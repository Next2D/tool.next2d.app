/*!
 * licenses: MIT Licenses.
 * version: 0.196.0
 * author: Toshiyuki Ienaga <ienaga@tvon.jp>
 * copyright: (c) 2021-2023 Toshiyuki Ienaga.
 */
"nt"in window||function(e){"use strict";class t{constructor(){this.mapping=this.createMapping(),requestAnimationFrame(this.initialize.bind(this))}initialize(){const e=document.getElementsByClassName("language");for(let t=0;t<e.length;++t){const r=e[t],a=r.dataset.text;if(!this.mapping.has(a))continue;let s=this.mapping.get(a),i=r.dataset.shortcutKey;if(i){const e=d.$shortcutSetting.viewMapping.get(r.dataset.area);s+=` (${e.has(i)?e.get(i).text:r.dataset.shortcutText})`}r.innerText=s}}replace(e){return this.mapping.has(e)?this.mapping.get(e):e}}class r extends t{createMapping(){return new Map([["{{ロックされたレイヤーです}}","锁定的层"],["{{トゥイーンには複数のオブジェクトを設置できません}}","多个对象不能放在一个Tween上"],["{{名前が重複しています}}","重复的名字"],["{{名前は必須です}}","名字是必须的"],["{{基準点}}","参考点"],["{{自由変形ツール}}","免费转换工具"],["{{キーフレームに変換}}","转换为关键帧"],["{{空のキーフレームに変換}}","转换为空关键帧"],["{{最初のフレームに移動}}","转到第一帧"],["{{最後のフレームに移動}}","转到最后一帧"],["{{SWFを解析中}}","正在分析的SWF"],["{{JSONを生成}}","生成JSON"],["{{ファイルを生成}}","生成文件"],["{{N2Dファイルの読み込み}}","加载N2D文件"],["{{JSONの読み込み}}","读取JSON"],["{{データを解凍中}}","对数据进行解压"],["{{データを圧縮中}}","压缩数据"],["{{エンコード}}","编码"],["{{外部ファイルの読み込み}}","加载外部文件"],["{{バイナリデータを生成}}","生成二进制数据"],["{{データベースを起動}}","启动数据库"],["{{データを保存中}}","储存数据"],["{{完了}}","完成"],["{{ステージ左揃え}}","舞台左侧对齐"],["{{ステージ中央揃え(水平方向)}}","对准舞台中心（水平）"],["{{ステージ右揃え}}","舞台右侧的对齐"],["{{ステージ上揃え}}","对齐舞台"],["{{ステージ中央揃え(垂直方向)}}","对准舞台中心（垂直）"],["{{ステージ下揃え}}","对准舞台底部"],["{{定規}}","尺子"],["{{表示}}","展示"],["{{ショートカット}}","快捷方式"],["{{レイヤーを複製}}","复制图层"],["{{未使用のフォルダを削除}}","删除未使用的文件夹"],["{{同名のアイテムが存在します}}","存在相同名称的项目"],["{{追加ファイル}}","附加文件"],["{{既存のコンテンツ}}","现有的内容"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","你可以选择覆盖、重命名和添加文件或跳过"],["{{全て上書き}}","覆盖所有"],["{{全てスキップ}}","跳过所有"],["{{追加・上書き}}","添加和覆盖"],["{{スキップ}}","跳过"],["{{表示確認したいフレームを指定}}","指定你要检查显示的框架"],["{{ファイル名を指定}}","指定文件名"],["{{ファイル名}}","文件名"],["{{終了フレームを指定}}","指定终端框架"],["{{開始フレームを指定}}","指定起始框架"],["{{フレーム設定}}","框架设置"],["{{書き出し設定}}","出口设置"],["{{ファイル形式の選択}}","选择文件格式"],["{{ファイル形式}}","文件格式"],["{{サイズ設定}}","尺寸"],["{{左上}}","左上"],["{{中央上}}","中-上"],["{{右上}}","右上"],["{{中央左}}","中间偏左"],["{{中央}}","中央"],["{{中央右}}","中右翼"],["{{左下}}","左下角"],["{{中央下}}","中下级"],["{{右下}}","右下"],["{{中心点のX座標}}","中心点的X坐标"],["{{中心点のY座標}}","中心点的Y坐标"],["{{MovieClipに変換}}","转换为MovieClip"],["{{変換}}","蜕变"],["{{ループ回数}}","循环次数"],["{{カーブポインターの削除}}","删除曲线指针"],["{{ステージ基準}}","阶段性标准"],["{{閉じる}}","贴近"],["{{保存}}","储存"],["{{リセット}}","重置"],["{{スクリーン}}","筛选"],["{{ショートカット設定}}","捷径设置"],["{{レイヤーカラー}}","分层色"],["{{Next2Dを支援する}}","支持Next2D"],["{{サポート}}","支持"],["{{未使用のアイテムを削除}}","删除未使用的项目"],["{{レイヤーをペースト}}","粘贴层"],["{{レイヤーをコピー}}","复制层"],["{{フレームをペースト}}","粘贴框架"],["{{フレームをコピー}}","复制框架"],["{{キーフレームを削除}}","删除关键帧"],["{{キーフレームに空のキーフレームを追加できません}}","不能向关键帧添加空关键帧"],["{{ズームツール}}","缩放工具"],["{{タイムライン幅の拡大・縮小}}","时间线宽度 扩大/缩小"],["{{ガイドレイヤー}}","指导层"],["{{音量設定}}","音量设置"],["{{サウンドを削除}}","移除声音"],["{{カスタムループ}}","定制的循环"],["{{読込のみ}}","只读"],["{{書込を許可}}","职位许可"],["{{単一行}}","单线"],["{{複数行}}","多线"],["{{自動で折り返し}}","自动绕行"],["{{左寄せ}}","左对齐"],["{{中央揃え}}","定心"],["{{右寄せ}}","右对齐"],["{{放射状グラデーション}}","径向梯度"],["{{線形グラデーション}}","线性梯度"],["{{画像}}","图片"],["{{画像選択}}","图像选择"],["{{種別}}","分类"],["{{Shapeの色設定}}","形状颜色设置"],["{{変形}}","变形"],["{{カラー効果}}","颜色转换"],["{{フィルター}}","滤镜"],["{{Shapeを複製}}","复制的形状"],["{{読み込み}}","读在"],["{{新規フォルダー}}","新文件夹"],["{{新規MovieClip}}","新的电影剪辑"],["{{枠に合わせてテキストをリサイズ}}","调整文字大小以适应框架"],["{{テキストに合わせて枠をリサイズ}}","调整框架的大小以适应文本"],["{{リサイズしない}}","不调整大小"],["{{フォント}}","字体"],["{{テキスト}}","文本"],["{{ループ}}","循环"],["{{音量}}","音量"],["{{ビデオ}}","视频"],["{{イージング}}","缓和"],["{{サウンド}}","声音"],["{{シンボル}}","符号"],["{{名前}}","命名"],["{{オブジェクト}}","对象"],["{{ステージ設定}}","舞台设置"],["{{プレビュー}}","预览"],["{{削除}}","删除"],["{{ペースト}}","粘贴"],["{{コピー}}","拷贝"],["{{プラグインメニュー}}","插件菜单"],["{{トゥイーン}}","嫩枝"],["{{カーブポインターの追加}}","额外的曲线指示器"],["{{パスの結合}}","路径合并"],["{{シェイプ}}","形状"],["{{キーフレームに配分}}","分配给关键帧"],["{{レイヤーに配分}}","分配到各层"],["{{タイムライン}}","时间线"],["{{整列}}","对齐"],["{{最背面}}","最 后"],["{{ひとつ背面へ}}","一个背影"],["{{ひとつ前面へ}}","一个正面"],["{{最前面}}","最前线"],["{{重ね順}}","继承顺序"],["{{プラグイン}}","插件"],["{{ライブラリ}}","图书馆"],["{{プロパティ}}","财产"],["{{マスクレイヤー}}","掩膜层"],["{{通常レイヤー}}","普通层"],["{{モーショントゥイーンの削除}}","删去了运动推理的内容"],["{{モーショントゥイーンの追加}}","额外的议案推理"],["{{モーダル表示}}","模态指示"],["{{言語}}","语言"],["{{フォーマット}}","格式"],["{{含める}}","包括"],["{{含めない}}","不包括"],["{{使い方、リファレンス}}","用法，参考"],["{{非表示レイヤー}}","隐藏层"],["{{設定}}","设置"],["{{デフォルトのループを利用する}}","使用默认的循环"],["{{フレームピッカー}}","选框机"],["{{左揃え}}","左对齐"],["{{中央揃え(水平方向)}}","居中（水平方向）"],["{{右揃え}}","右对齐"],["{{上揃え}}","上对齐"],["{{中央揃え(垂直方向)}}","居中（垂直方向）"],["{{下揃え}}","下对齐"],["{{開始フレーム}}","起始框架"],["{{終了フレーム}}","终端框架"],["{{ループで再生}}","循环播放"],["{{1回再生}}","1次播放"],["{{指定したフレームで固定}}","固定在指定的框架内"],["{{1回逆再生}}","1 反向播放"],["{{逆ループで再生}}","反向循环播放"],["{{画面の拡大・縮小}}","画面的放大和缩小"],["{{カスタムイージングデータを保存}}","保存自定义缓和数据"],["{{カスタムイージングデータの読込}}","读取自定义宽松数据"],["{{プレビューのON/OFF}}","预览开/关"],["{{フォント枠サイズ}}","字体帧大小"],["{{フォント枠カラー}}","字体帧颜色"],["{{オニオンスキン}}","洋葱皮"],["{{バケツツール}}","整体填充工具"],["{{ペンツール}}","钢笔工具"],["{{ダブルクリックでカーブポイントが追加されます}}","双击来添加一个曲线点"],["{{選択ツール}}","选择工具"],["{{Shape変形ツール}}","形状变换工具"],["{{テキストツール}}","文本工具"],["{{矩形ツール}}","矩形工具"],["{{楕円ツール}}","椭圆工具"],["{{角丸矩形ツール}}","圆角矩形工具"],["{{塗りのカラー}}","填充颜色"],["{{線のカラー}}","画笔颜色"],["{{線の太さ}}","画笔宽度"],["{{プロジェクトデータの読込}}","载入工程文件"],["{{プロジェクトデータを保存}}","保存工程文件"],["{{書き出し}}","导出"],["{{Discordへ移動}}","前往discord"],["{{バグ報告}}","错误报告"],["{{設定}}","设置"],["{{タブを追加}}","添加标签页"],["{{タブの一覧を表示・移動}}","标签页列表"],["{{スクリプトを追加}}","添加一个脚本"],["{{キーフレームを追加}}","添加一个关键帧"],["{{空のキーフレームを追加}}","添加一个空的关键帧"],["{{フレームを追加}}","添加帧"],["{{フレームを削除}}","删除帧"],["{{再生}}","播放"],["{{停止}}","停止"],["{{ループ設定}}","循环设置"],["{{レイヤーを追加}}","添加图层"],["{{レイヤーを削除}}","删除图层"],["{{全てのレイヤーをハイライト}}","高亮所有图层"],["{{全てのレイヤーを非表示}}","隐藏所有图层"],["{{全てのレイヤーをロック}}","锁定所有图层"],["{{比率を固定}}","锁定比例"],["{{ステージの幅}}","画面宽度"],["{{背景色}}","背景颜色"],["{{ステージの高さ}}","画面高度"],["{{フレームレート}}","帧速率"],["{{シンボル名}}","符号名称"],["{{イージング設定}}","过渡设置"],["{{ビデオの音量設定}}","视频音量设置"],["{{自動再生}}","自动播放"],["{{テキストエリアのボーダー設定}}","文本框边框设置"],["{{テキスト入力設定}}","文本输入设置"],["{{フォント選択}}","字体选择"],["{{自動サイズ調整}}","自动调整尺寸"],["{{フォントスタイルタイプ}}","字体风格类型"],["{{行揃え}}","对齐"],["{{改行設定}}","换行设置"],["{{スクロール設定}}","滚动设置"],["{{フォントサイズ}}","字体大小"],["{{フォントカラー}}","字体颜色"],["{{行間}}","行间距"],["{{文字幅}}","字符宽度"],["{{左マージン}}","左边距"],["{{右マージン}}","右边距"],["{{カラー種別の選択}}","选择颜色类型"],["{{背景画像の選択}}","选择背景图片"],["{{カラーポインターを追加}}","添加颜色指针"],["{{カラー値}}","颜色"],["{{アルファ(0%-100%)}}","透明度（0%-100%）"],["{{アルファ値}}","透明度"],["{{選択対象の幅}}","选择对象的宽度"],["{{選択対象のX座標}}","选择对象的X轴坐标"],["{{選択対象の高さ}}","选择对象的高度"],["{{選択対象のY座標}}","选择对象的Y轴坐标"],["{{選択対象の幅の伸縮}}","选定对象的X轴缩放"],["{{選択対象を回転}}","旋转物体"],["{{選択対象の高さの伸縮}}","所选对象的比例Y"],["{{アルファオフセット(-255〜255)}}","透明度偏移（-255~255）"],["{{赤(0%-100%)}}","红色（0%-100%）"],["{{赤オフセット(-255〜255)}}","红色偏移（-255~255）"],["{{緑(0%-100%)}}","绿色（0%-100%）"],["{{緑オフセット(-255〜255)}}","绿色偏移（-255~255）"],["{{青(0%-100%)}}","蓝色（0%-100%）"],["{{青オフセット(-255〜255)}}","蓝色偏移（-255~255）"],["{{ブレンドモード}}","混合模式"],["{{フィルターを選択}}","选择滤镜"],["{{フィルターを追加}}","添加滤镜"],["{{サウンドを追加}}","添加声音"],["{{フィルターを表示・非表示する}}","显示和隐藏滤镜"],["{{フィルターを削除}}","删除滤镜"],["{{水平方向にぼかす}}","横向模糊"],["{{垂直方向にぼかす}}","纵向模糊"],["{{フィルター強度}}","滤镜强度"],["{{フィルター角度}}","滤镜角度"],["{{シャドウのアルファ}}","阴影透明度"],["{{シャドウのカラー}}","阴影颜色"],["{{フィルター距離}}","滤镜距离"],["{{ハイライトのカラー}}","高光色"],["{{ハイライトのアルファ}}","高光透明度"],["{{グラデーションカラー}}","渐变色"],["{{グラデーションのアルファ}}","渐变透明度"],["{{タブの移動・名前を変更}}","移动/重命名标签"],["{{プロジェクトを閉じる}}","关闭工程"],["{{上下に移動}}","上下移动"],["{{レイヤー変更(ダブルクリック)}}","改变图层（双击）"],["{{レイヤーをハイライト}}","高亮图层"],["{{レイヤーを非表示}}","隐藏图层"],["{{レイヤーをロック}}","锁定图层"],["{{カーブポインター(ダブルクリックでON/OFF)}}","曲线指针（双击打开/关闭）"],["{{インスタンス名}}","实例名称"],["{{ライブラリ内の検索}}","在库中搜索"],["{{フレームラベル}}","帧标签"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","如果工程没有保存，将无法恢复此标签页数据。 你想删除这个标签页吗？"]])}}class a extends t{createMapping(){return new Map([["{{ロックされたレイヤーです}}","Locked layer"],["{{トゥイーンには複数のオブジェクトを設置できません}}","Multiple objects cannot be placed on a tween"],["{{名前が重複しています}}","Duplicate Name"],["{{名前は必須です}}","Name is required"],["{{基準点}}","Reference Point"],["{{自由変形ツール}}","Free Transform Tool"],["{{キーフレームに変換}}","Convert to keyframes"],["{{空のキーフレームに変換}}","Convert to empty keyframes"],["{{最初のフレームに移動}}","Go to First Frame"],["{{最後のフレームに移動}}","Go to Last Frame"],["{{SWFを解析中}}","SWF Being Parsed"],["{{JSONを生成}}","Generate JSON"],["{{ファイルを生成}}","Generate File"],["{{N2Dファイルの読み込み}}","Loading N2D File"],["{{JSONの読み込み}}","Loading JSON"],["{{データを解凍中}}","Decompressing Data"],["{{データを圧縮中}}","Compressing Data"],["{{エンコード}}","Encoding"],["{{外部ファイルの読み込み}}","Reading External Files"],["{{バイナリデータを生成}}","Generating Binary Data"],["{{データベースを起動}}","Starting the Database"],["{{データを保存中}}","Storing Data"],["{{完了}}","Completed"],["{{ステージ左揃え}}","Align Stage Left"],["{{ステージ中央揃え(水平方向)}}","Align Stage Center (Horizontal)"],["{{ステージ右揃え}}","Align Stage Right"],["{{ステージ上揃え}}","Align Stage Top"],["{{ステージ中央揃え(垂直方向)}}","Center Stage (Vertical)"],["{{ステージ下揃え}}","Align Bottom of Stage"],["{{定規}}","Ruler"],["{{表示}}","Display"],["{{ショートカット}}","Shortcut"],["{{レイヤーを複製}}","Duplicate Layer"],["{{未使用のフォルダを削除}}","Delete unused folders"],["{{同名のアイテムが存在します}}","An item of the same name exists"],["{{追加ファイル}}","Additional File"],["{{既存のコンテンツ}}","Existing Content"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","You can choose to overwrite, rename and add files, or skip"],["{{全て上書き}}","Overwrite All"],["{{全てスキップ}}","Skip All"],["{{追加・上書き}}","Add or Overwrite"],["{{スキップ}}","Skip"],["{{表示確認したいフレームを指定}}","Specify the frame you want to check the display"],["{{ファイル名を指定}}","Specify File Name"],["{{ファイル名}}","File Name"],["{{終了フレームを指定}}","Specify End Frame"],["{{開始フレームを指定}}","Specify Start Frame"],["{{フレーム設定}}","Frame Setting"],["{{書き出し設定}}","Export Settings"],["{{ファイル形式の選択}}","Select File Format"],["{{ファイル形式}}","File Formats"],["{{サイズ設定}}","Size Setting"],["{{左上}}","Top Left"],["{{中央上}}","Top Center"],["{{右上}}","Top Right"],["{{中央左}}","Center Left"],["{{中央}}","Center"],["{{中央右}}","Center Right"],["{{左下}}","Bottom Left"],["{{中央下}}","Bottom Center"],["{{右下}}","Bottom Right"],["{{中心点のX座標}}","X coordinate of the center point"],["{{中心点のY座標}}","Y coordinate of the center point"],["{{MovieClipに変換}}","Convert to MovieClip"],["{{変換}}","Conversion"],["{{ループ回数}}","Loop Count"],["{{カーブポインターの削除}}","Delete curve pointer"],["{{ステージ基準}}","Stage Criteria"],["{{閉じる}}","Close"],["{{保存}}","Save"],["{{リセット}}","Reset"],["{{スクリーン}}","Screen"],["{{ショートカット設定}}","Shortcut Settings"],["{{レイヤーカラー}}","Layer Color"],["{{Next2Dを支援する}}","Support Next2D"],["{{サポート}}","Support"],["{{未使用のアイテムを削除}}","Delete unused items"],["{{レイヤーをペースト}}","Paste Layer"],["{{レイヤーをコピー}}","Copy Layer"],["{{フレームをペースト}}","Paste Frame"],["{{フレームをコピー}}","Copy Frame"],["{{キーフレームを削除}}","Delete keyframe"],["{{キーフレームに空のキーフレームを追加できません}}","Cannot add an empty keyframe to a keyframe"],["{{ズームツール}}","Zoom Tool"],["{{タイムライン幅の拡大・縮小}}","Timeline Width Expand/Reduce"],["{{ガイドレイヤー}}","Guide Layer"],["{{音量設定}}","Volume Setting"],["{{サウンドを削除}}","Remove Sound"],["{{カスタムループ}}","Custom Loop"],["{{読込のみ}}","ReadOnly"],["{{書込を許可}}","Writeable"],["{{単一行}}","Single line"],["{{複数行}}","Multiline"],["{{自動で折り返し}}","Auto Wrap"],["{{左寄せ}}","Left"],["{{中央揃え}}","Center"],["{{右寄せ}}","Right"],["{{放射状グラデーション}}","Radial Gradient"],["{{線形グラデーション}}","Linear Gradient"],["{{画像}}","Image"],["{{画像選択}}","Image Selection"],["{{種別}}","Type"],["{{Shapeの色設定}}","Shape color settings"],["{{変形}}","Transform"],["{{カラー効果}}","Color Transform"],["{{フィルター}}","Filter"],["{{Shapeを複製}}","Duplicate Shape"],["{{読み込み}}","Read in"],["{{新規フォルダー}}","Added Folder"],["{{新規MovieClip}}","Added MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Resize text to fit the frame"],["{{テキストに合わせて枠をリサイズ}}","Resize the frame to fit the text"],["{{リサイズしない}}","No Resize"],["{{フォント}}","Font"],["{{テキスト}}","Text"],["{{ループ}}","Loop"],["{{音量}}","Volume"],["{{ビデオ}}","Video"],["{{イージング}}","Easing"],["{{サウンド}}","Sound"],["{{シンボル}}","Symbol"],["{{名前}}","Name"],["{{オブジェクト}}","Object"],["{{ステージ設定}}","Stage Setting"],["{{プレビュー}}","Preview"],["{{削除}}","Delete"],["{{ペースト}}","Paste"],["{{コピー}}","Copy"],["{{プラグインメニュー}}","Plugin Menu"],["{{トゥイーン}}","Tween"],["{{カーブポインターの追加}}","Added Curve Pointer"],["{{パスの結合}}","Integrating paths"],["{{シェイプ}}","Shape"],["{{キーフレームに配分}}","Distribute to Keyframes"],["{{レイヤーに配分}}","Distribute to Layers"],["{{タイムライン}}","Timeline"],["{{整列}}","Align"],["{{最背面}}","Send to Back"],["{{ひとつ背面へ}}","Send to Backward"],["{{ひとつ前面へ}}","Bring to Forward"],["{{最前面}}","Bring to Front"],["{{重ね順}}","Arrange"],["{{プラグイン}}","Plugin"],["{{ライブラリ}}","Library"],["{{プロパティ}}","Property"],["{{マスクレイヤー}}","Mask Layer"],["{{通常レイヤー}}","Normal Layer"],["{{モーショントゥイーンの削除}}","Deleted Motion Tweening"],["{{モーショントゥイーンの追加}}","Added Motion Tweening"],["{{モーダル表示}}","Modal Indication"],["{{言語}}","Language"],["{{フォーマット}}","Format"],["{{含める}}","Include"],["{{含めない}}","Not Including"],["{{使い方、リファレンス}}","Usage, Reference"],["{{非表示レイヤー}}","Hidden Layers"],["{{設定}}","Setting"],["{{デフォルトのループを利用する}}","Use the default loop"],["{{フレームピッカー}}","Frame Picker"],["{{左揃え}}","Left"],["{{中央揃え(水平方向)}}","Center (Horizontal)"],["{{右揃え}}","Right"],["{{上揃え}}","Top"],["{{中央揃え(垂直方向)}}","Center (Vertical)"],["{{下揃え}}","Bottom"],["{{開始フレーム}}","Start Frame"],["{{終了フレーム}}","End Frame"],["{{ループで再生}}","Play in loop"],["{{1回再生}}","1 playback"],["{{指定したフレームで固定}}","Fixed at the specified frame"],["{{1回逆再生}}","1 reverse playback"],["{{逆ループで再生}}","Playback in reverse loop"],["{{画面の拡大・縮小}}","Zoom in/out of screen"],["{{カスタムイージングデータを保存}}","Save custom easing data"],["{{カスタムイージングデータの読込}}","Reading custom easing data"],["{{プレビューのON/OFF}}","Preview on/off"],["{{フォント枠サイズ}}","Font Frame Size"],["{{フォント枠カラー}}","Font Frame Color"],["{{オニオンスキン}}","Onion Skin"],["{{バケツツール}}","Bucket Tools"],["{{ペンツール}}","Pen Tool"],["{{ダブルクリックでカーブポイントが追加されます}}","Double-click to add a curve point"],["{{選択ツール}}","Selection Tool"],["{{Shape変形ツール}}","Shape Transform Tool"],["{{テキストツール}}","Text Tool"],["{{矩形ツール}}","Rectangle Tool"],["{{楕円ツール}}","Ellipse Tool"],["{{角丸矩形ツール}}","Rounded Rectangle Tool"],["{{塗りのカラー}}","Fill Color"],["{{線のカラー}}","Stroke Color"],["{{線の太さ}}","Stroke Width"],["{{プロジェクトデータの読込}}","Loading project data"],["{{プロジェクトデータを保存}}","Save project data"],["{{書き出し}}","Export"],["{{Discordへ移動}}","Go to discord"],["{{バグ報告}}","Bug reports"],["{{設定}}","Setting"],["{{タブを追加}}","Add a tab"],["{{タブの一覧を表示・移動}}","View and move through the list of tabs"],["{{スクリプトを追加}}","Add a script"],["{{キーフレームを追加}}","Add a keyframe"],["{{空のキーフレームを追加}}","Add an empty keyframe"],["{{フレームを追加}}","Add a frame"],["{{フレームを削除}}","Delete frame"],["{{再生}}","Play"],["{{停止}}","Stop"],["{{ループ設定}}","Loop Setting"],["{{レイヤーを追加}}","Add a layer"],["{{レイヤーを削除}}","Delete layer"],["{{全てのレイヤーをハイライト}}","Highlight all layers"],["{{全てのレイヤーを非表示}}","Hide all layers"],["{{全てのレイヤーをロック}}","Lock all layers"],["{{比率を固定}}","Fixed ratio"],["{{ステージの幅}}","Stage Width"],["{{背景色}}","Background Color"],["{{ステージの高さ}}","Stage Height"],["{{フレームレート}}","Frame Rate"],["{{シンボル名}}","Symbol Name"],["{{イージング設定}}","Easing Setting"],["{{ビデオの音量設定}}","Video Volume Setting"],["{{自動再生}}","Auto Play"],["{{テキストエリアのボーダー設定}}","Text Area Border Setting"],["{{テキスト入力設定}}","Text Input Setting"],["{{フォント選択}}","Font Select"],["{{自動サイズ調整}}","Automatic size adjustment"],["{{フォントスタイルタイプ}}","Font Style Type"],["{{行揃え}}","Align"],["{{改行設定}}","Newline Setting"],["{{スクロール設定}}","Scroll Setting"],["{{フォントサイズ}}","Font Size"],["{{フォントカラー}}","Font Color"],["{{行間}}","Line Space"],["{{文字幅}}","Character Width"],["{{左マージン}}","Left Margin"],["{{右マージン}}","Right Margin"],["{{カラー種別の選択}}","Select a color type"],["{{背景画像の選択}}","Selecting a background image"],["{{カラーポインターを追加}}","Add color pointers"],["{{カラー値}}","Color"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Width of the selection object"],["{{選択対象のX座標}}","X coordinate of the selection object"],["{{選択対象の高さ}}","Height  of the selection object"],["{{選択対象のY座標}}","Y coordinate of the selection object"],["{{選択対象の幅の伸縮}}","scaleX of the selected object"],["{{選択対象を回転}}","Rotate the object"],["{{選択対象の高さの伸縮}}","scaleY of the selected object"],["{{アルファオフセット(-255〜255)}}","Alpha Offset(-255〜255)"],["{{赤(0%-100%)}}","Red(0%-100%)"],["{{赤オフセット(-255〜255)}}","Red Offset(-255〜255)"],["{{緑(0%-100%)}}","Green(0%-100%)"],["{{緑オフセット(-255〜255)}}","Green Offset(-255〜255)"],["{{青(0%-100%)}}","Blue(0%-100%)"],["{{青オフセット(-255〜255)}}","Blue Offset(-255〜255)"],["{{ブレンドモード}}","Blend Mode"],["{{フィルターを選択}}","Select a filter"],["{{フィルターを追加}}","Add a filter"],["{{サウンドを追加}}","Add a sound"],["{{フィルターを表示・非表示する}}","Show and Hide filters"],["{{フィルターを削除}}","Delete Filter"],["{{水平方向にぼかす}}","Blur Horizontally"],["{{垂直方向にぼかす}}","Blur Vertically"],["{{フィルター強度}}","Filter Strength"],["{{フィルター角度}}","Filter Angle"],["{{シャドウのアルファ}}","Shadow Alpha"],["{{シャドウのカラー}}","Shadow Color"],["{{フィルター距離}}","Filter Distance"],["{{ハイライトのカラー}}","Highlight Color"],["{{ハイライトのアルファ}}","Highlight Alpha"],["{{グラデーションカラー}}","Gradient Color"],["{{グラデーションのアルファ}}","Gradient Alpha"],["{{タブの移動・名前を変更}}","Move/Rename tabs"],["{{プロジェクトを閉じる}}","Close the project"],["{{上下に移動}}","Move up and down"],["{{レイヤー変更(ダブルクリック)}}","Layer Change(double-click)"],["{{レイヤーをハイライト}}","Highlight Layer"],["{{レイヤーを非表示}}","Hide Layer"],["{{レイヤーをロック}}","Lock the Layer"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Curve Pointer (double click to turn on/off)"],["{{インスタンス名}}","Instance Name"],["{{ライブラリ内の検索}}","Search in the library"],["{{フレームラベル}}","Frame Label"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","If the project is not saved, the project data in this tab cannot be recovered. Do you want to delete the tab?"]])}}class s extends t{createMapping(){return new Map([["{{ロックされたレイヤーです}}","Couche verrouillée"],["{{トゥイーンには複数のオブジェクトを設置できません}}","Il n'est pas possible de placer plusieurs objets sur un tween"],["{{名前が重複しています}}","Nom en double"],["{{名前は必須です}}","Le nom est obligatoire"],["{{名前が重複しています}}","Duplicate Name"],["{{名前は必須です}}","Name is required"],["{{自由変形ツール}}","Outil de transformation gratuit"],["{{キーフレームに変換}}","Convertir en image clé"],["{{空のキーフレームに変換}}","Convertir en images clés vides"],["{{最初のフレームに移動}}","Aller au premier cadre"],["{{最後のフレームに移動}}","Aller à la dernière image"],["{{SWFを解析中}}","SWF en cours d'analyse"],["{{JSONを生成}}","Générer JSON"],["{{ファイルを生成}}","Générer un fichier"],["{{N2Dファイルの読み込み}}","Chargement des fichiers N2D"],["{{JSONの読み込み}}","Chargement de JSON"],["{{データを解凍中}}","Décompression des données"],["{{データを圧縮中}}","Compression des données"],["{{エンコード}}","Encodage"],["{{外部ファイルの読み込み}}","Lecture de fichiers externes"],["{{バイナリデータを生成}}","Génération de données binaires"],["{{データベースを起動}}","Démarrage de la base de données"],["{{データを保存中}}","Stockage des données en cours"],["{{完了}}","Complété"],["{{ステージ左揃え}}","Aligner la scène à gauche"],["{{ステージ中央揃え(水平方向)}}","Aligner le centre de la scène (horizontal)"],["{{ステージ右揃え}}","Aligner la scène à droite"],["{{ステージ上揃え}}","Aligner la scène vers le haut"],["{{ステージ中央揃え(垂直方向)}}","Aligner le centre de la scène (vertical)"],["{{ステージ下揃え}}","Aligner le fond de la scène"],["{{定規}}","Règle"],["{{表示}}","Afficher"],["{{ショートカット}}","Raccourci"],["{{レイヤーを複製}}","Dupliquer la couche"],["{{未使用のフォルダを削除}}","Supprimez les dossiers inutilisés"],["{{同名のアイテムが存在します}}","Un ou plusieurs articles du même nom existent"],["{{追加ファイル}}","Fichier supplémentaire"],["{{既存のコンテンツ}}","Contenu existant"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","Vous pouvez choisir d'écraser, de renommer et d'ajouter des fichiers, ou de ne pas le faire"],["{{全て上書き}}","Ecraser tout"],["{{全てスキップ}}","Ignorer tout"],["{{追加・上書き}}","Ajouter ou Écraser"],["{{スキップ}}","Ignorer"],["{{表示確認したいフレームを指定}}","Specify the frame you want to check the display"],["{{ファイル名を指定}}","Spécifier le nom du fichier"],["{{ファイル名}}","nom du fichier"],["{{終了フレームを指定}}","Spécifier le cadre de fin"],["{{開始フレームを指定}}","Spécifier le cadre de départ"],["{{フレーム設定}}","Réglage du cadre"],["{{書き出し設定}}","Paramètres d'exportation"],["{{ファイル形式の選択}}","Sélectionner le format du fichier"],["{{ファイル形式}}","Formats de fichiers"],["{{サイズ設定}}","Réglage de la taille"],["{{左上}}","En haut à gauche"],["{{中央上}}","Centre supérieur"],["{{右上}}","Haut Droite"],["{{中央左}}","Centre gauche"],["{{中央}}","Centre"],["{{中央右}}","Centre droit"],["{{左下}}","Bas gauche"],["{{中央下}}","Bas Centre"],["{{右下}}","Bas droit"],["{{中心点のX座標}}","Coordonnée X du point central"],["{{中心点のY座標}}","Coordonnée Y du point central"],["{{MovieClipに変換}}","Convertir en MovieClip"],["{{変換}}","transformation"],["{{ループ回数}}","Nombre de boucles"],["{{カーブポインターの削除}}","Supprimer le pointeur de courbe"],["{{ステージ基準}}","Critères d'étape"],["{{閉じる}}","Fermer"],["{{保存}}","Sauvez"],["{{リセット}}","réinitialiser"],["{{スクリーン}}","Écran"],["{{ショートカット設定}}","Paramètres des raccourcis"],["{{レイヤーカラー}}","couleur superposée"],["{{Next2Dを支援する}}","Soutenez Next2D"],["{{サポート}}","soutien"],["{{未使用のアイテムを削除}}","Retirer les articles non utilisés"],["{{レイヤーをペースト}}","Couche de pâte"],["{{レイヤーをコピー}}","Copie de la couche"],["{{フレームをペースト}}","Coller le cadre"],["{{フレームをコピー}}","Cadre de copie"],["{{キーフレームを削除}}","Supprimez les images clés"],["{{キーフレームに空のキーフレームを追加できません}}","Impossible d'ajouter des images clés vides à des images clés"],["{{ズームツール}}","Outil de zoom"],["{{タイムライン幅の拡大・縮小}}","Largeur de la ligne de temps Développer/réduire"],["{{ガイドレイヤー}}","couche de guidage"],["{{音量設定}}","Réglage du volume"],["{{サウンドを削除}}","Supprimer le son"],["{{カスタムループ}}","boucle personnalisée"],["{{読込のみ}}","Lecture seulement"],["{{書込を許可}}","autorisation de poste"],["{{単一行}}","Ligne unique"],["{{複数行}}","Multiline"],["{{自動で折り返し}}","Enveloppe automatique"],["{{左寄せ}}","Gauche"],["{{中央揃え}}","Centre"],["{{右寄せ}}","Droite"],["{{放射状グラデーション}}","gradation radiale"],["{{線形グラデーション}}","gradient linéaire"],["{{画像}}","Image"],["{{画像選択}}","Sélection d'images"],["{{種別}}","Type"],["{{Shapeの色設定}}","Paramètres de couleur de la forme"],["{{変形}}","déformation"],["{{カラー効果}}","Transformation des couleurs"],["{{フィルター}}","filtre"],["{{Shapeを複製}}","Dupliquer la forme"],["{{読み込み}}","lire dans"],["{{新規フォルダー}}","Nouveau dossier"],["{{新規MovieClip}}","Nouveau MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Redimensionnez le texte pour l'adapter au cadre"],["{{テキストに合わせて枠をリサイズ}}","Redimensionnez le cadre pour l'adapter au texte"],["{{リサイズしない}}","Pas de redimensionnement"],["{{フォント}}","police"],["{{テキスト}}","Texte"],["{{ループ}}","boucle"],["{{音量}}","volume"],["{{ビデオ}}","Vidéo"],["{{イージング}}","facilitant"],["{{サウンド}}","son"],["{{シンボル}}","Symbole"],["{{名前}}","Nom"],["{{オブジェクト}}","objet"],["{{ステージ設定}}","Mise en scène"],["{{プレビュー}}","Prévisualisation"],["{{削除}}","Supprimer"],["{{ペースト}}","Pâte"],["{{コピー}}","Copie"],["{{プラグインメニュー}}","Menu plug-in"],["{{トゥイーン}}","entre"],["{{カーブポインターの追加}}","Pointeur de courbe supplémentaire"],["{{パスの結合}}","Fusion de chemins"],["{{シェイプ}}","forme"],["{{キーフレームに配分}}","Attribution aux images clés"],["{{レイヤーに配分}}","Affectation aux couches"],["{{タイムライン}}","chronologie"],["{{整列}}","Aligner"],["{{最背面}}","La plupart des dos"],["{{ひとつ背面へ}}","Un à l'arrière"],["{{ひとつ前面へ}}","Un front"],["{{最前面}}","Frontmost"],["{{重ね順}}","Organiser"],["{{プラグイン}}","plug-in"],["{{ライブラリ}}","bibliothèque"],["{{プロパティ}}","propriété"],["{{マスクレイヤー}}","couche de masque"],["{{通常レイヤー}}","Couche normale"],["{{モーショントゥイーンの削除}}","Suppression des tweens de mouvement"],["{{モーショントゥイーンの追加}}","Des tweens de mouvement supplémentaires"],["{{モーダル表示}}","indication modale"],["{{言語}}","Langue"],["{{フォーマット}}","format"],["{{含める}}","inclure"],["{{含めない}}","à ne pas inclure"],["{{使い方、リファレンス}}","Utilisation, référence"],["{{非表示レイヤー}}","couche cachée"],["{{設定}}","configuration"],["{{デフォルトのループを利用する}}","Utilisez la boucle par défaut"],["{{フレームピッカー}}","ramasseur de cadres"],["{{左揃え}}","Gauche"],["{{中央揃え(水平方向)}}","Centre(sens horizontal)"],["{{右揃え}}","Droit"],["{{上揃え}}","Top"],["{{中央揃え(垂直方向)}}","Centre(Vertical)"],["{{下揃え}}","Fond"],["{{開始フレーム}}","cadre de départ"],["{{終了フレーム}}","cadre terminal"],["{{ループで再生}}","Lecture en boucle"],["{{1回再生}}","1 lecture"],["{{指定したフレームで固定}}","Fixé dans le cadre spécifié"],["{{1回逆再生}}","1 lecture en sens inverse"],["{{逆ループで再生}}","Lecture en boucle inversée"],["{{画面の拡大・縮小}}","Zoom avant et arrière sur l'écran"],["{{カスタムイージングデータを保存}}","Enregistrez les données d'assouplissement personnalisées"],["{{カスタムイージングデータの読込}}","Lecture des données de l'assouplissement personnalisé"],["{{プレビューのON/OFF}}","Activation/désactivation de la prévisualisation"],["{{フォント枠サイズ}}","Taille du cadre de la police"],["{{フォント枠カラー}}","Couleur du cadre de la police"],["{{オニオンスキン}}","Peau d'oignon"],["{{バケツツール}}","Outils à godets"],["{{ペンツール}}","Outil stylo"],["{{ダブルクリックでカーブポイントが追加されます}}","Double-cliquez pour ajouter un point de courbe"],["{{選択ツール}}","Outils de sélection"],["{{Shape変形ツール}}","Outil de transformation des formes"],["{{テキストツール}}","Outil texte"],["{{矩形ツール}}","Outil Rectangle"],["{{楕円ツール}}","Outil Ellipse"],["{{角丸矩形ツール}}","Outil Rectangle arrondi"],["{{塗りのカラー}}","Couleur de remplissage"],["{{線のカラー}}","Couleur du trait"],["{{線の太さ}}","Largeur de course"],["{{プロジェクトデータの読込}}","Chargement des données du projet"],["{{プロジェクトデータを保存}}","Sauvegarder les données du projet"],["{{書き出し}}","Exportation"],["{{Discordへ移動}}","Aller sur le discord"],["{{バグ報告}}","Rapports de bogue"],["{{設定}}","Réglage de"],["{{タブを追加}}","Ajouter un onglet"],["{{タブの一覧を表示・移動}}","Visualiser et se déplacer dans la liste des onglets"],["{{スクリプトを追加}}","Ajouter un script"],["{{キーフレームを追加}}","Ajouter une image clé"],["{{空のキーフレームを追加}}","Ajouter une image clé vide"],["{{フレームを追加}}","Ajouter un cadre"],["{{フレームを削除}}","Supprimer le cadre"],["{{再生}}","Jouer"],["{{停止}}","Stop"],["{{ループ設定}}","Réglage de la boucle"],["{{レイヤーを追加}}","Ajouter une couche"],["{{レイヤーを削除}}","Supprimer la couche"],["{{全てのレイヤーをハイライト}}","Mettez en évidence toutes les couches"],["{{全てのレイヤーを非表示}}","Cacher toutes les couches"],["{{全てのレイヤーをロック}}","Verrouiller toutes les couches"],["{{比率を固定}}","Ratio fixe"],["{{ステージの幅}}","Largeur de la scène"],["{{背景色}}","Couleur de fond"],["{{ステージの高さ}}","Hauteur de la scène"],["{{フレームレート}}","Fréquence d'images"],["{{シンボル名}}","Nom du symbole"],["{{イージング設定}}","Réglage de l'assouplissement"],["{{ビデオの音量設定}}","Réglage du volume vidéo"],["{{自動再生}}","Lecture automatique"],["{{テキストエリアのボーダー設定}}","Réglage de la bordure de la zone de texte"],["{{テキスト入力設定}}","Réglage de la saisie du texte"],["{{フォント選択}}","Sélection de la police"],["{{自動サイズ調整}}","Ajustement automatique de la taille"],["{{フォントスタイルタイプ}}","Type de police"],["{{行揃え}}","Aligner"],["{{改行設定}}","Réglage des nouvelles lignes"],["{{スクロール設定}}","Réglage du défilement"],["{{フォントサイズ}}","Taille de la police"],["{{フォントカラー}}","Couleur de la police"],["{{行間}}","Espace linéaire"],["{{文字幅}}","Largeur des caractères"],["{{左マージン}}","Marge gauche"],["{{右マージン}}","Marge droite"],["{{カラー種別の選択}}","Sélectionnez un type de couleur"],["{{背景画像の選択}}","Sélection d'une image de fond"],["{{カラーポインターを追加}}","Ajouter des pointeurs de couleur"],["{{カラー値}}","Couleur"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Largeur de l'objet de sélection"],["{{選択対象のX座標}}","Coordonnée X de l'objet de sélection"],["{{選択対象の高さ}}","Hauteur de l'objet de sélection"],["{{選択対象のY座標}}","Coordonnée Y de l'objet de sélection"],["{{選択対象の幅の伸縮}}","scaleX de l'objet sélectionné"],["{{選択対象を回転}}","Faire pivoter l'objet"],["{{選択対象の高さの伸縮}}","scaleY de l'objet sélectionné"],["{{アルファオフセット(-255〜255)}}","Décalage alpha(-255〜255)"],["{{赤(0%-100%)}}","Rouge(0%-100%)"],["{{赤オフセット(-255〜255)}}","Décalage rouge(-255〜255)"],["{{緑(0%-100%)}}","Vert(0%-100%)"],["{{緑オフセット(-255〜255)}}","Compensation verte(-255〜255)"],["{{青(0%-100%)}}","Bleu(0%-100%)"],["{{青オフセット(-255〜255)}}","Décalage bleu(-255〜255)"],["{{ブレンドモード}}","Mode de mélange"],["{{フィルターを選択}}","Sélectionnez un filtre"],["{{フィルターを追加}}","Ajouter un filtre"],["{{サウンドを追加}}","Ajouter un son"],["{{フィルターを表示・非表示する}}","Afficher et masquer les filtres"],["{{フィルターを削除}}","Supprimer le filtre"],["{{水平方向にぼかす}}","Flou horizontal"],["{{垂直方向にぼかす}}","Flou vertical"],["{{フィルター強度}}","Résistance du filtre"],["{{フィルター角度}}","Angle du filtre"],["{{シャドウのアルファ}}","Shadow Alpha"],["{{シャドウのカラー}}","Couleur de l'ombre"],["{{フィルター距離}}","Distance du filtre"],["{{ハイライトのカラー}}","Couleur de mise en évidence"],["{{ハイライトのアルファ}}","Highlight Alpha"],["{{グラデーションカラー}}","Couleur dégradée"],["{{グラデーションのアルファ}}","Gradient Alpha"],["{{タブの移動・名前を変更}}","Déplacer/Renommer les onglets"],["{{プロジェクトを閉じる}}","Fermer le projet"],["{{上下に移動}}","Déplacement vers le haut et le bas"],["{{レイヤー変更(ダブルクリック)}}","Changement de couche (double-clic)"],["{{レイヤーをハイライト}}","Couche de mise en évidence"],["{{レイヤーを非表示}}","Masquer la couche"],["{{レイヤーをロック}}","Verrouiller le calque"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Pointeur de courbe (double-cliquez pour l'activer ou le désactiver)"],["{{インスタンス名}}","Nom de l'instance"],["{{ライブラリ内の検索}}","Recherche dans la bibliothèque"],["{{フレームラベル}}","Étiquette du cadre"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Si le projet n'est pas sauvegardé, les données du projet dans cet onglet ne peuvent pas être récupérées. Voulez-vous supprimer l'onglet ?"]])}}class i extends t{createMapping(){return new Map([["{{ロックされたレイヤーです}}","Strato bloccato"],["{{トゥイーンには複数のオブジェクトを設置できません}}","Non è possibile inserire più oggetti in un tween"],["{{名前が重複しています}}","Nome duplicato"],["{{名前は必須です}}","Il nome è obbligatorio"],["{{基準点}}","punto di riferimento"],["{{自由変形ツール}}","Strumento di trasformazione gratuito"],["{{キーフレームに変換}}","Convertire in keyframe"],["{{空のキーフレームに変換}}","Convertire in fotogrammi chiave vuoti"],["{{最初のフレームに移動}}","Vai al primo fotogramma"],["{{最後のフレームに移動}}","Vai all'ultimo fotogramma"],["{{SWFを解析中}}","SWF in analisi"],["{{JSONを生成}}","Generare JSON"],["{{ファイルを生成}}","Generare il file"],["{{N2Dファイルの読み込み}}","Caricamento dei file N2D"],["{{JSONの読み込み}}","Caricamento di JSON"],["{{データを解凍中}}","Decomprimere i dati"],["{{データを圧縮中}}","Comprimere i dati"],["{{エンコード}}","Codifica"],["{{外部ファイルの読み込み}}","Lettura di file esterni"],["{{バイナリデータを生成}}","Generazione di dati binari"],["{{データベースを起動}}","Avvio del database"],["{{データを保存中}}","Memorizzazione dei dati in corso"],["{{完了}}","Completato"],["{{ステージ左揃え}}","Allineare il palco a sinistra"],["{{ステージ中央揃え(水平方向)}}","Allineare il centro del palco (orizzontale)"],["{{ステージ右揃え}}","Allineare il palco a destra"],["{{ステージ上揃え}}","Allineare il palco in alto"],["{{ステージ中央揃え(垂直方向)}}","Allineare il centro del palco (verticale)"],["{{ステージ下揃え}}","Allineare il fondo del palco"],["{{定規}}","Righello"],["{{表示}}","Display"],["{{ショートカット}}","scorciatoia"],["{{レイヤーを複製}}","Duplicare il livello"],["{{未使用のフォルダを削除}}","Eliminare le cartelle inutilizzate"],["{{同名のアイテムが存在します}}","Esistono voci con lo stesso nome"],["{{追加ファイル}}","File aggiuntivo"],["{{既存のコンテンツ}}","Contenuto esistente"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","È possibile scegliere di sovrascrivere, rinominare e aggiungere i file, o di saltare"],["{{全て上書き}}","Sovrascrivi tutto"],["{{全てスキップ}}","Salta tutto"],["{{追加・上書き}}","Aggiungi o sovrascrivi"],["{{スキップ}}","Salta"],["{{表示確認したいフレームを指定}}","Specificare la cornice di cui si desidera controllare la visualizzazione"],["{{ファイル名を指定}}","Specificare il nome del file"],["{{ファイル名}}","nome del file"],["{{終了フレームを指定}}","Specificare la cornice finale"],["{{開始フレームを指定}}","Specificare il fotogramma iniziale"],["{{フレーム設定}}","Impostazione del telaio"],["{{書き出し設定}}","Impostazioni di esportazione"],["{{ファイル形式の選択}}","Selezionare il formato del file"],["{{ファイル形式}}","Formati dei file"],["{{サイズ設定}}","Impostazione delle dimensioni"],["{{左上}}","In alto a sinistra"],["{{中央上}}","In alto al centro"],["{{右上}}","In alto a destra"],["{{中央左}}","Centro Sinistra"],["{{中央}}","Centro"],["{{中央右}}","Centro Destra"],["{{左下}}","In basso a sinistra"],["{{中央下}}","In basso al centro"],["{{右下}}","In basso a destra"],["{{中心点のX座標}}","Coordinata X del punto centrale"],["{{中心点のY座標}}","Coordinata Y del punto centrale"],["{{MovieClipに変換}}","Convertire in MovieClip"],["{{変換}}","trasformazione"],["{{ループ回数}}","Conteggio dei cicli"],["{{カーブポインターの削除}}","Elimina il puntatore di curva"],["{{ステージ基準}}","Criteri di fase"],["{{閉じる}}","Chiudere"],["{{保存}}","Risparmiare"],["{{リセット}}","azzeramento"],["{{スクリーン}}","Schermo"],["{{ショートカット設定}}","Impostazioni delle scorciatoie"],["{{レイヤーカラー}}","colore stratificato"],["{{Next2Dを支援する}}","Supporto Next2D"],["{{サポート}}","supporto"],["{{未使用のアイテムを削除}}","Rimuovere gli articoli inutilizzati"],["{{レイヤーをペースト}}","Strato di pasta"],["{{レイヤーをコピー}}","Copiare il livello"],["{{フレームをペースト}}","Incolla la cornice"],["{{フレームをコピー}}","Cornice di copia"],["{{キーフレームを削除}}","Elimina i fotogrammi chiave"],["{{キーフレームに空のキーフレームを追加できません}}","Impossibile aggiungere keyframes vuoti ai keyframes"],["{{ズームツール}}","Strumento zoom"],["{{タイムライン幅の拡大・縮小}}","Larghezza della timeline Espandere/ridurre"],["{{ガイドレイヤー}}","strato guida"],["{{音量設定}}","Regolazione del volume"],["{{サウンドを削除}}","Rimuovere il suono"],["{{カスタムループ}}","anello personalizzato"],["{{読込のみ}}","Leggere solo"],["{{書込を許可}}","autorizzazione del post"],["{{単一行}}","Linea singola"],["{{複数行}}","Multiline"],["{{自動で折り返し}}","Avvolgimento automatico"],["{{左寄せ}}","Sinistra"],["{{中央揃え}}","Centro"],["{{右寄せ}}","Destra"],["{{放射状グラデーション}}","gradazione radiale"],["{{線形グラデーション}}","gradiente lineare"],["{{画像}}","Immagine"],["{{画像選択}}","Selezione dell'immagine"],["{{種別}}","Tipo"],["{{Shapeの色設定}}","Impostazioni del colore della forma"],["{{変形}}","deformazione"],["{{カラー効果}}","Trasformazione del colore"],["{{フィルター}}","filtro"],["{{Shapeを複製}}","Forma duplicata"],["{{読み込み}}","leggere in"],["{{新規フォルダー}}","Nuova cartella"],["{{新規MovieClip}}","Nuovo MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Ridimensiona il testo per adattarlo alla cornice"],["{{テキストに合わせて枠をリサイズ}}","Ridimensiona la cornice per adattarla al testo"],["{{リサイズしない}}","Nessun ridimensionamento"],["{{フォント}}","font"],["{{テキスト}}","Testo"],["{{ループ}}","loop"],["{{音量}}","volume"],["{{ビデオ}}","Video"],["{{イージング}}","facilitando"],["{{サウンド}}","suono"],["{{シンボル}}","Simbolo"],["{{名前}}","Nome"],["{{オブジェクト}}","oggetto"],["{{ステージ設定}}","Scenario"],["{{プレビュー}}","Anteprima"],["{{削除}}","Cancellare"],["{{ペースト}}","Incolla"],["{{コピー}}","Copia"],["{{プラグインメニュー}}","Menu del plug-in"],["{{トゥイーン}}","tween"],["{{カーブポインターの追加}}","Puntatore di curva supplementare"],["{{パスの結合}}","Fusione di percorsi"],["{{シェイプ}}","forma"],["{{キーフレームに配分}}","Assegnazione ai fotogrammi chiave"],["{{レイヤーに配分}}","Assegnazione ai livelli"],["{{タイムライン}}","Timeline"],["{{整列}}","Allineare"],["{{最背面}}","La maggior parte della schiena"],["{{ひとつ背面へ}}","Uno sul retro"],["{{ひとつ前面へ}}","Una parte anteriore"],["{{最前面}}","In prima linea"],["{{重ね順}}","Organizzare"],["{{プラグイン}}","plug-in"],["{{ライブラリ}}","biblioteca"],["{{プロパティ}}","proprietà"],["{{マスクレイヤー}}","strato di maschera"],["{{通常レイヤー}}","Strato normale"],["{{モーショントゥイーンの削除}}","Soppressione dei tweens di movimento"],["{{モーショントゥイーンの追加}}","Ulteriori tween di movimento"],["{{モーダル表示}}","indicazione modale"],["{{言語}}","Lingua"],["{{フォーマット}}","formato"],["{{含める}}","includere"],["{{含めない}}","non includere"],["{{使い方、リファレンス}}","Uso, riferimento"],["{{非表示レイヤー}}","strato nascosto"],["{{設定}}","setup"],["{{デフォルトのループを利用する}}","Utilizzare il ciclo predefinito"],["{{フレームピッカー}}","raccoglitore di cornici"],["{{左揃え}}","Sinistra"],["{{中央揃え(水平方向)}}","Centro (Orizzontalità)"],["{{右揃え}}","Destra"],["{{上揃え}}","Top"],["{{中央揃え(垂直方向)}}","Centro (Verticale)"],["{{下揃え}}","Fondo"],["{{開始フレーム}}","telaio di partenza"],["{{終了フレーム}}","telaio finale"],["{{ループで再生}}","Gioca in loop"],["{{1回再生}}","1 riproduzione"],["{{指定したフレームで固定}}","Fissato nella cornice specificata"],["{{1回逆再生}}","1 riproduzione inversa"],["{{逆ループで再生}}","Riproduzione in loop inverso"],["{{画面の拡大・縮小}}","Ingrandire e rimpicciolire lo schermo"],["{{カスタムイージングデータを保存}}","Salva i dati di easing personalizzati"],["{{カスタムイージングデータの読込}}","Lettura dei dati di easing personalizzati"],["{{プレビューのON/OFF}}","Anteprima on/off"],["{{フォント枠サイズ}}","Dimensione della cornice del carattere"],["{{フォント枠カラー}}","Colore della cornice del carattere"],["{{オニオンスキン}}","Pelle di cipolla"],["{{バケツツール}}","Strumenti a secchiello"],["{{ペンツール}}","Strumento penna"],["{{ダブルクリックでカーブポイントが追加されます}}","Doppio clic per aggiungere un punto di curva"],["{{選択ツール}}","Strumenti di selezione"],["{{Shape変形ツール}}","Strumento di trasformazione della forma"],["{{テキストツール}}","Text Tool"],["{{矩形ツール}}","Strumento di testo"],["{{楕円ツール}}","Strumento Ellisse"],["{{角丸矩形ツール}}","Strumento Rettangolo arrotondato"],["{{塗りのカラー}}","Colore di riempimento"],["{{線のカラー}}","Colore del tratto"],["{{線の太さ}}","Larghezza della corsa"],["{{プロジェクトデータの読込}}","Caricamento dei dati del progetto"],["{{プロジェクトデータを保存}}","Salvare i dati del progetto"],["{{書き出し}}","Esportazione"],["{{Discordへ移動}}","Vai su discordia"],["{{バグ報告}}","Segnalazioni di bug"],["{{設定}}","Impostazione"],["{{タブを追加}}","Aggiungere una scheda"],["{{タブの一覧を表示・移動}}","Visualizzare e spostarsi attraverso l'elenco delle schede"],["{{スクリプトを追加}}","Aggiungere uno script"],["{{キーフレームを追加}}","Aggiungere un keyframe"],["{{空のキーフレームを追加}}","Aggiungere un keyframe vuoto"],["{{フレームを追加}}","Aggiungere una cornice"],["{{フレームを削除}}","Cancellare la cornice"],["{{再生}}","Gioca"],["{{停止}}","Fermare"],["{{ループ設定}}","Impostazione del loop"],["{{レイヤーを追加}}","Aggiungere uno strato"],["{{レイヤーを削除}}","Cancellare il livello"],["{{全てのレイヤーをハイライト}}","Evidenzia tutti i livelli"],["{{全てのレイヤーを非表示}}","Nascondi tutti i livelli"],["{{全てのレイヤーをロック}}","Blocca tutti i livelli"],["{{比率を固定}}","Rapporto fisso"],["{{ステージの幅}}","Larghezza del palco"],["{{背景色}}","Colore di sfondo"],["{{ステージの高さ}}","Altezza del palco"],["{{フレームレート}}","Frame Rate"],["{{シンボル名}}","Nome del simbolo"],["{{イージング設定}}","Impostazione di rilassamento"],["{{ビデオの音量設定}}","Impostazione del volume video"],["{{自動再生}}","Riproduzione automatica"],["{{テキストエリアのボーダー設定}}","Impostazione del bordo dell'area di testo"],["{{テキスト入力設定}}","Impostazione dell'inserimento del testo"],["{{フォント選択}}","Seleziona il carattere"],["{{自動サイズ調整}}","Regolazione automatica delle dimensioni"],["{{フォントスタイルタイプ}}","Tipo di stile di carattere"],["{{行揃え}}","Allineare"],["{{改行設定}}","Impostazione Newline"],["{{スクロール設定}}","Impostazione dello scorrimento"],["{{フォントサイズ}}","Dimensione del carattere"],["{{フォントカラー}}","Colore del carattere"],["{{行間}}","Spazio di linea"],["{{文字幅}}","Larghezza del carattere"],["{{左マージン}}","Margine sinistro"],["{{右マージン}}","Margine destro"],["{{カラー種別の選択}}","Seleziona un tipo di colore"],["{{背景画像の選択}}","Selezionare un'immagine di sfondo"],["{{カラーポインターを追加}}","Aggiungere i puntatori di colore"],["{{カラー値}}","Colore"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Larghezza dell'oggetto di selezione"],["{{選択対象のX座標}}","Coordinata X dell'oggetto di selezione"],["{{選択対象の高さ}}","Altezza dell'oggetto di selezione"],["{{選択対象のY座標}}","Coordinata Y dell'oggetto di selezione"],["{{選択対象の幅の伸縮}}","scaleX dell'oggetto selezionato"],["{{選択対象を回転}}","Ruotare l'oggetto"],["{{選択対象の高さの伸縮}}","scalaY dell'oggetto selezionato"],["{{アルファオフセット(-255〜255)}}","Offset alfa(-255〜255)"],["{{赤(0%-100%)}}","Rosso(0%-100%)"],["{{赤オフセット(-255〜255)}}","Offset rosso(-255〜255)"],["{{緑(0%-100%)}}","Verde(0%-100%)"],["{{緑オフセット(-255〜255)}}","Offset Verde(-255〜255)"],["{{青(0%-100%)}}","Blu(0%-100%)"],["{{青オフセット(-255〜255)}}","Offset Blu(-255〜255)"],["{{ブレンドモード}}","Modalità di fusione"],["{{フィルターを選択}}","Seleziona un filtro"],["{{フィルターを追加}}","Aggiungere un filtro"],["{{サウンドを追加}}","Aggiungere un suono"],["{{フィルターを表示・非表示する}}","Mostrare e nascondere i filtri"],["{{フィルターを削除}}","Cancellare il filtro"],["{{水平方向にぼかす}}","Sfocatura orizzontale"],["{{垂直方向にぼかす}}","Sfocatura verticale"],["{{フィルター強度}}","Forza del filtro"],["{{フィルター角度}}","Angolo del filtro"],["{{シャドウのアルファ}}","Ombra alfa"],["{{シャドウのカラー}}","Colore dell'ombra"],["{{フィルター距離}}","Distanza del filtro"],["{{ハイライトのカラー}}","Colore in evidenza"],["{{ハイライトのアルファ}}","Evidenziare l'alfa"],["{{グラデーションカラー}}","Colore sfumato"],["{{グラデーションのアルファ}}","Gradiente alfa"],["{{タブの移動・名前を変更}}","Spostare/rinominare le schede"],["{{プロジェクトを閉じる}}","Chiudere il progetto"],["{{上下に移動}}","Sposta su e giù"],["{{レイヤー変更(ダブルクリック)}}","Cambio di livello (doppio clic)"],["{{レイヤーをハイライト}}","Strato di evidenziazione"],["{{レイヤーを非表示}}","Nascondere lo strato"],["{{レイヤーをロック}}","Bloccare il livello"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Curve Pointer (doppio clic per attivare/disattivare)"],["{{インスタンス名}}","Nome dell'istanza"],["{{ライブラリ内の検索}}","Cerca nella biblioteca"],["{{フレームラベル}}","Etichetta del telaio"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Se il progetto non viene salvato, i dati del progetto in questa scheda non possono essere recuperati. Vuoi cancellare la scheda?"]])}}class n extends t{createMapping(){return new Map([["{{ロックされたレイヤーです}}","ロックされたレイヤーです"],["{{トゥイーンには複数のオブジェクトを設置できません}}","トゥイーンには複数のオブジェクトを設置できません"],["{{名前が重複しています}}","名前が重複しています"],["{{名前は必須です}}","名前は必須です"],["{{基準点}}","基準点"],["{{自由変形ツール}}","自由変形ツール"],["{{キーフレームに変換}}","キーフレームに変換"],["{{空のキーフレームに変換}}","空のキーフレームに変換"],["{{最初のフレームに移動}}","最初のフレームに移動"],["{{最後のフレームに移動}}","最後のフレームに移動"],["{{SWFを解析中}}","SWFを解析中"],["{{JSONを生成}}","JSONを生成"],["{{ファイルを生成}}","ファイルを生成"],["{{N2Dファイルの読み込み}}","N2Dファイルの読み込み"],["{{JSONの読み込み}}","JSONの読み込み"],["{{データを解凍中}}","データを解凍中"],["{{データを圧縮中}}","データを圧縮中"],["{{エンコード}}","エンコード"],["{{外部ファイルの読み込み}}","外部ファイルの読み込み"],["{{バイナリデータを生成}}","バイナリデータを生成"],["{{データベースを起動}}","データベースを起動"],["{{データを保存中}}","データを保存中"],["{{完了}}","完了"],["{{ステージ左揃え}}","ステージ左揃え"],["{{ステージ中央揃え(水平方向)}}","ステージ中央揃え(水平方向)"],["{{ステージ右揃え}}","ステージ右揃え"],["{{ステージ上揃え}}","ステージ上揃え"],["{{ステージ中央揃え(垂直方向)}}","ステージ中央揃え(垂直方向)"],["{{ステージ下揃え}}","ステージ下揃え"],["{{定規}}","定規"],["{{表示}}","表示"],["{{ショートカット}}","ショートカット"],["{{レイヤーを複製}}","レイヤーを複製"],["{{未使用のフォルダを削除}}","未使用のフォルダを削除"],["{{同名のアイテムが存在します}}","同名のアイテムが存在します"],["{{追加ファイル}}","追加ファイル"],["{{既存のコンテンツ}}","既存のコンテンツ"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます"],["{{全て上書き}}","全て上書き"],["{{全てスキップ}}","全てスキップ"],["{{追加・上書き}}","追加・上書き"],["{{スキップ}}","スキップ"],["{{表示確認したいフレームを指定}}","表示確認したいフレームを指定"],["{{ファイル名を指定}}","ファイル名を指定"],["{{ファイル名}}","ファイル名"],["{{終了フレームを指定}}","終了フレームを指定"],["{{開始フレームを指定}}","開始フレームを指定"],["{{フレーム設定}}","フレーム設定"],["{{書き出し設定}}","書き出し設定"],["{{ファイル形式の選択}}","ファイル形式の選択"],["{{ファイル形式}}","ファイル形式"],["{{サイズ設定}}","サイズ設定"],["{{左上}}","左上"],["{{中央上}}","中央上"],["{{右上}}","右上"],["{{中央左}}","中央左"],["{{中央}}","中央"],["{{中央右}}","中央右"],["{{左下}}","左下"],["{{中央下}}","中央下"],["{{右下}}","右下"],["{{中心点のX座標}}","中心点のX座標"],["{{中心点のY座標}}","中心点のY座標"],["{{MovieClipに変換}}","MovieClipに変換"],["{{変換}}","変換"],["{{ループ回数}}","ループ回数"],["{{カーブポインターの削除}}","カーブポインターの削除"],["{{ステージ基準}}","ステージ基準"],["{{閉じる}}","閉じる"],["{{保存}}","保存"],["{{リセット}}","リセット"],["{{スクリーン}}","スクリーン"],["{{ショートカット設定}}","ショートカット設定"],["{{レイヤーカラー}}","レイヤーカラー"],["{{Next2Dを支援する}}","Next2Dを支援する"],["{{サポート}}","サポート"],["{{未使用のアイテムを削除}}","未使用のアイテムを削除"],["{{レイヤーをペースト}}","レイヤーをペースト"],["{{レイヤーをコピー}}","レイヤーをコピー"],["{{フレームをペースト}}","フレームをペースト"],["{{フレームをコピー}}","フレームをコピー"],["{{キーフレームを削除}}","キーフレームを削除"],["{{キーフレームに空のキーフレームを追加できません}}","キーフレームに空のキーフレームを追加できません"],["{{ズームツール}}","ズームツール"],["{{タイムライン幅の拡大・縮小}}","タイムライン幅の拡大・縮小"],["{{ガイドレイヤー}}","ガイドレイヤー"],["{{音量設定}}","音量設定"],["{{サウンドを削除}}","サウンドを削除"],["{{カスタムループ}}","カスタムループ"],["{{読込のみ}}","読込のみ"],["{{書込を許可}}","書込を許可"],["{{単一行}}","単一行"],["{{複数行}}","複数行"],["{{自動で折り返し}}","自動で折り返し"],["{{左寄せ}}","左寄せ"],["{{中央揃え}}","中央揃え"],["{{右寄せ}}","右寄せ"],["{{放射状グラデーション}}","放射状グラデーション"],["{{線形グラデーション}}","線形グラデーション"],["{{画像}}","画像"],["{{画像選択}}","画像選択"],["{{種別}}","種別"],["{{Shapeの色設定}}","Shapeの色設定"],["{{変形}}","変形"],["{{カラー効果}}","カラー効果"],["{{フィルター}}","フィルター"],["{{Shapeを複製}}","Shapeを複製"],["{{読み込み}}","読み込み"],["{{新規フォルダー}}","新規フォルダー"],["{{新規MovieClip}}","新規MovieClip"],["{{枠に合わせてテキストをリサイズ}}","枠に合わせてテキストをリサイズ"],["{{テキストに合わせて枠をリサイズ}}","テキストに合わせて枠をリサイズ"],["{{リサイズしない}}","リサイズしない"],["{{フォント}}","フォント"],["{{テキスト}}","テキスト"],["{{ループ}}","ループ"],["{{音量}}","音量"],["{{ビデオ}}","ビデオ"],["{{イージング}}","イージング"],["{{サウンド}}","サウンド"],["{{シンボル}}","シンボル"],["{{名前}}","名前"],["{{オブジェクト}}","オブジェクト"],["{{ステージ設定}}","ステージ設定"],["{{プレビュー}}","プレビュー"],["{{削除}}","削除"],["{{ペースト}}","ペースト"],["{{コピー}}","コピー"],["{{プラグインメニュー}}","プラグインメニュー"],["{{トゥイーン}}","トゥイーン"],["{{カーブポインターの追加}}","カーブポインターの追加"],["{{パスの結合}}","パスの結合"],["{{シェイプ}}","シェイプ"],["{{キーフレームに配分}}","キーフレームに配分"],["{{レイヤーに配分}}","レイヤーに配分"],["{{タイムライン}}","タイムライン"],["{{整列}}","整列"],["{{最背面}}","最背面"],["{{ひとつ背面へ}}","ひとつ背面へ"],["{{ひとつ前面へ}}","ひとつ前面へ"],["{{最前面}}","最前面"],["{{重ね順}}","重ね順"],["{{プラグイン}}","プラグイン"],["{{ライブラリ}}","ライブラリ"],["{{プロパティ}}","プロパティ"],["{{マスクレイヤー}}","マスクレイヤー"],["{{通常レイヤー}}","通常レイヤー"],["{{モーショントゥイーンの削除}}","モーショントゥイーンの削除"],["{{モーショントゥイーンの追加}}","モーショントゥイーンの追加"],["{{モーダル表示}}","モーダル表示"],["{{言語}}","言語"],["{{フォーマット}}","フォーマット"],["{{含める}}","含める"],["{{含めない}}","含めない"],["{{使い方、リファレンス}}","使い方、リファレンス"],["{{非表示レイヤー}}","非表示レイヤー"],["{{設定}}","設定"],["{{デフォルトのループを利用する}}","デフォルトのループを利用する"],["{{フレームピッカー}}","フレームピッカー"],["{{左揃え}}","左揃え"],["{{中央揃え(水平方向)}}","中央揃え(水平方向)"],["{{右揃え}}","右揃え"],["{{上揃え}}","上揃え"],["{{中央揃え(垂直方向)}}","中央揃え(垂直方向)"],["{{下揃え}}","下揃え"],["{{開始フレーム}}","開始フレーム"],["{{終了フレーム}}","終了フレーム"],["{{ループで再生}}","ループで再生"],["{{1回再生}}","1回再生"],["{{指定したフレームで固定}}","指定したフレームで固定"],["{{1回逆再生}}","1回逆再生"],["{{逆ループで再生}}","逆ループで再生"],["{{画面の拡大・縮小}}","画面の拡大・縮小"],["{{カスタムイージングデータを保存}}","カスタムイージングデータを保存"],["{{カスタムイージングデータの読込}}","カスタムイージングデータの読込"],["{{プレビューのON/OFF}}","プレビューのON/OFF"],["{{フォント枠サイズ}}","フォント枠サイズ"],["{{フォント枠カラー}}","フォント枠カラー"],["{{オニオンスキン}}","オニオンスキン"],["{{バケツツール}}","バケツツール"],["{{ペンツール}}","ペンツール"],["{{ダブルクリックでカーブポイントが追加されます}}","ダブルクリックでカーブポイントが追加されます"],["{{選択ツール}}","選択ツール"],["{{Shape変形ツール}}","Shape変形ツール"],["{{テキストツール}}","テキストツール"],["{{矩形ツール}}","矩形ツール"],["{{楕円ツール}}","楕円ツール"],["{{角丸矩形ツール}}","角丸矩形ツール"],["{{塗りのカラー}}","塗りのカラー"],["{{線のカラー}}","線のカラー"],["{{線の太さ}}","線の太さ"],["{{プロジェクトデータの読込}}","プロジェクトデータの読込"],["{{プロジェクトデータを保存}}","プロジェクトデータを保存"],["{{書き出し}}","書き出し"],["{{Discordへ移動}}","Discordへ移動"],["{{バグ報告}}","バグ報告"],["{{設定}}","設定"],["{{タブを追加}}","タブを追加"],["{{タブの一覧を表示・移動}}","タブの一覧を表示・移動"],["{{スクリプトを追加}}","スクリプトを追加"],["{{キーフレームを追加}}","キーフレームを追加"],["{{空のキーフレームを追加}}","空のキーフレームを追加"],["{{フレームを追加}}","フレームを追加"],["{{フレームを削除}}","フレームを削除"],["{{再生}}","再生"],["{{停止}}","停止"],["{{ループ設定}}","ループ設定"],["{{レイヤーを追加}}","レイヤーを追加"],["{{レイヤーを削除}}","レイヤーを削除"],["{{全てのレイヤーをハイライト}}","全てのレイヤーをハイライト"],["{{全てのレイヤーを非表示}}","全てのレイヤーを非表示"],["{{全てのレイヤーをロック}}","全てのレイヤーをロック"],["{{比率を固定}}","比率を固定"],["{{ステージの幅}}","ステージの幅"],["{{背景色}}","背景色"],["{{ステージの高さ}}","ステージの高さ"],["{{フレームレート}}","フレームレート"],["{{シンボル名}}","シンボル名"],["{{イージング設定}}","イージング設定"],["{{ビデオの音量設定}}","ビデオの音量設定"],["{{自動再生}}","自動再生"],["{{テキストエリアのボーダー設定}}","テキストエリアのボーダー設定"],["{{テキスト入力設定}}","テキスト入力設定"],["{{フォント選択}}","フォント選択"],["{{自動サイズ調整}}","自動サイズ調整"],["{{フォントスタイルタイプ}}","フォントスタイルタイプ"],["{{行揃え}}","行揃え"],["{{改行設定}}","改行設定"],["{{スクロール設定}}","スクロール設定"],["{{フォントサイズ}}","フォントサイズ"],["{{フォントカラー}}","フォントカラー"],["{{行間}}","行間"],["{{文字幅}}","文字幅"],["{{左マージン}}","左マージン"],["{{右マージン}}","右マージン"],["{{カラー種別の選択}}","カラー種別の選択"],["{{背景画像の選択}}","背景画像の選択"],["{{カラーポインターを追加}}","カラーポインターを追加"],["{{カラー値}}","カラー値"],["{{アルファ(0%-100%)}}","アルファ(0%-100%)"],["{{アルファ値}}","アルファ値"],["{{選択対象の幅}}","選択対象の幅"],["{{選択対象のX座標}}","選択対象のX座標"],["{{選択対象の高さ}}","選択対象の高さ"],["{{選択対象のY座標}}","選択対象のY座標"],["{{選択対象の幅の伸縮}}","選択対象の幅の伸縮"],["{{選択対象を回転}}","選択対象を回転"],["{{選択対象の高さの伸縮}}","選択対象の高さの伸縮"],["{{アルファオフセット(-255〜255)}}","アルファオフセット(-255〜255)"],["{{赤(0%-100%)}}","赤(0%-100%)"],["{{赤オフセット(-255〜255)}}","赤オフセット(-255〜255)"],["{{緑(0%-100%)}}","緑(0%-100%)"],["{{緑オフセット(-255〜255)}}","緑オフセット(-255〜255)"],["{{青(0%-100%)}}","青(0%-100%)"],["{{青オフセット(-255〜255)}}","青オフセット(-255〜255)"],["{{ブレンドモード}}","ブレンドモード"],["{{フィルターを選択}}","フィルターを選択"],["{{フィルターを追加}}","フィルターを追加"],["{{サウンドを追加}}","サウンドを追加"],["{{フィルターを表示・非表示する}}","フィルターを表示・非表示する"],["{{フィルターを削除}}","フィルターを削除"],["{{水平方向にぼかす}}","水平方向にぼかす"],["{{垂直方向にぼかす}}","垂直方向にぼかす"],["{{フィルター強度}}","フィルター強度"],["{{フィルター角度}}","フィルター角度"],["{{シャドウのアルファ}}","シャドウのアルファ"],["{{シャドウのカラー}}","シャドウのカラー"],["{{フィルター距離}}","フィルター距離"],["{{ハイライトのカラー}}","ハイライトのカラー"],["{{ハイライトのアルファ}}","ハイライトのアルファ"],["{{グラデーションカラー}}","グラデーションカラー"],["{{グラデーションのアルファ}}","グラデーションのアルファ"],["{{タブの移動・名前を変更}}","タブの移動・名前を変更"],["{{プロジェクトを閉じる}}","プロジェクトを閉じる"],["{{上下に移動}}","上下に移動"],["{{レイヤー変更(ダブルクリック)}}","レイヤー変更(ダブルクリック)"],["{{レイヤーをハイライト}}","レイヤーをハイライト"],["{{レイヤーを非表示}}","レイヤーを非表示"],["{{レイヤーをロック}}","レイヤーをロック"],["{{カーブポインター(ダブルクリックでON/OFF)}}","カーブポインター(ダブルクリックでON/OFF)"],["{{インスタンス名}}","インスタンス名"],["{{ライブラリ内の検索}}","ライブラリ内の検索"],["{{フレームラベル}}","フレームラベル"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？"]])}}class o extends t{createMapping(){return new Map([["{{ロックされたレイヤーです}}","잠긴 레이어입니다"],["{{トゥイーンには複数のオブジェクトを設置できません}}","트윈에는 여러 오브젝트를 설치할 수 없습니다"],["{{名前が重複しています}}","이름이 중복됨"],["{{名前は必須です}}","이름은 필수"],["{{基準点}}","기준점"],["{{自由変形ツール}}","자유 변형 도구"],["{{キーフレームに変換}}","키프레임으로 변환"],["{{空のキーフレームに変換}}","빈 키프레임으로 변환"],["{{最初のフレームに移動}}","첫 번째 프레임으로 이동"],["{{最後のフレームに移動}}","마지막 프레임으로 이동"],["{{SWFを解析中}}","SWF 분석 중"],["{{JSONを生成}}","JSON 생성"],["{{ファイルを生成}}","파일 생성"],["{{N2Dファイルの読み込み}}","N2D 파일 불러오기"],["{{JSONの読み込み}}","JSON 로드"],["{{データを解凍中}}","데이터 압축 해제 중"],["{{データを圧縮中}}","데이터 압축 중"],["{{エンコード}}","인코딩"],["{{外部ファイルの読み込み}}","외부 파일 로드"],["{{バイナリデータを生成}}","바이너리 데이터 생성"],["{{データベースを起動}}","데이터베이스 시작"],["{{データを保存中}}","데이터 저장 중"],["{{完了}}","완료"],["{{ステージ左揃え}}","스테이지 왼쪽 정렬"],["{{ステージ中央揃え(水平方向)}}","스테이지 중앙 정렬(수평 방향)"],["{{ステージ右揃え}}","스테이지 오른쪽 정렬"],["{{ステージ上揃え}}","무대에서 정렬"],["{{ステージ中央揃え(垂直方向)}}","스테이지 중앙 정렬(수직 방향)"],["{{ステージ下揃え}}","무대 아래 정렬"],["{{定規}}","눈금자"],["{{表示}}","표시"],["{{ショートカット}}","단축키"],["{{レイヤーを複製}}","중복 레이어"],["{{未使用のフォルダを削除}}","사용하지 않는 폴더 삭제"],["{{同名のアイテムが存在します}}","같은 이름의 항목이 존재합니다"],["{{追加ファイル}}","추가 파일"],["{{既存のコンテンツ}}","기존 콘텐츠"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","파일을 덮어쓰거나 이름을 변경하고 추가하거나 건너뛰도록 선택할 수 있습니다"],["{{全て上書き}}","모두 덮어쓰기"],["{{全てスキップ}}","모두 건너뛰기"],["{{追加・上書き}}","추가 또는 덮어쓰기"],["{{スキップ}}","건너뛰다"],["{{表示確認したいフレームを指定}}","표시 확인할 프레임 지정"],["{{ファイル名を指定}}","파일 이름 지정"],["{{ファイル名}}","파일 이름"],["{{終了フレームを指定}}","끝 프레임 지정"],["{{開始フレームを指定}}","시작 프레임 지정"],["{{フレーム設定}}","프레임 설정"],["{{書き出し設定}}","내보내기 설정"],["{{ファイル形式の選択}}","파일 형식 선택"],["{{ファイル形式}}","파일 형식"],["{{サイズ設定}}","사이즈 설정"],["{{左上}}","왼쪽 상단"],["{{中央上}}","상단 중앙"],["{{右上}}","오른쪽 상단"],["{{中央左}}","중앙 왼쪽"],["{{中央}}","센터"],["{{中央右}}","중앙 오른쪽"],["{{左下}}","왼쪽 하단"],["{{中央下}}","하단 중앙"],["{{右下}}","오른쪽 하단"],["{{中心点のX座標}}","중심점의 X 좌표"],["{{中心点のY座標}}","중심점의 Y 좌표"],["{{MovieClipに変換}}","MovieClip로 변환"],["{{変換}}","변환"],["{{ループ回数}}","루프 횟수"],["{{カーブポインターの削除}}","곡선 테이블의"],["{{ステージ基準}}","스테이지 기준"],["{{閉じる}}","닫다"],["{{保存}}","저장"],["{{リセット}}","리셋"],["{{スクリーン}}","스크린"],["{{ショートカット設定}}","바로 가기 설정"],["{{レイヤーカラー}}","레이어 색상"],["{{Next2Dを支援する}}","Next2D 지원"],["{{サポート}}","지원"],["{{未使用のアイテムを削除}}","사용하지 않는 항목 삭제"],["{{レイヤーをペースト}}","레이어 붙여넣기"],["{{レイヤーをコピー}}","레이어 복사"],["{{フレームをペースト}}","프레임을 붙여넣기"],["{{フレームをコピー}}","프레임 복사"],["{{キーフレームを削除}}","키프레임 삭제"],["{{キーフレームに空のキーフレームを追加できません}}","키프레임에 빈 키프레임을 추가할 수 없음"],["{{ズームツール}}","줌 도구"],["{{タイムライン幅の拡大・縮小}}","타임라인 폭 확대·축소"],["{{ガイドレイヤー}}","가이드레이야"],["{{音量設定}}","볼륨 설정"],["{{サウンドを削除}}","사운드 삭제"],["{{カスタムループ}}","맞춤형 루프"],["{{読込のみ}}","로드 전용"],["{{書込を許可}}","쓰기 허용"],["{{単一行}}","단일 행"],["{{複数行}}","여러 줄"],["{{自動で折り返し}}","자동으로 되감기"],["{{左寄せ}}","왼쪽"],["{{中央揃え}}","센터"],["{{右寄せ}}","권리"],["{{放射状グラデーション}}","방사형 그라데이션"],["{{線形グラデーション}}","선형 그라데이션"],["{{画像}}","이미지"],["{{画像選択}}","이미지 선택"],["{{種別}}","종별"],["{{Shapeの色設定}}","Shape 색상 설정"],["{{変形}}","변형"],["{{カラー効果}}","색상 변환"],["{{フィルター}}","필터"],["{{Shapeを複製}}","Shape 복제"],["{{読み込み}}","로딩"],["{{新規フォルダー}}","새 폴더"],["{{新規MovieClip}}","새로운 MovieClip"],["{{枠に合わせてテキストをリサイズ}}","프레임에 맞게 텍스트를 크기 조정"],["{{テキストに合わせて枠をリサイズ}}","텍스트에 맞게 프레임을 크기 조정"],["{{リサイズしない}}","크기 조정하지 않음"],["{{フォント}}","글꼴"],["{{テキスト}}","텍스트"],["{{ループ}}","루프"],["{{音量}}","볼륨"],["{{ビデオ}}","동영상"],["{{イージング}}","부드럽게"],["{{サウンド}}","소리"],["{{シンボル}}","상징"],["{{名前}}","이름"],["{{オブジェクト}}","개체"],["{{ステージ設定}}","스테이지 설정"],["{{プレビュー}}","미리보기"],["{{削除}}","삭제"],["{{ペースト}}","붙여넣기"],["{{コピー}}","복사"],["{{プラグインメニュー}}","플러그인 메뉴"],["{{トゥイーン}}","트윈"],["{{カーブポインターの追加}}","커브 포인터 추가"],["{{パスの結合}}","경로 결합"],["{{シェイプ}}","모양"],["{{キーフレームに配分}}","키프레임에 할당"],["{{レイヤーに配分}}","레이어에 배포"],["{{タイムライン}}","타임라인"],["{{整列}}","맞추다"],["{{最背面}}","최후면"],["{{ひとつ背面へ}}","하나의 뒷면으로"],["{{ひとつ前面へ}}","하나 앞으로"],["{{最前面}}","최전면"],["{{重ね順}}","겹침 순서"],["{{プラグイン}}","플러그인"],["{{ライブラリ}}","도서관"],["{{プロパティ}}","속성"],["{{マスクレイヤー}}","마스크 레이어"],["{{通常レイヤー}}","일반 레이어"],["{{モーショントゥイーンの削除}}","모션 트윈 삭제"],["{{モーショントゥイーンの追加}}","모션 트윈 추가"],["{{モーダル表示}}","모달 표시"],["{{言語}}","언어"],["{{フォーマット}}","형식"],["{{含める}}","포함"],["{{含めない}}","포함하지 않음"],["{{使い方、リファレンス}}","사용법, 참조"],["{{非表示レイヤー}}","숨겨진 레이어"],["{{設定}}","설정"],["{{デフォルトのループを利用する}}","기본 루프 사용"],["{{フレームピッカー}}","프레임 선택기"],["{{左揃え}}","왼쪽 정렬"],["{{中央揃え(水平方向)}}","중앙 정렬(수평 방향)"],["{{右揃え}}","오른쪽 정렬"],["{{上揃え}}","상단 정렬"],["{{中央揃え(垂直方向)}}","중앙 정렬(수직 방향)"],["{{下揃え}}","아래 정렬"],["{{開始フレーム}}","시작 프레임"],["{{終了フレーム}}","종료 프레임"],["{{ループで再生}}","루프로 재생"],["{{1回再生}}","한 번 재생"],["{{指定したフレームで固定}}","지정된 프레임으로 고정"],["{{1回逆再生}}","1회 역재생"],["{{逆ループで再生}}","역 루프로 재생"],["{{画面の拡大・縮小}}","화면 확대/축소"],["{{カスタムイージングデータを保存}}","맞춤형 여유 데이터 저장"],["{{カスタムイージングデータの読込}}","사용자 정의 여유 데이터 읽기"],["{{プレビューのON/OFF}}","프레뷰의 ON/OFF"],["{{フォント枠サイズ}}","글꼴 프레임 크기"],["{{フォント枠カラー}}","글꼴 프레임 색상"],["{{オニオンスキン}}","양파 껍질"],["{{バケツツール}}","버킷 도구"],["{{ペンツール}}","펜 도구"],["{{ダブルクリックでカーブポイントが追加されます}}","곡선 점을 추가하려면 두 번 클릭"],["{{選択ツール}}","선택 도구"],["{{Shape変形ツール}}","모양 변형 도구"],["{{テキストツール}}","텍스트 도구"],["{{矩形ツール}}","너무 직사각형"],["{{楕円ツール}}","타원 도구"],["{{角丸矩形ツール}}","둥근 사각형 도구"],["{{塗りのカラー}}","채우기 색상"],["{{線のカラー}}","획 색상"],["{{線の太さ}}","획 폭"],["{{プロジェクトデータの読込}}","프로젝트 데이터 로드"],["{{プロジェクトデータを保存}}","프로젝트 데이터 저장"],["{{書き出し}}","내 보내다"],["{{Discordへ移動}}","불화로 이동"],["{{バグ報告}}","버그 보고서"],["{{設定}}","환경"],["{{タブを追加}}","탭 추가"],["{{タブの一覧を表示・移動}}","탭 목록 보기 및 이동"],["{{スクリプトを追加}}","스크립트 추가"],["{{キーフレームを追加}}","키프레임 추가"],["{{空のキーフレームを追加}}","빈 키프레임 추가"],["{{フレームを追加}}","프레임 추가"],["{{フレームを削除}}","프레임 삭제"],["{{再生}}","놀다"],["{{停止}}","중지"],["{{ループ設定}}","루프 설정"],["{{レイヤーを追加}}","레이어 추가"],["{{レイヤーを削除}}","레이어 삭제"],["{{全てのレイヤーをハイライト}}","모든 레이어 강조 표시"],["{{全てのレイヤーを非表示}}","모든 레이어 숨기기"],["{{全てのレイヤーをロック}}","모든 레이어 잠금"],["{{比率を固定}}","고정 비율"],["{{ステージの幅}}","무대 폭"],["{{背景色}}","배경색"],["{{ステージの高さ}}","무대 높이"],["{{フレームレート}}","프레임 속도"],["{{シンボル名}}","기호 이름"],["{{イージング設定}}","이징 설정"],["{{ビデオの音量設定}}","비디오 볼륨 설정"],["{{自動再生}}","자동 재생"],["{{テキストエリアのボーダー設定}}","텍스트 영역 테두리 설정"],["{{テキスト入力設定}}","텍스트 입력 설정"],["{{フォント選択}}","글꼴 선택"],["{{自動サイズ調整}}","자동 크기 조정"],["{{フォントスタイルタイプ}}","글꼴 스타일 유형"],["{{行揃え}}","맞추다"],["{{改行設定}}","개행 설정"],["{{スクロール設定}}","스크롤 설정"],["{{フォントサイズ}}","글꼴 크기"],["{{フォントカラー}}","글꼴 색상"],["{{行間}}","줄 간격"],["{{文字幅}}","문자 너비"],["{{左マージン}}","왼쪽 여백"],["{{右マージン}}","오른쪽 여백"],["{{カラー種別の選択}}","색상 유형 선택"],["{{背景画像の選択}}","배경 이미지 선택"],["{{カラーポインターを追加}}","색상 포인터 추가"],["{{カラー値}}","색상"],["{{アルファ(0%-100%)}}","알파(0%-100%)"],["{{アルファ値}}","알파"],["{{選択対象の幅}}","선택 개체의 너비"],["{{選択対象のX座標}}","선택 객체의 X 좌표"],["{{選択対象の高さ}}","선택 개체의 높이"],["{{選択対象のY座標}}","선택 객체의 Y 좌표"],["{{選択対象の幅の伸縮}}","선택한 객체의 scaleX"],["{{選択対象を回転}}","개체 회전"],["{{選択対象の高さの伸縮}}","선택한 객체의 scaleY"],["{{アルファオフセット(-255〜255)}}","알파 오프셋(-255〜255)"],["{{赤(0%-100%)}}","빨간색(0%-100%)"],["{{赤オフセット(-255〜255)}}","레드 오프셋(-255〜255)"],["{{緑(0%-100%)}}","녹색(0%-100%)"],["{{緑オフセット(-255〜255)}}","그린 오프셋(-255〜255)"],["{{青(0%-100%)}}","파란색(0%-100%)"],["{{青オフセット(-255〜255)}}","블루 오프셋(-255〜255)"],["{{ブレンドモード}}","혼합 모드"],["{{フィルターを選択}}","필터 선택"],["{{フィルターを追加}}","필터 추가"],["{{サウンドを追加}}","소리 추가"],["{{フィルターを表示・非表示する}}","필터 표시 및 숨기기"],["{{フィルターを削除}}","필터 삭제"],["{{水平方向にぼかす}}","수평으로 흐림"],["{{垂直方向にぼかす}}","수직으로 흐림"],["{{フィルター強度}}","필터 강도"],["{{フィルター角度}}","필터 각도"],["{{シャドウのアルファ}}","섀도우 알파"],["{{シャドウのカラー}}","그림자 색상"],["{{フィルター距離}}","필터 거리"],["{{ハイライトのカラー}}","하이라이트 색상"],["{{ハイライトのアルファ}}","하이라이트 알파"],["{{グラデーションカラー}}","그라데이션 색상"],["{{グラデーションのアルファ}}","그라디언트 알파"],["{{タブの移動・名前を変更}}","탭 이동/이름 바꾸기"],["{{プロジェクトを閉じる}}","프로젝트 닫기"],["{{上下に移動}}","위아래로 이동"],["{{レイヤー変更(ダブルクリック)}}","레이어 변경(더블 클릭)"],["{{レイヤーをハイライト}}","하이라이트 레이어"],["{{レイヤーを非表示}}","레이어 숨기기"],["{{レイヤーをロック}}","레이어 잠금"],["{{カーブポインター(ダブルクリックでON/OFF)}}","곡선 포인터(켜기/끄려면 두 번 클릭)"],["{{インスタンス名}}","인스턴스 이름"],["{{ライブラリ内の検索}}","도서관에서 검색"],["{{フレームラベル}}","프레임 라벨"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","프로젝트를 저장하지 않으면 이 탭의 프로젝트 데이터를 복구할 수 없습니다. 탭을 삭제하시겠습니까?"]])}}class l extends t{createMapping(){return new Map([["{{ロックされたレイヤーです}}","Заблокированный слой"],["{{トゥイーンには複数のオブジェクトを設置できません}}","Несколько объектов не могут быть помещены в твин"],["{{名前が重複しています}}","Дублирующее имя"],["{{名前は必須です}}","Имя обязательно"],["{{基準点}}","точка отсчёта"],["{{自由変形ツール}}","Бесплатный инструмент трансформации"],["{{キーフレームに変換}}","Преобразование в ключевые кадры"],["{{空のキーフレームに変換}}","Преобразование в пустые ключевые кадры"],["{{最初のフレームに移動}}","Переход к первому кадру"],["{{最後のフレームに移動}}","Переход к последнему кадру"],["{{SWFを解析中}}","Анализируемые SWF"],["{{JSONを生成}}","Сгенерировать JSON"],["{{ファイルを生成}}","Создать файл"],["{{N2Dファイルの読み込み}}","Загрузка файлов N2D"],["{{JSONの読み込み}}","Загрузка JSON"],["{{データを解凍中}}","Декомпрессия данных"],["{{データを圧縮中}}","Сжатие данных"],["{{エンコード}}","Кодирование"],["{{外部ファイルの読み込み}}","Чтение внешних файлов"],["{{バイナリデータを生成}}","Генерация двоичных данных"],["{{データベースを起動}}","Запуск базы данных"],["{{データを保存中}}","Хранение данных в процессе работы"],["{{完了}}","Завершено"],["{{ステージ左揃え}}","Выровнять сцену слева"],["{{ステージ中央揃え(水平方向)}}","Выровняйте центр сцены (горизонтально)"],["{{ステージ右揃え}}","Выровнять сцену вправо"],["{{ステージ上揃え}}","Выровнять сцену вверх"],["{{ステージ中央揃え(垂直方向)}}","Выровняйте центр сцены (вертикально)"],["{{ステージ下揃え}}","Выровнять дно сцены"],["{{定規}}","Линейка"],["{{表示}}","Дисплей"],["{{ショートカット}}","ярлык"],["{{レイヤーを複製}}","Дублирование слоя"],["{{未使用のフォルダを削除}}","Удалите неиспользуемые папки"],["{{同名のアイテムが存在します}}","Существуют предметы с таким же названием"],["{{追加ファイル}}","Дополнительный файл"],["{{既存のコンテンツ}}","Существующее содержание"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","Вы можете выбрать перезапись, переименование и добавление файлов или пропуск"],["{{全て上書き}}","Переписать все"],["{{全てスキップ}}","Пропустить все"],["{{追加・上書き}}","Добавить или перезаписать"],["{{スキップ}}","Пропустить"],["{{表示確認したいフレームを指定}}","Укажите кадр, отображение которого вы хотите проверить"],["{{ファイル名を指定}}","Укажите имя файла"],["{{ファイル名}}","имя файла"],["{{終了フレームを指定}}","Укажите конечную рамку"],["{{開始フレームを指定}}","Укажите начальный кадр"],["{{フレーム設定}}","Установка рамы"],["{{書き出し設定}}","Настройки экспорта"],["{{ファイル形式の選択}}","Выберите формат файла"],["{{ファイル形式}}","Форматы файлов"],["{{サイズ設定}}","Установка размера"],["{{左上}}","Вверху слева"],["{{中央上}}","Вверху по центру"],["{{右上}}","Верхний правый"],["{{中央左}}","Центр Левый"],["{{中央}}","Центр"],["{{中央右}}","Центр Правый"],["{{左下}}","Низ Левый"],["{{中央下}}","Нижняя часть Центр"],["{{右下}}","Дно справа"],["{{中心点のX座標}}","X-координата центральной точки"],["{{中心点のY座標}}","Y-координата центральной точки"],["{{MovieClipに変換}}","Конвертировать в MovieClip"],["{{変換}}","трансформация"],["{{ループ回数}}","Количество циклов"],["{{カーブポインターの削除}}","Удалить указатель кривой"],["{{ステージ基準}}","Критерии этапа"],["{{閉じる}}","Закрыть"],["{{保存}}","Сохранить"],["{{リセット}}","сброс"],["{{スクリーン}}","Экран"],["{{ショートカット設定}}","Настройки ярлыков"],["{{レイヤーカラー}}","слоистый цвет"],["{{Next2Dを支援する}}","Поддержите Next2D"],["{{サポート}}","поддержка"],["{{未使用のアイテムを削除}}","Удалите неиспользуемые предметы"],["{{レイヤーをペースト}}","Слой пасты"],["{{レイヤーをコピー}}","Копирование слоя"],["{{フレームをペースト}}","Вставить рамку"],["{{フレームをコピー}}","Копировальная рама"],["{{キーフレームを削除}}","Удалить ключевые кадры"],["{{キーフレームに空のキーフレームを追加できません}}","Невозможно добавить пустые ключевые кадры в ключевые кадры"],["{{ズームツール}}","Инструмент масштабирования"],["{{タイムライン幅の拡大・縮小}}","Ширина временной шкалы Расширение/сокращение"],["{{ガイドレイヤー}}","направляющий слой"],["{{音量設定}}","Настройка громкости"],["{{サウンドを削除}}","Удалить звук"],["{{カスタムループ}}","индивидуальная петля"],["{{読込のみ}}","Только чтение"],["{{書込を許可}}","разрешение на публикацию"],["{{単一行}}","Одиночная линия"],["{{複数行}}","Многолинейный"],["{{自動で折り返し}}","Автоматический обхват"],["{{左寄せ}}","Слева"],["{{中央揃え}}","Центр"],["{{右寄せ}}","Правый"],["{{放射状グラデーション}}","радиальная градация"],["{{線形グラデーション}}","линейный градиент"],["{{画像}}","Изображение"],["{{画像選択}}","Выбор изображения"],["{{種別}}","Тип"],["{{Shapeの色設定}}","Настройки цвета формы"],["{{変形}}","деформация"],["{{カラー効果}}","Трансформация цвета"],["{{フィルター}}","фильтр"],["{{Shapeを複製}}","Дублировать форму"],["{{読み込み}}","читать в"],["{{新規フォルダー}}","Новая папка"],["{{新規MovieClip}}","Новый MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Измените размер текста, чтобы он поместился в рамку"],["{{テキストに合わせて枠をリサイズ}}","Измените размер рамки, чтобы вместить текст"],["{{リサイズしない}}","Отсутствие изменения размера"],["{{フォント}}","шрифт"],["{{テキスト}}","Текст"],["{{ループ}}","петля"],["{{音量}}","громкость"],["{{ビデオ}}","Видео"],["{{イージング}}","облегчение"],["{{サウンド}}","звук"],["{{シンボル}}","Символ"],["{{名前}}","Имя"],["{{オブジェクト}}","объект"],["{{ステージ設定}}","Постановка сцены"],["{{プレビュー}}","Предварительный просмотр"],["{{削除}}","Удалить"],["{{ペースト}}","Паста"],["{{コピー}}","Копировать"],["{{プラグインメニュー}}","Меню подключаемых модулей"],["{{トゥイーン}}","между"],["{{カーブポインターの追加}}","Дополнительный указатель кривой"],["{{パスの結合}}","Объединение путей"],["{{シェイプ}}","форма"],["{{キーフレームに配分}}","Распределение по ключевым кадрам"],["{{レイヤーに配分}}","Распределение по слоям"],["{{タイムライン}}","временная шкала"],["{{整列}}","Выровнять"],["{{最背面}}","Большая часть спины"],["{{ひとつ背面へ}}","Один в задней части"],["{{ひとつ前面へ}}","Один фронт"],["{{最前面}}","На переднем крае"],["{{重ね順}}","Организуйте"],["{{プラグイン}}","плагин"],["{{ライブラリ}}","библиотека"],["{{プロパティ}}","собственность"],["{{マスクレイヤー}}","слой маски"],["{{通常レイヤー}}","Нормальный слой"],["{{モーショントゥイーンの削除}}","Удаление твинов движения"],["{{モーショントゥイーンの追加}}","Дополнительные твины движения"],["{{モーダル表示}}","модальная индикация"],["{{言語}}","Язык"],["{{フォーマット}}","формат"],["{{含める}}","включать"],["{{含めない}}","не включать"],["{{使い方、リファレンス}}","Использование, ссылка"],["{{非表示レイヤー}}","скрытый слой"],["{{設定}}","настройка"],["{{デフォルトのループを利用する}}","Используйте цикл по умолчанию"],["{{フレームピッカー}}","подборщик рам"],["{{左揃え}}","Слева"],["{{中央揃え(水平方向)}}","Центр (горизонтальность)"],["{{右揃え}}","Справа"],["{{上揃え}}","Топ"],["{{中央揃え(垂直方向)}}","Центр (вертикальный)"],["{{下揃え}}","Дно"],["{{開始フレーム}}","начальная рамка"],["{{終了フレーム}}","торцевая рама"],["{{ループで再生}}","Воспроизведение по кругу"],["{{1回再生}}","1 воспроизведение"],["{{指定したフレームで固定}}","Фиксируется в указанном кадре"],["{{1回逆再生}}","1 воспроизведение в обратном направлении"],["{{逆ループで再生}}","Воспроизведение в обратном цикле"],["{{画面の拡大・縮小}}","Увеличение и уменьшение масштаба экрана"],["{{カスタムイージングデータを保存}}","Сохраните данные пользовательского смягчения"],["{{カスタムイージングデータの読込}}","Чтение пользовательских данных о смягчении"],["{{プレビューのON/OFF}}","Включение/выключение предварительного просмотра"],["{{フォント枠サイズ}}","Размер рамки шрифта"],["{{フォント枠カラー}}","Цвет шрифтовой рамки"],["{{オニオンスキン}}","Луковая шкурка"],["{{バケツツール}}","Ведерные инструменты"],["{{ペンツール}}",'Инструмент "Перо'],["{{ダブルクリックでカーブポイントが追加されます}}","Дважды щелкните, чтобы добавить точку кривой"],["{{選択ツール}}","Инструменты выбора"],["{{Shape変形ツール}}","Инструмент преобразования формы"],["{{テキストツール}}","Текстовый инструмент"],["{{矩形ツール}}",'Инструмент "Прямоугольник'],["{{楕円ツール}}",'Инструмент "Эллипс'],["{{角丸矩形ツール}}",'Инструмент "Скругленный прямоугольник'],["{{塗りのカラー}}","Цвет заливки"],["{{線のカラー}}","Цвет штриха"],["{{線の太さ}}","Ширина штриха"],["{{プロジェクトデータの読込}}","Загрузка данных проекта"],["{{プロジェクトデータを保存}}","Сохранить данные проекта"],["{{書き出し}}","Экспорт"],["{{Discordへ移動}}","Зайдите в дискорд"],["{{バグ報告}}","Сообщения об ошибках"],["{{設定}}","Настройка"],["{{タブを追加}}","Добавить вкладку"],["{{タブの一覧を表示・移動}}","Просмотр и перемещение по списку вкладок"],["{{スクリプトを追加}}","Добавить сценарий"],["{{キーフレームを追加}}","Добавить ключевой кадр"],["{{空のキーフレームを追加}}","Добавьте пустой ключевой кадр"],["{{フレームを追加}}","Добавить рамку"],["{{フレームを削除}}","Удалить рамку"],["{{再生}}","Играть"],["{{停止}}","Остановить"],["{{ループ設定}}","Настройка контура"],["{{レイヤーを追加}}","Добавить слой"],["{{レイヤーを削除}}","Удалить слой"],["{{全てのレイヤーをハイライト}}","Выделите все слои"],["{{全てのレイヤーを非表示}}","Скрыть все слои"],["{{全てのレイヤーをロック}}","Заблокируйте все слои"],["{{比率を固定}}","Фиксированный коэффициент"],["{{ステージの幅}}","Ширина сцены"],["{{背景色}}","Цвет фона"],["{{ステージの高さ}}","Высота сцены"],["{{フレームレート}}","Частота кадров"],["{{シンボル名}}","Название символа"],["{{イージング設定}}","Установка облегчения"],["{{ビデオの音量設定}}","Настройка громкости видео"],["{{自動再生}}","Автоматическое воспроизведение"],["{{テキストエリアのボーダー設定}}","Настройка границ текстовой области"],["{{テキスト入力設定}}","Настройка ввода текста"],["{{フォント選択}}","Выбор шрифта"],["{{自動サイズ調整}}","Автоматическая регулировка размера"],["{{フォントスタイルタイプ}}","Тип стиля шрифта"],["{{行揃え}}","Выровнять"],["{{改行設定}}","Установка новой строки"],["{{スクロール設定}}","Настройка прокрутки"],["{{フォントサイズ}}","Размер шрифта"],["{{フォントカラー}}","Цвет шрифта"],["{{行間}}","Пространство линии"],["{{文字幅}}","Ширина символа"],["{{左マージン}}","Левое поле"],["{{右マージン}}","Правая граница"],["{{カラー種別の選択}}","Выберите тип цвета"],["{{背景画像の選択}}","Выбор фонового изображения"],["{{カラーポインターを追加}}","Добавьте указатели цвета"],["{{カラー値}}","Цвет"],["{{アルファ(0%-100%)}}","Альфа(0%-100%)"],["{{アルファ値}}","Альфа"],["{{選択対象の幅}}","Ширина объекта выделения"],["{{選択対象のX座標}}","X координата объекта выделения"],["{{選択対象の高さ}}","Высота объекта выделения"],["{{選択対象のY座標}}","Y координата объекта выделения"],["{{選択対象の幅の伸縮}}","масштабX выбранного объекта"],["{{選択対象を回転}}","Повернуть объект"],["{{選択対象の高さの伸縮}}","scaleY выбранного объекта"],["{{アルファオフセット(-255〜255)}}","Альфа-смещение(-255〜255)"],["{{赤(0%-100%)}}","Красный(0%-100%)"],["{{赤オフセット(-255〜255)}}","Красное смещение(-255〜255)"],["{{緑(0%-100%)}}","Зеленый(0%-100%)"],["{{緑オフセット(-255〜255)}}","Зеленый зачет(-255〜255)"],["{{青(0%-100%)}}","Голубой(0%-100%)"],["{{青オフセット(-255〜255)}}","Синее смещение(-255〜255)"],["{{ブレンドモード}}","Режим наложения"],["{{フィルターを選択}}","Выберите фильтр"],["{{フィルターを追加}}","Добавить фильтр"],["{{サウンドを追加}}","Добавить звук"],["{{フィルターを表示・非表示する}}","Показать и скрыть фильтры"],["{{フィルターを削除}}","Удалить фильтр"],["{{水平方向にぼかす}}","Размытие по горизонтали"],["{{垂直方向にぼかす}}","Размытие по вертикали"],["{{フィルター強度}}","Прочность фильтра"],["{{フィルター角度}}","Угол фильтрации"],["{{シャドウのアルファ}}","Тень Альфа"],["{{シャドウのカラー}}","Цвет теней"],["{{フィルター距離}}","Расстояние между фильтрами"],["{{ハイライトのカラー}}","Цвет подсветки"],["{{ハイライトのアルファ}}","Выделение Альфа"],["{{グラデーションカラー}}","Цвет градиента"],["{{グラデーションのアルファ}}","Градиент Альфа"],["{{タブの移動・名前を変更}}","Переместить/именовать вкладки"],["{{プロジェクトを閉じる}}","Закрыть проект"],["{{上下に移動}}","Двигайтесь вверх и вниз"],["{{レイヤー変更(ダブルクリック)}}","Смена слоя (двойной щелчок)"],["{{レイヤーをハイライト}}","Выделительный слой"],["{{レイヤーを非表示}}","Скрыть слой"],["{{レイヤーをロック}}","Заблокировать слой"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Указатель кривой (двойной щелчок для включения/выключения)"],["{{インスタンス名}}","Имя экземпляра"],["{{ライブラリ内の検索}}","Поиск в библиотеке"],["{{フレームラベル}}","Рамочная этикетка"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Если проект не сохранен, данные проекта на этой вкладке не могут быть восстановлены. Вы хотите удалить вкладку?"]])}}class c extends t{createMapping(){return new Map([["{{ロックされたレイヤーです}}","Capa bloqueada"],["{{トゥイーンには複数のオブジェクトを設置できません}}","No se pueden colocar varios objetos en una interpolación"],["{{名前が重複しています}}","Nombre duplicado"],["{{名前は必須です}}","El nombre es obligatorio"],["{{基準点}}","punto de referencia"],["{{自由変形ツール}}","Herramienta de transformación gratuita"],["{{キーフレームに変換}}","Convertir en fotogramas clave"],["{{空のキーフレームに変換}}","Convertir en fotogramas clave vacíos"],["{{最初のフレームに移動}}","Ir al primer cuadro"],["{{最後のフレームに移動}}","Ir al último cuadro"],["{{SWFを解析中}}","SWF que se está analizando"],["{{JSONを生成}}","Generar JSON"],["{{ファイルを生成}}","Generar archivo"],["{{N2Dファイルの読み込み}}","Carga de archivos N2D"],["{{JSONの読み込み}}","Carga de JSON"],["{{データを解凍中}}","Descompresión de datos"],["{{データを圧縮中}}","Compresión de datos"],["{{エンコード}}","Codificación"],["{{外部ファイルの読み込み}}","Lectura de archivos externos"],["{{バイナリデータを生成}}","Generación de datos binarios"],["{{データベースを起動}}","Iniciar la base de datos"],["{{データを保存中}}","Almacenamiento de datos en curso"],["{{完了}}","Completado"],["{{ステージ左揃え}}","Alinear el escenario a la izquierda"],["{{ステージ中央揃え(水平方向)}}","Alinear el centro del escenario (horizontal)"],["{{ステージ右揃え}}","Alinear el escenario a la derecha"],["{{ステージ上揃え}}","Alinear el escenario hacia arriba"],["{{ステージ中央揃え(垂直方向)}}","Alinear el centro del escenario (vertical)"],["{{ステージ下揃え}}","Alinear el fondo del escenario"],["{{定規}}","Regla"],["{{表示}}","Mostrar"],["{{ショートカット}}","acceso directo"],["{{レイヤーを複製}}","Duplicar capa"],["{{未使用のフォルダを削除}}","Eliminar las carpetas no utilizadas"],["{{同名のアイテムが存在します}}","Existen artículos con el mismo nombre"],["{{追加ファイル}}","Archivo adicional"],["{{既存のコンテンツ}}","Contenido existente"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","Puede elegir entre sobrescribir, renombrar y añadir archivos, u omitir"],["{{全て上書き}}","Sobrescribir todo"],["{{全てスキップ}}","Omitir todo"],["{{追加・上書き}}","Añadir o sobrescribir"],["{{スキップ}}","Omitir"],["{{表示確認したいフレームを指定}}","Especifique el marco del que desea comprobar la visualización"],["{{ファイル名を指定}}","Especifique el nombre del archivo"],["{{ファイル名}}","nombre del archivo"],["{{終了フレームを指定}}","Especifique el marco final"],["{{開始フレームを指定}}","Especifique el marco de inicio"],["{{フレーム設定}}","Ajuste del marco"],["{{書き出し設定}}","Configuración de la exportación"],["{{ファイル形式の選択}}","Seleccione el formato de archivo"],["{{ファイル形式}}","Formatos de archivo"],["{{サイズ設定}}","Ajuste del tamaño"],["{{左上}}","Arriba a la izquierda"],["{{中央上}}","Centro superior"],["{{右上}}","Arriba Derecha"],["{{中央左}}","Centro Izquierda"],["{{中央}}","Centro"],["{{中央右}}","Centro derecha"],["{{左下}}","Abajo a la izquierda"],["{{中央下}}","Abajo Centro"],["{{右下}}","Abajo a la derecha"],["{{中心点のX座標}}","Coordenada X del punto central"],["{{中心点のY座標}}","Coordenada Y del punto central"],["{{MovieClipに変換}}","Convertir a MovieClip"],["{{変換}}","transformación"],["{{ループ回数}}","Recuento de bucles"],["{{カーブポインターの削除}}","Borrar el puntero de la curva"],["{{ステージ基準}}","Criterios de la etapa"],["{{閉じる}}","Cerrar"],["{{保存}}","Guardar"],["{{リセット}}","restablecer"],["{{スクリーン}}","Pantalla"],["{{ショートカット設定}}","Configuración de los accesos directos"],["{{レイヤーカラー}}","color en capas"],["{{Next2Dを支援する}}","Apoya a Next2D"],["{{サポート}}","soporte"],["{{未使用のアイテムを削除}}","Eliminar los elementos no utilizados"],["{{レイヤーをペースト}}","Capa de pasta"],["{{レイヤーをコピー}}","Copiar capa"],["{{フレームをペースト}}","Pegar el marco"],["{{フレームをコピー}}","Copiar marco"],["{{キーフレームを削除}}","Eliminar fotogramas clave"],["{{キーフレームに空のキーフレームを追加できません}}","No se pueden añadir fotogramas clave vacíos a los fotogramas clave"],["{{ズームツール}}","Herramienta de zoom"],["{{タイムライン幅の拡大・縮小}}","Anchura de la línea de tiempo Ampliar/reducir"],["{{ガイドレイヤー}}","capa de guía"],["{{音量設定}}","Ajuste del volumen"],["{{サウンドを削除}}","Eliminar el sonido"],["{{カスタムループ}}","bucle personalizado"],["{{読込のみ}}","Sólo para leer"],["{{書込を許可}}","permiso de correos"],["{{単一行}}","Línea única"],["{{複数行}}","Multilínea"],["{{自動で折り返し}}","Envoltura automática"],["{{左寄せ}}","Izquierda"],["{{中央揃え}}","Centro"],["{{右寄せ}}","Derecha"],["{{放射状グラデーション}}","gradación radial"],["{{線形グラデーション}}","gradiente lineal"],["{{画像}}","Imagen"],["{{画像選択}}","Selección de imágenes"],["{{種別}}","Tipo"],["{{Shapeの色設定}}","Configuración del color de la forma"],["{{変形}}","deformación"],["{{カラー効果}}","Transformación del color"],["{{フィルター}}","filtro"],["{{Shapeを複製}}","Duplicar la forma"],["{{読み込み}}","leer en"],["{{新規フォルダー}}","Carpeta nueva"],["{{新規MovieClip}}","Nuevo MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Cambia el tamaño del texto para que se ajuste al marco"],["{{テキストに合わせて枠をリサイズ}}","Cambia el tamaño del marco para que se ajuste al texto"],["{{リサイズしない}}","No hay cambio de tamaño"],["{{フォント}}","fuente"],["{{テキスト}}","Texto"],["{{ループ}}","bucle"],["{{音量}}","volumen"],["{{ビデオ}}","Vídeo"],["{{イージング}}","facilitando"],["{{サウンド}}","sonido"],["{{シンボル}}","Símbolo"],["{{名前}}","Nombre"],["{{オブジェクト}}","objeto"],["{{ステージ設定}}","Puesta en escena"],["{{プレビュー}}","Previsualización"],["{{削除}}","Borrar"],["{{ペースト}}","Pegar"],["{{コピー}}","Copiar"],["{{プラグインメニュー}}","Menú de complementos"],["{{トゥイーン}}","tween"],["{{カーブポインターの追加}}","Puntero de curva adicional"],["{{パスの結合}}","Fusión de caminos"],["{{シェイプ}}","forma"],["{{キーフレームに配分}}","Asignación a los fotogramas clave"],["{{レイヤーに配分}}","Asignación a las capas"],["{{タイムライン}}","línea de tiempo"],["{{整列}}","Alinear"],["{{最背面}}","La mayor parte de la espalda"],["{{ひとつ背面へ}}","Uno en la parte trasera"],["{{ひとつ前面へ}}","Un frente"],["{{最前面}}","Frontmost"],["{{重ね順}}","Organice"],["{{プラグイン}}","plug-in"],["{{ライブラリ}}","biblioteca"],["{{プロパティ}}","propiedad"],["{{マスクレイヤー}}","capa de máscara"],["{{通常レイヤー}}","Capa normal"],["{{モーショントゥイーンの削除}}","Supresión de los tweens de movimiento"],["{{モーショントゥイーンの追加}}","Tweens de movimiento adicionales"],["{{モーダル表示}}","indicación modal"],["{{言語}}","El idioma"],["{{フォーマット}}","formato"],["{{含める}}","incluir"],["{{含めない}}","no incluir"],["{{使い方、リファレンス}}","Uso, referencia"],["{{非表示レイヤー}}","capa oculta"],["{{設定}}","configuración"],["{{デフォルトのループを利用する}}","Utiliza el bucle por defecto"],["{{フレームピッカー}}","Recogedor de marcos"],["{{左揃え}}","Izquierda"],["{{中央揃え(水平方向)}}","Centro (Horizontal)"],["{{右揃え}}","Derecho"],["{{上揃え}}","Arriba"],["{{中央揃え(垂直方向)}}","Centro (Vertical)"],["{{下揃え}}","Fondo"],["{{開始フレーム}}","marco de inicio"],["{{終了フレーム}}","marco final"],["{{ループで再生}}","Reproducir en bucle"],["{{1回再生}}","1 reproducción"],["{{指定したフレームで固定}}","Fijado en el marco especificado"],["{{1回逆再生}}","1 reproducción inversa"],["{{逆ループで再生}}","Reproducción en bucle invertido"],["{{画面の拡大・縮小}}","Acercar y alejar la pantalla"],["{{カスタムイージングデータを保存}}","Guarda los datos de la flexión personalizada"],["{{カスタムイージングデータの読込}}","Lectura de datos de flexibilización personalizados"],["{{プレビューのON/OFF}}","Activación/desactivación de la vista previa"],["{{フォント枠サイズ}}","Tamaño del marco de la fuente"],["{{フォント枠カラー}}","Color del marco de la fuente"],["{{オニオンスキン}}","Piel de cebolla"],["{{バケツツール}}","Herramientas para cubos"],["{{ペンツール}}","Herramienta de la pluma"],["{{ダブルクリックでカーブポイントが追加されます}}","Haga doble clic para añadir un punto de curva"],["{{選択ツール}}","Herramientas de selección"],["{{Shape変形ツール}}","Herramienta de transformación de formas"],["{{テキストツール}}","Herramienta de texto"],["{{矩形ツール}}","Herramienta Rectángulo"],["{{楕円ツール}}","Herramienta Elipse"],["{{角丸矩形ツール}}","Herramienta Rectángulo Redondeado"],["{{塗りのカラー}}","Color de relleno"],["{{線のカラー}}","Color del trazo"],["{{線の太さ}}","Anchura de la carrera"],["{{プロジェクトデータの読込}}","Carga de los datos del proyecto"],["{{プロジェクトデータを保存}}","Guardar los datos del proyecto"],["{{書き出し}}","Exportar"],["{{Discordへ移動}}","Ir a la discordia"],["{{バグ報告}}","Informes de errores"],["{{設定}}","Configuración"],["{{タブを追加}}","Añadir una pestaña"],["{{タブの一覧を表示・移動}}","Ver y desplazarse por la lista de pestañas"],["{{スクリプトを追加}}","Añadir una secuencia de comandos"],["{{キーフレームを追加}}","Añadir un fotograma clave"],["{{空のキーフレームを追加}}","Añadir un fotograma clave vacío"],["{{フレームを追加}}","Añadir un marco"],["{{フレームを削除}}","Borrar el marco"],["{{再生}}","Juega a"],["{{停止}}","Detener"],["{{ループ設定}}","Ajuste del bucle"],["{{レイヤーを追加}}","Añadir una capa"],["{{レイヤーを削除}}","Eliminar la capa"],["{{全てのレイヤーをハイライト}}","Resaltar todas las capas"],["{{全てのレイヤーを非表示}}","Ocultar todas las capas"],["{{全てのレイヤーをロック}}","Bloquear todas las capas"],["{{比率を固定}}","Relación fija"],["{{ステージの幅}}","Anchura del escenario"],["{{背景色}}","Color de fondo"],["{{ステージの高さ}}","Altura del escenario"],["{{フレームレート}}","Velocidad de fotogramas"],["{{シンボル名}}","Nombre del símbolo"],["{{イージング設定}}","Ajuste de la flexibilización"],["{{ビデオの音量設定}}","Ajuste del volumen de vídeo"],["{{自動再生}}","Reproducción automática"],["{{テキストエリアのボーダー設定}}","Configuración del borde del área de texto"],["{{テキスト入力設定}}","Ajuste de la entrada de texto"],["{{フォント選択}}","Selección de fuentes"],["{{自動サイズ調整}}","Ajuste automático del tamaño"],["{{フォントスタイルタイプ}}","Tipo de letra"],["{{行揃え}}","Alinear"],["{{改行設定}}","Ajuste de la nueva línea"],["{{スクロール設定}}","Ajuste de desplazamiento"],["{{フォントサイズ}}","Tamaño de la fuente"],["{{フォントカラー}}","Color de la fuente"],["{{行間}}","Espacio de la línea"],["{{文字幅}}","Anchura de los caracteres"],["{{左マージン}}","Margen izquierdo"],["{{右マージン}}","Margen derecho"],["{{カラー種別の選択}}","Seleccione un tipo de color"],["{{背景画像の選択}}","Seleccionar una imagen de fondo"],["{{カラーポインターを追加}}","Añadir punteros de color"],["{{カラー値}}","Color"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Anchura del objeto de selección"],["{{選択対象のX座標}}","Coordenada X del objeto de selección"],["{{選択対象の高さ}}","Altura del objeto de selección"],["{{選択対象のY座標}}","Coordenada Y del objeto de selección"],["{{選択対象の幅の伸縮}}","scaleX del objeto seleccionado"],["{{選択対象を回転}}","Girar el objeto"],["{{選択対象の高さの伸縮}}","escalaY del objeto seleccionado"],["{{アルファオフセット(-255〜255)}}","Desplazamiento alfa(-255〜255)"],["{{赤(0%-100%)}}","Rojo(0%-100%)"],["{{赤オフセット(-255〜255)}}","Compensación roja(-255〜255)"],["{{緑(0%-100%)}}","Verde(0%-100%)"],["{{緑オフセット(-255〜255)}}","Compensación verde(-255〜255)"],["{{青(0%-100%)}}","Azul(0%-100%)"],["{{青オフセット(-255〜255)}}","Offset azul(-255〜255)"],["{{ブレンドモード}}","Modo de fusión"],["{{フィルターを選択}}","Seleccione un filtro"],["{{フィルターを追加}}","Añadir un filtro"],["{{サウンドを追加}}","Añadir un sonido"],["{{フィルターを表示・非表示する}}","Mostrar y ocultar filtros"],["{{フィルターを削除}}","Eliminar el filtro"],["{{水平方向にぼかす}}","Desenfoque horizontal"],["{{垂直方向にぼかす}}","Desenfoque vertical"],["{{フィルター強度}}","Fuerza del filtro"],["{{フィルター角度}}","Ángulo del filtro"],["{{シャドウのアルファ}}","Sombra Alfa"],["{{シャドウのカラー}}","Color de la sombra"],["{{フィルター距離}}","Distancia del filtro"],["{{ハイライトのカラー}}","Color de realce"],["{{ハイライトのアルファ}}","Resaltar Alpha"],["{{グラデーションカラー}}","Color degradado"],["{{グラデーションのアルファ}}","Gradiente Alfa"],["{{タブの移動・名前を変更}}","Mover/Renombrar pestañas"],["{{プロジェクトを閉じる}}","Cerrar el proyecto"],["{{上下に移動}}","Subir y bajar"],["{{レイヤー変更(ダブルクリック)}}","Cambio de capa (doble clic)"],["{{レイヤーをハイライト}}","Capa de resaltado"],["{{レイヤーを非表示}}","Ocultar capa"],["{{レイヤーをロック}}","Bloquear la capa"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Puntero de curva (doble clic para activar/desactivar)"],["{{インスタンス名}}","Nombre de la instancia"],["{{ライブラリ内の検索}}","Buscar en la biblioteca"],["{{フレームラベル}}","Etiqueta del marco"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Si el proyecto no se guarda, los datos del proyecto en esta pestaña no se pueden recuperar. ¿Desea eliminar la pestaña?"]])}}const d={VERSION:1,PREFIX:"__next2d-tools__",DATABASE_NAME:"save-data",STORE_KEY:"local",REVISION_LIMIT:100,$activeWorkSpaceId:0,$activeCharacterIds:[],$workSpaces:[],$readStatus:0,$readEnd:1,$shiftKey:!1,$ctrlKey:!1,$altKey:!1,$zoomScale:1,$currentFrame:1,$root:null};d.$Rad2Deg=180/Math.PI,d.$Deg2Rad=Math.PI/180,d.$keyLock=!1,d.$activeScript=!1,d.$previewMode=!1,d.$offsetLeft=0,d.$offsetTop=0,d.$currentCursor="auto",d.$useIds=new Map,d.$symbols=new Map,d.$copyWorkSpaceId=-1,d.$copyLibrary=null,d.$copyLayer=null,d.$copyCharacter=null,d.$canCopyLayer=!1,d.$canCopyCharacter=!1,d.$hitColor=null,d.$updated=!1,d.$languages=new Map,d.$currentLanguage=null,d.$shapePointerColor="#009900",d.$shapeLinkedPointerColor="#ffa500",d.$shortcut=new Map,d.$useShortcutSetting=!1,d.$changeLibraryId=0,d.$canvases=[],d.$sleepCanvases=[];const h=window.navigator.userAgentData;h?h.getHighEntropyValues(["platform"]).then((e=>{d.$isMac=e.platform.indexOf("mac")>-1})):d.$isMac=window.navigator.userAgent.indexOf("Mac")>-1;const u=document.createElement("canvas");u.width=1,u.height=1,d.$hitContext=u.getContext("2d"),d.$useOffscreenCanvas="transferControlToOffscreen"in u,d.$getCanvas=()=>d.$canvases.length?d.$canvases.shift():document.createElement("canvas"),d.$poolCanvas=e=>{e instanceof HTMLCanvasElement&&(e.width=e.height=1,d.$canvases.push(e))},d.$cloneMovieClip=(e,t)=>{const r=d.$workSpaces[e],a=d.$currentWorkSpace(),s=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$copyWorkSpaceId;const i=t.clone();d.$activeWorkSpaceId=s;for(const t of i._$layers.values()){const n=new v;for(let i=0;i<t._$characters.length;++i){d.$activeWorkSpaceId=e;const o=new p(JSON.parse(JSON.stringify(t._$characters[i].toObject())));o._$id=a._$characterId++,d.$activeWorkSpaceId=s;const l=r.getLibrary(o.libraryId);if(this._$copyMapping.has(l.id)){o.libraryId=this._$copyMapping.get(l.id),n.addCharacter(o);continue}if(l.folderId){const e=[];let t=l;for(;t._$folderId;)t=r.getLibrary(t._$folderId),e.unshift(t);for(let t=0;e.length>t;++t){const s=e[t],i=s.getPathWithWorkSpace(r);if(a._$nameMap.has(i)){this._$instanceMap.has(s.id)||this._$instanceMap.set(s.id,[]),this._$instanceMap.get(s.id).push({layer:null,path:i,character:s});continue}const n=s.clone(),o=a.nextLibraryId;this._$copyMapping.set(n.id,o),n._$id=o,n.folderId&&this._$copyMapping.has(n.folderId)&&(n.folderId=this._$copyMapping.get(n.folderId)),a._$libraries.set(n.id,n),d.$libraryController.createInstance(n.type,n.name,n.id,n.symbol)}}const c=l.getPathWithWorkSpace(r);if(a._$nameMap.has(c)){this._$instanceMap.has(l.id)||this._$instanceMap.set(l.id,[]),this._$instanceMap.get(l.id).push({layer:n,path:c,character:o});continue}const h=l.type===b.MOVIE_CLIP?this.cloneMovieClip(l):l.clone(),u=a.nextLibraryId;this._$copyMapping.set(l.id,u),o.libraryId=u,h._$id=u,a._$libraries.set(h.id,h),h.folderId&&this._$copyMapping.has(h.folderId)&&(h.folderId=this._$copyMapping.get(h.folderId)),d.$libraryController.createInstance(h.type,h.name,h.id,h.symbol),a._$nameMap.set(c,h.id),n.addCharacter(o)}for(let e=0;e<t._$emptys.length;++e)n.addEmptyCharacter(t._$emptys[e].clone());n.id=t.id,i.setLayer(n.id,n)}return i},d.$clamp=(e,t,r)=>{const a=+e;return Math.min(Math.max(t,isNaN(a)||!isFinite(a)?0:a),r)},d.$generateShortcutKey=(e,t=null)=>{let r=1===e.length?e.toLowerCase():e;return t&&(t.shift&&(r+="Shift"),t.alt&&(r+="Alt"),t.ctrl&&(r+="Ctrl")),r},d.$isArray=e=>Array.isArray(e),d.$setCursor=(e="auto")=>{d.$currentCursor!==e&&(d.$currentCursor=e,document.documentElement.style.setProperty("--tool-cursor",e))},d.$addModalEvent=e=>{const t=e.querySelectorAll("[data-detail]");for(let e=0;e<t.length;++e){const r=t[e];r.addEventListener("mouseover",d.$fadeIn),r.addEventListener("mouseout",d.$fadeOut)}},d.$fadeIn=e=>{const t=d.$userSetting.getPublishSetting();if("modal"in t&&!t.modal)return;const r=e.currentTarget;let a=d.$currentLanguage.replace(r.dataset.detail),s=r.dataset.shortcutKey;if(s){const e=d.$shortcutSetting.viewMapping.get(r.dataset.area);a+=` (${e.has(s)?e.get(s).text:r.dataset.shortcutText})`}const i=document.getElementById("detail-modal");switch(i.textContent!==a&&(i.textContent=a),!0){case i.clientWidth+e.pageX-20>window.innerWidth:i.style.left=e.pageX-(i.clientWidth+e.pageX+10-window.innerWidth)+"px";break;case 0>e.pageX-20:i.style.left="10px";break;default:i.style.left=e.pageX-20+"px"}if(!0==i.clientHeight+e.pageY+20>window.innerHeight)i.style.top=e.pageY-i.clientHeight-20+"px";else i.style.top=`${e.pageY+20}px`;i.setAttribute("class","fadeIn"),i.dataset.timerId=setTimeout((()=>{i.classList.contains("fadeOut")||i.setAttribute("class","fadeOut")}),1500)},d.$fadeOut=()=>{const e=d.$userSetting.getPublishSetting();if("modal"in e&&!e.modal)return;const t=document.getElementById("detail-modal");clearTimeout(0|t.dataset.timerId),t.setAttribute("class","fadeOut")},d.$endMenu=e=>{const t=["timeline-menu","library-menu","tab-name-menu","timeline-layer-menu","scene-name-menu","user-setting","screen-menu","editor-modal","plugin-modal","shortcut-setting-menu","library-export-modal","screen-order-menu","screen-align-menu","change-movie-clip"];for(let r=0;r<t.length;++r){const a=t[r];if(a===e)continue;"editor-modal"===a&&d.$javaScriptEditor.active&&d.$javaScriptEditor.hide();const s=document.getElementById(a);s.classList.contains("fadeIn")&&s.setAttribute("class","fadeOut")}},d.$loadSaveData=()=>{d.$saveProgress.start();const e=localStorage.getItem(`${d.PREFIX}@${d.DATABASE_NAME}`);if(e){localStorage.removeItem(`${d.PREFIX}@${d.DATABASE_NAME}`);const t=e.length,r=new Uint8Array(t);for(let a=0;a<t;++a)r[a]=255&e.charCodeAt(a);d.$saveProgress.zlibInflate(),d.$unZlibWorker.postMessage({buffer:r,type:"local"},[r.buffer])}else{d.$saveProgress.launchDatabase(10);d.$launchDB().onsuccess=e=>{const t=e.target.result;t.transaction(`${d.DATABASE_NAME}`,"readonly").objectStore(`${d.DATABASE_NAME}`).get(d.STORE_KEY).onsuccess=e=>{const r=e.target.result;if(r){const e=r.length,t=new Uint8Array(e);for(let a=0;a<e;++a)t[a]=255&r.charCodeAt(a);d.$saveProgress.zlibInflate(),d.$unZlibWorker.postMessage({buffer:t,type:"local"},[t.buffer])}else d.$workSpaces.push(new z),d.$screenTab.run(),d.$initializeEnd();t.close()}}}},d.$multiplicationMatrix=(e,t)=>new Float32Array([e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]),d.$setShortcut=(e,t)=>{d.$shortcut.set(e,t)},d.$deleteShortcut=e=>{d.$shortcut.has(e)&&d.$shortcut.delete(e)},d.$executeKeyCommand=e=>{if(d.$shiftKey=e.shiftKey,d.$ctrlKey=e.ctrlKey||e.metaKey,d.$altKey=e.altKey,d.$ctrlKey)switch(e.key){case"-":case"+":case";":e.stopPropagation(),e.preventDefault()}if(d.$keyLock)return;if(d.$useShortcutSetting)return e.stopPropagation(),void e.preventDefault();const t=d.$generateShortcutKey(e.key,{alt:d.$altKey,shift:d.$shiftKey,ctrl:d.$ctrlKey});d.$shortcut.has(t)&&(e.stopPropagation(),e.preventDefault(),d.$shortcut.get(t)(e))},d.$loadAudioContext=()=>{window.removeEventListener("click",d.$loadAudioContext),d.$audioContext=new AudioContext,"next2d"in window&&d.$root.stage._$player._$loadWebAudio()},d.$initialize=()=>{"Raven"in window&&(Raven.config("https://ebbc692644d14dddaa6f6fec5a9a2dc6@o4504829779705856.ingest.sentry.io/4504829782458368").install(),window.onerror=(e,t,r,a,s)=>{console.log(e),Raven.captureException(s)}),window.removeEventListener("DOMContentLoaded",d.$initialize),window.addEventListener("mousedown",d.$loadAudioContext),d.$filterClasses={BevelFilter:F,BlurFilter:k,DropShadowFilter:A,GlowFilter:T,GradientBevelFilter:B,GradientGlowFilter:P},d.$languages.set("Japanese",n),d.$languages.set("English",a),d.$languages.set("Chinese",r),d.$languages.set("Korean",o),d.$languages.set("French",s),d.$languages.set("Russia",l),d.$languages.set("Italiano",i),d.$languages.set("Spanish",c);let e=localStorage.getItem(`${d.PREFIX}@language-setting`);if(!e)switch(navigator.language){case"ja":e="Japanese";break;case"ko":e="Korean";break;case"zh":e="Chinese";break;case"fr":e="French";break;case"ru":e="Russia";break;case"it":e="Italiano";break;case"es":e="Spanish";break;default:e="English"}const t=d.$languages.get(e);d.$currentLanguage=new t;const h=x.STAGE_DEFAULT_WIDTH,u=x.STAGE_DEFAULT_HEIGHT,m=x.STAGE_DEFAULT_FPS,g=document.getElementById("preview-display");if(g&&(g.style.width=`${h}px`,g.style.height=`${u}px`),"next2d"in window){d.$root=window.next2d.createRootMovieClip(h,u,m,{tagId:"preview-display"}),d.$root.stage._$player.stop();const{LoaderInfo:e}=window.next2d.display;d.$loaderInfo=new e}d.$loadSaveData(),window.addEventListener("keydown",d.$executeKeyCommand),window.addEventListener("keyup",(()=>{d.$shiftKey=!1,d.$ctrlKey=!1,d.$altKey=!1})),window.addEventListener("beforeunload",(e=>{if(d.$updated)return e.preventDefault(),e.stopPropagation(),e.returnValue="データ保存中...",d.$autoSave(),!1})),document.documentElement.style.setProperty("--timeline-frame-width",`${_e.DEFAULT_TIMELINE_WIDTH}px`),document.documentElement.style.setProperty("--timeline-frame-height",_e.DEFAULT_TIMELINE_HEIGHT-1+"px"),document.documentElement.style.setProperty("--screen-height",window.innerHeight-50+"px");const $=document.getElementById("preview-stop");$&&$.addEventListener("click",d.$hidePreview),document.documentElement.style.setProperty("--ad","280px"),d.$initialize=null},window.addEventListener("DOMContentLoaded",d.$initialize),window.addEventListener("resize",(()=>{d.$saveProgress.active||(d.$rebuildTimeline(),d.$rebuildRuler())})),d.$rebuildRuler=()=>{const e=d.$currentWorkSpace();(e._$rulerX.length||e._$rulerY.length)&&d.$screenRuler.rebuild()},d.$rebuildTimeline=()=>{d.$timelineHeader._$currentFrame=-1,d.$timelineHeader.setWidth(),d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),d.$timelineLayer.updateClientSize()},d.$showPreview=()=>{d.$timelinePlayer.executeTimelineStop(),d.$javaScriptEditor.save(),d.$previewMode=!0,d.$keyLock=!0;const e=document.getElementById("player-preview");e.style.display="",e.style.zIndex="9999";const t=d.$currentWorkSpace(),r=document.getElementById("preview-display");r.style.width=`${t.stage.width}px`,r.style.height=`${t.stage.height}px`;const a=document.getElementById("preview-stop");a.style.top=r.offsetTop-20+"px",a.style.left=`${r.offsetLeft+t.stage.width}px`,a.addEventListener("click",d.$hidePreview);const s=d.$root.stage,i=s._$player;s.clearGlobalVariable(),s._$events=new Map,i._$broadcastEvents=new Map;const n=q.toJSON();d.$useIds.clear();const{Loader:o}=window.next2d.display,{URLRequest:l}=window.next2d.net,{Event:c}=window.next2d.events,h=new o;h.contentLoaderInfo.addEventListener(c.COMPLETE,(e=>{const t=e.currentTarget,r=d.$root.stage,a=r._$player,s=t._$data;for(a.width=s.stage.width,a.height=s.stage.height,a.stage._$frameRate=s.stage.fps,a._$resize();r.numChildren;)r.removeChildAt(0);d.$root=null,d.$root=t.content,r.addChild(d.$root),a._$setBackgroundColor(0|`0xff${s.stage.bgColor.slice(1)}`),a._$cacheStore.reset(),a.play()})),h.load(new l(URL.createObjectURL(new Blob([n],{type:"application/json"})))),i._$broadcastEvents.clear(),window.next2d.media.SoundMixer.volume=1,i._$loadStatus=1,i._$updateLoadStatus()},d.$hidePreview=()=>{document.getElementById("preview-stop").removeEventListener("click",d.$hidePreview);const e=document.getElementById("player-preview");e.style.display="none",e.style.zIndex="0",d.$previewMode=!1,d.$activeScript||(d.$keyLock=!1);const t=d.$root,r=t.stage._$player;for(;d.$root.numChildren;)t.removeChildAt(0);r._$setBackgroundColor(),r.stop()},d.$toJSON=()=>{const e=d.$activeWorkSpaceId,t=document.getElementById("view-tab-area").children,r=[];for(let e=0;e<t.length;++e){const a=t[e],s=d.$workSpaces[0|a.dataset.tabId];s&&(d.$activeWorkSpaceId=0|a.dataset.tabId,r.push(s.toJSON()))}return d.$activeWorkSpaceId=e,JSON.stringify(r)},d.$autoSave=()=>d.$saveProgress.active?Promise.resolve():(d.$javaScriptEditor.save(),d.$saveProgress.start(),new Promise((e=>{d.$saveProgress.createJson(),setTimeout((()=>{e({object:d.$toJSON(),type:"local"})}),200)})).then((e=>{d.$saveProgress.zlibDeflate(),d.$zlibWorkerActive?d.$zlibQueues.push(e):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(e))}))),d.$inverseMatrix=e=>{const t=e[2]*e[5]-e[3]*e[4],r=e[1]*e[4]-e[0]*e[5];let a=e[0]*e[3]-e[2]*e[1];if(!a||!isFinite(a))return[e[3],-e[1],-e[2],e[0],t,r];const s=1/a;return[e[3]*s,-e[1]*s,-e[2]*s,e[0]*s,t*s,r*s]},d.$toFixed4=e=>{const t=e.toString(),r=t.indexOf("e");return r>-1&&(e=+t.slice(0,r)),+e.toFixed(4)},d.$currentWorkSpace=()=>d.$workSpaces[d.$activeWorkSpaceId],d.$initializeEnd=()=>{d.$readStatus++,d.$readStatus===d.$readEnd&&(d.$saveProgress.end(),d.$addModalEvent(document),d.$currentWorkSpace().run())},d.$changeWorkSpace=e=>{d.$useIds.clear(),d.$symbols.clear(),d.$currentWorkSpace().stop(),d.$activeWorkSpaceId=0|e,d.$currentWorkSpace().run()},d.$unZlibWorker=new Worker(URL.createObjectURL(new Blob(['const zlibes=function(e){"use strict";const t=Object.freeze({UNCOMPRESSED:0,FIXED:1,DYNAMIC:2}),n=131072,r=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],a=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function f(e){const t=Object.keys(e);let n=0,r=0,i=Number.MAX_SAFE_INTEGER;t.forEach((e=>{n=Number(e),r<n&&(r=n),i>n&&(i=n)}));let s,o=0;const a={};for(let t=i;t<=r;t++){void 0===(s=e[t])&&(s=[]),s.sort(((e,t)=>e<t?-1:e>t?1:0));const n={};s.forEach((e=>{n[o]=e,o++})),a[t]=n,o<<=1}return a}function h(e,t=15){const n={};for(const t of e)n[t]?n[t]++:n[t]=1;const r=Object.keys(n);let i=[],s=0,o=[];if(1===r.length)o.push({count:n[0],simbles:[Number(r[0])]});else for(let e=0;e<t;e++){for(o=[],r.forEach((e=>{const t={count:n[Number(e)],simbles:[Number(e)]};o.push(t)})),s=0;s+2<=i.length;){const e={count:i[s].count+i[s+1].count,simbles:i[s].simbles.concat(i[s+1].simbles)};o.push(e),s+=2}(o=o.sort(((e,t)=>e.count<t.count?-1:e.count>t.count?1:0))).length%2!=0&&o.pop(),i=o}const a={};let f;o.forEach((e=>{e.simbles.forEach((e=>{a[e]?a[e]++:a[e]=1}))}));const h=Object.keys(a),d={};let u=0,c=3,l=Number.MAX_SAFE_INTEGER,w=0;h.forEach((e=>{c=a[Number(e)],d[c]||(d[c]=[],l>c&&(l=c),w<c&&(w=c)),d[c].push(Number(e))})),u=0;const g=new Map;for(let e=l;e<=w;e++)(f=d[e])&&(f=f.sort(((e,t)=>e<t?-1:e>t?1:0))).forEach((t=>{g.set(t,{code:u,bitlen:e}),u++})),u<<=1;return g}function d(e,t,n){let r=t;const o=t+n-3;let a=0,f=0,h=0,d=0,u=0,c=0,l=0;const w=[],g={},b={},R=function(e,t,n){const r=t+n-3,i={};for(let n=t;n<=r;n++){const t=e[n]<<16|e[n+1]<<8|e[n+2];void 0===i[t]&&(i[t]=[]),i[t].push(n)}return i}(e,t,n);for(;r<=o;){const t=e[r]<<16|e[r+1]<<8|e[r+2],n=R[t];if(void 0===n||n.length<=1){w.push([e[r]]),r++;continue}a=r>32768?r-32768:0,h=0,d=0;let E=g[t]||0;for(;n[E]<a;)E=E+1|0;for(g[t]=E,E=b[t]||0;n[E]<r;)E=E+1|0;b[t]=E;let p=0;e:for(let i=b[t]-1,s=g[t];s<=i&&!(p>=128||h>=8&&p>=16);i--){p++;const t=n[i];for(let n=h-1;0<n;n--)if(e[t+n]!==e[r+n])continue e;f=258;for(let n=h;n<=258;n++)if(e[t+n]!==e[r+n]){f=n;break}if(h<f&&(h=f,d=t,258<=f))break}if(h>=3&&r+h<=o){u=r-d;for(let e=0;e<i.length&&!(i[e]>h);e++)c=e;for(let e=0;e<s.length&&!(s[e]>u);e++)l=e;w.push([c,l,h,u]),r+=h}else w.push([e[r]]),r++}return w.push([e[r]]),w.push([e[r+1]]),w}class u{constructor(e,t=0,n=0){this.nowBitsIndex=0,this.isEnd=!1,this.buffer=e,this.bufferIndex=t,this.nowBits=e[t],this.nowBitsIndex=n}write(e){if(this.isEnd)throw new Error("Lack of data length");e<<=this.nowBitsIndex,this.nowBits+=e,this.nowBitsIndex++,this.nowBitsIndex>=8&&(this.buffer[this.bufferIndex]=this.nowBits,this.bufferIndex++,this.nowBits=0,this.nowBitsIndex=0,this.buffer.length<=this.bufferIndex&&(this.isEnd=!0))}writeRange(e,t){let n=1,r=0;for(let i=0;i<t;i++)r=e&n?1:0,this.write(r),n<<=1}writeRangeCoded(e,t){let n=1<<t-1,r=0;for(let i=0;i<t;i++)r=e&n?1:0,this.write(r),n>>>=1}}function c(e,t,n,f){const u=d(t,n,f),c=[256],l=[];let w=256,g=0;for(let e=0,t=u.length;e<t;e++){const t=u[e];let n=t[0];const r=t[1];void 0!==r&&(n+=257,l.push(r),g<r&&(g=r)),c.push(n),w<n&&(w=n)}const b=h(c),R=h(l),E=[];for(let e=0;e<=w;e++)b.has(e)?E.push(b.get(e).bitlen):E.push(0);const p=E.length;for(let e=0;e<=g;e++)R.has(e)?E.push(R.get(e).bitlen):E.push(0);const B=E.length-p,I=[],N=[];let m=0,x=0;for(let e=0;e<E.length;e++){for(m=E[e],x=1;m===E[e+1];)if(x++,e++,0===m){if(138<=x)break}else if(6<=x)break;if(4<=x)0===m?11<=x?I.push(18):I.push(17):(I.push(m),N.push(1),x--,I.push(16)),N.push(x);else for(let e=0;e<x;e++)I.push(m),N.push(1)}const A=h(I,7);let v,y=0;a.forEach(((e,t)=>{A.has(e)&&(y=t+1)})),e.writeRange(p-257,5),e.writeRange(B-1,5),e.writeRange(y-4,4);for(let t=0;t<y;t++)void 0!==(v=A.get(a[t]))?e.writeRange(v.bitlen,3):e.writeRange(0,3);I.forEach(((t,n)=>{if(void 0===(v=A.get(t)))throw new Error("Data is corrupted");e.writeRangeCoded(v.code,v.bitlen),18===t?e.writeRange(N[n]-11,7):17===t?e.writeRange(N[n]-3,3):16===t&&e.writeRange(N[n]-3,2)}));for(let t=0,n=u.length;t<n;t++){const n=u[t],a=n[0],f=n[1];if(void 0!==f){if(void 0===(v=b.get(a+257)))throw new Error("Data is corrupted");e.writeRangeCoded(v.code,v.bitlen),0<r[a]&&(x=n[2],e.writeRange(x-i[a],r[a]));const t=R.get(f);if(void 0===t)throw new Error("Data is corrupted");if(e.writeRangeCoded(t.code,t.bitlen),0<o[f]){const t=n[3];e.writeRange(t-s[f],o[f])}}else{if(void 0===(v=b.get(a)))throw new Error("Data is corrupted");e.writeRangeCoded(v.code,v.bitlen)}}if(void 0===(v=b.get(256)))throw new Error("Data is corrupted");e.writeRangeCoded(v.code,v.bitlen)}class l{constructor(e,t=0){this.nowBitsLength=0,this.isEnd=!1,this.buffer=e,this.bufferIndex=t,this.nowBits=e[t],this.nowBitsLength=8}read(){if(this.isEnd)throw new Error("Lack of data length");const e=1&this.nowBits;return this.nowBitsLength>1?(this.nowBitsLength--,this.nowBits>>=1):(this.bufferIndex++,this.bufferIndex<this.buffer.length?(this.nowBits=this.buffer[this.bufferIndex],this.nowBitsLength=8):(this.nowBitsLength=0,this.isEnd=!0)),e}readRange(e){for(;this.nowBitsLength<=e;)this.nowBits|=this.buffer[++this.bufferIndex]<<this.nowBitsLength,this.nowBitsLength+=8;const t=this.nowBits&(1<<e)-1;return this.nowBits>>>=e,this.nowBitsLength-=e,t}readRangeCoded(e){let t=0;for(let n=0;n<e;n++)t<<=1,t|=this.read();return t}}class w{constructor(e){this.index=0,this.buffer=new Uint8Array(e),this.length=e,this._extendedSize=e}write(e){if(this.length<=this.index){this.length+=this._extendedSize;const e=new Uint8Array(this.length),t=this.buffer.length;for(let n=0;n<t;n++)e[n]=this.buffer[n];this.buffer=e}this.buffer[this.index]=e,this.index++}}const g=f(function(){const e={7:[],8:[],9:[]};for(let t=0;t<=287;t++)t<=143?e[8].push(t):t<=255?e[9].push(t):t<=279?e[7].push(t):e[8].push(t);return e}());function b(e,t){e.nowBitsLength<8&&e.readRange(e.nowBitsLength);const n=e.readRange(8)|e.readRange(8)<<8;if(n+(e.readRange(8)|e.readRange(8)<<8)!==65535)throw new Error("Data is corrupted");for(let r=0;r<n;r++)t.write(e.readRange(8))}function R(e,t){const n=g,a=Object.keys(n);let f=0,h=0,d=Number.MAX_SAFE_INTEGER;a.forEach((e=>{f=Number(e),h<f&&(h=f),d>f&&(d=f)}));let u,c,l,w,b,R,E,p,B=0;for(;!e.isEnd;){for(u=void 0,f=d,B=e.readRangeCoded(d);void 0===(u=n[f][B]);){if(h<=f)throw new Error("Data is corrupted");f++,B<<=1,B|=e.read()}if(u<256)t.write(u);else{if(256===u)break;l=i[c=u-257],0<(w=r[c])&&(l+=e.readRange(w)),b=e.readRangeCoded(5),R=s[b],0<(E=o[b])&&(R+=e.readRange(E)),p=t.index-R;for(let e=0;e<l;e++)t.write(t.buffer[p+e])}}}function E(e,t){const n=e.readRange(5)+257,h=e.readRange(5)+1,d=e.readRange(4)+4;let u=0;const c={};for(let t=0;t<d;t++)0!==(u=e.readRange(3))&&(c[u]||(c[u]=[]),c[u].push(a[t]));const l=f(c),w=Object.keys(l);let g=0,b=Number.MAX_SAFE_INTEGER;w.forEach((e=>{u=Number(e),g<u&&(g=u),b>u&&(b=u)}));const R={},E={};let p,B=0,I=0,N=0;const m=n+h;for(let t=0;t<m;){for(p=void 0,u=b,B=e.readRangeCoded(b);void 0===(p=l[u][B]);){if(g<=u)throw new Error("Data is corrupted");u++,B<<=1,B|=e.read()}if(16===p?I=3+e.readRange(2):17===p?(I=3+e.readRange(3),N=0):18===p?(I=11+e.readRange(7),N=0):(I=1,N=p),N<=0)t+=I;else for(;I;)t<n?(R[N]||(R[N]=[]),R[N].push(t++)):(E[N]||(E[N]=[]),E[N].push(t++-n)),I--}const x=f(R),A=f(E),v=Object.keys(x);let y=0,C=0,D=Number.MAX_SAFE_INTEGER;v.forEach((e=>{y=Number(e),C<y&&(C=y),D>y&&(D=y)}));const k=Object.keys(A);let L=0,_=0,M=Number.MAX_SAFE_INTEGER;k.forEach((e=>{L=Number(e),_<L&&(_=L),M>L&&(M=L)}));let S,O,j,U,F,X,T,G,z,Y,P=0;for(;!e.isEnd;){for(S=void 0,y=D,P=e.readRangeCoded(D);void 0===(S=x[y][P]);){if(C<=y)throw new Error("Data is corrupted");y++,P<<=1,P|=e.read()}if(S<256)t.write(S);else{if(256===S)break;for(j=i[O=S-257],0<(U=r[O])&&(j+=e.readRange(U)),F=void 0,G=M,z=e.readRangeCoded(M);void 0===(F=A[G][z]);){if(_<=G)throw new Error("Data is corrupted");G++,z<<=1,z|=e.read()}X=s[F],0<(T=o[F])&&(X+=e.readRange(T)),Y=t.index-X;for(let e=0;e<j;e++)t.write(t.buffer[Y+e])}}}/**     * @license Copyright (c) 2018 zprodev     */return e.inflate=function(e){const n=new l(e);if(8!==n.readRange(4))throw new Error("Not compressed by deflate");return n.readRange(4),n.readRange(5),n.readRange(1),n.readRange(2),function(e,n=0){const r=new w(10*e.length),i=new l(e,n);let s=0,o=0;for(;1!==s;){if(s=i.readRange(1),(o=i.readRange(2))===t.UNCOMPRESSED)b(i,r);else if(o===t.FIXED)R(i,r);else{if(o!==t.DYNAMIC)throw new Error("Not supported BTYPE : "+o);E(i,r)}if(0===s&&i.isEnd)throw new Error("Data length is insufficient")}return r.buffer.subarray(0,r.index)}(e,2)},e.deflate=function(e){const r=function(e){const r=e.length,i=new u(new Uint8Array(r<n/2?n:2*r));let s=0,o=0;for(;s+n>=r?(o=r-s,i.writeRange(1,1)):(o=n,i.writeRange(0,1)),i.writeRange(t.DYNAMIC,2),c(i,e,s,o),!((s+=n)>=r););return 0!==i.nowBitsIndex&&i.writeRange(0,8-i.nowBitsIndex),i.buffer.subarray(0,i.bufferIndex)}(e),i=new u(new Uint8Array(1));i.writeRange(8,4),i.writeRange(7,4);const s=new u(new Uint8Array(1));s.writeRange(28,5),s.writeRange(0,1),s.writeRange(2,2);const o=new u(new Uint8Array(4)),a=function(e){let t=1,n=0;const r=e.length;for(let i=0;i<r;i++)n=((t=(t+e[i])%65521)+n)%65521;return(n<<16)+t}(e);o.writeRange(a>>>24,8),o.writeRange(a>>>16&255,8),o.writeRange(a>>>8&255,8),o.writeRange(255&a,8);const f=new Uint8Array(r.length+6);return f.set(i.buffer),f.set(s.buffer,1),f.set(r,2),f.set(o.buffer,f.length-4),f},e}({});this.addEventListener("message",(function(e){const t=zlibes.inflate(e.data.buffer);let n="";for(let e=0;e<t.length;e+=4096)n+=String.fromCharCode.apply(null,t.slice(e,e+4096));this.postMessage({json:n,name:e.data.name,type:e.data.type})}));'],{type:"text/javascript"}))),d.$unZlibWorker.onmessage=e=>{if("n2d"===e.data.type){d.$saveProgress.loadN2D();const t=new z(decodeURIComponent(e.data.json));t.name=e.data.name,d.$workSpaces.push(t),d.$screenTab.createElement(t,d.$workSpaces.length-1),d.$saveProgress.end()}else{d.$saveProgress.loadJson();const t=JSON.parse(decodeURIComponent(e.data.json));for(let e=0;e<t.length;++e)d.$workSpaces.push(new z(t[e]));d.$workSpaces.length||d.$workSpaces.push(new z),d.$screenTab.run(),d.$initializeEnd()}},d.$zlibWorker=new Worker(URL.createObjectURL(new Blob(['const zlibes=function(e){"use strict";const t=Object.freeze({UNCOMPRESSED:0,FIXED:1,DYNAMIC:2}),n=131072,r=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],i=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function a(e){const t=Object.keys(e);let n=0,r=0,s=Number.MAX_SAFE_INTEGER;t.forEach((e=>{n=Number(e),r<n&&(r=n),s>n&&(s=n)}));let i,o=0;const f={};for(let t=s;t<=r;t++){void 0===(i=e[t])&&(i=[]),i.sort(((e,t)=>e<t?-1:e>t?1:0));const n={};i.forEach((e=>{n[o]=e,o++})),f[t]=n,o<<=1}return f}function h(e,t=15){const n={};for(const t of e)n[t]?n[t]++:n[t]=1;const r=Object.keys(n);let s=[],i=0,o=[];if(1===r.length)o.push({count:n[0],simbles:[Number(r[0])]});else for(let e=0;e<t;e++){for(o=[],r.forEach((e=>{const t={count:n[Number(e)],simbles:[Number(e)]};o.push(t)})),i=0;i+2<=s.length;){const e={count:s[i].count+s[i+1].count,simbles:s[i].simbles.concat(s[i+1].simbles)};o.push(e),i+=2}(o=o.sort(((e,t)=>e.count<t.count?-1:e.count>t.count?1:0))).length%2!=0&&o.pop(),s=o}const f={};let a;o.forEach((e=>{e.simbles.forEach((e=>{f[e]?f[e]++:f[e]=1}))}));const h=Object.keys(f),d={};let u=0,c=3,l=Number.MAX_SAFE_INTEGER,w=0;h.forEach((e=>{c=f[Number(e)],d[c]||(d[c]=[],l>c&&(l=c),w<c&&(w=c)),d[c].push(Number(e))})),u=0;const g=new Map;for(let e=l;e<=w;e++)(a=d[e])&&(a=a.sort(((e,t)=>e<t?-1:e>t?1:0))).forEach((t=>{g.set(t,{code:u,bitlen:e}),u++})),u<<=1;return g}function d(e,t,n){let r=t;const o=t+n-3;let f=0,a=0,h=0,d=0,u=0,c=0,l=0;const w=[],g={},b={},R=function(e,t,n){const r=t+n-3,s={};for(let n=t;n<=r;n++){const t=e[n]<<16|e[n+1]<<8|e[n+2];void 0===s[t]&&(s[t]=[]),s[t].push(n)}return s}(e,t,n);for(;r<=o;){const t=e[r]<<16|e[r+1]<<8|e[r+2],n=R[t];if(void 0===n||n.length<=1){w.push([e[r]]),r++;continue}f=r>32768?r-32768:0,h=0,d=0;let E=g[t]||0;for(;n[E]<f;)E=E+1|0;for(g[t]=E,E=b[t]||0;n[E]<r;)E=E+1|0;b[t]=E;let p=0;e:for(let s=b[t]-1,i=g[t];i<=s&&!(p>=128||h>=8&&p>=16);s--){p++;const t=n[s];for(let n=h-1;0<n;n--)if(e[t+n]!==e[r+n])continue e;a=258;for(let n=h;n<=258;n++)if(e[t+n]!==e[r+n]){a=n;break}if(h<a&&(h=a,d=t,258<=a))break}if(h>=3&&r+h<=o){u=r-d;for(let e=0;e<s.length&&!(s[e]>h);e++)c=e;for(let e=0;e<i.length&&!(i[e]>u);e++)l=e;w.push([c,l,h,u]),r+=h}else w.push([e[r]]),r++}return w.push([e[r]]),w.push([e[r+1]]),w}class u{constructor(e,t=0,n=0){this.nowBitsIndex=0,this.isEnd=!1,this.buffer=e,this.bufferIndex=t,this.nowBits=e[t],this.nowBitsIndex=n}write(e){if(this.isEnd)throw new Error("Lack of data length");e<<=this.nowBitsIndex,this.nowBits+=e,this.nowBitsIndex++,this.nowBitsIndex>=8&&(this.buffer[this.bufferIndex]=this.nowBits,this.bufferIndex++,this.nowBits=0,this.nowBitsIndex=0,this.buffer.length<=this.bufferIndex&&(this.isEnd=!0))}writeRange(e,t){let n=1,r=0;for(let s=0;s<t;s++)r=e&n?1:0,this.write(r),n<<=1}writeRangeCoded(e,t){let n=1<<t-1,r=0;for(let s=0;s<t;s++)r=e&n?1:0,this.write(r),n>>>=1}}function c(e,t,n,a){const u=d(t,n,a),c=[256],l=[];let w=256,g=0;for(let e=0,t=u.length;e<t;e++){const t=u[e];let n=t[0];const r=t[1];void 0!==r&&(n+=257,l.push(r),g<r&&(g=r)),c.push(n),w<n&&(w=n)}const b=h(c),R=h(l),E=[];for(let e=0;e<=w;e++)b.has(e)?E.push(b.get(e).bitlen):E.push(0);const p=E.length;for(let e=0;e<=g;e++)R.has(e)?E.push(R.get(e).bitlen):E.push(0);const B=E.length-p,I=[],N=[];let x=0,m=0;for(let e=0;e<E.length;e++){for(x=E[e],m=1;x===E[e+1];)if(m++,e++,0===x){if(138<=m)break}else if(6<=m)break;if(4<=m)0===x?11<=m?I.push(18):I.push(17):(I.push(x),N.push(1),m--,I.push(16)),N.push(m);else for(let e=0;e<m;e++)I.push(x),N.push(1)}const A=h(I,7);let y,v=0;f.forEach(((e,t)=>{A.has(e)&&(v=t+1)})),e.writeRange(p-257,5),e.writeRange(B-1,5),e.writeRange(v-4,4);for(let t=0;t<v;t++)void 0!==(y=A.get(f[t]))?e.writeRange(y.bitlen,3):e.writeRange(0,3);I.forEach(((t,n)=>{if(void 0===(y=A.get(t)))throw new Error("Data is corrupted");e.writeRangeCoded(y.code,y.bitlen),18===t?e.writeRange(N[n]-11,7):17===t?e.writeRange(N[n]-3,3):16===t&&e.writeRange(N[n]-3,2)}));for(let t=0,n=u.length;t<n;t++){const n=u[t],f=n[0],a=n[1];if(void 0!==a){if(void 0===(y=b.get(f+257)))throw new Error("Data is corrupted");e.writeRangeCoded(y.code,y.bitlen),0<r[f]&&(m=n[2],e.writeRange(m-s[f],r[f]));const t=R.get(a);if(void 0===t)throw new Error("Data is corrupted");if(e.writeRangeCoded(t.code,t.bitlen),0<o[a]){const t=n[3];e.writeRange(t-i[a],o[a])}}else{if(void 0===(y=b.get(f)))throw new Error("Data is corrupted");e.writeRangeCoded(y.code,y.bitlen)}}if(void 0===(y=b.get(256)))throw new Error("Data is corrupted");e.writeRangeCoded(y.code,y.bitlen)}class l{constructor(e,t=0){this.nowBitsLength=0,this.isEnd=!1,this.buffer=e,this.bufferIndex=t,this.nowBits=e[t],this.nowBitsLength=8}read(){if(this.isEnd)throw new Error("Lack of data length");const e=1&this.nowBits;return this.nowBitsLength>1?(this.nowBitsLength--,this.nowBits>>=1):(this.bufferIndex++,this.bufferIndex<this.buffer.length?(this.nowBits=this.buffer[this.bufferIndex],this.nowBitsLength=8):(this.nowBitsLength=0,this.isEnd=!0)),e}readRange(e){for(;this.nowBitsLength<=e;)this.nowBits|=this.buffer[++this.bufferIndex]<<this.nowBitsLength,this.nowBitsLength+=8;const t=this.nowBits&(1<<e)-1;return this.nowBits>>>=e,this.nowBitsLength-=e,t}readRangeCoded(e){let t=0;for(let n=0;n<e;n++)t<<=1,t|=this.read();return t}}class w{constructor(e){this.index=0,this.buffer=new Uint8Array(e),this.length=e,this._extendedSize=e}write(e){if(this.length<=this.index){this.length+=this._extendedSize;const e=new Uint8Array(this.length),t=this.buffer.length;for(let n=0;n<t;n++)e[n]=this.buffer[n];this.buffer=e}this.buffer[this.index]=e,this.index++}}const g=a(function(){const e={7:[],8:[],9:[]};for(let t=0;t<=287;t++)t<=143?e[8].push(t):t<=255?e[9].push(t):t<=279?e[7].push(t):e[8].push(t);return e}());function b(e,t){e.nowBitsLength<8&&e.readRange(e.nowBitsLength);const n=e.readRange(8)|e.readRange(8)<<8;if(n+(e.readRange(8)|e.readRange(8)<<8)!==65535)throw new Error("Data is corrupted");for(let r=0;r<n;r++)t.write(e.readRange(8))}function R(e,t){const n=g,f=Object.keys(n);let a=0,h=0,d=Number.MAX_SAFE_INTEGER;f.forEach((e=>{a=Number(e),h<a&&(h=a),d>a&&(d=a)}));let u,c,l,w,b,R,E,p,B=0;for(;!e.isEnd;){for(u=void 0,a=d,B=e.readRangeCoded(d);void 0===(u=n[a][B]);){if(h<=a)throw new Error("Data is corrupted");a++,B<<=1,B|=e.read()}if(u<256)t.write(u);else{if(256===u)break;l=s[c=u-257],0<(w=r[c])&&(l+=e.readRange(w)),b=e.readRangeCoded(5),R=i[b],0<(E=o[b])&&(R+=e.readRange(E)),p=t.index-R;for(let e=0;e<l;e++)t.write(t.buffer[p+e])}}}function E(e,t){const n=e.readRange(5)+257,h=e.readRange(5)+1,d=e.readRange(4)+4;let u=0;const c={};for(let t=0;t<d;t++)0!==(u=e.readRange(3))&&(c[u]||(c[u]=[]),c[u].push(f[t]));const l=a(c),w=Object.keys(l);let g=0,b=Number.MAX_SAFE_INTEGER;w.forEach((e=>{u=Number(e),g<u&&(g=u),b>u&&(b=u)}));const R={},E={};let p,B=0,I=0,N=0;const x=n+h;for(let t=0;t<x;){for(p=void 0,u=b,B=e.readRangeCoded(b);void 0===(p=l[u][B]);){if(g<=u)throw new Error("Data is corrupted");u++,B<<=1,B|=e.read()}if(16===p?I=3+e.readRange(2):17===p?(I=3+e.readRange(3),N=0):18===p?(I=11+e.readRange(7),N=0):(I=1,N=p),N<=0)t+=I;else for(;I;)t<n?(R[N]||(R[N]=[]),R[N].push(t++)):(E[N]||(E[N]=[]),E[N].push(t++-n)),I--}const m=a(R),A=a(E),y=Object.keys(m);let v=0,C=0,D=Number.MAX_SAFE_INTEGER;y.forEach((e=>{v=Number(e),C<v&&(C=v),D>v&&(D=v)}));const k=Object.keys(A);let L=0,M=0,_=Number.MAX_SAFE_INTEGER;k.forEach((e=>{L=Number(e),M<L&&(M=L),_>L&&(_=L)}));let S,j,O,U,F,X,z,T,G,Y,P=0;for(;!e.isEnd;){for(S=void 0,v=D,P=e.readRangeCoded(D);void 0===(S=m[v][P]);){if(C<=v)throw new Error("Data is corrupted");v++,P<<=1,P|=e.read()}if(S<256)t.write(S);else{if(256===S)break;for(O=s[j=S-257],0<(U=r[j])&&(O+=e.readRange(U)),F=void 0,T=_,G=e.readRangeCoded(_);void 0===(F=A[T][G]);){if(M<=T)throw new Error("Data is corrupted");T++,G<<=1,G|=e.read()}X=i[F],0<(z=o[F])&&(X+=e.readRange(z)),Y=t.index-X;for(let e=0;e<O;e++)t.write(t.buffer[Y+e])}}}/**     * @license Copyright (c) 2018 zprodev     */return e.inflate=function(e){const n=new l(e);if(8!==n.readRange(4))throw new Error("Not compressed by deflate");return n.readRange(4),n.readRange(5),n.readRange(1),n.readRange(2),function(e,n=0){const r=new w(10*e.length),s=new l(e,n);let i=0,o=0;for(;1!==i;){if(i=s.readRange(1),(o=s.readRange(2))===t.UNCOMPRESSED)b(s,r);else if(o===t.FIXED)R(s,r);else{if(o!==t.DYNAMIC)throw new Error("Not supported BTYPE : "+o);E(s,r)}if(0===i&&s.isEnd)throw new Error("Data length is insufficient")}return r.buffer.subarray(0,r.index)}(e,2)},e.deflate=function(e){const r=function(e){const r=e.length,s=new u(new Uint8Array(r<n/2?n:2*r));let i=0,o=0;for(;i+n>=r?(o=r-i,s.writeRange(1,1)):(o=n,s.writeRange(0,1)),s.writeRange(t.DYNAMIC,2),c(s,e,i,o),!((i+=n)>=r););return 0!==s.nowBitsIndex&&s.writeRange(0,8-s.nowBitsIndex),s.buffer.subarray(0,s.bufferIndex)}(e),s=new u(new Uint8Array(1));s.writeRange(8,4),s.writeRange(7,4);const i=new u(new Uint8Array(1));i.writeRange(28,5),i.writeRange(0,1),i.writeRange(2,2);const o=new u(new Uint8Array(4)),f=function(e){let t=1,n=0;const r=e.length;for(let s=0;s<r;s++)n=((t=(t+e[s])%65521)+n)%65521;return(n<<16)+t}(e);o.writeRange(f>>>24,8),o.writeRange(f>>>16&255,8),o.writeRange(f>>>8&255,8),o.writeRange(255&f,8);const a=new Uint8Array(r.length+6);return a.set(s.buffer),a.set(i.buffer,1),a.set(r,2),a.set(o.buffer,a.length-4),a},e}({});this.addEventListener("message",(function(e){const t=encodeURIComponent(e.data.object),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t[e].charCodeAt(0);const r=e.data.type;if("json"===r)this.postMessage({json:JSON.stringify({buffer:Array.from(zlibes.deflate(n)),type:"zlib"}),type:r});else{const e=zlibes.deflate(n);this.postMessage({buffer:e,type:r},[e.buffer])}}));'],{type:"text/javascript"}))),d.$zlibWorker.onmessage=e=>{const t=e.data.type;switch(t){case"json":case"n2d":d.$saveProgress.createFile(),setTimeout((()=>{const r=document.getElementById("save-anchor");r.href&&URL.revokeObjectURL(r.href),r.download=`${d.$currentWorkSpace().name}.${t}`,r.href="json"===t?URL.createObjectURL(new Blob([e.data.json],{type:"application/json"})):URL.createObjectURL(new Blob([e.data.buffer],{type:"text/plain"})),r.click(),d.$saveProgress.end()}),200);break;case"local":{const t=e.data.buffer;new Promise((e=>{window.requestAnimationFrame((()=>{d.$saveProgress.createBinary();let r="";for(let e=0;e<t.length;e+=4096)r+=String.fromCharCode.apply(null,t.slice(e,e+4096));e(r)}))})).then((e=>{d.$saveProgress.launchDatabase(90);d.$launchDB().onsuccess=t=>{const r=t.target.result.transaction(`${d.DATABASE_NAME}`,"readwrite");r.objectStore(`${d.DATABASE_NAME}`).put(e,d.STORE_KEY),r.oncomplete=e=>{e.target.db.close(),d.$updated=!1,d.$saveProgress.end()},d.$saveProgress.commit(),r.commit()}}))}}d.$zlibQueues.length?d.$zlibWorker.postMessage(d.$zlibQueues.pop()):d.$zlibWorkerActive=!1},d.$zlibQueues=[],d.$zlibWorkerActive=!1,d.$unzipURL=URL.createObjectURL(new Blob(['const Util={};Util.$Uint8Array=Uint8Array,Util.$Uint16Array=Uint16Array,Util.$Int16Array=Int16Array,Util.$ArrayBuffer=ArrayBuffer,Util.$max=Math.max,Util.$min=Math.min,Util.$potArrayBuffers=new Map,Util.$codeTables=[],Util.$getCodeTable=function(t,e){const i=Util.$codeTables.pop()||{key:null,value:null};return i.key=t,i.value=e,i},Util.$poolCodeTable=function(t){Util.$codeTables.push(t)},Util.$poolTypedArrayBuffer=function(t){const e=t.buffer,i=e.byteLength;if(!i||i!==Util.$upperPowerOfTwo(i))return;let r=Util.$potArrayBuffers.get(i);r||(r=[],Util.$potArrayBuffers.set(i,r)),r.push(e)},Util.$upperPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},Util.$getUint8Array=function(t){let e;const i=Util.$upperPowerOfTwo(t),r=Util.$potArrayBuffers.get(i),l=r&&r.pop();return l?(e=new Util.$Uint8Array(l,0,t),e.fill(0)):e=new Util.$Uint8Array(new Util.$ArrayBuffer(i),0,t),e},Util.$getUint16Array=function(t){let e;const i=Util.$upperPowerOfTwo(2*t),r=Util.$potArrayBuffers.get(i),l=r&&r.pop();return l?(e=new Util.$Uint16Array(l,0,t),e.fill(0)):e=new Util.$Uint16Array(new Util.$ArrayBuffer(i),0,t),e},Util.$fixedDistTable={key:new Util.$Uint16Array([5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5]),value:new Util.$Uint16Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31])},Util.$fixedLitTable={key:new Util.$Uint16Array([7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9]),value:new Util.$Uint16Array([256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,280,281,282,283,284,285,286,287,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255])},Util.$ORDER=new Util.$Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Util.$LEXT=new Util.$Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99]),Util.$LENS=new Util.$Int16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Util.$DEXT=new Util.$Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Util.$DISTS=new Util.$Int16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]);class ByteStream{constructor(){this.initialization()}initialization(){this.data=null,this.bit_offset=0,this.byte_offset=0,this.bit_buffer=null}byteAlign(){this.bit_offset&&(this.byte_offset=this.byte_offset+(this.bit_offset+7)/8|0,this.bit_offset=0)}getData(t){this.byteAlign();const e=this.byte_offset+t,i=this.data.slice(this.byte_offset,e);return this.byte_offset=e,i}setOffset(t,e){this.byte_offset=t,this.bit_offset=e}unzip(t,e=0){let i=e;const r=Util.$getUint8Array(19);let l=null,a=null;for(;;){const e=this.readUB(1),s=this.readUB(2);if(l&&(Util.$poolCodeTable(l),Util.$poolCodeTable(a)),l=null,a=null,s){if(1===s)l=Util.$fixedDistTable,a=Util.$fixedLitTable;else{const t=this.readUB(5)+257,e=this.readUB(5)+1,i=this.readUB(4)+4;for(let t=0;t<i;++t)r[Util.$ORDER[t]]=this.readUB(3);const s=this.buildHuffTable(r);r.fill(0);const f=t+e|0,o=Util.$getUint8Array(f);let n=0;for(let t=0;t<f;){const e=this.decodeSymbol(s.key,s.value);switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:o[t++]=e,n=e;break;case 16:{let e=this.readUB(2)+3|0;for(;e;)--e,o[t++]=n}break;case 17:{let e=this.readUB(3)+3|0;for(;e;)--e,o[t++]=0}break;case 18:{let e=this.readUB(7)+11|0;for(;e;)--e,o[t++]=0}}}Util.$poolCodeTable(s),l=this.buildHuffTable(o.subarray(t)),a=this.buildHuffTable(o.subarray(0,t)),Util.$poolTypedArrayBuffer(o),Util.$poolTypedArrayBuffer(s.key),Util.$poolTypedArrayBuffer(s.value)}for(;;){const e=0|this.decodeSymbol(a.key,a.value);if(256===e)break;if(e<256)t[i++]=e;else{const r=e-257|0;let a=Util.$LENS[r]+this.readUB(Util.$LEXT[r])|0;const s=this.decodeSymbol(l.key,l.value);let f=i-(Util.$DISTS[s]+this.readUB(Util.$DEXT[s])|0)|0;for(;a;)--a,t[i++]=t[f++]}}}else{this.bit_offset=8,this.bit_buffer=null;const e=0|this.readNumber(2);this.byte_offset+=2;for(let r=0;r<e;++r)t[i++]=this.readNumber(1)}if(e)break}Util.$poolTypedArrayBuffer(r)}buildHuffTable(t){const e=t.length,i=Util.$max.apply(null,t),r=Util.$getUint8Array(i),l=Util.$getUint16Array(i+1);let a=0,s=0,f=e;for(;f;)s=t[--f],s&&++r[s];let o=0;for(let t=0;t<i;)a=a+r[t++]<<1,l[t]=a,o=Util.$max(o,a);const n=o+e,U=Util.$getUint16Array(n),u=Util.$getUint16Array(n);for(let i=0;i<e;++i)if(s=t[i],s){const t=l[s];U[t]=s,u[t]=i,l[s]=t+1|0}return Util.$poolTypedArrayBuffer(r),Util.$poolTypedArrayBuffer(l),Util.$getCodeTable(U,u)}decodeSymbol(t,e){let i=0,r=0;for(;;)if(i=i<<1|this.readUB(1),++r,t[i]===r)return e[i]}readUB(t){let e=0;for(let i=0;i<t;++i)8===this.bit_offset&&(this.bit_buffer=this.readNumber(1),this.bit_offset=0),e|=(this.bit_buffer&1<<this.bit_offset++?1:0)<<i;return e}readNumber(t){let e=0;const i=this.byte_offset;let r=i+t|0;for(;r>i;)e=e<<8|this.data[--r];return this.byte_offset+=t,e}}Util.$byteStream=new ByteStream,Util.$lossless=function(t,e,i,r,l,a){const s=new Util.$Uint8Array(e*i*4);if(3===r){const r=(e+3&-4)-e;let f=0;if(a){let a=4*l;for(let l=0;l<i;++l){for(let i=0;i<e;++i){const e=4*t[a++],i=t[e+3];if(0===i){s[f++]=0,s[f++]=0,s[f++]=0,s[f++]=0;continue}const r=t[e],l=t[e+1],o=t[e+2];255!==i?(s[f++]=255&Util.$min(r/i*255,255),s[f++]=255&Util.$min(l/i*255,255),s[f++]=255&Util.$min(o/i*255,255),s[f++]=i):(s[f++]=r,s[f++]=l,s[f++]=o,s[f++]=i)}a+=r}return s}let o=3*l;for(let l=0;l<i;++l){for(let i=0;i<e;++i){const e=3*t[o++];s[f++]=t[e],s[f++]=t[e+1],s[f++]=t[e+2],s[f++]=255}o+=r}return s}const f=e*i;if(a){for(let e=0;e<f;++e){const i=4*e,r=i,l=i+1,a=i+2,f=i+3,o=t[r];0!==o?255!==o?(s[r]=255&Util.$min(t[l]/o*255,255),s[l]=255&Util.$min(t[a]/o*255,255),s[a]=255&Util.$min(t[f]/o*255,255),s[f]=o):(s[r]=t[l],s[l]=t[a],s[a]=t[f],s[f]=o):(s[r]=0,s[l]=0,s[a]=0,s[f]=0)}return s}for(let e=0;e<f;++e){const i=4*e,r=i+1,l=i+2,a=i+3;s[i]=t[r],s[r]=t[l],s[l]=t[a],s[a]=255}return s},this.addEventListener("message",(function(t){const e=Util.$byteStream;switch(t.data.mode){case"swf":{e.data=t.data.buffer;const i=t.data.fileSize,r=new Util.$Uint8Array(i),l=e.getData(8);e.setOffset(10,8),r.set(l,0),e.unzip(r,8),this.postMessage({buffer:r,mode:t.data.mode},[r.buffer])}break;case"lossless":{const i=t.data,r=new Util.$Uint8Array(i.fileSize);e.data=t.data.buffer,e.setOffset(2,8),e.unzip(r,0);const l=Util.$lossless(r,i.width,i.height,i.format,i.tableSize,i.isAlpha);this.postMessage({buffer:l,mode:t.data.mode},[l.buffer])}break;case"jpegAlpha":{const i=t.data.width*t.data.height,r=new Util.$Uint8Array(i);e.data=t.data.alphaData,e.setOffset(2,8),e.unzip(r,0),t.data.alphaData=r,this.postMessage(t.data,[t.data.buffer.buffer,t.data.alphaData.buffer])}}Util.$byteStream.initialization()}));'],{type:"text/javascript"})),d.$unzipWorker=null,d.$unzipQueues=[],d.$unzipWorkerActive=!1,d.$launchDB=()=>{const e=indexedDB.open(`${d.PREFIX}@${d.DATABASE_NAME}`);return e.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(`${d.DATABASE_NAME}`)||t.createObjectStore(`${d.DATABASE_NAME}`)},e},d.$unzipHandler=function(e){const t=e.target;switch(t.onmessage=null,e.data.mode){case"swf":this._$byteStream._$buffer=e.data.buffer,this.parseAndBuild();break;case"lossless":{const t=d.$currentWorkSpace().getLibrary(this.libraryId);t._$buffer=e.data.buffer,t._$command=null}break;case"jpegAlpha":{const t=e.data.buffer,r=e.data.alphaData;let a=0;for(let e=0;e<t.length;e+=4)t[e+3]=r[a++];const s=d.$currentWorkSpace().getLibrary(this.libraryId);s._$buffer=t,s._$command=null}}if(d.$unzipQueues.length){const e=d.$unzipQueues.shift();switch(t.onmessage=d.$unzipHandler.bind(e),e.mode){case"swf":{const r=e._$byteStream._$buffer;t.postMessage({fileSize:e.fileSize,mode:e.mode,buffer:r},[r.buffer])}break;case"lossless":t.postMessage(e,[e.buffer.buffer]);break;case"jpegAlpha":t.postMessage(e,[e.buffer.buffer,e.alphaData.buffer])}}else d.$unzipWorkerActive=!1},d.$unlzmaWorkerURL=URL.createObjectURL(new Blob(['const LZMA={init:function(e){const t=[];t.push(e[12],e[13],e[14],e[15],e[16],e[4],e[5],e[6],e[7]);let s=8;for(let e=5;e<9;++e){if(t[e]>=s){t[e]=t[e]-s|0;break}t[e]=256+t[e]-s|0,s=1}return t.push(0,0,0,0),e.set(t,4),e.subarray(4)},reverseDecode2:function(e,t,s,i){let r=1,o=0,d=0;for(;d<i;++d){const i=s.decodeBit(e,t+r);r=r<<1|i,o|=i<<d}return o},decompress:function(e,t){const s=new Decoder,i=s.decodeHeader(e),r=i.uncompressedSize;if(s.setProperties(i),!s.decodeBody(e,t,r))throw new Error("Error in lzma data stream");return t}};class OutWindow{constructor(){this._buffer=null,this._stream=null,this._pos=0,this._streamPos=0,this._windowSize=0}create(e){this._buffer&&this._windowSize===e||(this._buffer=new Uint8Array(e)),this._windowSize=e}flush(){const e=this._pos-this._streamPos;e&&(this._stream.writeBytes(this._buffer,e),this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos)}releaseStream(){this.flush(),this._stream=null}setStream(e){this._stream=e}init(e=!1){e||(this._streamPos=0,this._pos=0)}copyBlock(e,t){let s=this._pos-e-1;for(s<0&&(s+=this._windowSize);t--;)s>=this._windowSize&&(s=0),this._buffer[this._pos++]=this._buffer[s++],this._pos>=this._windowSize&&this.flush()}putByte(e){this._buffer[this._pos++]=e,this._pos>=this._windowSize&&this.flush()}getByte(e){let t=this._pos-e-1;return t<0&&(t+=this._windowSize),this._buffer[t]}}class RangeDecoder{constructor(){this._stream=null,this._code=0,this._range=-1}setStream(e){this._stream=e}releaseStream(){this._stream=null}init(){let e=5;for(this._code=0,this._range=-1;e--;)this._code=this._code<<8|this._stream.readByte()}decodeDirectBits(e){let t=0,s=e;for(;s--;){this._range>>>=1;const e=this._code-this._range>>>31;this._code-=this._range&e-1,t=t<<1|1-e,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8)}return t}decodeBit(e,t){const s=e[t],i=(this._range>>>11)*s;return(2147483648^this._code)<(2147483648^i)?(this._range=i,e[t]+=2048-s>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=i,this._code-=i,e[t]-=s>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)}}class BitTreeDecoder{constructor(e){this._models=Array(1<<e).fill(1024),this._numBitLevels=e}decode(e){let t=1,s=this._numBitLevels;for(;s--;)t=t<<1|e.decodeBit(this._models,t);return t-(1<<this._numBitLevels)}reverseDecode(e){let t=1,s=0,i=0;for(;i<this._numBitLevels;++i){const r=e.decodeBit(this._models,t);t=t<<1|r,s|=r<<i}return s}}class LenDecoder{constructor(){this._choice=[1024,1024],this._lowCoder=[],this._midCoder=[],this._highCoder=new BitTreeDecoder(8),this._numPosStates=0}create(e){for(;this._numPosStates<e;++this._numPosStates)this._lowCoder[this._numPosStates]=new BitTreeDecoder(3),this._midCoder[this._numPosStates]=new BitTreeDecoder(3)}decode(e,t){return 0===e.decodeBit(this._choice,0)?this._lowCoder[t].decode(e):0===e.decodeBit(this._choice,1)?8+this._midCoder[t].decode(e):16+this._highCoder.decode(e)}}class Decoder2{constructor(){this._decoders=Array(768).fill(1024)}decodeNormal(e){let t=1;do{t=t<<1|e.decodeBit(this._decoders,t)}while(t<256);return 255&t}decodeWithMatchByte(e,t){let s=1;do{const i=t>>7&1;t<<=1;const r=e.decodeBit(this._decoders,(1+i<<8)+s);if(s=s<<1|r,i!==r){for(;s<256;)s=s<<1|e.decodeBit(this._decoders,s);break}}while(s<256);return 255&s}}class LiteralDecoder{create(e,t){if(this._coders&&this._numPrevBits===t&&this._numPosBits===e)return;this._numPosBits=e,this._posMask=(1<<e)-1,this._numPrevBits=t,this._coders=[];let s=1<<this._numPrevBits+this._numPosBits;for(;s--;)this._coders[s]=new Decoder2}getDecoder(e,t){return this._coders[((e&this._posMask)<<this._numPrevBits)+((255&t)>>>8-this._numPrevBits)]}}class Decoder{constructor(){this._outWindow=new OutWindow,this._rangeDecoder=new RangeDecoder,this._isMatchDecoders=Array(192).fill(1024),this._isRepDecoders=Array(12).fill(1024),this._isRepG0Decoders=Array(12).fill(1024),this._isRepG1Decoders=Array(12).fill(1024),this._isRepG2Decoders=Array(12).fill(1024),this._isRep0LongDecoders=Array(192).fill(1024),this._posDecoders=Array(114).fill(1024),this._posAlignDecoder=new BitTreeDecoder(4),this._lenDecoder=new LenDecoder,this._repLenDecoder=new LenDecoder,this._literalDecoder=new LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder=[new BitTreeDecoder(6),new BitTreeDecoder(6),new BitTreeDecoder(6),new BitTreeDecoder(6)]}setDictionarySize(e){return!(e<0)&&(this._dictionarySize!==e&&(this._dictionarySize=e,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)}setLcLpPb(e,t,s){if(e>8||t>4||s>4)return!1;const i=1<<s;return this._literalDecoder.create(t,e),this._lenDecoder.create(i),this._repLenDecoder.create(i),this._posStateMask=i-1,!0}setProperties(e){if(!this.setLcLpPb(e.lc,e.lp,e.pb))throw Error("Incorrect stream properties");if(!this.setDictionarySize(e.dictionarySize))throw Error("Invalid dictionary size")}decodeHeader(e){if(e._$size<13)return!1;let t=e.readByte();const s=t%9;t=~~(t/9);const i=t%5,r=~~(t/5);let o=e.readByte();o|=e.readByte()<<8,o|=e.readByte()<<16,o+=16777216*e.readByte();let d=e.readByte();return d|=e.readByte()<<8,d|=e.readByte()<<16,d+=16777216*e.readByte(),e.readByte(),e.readByte(),e.readByte(),e.readByte(),{lc:s,lp:i,pb:r,dictionarySize:o,uncompressedSize:d}}decodeBody(e,t,s){let i,r,o=0,d=0,h=0,c=0,n=0,_=0,a=0;for(this._rangeDecoder.setStream(e),this._rangeDecoder.init(),this._outWindow.setStream(t),this._outWindow.init(!1);_<s;){const e=_&this._posStateMask;if(0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(o<<4)+e)){const e=this._literalDecoder.getDecoder(_++,a);a=o>=7?e.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(d)):e.decodeNormal(this._rangeDecoder),this._outWindow.putByte(a),o=o<4?0:o-(o<10?3:6)}else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,o))i=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,o)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(o<<4)+e)&&(o=o<7?9:11,i=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,o)?r=h:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,o)?r=c:(r=n,n=c),c=h),h=d,d=r),0===i&&(i=2+this._repLenDecoder.decode(this._rangeDecoder,e),o=o<7?8:11);else{n=c,c=h,h=d,i=2+this._lenDecoder.decode(this._rangeDecoder,e),o=o<7?7:10;const t=this._posSlotDecoder[i<=5?i-2:3].decode(this._rangeDecoder);if(t>=4){const e=(t>>1)-1;if(d=(2|1&t)<<e,t<14)d+=LZMA.reverseDecode2(this._posDecoders,d-t-1,this._rangeDecoder,e);else if(d+=this._rangeDecoder.decodeDirectBits(e-4)<<4,d+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),d<0){if(-1===d)break;return!1}}else d=t}if(d>=_||d>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(d,i),_+=i,a=this._outWindow.getByte(0)}}return this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0}}class InStream{constructor(e){this._$data=e,this._$size=e.length,this._$offset=0}readByte(){return this._$data[this._$offset++]}}class OutStream{constructor(e){this.size=8,this.buffers=e}writeBytes(e,t){e.length===t?this.buffers.set(e,this.size):this.buffers.set(e.subarray(0,t),this.size),this.size+=t}}this.addEventListener("message",(function(e){const t=e.data.fileSize,s=e.data.buffer,i=new Uint8Array(t+8);i.set(s.slice(0,8),0),LZMA.decompress(new InStream(LZMA.init(s)),new OutStream(i)),this.postMessage(i,[i.buffer]),this.close()}));'],{type:"text/javascript"})),d.$unlzmaQueues=[],d.$unlzmaWorkerActive=!1,d.$parserURL=URL.createObjectURL(new Blob(['const Util={$tagObjects:[]};Util.$installed=new Map,Util.$swfParser=null,Util.$Rad2Deg=180/Math.PI,Util.$JCT11280=Function(\'var a="zKV33~jZ4zN=~ji36XazM93y!{~k2y!o~k0ZlW6zN?3Wz3W?{EKzK[33[`y|;-~j^YOTz$!~kNy|L1$353~jV3zKk3~k-4P4zK_2+~jY4y!xYHR~jlz$_~jk4z$e3X5He<0y!wy|X3[:~l|VU[F3VZ056Hy!nz/m1XD61+1XY1E1=1y|bzKiz!H034zKj~mEz#c5ZA3-3X$1~mBz$$3~lyz#,4YN5~mEz#{ZKZ3V%7Y}!J3X-YEX_J(3~mAz =V;kE0/y|F3y!}~m>z/U~mI~j_2+~mA~jp2;~m@~k32;~m>V}2u~mEX#2x~mBy+x2242(~mBy,;2242(~may->2&XkG2;~mIy-_2&NXd2;~mGz,{4<6:.:B*B:XC4>6:.>B*BBXSA+A:X]E&E<~r#z+625z s2+zN=`HXI@YMXIAXZYUM8X4K/:Q!Z&33 3YWX[~mB`{zKt4z (zV/z 3zRw2%Wd39]S11z$PAXH5Xb;ZQWU1ZgWP%3~o@{Dgl#gd}T){Uo{y5_d{e@}C(} WU9|cB{w}bzvV|)[} H|zT}d||0~{]Q|(l{|x{iv{dw}(5}[Z|kuZ }cq{{y|ij}.I{idbof%cu^d}Rj^y|-M{ESYGYfYsZslS`?ZdYO__gLYRZ&fvb4oKfhSf^d<Yeasc1f&a=hnYG{QY{D`Bsa|u,}Dl|_Q{C%xK|Aq}C>|c#ryW=}eY{L+`)][YF_Ub^h4}[X|?r|u_ex}TL@YR]j{SrXgo*|Gv|rK}B#mu{R1}hs|dP{C7|^Qt3|@P{YVV |8&}#D}ef{e/{Rl|>Hni}R1{Z#{D[}CQlQ||E}[s{SG_+i8eplY[=[|ec[$YXn#`hcm}YR|{Ci(_[ql|?8p3]-}^t{wy}4la&pc|3e{Rp{LqiJ],] `kc(]@chYnrM`O^,ZLYhZB]ywyfGY~aex!_Qww{a!|)*lHrM{N+n&YYj~Z b c#e_[hZSon|rOt`}hBXa^i{lh|<0||r{KJ{kni)|x,|0auY{D!^Sce{w;|@S|cA}Xn{C1h${E]Z-XgZ*XPbp]^_qbH^e[`YM|a||+=]!Lc}]vdBc=j-YSZD]YmyYLYKZ9Z>Xcczc2{Yh}9Fc#Z.l{}(D{G{{mRhC|L3b#|xK[Bepj#ut`H[,{E9Yr}1b{[e]{ZFk7[ZYbZ0XL]}Ye[(`d}c!|*y`Dg=b;gR]Hm=hJho}R-[n}9;{N![7k_{UbmN]rf#pTe[x8}!Qcs_rs[m`|>N}^V})7{^r|/E}),}HH{OYe2{Skx)e<_.cj.cjoMhc^d}0uYZd!^J_@g,[[[?{i@][|3S}Yl3|!1|eZ|5IYw|1D}e7|Cv{OHbnx-`wvb[6[4} =g+k:{C:}ed{S]|2M]-}WZ|/q{LF|dYu^}Gs^c{Z=}h>|/i|{W]:|ip{N:|zt|S<{DH[p_tvD{N<[8Axo{X4a.^o^X>Yfa59`#ZBYgY~_t^9`jZHZn`>G[oajZ;X,i)Z.^~YJe ZiZF^{][[#Zt^|]Fjx]&_5dddW]P0C[-]}]d|y {C_jUql] |OpaA[Z{lp|rz}:Mu#]_Yf6{Ep?f5`$[6^D][^u[$[6^.Z8]]ePc2U/=]K^_+^M{q*|9tYuZ,s(dS{i=|bNbB{uG}0jZOa:[-]dYtu3]:]<{DJ_SZIqr_`l=Yt`gkTnXb3d@kiq0a`Z{|!B|}e}Ww{Sp,^Z|0>_Z}36|]A|-t}lt{R6pi|v8hPu#{C>YOZHYmg/Z4nicK[}hF_Bg|YRZ7c|crkzYZY}_iXcZ.|)U|L5{R~qi^Uga@Y[xb}&qdbd6h5|Btw[}c<{Ds53[Y7]?Z<|e0{L[ZK]mXKZ#Z2^tavf0`PE[OSOaP`4gi`qjdYMgys/?[nc,}EEb,eL]g[n{E_b/vcvgb.{kcwi`~v%|0:|iK{Jh_vf5lb}KL|(oi=LrzhhY_^@`zgf[~g)[J_0fk_V{T)}I_{D&_/d9W/|MU[)f$xW}?$xr4<{Lb{y4}&u{XJ|cm{Iu{jQ}CMkD{CX|7A}G~{kt)nB|d5|<-}WJ}@||d@|Iy}Ts|iL|/^|no|0;}L6{Pm]7}$zf:|r2}?C_k{R(}-w|`G{Gy[g]bVje=_0|PT{^Y^yjtT[[[l!Ye_`ZN]@[n_)j3nEgMa]YtYpZy].d-Y_cjb~Y~[nc~sCi3|zg}B0}do{O^{|$`_|D{}U&|0+{J3|8*]iayx{a{xJ_9|,c{Ee]QXlYb]$[%YMc*]w[aafe]aVYi[fZEii[xq2YQZHg]Y~h#|Y:thre^@^|_F^CbTbG_1^qf7{L-`VFx Zr|@EZ;gkZ@slgko`[e}T:{Cu^pddZ_`yav^Ea+[#ZBbSbO`elQfLui}.F|txYcbQ`XehcGe~fc^RlV{D_0ZAej[l&jShxG[ipB_=u:eU}3e8[=j|{D(}dO{Do[BYUZ0/]AYE]ALYhZcYlYP/^-^{Yt_1_-;YT`P4BZG=IOZ&]H[e]YYd[9^F[1YdZxZ?Z{Z<]Ba2[5Yb[0Z4l?]d_;_)a?YGEYiYv`_XmZs4ZjY^Zb]6gqGaX^9Y}dXZr[g|]Y}K aFZp^k^F]M`^{O1Ys]ZCgCv4|E>}8eb7}l`{L5[Z_faQ|c2}Fj}hw^#|Ng|B||w2|Sh{v+[G}aB|MY}A{|8o}X~{E8paZ:]i^Njq]new)`-Z>haounWhN}c#{DfZ|fK]KqGZ=:u|fqoqcv}2ssm}.r{]{nIfV{JW)[K|,Z{Uxc|]l_KdCb%]cfobya3`p}G^|LZiSC]U|(X|kBlVg[kNo({O:g:|-N|qT}9?{MBiL}Sq{`P|3a|u.{Uaq:{_o|^S}jX{Fob0`;|#y_@[V[K|cw[<_ }KU|0F}d3|et{Q7{LuZttsmf^kYZ`Af`}$x}U`|Ww}d]| >}K,r&|XI|*e{C/a-bmr1fId4[;b>tQ_:]hk{b-pMge]gfpo.|(w[jgV{EC1Z,YhaY^q,_G[c_g[J0YX]`[h^hYK^_Yib,` {i6vf@YM^hdOKZZn(jgZ>bzSDc^Z%[[o9[2=/YHZ(_/Gu_`*|8z{DUZxYt^vuvZjhi^lc&gUd4|<UiA`z]$b/Z?l}YI^jaHxe|;F}l${sQ}5g}hA|e4}?o{ih}Uz{C)jPe4]H^J[Eg[|AMZMlc}:,{iz}#*|gc{Iq|/:|zK{l&}#u|myd{{M&v~nV};L|(g|I]ogddb0xsd7^V})$uQ{HzazsgxtsO^l}F>ZB]r|{7{j@cU^{{CbiYoHlng]f+nQ[bkTn/}<-d9q {KXadZYo+n|l[|lc}V2{[a{S4Zam~Za^`{HH{xx_SvF|ak=c^[v^7_rYT`ld@]:_ub%[$[m](Shu}G2{E.ZU_L_R{tz`vj(f?^}hswz}GdZ}{S:h`aD|?W|`dgG|if{a8|J1{N,}-Ao3{H#{mfsP|[ bzn+}_Q{MT{u4kHcj_q`eZj[8o0jy{p7}C|[}l){MuYY{|Ff!Ykn3{rT|m,^R|,R}$~Ykgx{P!]>iXh6[l[/}Jgcg{JYZ.^qYfYIZl[gZ#Xj[Pc7YyZD^+Yt;4;`e8YyZVbQ7YzZxXja.7SYl[s]2^/Ha$[6ZGYrb%XiYdf2]H]kZkZ*ZQ[ZYS^HZXcCc%Z|[(bVZ]]:OJQ_DZCg<[,]%Zaa [g{C00HY[c%[ChyZ,Z_`PbXa+eh`^&jPi0a[ggvhlekL]w{Yp^v}[e{~;k%a&k^|nR_z_Qng}[E}*Wq:{k^{FJZpXRhmh3^p>de^=_7`|ZbaAZtdhZ?n4ZL]u`9ZNc3g%[6b=e.ZVfC[ZZ^^^hD{E(9c(kyZ=bb|Sq{k`|vmr>izlH[u|e`}49}Y%}FT{[z{Rk}Bz{TCc/lMiAqkf(m$hDc;qooi[}^o:c^|Qm}a_{mrZ(pA`,}<2sY| adf_%|}`}Y5U;}/4|D>|$X{jw{C<|F.hK|*A{MRZ8Zsm?imZm_?brYWZrYx`yVZc3a@f?aK^ojEd {bN}/3ZH]/$YZhm^&j 9|(S|b]mF}UI{q&aM]LcrZ5^.|[j`T_V_Gak}9J[ ZCZD|^h{N9{~&[6Zd{}B}2O|cv]K}3s}Uy|l,fihW{EG`j_QOp~Z$F^zexS`dcISfhZBXP|.vn|_HYQ|)9|cr]<`&Z6]m_(ZhPcSg>`Z]5`~1`0Xcb4k1{O!bz|CN_T{LR|a/gFcD|j<{Z._[f)mPc:1`WtIaT1cgYkZOaVZOYFrEe[}T$}Ch}mk{K-^@]fH{Hdi`c*Z&|Kt{if[C{Q;{xYB`dYIX:ZB[}]*[{{p9|4GYRh2ao{DS|V+[zd$`F[ZXKadb*A] Ys]Maif~a/Z2bmclb8{Jro_rz|x9cHojbZ{GzZx_)]:{wAayeDlx}<=`g{H1{l#}9i|)=|lP{Qq}.({La|!Y{i2EZfp=c*}Cc{EDvVB|;g}2t{W4av^Bn=]ri,|y?|3+}T*ckZ*{Ffr5e%|sB{lx^0]eZb]9[SgAjS_D|uHZx]dive[c.YPkcq/}db{EQh&hQ|eg}G!ljil|BO]X{Qr_GkGl~YiYWu=c3eb}29v3|D|}4i||.{Mv})V{SP1{FX}CZW6{cm|vO{pS|e#}A~|1i}81|Mw}es|5[}3w{C`h9aL]o{}p[G`>i%a1Z@`Ln2bD[$_h`}ZOjhdTrH{[j_:k~kv[Sdu]CtL}41{I |[[{]Zp$]XjxjHt_eThoa#h>sSt8|gK|TVi[Y{t=}Bs|b7Zpr%{gt|Yo{CS[/{iteva|cf^hgn}($_c^wmb^Wm+|55jrbF|{9^ q6{C&c+ZKdJkq_xOYqZYSYXYl`8]-cxZAq/b%b*_Vsa[/Ybjac/OaGZ4fza|a)gY{P?| I|Y |,pi1n7}9bm9ad|=d{aV|2@[(}B`d&|Uz}B}{`q|/H|!JkM{FU|CB|.{}Az}#P|lk}K{|2rk7{^8^?`/|k>|Ka{Sq}Gz}io{DxZh[yK_#}9<{TRdgc]`~Z>JYmYJ]|`!ZKZ]gUcx|^E[rZCd`f9oQ[NcD_$ZlZ;Zr}mX|=!|$6ZPZYtIo%fj}CpcN|B,{VDw~gb}@hZg`Q{LcmA[(bo`<|@$|o1|Ss}9Z_}tC|G`{F/|9nd}i=}V-{L8aaeST]daRbujh^xlpq8|}zs4bj[S`J|]?G{P#{rD{]I`OlH{Hm]VYuSYUbRc*6[j`8]pZ[bt_/^Jc*[<Z?YE|Xb|?_Z^Vcas]h{t9|Uwd)_(=0^6Zb{Nc} E[qZAeX[a]P^|_J>e8`W^j_Y}R{{Jp__]Ee#e:iWb9q_wKbujrbR}CY`,{mJ}gz{Q^{t~N|? gSga`V_||:#mi}3t|/I`X{N*|ct|2g{km}gi|{={jC}F;|E}{ZZjYf*frmu}8Tdroi{T[|+~}HG{cJ}DM{Lp{Ctd&}$hi3|FZ| m}Kr|38}^c|m_|Tr{Qv|36}?Up>|;S{DV{k_as}BK{P}}9p|t`jR{sAm4{D=b4pWa[}Xi{EjwEkI}3S|E?u=X0{jf} S|NM|JC{qo^3cm]-|JUx/{Cj{s>{Crt[UXuv|D~|j|d{YXZR}Aq}0r}(_{pJfi_z}0b|-vi)Z mFe,{f4|q`b{}^Z{HM{rbeHZ|^x_o|XM|L%|uFXm}@C_{{Hhp%a7|0p[Xp+^K}9U{bP}: tT}B|}+$|b2|[^|~h{FAby[`{}xgygrt~h1[li`c4vz|,7p~b(|mviN}^pg[{N/|g3|^0c,gE|f%|7N{q[|tc|TKA{LU}I@|AZp(}G-sz{F |qZ{}F|f-}RGn6{Z]_5})B}UJ{FFb2]4ZI@v=k,]t_Dg5Bj]Z-]L]vrpdvdGlk|gF}G]|IW}Y0[G| /bo|Te^,_B}#n^^{QHYI[?hxg{[`]D^IYRYTb&kJ[cri[g_9]Ud~^_]<p@_e_XdNm-^/|5)|h_{J;{kacVopf!q;asqd}n)|.m|bf{QW|U)}b+{tL|w``N|to{t ZO|T]jF}CB|0Q{e5Zw|k |We}5:{HO{tPwf_uajjBfX}-V_C_{{r~gg|Ude;s+}KNXH}! `K}eW{Upwbk%ogaW}9EYN}YY|&v|SL{C3[5s.]Y]I]u{M6{pYZ`^,`ZbCYR[1mNg>rsk0Ym[jrE]RYiZTr*YJ{Ge|%-lf|y(`=[t}E6{k!|3)}Zk} ][G{E~cF{u3U.rJ|a9p#o#ZE|?|{sYc#vv{E=|LC}cu{N8`/`3`9rt[4|He{cq|iSYxY`}V |(Q|t4{C?]k_Vlvk)BZ^r<{CL}#h}R+[<|i=}X|{KAo]|W<`K{NW|Zx}#;|fe{IMr<|K~tJ_x}AyLZ?{GvbLnRgN}X&{H7|x~}Jm{]-| GpNu0}.ok>|c4{PYisrDZ|fwh9|hfo@{H~XSbO]Odv]%`N]b1Y]]|eIZ}_-ZA]aj,>eFn+j[aQ_+]h[J_m_g]%_wf.`%k1e#Z?{CvYu_B^|gk`Xfh^M3`afGZ-Z|[m{L}|k3cp[it ^>YUi~d>{T*}YJ{Q5{Jxa$hg|%4`}|LAgvb }G}{P=|<;Ux{_skR{cV|-*|s-{Mp|XP|$G|_J}c6cM{_=_D|*9^$ec{V;|4S{qO|w_|.7}d0|/D}e}|0G{Dq]Kdp{}dfDi>}B%{Gd|nl}lf{C-{y}|ANZr}#={T~|-(}c&{pI|ft{lsVP}){|@u}!W|bcmB{d?|iW|:dxj{PSkO|Hl]Li:}VYk@|2={fnWt{M3`cZ6|)}|Xj}BYa?vo{e4|L7|B7{L7|1W|lvYO}W8nJ|$Vih|{T{d*_1|:-n2dblk``fT{Ky|-%}m!|Xy|-a{Pz}[l{kFjz|iH}9N{WE{x,|jz}R {P|{D)c=nX|Kq|si}Ge{sh|[X{RF{t`|jsr*fYf,rK|/9}$}}Nf{y!1|<Std}4Wez{W${Fd_/^O[ooqaw_z[L`Nbv[;l7V[ii3_PeM}.h^viqYjZ*j1}+3{bt{DR[;UG}3Og,rS{JO{qw{d<_zbAh<R[1_r`iZTbv^^a}c{iEgQZ<exZFg.^Rb+`Uj{a+{z<[~r!]`[[|rZYR|?F|qppp]L|-d|}K}YZUM|=Y|ktm*}F]{D;g{uI|7kg^}%?Z%ca{N[_<q4xC]i|PqZC]n}.bDrnh0Wq{tr|OMn6tM|!6|T`{O`|>!]ji+]_bTeU}Tq|ds}n|{Gm{z,f)}&s{DPYJ`%{CGd5v4tvb*hUh~bf]z`jajiFqAii]bfy^U{Or|m+{I)cS|.9k:e3`^|xN}@Dnlis`B|Qo{`W|>||kA}Y}{ERYuYx`%[exd`]|OyiHtb}HofUYbFo![5|+]gD{NIZR|Go}.T{rh^4]S|C9_}xO^i`vfQ}C)bK{TL}cQ|79iu}9a];sj{P.o!f[Y]pM``Jda^Wc9ZarteBZClxtM{LW}l9|a.mU}KX}4@{I+f1}37|8u}9c|v${xGlz}jP{Dd1}e:}31}%3X$|22i<v+r@~mf{sN{C67G97855F4YL5}8f{DT|xy{sO{DXB334@55J1)4.G9A#JDYtXTYM4, YQD9;XbXm9SX]IB^4UN=Xn<5(;(F3YW@XkH-X_VM[DYM:5XP!T&Y`6|,^{IS-*D.H>:LXjYQ0I3XhAF:9:(==.F*3F1189K/7163D,:@|e2{LS36D4hq{Lw/84443@4.933:0307::6D7}&l{Mx657;89;,K5678H&93D(H<&<>0B90X^I;}Ag1{P%3A+>><975}[S{PZE453?4|T2{Q+5187;>447:81{C=hL6{Me^:=7ii{R=.=F<81;48?|h8}Uh{SE|,VxL{ST,7?9Y_5Xk3A#:$%YSYdXeKXOD8+TXh7(@>(YdXYHXl9J6X_5IXaL0N?3YK7Xh!1?XgYz9YEXhXaYPXhC3X`-YLY_XfVf[EGXZ5L8BXL9YHX]SYTXjLXdJ: YcXbQXg1PX]Yx4|Jr{Ys4.8YU+XIY`0N,<H%-H;:0@,74/:8546I=9177154870UC]d<C3HXl7ALYzXFXWP<<?E!88E5@03YYXJ?YJ@6YxX-YdXhYG|9o{`iXjY_>YVXe>AYFX[/(I@0841?):-B=14337:8=|14{c&93788|di{cW-0>0<097/A;N{FqYpugAFT%X/Yo3Yn,#=XlCYHYNX[Xk3YN:YRT4?)-YH%A5XlYF3C1=NWyY}>:74-C673<69545v {iT85YED=64=.F4..9878/D4378?48B3:7:7/1VX[f4{D,{l<5E75{dAbRB-8-@+;DBF/$ZfW8S<4YhXA.(5@*11YV8./S95C/0R-A4AXQYI7?68167B95HA1*<M3?1/@;/=54XbYP36}lc{qzSS38:19?,/39193574/66878Yw1X-87E6=;964X`T734:>86>1/=0;(I-1::7ALYGXhF+Xk[@W%TYbX7)KXdYEXi,H-XhYMRXfYK?XgXj.9HX_SX]YL1XmYJ>Y}WwIXiI-3-GXcYyXUYJ$X`Vs[7;XnYEZ;XF! 3;%8;PXX(N3Y[)Xi1YE&/ :;74YQ6X`33C;-(>Xm0(TYF/!YGXg8 9L5P01YPXO-5%C|qd{{/K/E6,=0144:361:955;6443@?B7*7:F89&F35YaX-CYf,XiFYRXE_e{}sF 0*7XRYPYfXa5YXXY8Xf8Y~XmA[9VjYj*#YMXIYOXk,HHX40YxYMXU8OXe;YFXLYuPXP?EB[QV0CXfY{:9XV[FWE0D6X^YVP*$4%OXiYQ(|xp|%c3{}V`1>Y`XH00:8/M6XhQ1:;3414|TE|&o@1*=81G8<3}6<|(f6>>>5-5:8;093B^3U*+*^*UT30XgYU&7*O1953)5@E78--F7YF*B&0:%P68W9Zn5974J9::3}Vk|-,C)=)1AJ4+<3YGXfY[XQXmT1M-XcYTYZXCYZXEYXXMYN,17>XIG*SaS|/eYJXbI?XdNZ+WRYP<F:R PXf;0Xg`$|1GX9YdXjLYxWX!ZIXGYaXNYm6X9YMX?9EXmZ&XZ#XQ>YeXRXfAY[4 ;0X!Zz0XdN$XhYL XIY^XGNXUYS/1YFXhYk.TXn4DXjB{jg|4DEX]:XcZMW=A.+QYL<LKXc[vV$+&PX*Z3XMYIXUQ:ZvW< YSXFZ,XBYeXMM)?Xa XiZ4/EXcP3%}&-|6~:1(-+YT$@XIYRBC<}&,|7aJ6}bp|8)K1|Xg|8C}[T|8Q.89;-964I38361<=/;883651467<7:>?1:.}le|:Z=39;1Y^)?:J=?XfLXbXi=Q0YVYOXaXiLXmJXO5?.SFXiCYW}-;|=u&D-X`N0X^,YzYRXO(QX_YW9`I|>hZ:N&X)DQXP@YH#XmNXi$YWX^=!G6YbYdX>XjY|XlX^XdYkX>YnXUXPYF)FXT[EVTMYmYJXmYSXmNXi#GXmT3X8HOX[ZiXN]IU2>8YdX1YbX<YfWuZ8XSXcZU%0;1XnXkZ_WTG,XZYX5YSX Yp 05G?XcYW(IXg6K/XlYP4XnI @XnO1W4Zp-9C@%QDYX+OYeX9>--YSXkD.YR%Q/Yo YUX].Xi<HYEZ2WdCE6YMXa7F)=,D>-@9/8@5=?7164;35387?N<618=6>7D+C50<6B03J0{Hj|N9$D,9I-,.KB3}m |NzE0::/81YqXjMXl7YG; [.W=Z0X4XQY]:MXiR,XgM?9$9>:?E;YE77VS[Y564760391?14941:0=:8B:;/1DXjFA-564=0B3XlH1+D85:0Q!B#:-6&N/:9<-R3/7Xn<*3J4.H:+334B.=>30H.;3833/76464665755:/83H6633:=;.>5645}&E|Y)?1/YG-,93&N3AE@5 <L1-G/8A0D858/30>8<549=@B8] V0[uVQYlXeD(P#ID&7T&7;Xi0;7T-$YE)E=1:E1GR):--0YI7=E<}n9|aT6783A>D7&4YG7=391W;Zx<5+>F#J39}o/|cc;6=A050EQXg8A1-}D-|d^5548083563695D?-.YOXd37I$@LYLWeYlX<Yd+YR A$;3-4YQ-9XmA0!9/XLY_YT(=5XdDI>YJ5XP1ZAW{9>X_6R(XhYO65&J%DA)C-!B:97#A9;@?F;&;(9=11/=657/H,<8}bz|j^5446>.L+&Y^8Xb6?(CYOXb*YF(8X`FYR(XPYVXmPQ%&DD(XmZXW??YOXZXfCYJ79,O)XnYF7K0!QXmXi4IYFRXS,6<%-:YO(+:-3Q!1E1:W,Zo}Am|n~;3580534*?3Zc4=9334361693:30C<6/717:<1/;>59&:4}6!|rS36=1?75<8}[B|s809983579I.A.>84758=108564741H*9E{L{|u%YQ<%6XfH.YUXe4YL@,>N}Tv|ve*G0X)Z;/)3@A74(4P&A1X:YVH97;,754*A66:1 D739E3553545558E4?-?K17/770843XAYf838A7K%N!YW4.$T19Z`WJ*0XdYJXTYOXNZ 1XaN1A+I&Xi.Xk3Z3GB&5%WhZ1+5#Y[X<4YMXhQYoQXVXbYQ8XSYUX4YXBXWDMG0WxZA[8V+Z8X;D],Va$%YeX?FXfX[XeYf<X:Z[WsYz8X_Y]%XmQ(!7BXIZFX]&YE3F$(1XgYgYE& +[+W!<YMYFXc;+PXCYI9YrWxGXY9DY[!GXiI7::)OC;*$.>N*HA@{C|}&k=:<TB83X`3YL+G4XiK]i}(fYK<=5$.FYE%4*5*H*6XkCYL=*6Xi6!Yi1KXR4YHXbC8Xj,B9ZbWx/XbYON#5B}Ue}+QKXnF1&YV5XmYQ0!*3IXBYb71?1B75XmF;0B976;H/RXU:YZX;BG-NXj;XjI>A#D3B636N;,*%<D:0;YRXY973H5)-4FXOYf0:0;/7759774;7;:/855:543L43<?6=E,.A4:C=L)%4YV!1(YE/4YF+ F3%;S;&JC:%/?YEXJ4GXf/YS-EXEYW,9;E}X$}547EXiK=51-?71C%?57;5>463553Zg90;6447?<>4:9.7538XgN{|!}9K/E&3-:D+YE1)YE/3;37/:05}n<}:UX8Yj4Yt864@JYK..G=.(A Q3%6K>3(P3#AYE$-6H/456*C=.XHY[#S.<780191;057C)=6HXj?955B:K1 E>-B/9,;5.!L?:0>/.@//:;7833YZ56<4:YE=/:7Z_WGC%3I6>XkC*&NA16X=Yz2$X:Y^&J48<99k8}CyB-61<18K946YO4{|N}E)YIB9K0L>4=46<1K0+R;6-=1883:478;4,S+3YJX`GJXh.Yp+Xm6MXcYpX(>7Yo,/:X=Z;Xi0YTYHXjYmXiXj;*;I-8S6N#XgY}.3XfYGO3C/$XjL$*NYX,1 6;YH&<XkK9C#I74.>}Hd`A748X[T450[n75<4439:18A107>|ET}Rf<1;14876/Yb983E<5.YNXd4149>,S=/4E/<306443G/06}0&}UkYSXFYF=44=-5095=88;63844,9E6644{PL}WA8:>)7+>763>>0/B3A545CCnT}Xm|dv}Xq1L/YNXk/H8;;.R63351YY747@15YE4J8;46;.38.>4A369.=-83,;Ye3?:3@YE.4-+N353;/;@(X[YYD>@/05-I*@.:551741Yf5>6A443<3535;.58/86=D4753442$635D1>0359NQ @73:3:>><Xn?;43C14 ?Y|X611YG1&<+,4<*,YLXl<1/AIXjF*N89A4Z576K1XbJ5YF.ZOWN.YGXO/YQ01:4G38Xl1;KI0YFXB=R<7;D/,/4>;$I,YGXm94@O35Yz66695385.>:6A#5}W7n^4336:4157597434433<3|XA}m`>=D>:4A.337370?-6Q96{`E|4A}C`|Qs{Mk|J+~r>|o,wHv>Vw}!c{H!|Gb|*Ca5}J||,U{t+{CN[!M65YXOY_*B,Y[Z9XaX[QYJYLXPYuZ%XcZ8LY[SYPYKZM<LMYG9OYqSQYM~[e{UJXmQYyZM_)>YjN1~[f3{aXFY|Yk:48YdH^NZ0|T){jVFYTZNFY^YTYN~[h{nPYMYn3I]`EYUYsYIZEYJ7Yw)YnXPQYH+Z.ZAZY]^Z1Y`YSZFZyGYHXLYG 8Yd#4~[i|+)YH9D?Y^F~Y7|-eYxZ^WHYdYfZQ~[j|3>~[k|3oYmYqY^XYYO=Z*4[]Z/OYLXhZ1YLZIXgYIHYEYK,<Y`YEXIGZI[3YOYcB4SZ!YHZ*&Y{Xi3~[l|JSY`Zz?Z,~[m|O=Yi>??XnYWXmYS617YVYIHZ(Z4[~L4/=~[n|Yu{P)|];YOHHZ}~[o33|a>~[r|aE]DH~[s|e$Zz~[t|kZFY~XhYXZB[`Y}~[u|{SZ&OYkYQYuZ2Zf8D~[v}% ~[w3},Q[X]+YGYeYPIS~[y}4aZ!YN^!6PZ*~[z}?E~[{3}CnZ=~[}}EdDZz/9A3(3S<,YR8.D=*XgYPYcXN3Z5 4)~[~}JW=$Yu.XX~] }KDX`PXdZ4XfYpTJLY[F5]X~[2Yp}U+DZJ::<446[m@~]#3}]1~]%}^LZwZQ5Z`/OT<Yh^ -~]&}jx[ ~m<z!%2+~ly4VY-~o>}p62yz!%2+Xf2+~ly4VY-zQ`z (=] 2z~o2",C={" ":0,"!":1},c=34,i=2,p,s="",u=String.fromCharCode,t=u(12539);for(;++c<127;)C[u(c)]=c^39&&c^92?i++:0;i=0;for(;0<=(c=C[a.charAt(i++)]);)if(16===c)if((c=C[a.charAt(i++)])<87){if(86===c)c=1879;for(;c--;)s+=u(++p)}else s+=s.substr(8272,360);else if(c<86)s+=u(p+=c<51?c-16:(c-55)*92+C[a.charAt(i++)]);else if((c=((c-86)*92+C[a.charAt(i++)])*92+C[a.charAt(i++)])<49152)s+=u(p=c<40960?c:c|57344);else{c&=511;for(;c--;)s+=t;p=12539}return s\')(),Util.$decodeToShiftJis=function(t){return t.replace(/%(8[1-9A-F]|[9E][0-9A-F]|F[0-9A-C])(%[4-689A-F][0-9A-F]|%7[0-9A-E]|[@-~])|%([0-7][0-9A-F]|A[1-9A-F]|[B-D][0-9A-F])/gi,(function(t){let e=parseInt(t.substring(1,3),16);const s=t.length;return 3===s?String.fromCharCode(e<160?e:e+65216):Util.$JCT11280.charAt(188*(e<160?e-129:e-193)+(4===s?t.charCodeAt(3)-64:(e=parseInt(t.substring(4),16))<127?e-64:e-65))}))},Util.$getTagObject=function(){return Util.$tagObjects.pop()||{placeObjects:[],sounds:[],removeObjects:[],frameLabel:[]}},Util.$poolTagObject=function(t){t.placeObjects.length=0,t.sounds.length=0,t.removeObjects.length=0,t.frameLabel.length=0,Util.$tagObjects.push(t)},Util.$createMovieClip=function(){const t={_$characterId:0,_$name:"MovieClip",_$controller:[],_$placeObjects:[],_$placeMap:[],_$labels:[],_$dictionary:[],_$sounds:[]};return t},Util.$getControllerAt=function(t,e,s){return s in t._$controller[e]?t._$controller[e][s]:null},Util.$addDictionary=function(t,e){const s=t._$dictionary.length,a={CharacterId:e.CharacterId,Depth:e.Depth,Name:null,ClipDepth:0,PlaceFlagHasImage:0|e.PlaceFlagHasImage,StartFrame:0|e.StartFrame,EndFrame:0|e.EndFrame};return e.PlaceFlagHasName&&(a.Name=e.Name),e.PlaceFlagHasClipDepth&&(a.ClipDepth=e.ClipDepth),t._$dictionary[s]=a,s},Util.$getBlendName=function(t){switch(t){case 1:case"normal":default:return"normal";case 2:case"layer":return"layer";case 3:case"multiply":return"multiply";case 4:case"screen":return"screen";case 5:case"lighten":return"lighten";case 6:case"darken":return"darken";case 7:case"difference":return"difference";case 8:case"add":return"add";case 9:case"subtract":return"subtract";case 10:case"invert":return"invert";case 11:case"alpha":return"alpha";case 12:case"erase":return"erase";case 13:case"overlay":return"overlay";case 14:case"hardlight":return"hardlight"}};class ByteStream{constructor(){this.clear()}clear(){this.data=null,this.bit_offset=0,this.byte_offset=0,this.bit_buffer=null}setData(t){this.data=t}getData(t){this.byteAlign();const e=this.byte_offset+t,s=this.data.subarray(this.byte_offset,e);return this.byte_offset=e,s}byteAlign(){this.bit_offset&&(this.byte_offset=this.byte_offset+(this.bit_offset+7)/8|0,this.bit_offset=0)}getDataUntil(t=0){this.byteAlign();let e="";for(;;){const t=this.data[this.byte_offset++];if(!t)break;if(10===t||13===t){e+="\\n";continue}let s=t.toString(16);1===s.length&&(s="0"+s),e+="%"+s}if(!e.length)return"";if(e.length>5&&"\\n"===e.substr(-5)&&(e=e.slice(0,-5)),t)return Util.$decodeToShiftJis(e);try{return decodeURIComponent(e)}catch(t){return Util.$decodeToShiftJis(e)}}byteCarry(){if(this.bit_offset>7)this.byte_offset=this.byte_offset+(0|(this.bit_offset+7)/8),this.bit_offset&=7;else for(;this.bit_offset<0;)--this.byte_offset,this.bit_offset+=8}getUIBits(t){let e=0;for(;t;)e<<=1,e|=this.getUIBit(),--t;return e}getUIBit(){return this.byteCarry(),this.data[this.byte_offset]>>7-this.bit_offset++&1}getSIBits(t){const e=this.getUIBits(t),s=e&1<<t-1;return s?-(e^2*s-1)-1:e}getUI8(){return this.byteAlign(),this.data[this.byte_offset++]}getUI16(){return this.byteAlign(),this.getUI8()|this.getUI8()<<8}getUI32(){return this.byteAlign(),this.getUI8()|(this.getUI8()|(this.getUI8()|this.getUI8()<<8)<<8)<<8}getFloat16(){const t=this.data[this.byte_offset++];let e=0;return e|=this.data[this.byte_offset++]<<8,e|=t<<0,e}getFloat32(){const t=this.data[this.byte_offset++],e=this.data[this.byte_offset++],s=this.data[this.byte_offset++];let a=0;a|=this.data[this.byte_offset++]<<24,a|=s<<16,a|=e<<8,a|=t<<0;const i=a>>23&255;return a&&2147483648!==a?(2147483648&a?-1:1)*(8388608|8388607&a)*Math.pow(2,i-127-23):0}incrementOffset(t,e){this.byte_offset+=t,this.bit_offset+=e,this.byteCarry()}setOffset(t,e){this.byte_offset=t,this.bit_offset=e}}class SwfParser{constructor(){this.byteStream=new ByteStream,this.currentPosition={x:0,y:0},this.jpegTables=null,this.characters=[],this.frameInfo=[],this.fonts=new Map,this.textSettings=new Map,this.grids=new Map,this.version=0}clear(){this.byteStream.clear(),this.currentPosition.x=0,this.currentPosition.y=0,this.jpegTables=null,this.characters.length=0,this.frameInfo.length=0,this.version=0}getCharacter(t){return this.characters[t]}setCharacter(t,e,s){this.characters[t]=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:e},s)}getFont(t){return this.fonts.get(t)}setFont(t,e){this.fonts.set(t,e)}setTextSetting(t,e){this.textSettings.set(t,e)}setGrid(t,e){this.grids.set(t,e)}showFrame(t,e,s,a){let i,r;const h=s-1|0,o=e.frameLabel;i=o.length;for(let e=0;e<i;++e){const a=o[e];a.name in this.frameInfo&&(a.frame=this.frameInfo["@"+a.name]),t._$labels.push({label:a.name,frame:a.frame||s})}const n=e.sounds;i=0|n.length,i&&t._$sounds.push({frame:s,data:n.slice(0)});const l=e.removeObjects;i=l.length;for(let e=0;e<i;++e){const a=l[e],i=Util.$getControllerAt(t,h,a.Depth);t._$dictionary[i].EndFrame=s,Util.$installed.set(a.Depth,1)}s in a||(a[s]=[]),s in t._$controller||(t._$controller[s]=[]),s in t._$placeMap||(t._$placeMap[s]=[]);const c=e.placeObjects,b=h?a[h]:null;i=c.length;for(let e=0;e<i;++e){let i=null;const r=c[e];let o=null;h&&r.Depth in b&&(o=b[r.Depth]),0===r.PlaceFlagHasCharacter&&o&&(r.CharacterId=o.CharacterId);let n=!1;if((0===r.PlaceFlagMove||1===r.PlaceFlagMove&&1===r.PlaceFlagHasCharacter)&&(n=!0),h&&!n&&(i=Util.$getControllerAt(t,h,r.Depth),null===i&&(n=!0)),1===r.PlaceFlagMove&&o&&(1!==o.PlaceFlagHasMatrix||r.PlaceFlagHasMatrix||(r.PlaceFlagHasMatrix=1,r.Matrix=o.Matrix),1!==o.PlaceFlagHasColorTransform||r.PlaceFlagHasColorTransform||(r.PlaceFlagHasColorTransform=1,r.ColorTransform=o.ColorTransform),1!==o.PlaceFlagHasClipDepth||r.PlaceFlagHasClipDepth||(r.PlaceFlagHasClipDepth=1,r.ClipDepth=o.ClipDepth),1!==o.PlaceFlagHasRatio||r.PlaceFlagHasRatio||(r.PlaceFlagHasRatio=1,r.Ratio=o.Ratio),1!==o.PlaceFlagHasFilterList||r.PlaceFlagHasFilterList||(r.PlaceFlagHasFilterList=1,r.SurfaceFilterList=o.SurfaceFilterList),1!==o.PlaceFlagHasBlendMode||r.PlaceFlagHasBlendMode||(r.PlaceFlagHasBlendMode=1,r.BlendMode=o.BlendMode)),h&&!Util.$installed.has(r.Depth)){const e=Util.$getControllerAt(t,h,r.Depth);if(null!==e){const a=t._$dictionary[e];!a||0!==r.PlaceFlagMove&&1!==r.PlaceFlagHasCharacter||(a.EndFrame=0|s,t._$dictionary[e]=a,n=!0)}}if(n){if(r.StartFrame=0|s,r.EndFrame=0,1===r.PlaceFlagHasCharacter&&1===r.PlaceFlagMove){const e=Util.$getControllerAt(t,h,r.Depth),a=t._$dictionary[e];a.EndFrame=0|s,t._$dictionary[e]=a}i=Util.$addDictionary(t,r)}t._$controller[s][r.Depth]=i;const l=t._$placeObjects.length;t._$placeObjects[l]=this.buildPlaceObject(r),t._$placeMap[s][r.Depth]=l,Util.$installed.set(r.Depth,1),a[s][r.Depth]=r}if(h){let e;const o=t._$controller[h];r=Object.keys(o),i=r.length;for(let n=0;n<i;++n)e=0|r[n],Util.$installed.has(e)||(a[s][e]=a[h][e],t._$controller[s][e]=o[e]);const n=t._$placeMap[h];r=Object.keys(n),i=r.length;for(let a=0;a<i;++a)e=r[a],e in t._$placeMap[s]||(t._$placeMap[s][e]=n[e])}Util.$installed.clear()}buildPlaceObject(t){const e={matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],filters:null,blendMode:"normal"};return t.PlaceFlagHasMatrix&&(e.matrix=t.Matrix),t.PlaceFlagHasColorTransform&&(e.colorTransform=t.ColorTransform),t.PlaceFlagHasFilterList&&(e.surfaceFilterList=t.SurfaceFilterList),t.PlaceFlagHasBlendMode&&(e.blendMode=Util.$getBlendName(t.BlendMode)),t.PlaceFlagHasRatio&&(e.ratio=t.Ratio||0),e}postData(t){if(this.textSettings.size){for(let[t,e]of this.textSettings){const s=this.characters[t];s&&(s._$textSetting=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:s}))}this.textSettings.clear()}if(this.grids.size){for(let[t,e]of this.grids){const s=this.characters[t];s&&(s._$grid=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:s}))}this.grids.clear()}if(this.fonts.size){for(let[t,e]of this.fonts){if(!e._$hasLayout){globalThis.postMessage({infoKey:"font",index:t,piece:e});continue}const s=e._$glyphShapeTable,a=e._$zoneTable;e._$glyphShapeTable=[],e._$zoneTable=a?[]:null,globalThis.postMessage({infoKey:"font",index:t,piece:e},[e._$advanceTable.buffer,e._$codeTable.buffer]);const i=s.length;if(i){const e=[],a=[];for(let r=0;r<i;++r){const i=s[r];e.push(i),a.push(i.records.buffer),e.length>256&&(globalThis.postMessage({infoKey:"font_shape",index:t,pieces:e},a),a.length=0,e.length=0)}e.length&&globalThis.postMessage({infoKey:"font_shape",index:t,pieces:e},a)}if(a)for(;a.length;){const e=Math.min(256,a.length);globalThis.postMessage({infoKey:"font_zone",index:t,pieces:a.splice(0,e)})}}this.fonts.clear()}for(let e=1;e<t._$controller.length;++e){const s=t._$controller[e];t._$controller[e]=s.filter((()=>!0))}this.setCharacter(0,t)}parseTags(t,e){const s=Util.$getTagObject();let a=1;const i=[],r=this.byteStream;for(;r.byte_offset<t;){const h=r.byte_offset;if(h+2>t)break;const o=r.getUI16(),n=o>>6;let l=63&o;if(63===l){if(h+6>t){r.byte_offset=h,r.bit_offset=0;break}l=r.getUI32()}const c=r.byte_offset;this.parseTag(n,l,e,a,s,i),1===n&&(++a,s.placeObjects.length=0,s.sounds.length=0,s.removeObjects.length=0,s.frameLabel.length=0);const b=r.byte_offset-c|0;b!==l&&b<l&&(r.byte_offset=r.byte_offset+(l-b)),r.bit_offset=0}Util.$poolTagObject(s)}parseTag(t,e,s,a,i,r){switch(t){case 28:i.removeObjects.push({Frame:a,Depth:this.byteStream.getUI16()});break;case 4:case 26:case 70:i.placeObjects.push(this.parsePlaceObject(t,e));break;case 39:{const t=this.byteStream.byte_offset+e,s=this.byteStream.getUI16();this.byteStream.getUI16();const a=Util.$createMovieClip();a._$characterId=s,this.parseTags(t,a);for(let t=1;t<a._$controller.length;++t){const e=a._$controller[t];a._$controller[t]=e.filter((()=>!0))}this.setCharacter(s,a)}break;case 1:this.showFrame(s,i,a,r);break;case 2:case 22:case 32:case 83:e<10?this.byteStream.byte_offset+=e:this.parseDefineShape(t);break;case 20:case 36:this.parseDefineBitsLossLess(t,e);break;case 6:case 21:case 35:case 90:this.parseDefineBits(t,e,this.jpegTables);break;case 15:case 89:i.sounds.push(this.parseStartSound(t));break;case 10:case 48:case 75:this.parseDefineFont(t,e);break;case 14:this.parseDefineSound(e);break;case 13:case 62:this.parseDefineFontInfo(t,e);break;case 43:i.frameLabel.push(this.parseFrameLabel());break;case 11:case 33:this.parseDefineText(t);break;case 37:this.parseDefineEditText(t);break;case 7:case 34:this.parseDefineButton(t,e);break;case 88:this.parseDefineFontName();break;case 8:e&&(this.jpegTables=this.parseJPEGTables(e));break;case 46:case 84:this.parseDefineMorphShape(t);break;case 18:case 45:this.parseSoundStreamHead(t);break;case 17:this.parseDefineButtonSound();break;case 73:this.parseDefineFontAlignZones();break;case 74:this.parseCSMTextSettings(t);break;case 19:this.parseSoundStreamBlock(t,e);break;case 78:this.parseDefineScalingGrid();break;case 5:console.log("TODO RemoveObject type 5."),i.removeObjects.push({CharacterId:this.byteStream.getUI16(),Depth:this.byteStream.getUI16()});break;case 76:this.parseSymbolClass();break;case 0:case 27:case 30:case 67:case 68:case 79:case 80:case 81:case 85:case 92:default:break;case 86:case 56:case 9:case 40:case 24:case 63:case 64:case 69:case 65:case 77:case 60:case 61:case 41:case 87:case 59:case 12:case 72:case 82:this.byteStream.byte_offset+=e;break;case 3:case 16:case 23:case 25:case 29:case 31:case 38:case 42:case 44:case 47:case 49:case 52:case 53:case 54:case 55:case 57:case 58:case 66:case 71:case 91:case 93:console.log("[TODO] tagType -> "+t)}}parseSymbolClass(){const t=this.byteStream.getUI16();if(t){const e=[];for(let s=0;s<t;++s){const t=this.byteStream.getUI16(),s=this.byteStream.getDataUntil();e[e.length]={tagId:t,ns:s},128===e.length&&(globalThis.postMessage({infoKey:"_$symbols",pieces:e}),e.length=0)}e.length&&globalThis.postMessage({infoKey:"_$symbols",pieces:e})}}parseDefineShape(t){const e=0|this.byteStream.getUI16(),s=this.rect();if(83===t){const t={};this.rect(),this.byteStream.getUIBits(5),t.UsesFillWindingRule=this.byteStream.getUIBits(1),t.UsesNonScalingStrokes=this.byteStream.getUIBits(1),t.UsesScalingStrokes=this.byteStream.getUIBits(1)}const a=this.shapeWithStyle(t);this.setCharacter(e,{_$records:a,_$name:"Shape",_$bounds:s,_$characterId:e},[a.ShapeData.records.buffer])}rect(){this.byteStream.byteAlign();const t=this.byteStream.getUIBits(5);return{xMin:this.byteStream.getSIBits(t)/20,xMax:this.byteStream.getSIBits(t)/20,yMin:this.byteStream.getSIBits(t)/20,yMax:this.byteStream.getSIBits(t)/20}}shapeWithStyle(t){const e={};switch(t){case 46:case 84:break;default:e.fillStyles=this.fillStyleArray(t),e.lineStyles=this.lineStyleArray(t)}const s=this.byteStream.getUI8(),a=s>>4,i=15&s;return e.ShapeData=this.shapeRecords(t,{FillBits:a,LineBits:i}),e}fillStyleArray(t){let e=0|this.byteStream.getUI8();t>2&&255===e&&(e=this.byteStream.getUI16());const s=[];for(let a=0;a<e;++a)s[s.length]=this.fillStyle(t);return s}fillStyle(t){const e=this.byteStream.getUI8(),s={};switch(s.fillStyleType=e,e){case 0:switch(t){case 32:case 83:s.Color=this.rgba();break;case 46:case 84:s.StartColor=this.rgba(),s.EndColor=this.rgba();break;default:s.Color=this.rgb()}break;case 16:case 18:switch(t){case 46:case 84:s.startGradientMatrix=this.matrix(),s.endGradientMatrix=this.matrix(),s.gradient=this.gradient(t);break;default:s.gradientMatrix=this.matrix(),s.gradient=this.gradient(t)}break;case 19:s.gradientMatrix=this.matrix(),s.gradient=this.focalGradient(t);break;case 64:case 65:case 66:case 67:switch(s.bitmapId=this.byteStream.getUI16(),t){case 46:case 84:s.startBitmapMatrix=this.matrix(),s.endBitmapMatrix=this.matrix();break;default:s.bitmapMatrix=this.matrix()}}return s}rgb(){return{R:0|this.byteStream.getUI8(),G:0|this.byteStream.getUI8(),B:0|this.byteStream.getUI8(),A:1}}rgba(){return{R:this.byteStream.getUI8(),G:this.byteStream.getUI8(),B:this.byteStream.getUI8(),A:this.byteStream.getUI8()/255}}matrix(){this.byteStream.byteAlign();const t=[1,0,0,1,0,0];if(this.byteStream.getUIBit()){const e=this.byteStream.getUIBits(5);t[0]=this.byteStream.getSIBits(e)/65536,t[3]=this.byteStream.getSIBits(e)/65536}if(this.byteStream.getUIBit()){const e=this.byteStream.getUIBits(5);t[1]=this.byteStream.getSIBits(e)/65536,t[2]=this.byteStream.getSIBits(e)/65536}const e=this.byteStream.getUIBits(5);return t[4]=this.byteStream.getSIBits(e)/20,t[5]=this.byteStream.getSIBits(e)/20,t}gradient(t){let e,s=0,a=0;switch(this.byteStream.byteAlign(),t){case 46:case 84:e=this.byteStream.getUI8();break;default:s=this.byteStream.getUIBits(2),a=this.byteStream.getUIBits(2),e=this.byteStream.getUIBits(4)}const i=[];for(let s=0;s<e;++s)i[i.length]=this.gradientRecord(t);return{SpreadMode:s,InterpolationMode:a,GradientRecords:i,FocalPoint:0}}gradientRecord(t){switch(t){case 46:case 84:return{StartRatio:this.byteStream.getUI8()/255,StartColor:this.rgba(),EndRatio:this.byteStream.getUI8()/255,EndColor:this.rgba()};default:return{Ratio:this.byteStream.getUI8()/255,Color:t<32?this.rgb():this.rgba()}}}focalGradient(t){this.byteStream.byteAlign();const e=this.byteStream.getUIBits(2),s=this.byteStream.getUIBits(2),a=this.byteStream.getUIBits(4),i=[];for(let e=0;e<a;++e)i[i.length]=this.gradientRecord(t);return{SpreadMode:e,InterpolationMode:s,GradientRecords:i,FocalPoint:this.byteStream.getFloat16()}}lineStyleArray(t){let e=this.byteStream.getUI8();t>2&&255===e&&(e=this.byteStream.getUI16());const s=[];for(let a=0;a<e;++a)s[s.length]=this.lineStyles(t);return s}lineStyles(t){const e={fillStyleType:0};switch(t){case 46:e.StartWidth=this.byteStream.getUI16()/20,e.EndWidth=this.byteStream.getUI16()/20,e.StartColor=this.rgba(),e.EndColor=this.rgba();break;case 84:e.StartWidth=this.byteStream.getUI16()/20,e.EndWidth=this.byteStream.getUI16()/20,e.StartCapStyle=this.byteStream.getUIBits(2),e.JoinStyle=this.byteStream.getUIBits(2),e.HasFillFlag=this.byteStream.getUIBit(),e.NoHScaleFlag=this.byteStream.getUIBit(),e.NoVScaleFlag=this.byteStream.getUIBit(),e.PixelHintingFlag=this.byteStream.getUIBit(),this.byteStream.getUIBits(5),e.NoClose=this.byteStream.getUIBit(),e.EndCapStyle=this.byteStream.getUIBits(2),2===e.JoinStyle&&(e.MiterLimitFactor=this.byteStream.getUI16()/20),e.HasFillFlag?e.FillType=this.fillStyle(t):(e.StartColor=this.rgba(),e.EndColor=this.rgba());break;case 83:e.Width=this.byteStream.getUI16()/20,e.StartCapStyle=this.byteStream.getUIBits(2),e.JoinStyle=this.byteStream.getUIBits(2),e.HasFillFlag=this.byteStream.getUIBit(),e.NoHScaleFlag=this.byteStream.getUIBit(),e.NoVScaleFlag=this.byteStream.getUIBit(),e.PixelHintingFlag=this.byteStream.getUIBit(),this.byteStream.getUIBits(5),e.NoClose=this.byteStream.getUIBit(),e.EndCapStyle=this.byteStream.getUIBits(2),2===e.JoinStyle&&(e.MiterLimitFactor=this.byteStream.getUI16()),e.HasFillFlag?e.FillType=this.fillStyle(t):e.Color=this.rgba();break;case 32:e.Width=this.byteStream.getUI16()/20,e.Color=this.rgba(),e.JoinStyle=0,e.StartCapStyle=0,e.EndCapStyle=0;break;default:e.Width=this.byteStream.getUI16()/20,e.Color=this.rgb(),e.JoinStyle=0,e.StartCapStyle=0,e.EndCapStyle=0}return e}shapeRecords(t,e){this.currentPosition.x=0,this.currentPosition.y=0;const s=[],a=[];for(;;){const i=this.byteStream.getUIBits(6);if(32&i){const e=15&i;if(16&i){this.straightEdgeRecord(t,e,s);continue}this.curvedEdgeRecord(t,e,s)}else{if(!i){s.push(-1),this.byteStream.byteAlign();break}this.styleChangeRecord(t,i,e,s,a)}}const i={records:new Int32Array(s)};return a.length&&(i.styles=a),i}straightEdgeRecord(t,e,s){let a=0,i=0;this.byteStream.getUIBit()?(a=this.byteStream.getSIBits(e+2),i=this.byteStream.getSIBits(e+2)):this.byteStream.getUIBit()?i=this.byteStream.getSIBits(e+2):a=this.byteStream.getSIBits(e+2);let r=a,h=i;switch(t){case 46:case 84:break;default:r=this.currentPosition.x+a,h=this.currentPosition.y+i,this.currentPosition.x=r,this.currentPosition.y=h}s.push(0,0,r,h)}curvedEdgeRecord(t,e,s){const a=this.byteStream.getSIBits(e+2),i=this.byteStream.getSIBits(e+2),r=this.byteStream.getSIBits(e+2),h=this.byteStream.getSIBits(e+2);let o=a,n=i,l=r,c=h;switch(t){case 46:case 84:break;default:o=this.currentPosition.x+a,n=this.currentPosition.y+i,l=o+r,c=n+h,this.currentPosition.x=l,this.currentPosition.y=c}s.push(0,1,o,n,l,c)}styleChangeRecord(t,e,s,a,i){const r=e>>4&1,h=e>>3&1,o=e>>2&1,n=e>>1&1,l=1&e;let c=0,b=0;if(l){const t=this.byteStream.getUIBits(5);c=this.byteStream.getSIBits(t),b=this.byteStream.getSIBits(t),this.currentPosition.x=c,this.currentPosition.y=b}const g=n?this.byteStream.getUIBits(s.FillBits):0,y=o?this.byteStream.getUIBits(s.FillBits):0,S=h?this.byteStream.getUIBits(s.LineBits):0;let m=null,f=null,d=0,Y=0;if(r){m=this.fillStyleArray(t),f=this.lineStyleArray(t);const e=this.byteStream.getUI8();s.FillBits=d=e>>4,s.LineBits=Y=15&e}a.push(1,r),r&&(a.push(d,Y),i.push({FillStyles:m,LineStyles:f})),a.push(l),l&&a.push(c,b),a.push(n),n&&a.push(g),a.push(o),o&&a.push(y),a.push(h),h&&a.push(S)}parseDefineBitsLossLess(t,e){const s=this.byteStream.byte_offset,a=this.byteStream.getUI16(),i=this.byteStream.getUI8(),r=this.byteStream.getUI16(),h=this.byteStream.getUI16(),o=36===t,n=3===i?this.byteStream.getUI8()+1:0;let l=r*h*4;if(3===i){l=(r+((r+3&-4)-r|0))*h+n*(o?4:3)}const c=e-(this.byteStream.byte_offset-s),b=this.byteStream.byte_offset;this.byteStream.byte_offset+=c;const g=this.byteStream.data.slice(b,this.byteStream.byte_offset),y={width:r,height:h,format:i,fileSize:l,tableSize:n,isAlpha:o,color:o?4278190080:0,_$name:"lossless",_$characterId:a,buffer:g};this.setCharacter(a,y,[g.buffer])}parseJPEGTables(t){const e=this.byteStream.byte_offset;return this.byteStream.byte_offset+=t,{offset:e,length:this.byteStream.byte_offset}}parseDefineBits(t,e,s=null){const a=this.byteStream.byte_offset,i=this.byteStream.getUI16(),r=this.byteStream.byte_offset-a,h=35===t||90===t?this.byteStream.getUI32():e-r;if(90===t){const t=this.byteStream.getUI16();console.log("TODO DeblockParam",t)}const o=this.byteStream.byte_offset;this.byteStream.byte_offset+=h;let n=this.byteStream.data.slice(o,this.byteStream.byte_offset);if(s){const t=this.byteStream.data.subarray(s.offset,s.length);if(t.length>4&&255===n[0]&&216===n[1]){const e=t.length-2,s=n.length,a=new Uint8Array(e+s);a.set(t.subarray(0,e),0),a.set(n.subarray(2,s),e),n=a}}const l={infoKey:"character",_$name:"imageData",_$characterId:i,jpegData:n,alphaData:null},c=[];c.push(n.buffer);let b=!1;const g=a+e-this.byteStream.byte_offset;if(g){b=!0;const t=this.byteStream.byte_offset;this.byteStream.byte_offset+=g;const e=this.byteStream.data.slice(t,this.byteStream.byte_offset);l.alphaData=e,c.push(e.buffer)}l.isAlpha=b,l.color=b?4278190080:0,this.setCharacter(i,l,c)}parseDefineFont(t,e){const s=this.byteStream.byte_offset+e|0,a=this.byteStream.getUI16(),i=this.getFont(a)||{};let r=0,h=0,o=0;if(48===t||75===t){const t=this.byteStream.getUI8();i._$hasLayout=t>>>7&1,i._$shiftJIS=t>>>6&1,i._$smallText=t>>>5&1,i._$ANSI=t>>>4&1,h=t>>>3&1,o=t>>>2&1,i._$italic=t>>>1&1,i._$bold=1&t,this.byteStream.byteAlign(),i._$languageCode=this.byteStream.getUI8();const e=this.byteStream.getUI8();if(e){const t=0|this.byteStream.byte_offset;i._$fontName=this.getFontName(this.byteStream.getDataUntil()),this.byteStream.byte_offset=t+e|0}r=this.byteStream.getUI16(),i._$numGlyphs=r}const n=0|this.byteStream.byte_offset;if(10===t&&(r=this.byteStream.getUI16()),r){const e=[];10===t&&(e[0]=r,r/=2,r-=1);let s=0;if(1===h){for(let t=0;t<r;++t)e[e.length]=this.byteStream.getUI32();10!==t&&(s=this.byteStream.getUI32())}else{for(let t=0;t<r;++t)e[e.length]=this.byteStream.getUI16();10!==t&&(s=this.byteStream.getUI16())}const a=[];10===t&&(r+=1);for(let s=0;s<r;++s){this.byteStream.setOffset(e[s]+n,0);const i=this.byteStream.getUI8(),r={FillBits:i>>4,LineBits:15&i};a[a.length]=this.shapeRecords(t,r)}switch(i._$glyphShapeTable=a,t){case 48:case 75:if(this.byteStream.setOffset(s+n,0),1===o){const t=new Uint16Array(r);for(let e=0;e<r;++e)t[e]=this.byteStream.getUI16();i._$codeTable=t}else{const t=new Uint8Array(r);for(let e=0;e<r;++e)t[e]=this.byteStream.getUI8();i._$codeTable=t}if(i._$hasLayout){i._$ascent=this.byteStream.getUI16(),i._$descent=this.byteStream.getUI16(),i._$leading=this.byteStream.getUI16();const e=new Uint16Array(r);for(let t=0;t<r;++t)e[t]=this.byteStream.getUI16();i._$advanceTable=e;const s=[];for(let t=0;t<r;++t)s[s.length]=this.rect();if(75===t){const t=this.byteStream.getUI16(),e=[];for(let s=0;s<t;++s){const t=o?this.byteStream.getUI16():this.byteStream.getUI8(),s=o?this.byteStream.getUI16():this.byteStream.getUI8(),a=this.byteStream.getSIBits(16);e[e.length]={FontKerningCode1:t,FontKerningCode2:s,FontKerningAdjustment:a}}i._$kerningRecords=e}}}}this.byteStream.byte_offset=0|s,this.setFont(a,i)}parseDefineFontInfo(t,e){const s=this.byteStream.byte_offset+e|0,a=this.byteStream.getUI16();let i=this.getFont(a);i||(i={});const r=this.byteStream.getUI8(),h=this.byteStream.getData(r);let o="";for(let t=0;t<r;++t)h[t]>127||(o+=String.fromCharCode(h[t]));this.byteStream.getUIBits(2),i._$smallText=this.byteStream.getUIBits(1),i._$shiftJIS=this.byteStream.getUIBits(1),i._$ANSI=this.byteStream.getUIBits(1),i._$italic=this.byteStream.getUIBits(1),i._$bold=this.byteStream.getUIBits(1);const n=this.byteStream.getUIBits(1);62===t&&(i._$languageCode=this.byteStream.getUI8());const l=i._$shiftJIS||2===i._$languageCode?Util.$decodeToShiftJis(o):decodeURIComponent(o);i._$fontName=this.getFontName(l),this.byteStream.byteAlign();const c=[];let b=null;if(!0==(1===n||62===t)){for(;this.byteStream.byte_offset<s;)c[c.length]=this.byteStream.getUI16();b=new Uint16Array(c)}else{for(;this.byteStream.byte_offset<s;)c[c.length]=this.byteStream.getUI8();b=new Uint8Array(c)}i._$codeTable=b,this.setFont(a,i)}getFontName(t){const e=0|t.length;switch(0===t.substr(e-1).charCodeAt(0)&&(t=t.slice(0,-1)),t){case"_sans":return"_sans";case"_serif":return"_serif";case"_typewriter":return"_typewriter";case"_等幅":return"Osaka";default:return"_"===t.substr(0,1)?"sans-serif":t}}parseDefineFontName(){this.byteStream.getUI16(),this.byteStream.getDataUntil(),this.byteStream.getDataUntil()}parseDefineText(t){const e={_$name:"StaticText"};e._$characterId=0|this.byteStream.getUI16(),e._$bounds=this.rect(),e._$baseMatrix=this.matrix(),e._$shapeRecords=null;const s=this.byteStream.getUI8(),a=this.byteStream.getUI8();e._$textRecords=this.getTextRecords(t,s,a),this.setCharacter(e._$characterId,e)}getTextRecords(t,e,s){const a=[];for(;0!==this.byteStream.getUI8();){this.byteStream.incrementOffset(-1,0);const i={};i.TextRecordType=this.byteStream.getUIBits(1),i.StyleFlagsReserved=this.byteStream.getUIBits(3),i.StyleFlagsHasFont=this.byteStream.getUIBits(1),i.StyleFlagsHasColor=this.byteStream.getUIBits(1),i.StyleFlagsHasYOffset=this.byteStream.getUIBits(1),i.StyleFlagsHasXOffset=this.byteStream.getUIBits(1),i.StyleFlagsHasFont&&(i.FontId=this.byteStream.getUI16()),i.StyleFlagsHasColor&&(i.TextColor=11===t?this.rgb():this.rgba()),i.StyleFlagsHasXOffset&&(i.XOffset=this.byteStream.getUI16()/20),i.StyleFlagsHasYOffset&&(i.YOffset=this.byteStream.getUI16()/20),i.StyleFlagsHasFont&&(i.TextHeight=this.byteStream.getUI16()),i.GlyphCount=this.byteStream.getUI8(),i.GlyphEntries=this.getGlyphEntries(i.GlyphCount,e,s),a[a.length]=i}return a}getGlyphEntries(t,e,s){const a=[];for(let i=0;i<t;++i)a[a.length]={GlyphIndex:this.byteStream.getUIBits(e),GlyphAdvance:this.byteStream.getSIBits(s)/20};return a}parseDefineEditText(){const t={_$ns:["flash","text"],_$name:"TextField"},e={},s=this.byteStream.getUI16();t._$characterId=s,t._$bounds=this.rect();const a=this.byteStream.getUI8(),i=a>>>7&1;t._$wordWrap=a>>>6&1,t._$multiline=a>>>5&1,t._$displayAsPassword=a>>>4&1;const r=a>>>3&1;t._$type="dynamic",r||(t._$type="input");const h=a>>>2&1,o=a>>>1&1,n=1&a,l=this.byteStream.getUI8(),c=l>>>7&1,b=l>>>5&1;t._$selectable=l>>>4&1,t._$border=l>>>3&1;const g=l>>>1&1,y=1&l;t._$border&&(t._$background=!0);let S=0;if(n){const s=this.byteStream.getUI16(),a=this.getFont(s);if(a){if(S=a._$shiftJIS,c){const t=this.byteStream.getDataUntil();console.log("TODO HasFontClass: ",t)}e._$font=a._$fontName,e._$size=this.byteStream.getUI16()/20,t._$fontId=0|s,t._$embedFonts=!(!y&&"embedded"!==a.fontType||t.displayAsPassword)}}if(h){const e=this.rgba();t._$textColor=(e.R<<16)+(e.G<<8)+e.B+255*e.A*16777216}if(o&&(t._$maxChars=this.byteStream.getUI16()),b){switch(this.byteStream.getUI8()){case 0:e._$align="left";break;case 1:e._$align="right";break;case 2:e._$align="center";break;case 3:e._$align="justify"}e._$leftMargin=this.byteStream.getUI16()/20,e._$rightMargin=this.byteStream.getUI16()/20,e._$indent=this.byteStream.getUI16(),e._$indent>=32768&&(e._$indent-=65536),e._$leading=this.byteStream.getUI16(),e._$leading>=32768&&(e._$leading-=65536),e._$indent/=20,e._$leading/=20}const m=this.byteStream.getDataUntil(S)+"";if(t._$text="",i){const e=this.byteStream.getDataUntil(S);if(!0==(1===g))t._$htmlText=e,t._$initText=!0;else t._$text=e}""!==m&&console.log("VariableName: ",m),t._$defaultTextFormat=[null,e._$font,e._$size,e._$color,e._$bold,e._$italic,e._$underline,e._$url,e._$target,e._$align,e._$leftMargin,e._$rightMargin,0,e._$leading,e._$indent],this.setCharacter(s,t)}parseDefineMorphShape(t){const e={};e.CharacterId=this.byteStream.getUI16(),e.StartBounds=this.rect(),e.EndBounds=this.rect(),84===t&&(e.StartEdgeBounds=this.rect(),e.EndEdgeBounds=this.rect(),this.byteStream.getUIBits(6),e.UsesNonScalingStrokes=this.byteStream.getUIBits(1),e.UsesScalingStrokes=this.byteStream.getUIBits(1));const s=this.byteStream.getUI32(),a=this.byteStream.byte_offset+s;e.MorphFillStyles=this.fillStyleArray(t),e.MorphLineStyles=this.lineStyleArray(t),e.StartEdges=this.shapeWithStyle(t),this.byteStream.byte_offset!==a&&(this.byteStream.byte_offset=a),e.EndEdges=this.shapeWithStyle(t);const i={x:0,y:0},r={x:0,y:0},h=e.StartEdges.ShapeData.records,o=e.EndEdges.ShapeData.records,n=h.length,l=o.length;let c=Math.max(n,l);const b=[],g=[];let y=0,S=0;for(;c>y||c>S;){const t=h[y++],e=o[S++];if(-1===t&&-1===e)break;switch(!0){case-1===t:case void 0===t:if(e){const t=o[S++];if(g.push(1,t),b.push(1,t),t){const t=o[S++],e=o[S++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=o[S++];if(g.push(e),b.push(e),e){const t=o[S++],e=o[S++];r.x=t,r.y=e,g.push(t,e),b.push(t,e)}const s=o[S++];if(g.push(s),b.push(s),s){const t=o[S++];g.push(t),b.push(t)}const a=o[S++];if(g.push(a),b.push(a),a){const t=o[S++];g.push(t),b.push(t)}const i=o[S++];if(g.push(i),b.push(i),i){const t=o[S++];g.push(t),b.push(t)}break}if(o[S++]){const t=o[S++],e=o[S++],s=o[S++],a=o[S++];r.x+=t+s,r.y+=e+a,g.push(0,1,t,e,s,a),b.push(0,1,t,e,s,a)}else{const t=o[S++],e=o[S++];r.x+=t,r.y+=e,g.push(0,0,t,e),b.push(0,0,t,e)}break;case-1===e:case void 0===e:if(t){const t=h[y++];if(g.push(1,t),b.push(1,t),t){const t=h[y++],e=h[y++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=h[y++];if(g.push(e),b.push(e),e){const t=h[y++],e=h[y++];i.x=t,i.y=e,g.push(t,e),b.push(t,e)}const s=h[y++];if(g.push(s),b.push(s),s){const t=h[y++];g.push(t),b.push(t)}const a=h[y++];if(g.push(a),b.push(a),a){const t=h[y++];g.push(t),b.push(t)}const r=h[y++];if(g.push(r),b.push(r),r){const t=h[y++];g.push(t),b.push(t)}break}if(h[y++]){const t=h[y++],e=h[y++],s=h[y++],a=h[y++];i.x+=t+s,i.y+=e+a,g.push(0,1,t,e,s,a),b.push(0,1,t,e,s,a)}else{const t=h[S++],e=h[S++];i.x+=t,i.y+=e,g.push(0,0,t,e),b.push(0,0,t,e)}break;case 1===t&&1===e:const s=h[y++];if(b.push(1,s),s){const t=h[y++],e=h[y++];b.push(t,e),console.log("TODO Parse Morph NewStyles")}const a=h[y++];if(b.push(a),a){const t=h[y++],e=h[y++];i.x=t,i.y=e,b.push(t,e)}const n=h[y++];if(b.push(n),n){const t=h[y++];b.push(t)}const l=h[y++];if(b.push(l),l){const t=h[y++];b.push(t)}const c=h[y++];if(b.push(c),c){const t=h[y++];b.push(t)}const m=o[S++];if(g.push(1,m),m){const t=o[S++],e=o[S++];g.push(t,e),console.log("TODO Parse Morph NewStyles")}const f=o[S++];if(g.push(f),f){const t=o[S++],e=o[S++];i.x=t,i.y=e,g.push(t,e)}const d=o[S++];if(g.push(d),d){const t=o[S++];g.push(t)}const Y=o[S++];if(g.push(Y),Y){const t=o[S++];g.push(t)}const I=o[S++];if(g.push(I),I){const t=o[S++];g.push(t)}break;case 0===t&&0===e:if(h[y++]){const t=h[y++],e=h[y++],s=h[y++],a=h[y++];i.x=s,i.y=a,b.push(0,1,t,e,s,a)}else{const t=h[y++],e=h[y++];i.x=t,i.y=e,b.push(0,0,t,e)}if(o[S++]){const t=o[S++],e=o[S++],s=o[S++],a=o[S++];r.x=s,r.y=a,g.push(0,1,t,e,s,a)}else{const t=o[S++],e=o[S++];r.x=t,r.y=e,g.push(0,0,t,e)}break;case 1===t&&0===e:{const t=h[y++];if(g.push(1,t),b.push(1,t),t){const t=h[y++],e=h[y++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=h[y++];if(g.push(e),b.push(e),e){const t=h[y++],e=h[y++];i.x=t,i.y=e,g.push(t,e),b.push(t,e)}const s=h[y++];if(g.push(s),b.push(s),s){const t=h[y++];g.push(t),b.push(t)}const a=h[y++];if(g.push(a),b.push(a),a){const t=h[y++];g.push(t),b.push(t)}const r=h[y++];if(g.push(r),b.push(r),r){const t=h[y++];g.push(t),b.push(t)}--S}break;case 0===t&&1===e:{const t=o[S++];if(g.push(1,t),b.push(1,t),t){const t=o[S++],e=o[S++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=o[S++];if(g.push(e),b.push(e),e){const t=o[S++],e=o[S++];r.x=t,r.y=e,g.push(t,e),b.push(t,e)}const s=o[S++];if(g.push(s),b.push(s),s){const t=o[S++];g.push(t),b.push(t)}const a=o[S++];if(g.push(a),b.push(a),a){const t=o[S++];g.push(t),b.push(t)}const i=o[S++];if(g.push(i),b.push(i),i){const t=o[S++];g.push(t),b.push(t)}--y}}}b.push(-1),g.push(-1),e.StartEdges.ShapeData.records=new Int32Array(b),e.EndEdges.ShapeData.records=new Int32Array(g),this.setCharacter(e.CharacterId,{_$ns:["flash","display"],_$name:"MorphShape",_$characterId:e.CharacterId,_$endBounds:e.EndBounds,_$endEdges:e.EndEdges,_$fillStyles:e.MorphFillStyles,_$lineStyles:e.MorphLineStyles,_$startBounds:e.StartBounds,_$startEdges:e.StartEdges,_$shapes:null,_$frameData:[],_$frameCreated:!1},[e.StartEdges.ShapeData.records.buffer,e.EndEdges.ShapeData.records.buffer])}parseFrameLabel(){return{name:this.byteStream.getDataUntil(),frame:0}}parseDefineButton(t,e){const s=this.byteStream.byte_offset+e|0,a={_$ns:["flash","display"],_$name:"SimpleButton"};a._$characterId=0|this.byteStream.getUI16();let i=0;7!==t&&(this.byteStream.getUIBits(7),a._$trackAsMenu=!!this.byteStream.getUIBits(1),i=0|this.byteStream.getUI16()),a._$characters=this.buttonCharacters(s),7===t?(i=s-this.byteStream.byte_offset|0,this.byteStream.byte_offset+=i):i>0&&(a._$actions=this.buttonActions(s)),this.setCharacter(a._$characterId,a),this.byteStream.byte_offset!==s&&(this.byteStream.byte_offset=0|s)}buttonCharacters(t){const e=[];for(;0!==this.byteStream.getUI8();){this.byteStream.incrementOffset(-1,0);const s=0|this.byteStream.byte_offset,a=this.buttonRecord();if(this.byteStream.byte_offset>t){this.byteStream.byte_offset=0|s;break}e[e.length]=a}return e}buttonRecord(){this.byteStream.getUIBits(2);const t={};return t.PlaceFlagHasBlendMode=this.byteStream.getUIBits(1),t.PlaceFlagHasFilterList=this.byteStream.getUIBits(1),t.ButtonStateHitTest=this.byteStream.getUIBits(1),t.ButtonStateDown=this.byteStream.getUIBits(1),t.ButtonStateOver=this.byteStream.getUIBits(1),t.ButtonStateUp=this.byteStream.getUIBits(1),t.CharacterId=this.byteStream.getUI16(),t.Depth=this.byteStream.getUI16(),t.PlaceFlagHasMatrix=1,t.Matrix=this.matrix(),t.ColorTransform=this.colorTransform(),t.PlaceFlagHasColorTransform=void 0===t.ColorTransform?0:1,t.PlaceFlagHasBlendMode&&(t.BlendMode=this.byteStream.getUI8()),t.PlaceFlagHasFilterList&&(t.SurfaceFilterList=this.getFilterList()),t.PlaceFlagHasRatio=0,t.PlaceFlagHasClipDepth=0,t.Sound=null,t}buttonActions(t){for(;;){const e={},s=0|this.byteStream.byte_offset,a=this.byteStream.getUI16();e.CondIdleToOverDown=this.byteStream.getUIBits(1),e.CondOutDownToIdle=this.byteStream.getUIBits(1),e.CondOutDownToOverDown=this.byteStream.getUIBits(1),e.CondOverDownToOutDown=this.byteStream.getUIBits(1),e.CondOverDownToOverUp=this.byteStream.getUIBits(1),e.CondOverUpToOverDown=this.byteStream.getUIBits(1),e.CondOverUpToIdle=this.byteStream.getUIBits(1),e.CondIdleToOverUp=this.byteStream.getUIBits(1),e.CondKeyPress=this.byteStream.getUIBits(7),e.CondOverDownToIdle=this.byteStream.getUIBits(1);const i=t-this.byteStream.byte_offset+1|0;if(this.byteStream.byte_offset+=i,!a)break;this.byteStream.byte_offset=s+a|0}return[]}parsePlaceObject(t,e){const s=this.byteStream.byte_offset,a={};if(a.tagType=t,4===t)return a.CharacterId=this.byteStream.getUI16(),a.Depth=this.byteStream.getUI16(),a.Matrix=this.matrix(),a.PlaceFlagHasMatrix=1,this.byteStream.byteAlign(),this.byteStream.byte_offset-s<e&&(a.ColorTransform=this.colorTransform(),a.PlaceFlagHasColorTransform=1),this.byteStream.byteAlign(),this.byteStream.byte_offset=s+e,a;const i=this.swfVersion;if(a.PlaceFlagHasClipActions=this.byteStream.getUIBits(1),a.PlaceFlagHasClipDepth=this.byteStream.getUIBits(1),a.PlaceFlagHasName=this.byteStream.getUIBits(1),a.PlaceFlagHasRatio=this.byteStream.getUIBits(1),a.PlaceFlagHasColorTransform=this.byteStream.getUIBits(1),a.PlaceFlagHasMatrix=this.byteStream.getUIBits(1),a.PlaceFlagHasCharacter=this.byteStream.getUIBits(1),a.PlaceFlagMove=this.byteStream.getUIBits(1),70===t&&(this.byteStream.getUIBits(1),a.PlaceFlagOpaqueBackground=this.byteStream.getUIBits(1),a.PlaceFlagHasVisible=this.byteStream.getUIBits(1),a.PlaceFlagHasImage=this.byteStream.getUIBits(1),a.PlaceFlagHasClassName=this.byteStream.getUIBits(1),a.PlaceFlagHasCacheAsBitmap=this.byteStream.getUIBits(1),a.PlaceFlagHasBlendMode=this.byteStream.getUIBits(1),a.PlaceFlagHasFilterList=this.byteStream.getUIBits(1)),a.Depth=this.byteStream.getUI16(),a.PlaceFlagHasClassName&&(a.ClassName=this.byteStream.getDataUntil(),console.log("TODO ",a.ClassName)),a.PlaceFlagHasCharacter&&(a.CharacterId=this.byteStream.getUI16()),a.PlaceFlagHasMatrix&&(a.Matrix=this.matrix()),a.PlaceFlagHasColorTransform&&(a.ColorTransform=this.colorTransform()),a.PlaceFlagHasRatio&&(a.Ratio=this.byteStream.getUI16()),a.PlaceFlagHasName&&(a.Name=this.byteStream.getDataUntil()),a.PlaceFlagHasClipDepth&&(a.ClipDepth=this.byteStream.getUI16()),70===t&&(a.PlaceFlagHasFilterList&&(a.SurfaceFilterList=this.getFilterList()),a.PlaceFlagHasBlendMode&&(a.BlendMode=this.byteStream.getUI8()),a.PlaceFlagHasCacheAsBitmap&&(a.BitmapCache=this.byteStream.getUI8()),a.PlaceFlagHasVisible&&(a.Visible=this.byteStream.getUI8()),a.PlaceFlagOpaqueBackground&&(a.BackgroundColor=this.rgba())),a.PlaceFlagHasClipActions){this.byteStream.getUI16(),a.AllEventFlags=this.parseClipEventFlags();const t=s+e;for(;this.byteStream.byte_offset<t;){const e=this.parseClipActionRecord(t);if(t<=this.byteStream.byte_offset)break;if(!(i<=5?this.byteStream.getUI16():this.byteStream.getUI32()))break;this.byteStream.byte_offset-=i<=5?2:4,e.KeyCode&&(this.byteStream.byte_offset-=1)}}return this.byteStream.byteAlign(),this.byteStream.byte_offset=s+e,a}parseClipActionRecord(t){const e={},s=this.parseClipEventFlags();if(t>this.byteStream.byte_offset){const t=this.byteStream.getUI32();s.keyPress&&(e.KeyCode=this.byteStream.getUI8()),this.byteStream.byte_offset+=t}return e}parseClipEventFlags(){const t=this.swfVersion,e={};return e.keyUp=this.byteStream.getUIBits(1),e.keyDown=this.byteStream.getUIBits(1),e.mouseUp=this.byteStream.getUIBits(1),e.mouseDown=this.byteStream.getUIBits(1),e.mouseMove=this.byteStream.getUIBits(1),e.unload=this.byteStream.getUIBits(1),e.enterFrame=this.byteStream.getUIBits(1),e.load=this.byteStream.getUIBits(1),t>=6&&(e.dragOver=this.byteStream.getUIBits(1),e.rollOut=this.byteStream.getUIBits(1),e.rollOver=this.byteStream.getUIBits(1),e.releaseOutside=this.byteStream.getUIBits(1),e.release=this.byteStream.getUIBits(1),e.press=this.byteStream.getUIBits(1),e.initialize=this.byteStream.getUIBits(1)),e.data=this.byteStream.getUIBits(1),t>=6&&(this.byteStream.getUIBits(5),e.construct=this.byteStream.getUIBits(1),e.keyPress=this.byteStream.getUIBits(1),e.dragOut=this.byteStream.getUIBits(1),this.byteStream.getUIBits(8)),this.byteStream.byteAlign(),e}getFilterList(){const t=0|this.byteStream.getUI8(),e=[];for(let s=0;s<t;++s){const t=this.getFilter();t&&(e[e.length]=t)}return e.length?e:null}getFilter(){switch(0|this.byteStream.getUI8()){case 0:return this.dropShadowFilter();case 1:return this.blurFilter();case 2:return this.glowFilter();case 3:return this.bevelFilter();case 4:return this.gradientGlowFilter();case 5:return this.convolutionFilter();case 6:return this.colorMatrixFilter();case 7:return this.gradientBevelFilter()}}dropShadowFilter(){const t={},e=this.rgba(),s=e.A,a=e.R<<16|e.G<<8|e.B,i=this.byteStream.getUI32()/65536,r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536*Util.$Rad2Deg,o=this.byteStream.getUI32()/65536,n=this.byteStream.getFloat16()/256,l=!!this.byteStream.getUIBits(1),c=!!this.byteStream.getUIBits(1),b=!this.byteStream.getUIBits(1),g=this.byteStream.getUIBits(5);return t._$ns=["flash","filters"],t._$name="DropShadowFilter",t.params=[null,o,h,a,s,i,r,n,g,l,c,b],t}blurFilter(){const t={},e=this.byteStream.getUI32()/65536,s=this.byteStream.getUI32()/65536,a=this.byteStream.getUIBits(5);return this.byteStream.getUIBits(3),t._$ns=["flash","filters"],t._$name="BlurFilter",t.params=[null,e,s,a],t}glowFilter(){const t={},e=this.rgba(),s=e.A,a=e.R<<16|e.G<<8|e.B,i=this.byteStream.getUI32()/65536,r=this.byteStream.getUI32()/65536,h=this.byteStream.getFloat16()/256,o=!!this.byteStream.getUIBits(1),n=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const l=this.byteStream.getUIBits(5);return t._$ns=["flash","filters"],t._$name="GlowFilter",t.params=[null,a,s,i,r,h,l,o,n],t}bevelFilter(){const t={};let e=this.rgba();const s=e.A,a=e.R<<16|e.G<<8|e.B;e=this.rgba();const i=e.A,r=e.R<<16|e.G<<8|e.B,h=this.byteStream.getUI32()/65536,o=this.byteStream.getUI32()/65536,n=this.byteStream.getUI32()/65536*Util.$Rad2Deg,l=this.byteStream.getUI32()/65536,c=this.byteStream.getFloat16()/256,b=!!this.byteStream.getUIBits(1),g=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const y=this.byteStream.getUIBits(1),S=this.byteStream.getUIBits(4);let m="inner";return b||(m=y?"full":"outer"),t._$ns=["flash","filters"],t._$name="BevelFilter",t.params=[null,l,n,a,s,r,i,h,o,c,S,m,g],t}gradientGlowFilter(){const t={},e=0|this.byteStream.getUI8(),s=[],a=[];for(let t=0;t<e;++t){const t=this.rgba();a[a.length]=t.A,s[s.length]=t.R<<16|t.G<<8|t.B|0}const i=[];for(let t=0;t<e;++t)i[i.length]=+this.byteStream.getUI8()/255;const r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536,o=this.byteStream.getUI32()/65536*Util.$Rad2Deg,n=this.byteStream.getUI32()/65536,l=this.byteStream.getFloat16()/256,c=!!this.byteStream.getUIBits(1),b=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const g=this.byteStream.getUIBits(1),y=this.byteStream.getUIBits(4);let S="inner";return c||(S=g?"full":"outer"),t._$ns=["flash","filters"],t._$name="GradientGlowFilter",t.params=[null,n,o,s,a,i,r,h,l,y,S,b],t}convolutionFilter(){const t={},e=this.byteStream.getUI8(),s=this.byteStream.getUI8(),a=this.byteStream.getFloat32,i=this.byteStream.getFloat32,r=e*s,h=[];for(let t=0;t<r;++t)h[h.length]=this.byteStream.getFloat32();const o=this.rgba();this.byteStream.getUIBits(6);const n=!!this.byteStream.getUIBits(1),l=!!this.byteStream.getUIBits(1);return t._$ns=["flash","filters"],t._$name="ConvolutionFilter",t.params=[null,e,s,h,a,i,l,n,o],t}gradientBevelFilter(){const t={},e=0|this.byteStream.getUI8(),s=[],a=[];for(let t=0;t<e;++t){const t=this.rgba();a[a.length]=t.A,s[s.length]=t.R<<16|t.G<<8|t.B|0}const i=[];for(let t=0;t<e;++t)i[i.length]=+this.byteStream.getUI8()/255;const r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536,o=this.byteStream.getUI32()/65536*Util.$Rad2Deg,n=this.byteStream.getUI32()/65536,l=this.byteStream.getFloat16()/256,c=!!this.byteStream.getUIBits(1),b=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const g=this.byteStream.getUIBits(1),y=this.byteStream.getUIBits(4);let S="inner";return c||(S=g?"full":"outer"),t._$ns=["flash","filters"],t._$name="GradientBevelFilter",t.params=[null,n,o,s,a,i,r,h,l,y,S,b],t}colorMatrixFilter(){const t={},e=[];for(let t=0;t<20;t++)e[e.length]=this.byteStream.getFloat32();return t._$ns=["flash","filters"],t._$name="ColorMatrixFilter",t.params=[null,e],t}colorTransform(){this.byteStream.byteAlign();const t=[1,1,1,1,0,0,0,0],e=this.byteStream.getUIBits(6),s=e>>5,a=15&e;return e>>4&1&&(t[0]=this.byteStream.getSIBits(a)/256,t[1]=this.byteStream.getSIBits(a)/256,t[2]=this.byteStream.getSIBits(a)/256,t[3]=this.byteStream.getSIBits(a)/256),s&&(t[4]=this.byteStream.getSIBits(a),t[5]=this.byteStream.getSIBits(a),t[6]=this.byteStream.getSIBits(a),t[7]=this.byteStream.getSIBits(a)),t}parseSoundStreamHead(t){const e={};e.tagType=t,this.byteStream.getUIBits(4),e.PlaybackSoundRate=this.byteStream.getUIBits(2),e.PlaybackSoundSize=this.byteStream.getUIBits(1),e.PlaybackSoundType=this.byteStream.getUIBits(1),e.StreamSoundCompression=this.byteStream.getUIBits(4),e.StreamSoundRate=this.byteStream.getUIBits(2),e.StreamSoundSize=this.byteStream.getUIBits(1),e.StreamSoundType=this.byteStream.getUIBits(1),e.StreamSoundSampleCount=this.byteStream.getUI16(),2===e.StreamSoundCompression&&(e.LatencySeek=this.byteStream.getSIBits(2))}parseDefineSound(t){const e=this.byteStream.byte_offset,s=this.byteStream.getUI16();this.byteStream.getUIBits(4),this.byteStream.getUIBits(2),this.byteStream.getUIBit(),this.byteStream.getUIBit(),this.byteStream.getUI32();const a=t-(this.byteStream.byte_offset-e),i={_$characterId:s,_$data:null,_$buffer:null};i._$length=this.byteStream.byte_offset+a,i._$offset=this.byteStream.byte_offset,this.byteStream.byte_offset=e+t,this.setCharacter(s,i)}parseStartSound(t){const e={};return e.SoundId=this.byteStream.getUI16(),89===t&&(e.SoundClassName=this.byteStream.getDataUntil()),e.SoundInfo=this.parseSoundInfo(),e}parseDefineButtonSound(){const t=this.byteStream.getUI16(),e=this.getCharacter(t);for(let t=0;t<4;t++){const s=this.byteStream.getUI16();if(s){const a=this.parseSoundInfo();switch(t){case 0:e.ButtonStateUpSoundInfo=a,e.ButtonStateUpSoundId=s;break;case 1:e.ButtonStateOverSoundInfo=a,e.ButtonStateOverSoundId=s;break;case 2:e.ButtonStateDownSoundInfo=a,e.ButtonStateDownSoundId=s;break;case 3:e.ButtonStateHitTestSoundInfo=a,e.ButtonStateHitTestSoundId=s}}}this.setCharacter(t,e)}parseSoundInfo(){this.byteStream.getUIBits(2);const t={};if(t.SyncStop=this.byteStream.getUIBit(),t.SyncNoMultiple=this.byteStream.getUIBit(),t.HasEnvelope=this.byteStream.getUIBit(),t.HasLoops=this.byteStream.getUIBit(),t.HasOutPoint=this.byteStream.getUIBit(),t.HasInPoint=this.byteStream.getUIBit(),t.HasInPoint&&(t.InPoint=this.byteStream.getUI32()),t.HasOutPoint&&(t.OutPoint=this.byteStream.getUI32()),t.HasLoops&&(t.LoopCount=this.byteStream.getUI16()),t.HasEnvelope){const e=this.byteStream.getUI8(),s=[];for(let t=0;t<e;++t)s[t]={Pos44:this.byteStream.getUI32(),LeftLevel:this.byteStream.getUI16(),RightLevel:this.byteStream.getUI16()};t.EnvPoints=e,t.EnvelopeRecords=s}return t}parseDefineFontAlignZones(){const t=this.byteStream.getUI16(),e=this.getFont(t)||{};e._$CSMTableHint=this.byteStream.getUIBits(2),this.byteStream.getUIBits(6);const s=0|e._$numGlyphs,a=[];for(let t=0;t<s;++t){const e=this.byteStream.getUI8(),s=[];for(let t=0;t<e;++t)s.push(this.byteStream.getFloat16()),s.push(this.byteStream.getFloat16());this.byteStream.getUIBits(6),this.byteStream.getUIBits(1),this.byteStream.getUIBits(1),a[t]=s}this.byteStream.byteAlign(),e._$zoneTable=a,this.setFont(t,e)}parseCSMTextSettings(t){const e=this.byteStream.getUI16(),s={};s.tagType=t,s.UseFlashType=this.byteStream.getUIBits(2),s.GridFit=this.byteStream.getUIBits(3),this.byteStream.getUIBits(3),s.Thickness=this.byteStream.getUI32(),s.Sharpness=this.byteStream.getUI32(),this.byteStream.getUI8(),this.setTextSetting(e,s)}parseSoundStreamBlock(t,e){const s={};s.tagType=t,s.compressed=this.byteStream.getData(e)}parseDefineScalingGrid(){const t=this.byteStream.getUI16(),e=this.rect();this.setGrid(t,e)}postCharacter(t,e){globalThis.postMessage({infoKey:"_$characters",characters:t},e),t.length=0,e&&(e.length=0)}}Util.$swfParser=new SwfParser,this.addEventListener("message",(function(t){const e=Util.$swfParser;e.version=t.data.version,e.byteStream.setData(t.data.buffer),e.byteStream.byte_offset=t.data.offset;const s=Util.$createMovieClip();e.parseTags(t.data.buffer.length,s),e.postData(s),e.clear()}));'],{type:"text/javascript"})),d.$parserWorker=null,d.$parserQueues=[],d.$parserWorkerWait=!1,d.$unlzmaHandler=function(e){if(e.target.onmessage=null,d.$unlzmaQueues.length){const e=d.$unlzmaQueues.shift(),t=new Worker(d.$unlzmaWorkerURL);t.onmessage=d.$unlzmaHandler.bind(e);const r=e._$byteStream._$buffer;t.postMessage({fileSize:e.fileSize,mode:e.mode,buffer:r},[r.buffer])}else d.$unlzmaWorkerActive=!1;this._$byteStream._$buffer=e.data,this.parseAndBuild()},d.$allClearCopy=()=>{d.$timelineMenu.clearCopy(),d.$screenMenu.clearCopy(),d.$libraryMenu.clearCopy()},d.$getImageType=e=>{switch(!0){case 255===e[0]&&216===e[1]:return"jpeg";case 71===e[0]&&73===e[1]&&70===e[2]:return"gif";case 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]:return"png";case 66===e[0]&&77===e[1]:return"bmp";default:return null}},d.$jpegDecodeHandler=()=>{const e=this.image,t=e.width,r=e.height,a=document.createElement("canvas");a.width=t,a.height=r;const s=a.getContext("2d");s.drawImage(e,0,0,t,r);const i=new Uint8Array(s.getImageData(0,0,t,r).data);this.jpegData=null,this.image=null;const n=d.$currentWorkSpace().getLibrary(this.libraryId);if(n.width=t,n.height=r,this.isAlpha){if(this.buffer=i,this.width=t,this.height=r,d.$unzipWorkerActive)return void d.$unzipQueues.push(this);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const e=d.$unzipWorker;e.onmessage=d.$unzipHandler.bind(this),e.postMessage(this,[this.buffer.buffer,this.alphaData.buffer])}else n._$buffer=i},d.$characters=new Map,d.$symbols=new Map,d.$fonts=new Map,d.$texts=new Map,d.$parserHandler=function(e){const t=e.target;switch(e.data.infoKey){case"character":{const t=e.data.piece,r=d.$currentWorkSpace(),a=r.nextLibraryId;switch(t.libraryId=a,t._$name){case"Shape":{const e=d.$libraryController.createInstance(b.SHAPE,`Shape_${a}`,a);e.recodes=d.$vtc.convert(t._$records),e.inBitmap=e.recodes.pop(),e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax};const s=r.addLibrary(e);this._$folderId&&(s.folderId=this._$folderId),d.$characters.set(t._$characterId,a)}break;case"MovieClip":{for(let e=0;e<t._$dictionary.length;++e){const r=t._$dictionary[e];r.LibraryId=d.$characters.get(r.CharacterId)}const e=t._$characterId?`MovieClip_${a}`:this._$fileName;let s=!t._$characterId&&this._$libraryId?this._$libraryId:a;const i=d.$libraryController.createInstance(b.MOVIE_CLIP,e,s),n=r.addLibrary(i);this._$folderId&&(n.folderId=this._$folderId);let o=new Map,l=[];for(let e=0;e<t._$dictionary.length;++e){const r=t._$dictionary[e];-1===l.indexOf(r.Depth)&&(l.push(r.Depth),r.ClipDepth&&o.set(r.Depth,e))}if(l.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}})),o.size)for(const[e,r]of o){const a=[],s=t._$dictionary[r];for(let r=0;t._$dictionary.length>r;++r){const i=t._$dictionary[r];if(i.Depth>s.ClipDepth)break;i.Depth>e&&a.push(i)}for(let e=0;e<a.length;++e){const t=a[e],r=l.indexOf(t.Depth),i=l.splice(r,1)[0],n=l.indexOf(s.Depth);l.splice(n,0,i)}}let c=-1,h=-1;const u=l.length-1,m=new Map,g=[];for(let e=u;e>-1;--e){const t=new v;t.name="Layer_"+(u-e);const r=l[e];o.size&&(h>-1&&(r>h?(t.mode=I.MASK_IN,t.maskId=c):(c=-1,h=-1)),o.has(r)&&(h=r,c=u-e,t.mode=I.MASK)),g.push(t),m.set(r,t)}for(let e=0;e<l.length;++e)n.setLayer(e,g[e]);const $=[],y=t._$controller.length-1;for(let e=0;e<t._$dictionary.length;++e){const r=t._$dictionary[e],a=new p;a.libraryId=r.LibraryId,a.startFrame=r.StartFrame,a.endFrame=r.EndFrame||y+1,a.name=r.Name||"",$.push(a)}const _=new Map;for(let e=1;e<t._$controller.length;++e){const r=t._$controller[e];for(let a=0;a<r.length;++a){const s=r[a],i=t._$dictionary[s],n=m.get(i.Depth),o=$[s];_.has(s)||(_.set(s,-1),n.addCharacter(o));const l=t._$placeMap[e][i.Depth];if(_.get(s)!==l){const r=t._$placeObjects[l];o.setPlace(e,{frame:e,depth:0,matrix:r.matrix,colorTransform:r.colorTransform,blendMode:r.blendMode,filter:r.filters?r.filters:[],loop:d.$getDefaultLoopConfig()}),_.set(s,l)}}}for(let e=0;e<g.length;++e){const t={startFrame:-1},r=g[e];for(let e=1;e<=y;++e){r.getActiveCharacter(e).length?t.startFrame>0&&(r.addEmptyCharacter(new f({startFrame:t.startFrame,endFrame:e})),t.startFrame=-1):-1===t.startFrame&&(t.startFrame=e)}}for(let e=0;e<g.length;++e){const t=g[e],r=t.totalFrame;for(let e=1;r>e;){const a=t.getActiveCharacter(e);if(!a.length||a.length>2){e++;continue}const s=a[0],i=s.getRange(e);if(i.endFrame-i.startFrame!=1){e=i.endFrame;continue}if(e+1>=r)break;if(!s.hasPlace(e+1)){e++;continue}const n=e;for(;;){if(!s.hasPlace(e+1)){if(e-n>2){s.setTween(n,{method:"linear",curve:[],custom:d.$tweenController.createEasingObject(),startFrame:n,endFrame:e});for(let t=n;e>t;++t)s.getPlace(t).tweenFrame=n}break}if(e++,e>=r)break}}}d.$characters.set(t._$characterId,a)}break;case"lossless":{const e=d.$libraryController.createInstance(b.BITMAP,`Bitmap_${a}`,a);t.mode="lossless",e.imageType="image/png",e.buffer=null,e.width=t.width,e.height=t.height;const s=r.addLibrary(e);if(this._$folderId&&(s.folderId=this._$folderId),d.$characters.set(t._$characterId,a),d.$unzipWorkerActive)return void d.$unzipQueues.push(t);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const i=d.$unzipWorker;i.onmessage=d.$unzipHandler.bind(t),i.postMessage(t,[t.buffer.buffer])}break;case"imageData":{const e=d.$libraryController.createInstance(b.BITMAP,`Bitmap_${a}`,a),s=`image/${d.$getImageType(t.jpegData)}`;t.mode="jpegAlpha",t.imageType=s,e.imageType=s,e.buffer=null,e.width=0,e.height=0;const i=r.addLibrary(e);this._$folderId&&(i.folderId=this._$folderId),d.$characters.set(t._$characterId,a),t.image=new Image,t.image.decoding="async",t.image.src=URL.createObjectURL(new Blob([t.jpegData],{type:t.imageType})),t.image.decode().then(d.$jpegDecodeHandler.bind(t))}break;case"StaticText":{const e=d.$libraryController.createInstance(b.SHAPE,`ShapeText_${a}`,a);e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax};const s=r.addLibrary(e);this._$folderId&&(s.folderId=this._$folderId),d.$characters.set(t._$characterId,a),d.$texts.set(d.$texts.size,t)}break;case"SimpleButton":console.log("TODO SimpleButton: ",t);d.$libraryController.createInstance(b.BUTTON,`Button_${a}`,a).bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax},d.$characters.set(t._$characterId,a);break;case"TextField":{const e=d.$libraryController.createInstance(b.TEXT,`Text_${a}`,a);e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax},e.text=t._$text,e.inputType=t._$type,e.color=t._$textColor,e.font=t._$defaultTextFormat[1],e.size=t._$defaultTextFormat[2],e.align=t._$defaultTextFormat[7],e.leftMargin=t._$defaultTextFormat[8],e.rightMargin=t._$defaultTextFormat[9],e.leading=t._$defaultTextFormat[10],e.multiline=1===t._$multiline,e.wordWrap=1===t._$wordWrap,e.border=1===t._$border,t._$defaultTextFormat[4]&&t._$defaultTextFormat[5]?e.fontType=3:t._$defaultTextFormat[4]?e.fontType=2:t._$defaultTextFormat[5]&&(e.fontType=1),e.htmlText=t._$htmlText;const s=r.addLibrary(e);this._$folderId&&(s.folderId=this._$folderId),d.$characters.set(t._$characterId,a)}break;default:console.log("TODO: ",t)}if(t._$characterId)return;this._$libraryId&&(d.$changeLibraryId=this._$libraryId,r.scene.changeFrame(d.$timelineFrame.currentFrame),d.$changeLibraryId=0)}break;case"_$symbols":for(let t=0;t<e.data.pieces.length;++t){const r=e.data.pieces[t];d.$symbols.set(r.tagId,r.ns)}return;case"font":return void d.$fonts.set(e.data.index,e.data.piece);case"font_shape":{const t=d.$fonts.get(e.data.index);t._$glyphShapeTable.push.apply(t._$glyphShapeTable,e.data.pieces),d.$fonts.set(e.data.index,t)}return;case"font_zone":{const t=d.$fonts.get(e.data.index);t._$zoneTable.push.apply(t._$zoneTable,e.data.pieces),d.$fonts.set(e.data.index,t)}return}const r=d.$currentWorkSpace();for(const[e,t]of d.$symbols){r.getLibrary(e)._$symbol=`${t}`}if(d.$characters.clear(),d.$symbols.clear(),d.$fonts.clear(),d.$texts.clear(),d.$libraryController.reload(Array.from(r._$libraries.values())),t.onmessage=null,this._$resolve&&this._$resolve(),d.$parserQueues.length){const e=d.$parserQueues.shift();t.onmessage=d.$parserHandler.bind(e);const r=e._$byteStream._$buffer;t.postMessage({version:e._$swfVersion,offset:e._$offset,buffer:r},[r.buffer])}else d.$parserWorkerWait=!1},d.$boundsMatrix=(e,t)=>{const r=e.xMax*t[0]+e.yMax*t[2]+t[4],a=e.xMax*t[0]+e.yMin*t[2]+t[4],s=e.xMin*t[0]+e.yMax*t[2]+t[4],i=e.xMin*t[0]+e.yMin*t[2]+t[4],n=e.xMax*t[1]+e.yMax*t[3]+t[5],o=e.xMax*t[1]+e.yMin*t[3]+t[5],l=e.xMin*t[1]+e.yMax*t[3]+t[5],c=e.xMin*t[1]+e.yMin*t[3]+t[5];return{xMin:Math.min(Number.MAX_VALUE,r,a,s,i),xMax:Math.max(-Number.MAX_VALUE,r,a,s,i),yMin:Math.min(Number.MAX_VALUE,n,o,l,c),yMax:Math.max(-Number.MAX_VALUE,n,o,l,c)}},d.$intToRGB=e=>({R:(16711680&e)>>16,G:(65280&e)>>8,B:255&e}),d.$copyContainer=(e,t)=>{const r=d.$currentWorkSpace(),a=d.$workSpaces[d.$copyWorkSpaceId];t.has(e.id)||t.set(e.id,r.nextLibraryId),e.id=t.get(e.id),r.addLibrary(e);for(let s=0;s<e.layers.length;++s){const i=e.layers[s];for(let e=0;e<i.characters.length;++e){const s=i.characters[e];if(!t.has(s.libraryId)){t.set(s.libraryId,r.nextLibraryId);const e=a.getLibrary(s.libraryId).toObject();e.type===b.MOVIE_CLIP?d.$copyContainer(e,t):(e.id=t.get(s.libraryId),r.addLibrary(e))}s.libraryId=t.get(s.libraryId)}}r.addLibrary(e)},d.$clearShapePointer=()=>{const e=document.getElementById("stage-area");if(!e)return;const t=e.children;for(let e=0;t.length>e;++e){const r=t[e];r.dataset.shapePointer&&(r.remove(),--e)}},d.$getDefaultLoopConfig=()=>({type:Me.DEFAULT,start:1,end:0}),d.$getFrame=(e,t,r,a,s=0)=>{const i=r-t.startFrame;let n=1;switch(e.loop.type){case Me.REPEAT:{const t=e.loop.end?e.loop.end:a;n=e.loop.start;for(let r=0;r<i;++r)++n,n>t&&(n=e.loop.start)}break;case Me.NO_REPEAT:{const t=e.loop.end?e.loop.end:a;n=e.loop.start;for(let e=0;e<i;++e)if(++n,n>t){n=t;break}}break;case Me.FIXED_ONE:n=e.loop.start;break;case Me.NO_REPEAT_REVERSAL:n=e.loop.end?e.loop.end:a;for(let t=0;t<i;++t)if(--n,e.loop.start>n){n=e.loop.start;break}break;case Me.REPEAT_REVERSAL:{const t=e.loop.end?e.loop.end:a;n=t;for(let r=0;r<i;++r)--n,e.loop.start>n&&(n=t)}break;case Me.DEFAULT:if(0===s){n=1;for(let e=0;e<i;++e)++n,n>a&&(n=1)}else n=s,n>a&&(n=1)}return n};d.$globalKeyboardCommand=new class{constructor(){this._$activeTool=null,this._$executeMulti=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),d.$setShortcut(d.$generateShortcutKey("z",{ctrl:!0}),this.undo),d.$setShortcut(d.$generateShortcutKey("z",{ctrl:!0,shift:!0}),this.redo),d.$setShortcut(d.$generateShortcutKey("s",{ctrl:!0}),d.$autoSave),d.$setShortcut("Enter",(()=>{d.$timelinePlayer.executeTimelinePlay()})),d.$setShortcut(d.$generateShortcutKey("Enter",{ctrl:!0}),d.$showPreview),d.$setShortcut(d.$generateShortcutKey("Enter",{ctrl:!0,shift:!0}),d.$project.publish),d.$setShortcut("Escape",d.$hidePreview),d.$setShortcut(d.$generateShortcutKey("p",{ctrl:!0}),this.changeRepeatMode),d.$setShortcut(d.$generateShortcutKey("ArrowRight",{ctrl:!0}),this.changeProject),d.$setShortcut(d.$generateShortcutKey("ArrowLeft",{ctrl:!0}),this.changeProject),d.$initializeEnd()}redo(){const e=d.$currentWorkSpace();e&&e.redo()}undo(){const e=d.$currentWorkSpace();e&&e.undo()}changeRepeatMode(){d.$timelinePlayer.repeat?d.$timelinePlayer.executeTimelineRepeat():d.$timelinePlayer.executeTimelineNoRepeat()}changeProject(e){const t=Array.from(document.getElementById("view-tab-area").children);let r=0;for(let e=0;e<t.length;++e){if((0|t[e].dataset.tabId)===d.$activeWorkSpaceId){r=e;break}}let a=null;if("ArrowLeft"===e.key?(a=t[r-1],a||(a=t[t.length-1])):(a=t[r+1],a||(a=t[0])),a){const e=0|a.dataset.tabId;d.$activeWorkSpaceId!==e&&d.$screenTab.activeTab({currentTarget:{dataset:{tabId:e}}})}}};class m{constructor(e,t=0,r=0,a=60,s=!0){this._$pngs=e,this._$width=t,this._$height=r,this._$fps=a,this._$loop=s?0:1,this._$crcTable=new Uint32Array(256);for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;this._$crcTable[e]=t}}_$crcUpdate(e,t,r,a){for(let s=0;s<a;s++)e=this._$crcTable[255&(e^t[r+s])]^e>>>8;return e}_$crc(e,t,r){return 4294967295^this._$crcUpdate(4294967295,e,t,r)}_$writeString(e,t,r){for(let a=0;a<r.length;a++)e[t+a]=r.charCodeAt(a)}encode(){return new Promise((e=>{requestAnimationFrame((()=>{let t=0,r=0;const a=[],s=new FileReader,i=new Uint8Array([137,80,78,71,13,10,26,10]);a.push(i.buffer);const n=new Uint8Array(25),o=new DataView(n.buffer);o.setUint32(0,13),this._$writeString(n,4,"IHDR"),o.setUint32(8,this._$width),o.setUint32(12,this._$height),o.setUint8(16,8),o.setUint8(17,6),o.setUint8(18,0),o.setUint8(19,0),o.setUint8(20,0),o.setUint32(21,this._$crc(n,4,17)),a.push(n.buffer);const l=new Uint8Array(20),c=new DataView(l.buffer);c.setUint32(0,8),this._$writeString(l,4,"acTL"),c.setUint32(8,this._$pngs.length),c.setUint32(12,this._$loop),c.setUint32(16,this._$crc(l,4,12)),a.push(l.buffer),s.onload=()=>{const i=new DataView(s.result);let n=8;const o=new Uint8Array(38),l=new DataView(o.buffer);l.setUint32(0,26),this._$writeString(o,4,"fcTL"),l.setUint32(8,t++),l.setUint32(12,this._$width),l.setUint32(16,this._$height),l.setUint32(20,0),l.setUint32(24,0),l.setUint16(28,1e3/this._$fps),l.setUint16(30,1e3),l.setUint8(32,0),l.setUint8(33,0),l.setUint32(34,this._$crc(o,4,30)),a.push(o.buffer);const c=s.result.byteLength;for(;;){const e=i.getUint32(n);if(1229209940===i.getUint32(n+4))if(r){let r=new Uint8Array(4),i=new DataView(r.buffer);i.setUint32(0,e+4),a.push(r.buffer),r=new Uint8Array(s.result.slice(n,n+e+8+4)),i=new DataView(r.buffer),this._$writeString(r,0,"fdAT"),i.setUint32(4,t++),i.setUint32(e+8,this._$crc(r,0,e+8)),a.push(r.buffer)}else a.push(s.result.slice(n,n+e+8+4));if(n+=e+12,n>=c)break}r++,this._$pngs.length>r?s.readAsArrayBuffer(this._$pngs[r]):(a.push(new Uint8Array([0,0,0,0,73,69,78,68,174,66,96,130]).buffer),e(new Blob(a,{type:"image/apng"})))},s.readAsArrayBuffer(this._$pngs[0])}))}))}}class g{constructor(e){this._$id=e.id,this._$name=e.name,this._$type=e.type,this._$symbol=e.symbol||"",this._$folderId=0|e.folderId}initialize(){}toObject(){}toPublish(){}get defaultSymbol(){}createInstance(){}getBounds(e=null,t=null,r=null){}get id(){return this._$id}set id(e){this._$id=0|e}get folderId(){return this._$folderId}set folderId(e){this._$folderId=0|e}get path(){const e=d.$currentWorkSpace();let t=this._$name;if(this._$folderId){let r=this;for(;r._$folderId;)r=e.getLibrary(r._$folderId),t=`${r._$name}/${t}`}return t}getPathWithWorkSpace(e){let t=this._$name;if(this._$folderId){let r=this;for(;r._$folderId;)r=e.getLibrary(r._$folderId),t=`${r._$name}/${t}`}return t}get name(){return this._$name}set name(e){if(this._$name=`${e}`,this.id){const e=document.getElementById(`library-name-${this.id}`);e&&(e.textContent=`${this._$name}`)}const t=d.$currentWorkSpace();if(t&&t.scene.id===this.id){const e=document.getElementById("object-name");e&&(e.value=`${this._$name}`);const t=document.getElementById("scene-name");t&&(t.textContent=`${this._$name}`)}}get type(){return this._$type}set type(e){switch(e=`${e}`.toLowerCase()){case b.SHAPE:case b.BITMAP:case b.VIDEO:case b.FOLDER:case b.SOUND:case b.MOVIE_CLIP:case b.TEXT:this._$type=e}}get symbol(){return this._$symbol}set symbol(e){if(this._$symbol=`${e}`,this.id){const t=document.getElementById(`library-symbol-name-${this.id}`);t&&(t.textContent=`${e}`)}}showController(e,t=""){d.$controller.hideObjectSetting(["sound-setting","ease-setting"]),d.$controller.showObjectSetting(["object-setting","reference-setting","transform-setting","color-setting","blend-setting","filter-setting","instance-setting"]),d.$instanceSelectController.createInstanceSelect(this);const r=e.matrix;document.getElementById("object-name").value=t,document.getElementById("object-symbol").value=this.symbol;const a="scaleX"in e?e.scaleX:Math.sqrt(r[0]*r[0]+r[1]*r[1]);document.getElementById("transform-scale-x").value=""+ +(100*a).toFixed(2);const s="scaleY"in e?e.scaleY:Math.sqrt(r[2]*r[2]+r[3]*r[3]);document.getElementById("transform-scale-y").value=""+ +(100*s).toFixed(2);const i="rotation"in e?e.rotation:Math.atan2(r[1],r[0])*d.$Rad2Deg;document.getElementById("transform-rotate").value=""+(0|i);const n=e.colorTransform;document.getElementById("color-red-multiplier").value=100*n[0],document.getElementById("color-green-multiplier").value=100*n[1],document.getElementById("color-blue-multiplier").value=100*n[2],document.getElementById("color-alpha-multiplier").value=100*n[3],document.getElementById("color-red-offset").value=n[4],document.getElementById("color-green-offset").value=n[5],document.getElementById("color-blue-offset").value=n[6],document.getElementById("color-alpha-offset").value=n[7];const o=document.getElementById("blend-select").children;for(let t=0;t<o.length;++t){const r=o[t];if(r.value===e.blendMode){r.selected=!0;break}}d.$filterController.clear();const l=e.filter.length;l&&(document.querySelectorAll(".filter-none")[0].style.display="none");for(let t=0;t<l;++t){const r=e.filter[t];d.$filterController[`add${r.name}`](r,!1)}}draw(e,t,r,a,s=null,i=0,n=!1){if(!t||!r)return e.width=0,e.height=0,Promise.resolve(e);const o=this.createInstance(a,s,i,n);let l=a.matrix;!n&&d.$sceneChange.matrix.length&&(l=d.$multiplicationMatrix(d.$sceneChange.concatenatedMatrix,a.matrix));const c=this.createContainer(o,a,l,n),h=this.calcFilter(t,r,a);h.filters.length&&(o._$transform._$filters=h.filters);const u=this.createBitmapData(h.width,h.height,n);e.width=h.width,e.height=h.height;const m=window.devicePixelRatio,g=n?window.devicePixelRatio:window.devicePixelRatio*d.$zoomScale,$=c.getBounds(c);let p=-$.x*m;0>h.offsetX&&(p-=h.offsetX*g);let f=-$.y*m;0>h.offsetY&&(f-=h.offsetY*g),e._$width=h.width,e._$height=h.height,e.draggable=!1;const y=this.getBounds(l,a,s,i);return e._$tx=y.xMin,e._$ty=y.yMin,e._$offsetX=0>h.offsetX?h.offsetX:0,e._$offsetY=0>h.offsetY?h.offsetY:0,new Promise((t=>{const{Matrix:r}=window.next2d.geom;u.draw(c,new r(m,0,0,m,p,f),null,e,t)}))}calcFilter(e,t,r){const{Rectangle:a}=window.next2d.geom;let s=Math.sqrt(r.matrix[0]*r.matrix[0]+r.matrix[1]*r.matrix[1]),i=Math.sqrt(r.matrix[2]*r.matrix[2]+r.matrix[3]*r.matrix[3]);const n={width:e,height:t,offsetX:0,offsetY:0,filters:[]};if(r.filter.length){let o=new a(0,0,e,t);for(let e=0;e<r.filter.length;++e){const t=r.filter[e];if(!t.state)continue;const a=t.createInstance();o=a._$generateFilterRect(o,s,i),n.filters.push(a)}n.width=Math.ceil(o.width),n.height=Math.ceil(o.height),n.offsetX=o.x,n.offsetY=o.y}return n}createContainer(e,t,r,a=!1){const{Sprite:s}=window.next2d.display,{Matrix:i,ColorTransform:n}=window.next2d.geom;e._$transform._$matrix=new i(r[0],r[1],r[2],r[3],r[4],r[5]),e._$transform._$colorTransform=new n(t.colorTransform[0],t.colorTransform[1],t.colorTransform[2],t.colorTransform[3],t.colorTransform[4],t.colorTransform[5],t.colorTransform[6],t.colorTransform[7]);const o=new s;o.addChild(e);let l=1;a||(l*=d.$zoomScale),o.scaleX=l,o.scaleY=l;const c=new s;return c.addChild(o),c}createBitmapData(e,t,r=!1){const{BitmapData:a}=window.next2d.display;let s=window.devicePixelRatio;return r||(s*=d.$zoomScale),new a(Math.ceil(e*s),Math.ceil(t*s),!0,0)}getPreview(){if(this._$type===b.FOLDER)return Promise.resolve();const e=this.getBounds([1,0,0,1,0,0]);let t=Math.abs(e.xMax-e.xMin),r=Math.abs(e.yMax-e.yMin);if(!t||!r)return Promise.resolve();let a=1;const s=150/r;t=t*s|0,r=r*s|0;const i=(0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0])-10;return t>i&&(a=i/t,t=t*a|0,r=r*a|0),this.draw(d.$getCanvas(),Math.ceil(t),Math.ceil(r),{frame:1,matrix:[s*a,0,0,s*a,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[]},null,0,!0).then((e=>{const a=Math.min(150,r);return e.style.width=t*a/r+"px",e.style.height=`${a}px`,Promise.resolve(e)}))}remove(){const e=d.$root;e&&e.stage._$player.removeCache(`${d.$loaderInfo._$id}@${this.id}`);const t=d.$currentWorkSpace(),r=t.scene;for(let e of t._$libraries.values())if(e.type===b.MOVIE_CLIP&&e.id!==this.id){for(let t of e._$layers.values()){let a=!1;const s=t._$characters.slice();for(let e=0;e<s.length;++e){const r=s[e];if(this.id===r.libraryId){for(const e of r._$places.keys()){const a=r.getRange(e);if(t.getActiveEmptyCharacter(e))continue;const s=t.getActiveCharacter(e);let i=!1;for(let e=0;e<s.length;++e){s[e].id!==r.id&&(i=!0)}i||t.addEmptyCharacter(new f({startFrame:a.startFrame,endFrame:a.endFrame}))}t.deleteCharacter(r.id),a=!0}}a&&r.id===e.id&&t.reloadStyle()}if(e._$sounds.size)for(const[t,r]of e._$sounds){const a=[];for(let e=0;e<r.length;++e){const t=r[e];this.id!==t.characterId&&a.push(t)}e._$sounds.set(t,a)}}}}class $ extends g{constructor(e){super(e),this.imageType=e.imageType,this.width=e.width,this.height=e.height,this._$buffer=null,e.buffer&&(this.buffer=e.buffer),this._$graphicBuffer=null,this._$binary=""}clone(){return new $(JSON.parse(JSON.stringify(this.toObject())))}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["text-setting","loop-setting","video-setting","fill-color-setting","nine-slice-setting"])}getBounds(e=null){const t={xMin:0,xMax:this.width,yMin:0,yMax:this.height};return e?d.$boundsMatrix(t,e):t}get defaultSymbol(){return window.next2d.display.Shape.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let r=0;r<t;++r)this._$buffer[r]=255&e.charCodeAt(r);this._$binary=e}}}get imageType(){return this._$imageType}set imageType(e){this._$imageType=e}get width(){return this._$width}set width(e){this._$width=e}get height(){return this._$height}set height(e){this._$height=e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,width:this.width,height:this.height,imageType:this.imageType,buffer:this.buffer}}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,buffer:Array.from(this._$buffer),bounds:this.getBounds()}}createInstance(){const{Shape:e,BitmapData:t}=window.next2d.display,{width:r,height:a}=this,s=new e;s._$loaderInfo=d.$loaderInfo,s._$characterId=this.id;const i=new t(r,a,!0,0);i._$buffer=this._$buffer;const n=s.graphics;return n.beginBitmapFill(i,null,!1).drawRect(0,0,r,a).endFill(),n._$maxAlpha=1,n._$canDraw=!0,n._$xMin=0,n._$xMax=this.width,n._$yMin=0,n._$yMax=this.height,this._$graphicBuffer||(this._$graphicBuffer=n._$getRecodes()),n._$buffer=this._$graphicBuffer,s}}class p{constructor(e=null){this._$libraryId=-1,this._$places=new Map,this._$tween=new Map,this._$canvas=null,this._$base64=null,this._$currentFrame=0,this._$currentPlace=null,this._$screenX=0,this._$screenY=0,this._$offsetX=0,this._$offsetY=0,this._$name="",this._$cachePlaces=[],this._$maskPlaceFrame=0,this._$referencePoint={x:0,y:0},e?(this._$id=e.id,this._$libraryId=e.libraryId,this._$name=e.name||"",this._$startFrame=e.startFrame,this._$endFrame=e.endFrame,this.places=e.places||[],this.tween=e.tween||[]):(this._$id=d.$currentWorkSpace()._$characterId++,this._$startFrame=1,this._$endFrame=2)}showController(){const e=d.$currentWorkSpace().getLibrary(this.libraryId),t=d.$timelineFrame.currentFrame;e.showController(this.getPlace(t),this.name);const r=this.getRange(t);if(this.hasTween(r.startFrame)){d.$controller.showObjectSetting(["ease-setting"]);const e=this.getTween(r.startFrame),t=document.getElementById("ease-select").children;for(let r=0;r<t.length;++r){const a=t[r];if(a.value===e.method){a.selected=!0;break}}"custom"===e.method?d.$tweenController.showCustomArea():d.$tweenController.hideCustomArea()}}showShapeColor(e){d.$controller.hideObjectSetting(["fill-color-setting"]);const t=d.$currentWorkSpace().getLibrary(this.libraryId);if(t.type!==b.SHAPE)return;const r=d.$timelineFrame.currentFrame;t.showShapeColor(this.getPlace(r),e)}clone(){const e=new p(JSON.parse(JSON.stringify(this.toObject())));return e._$id=d.$currentWorkSpace()._$characterId++,e}remove(e){if(1===this._$places.size)return void e.deleteCharacter(this.id);const t=this.getRange(d.$timelineFrame.currentFrame);switch(!0){case t.startFrame===this.startFrame:this._$places.delete(t.startFrame),this.startFrame=t.endFrame;break;case t.endFrame===this.endFrame:this._$places.delete(t.startFrame),this.endFrame=t.startFrame;break;default:this.split(e,t.startFrame,t.endFrame)._$tween.size&&d.$tweenController.clearPointer()}if(this._$tween.has(t.startFrame)){this._$tween.delete(t.startFrame);for(let e=t.startFrame;e<t.endFrame;++e)this._$places.has(e)&&this._$places.delete(e);d.$tweenController.clearPointer()}}relocationTween(e){if(!this._$tween.size)return;const t=this.getRange(e);this.hasTween(t.startFrame)&&(this.endFrame-1>e&&!this.hasTween(e)&&d.$timelineTool.executeTimelineKeyAdd(),d.$tweenController.relocationPlace(this,t.startFrame),d.$tweenController.clearPointer().relocationPointer())}getRange(e){if(1===this._$places.size&&this._$places.has(e))return{startFrame:this.startFrame,endFrame:this.endFrame};let t=this._$cachePlaces;t.length||(t=Array.from(this._$places.keys()),t.sort(((e,t)=>{switch(!0){case e>t:return-1;case e<t:return 1;default:return 0}})));let r=0;for(let a=0;a<t.length;++a){const s=t[a];if(e>=s){const e=this.getPlace(s);if(e.tweenFrame){const t=this.getTween(e.tweenFrame);return{startFrame:t.startFrame,endFrame:t.endFrame}}return{startFrame:s,endFrame:r||this.endFrame}}r=s}}getCloneTween(e){return JSON.parse(JSON.stringify(this.getTween(e)))}getTween(e){return this.hasTween(e)?this._$tween.get(e):null}setTween(e,t){this._$tween.set(e,t)}hasTween(e){return this._$tween.has(e)}deleteTween(e){return this._$tween.delete(0|e)}getBounds(e=null,t=0){const r=d.$currentWorkSpace().getLibrary(this.libraryId),a=t||d.$timelineFrame.currentFrame,s=this.getPlace(a),i=s.loop&&s.loop.type===Me.DEFAULT?{startFrame:this.startFrame,endFrame:this.endFrame}:this.getRange(a),n=d.$currentFrame;d.$currentFrame=a;let o=s.matrix;e&&(o=d.$multiplicationMatrix([e[0],e[1],e[2],e[3],0,0],s.matrix));const l=r.getBounds(o,s,i);return d.$currentFrame=n,l}get rotation(){const e=d.$timelineFrame.currentFrame,t=this.getPlace(e);if(!t.rotation){const e=t.matrix;t.rotation=Math.atan2(e[1],e[0])*d.$Rad2Deg}return t.rotation}set rotation(e){const t=d.$timelineFrame.currentFrame,r=this.getPlace(t);r.rotation=e;const a=r.matrix;let s=Math.atan2(a[1],a[0]),i=Math.atan2(-a[2],a[3]);const n=Math.sqrt(a[0]*a[0]+a[1]*a[1]),o=Math.sqrt(a[2]*a[2]+a[3]*a[3]),l=e*d.$Deg2Rad;i=i+l-s,s=l,a[0]=n*Math.cos(s),a[1]=n*Math.sin(s),a[2]=-o*Math.sin(i),a[3]=o*Math.cos(i)}get width(){const e=this.getBounds(),t=+Math.abs(e.xMax-e.xMin);return t!==1/0?t:0}set width(e){const t=this.getBounds(),r=Math.abs(t.xMax-t.xMin);this.scaleX=e/r}get scaleX(){const e=d.$timelineFrame.currentFrame,t=this.getPlace(e);if(!t.scaleX){const e=t.matrix;t.scaleX=Math.sqrt(e[0]*e[0]+e[1]*e[1])}return t.scaleX}set scaleX(e){e=d.$toFixed4(e);const t=d.$timelineFrame.currentFrame,r=this.getPlace(t);r.scaleX=e;const a=r.matrix;if(a[1]){const t=Math.atan2(a[1],a[0]);a[1]=e*Math.sin(t),1===a[1]||-1===a[1]?a[0]=0:a[0]=e*Math.cos(t)}else a[0]=e}get height(){const e=this.getBounds(),t=+Math.abs(e.yMax-e.yMin);return t!==1/0?t:0}set height(e){const t=this.getBounds(),r=Math.abs(t.yMax-t.yMin);this.scaleY=e/r}get scaleY(){const e=d.$timelineFrame.currentFrame,t=this.getPlace(e);if(!t.scaleY){const e=t.matrix;t.scaleY=Math.sqrt(e[2]*e[2]+e[3]*e[3])}return t.scaleY}set scaleY(e){e=d.$toFixed4(e);const t=d.$timelineFrame.currentFrame,r=this.getPlace(t);r.scaleY=e;const a=r.matrix;if(a[2]){const t=Math.atan2(-a[2],a[3]);a[2]=-e*Math.sin(t),1===a[2]||-1===a[2]?a[3]=0:a[3]=e*Math.cos(t)}else a[3]=e}get x(){const e=d.$timelineFrame.currentFrame;return this.getPlace(e).matrix[4]}set x(e){const t=d.$timelineFrame.currentFrame;this.getPlace(t).matrix[4]=e;const r=this.getBounds();this.screenX=r.xMin;const a=document.getElementById(`character-${this.id}`);a&&(a.style.left=`${d.$offsetLeft+r.xMin*d.$zoomScale}px`)}get y(){const e=d.$timelineFrame.currentFrame;return this.getPlace(e).matrix[5]}set y(e){const t=d.$timelineFrame.currentFrame;this.getPlace(t).matrix[5]=e;const r=this.getBounds();this.screenY=r.yMin;const a=document.getElementById(`character-${this.id}`);a&&(a.style.top=`${d.$offsetTop+r.yMin*d.$zoomScale}px`)}draw(e=null,t=0){const r=d.$currentWorkSpace().getLibrary(this.libraryId);let a=t||d.$timelineFrame.currentFrame;const s=this.getPlace(a),i=s.loop&&s.loop.type===Me.DEFAULT?{startFrame:this.startFrame,endFrame:this.endFrame}:this.getRange(a);if(r.type===b.MOVIE_CLIP){const e=this.endFrame-1;a=d.$getFrame(s,i,a,e,t),a>e&&(a=1),a!==this._$currentFrame&&this.dispose()}if(this._$canvas)return e instanceof HTMLCanvasElement&&d.$poolCanvas(e),Promise.resolve(this._$canvas);r.type===b.MOVIE_CLIP&&(this._$currentFrame=a),d.$currentFrame=a;let n=s.matrix;d.$sceneChange.matrix.length&&(n=d.$multiplicationMatrix(d.$sceneChange.concatenatedMatrix,s.matrix));const o=r.getBounds(n,s,i),l=+Math.ceil(Math.abs(o.xMax-o.xMin)),c=+Math.ceil(Math.abs(o.yMax-o.yMin));e.setAttribute("style","");let h=null;switch(s.blendMode){case"invert":h=r.draw(e,l,c,{frame:s.frame,matrix:s.matrix,colorTransform:[0,0,0,s.colorTransform[3],0,0,0,s.colorTransform[7]],blendMode:s.blendMode,filter:s.filter,tweenFrame:s.tweenFrame,loop:s.loop},i,t);break;case"alpha":case"erase":{const t=this.getBounds(s.matrix);e._$tx=t.xMin,e._$ty=t.yMin,e._$offsetX=0,e._$offsetY=0,e._$width=0,e._$height=0,e.draggable=!1,e.width=e.height=0,h=Promise.resolve(e)}break;default:h=r.draw(e,l,c,s,i,t)}return h.then((e=>{if("normal"!==s.blendMode)switch(s.blendMode){case"add":e.style.mixBlendMode="color-dodge";break;case"subtract":e.style.filter="invert(100%)",e.style.mixBlendMode="multiply";break;case"invert":e.style.filter="invert(100%)",e.style.mixBlendMode="difference";break;case"hardlight":e.style.mixBlendMode="hard-light";break;case"alpha":case"erase":case"layer":break;default:e.style.mixBlendMode=s.blendMode}return this.screenX=e._$tx,this.screenY=e._$ty,this._$offsetX=e._$offsetX,this._$offsetY=e._$offsetY,this._$canvas=e,Promise.resolve(e)}))}get offsetX(){return this._$offsetX}get offsetY(){return this._$offsetY}get screenX(){return this._$screenX}set screenX(e){this._$screenX=d.$clamp(+e,-Number.MAX_VALUE,Number.MAX_VALUE,0)}get screenY(){return this._$screenY}set screenY(e){this._$screenY=d.$clamp(+e,-Number.MAX_VALUE,Number.MAX_VALUE,0)}get id(){return this._$id}get libraryId(){return this._$libraryId}set libraryId(e){this._$libraryId=0|e}get name(){return this._$name}set name(e){this._$name=`${e}`.replace(/ /g,"").trim()}get referencePoint(){return{x:this._$referencePoint.x,y:this._$referencePoint.y}}set referencePoint(e){e&&(this._$referencePoint.x=d.$clamp(+e.x,-Number.MAX_VALUE,Number.MAX_VALUE,0),this._$referencePoint.y=d.$clamp(+e.y,-Number.MAX_VALUE,Number.MAX_VALUE,0))}get tween(){const e=[];for(let[t,r]of this._$tween)e.push({frame:t,value:r});return e}set tween(e){for(let t=0;t<e.length;++t){const r=e[t];r.value.custom||(r.value.custom=d.$tweenController.createEasingObject()),this._$tween.set(0|r.frame,r.value)}}get places(){const e=d.$currentWorkSpace().getLibrary(this.libraryId);if(!e)return[];const t=[];for(let[r,a]of this._$places){a.frame=r;const s=[];for(let e=0;e<a.filter.length;++e)s.push(a.filter[e].toObject());const i={frame:r,depth:a.depth,blendMode:a.blendMode,filter:s,matrix:a.matrix.slice(0),colorTransform:a.colorTransform.slice(0),point:a.point};"scaleX"in a&&(i.scaleX=a.scaleX),"scaleY"in a&&(i.scaleY=a.scaleY),"rotation"in a&&(i.rotation=a.rotation),a.tweenFrame&&(i.tweenFrame=a.tweenFrame),e.type===b.MOVIE_CLIP&&(a.loop?i.loop={type:a.loop.type,start:a.loop.start,end:a.loop.end}:i.loop=d.$getDefaultLoopConfig()),t.push(i)}return t}set places(e){for(let t=0;t<e.length;++t){const r=e[t],a=[];for(let e=0;r.filter.length>e;++e){const t=r.filter[e];a.push(new d.$filterClasses[t.name](t))}if(r.filter=null,r.filter=a,r.loop||(r.loop=d.$getDefaultLoopConfig()),!("scaleX"in r)){const e=r.matrix;r.scaleX=Math.sqrt(e[0]*e[0]+e[1]*e[1])}if(!("scaleY"in r)){const e=r.matrix;r.scaleY=Math.sqrt(e[2]*e[2]+e[3]*e[3])}if(!("rotation"in r)){const e=r.matrix;r.rotation=Math.atan2(e[1],e[0])*d.$Rad2Deg}this._$places.set(0|r.frame,r)}}getClonePlace(e){const t=this.getPlace(e),r=JSON.parse(JSON.stringify(t)),a=[];for(let e=0;e<t.filter.length;++e)a.push(t.filter[e].clone());return r.filter=a,r}getPlace(e){return 1===this._$places.size&&this.hasPlace(this.startFrame)?this._$places.get(this.startFrame):this.hasPlace(e)?this._$places.get(0|e):this._$places.get(this.getNearPlaceFrame(0|e))}getNearPlaceFrame(e){this._$cachePlaces.length||(this._$cachePlaces=Array.from(this._$places.keys()),this._$cachePlaces.sort(((e,t)=>{switch(!0){case e>t:return-1;case e<t:return 1;default:return 0}})));let t=0;for(;this._$cachePlaces.length>t;){const r=0|this._$cachePlaces[t++];if(e>r)return r}return 1}setPlace(e,t){t.frame=0|e,this._$places.set(0|e,t),this._$cachePlaces.length=0}hasPlace(e){return this._$places.has(0|e)}deletePlace(e){this._$places.delete(0|e),this._$cachePlaces.length=0}get startFrame(){return this._$startFrame}set startFrame(e){this._$startFrame=d.$clamp(0|e,1,Number.MAX_VALUE,1)}get endFrame(){return this._$endFrame}set endFrame(e){this._$endFrame=d.$clamp(0|e,2,Number.MAX_VALUE,2)}updateTweenPlace(e,t){for(let r=e;r<t;++r){const t=this.hasPlace(r)?this.getPlace(r):this.getClonePlace(e);t.tweenFrame=e,this.setPlace(r,t)}}updateTweenBlend(e){if(!this._$tween.size)return;const t=this.getRange(e),r=this.getPlace(t.startFrame);for(let e=t.startFrame;e<t.endFrame;++e)if(this.hasPlace(e))this.getPlace(e).blendMode=r.blendMode;else{const a=this.getClonePlace(t.startFrame);a.blendMode=r.blendMode,this.setPlace(e,a)}}updateTweenFilter(e){if(!this._$tween.size)return;const t=this.getRange(e),r=this.getPlace(t.startFrame);for(let e=t.startFrame;e<t.endFrame;++e){const a=[],s=r.filter.length;for(let e=0;e<s;++e)a.push(r.filter[e].clone());if(this.hasPlace(e))this.getPlace(e).filter=a;else{const r=this.getClonePlace(t.startFrame);r.filter=a,this.setPlace(e,r)}}}move(e){const t=new Map;for(const[r,a]of this._$places)a.frame=r+e,a.tweenFrame&&(a.tweenFrame+=e),t.set(a.frame,a);if(this._$places=t,this._$cachePlaces.length=0,this._$tween.size){const t=new Map;for(const[r,a]of this._$tween)a.startFrame+=e,a.endFrame+=e,t.set(r+e,a);this._$tween=t}this.startFrame+=e,this.endFrame+=e}split(e,t,r){if(t===this.startFrame&&r===this.endFrame)return e.deleteCharacter(this.id),this;if(this._$cachePlaces.length=0,t>this.startFrame){const a=new p;a._$libraryId=this._$libraryId,a._$startFrame=this.startFrame,a._$endFrame=t;const s=new Map;for(const[e,r]of this._$places)t>e?a.setPlace(e,r):s.set(e,r);const i=new Map;for(const[e,r]of this._$tween)t>e?a.setTween(e,r):i.set(e,r);e.addCharacter(a),this._$tween=i,this._$places=s,this._$startFrame=r,this._$cachePlaces.length=0}const a=new p;a._$libraryId=this._$libraryId,a._$startFrame=t,a._$endFrame=r;const s=[];for(const[e,i]of this._$places)t>e||e>=r||(s.push(e),a._$places.set(e,i));for(let e=0;e<s.length;++e)this._$places.delete(s[e]);s.length=0;for(const[e,i]of this._$tween)t>e||e>=r||(s.push(e),a._$tween.set(e,i));for(let e=0;e<s.length;++e)this._$tween.delete(s[e]);if(this._$places.size){const e=Array.from(this._$places.keys());this._$places.size>1&&e.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}})),this._$startFrame=0|e[0]}else e.deleteCharacter(this.id);return a}toObject(){return{id:this.id,name:this.name,libraryId:this.libraryId,places:this.places,startFrame:this.startFrame,endFrame:this.endFrame,tween:this.tween}}dispose(){d.$sleepCanvases.push(this._$canvas),this._$canvas=null,this._$base64=null}}class f{constructor(e=null){this._$startFrame=e?e.startFrame:1,this._$endFrame=e?e.endFrame:2}get startFrame(){return this._$startFrame}set startFrame(e){this._$startFrame=0|e}get endFrame(){return this._$endFrame}set endFrame(e){this._$endFrame=0|e}clone(){return new f(JSON.parse(JSON.stringify(this.toObject())))}toObject(){return{startFrame:this.startFrame,endFrame:this.endFrame}}move(e){this._$startFrame+=e,this._$endFrame+=e}split(e,t,r){e.deleteEmptyCharacter(this),t>this.startFrame&&e.addEmptyCharacter(new f({startFrame:this.startFrame,endFrame:t})),this.endFrame>r&&e.addEmptyCharacter(new f({startFrame:r,endFrame:this.endFrame}))}getRange(){return{startFrame:this.startFrame,endFrame:this.endFrame}}}class y extends g{constructor(e){super(e),this._$mode=_.CLOSE,e.mode&&(this._$mode=e.mode)}clone(){return new y(JSON.parse(JSON.stringify(this.toObject())))}get mode(){return this._$mode}set mode(e){this._$mode=_.OPEN===`${e}`.toLowerCase()?_.OPEN:_.CLOSE}remove(){const e=d.$currentWorkSpace();for(let t of e._$libraries.values())t.folderId&&t.folderId===this.id&&(t.remove(),e.removeLibrary(t.id))}getPreview(){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path fill="gainsboro" d="M11 5c-1.629 0-2.305-1.058-4-3h-7v20h24v-17h-13z"/></svg>',e.style.width="100px",e.style.height="100px",e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,mode:this.mode}}getInstanceIds(e){const t=d.$currentWorkSpace();for(const r of t._$libraries.values())r.folderId&&r.folderId===this.id&&(r.type!==b.FOLDER?e.push(r.id):r.getInstanceIds(e))}}class _{static get OPEN(){return"open"}static get CLOSE(){return"close"}}class b{static get SHAPE(){return"shape"}static get BITMAP(){return"bitmap"}static get VIDEO(){return"video"}static get FOLDER(){return"folder"}static get SOUND(){return"sound"}static get MOVIE_CLIP(){return"container"}static get TEXT(){return"text"}}class v{constructor(e=null){this._$id=0,this._$characters=[],this._$emptys=[],this._$instances=new Map,this._$children=[],this._$maskId=null,this._$guideId=null,this._$name="",this._$display="",this._$light=!1,this._$disable=!1,this._$lock=!1,this._$mode=I.NORMAL,this._$color=fe.color,e&&(this._$name=e.name,this._$light=e.light,this._$disable=e.disable,this._$lock=e.lock,this._$mode=e.mode,this._$maskId=e.maskId,this._$guideId=e.guideId,this._$color=e.color||this._$color,this.characters=e.characters,this.emptyCharacters=e.emptyCharacters||[])}initialize(){const e=document.getElementById("timeline-content");if(!e)return;this._$children=[],this._$display="",d.$timelineLayer.create(this._$id);const t=e.lastElementChild;if(!t)return;const r=document.getElementById(`layer-name-${this.id}`);this.name?(r.textContent=this.name,document.getElementById(`layer-name-input-${this.id}`).value=this.name):this.name=r.textContent;const a=document.getElementById(`layer-light-icon-${this.id}`);if(a.style.backgroundImage=`url('${this.getHighlightURL()}')`,this.light&&(a.classList.remove("icon-disable"),a.classList.add("light-icon-active"),t.style.borderBottom=`1px solid ${this.color}`),this.disable){const e=document.getElementById(`layer-disable-icon-${this.id}`);e.classList.remove("icon-disable"),e.classList.add("icon-active")}if(this.lock){const e=document.getElementById(`layer-lock-icon-${this.id}`);e.classList.remove("icon-disable"),e.classList.add("icon-active")}this.showIcon()}get display(){return this._$display}set display(e){this._$display="none"===e?e:""}getHighlightURL(){const e=d.$intToRGB(0|`0x${this.color.slice(1)}`);return`data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"><path fill="rgb(${e.R},${e.G},${e.B})" d="M14 19h-4c-.276 0-.5.224-.5.5s.224.5.5.5h4c.276 0 .5-.224.5-.5s-.224-.5-.5-.5zm0 2h-4c-.276 0-.5.224-.5.5s.224.5.5.5h4c.276 0 .5-.224.5-.5s-.224-.5-.5-.5zm.25 2h-4.5l1.188.782c.154.138.38.218.615.218h.895c.234 0 .461-.08.615-.218l1.187-.782zm3.75-13.799c0 3.569-3.214 5.983-3.214 8.799h-1.989c-.003-1.858.87-3.389 1.721-4.867.761-1.325 1.482-2.577 1.482-3.932 0-2.592-2.075-3.772-4.003-3.772-1.925 0-3.997 1.18-3.997 3.772 0 1.355.721 2.607 1.482 3.932.851 1.478 1.725 3.009 1.72 4.867h-1.988c0-2.816-3.214-5.23-3.214-8.799 0-3.723 2.998-5.772 5.997-5.772 3.001 0 6.003 2.051 6.003 5.772zm4-.691v1.372h-2.538c.02-.223.038-.448.038-.681 0-.237-.017-.464-.035-.69h2.535zm-10.648-6.553v-1.957h1.371v1.964c-.242-.022-.484-.035-.726-.035-.215 0-.43.01-.645.028zm-3.743 1.294l-1.04-1.94 1.208-.648 1.037 1.933c-.418.181-.822.401-1.205.655zm10.586 1.735l1.942-1.394.799 1.115-2.054 1.473c-.191-.43-.423-.827-.687-1.194zm-3.01-2.389l1.038-1.934 1.208.648-1.041 1.941c-.382-.254-.786-.473-1.205-.655zm-10.068 3.583l-2.054-1.472.799-1.115 1.942 1.393c-.264.366-.495.763-.687 1.194zm13.707 6.223l2.354.954-.514 1.271-2.425-.982c.21-.397.408-.812.585-1.243zm-13.108 1.155l-2.356 1.06-.562-1.251 2.34-1.052c.173.433.371.845.578 1.243zm-1.178-3.676h-2.538v-1.372h2.535c-.018.226-.035.454-.035.691 0 .233.018.458.038.681z"/></svg>`}clone(){return new v(JSON.parse(JSON.stringify(this.toObject())))}appendCharacter(e=1){if(this.disable)return Promise.resolve();const t=[];if(document.getElementById("timeline-onion-skin").classList.contains("onion-skin-active")&&d.$timelinePlayer.stopFlag){const e=d.$timelineFrame.currentFrame,r=new Map;for(let e=0;e<this._$characters.length;++e){const t=this._$characters[e];for(const e of t._$places.keys())r.set(e,!0)}const a=this.getActiveCharacter(e);if(a.length){const t=a[0].getRange(e);r.delete(t.startFrame)}for(const e of r.keys()){d.$timelineFrame.currentFrame=e;const r=this.getActiveCharacter(e);if(r.length){r.length>1&&this.sort(r,e);for(let e=0;e<r.length;++e){const a=r[e];a.dispose(),t.push(d.$screen.appendOnionCharacter(a,this.id))}}}d.$timelineFrame.currentFrame=e;const s=this.getActiveCharacter(e);if(s.length){s.length>1&&this.sort(s,e);const r=this.lock?"none":"auto";for(let a=0;a<s.length;++a){const i=s[a];i.dispose(),t.push(d.$screen.appendCharacter(i,e,this.id,r))}}}else{const r=this.getActiveCharacter(e);if(!r.length)return Promise.resolve();r.length>1&&this.sort(r,e);const a=this.lock?"none":"auto";for(let s=0;s<r.length;++s)t.push(d.$screen.appendCharacter(r[s],e,this.id,a))}return Promise.all(t)}sort(e,t){e.sort(((e,r)=>{const a=e.getPlace(t).depth,s=r.getPlace(t).depth;switch(!0){case a>s:return 1;case a<s:return-1;default:return 0}}))}getActiveCharacter(e=1){const t=[];for(let r=0;r<this._$characters.length;++r){const a=this._$characters[r];a.startFrame>e||(e>=a.endFrame||t.push(a))}return t}getChildren(e=1){const t=d.$timelineHeader.leftFrame;return t>e?null:this._$children[e-t]}getActiveEmptyCharacter(e=1){for(let t=0;t<this._$emptys.length;++t){const r=this._$emptys[t];if(!(r.startFrame>e)&&!(e>=r.endFrame))return r}return null}showIcon(){const e=document.getElementById(`layer-name-${this.id}`);e.classList.remove("in-view-text"),e.classList.add("view-text");switch(document.getElementById(`layer-name-input-${this.id}`).classList.remove("in-view-text-input"),this._$mode){case I.NORMAL:document.getElementById(`layer-icon-${this.id}`).style.display="",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-in-icon-${this.id}`).style.display="none";break;case I.MASK:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-in-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-icon-${this.id}`);e.style.display="",e.style.opacity="0"}break;case I.MASK_IN:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-in-icon-${this.id}`);e.style.display="",e.style.opacity="0";const t=document.getElementById(`layer-name-${this.id}`);t.classList.remove("view-text"),t.classList.add("in-view-text");document.getElementById(`layer-name-input-${this.id}`).classList.add("in-view-text-input")}break;case I.GUIDE:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-in-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-icon-${this.id}`);e.style.display="",e.style.opacity="0"}break;case I.GUIDE_IN:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="",document.getElementById(`timeline-exit-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-in-icon-${this.id}`);e.style.display="",e.style.opacity="0";const t=document.getElementById(`layer-name-${this.id}`);t.classList.remove("view-text"),t.classList.add("in-view-text");document.getElementById(`layer-name-input-${this.id}`).classList.add("in-view-text-input")}}}reloadStyle(){this.resetStyle(),this.setEmptyStyle(),this.setCharacterStyle()}setCharacterStyle(){const e=d.$timelineHeader.leftFrame,t=e+this._$children.length,r=new Map;for(let a=0;a<this._$characters.length;++a){const s=this._$characters[a];if(s.startFrame>t)continue;if(e>=s.endFrame)continue;const i=Array.from(s._$places.keys());i.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let t=0;t<i.length;++t){const a=i[t];if(r.has(a))continue;r.set(a,!0);const n=i[t+1]||s.endFrame;if(a===n-1){if(e>a)continue;const t=this._$children[a-e];if(!t)return;if(t.dataset.frameState="key-frame",s.hasTween(a)){t.classList.add("tween-key-frame");const e=s.getTween(a);(e.endFrame-e.startFrame>1||s.hasTween(e.endFrame))&&t.classList.add("tween-key-frame-join")}else{const e=s.getPlace(a);if(e.tweenFrame){const r=s.getTween(e.tweenFrame);r.endFrame-1===a?s.hasTween(r.endFrame)?t.classList.add("tween-space-frame"):t.classList.add("tween-frame-end"):t.classList.add("tween-space-frame")}else t.classList.add("key-frame")}continue}let o=a;if(e>o)o++;else{const t=o-e,r=this._$children[t];o++,r&&(r.dataset.frameState="key-frame",s.hasTween(a)?r.classList.add("tween-key-frame","tween-key-frame-join"):r.classList.add("key-frame","key-frame-join"))}const l=n-1;for(;o<l;){if(e>o){o++;continue}const t=o-e,r=this._$children[t];o++,r&&(r.dataset.frameState="key-space-frame",s.hasTween(a)?r.classList.add("tween-space-frame"):r.classList.add("key-space-frame"))}if(e>o)continue;const c=this._$children[o-e];c&&(c.dataset.frameState="key-space-frame-end",s.hasTween(a)?c.classList.add("tween-frame-end"):c.classList.add("key-space-frame-end"))}}}setEmptyStyle(){const e=d.$timelineHeader.leftFrame,t=e+this._$children.length;for(let r=0;r<this._$emptys.length;++r){const a=this._$emptys[r];if(a.startFrame>t)continue;if(e>=a.endFrame)continue;if(a.startFrame===a.endFrame-1){if(e>a.startFrame)continue;const t=a.startFrame-e,r=this._$children[t];r&&(r.dataset.frameState="empty-key-frame",r.classList.add("empty-key-frame"));continue}let s=a.startFrame;if(e>s)s++;else{const t=s-e,r=this._$children[t];r&&(r.dataset.frameState="empty-key-frame",r.classList.add("empty-key-frame","empty-key-frame-join")),s++}const i=a.endFrame-1;for(;s<i;){if(e>s){s++;continue}const t=s-e,r=this._$children[t];s++,r&&(r.dataset.frameState="empty-space-frame",r.classList.add("empty-space-frame"))}if(e>s)continue;const n=s-e,o=this._$children[n];o&&(o.dataset.frameState="empty-space-frame-end",o.classList.add("empty-space-frame-end"))}}resetStyle(){let e=d.$timelineHeader.leftFrame;for(let t=0;t<this._$children.length;++t){const r=this._$children[t];if(!r||"empty"===r.dataset.frameState)return;r.setAttribute("class",e%5!=0?"frame":"frame frame-pointer"),r.setAttribute("data-frame-state","empty"),e++}}get id(){return this._$id}set id(e){this._$id=d.$clamp(0|e,0,65535)}get name(){return this._$name}set name(e){this._$name=`${e}`}get light(){return this._$light}set light(e){this._$light=!!e}get disable(){return this._$disable}set disable(e){this._$disable=!!e}get lock(){return this._$lock}set lock(e){this._$lock=!!e}get emptyCharacters(){const e=[];for(let t=0;t<this._$emptys.length;++t)e.push(this._$emptys[t].toObject());return e}set emptyCharacters(e){for(let t=0;t<e.length;++t){const r=new f(e[t]);this._$emptys.push(r)}}get characters(){const e=[];for(let t=0;t<this._$characters.length;++t)e.push(this._$characters[t].toObject());return e}set characters(e){for(let t=0;t<e.length;++t){const r=new p(e[t]);this._$instances.set(r.id,r),this._$characters.push(r)}}getCharacter(e){return this._$instances.get(0|e)}addCharacter(e){this._$instances.has(e.id)||(this._$characters.push(e),this._$instances.set(e.id,e))}deleteCharacter(e){if(!this._$instances.has(0|e))return;const t=this._$instances.get(0|e);this._$characters.splice(this._$characters.indexOf(t),1),this._$instances.delete(0|e)}addEmptyCharacter(e){this._$emptys.push(e)}deleteEmptyCharacter(e){const t=this._$emptys.indexOf(e);t>-1&&this._$emptys.splice(t,1)}adjustmentLocation(e){const t=this.getActiveEmptyCharacter(e);if(t)return this.deleteEmptyCharacter(t),{startFrame:t.startFrame,endFrame:t.endFrame};const r=this.getActiveCharacter(e);if(r.length){let t=1,a=Number.MAX_VALUE;for(let s=0;s<r.length;++s){const i=r[s];t=Math.max(t,i.startFrame),a=Math.min(a,i.endFrame);for(const r of i._$places.keys())r>e&&(a=Math.min(a,r)),e>=r&&(t=Math.max(t,r))}return{startFrame:t,endFrame:a}}if(e>1){let t=1;for(;e-t>0;++t){const r=this.getActiveEmptyCharacter(e-t);if(r){r.endFrame=e;break}const a=this.getActiveCharacter(e-t);if(a.length){for(let t=0;t<a.length;++t)a[t].endFrame=e;break}}e-t||this.addEmptyCharacter(new f({startFrame:1,endFrame:e}))}return{startFrame:e,endFrame:e+1}}get totalFrame(){let e=0;for(let t=0;t<this._$characters.length;++t){const r=this._$characters[t];e=Math.max(e,r.endFrame)}for(let t=0;t<this._$emptys.length;++t){const r=this._$emptys[t];e=Math.max(e,r.endFrame)}return e}get mode(){return this._$mode}set mode(e){switch(e|=0){case I.NORMAL:case I.MASK:case I.MASK_IN:case I.GUIDE:case I.GUIDE_IN:this._$mode=e;break;default:this._$mode=I.NORMAL}}get maskId(){return this._$maskId}set maskId(e){this._$maskId="number"==typeof e?d.$clamp(0|e,0,65535):null}get guideId(){return this._$guideId}set guideId(e){this._$guideId="number"==typeof e?d.$clamp(0|e,0,65535):null}get color(){return this._$color}set color(e){this._$color=`${e}`}toObject(){return{name:this.name,light:this.light,disable:this.disable,lock:this.lock,mode:this.mode,maskId:this.maskId,guideId:this.guideId,color:this.color,characters:this.characters,emptyCharacters:this.emptyCharacters}}}class I{static get NORMAL(){return 0}static get MASK(){return 1}static get MASK_IN(){return 2}static get GUIDE(){return 3}static get GUIDE_IN(){return 4}}class E extends g{constructor(e){super(e),this._$currentFrame=1,this._$layerId=0,this._$labels=new Map,this._$layers=new Map,this._$actions=new Map,this._$sounds=new Map,this._$publishObject=null,e.layers&&(this.layers=e.layers),e.labels&&(this.labels=e.labels),e.placeMap&&(this.placeMap=e.placeMap),e.sounds&&(this.sounds=e.sounds),e.actions&&(this.actions=e.actions),e.currentFrame&&(this._$currentFrame=Math.max(1,0|e.currentFrame))}clone(){return new E(JSON.parse(JSON.stringify(this.toObject())))}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["text-setting","video-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["loop-setting"]),d.$loopController.reload(e.loop),document.getElementById("loop-image-list").style.display="none"}initialize(){d.$tools.reset(),d.$screen.clearStageArea(),d.$clearShapePointer(),this.cacheClear();const e=document.getElementById("scene-name");e&&(e.textContent=this.name);const t=document.getElementById("object-name");t&&(t.value=this.name);const r=document.getElementById("object-symbol");if(r&&(r.value=this.symbol),0===this.id){const e=document.getElementById("scene-name-menu-list");if(e)for(;e.children.length;)e.children[0].remove()}d.$timelineLayer.removeAll();const a=d.$currentWorkSpace()._$currentFrame||1;d.$timelineFrame.currentFrame=a,d.$timelineHeader.setWidth(),d.$timelineHeader.scrollX=(a-1)*d.$timelineTool.timelineWidth,d.$timelineHeader.rebuild(),d.$timelineMarker.move(),d.$timelineLayer.changeLabel(a),d.$timelineLayer.updateClientSize(),d.$timelineScroll.updateWidth(),d.$timelineScroll.updateHeight(),d.$timelineScroll.execute(-d.$timelineScroll.x,-d.$timelineScroll.y),this._$layerId=0;for(const e of this._$layers.values())e._$id=this._$layerId++,e.initialize();if(this._$layers.size||this.addLayer(),d.$controller.default(),this.id){const e=document.getElementById(`library-child-id-${this.id}`);e&&(e.draggable=!1)}if(!this.id){const e=d.$currentWorkSpace();if(e._$ruler)d.$screenRuler.show();else{const t=e._$rulerX,r=e._$rulerY;(t.length||r.length)&&d.$screenRuler.createBorder()}}d.$soundController.createSoundElements(),this.changeFrame(d.$timelineFrame.currentFrame)}get currentFrame(){return this._$currentFrame}get totalFrame(){let e=1;for(const t of this._$layers.values())e=Math.max(e,t.totalFrame-1);return e}changeFrame(e=1){const t=document.getElementById("stage-area");if(!t)return Promise.resolve();this.startSound(e);const r=[];if(d.$sceneChange.matrix.length){const e=document.getElementById("scene-name-menu-list").children,t=d.$activeCharacterIds.length?d.$activeCharacterIds[d.$activeCharacterIds.length-1]:-1,a=d.$currentWorkSpace(),s=d.$sceneChange.offsetX,i=d.$sceneChange.offsetY,n=d.$sceneChange.matrix.slice(0);d.$sceneChange.clear();for(let s=0;e.length>s;++s){const i=e[s];if("false"===i.dataset.parent)continue;const o=a.getLibrary(0|i.dataset.libraryId);d.$sceneChange.offsetX=+i.dataset.offsetX,d.$sceneChange.offsetY=+i.dataset.offsetY,s&&d.$sceneChange.matrix.push(n[s-1]);const l=o.currentFrame;for(const e of o._$layers.values()){if(e.mode===I.MASK)continue;const a=e.getActiveCharacter(l);if(a.length){a.length>1&&e.sort(a,l);for(let s=0;s<a.length;++s){const i=a[s];i.id!==t&&r.push(d.$screen.appendCharacter(i,l,e.id,"none",o,.25,d.$sceneChange.offsetX,d.$sceneChange.offsetY))}}}break}d.$sceneChange._$matrix=n,d.$sceneChange.offsetX=s,d.$sceneChange.offsetY=i}const a=Array.from(this._$layers.values());for(;a.length;){const t=a.pop();t.mode===I.MASK&&t.lock||r.push(t.appendCharacter(e))}return this._$currentFrame=e,Promise.all(r).then((e=>{d.$screen.clearStageArea();const r=[],a=t.children;for(let e=0;a.length>e;++e){const t=a[e];t.dataset.shapePointer&&(t.remove(),r.push(t),--e)}for(let r=0;e.length>r;++r){const a=e[r];if(a)if(Array.isArray(a))for(let e=0;a.length>e;++e){const r=a[e];r&&(r.div.appendChild(r.canvas),t.appendChild(r.div))}else a.div.appendChild(a.canvas),t.appendChild(a.div)}d.$transformController.relocation(),d.$gridController.relocation();for(let e=0;r.length>e;++e)t.appendChild(r[e]);if(d.$tweenController.clearPointer().relocationPointer(),this.id){const e=document.createElement("div");e.setAttribute("class","standard-point");const t=d.$offsetLeft+d.$sceneChange.offsetX*d.$zoomScale-6,r=d.$offsetTop+d.$sceneChange.offsetY*d.$zoomScale-6;e.setAttribute("style",`left: ${t}px; top: ${r}px;`),e.dataset.child="true",document.getElementById("stage-area").appendChild(e)}for(;d.$sleepCanvases.length;)d.$poolCanvas(d.$sleepCanvases.pop())}))}startSound(e=1){if(d.$timelinePlayer.stopFlag||!this._$sounds.has(e))return;const{Sound:t}=window.next2d.media,r=d.$currentWorkSpace(),a=this._$sounds.get(e);for(let e=0;e<a.length;++e){const s=a[e],i=r.getLibrary(s.characterId);if(!i)continue;const n=new t;n.volume=s.volume/100,n.loopCount=s.loopCount,n.src=URL.createObjectURL(new Blob([new Uint8Array(i._$buffer)],{type:"audio/mp3"})),n.play(),d.$timelinePlayer._$sounds.push(n)}}addSceneName(e=!1){const t=d.$currentWorkSpace().getLibrary(0|this.id),r=`\n<div id="scene-instance-id-${t.id}" data-library-id="${t.id}" data-offset-x="${d.$sceneChange.offsetX}" data-offset-y="${d.$sceneChange.offsetY}" data-parent="${e}">${t.name}</div>\n`;document.getElementById("scene-name-menu-list").insertAdjacentHTML("beforeend",r);const a=document.getElementById(`scene-instance-id-${t.id}`);a.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault()})),a.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),d.$endMenu();const t=Array.from(document.getElementById("scene-name-menu-list").children),r=e.target,a=t.indexOf(r);for(let e=t.length-1;e>-1;--e){if(t[e].remove(),d.$activeCharacterIds.pop(),d.$sceneChange.matrix.pop(),a===e)break}d.$sceneChange.offsetX=+r.dataset.offsetX,d.$sceneChange.offsetY=+r.dataset.offsetY,d.$sceneChange.execute(0|r.dataset.libraryId)}))}cacheClear(){for(const e of this._$layers.values()){const t=e._$characters;for(let e=0;e<t.length;++e)t[e].dispose()}if(d.$activeCharacterIds.length){const e=document.getElementById("scene-name-menu-list").children,t=d.$activeCharacterIds[d.$activeCharacterIds.length-1],r=d.$currentWorkSpace();for(let a=0;e.length>a;++a){const s=e[a];if("false"===s.dataset.parent)continue;const i=r.getLibrary(0|s.dataset.libraryId);if(!i)continue;const n=i.currentFrame;for(const e of i._$layers.values()){if(e.mode===I.MASK)continue;const r=e.getActiveCharacter(n);if(r.length)for(let e=0;e<r.length;++e){const a=r[e];a.id!==t&&a.dispose()}}break}}}stop(){if(this.id){const e=document.getElementById(`library-child-id-${this.id}`);e&&(e.draggable=!0)}const e=document.getElementById("timeline-content");if(!e)return;const t=e.children,r=[],a=t.length;for(let e=0;e<a;++e){const a=this.getLayer(0|t[e].dataset.layerId);a._$children.length=0,r.push(a)}this._$layers.clear();for(let e=0;e<r.length;++e){const t=r[e];t._$id=e,this.setLayer(e,t)}d.$tools.getDefaultTool("arrow").clear(),this.cacheClear()}get labels(){const e=[];for(let[t,r]of this._$labels)e.push({frame:t,name:r});return e}set labels(e){for(let t=0;t<e.length;++t){const r=e[t];this._$labels.set(0|r.frame,r.name)}}setLabel(e,t){this._$labels.set(0|e,t)}getLabel(e){return this.hasLabel(e)?this._$labels.get(0|e):null}hasLabel(e){return this._$labels.has(e)}deleteLabel(e){this._$labels.delete(0|e)}get layers(){let e=0,t=null;const r=[];for(const a of this._$layers.values()){const s=a.toObject();switch(s.mode){case I.MASK:case I.GUIDE:t=e;break;case I.MASK_IN:s.maskId=t;break;case I.GUIDE_IN:s.guideId=t;break;default:t=null}r.push(s),e++}return r}set layers(e){for(let t=0;t<e.length;++t)this._$layers.set(t,new v(e[t]))}addLayer(e=null){return e||(e=new v),e._$id=this._$layerId++,this._$layers.set(e._$id,e),e.initialize(),e}getLayer(e){return this._$layers.get(0|e)}setLayer(e,t){this._$layers.set(0|e,t)}deleteLayer(e){this._$layers.delete(0|e)}clearLayer(){this._$layers.clear()}get sounds(){const e=[];for(let[t,r]of this._$sounds)e.push({frame:t,sound:r});return e}set sounds(e){for(let t=0;t<e.length;++t){const r=e[t];this._$sounds.set(0|r.frame,r.sound)}}get actions(){const e=[];for(let[t,r]of this._$actions)e.push({frame:t,action:r});return e}set actions(e){for(let t=0;t<e.length;++t){const r=e[t];this._$actions.set(0|r.frame,r.action)}}getSound(e){return this._$sounds.get(e)}setSound(e,t){return this._$sounds.set(e,t)}hasSound(e){return this._$sounds.has(e)}deleteSound(e){this._$sounds.delete(e)}getAction(e){return this._$actions.get(e)}setAction(e,t){this._$actions.set(e,t),d.$javascriptController.reload()}hasAction(e){return this._$actions.has(e)}deleteAction(e){this._$actions.delete(e),d.$javascriptController.reload()}getBounds(e=[1,0,0,1,0,0],t=null,r=null,a=0){if(!this._$layers.size)return{xMin:0,xMax:0,yMin:0,yMax:0};const s=this.totalFrame,i=d.$currentFrame;let n=a||1;t&&r&&(n=d.$getFrame(t,r,i,s,a)),n>s&&(n=1);const o=e;d.$currentFrame=n;const l=d.$currentWorkSpace();let c=Number.MAX_VALUE,h=-Number.MAX_VALUE,u=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(const e of this._$layers.values()){if(e.disable)continue;const t=e.getActiveCharacter(n),r=t.length;for(let e=0;e<r;++e){const r=t[e],i=r.getPlace(n),g=i.loop&&i.loop.type===Me.DEFAULT?{startFrame:r.startFrame,endFrame:r.endFrame}:r.getRange(n),$=l.getLibrary(0|r.libraryId),p=d.$multiplicationMatrix(o,i.matrix),f=$.getBounds(p,i,g,1===s?a:n),y=f.xMax-f.xMin,_=f.yMax-f.yMin;y&&_||(f.xMin=p[4],f.xMax=p[4],f.yMin=p[5],f.yMax=p[5]),c=Math.min(f.xMin,c),h=Math.max(f.xMax,h),u=Math.min(f.yMin,u),m=Math.max(f.yMax,m)}}return d.$currentFrame=i,{xMin:c,xMax:h,yMin:u,yMax:m}}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,currentFrame:this.currentFrame,layers:this.layers,labels:this.labels,sounds:this.sounds,actions:this.actions}}toPublish(e=!1){const t=[],r=[],a=[],s=[],i=d.$currentWorkSpace(),n=new Map;let o=0;for(const e of i._$libraries.keys())n.set(e,o++);let l=0,c=!1,h=0;const u=d.$userSetting.getPublishSetting(),m=Array.from(this._$layers),g=[];let $=0,p=0;for(let n=m.length-1;n>-1;--n){if(h&&!g.length){h=0,$=0;continue}const o=!c&&g.length?g.shift():m[n][1];if(!u.layer&&o.disable)continue;if(o.mode===I.GUIDE)continue;if(o.mode!==I.MASK_IN||c||h||(c=!0,h=n),c&&o.mode===I.MASK_IN){$+=o._$characters.length,g.push(o);continue}const f=o._$characters,y=o.mode===I.MASK?Math.min(1,f.length):f.length;let _=o.mode===I.MASK?y-1:0;for(;;){const n=t.length,c=f[_];if(!c)break;const h=c.startFrame,u=c.endFrame,m=i._$libraries.get(c.libraryId);d.$useIds.has(m.id)||d.$useIds.set(m.id,!0);const g={name:c.name,characterId:m.id,endFrame:u,startFrame:h,clipDepth:o.mode===I.MASK?_+$+l:0};e&&(g.id=c.id),t.push(g);let v=0;for(let e=h;e<u;++e){e in r||(r[e]=[]),e in a||(a[e]=[]);const t=c.getPlace(e);if(c.hasPlace(e)){v=s.length;const e=[];for(let r=0;r<t.filter.length;++r){const a=t.filter[r];a.state&&e.push({class:a.name,params:a.toParamArray()})}const r={matrix:t.matrix,colorTransform:t.colorTransform,blendMode:t.blendMode,surfaceFilterList:e};if(m.type===b.MOVIE_CLIP&&Me.DEFAULT>t.loop.type){if(t.loop.referenceFrame){const e=c.getPlace(t.loop.referenceFrame);r.loop={type:e.loop.type,frame:e.frame,start:e.loop.start,end:e.loop.end}}else r.loop={type:t.loop.type,frame:t.frame,start:t.loop.start,end:t.loop.end};t.loop.tweenFrame&&(r.loop.tweenFrame=t.loop.tweenFrame)}s.push(r)}r[e][p+t.depth]=n,a[e][p+t.depth]=v}if(o.mode===I.MASK){if(--_,-1===_)break}else if(++_,_===y)break}l+=y,p+=y,c&&g.length&&(n=h+1,c=!1)}for(let e=1;r.length>e;++e){if(!(e in r))continue;const t=r[e],s=a[e];r[e]=t.filter((e=>"number"==typeof e)),a[e]=s.filter((e=>"number"==typeof e))}const f=[];for(let[e,t]of this._$sounds){const r={frame:e,sound:[]};for(let e=0;e<t.length;++e){const a=t[e],s=0|a.characterId;r.sound.push({characterId:s,volume:a.volume/100,autoPlay:a.autoPlay,loopCount:a.loopCount}),d.$useIds.has(s)||d.$useIds.set(s,!0)}f.push(r)}const y=[];for(let[e,t]of this._$actions){const r=t.replace(/("[^"]*\/\/.*?")|\/\/(?:.|\r?\n)*?(?:\r?\n|.*)?/g,"$1").replace(/(["'][^"']*\/\*.*?\*\/[^"']*["'])|\/\*(?:.|\r?\n)*?\*\//g,"$1").replace(/^\s+|\s+$/g,"").replace(/ +/g," ").split(/\r?\n/);let a=[];for(let e=0;e<r.length;++e){const t=r[e].trim();t.length&&a.push(t)}y.push({frame:e,action:a.join("\n")})}return{actions:y,symbol:this.symbol,extends:this.defaultSymbol,totalFrame:this.totalFrame,controller:r,dictionary:t,labels:this.labels,placeMap:a,placeObjects:s,sounds:f}}get defaultSymbol(){return window.next2d.display.MovieClip.namespace}createInstance(e,t,r=0,a=!1){const{MovieClip:s}=window.next2d.display,{Matrix:i,ColorTransform:n}=window.next2d.geom,o=d.$currentWorkSpace(),l=new s;l._$characterId=this.id;const c=d.$currentFrame;d.$useIds.clear();let h=null;d.$timelinePlayer._$stopFlag?(this._$publishObject&&(this._$publishObject=null),h=this.toPublish(!0)):(this._$publishObject||(this._$publishObject=this.toPublish(!0)),h=this._$publishObject);const u=this.totalFrame;let m=r||1;e&&t&&(m=d.$getFrame(e,t,c,u,r)),m>u&&(m=1),d.$currentFrame=m,l._$currentFrame=m;const g=h.controller[m];if(!g)return l;const $=d.$activeCharacterIds.length?d.$activeCharacterIds[d.$activeCharacterIds.length-1]:-1,p=h.placeMap[m];for(let e=0;g.length>e;++e){const s=h.dictionary[g[e]],c=o.getLibrary(s.characterId),u=h.placeObjects[p[e]];u.loop||(u.loop=d.$getDefaultLoopConfig());let f=null;switch(c.type){case b.MOVIE_CLIP:{if(!c._$layers.size)continue;const s=Array.from(c._$layers.values()).reverse();let i=null,n=-1;for(let t=0;t<s.length;++t){if(n++,n!==e)continue;const r=s[t].getActiveCharacter(m);r.length>1&&r.sort(((e,t)=>{const r=e.getPlace(m).depth,a=t.getPlace(m).depth;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}})),r.length&&(i=r[0].getRange(m))}u&&(u.frame=m,u.loop.type===Me.DEFAULT&&(i=t)),f=c.createInstance(u,i,r||m,a)}break;case b.SHAPE:f=c.createInstance(),f._$bitmapId=c._$bitmapId;break;default:f=c.createInstance()}!a&&$>-1&&s.id===$&&(f.visible=!1),f._$transform._$matrix=new i(u.matrix[0],u.matrix[1],u.matrix[2],u.matrix[3],u.matrix[4],u.matrix[5]),f._$transform._$colorTransform=new n(u.colorTransform[0],u.colorTransform[1],u.colorTransform[2],u.colorTransform[3],u.colorTransform[4],u.colorTransform[5],u.colorTransform[6],u.colorTransform[7]),f._$transform._$blendMode=u.blendMode;const y=[];for(let e=0;e<u.surfaceFilterList.length;++e){const t=u.surfaceFilterList[e],r=window.next2d.filters[t.class];y.push(new(r.bind.apply(r,t.params)))}f._$transform._$filters=y,f._$placeId=e,f._$clipDepth=s.clipDepth,f._$loaderInfo={_$id:0},f._$characterId=s.characterId,l.addChild(f)}return d.$currentFrame=c,l}}class S extends g{constructor(e=null){super(e),this._$bitmapId=0,this._$bounds=null,this._$grid=null,this._$inBitmap=!1,this._$recodes=[],e.inBitmap&&(this.inBitmap=e.inBitmap),e.recodes&&(this.recodes=e.recodes),e.bounds&&(this.bounds=e.bounds),e.bitmapId&&(this.bitmapId=e.bitmapId),e.grid&&(this.grid=e.grid),this._$graphicBuffer=null}clone(){return new S(JSON.parse(JSON.stringify(this.toObject())))}showController(e,t=""){super.showController(e,t),document.getElementById("nine-slice-setting-x").value="0",document.getElementById("nine-slice-setting-y").value="0",document.getElementById("nine-slice-setting-w").value="0",document.getElementById("nine-slice-setting-h").value="0",d.$controller.showObjectSetting(["nine-slice-setting"]),d.$controller.hideObjectSetting(["text-setting","loop-setting","video-setting","fill-color-setting"])}showShapeColor(e,t){this.setHitColor(t.offsetX,t.offsetY,e.matrix);const r=this._$grid;r&&r.x&&r.y&&(document.getElementById("nine-slice-setting-x").value=`${r.x}`,document.getElementById("nine-slice-setting-y").value=`${r.y}`,document.getElementById("nine-slice-setting-w").value=`${r.w}`,document.getElementById("nine-slice-setting-h").value=`${r.h}`,d.$gridController.show().relocation()),d.$hitColor&&d.$controller.showObjectSetting(["fill-color-setting","nine-slice-setting"])}getBounds(e=null){return e?d.$boundsMatrix(this._$bounds,e):this._$bounds}get inBitmap(){return this._$inBitmap}set inBitmap(e){this._$inBitmap=!!e}get width(){return Math.abs(this._$bounds.xMax-this._$bounds.xMin)}get height(){return Math.abs(this._$bounds.yMax-this._$bounds.yMin)}get defaultSymbol(){return window.next2d.display.Shape.namespace}get recodes(){if(!this._$inBitmap)return this._$recodes;const e=[],{BitmapData:t}=window.next2d.display;for(let r=0;this._$recodes.length>r;++r){const a=this._$recodes[r];e[r]=a,"object"==typeof a&&(a.namespace===t.namespace&&(e[r]={buffer:Array.from(a._$buffer),width:a.width,height:a.height}))}return e}set recodes(e){if(this._$recodes=e,this._$inBitmap){const{BitmapData:e}=window.next2d.display;for(let t=0;this._$recodes.length>t;++t){const r=this._$recodes[t];if("object"!=typeof r)continue;if(r.namespace===e.namespace)continue;if(!r.buffer)continue;const a=new e(r.width,r.height,!0,0);a._$buffer=new Uint8Array(r.buffer),this._$recodes[t]=a}}}get bounds(){return this._$bounds}set bounds(e){this._$bounds=e}get bitmapId(){return this._$bitmapId}set bitmapId(e){this._$bitmapId=0|e}get grid(){return this._$grid}set grid(e){this._$grid=e}createPointer(e,t,r){const{Graphics:a}=window.next2d.display;d.$clearShapePointer();const s=document.getElementById("stage-area");let i=2,n=null;for(let s=0;s<this._$recodes.length;)switch(this._$recodes[s++]){case a.MOVE_TO:i=s,n={idx:s,x:this._$recodes[s++],y:this._$recodes[s++]};break;case a.LINE_TO:this.addPointer(t,r,s,this._$recodes[s++],this._$recodes[s++],e,a.LINE_TO),this._$adjustmentPointer(s,i);break;case a.CUBIC:for(let i=0;2>i;++i)this.addPointer(t,r,s,this._$recodes[s++],this._$recodes[s++],e,a.CUBIC,!0);this.addPointer(t,r,s,this._$recodes[s++],this._$recodes[s++],e,a.CUBIC,!1),this._$adjustmentPointer(s,i);break;case a.CURVE_TO:this.addPointer(t,r,s,this._$recodes[s++],this._$recodes[s++],e,a.CURVE_TO,!0),this.addPointer(t,r,s,this._$recodes[s++],this._$recodes[s++],e,a.CURVE_TO),this._$adjustmentPointer(s,i);break;case a.FILL_STYLE:s+=4;break;case a.STROKE_STYLE:n&&(this.addPointer(t,r,n.idx,n.x,n.y,e,a.MOVE_TO),n=null),s+=8;break;case a.GRADIENT_FILL:s+=6;break;case a.GRADIENT_STROKE:s+=10;case a.BEGIN_PATH:case a.END_FILL:case a.END_STROKE:}d.$addModalEvent(s)}_$adjustmentPointer(e,t){const{Graphics:r}=window.next2d.display;switch(this._$recodes[e]){case r.MOVE_TO:case r.FILL_STYLE:case r.GRADIENT_FILL:{const e=document.getElementById("stage-area").children;e[e.length-1].dataset.syncId=`${t}`}}}addPointer(e,t,r,a,s,i,n,o=!1){const l=document.getElementById("stage-area"),c=document.createElement("div");c.classList.add("transform"),c.dataset.shapePointer="true",c.dataset.layerId=`${e}`,c.dataset.characterId=`${t}`,c.dataset.index=`${r}`,c.dataset.libraryId=`${this.id}`,c.dataset.curve=`${o}`,c.dataset.type=`${n}`,c.dataset.position=`${l.children.length}`;const h=a*i[0]+s*i[2]+i[4],u=a*i[1]+s*i[3]+i[5],m=d.$sceneChange.offsetX*d.$zoomScale,g=d.$sceneChange.offsetY*d.$zoomScale;c.style.left=h*d.$zoomScale+m+d.$offsetLeft-3+"px",c.style.top=u*d.$zoomScale+g+d.$offsetTop-3+"px",o?c.style.borderRadius="5px":c.dataset.detail="{{ダブルクリックでカーブポイントが追加されます}}",c.addEventListener("mousedown",(e=>{if(e.button)return;e.stopPropagation();const t=d.$tools.activeTool;t&&(e.shapePointer=!0,t.dispatchEvent(j.MOUSE_DOWN,e))})),c.addEventListener("dblclick",(e=>{e.stopPropagation();const t=d.$tools.activeTool;t&&(e.shapePointer=!0,e.matrix=i,t.dispatchEvent(j.DBL_CLICK,e))})),l.appendChild(c)}reloadBounds(){const{Graphics:e,Shape:t}=window.next2d.display,r=(new t).graphics,a=[];for(let t=0;t<this._$recodes.length;)switch(this._$recodes[t++]){case e.MOVE_TO:case e.LINE_TO:t+=2;break;case e.CURVE_TO:t+=4;break;case e.CUBIC:t+=6;break;case e.FILL_STYLE:a.push("fill"),t+=4;break;case e.STROKE_STYLE:a.push(t+1),t+=8;break;case e.GRADIENT_FILL:a.push("fill"),t+=6;break;case e.GRADIENT_STROKE:a.push(t+1),t+=10;case e.BEGIN_PATH:case e.END_FILL:case e.END_STROKE:}for(let t=0;t<this._$recodes.length;)switch(this._$recodes[t++]){case e.MOVE_TO:r.moveTo(this._$recodes[t++],this._$recodes[t++]);break;case e.LINE_TO:r.lineTo(this._$recodes[t++],this._$recodes[t++]);break;case e.CUBIC:r.cubicCurveTo(this._$recodes[t++],this._$recodes[t++],this._$recodes[t++],this._$recodes[t++],this._$recodes[t++],this._$recodes[t++]);break;case e.CURVE_TO:r.curveTo(this._$recodes[t++],this._$recodes[t++],this._$recodes[t++],this._$recodes[t++]);break;case e.FILL_STYLE:t+=4;break;case e.STROKE_STYLE:t+=8;break;case e.GRADIENT_FILL:{const{Matrix:e}=window.next2d.geom,a=new e,s=this.width/2/819.2,i=this.height/2/819.2;a.scale(s,i),a.translate(this.width/2+r._$xMin,this.height/2+r._$yMin),this._$recodes[t+2]=Array.from(a._$matrix),t+=6}break;case e.GRADIENT_STROKE:{const{Matrix:e}=window.next2d.geom,a=new e,s=this.width/2/819.2,i=this.height/2/819.2;a.scale(s,i),a.translate(this.width/2+r._$xMin,this.height/2+r._$yMin),this._$recodes[t+6]=Array.from(a._$matrix),t+=10}break;case e.BEGIN_PATH:{const e=a.shift();"fill"===e?r.beginFill():r.lineStyle(e)}break;case e.END_FILL:r.endFill();break;case e.END_STROKE:r.endLine()}return{xMin:r._$xMin,xMax:r._$xMax,yMin:r._$yMin,yMax:r._$yMax}}copyFrom(e){return e._$recodes=this._$recodes.slice(),e._$bounds={xMin:this._$bounds.xMin,xMax:this._$bounds.xMax,yMin:this._$bounds.yMin,yMax:this._$bounds.yMax},e._$bitmapId=this._$bitmapId,e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,bitmapId:this.bitmapId,grid:this.grid,inBitmap:this.inBitmap,recodes:this.recodes,bounds:this.bounds}}toPublish(){return this._$bitmapId&&d.$useIds.set(this._$bitmapId,!0),{symbol:this.symbol,extends:this.defaultSymbol,bitmapId:this.bitmapId,grid:this.grid,inBitmap:this.inBitmap,recodes:this.recodes,bounds:{xMin:this._$bounds.xMin,xMax:this._$bounds.xMax,yMin:this._$bounds.yMin,yMax:this._$bounds.yMax}}}changeStyle(e){const{Graphics:t,GradientType:r}=window.next2d.display,a=d.$hitColor.index;switch(d.$hitColor.style){case t.BITMAP_FILL:case t.FILL_STYLE:switch(document.getElementById("fill-color-type-select").value){case r.LINEAR:case r.RADIAL:{const r=document.getElementById("fill-color-value").value,s=d.$intToRGB(0|`0x${r.slice(1)}`),i=(0|document.getElementById("fill-alpha-value").value)/100*255;this.changeGradient(a,e,t.GRADIENT_FILL,6,s,i)}}break;case t.GRADIENT_FILL:{const r=document.getElementById("fill-color-type-select"),s=this._$recodes[a+1].pop();switch(r.value){case"bitmap":case"rgba":this._$recodes.splice(a-1,12,t.FILL_STYLE,s.R,s.G,s.B,s.A,t.END_FILL),d.$hitColor={index:a,style:t.FILL_STYLE,shape:this};break;default:this.changeGradient(a,e,t.GRADIENT_FILL,12,s,s.A)}}break;case t.STROKE_STYLE:switch(document.getElementById("fill-color-type-select").value){case r.LINEAR:case r.RADIAL:{const r=document.getElementById("fill-color-value").value,s=d.$intToRGB(0|`0x${r.slice(1)}`),i=(0|document.getElementById("fill-alpha-value").value)/100*255;this.changeGradient(a,e,t.GRADIENT_STROKE,5,s,i)}}break;case t.GRADIENT_STROKE:{const r=document.getElementById("fill-color-type-select"),s=this._$recodes[a+5].pop(),i=this._$recodes[a],n=this._$recodes[a+1],o=this._$recodes[a+2],l=this._$recodes[a+3];switch(r.value){case"bitmap":case"rgba":this._$recodes.splice(a-1,11,t.STROKE_STYLE,i,n,o,l,s.R,s.G,s.B,s.A,t.END_STROKE),d.$hitColor={index:a,width:i,style:t.STROKE_STYLE,shape:this};break;default:this.changeGradient(a,e,t.GRADIENT_STROKE,6,s,s.A)}}}this.cacheClear();const s=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(s)}changeGradient(e,t,r,a,s,i){const{Graphics:n,SpreadMethod:o,InterpolationMethod:l}=window.next2d.display,{Matrix:c}=window.next2d.geom,h=new c,u=this.width/2/819.2,m=this.height/2/819.2;h.scale(u,m),h.translate(this.width/2+this._$bounds.xMin,this.height/2+this._$bounds.yMin);const g=[{ratio:0,R:255,G:255,B:255,A:255},{ratio:1,R:s.R,G:s.G,B:s.B,A:i}];d.$hitColor={index:e,style:r,type:t,ratios:g,shape:this},n.GRADIENT_STROKE===r?(this._$recodes[e-1]=n.GRADIENT_STROKE,this._$recodes.splice(e+4,a,t,g,Array.from(h._$matrix),o.PAD,l.RGB,0),d.$hitColor.width=this._$recodes[e]):this._$recodes.splice(e-1,a,r,t,g,Array.from(h._$matrix),o.PAD,l.RGB,0),d.$shapeController.initializeGradient()}changeColor(e=-1){const{Graphics:t}=window.next2d.display,r=d.$hitColor.index;switch(d.$hitColor.style){case t.BITMAP_FILL:break;case t.BITMAP_STROKE:{const e=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[r]!==e){d.$hitColor.width=e,this._$recodes[r]=e;const t=this.reloadBounds(e);this._$bounds.xMin=t.xMin,this._$bounds.xMax=t.xMax,this._$bounds.yMin=t.yMin,this._$bounds.yMax=t.yMax,this.cacheClear()}}break;case t.FILL_STYLE:{const e=document.getElementById("fill-color-value").value,t=d.$intToRGB(0|`0x${e.slice(1)}`);this._$recodes[r]=t.R,this._$recodes[r+1]=t.G,this._$recodes[r+2]=t.B,this._$recodes[r+3]=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255)}break;case t.GRADIENT_FILL:{const t=this._$recodes[r+1],a=t[e>-1?e:t.length-1],s=document.getElementById("fill-color-value").value,i=d.$intToRGB(0|`0x${s.slice(1)}`);a.R=i.R,a.G=i.G,a.B=i.B,a.A=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255)}break;case t.STROKE_STYLE:{const e=document.getElementById("fill-color-value").value,t=d.$intToRGB(0|`0x${e.slice(1)}`);this._$recodes[r+4]=t.R,this._$recodes[r+5]=t.G,this._$recodes[r+6]=t.B,this._$recodes[r+7]=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255);const a=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[r]!==a){d.$hitColor.width=a,this._$recodes[r]=a;const e=this.reloadBounds(a);this._$bounds.xMin=e.xMin,this._$bounds.xMax=e.xMax,this._$bounds.yMin=e.yMin,this._$bounds.yMax=e.yMax,this.cacheClear()}}break;case t.GRADIENT_STROKE:{const t=this._$recodes[r+5],a=t[e>-1?e:t.length-1],s=document.getElementById("fill-color-value").value,i=d.$intToRGB(0|`0x${s.slice(1)}`);a.R=i.R,a.G=i.G,a.B=i.B,a.A=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255);const n=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[r]!==n){d.$hitColor.width=n,this._$recodes[r]=n;const e=this.reloadBounds(n);this._$bounds.xMin=e.xMin,this._$bounds.xMax=e.xMax,this._$bounds.yMin=e.yMin,this._$bounds.yMax=e.yMax,this.cacheClear()}}}this.cacheClear()}cacheClear(){const e=d.$currentWorkSpace().scene;for(const t of e._$layers.values()){const e=t._$characters.length;for(let r=0;r<e;++r){const e=t._$characters[r];e.libraryId===this.id&&e.dispose()}}this._$graphicBuffer=null}setHitColor(e,t,r){if(!this._$recodes.length)return;const{Graphics:a,GradientType:s}=window.next2d.display,{Point:i,Matrix:n}=window.next2d.geom,o=new n,l=Math.sqrt(r[0]*r[0]+r[1]*r[1])*d.$zoomScale,c=Math.sqrt(r[2]*r[2]+r[3]*r[3])*d.$zoomScale;o.scale(l,c);const h=Math.atan2(r[1],r[0]);h&&(o.translate(-this.width/2,-this.height/2),o.rotate(h),o.translate(this.width/2,this.height/2));const u=o.transformPoint(new i(0,0)),m=o.transformPoint(new i(this.width,0)),g=o.transformPoint(new i(0,this.height)),$=o.transformPoint(new i(this.width,this.height)),p=Math.min(u.x,m.x,g.x,$.x),f=Math.min(u.y,m.y,g.y,$.y);o.translate(-p,-f),d.$hitColor=null,d.$hitContext.lineWidth=0,d.$hitContext.beginPath(),d.$hitContext.setTransform(o._$matrix[0],o._$matrix[1],o._$matrix[2],o._$matrix[3],-this._$bounds.xMin*l+o._$matrix[4],-this._$bounds.yMin*c+o._$matrix[5]);const y=this._$recodes,_=y.length;for(let r=0;r<_;)switch(y[r++]){case a.BEGIN_PATH:d.$hitContext.beginPath();break;case a.MOVE_TO:d.$hitContext.moveTo(y[r++],y[r++]);break;case a.LINE_TO:d.$hitContext.lineTo(y[r++],y[r++]);break;case a.CURVE_TO:d.$hitContext.quadraticCurveTo(y[r++],y[r++],y[r++],y[r++]);break;case a.CUBIC:d.$hitContext.bezierCurveTo(y[r++],y[r++],y[r++],y[r++],y[r++],y[r++]);break;case a.FILL_STYLE:if(d.$hitContext.isPointInPath(e,t)){if(this._$bitmapId)d.$hitColor={index:r,style:a.BITMAP_FILL,shape:this},document.getElementById("fill-color-type-select")[1].selected=!0;else{d.$hitColor={index:r,style:a.FILL_STYLE,shape:this};const e=y[r].toString(16).padStart(2,"0"),t=y[r+1].toString(16).padStart(2,"0"),s=y[r+2].toString(16).padStart(2,"0");document.getElementById("fill-color-type-select")[0].selected=!0,document.getElementById("fill-color-value").value=`#${e}${t}${s}`,document.getElementById("fill-alpha-value").value=""+y[r+3]/255*100}d.$shapeController.changeFillColorTypeSelect()}r+=4;break;case a.GRADIENT_FILL:d.$hitContext.isPointInPath(e,t)&&(document.getElementById("fill-color-type-select")[y[r]===s.LINEAR?2:3].selected=!0,d.$hitColor={index:r,style:a.GRADIENT_FILL,type:y[r],ratios:y[r+1],shape:this},d.$shapeController.changeFillColorTypeSelect()),r+=6;break;case a.STROKE_STYLE:if(d.$hitContext.lineWidth=0|y[r],d.$hitContext.isPointInStroke(e,t)){if(this._$bitmapId)d.$hitColor={index:r,width:d.$hitContext.lineWidth,style:a.BITMAP_STROKE,shape:this},document.getElementById("fill-color-type-select")[1].selected=!0;else{d.$hitColor={index:r,width:d.$hitContext.lineWidth,style:a.STROKE_STYLE,shape:this};const e=y[r+4].toString(16).padStart(2,"0"),t=y[r+5].toString(16).padStart(2,"0"),s=y[r+6].toString(16).padStart(2,"0");document.getElementById("fill-color-type-select")[0].selected=!0,document.getElementById("fill-color-value").value=`#${e}${t}${s}`,document.getElementById("fill-alpha-value").value=""+y[r+7]/255*100}document.getElementById("fill-stroke-width-value").value=`${d.$hitContext.lineWidth}`,d.$shapeController.changeFillColorTypeSelect()}r+=8;break;case a.GRADIENT_STROKE:d.$hitContext.lineWidth=y[r],d.$hitContext.isPointInStroke(e,t)&&(document.getElementById("fill-color-type-select")[y[r+4]===s.LINEAR?2:3].selected=!0,d.$hitColor={index:r,width:y[r],style:a.GRADIENT_STROKE,type:y[r+4],ratios:y[r+5],shape:this},d.$shapeController.changeFillColorTypeSelect()),r+=10;case a.CLOSE_PATH:case a.END_STROKE:case a.END_FILL:}}createInstance(){const{Shape:e,Graphics:t}=window.next2d.display,r=new e;if(r._$loaderInfo=d.$loaderInfo,r._$characterId=this.id,this._$grid){const{Rectangle:e}=window.next2d.geom;r.scale9Grid=new e(this._$grid.x,this._$grid.y,this._$grid.w,this._$grid.h)}const a=r.graphics;if(a._$maxAlpha=1,a._$canDraw=!0,a._$xMin=this._$bounds.xMin,a._$xMax=this._$bounds.xMax,a._$yMin=this._$bounds.yMin,a._$yMax=this._$bounds.yMax,this._$bitmapId){const{BitmapData:e}=window.next2d.display,s=d.$currentWorkSpace().getLibrary(this._$bitmapId);if(s){r._$bitmapId=this._$bitmapId,a._$recode=[];const i=new e(s.width,s.height,!0,0);i._$buffer=s._$buffer;const n=this._$recodes;if(n[n.length-1]===t.END_FILL){const e=n.length-6;for(let t=0;t<e;++t)a._$recode.push(n[t]);a._$recode.push(t.BITMAP_FILL,i,null,"repeat",!1)}else{const e=this._$recodes[n.length-9],r=this._$recodes[n.length-8],s=this._$recodes[n.length-7],o=this._$recodes[n.length-6],l=n.length-10;for(let e=0;e<l;++e)a._$recode.push(n[e]);a._$recode.push(t.BITMAP_STROKE,e,r,s,o,i,[1,0,0,1,a._$xMin,a._$yMin],"repeat",!1)}}else a._$recode=this._$recodes.slice(0)}else a._$recode=this._$recodes.slice(0);return this._$graphicBuffer||(d.$root.stage._$player.removeCache(`${d.$loaderInfo._$id}@${this.id}`),this._$graphicBuffer=a._$getRecodes()),a._$buffer=this._$graphicBuffer,r}}class w extends g{constructor(e){super(e),this.buffer=e.buffer,this._$binary="",this._$volume=100,this._$loopCount=0,"volume"in e&&(this.volume=e.volume),"loopCount"in e&&(this.loopCount=e.loopCount),this._$audio=document.createElement("audio"),this._$audio.preload="auto",this._$audio.autoplay=!1,this._$audio.loop=!1,this._$audio.controls=!0,this._$audio.src=URL.createObjectURL(new Blob([new Uint8Array(this._$buffer)],{type:"audio/mp3"})),this._$audio.load()}clone(){return new w(JSON.parse(JSON.stringify(this.toObject())))}getPreview(){return Promise.resolve(this._$audio)}get defaultSymbol(){return window.next2d.media.Sound.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let r=0;r<t;++r)this._$buffer[r]=255&e.charCodeAt(r);this._$binary=e}}}get volume(){return this._$volume}set volume(e){this._$volume=e}get loopCount(){return this._$loopCount}set loopCount(e){this._$loopCount=e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,buffer:this.buffer,volume:this.volume,loopCount:this.loopCount}}toPublish(){return{buffer:Array.from(this._$buffer),audioBuffer:null,init:!1}}}class x{constructor(e=null){e?(this._$width=e.width,this._$height=e.height,this._$fps=e.fps,this._$bgColor=e.bgColor,this._$lock=e.lock):(this._$width=x.STAGE_DEFAULT_WIDTH,this._$height=x.STAGE_DEFAULT_HEIGHT,this._$fps=x.STAGE_DEFAULT_FPS,this._$bgColor="#ffffff",this._$lock=!1)}static get STAGE_DEFAULT_WIDTH(){return 550}static get STAGE_DEFAULT_HEIGHT(){return 400}static get STAGE_DEFAULT_FPS(){return 24}initialize(){d.$zoomScale=1;const e=document.getElementById("screen-scale");e&&(e.value="100");const t=document.getElementById("stage");t&&(t.style.width=`${this.width}px`,t.style.height=`${this.height}px`,t.style.backgroundColor=this.bgColor);const r=document.getElementById("library-preview-area");r&&(r.style.backgroundColor=this.bgColor);const a=document.getElementById("stage-area");if(a){let e="";e+=`width: ${this.width+window.screen.width}px;`,e+=`height: ${this.height+window.screen.height}px;`,a.setAttribute("style",e)}const s=document.getElementById("label-name");s&&(s.value="");const i=document.getElementById("stage-width");i&&(i.value=this.width);const n=document.getElementById("stage-height");n&&(n.value=this.height);const o=document.getElementById("stage-fps");o&&(o.value=this.fps);const l=document.getElementById("stage-bgColor");l&&(l.value=this.bgColor);const c=document.getElementById("stage-lock");if(c){c.childNodes[1].setAttribute("class",this.lock?"active":"disable")}d.$controller._$stageLock=this.lock;const h=document.getElementById("screen");h&&(h.scrollLeft=window.screen.width/2-(h.clientWidth-this.width)/2,h.scrollTop=window.screen.height/2-(h.clientHeight-this.height)/2),t&&(d.$offsetLeft=t.offsetLeft,d.$offsetTop=t.offsetTop)}get width(){return this._$width}set width(e){this._$width=d.$clamp(+e,1,4096)}get height(){return this._$height}set height(e){this._$height=d.$clamp(+e,1,4096)}get fps(){return this._$fps}set fps(e){this._$fps=d.$clamp(0|e,1,60)}get bgColor(){return this._$bgColor}set bgColor(e){this._$bgColor=`${e}`.toLowerCase()}get lock(){return this._$lock}set lock(e){this._$lock=!!e}toObject(){return{width:this.width,height:this.height,fps:this.fps,bgColor:this.bgColor,lock:this.lock}}}class L extends g{constructor(e=null){super(e),this._$text="",this._$font="sans-serif",this._$size=12,this._$align="left",this._$color=0,this._$fontType=0,this._$inputType="static",this._$leading=0,this._$letterSpacing=0,this._$leftMargin=0,this._$rightMargin=0,this._$autoSize=0,this._$multiline=!0,this._$wordWrap=!0,this._$border=!1,this._$scroll=!0,this._$cache=null,this._$htmlText=null,this._$thickness=0,this._$thicknessColor=0,this._$bounds={xMin:0,xMax:L.FONT_DEFAULT_SIZE,yMin:0,yMax:L.FONT_DEFAULT_SIZE},this._$originBounds={xMin:0,xMax:L.FONT_DEFAULT_SIZE,yMin:0,yMax:L.FONT_DEFAULT_SIZE},e.text&&(this.text=e.text),e.font&&(this.font=e.font),e.fontType&&(this.fontType=e.fontType),e.inputType&&(this.inputType=e.inputType),e.size&&(this.size=e.size),e.align&&(this.align=e.align),e.color&&(this.color=e.color),e.leading&&(this.leading=e.leading),e.letterSpacing&&(this.letterSpacing=e.letterSpacing),e.leftMargin&&(this.leftMargin=e.leftMargin),e.rightMargin&&(this.rightMargin=e.rightMargin),"multiline"in e&&(this.multiline=e.multiline),"wordWrap"in e&&(this.wordWrap=e.wordWrap),e.autoFontSize&&(this.autoFontSize=e.autoFontSize),"scroll"in e&&(this.scroll=e.scroll),e.border&&(this.border=e.border),e.bounds&&(this.bounds=e.bounds),e.originBounds&&(this.originBounds=e.originBounds),e.autoSize&&(this.autoSize=e.autoSize),e.thickness&&(this.thickness=e.thickness),e.thicknessColor&&(this.thicknessColor=e.thicknessColor)}static get FONT_DEFAULT_SIZE(){return 200}clone(){return new L(JSON.parse(JSON.stringify(this.toObject())))}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["video-setting","loop-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["text-setting"]);const r=document.getElementById("font-select");r.children[0].selected=!0;for(let e=0;e<r.children.length;++e){const t=r.children[e];if(t.value===this._$font){t.selected=!0;break}}const a=document.getElementById("font-style-select");for(let e=0;e<a.children.length;++e){const t=a.children[e];if((0|t.value)===this._$fontType){t.selected=!0;break}}const s=document.getElementById("font-align-select");for(let e=0;e<s.children.length;++e){const t=s.children[e];if(t.value===this._$align){t.selected=!0;break}}const i=document.getElementById("font-wrap-select");switch(!0){case!this._$wordWrap&&!this._$multiline:i.children[0].selected=!0;break;case!this._$wordWrap&&this._$multiline:i.children[1].selected=!0;break;case this._$wordWrap&&this._$multiline:i.children[2].selected=!0}document.getElementById("font-input-select").children["static"===this._$inputType?0:1].selected=!0,document.getElementById("font-size").value=`${this._$size}`,document.getElementById("font-color").value=`#${this._$color.toString(16).padStart(6,"0")}`,document.getElementById("font-stroke-size").value=`${this._$thickness}`,document.getElementById("font-stroke-color").value=`#${this._$thicknessColor.toString(16).padStart(6,"0")}`;const n=["font-leading","font-letterSpacing","font-leftMargin","font-rightMargin"];for(let e=0;e<n.length;++e){const t=n[e];document.getElementById(t).value=`${this[t.split("-")[1]]}`}document.getElementById("font-auto-size-select").children[this._$autoSize].selected=!0,this._$border&&(document.getElementById("font-border-select").children[1].selected=!0),this._$scroll&&(document.getElementById("font-scroll-select").children[0].selected=!0)}getBounds(e=null){const t={xMin:-this._$thickness,xMax:this._$bounds.xMax+this._$thickness,yMin:-this._$thickness,yMax:this._$bounds.yMax+4+this._$thickness};return e?d.$boundsMatrix(t,e):t}get text(){return this._$text}set text(e){this._$text=`${e}`,this.resize()}get size(){return this._$size}set size(e){this._$size=0|e,this.resize()}get font(){return this._$font}set font(e){this._$font=`${e}`,this.resize()}get fontType(){return this._$fontType}set fontType(e){this._$fontType=0|e,this.resize()}get inputType(){return this._$inputType}set inputType(e){e=`${e}`.toLowerCase(),this._$inputType="static"===e?e:"input"}get align(){return this._$align}set align(e){switch(e=`${e}`.toLowerCase()){case"right":case"center":this._$align=e;break;default:this._$align="left"}this._$align=e}get color(){return this._$color}set color(e){this._$color=0|e}get leading(){return this._$leading}set leading(e){this._$leading=0|e,this.resize()}get letterSpacing(){return this._$letterSpacing}set letterSpacing(e){this._$letterSpacing=0|e,this.resize()}get leftMargin(){return this._$leftMargin}set leftMargin(e){this._$leftMargin=0|e,this.resize()}get rightMargin(){return this._$rightMargin}set rightMargin(e){this._$rightMargin=0|e,this.resize()}get multiline(){return this._$multiline}set multiline(e){this._$multiline=!!e,this.resize()}get border(){return this._$border}set border(e){this._$border=!!e}get scroll(){return this._$scroll}set scroll(e){this._$scroll=!!e}get wordWrap(){return this._$wordWrap}set wordWrap(e){this._$wordWrap=!!e,this.resize()}get bounds(){return this._$bounds}set bounds(e){this._$bounds=e}get originBounds(){return this._$originBounds}set originBounds(e){this._$originBounds=e}get autoSize(){return this._$autoSize}set autoSize(e){this._$autoSize=0|e,1!==this._$autoSize&&(this._$bounds.xMax=this._$originBounds.xMax,this._$bounds.yMax=this._$originBounds.yMax),this.resize()}get thickness(){return this._$thickness}set thickness(e){this._$thickness=0|e,this.resize()}get thicknessColor(){return this._$thicknessColor}set thicknessColor(e){this._$thicknessColor=0|e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,text:this.text,font:this.font,fontType:this.fontType,inputType:this.inputType,size:this.size,align:this.align,color:this.color,leading:this.leading,letterSpacing:this.letterSpacing,leftMargin:this.leftMargin,rightMargin:this.rightMargin,multiline:this.multiline,wordWrap:this.wordWrap,border:this.border,autoSize:this.autoSize,scroll:this.scroll,originBounds:this.originBounds,bounds:this.bounds,thickness:this.thickness,thicknessColor:this.thicknessColor}}get defaultSymbol(){return window.next2d.text.TextField.namespace}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,text:this.text,font:this.font,fontType:this.fontType,inputType:this.inputType,size:this.size,align:this.align,color:this.color,leading:this.leading,letterSpacing:this.letterSpacing,leftMargin:this.leftMargin,rightMargin:this.rightMargin,multiline:this.multiline,wordWrap:this.wordWrap,border:this.border,autoSize:this.autoSize,scroll:this.scroll,originBounds:this.originBounds,bounds:this.bounds,thickness:this.thickness,thicknessColor:this.thicknessColor}}resize(){const e=this.createInstance();this._$bounds={xMin:e._$bounds.xMin,xMax:e._$bounds.xMax,yMin:e._$bounds.yMin,yMax:e._$bounds.yMax}}createInstance(){const{TextField:e}=window.next2d.text,t=new e;t._$loaderInfo=d.$loaderInfo,t._$characterId=this.id,t._$bounds={xMin:this._$originBounds.xMin,xMax:this._$originBounds.xMax,yMin:this._$originBounds.yMin,yMax:this._$originBounds.yMax},t._$originBounds={xMin:this._$originBounds.xMin,xMax:this._$originBounds.xMax,yMin:this._$originBounds.yMin,yMax:this._$originBounds.yMax};const r=t.defaultTextFormat;switch(r.font=this._$font,r.size=this._$size,r.align=this._$align,r.color=this._$color,r.leading=this._$leading,r.letterSpacing=this._$letterSpacing,r.leftMargin=this._$leftMargin,r.rightMargin=this._$rightMargin,this._$fontType){case 1:r.bold=!0;break;case 2:r.italic=!0;break;case 3:r.bold=!0,r.italic=!0}switch(this._$autoSize){case 1:t.autoSize=this._$align;break;case 2:t.autoFontSize=!0}return t.multiline=this._$multiline,t.wordWrap=this._$wordWrap,t.border=this._$border,t.scroll=this._$scroll,t.thickness=this._$thickness,t.thicknessColor=this._$thicknessColor,t.text=this._$text,t}draw(e,t,r,a,s=null,i=0,n=!1){return super.draw(e,t,r,a,s,i,n).then((e=>{e._$tx-=this._$thickness,e._$ty-=this._$thickness;let t=0;switch(this._$autoSize){case 0:"right"===this._$align&&(t=-4);break;case 1:switch(this._$align){case"center":t=(this._$bounds.xMax-this._$originBounds.xMax)/2,t&&(t-=2);break;case"right":t=this._$originBounds.xMax-this._$bounds.xMax,t&&(t+=2,t*=-1)}}return 1===this._$autoSize&&(e._$tx-=t),Promise.resolve(e)}))}}class M extends g{constructor(e){super(e),this._$volume=100,this._$loop=!1,this._$autoPlay=!0,this._$binary="",this._$queue=[],this._$loaded=!1,this.buffer=e.buffer,this.width=0|e.width,this.height=0|e.height,"volume"in e&&(this.volume=e.volume),"loop"in e&&(this.loop=e.loop),"autoPlay"in e&&(this.autoPlay=e.autoPlay),this._$video=document.createElement("video"),this._$video.crossOrigin="anonymous",this._$video.type="video/mp4",this._$video.muted=!0,this._$video.autoplay=!1;const t=e=>{const r=e.target;r.removeEventListener("canplaythrough",t),r.play(),r.currentTime=0,r.pause(),setTimeout((()=>{this.delayImage()}),150)};this._$video.addEventListener("canplaythrough",t),this._$video.src=URL.createObjectURL(new Blob([new Uint8Array(this._$buffer)],{type:"video/mp4"})),this._$video.load()}clone(){return new M(JSON.parse(JSON.stringify(this.toObject())))}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["text-setting","loop-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["video-setting"]),document.getElementById("video-volume").value=this.volume,document.getElementById("video-loop-select").children[this.loop?1:0].selected=!0,document.getElementById("video-auto-select").children[this.autoPlay?1:0].selected=!0}getPreview(){const e=this.getBounds();let t=Math.abs(e.xMax-e.xMin),r=Math.abs(e.yMax-e.yMin),a=1;const s=150/r;t=t*s|0,r=r*s|0;const i=(0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0])-10;return t>i&&(a=i/t,t=t*a|0,r=r*a|0),this._$video.style.width=`${t}px`,this._$video.style.height=`${r}px`,this._$video.controls=!0,Promise.resolve(this._$video)}getBounds(e=null){const t={xMin:0,xMax:this.width,yMin:0,yMax:this.height};return e?d.$boundsMatrix(t,e):t}get defaultSymbol(){return window.next2d.media.Video.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let r=0;r<t;++r)this._$buffer[r]=255&e.charCodeAt(r);this._$binary=e}}}get volume(){return this._$volume}set volume(e){this._$volume=d.$clamp(0|e,0,100)}get loop(){return this._$loop}set loop(e){this._$loop=!!e}get autoPlay(){return this._$autoPlay}set autoPlay(e){this._$autoPlay=!!e}get width(){return this._$width}set width(e){this._$width=0|e}get height(){return this._$height}set height(e){this._$height=0|e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,width:this.width,height:this.height,buffer:this.buffer,volume:this.volume,loop:this.loop,autoPlay:this.autoPlay}}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,buffer:Array.from(this._$buffer),bounds:this.getBounds(),volume:this.volume/100,loop:this.loop,autoPlay:this.autoPlay}}createInstance(e){e||console.log(e);const{Video:t}=window.next2d.media,r=this._$loaded?new t(this._$video.videoWidth,this._$video.videoHeight):new t(this.width,this.height);return r._$loaderInfo=d.$loaderInfo,r._$characterId=this.id,r._$video=this._$video,r._$createContext(),r}delayImage(){this._$loaded=!0;for(let e=0;e<this._$queue.length;++e){const t=this._$queue[e];this.draw(t.canvas,t.width,t.height,t.place,t.range,t.staticFrame)}this._$queue.length=0}draw(e,t,r,a,s=null,i=0,n=!1){return new Promise((e=>{this._$video.currentTime=d.$timelineFrame.currentFrame/60;const t=()=>{this._$loaded?e():requestAnimationFrame(t)};t()})).then((()=>super.draw(e,t,r,a,s,i,n).then((e=>Promise.resolve(e)))))}}class C{constructor(e=null){this._$blurX=4,this._$blurY=4,this._$quality=1,this._$state=!0,this._$name="",e&&(this.blurX=e.blurX,this.blurY=e.blurY,this.quality=0|e.quality,this.state=e.state)}clone(){return new this.constructor(JSON.parse(JSON.stringify(this.toObject())))}isSame(e){return this._$quality===e._$quality&&(this._$blurX===e._$blurX&&this._$blurY===e._$blurY)}get blurX(){return this._$blurX}set blurX(e){this._$blurX=d.$clamp(+e,we.MIN_BLUR,we.MAX_BLUR)}get blurY(){return this._$blurY}set blurY(e){this._$blurY=d.$clamp(+e,we.MIN_BLUR,we.MAX_BLUR)}get quality(){return this._$quality}set quality(e){this._$quality=d.$clamp(0|e,1,3)}get state(){return this._$state}set state(e){this._$state=e}get name(){return this._$name}set name(e){this._$name=e}}class F extends C{constructor(e=null){super(e),this.name="BevelFilter",this._$distance=4,this._$angle=45,this._$highlightColor=16777215,this._$highlightAlpha=100,this._$shadowColor=0,this._$shadowAlpha=100,this._$strength=1,this._$type="inner",this._$knockout=!1,e&&(this.distance=e.distance,this.angle=e.angle,this.highlightColor=0|e.highlightColor,this.highlightAlpha=100*e.highlightAlpha,this.shadowColor=0|e.shadowColor,this.shadowAlpha=100*e.shadowAlpha,this.strength=e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,we.MIN_DISTANCE,we.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get highlightColor(){return this._$highlightColor}set highlightColor(e){this._$highlightColor=d.$clamp(0|e,0,16777215)}get highlightAlpha(){return this._$highlightAlpha}set highlightAlpha(e){this._$highlightAlpha=d.$clamp(+e,0,100)}get shadowColor(){return this._$shadowColor}set shadowColor(e){this._$shadowColor=d.$clamp(0|e,0,16777215)}get shadowAlpha(){return this._$shadowAlpha}set shadowAlpha(e){this._$shadowAlpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,we.MIN_STRENGTH,we.MAX_STRENGTH)}get type(){return this._$type}set type(e){switch(e=`${e}`.toLowerCase()){case"outer":case"inner":this._$type=e;break;default:this._$type="full"}}get knockout(){return this._$knockout}set knockout(e){this._$knockout=!!e}isSame(e){return this._$distance===e._$distance&&(this._$angle===e._$angle&&(this._$highlightColor===e._$highlightColor&&(this._$highlightAlpha===e._$highlightAlpha&&(this._$shadowColor===e._$shadowColor&&(this._$shadowAlpha===e._$shadowAlpha&&(this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))))))))}createInstance(){return new window.next2d.filters.BevelFilter(this.distance,this.angle,this.highlightColor,this.highlightAlpha/100,this.shadowColor,this.shadowAlpha/100,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){return[null,this.distance,this.angle,this.highlightColor,this.highlightAlpha/100,this.shadowColor,this.shadowAlpha/100,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,highlightColor:this.highlightColor,highlightAlpha:this.highlightAlpha/100,shadowColor:this.shadowColor,shadowAlpha:this.shadowAlpha/100,strength:this.strength,type:this.type,knockout:this.knockout}}}class k extends C{constructor(e=null){super(e),this.name="BlurFilter"}createInstance(){return new window.next2d.filters.BlurFilter(this.blurX,this.blurY,this.quality)}toParamArray(){return[null,this.blurX,this.blurY,this.quality]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state}}}class A extends C{constructor(e=null){super(e),this.name="DropShadowFilter",this._$distance=4,this._$angle=45,this._$color=0,this._$alpha=100,this._$strength=1,this._$inner=!1,this._$knockout=!1,this._$hideObject=!1,e&&(this.distance=e.distance,this.angle=e.angle,this.color=e.color,this.alpha=100*e.alpha,this.strength=e.strength,this.inner=e.inner,this.knockout=e.knockout,this.hideObject=e.hideObject)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,we.MIN_DISTANCE,we.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get color(){return this._$color}set color(e){this._$color=d.$clamp(0|e,0,16777215)}get alpha(){return this._$alpha}set alpha(e){this._$alpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,we.MIN_STRENGTH,we.MAX_STRENGTH)}get inner(){return this._$inner}set inner(e){this._$inner=!!e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=!!e}get hideObject(){return this._$hideObject}set hideObject(e){this._$hideObject=!!e}isSame(e){return this._$distance===e._$distance&&(this._$angle===e._$angle&&(this._$color===e._$color&&(this._$alpha===e._$alpha&&(this._$strength===e._$strength&&(this._$inner===e._$inner&&(this._$knockout===e._$knockout&&(this._$hideObject===e._$hideObject&&super.isSame(e))))))))}createInstance(){return new window.next2d.filters.DropShadowFilter(this.distance,this.angle,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout,this.hideObject)}toParamArray(){return[null,this.distance,this.angle,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout,this.hideObject]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,color:this.color,alpha:this.alpha/100,strength:this.strength,inner:this.inner,knockout:this.knockout,hideObject:this.hideObject}}}class T extends C{constructor(e=null){super(e),this.name="GlowFilter",this._$color=0,this._$alpha=100,this._$strength=1,this._$inner=!1,this._$knockout=!1,e&&(this.color=e.color,this.alpha=100*e.alpha,this.strength=e.strength,this.inner=e.inner,this.knockout=e.knockout)}get color(){return this._$color}set color(e){this._$color=d.$clamp(0|e,0,16777215)}get alpha(){return this._$alpha}set alpha(e){this._$alpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,we.MIN_STRENGTH,we.MAX_STRENGTH)}get inner(){return this._$inner}set inner(e){this._$inner=!!e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=!!e}isSame(e){return this._$color===e._$color&&(this._$alpha===e._$alpha&&(this._$strength===e._$strength&&(this._$inner===e._$inner&&(this._$knockout===e._$knockout&&super.isSame(e)))))}createInstance(){return new window.next2d.filters.GlowFilter(this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout)}toParamArray(){return[null,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,color:this.color,alpha:this.alpha/100,strength:this.strength,inner:this.inner,knockout:this.knockout}}}class B extends C{constructor(e=null){super(e),this.name="GradientBevelFilter",this._$distance=4,this._$angle=45,this._$colors=[16777215,16711680,0],this._$alphas=[100,0,100],this._$ratios=[0,128,255],this._$strength=1,this._$type="inner",this._$knockout=!1,e&&(this.distance=+e.distance,this.angle=+e.angle,this.colors=e.colors,this.alphas=e.alphas,this.ratios=e.ratios,this.strength=+e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,we.MIN_DISTANCE,we.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get colors(){return this._$colors}set colors(e){this._$colors.length=0,this._$colors=e}get alphas(){return this._$alphas}set alphas(e){this._$alphas.length=0;for(let t=0;t<e.length;++t)this._$alphas.push(100*e[t])}get ratios(){return this._$ratios}set ratios(e){this._$ratios.length=0;for(let t=0;t<e.length;++t)this._$ratios.push(255*e[t])}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,we.MIN_STRENGTH,we.MAX_STRENGTH)}get type(){return this._$type}set type(e){switch(e=`${e}`.toLowerCase()){case"outer":case"full":this._$type=e;break;default:this._$type="inner"}}get knockout(){return this._$knockout}set knockout(e){this._$knockout=!!e}adjustment(){const e=[],t=[],r=[],a=new Map;for(let t=0;t<this._$ratios.length;++t){const r=this._$ratios[t]/255;e.push(r),a.set(r,t)}e.sort((function(e,t){switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let s=0;s<e.length;++s){const i=a.get(e[s]);t.push(this._$colors[i]),r.push(this._$alphas[i]/100)}return{ratios:e,colors:t,alphas:r}}isSame(e){if(this._$distance!==e._$distance)return!1;if(this._$angle!==e._$angle)return!1;for(let t=0;t<this._$colors.length;++t)if(this._$colors[t]!==e._$colors[t])return!1;for(let t=0;t<this._$alphas.length;++t)if(this._$alphas[t]!==e._$alphas[t])return!1;for(let t=0;t<this._$ratios.length;++t)if(this._$ratios[t]!==e._$ratios[t])return!1;return this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))}createInstance(){const e=this.adjustment();return new window.next2d.filters.GradientBevelFilter(this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){const e=this.adjustment();return[null,this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){const e=this.adjustment();return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,colors:e.colors,alphas:e.alphas,ratios:e.ratios,strength:this.strength,type:this.type,knockout:this.knockout}}}class P extends C{constructor(e=null){super(e),this.name="GradientGlowFilter",this._$distance=4,this._$angle=45,this._$colors=[16777215,0],this._$alphas=[0,100],this._$ratios=[0,255],this._$strength=1,this._$type="outer",this._$knockout=!1,e&&(this.distance=+e.distance,this.angle=+e.angle,this.colors=e.colors,this.alphas=e.alphas,this.ratios=e.ratios,this.strength=+e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,we.MIN_DISTANCE,we.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get colors(){return this._$colors}set colors(e){this._$colors.length=0,this._$colors=e}get alphas(){return this._$alphas}set alphas(e){this._$alphas.length=0;for(let t=0;t<e.length;++t)this._$alphas.push(100*e[t])}get ratios(){return this._$ratios}set ratios(e){this._$ratios.length=0;for(let t=0;t<e.length;++t)this._$ratios.push(255*e[t])}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,we.MIN_STRENGTH,we.MAX_STRENGTH)}get type(){return this._$type}set type(e){switch(e=`${e}`.toLowerCase()){case"outer":case"full":this._$type=e;break;default:this._$type="inner"}}get knockout(){return this._$knockout}set knockout(e){this._$knockout=!!e}adjustment(){const e=[],t=[],r=[],a=new Map;for(let t=0;t<this._$ratios.length;++t){const r=this._$ratios[t]/255;e.push(r),a.set(r,t)}e.sort((function(e,t){switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let s=0;s<e.length;++s){const i=a.get(e[s]);t.push(this._$colors[i]),r.push(this._$alphas[i]/100)}return{ratios:e,colors:t,alphas:r}}isSame(e){if(this._$distance!==e._$distance)return!1;if(this._$angle!==e._$angle)return!1;for(let t=0;t<this._$colors.length;++t)if(this._$colors[t]!==e._$colors[t])return!1;for(let t=0;t<this._$alphas.length;++t)if(this._$alphas[t]!==e._$alphas[t])return!1;for(let t=0;t<this._$ratios.length;++t)if(this._$ratios[t]!==e._$ratios[t])return!1;return this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))}createInstance(){const e=this.adjustment();return new window.next2d.filters.GradientGlowFilter(this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){const e=this.adjustment();return[null,this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){const e=this.adjustment();return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,colors:e.colors,alphas:e.alphas,ratios:e.ratios,strength:this.strength,type:this.type,knockout:this.knockout}}}class O{matrix(e=1,t=0,r=0,a=1,s=0,i=0){return this.transform(N.MATRIX(e,t,r,a,s,i))}translate(e,t=0){return this.transform(N.TRANSLATE(e,t))}scale(e,t=null){return this.transform(N.SCALE(e,null===t||isNaN(t)?e:t))}rotate(e,t=0,r=0){return this.transform(N.ROTATE(e*(Math.PI/180),t,r))}skewX(e){return this.transform(N.SKEW_X(e*(Math.PI/180)))}skewY(e){return this.transform(N.SKEW_Y(e*(Math.PI/180)))}}class U{constructor(){this._$buffer=null,this._$bitOffset=0,this._$byteOffset=0}setData(e){this._$buffer=e}getData(e){this.byteAlign();const t=this._$byteOffset+e,r=this._$buffer.slice(this._$byteOffset,t);return this._$byteOffset=t,r}getHeaderSignature(){let e="",t=3;for(;t;){const r=this.getUI8();switch(r){case 32:case 96:case 127:continue}e+=String.fromCharCode(r),--t}return e}getVersion(){return this.getUI8()}byteAlign(){this._$bitOffset&&(this._$byteOffset=this._$byteOffset+(this._$bitOffset+7)/8|0,this._$bitOffset=0)}byteCarry(){if(this._$bitOffset>7)this._$byteOffset=this._$byteOffset+(0|(this._$bitOffset+7)/8),this._$bitOffset&=7;else for(;this._$bitOffset<0;)--this._$byteOffset,this._$bitOffset+=8}getUIBits(e){let t=0;for(;e;)t<<=1,t|=this.getUIBit(),--e;return t}getUIBit(){return this.byteCarry(),this._$buffer[this._$byteOffset]>>7-this._$bitOffset++&1}getSIBits(e){const t=this.getUIBits(e),r=t&1<<e-1;return r?-(t^2*r-1)-1:t}getUI8(){return this.byteAlign(),this._$buffer[this._$byteOffset++]}getUI16(){return this.byteAlign(),this.getUI8()|this.getUI8()<<8}getUI32(){return this.byteAlign(),this.getUI8()|(this.getUI8()|(this.getUI8()|this.getUI8()<<8)<<8)<<8}}class D{constructor(){this._$folderId=0,this._$libraryId=0,this._$fileName="",this._$byteStream=new U,this._$bounds={xMin:0,xMax:0,yMin:0,yMax:0},this._$swfVersion=0,this._$info=null,this._$buildData=null,this._$fileSize=0,this._$mode="swf",this._$offset=0,this._$resolve=null}get mode(){return this._$mode}get fileSize(){return this._$fileSize}setData(e){return this._$byteStream.setData(e),this}run(e,t,r=0,a=0){this._$resolve=t,this._$fileName=e.replace(".swf",""),this._$folderId=r,this._$libraryId=a;const s=this._$byteStream.getHeaderSignature();switch(this._$byteStream.getVersion(),d.$saveProgress.parseSWF(),this._$fileSize=this._$byteStream.getUI32(),this._$mode="swf",s){case"FWS":return this.parseAndBuild();case"CWS":{if(d.$unzipWorkerActive)return void d.$unzipQueues.push(this);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const e=d.$unzipWorker;e.onmessage=d.$unzipHandler.bind(this);const t=this._$byteStream._$buffer;e.postMessage({fileSize:this._$fileSize,mode:this._$mode,buffer:t},[t.buffer])}break;case"ZWS":{if(d.$unlzmaWorkerActive)return void d.$unlzmaQueues.push(this);d.$unlzmaWorkerActive=!0;const e=new Worker(d.$unlzmaWorkerURL);e.onmessage=d.$unlzmaHandler.bind(this);const t=this._$byteStream._$buffer;e.postMessage({fileSize:this._$fileSize,mode:this._$mode,buffer:t},[t.buffer])}break;default:throw new Error("this data is not swf.")}}parseAndBuild(){this._$byteStream.byteAlign();const e=this._$byteStream.getUIBits(5);if(this._$bounds.xMin=this._$byteStream.getSIBits(e),this._$bounds.xMax=this._$byteStream.getSIBits(e),this._$bounds.yMin=this._$byteStream.getSIBits(e),this._$bounds.yMax=this._$byteStream.getSIBits(e),this._$byteStream.getUI16(),this._$byteStream.getUI16(),this._$offset=this._$byteStream._$byteOffset,d.$parserWorkerWait)return void d.$parserQueues.push(this);d.$parserWorkerWait=!0,d.$parserWorker||(d.$parserWorker=new Worker(d.$parserURL)),d.$parserWorker.onmessage=d.$parserHandler.bind(this);const t=this._$byteStream._$buffer;d.$parserWorker.postMessage({version:this._$swfVersion,offset:this._$offset,buffer:t},[t.buffer])}build(){const e=this.buildData.info,t=this.buildData.parent;this.loaderInfo._$bytes._$byteArray=this.buildData.buffer,this.loaderInfo._$actionScriptVersion=e._$asv;let r=!1,a=this.loaderInfo._$symbols.length;if(a){const e=this.loaderInfo._$applicationDomain,t=d.$getArray();for(let s=0;s<a;++s){const a=this.loaderInfo._$symbols[s],i=a.tagId;switch(0===i&&(r=!0),!0){case i in this.loaderInfo._$characters:case this.loaderInfo._$fonts.has(i):{const t=d.$getPackage(e,a.path);if(t._$loaderInfoId===this.loaderInfo._$id||!("__$$characterId"in t.prototype)){t.prototype.__$$characterId=i,t.prototype.__$$loaderInfoId=this.loaderInfo._$id;const e=t.__$$slots,r=d.$Object.keys(e),a=r.length;for(let t=0;t<a;++t){const a=e[r[t]];a.__$$classInit&&a.__$$classInit()}d.$poolArray(r)}}}t[i]=a.path}this.loaderInfo._$symbols=t}if(r){const e=d.$buildAVM2(this.loaderInfo._$applicationDomain,this.loaderInfo._$symbols[0]);e._$root=e,e._$symbolBuild(0,this.loaderInfo._$id,t),this.loaderInfo._$content=e}else E._$targetBuild(this.loaderInfo._$content,t),this.loaderInfo._$content._$characterBuild();if(a=e._$sceneInfo.length,a){const t=d.$getArray();for(let r=0;r<a;++r){const a=e._$sceneInfo[r],s=new Scene(a.name,d.$getArray(),1);s._$offset=a.offset;const i=r+1|0;let n=this.loaderInfo._$content._$totalFrames;i in e._$sceneInfo&&(n=0|e._$sceneInfo[i].offset),s._$numFrames=n-s._$offset|0;const o=this.loaderInfo._$content.currentLabels;if(o){const e=o.length,t=d.$getArray();for(let r=0;r<e;++r){const e=o[r];e.frame>a.offset&&e.frame<=n&&(t[t.length]=e)}s._$labels=t}t[t.length]=s}this.loaderInfo._$content._$scenes=t}}}class R{static get CLOSE_PATH(){return 1}static get MOVE_TO(){return 2}static get HORIZ_LINE_TO(){return 4}static get VERT_LINE_TO(){return 8}static get LINE_TO(){return 16}static get CURVE_TO(){return 32}static get SMOOTH_CURVE_TO(){return 64}static get QUAD_TO(){return 128}static get SMOOTH_QUAD_TO(){return 256}static get ARC(){return 512}static get CIRCLE(){return 1024}static get LINE_COMMANDS(){return R.LINE_TO|R.HORIZ_LINE_TO|R.VERT_LINE_TO}static get DRAWING_COMMANDS(){return R.HORIZ_LINE_TO|R.VERT_LINE_TO|R.LINE_TO|R.CURVE_TO|R.SMOOTH_CURVE_TO|R.QUAD_TO|R.SMOOTH_QUAD_TO|R.ARC}}class N{static INFO(e){let t=0,r=0,a=NaN,s=NaN;return function(i){if(isNaN(a)&&!(i.type&R.MOVE_TO))throw new Error("path must start with moveto");const n=e(i,t,r,a,s);return i.type&R.CLOSE_PATH&&(t=a,r=s),void 0!==i.x&&(t=i.relative?t+i.x:i.x),void 0!==i.y&&(r=i.relative?r+i.y:i.y),i.type&R.MOVE_TO&&(a=t,s=r),n}}static MATRIX(e,t,r,a,s,i){return N.INFO(((n,o,l,c)=>{const d=n.x1,h=n.x2,u=n.relative&&!isNaN(c),m=void 0!==n.x?n.x:u?0:o,g=void 0!==n.y?n.y:u?0:l;function $(e){return e*e}n.type&R.HORIZ_LINE_TO&&0!==t&&(n.type=R.LINE_TO,n.y=n.relative?0:l),n.type&R.VERT_LINE_TO&&0!==r&&(n.type=R.LINE_TO,n.x=n.relative?0:o),void 0!==n.x&&(n.x=n.x*e+g*r+(u?0:s)),void 0!==n.y&&(n.y=m*t+n.y*a+(u?0:i)),void 0!==n.x1&&(n.x1=n.x1*e+n.y1*r+(u?0:s)),void 0!==n.y1&&(n.y1=d*t+n.y1*a+(u?0:i)),void 0!==n.x2&&(n.x2=n.x2*e+n.y2*r+(u?0:s)),void 0!==n.y2&&(n.y2=h*t+n.y2*a+(u?0:i));const p=e*a-t*r;if(void 0!==n.xRot&&(1!==e||0!==t||0!==r||1!==a))if(0===p)delete n.rX,delete n.rY,delete n.xRot,delete n.lArcFlag,delete n.sweepFlag,n.type=R.LINE_TO;else{const s=n.xRot*Math.PI/180,i=Math.sin(s),o=Math.cos(s),l=1/$(n.rX),c=1/$(n.rY),d=$(o)*l+$(i)*c,h=2*i*o*(l-c),u=$(i)*l+$(o)*c,m=d*a*a-h*t*a+u*t*t,g=h*(e*a+t*r)-2*(d*r*a+u*e*t),f=d*r*r-h*e*r+u*e*e,y=(Math.atan2(g,m-f)+Math.PI)%Math.PI/2,_=Math.sin(y),b=Math.cos(y);n.rX=Math.abs(p)/Math.sqrt(m*$(b)+g*_*b+f*$(_)),n.rY=Math.abs(p)/Math.sqrt(m*$(_)-g*_*b+f*$(b)),n.xRot=180*y/Math.PI}return void 0!==n.sweepFlag&&0>p&&(n.sweepFlag=+!n.sweepFlag),n}))}static TRANSLATE(e,t=0){return N.MATRIX(1,0,0,1,e,t)}static SCALE(e,t){return N.MATRIX(e,0,0,t,0,0)}static ROTATE(e,t=0,r=0){const a=Math.sin(e),s=Math.cos(e);return N.MATRIX(s,a,-a,s,t-t*s+r*a,r-t*a-r*s)}static SKEW_X(e){return N.MATRIX(1,0,Math.atan(e),1,0,0)}static SKEW_Y(e){return N.MATRIX(1,Math.atan(e),0,1,0,0)}}class X extends O{constructor(){super(),this._$curNumber="",this._$curCommandType=-1,this._$curCommandRelative=!1,this._$canParseCommandOrComma=!0,this._$curNumberHasExp=!1,this._$curNumberHasExpDigits=!1,this._$curNumberHasDecimal=!1,this._$curArgs=[],this._$commands=[],this._$transforms=[]}static get COMMAND_ARG_COUNTS(){return{[R.MOVE_TO]:2,[R.LINE_TO]:2,[R.HORIZ_LINE_TO]:1,[R.VERT_LINE_TO]:1,[R.CLOSE_PATH]:0,[R.QUAD_TO]:4,[R.SMOOTH_QUAD_TO]:2,[R.CURVE_TO]:6,[R.SMOOTH_CURVE_TO]:4,[R.ARC]:7}}execute(e){this._$commands=[];for(let t=0;t<e.length;t++){const r=e[t],a=!(this._$curCommandType!==R.ARC||3!==this._$curArgs.length&&4!==this._$curArgs.length||1!==this._$curNumber.length||"0"!==this._$curNumber&&"1"!==this._$curNumber),s=this.isDigit(r)&&("0"===this._$curNumber&&"0"===r||a);if(!this.isDigit(r)||s)if("e"!==r&&"E"!==r)if("-"!==r&&"+"!==r||!this._$curNumberHasExp||this._$curNumberHasExpDigits)if("."!==r||this._$curNumberHasExp||this._$curNumberHasDecimal||a){if(this._$curNumber&&-1!==this._$curCommandType){const e=Number(this._$curNumber);if(isNaN(e))throw new Error(`Invalid number ending at ${t}`);if(this._$curCommandType===R.ARC){if((0===this._$curArgs.length||1===this._$curArgs.length)&&0>e)throw new Error(`Expected positive number, got "${e}" at index "${t}"`);if((3===this._$curArgs.length||4===this._$curArgs.length)&&"0"!==this._$curNumber&&"1"!==this._$curNumber)throw new Error(`Expected a flag, got "${this._$curNumber}" at index "${t}"`)}this._$curArgs.push(e),this._$curArgs.length===X.COMMAND_ARG_COUNTS[this._$curCommandType]&&this.pushCommand(),this._$curNumber="",this._$curNumberHasExpDigits=!1,this._$curNumberHasExp=!1,this._$curNumberHasDecimal=!1,this._$canParseCommandOrComma=!0}if(!this.isWhiteSpace(r))if(","===r&&this._$canParseCommandOrComma)this._$canParseCommandOrComma=!1;else if("+"!==r&&"-"!==r&&"."!==r)if(s)this._$curNumber=r,this._$curNumberHasDecimal=!1;else{if(0!==this._$curArgs.length)throw new Error(`Unterminated command at index ${t}.`);if(!this._$canParseCommandOrComma)throw new Error(`Unexpected character "${r}" at index ${t}. Command cannot follow comma`);switch(this._$canParseCommandOrComma=!1,r){case"z":case"Z":this._$commands.push({type:R.CLOSE_PATH}),this._$canParseCommandOrComma=!0,this._$curCommandType=-1;break;case"h":case"H":this._$curCommandType=R.HORIZ_LINE_TO,this._$curCommandRelative="h"===r;break;case"v":case"V":this._$curCommandType=R.VERT_LINE_TO,this._$curCommandRelative="v"===r;break;case"m":case"M":this._$curCommandType=R.MOVE_TO,this._$curCommandRelative="m"===r;break;case"l":case"L":this._$curCommandType=R.LINE_TO,this._$curCommandRelative="l"===r;break;case"c":case"C":this._$curCommandType=R.CURVE_TO,this._$curCommandRelative="c"===r;break;case"s":case"S":this._$curCommandType=R.SMOOTH_CURVE_TO,this._$curCommandRelative="s"===r;break;case"q":case"Q":this._$curCommandType=R.QUAD_TO,this._$curCommandRelative="q"===r;break;case"t":case"T":this._$curCommandType=R.SMOOTH_QUAD_TO,this._$curCommandRelative="t"===r;break;case"a":case"A":this._$curCommandType=R.ARC,this._$curCommandRelative="a"===r;break;default:throw new Error(`Unexpected character "${r}" at index ${t}.`)}}else this._$curNumber=r,this._$curNumberHasDecimal="."===r}else this._$curNumber+=r,this._$curNumberHasDecimal=!0;else this._$curNumber+=r;else this._$curNumber+=r,this._$curNumberHasExp=!0;else this._$curNumber+=r,this._$curNumberHasExpDigits=this._$curNumberHasExp}if(-1!==this._$curCommandType){const e=Number(this._$curNumber);isNaN(e)||(this._$curArgs.push(e),this._$curArgs.length===X.COMMAND_ARG_COUNTS[this._$curCommandType]&&this.pushCommand())}return this.executeTransform(),this._$commands}executeTransform(){for(let e=0;e<this._$transforms.length;++e){const t=this._$transforms[e],r=[];for(let e=0;e<this._$commands.length;++e){const a=t(this._$commands[e]);Array.isArray(a)?r.push(...a):r.push(a)}this._$commands=r}}pushCommand(){switch(this._$curCommandType){case R.HORIZ_LINE_TO:this._$commands.push({type:R.HORIZ_LINE_TO,relative:this._$curCommandRelative,x:this._$curArgs[0]});break;case R.VERT_LINE_TO:this._$commands.push({type:R.VERT_LINE_TO,relative:this._$curCommandRelative,y:this._$curArgs[0]});break;case R.MOVE_TO:case R.LINE_TO:case R.SMOOTH_QUAD_TO:this._$commands.push({type:this._$curCommandType,relative:this._$curCommandRelative,x:this._$curArgs[0],y:this._$curArgs[1]}),R.MOVE_TO===this._$curCommandType&&(this._$curCommandType=R.LINE_TO);break;case R.CURVE_TO:this._$commands.push({type:R.CURVE_TO,relative:this._$curCommandRelative,x1:this._$curArgs[0],y1:this._$curArgs[1],x2:this._$curArgs[2],y2:this._$curArgs[3],x:this._$curArgs[4],y:this._$curArgs[5]});break;case R.SMOOTH_CURVE_TO:this._$commands.push({type:R.SMOOTH_CURVE_TO,relative:this._$curCommandRelative,x2:this._$curArgs[0],y2:this._$curArgs[1],x:this._$curArgs[2],y:this._$curArgs[3]});break;case R.QUAD_TO:this._$commands.push({type:R.QUAD_TO,relative:this._$curCommandRelative,x1:this._$curArgs[0],y1:this._$curArgs[1],x:this._$curArgs[2],y:this._$curArgs[3]});break;case R.ARC:this._$commands.push({type:R.ARC,relative:this._$curCommandRelative,rX:this._$curArgs[0],rY:this._$curArgs[1],xRot:this._$curArgs[2],lArcFlag:this._$curArgs[3],sweepFlag:this._$curArgs[4],x:this._$curArgs[5],y:this._$curArgs[6]})}this._$curArgs.length=0,this._$canParseCommandOrComma=!0}isDigit(e){return"0".charCodeAt(0)<=e.charCodeAt(0)&&e.charCodeAt(0)<="9".charCodeAt(0)}isWhiteSpace(e){return" "===e||"\t"===e||"\r"===e||"\n"===e}transform(e){return this._$transforms.push(e),this}}class Y{static parse(e,t){const r=(new DOMParser).parseFromString(e,"image/svg+xml").children[0];if("svg"!==r.tagName)return;const a=new Map,s=r.attributes,i=s.length;for(let e=0;e<i;++e){const t=s[e];"style"!==t.name&&a.set(t.name,t.value)}if(r.hasAttribute("style")){const e=r.style,t=e.length;for(let r=0;r<t;++r){const t=e[r];a.set(t,e[t])}}Y.parseElement(r,t,a,new Map);const n=[];for(const e of t._$layers.values())n.unshift(e);t.clearLayer();for(let e=0;e<n.length;++e)t.setLayer(e,n[e])}static parseElement(e,t,r,a){const s=e.children,i=s.length;for(let e=0;i>e;++e){const i=s[e];let n=null;switch(i.tagName.toLowerCase()){case"path":Y.createGraphics(i,t,r,a);break;case"g":{n=new Map;const e=i.attributes,t=e.length;for(let r=0;r<t;++r){const t=e[r];"style"!==t.name&&n.set(t.name,t.value)}for(const[e,t]of r)n.has(e)||n.set(e,t);const a=i.style;for(let e=0;e<a.length;++e){const t=a[e];n.set(t,i.style[t])}}break;case"rect":{const e=i.hasAttribute("x")?parseFloat(i.getAttribute("x")):0,s=i.hasAttribute("y")?parseFloat(i.getAttribute("y")):0,n=i.hasAttribute("width")?parseFloat(i.getAttribute("width")):0,o=i.hasAttribute("height")?parseFloat(i.getAttribute("height")):0;if(!n||!o)continue;const l=[];if(i.hasAttribute("rx")||i.hasAttribute("ry")){const t=parseFloat(i.getAttribute("rx"))/2,r=parseFloat(i.getAttribute("ry"))/2,a=4/3*(Math.SQRT2-1),c=a*t,d=a*r,h=e+t,u=e+n,m=u-t,g=s+r,$=s+o,p=$-r;l.push({type:R.MOVE_TO,relative:!1,x:h,y:s},{type:R.LINE_TO,relative:!1,x:m,y:s},{type:R.CURVE_TO,relative:!1,x1:m+c,y1:s,x2:u,y2:g-d,x:u,y:g},{type:R.LINE_TO,relative:!1,x:u,y:p},{type:R.CURVE_TO,relative:!1,x1:u,y1:p+d,x2:m+c,y2:$,x:m,y:$},{type:R.LINE_TO,relative:!1,x:h,y:$},{type:R.CURVE_TO,relative:!1,x1:h-c,y1:$,x2:e,y2:p+d,x:e,y:p},{type:R.LINE_TO,relative:!1,x:e,y:g},{type:R.CURVE_TO,relative:!1,x1:e,y1:g-d,x2:h-c,y2:s,x:h,y:s})}else l.push({type:R.MOVE_TO,relative:!1,x:e,y:s},{type:R.LINE_TO,relative:!1,x:e+n,y:s},{type:R.LINE_TO,relative:!1,x:e+n,y:s+o},{type:R.LINE_TO,relative:!1,x:e,y:s+o},{type:R.LINE_TO,relative:!1,x:e,y:s});const c=document.createElement("path"),d=i.attributes,h=d.length;for(let e=0;e<h;++e){const t=d[e];switch(t.name){case"x":case"y":case"width":case"height":continue}c.setAttribute(t.name,t.value)}Y.createGraphics(c,t,r,a,l)}break;case"circle":{const e=i.hasAttribute("cx")?parseFloat(i.getAttribute("cx")):0,s=i.hasAttribute("cy")?parseFloat(i.getAttribute("cy")):0,n=i.hasAttribute("r")?parseFloat(i.getAttribute("r")):0;if(!n)continue;const o=[{type:R.MOVE_TO,relative:!1,x:e-n,y:s},{type:R.ARC,relative:!1,x:e+n,y:s,rX:n,rY:n,lArcFlag:0,sweepFlag:0,xRot:180},{type:R.ARC,relative:!1,x:e-n,y:s,rX:n,rY:n,lArcFlag:0,sweepFlag:0,xRot:180},{type:R.CIRCLE,x:e,y:s}],l=document.createElement("path"),c=i.attributes,d=c.length;for(let e=0;e<d;++e){const t=c[e];switch(t.name){case"cx":case"cy":case"r":continue}l.setAttribute(t.name,t.value)}Y.createGraphics(l,t,r,a,o)}break;case"ellipse":{const e=i.hasAttribute("cx")?parseFloat(i.getAttribute("cx")):0,s=i.hasAttribute("cy")?parseFloat(i.getAttribute("cy")):0,n=i.hasAttribute("rx")?parseFloat(i.getAttribute("rx")):0,o=i.hasAttribute("ry")?parseFloat(i.getAttribute("ry")):0,l=[{type:R.MOVE_TO,relative:!1,x:e-n,y:s},{type:R.ARC,relative:!1,x:e+n,y:s,rX:n,rY:o,lArcFlag:0,sweepFlag:0,xRot:180},{type:R.ARC,relative:!1,x:e-n,y:s,rX:n,rY:o,lArcFlag:0,sweepFlag:0,xRot:180},{type:R.CIRCLE,x:e,y:s}],c=document.createElement("path"),d=i.attributes,h=d.length;for(let e=0;e<h;++e){const t=d[e];switch(t.name){case"cx":case"cy":case"rx":case"ry":continue}c.setAttribute(t.name,t.value)}Y.createGraphics(c,t,r,a,l)}break;case"polygon":case"polyline":{if(!i.hasAttribute("points"))continue;const e=i.getAttribute("points"),s=Y._$adjParam(e.replace(/,/g," ").replace(/-/g," -").trim().split(" ")),n=[{type:R.MOVE_TO,relative:!1,x:+s[0],y:+s[1]}];for(let e=2;e<s.length;e+=2)n.push({type:R.LINE_TO,relative:!1,x:+s[e],y:+s[e+1]});"polygon"===i.tagName&&n.push({type:R.CLOSE_PATH});const o=document.createElement("path"),l=i.attributes,c=l.length;for(let e=0;e<c;++e){const t=l[e];"points"!==t.name&&o.setAttribute(t.name,t.value)}Y.createGraphics(o,t,r,a,n)}break;case"line":{const e=i.hasAttribute("x1")?parseFloat(i.getAttribute("x1")):0,s=i.hasAttribute("y1")?parseFloat(i.getAttribute("y1")):0,n=i.hasAttribute("x2")?parseFloat(i.getAttribute("x2")):0,o=i.hasAttribute("y2")?parseFloat(i.getAttribute("y2")):0;if(e===n&&s===o)continue;const l=[{type:R.MOVE_TO,relative:!1,x:e,y:s},{type:R.LINE_TO,relative:!1,x:n,y:o}],c=document.createElement("path"),d=i.attributes,h=d.length;for(let e=0;e<h;++e){const t=d[e];switch(t.name){case"x1":case"y1":case"x2":case"y2":continue}c.setAttribute(t.name,t.value)}Y.createGraphics(c,t,r,a,l)}break;case"style":{const e=i.sheet.cssRules,t=e.length;for(let r=0;r<t;++r){const t=e[r];a.set(t.selectorText,t)}}break;case"use":{let e=null;switch(!0){case i.hasAttribute("href"):e=i.getAttribute("href").slice(1);break;case i.hasAttribute("xlink:href"):e=i.getAttribute("xlink:href").slice(1)}if(!e)continue;const s=i.viewportElement.getElementById(e),n=document.createElement("path"),o=i.attributes,l=o.length;for(let e=0;e<l;++e){const t=o[e];switch(t.name){case"href":case"xlink:href":continue}n.setAttribute(t.name,t.value)}const c=s.attributes,d=c.length;for(let e=0;e<d;++e){const t=c[e];n.setAttribute(t.name,t.value)}const h=document.createElement("element");h.appendChild(n),Y.parseElement(h,t,r,a)}}Y.parseElement(i,t,n||r,a)}}static createShape(e,t,r,a){const s=d.$currentWorkSpace(),i=s.nextLibraryId,n=s.addLibrary(d.$libraryController.createInstance(b.SHAPE,`Shape_${i}`,i)),o=new v;o.name=`Layer_${e._$layers.size}`,e.setLayer(e._$layers.size,o);const l=new p;l.libraryId=n.id;const c=o.adjustmentLocation(1);l.startFrame=c.startFrame,l.endFrame=c.endFrame;let h=0,u=0;if(t.hasAttribute("transform")){const e=t.getAttribute("transform");if(e.indexOf("translate")>-1){const t=/translate\((.+?)\)/gi.exec(e)[1],r=Y._$adjParam(t.replace(/,/g," ").replace(/-/g," -").trim().split(" ")),a=[];for(let e=0;e<r.length;++e){const t=r[e];t&&a.push(+t)}h+=parseFloat(a[0]),u+=parseFloat(a[1])}}if(r.has("transform")){const e=r.get("transform");if(e.indexOf("translate")>-1){const t=/translate\((.+?)\)/gi.exec(e)[1],r=Y._$adjParam(t.replace(/,/g," ").replace(/-/g," -").trim().split(" ")),a=[];for(let e=0;e<r.length;++e){const t=r[e];t&&a.push(+t)}h+=parseFloat(a[0]),u+=parseFloat(a[1])}}if(a.has("transform")){const e=a.get("transform");if(e.indexOf("translate")>-1){const t=/translate\((.+?)\)/gi.exec(e)[1],r=Y._$adjParam(t.replace(/,/g," ").replace(/-/g," -").trim().split(" ")),a=[];for(let e=0;e<r.length;++e){const t=r[e];t&&a.push(+t)}h+=parseFloat(a[0]),u+=parseFloat(a[1])}}return l.setPlace(c.startFrame,{frame:c.startFrame,matrix:[1,0,0,1,isNaN(h)?0:h,isNaN(u)?0:u],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:o._$characters.length}),o.addCharacter(l),n}static getFillObject(e,t,r){let a=null;switch(!0){case e.hasAttribute("fill"):a=e.getAttribute("fill");break;case""!==e.style.fill:a=e.style.fill;break;case t.has("fill"):a=t.get("fill");break;default:{const t=e.classList,s=t.length;for(let e=0;e<s;++e){const s=t[e];let i=null;switch(!0){case r.has(`#${s}`):i=r.get(`#${s}`);break;case r.has(`.${s}`):i=r.get(`.${s}`);break;default:continue}i&&(""!==i.style.fill&&(a=i.style.fill))}}}let s=null;switch(!0){case e.hasAttribute("fill-opacity"):s=e.getAttribute("fill-opacity");break;case e.hasAttribute("opacity"):s=e.getAttribute("opacity");break;case""!==e.style.fillOpacity:s=e.style.fillOpacity;break;case""!==e.style.opacity:s=e.style.opacity;break;case t.has("fill-opacity"):s=t.get("fill-opacity");break;case t.has("opacity"):s=t.get("opacity");break;default:{const t=e.classList,a=t.length;for(let e=0;e<a;++e){const a=t[e];let i=null;switch(!0){case r.has(`#${a}`):i=r.get(`#${a}`);break;case r.has(`.${a}`):i=r.get(`.${a}`);break;default:continue}if(i){""!==i.style.fillOpacity&&(s=i.style.fillOpacity),""!==i.style.opacity&&(s=i.style.opacity);break}}}}let i=null===s?1:+s,n=0;if(a)switch(!0){case a.indexOf("rgba")>-1:{const e=/rgba\((.+?)\)/gi.exec(a)[1].trim().split(",");n="0x",n+=parseInt(e[0].trim()).toString(16),n+=parseInt(e[1].trim()).toString(16),n+=parseInt(e[2].trim()).toString(16),n|=0,i=+e[3].trim()}break;case a.indexOf("rgb")>-1:{const e=/rgb\((.+?)\)/gi.exec(a)[1].trim().split(",");n="0x",n+=parseInt(e[0].trim()).toString(16),n+=parseInt(e[1].trim()).toString(16),n+=parseInt(e[2].trim()).toString(16),n|=0}break;case"transparent"===a:case"none"===a:i=0;break;default:n=a}return{color:n,alpha:i}}static getStrokeObject(e,t,r){let a="none";switch(!0){case e.hasAttribute("stroke-linecap"):a=e.getAttribute("stroke-linecap");break;case""!==e.style.strokeLinecap:a=e.style.strokeLinecap;break;case t.has("stroke-linecap"):a=t.get("stroke-linecap");break;default:{const t=e.classList,s=t.length;for(let e=0;e<s;++e){const s=t[e];let i=null;switch(!0){case r.has(`#${s}`):i=r.get(`#${s}`);break;case r.has(`.${s}`):i=r.get(`.${s}`);break;default:continue}i&&(""!==i.style.strokeLinecap&&(a=i.style.strokeLinecap))}}}let s="miter";switch(!0){case e.hasAttribute("stroke-linejoin"):s=e.getAttribute("stroke-linejoin");break;case""!==e.style.strokeLinejoin:s=e.style.strokeLinejoin;break;case t.has("stroke-linejoin"):s=t.get("stroke-linejoin");break;default:{const t=e.classList,a=t.length;for(let e=0;e<a;++e){const a=t[e];let i=null;switch(!0){case r.has(`#${a}`):i=r.get(`#${a}`);break;case r.has(`.${a}`):i=r.get(`.${a}`);break;default:continue}i&&(""!==i.style.strokeLinejoin&&(s=i.style.strokeLinejoin))}}}let i=null;switch(!0){case e.hasAttribute("stroke"):i=e.getAttribute("stroke");break;case""!==e.style.stroke:i=e.style.stroke;break;case t.has("stroke"):i=t.get("stroke");break;default:{const t=e.classList,a=t.length;for(let e=0;e<a;++e){const a=t[e];let s=null;switch(!0){case r.has(`#${a}`):s=r.get(`#${a}`);break;case r.has(`.${a}`):s=r.get(`.${a}`);break;default:continue}s&&(""!==s.style.stroke&&(i=s.style.stroke))}}}let n=i?1:0;switch(!0){case e.hasAttribute("stroke-width"):n=parseFloat(e.getAttribute("stroke-width"));break;case""!==e.style.strokeWidth:n=parseFloat(e.style.strokeWidth);break;case t.has("stroke-width"):n=parseFloat(t.get("stroke-width"));break;default:{const t=e.classList,a=t.length;for(let e=0;e<a;++e){const a=t[e];let s=null;switch(!0){case r.has(`#${a}`):s=r.get(`#${a}`);break;case r.has(`.${a}`):s=r.get(`.${a}`);break;default:continue}s&&(""!==s.style.strokeWidth&&(n=parseFloat(s.style.strokeWidth)))}}}let o=null;switch(!0){case e.hasAttribute("stroke-opacity"):o=e.getAttribute("stroke-opacity");break;case e.hasAttribute("opacity"):o=e.getAttribute("opacity");break;case""!==e.style.strokeOpacity:o=e.style.strokeOpacity;break;case""!==e.style.opacity:o=e.style.opacity;break;case t.has("stroke-opacity"):o=t.get("stroke-opacity");break;case t.has("opacity"):o=t.get("opacity");break;default:{const t=e.classList,a=t.length;for(let e=0;e<a;++e){const a=t[e];let s=null;switch(!0){case r.has(`#${a}`):s=r.get(`#${a}`);break;case r.has(`.${a}`):s=r.get(`.${a}`);break;default:continue}s&&(""!==s.style.strokeOpacity&&(o=s.style.strokeOpacity),""!==s.style.opacity&&(o=s.style.opacity))}}}let l=null===o?1:o,c=0;if(i)switch(!0){case i.indexOf("rgba")>-1:{const e=/rgba\((.+?)\)/gi.exec(i)[1].trim().split(",");c="0x",c+=+e[0].trim(),c+=+e[1].trim(),c+=+e[2].trim(),c|=0,l=+e[3].trim()}break;case i.indexOf("rgb")>-1:{const e=/rgb\((.+?)\)/gi.exec(i)[1].trim().split(",");c="0x",c+=+e[0].trim(),c+=+e[1].trim(),c+=+e[2].trim(),c|=0}break;case"transparent"===i:case"none"===i:l=0;break;default:c=i}return{color:c,alpha:l,width:n,caps:"butt"===a?"none":a,join:s}}static createParser(e,t){let r=new X;for(let a=0;2>a;++a){let s=null;switch(a){case 0:t.size&&t.has("transform")&&(s=t.get("transform"));break;case 1:e.hasAttribute("transform")&&(s=e.getAttribute("transform"))}if(s){const e=["matrix","scale","rotate","skewX","skewY"],t=[];for(let r=0;e.length>r;++r){const a=e[r],i=s.indexOf(a);-1!==i&&t.push({index:i,name:a})}t.sort(((e,t)=>e.index>t.index?1:t.index>e.index?-1:0));for(let e=0;t.length>e;++e){const a=t[e].name,i=Y._$adjParam(new RegExp(`${a}\\((.+?)\\)`,"gi").exec(s)[1].replace(/,/g," ").replace(/-/g," -").trim().split(" ")),n=[];for(let e=0;e<i.length;++e){const t=i[e];t&&n.push(+t)}r=r[a](n[0],n[1],n[2],n[3],n[4],n[5])}}}return r}static createGraphics(e,t,r,a,s=null){if(!s&&!e.hasAttribute("d"))return;const{Shape:i,Graphics:n}=window.next2d.display,o=Y.createShape(t,e,r,a),l=(new i).graphics,c=Y.getFillObject(e,r,a);c.alpha&&l.beginFill(c.color,c.alpha);const d=Y.getStrokeObject(e,r,a);d.width&&d.alpha&&l.lineStyle(d.width,d.color,d.alpha,d.caps,d.join);const h=Y.createParser(e,r);let u=0,m=0,g=0,$=0;s?(h._$commands=s,h.executeTransform()):s=h.execute(e.getAttribute("d"));for(let e=0;s.length>e;++e){const t=s[e];switch(t.type){case R.MOVE_TO:t.relative?(u+=t.x,m+=t.y):(u=t.x,m=t.y),l._$lines&&l._$lines.length>1&&(l.endLine(),l._$pointerX=0,l._$pointerY=0,l.lineStyle(d.width,d.color,d.alpha,d.caps,d.join)),l._$fills&&(l.endFill(),l.beginFill(c.color,c.alpha)),l.moveTo(u,m);break;case R.LINE_TO:t.relative?(u+=t.x,m+=t.y):(u=t.x,m=t.y),g=u,$=m,l.lineTo(u,m);break;case R.CIRCLE:g=u=t.x,$=m=t.y;break;case R.ARC:{let e=t.x,r=t.y;t.relative&&(e+=u,r+=m);const a=Y._$arcToCurve(u,m,e,r,t.lArcFlag,t.sweepFlag,t.rX,t.rY,t.xRot);for(let e=0;e<a.length;++e){const t=a[e];l.cubicCurveTo(t[0],t[1],t[2],t[3],t[4],t[5])}g=u=e,$=m=r}break;case R.CURVE_TO:{let e=t.x1,r=t.y1,a=t.x2,s=t.y2,i=t.x,n=t.y;t.relative&&(e+=u,r+=m,a+=u,s+=m,i+=u,n+=m),l.cubicCurveTo(e,r,a,s,i,n),u=i,m=n,g=2*i-a,$=2*n-s}break;case R.SMOOTH_CURVE_TO:{let e=t.x2,r=t.y2,a=t.x,s=t.y;t.relative&&(e+=u,r+=m,a+=u,s+=m),l.cubicCurveTo(g,$,e,r,a,s),u=a,m=s,g=2*a-e,$=2*s-r}break;case R.SMOOTH_QUAD_TO:{const e=Math.atan2(m-$,u-g),r=Math.sqrt(Math.pow(u-g,2)+Math.pow(m-$,2));g=u+r*Math.cos(e),$=m+r*Math.sin(e),t.relative?(u+=t.x,m+=t.y):(u=t.x,m=t.y),l.curveTo(g,$,u,m)}break;case R.QUAD_TO:{let e=t.x1,r=t.y1,a=t.x,s=t.y;t.relative&&(e+=u,r+=m,a+=u,s+=m),l.curveTo(e,r,a,s),u=a,m=s,g=e,$=r}break;case R.HORIZ_LINE_TO:{let e=t.x;t.relative&&(e+=u),g=u=e,l.lineTo(u,m)}break;case R.VERT_LINE_TO:{let e=t.y;t.relative&&(e+=m),$=m=e,l.lineTo(u,m)}break;case R.CLOSE_PATH:if(l._$fills){const e=l._$fills[2],t=l._$fills[3];e===l._$pointerX&&t===l._$pointerY||l._$fills.push(n.LINE_TO,e,t),l.endFill(),l.beginFill(c.color,c.alpha)}if(l._$lines){const e=l._$lines[2],t=l._$lines[3];e===l._$pointerX&&t===l._$pointerY||l._$lines.push(n.LINE_TO,e,t),l.endLine(),l.lineStyle(d.width,d.color,d.alpha,d.caps,d.join)}}}l.endLine(),l.endFill(),l._$recode&&(o._$recodes=l._$recode.slice()),o._$bounds={xMin:l._$xMin,xMax:l._$xMax,yMin:l._$yMin,yMax:l._$yMax}}static _$adjParam(e){for(;;){let t=0;for(let r=0;r<e.length;++r){const a=e[r];if(!isNaN(a)){t++;continue}const s=a.split(".");e.splice(r+1,0,`0.${s.pop()}`),e[r]=s.join(".")}if(e.length===t)break}return e}static _$arc(e,t,r,a,s,i){let n=Math.min(Math.ceil(2*a+1),1024);if(n<1)return;s=void 0===s?0:s;const o=((i=void 0===i?2*Math.PI:i)-s)/n;for(let i=0;i<=n;i++){const n=s+i*o;e.lineTo(t+Math.cos(n)*a,r+Math.sin(n)*a)}}static _$arcToCurve(e,t,r,a,s,i,n,o,l){const c=2*Math.PI,d=Math.sin(l*c/360),h=Math.cos(l*c/360),u=h*(e-r)/2+d*(t-a)/2,m=-d*(e-r)/2+h*(t-a)/2;if(0===u&&0===m||0===n||0===o)return[];n=Math.abs(n),o=Math.abs(o);const g=u*u/(n*n)+m*m/(o*o);g>1&&(n*=Math.sqrt(g),o*=Math.sqrt(g));const $=Y._$getArcCenter(e,t,r,a,s,i,n,o,d,h),p=[];let f=$[2],y=$[3];const _=Math.max(Math.ceil(Math.abs(y)/(c/4)),1);y/=_;for(let e=0;e<_;e++)p.push(Y._$approximateUnitArc(f,y)),f+=y;return p.map((e=>{for(let t=0;t<e.length;t+=2){let r=e[t],a=e[t+1];r*=n,a*=o;const s=h*r-d*a,i=d*r+h*a;e[t]=s+$[0],e[t+1]=i+$[1]}return e.shift(),e.shift(),e}))}static _$approximateUnitArc(e,t){const r=4/3*Math.tan(t/4),a=Math.cos(e),s=Math.sin(e),i=Math.cos(e+t),n=Math.sin(e+t);return[a,s,a-s*r,s+a*r,i+n*r,n-i*r,i,n]}static _$getArcCenter(e,t,r,a,s,i,n,o,l,c){const d=2*Math.PI,h=c*(e-r)/2+l*(t-a)/2,u=-l*(e-r)/2+c*(t-a)/2,m=n*n,g=o*o,$=h*h,p=u*u;let f=m*g-m*p-g*$;f<0&&(f=0),f/=m*p+g*$,f=Math.sqrt(f)*(s===i?-1:1);const y=f*n/o*u,_=f*-o/n*h,b=c*y-l*_+(e+r)/2,v=l*y+c*_+(t+a)/2,I=(h-y)/n,E=(u-_)/o,S=(-h-y)/n,w=(-u-_)/o,x=Y._$unitVectorAngle(1,0,I,E);let L=Y._$unitVectorAngle(I,E,S,w);return 0===i&&L>0&&(L-=d),1===i&&L<0&&(L+=d),[b,v,x,L]}static _$unitVectorAngle(e,t,r,a){let s=e*r+t*a;return s>1&&(s=1),s<-1&&(s=-1),(e*a-t*r<0?-1:1)*Math.acos(s)}}d.$vtc=new class{clone(e){const t=function(e,r){const a=Object.keys(e),s=0|a.length;for(let i=0;i<s;++i){const s=a[i],n=e[s];switch(!0){case d.$isArray(n):r[s]=[],t(n,r[s]);break;case"object"==typeof n:r[s]={},t(n,r[s]);break;default:r[s]=n}}},r={};return t(e,r),r}convert(e,t=!1){let r=e.lineStyles,a=e.fillStyles,s=0,i={},n=[],o=0,l=0,c=0,d=0,h=0,u=0,m=0,g=0,$=0,p=[],f=[],y=[],_=[],b=0;const v=e.ShapeData,I=v.records,E=v.styles;let S=0,w=0;for(;;){const e=I[S++];if(-1===e){_=this.setStack(_,this.fillMerge(p,f,t)),_=this.setStack(_,y);break}if(e){if(++b,I[S++]){_=this.setStack(_,this.fillMerge(p,f,t)),_=this.setStack(_,y),o=0,l=0,p=[],f=[],y=[];const e=E[w++];I[S++]&&(a=e.FillStyles),I[S++]&&(r=e.LineStyles)}c=o,d=l,I[S++]&&(c=o=I[S++]/20,d=o=I[S++]/20),h=c,u=d,I[S++]&&(m=I[S++]),I[S++]&&(g=I[S++]),I[S++]&&($=I[S++]);continue}const v=I[S++],x=v?I[S++]/20:0,L=v?I[S++]/20:0;o=I[S++]/20,l=I[S++]/20;const M={isCurved:v,ControlX:x,ControlY:L,AnchorX:o,AnchorY:l};if(m&&(s=m-1|0,s in p||(p[s]=[]),b in p[s]||(p[s][b]={obj:a?a[s]:null,startX:c,startY:d,endX:0,endY:0,cache:[]}),i=p[s][b],n=i.cache,n[n.length]=this.clone(M),i.endX=o,i.endY=l),g&&(s=g-1|0,s in f||(f[s]=[]),b in f[s]||(f[s][b]={obj:a?a[s]:null,startX:c,startY:d,endX:0,endY:0,cache:[]}),i=f[s][b],n=i.cache,n[n.length]=this.clone(M),i.endX=o,i.endY=l),$){s=$-1|0,s in y||(y[s]={obj:r?r[s]:null,cache:[]}),i=y[s],n=i.cache,n[n.length]=[0,h,u];let e=[2,o,l];v&&(e=[1,x,L,o,l]),n[n.length]=e}h=o,u=l}return this.toGraphicPath(_)}toGraphicPath(e){const{Graphics:t,GradientType:r,InterpolationMethod:a,SpreadMethod:s,CapsStyle:i,JointStyle:n}=window.next2d.display;let o=!1;const l=[];for(let c=0;c<e.length;++c){const h=e[c];l.push(t.BEGIN_PATH);for(let e=0;e<h.recode.length;++e)l.push.apply(l,h.recode[e]);const u="Width"in h.object;let m=0,g=i.NONE,$=0,p=n.ROUND;if(u){switch(m=h.object.Width,h.object.StartCapStyle){case 0:g=i.ROUND;break;case 1:g=i.NONE;break;case 2:g=i.SQUARE}switch(h.object.JoinStyle){case 0:p=n.ROUND;break;case 1:p=n.BEVEL;break;case 2:p=n.MITER,$=h.object.MiterLimitFactor}}const f=h.object.HasFillFlag?h.object.FillType:h.object;switch(f.fillStyleType){case 0:u?l.push(t.STROKE_STYLE,m,g,p,$,f.Color.R,f.Color.G,f.Color.B,255*f.Color.A,t.END_STROKE):l.push(t.FILL_STYLE,f.Color.R,f.Color.G,f.Color.B,255*f.Color.A,t.END_FILL);break;case 16:case 18:case 19:{const e=f.gradient,i=[],n=e.GradientRecords;for(let e=0;e<n.length;++e){const t=n[e];i.push({ratio:t.Ratio,R:t.Color.R,G:t.Color.G,B:t.Color.B,A:255*t.Color.A})}const o=0===e.InterpolationMode?a.RGB:a.LINEAR_RGB;let c=s.PAD;switch(e.SpreadMode){case 0:c=s.PAD;break;case 1:c=s.REFLECT;break;case 2:c=s.REPEAT}u?l.push(t.GRADIENT_STROKE,m,g,p,$,16===f.fillStyleType?r.LINEAR:r.RADIAL,i,f.gradientMatrix,c,o,e.FocalPoint):l.push(t.GRADIENT_FILL,16===f.fillStyleType?r.LINEAR:r.RADIAL,i,f.gradientMatrix,c,o,e.FocalPoint)}break;case 64:case 65:case 66:case 67:{o=!0;const e=d.$currentWorkSpace().getLibrary(d.$characters.get(f.bitmapId)),r=function(e,a){if(!this._$buffer)return requestAnimationFrame(r);const s=64===a.fillStyleType||65===a.fillStyleType,i=64===a.fillStyleType||66===a.fillStyleType,n=d.$multiplicationMatrix(a.bitmapMatrix,[.05,0,0,.05,0,0]),{BitmapData:o}=window.next2d.display,l=new o(this.width,this.height,!0,0);l._$buffer=this._$buffer,e.push(t.BITMAP_FILL,l,Array.from(n),i?"repeat":"no-repeat",s)}.bind(e,l,f);r()}}}return l.push(o),l}fillMerge(e,t,r){if((e=this.fillReverse(e)).length){const r=Object.keys(e),a=0|r.length;for(let s=0;s<a;++s){const a=r[s],i=e[a];if(a in t){const e=t[a],r=Object.keys(i),s=0|r.length;for(let t=0;t<s;++t)e[e.length]=i[r[t]]}else t[a]=i}}return this.coordinateAdjustment(t,r)}fillReverse(e){if(!e.length)return e;const t=Object.keys(e),r=0|t.length;for(let a=0;a<r;++a){const r=e[t[a]],s=Object.keys(r),i=0|s.length;for(let e=0;e<i;++e){let t=0,a=0;const i=r[s[e]];let n=i.startX,o=i.startY;const l=i.cache;let c=0|l.length;if(c){const e=Object.keys(l),r=0|e.length;for(let s=0;s<r;++s){const r=l[e[s]];t=r.AnchorX,a=r.AnchorY,r.AnchorX=n,r.AnchorY=o,n=t,o=a}const s=[];if(c>0)for(;c;)--c,s[s.length]=l[c];i.cache=s}n=i.startX,o=i.startY,i.startX=i.endX,i.startY=i.endY,i.endX=n,i.endY=o}}return e}coordinateAdjustment(e,t){const r=Object.keys(e),a=0|r.length;for(let s=0;s<a;++s){const a=r[s],i=[],n=e[a],o=Object.keys(n),l=0|o.length;for(let e=0;e<l;++e)i[i.length]=n[o[e]];let c=[];if(!0==(i.length>1&&!t))for(;i.length;){const e=i.shift();if(e.startX===e.endX&&e.startY===e.endY){c[c.length]=e;continue}let t=0,r=0|i.length;for(;r;){--r;const a=i[r];if(a.startX===e.endX&&a.startY===e.endY){e.endX=a.endX,e.endY=a.endY;const s=e.cache,n=a.cache,o=0|n.length;for(let e=0;e<o;++e)s[s.length]=n[e];i.splice(r,1),i.unshift(e),t=1;break}}t||i.unshift(e)}else c=i;const d=0|c.length,h=[];let u={};for(let e=0;e<d;++e){const t=c[e];u=t.obj;const r=t.cache,a=0|r.length;h[h.length]=[0,t.startX,t.startY];for(let e=0;e<a;++e){const t=r[e];h[h.length]=t.isCurved?[1,t.ControlX,t.ControlY,t.AnchorX,t.AnchorY]:[2,t.AnchorX,t.AnchorY]}}e[a]={cache:h,obj:u}}return e}setStack(e,t){if(t.length){const r=Object.keys(t),a=0|r.length;for(let s=0;s<a;++s){const a=t[r[s]];e.push({object:a.obj,recode:a.cache})}}return e}};class z{constructor(e=""){if(this._$name="",this._$scene=null,this._$stage=null,this._$libraries=new Map,this._$nameMap=new Map,this._$plugins=new Map,this._$position=0,this._$ruler=!1,this._$rulerX=[],this._$rulerY=[],this._$characterId=0,this._$revision=[],this._$currentData=null,this._$currentFrame=0,this._$timelineHeight=$e.TIMELINE_DEFAULT_SIZE,this._$controllerWidth=Se.DEFAULT_SIZE,e&&this.load(e),!this._$libraries.has(0)){const e=new E({id:0,type:b.MOVIE_CLIP,name:"main",symbol:""});this._$libraries.set(0,e)}this._$stage||(this._$stage=new x)}get root(){return this._$libraries.get(0)}get stage(){return this._$stage}get name(){return this._$name}set name(e){this._$name=`${e}`}get scene(){return this._$scene}set scene(e){this._$scene&&this._$scene.stop(),this._$scene=e,e.initialize()}get nextLibraryId(){const e=Array.from(this._$libraries.keys());e.sort((function(e,t){return e>t?1:e<t?-1:0}));return(0|this._$libraries.get(0|e.pop()).id)+1}initialize(e){this.scene=e,d.$libraryController.clearActive(),d.$libraryController.reload(Array.from(this._$libraries.values())),d.$javascriptController.reload(),d.$pluginController.reload(Array.from(this._$plugins.values())),d.$sceneChange.reload()}run(){document.documentElement.style.setProperty("--timeline-height",`${this._$timelineHeight}px`),document.documentElement.style.setProperty("--controller-width",`${this._$controllerWidth}px`),this.stage.initialize(),this.initialize(this.root)}stop(){this._$scene&&(this._$scene.stop(),this._$scene=null),d.$screenRuler.clear(),d.$root.stage._$player.stop()}load(e){const t=JSON.parse(e);if(this._$characterId=0|t.characterId,this._$name=t.name,this._$stage=new x(t.stage),this._$plugins.size&&this._$plugins.clear(),t.plugins)for(let e=0;e<t.plugins.length;++e){const r=t.plugins[e];this._$plugins.set(r.name,r)}this._$libraries.size&&this._$libraries.clear();const r=t.libraries;for(let e=0;e<r.length;++e)this.addLibrary(r[e]);t.setting&&(this._$timelineHeight=t.setting.timelineHeight,this._$controllerWidth=t.setting.controllerWidth,this._$ruler=!!t.setting.ruler,this._$rulerX=t.setting.rulerX||[],this._$rulerY=t.setting.rulerY||[])}toJSON(){const e=[];for(const t of this._$libraries.values())e.push(t.toObject());return JSON.stringify({version:d.VERSION,name:this.name,characterId:this._$characterId,stage:this.stage.toObject(),libraries:e,plugins:Array.from(this._$plugins.values()),setting:{timelineHeight:this._$timelineHeight,controllerWidth:this._$controllerWidth,ruler:this._$ruler,rulerX:this._$rulerX.slice(0),rulerY:this._$rulerY.slice(0)}})}temporarilySaved(){d.$updated=!0,this._$currentData&&(this._$currentData=null),this._$position!==this._$revision.length&&(this._$revision.length=this._$position),this._$revision.push(this.toJSON()),this._$position++,this._$revision.length>d.REVISION_LIMIT&&(this._$revision.shift(),this._$position=this._$revision.length)}undo(){this._$position&&(this._$currentData||(this._$currentData=this.toJSON()),this._$currentFrame=d.$timelineFrame.currentFrame,this.reloadData(this._$revision[--this._$position]),this._$currentFrame=0)}redo(){if(!this._$revision.length||this._$position===this._$revision.length)return;let e=null;if(this._$position+1===this._$revision.length){if(!this._$currentData)return;e=this._$currentData,this._$position++,this._$currentData=null}else e=this._$revision[++this._$position];e&&(this._$currentFrame=d.$timelineFrame.currentFrame,this.reloadData(e),this._$currentFrame=0)}reloadData(e){const t=[],r=d.$timelineLayer.targetLayers;for(const e of r.keys())t.push(e);d.$sceneChange.cache();d.$tools.getDefaultTool("arrow").clear(),d.$tools.reset();const a=this._$scene.currentFrame,s=this._$scene.id;this._$scene.stop(),this._$scene=null,this.load(e);let i=this.getLibrary(s);if(i?i._$currentFrame=a:(i=this.getLibrary(0),t.length=0),d.$sceneChange.restore(),this.initialize(i),t.length){const e=d.$ctrlKey;d.$ctrlKey=!0;for(let e=0;e<t.length;++e){const r=document.getElementById(`${t[e]}`);r&&d.$timelineLayer.activeLayer(r)}d.$ctrlKey=e}}addLibrary(e){let t;switch(e.type){case b.MOVIE_CLIP:t=new E(e);break;case b.BITMAP:t=new $(e);break;case b.TEXT:t=new L(e);break;case b.SOUND:t=new w(e);break;case b.VIDEO:t=new M(e);break;case b.SHAPE:t=new S(e);break;case b.FOLDER:t=new y(e)}return this._$libraries.set(t.id,t),t}getLibrary(e){return this._$libraries.get(0|e)}removeLibrary(e){this._$libraries.delete(0|e)}}class W{constructor(){this._$events=new Map}addEventListener(e,t){this._$events.has(e)||this._$events.set(e,[]),this._$events.get(e).push(t)}dispatchEvent(e,t=null){if(!this._$events.has(e))return;const r=this._$events.get(e);for(let e=0;e<r.length;++e){(0,r[e])(t)}}}class j{static get MOUSE_DOWN(){return"mousedown"}static get MOUSE_UP(){return"mouseup"}static get MOUSE_MOVE(){return"mousemove"}static get START(){return"start"}static get END(){return"end"}static get DBL_CLICK(){return"dblclick"}static get CHANGE(){return"change"}static get MOUSE_OVER(){return"mouseover"}static get MOUSE_OUT(){return"mouseout"}static get KEY_DOWN(){return"keydown"}static get MOUSE_LEAVE(){return"mouseleave"}}class H{constructor(){this._$saved=!1,this._$focus=!1,this._$currentEvent=null,this._$currentTarget=null,this._$mouseMove=null,this._$mouseUp=null}setInputEvent(e){e&&(e.addEventListener("mouseover",(e=>{this.mouseOver(e)})),e.addEventListener("mouseout",(e=>{this.mouseOut(e)})),e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})),e.addEventListener("focusout",(e=>{this.finishInput(e)})),e.addEventListener("keypress",(e=>{this.finishInput(e)})))}changeFunction(e,t){let r=e.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("");return this[`change${r}`](t)}mouseOver(e){switch(e.stopPropagation(),!0){case this._$focus:case null!==this._$currentTarget:return;default:d.$setCursor("ew-resize"),e.target.style.cursor="ew-resize"}this._$currentValue=+e.target.value}mouseOut(e){e.stopPropagation(),!this._$focus&&this._$currentTarget||(d.$setCursor("auto"),e.target.style.cursor="")}mouseDown(e){this._$focus||(e.preventDefault(),this._$saved=!1,this._$pointX=e.screenX,this._$currentTarget=e.target,d.$setCursor("ew-resize"),this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto"),this._$currentTarget&&(this._$currentTarget.style.cursor="",this._$currentTarget.focus())}mouseMove(e){!this._$focus&&this._$currentTarget&&window.requestAnimationFrame((()=>{if(this._$focus||!this._$currentTarget)return;e.preventDefault(),d.$setCursor("ew-resize");const t=e.screenX-this._$pointX;let r=+this._$currentTarget.value;isNaN(r)&&(r=0),this._$currentTarget.value=this.changeFunction(this._$currentTarget.id,r+t),this._$pointX=e.screenX}))}focusIn(){this._$focus=!0,d.$keyLock=!0}focusOut(){this._$saved=!1,this._$focus=!1,this._$currentTarget=null,d.$keyLock=!1}finishInput(e){"Enter"!==e.key?"focusout"===e.type&&(this._$currentTarget=e.target,e.target.value=this.changeFunction(this._$currentTarget.id,this._$currentTarget.value),this.focusOut()):e.currentTarget.blur()}reloadScreen(){const e=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(e)}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}}class G extends W{constructor(){super(),this._$active=!1,this._$target=null,this._$events.set(j.MOUSE_DOWN,[e=>{this.activation(e)}]),this._$events.set(j.MOUSE_UP,[()=>{this.termination()}]),this._$events.set(j.START,[()=>{this.toolStart()}]),this._$events.set(j.END,[()=>{this.toolEnd()}])}get active(){return this._$active}set active(e){this._$active=!!e}get target(){return this._$target}set target(e){this._$target=e}activation(e){this.active=!0,this.target=e.currentTarget}termination(){this.active=!1,this.target=null}toolStart(){d.$setCursor("auto");const e=document.getElementById(`tools-${this._$name}`);e&&e.classList.add("active")}toolEnd(){const e=document.getElementById(`tools-${this._$name}`);e&&e.classList.remove("active")}}class V{constructor(e){this._$areaName=e,this._$active=!1,this._$mapping=new Map,this._$execute=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}get areaName(){return this._$areaName}get active(){return this._$active}set active(e){this._$active=!!e,this._$active?window.addEventListener("keydown",this._$execute):window.removeEventListener("keydown",this._$execute)}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),this._$execute=this.execute.bind(this),d.$initializeEnd()}add(e,t){this._$mapping.set(e,t)}delete(e){this._$mapping.delete(e)}execute(e){if(d.$keyLock||!this._$active)return;let t=d.$generateShortcutKey(e.key,{alt:d.$altKey,shift:d.$shiftKey,ctrl:d.$ctrlKey});const r=d.$shortcutSetting.commandMapping.get(this.areaName);if(r.has(t))t=r.get(t);else{if(d.$shortcutSetting.viewMapping.get(this.areaName).has(t))return}this._$mapping.has(t)&&(d.$endMenu(),e.stopPropagation(),e.preventDefault(),this._$mapping.get(t)(t))}}d.$keyboardCommand=new V;class K extends H{constructor(){super(),this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}static get FILL_DEFAULT_COLOR(){return"#000000"}static get STROKE_DEFAULT_COLOR(){return"#000000"}static get STROKE_DEFAULT_SIZE(){return 0}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("fill-color");e&&(e.value=localStorage.getItem(`${d.PREFIX}@${e.id}`)||K.FILL_DEFAULT_COLOR,e.addEventListener("change",(e=>{const t=e.target;localStorage.setItem(`${d.PREFIX}@${t.id}`,e.target.value)})));const t=document.getElementById("stroke-color");t&&(t.value=localStorage.getItem(`${d.PREFIX}@${t.id}`)||K.STROKE_DEFAULT_COLOR,t.addEventListener("change",(e=>{const t=e.target;localStorage.setItem(`${d.PREFIX}@${t.id}`,t.value)})));const r=document.getElementById("stroke-size");r&&(r.value=localStorage.getItem(`${d.PREFIX}@${r.id}`)||K.STROKE_DEFAULT_SIZE,this.setInputEvent(r)),d.$initializeEnd()}changeStrokeSize(e){return e=d.$clamp(0|e,0,255),localStorage.setItem(`${d.PREFIX}@stroke-size`,e),e}}d.$colorTool=new K;class Z extends G{constructor(e){if(super(),this._$name=e,this._$cursor="auto",this._$pageX=0,this._$pageY=0,this._$offsetX=0,this._$offsetY=0,e){d.$tools.setTool(e,this);let t=document.getElementById(`tools-${e}`);if(!t){const r=document.getElementById("plugin-tools");if(r){const a=document.createElement("div");a.id=`tools-${e}`,a.classList.add("item"),a.dataset.mode="tool",a.dataset.name=e,r.appendChild(a),t=a}}t&&t.addEventListener(j.MOUSE_DOWN,(()=>{d.$tools.activeTool&&d.$tools.activeTool.dispatchEvent(j.END),this.dispatchEvent(j.START),d.$tools.activeTool=this}))}}get name(){return this._$name}get pageX(){return this._$pageX}set pageX(e){this._$pageX=e}get pageY(){return this._$pageY}set pageY(e){this._$pageY=e}get offsetX(){return this._$offsetX}set offsetX(e){this._$offsetX=e}get offsetY(){return this._$offsetY}set offsetY(e){this._$offsetY=e}setIcon(e){const t=document.getElementById(`tools-${this._$name}`),r=t.children;for(;r.length;)r[0].remove();t.appendChild(e)}setToolTip(e){const t=document.getElementById(`tools-${this._$name}`);t&&(t.dataset.detail=`${e}`)}setCursor(e="auto"){this._$cursor=`${e}`}}d.$project=new class{initialize(){const e=document.getElementById("tools-load");e&&e.addEventListener("click",(e=>{e.preventDefault(),this.open()}));const t=document.getElementById("tools-load-file-input");t&&t.addEventListener("change",(e=>{const t=e.target.files;for(let e=0;e<t.length;++e)this.load(t[e]);e.target.value=""}));const r=document.getElementById("tools-save");r&&r.addEventListener("click",(e=>{e.preventDefault(),this.save()}));const a=document.getElementById("tools-export");a&&a.addEventListener("click",(e=>{e.preventDefault(),this.publish()}));const s=document.getElementById("language-setting");if(s){const e=localStorage.getItem(`${d.PREFIX}@language-setting`);if(e){const t=s.children;for(let r=0;r<t.length;++r){const a=t[r];if(a.value===e){a.selected=!0;break}}}s.addEventListener("change",(e=>{const t=e.target.value,r=d.$languages.get(t);d.$currentLanguage=new r,localStorage.setItem(`${d.PREFIX}@language-setting`,t),d.$addModalEvent(document)}))}}publish(){if(d.$saveProgress.active)return;d.$saveProgress.start();const e=document.getElementById("save-anchor");e.href&&URL.revokeObjectURL(e.href);switch(document.getElementById("publish-type-setting").value){case"json":d.$saveProgress.createJson(),setTimeout((()=>{e.download=`${d.$currentWorkSpace().name}.json`,e.href=URL.createObjectURL(new Blob([q.toJSON()],{type:"application/json"})),e.click(),d.$saveProgress.end()}),200);break;case"zlib":q.toZlib();break;case"webm":q.toWebM();break;case"gif-loop":q.toGIF();break;case"gif":q.toGIF(-1);break;case"png":q.toPng();break;case"apng-loop":q.toApng(!0);break;case"apng":q.toApng(!1);break;case"custom":"CustomPublish"in window&&window.CustomPublish.execute(q.toObject()),d.$saveProgress.end()}}load(e){d.$saveProgress.active||(d.$saveProgress.start(),e.arrayBuffer().then((t=>{d.$saveProgress.zlibInflate();const r=new Uint8Array(t);d.$unZlibWorker.postMessage({buffer:r,name:e.name.replace(".n2d",""),type:"n2d"},[r.buffer])})))}open(){document.getElementById("tools-load-file-input").click()}save(){d.$saveProgress.active||(d.$saveProgress.start(),new Promise((e=>{d.$saveProgress.createJson(),setTimeout((()=>{e({object:d.$currentWorkSpace().toJSON(),type:"n2d"})}),200)})).then((e=>{d.$saveProgress.zlibDeflate(),d.$zlibWorkerActive?d.$zlibQueues.push(e):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(e))})))}};class q{static toObject(){const e=d.$currentWorkSpace(),t=e.stage,r=e._$libraries,a=[];for(let[e,t]of r)switch(!0){case 0===e:case"folder"!==t.type:case""!==t.symbol:case d.$useIds.has(e):{const r=t.toPublish();r.symbol&&d.$symbols.set(r.symbol,a.length),a[e]=r}break;default:a[e]=null}let s=d.$useIds.size;for(;;){for(let[e,t]of r){if(a[e])continue;if(!d.$useIds.has(e))continue;const r=t.toPublish();r.symbol&&d.$symbols.set(r.symbol,a.length),a[e]=r}if(s===d.$useIds.size)break;s=d.$useIds.size}return{stage:{width:t.width,height:t.height,fps:t.fps,bgColor:t.bgColor},characters:a}}static toJSON(){d.$symbols.size&&d.$symbols.clear();const e=q.toObject();return e.symbols=Array.from(d.$symbols),e.type="json",JSON.stringify(e)}static toZlib(){d.$symbols.size&&d.$symbols.clear(),new Promise((e=>{d.$saveProgress.createJson(),setTimeout((()=>{const t=q.toObject();t.symbols=Array.from(d.$symbols),e({object:JSON.stringify(t),type:"json"})}),200)})).then((e=>{d.$saveProgress.zlibDeflate(),d.$zlibWorkerActive?d.$zlibQueues.push(e):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(e))}))}static toWebM(){d.$saveProgress.encode();const e=document.getElementById("__next2d__").children[0].captureStream(0|document.getElementById("stage-fps").value),t=[],r="video/webm;codecs=h264",a=new MediaRecorder(e,{mimeType:r});a.addEventListener("dataavailable",(e=>{t.push(e.data)})),a.addEventListener("stop",(()=>{d.$hidePreview();const e=document.getElementById("save-anchor");e.download=`${d.$currentWorkSpace().name}.webm`,e.href=URL.createObjectURL(new Blob(t,{type:r})),e.click(),d.$saveProgress.end()}));const s=function(){if(d.$root.numChildren)return d.$root.currentFrame>=d.$root.totalFrames?a.stop():void requestAnimationFrame(s);requestAnimationFrame(s)};s(),d.$showPreview();document.getElementById("player-preview").style.display="none",a.start(0)}static toGIF(e=0){d.$saveProgress.encode();const t=new GIF({repeat:e,workerScript:"./assets/js/gif.worker.js"});t.on("finished",(e=>{const t=document.getElementById("save-anchor");t.download=`${d.$currentWorkSpace().name}.gif`,t.href=URL.createObjectURL(e),t.click(),d.$saveProgress.end()}));const r=function(){if(!d.$root.numChildren)return void requestAnimationFrame(r);const e=document.getElementById("__next2d__").children[0],a=document.createElement("canvas");a.width=e.width,a.height=e.height;const s=a.getContext("2d");if(s.drawImage(e,0,0,e.width,e.height),t.addFrame(s.canvas,{delay:20}),d.$root.currentFrame>=d.$root.totalFrames)return d.$hidePreview(),void t.render();requestAnimationFrame(r)};r(),d.$showPreview();document.getElementById("player-preview").style.display="none"}static toPng(){d.$saveProgress.encode();const e=()=>{if(!d.$root.numChildren)return void requestAnimationFrame(e);const t=d.$root.stage;if(!t)return void requestAnimationFrame(e);if(t._$player._$stopFlag)return void requestAnimationFrame(e);const r=document.getElementById("__next2d__").children[0],a=document.getElementById("save-anchor");a.download=`${d.$currentWorkSpace().name}.png`,a.href=r.toDataURL(),a.click(),d.$saveProgress.end(),d.$hidePreview()};e(),d.$showPreview();document.getElementById("player-preview").style.display="none"}static toApng(e=!0){d.$saveProgress.encode();const t=[];let r=0;const a=()=>{if(d.$root.stage._$player._$stopFlag||!d.$root.numChildren||r===d.$root.currentFrame)return void requestAnimationFrame(a);r=d.$root.currentFrame;const s=document.getElementById("__next2d__").children[0],i=document.createElement("canvas");i.width=s.width,i.height=s.height,s.toBlob((r=>{if(t.push(r),t.length===d.$root.totalFrames)return d.$hidePreview(),new m(t,s.width,s.height,0|document.getElementById("stage-fps").value,e).encode().then((e=>{const t=document.getElementById("save-anchor");t.download=`${d.$currentWorkSpace().name}.apng`,t.href=URL.createObjectURL(e),t.click(),d.$saveProgress.end()}))})),d.$root.currentFrame>=d.$root.totalFrames||requestAnimationFrame(a)};a(),d.$showPreview();document.getElementById("player-preview").style.display="none"}}d.$saveProgress=new class{constructor(){this._$active=!1,this._$value=0,this._$timerId=-1,this._$mouseMove=null,this._$mouseUp=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}get active(){return this._$active}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("save-progress-modal");e&&e.addEventListener("mousedown",(e=>{this.moveStart(e)})),d.$initializeEnd()}moveStart(e){e.stopPropagation(),e.preventDefault(),this._$pageX=e.pageX,this._$pageY=e.pageY,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){const t=document.getElementById("save-progress-modal");t&&window.requestAnimationFrame((()=>{const r=t.offsetLeft+(e.pageX-this._$pageX),a=t.offsetTop+(e.pageY-this._$pageY);t.setAttribute("style",`left: ${r}px; top: ${a}px`),this._$pageX=e.pageX,this._$pageY=e.pageY}))}mouseUp(e){e.stopPropagation(),e.preventDefault(),window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp)}start(){clearInterval(this._$timerId);const e=document.getElementById("save-progress-modal");if(!e)return;this.update(0),e.classList.contains("fadeIn")||e.setAttribute("class","fadeIn"),e.setAttribute("style","");const t=(window.innerWidth-e.clientWidth)/2,r=(window.innerHeight-e.clientHeight)/2;e.setAttribute("style",`left: ${t}px; top: ${r}px`),this._$active=!0}createJson(){clearInterval(this._$timerId),this.update(10,d.$currentLanguage.replace("{{JSONを生成}}"))}createFile(){clearInterval(this._$timerId),this.update(90,d.$currentLanguage.replace("{{ファイルを生成}}"))}loadN2D(){clearInterval(this._$timerId),this.update(90,d.$currentLanguage.replace("{{N2Dファイルの読み込み}}"))}loadJson(){clearInterval(this._$timerId),this.update(90,d.$currentLanguage.replace("{{JSONの読み込み}}"))}zlibInflate(){clearInterval(this._$timerId),this.update(15,d.$currentLanguage.replace("{{データを解凍中}}")),this._$timerId=setInterval((()=>{this.update(Math.min(80,this._$value+1),d.$currentLanguage.replace("{{データを解凍中}}"))}),300)}encode(){clearInterval(this._$timerId),this.update(15,d.$currentLanguage.replace("{{エンコード}}")),this._$timerId=setInterval((()=>{this.update(Math.min(80,this._$value+1),d.$currentLanguage.replace("{{エンコード}}"))}),300)}zlibDeflate(){clearInterval(this._$timerId),this.update(15,d.$currentLanguage.replace("{{データを圧縮中}}")),this._$timerId=setInterval((()=>{this.update(Math.min(80,this._$value+1),d.$currentLanguage.replace("{{データを圧縮中}}"))}),300)}parseSWF(){clearInterval(this._$timerId),this.update(15,d.$currentLanguage.replace("{{SWFを解析中}}")),this._$timerId=setInterval((()=>{this.update(Math.min(80,this._$value+1),d.$currentLanguage.replace("{{SWFを解析中}}"))}),300)}loadFiles(){this.update(5,d.$currentLanguage.replace("{{外部ファイルの読み込み}}")),this._$timerId=setInterval((()=>{this.update(Math.min(90,this._$value+1),d.$currentLanguage.replace("{{外部ファイルの読み込み}}"))}),300)}createBinary(){clearInterval(this._$timerId),this.update(80,d.$currentLanguage.replace("{{バイナリデータを生成}}"))}launchDatabase(e){clearInterval(this._$timerId),this.update(e,d.$currentLanguage.replace("{{データベースを起動}}"))}commit(){clearInterval(this._$timerId),this.update(95,d.$currentLanguage.replace("{{データを保存中}}"))}end(){clearInterval(this._$timerId),this.update(100,d.$currentLanguage.replace("{{完了}}")),window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),this._$timerId=-1,this._$active=!1;const e=document.getElementById("save-progress-modal");e&&(e.classList.contains("fadeOut")||setTimeout((()=>{e.setAttribute("class","fadeOut")}),1e3))}update(e,t=""){const r=document.getElementById("save-progress");r&&(this._$value=e,r.value=`${e}`,document.getElementById("progress-state").textContent=t)}};d.$shortcutSetting=new class{constructor(){this._$names=["screen","timeline","library"],this._$default={screen:[{key:"v",text:"V",css:"tools-arrow",description:"{{選択ツール}}"},{key:"q",text:"Q",css:"tools-arrow-transform",description:"{{自由変形ツール}}"},{key:"a",text:"A",css:"tools-transform",description:"{{Shape変形ツール}}"},{key:"p",text:"P",css:"tools-pen",description:"{{ペンツール}}"},{key:"k",text:"K",css:"tools-bucket",description:"{{バケツツール}}"},{key:"r",text:"R",css:"tools-rectangle",description:"{{矩形ツール}}"},{key:"o",text:"O",css:"tools-circle",description:"{{楕円ツール}}"},{key:"rShift",text:"Shift + R",css:"tools-round-rect",description:"{{角丸矩形ツール}}"},{key:"t",text:"T",css:"tools-text",description:"{{テキストツール}}"},{key:"z",text:"Z",css:"tools-zoom",description:"{{ズームツール}}"},{key:"rCtrl",text:"Ctrl + R",css:"tools-load",description:"{{プロジェクトデータの読込}}"},{key:"sShiftCtrl",text:"Ctrl + Shift + S",css:"tools-save",description:"{{プロジェクトデータを保存}}"},{key:"EnterShiftCtrl",text:"Ctrl + Shift + Enter",css:"tools-export",description:"{{書き出し}}"},{key:"s",text:"S",css:"tools-setting",description:"{{設定}}"},{key:"ArrowUpShiftCtrl",text:"Ctrl + Shift + ArrowUp",css:"screen-front",description:"{{最前面}}"},{key:"ArrowUpCtrl",text:"Ctrl + ArrowUp",css:"screen-front-one",description:"{{ひとつ前面へ}}"},{key:"ArrowDownCtrl",text:"Ctrl + ArrowDown",css:"screen-menu-bottom",description:"{{ひとつ背面へ}}"},{key:"ArrowDownShiftCtrl",text:"Ctrl + Shift + ArrowDown",css:"screen-back",description:"{{最背面}}"},{key:"1",text:"1",css:"screen-position-left",description:"{{左揃え}}"},{key:"2",text:"2",css:"screen-position-center",description:"{{中央揃え(水平方向)}}"},{key:"3",text:"3",css:"screen-position-right",description:"{{右揃え}}"},{key:"4",text:"4",css:"screen-position-top",description:"{{上揃え}}"},{key:"5",text:"5",css:"screen-position-middle",description:"{{中央揃え(垂直方向)}}"},{key:"6",text:"6",css:"screen-position-bottom",description:"{{下揃え}}"},{key:"!Shift",text:"Shift + 1",css:"stage-position-left",description:"{{ステージ左揃え}}"},{key:'"Shift',text:"Shift + 2",css:"stage-position-center",description:"{{ステージ中央揃え(水平方向)}}"},{key:"#Shift",text:"Shift + 3",css:"stage-position-right",description:"{{ステージ右揃え}}"},{key:"$Shift",text:"Shift + 4",css:"stage-position-top",description:"{{ステージ上揃え}}"},{key:"%Shift",text:"Shift + 5",css:"stage-position-middle",description:"{{ステージ中央揃え(垂直方向)}}"},{key:"&Shift",text:"Shift + 6",css:"stage-position-bottom",description:"{{ステージ下揃え}}"},{key:"dCtrl",text:"Ctrl + D",css:"screen-distribute-to-layers",description:"{{レイヤーに配分}}"},{key:"kCtrl",text:"Ctrl + K",css:"screen-distribute-to-keyframes",description:"{{キーフレームに配分}}"},{key:"iCtrl",text:"Ctrl + I",css:"screen-integrating-paths",description:"{{パスの結合}}"},{key:"pCtrl",text:"Ctrl + P",css:"screen-add-tween-curve-pointer",description:"{{カーブポインターの追加}}"},{key:"pShiftCtrl",text:"Ctrl + Shift + P",css:"screen-delete-tween-curve-pointer",description:"{{カーブポインターの削除}}"},{key:"mShift",text:"Shift + M",css:"screen-change-movie-clip",description:"{{MovieClipに変換}}"},{key:"rShiftCtrl",text:"Ctrl + Shift + R",css:"screen-ruler",description:"{{定規}}"}],timeline:[{key:"nShift",text:"Shift + N",css:"timeline-layer-normal",description:"{{通常レイヤー}}"},{key:"mShift",text:"Shift + M",css:"timeline-layer-mask",description:"{{マスクレイヤー}}"},{key:"gShift",text:"Shift + G",css:"timeline-layer-guide",description:"{{ガイドレイヤー}}"},{key:";Ctrl",text:"Ctrl + +",css:"timeline-layer-add",description:"{{レイヤーを追加}}"},{key:"BackspaceCtrl",text:"Ctrl + Backspace",css:"timeline-layer-trash",description:"{{レイヤーを削除}}"},{key:"hShift",text:"Shift + H",css:"timeline-layer-light-all",description:"{{全てのレイヤーをハイライト}}"},{key:"dShift",text:"Shift + D",css:"timeline-layer-disable-all",description:"{{全てのレイヤーを非表示}}"},{key:"lShift",text:"Shift + L",css:"timeline-layer-lock-all",description:"{{全てのレイヤーをロック}}"},{key:"m",text:"M",css:"context-menu-tween-add",description:"{{モーショントゥイーンの追加}}"},{key:"mCtrl",text:"Ctrl + M",css:"context-menu-tween-delete",description:"{{モーショントゥイーンの削除}}"},{key:"s",text:"S",css:"timeline-script-add",description:"{{スクリプトを追加}}"},{key:"k",text:"K",css:"timeline-key-add",description:"{{キーフレームを追加}}"},{key:"kCtrl",text:"Ctrl + K",css:"timeline-key-delete",description:"{{キーフレームを削除}}"},{key:"e",text:"E",css:"timeline-empty-add",description:"{{空のキーフレームを追加}}"},{key:"f",text:"F",css:"timeline-frame-add",description:"{{フレームを追加}}"},{key:"fCtrl",text:"Ctrl + F",css:"timeline-frame-delete",description:"{{フレームを削除}}"},{key:"oCtrl",text:"Ctrl + O",css:"timeline-onion-skin",description:"{{オニオンスキン}}"},{key:"p",text:"P",css:"timeline-preview",description:"{{プレビューのON/OFF}}"},{key:"pCtrl",text:"Ctrl + P",css:"timeline-repeat",description:"{{ループ設定}}"},{key:"l",text:"L",css:"label-name",description:"{{フレームラベル}}"},{key:"z",text:"Z",css:"timeline-scale",description:"{{タイムライン幅の拡大・縮小}}"},{key:"lCtrl",text:"Ctrl + L",css:"context-menu-layer-clone",description:"{{レイヤーを複製}}"},{key:"ArrowLeftShiftCtrl",text:"Ctrl + Shift + ArrowLeft",css:"context-menu-first-frame",description:"{{最初のフレームに移動}}"},{key:"ArrowRightShiftCtrl",text:"Ctrl + Shift + ArrowRight",css:"context-menu-last-frame",description:"{{最後のフレームに移動}}"},{key:"cCtrl",text:"Ctrl + C",css:"context-menu-frame-copy",description:"{{フレームをコピー}}"},{key:"vCtrl",text:"Ctrl + V",css:"context-menu-frame-paste",description:"{{フレームをペースト}}"}],library:[{key:"mCtrl",text:"Ctrl + M",css:"library-menu-container-add",description:"{{新規MovieClip}}"},{key:"fCtrl",text:"Ctrl + F",css:"library-menu-folder-add",description:"{{新規フォルダー}}"},{key:"rCtrl",text:"Ctrl + R",css:"library-menu-file",description:"{{読み込み}}"},{key:"sShiftCtrl",text:"Ctrl + Shift + S",css:"library-menu-export",description:"{{書き出し}}"},{key:"Backspace",text:"Backspace",css:"library-menu-delete",description:"{{削除}}"},{key:"cCtrl",text:"Ctrl + C",css:"library-menu-copy",description:"{{コピー}}"},{key:"vCtrl",text:"Ctrl + V",css:"library-menu-paste",description:"{{ペースト}}"}]},this._$commandMapping=new Map([["screen",new Map],["timeline",new Map],["library",new Map],["global",new Map]]),this._$viewMapping=new Map([["screen",new Map],["timeline",new Map],["library",new Map],["global",new Map]]),this._$active=!1,this._$selectNode=null,this._$selectArea="",this._$keydownEvent=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}get commandMapping(){return this._$commandMapping}get viewMapping(){return this._$viewMapping}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=["shortcut-setting-screen","shortcut-setting-timeline","shortcut-setting-library","shortcut-setting-reset","shortcut-setting-save","shortcut-setting-close"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.executeFunction(e)}))}this.createShortcutMap();for(let e=0;e<this._$names.length;++e){const t=this._$names[e],r=document.getElementById(`shortcut-list-${t}`);if(!r)continue;const a=this.viewMapping.get(t),s=this._$default[t];for(let e=0;e<s.length;++e){const t=s[e],i=`\n<div class="shortcut-item">\n    <i class="${t.css}"></i>\n    <div class="description">\n        <span class="language" data-text="${t.description}">${d.$currentLanguage.replace(t.description)}</span>\n    </div>\n    <div class="command" data-key="${t.key}" data-default-text="${t.text}">${t.text}</div>\n</div>`;r.insertAdjacentHTML("beforeend",i);const n=r.lastElementChild;n.addEventListener("mousedown",(e=>{this.selectNode(e)}));const o=n.lastElementChild;if(!a.has(o.dataset.key))continue;const l=a.get(o.dataset.key);o.dataset.map=l.map,o.textContent=l.text}}this._$keydownEvent=this.keydownEvent.bind(this),d.$initializeEnd()}createShortcutMap(){const e=localStorage.getItem(`${d.PREFIX}@shortcut`);if(!e)return;const t=JSON.parse(e),r=Object.keys(t);for(let e=0;e<r.length;++e){const a=r[e];this.viewMapping.get(a).clear(),this.commandMapping.get(a).clear();const s=t[a];for(let e=0;e<s.length;++e){const t=s[e];this.viewMapping.get(a).set(t.key,{map:t.map,text:t.text}),this.commandMapping.get(a).set(t.map,t.key)}}}keydownEvent(e){if(document.getElementById("shortcut-setting-menu").classList.contains("fadeOut"))return d.$useShortcutSetting=!1,this._$active=!1,void window.removeEventListener("keydown",this._$keydownEvent);if(!this._$selectNode||!this._$selectArea)return;const t=[];switch(d.$shiftKey&&t.push("Shift"),d.$altKey&&t.push("Alt"),d.$ctrlKey&&t.push("Ctrl"),!0){case" "===e.key:t.push(e.code);break;case 1===e.key.length:t.push(e.key.toUpperCase());break;default:t.push(e.key)}const r=this._$selectNode.lastElementChild;r.textContent=`${t.join(" + ")}`;const a=d.$generateShortcutKey(e.key,{alt:d.$altKey,shift:d.$shiftKey,ctrl:d.$ctrlKey});a!==r.dataset.key?(r.dataset.map=a,r.dataset.text=r.textContent):(delete r.dataset.map,delete r.dataset.text)}selectNode(e){this._$selectNode&&this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=e.target,this._$selectNode.classList.add("shortcut-active")}executeFunction(e){this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}executeShortcutSettingScreen(){document.getElementById("shortcut-setting-screen").classList.add("shortcut-active"),document.getElementById("shortcut-setting-timeline").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-library").classList.remove("shortcut-active"),document.getElementById("shortcut-list-screen").style.display="",document.getElementById("shortcut-list-timeline").style.display="none",document.getElementById("shortcut-list-library").style.display="none",this._$selectArea="screen",this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null)}executeShortcutSettingTimeline(){document.getElementById("shortcut-setting-screen").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-timeline").classList.add("shortcut-active"),document.getElementById("shortcut-setting-library").classList.remove("shortcut-active"),document.getElementById("shortcut-list-screen").style.display="none",document.getElementById("shortcut-list-timeline").style.display="",document.getElementById("shortcut-list-library").style.display="none",this._$selectArea="timeline",this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null)}executeShortcutSettingLibrary(){document.getElementById("shortcut-setting-screen").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-timeline").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-library").classList.add("shortcut-active"),document.getElementById("shortcut-list-screen").style.display="none",document.getElementById("shortcut-list-timeline").style.display="none",document.getElementById("shortcut-list-library").style.display="",this._$selectArea="library",this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null)}executeShortcutSettingReset(){localStorage.removeItem(`${d.PREFIX}@shortcut`);for(let e=0;e<this._$names.length;++e){const t=this._$names[e],r=document.getElementById(`shortcut-list-${t}`).children;for(let e=0;e<r.length;++e){const t=r[e].lastElementChild;t.textContent=t.dataset.defaultText,t.dataset.map&&(delete t.dataset.map,delete t.dataset.text)}this.viewMapping.get(t).clear(),this.commandMapping.get(t).clear()}this.createShortcutMap()}executeShortcutSettingSave(){localStorage.removeItem(`${d.PREFIX}@shortcut`);const e={};for(let t=0;t<this._$names.length;++t){const r=this._$names[t],a=document.getElementById(`shortcut-list-${r}`).children;for(let t=0;t<a.length;++t){const s=a[t].lastElementChild;s.dataset.map&&(e[r]||(e[r]=[]),e[r].push({key:s.dataset.key,map:s.dataset.map,text:s.textContent}))}}localStorage.setItem(`${d.PREFIX}@shortcut`,JSON.stringify(e)),this.createShortcutMap()}executeShortcutSettingClose(){d.$userSetting.show(),this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null,this._$selectArea="")}show(){const e=document.getElementById("shortcut-setting-menu");this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null,this._$selectArea=""),this.executeShortcutSettingScreen(),this._$active||(d.$useShortcutSetting=!0,this._$active=!0,window.addEventListener("keydown",this._$keydownEvent)),d.$endMenu("shortcut-setting-menu");const t=document.getElementById("user-setting");e.style.display="",e.style.left=`${t.offsetLeft}px`,e.style.top=`${t.offsetTop}px`,e.setAttribute("class","fadeIn")}};d.$tools=new class{constructor(){this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize(),this._$activeTool=null,this._$tools=new Map,this._$externalTools=new Map}get activeTool(){return this._$activeTool}set activeTool(e){this._$activeTool=e}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=[ee,te,ce,ne,ae,oe,ie,re,le,de,se];for(let t=0;t<e.length;++t){const r=new(0,e[t]);this._$tools.set(r.name,r)}const t=document.getElementById("tools");t&&(t.addEventListener("mousemove",(e=>{const t=this.activeTool;t&&(e.tools=!0,t.dispatchEvent(j.MOUSE_MOVE,e))})),t.addEventListener("mouseout",(e=>{d.$setCursor("auto"),e.stopPropagation()}))),d.$project.initialize(),d.$userSetting.initialize(),d.$initializeEnd()}setTool(e,t){this._$externalTools.set(e,t)}getTool(e){return this._$externalTools.has(e)?this._$externalTools.get(e):null}getDefaultTool(e){return this._$tools.get(e)}reset(){const e=this.activeTool;e&&e.dispatchEvent(j.END);const t=this.getDefaultTool("arrow");t.dispatchEvent(j.START),this.activeTool=t}};d.$userSetting=new class{initialize(){const e=document.getElementById("tools-setting");e&&e.addEventListener("click",(e=>{this.show(e)}));const t=this.getPublishSetting(),r=document.getElementById("publish-layer-setting");r&&(r.children[t.layer?1:0].selected=!0,r.addEventListener("change",(e=>{const t=this.getPublishSetting();t.layer="1"===e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))})));const a=document.getElementById("publish-type-setting");if(a){for(let e=0;e<a.children.length;++e){const r=a.children[e];if(t.type===r.value){r.selected=!0;break}}a.addEventListener("change",(e=>{const t=this.getPublishSetting();t.type=e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))}))}const s=document.getElementById("modal-setting");s&&("modal"in t&&(s.children[t.modal?0:1].selected=!0),s.addEventListener("change",(e=>{const t=this.getPublishSetting();t.modal="1"===e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))})));const i=document.getElementById("shortcut-setting");i&&i.addEventListener("click",(()=>{d.$shortcutSetting.show()}))}getPublishSetting(){const e=localStorage.getItem(`${d.PREFIX}@user-publish-setting`);return e?JSON.parse(e):{layer:!1,type:"zlib"}}show(){const e=document.getElementById("user-setting");d.$endMenu("user-setting");const t=document.getElementById("tools-setting");e.style.display="",e.style.left=`${t.offsetLeft+30}px`,e.style.top=t.offsetTop-e.clientHeight+80+"px",e.setAttribute("class","fadeIn")}};class J extends Z{constructor(e){super(e),this.initialize()}initialize(){}changeNodeEvent(e=!0){d.$hitColor=null;const t=document.getElementById("stage-area");if(t){const r=t.children;for(let t=0;t<r.length;++t){const a=r[t];a.dataset.shapePointer?(a.remove(),--t):a.dataset.child&&"true"!==a.dataset.preview&&(a.style.pointerEvents=e?"auto":"none")}}}createShape(e,t=0,r=0){const a=d.$currentWorkSpace().scene,s=0|d.$timelineLayer.targetLayer.dataset.layerId,i=a.getLayer(0|s);if(i.lock)return;const n=d.$currentWorkSpace().addLibrary(e),o=d.$timelineFrame.currentFrame,l=i.adjustmentLocation(o),{Matrix:c}=window.next2d.geom,h=d.$sceneChange.concatenatedMatrix,u=new c(h[0],h[1],h[2],h[3],h[4],h[5]);u.invert();const m=t*u.a+r*u.c+u.tx,g=t*u.b+r*u.d+u.ty,$=new p;$.libraryId=n.id,$.startFrame=l.startFrame,$.endFrame=l.endFrame,$.setPlace(l.startFrame,{frame:l.startFrame,matrix:[1,0,0,1,m,g],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:i._$characters.length,scaleX:1,scaleY:1,rotation:0}),i.addCharacter($),i.reloadStyle(),d.$timelineScroll.updateWidth(),d.$libraryController.reload()}createTextField(e,t=0,r=0){const a=d.$currentWorkSpace().scene,s=0|d.$timelineLayer.targetLayer.dataset.layerId,i=a.getLayer(0|s);if(i.lock)return;const n=d.$currentWorkSpace().addLibrary(e),o=d.$timelineFrame.currentFrame,l=i.adjustmentLocation(o),{Matrix:c}=window.next2d.geom,h=d.$sceneChange.concatenatedMatrix,u=new c(h[0],h[1],h[2],h[3],h[4],h[5]);u.invert();const m=t*u.a+r*u.c+u.tx,g=t*u.b+r*u.d+u.ty,$=new p;$.libraryId=n.id,$.startFrame=l.startFrame,$.endFrame=l.endFrame,$.setPlace(l.startFrame,{frame:l.startFrame,matrix:[1,0,0,1,m,g],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:i._$characters.length,scaleX:1,scaleY:1,rotation:0}),i.addCharacter($),i.reloadStyle(),d.$timelineScroll.updateWidth(),d.$libraryController.reload()}reloadScreen(){return d.$currentWorkSpace().scene.changeFrame(d.$timelineFrame.currentFrame)}}class Q extends J{constructor(e){super(e)}initialize(){this.setCursor("crosshair"),this.addEventListener(j.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(!1)})),this.addEventListener(j.MOUSE_DOWN,(e=>{d.$setCursor(this._$cursor),this.active=!!e.screen,e.screen&&this.mouseDown(e)})),this.addEventListener(j.MOUSE_MOVE,(e=>{d.$setCursor(this._$cursor),e.screen&&this.active&&(e.stopPropagation(),this.mouseMove(e))})),this.addEventListener(j.MOUSE_UP,(e=>{d.$setCursor(this._$cursor),e.stopPropagation(),e.screen&&(d.$timelineLayer.attachLayer(),this.createCharacter().then((()=>{document.getElementById("draw-rect").style.display="none",d.$tools.reset()})))}))}createCharacter(e=""){if(!e)return Promise.resolve();const t=document.getElementById("draw-rect"),{Graphics:r}=window.next2d.display,a=0|document.getElementById("stroke-size").value,s=(parseFloat(t.style.width)+a)/d.$zoomScale,i=(parseFloat(t.style.height)+a)/d.$zoomScale;if(!s||!i)return Promise.resolve();const n=d.$currentWorkSpace();n.temporarilySaved();const o=new r;switch(o.beginFill(document.getElementById("fill-color").value,1),e){case"rectangle":o.drawRect(0,0,s,i);break;case"circle":o.drawEllipse(0,0,s,i);break;case"round-rect":o.drawRoundRect(0,0,s,i,Math.min(s,i)/4)}o.endFill();const l=(this.offsetX-d.$offsetLeft)/d.$zoomScale,c=(this.offsetY-d.$offsetTop)/d.$zoomScale,h=n.nextLibraryId;if(this.createShape({id:h,type:b.SHAPE,name:`Shape_${h}`,symbol:"",recodes:o._$recode?o._$recode.slice(0):[],bounds:{xMin:0,xMax:s,yMin:0,yMax:i}},l+a/2,c+a/2),a){const t=new r;switch(t.lineStyle(a,document.getElementById("stroke-color").value),e){case"rectangle":t.drawRect(0,0,s,i);break;case"circle":t.drawEllipse(0,0,s,i);break;case"round-rect":t.drawRoundRect(0,0,s,i,Math.min(s,i)/4)}t.endLine();const o=Math.abs(t._$xMax-t._$xMin)-s,l=Math.abs(t._$yMax-t._$yMin)-i,c=this.offsetX-d.$offsetLeft,h=this.offsetY-d.$offsetTop,u=n.nextLibraryId;this.createShape({id:u,type:b.SHAPE,name:`Shape_${u}`,symbol:"",recodes:t._$recode?t._$recode.slice(0):[],bounds:{xMin:-o/2,xMax:s+o/2,yMin:-l/2,yMax:i+l/2}},c+o/2,h+l/2)}return this.reloadScreen()}mouseDown(e){this.pageX=e.pageX,this.pageY=e.pageY,this.offsetX=e.offsetX,this.offsetY=e.offsetY,"stage-area"!==e.target.id&&(this.offsetX+=e.target.offsetLeft,this.offsetY+=e.target.offsetTop);const t=document.getElementById("draw-rect");t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,t.style.width="0px",t.style.height="0px",t.style.display="",t.style.background=document.getElementById("fill-color").value,t.style.borderRadius="",t.style.border="";const r=0|document.getElementById("stroke-size").value;r&&(t.style.borderRadius=`${r}px`,t.style.border=`${r}px solid ${document.getElementById("stroke-color").value}`)}mouseMove(e){e.preventDefault();const t=e.pageX,r=e.pageY,a=document.getElementById("draw-rect");if("circle"===this.name&&(a.style.borderRadius="50%"),d.$shiftKey){const s=Math.max(Math.abs(t-this.pageX),Math.abs(r-this.pageY));this.pageX<t&&(a.style.left=`${this.pageX}px`),this.pageY<r&&(a.style.top=`${this.pageY}px`),this.pageX>t&&(this.offsetX=e.offsetX,a.style.left=this.pageX-s+"px"),this.pageY>r&&(this.offsetY=e.offsetY,a.style.top=this.pageY-s+"px"),a.style.width=`${s}px`,a.style.height=`${s}px`}else this.pageX>t&&(this.offsetX=e.offsetX,a.style.left=`${t}px`),this.pageY>r&&(this.offsetY=e.offsetY,a.style.top=`${r}px`),a.style.width=`${Math.abs(t-this.pageX)}px`,a.style.height=`${Math.abs(r-this.pageY)}px`;if("round-rect"===this.name){const e=Math.min(parseFloat(a.style.width),parseFloat(a.style.height));a.style.borderRadius=(e/8|0)+"px"}}}class ee extends J{constructor(){super("arrow"),this._$saved=!1,this._$activeElement="",this._$activeElements=[],this._$xReverse=!1,this._$yReverse=!1}initialize(){this.addEventListener(j.MOUSE_OVER,(e=>{const t=0|e.currentTarget.dataset.layerId,r=document.getElementById(`layer-lock-icon-${t}`);r&&!r.classList.contains("icon-active")&&d.$setCursor("move")})),this.addEventListener(j.MOUSE_OUT,(()=>{d.$setCursor("auto")})),this.addEventListener(j.CHANGE,(e=>{this.changeCharacter(e)})),this.addEventListener(j.MOUSE_LEAVE,(()=>{this.active=!1})),this.addEventListener(j.MOUSE_DOWN,(e=>{switch(this.active=!1,!0){case e.displayObject:this.active=!0,this._$activeElement=ee.DISPLAY_OBJECT,d.$endMenu(),this.activateElement(e);break;case e.screen:this.active=!0,this._$activeElement=ee.SCREEN,d.$endMenu(),this.clear(),this.startRect(e);break;case e.transform:this.active=!0,this._$activeElement=ee.TRANSFORM,d.$endMenu(),this.startPosition(e),this.setReverse();break;case e.grid:this.active=!0,this._$activeElement=ee.GRID,d.$endMenu(),this.startPosition(e);break;default:this._$activeElement=""}})),this.addEventListener(j.MOUSE_MOVE,(e=>{if(this.active)switch(e.stopPropagation(),e.preventDefault(),this._$activeElement){case ee.DISPLAY_OBJECT:this.moveDisplayObject(e);break;case ee.SCREEN:this.moveRect(e);break;case ee.TRANSFORM:this.moveTransform(e);break;case ee.GRID:this.moveGrid(e)}})),this.addEventListener(j.MOUSE_UP,(e=>{if(this._$activeElement){if(this._$activeElement===ee.SCREEN)e.stopPropagation(),this.endRect();this._$activeElement="",this._$saved=!1}})),this.addEventListener(j.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(),d.$timelineLayer.activeCharacter();const e=document.getElementById("target-rect");e&&e.setAttribute("class","arrow")})),this.addEventListener(j.END,(()=>{this.clearActiveElement(),d.$transformController.hide(),d.$gridController.hide(),d.$tweenController.clearPointer(),d.$controller.default()})),this.addEventListener(j.DBL_CLICK,(e=>{e.screen&&!this._$activeElements.length&&this.moveScene()})),this.dispatchEvent(j.START),d.$tools.activeTool=this}get activeElements(){return this._$activeElements}static get SCREEN(){return"screen"}static get TRANSFORM(){return"transform"}static get DISPLAY_OBJECT(){return"displayObject"}static get GRID(){return"grid"}clear(){this.clearActiveElement(),d.$clearShapePointer(),d.$transformController.hide(),d.$gridController.hide(),d.$tweenController.clearPointer(),d.$controller.default(),d.$timelineLayer.clear(),d.$referenceController.resetPointer()}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}clearActiveElement(){this._$activeElements.length=0}deleteDisplayObject(){const e=this.activeElements;if(!e.length)return;this.save();const t=d.$timelineFrame.currentFrame,r=new Map,a=d.$currentWorkSpace().scene;for(let s=0;s<e.length;++s){const i=e[s],n=a.getLayer(0|i.dataset.layerId);if(!n)continue;const o=n.getCharacter(0|i.dataset.characterId);o&&(r.has(n.id)||r.set(n.id,{layer:n,range:o.getRange(t)}),o.remove(n))}this.clearActiveElement();for(const e of r.values()){const r=e.layer,a=e.range,s=r.getActiveCharacter(a.startFrame);if(s.length){r.sort(s,t);for(let e=0;e<s.length;++e)s[e].getPlace(t).depth=e}else r.addEmptyCharacter(new f({startFrame:a.startFrame,endFrame:a.endFrame}));r.reloadStyle()}this.reloadScreen(),this._$saved=!1}addElement(e,t=!1){if(!e)return;for(let t=0;t<this._$activeElements.length;++t){if(this._$activeElements[t].dataset.characterId===e.dataset.characterId)return d.$shiftKey?(d.$tweenController.clearPointer(),this._$activeElements.splice(t,1),d.$referenceController.pointer=null):this._$activeElements.splice(t,1,e),!1}t||d.$shiftKey?d.$referenceController.pointer=null:this.clearActiveElement(),this._$activeElements.push(e);const r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId).getCharacter(0|e.dataset.characterId),a=r.getRange(d.$timelineFrame.currentFrame);return r.hasTween(a.startFrame)&&d.$tweenController.clearPointer().relocationPointer(),!0}activateElement(e){let t=this.target;const r=0|t.dataset.layerId,a=d.$currentWorkSpace().scene.getLayer(r);if(a.lock)return;this.pageX=e.pageX,this.pageY=e.pageY,d.$timelineLayer.clear();const s=a.getCharacter(0|t.dataset.characterId),i=d.$timelineFrame.currentFrame,n=s.getPlace(i);let o=-1;const l=[];if(d.$altKey&&!n.tweenFrame){const e=s.clone();for(const[t,r]of e._$places){let e=0;const s=a.getActiveCharacter(t);for(let r=0;r<s.length;++r)e=Math.max(s[r].getPlace(t).depth,e);r.depth=e+1}a.addCharacter(e),l.push(d.$screen.appendCharacter(e,i,a.id)),o=e.id}Promise.all(l).then((r=>{if(o>-1){const e=document.getElementById("stage-area");for(let t=0;t<r.length;++t){const a=r[t];a&&(e.appendChild(a.div),a.div.appendChild(a.canvas))}for(t=document.getElementById(`character-${o}`);d.$sleepCanvases.length;)d.$poolCanvas(d.$sleepCanvases.pop())}this.addElement(t),this.updateControllerProperty(),1===this._$activeElements.length&&s.showShapeColor(e),d.$transformController.show().relocation(),d.$gridController.show().relocation(),this.activeTimeline()}))}activeTimeline(){d.$timelineLayer.clear();const e=d.$timelineFrame.currentFrame,t=d.$ctrlKey;d.$ctrlKey=this._$activeElements.length>1;const r=d.$currentWorkSpace().scene;for(let t=0;t<this._$activeElements.length;++t){const a=0|this._$activeElements[t].dataset.layerId,s=document.getElementById(`layer-id-${a}`);d.$timelineLayer.targetLayers.has(s.id)||(d.$timelineLayer.targetLayer=s);const i=r.getLayer(a);d.$timelineLayer.addTargetFrame(i,e)}d.$ctrlKey=t}changeCharacter(e){if(1!==this._$activeElements.length)return;const t=d.$currentWorkSpace(),r=t.scene,a=this._$activeElements[0],s=0|a.dataset.layerId,i=r.getLayer(s),n=0|a.dataset.characterId,o=i.getCharacter(n);o.dispose();const l=o.getRange(d.$timelineFrame.currentFrame),c=o.split(i,l.startFrame,l.endFrame);i.addCharacter(c),c._$libraryId=0|e.target.value,c.dispose();const h=t.getLibrary(c._$libraryId);if(h.type===b.MOVIE_CLIP)for(const e of c._$places.values())e.loop=d.$getDefaultLoopConfig();document.getElementById("instance-type-name").getElementsByTagName("i")[0].setAttribute("class",`library-type-${h.type}`),d.$timelineLayer.activeCharacter(),c.hasTween(l.startFrame)&&d.$tweenController.clearPointer().relocationPointer(),this.reloadScreen(),d.$transformController.show().relocation()}startRect(e){this.pageX=e.pageX,this.pageY=e.pageY;const t=document.getElementById("stage-rect");t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,t.style.width="0px",t.style.height="0px",t.style.display=""}moveRect(e){const t=e.pageX,r=e.pageY,a=document.getElementById("stage-rect");this.pageX>t&&(a.style.left=`${t}px`),this.pageY>r&&(a.style.top=`${r}px`),a.style.width=`${Math.abs(t-this.pageX)}px`,a.style.height=`${Math.abs(r-this.pageY)}px`}endRect(){const e=document.getElementById("stage-rect");e.style.display="none";const t=parseFloat(e.style.width),r=parseFloat(e.style.height);if(!t||!r)return;const a=parseFloat(e.style.left),s=parseFloat(e.style.top),i=a+t,n=s+r,o=document.getElementById("stage-area").children;for(let e=0;e<o.length;++e){const t=o[e];switch(!0){case!t.dataset.child:case"tween"===t.dataset.child:case"true"===t.dataset.preview:case t.classList.contains("standard-point"):continue}const r=t.getBoundingClientRect();switch(!0){case r.bottom<s:case r.top>n:case r.right<a:case r.left>i:continue}const l=0|t.dataset.layerId;document.getElementById(`layer-lock-icon-${l}`).classList.contains("icon-active")||this.addElement(t,!0)}this._$activeElements.length&&(this.updateControllerProperty(),d.$transformController.show().relocation(),this.activeTimeline())}setReverse(){const e=+document.getElementById("transform-scale-x").value,t=document.getElementById("transform-scale-y").value;this._$xReverse=0>e,this._$yReverse=0>t}startPosition(e){this.pageX=e.pageX,this.pageY=e.pageY}moveGrid(e){d.$setCursor("move"),e.preventDefault();const t=(e.pageX-this.pageX)/d.$zoomScale,r=(e.pageY-this.pageY)/d.$zoomScale;let a=+document.getElementById("nine-slice-setting-x").value,s=+document.getElementById("nine-slice-setting-y").value,i=+document.getElementById("nine-slice-setting-w").value,n=+document.getElementById("nine-slice-setting-h").value;switch(this.target.id){case"grid-top-left":a+=t,i-=t,s+=r,n-=r;break;case"grid-top-right":i+=t,s+=r;break;case"grid-bottom-left":a+=t,i-=t,n+=r;break;case"grid-bottom-right":i+=t,n+=r}document.getElementById("nine-slice-setting-x").value=`${a}`,document.getElementById("nine-slice-setting-y").value=`${s}`,document.getElementById("nine-slice-setting-w").value=`${i}`,document.getElementById("nine-slice-setting-h").value=`${n}`,this.startPosition(e),d.$gridController.updateShapeGrid(a,s,i,n),this.reloadScreen()}moveTransform(e){d.$setCursor("move"),e.preventDefault(),this.save();let t=!1;switch(this.target.id){case"scale-top-left":{const r=this.updateLeftScaleX(e),a=this.updateTopScaleY(e);(r||a)&&(t=!0,d.$shiftKey&&this.adjustmentScale(r,a))}break;case"scale-center-left":this.updateLeftScaleX(e)&&(t=!0);break;case"scale-bottom-left":{const r=this.updateLeftScaleX(e),a=this.updateBottomScaleY(e);(r||a)&&(t=!0,d.$shiftKey&&this.adjustmentScale(r,a))}break;case"scale-center-bottom":this.updateBottomScaleY(e)&&(t=!0);break;case"scale-bottom-right":{const r=this.updateRightScaleX(e),a=this.updateBottomScaleY(e);(r||a)&&(t=!0,d.$shiftKey&&this.adjustmentScale(r,a))}break;case"scale-center-right":this.updateRightScaleX(e)&&(t=!0);break;case"scale-top-right":{const r=this.updateRightScaleX(e),a=this.updateTopScaleY(e);(r||a)&&(t=!0,d.$shiftKey&&this.adjustmentScale(r,a))}break;case"scale-center-top":this.updateTopScaleY(e)&&(t=!0);break;case"target-rotation":this.updateRotate(e)&&(t=!0);break;case"reference-point":this.updateReferencePoint(e);break;default:return}this.startPosition(e),t&&this.reloadScreen()}adjustmentScale(e=0,t=0){if(e!==t){if(e){const t=+document.getElementById("transform-scale-y").value;d.$transformController.updateScaleY((t+e)/100)}if(t){const e=+document.getElementById("transform-scale-x").value;d.$transformController.updateScaleX((e+t)/100)}}}updateTopScaleY(e){let t=this.pageY-e.pageY;if(!t)return 0;this._$yReverse&&(t*=-1);const r=+document.getElementById("transform-scale-y").value;return d.$transformController.updateScaleY((r+t)/100),t}updateRotate(e){const t=e.pageX-this.pageX;if(!t)return 0;let r=+document.getElementById("transform-rotate").value+t;return r=d.$clamp((0|r)%360,Be.MIN_ROTATE,Be.MAX_ROTATE),d.$transformController.updateRotate(r),1}updateReferencePoint(e){const t=(e.pageX-this.pageX)/d.$zoomScale,r=(e.pageY-this.pageY)/d.$zoomScale,a=d.$tools.getDefaultTool("arrow").activeElements,s=document.getElementById("reference-point");if(a.length>1){const e=d.$referenceController.pointer;e.x+=t,e.y+=r,d.$referenceController.setInputValue(e.x,e.y),s.style.left=`${s.offsetLeft+t}px`,s.style.top=`${s.offsetTop+r}px`}else{const e=a[0],i=0|e.dataset.layerId,n=d.$currentWorkSpace().scene.getLayer(i).getCharacter(0|e.dataset.characterId),o=d.$timelineFrame.currentFrame,l=n.getRange(o),c=n.getPlace(l.startFrame);if(!c.point){const e=n.getBounds();c.point={x:c.matrix[4]+Math.abs(e.xMax-e.xMin)/2,y:c.matrix[5]+Math.abs(e.yMax-e.yMin)/2}}c.point.x+=t,c.point.y+=r,d.$referenceController.setInputValue(c.point.x,c.point.y);const h=d.$offsetLeft+c.point.x*d.$zoomScale-s.offsetWidth/2,u=d.$offsetTop+c.point.y*d.$zoomScale-s.offsetHeight/2;s.setAttribute("style",`left: ${h}px; top: ${u}px;`),c.tweenFrame&&d.$tweenController.relocationPlace(n,l.startFrame)}}updateLeftScaleX(e){let t=this.pageX-e.pageX;if(!t)return 0;this._$xReverse&&(t*=-1);const r=+document.getElementById("transform-scale-x").value;return d.$transformController.updateScaleX((r+t)/100),t}updateBottomScaleY(e){let t=e.pageY-this.pageY;if(!t)return 0;this._$yReverse&&(t*=-1);const r=+document.getElementById("transform-scale-y").value;return d.$transformController.updateScaleY((r+t)/100),t}updateRightScaleX(e){let t=e.pageX-this.pageX;if(!t)return 0;this._$xReverse&&(t*=-1);const r=+document.getElementById("transform-scale-x").value;return d.$transformController.updateScaleX((r+t)/100),t}moveDisplayObject(e=null){this.save();const t=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame,a=e?e.pageX-this.pageX:this.pageX,s=e?e.pageY-this.pageY:this.pageY,i=d.$sceneChange.concatenatedMatrix,{Matrix:n}=next2d.geom,o=new n(i[0],i[1],i[2],i[3],i[4],i[5]);o.invert();let l=Number.MAX_VALUE,c=Number.MAX_VALUE;for(let e=0;e<this._$activeElements.length;++e){const n=this._$activeElements[e],h=document.getElementById(n.id);if(!h)continue;const u=0|h.dataset.layerId,m=t.getLayer(u),g=m.getCharacter(0|h.dataset.characterId);this.initPlace(g,u,r);const $=g.getPlace(r),p=a*o.a+s*o.c,f=a*o.b+s*o.d;$.matrix[4]+=p/d.$zoomScale,$.matrix[5]+=f/d.$zoomScale;const y=g.getBounds(i);$.point?($.point.x+=a/d.$zoomScale,$.point.y+=s/d.$zoomScale):$.point={x:d.$sceneChange.offsetX+y.xMin+Math.abs(y.xMax-y.xMin)/2,y:d.$sceneChange.offsetY+y.yMin+Math.abs(y.yMax-y.yMin)/2};let _=null;d.$sceneChange.matrix.length&&(_=d.$multiplicationMatrix(i,$.matrix));const b=g.getBounds(_);g.screenX=b.xMin,g.screenY=b.yMin;let v="position: absolute;";v+=`pointer-events: ${h.dataset.pointer};`;const I=[];if(null!==m.maskId){const e=t.getLayer(m.maskId);if(e.lock&&e._$characters.length){const t=d.$sceneChange.concatenatedMatrix,r=e._$characters[0];r.dispose(),I.push(r.draw(d.$getCanvas()).then((e=>{const a=r.getBounds(t),s=e.toDataURL(),i=e._$width*d.$zoomScale,n=e._$height*d.$zoomScale,o=(a.xMin-y.xMin)*d.$zoomScale,l=(a.yMin-y.yMin)*d.$zoomScale;v+=`mask: url(${s}), none;`,v+=`-webkit-mask: url(${s}), none;`,v+=`mask-size: ${i}px ${n}px;`,v+=`-webkit-mask-size: ${i}px ${n}px;`,v+="mask-repeat: no-repeat;",v+="-webkit-mask-repeat: no-repeat;",v+=`mask-position: ${o}px ${l}px;`,v+=`-webkit-mask-position: ${o}px ${l}px;`;const c=g._$canvas;v+=`mix-blend-mode: ${c.style.mixBlendMode};`,v+=`filter: ${c.style.filter};`})))}}Promise.all(I).then((()=>{const e=d.$offsetLeft+(d.$sceneChange.offsetX+y.xMin)*d.$zoomScale,t=d.$offsetTop+(d.$sceneChange.offsetY+y.yMin)*d.$zoomScale;v+=`left: ${e}px;`,v+=`top: ${t}px;`,h.setAttribute("style",v),l=Math.min(l,g.x),c=Math.min(c,g.y),g.relocationTween(r)}))}if(e&&(this.pageX=e.pageX,this.pageY=e.pageY),document.getElementById("object-x").value=+l.toFixed(2),document.getElementById("object-y").value=+c.toFixed(2),this._$activeElements.length>1){const e=d.$referenceController.pointer;e.x+=a,e.y+=s}d.$transformController.show().relocation(),d.$gridController.show().relocation();const h=document.getElementById("timeline-onion-skin");h&&h.classList.contains("onion-skin-active")&&this.reloadScreen()}initPlace(e,t,r){const a=d.$currentWorkSpace().scene.getLayer(t);let s=r;for(;s>0;){const t=a.getChildren(s);if(t&&"key-frame"===t.dataset.frameState){e._$places.has(s)||e.setPlace(s,e.getClonePlace(s));break}s--}}updateControllerProperty(){const e=d.$currentWorkSpace().scene;let t=null,r=Number.MAX_VALUE,a=Number.MAX_VALUE,s=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let l=0;l<this._$activeElements.length;++l){const c=this._$activeElements[l],d=0|c.dataset.layerId;t=e.getLayer(d).getCharacter(0|c.dataset.characterId),r=Math.min(r,t.x),a=Math.min(a,t.y);const h=t.getBounds();s=Math.min(s,h.xMin),i=Math.max(i,h.xMax),n=Math.min(n,h.yMin),o=Math.max(o,h.yMax)}const l=Math.abs(i-s),c=Math.abs(o-n);document.getElementById("object-width").value=""+ +l.toFixed(2),document.getElementById("object-height").value=""+ +c.toFixed(2),document.getElementById("object-x").value=""+ +r.toFixed(2),document.getElementById("object-y").value=""+ +a.toFixed(2),d.$controller.showObjectSetting(["object-area"]),d.$controller.hideObjectSetting(["stage-setting","fill-color-setting"]),this._$activeElements.length>1?(d.$controller.hideObjectSetting(["object-setting","color-setting","blend-setting","loop-setting","filter-setting","video-setting","instance-setting","text-setting","nine-slice-setting","sound-setting","ease-setting"]),d.$referenceController.pointer||d.$referenceController.resetPointer(),document.getElementById("transform-scale-x").value=100,document.getElementById("transform-scale-y").value=100,document.getElementById("transform-rotate").value=0):t.showController()}moveScene(){const e=document.getElementById("scene-name-menu-list").lastElementChild;e&&(d.$sceneChange.offsetX=+e.dataset.offsetX,d.$sceneChange.offsetY=+e.dataset.offsetY,d.$activeCharacterIds.pop(),d.$sceneChange.matrix.pop(),d.$sceneChange.execute(0|e.dataset.libraryId),e.remove())}}class te extends J{constructor(){super("arrow-transform"),this._$validity=!1}get validity(){return this._$validity}initialize(){const e=d.$tools.getDefaultTool("arrow");for(const t of e._$events.keys())t!==j.START&&t!==j.END&&this.addEventListener(t,(e=>{d.$tools.getDefaultTool("arrow").dispatchEvent(t,e)}));this.addEventListener(j.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent();const e=document.getElementById("target-rect");e&&e.setAttribute("class",""),d.$timelineLayer.activeCharacter(),this._$validity=!0,d.$transformController.show().relocation()})),this.addEventListener(j.END,(()=>{d.$tools.getDefaultTool("arrow").clearActiveElement(),d.$transformController.hide(),d.$gridController.hide(),d.$tweenController.clearPointer(),d.$controller.default(),this._$validity=!1}))}}class re extends J{constructor(){super("bucket")}initialize(){this.addEventListener(j.START,(()=>{this.setCursor(),this.changeNodeEvent()})),this.addEventListener(j.MOUSE_DOWN,(e=>{this.setCursor(),e.stopPropagation(),e.displayObject&&this.mouseDown(e)})),this.addEventListener(j.MOUSE_MOVE,(e=>{this.setCursor(),e.stopPropagation()})),this.addEventListener(j.MOUSE_UP,(e=>{this.setCursor(),e.stopPropagation(),d.$tools.reset()}))}setCursor(){const e=d.$intToRGB(0|`0x${document.getElementById("fill-color").value.slice(1)}`);d.$setCursor(`url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="rgb(${e.R},${e.G},${e.B})" d="M24 19.007c0-3.167-1.409-6.771-2.835-9.301l-.006-.01-.014-.026c-.732-1.392-1.914-3.052-3.619-4.757-2.976-2.976-5.476-3.912-6.785-3.913-.413 0-.708.094-.859.245l-.654.654c-1.898-.236-3.42.105-4.294.982-.876.875-1.164 2.159-.792 3.524.242.893.807 1.891 1.752 2.836.867.867 2.062 1.684 3.615 2.327.488-.839 1.654-1.019 2.359-.315.586.586.584 1.533-.002 2.119s-1.533.589-2.121 0c-.229-.229-.366-.515-.416-.812-1.646-.657-3.066-1.534-4.144-2.612-.728-.728-1.289-1.528-1.664-2.349l-2.835 2.832c-.445.447-.685 1.064-.686 1.82.001 1.635 1.122 3.915 3.714 6.506 2.764 2.764 5.58 4.243 7.431 4.243.649 0 1.181-.195 1.548-.562l8.086-8.079c.911.875-.777 3.541-.777 4.65 0 1.104.896 1.999 2 1.998 1.104 0 1.998-.895 1.998-2zm-18.912-12.974c-.236-.978-.05-1.845.554-2.444.526-.53 1.471-.791 2.656-.761l-3.21 3.205zm9.138 2.341l-.03-.029c-1.29-1.291-3.802-4.354-3.095-5.062.715-.715 3.488 1.521 5.062 3.095.862.863 2.088 2.248 2.938 3.459-1.718-1.073-3.493-1.469-4.875-1.463zm-3.875 12.348c-.547-.082-1.5-.547-1.9-.928l7.086-7.086c.351.37 1.264.931 1.753 1.075l-6.939 6.939z"/></svg>'),auto`)}mouseDown(e){const t=e.target;if(t.dataset.instanceType===b.SHAPE){const{Graphics:e}=window.next2d.display,r=d.$currentWorkSpace();r.temporarilySaved();const a=r.getLibrary(0|t.dataset.libraryId),s=d.$intToRGB(0|`0x${document.getElementById("fill-color").value.slice(1)}`);switch(a._$recodes[a._$recodes.length-1]){case e.END_FILL:a._$recodes.splice(a._$recodes.length-6,6,e.FILL_STYLE,s.R,s.G,s.B,255,e.END_FILL);break;case e.END_STROKE:a._$recodes.push(e.FILL_STYLE,s.R,s.G,s.B,255,e.END_FILL)}a.cacheClear(),this.reloadScreen()}}}class ae extends Q{constructor(){super("circle")}createCharacter(e="circle"){return super.createCharacter(e)}}class se extends J{constructor(){super("hand")}initialize(){this.setCursor("grab"),this.addEventListener(j.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(!1)})),this.addEventListener(j.MOUSE_MOVE,(e=>{if(d.$setCursor(this._$cursor),!this.active)return;const t=document.getElementById("screen");t.scrollLeft+=this.pageX-e.pageX,t.scrollTop+=this.pageY-e.pageY,this.pageX=e.pageX,this.pageY=e.pageY})),this.addEventListener(j.MOUSE_UP,(()=>{this.active=!1,this.setCursor("grab"),d.$setCursor(this._$cursor)})),this.addEventListener(j.MOUSE_DOWN,(e=>{this.active=!0,this.setCursor("grabbing"),d.$setCursor(this._$cursor),this.pageX=e.pageX,this.pageY=e.pageY}))}}class ie extends J{constructor(){super("pen")}initialize(){this.addEventListener(j.START,(()=>{this.setCursor(),this.changeNodeEvent(!1)})),this.addEventListener(j.MOUSE_DOWN,(e=>{this.setCursor(),e.stopPropagation(),this.clearPenPointer();let t=e.offsetX,r=e.offsetY;"stage-area"!==e.target.id&&(t+=e.target.offsetLeft,r+=e.target.offsetTop),this.offsetX=t,this.offsetY=r})),this.addEventListener(j.MOUSE_MOVE,(e=>{this.setCursor(),e.stopPropagation(),e.screen&&this.active&&this.mouseMove(e)})),this.addEventListener(j.MOUSE_UP,(e=>{this.setCursor(),e.stopPropagation(),this.mouseUp()}))}clearPenPointer(){const e=document.getElementById("stage-area");for(let t=0;e.children.length>t;++t){const r=e.children[t];r.dataset.penPointer&&(r.remove(),--t)}}setCursor(){const e=d.$intToRGB(0|`0x${document.getElementById("stroke-color").value.slice(1)}`);d.$setCursor(`url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24"><path fill="rgb(${e.R},${e.G},${e.B})" d="M1.438 16.875l5.688 5.689-7.126 1.436 1.438-7.125zm22.562-11.186l-15.46 15.46-5.688-5.689 15.459-15.46 5.689 5.689zm-4.839-2.017l-.849-.849-12.614 12.599.85.849 12.613-12.599z"/></svg>') 0 12, auto`)}mouseMove(e){const t=0|document.getElementById("stroke-size").value;if(t){e.preventDefault();let r=e.offsetX,a=e.offsetY;"stage-area"!==e.target.id&&(r+=e.target.offsetLeft,a+=e.target.offsetTop);const s=document.getElementById("stage-area"),i=document.createElement("div");i.dataset.penPointer="true",i.classList.add("pen-pointer"),i.style.width=`${t}px`,i.style.height=`${t}px`,i.style.left=`${r}px`,i.style.top=`${a}px`,i.style.backgroundColor=document.getElementById("stroke-color").value,i.style.borderRadius=t/2+"px",s.appendChild(i)}}mouseUp(){d.$timelineLayer.attachLayer();const{Shape:e}=window.next2d.display,t=0|document.getElementById("stroke-size").value,r=new e;r.graphics.lineStyle(t,document.getElementById("stroke-color").value);const a=this.offsetX-d.$offsetLeft,s=this.offsetY-d.$offsetTop;r.graphics.moveTo(0,0);const i=document.getElementById("stage-area").children;for(let e=0;i.length>e;++e){const t=i[e];t.dataset.penPointer&&(r.graphics.lineTo((t.offsetLeft-d.$offsetLeft-a)/d.$zoomScale,(t.offsetTop-d.$offsetTop-s)/d.$zoomScale),t.remove(),--e)}r.graphics.endLine();const n=d.$currentWorkSpace().nextLibraryId,o=(a+t)/2/d.$zoomScale,l=(s+t)/2/d.$zoomScale;this.createShape({id:n,type:b.SHAPE,name:`Shape_${n}`,symbol:"",recodes:r.graphics._$recode.slice(0),bounds:{xMin:r.graphics._$xMin,xMax:r.graphics._$xMax,yMin:r.graphics._$yMin,yMax:r.graphics._$yMax}},o,l),this.reloadScreen(),d.$tools.reset()}}class ne extends Q{constructor(){super("rectangle")}createCharacter(e="rectangle"){return super.createCharacter(e)}}class oe extends Q{constructor(){super("round-rect")}createCharacter(e="round-rect"){return super.createCharacter(e)}}class le extends J{constructor(){super("text")}initialize(){this.addEventListener(j.START,(()=>{d.$setCursor("text"),this.changeNodeEvent(!1)})),this.addEventListener(j.MOUSE_DOWN,(e=>{d.$setCursor("text"),e.stopPropagation(),e.screen&&this.mouseDown(e)})),this.addEventListener(j.MOUSE_MOVE,(e=>{d.$setCursor("text"),e.stopPropagation(),e.screen&&this.mouseMove(e)})),this.addEventListener(j.MOUSE_UP,(e=>{d.$setCursor("text"),e.screen&&(e.stopPropagation(),this.mouseUp(),d.$tools.reset())}))}mouseDown(e){let t=e.offsetX,r=e.offsetY;"stage-area"!==e.target.id&&(t+=e.target.offsetLeft,r+=e.target.offsetTop),this.pageX=e.pageX,this.pageY=e.pageY,this.offsetX=t,this.offsetY=r;const a=document.getElementById("draw-text");a.style.left=`${e.pageX}px`,a.style.top=`${e.pageY}px`,a.style.width="0px",a.style.height="0px",a.style.display="",a.style.border="1px dashed gray"}mouseMove(e){e.preventDefault();const t=e.pageX,r=e.pageY,a=document.getElementById("draw-text");this.pageX>t&&(this.offsetX=e.offsetX,a.style.left=`${t}px`),this.pageY>r&&(this.offsetY=e.offsetY,a.style.top=`${r}px`),a.style.width=`${Math.abs(t-this.pageX)}px`,a.style.height=`${Math.abs(r-this.pageY)}px`}mouseUp(){d.$timelineLayer.attachLayer();const e=document.getElementById("draw-text"),t=d.$currentWorkSpace();t.temporarilySaved();const r=(this.offsetX-d.$offsetLeft)/d.$zoomScale,a=(this.offsetY-d.$offsetTop)/d.$zoomScale,s=parseFloat(e.style.width)/d.$zoomScale,i=parseFloat(e.style.height)/d.$zoomScale,n=t.nextLibraryId;this.createTextField({id:n,type:b.TEXT,name:`Text_${n}`,symbol:"",bounds:{xMin:0,xMax:s,yMin:0,yMax:i},originBounds:{xMin:0,xMax:s,yMin:0,yMax:i}},r,a),this.reloadScreen(),e.style.display="none"}}class ce extends J{constructor(){super("transform"),this._$element=null,this._$deletePointer=null}initialize(){this.setCursor('url(\'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 48 48"><path fill="white" d="M27.8,39.7c-0.1,0-0.2,0-0.4-0.1c-0.2-0.1-0.4-0.3-0.6-0.5l-3.7-8.6l-4.5,4.2C18.5,34.9,18.3,35,18,35c-0.1,0-0.3,0-0.4-0.1C17.3,34.8,17,34.4,17,34l0-22c0-0.4,0.2-0.8,0.6-0.9C17.7,11,17.9,11,18,11c0.2,0,0.5,0.1,0.7,0.3l16,15c0.3,0.3,0.4,0.7,0.3,1.1c-0.1,0.4-0.5,0.6-0.9,0.7l-6.3,0.6l3.9,8.5c0.1,0.2,0.1,0.5,0,0.8c-0.1,0.2-0.3,0.5-0.5,0.6l-2.9,1.3C28.1,39.7,27.9,39.7,27.8,39.7z"/><path fill="black" d="M18,12l16,15l-7.7,0.7l4.5,9.8l-2.9,1.3l-4.3-9.9L18,34L18,12 M18,10c-0.3,0-0.5,0.1-0.8,0.2c-0.7,0.3-1.2,1-1.2,1.8l0,22c0,0.8,0.5,1.5,1.2,1.8C17.5,36,17.8,36,18,36c0.5,0,1-0.2,1.4-0.5l3.4-3.2l3.1,7.3c0.2,0.5,0.6,0.9,1.1,1.1c0.2,0.1,0.5,0.1,0.7,0.1c0.3,0,0.5-0.1,0.8-0.2l2.9-1.3c0.5-0.2,0.9-0.6,1.1-1.1c0.2-0.5,0.2-1.1,0-1.5l-3.3-7.2l4.9-0.4c0.8-0.1,1.5-0.6,1.7-1.3c0.3-0.7,0.1-1.6-0.5-2.1l-16-15C19,10.2,18.5,10,18,10L18,10z"/></svg>\') 6 6,auto'),this.addEventListener(j.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(),this._$deletePointer=this.deletePointer.bind(this),window.addEventListener("keydown",this._$deletePointer)})),this.addEventListener(j.END,(()=>{window.removeEventListener("keydown",this._$deletePointer)})),this.addEventListener(j.MOUSE_DOWN,(e=>{switch(!0){case e.displayObject:this._$element=null,this.mouseDownForDisplayObject();break;case e.shapePointer:this.mouseDownForPointer(e);break;default:this._$element=null}})),this.addEventListener(j.DBL_CLICK,(e=>{switch(d.$setCursor(this._$cursor),e.stopPropagation(),!0){case e.shapePointer:this.addCurvePointer(e);break;case e.screen:this.addPointer(e)}})),this.addEventListener(j.MOUSE_UP,(e=>{d.$setCursor(this._$cursor),e.stopPropagation()})),this.addEventListener(j.MOUSE_MOVE,(e=>{d.$setCursor(this._$cursor),this.active&&(e.stopPropagation(),this.movePointer(e))}))}addPointer(e){this.clearActivePointer();const t=d.$timelineFrame.currentFrame;let r=null,a=Number.MAX_VALUE;const s=document.getElementById("stage-area").children,i=d.$currentWorkSpace(),n=i.scene;let o=e.offsetX,l=e.offsetY;if("stage-area"!==e.target.id){const t=0|e.target.dataset.layerId,r=0|e.target.dataset.characterId,a=n.getLayer(t).getCharacter(r);o=a.screenX+d.$offsetLeft+e.offsetX,l=a.screenY+d.$offsetTop+e.offsetY}for(let e=0;e<s.length;++e){const t=s[e];if(!t.dataset.shapePointer)continue;if("true"===t.dataset.curve)continue;const i=Math.sqrt(Math.pow(t.offsetLeft-o,2)+Math.pow(t.offsetTop-l,2));a>i&&(r=t),a=Math.min(a,i)}if(!r)return;const c=i.getLibrary(0|r.dataset.libraryId);if(!c)return;const h=[],u=0|r.dataset.position;for(let e=u+1;e<s.length;++e){const t=s[e];if("true"!==t.dataset.curve){h.push(t);break}}if(!h.length)for(let e=0;e<s.length;++e){const t=s[e];if(t.dataset.shapePointer&&"true"!==t.dataset.curve){h.push(t);break}}for(let e=u-1;;--e){const t=s[e];if(!t.dataset.shapePointer)break;if("true"!==t.dataset.curve){h.push(t);break}}if(1===h.length)for(let e=s.length-1;;--e){const t=s[e];if(!t.dataset.shapePointer)break;if("true"!==t.dataset.curve){h.push(t);break}}let m=null;a=Number.MAX_VALUE;for(let e=0;e<h.length;++e){const t=h[e],r=Math.sqrt(Math.pow(t.offsetLeft-o,2)+Math.pow(t.offsetTop-l,2));a>r&&(m=t),a=Math.min(a,r)}const{Graphics:g}=window.next2d.display,$=0|r.dataset.layerId,p=0|r.dataset.characterId,f=n.getLayer($).getCharacter(p),y=f.getPlace(t).matrix,_=Math.sqrt(y[0]*y[0]+y[1]*y[1]),b=Math.sqrt(y[2]*y[2]+y[3]*y[3]),v=0|r.dataset.index,I=0|m.dataset.index;I>v?c._$recodes.splice(v+2,0,g.LINE_TO,(o-d.$offsetLeft-f.screenX+c._$bounds.xMin)/_,(l-d.$offsetTop-f.screenY+c._$bounds.yMin)/b):c._$recodes.splice(I+2,0,g.LINE_TO,(o-d.$offsetLeft-f.screenX+c._$bounds.xMin)/_,(l-d.$offsetTop-f.screenY+c._$bounds.yMin)/b);for(let e=0;e<s.length;++e){const t=s[e];t.dataset.shapePointer&&("true"!==t.dataset.curve&&(t.remove(),--e))}const E=c.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);if(c._$bounds.xMin=E.xMin,c._$bounds.xMax=E.xMax,c._$bounds.yMin=E.yMin,c._$bounds.yMax=E.yMax,c.cacheClear(),n.changeFrame(t),f){const e=f.getPlace(t).matrix;c.createPointer(e,$,p)}}addCurvePointer(e){this.clearActivePointer();const{Graphics:t}=window.next2d.display,r=d.$currentWorkSpace(),a=e.target;if(!("true"===a.dataset.curve)){const s=0|a.dataset.type,i=0|a.dataset.index,n=0|a.dataset.layerId,o=0|a.dataset.characterId,l=r.getLibrary(0|a.dataset.libraryId);switch(s){case t.LINE_TO:{r.temporarilySaved(),l._$recodes[i-1]=t.CURVE_TO;const a=l._$recodes[i],s=l._$recodes[i+1];l._$recodes.splice(i+2,0,a,s),l._$recodes[i]+=20,l._$recodes[i+1]+=20,l.cacheClear();const c=d.$timelineFrame.currentFrame;r.scene.changeFrame(c),l.createPointer(e.matrix,n,o)}break;case t.CURVE_TO:{r.temporarilySaved(),l._$recodes[i-3]=t.CUBIC;const a=l._$recodes[i],s=l._$recodes[i+1];l._$recodes.splice(i+2,0,a,s),l._$recodes[i]+=20,l._$recodes[i+1]+=20,l.cacheClear();const c=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(c),l.createPointer(e.matrix,n,o)}}}}clearActivePointer(){const{Graphics:e}=window.next2d.display,t=document.getElementById("stage-area"),r=this._$element;if(r){r.style.backgroundColor="";const a=0|r.dataset.position,s=0|r.dataset.type,i="true"===r.dataset.curve;switch(s){case e.CURVE_TO:i?t.children[a+1].style.backgroundColor="":t.children[a-1].style.backgroundColor="";break;case e.CUBIC:if(i)for(let e=1;e<3;++e){const r=t.children[a+e];if(r.style.backgroundColor="","true"!==r.dataset.curve){1===e&&(t.children[a-1].style.backgroundColor="");break}}else t.children[a-1].style.backgroundColor="",t.children[a-2].style.backgroundColor=""}}}mouseDownForPointer(e){d.$currentWorkSpace().temporarilySaved();const{Graphics:t}=window.next2d.display,r=document.getElementById("stage-area");this.clearActivePointer();const a=this.target;this._$element=a,this.pageX=e.pageX-a.offsetLeft,this.pageY=e.pageY-a.offsetTop;const s=this.target;s.style.backgroundColor=d.$shapePointerColor;const i=0|s.dataset.position,n=0|s.dataset.type,o="true"===s.dataset.curve;switch(n){case t.CURVE_TO:o?r.children[i+1].style.backgroundColor=d.$shapeLinkedPointerColor:r.children[i-1].style.backgroundColor=d.$shapeLinkedPointerColor;break;case t.CUBIC:if(o)for(let e=1;e<3;++e){const t=r.children[i+e];if(t.style.backgroundColor=d.$shapeLinkedPointerColor,"true"!==t.dataset.curve){1===e&&(r.children[i-1].style.backgroundColor=d.$shapeLinkedPointerColor);break}}else r.children[i-1].style.backgroundColor=d.$shapeLinkedPointerColor,r.children[i-2].style.backgroundColor=d.$shapeLinkedPointerColor}}mouseDownForDisplayObject(){const e=this.target;if(e.dataset.instanceType!==b.SHAPE)return;d.$tools.getDefaultTool("arrow").clear();const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace(),a=0|e.dataset.layerId,s=0|e.dataset.characterId,i=r.scene.getLayer(a).getCharacter(s),n=r.getLibrary(0|e.dataset.libraryId),o=i.getPlace(t).matrix;n.createPointer(o,a,s)}movePointer(e){const t=this.target;if("true"!==t.dataset.shapePointer)return;const r=d.$currentWorkSpace(),a=r.getLibrary(0|t.dataset.libraryId);if(!a)return void d.$clearShapePointer();e.preventDefault();const s=d.$timelineFrame.currentFrame,i=0|t.dataset.layerId,n=0|t.dataset.characterId,o=r.scene,l=o.getLayer(i).getCharacter(n).getPlace(s).matrix,c=e.pageX-this.pageX,h=e.pageY-this.pageY,{Matrix:u}=window.next2d.geom,m=new u(l[0],l[1],l[2],l[3],l[4],l[5]);m.invert();const g=c-t.offsetLeft,$=h-t.offsetTop,p=g*m.a+$*m.c,f=g*m.b+$*m.d,y=0|t.dataset.index;a._$recodes[y]+=p/d.$zoomScale,a._$recodes[y+1]+=f/d.$zoomScale;const _=0|t.dataset.syncId;_&&(a._$recodes[_]+=p/d.$zoomScale,a._$recodes[_+1]+=f/d.$zoomScale),t.style.left=`${c}px`,t.style.top=`${h}px`;const b=a.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);a._$bounds.xMin=b.xMin,a._$bounds.xMax=b.xMax,a._$bounds.yMin=b.yMin,a._$bounds.yMax=b.yMax,a.cacheClear(),o.changeFrame(s)}deletePointer(e){if(d.$setCursor(this._$cursor),d.$keyLock||"Backspace"!==e.key)return;e.stopPropagation();let t=0;const r=document.getElementById("stage-area").children;for(let e=0;r.length>e;++e){const a=r[e];a.dataset.shapePointer&&("false"===a.dataset.curve&&t++)}const a=this._$element;if(!a)return;const s="true"===a.dataset.curve;if(!a.dataset.syncId&&(t>2||s)){const e=d.$currentWorkSpace();e.temporarilySaved();const{Graphics:t}=window.next2d.display,r=e.getLibrary(0|a.dataset.libraryId),i=0|a.dataset.index;switch(0|a.dataset.type){case t.MOVE_TO:break;case t.LINE_TO:r._$recodes.splice(i-1,3);break;case t.CUBIC:{let e=i;for(;r._$recodes[--e]!==t.CUBIC;);s?(r._$recodes[e]=t.CURVE_TO,r._$recodes.splice(i,2)):r._$recodes.splice(e,7)}break;case t.CURVE_TO:{let e=i;for(;r._$recodes[--e]!==t.CURVE_TO;);s?(r._$recodes[e]=t.LINE_TO,r._$recodes.splice(i,2)):r._$recodes.splice(e,5)}}const n=r.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);r._$bounds.xMin=n.xMin,r._$bounds.xMax=n.xMax,r._$bounds.yMin=n.yMin,r._$bounds.yMax=n.yMax,r.cacheClear();const o=d.$timelineFrame.currentFrame,l=e.scene;l.changeFrame(o);const c=0|a.dataset.layerId,h=0|a.dataset.characterId,u=l.getLayer(c).getCharacter(h);if(u){const e=u.getPlace(o).matrix;r.createPointer(e,c,h)}}}}class de extends J{constructor(){super("zoom")}initialize(){this.setCursor('url(\'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><path d="M13 10h-3v3h-2v-3h-3v-2h3v-3h2v3h3v2zm8.172 14l-7.387-7.387c-1.388.874-3.024 1.387-4.785 1.387-4.971 0-9-4.029-9-9s4.029-9 9-9 9 4.029 9 9c0 1.761-.514 3.398-1.387 4.785l7.387 7.387-2.828 2.828zm-12.172-8c3.859 0 7-3.14 7-7s-3.141-7-7-7-7 3.14-7 7 3.141 7 7 7z"/></svg>\') 6 6,auto'),this.addEventListener(j.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(!1)})),this.addEventListener(j.MOUSE_DOWN,(e=>{this.startRect(e)})),this.addEventListener(j.MOUSE_MOVE,(e=>{this.moveRect(e)})),this.addEventListener(j.MOUSE_UP,(()=>{this.execute()}))}startRect(e){this.active=!0,d.$setCursor(this._$cursor),this.pageX=e.pageX,this.pageY=e.pageY;const t=document.getElementById("stage-rect");t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,t.style.width="0px",t.style.height="0px",t.style.display=""}moveRect(e){if(d.$setCursor(this._$cursor),!this.active)return;const t=e.pageX,r=e.pageY,a=document.getElementById("stage-rect");this.pageX>t&&(a.style.left=`${t}px`),this.pageY>r&&(a.style.top=`${r}px`),a.style.width=`${Math.abs(t-this.pageX)}px`,a.style.height=`${Math.abs(r-this.pageY)}px`}execute(){this.active=!1,d.$setCursor(this._$cursor);const e=document.getElementById("stage-rect");if(!e)return;const t=e.offsetLeft,r=e.offsetTop;e.style.display="none";const a=parseFloat(e.style.width),s=parseFloat(e.style.height);if(!a||!s)return;const i=d.$currentWorkSpace(),n=Math.max(i.stage.width/a,i.stage.height/s,d.$zoomScale),o=document.getElementById("screen"),l=t-o.offsetLeft+a/2,c=r-o.offsetTop+s/2;o.scrollLeft-=o.clientWidth/2-l,o.scrollTop-=o.clientHeight/2-c,d.$screenZoom.execute(n-d.$zoomScale),d.$tools.activeTool&&d.$tools.activeTool.dispatchEvent(j.END);const h=d.$tools.getDefaultTool("zoom");h.dispatchEvent(j.START),d.$tools.activeTool=h}}class he{constructor(e=""){this._$name=e,this._$saved=!1,this._$pointX=0,this._$pointY=0,this._$focus=!1,this._$currentValue=null,this._$currentTarget=null,this._$lockTarget=null,this._$mouseMove=null,this._$mouseUp=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){if(this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),this.name){const e=document.getElementById(`${this.name}-setting-title`);e&&e.addEventListener("mousedown",(()=>{this.clickTitle()}))}d.$initializeEnd()}focusIn(e){this._$focus=!0,this._$currentValue=+e.target.value,d.$keyLock=!0}focusOut(){this._$focus=!1,this._$currentValue=null,this._$currentTarget=null,this._$lockTarget=null,d.$keyLock=!1}mouseOut(e){e.stopPropagation(),!this._$focus&&this._$currentTarget||(d.$setCursor("auto"),e.target.style.cursor="")}mouseDown(e){this._$focus||(e.preventDefault(),this._$saved=!1,this._$pointX=e.screenX,this._$currentTarget=e.target,this._$currentValue=+e.target.value,d.$setCursor("ew-resize"),this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto"),this._$currentTarget&&(this._$currentTarget.style.cursor="",this._$currentTarget.focus())}mouseMove(e,t=!0){!this._$focus&&this._$currentTarget&&window.requestAnimationFrame((()=>{if(this._$focus||!this._$currentTarget)return;e.preventDefault(),d.$setCursor("ew-resize");const r=e.screenX-this._$pointX;let a=+this._$currentTarget.value;isNaN(a)&&(a=0),this._$currentTarget.value=this.executeFunction(this._$currentTarget.id,a+r),this._$currentValue=+this._$currentTarget.value,this._$lockTarget&&(this._$lockTarget.value=this.executeFunction(this._$lockTarget.id,+this._$lockTarget.value+r)),this._$pointX=e.screenX,t&&this.reloadScreen()}))}reloadScreen(){const e=d.$currentWorkSpace();if(!e)return;const t=e.scene;t&&t.changeFrame(d.$timelineFrame.currentFrame)}mouseOver(e){switch(e.stopPropagation(),!0){case this._$focus:case null!==this._$currentTarget:case null!==this._$currentValue:return;default:d.$setCursor("ew-resize"),e.target.style.cursor="ew-resize"}}clickTitle(){const e=document.getElementById(`${this.name}-setting-view-area`),t=document.getElementById(`${this.name}-setting-title`).getElementsByTagName("i")[0];"none"===e.style.display?(e.style.display="",t.setAttribute("class","active")):(e.style.display="none",t.setAttribute("class","disable"))}executeFunction(e,t){this.save();const r=e.split("-");let a=r.map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("");return`change${a}`in this||(r.pop(),a=r.map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")),this[`change${a}`](t)}finishInput(e,t=!0){if("Enter"!==e.key){if("focusout"===e.type){this._$currentTarget=e.target;const r=this.executeFunction(e.target.id,e.target.value);this._$lockTarget&&(this._$lockTarget.value=this.executeFunction(this._$lockTarget.id,+this._$lockTarget.value+r-this._$currentValue)),e.target.value=r,this._$currentValue=r,this.focusOut(),t&&this.reloadScreen()}}else e.currentTarget.blur()}save(){if(this._$saved)return;this._$saved=!0;const e=d.$currentWorkSpace();e&&e.temporarilySaved()}setChangeEvent(e){e&&e.addEventListener("change",(e=>{this._$currentTarget=e.target,this.executeFunction(e.target.id,e.target.value),this._$currentTarget=null,this.reloadScreen()}))}setInputEvent(e){e&&(e.addEventListener("mouseover",(e=>{this.mouseOver(e)})),e.addEventListener("mouseout",(e=>{this.mouseOut(e)})),e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})),e.addEventListener("focusout",(e=>{this.finishInput(e)})),e.addEventListener("keypress",(e=>{this.finishInput(e)})))}setClickEvent(e){e&&e.addEventListener("click",(e=>{this._$currentTarget=e.target,this.executeFunction(e.target.id,e.target.value),this._$currentTarget=null,this.reloadScreen()}))}get name(){return this._$name}}class ue extends he{constructor(e){super(e),this._$currentPointer=null,this._$drawGradientContext=null,this._$mouseMoveGradientColorPointer=null,this._$mouseUpGradientColorPointer=null}static get GRADIENT_CANVAS_WIDTH(){return 255}static get GRADIENT_CANVAS_HEIGHT(){return 30}static get MIN_GRADIENT_POINTER(){return 0}static get MAX_GRADIENT_POINTER(){return 255}initialize(){super.initialize();const e=document.createElement("canvas");e.width=ue.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,e.height=ue.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,this._$drawGradientContext=e.getContext("2d")}changeGradientColor(e){if(!this._$currentTarget)return e;const t=0|this._$currentTarget.dataset.filterId;if(!this._$filters.has(t))return e;if(this._$currentPointer){const r=this._$filters.get(t).filter,a=0|this._$currentPointer.dataset.index;r._$colors[a]=0|`0x${e.slice(1)}`,this._$currentPointer.dataset.color=e,this._$currentPointer.getElementsByTagName("i")[0].style.backgroundColor=e,this.updateFilterGradientCanvas(r),this.disposeCharacterImage(),this.reloadScreen()}return e}changeGradientAlpha(e){if(e=d.$clamp(+e,we.MIN_ALPHA,we.MAX_ALPHA),!this._$currentTarget)return e;const t=0|this._$currentTarget.dataset.filterId;if(!this._$filters.has(t))return e;if(this._$currentPointer){const r=this._$filters.get(t).filter,a=0|this._$currentPointer.dataset.index;r._$alphas[a]=e,this._$currentPointer.dataset.alpha=e,this.updateFilterGradientCanvas(r),this.disposeCharacterImage(),this.reloadScreen()}return e}addGradientGlowFilter(e=null,t=!0){const r=document.getElementById("filter-setting-list");if(!r)return;const a=this.createFilter(P,e);e||(e=this._$filters.get(a).filter);const s=`\n${xe.createHeaderHTML(a,"GradientGlow")}\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                ${xe.createBlurX(a,e.blurX)}\n                ${xe.createStrength(a,e.strength)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createBlurY(a,e.blurY)}\n                ${xe.createAngle(a,e.angle)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createDistance(a,e.distance)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createGradientColorPalette(a)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createGradientColor(a)}\n                ${xe.createGradientAlpha(a)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createKnockout(a)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createBevelType(a)}\n                ${xe.createQuality(a)}\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;r.insertAdjacentHTML("beforeend",s);const i=document.getElementById(`gradient-canvas-${a}`);i.width=we.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,i.height=we.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,i.style.width=`${we.GRADIENT_CANVAS_WIDTH}px`,i.style.height=`${we.GRADIENT_CANVAS_HEIGHT}px`,e.context=i.getContext("2d"),this.setCommonEvent(a),e.knockout&&(document.getElementById(`knockout-${a}`).checked=!0);const n=[`blurX-${a}`,`blurY-${a}`,`strength-${a}`,`angle-${a}`,`gradientAlpha-${a}`,`distance-${a}`];for(let e=0;e<n.length;++e)this.setInputEvent(document.getElementById(n[e]));const o=[`knockout-${a}`];for(let e=0;e<o.length;++e)this.setClickEvent(document.getElementById(o[e]));const l=[`gradientColor-${a}`,`type-${a}`,`quality-${a}`];for(let e=0;e<l.length;++e)this.setChangeEvent(document.getElementById(l[e]));for(let t=0;t<e.ratios.length;++t){const r=e.ratios[t],s=`#${e.colors[t].toString(16).padStart(6,"0")}`,i=e.alphas[t];this.addFilterGradientColorPointer(a,t,r,s,i)}this.setCreateGradientColorPointerEvent(a),this.updateFilterGradientCanvas(e),t&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}addGradientBevelFilter(e=null,t=!0){const r=document.getElementById("filter-setting-list");if(!r)return;const a=this.createFilter(B,e);e||(e=this._$filters.get(a).filter);const s=`\n${xe.createHeaderHTML(a,"GradientBevel")}\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                ${xe.createBlurX(a,e.blurX)}\n                ${xe.createStrength(a,e.strength)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createBlurY(a,e.blurY)}\n                ${xe.createAngle(a,e.angle)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createDistance(a,e.distance)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createGradientColorPalette(a)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createGradientColor(a)}\n                ${xe.createGradientAlpha(a)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createKnockout(a)}\n            </div>\n\n            <div class="filter-container">                \n                ${xe.createBevelType(a)}\n                ${xe.createQuality(a)}\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;r.insertAdjacentHTML("beforeend",s);const i=document.getElementById(`gradient-canvas-${a}`);i.width=ue.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,i.height=ue.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,i.style.width=`${ue.GRADIENT_CANVAS_WIDTH}px`,i.style.height=`${ue.GRADIENT_CANVAS_HEIGHT}px`,e.context=i.getContext("2d"),this.setCommonEvent(a),e.knockout&&(document.getElementById(`knockout-${a}`).checked=!0);const n=[`blurX-${a}`,`blurY-${a}`,`strength-${a}`,`angle-${a}`,`gradientAlpha-${a}`,`distance-${a}`];for(let e=0;e<n.length;++e)this.setInputEvent(document.getElementById(n[e]));const o=[`knockout-${a}`];for(let e=0;e<o.length;++e)this.setClickEvent(document.getElementById(o[e]));const l=[`gradientColor-${a}`,`type-${a}`,`quality-${a}`];for(let e=0;e<l.length;++e)this.setChangeEvent(document.getElementById(l[e]));for(let t=0;t<e.ratios.length;++t){const r=e.ratios[t],s=`#${e.colors[t].toString(16).padStart(6,"0")}`,i=e.alphas[t];this.addFilterGradientColorPointer(a,t,r,s,i)}this.setCreateGradientColorPointerEvent(a),this.updateFilterGradientCanvas(e),t&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}addGradientColorPointer(e){const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;const r=this._$filters.get(t).filter,a=r.ratios.length,s=e.offsetX,i=document.getElementById(`gradientColor-${t}`).value,n=0|document.getElementById(`gradientAlpha-${t}`).value;r.ratios.push(s),r.colors.push(0|`0x${i.slice(1)}`),r.alphas.push(n),this.addFilterGradientColorPointer(t,a,s,i,n),this.updateFilterGradientCanvas(r),this.disposeCharacterImage(),this.reloadScreen()}setCreateGradientColorPointerEvent(e){const t=document.getElementById(`color-pointer-list-${e}`);t&&t.addEventListener("mousedown",(e=>{this.addGradientColorPointer(e)}))}updateFilterGradientCanvas(e){const t=this._$drawGradientContext;t.clearRect(0,0,ue.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,ue.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio);const r=e.adjustment();t.beginPath();const a=r.ratios.length,s=Math.ceil(255*r.ratios[a-1]*window.devicePixelRatio),i=t.createLinearGradient(0,0,s,0);for(let e=0;e<a;++e){const t=d.$intToRGB(r.colors[e]);i.addColorStop(r.ratios[e],`rgba(${t.R}, ${t.G}, ${t.B}, ${r.alphas[e]})`)}t.fillStyle=i,t.rect(0,0,ue.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,ue.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),t.fill(),e.context.clearRect(0,0,ue.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,ue.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.context.drawImage(t.canvas,0,0)}addFilterGradientColorPointer(e,t,r,a,s){const i=document.getElementById(`color-pointer-list-${e}`),n=`\n<div class="color-pointer" style="left: ${r-4}px;" data-filter-id="${e}" data-index="${t}" data-color="${a}" data-alpha="${s}">\n    <div class="color-pointer-triangle"></div>\n    <div class="color-pointer-rect">\n        <i class="pointer-color" style="background-color: ${a}"></i>\n    </div>\n</div>\n`;i.insertAdjacentHTML("beforeend",n);const o=i.lastElementChild;o.addEventListener("mousedown",(e=>{this.mouseDownGradientColorPointer(e)})),t&&o.addEventListener("dblclick",(e=>{this.removeGradientColorPointer(e)})),this._$currentPointer=o}removeGradientColorPointer(e){const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;const r=document.getElementById(`color-pointer-list-${t}`);if(2>=r.children.length)return;const a=0|e.target.dataset.index,s=this._$filters.get(t).filter;s.ratios.splice(a,1),s.colors.splice(a,1),s.alphas.splice(a,1),e.target.remove();for(let e=a;e<r.children.length;++e){const t=r.children[e],a=(0|t.dataset.index)-1;t.dataset.index=`${a}`}super.focusOut(),this.updateFilterGradientCanvas(s),this.disposeCharacterImage(),this.reloadScreen()}mouseDownGradientColorPointer(e){e.stopPropagation(),this._$saved=!1,this._$pointX=e.screenX,this._$currentTarget=e.target,this._$currentPointer=e.target;const t=e.target.dataset.filterId;document.getElementById(`gradientColor-${t}`).value=e.target.dataset.color,document.getElementById(`gradientAlpha-${t}`).value=e.target.dataset.alpha,this._$mouseMoveGradientColorPointer||(this._$mouseMoveGradientColorPointer=this.mouseMoveGradientColorPointer.bind(this)),this._$mouseUpGradientColorPointer||(this._$mouseUpGradientColorPointer=this.mouseUpGradientColorPointer.bind(this)),window.addEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.addEventListener("mouseup",this._$mouseUpGradientColorPointer)}mouseMoveGradientColorPointer(e){const t=this._$currentTarget;if(!t)return;const r=0|t.dataset.index;r&&window.requestAnimationFrame((()=>{e.preventDefault();const a=0|t.dataset.filterId;if(!this._$filters.has(a))return;const s=parseFloat(t.style.left),i=d.$clamp(s+(e.screenX-this._$pointX)+4,ue.MIN_GRADIENT_POINTER,ue.MAX_GRADIENT_POINTER);t.style.left=i-4+"px";const n=this._$filters.get(a).filter;n._$ratios[r]=i,this._$pointX&&(this._$pointX=e.screenX),this.updateFilterGradientCanvas(n),this.disposeCharacterImage(),this.reloadScreen()}))}mouseUpGradientColorPointer(){window.removeEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.removeEventListener("mouseup",this._$mouseUpGradientColorPointer),d.$setCursor("auto"),super.focusOut()}}d.$view=new class{constructor(){this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("view");e&&e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),d.$initializeEnd()}mouseDown(e){e.button||d.$endMenu()}};class me extends H{constructor(){super(),this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),d.$initializeEnd()}reloadScreen(){const e=d.$timelineFrame.currentFrame;return d.$currentWorkSpace().scene.changeFrame(e)}executeFunction(e){this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}}class ge extends me{constructor(){super(),this._$editor=null,this._$active=!1,this._$frame=-1,this._$scene=null,this._$screenX=0,this._$screenY=0,this._$mouseMove=null,this._$mouseUp=null}static get SCRIPT_MODAL_WIDTH(){return 620}static get SCRIPT_MODAL_HEIGHT(){return 450}static get SCRIPT_MODAL_BAR_HEIGHT(){return 25}get active(){return this._$active}initialize(){super.initialize(),this.createEditor();const e=["editor-hide-icon","editor-bar"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),d.$endMenu("editor-modal"),this.executeFunction(e)}))}document.documentElement.style.setProperty("--script-modal-width",`${ge.SCRIPT_MODAL_WIDTH}px`),document.documentElement.style.setProperty("--script-modal-height",`${ge.SCRIPT_MODAL_HEIGHT}px`),document.documentElement.style.setProperty("--script-modal-bar-height",`${ge.SCRIPT_MODAL_BAR_HEIGHT}px`)}createEditor(){if(!("ace"in window))return;this._$editor=ace.edit("editor"),this._$editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this._$editor.setTheme("ace/theme/monokai"),this._$editor.session.setMode("ace/mode/javascript");const e=[{word:"next2d",meta:"window.next2d"},{word:"toString",value:"toString()",meta:"common method"},{word:"namespace",meta:"common property"}],t=Object.keys(window.next2d);for(let r=1;r<t.length;++r){const a=t[r];e.push({word:`next2d.${a}`,meta:`next2d.${a}`});const s=Object.keys(window.next2d[a]);for(let t=0;t<s.length;++t){const r=s[t];e.push({word:r,meta:`next2d.${a}.${r}`});const i=window.next2d[a][r],n=Object.getOwnPropertyDescriptors(i),o=Object.getOwnPropertyNames(i);for(let t=0;t<o.length;++t){const a=o[t];switch(a){case"length":case"prototype":case"toString":case"namespace":case"name":continue}const s=n[a];if("value"in s){const t=s.value.toString().replace(/ |\n/g,"").split("{")[0].split("(")[1];e.push({word:a,value:`${a}()`,meta:`${r}.${a}(${t}`})}else e.push({word:a,meta:`${r}.${a}`})}const l=Object.getOwnPropertyDescriptors(i.prototype),c=Object.getOwnPropertyNames(i.prototype);for(let t=0;t<c.length;++t){const a=c[t];switch(a){case"constructor":case"toString":case"namespace":case"name":continue}if(a.indexOf("_$")>-1)continue;const s=l[a];if("value"in s){const t=s.value.toString().replace(/ |\n/g,"").split("{")[0].split("(")[1];e.push({word:a,value:`${a}()`,meta:`${r}.${a}(${t}`})}else e.push({word:a,meta:`${r}.${a}`})}}}ace.require("ace/ext/language_tools").addCompleter({getCompletions:(t,r,a,s,i)=>{i(null,e.map((e=>({caption:e.word,value:e.value||e.word,meta:e.meta,score:0}))))}});const r=new ResizeObserver((e=>{e.forEach((e=>{const t=e.target,r=parseFloat(document.documentElement.style.getPropertyValue("--script-modal-width")),a=parseFloat(document.documentElement.style.getPropertyValue("--script-modal-height"));r!==t.clientWidth&&document.documentElement.style.setProperty("--script-modal-width",`${t.clientWidth}px`),a!==t.clientHeight&&document.documentElement.style.setProperty("--script-modal-height",`${t.clientHeight+ge.SCRIPT_MODAL_BAR_HEIGHT}px`)})),this._$editor.resize()})),a=document.getElementById("editor-modal");a&&r.observe(a)}executeTimelineScriptAdd(e){this.show(e)}executeContextMenuScriptAdd(e){this.show(e)}executeEditorHideIcon(){this.hide()}executeEditorBar(e){this._$screenX=e.screenX,this._$screenY=e.screenY,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){window.requestAnimationFrame((()=>{const t=document.getElementById("editor-modal");t.style.left=`${parseFloat(t.style.left)+(e.screenX-this._$screenX)}px`,t.style.top=`${parseFloat(t.style.top)+(e.screenY-this._$screenY)}px`,this._$screenX=e.screenX,this._$screenY=e.screenY}))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto")}show(e=null,t=0,r=null){d.$keyLock=!0,this._$active=!0,this._$frame=t||d.$timelineFrame.currentFrame,this._$editor.setValue("",-1),(r=r||d.$currentWorkSpace().scene).hasAction(this._$frame)&&this._$editor.setValue(r.getAction(this._$frame),-1),document.getElementById("editor-title").textContent=`${r.name} / frame[${this._$frame}]`;const a=document.getElementById("editor-modal");e&&(a.style.display="",a.style.left=`${e.pageX+5}px`,a.style.top=e.pageY-a.clientHeight/2+"px"),isNaN(parseFloat(a.style.left))&&(a.style.left="200px",a.style.top=300-a.clientHeight/2+"px"),a.setAttribute("class","fadeIn"),d.$endMenu("editor-modal"),this._$editor.focus()}hide(){this.save(),this._$editor.setValue("",0),this._$frame=-1,this._$scene=null,this._$active=!1,d.$keyLock=!1,d.$endMenu()}save(){if(-1===this._$frame)return;const e=d.$timelineHeader.leftFrame;if(e>this._$frame)return;const t=this._$frame-e,r=document.getElementById("timeline-header").children[t].children[pe.ACTION_INDEX],a=this._$editor.getValue(0),s=this._$scene||d.$currentWorkSpace().scene;a?(s.setAction(this._$frame,a.trim()),this._$scene||r.classList.contains("frame-border-box-action")||r.setAttribute("class","frame-border-box-action")):(s.deleteAction(this._$frame),this._$scene||r.setAttribute("class","frame-border-box"))}}d.$javaScriptEditor=new ge;class $e extends me{constructor(){super(),this._$pointY=0,this._$mouseMove=null,this._$mouseUp=null}static get TIMELINE_DEFAULT_SIZE(){return 280}static get TIMELINE_MIN_SIZE(){return 150}initialize(){super.initialize(),document.documentElement.style.setProperty("--timeline-height",`${$e.TIMELINE_DEFAULT_SIZE}px`);const e=document.getElementById("timeline-adjustment");e&&e.addEventListener("mousedown",(e=>{this.mouseDown(e)}))}mouseDown(e){e.preventDefault(),this._$pointY=e.screenY,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){d.$setCursor("row-resize"),window.requestAnimationFrame((()=>{const t=this._$pointY-e.screenY,r=0|document.documentElement.style.getPropertyValue("--timeline-height").split("px")[0],a=Math.max($e.TIMELINE_MIN_SIZE,r+t);document.documentElement.style.setProperty("--timeline-height",`${a}px`),d.$currentWorkSpace()._$timelineHeight=a,this._$pointY=e.screenY,d.$timelineLayer.updateClientSize(),d.$timelineMarker.setMarkerPosition()}))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$timelineLayer.moveTimeLine(),d.$setCursor("auto"),d.$timelineLayer.updateClientSize()}}d.$timelineAdjustment=new $e;d.$timelineFrame=new class extends me{constructor(){super(),this._$pointX=0,this._$currentValue=null,this._$currentTarget=null,this._$mouseMove=null,this._$mouseUp=null}get currentFrame(){const e=document.getElementById("current-frame");return e?0|e.value:1}set currentFrame(e){const t=document.getElementById("current-frame");if(t){const r=d.$currentWorkSpace().scene,a=r?r.totalFrame+ye.FRAME_COUNT-2:ye.FRAME_COUNT-2;t.value=""+(0|Math.max(1,Math.min(e,a)))}}initialize(){super.initialize();const e=document.getElementById("current-frame");e&&(e.addEventListener("mouseover",(e=>{this.mouseOver(e)})),e.addEventListener("mouseout",(e=>{this.mouseOut(e)})),e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})),e.addEventListener("focusout",(e=>{this.finishInput(e)})),e.addEventListener("keypress",(e=>{this.finishInput(e)})))}focusIn(e){super.focusIn(),this._$currentValue=+e.target.value,this._$currentTarget=e.target}focusOut(){super.focusOut(),this._$currentValue=null,this._$currentTarget=null}mouseOver(e){switch(e.stopPropagation(),!0){case this._$focus:case null!==this._$currentTarget:case null!==this._$currentValue:return;default:d.$setCursor("ew-resize"),e.target.style.cursor="ew-resize"}}mouseOut(e){e.stopPropagation(),!this._$focus&&this._$currentTarget||(d.$setCursor("auto"),e.target.style.cursor="")}mouseDown(e){this._$focus||(e.preventDefault(),this._$pointX=e.screenX,this._$currentTarget=e.target,this._$currentValue=+e.target.value,d.$setCursor("ew-resize"),this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),d.$timelineLayer.clear(),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto"),this._$currentTarget&&(this._$currentTarget.style.cursor="",this._$currentTarget.focus())}mouseMove(e){!this._$focus&&this._$currentTarget&&window.requestAnimationFrame((()=>{if(this._$focus||!this._$currentTarget)return;e.preventDefault(),d.$setCursor("ew-resize");const t=e.screenX-this._$pointX;let r=+this._$currentTarget.value;isNaN(r)&&(r=1);const a=d.$currentWorkSpace().scene.totalFrame+ye.FRAME_COUNT-2,s=Math.max(1,Math.min(r+t,a));this._$currentTarget.value=`${s}`,this._$currentValue=s,this._$pointX=e.screenX,this.moveTimeline(),this.reloadScreen()}))}finishInput(e){if("Enter"!==e.key){if("focusout"===e.type){const t=d.$currentWorkSpace().scene.totalFrame+ye.FRAME_COUNT-2;e.target.value=`${Math.max(1,Math.min(0|e.target.value,t))}`,this.moveTimeline(),this.focusOut(),this.reloadScreen()}}else e.currentTarget.blur()}moveTimeline(){const e=document.getElementById("timeline-controller-base");if(!e)return;const t=d.$timelineTool.timelineWidth,r=d.$timelineFrame.currentFrame,a=(r-(d.$timelineHeader.scrollX/t|0))*(t+1);(0>=a||a>e.clientWidth)&&(d.$timelineHeader.scrollX=(r-1)*t),d.$timelineHeader.rebuild(),d.$timelineMarker.move(),d.$timelineLayer.moveTimeLine()}};class pe extends me{constructor(){super(),this._$width=0,this._$scrollX=0,this._$targetElement=null,this._$deleteIcon=null}static get MARKER_INDEX(){return 1}static get ACTION_INDEX(){return 2}static get SOUND_INDEX(){return 3}get width(){return this._$width}get scrollX(){return this._$scrollX}get leftFrame(){return d.$timelineTool.timelineWidth||(d.$timelineTool.timelineWidth=d.$timelineTool.DEFAULT_TIMELINE_WIDTH),1+this._$scrollX/d.$timelineTool.timelineWidth|0}set scrollX(e){this._$scrollX=0|Math.max(0,Math.min(e,d.$timelineScroll.maxX)),d.$timelineScroll.x=this._$scrollX}initialize(){super.initialize(),this._$deleteIcon||(this._$deleteIcon=this.deleteIcon.bind(this));const e=document.getElementById("timeline-controller-base");e&&(e.addEventListener("wheel",(e=>{if(e.stopPropagation(),e.preventDefault(),d.$altKey){const t=0|e.deltaY;if(!t)return!1;window.requestAnimationFrame((()=>{d.$timelineTool.timelineWidth=d.$clamp(d.$timelineTool.timelineWidth+t,5,240)}))}else{const t=0|(e.deltaX||e.deltaY);if(!t)return!1;if(!this._$scrollX&&0>t)return!1;if(this._$scrollX>=Number.MAX_VALUE)return!1;window.requestAnimationFrame((()=>{this.scrollX=d.$clamp(this._$scrollX+t,0,Number.MAX_VALUE),this.rebuild(),d.$timelineMarker.move(),d.$timelineLayer.moveTimeLine()}))}}),{passive:!1}),e.addEventListener("mouseleave",(()=>{this.clearParams(),window.removeEventListener("keydown",this._$deleteIcon)})),e.addEventListener("mouseover",(()=>{window.addEventListener("keydown",this._$deleteIcon)})))}setWidth(){const e=document.getElementById("timeline-controller-base");e&&(this._$width=0|e.clientWidth)}rebuild(){const e=document.getElementById("timeline-header");if(!e)return;const t=d.$currentWorkSpace();if(!t)return;const r=t.scene;if(!r)return;d.$timelineTool.timelineWidth||(d.$timelineTool.timelineWidth=d.$timelineTool.DEFAULT_TIMELINE_WIDTH);const a=d.$timelineTool.timelineWidth,s=this.width/(a+1)|0;if(!e.children.length)for(let t=0;s>=t;++t)this.createElement(e,t+1);if(e.children.length+1>s){const t=s+1;for(;e.children.length>t;)e.children[t].remove()}if(s>e.children.length){let t=0|e.lastElementChild.dataset.frame;const r=s-e.children.length;for(let a=1;r>=a;++a)this.createElement(e,t++)}const i=0|document.getElementById("stage-fps").value;let n=this.leftFrame,o=Math.max(1,1+(n/24|0));const l=e.children,c=l.length;for(let e=0;c>e;++e){const t=n+e,a=l[e];(0|a.dataset.frame)!==t&&a.setAttribute("data-frame",`${t}`);const s=a.children,c=s.length;for(let e=0;c>e;++e){const a=s[e];switch((0|a.dataset.frame)!==t&&a.setAttribute("data-frame",`${t}`),e){case 0:if(t%5==0?a.classList.contains("frame-border-end")||a.setAttribute("class","frame-border-end"):a.classList.contains("frame-border")||a.setAttribute("class","frame-border"),t%i==0&&i>4){const e=o+++"s";a.innerHTML&&a.innerHTML===e||(a.innerHTML=e)}else a.innerHTML&&(a.innerHTML="");break;case pe.MARKER_INDEX:r.hasLabel(t)?a.classList.contains("frame-border-box-marker")||a.setAttribute("class","frame-border-box-marker"):a.classList.contains("frame-border-box")||a.setAttribute("class","frame-border-box");break;case pe.ACTION_INDEX:r.hasAction(t)?a.classList.contains("frame-border-box-action")||a.setAttribute("class","frame-border-box-action"):a.classList.contains("frame-border-box")||a.setAttribute("class","frame-border-box");break;case pe.SOUND_INDEX:r.hasSound(t)?a.classList.contains("frame-border-box-sound")||a.setAttribute("class","frame-border-box-sound"):a.classList.contains("frame-border-box")||a.setAttribute("class","frame-border-box");break;case 4:if(t%5==0){const e=`${t}`;a.innerHTML&&a.innerHTML===e||(a.innerHTML=e)}else a.innerHTML&&(a.innerHTML="")}}}}createElement(e,t=1){const r=`\n<div class="frame-header-parent" data-frame="${t}">\n    <div class="frame-sec ${t%5==0?"frame-border-end":"frame-border"}" data-frame="${t}"></div>\n    <div class="frame-border-box" data-type="marker" data-frame="${t}"></div>\n    <div class="frame-border-box" data-type="action" data-frame="${t}"></div>\n    <div class="frame-border-box" data-type="sound" data-frame="${t}"></div>\n    <div class="frame-number" data-frame="${t}">${t%5==0?t:""}</div>\n</div>\n`;e.insertAdjacentHTML("beforeend",r);const a=e.lastElementChild;a.addEventListener("mousedown",(e=>{e.button||(d.$endMenu(),this.moveMarker(e))}));for(let e=0;e<3;++e){const t=a.children[1+e];t&&(t.addEventListener("mousedown",(e=>{this.dragIcon(e)})),t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(e=>{this.dropIcon(e)})))}}clearParams(){this._$targetElement=null}dragIcon(e){const t=e.target;t.classList.contains("frame-border-box")||(e.stopPropagation(),t.draggable=!0,this._$targetElement=t)}deleteIcon(e){if(d.$keyLock)return;if("Backspace"!==e.key)return;if(!this._$targetElement)return;this.save();const t=0|this._$targetElement.dataset.frame,r=d.$currentWorkSpace().scene;switch(this._$targetElement.dataset.type){case"marker":r.deleteLabel(t);break;case"action":r.deleteAction(t);break;case"sound":r.deleteSound(t)}this._$targetElement.setAttribute("class","frame-border-box"),this._$targetElement=null,super.focusOut()}dropIcon(e){if(!this._$targetElement)return;e.preventDefault(),this._$targetElement.draggable=!1;const t=e.target,r=0|this._$targetElement.dataset.frame,a=0|t.dataset.frame;if(r!==a){this.save();const e=d.$currentWorkSpace().scene,s=this._$targetElement.dataset.type;let i=null;const n=t.parentElement;switch(s){case"marker":i=n.children[1],e.setLabel(a,e.getLabel(r));break;case"action":i=n.children[2],e.setAction(a,e.getAction(r));break;case"sound":i=n.children[3],e.setSound(a,e.getSound(r))}d.$altKey||this.deleteIcon({key:"Backspace"}),i&&(this._$targetElement=i,i.setAttribute("class",`frame-border-box-${s}`))}super.focusOut()}moveMarker(e){e.stopPropagation(),this.clearParams(),d.$timelineFrame.currentFrame=0|e.target.dataset.frame,d.$timelineMarker.move(),d.$soundController.createSoundElements(),d.$timelineMarker.startMarker(),this.reloadScreen()}}d.$timelineHeader=new pe;class fe{static get color(){const e=["#ef857d","#ffedab","#a3d6cc","#8d93c8","#e3acae","#ea5550","#00947a","#4d4398","#915da3","#ed6d35","#bd6856","#72640c","#98605e","#6c3524","#f8f4e6","#6a1917","#7f1184","#00afcc","#e3e548","#af0082","#0073a8","#e4007f"];return e[Math.random()*e.length|0]}}d.$timelineKeyboardCommand=new class extends V{constructor(){super("timeline")}initialize(){super.initialize();const e=document.getElementById("timeline");e&&(e.addEventListener("mouseleave",(()=>{this.active=!1})),e.addEventListener("mouseover",(()=>{this.active||(this.active=!0)})),e.addEventListener("mouseup",(()=>{this.active||(this.active=!0)}))),this.add(d.$generateShortcutKey("+",{ctrl:!0}),(()=>{d.$timelineTool.executeTimelineLayerAdd()})),this.add(d.$generateShortcutKey(";",{ctrl:!0}),(()=>{d.$timelineTool.executeTimelineLayerAdd()})),this.add(d.$generateShortcutKey("Backspace",{ctrl:!0}),(()=>{d.$timelineTool.executeTimelineLayerTrash()})),this.add("Backspace",(()=>{d.$timelineLayer.removeFrame()})),this.add(d.$generateShortcutKey("ArrowDown",{ctrl:!0}),this.selectLayer),this.add(d.$generateShortcutKey("ArrowUp",{ctrl:!0}),this.selectLayer),this.add(d.$generateShortcutKey("ArrowLeft",{ctrl:!0}),this.moveFrame),this.add(d.$generateShortcutKey("ArrowRight",{ctrl:!0}),this.moveFrame);const t=d.$screenKeyboardCommand.executeMoveDisplayObject;this.add("ArrowDown",t),this.add(d.$generateShortcutKey("ArrowDown",{shift:!0}),t),this.add("ArrowUp",t),this.add(d.$generateShortcutKey("ArrowUp",{shift:!0}),t),this.add("ArrowLeft",t),this.add(d.$generateShortcutKey("ArrowLeft",{shift:!0}),t),this.add("ArrowRight",t),this.add(d.$generateShortcutKey("ArrowRight",{shift:!0}),t),this.add("f",(()=>{d.$timelineTool.executeTimelineFrameAdd()})),this.add(d.$generateShortcutKey("f",{ctrl:!0}),(()=>{d.$timelineTool.executeTimelineFrameDelete()})),this.add("k",(()=>{d.$timelineTool.executeTimelineKeyAdd()})),this.add(d.$generateShortcutKey("k",{ctrl:!0}),(()=>{d.$timelineTool.executeTimelineKeyDelete()})),this.add("l",(()=>{document.getElementById("label-name").focus()})),this.add("e",(()=>{d.$timelineTool.executeTimelineEmptyAdd()})),this.add("s",(()=>{d.$javaScriptEditor.show()})),this.add("v",this.activePropertyTab),this.add("z",(()=>{document.getElementById("timeline-scale").focus()})),this.add("p",d.$timelineTool.executeTimelinePreview),this.add("o",(()=>{d.$timelineTool.executeTimelineOnionSkin()})),this.add("m",(()=>{d.$timelineMenu.executeContextMenuTweenAdd()})),this.add(d.$generateShortcutKey("m",{ctrl:!0}),(()=>{d.$timelineMenu.executeContextMenuTweenDelete()})),this.add(d.$generateShortcutKey("h",{shift:!0}),(()=>{d.$timelineTool.executeTimelineLayerLightAll()})),this.add(d.$generateShortcutKey("l",{shift:!0}),(()=>{d.$timelineTool.executeTimelineLayerLockAll()})),this.add(d.$generateShortcutKey("d",{shift:!0}),(()=>{d.$timelineTool.executeTimelineLayerDisableAll()})),this.add(d.$generateShortcutKey("n",{shift:!0}),(()=>{d.$timelineLayerMenu.executeTimelineLayerNormal()})),this.add(d.$generateShortcutKey("m",{shift:!0}),(()=>{d.$timelineLayerMenu.executeTimelineLayerMask()})),this.add(d.$generateShortcutKey("g",{shift:!0}),(()=>{d.$timelineLayerMenu.executeTimelineLayerGuide()})),this.add(d.$generateShortcutKey("c",{ctrl:!0}),(()=>(d.$timelineMenu.executeContextMenuFrameCopy(),!1))),this.add(d.$generateShortcutKey("v",{ctrl:!0}),(()=>(d.$timelineMenu.executeContextMenuFramePaste(),!1))),this.add(d.$generateShortcutKey("l",{ctrl:!0}),(()=>{d.$timelineMenu.executeContextMenuLayerCopy(),d.$timelineMenu.executeContextMenuLayerPaste()})),this.add(d.$generateShortcutKey("ArrowLeft",{ctrl:!0,shift:!0}),(()=>{d.$timelineMenu.executeContextMenuFirstFrame()})),this.add(d.$generateShortcutKey("ArrowRight",{ctrl:!0,shift:!0}),(()=>{d.$timelineMenu.executeContextMenuLastFrame()})),this.add("F6",(()=>{d.$timelineMenu.executeContextMenuKeyFrameChange()})),this.add("F7",(()=>{d.$timelineMenu.executeContextMenuKeyFrameChange()}))}activePropertyTab(){document.getElementById("controller-tab-area").children[0].click()}moveFrame(e){const t=d.$timelineLayer.targetLayer;if(!t)return;const r=e?"ArrowRightCtrl"===e?1:-1:0,a=Math.max(1,d.$timelineFrame.currentFrame+r);d.$tools.getDefaultTool("arrow").clear(),d.$timelineLayer.changeLabel(a),d.$timelineLayer.moveFrame(a),d.$timelineLayer.activeLayer(t)}selectLayer(e){let t=null;const r=document.getElementById("timeline-content"),a=d.$ctrlKey;d.$ctrlKey=!1;const s=d.$timelineLayer.targetLayer;if(s)if("ArrowDownCtrl"===e){if(t=s.nextElementSibling,!t)return;t.offsetTop+t.offsetHeight>window.innerHeight&&d.$timelineScroll.execute(0,d.$timelineTool.timelineHeight)}else{if(t=s.previousElementSibling,!t)return;r.offsetTop>t.offsetTop&&d.$timelineScroll.execute(0,-d.$timelineTool.timelineHeight)}else"ArrowDownCtrl"===e?(t=r.firstElementChild,d.$timelineScroll.execute(0,-d.$timelineScroll.y)):(t=r.lastElementChild,d.$timelineScroll.execute(0,d.$timelineLayer.clientHeight));d.$timelineLayer.activeLayer(t),d.$ctrlKey=a}};d.$timelineLayer=new class extends me{constructor(){super(),this._$targetFrames=new Map,this._$activeKeyEvent=!1,this._$targetLayers=new Map,this._$clientX=0,this._$clientY=0,this._$clientHeight=0,this._$scrollIndex=0,this._$moveLayerId=-1,this._$clickTimerId=-1,this._$selectLayerId=-1,this._$destLayer=null,this._$timerId=-1,this._$exitLayer=null,this._$executeMoveLayer=null,this._$moveLayer=null,this._$endInput=null,this._$moveTargetGroup=null,this._$endTargetGroup=null,this._$multiSelect=null,this._$endMultiSelect=null,this._$clearClickParam=null,this._$disableState=!1,this._$lightState=!1,this._$lockState=!1}get clientWidth(){return this._$clientWidth}set clientWidth(e){this._$clientWidth=0|e,d.$timelineScroll.updateWidth()}get clientHeight(){return this._$clientHeight}set clientHeight(e){this._$clientHeight=0|e,d.$timelineScroll.updateHeight()}get targetFrames(){return this._$targetFrames}get targetFrame(){return this.targetFrames.size?this.targetFrames.values().next().value[0]:null}get targetLayers(){return this._$targetLayers}get targetLayer(){return this.targetLayers.size?this.targetLayers.values().next().value:null}set targetLayer(e){switch(!0){case d.$ctrlKey:e&&(this.targetLayers.has(e.id)?(e.classList.remove("active"),this.targetLayers.delete(e.id)):(e.classList.add("active"),this.targetLayers.set(e.id,e)));break;case d.$shiftKey:if(e){const t=this.targetLayer;if(!t||t.id===e.id)return;this.clearActiveLayers(),this.clearActiveFrames();const r=Array.from(document.getElementById("timeline-content").children),a=r.indexOf(t),s=r.indexOf(e),i=Math.min(a,s),n=Math.max(a,s);this.targetLayers.set(t.id,t);for(let e=i;e<=n;++e){const t=r[e];t.classList.add("active"),this.targetLayers.has(t.id)||this.targetLayers.set(t.id,t)}}break;default:this.clearActiveLayers(),this.clearActiveFrames(),e&&(e.classList.add("active"),this.targetLayers.set(e.id,e))}}addTargetFrame(e,t){this.targetFrames.has(e.id)||this.targetFrames.set(e.id,[]);this.targetFrames.get(e.id).push(t);const r=e.getChildren(t);r&&r.classList.add("frame-active")}clearClickParam(){window.removeEventListener("mouseup",this._$clearClickParam),this._$disableState=!1,this._$lightState=!1,this._$lockState=!1}initialize(){super.initialize();const e=document.getElementById("timeline");e&&e.addEventListener("mouseover",(()=>{d.$setCursor("auto")}));const t=document.getElementById("timeline-content");t&&t.addEventListener("wheel",(e=>{const t=0|e.deltaY;if(!t)return!1;e.stopPropagation(),e.preventDefault(),d.$altKey?window.requestAnimationFrame((()=>{d.$timelineTool.timelineWidth=d.$clamp(d.$timelineTool.timelineWidth+t,5,240)})):window.requestAnimationFrame((()=>{d.$timelineScroll.execute(0,t)}))}),{passive:!1}),this.hideTargetGroup()}updateClientSize(){const e=document.getElementById("timeline-content");if(e){const t=window.innerWidth-(0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0])-338;this.clientWidth!==t&&(this.clientWidth=t,d.$timelineScroll.updateWidth()),this.clientHeight!==e.clientHeight&&(this.clientHeight=e.clientHeight,d.$timelineScroll.updateHeight())}}updateScrollY(e=0){const t=d.$currentWorkSpace();if(!t)return;const r=t.scene;if(!r)return;const a=r._$layers.size*d.$timelineTool.timelineHeight,s=this.scrollY;if(this.clientHeight>a)this.scrollY=0;else{const t=this.clientHeight/d.$timelineTool.timelineHeight|0;this.scrollY=Math.max(0,Math.min(this.scrollY+e,(r._$layers.size-t)*d.$timelineTool.timelineHeight))}s!==this.scrollY&&this.moveTimeLine()}activeCharacter(){if(!this.targetLayers.size)return;const e=d.$tools.getDefaultTool("arrow");e.clearActiveElement(),d.$transformController.hide(),d.$gridController.hide();const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene,a=d.$shiftKey;d.$shiftKey=!0;for(const a of this.targetFrames.keys()){const s=r.getLayer(a).getActiveCharacter(t);for(let t=0;t<s.length;++t){const r=s[t],a=document.getElementById(`character-${r.id}`);a&&e.addElement(a,!0)}}d.$shiftKey=a,d.$controller.default(),e.activeElements.length?(e.updateControllerProperty(),d.$transformController.show().relocation(),d.$gridController.show().relocation()):d.$tweenController.clearPointer()}clear(){this.clearActiveLayers(),this.clearActiveFrames()}removeAll(){const e=document.getElementById("timeline-content");if(e)for(;e.firstChild;)e.firstChild.remove()}create(e){if(!d.$currentWorkSpace())return;const t=document.getElementById("timeline-content");if(!t)return;if(!document.getElementById(`frame-scroll-id-${e}`)){t.insertAdjacentHTML("beforeend",`\n<div class="timeline-content-child" id="layer-id-${e}" data-layer-id="${e}">\n\n    <div class="timeline-layer-controller">\n        <i class="timeline-exit-icon" id="timeline-exit-icon-${e}" data-layer-id="${e}"></i>\n        <i class="timeline-exit-in-icon" id="timeline-exit-in-icon-${e}" data-layer-id="${e}"></i>\n        <i class="timeline-layer-icon" id="layer-icon-${e}" data-layer-id="${e}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-mask-icon" id="layer-mask-icon-${e}" data-layer-id="${e}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-mask-in-icon" id="layer-mask-in-icon-${e}" data-layer-id="${e}"></i>\n        <i class="timeline-guide-icon" id="layer-guide-icon-${e}" data-layer-id="${e}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-guide-in-icon" id="layer-guide-in-icon-${e}" data-layer-id="${e}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <div class="view-text" id="layer-name-${e}" data-layer-id="${e}">layer_${e}</div>\n        <input type="text" class="view-text-input" id="layer-name-input-${e}" data-layer-id="${e}" value="layer_${e}" style="display: none;" autocomplete="off">\n        <i class="timeline-layer-light-one icon-disable" id="layer-light-icon-${e}" data-click-type="light" data-layer-id="${e}" data-detail="{{レイヤーをハイライト}}"></i>\n        <i class="timeline-layer-disable-one icon-disable" id="layer-disable-icon-${e}" data-click-type="disable" data-layer-id="${e}" data-detail="{{レイヤーを非表示}}"></i>\n        <i class="timeline-layer-lock-one icon-disable" id="layer-lock-icon-${e}" data-click-type="lock" data-layer-id="${e}" data-detail="{{レイヤーをロック}}"></i>\n    </div>\n\n    <div class="timeline-frame-controller" id="frame-scroll-id-${e}"></div>\n</div>\n`),document.getElementById(`layer-name-${e}`).addEventListener("dblclick",(e=>{this.showInput(e)})),document.getElementById(`layer-icon-${e}`).addEventListener("dblclick",(e=>{this.showLayerMenu(e)}));const r=document.getElementById(`layer-guide-icon-${e}`);r.addEventListener("dblclick",(e=>{this.showLayerMenu(e)})),r.addEventListener("mouseover",(e=>{this.exitLayer(e)})),r.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const a=document.getElementById(`layer-mask-icon-${e}`);a.addEventListener("dblclick",(e=>{this.showLayerMenu(e)})),a.addEventListener("mouseover",(e=>{this.exitLayer(e)})),a.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const s=document.getElementById(`timeline-exit-icon-${e}`);s.addEventListener("mouseover",(e=>{this.exitLayer(e)})),s.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const i=document.getElementById(`timeline-exit-in-icon-${e}`);i.addEventListener("mouseover",(e=>{this.exitLayer(e)})),i.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const n=document.getElementById(`layer-id-${e}`);d.$addModalEvent(n),n.addEventListener("mousedown",(e=>{this.selectLayer(e)}));const o=n.getElementsByClassName("timeline-layer-controller")[0];o.addEventListener("mouseover",(e=>{this.activeMoveLayer(e)})),o.addEventListener("mouseout",(e=>{this.inactiveMoveLayer(e)})),o.addEventListener("contextmenu",(e=>{this.showLayerMenu(e)}));const l=n.getElementsByClassName("timeline-frame-controller")[0];l.addEventListener("wheel",(e=>{let t=0|e.deltaY,r=0|e.deltaX;if(d.$shiftKey&&(r=0|e.deltaY,t=0),!r||t>0)return!1;e.stopPropagation(),e.preventDefault();const a=d.$timelineHeader.scrollX;if(!a&&0>r)return!1;window.requestAnimationFrame((()=>{d.$timelineHeader.scrollX=d.$clamp(a+r,0,Number.MAX_VALUE),d.$timelineHeader.rebuild(),d.$timelineMarker.move(),this.moveTimeLine()}))}),{passive:!1}),l.addEventListener("mouseover",(e=>{this.showLayerPreview(e)})),l.addEventListener("mouseout",(()=>{this.hideLayerPreview()})),l.addEventListener("mousedown",(e=>{this.selectFrame(e)})),l.addEventListener("dblclick",(e=>{this.selectRange(e)}));const c=document.getElementById(`layer-light-icon-${e}`);c.addEventListener("mousedown",(e=>{this.clickLight(e)})),c.addEventListener("mouseover",(e=>{this._$lightState&&this.clickLight(e)}));const h=document.getElementById(`layer-disable-icon-${e}`);h.addEventListener("mousedown",(e=>{this.clickDisable(e)})),h.addEventListener("mouseover",(e=>{this._$disableState&&this.clickDisable(e)}));const u=document.getElementById(`layer-lock-icon-${e}`);u.addEventListener("mousedown",(e=>{this.clickLock(e)})),u.addEventListener("mouseover",(e=>{this._$lockState&&this.clickLock(e)}));document.getElementById(`frame-scroll-id-${e}`).addEventListener("contextmenu",(e=>{d.$timelineMenu.show(e)}))}this.rebuild(e)}rebuild(e){const t=document.getElementById(`frame-scroll-id-${e}`);if(!t)return;const r=d.$currentWorkSpace().scene.getLayer(e);if(!r)return;const a=d.$timelineTool.timelineWidth,s=d.$timelineHeader.width/(a+1)|0;if(!t.children.length){for(let r=0;s>=r;++r)this.createElement(t,e,r+1);r._$children=[]}if(t.children.length>s+1){const e=s+1;for(;t.children.length>e;)t.children[e].remove();r._$children=[]}if(s>t.children.length){let a=0|t.lastElementChild.dataset.frame;const i=s-t.children.length;for(let r=0;i>=r;++r)this.createElement(t,e,++a);r._$children=[]}r._$children.length||(r._$children=Array.from(t.children));let i=d.$timelineHeader.leftFrame;for(let e=0;r._$children.length>e;++e){const t=i+e,a=r._$children[e];a.setAttribute("data-frame",`${t}`),a.setAttribute("data-frame-state","empty"),a.setAttribute("class",t%5!=0?"frame":"frame frame-pointer")}r.reloadStyle()}createElement(e,t,r=1){e.insertAdjacentHTML("beforeend",`<div class="${r%5!=0?"frame":"frame frame-pointer"}" data-frame-state="empty" data-layer-id="${t}" data-frame="${r}"></div>`)}removeFrame(){if(!this.targetLayer)return;this.save();let e=!1;const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene,a=this.targetFrames;for(const s of a.keys()){const a=r.getLayer(s),i=a.getActiveCharacter(t);if(!i.length)continue;e=!0;let n=null;for(let e=0;e<i.length;++e){const r=i[e];n||(n=r.getRange(t)),r.remove(a)}a.addEmptyCharacter(new f({startFrame:n.startFrame,endFrame:n.endFrame})),a.reloadStyle()}this.clearActiveFrames(),this.activeCharacter(),e&&this.reloadScreen(),super.focusOut()}attachLayer(){if(!this.targetLayer){const e=d.$currentWorkSpace().scene;let t=document.getElementById("timeline-content").children[0];t||(e.addLayer(),t=document.getElementById("timeline-content").children[0]);const r=d.$shiftKey,a=d.$ctrlKey;d.$shiftKey=!1,d.$ctrlKey=!1,this.targetLayer=t;const s=e.getLayer(0|t.dataset.layerId);this.addTargetFrame(s,d.$timelineFrame.currentFrame),d.$shiftKey=r,d.$ctrlKey=a}}exitLayer(e){if(-1===this._$moveLayerId)return;const t=0|e.target.dataset.layerId;let r=document.getElementById(`layer-id-${t}`);const a=Array.from(document.getElementById("timeline-content").children),s=d.$currentWorkSpace().scene,i=a.indexOf(r),n=a[i+1];if(n){switch(s.getLayer(0|n.dataset.layerId).mode){case I.MASK_IN:case I.GUIDE_IN:return}}this._$exitLayer=r,document.getElementById(`timeline-exit-icon-${t}`).style.opacity="1",document.getElementById(`timeline-exit-in-icon-${t}`).style.opacity="1"}endExitLayer(e){if(-1===this._$moveLayerId)return;this._$exitLayer=null;const t=0|e.target.dataset.layerId;document.getElementById(`timeline-exit-icon-${t}`).style.opacity="0",document.getElementById(`timeline-exit-in-icon-${t}`).style.opacity="0"}clickLight(e){e.button||(d.$endMenu(),e.stopPropagation(),this._$lightState=!0,this._$clearClickParam||(this._$clearClickParam=this.clearClickParam.bind(this)),window.addEventListener("mouseup",this._$clearClickParam),this.changeType(e.target,"light"))}clickLock(e){e.button||(d.$endMenu(),e.stopPropagation(),this._$lockState=!0,this._$clearClickParam||(this._$clearClickParam=this.clearClickParam.bind(this)),window.addEventListener("mouseup",this._$clearClickParam),this.changeType(e.target,"lock"),d.$transformController.show().relocation())}clickDisable(e){e.button||(d.$endMenu(),e.stopPropagation(),this._$disableState=!0,this._$clearClickParam||(this._$clearClickParam=this.clearClickParam.bind(this)),window.addEventListener("mouseup",this._$clearClickParam),this.changeType(e.target,"disable"),d.$transformController.show(),d.$clearShapePointer(),this.reloadScreen())}changeType(e,t){const r=0|e.dataset.layerId,a=document.getElementById(`layer-id-${r}`),s=d.$currentWorkSpace().scene.getLayer(r);s[t]=!s[t],s[t]?(e.classList.remove("icon-disable"),"light"===t?(e.classList.add("light-icon-active"),a.style.borderBottom=`1px solid ${s.color}`):(e.classList.add("icon-active"),a.classList.add(`${t}-active`))):(e.classList.add("icon-disable"),"light"===t?(e.classList.remove("light-icon-active"),a.style.borderBottom=""):(e.classList.remove("icon-active"),a.classList.remove(`${t}-active`))),"lock"===t&&this.reloadScreen()}showLayerMenu(e){e.preventDefault(),e.stopPropagation();const t=0|e.target.dataset.layerId;d.$timelineLayer.targetLayers.has(`layer-id-${t}`)||(this.targetLayer=document.getElementById(`layer-id-${t}`)),d.$timelineLayerMenu.show(e)}showInput(e){e.stopPropagation(),d.$keyLock=!0;const t=0|e.target.dataset.layerId,r=document.getElementById(`layer-name-input-${t}`);r.value=e.target.textContent,r.style.display="",r.focus(),e.target.style.display="none",this._$endInput||(this._$endInput=this.endInput.bind(this)),r.addEventListener("focusout",this._$endInput),r.addEventListener("keypress",this._$endInput)}endInput(e){if("Enter"===e.key)return void e.target.blur();if("focusout"!==e.type)return;this.save(),e.stopPropagation();const t=e.target,r=0|t.dataset.layerId;d.$currentWorkSpace().scene.getLayer(r).name=t.value;const a=document.getElementById(`layer-name-${r}`);a.textContent=t.value,a.style.display="",t.style.display="none",t.removeEventListener("focusout",this._$endInput),t.removeEventListener("keypress",this._$endInput),super.focusOut()}moveLayer(e){d.$setCursor("grabbing"),window.requestAnimationFrame((()=>{const t=document.getElementById("timeline-content");e.pageY+20>window.innerHeight&&(t.scrollTop+=e.pageY+20-window.innerHeight),t.scrollTop>0&&t.offsetTop>e.pageY-8&&(t.scrollTop+=e.pageY-t.offsetTop-8)}))}executeMoveLayer(){window.removeEventListener("mousemove",this._$moveLayer),window.removeEventListener("mouseup",this._$executeMoveLayer);let e=null;const t=d.$currentWorkSpace().scene;if(this._$exitLayer){switch(e=t.getLayer(0|this._$exitLayer.dataset.layerId),e.mode){case I.MASK_IN:for(const t of this.targetLayers.values())if(t.id===e.maskId)return this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,void d.$setCursor("auto");break;case I.GUIDE_IN:for(const t of this.targetLayers.values())if(t.id===e.guideId)return this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,void d.$setCursor("auto")}document.getElementById(`timeline-exit-icon-${e.id}`).style.opacity="0",document.getElementById(`timeline-exit-in-icon-${e.id}`).style.opacity="0",this._$destLayer=this._$exitLayer}if(this._$destLayer){this._$destLayer.classList.remove("move-target");const r=t.getLayer(0|this._$destLayer.dataset.layerId);if(null===e)switch(r.mode){case I.MASK:case I.MASK_IN:case I.GUIDE:case I.GUIDE_IN:for(const e of this.targetLayers.values()){switch(t.getLayer(0|e.dataset.layerId).mode){case I.MASK:case I.GUIDE:return this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,void d.$setCursor("auto")}}}this.save();const a=document.getElementById("timeline-content"),s=Array.from(this.targetLayers.values());if(s.length>1){for(let e=0;e<s.length;++e){const r=s[e],a=t.getLayer(0|r.dataset.layerId);switch(a.mode){case I.MASK_IN:{const t=document.getElementById(`layer-id-${a.maskId}`);s.indexOf(t)>-1&&(s.splice(e,1),--e)}break;case I.GUIDE_IN:{const t=document.getElementById(`layer-id-${a.guideId}`);s.indexOf(t)>-1&&(s.splice(e,1),--e)}}}const e=Array.from(a.children);s.sort(((t,r)=>{const a=e.indexOf(t),s=e.indexOf(r);switch(!0){case a>s:return-1;case a<s:return 1;default:return 0}}))}const i=[];for(let n=0;n<s.length;++n){const o=s[n],l=t.getLayer(0|o.dataset.layerId);switch(r.mode){case I.MASK:case I.MASK_IN:e?null!==e.maskId&&e.maskId===l.maskId&&(l.maskId=null,l.mode=I.NORMAL,l.showIcon()):(l.maskId=null===r.maskId?r.id:r.maskId,l.mode=I.MASK_IN,l.showIcon());break;case I.GUIDE:case I.GUIDE_IN:e?null!==e.guideId&&e.guideId===l.guideId&&(l.guideId=null,l.mode=I.NORMAL,l.showIcon()):(l.guideId=null===r.guideId?r.id:r.guideId,l.mode=I.GUIDE_IN,l.showIcon());break;default:switch(l.mode){case I.MASK_IN:l.maskId=null,l.mode=I.NORMAL,l.showIcon();break;case I.GUIDE_IN:l.guideId=null,l.mode=I.NORMAL,l.showIcon()}}switch(i.length&&(i.length=0),l.mode){case I.MASK:{const e=Array.from(a.children);let r=e.indexOf(o);for(;;){const a=e[++r];if(!a)break;if(t.getLayer(0|a.dataset.layerId).mode!==I.MASK_IN)break;i.unshift(a)}}break;case I.GUIDE:{const e=Array.from(a.children);let r=e.indexOf(o);for(;;){const a=e[++r];if(!a)break;if(t.getLayer(0|a.dataset.layerId).mode!==I.GUIDE_IN)break;i.unshift(a)}}}if(a.insertBefore(o,this._$destLayer.nextElementSibling),i.length)for(let e=0;e<i.length;++e)a.insertBefore(i[e],o.nextElementSibling)}const n=[],o=a.children;for(let e=0;e<o.length;++e)n.push(t.getLayer(0|o[e].dataset.layerId));t.clearLayer();for(let e=0;e<n.length;++e){const r=n[e];t.setLayer(r.id,r)}this.reloadScreen()}else if(this._$moveLayerId!==this._$selectLayerId){const e=document.getElementById(`layer-id-${this._$moveLayerId}`);this.activeLayer(e)}super.focusOut(),this._$selectLayerId=-1,this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,d.$setCursor("auto")}activeMoveLayer(e){if(this._$destLayer=null,-1===this._$moveLayerId)return;e.stopPropagation();const t=e.currentTarget.parentNode;this.targetLayers.has(t.id)||(this._$destLayer=t,t.classList.add("move-target"))}inactiveMoveLayer(e){-1!==this._$moveLayerId&&this._$destLayer&&(e.stopPropagation(),this._$destLayer.classList.remove("move-target"),this._$destLayer=null)}moveTimeLine(){const e=d.$currentWorkSpace().scene;if(!e)return;const t=this.clientHeight,r=d.$timelineScroll.y/d.$timelineTool.timelineHeight|0;let a=0,s=0;for(const i of e._$layers.values())if(r>a){if("none"!==i.display){const e=document.getElementById(`layer-id-${i.id}`);e&&(i.display=e.style.display="none")}a++}else{if("none"===i.display){const e=document.getElementById(`layer-id-${i.id}`);e&&(i.display=e.style.display="")}if(this.rebuild(i.id),d.$timelineTool.timelineHeight*++s>t)break;a++}this.moveActiveFrame()}showLayerPreview(e){if(!d.$timelineTool.preview)return;const t=0|e.target.dataset.layerId,r=e.target;window.requestAnimationFrame((()=>{const a=d.$currentWorkSpace(),s=0|r.dataset.frame,i=a.scene.getLayer(t),n=d.$currentFrame;d.$currentFrame=s;const o=i.getActiveCharacter(s);if(o.length){clearTimeout(this._$timerId),i.sort(o,s);const t=document.getElementById("timeline-preview-modal"),{Sprite:r,BitmapData:n}=window.next2d.display,{Matrix:l,ColorTransform:c}=window.next2d.geom,h=new r;let u=Number.MAX_VALUE,m=-Number.MAX_VALUE,g=Number.MAX_VALUE,$=-Number.MAX_VALUE;for(let e=0;e<o.length;++e){const t=o[e],r=t.getRange(s),i=t.getPlace(s),n=a.getLibrary(t.libraryId).createInstance(i,r);n.transform.matrix=new l(i.matrix[0],i.matrix[1],i.matrix[2],i.matrix[3],i.matrix[4],i.matrix[5]),n.transform.colorTransform=new c(i.colorTransform[0],i.colorTransform[1],i.colorTransform[2],i.colorTransform[3],i.colorTransform[4],i.colorTransform[5],i.colorTransform[6],i.colorTransform[7]);const d=a.getLibrary(t.libraryId).getBounds(i.matrix,i,r);u=Math.min(u,d.xMin),m=Math.max(m,d.xMax),g=Math.min(g,d.yMin),$=Math.max($,d.yMax),h.addChild(n)}const p=Math.ceil(Math.abs(m-u)),f=Math.ceil(Math.abs($-g)),y=Math.min(120/p,120/f),_=window.devicePixelRatio,b=new n(p*y*_,f*y*_,!0,0),v=new l(_,0,0,_,-u*_,-g*_);v.scale(y,y),b.draw(h,v);const I=b.drawFromCanvas(d.$getCanvas());for(b.dispose();t.children.length;){const e=t.children[0];d.$poolCanvas(e),e.remove()}let E="";E+=`left: ${e.pageX+10}px;`,E+=`top: ${e.pageY-t.offsetHeight-10}px;`,E+=`background-color: ${document.getElementById("stage-bgColor").value};`,t.setAttribute("style",E);const S=I.canvas;S.style.width=b.width/_+"px",S.style.height=b.height/_+"px",t.appendChild(S),t.classList.contains("fadeIn")||t.setAttribute("class","fadeIn")}d.$currentFrame=n}))}hideLayerPreview(){if(!document.getElementById("timeline-preview").classList.contains("timeline-preview-active"))return;const e=document.getElementById("timeline-preview-modal");e.classList.contains("fadeOut")||(this._$timerId=setTimeout((()=>{e.classList.contains("fadeOut")||e.setAttribute("class","fadeOut")}),1e3))}selectLayer(e){if(e.button||d.$keyLock)return;e.stopPropagation(),d.$endMenu();const t=e.currentTarget;t.classList.contains("active")||this.activeLayer(t),this._$moveLayer||(this._$moveLayer=this.moveLayer.bind(this)),this._$executeMoveLayer||(this._$executeMoveLayer=this.executeMoveLayer.bind(this)),this._$moveLayerId=0|t.dataset.layerId,window.addEventListener("mousemove",this._$moveLayer),window.addEventListener("mouseup",this._$executeMoveLayer)}activeLayer(e){this.clearActiveFrames(),this.targetLayer=e,this._$selectLayerId=0|e.dataset.layerId;const t=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame;for(const e of this.targetLayers.values()){const a=0|e.dataset.layerId,s=t.getLayer(a);this.targetFrames.delete(a),this.addTargetFrame(s,r)}d.$timelineMarker.move(),this.activeCharacter()}selectRange(e){clearTimeout(this._$clickTimerId),e.stopPropagation(),d.$endMenu();const t=e.target,r=d.$timelineFrame.currentFrame,a=0|t.dataset.layerId,s=d.$currentWorkSpace().scene.getLayer(a);let i=null;const n=s.getActiveCharacter(r);if(n.length&&(i=n[0]),i||(i=s.getActiveEmptyCharacter(r)),!i)return;d.$tools.getDefaultTool("arrow").clear(),this.targetLayer=document.getElementById(`layer-id-${a}`);const o=i.getRange(r);for(let e=o.startFrame;o.endFrame>e;++e)this.addTargetFrame(s,e);this.moveFrame(r)}selectFrame(e){if(e.button)return;e.stopPropagation(),d.$endMenu();const t=document.getElementById("timeline-preview-modal");t.classList.contains("fadeOut")||t.setAttribute("class","fadeOut");const r=e.target,a=0|r.dataset.frame;this.changeLabel(a);const s=d.$tools.getDefaultTool("arrow"),i=0|r.dataset.layerId;let n=!1;if(this.targetFrames.has(i)){n=this.targetFrames.get(i).indexOf(a)>-1}if(n){const t=this.targetFrames.values().next().value;if(!t.length)return;clearTimeout(this._$clickTimerId),this._$clickTimerId=window.setTimeout((()=>{const r=this.targetLayer;if(!r)return;const a=Array.from(document.getElementById("timeline-content").children);let s=a.indexOf(r);if(this.targetFrames.size>1)for(const e of this.targetFrames.keys()){const t=document.getElementById(`layer-id-${e}`);t&&(s=Math.min(s,a.indexOf(t)))}const i=d.$timelineTool.getFirstFrame(),n=d.$currentWorkSpace().scene.getLayer(0|a[s].dataset.layerId).getChildren(i),o=document.getElementById("timeline-content"),l=t.length*(d.$timelineTool.timelineWidth+1)-5;this._$clientX=n.offsetLeft,this._$clientY=n.offsetTop-o.scrollTop;const c=document.getElementById("target-group");let h=`width: ${l}px;`;h+=`height: ${this.targetFrames.size*d.$timelineTool.timelineHeight-5}px;`,h+=`left: ${this._$clientX}px;`,h+=`top: ${this._$clientY}px;`,c.setAttribute("style",h),c.dataset.frame=`${i}`,c.dataset.index=`${s}`;const u=d.$timelineTool.timelineWidth+1;for(;!(this._$clientX+u>e.clientX);)this._$clientX+=u;for(;!(this._$clientY+30>e.clientY);)this._$clientY+=30;this._$moveTargetGroup||(this._$moveTargetGroup=this.moveTargetGroup.bind(this)),window.addEventListener("mousemove",this._$moveTargetGroup),this._$clickTimerId=-1}),200),this._$endTargetGroup||(this._$endTargetGroup=this.endTargetGroup.bind(this)),window.addEventListener("mouseup",this._$endTargetGroup)}else{d.$ctrlKey||s.clear(),this.targetLayer=document.getElementById(`layer-id-${i}`);const e=d.$currentWorkSpace().scene.getLayer(i);this.addTargetFrame(e,a),this._$multiSelect||(this._$multiSelect=this.multiSelect.bind(this)),this._$endMultiSelect||(this._$endMultiSelect=this.endMultiSelect.bind(this)),window.addEventListener("mousemove",this._$multiSelect),window.addEventListener("mouseup",this._$endMultiSelect),this.moveFrame(a)}}changeLabel(e){const t=document.getElementById("label-name");if(!t)return;t.blur(),t.value="";const r=d.$currentWorkSpace().scene;r.hasLabel(e)&&(t.value=r.getLabel(e))}moveFrame(e){const t=[];if(d.$timelineFrame.currentFrame!==e){d.$timelineFrame.currentFrame=e;const r=d.$timelineTool.timelineWidth,a=d.$timelineHeader.leftFrame,s=d.$timelineHeader.width/(r+1)|0;switch(!0){case a>e:case e>a+s-1:d.$timelineHeader.scrollX=(e-1)*r,d.$timelineHeader.rebuild(),this.moveTimeLine()}d.$timelineMarker.move(),d.$soundController.createSoundElements(),t.push(this.reloadScreen())}Promise.all(t).then((()=>{this.activeCharacter()}))}moveTargetGroup(e){window.requestAnimationFrame((()=>{const t=document.getElementById("target-group"),r=this.targetLayer;if(!r)return;const a=document.getElementById(`frame-scroll-id-${r.dataset.layerId}`),s=d.$timelineTool.timelineWidth,i=s+1,n=0|t.dataset.frame,o=0|t.dataset.index;if(e.clientX-this._$clientX>i){if(t.offsetLeft+t.offsetWidth+i>a.offsetLeft+a.offsetWidth){const r=document.getElementById("timeline-controller-base");return void(e.pageX>r.offsetLeft+r.offsetWidth&&(d.$timelineHeader.scrollX+=s,d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),t.dataset.frame=`${n+1}`))}return t.style.left=`${t.offsetLeft+i}px`,t.dataset.frame=`${n+1}`,void(this._$clientX+=i)}if(this._$clientX-e.clientX>i){if(a.offsetLeft>t.offsetLeft-i){const r=document.getElementById("timeline-controller-base");return void(d.$timelineHeader.scrollX>0&&r.offsetLeft>e.pageX&&(d.$timelineHeader.scrollX-=s,d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),t.dataset.frame=""+(n-1)))}return t.style.left=t.offsetLeft-i+"px",t.dataset.frame=""+(n-1),void(this._$clientX-=i)}if(e.clientY-this._$clientY>d.$timelineTool.timelineHeight-1){const e=document.getElementById("timeline-content"),r=Math.min(e.children.length*d.$timelineTool.timelineHeight,e.offsetHeight);return t.offsetTop+t.offsetHeight+d.$timelineTool.timelineHeight>e.offsetTop+r?void(d.$timelineScroll.maxY>=d.$timelineScroll.y+d.$timelineTool.timelineHeight&&(t.dataset.index=`${o+1}`,d.$timelineScroll.execute(0,d.$timelineTool.timelineHeight))):(t.style.top=`${t.offsetTop+d.$timelineTool.timelineHeight}px`,t.dataset.index=`${o+1}`,void(this._$clientY+=d.$timelineTool.timelineHeight-1))}if(this._$clientY-e.clientY>0){if(document.getElementById("timeline-content").offsetTop>t.offsetTop-d.$timelineTool.timelineHeight)return void(d.$timelineScroll.y>0&&(t.dataset.index=""+(o-1),d.$timelineScroll.execute(0,-d.$timelineTool.timelineHeight)));t.style.top=t.offsetTop-d.$timelineTool.timelineHeight+"px",t.dataset.index=""+(o-1),this._$clientY-=d.$timelineTool.timelineHeight-1}}))}pasteFrame(e,t,r,a,s,i=!1,n=!1,o=null,l=null){const c=a+s.length,d=this.createMoveCharacters(e,s,o,l),h=d.characters,u=d.emptys,m=this.createTweenMap(e,h);let g=0;const $=r+s.length;if(!i){const t=this.deleteSourceKeyFrame(e,h,r,$),a=this.deleteSourceEmptyKeyFrame(e,r,$);g=Math.max(t,a)}const p=this.deleteDestinationKeyFrame(t,a,c),f=this.deleteDestinationEmptyKeyFrame(t,a,c);this.moveKeyFrame(t,h,a-r),this.moveEmptyKeyFrame(t,u,a-r);const y=Math.max(c,g,p,f),_=Math.min(r,a);if(n||t.id!==e.id){const e=Math.max(p,f);this.adjustBehindFrame(t,1,e-1)}else this.adjustBehindFrame(t,_,y-1);(n||t.id!==e.id)&&this.adjustBehindFrame(e,1,g-1),a>1&&this.adjustPreviousFrame(t,a,y),1!==r||!n&&t.id===e.id||this.adjustPreviousFrame(e,a,g),this.characterIntegration(t,h),m.size&&!n&&t.id===e.id&&this.adjustTween(h,m,a-r),t.reloadStyle(),e!==t&&e.reloadStyle()}endTargetGroup(){if(window.removeEventListener("mousemove",this._$moveTargetGroup),window.removeEventListener("mouseup",this._$endTargetGroup),this._$clickTimerId>0)return clearTimeout(this._$clickTimerId),void(this._$clickTimerId=-1);this.hideTargetGroup();const e=this.targetLayer;if(!e)return;const t=document.getElementById("target-group"),r=0|t.dataset.frame;let a=0|t.dataset.index;const s=Array.from(document.getElementById("timeline-content").children);let i=s.indexOf(e);if(this.targetFrames.size>1)for(const e of this.targetFrames.keys()){const t=document.getElementById(`layer-id-${e}`);t&&(i=Math.min(i,s.indexOf(t)))}const n=0|s[a].dataset.layerId,o=0|s[i].dataset.layerId,l=d.$timelineTool.getFirstFrame();if(n===o&&l===r)return;this.save();const c=[];for(const[e,t]of this.targetFrames){const r=document.getElementById(`layer-id-${e}`);c.push({index:s.indexOf(r),value:{layerId:e,frames:t}})}c.sort(((e,t)=>{const r=0|e.index,a=0|t.index;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}}));let h=null;const u=d.$currentWorkSpace().scene;for(let e=0;e<c.length;++e){const t=c[e].value,i=t.layerId,n=t.frames;if(!s[a])break;h||(h=n.slice(),h.length>1&&h.sort(((e,t)=>{const r=0|e,a=0|t;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}})));const o=u.getLayer(i),m=u.getLayer(0|s[a++].dataset.layerId);this.pasteFrame(o,m,l,r,h,d.$altKey)}d.$tools.getDefaultTool("arrow").clear(),this.reloadScreen(),this._$saved=!1}adjustTween(e,t,r){for(const[a,s]of e){const e=s.endFrame-1;if(e>1&&e>s.startFrame&&s.hasTween(e)){const t=s.getRange(e),r=s.getRange(t.startFrame-1);if(s.hasTween(r.startFrame)){s.getTween(r.startFrame).endFrame=t.endFrame;s.getPlace(e).tweenFrame=r.startFrame,s.deleteTween(e)}}if(t.has(a))for(const[e,i]of t.get(a)){const t=s.getRange(e+r);i.tweenFrame=t.startFrame,s.setPlace(t.endFrame-1,i),d.$tweenController.relocationPlace(s,t.startFrame)}}}characterIntegration(e,t){for(const r of t.values()){let t=r;const a=r.startFrame-1;if(a){const s=e.getActiveCharacter(a);for(let a=0;a<s.length;++a){const i=s[a];if(i.libraryId===r.libraryId&&i.endFrame===r.startFrame){for(const[e,r]of i._$places)t.setPlace(e,r);for(const[e,r]of i._$tween)t.setTween(e,r);t.startFrame=i.startFrame,e.deleteCharacter(i.id);break}}}const s=r.endFrame,i=e.getActiveCharacter(s);for(let r=0;r<i.length;++r){const a=i[r];if(a.libraryId===t.libraryId&&a.startFrame===t.endFrame){for(const[e,r]of a._$places)t.setPlace(e,r);for(const[e,r]of a._$tween)t.setTween(e,r);t.endFrame=a.endFrame,e.deleteCharacter(a.id);break}}}}adjustBehindFrame(e,t,r){let a=r+1,s=r;for(;s>=t;){if(!e.getActiveCharacter(s).length&&!e.getActiveEmptyCharacter(s)){a=s+1;break}--s}let i=0;for(s=a-1;s>0;){const t=e.getActiveCharacter(s);if(t.length){for(let e=0;e<t.length;++e){const r=t[e],s=r.getPlace(r.endFrame-1);if(s.tweenFrame){r.getTween(s.tweenFrame).endFrame=a;const e=r.endFrame-1;for(let t=r.endFrame;a>t;++t)r.setPlace(t,r.getClonePlace(e))}r.endFrame=a,i=r.startFrame}break}const r=e.getActiveEmptyCharacter(s);if(r){r.endFrame=a,i=r.startFrame;break}--s}i&&i>t&&this.adjustBehindFrame(e,t,i-1)}adjustPreviousFrame(e,t,r){if(!r)return;let a=1;for(;t>=a&&(e.getActiveCharacter(a).length||e.getActiveEmptyCharacter(a));)++a;if(a>t)return;const s=new f({startFrame:a});for(;r>a&&!e.getActiveCharacter(a).length&&!e.getActiveEmptyCharacter(a);)++a;s.endFrame=a,e.addEmptyCharacter(s)}moveEmptyKeyFrame(e,t,r){for(let a=0;a<t.length;++a){const s=t[a];s.move(r),e.addEmptyCharacter(s)}}moveKeyFrame(e,t,r){for(const a of t.values())a.move(r),e.addCharacter(a)}deleteSourceEmptyKeyFrame(e,t,r){let a=0;const s=e._$emptys.slice(0);for(let i=0;i<s.length;++i){const n=s[i];if(t>=n.endFrame)continue;if(n.startFrame>=r)continue;if(a=Math.max(a,n.endFrame),a.startFrame>=t&&r>=a.endFrame){e.deleteEmptyCharacter(n);continue}let o=!1;for(let a=t;r>a;++a)if(n.startFrame===a){e.deleteEmptyCharacter(n),o=!0;break}o||n.endFrame>t&&(n.endFrame=t)}return a}deleteSourceKeyFrame(e,t,r,a){let s=0;for(const i of t.keys()){const t=e.getCharacter(i);if(!t)continue;if(t.startFrame>=r&&a>=t.endFrame){e.deleteCharacter(t.id),s=Math.max(s,t.endFrame);continue}if(r>t.startFrame){const i=t.getRange(a-1);s=Math.max(s,i.endFrame);const n=new p;n.libraryId=t.libraryId,n.startFrame=t.startFrame,n.endFrame=r;const o=new Map;for(const[e,a]of t._$places)r>e?n.setPlace(e,a):i.endFrame>e||o.set(e,a);const l=new Map;for(const[e,a]of t._$tween)r>e?n.setTween(e,a):i.endFrame>e||l.set(e,a);if(e.addCharacter(n),!o.size){e.deleteCharacter(t.id);continue}t._$tween=l,t._$places=o,t._$startFrame=i.endFrame,t._$cachePlaces.length=0;continue}const n=t.getRange(a-1);s=Math.max(s,n.endFrame);const o=new Map;for(const[e,r]of t._$places)n.endFrame>e||o.set(e,r);const l=new Map;for(const[e,r]of t._$tween)n.endFrame>e||l.set(e,r);o.size?(t._$tween=l,t._$places=o,t.startFrame=n.endFrame,t._$cachePlaces.length=0):e.deleteCharacter(t.id)}return s}deleteDestinationEmptyKeyFrame(e,t,r){const a=e._$emptys.slice();let s=0;for(let i=0;i<a.length;++i){const n=a[i];t>=n.endFrame||(n.startFrame>=r||(s=Math.max(n.endFrame,s),t>n.startFrame?n.endFrame=t:e.deleteEmptyCharacter(n)))}return s}deleteDestinationKeyFrame(e,t,r){let a=1;const s=e._$characters.slice();for(let i=0;i<s.length;++i){const n=s[i];if(!(t>=n.endFrame)&&!(n.startFrame>=r))if(n.startFrame>=t&&r>=n.endFrame)a=Math.max(a,n.endFrame),e.deleteCharacter(n.id);else{const s=n.getRange(r-1);a=Math.max(a,s.endFrame);for(let e=t;r>e&&!(e>=n.endFrame);++e){if(!n.hasPlace(e))continue;const r=n.getPlace(e);if(r.tweenFrame){const a=n.getRange(e);if(n.hasTween(e)){for(let e=a.startFrame;a.endFrame>e;++e)n.deletePlace(e);n.deleteTween(e)}else{for(let e=t;a.endFrame>e;++e)n.deletePlace(e);n.getTween(r.tweenFrame).endFrame=t,d.$tweenController.relocationPlace(n,r.tweenFrame)}}n.deletePlace(e)}if(n._$places.size){if(n.hasPlace(s.endFrame)){const t=n.clone(),r=new Map;for(const[e,a]of t._$places)s.endFrame>e||(n.deletePlace(e),r.set(e,a));const a=new Map;for(const[e,r]of t._$tween)s.endFrame>e||(n.deleteTween(e),a.set(e,r));r.size&&(t.startFrame=s.endFrame,t._$tween=a,t._$places=r,e.addCharacter(t))}if(n._$places.size){const e=n.getRange(t);n.hasTween(e.startFrame)&&(n.getTween(e.startFrame).endFrame=t),n.endFrame=t}else e.deleteCharacter(n.id)}else e.deleteCharacter(n.id)}}return Math.max(a,r)}createMoveCharacters(e,t,r=null,a=null){const s=new Map,i=[];let n=null,o=1;for(let l=0;l<t.length;++l){const c=t[l];if(e.getActiveEmptyCharacter(c)||e.getActiveCharacter(c).length){const t=e.getActiveCharacter(c);if(t.length){let e=0;if(r)for(let a=0;a<t.length;++a){const s=t[a];r.has(s.libraryId)&&e++}if(t.length>e){n&&(n.endFrame=c,i.push(n),n=null);for(let e=0;e<t.length;++e){const i=t[e];if(r&&r.has(i.libraryId))continue;if(!s.has(i.id)){const e=new p;e.libraryId=a?a.get(i.libraryId):i.libraryId,e.startFrame=c,e.endFrame=c+1,e.screenX=i.screenX,e.screenY=i.screenY;const t=i.getClonePlace(c);if(e.setPlace(c,t),t.tweenFrame){const r=i.getCloneTween(t.tweenFrame);r.startFrame=c,r.endFrame=c+1,t.tweenFrame=c,e.setTween(c,r)}s.set(i.id,e),o=Math.max(e.endFrame,o);continue}const n=s.get(i.id);if(i.hasPlace(c)){const e=i.getClonePlace(c);e.tweenFrame&&(e.tweenFrame=e.tweenFrame===c?c:n.getPlace(c).tweenFrame,n.hasTween(e.tweenFrame)||n.setTween(e.tweenFrame,i.getCloneTween(e.tweenFrame)),n.getTween(e.tweenFrame).endFrame=c+1),n.setPlace(c,e)}n.endFrame=c+1,o=Math.max(n.endFrame,o)}continue}}if(!n){n=new f,n.startFrame=c,n.endFrame=c+1,o=Math.max(n.endFrame,o);continue}n.endFrame=c+1,o=Math.max(n.endFrame,o)}else{if(n){n.endFrame=c+1;continue}if(s.size){let e=0;if(r)for(const t of s.values())r.has(t.libraryId)&&e++;if(s.size>e){for(const e of s.values()){if(e.endFrame!==o)continue;if(r&&r.has(e.libraryId))continue;const t=e.endFrame-1;if(e.hasPlace(t)){const r=e.getPlace(t);r.tweenFrame&&(e.setPlace(c,e.getClonePlace(t)),e.getTween(r.tweenFrame).endFrame=c+1,d.$tweenController.relocationPlace(e,t))}e.endFrame=c+1,o=c+1}continue}}n=new f,n.startFrame=c,n.endFrame=c+1}}return n&&i.push(n),{characters:s,emptys:i}}createTweenMap(e,t){const r=new Map;for(const[a,s]of t){const t=e.getCharacter(a);if(t)for(const e of s._$tween.values()){const s=t.getRange(e.startFrame),i=t.getClonePlace(s.endFrame-1);r.has(a)||r.set(a,new Map),r.get(a).set(e.startFrame,i)}}return r}clearActiveLayers(){for(const e of this.targetLayers.values())e.classList.remove("active");this.targetLayers.clear()}moveActiveFrame(){const e=d.$timelineTool.timelineWidth,t=d.$timelineHeader.width/(e+1)|0,r=d.$timelineHeader.leftFrame,a=r+t,s=d.$timelineTool.getFirstFrame(),i=d.$currentWorkSpace().scene;for(const[e,t]of this._$targetFrames){const n=i.getLayer(e);if(n)for(let e=0;e<t.length;++e){const t=s+e;if(r>t)continue;if(t>a)continue;const i=n.getChildren(t);i&&i.classList.add("frame-active")}}}clearActiveFrames(){const e=d.$currentWorkSpace();if(!e)return this.targetFrames.clear(),void this.hideTargetGroup();const t=e.scene;if(!t)return this.targetFrames.clear(),void this.hideTargetGroup();for(const[e,r]of this.targetFrames){const a=t.getLayer(e);if(a)for(let e=0;e<r.length;++e){const t=a.getChildren(r[e]);t&&t.classList.remove("frame-active")}}this.targetFrames.clear(),this.hideTargetGroup()}hideTargetGroup(){const e=document.getElementById("target-group");e&&(e.style.display="none")}multiSelect(e,t=null){const r=e?e.target:t,a=0|r.dataset.frame;if(!a)return;if(!("layerId"in r.dataset))return;const s=this.targetLayer;if(!s)return;e&&(e.stopPropagation(),e.preventDefault());const i=0|this.targetFrames.keys().next().value,n=this.targetFrames.values().next().value[0],o=Math.min(a,n),l=Math.max(a,n)+1,c=[i],h=0|r.dataset.layerId;if(i!==h){const e=Array.from(document.getElementById("timeline-content").children),t=e.indexOf(s),r=e.indexOf(document.getElementById(`layer-id-${h}`));if(r>t){const a=r-t+1;for(let r=1;r<a;++r)c.push(0|e[t+r].dataset.layerId)}else{const a=t-r+1;for(let r=1;r<a;++r)c.push(0|e[t-r].dataset.layerId)}}this.clearActiveFrames();const u=d.$currentWorkSpace().scene;for(let e=0;e<c.length;++e){const t=0|c[e],r=u.getLayer(t);for(let e=o;e<l;++e)this.addTargetFrame(r,e)}const m=this.targetFrames.get(i);m.splice(m.indexOf(n),1),m.unshift(n),this.activeCharacter()}endMultiSelect(){d.$setCursor("auto"),window.removeEventListener("mousemove",this._$multiSelect),window.removeEventListener("mouseup",this._$endMultiSelect)}};d.$timelineLayerMenu=new class extends me{initialize(){super.initialize();const e=["timeline-layer-normal","timeline-layer-mask","timeline-layer-guide","timeline-layer-copy","timeline-layer-paste"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e)}))}const t=document.getElementById("timeline-layer-color");t&&t.addEventListener("change",(e=>{e.stopPropagation(),this.changeLayerHighlightColor(e)}));const r=document.getElementById("timeline-layer-scale");r&&r.addEventListener("change",(e=>{e.stopPropagation(),d.$endMenu(),this.changeLayerScale(e)}))}changeLayerScale(e){const t=+e.target.value,r=_e.DEFAULT_TIMELINE_HEIGHT-1,a=d.$timelineScroll.y;d.$timelineScroll.execute(0,-a),d.$timelineTool.timelineHeight=r*t,d.$timelineScroll.execute(0,a)}executeTimelineLayerNormal(){d.$endMenu();const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$currentWorkSpace().scene,r=0|e.dataset.layerId,a=t.getLayer(r);if(a.mode===I.NORMAL)return;this.save();const s=this.resetLayer(e);a.mode=I.NORMAL,a.showIcon(),s&&this.reloadScreen(),super.focusOut()}executeTimelineLayerMask(){d.$endMenu();const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId);if(t.mode===I.MASK)return;this.save();const r=this.resetLayer(e);t.mode=I.MASK,t.showIcon(),(r||t.lock)&&this.reloadScreen(),super.focusOut()}executeTimelineLayerCopy(){d.$endMenu(),d.$timelineMenu.executeContextMenuLayerCopy()}executeTimelineLayerPaste(){d.$endMenu(),d.$timelineMenu.executeContextMenuLayerPaste()}executeTimelineLayerGuide(){d.$endMenu();const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId);if(t.mode===I.GUIDE)return;this.save();const r=this.resetLayer(e);t.mode=I.GUIDE,t.showIcon(),r&&this.reloadScreen(),super.focusOut()}changeLayerHighlightColor(e){this.save();const t=0|e.target.dataset.layerId,r=d.$currentWorkSpace().scene.getLayer(t);r.color=e.target.value;document.getElementById(`layer-light-icon-${t}`).style.backgroundImage=`url('${r.getHighlightURL()}')`,r.light&&(document.getElementById(`layer-id-${t}`).style.borderBottom=`1px solid ${r.color}`),super.focusOut(),d.$endMenu()}resetLayer(e){const t=d.$currentWorkSpace().scene,r=t.getLayer(0|e.dataset.layerId),a=Array.from(document.getElementById("timeline-content").children);let s=!1,i=a.indexOf(e);switch(r.mode){case I.MASK:for(;;){const e=a[++i];if(!e)break;const r=t.getLayer(0|e.dataset.layerId);if(r.mode!==I.MASK_IN)break;r.maskId=null,r.mode=I.NORMAL,r.showIcon(),s=!0}break;case I.GUIDE:for(;;){const e=a[++i];if(!e)break;const r=t.getLayer(0|e.dataset.layerId);if(r.mode!==I.GUIDE_IN)break;r.guideId=null,r.mode=I.NORMAL,r.showIcon()}}return s}show(e){e.stopPropagation(),d.$endMenu("timeline-layer-menu");const t=0|e.target.dataset.layerId,r=d.$currentWorkSpace().scene.getLayer(t),a=document.getElementById("timeline-layer-color");a.dataset.layerId=`${t}`,a.value=r.color;const s=document.getElementById("timeline-layer-menu");s.style.left=`${e.pageX+5}px`,s.style.top=e.pageY-s.clientHeight+"px",15>s.offsetTop&&(s.style.top="10px"),e.pageY+15>window.innerHeight&&(s.style.top=e.pageY-s.clientHeight-15+"px"),s.setAttribute("class","fadeIn")}};d.$timelineMarker=new class extends me{constructor(){super(),this._$left=0,this._$pointerEvents="",this._$clientWidth=0,this._$offsetTop=0,this._$markerClientWidth=0,this._$controllerWidth=0,this._$timelineHeight=0,this._$moveMarker=null,this._$endMarker=null}initialize(){super.initialize();const e=document.getElementById("timeline-marker");e&&e.addEventListener("mousedown",(e=>{e.button||this.startMarker()}))}startMarker(){d.$tools.getDefaultTool("arrow").clear(),this._$pointerEvents="none",document.getElementById("timeline-marker").setAttribute("style",`left: ${this._$left}px; pointer-events: none;`),this._$moveMarker||(this._$moveMarker=this.moveMarker.bind(this)),this._$endMarker||(this._$endMarker=this.endMarker.bind(this)),window.addEventListener("mousemove",this._$moveMarker),window.addEventListener("mouseup",this._$endMarker),document.getElementById("label-name").blur()}moveMarker(e){d.$setCursor("ew-resize"),window.requestAnimationFrame((()=>{const t=document.getElementById("timeline-controller-base"),r=d.$timelineTool.timelineWidth;if(e.pageX+r>t.offsetLeft+t.offsetWidth){const a=(e.pageX+2*r-(t.offsetLeft+t.offsetWidth))/r|0;if(!a)return;return d.$timelineFrame.currentFrame+=a,d.$timelineHeader.scrollX+=a*r,d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),this.move(),void this.reloadScreen()}if(t.offsetLeft>e.pageX-r){let a=(t.offsetLeft-e.pageX-r)/r|0;if(!a||1===d.$timelineFrame.currentFrame)return;return a>0&&(a*=-1),d.$timelineFrame.currentFrame+=a,d.$timelineHeader.scrollX+=a*r,d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),this.move(),void this.reloadScreen()}let a=0|e.target.dataset.frame;if(!a)return;d.$timelineFrame.currentFrame!==a&&(d.$timelineFrame.currentFrame=a,this.move(),this.reloadScreen())}))}endMarker(){d.$setCursor("auto"),window.removeEventListener("mousemove",this._$moveMarker),window.removeEventListener("mouseup",this._$endMarker),this._$pointerEvents="",document.getElementById("timeline-marker").setAttribute("style",`left: ${this._$left}px;`);const e=d.$currentWorkSpace().scene.getLabel(d.$timelineFrame.currentFrame);document.getElementById("label-name").value=e||""}move(){const e=document.getElementById("timeline-marker");if(!e)return;const t=d.$timelineTool.timelineWidth,r=t+1,a=1+d.$timelineHeader.scrollX/t|0,s=d.$timelineFrame.currentFrame-a;this._$left=s*r;let i=`left: ${this._$left}px;`;this._$pointerEvents&&(i+="pointer-events: none;"),e.setAttribute("style",i),this.setMarkerPosition()}setMarkerPosition(){const e=document.getElementById("timeline-marker");if(!e)return;this._$markerClientWidth||(this._$markerClientWidth=e.clientWidth);const t=document.getElementById("timeline-content");if(!t)return;const r=d.$currentWorkSpace();this._$controllerWidth!==r._$controllerWidth&&(this._$controllerWidth=r._$controllerWidth,this._$clientWidth=t.clientWidth),this._$timelineHeight!==r._$timelineHeight&&(this._$timelineHeight=r._$timelineHeight,this._$offsetTop=t.offsetTop);const a=document.getElementById("timeline-marker-border");if(!a)return;const s=this._$left;if(0>s||this._$clientWidth>0&&s+318-45>=this._$clientWidth)return void a.setAttribute("style","display: none;");const i=318+this._$markerClientWidth/2+s,n=this._$offsetTop-1,o=window.screen.height;a.setAttribute("style",`height: ${o}px; top: ${0|n}px; left: ${0|i}px;`)}};d.$timelineMenu=new class extends me{constructor(){super(),this._$copyWorkSpaceId=-1,this._$copyLayers=[],this._$copyFrames=new Map,this._$copyScene=null,this._$targetLayer=null}initialize(){super.initialize();const e=["context-menu-script-add","context-menu-frame-add","context-menu-key-frame-add","context-menu-empty-key-frame-add","context-menu-frame-delete","context-menu-key-frame-delete","context-menu-tween-add","context-menu-tween-delete","context-menu-frame-copy","context-menu-frame-paste","context-menu-layer-copy","context-menu-layer-paste","context-menu-layer-clone","context-menu-first-frame","context-menu-last-frame","context-menu-key-frame-change"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),d.$endMenu(),this.executeFunction(e)}))}}executeContextMenuKeyFrameChange(){if(!d.$timelineLayer.targetLayer)return;this.save();const e=d.$currentWorkSpace().scene;let t=null;const r=d.$timelineLayer.targetFrames;for(let[a,s]of r){const r=e.getLayer(a);if(r._$characters.length||r._$emptys.length){t||(t=s.slice().sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}})));for(let e=0;e<t.length;++e){const a=t[e],s=r.getActiveCharacter(a);if(s.length){for(let e=0;e<s.length;++e){const t=s[e],r=t.getPlace(a);if(r.tweenFrame){const e=r.tweenFrame,s=t.getTween(e);for(let e=a;s.endFrame>e;++e){t.getPlace(e).tweenFrame=a}const i=t.getCloneTween(e);i.startFrame=a,i.endFrame=s.endFrame,t.setTween(a,i),s.endFrame=a}else t.hasPlace(a)||t.setPlace(a,t.getClonePlace(a))}continue}const i=r.getActiveEmptyCharacter(a);i&&i.startFrame!==a&&(r.addEmptyCharacter(new f({startFrame:a,endFrame:i.endFrame})),i.endFrame=a)}r.reloadStyle()}}d.$timelineTool.setActiveFrame(),this._$saved=!1}executeContextMenuFirstFrame(){const e=d.$timelineLayer.targetLayer;if(!e)return;d.$tools.getDefaultTool("arrow").clear(),d.$timelineFrame.currentFrame=1,d.$timelineHeader.scrollX=0,d.$timelineHeader.rebuild(),d.$timelineMarker.move(),d.$timelineLayer.moveTimeLine(),d.$timelineLayer.targetLayer=e;const t=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId);d.$timelineLayer.addTargetFrame(t,1),this.reloadScreen()}executeContextMenuLastFrame(){const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$currentWorkSpace().scene.totalFrame;if(2>t)return;d.$tools.getDefaultTool("arrow").clear();const r=d.$timelineTool.timelineWidth;d.$timelineFrame.currentFrame=t,d.$timelineHeader.scrollX=(t-1)*r,d.$timelineHeader.rebuild(),d.$timelineMarker.move(),d.$timelineLayer.moveTimeLine(),d.$timelineLayer.targetLayer=e;const a=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId);d.$timelineLayer.addTargetFrame(a,t),this.reloadScreen()}executeContextMenuFrameCopy(){if(this._$copyScene=null,this._$copyFrames.clear(),this._$targetLayer=d.$timelineLayer.targetLayer,!this._$targetLayer)return;this._$copyWorkSpaceId=d.$activeWorkSpaceId,this._$copyScene=d.$currentWorkSpace().scene;const e=d.$timelineLayer.targetFrames,t=Array.from(document.getElementById("timeline-content").children),r=[];for(const[a,s]of e){const e=document.getElementById(`layer-id-${a}`);r.push({index:t.indexOf(e),value:{layerId:a,frames:s}})}r.sort(((e,t)=>{const r=0|e.index,a=0|t.index;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}}));for(let e=0;e<r.length;++e){const t=r[e].value;this._$copyFrames.set(t.layerId,t.frames.slice())}}executeContextMenuFramePaste(){const e=d.$timelineLayer.targetLayer;if(!e)return;if(!this._$copyFrames.size)return;clearTimeout(d.$timelineLayer._$clickTimerId),d.$timelineLayer._$clickTimerId=-1,this.save(),d.$timelineLayer.hideTargetGroup();const t=this._$copyFrames.values().next().value.slice();t.length>1&&t.sort(((e,t)=>{const r=0|e,a=0|t;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}}));let r=Number.MAX_VALUE;for(let e=0;e<t.length;++e)r=Math.min(r,t[e]);const a=d.$timelineFrame.currentFrame;let s=Array.from(document.getElementById("timeline-content").children);const i=d.$workSpaces[this._$copyWorkSpaceId],n=d.$currentWorkSpace();let o=s.indexOf(e);if(this._$copyWorkSpaceId!==d.$activeWorkSpaceId){if(this._$copyFrames.size>1&&this._$copyFrames.size>s.length){const t=this._$copyFrames.size-1;for(let e=0;e<t;++e)d.$timelineTool.executeTimelineLayerAdd();s=Array.from(document.getElementById("timeline-content").children),o=s.indexOf(e)-t}if(!d.$workSpaces[this._$copyWorkSpaceId])return;d.$confirmModal.clear(),d.$confirmModal.addCallback((e=>{const t=this._$copyFrames.values().next().value.slice();t.length>1&&t.sort(((e,t)=>{const r=0|e,a=0|t;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}}));let r=Number.MAX_VALUE;for(let e=0;e<t.length;++e)r=Math.min(r,t[e]);const a=d.$currentWorkSpace().scene;for(const i of this._$copyFrames.keys()){const n=this._$copyScene.getLayer(i);if(!n){d.$confirmModal.clear(),this._$copyScene=null,this._$copyFrames.clear();break}const l=a.getLayer(0|s[o++].dataset.layerId),c=d.$confirmModal._$mapping,h=d.$timelineFrame.currentFrame;d.$timelineLayer.pasteFrame(n,l,r,h,t,!0,!1,e,c)}}));const t=d.$confirmModal._$mapping;for(const e of this._$copyFrames.keys()){const r=this._$copyScene.getLayer(e);if(!r){d.$confirmModal.clear(),this._$copyFrames.clear();break}for(let e=0;r._$characters.length>e;++e){const a=r._$characters[e].libraryId;if(t.has(a))continue;const s=i.getLibrary(a);if(!s)continue;const o=s.getPathWithWorkSpace(i);if(n._$nameMap.has(o)){d.$confirmModal.files.push({file:s,path:o,workSpaceId:this._$copyWorkSpaceId,type:"copy"});continue}let l=null;if(s.type===b.MOVIE_CLIP)l=d.$confirmModal.cloneMovieClip(this._$copyWorkSpaceId,s);else{const e=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$copyWorkSpaceId,l=s.clone(),d.$activeWorkSpaceId=e}l._$id=n.nextLibraryId,t.set(a,l.id),d.$libraryController.createInstance(l.type,l.name,l.id,l.symbol),n._$libraries.set(l.id,l),l.folderId&&d.$confirmModal.createFolder(this._$copyWorkSpaceId,l)}}d.$confirmModal.files.length?d.$confirmModal.show():(d.$confirmModal.executeCallBack(),d.$confirmModal.clear(),d.$libraryController.reload())}else{const e=n.scene,i=this._$copyScene===e;for(const n of this._$copyFrames.keys()){const l=this._$copyScene.getLayer(n);if(!l){this._$copyFrames.clear();break}const c=e.getLayer(0|s[o++].dataset.layerId);d.$timelineLayer.pasteFrame(l,c,r,a,t,!0,i)}}d.$tools.getDefaultTool("arrow").clear(),this.reloadScreen()}clearCopy(){this._$copyWorkSpaceId=-1,this._$copyLayers.length=0}executeContextMenuLayerCopy(){this.clearCopy(),this._$copyWorkSpaceId=d.$activeWorkSpaceId;const e=d.$timelineLayer.targetLayers,t=d.$currentWorkSpace().scene;for(const r of e.values()){const e=t.getLayer(0|r.dataset.layerId);this._$copyLayers.push(e.clone())}}executeContextMenuLayerPaste(){const e=document.getElementById("timeline-content");if(!e)return;const t=d.$workSpaces[this._$copyWorkSpaceId],r=d.$currentWorkSpace();this.save();let a=d.$timelineLayer.targetLayer;a||(d.$timelineLayer.attachLayer(),a=d.$timelineLayer.targetLayer);const s=r.scene;if(this._$copyWorkSpaceId!==d.$activeWorkSpaceId){if(!d.$workSpaces[this._$copyWorkSpaceId])return;d.$confirmModal.clear();const i=d.$confirmModal._$mapping;for(let n=0;n<this._$copyLayers.length;++n){const o=this._$copyLayers[n],l=new v;for(let e=0;e<o._$characters.length;++e){const a=o._$characters[e],s=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$copyWorkSpaceId;const n=new p(JSON.parse(JSON.stringify(a.toObject())));n._$id=r._$characterId++,d.$activeWorkSpaceId=s;const c=n.libraryId;if(i.has(c)){const e=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$copyWorkSpaceId;const t=new p(JSON.parse(JSON.stringify(a.toObject())));d.$activeWorkSpaceId=e,t.libraryId=i.get(c),l.addCharacter(t);continue}const h=t.getLibrary(c);if(!h)continue;const u=h.getPathWithWorkSpace(t);if(r._$nameMap.has(u)){d.$confirmModal.files.push({file:h,character:n,layer:l,path:u,workSpaceId:this._$copyWorkSpaceId,type:"copy"});continue}l.addCharacter(n);let m=null;if(h.type===b.MOVIE_CLIP)m=d.$confirmModal.cloneMovieClip(this._$copyWorkSpaceId,h);else{const e=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$copyWorkSpaceId,m=h.clone(),d.$activeWorkSpaceId=e}const g=r.nextLibraryId;n.libraryId=m._$id=g,i.set(h.id,m.id),d.$libraryController.createInstance(m.type,m.name,m.id,m.symbol),r._$libraries.set(m.id,m),m.folderId&&d.$confirmModal.createFolder(this._$copyWorkSpaceId,m)}for(let e=0;e<o._$emptys.length;++e)l.addEmptyCharacter(o._$emptys[e].clone());s.addLayer(l);const c=e.lastElementChild;e.insertBefore(c,a)}d.$libraryController.reload()}else for(let t=0;t<this._$copyLayers.length;++t){const i=this._$copyLayers[t].clone();s.addLayer(i),i._$instances.clear();for(let e=0;e<i._$characters.length;++e){const t=i._$characters[e];t._$id=r._$characterId++,i._$instances.set(t.id,t)}const n=e.lastElementChild;e.insertBefore(n,a)}const i=[];for(let t=0;t<e.children.length;++t)i.push(s.getLayer(0|e.children[t].dataset.layerId));s.clearLayer();for(let e=0;e<i.length;++e){const t=i[e];s.setLayer(t.id,t)}d.$confirmModal.files.length?d.$confirmModal.show():d.$confirmModal.clear(),this.reloadScreen(),super.focusOut()}executeContextMenuLayerClone(){this.executeContextMenuLayerCopy(),this.executeContextMenuLayerPaste()}executeContextMenuScriptAdd(){d.$javaScriptEditor.show()}executeContextMenuFrameAdd(){d.$timelineTool.executeTimelineFrameAdd()}executeContextMenuKeyFrameAdd(){d.$timelineTool.executeTimelineKeyAdd()}executeContextMenuKeyFrameDelete(){d.$timelineTool.executeTimelineKeyDelete()}executeContextMenuEmptyKeyFrameAdd(){d.$timelineTool.executeTimelineEmptyAdd()}executeContextMenuFrameDelete(){d.$timelineTool.executeTimelineFrameDelete()}executeContextMenuTweenAdd(){const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),a=r.getActiveCharacter(t);if(!a.length)return;if(a.length>1)return void alert("If you want to add motion tweening to multiple objects, please do so in a single MovieClip.");const s=a[0],i=s.getRange(t);s.hasTween(i.startFrame)||(this.save(),s.setTween(i.startFrame,{method:"linear",curve:[],custom:d.$tweenController.createEasingObject(),startFrame:i.startFrame,endFrame:i.endFrame}),s.updateTweenPlace(i.startFrame,i.endFrame),s.relocationTween(i.startFrame),r.reloadStyle(),s.dispose(),this.reloadScreen(),this._$saved=!1)}executeContextMenuTweenDelete(){if(!d.$timelineLayer.targetLayer)return;const e=d.$currentWorkSpace().scene;for(let[t,r]of d.$timelineLayer.targetFrames){const a=e.getLayer(t);for(let e=0;e<r.length;++e){const t=r[e],s=a.getActiveCharacter(t);if(!s.length||s.length>1)continue;const i=s[0],n=i.getRange(t);if(!i.hasTween(n.startFrame))continue;this.save();for(let e=n.startFrame+1;n.endFrame>e;++e)i.hasPlace(e)&&i.deletePlace(e);i.deleteTween(n.startFrame);delete i.getPlace(n.startFrame).tweenFrame,i.dispose()}a.reloadStyle()}d.$tweenController.clearPointer(),this.reloadScreen(),this._$saved=!1}show(e){d.$endMenu("timeline-menu");const t=document.getElementById("timeline-menu");t.style.left=`${e.pageX+5}px`,t.style.top=e.pageY-t.clientHeight+"px",15>t.offsetTop&&(t.style.top="10px"),e.pageY+15>window.innerHeight&&(t.style.top=e.pageY-t.clientHeight-15+"px"),t.setAttribute("class","fadeIn")}};d.$timelinePlayer=new class extends me{constructor(){super(),this._$stopFlag=!0,this._$repeat=!1,this._$totalFrame=0,this._$startTime=0,this._$fps=0,this._$timerId=-1,this._$baseOffsetHalfWidth=0,this._$sounds=[],this._$clientWidth=0,this._$run=null}get repeat(){return this._$repeat}get stopFlag(){return this._$stopFlag}initialize(){super.initialize();const e=["timeline-play","timeline-stop","timeline-repeat","timeline-no-repeat"];for(let t=0;t<e.length;++t){const r=e[t],a=document.getElementById(r);if(a){switch(r){case"timeline-stop":case"timeline-repeat":a.style.display="none"}a.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e),d.$endMenu()}))}}this._$run=this.run.bind(this)}executeTimelinePlay(){if(this._$stopFlag){"next2d"in window&&d.$root.stage._$player._$loadWebAudio();const e=d.$currentWorkSpace().scene;if(this._$totalFrame=e.totalFrame,this._$totalFrame>1){this._$stopFlag=!1,this._$timerId>-1&&window.cancelAnimationFrame(this._$timerId);d.$tools.getDefaultTool("arrow").clear(),d.$timelineFrame.currentFrame>=this._$totalFrame&&(d.$timelineFrame.currentFrame=1,d.$timelineHeader.scrollX=0,d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),d.$timelineMarker.move(),this.reloadScreen()),e.startSound(d.$timelineFrame.currentFrame),document.getElementById("timeline-play").style.display="none",document.getElementById("timeline-stop").style.display="";const t=document.getElementById("timeline-controller-base");this._$baseOffsetHalfWidth=t.offsetWidth/2,this._$clientWidth=t.clientWidth,this._$startTime=window.performance.now(),this._$fps=1e3/(0|document.getElementById("stage-fps").value),this._$timerId=window.requestAnimationFrame(this._$run)}}else this.executeTimelineStop()}stopAllSound(){for(let e=0;e<this._$sounds.length;++e){this._$sounds[e].stop()}this._$sounds.length=0}executeTimelineStop(){window.cancelAnimationFrame(this._$timerId),this.stopAllSound(),this._$stopFlag=!0,this._$timerId=-1,document.getElementById("timeline-play").style.display="",document.getElementById("timeline-stop").style.display="none",this.reloadScreen()}executeTimelineRepeat(){document.getElementById("timeline-repeat").style.display="none",document.getElementById("timeline-no-repeat").style.display="",this._$repeat=!1}executeTimelineNoRepeat(){document.getElementById("timeline-repeat").style.display="",document.getElementById("timeline-no-repeat").style.display="none",this._$repeat=!0}run(e=0){if(this._$stopFlag)return;let t=e-this._$startTime;if(t>this._$fps){let r=d.$timelineFrame.currentFrame+1;if(r>this._$totalFrame){if(!this._$repeat)return this.executeTimelineStop();r=1,d.$timelineHeader.scrollX=0,d.$timelineLayer.moveTimeLine()}d.$timelineFrame.currentFrame=r;const a=d.$timelineTool.timelineWidth,s=(r-(d.$timelineHeader.scrollX/a|0))*(a+1);(0>=s||s>this._$clientWidth)&&(d.$timelineHeader.scrollX=(r-1)*a),d.$timelineHeader.rebuild(),d.$timelineMarker.move();(r-1)*(d.$timelineTool.timelineWidth+1)>this._$baseOffsetHalfWidth&&d.$timelineLayer.moveTimeLine(),this._$startTime=e-t%this._$fps,this.reloadScreen()}this._$timerId=window.requestAnimationFrame(this._$run)}};class ye extends me{constructor(){super(),this._$x=0,this._$y=0,this._$pageX=0,this._$pageY=0,this._$mouseMove=null,this._$mouseUp=null}static get FRAME_COUNT(){return 600}initialize(){super.initialize();const e=["timeline-scroll-bar-x","timeline-scroll-bar-y"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&(r.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault(),d.$endMenu(),this.executeFunction(e)})),r.addEventListener("wheel",(e=>{e.stopPropagation(),e.preventDefault(),d.$endMenu(),"timeline-scroll-bar-y"===e.target.id?this.executeTimelineYBarBox(e):this.executeTimelineXBarBox(e)}),{passive:!1}))}const t=["timeline-x-bar-box","timeline-y-bar-box"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);r&&r.addEventListener("wheel",(e=>{e.stopPropagation(),e.preventDefault(),d.$endMenu(),this.executeFunction(e)}),{passive:!1})}}get x(){return this._$x}set x(e){this._$x=Math.max(0,Math.min(e,this.maxX)),this.viewX()}get y(){return this._$y}set y(e){this._$y=e,this.viewY()}executeTimelineXBarBox(e){const t=0|e.deltaX;if(!t)return!1;window.requestAnimationFrame((()=>{d.$timelineScroll.execute(t,0)}))}executeTimelineYBarBox(e){const t=0|e.deltaY;if(!t)return!1;window.requestAnimationFrame((()=>{d.$timelineScroll.execute(0,t)}))}executeTimelineScrollBarX(e){this._$pageX=e.pageX,this._$pageY=0,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}executeTimelineScrollBarY(e){this._$pageX=0,this._$pageY=e.pageY,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){e.stopPropagation(),e.preventDefault(),window.requestAnimationFrame((()=>{const t=d.$currentWorkSpace().scene;if(this._$pageY){const r=e.pageY-this._$pageY;if(r){const e=t._$layers.size*d.$timelineTool.timelineHeight/d.$timelineLayer.clientHeight;this.execute(0,r*e)}this._$pageY=e.pageY}if(this._$pageX){const r=e.pageX-this._$pageX;if(r){const e=d.$timelineLayer.clientWidth,a=(t.totalFrame+ye.FRAME_COUNT)*d.$timelineTool.timelineWidth/e;this.execute(r*a,0)}this._$pageX=e.pageX}}))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),this._$pageX=0,this._$pageY=0}get maxX(){const e=d.$currentWorkSpace().scene,t=d.$timelineLayer.clientWidth-10;return(e.totalFrame+ye.FRAME_COUNT)*d.$timelineTool.timelineWidth-t}get maxY(){const e=d.$currentWorkSpace().scene,t=d.$timelineLayer.clientHeight/d.$timelineTool.timelineHeight|0;return(e._$layers.size-t)*d.$timelineTool.timelineHeight}execute(e=0,t=0){const r=d.$currentWorkSpace();if(!r)return;const a=r.scene;if(!a)return;const s=this.x;e&&(this.x=Math.max(0,Math.min(this.x+e,this.maxX)),d.$timelineHeader.scrollX=this.x);const i=this.y;if(t){const e=a._$layers.size*d.$timelineTool.timelineHeight;if(d.$timelineLayer.clientHeight>e)this.y=0;else{if((d.$timelineLayer.clientHeight/d.$timelineTool.timelineHeight|0)>=a._$layers.size)return void this.viewY();this.y=Math.max(0,Math.min(this.y+t,this.maxY))}}i===this.y&&s===this.x||(s!==this.x&&(d.$timelineMarker.move(),d.$timelineHeader.rebuild()),d.$timelineLayer.moveTimeLine())}updateWidth(){const e=d.$currentWorkSpace();if(!e)return;const t=e.scene;if(!t)return;const r=d.$timelineLayer.clientWidth,a=r*(r/((t.totalFrame+ye.FRAME_COUNT)*d.$timelineTool.timelineWidth))|0;document.documentElement.style.setProperty("--timeline-scroll-bar-width",a-2+"px"),this.viewX()}updateHeight(){const e=d.$currentWorkSpace();if(!e)return;const t=e.scene;if(!t)return;const r=d.$timelineLayer.clientHeight,a=r/d.$timelineTool.timelineHeight|0;if(t._$layers.size>a){const e=(r-(r-(a*d.$timelineTool.timelineHeight|0)))*(r/(t._$layers.size*d.$timelineTool.timelineHeight))|0;document.documentElement.style.setProperty("--timeline-scroll-bar-height",e-2+"px")}this.viewY()}viewX(){const e=document.getElementById("timeline-scroll-bar-x");if(e){const t=d.$currentWorkSpace();if(!t)return;const r=t.scene;if(!r)return;const a=d.$timelineLayer.clientWidth/((r.totalFrame+ye.FRAME_COUNT)*d.$timelineTool.timelineWidth),s=this.x*a|0;e.style.left=`${s+1}px`}}viewY(){const e=document.getElementById("timeline-scroll-bar-y");if(e){const t=d.$currentWorkSpace();if(!t)return;const r=t.scene;if(!r)return;if((d.$timelineLayer.clientHeight/d.$timelineTool.timelineHeight|0)>=r._$layers.size)return void(e.style.display="none");e.style.display="";const a=d.$timelineLayer.clientHeight/(r._$layers.size*d.$timelineTool.timelineHeight),s=this.y*a|0;e.style.top=`${s+1}px`}}}d.$timelineScroll=new ye;class _e extends me{constructor(){super(),this._$labelFrame=0,this._$timelineWidth=_e.DEFAULT_TIMELINE_WIDTH,this._$timelineHeight=_e.DEFAULT_TIMELINE_HEIGHT,this._$lightAll=!1,this._$lockAll=!1,this._$disableAll=!1,this._$preview=!1}initialize(){super.initialize();const e=["timeline-layer-add","timeline-layer-trash","timeline-layer-light-all","timeline-layer-disable-all","timeline-layer-lock-all","timeline-script-add","timeline-frame-add","timeline-key-add","timeline-empty-add","timeline-frame-delete","timeline-onion-skin","timeline-preview","scene-list"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e)}))}const t=["label-name"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);r&&(r.addEventListener("focusin",(e=>{this.focusIn(e)})),r.addEventListener("keypress",(e=>{"Enter"===e.key&&e.target.blur()})),r.addEventListener("focusout",(e=>{this.executeFunction(e)})))}const r=document.getElementById("timeline-scale");r&&this.setInputEvent(r)}get preview(){return this._$preview}static get DEFAULT_TIMELINE_WIDTH(){return 13}static get DEFAULT_TIMELINE_HEIGHT(){return 31}get timelineHeight(){return this._$timelineHeight}set timelineHeight(e){this._$timelineHeight=e,document.documentElement.style.setProperty("--timeline-frame-height",`${e}px`),d.$timelineScroll.updateHeight(),d.$timelineLayer.moveTimeLine()}get timelineWidth(){return this._$timelineWidth}set timelineWidth(e){this._$timelineWidth=e,document.documentElement.style.setProperty("--timeline-frame-width",`${e}px`),document.documentElement.style.setProperty("--marker-width",`${d.$clamp(e,4,_e.DEFAULT_TIMELINE_WIDTH)}px`),document.getElementById("timeline-scale").value=""+(e/_e.DEFAULT_TIMELINE_WIDTH*100|0),d.$timelineScroll.updateWidth(),d.$timelineHeader.rebuild(),d.$timelineMarker.move()}focusIn(){super.focusIn(),this._$labelFrame=d.$timelineFrame.currentFrame}executeLabelName(e){if(!this._$labelFrame)return;const t=d.$timelineHeader.leftFrame;if(t>this._$labelFrame)return;const r=this._$labelFrame-t,a=document.getElementById("timeline-header").children[r].children[pe.MARKER_INDEX],s=e.target.value,i=d.$currentWorkSpace().scene;if(s)this.save(),i.setLabel(this._$labelFrame,s),a.setAttribute("class","frame-border-box-marker");else{i.getLabel(this._$labelFrame)&&(this.save(),i.deleteLabel(this._$labelFrame),a.setAttribute("class","frame-border-box"))}super.focusOut(),this._$labelFrame=0}changeTimelineScale(e){return e=d.$clamp(0|e,41,2e3),this.timelineWidth=_e.DEFAULT_TIMELINE_WIDTH*e/100,d.$timelineHeader._$currentFrame=-1,d.$timelineHeader.rebuild(),d.$timelineMarker.move(),d.$timelineLayer.moveTimeLine(),e}executeTimelineLayerLockAll(){this._$lockAll=!this._$lockAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene;let r=!1;const a=e.children.length;for(let s=0;s<a;++s){const a=0|e.children[s].dataset.layerId,i=document.getElementById(`layer-lock-icon-${a}`),n=t.getLayer(a);n.mode===I.MASK&&(r=!0),this._$lockAll?(i.classList.remove("icon-disable"),i.classList.add("icon-active"),n.lock=!0):(i.classList.remove("icon-active"),i.classList.add("icon-disable"),n.lock=!1),r&&this.reloadScreen()}d.$tools.getDefaultTool("arrow").clear()}executeTimelineLayerDisableAll(){this._$disableAll=!this._$disableAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene,r=e.children.length;for(let a=0;a<r;++a){const r=0|e.children[a].dataset.layerId,s=document.getElementById(`layer-disable-icon-${r}`),i=t.getLayer(r);this._$disableAll?(s.classList.remove("icon-disable"),s.classList.add("icon-active"),i.disable=!0):(s.classList.remove("icon-active"),s.classList.add("icon-disable"),i.disable=!1);d.$tools.getDefaultTool("arrow").clear(),this.reloadScreen()}}executeTimelineLayerLightAll(){this._$lightAll=!this._$lightAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene,r=e.children.length;for(let a=0;a<r;++a){const r=0|e.children[a].dataset.layerId,s=document.getElementById(`layer-light-icon-${r}`),i=document.getElementById(`layer-id-${r}`),n=t.getLayer(r);this._$lightAll?(s.classList.remove("icon-disable"),s.classList.add("light-icon-active"),i.style.borderBottom=`1px solid ${n.color}`,n.light=!0):(s.classList.remove("light-icon-active"),s.classList.add("icon-disable"),i.style.borderBottom="",n.light=!1)}}executeTimelineLayerTrash(){const e=d.$timelineLayer.targetLayers;if(e.size){this.save();const t=d.$currentWorkSpace().scene,r=document.getElementById("timeline-content");let a=Array.from(r.children).indexOf(d.$timelineLayer.targetLayer),s=!1;const i=d.$timelineFrame.currentFrame;for(const a of e.values()){const e=Array.from(r.children).indexOf(a),n=0|a.dataset.layerId,o=t.getLayer(n),l=r.children;switch(o.mode){case I.MASK:for(let r=e+1;r<l.length;++r){const e=l[r],a=t.getLayer(0|e.dataset.layerId);if(a.mode!==I.MASK_IN)break;a.mode=I.NORMAL,a.showIcon()}break;case I.GUIDE:for(let r=e+1;r<l.length;++r){const e=l[r],a=t.getLayer(0|e.dataset.layerId);if(a.mode!==I.GUIDE_IN)break;a.mode=I.NORMAL,a.showIcon()}}o.getActiveCharacter(i).length&&(s=!0),a.remove(),t.deleteLayer(n)}if(d.$tools.getDefaultTool("arrow").clear(),r.children.length){let e=null;for(;;)if(e=r.children[a--],e){d.$timelineLayer.activeLayer(e);break}}d.$timelineScroll.updateWidth(),d.$timelineLayer.moveTimeLine(),d.$timelineScroll.updateHeight(),s&&this.reloadScreen()}}executeTimelineLayerAdd(){this.save();const e=d.$timelineLayer.targetLayer||document.getElementById("timeline-content").children[0],t=d.$currentWorkSpace().scene,r=t.addLayer();if(t.totalFrame>0&&r.addEmptyCharacter(new f({startFrame:1,endFrame:t.totalFrame+1})),e){const r=document.getElementById("timeline-content"),a=t.getLayer(0|e.dataset.layerId),s=r.lastElementChild;switch(a.mode){case I.MASK_IN:{const e=t.getLayer(0|s.dataset.layerId);e.maskId=null===a.maskId?a.id:a.maskId,e.mode=I.MASK_IN,e.showIcon()}break;case I.GUIDE_IN:{const e=t.getLayer(0|s.dataset.layerId);e.guideId=null===a.guideId?a.id:a.guideId,e.mode=I.GUIDE_IN,e.showIcon()}}r.insertBefore(s,e);const i=[];for(let e=0;e<r.children.length;++e)i.push(t.getLayer(0|r.children[e].dataset.layerId));t.clearLayer();for(let e=0;e<i.length;++e){const r=i[e];t.setLayer(r.id,r)}d.$timelineLayer.moveTimeLine(),d.$timelineScroll.updateHeight()}super.focusOut()}executeTimelineScriptAdd(e){d.$javaScriptEditor.show(e)}executeTimelineFrameAdd(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=this.getFirstFrame(),r=d.$currentWorkSpace().scene;for(const[a,s]of e){const e=t+s.length,i=r.getLayer(a),n=i.getChildren(t);if(n){if("empty"===n.dataset.frameState){let t=!1,r=1;for(let e=0;e<i._$characters.length;++e)r=Math.max(i._$characters[e].endFrame-1,r);for(let e=0;e<i._$emptys.length;++e)r=Math.max(i._$emptys[e].endFrame-1,r);const a=i.getActiveCharacter(r);if(a.length){for(let t=0;t<a.length;++t){const s=a[t],i=s.getRange(r);if(s.hasTween(i.startFrame)){s.getTween(i.startFrame).endFrame=e,s.updateTweenPlace(i.startFrame,e),s.relocationTween(i.startFrame)}s.endFrame=e}t=!0}const s=i.getActiveEmptyCharacter(r);!t&&s&&(s.endFrame=e,t=!0),t||i.addEmptyCharacter(new f({startFrame:r,endFrame:e}))}else{for(let e=0;e<i._$characters.length;++e){const r=i._$characters[e];t>=r.startFrame||r.move(s.length)}for(let e=0;e<i._$emptys.length;++e){const r=i._$emptys[e];t>=r.startFrame||r.move(s.length)}const e=i.getActiveCharacter(t);if(e.length)for(let r=0;r<e.length;++r){const a=e[r],i=a.getRange(t),n=new Map;for(const[e,t]of a._$places)i.startFrame>e||e>=i.startFrame&&i.endFrame>e?n.set(e,t):(t.frame=e+s.length,t.tweenFrame&&(t.tweenFrame+=s.length),n.set(t.frame,t));if(a._$places=n,a._$cachePlaces.length=0,a._$tween.size){const e=new Map;for(const[t,r]of a._$tween)i.startFrame>=t?e.set(t,r):(r.startFrame+=s.length,r.endFrame+=s.length,e.set(r.startFrame,r));if(a._$tween=e,a.hasTween(i.startFrame)){a.getTween(i.startFrame).endFrame+=s.length,a.updateTweenPlace(i.startFrame,i.endFrame+s.length),a.relocationTween(i.startFrame)}}a.endFrame+=s.length}else{const e=i.getActiveEmptyCharacter(t);e&&(e.endFrame+=s.length)}}i.reloadStyle()}}this.setActiveFrame(),this.reloadScreen(),super.focusOut()}executeTimelineKeyAdd(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene;for(const a of e.keys()){const e=r.getLayer(a),s=e.getActiveCharacter(t);if(s.length)for(let e=0;e<s.length;++e){const r=s[e];if(r.hasPlace(t)){const e=r.getPlace(t);if(e.tweenFrame){const a=r.getRange(t),s=r.getTween(e.tweenFrame);s.endFrame=t,r.setTween(t,{method:s.method,curve:[],custom:d.$tweenController.createEasingObject(),startFrame:t,endFrame:a.endFrame}),r.updateTweenPlace(t,a.endFrame),d.$tweenController.relocationPlace(r,t),d.$tweenController.clearPointer().relocationPointer()}}else r.setPlace(t,r.getClonePlace(t))}else this.addEmptyCharacter(e);e.reloadStyle()}this.setActiveFrame(),this.reloadScreen(),super.focusOut()}executeTimelineKeyDelete(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=d.$currentWorkSpace().scene,r=this.getFirstFrame();for(const[a,s]of e){const e=t.getLayer(a);if(!e._$characters.length&&!e._$emptys.length)continue;const i=e.totalFrame;let n=0;for(let t=0;s.length>t&&(e._$characters.length||e._$emptys.length);++t){const r=s[t],a=e.getActiveCharacter(r);if(a.length){for(let t=0;t<a.length;++t){const s=a[t];if(!s.hasPlace(r))continue;const i=s.getPlace(r);if(i.tweenFrame&&i.tweenFrame!==r)continue;const o=s.getRange(r);if(n=Math.max(n,o.endFrame),s.hasTween(r)){const e=s.getTween(r);switch(!0){case s.startFrame===e.startFrame&&s.endFrame===e.endFrame:s._$places.clear();break;case s.startFrame===e.startFrame:for(let t=e.startFrame;t<e.endFrame;++t)s.deletePlace(t);break;default:{const t=s.getRange(e.startFrame-1);if(s.hasTween(t.startFrame)){for(let r=e.startFrame;r<e.endFrame;++r){s.getPlace(r).tweenFrame=t.startFrame}s.getTween(t.startFrame).endFrame=e.endFrame,s.updateTweenFilter(t.startFrame),s.updateTweenBlend(t.startFrame),s.relocationTween(t.startFrame)}else for(let t=e.startFrame;t<e.endFrame;++t)s.deletePlace(t)}}s.deleteTween(r)}else s.deletePlace(r);if(s._$places.size){if(r===s.startFrame){let e=s.endFrame;for(const t of s._$places.keys())e=Math.min(e,t);s.startFrame=e}}else e.deleteCharacter(s.id)}continue}const i=e.getActiveEmptyCharacter(r);i&&i.startFrame===r&&(n=Math.max(n,i.endFrame),e.deleteEmptyCharacter(i))}this.adjustmentKeyFrame(e,r,n,i),e.reloadStyle()}this.setActiveFrame(),d.$timelineLayer.activeCharacter(),this.reloadScreen(),super.focusOut()}executeTimelineEmptyAdd(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;d.$tools.getDefaultTool("arrow").clearActiveElement(),this.save();const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene;for(const a of e.keys()){const e=r.getLayer(a),s=e.getActiveCharacter(t);if(s.length){const r=e.getChildren(t);if("key-frame"===r.dataset.frameState){d.$fadeIn({currentTarget:{dataset:{detail:"{{キーフレームに空のキーフレームを追加できません}}"}},pageX:r.offsetLeft,pageY:r.offsetTop});continue}let a=Number.MAX_VALUE;for(let e=0;e<s.length;++e){const r=s[e];a=Math.min(a,r.endFrame);for(let e of r._$places.keys())t>e||(a=Math.min(a,e))}for(let r=0;r<s.length;++r){const i=s[r];i.split(e,t,a),i.endFrame>a&&e.addCharacter(i.split(e,a,i.endFrame))}const i=new f;i.startFrame=t,i.endFrame=a,e.addEmptyCharacter(i)}else this.addEmptyCharacter(e);e.reloadStyle()}this.setActiveFrame(),this.reloadScreen(),super.focusOut()}addEmptyCharacter(e){const t=d.$timelineFrame.currentFrame,r=e.getActiveEmptyCharacter(t);if(r){const a=e.getChildren(t);if(a&&"empty-key-frame"===a.dataset.frameState)return;r.startFrame!==t&&(e.addEmptyCharacter(new f({startFrame:t,endFrame:r.endFrame})),r.endFrame=t)}else{if(t>1){let r=1;for(let t=0;t<e._$characters.length;++t)r=Math.max(e._$characters[t].endFrame-1,r);for(let t=0;t<e._$emptys.length;++t)r=Math.max(e._$emptys[t].endFrame-1,r);const a=e.getActiveCharacter(r);if(a.length)for(let e=0;e<a.length;++e){a[e].endFrame=t}else{const a=e.getActiveEmptyCharacter(r);a?a.endFrame=t:e.addEmptyCharacter(new f({startFrame:r,endFrame:t}))}}const r=new f;r.startFrame=t,r.endFrame=t+1,e.addEmptyCharacter(r)}}executeTimelineFrameDelete(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=this.getFirstFrame(),r=d.$currentWorkSpace().scene;for(const[a,s]of e){const e=r.getLayer(a),i=e.getChildren(t);if(!i||"empty"===i.dataset.frameState)continue;const n=e.getActiveCharacter(t);let o=0;if(n.length)for(let r=0;r<n.length;++r){const a=n[r],i=a.getRange(t);if(a.hasPlace(t)&&s.length>=i.endFrame-i.startFrame){if(a.hasTween(t)){for(let e=i.startFrame;e<i.endFrame;++e)a.deletePlace(e);a.deleteTween(t),d.$tweenController.clearPointer()}a.deletePlace(t)}if(o=Math.min(i.endFrame,t+s.length)-t,a._$places.size){const e=new Map;for(const[t,r]of a._$places)i.startFrame>t?e.set(t,r):t>=i.startFrame&&i.endFrame>t?(i.endFrame-o>t&&e.set(t,r),i.endFrame-1===t&&e.set(i.endFrame-o-1,r)):(r.frame=t-o,r.tweenFrame&&(r.tweenFrame-=o),e.set(r.frame,r));if(a._$places=e,a._$cachePlaces.length=0,a._$tween.size){const e=new Map;for(const[t,r]of a._$tween)i.startFrame>=t?(i.startFrame===t&&(r.endFrame-=o),e.set(t,r)):(r.startFrame-=o,r.endFrame-=o,e.set(r.startFrame,r));a._$tween=e,a.relocationTween(i.startFrame)}a.endFrame-=o}else e.deleteCharacter(a.id)}else{const r=e.getActiveEmptyCharacter(t);if(r){const a=r.endFrame-r.startFrame;o=Math.min(r.endFrame,t+s.length)-t,o>=a?e.deleteEmptyCharacter(r):r.endFrame-=o}}for(let r=0;r<e._$characters.length;++r){const a=e._$characters[r];t>=a.startFrame||a.move(-o)}for(let r=0;r<e._$emptys.length;++r){const a=e._$emptys[r];t>=a.startFrame||a.move(-o)}e.reloadStyle()}this.setActiveFrame(),d.$timelineLayer.activeCharacter(),this.reloadScreen(),super.focusOut()}executeTimelineOnionSkin(){const e=document.getElementById("timeline-onion-skin");if(e.classList.contains("onion-skin-active")){e.classList.remove("onion-skin-active");const t=d.$currentWorkSpace().scene._$layers;for(const e of t.values())for(let t=0;t<e._$characters.length;++t)e._$characters[t].dispose()}else e.classList.add("onion-skin-active");this.reloadScreen()}executeTimelinePreview(){const e=document.getElementById("timeline-preview");e&&(this._$preview?(this._$preview=!1,e.setAttribute("class","")):(this._$preview=!0,e.setAttribute("class","timeline-preview-active")))}executeSceneList(e){if(!document.getElementById("scene-name-menu-list").children.length)return;const t=document.getElementById("scene-name-menu");if(t.classList.contains("fadeIn"))t.setAttribute("class","fadeOut");else{const r=e.currentTarget;t.style.left=`${r.offsetLeft+r.offsetWidth}px`,t.style.top=`${r.offsetTop+10}px`,t.setAttribute("class","fadeIn"),d.$endMenu("scene-name-menu")}}setActiveFrame(){const e=this.timelineWidth,t=d.$timelineHeader.width/(e+1)|0,r=d.$timelineHeader.leftFrame,a=r+t,s=d.$currentWorkSpace().scene;for(const[e,t]of d.$timelineLayer.targetFrames){const i=s.getLayer(e);for(let e=0;e<t.length;++e){const s=t[e];if(r>s)continue;if(s>a)continue;const n=i.getChildren(s);n&&n.classList.add("frame-active")}}d.$timelineScroll.updateWidth()}adjustmentKeyFrame(e,t,r,a){if(t>1)for(let a=1;t-a>0;++a){const s=t-a,i=e.getActiveCharacter(s);if(i.length){for(let e=0;e<i.length;++e){const t=i[e],a=t.endFrame-1;if(t.hasPlace(a)){const e=t.getPlace(a);if(e.tweenFrame){const s=t.getTween(e.tweenFrame);if(r>s.endFrame){s.endFrame=endFrame;for(let e=a+1;r>e;++e)t.setPlace(e,t.getClonePlace(a))}d.$tweenController.relocationPlace(t,a)}}r>t.endFrame&&(t.endFrame=r)}break}const n=e.getActiveEmptyCharacter(s);if(n){n.endFrame=r;break}}else if(e._$characters.length||e._$emptys.length)for(let t=1;;++t){const r=1+t,a=e.getActiveCharacter(r);if(a.length){for(let e=0;e<a.length;++e){const t=a[e];let r=t.endFrame;for(let e of t._$places.keys())r=Math.min(r,e);const s=t.getPlace(r);t.deletePlace(r),t.setPlace(1,s),t.startFrame=1}break}const s=e.getActiveEmptyCharacter(r);if(s){s.startFrame=1;break}}else e.addEmptyCharacter(new f({startFrame:t,endFrame:a}))}getFirstFrame(){if(!d.$timelineLayer.targetFrame)return 1;const e=d.$timelineLayer.targetFrames.values().next().value;let t=Number.MAX_VALUE;for(let r=0;r<e.length;++r)t=Math.min(t,e[r]);return t}}d.$timelineTool=new _e;class be extends H{constructor(){super(),this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),d.$initializeEnd()}executeFunction(e){d.$endMenu();this[`execute${e.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`]()}}d.$changeMovieClip=new class extends be{constructor(){super(),this._$element=null,this._$message=""}initialize(){super.initialize();const e=document.getElementById("change-movie-clip");if(e){const t=e.getElementsByClassName("change-movie-clip-box-child");for(let e=0;t.length>e;++e){const r=t[e];"middle-center"===r.dataset.position&&(this._$element=r,this._$element.classList.add("active")),r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.changeBox(e)}))}}const t=["change-movie-clip-button"];for(let e=0;t.length>e;++e){const r=document.getElementById(t[e]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),this._$message?this.showModal(this._$message):this.executeFunction(e.target.id)}))}const r=document.getElementById("change-movie-clip-input");r&&(r.addEventListener("focusin",(()=>{this.focusIn()})),r.addEventListener("focusout",(()=>{this.focusOut()})))}focusIn(){d.$keyLock=!0}focusOut(){if(!d.$keyLock)return;d.$keyLock=!1,this._$message="";const e=document.getElementById("change-movie-clip-input");if(!e)return;const t=e.value;if(t||(this._$message="{{名前は必須です}}"),!this._$message){const e=d.$currentWorkSpace();for(const r of e._$libraries.values())if(r.path===t){this._$message="{{名前が重複しています}}";break}}this._$message&&this.showModal(this._$message)}showModal(e=""){const t=document.getElementById("detail-modal");if(t){clearTimeout(0|t.dataset.timerId),t.textContent=d.$currentLanguage.replace(e);const r=document.getElementById("change-movie-clip"),a=r.offsetLeft-r.offsetWidth/2,s=r.offsetTop-r.offsetHeight/2,i=document.getElementById("change-movie-clip-input");t.style.left=`${a+i.offsetLeft}px`,t.style.top=`${s+i.offsetTop}px`,t.classList.contains("fadeIn")||t.setAttribute("class","fadeIn"),t.dataset.timerId=setTimeout((()=>{t.classList.contains("fadeOut")||t.setAttribute("class","fadeOut")}),1500)}}changeBox(e){this._$element&&this._$element.setAttribute("class","change-movie-clip-box-child"),this._$element=e.target,this._$element.classList.add("active")}executeChangeMovieClipButton(){const e=document.getElementById("change-movie-clip-input");if(!e)return;if(d.$keyLock&&e.blur(),!this._$element||this._$message)return;const t=d.$tools.getDefaultTool("arrow"),r=t.activeElements;if(!r.length)return;if(!d.$timelineLayer.targetLayer)return;this.save();const a=d.$currentWorkSpace(),s=a.scene,i=d.$timelineFrame.currentFrame,n=a.nextLibraryId,o=a.addLibrary(d.$libraryController.createInstance(b.MOVIE_CLIP,e.value,n)),l=new v;o.setLayer(0,l);let c=Number.MAX_VALUE,h=-Number.MAX_VALUE,u=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let e=0;e<r.length;++e){const t=r[e],a=s.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId).getBounds();c=Math.min(c,a.xMin),h=Math.max(h,a.xMax),u=Math.min(u,a.yMin),m=Math.max(m,a.yMax)}const g=this._$element.dataset.position;let $=c,y=u;const _=Math.abs(h-c),I=Math.abs(m-u);switch(g){case"top-left":break;case"top-center":$+=_/2;break;case"top-right":$+=_;break;case"middle-left":y+=I/2;break;case"middle-center":$+=_/2,y+=I/2;break;case"middle-right":$+=_,y+=I/2;break;case"bottom-left":y+=I;break;case"bottom-center":$+=_/2,y+=I;break;case"bottom-right":$+=_,y+=I}let E=null,S=null,w=null,x=null;const L=new Map;for(let e=0;e<r.length;++e){const t=r[e],a=s.getLayer(0|t.dataset.layerId);E||(E=a);const n=a.getCharacter(0|t.dataset.characterId);S||(S=n.getRange(i),w=n.getPlace(S.startFrame),n.hasTween(S.startFrame)&&(x={tween:n.getTween(S.startFrame),place:n.getClonePlace(S.endFrame-1)}));const o=n.getRange(i);L.has(a.id)||L.set(a.id,{layer:a,range:o});const c=new p;c.libraryId=n.libraryId;const h=n.getPlace(o.startFrame),u={frame:1,matrix:h.matrix.slice(),colorTransform:h.colorTransform.slice(),blendMode:h.blendMode,filter:h.filter.slice(),point:{x:h.point.x,y:h.point.y},loop:h.loop?JSON.parse(JSON.stringify(h.loop)):d.$getDefaultLoopConfig(),depth:e};"scaleX"in h&&(u.scaleX=h.scaleX),"scaleY"in h&&(u.scaleY=h.scaleY),"rotation"in h&&(u.rotation=h.rotation),c.setPlace(1,u),c.x-=$,c.y-=y,l.addCharacter(c),n.remove(a)}for(const e of L.values()){const t=e.layer,r=e.range,a=t.getActiveCharacter(r.startFrame);if(a.length){t.sort(a,i);for(let e=0;e<a.length;++e)a[e].getPlace(i).depth=e}else t.addEmptyCharacter(new f({startFrame:r.startFrame,endFrame:r.endFrame}));t.reloadStyle()}const M=new p;if(M.libraryId=o.id,M.startFrame=S.startFrame,M.endFrame=S.endFrame,x){for(let e=S.startFrame;S.endFrame>e;++e)M.setPlace(e,{frame:e,tweenFrame:S.startFrame,matrix:[1,0,0,1,$,y],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:0,loop:d.$getDefaultLoopConfig()});let e=x.place.matrix[4],t=x.place.matrix[5];switch(g){case"top-left":break;case"top-center":e+=_/2;break;case"top-right":e+=_;break;case"middle-left":t+=I/2;break;case"middle-center":e+=_/2,t+=I/2;break;case"middle-right":e+=_,t+=I/2;break;case"bottom-left":t+=I;break;case"bottom-center":e+=_/2,t+=I;break;case"bottom-right":e+=_,t+=I}const r=M.getPlace(S.endFrame-1);r.matrix[4]=e,r.matrix[5]=t,M.setTween(S.startFrame,x.tween),d.$tweenController.relocationPlace(M,S.startFrame)}else M.setPlace(S.startFrame,{frame:S.startFrame,matrix:[1,0,0,1,$,y],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:0,loop:d.$getDefaultLoopConfig(),point:{x:w.point.x,y:w.point.y},scaleX:1,scaleY:1,rotation:0});E.addCharacter(M);const C=E.getActiveEmptyCharacter(S.startFrame);C&&E.deleteEmptyCharacter(C),S.startFrame>1&&E.addEmptyCharacter(new f({startFrame:1,endFrame:S.startFrame})),E.reloadStyle(),t.clearActiveElement(),this.reloadScreen(),this._$saved=!1}};d.$sceneChange=new class extends be{constructor(){super(),this._$matrix=[],this._$offsetX=0,this._$offsetY=0,this._$cache=null}cache(){const e=document.getElementById("scene-name-menu-list");if(e&&e.children.length){const t=Array.from(e.children);this._$cache={children:t,matrix:this._$matrix.slice(),offsetX:this._$offsetX,offsetY:this._$offsetY}}}restore(){if(!this._$cache)return;const e=document.getElementById("scene-name-menu-list");if(!e)return;this._$matrix=this._$cache.matrix,this._$offsetX=this._$cache.offsetX,this._$offsetY=this._$cache.offsetY;const t=this._$cache.children;for(let r=0;t.length>r;++r)e.appendChild(t[r])}get matrix(){return this._$matrix}get concatenatedMatrix(){let e=new Float32Array([1,0,0,1,0,0]);for(let t=0;this._$matrix.length>t;++t)e=d.$multiplicationMatrix(e,this._$matrix[t]);return e}get offsetX(){return this._$offsetX}set offsetX(e){this._$offsetX=e}get offsetY(){return this._$offsetY}set offsetY(e){this._$offsetY=e}initialize(){super.initialize()}clear(){this._$offsetX=0,this._$offsetY=0,this._$matrix.length=0}reload(e=-1){if(this._$cache)return void(this._$cache=null);const t=document.getElementById("scene-name-menu-list");if(t){for(;t.children.length;)t.children[0].remove();this.clear(),d.$currentWorkSpace().root.addSceneName(),e>-1&&d.$sceneChange.execute(e)}}execute(e){const t=d.$currentWorkSpace(),r=t.getLibrary(e),a=r.currentFrame;d.$timelineFrame.currentFrame=a,d.$timelineMarker.move();const s=document.getElementById("timeline-controller-base"),i=(a-1)*(d.$timelineTool.timelineWidth+1);i>s.offsetWidth/2&&d.$timelineLayer.moveTimeLine(i-s.offsetWidth/2),t.scene=r}};d.$screen=new class extends be{constructor(){super(),this._$timerId=-1}initialize(){super.initialize();const e=document.getElementById("screen");e&&(e.addEventListener("contextmenu",(e=>{d.$screenMenu.show(e)})),e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(e=>{e.preventDefault(),e.stopPropagation(),this.drop(e)})),e.addEventListener("mousedown",(e=>{if(e.button)return;d.$canCopyLayer=!1,d.$endMenu();const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(j.MOUSE_DOWN,e))})),e.addEventListener("dblclick",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(j.DBL_CLICK,e))})),e.addEventListener("mouseleave",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(j.MOUSE_LEAVE,e)),document.getElementById("stage-rect").style.display="none",document.getElementById("draw-rect").style.display="none",d.$setCursor("auto")})),e.addEventListener("mousewheel",(e=>{const t=e.deltaX||e.deltaY;if(t)return e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey?(e.preventDefault(),window.cancelAnimationFrame(this._$timerId),this._$timerId=window.requestAnimationFrame((()=>{d.$screenZoom.execute(t/2/100*-1)})),!1):void 0}),{passive:!1}),e.addEventListener("scroll",(e=>{if("hide"!==d.$screenRuler.state)return e.preventDefault(),d.$screenRuler.reload(),!1})),e.addEventListener("mousemove",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,window.requestAnimationFrame((()=>{t.dispatchEvent(j.MOUSE_MOVE,e)})))})),e.addEventListener("mouseup",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(j.MOUSE_UP,e))})))}drop(e){const t=d.$libraryController.activeInstances;if(!t.size)return;const r=d.$currentWorkSpace(),a=r.scene;d.$timelineLayer.attachLayer();const s=0|d.$timelineLayer.targetLayer.dataset.layerId,i=a.getLayer(s);if(i.lock){const t=document.getElementById("detail-modal");return t.textContent=d.$currentLanguage.replace("{{ロックされたレイヤーです}}"),t.style.left=`${e.pageX+10}px`,t.style.top=e.pageY-30+"px",t.setAttribute("class","fadeIn"),void(t.dataset.timerId=setTimeout((()=>{t.classList.contains("fadeOut")||t.setAttribute("class","fadeOut")}),1500))}const n=d.$timelineFrame.currentFrame;this.save();const o=[],l=[];for(const e of t.keys()){const t=r.getLibrary(e);if(t&&t.id!==a.id)switch(t.type){case b.SOUND:o.push(e);break;case b.FOLDER:t.getInstanceIds(l);break;default:l.push(e)}}if(o.length){a.hasSound(n)||a.setSound(n,[]);const e=a.getSound(n);for(let t=0;t<o.length;++t){const a=r.getLibrary(o[t]);e.push({characterId:a.id,name:a.name,volume:100,autoPlay:!1,loopCount:0})}d.$soundController.setIcon(n),d.$soundController.createSoundElements()}const c=i.getActiveCharacter(n);if(c.length){const t=c[0],r=t.getRange(n);if(t.hasTween(r.startFrame)){const t=document.getElementById("detail-modal");return t.textContent=d.$currentLanguage.replace("{{トゥイーンには複数のオブジェクトを設置できません}}"),t.style.left=`${e.pageX+10}px`,t.style.top=e.pageY-30+"px",t.setAttribute("class","fadeIn"),void(t.dataset.timerId=setTimeout((()=>{t.classList.contains("fadeOut")||t.setAttribute("class","fadeOut")}),1500))}}if(l.length){const t=(e.offsetX-d.$offsetLeft)/d.$zoomScale,a=(e.offsetY-d.$offsetTop)/d.$zoomScale,{Matrix:s}=window.next2d.geom,o=d.$sceneChange.concatenatedMatrix,c=new s(o[0],o[1],o[2],o[3],o[4],o[5]);c.invert();const h=t*c.a+a*c.c+c.tx,u=t*c.b+a*c.d+c.ty,m=i.adjustmentLocation(n),g=m.endFrame,$=m.startFrame;for(let e=0;e<l.length;++e){const t=l[e],a={start:null,end:null},s=i._$characters;for(let e=0;e<s.length;++e){const r=s[e];if(r.libraryId===t)switch(!0){case $>1&&r.endFrame===$:a.start=r;break;case r.startFrame===g:a.end=r}}const n=r.getLibrary(t),c={frame:m.startFrame,matrix:[1,0,0,1,h,u],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:i._$characters.length,scaleX:1,scaleY:1,rotation:0};n.type===b.MOVIE_CLIP&&(c.loop=d.$getDefaultLoopConfig());let f=null;if(a.start&&(f=a.start,f.endFrame=g),a.end)if(f){f.endFrame=a.end.endFrame;for(let[e,t]of a.end._$places)f.setPlace(e,t);for(let[e,t]of a.end._$tween)f.setTween(e,t);i.deleteCharacter(a.end.id)}else f=a.end,f.startFrame=$;f?f.setPlace($,c):(f=new p,f.libraryId=t,f.startFrame=$,f.endFrame=g,f.setPlace($,c),i.addCharacter(f));const y=n.getBounds([1,0,0,1,0,0]);let _=y.xMin,v=y.yMin;const I=f.getBounds();let E=I.xMax-I.xMin;E||(E=10);let S=I.yMax-I.yMin;S||(S=10),_+=E/2,v+=S/2,c.matrix[4]-=_,c.matrix[5]-=v;const w=f.getBounds(o),x=d.$sceneChange.offsetX+w.xMin,L=d.$sceneChange.offsetY+w.yMin,M=Math.ceil(Math.abs(w.xMax-w.xMin))/2,C=Math.ceil(Math.abs(w.yMax-w.yMin))/2;c.point={x:x+M,y:L+C}}d.$timelineScroll.updateWidth(),i.reloadStyle(),this.reloadScreen()}this._$saved=!1}appendOnionCharacter(e,t,r=null){return e.draw(d.$getCanvas()).then((a=>{const s=r||d.$currentWorkSpace().scene,i=d.$sceneChange.concatenatedMatrix,n=e.getBounds(i),o=document.createElement("div");o.dataset.child="true",o.dataset.preview="true",o.appendChild(a),a.style.width=a._$width*d.$zoomScale+"px",a.style.height=a._$height*d.$zoomScale+"px",a.style.left=e.offsetX*d.$zoomScale+"px",a.style.top=e.offsetY*d.$zoomScale+"px";let l="";const c=s.getLayer(t);if(null!==c.maskId){const e=s.getLayer(c.maskId);if(e||(c.maskId=null),e&&e.lock&&e._$characters.length){const t=e._$characters[0];t.dispose();const r=t.draw(d.$getCanvas()),s=t.getBounds(i),o=(s.xMin-n.xMin)*d.$zoomScale,c=(s.yMin-n.yMin)*d.$zoomScale,h=r.toDataURL(),u=r._$width*d.$zoomScale,m=r._$height*d.$zoomScale;l+=`mask: url(${h}), none;`,l+=`-webkit-mask: url(${h}), none;`,l+=`mask-size: ${u}px ${m}px;`,l+=`-webkit-mask-size: ${u}px ${m}px;`,l+="mask-repeat: no-repeat;",l+="-webkit-mask-repeat: no-repeat;",l+=`mask-position: ${o}px ${c}px;`,l+=`-webkit-mask-position: ${o}px ${c}px;`,l+=`mix-blend-mode: ${a.style.mixBlendMode};`,l+=`filter: ${a.style.filter};`}}return l+="position: absolute;",l+="pointer-events: none;",l+="opacity: 0.25;",l+=`left: ${d.$offsetLeft+(d.$sceneChange.offsetX+a._$tx)*d.$zoomScale}px;`,l+=`top: ${d.$offsetTop+(d.$sceneChange.offsetY+a._$ty)*d.$zoomScale}px;`,o.setAttribute("style",l),Promise.resolve({div:o,canvas:a})}))}appendCharacter(e,t,r,a="auto",s=null,i=1,n=null,o=null){const l=d.$currentWorkSpace(),c=s||l.scene,h=e.getPlace(t),u=l.getLibrary(e.libraryId);if(!u)return Promise.resolve();let m=e.libraryId===d.$changeLibraryId;switch(u.type){case b.MOVIE_CLIP:u.totalFrame>1&&e._$currentFrame!==t&&(m=!0,e._$currentFrame=t);break;case b.VIDEO:e._$currentFrame!==t&&(m=!0,e._$currentFrame=t)}if(h!==e._$currentPlace){if(e._$currentPlace){const t=h.matrix,r=e._$currentPlace.matrix;switch(!0){case t[0]!==r[0]:case t[1]!==r[1]:case t[2]!==r[2]:case t[3]!==r[3]:m=!0;break;default:e._$screenX+=-r[4]+t[4],e._$screenY+=-r[5]+t[5]}if(!m){const t=h.colorTransform,r=e._$currentPlace.colorTransform;switch(!0){case t[0]!==r[0]:case t[1]!==r[1]:case t[2]!==r[2]:case t[3]!==r[3]:case t[4]!==r[4]:case t[5]!==r[5]:case t[6]!==r[6]:case t[7]!==r[7]:m=!0}}if(m||h.blendMode===e._$currentPlace.blendMode||(m=!0),!m&&(e._$currentPlace.filter.length!==h.filter.length&&(m=!0),!m))for(let t=0;t<h.filter.length;++t){const r=h.filter[t],a=e._$currentPlace[t];if(!r||!a){m=!0;break}if(a.constructor!==r.constructor){m=!0;break}if(!a.isSame(r)){m=!0;break}}}e._$currentPlace=h}return m&&e.dispose(),e.draw(d.$getCanvas(),s?t:0).then((l=>{const h=document.createElement("div");h.setAttribute("data-child","true"),d.$timelinePlayer.stopFlag&&(h.setAttribute("id",`character-${e.id}`),h.setAttribute("data-character-id",`${e.id}`),h.setAttribute("data-layer-id",`${r}`),h.setAttribute("data-instance-type",`${u.type}`),h.setAttribute("data-library-id",`${e.libraryId}`),h.setAttribute("data-pointer",`${a}`),h.addEventListener("mouseover",(e=>{e.stopPropagation();const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(j.MOUSE_OVER,e))})),h.addEventListener("mouseout",(e=>{e.stopPropagation();const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(j.MOUSE_OUT,e))})),h.addEventListener("mousedown",(e=>{if(e.button)return;e.stopPropagation();const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(j.MOUSE_DOWN,e))}))),s&&h.setAttribute("data-preview","true");let m="position: absolute;";m+=`pointer-events: ${a};`,1>i&&(m+=`opacity: ${i};`);const g=d.$sceneChange.concatenatedMatrix,$=e.getBounds(g,t);let p=($.xMax-$.xMin)*d.$zoomScale;p||(p=10);let f=($.yMax-$.yMin)*d.$zoomScale;f||(f=10),m+=`width: ${Math.ceil(p)}px;`,m+=`height: ${Math.ceil(f)}px;`;const y=null===n?d.$sceneChange.offsetX:n,_=null===o?d.$sceneChange.offsetY:o;let v=d.$offsetLeft+(y+$.xMin)*d.$zoomScale,I=d.$offsetTop+(_+$.yMin)*d.$zoomScale;m+=`left: ${v}px;`,m+=`top: ${I}px;`;let E=l.getAttribute("style");E+=`width: ${l._$width*d.$zoomScale}px;`,E+=`height: ${l._$height*d.$zoomScale}px;`,e.offsetX&&(E+=`left: ${e.offsetX*d.$zoomScale}px;`),e.offsetY&&(E+=`top: ${e.offsetY*d.$zoomScale}px;`),l.setAttribute("style",E);const S=[],w=c.getLayer(r);if(null!==w.maskId){const e=c.getLayer(w.maskId);if(e||(w.maskId=null),e&&e.lock&&e._$characters.length){const r=e._$characters[0],a=r.getPlace(t);r._$maskPlaceFrame!==a.frame&&(r.dispose(),r._$maskPlaceFrame=a.frame),S.push(r.draw(d.$getCanvas()).then((e=>{const t=r.getBounds(g),a=(t.xMin-$.xMin)*d.$zoomScale,s=(t.yMin-$.yMin)*d.$zoomScale;e._$base64||(e._$base64=e.toDataURL());const i=e._$base64,n=e._$width*d.$zoomScale,o=e._$height*d.$zoomScale;m+=`mask: url(${i}), none;`,m+=`-webkit-mask: url(${i}), none;`,m+=`mask-size: ${n}px ${o}px;`,m+=`-webkit-mask-size: ${n}px ${o}px;`,m+="mask-repeat: no-repeat;",m+="-webkit-mask-repeat: no-repeat;",m+=`mask-position: ${a}px ${s}px;`,m+=`-webkit-mask-position: ${a}px ${s}px;`,m+=`mix-blend-mode: ${l.style.mixBlendMode};`,m+=`filter: ${l.style.filter};`})))}}if(d.$timelinePlayer.stopFlag)switch(u._$type){case b.MOVIE_CLIP:h.addEventListener("dblclick",(e=>{this.changeScene(e)}));break;case b.TEXT:{const e=document.createElement("div");e.style.width=p-2+"px",e.style.height=f-2+"px",e.style.pointerEvents="none",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.border=u._$border?"1px solid gray":"1px dashed gray",h.appendChild(e),h.addEventListener("dblclick",(e=>{this.selectText(e)}))}}return S.length?Promise.all(S).then((()=>(h.setAttribute("style",m),Promise.resolve({div:h,canvas:l})))):(h.setAttribute("style",m),Promise.resolve({div:h,canvas:l}))}))}selectText(e){e.stopPropagation(),d.$tools.reset();const t=document.getElementById("stage-area").children;for(let e=0;e<t.length;++e)t[e].style.pointerEvents="none";const r=e.currentTarget;r.style.pointerEvents="";const a=r.firstChild;a.remove();const s=window.document.createElement("textarea");r.style.display="none",r.parentNode.appendChild(s);const i=d.$currentWorkSpace(),n=i.scene,o=0|r.dataset.layerId,l=n.getLayer(o),c=0|r.dataset.characterId,h=l.getCharacter(c),u=i.getLibrary(h.libraryId);s.value=u._$text,s.style.border=u._$border?"1px solid gray":"1px dashed gray",s.style.fontSize=`${u._$size}px`,s.style.fontFamily=u._$font,s.style.width=parseFloat(a.style.width)-4+"px",s.style.height=`${parseFloat(a.style.height)}px`,s.style.position="absolute",s.style.left=r.style.left,s.style.top=r.style.top,s.style.pointerEvents="auto",u._$border||(s.style.backgroundColor="transparent"),s.dataset.characterId=`${h.id}`,s.dataset.layerId=`${o}`,s.dataset.libraryId=`${h.libraryId}`,s.dataset.child="true",u._$multiline||s.addEventListener("keydown",(e=>{if("Enter"===e.key)return e.preventDefault(),!1})),s.addEventListener("focusin",(()=>{d.$keyLock=!0})),s.addEventListener("focusout",(e=>{const t=e.target,r=d.$currentWorkSpace(),a=r.scene,s=0|t.dataset.layerId,i=a.getLayer(s),n=0|t.dataset.characterId,o=i.getCharacter(n);r.getLibrary(o.libraryId)._$text=t.value,o.dispose(),d.$keyLock=!1;const l=document.getElementById("stage-area").children;for(let e=0;e<l.length;++e){l[e].style.pointerEvents=""}const c=d.$timelineFrame.currentFrame;a.changeFrame(c)})),s.focus()}changeScene(e){e.stopPropagation();const t=e.currentTarget,r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId),a=0|t.dataset.characterId,s=r.getCharacter(a);d.$activeCharacterIds.push(a),d.$currentWorkSpace().scene.addSceneName(!0);const i=d.$sceneChange.concatenatedMatrix,n=s.x,o=s.y,l=n*i[0]+o*i[2]+i[4],c=n*i[1]+o*i[3]+i[5];d.$sceneChange.offsetX=l,d.$sceneChange.offsetY=c;const h=d.$timelineFrame.currentFrame,u=s.getPlace(h);d.$sceneChange.matrix.push(u.matrix),d.$sceneChange.execute(0|t.dataset.libraryId)}clearStageArea(){const e=document.getElementById("stage-area");if(!e)return;let t=0;for(;e.children.length>t;){const r=e.children[t];r.dataset.child?r.remove():t++}}};d.$screenKeyboardCommand=new class extends V{constructor(){super("screen"),this._$state="close",this._$prevTool=null,this._$activeTool=null,this._$endHandTool=null}initialize(){super.initialize();const e=document.getElementById("screen");e&&(e.addEventListener("mouseleave",(()=>{this.active=!1})),e.addEventListener("mouseover",(()=>{this.active||(this.active=!0)})),e.addEventListener("mouseup",(()=>{this.active||(this.active=!0)}))),this._$endHandTool=this.endHandTool.bind(this),this.add(" ",this.startHandTool.bind(this));const t=["v","q","a","p","t","k","o","r","z"];this._$activeTool=this.activeTool.bind(this);for(let e=0;e<t.length;++e)this.add(t[e],this._$activeTool);this.add(d.$generateShortcutKey("r",{shift:!0}),this._$activeTool),this.add("s",this.userSetting.bind(this));const r=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"];for(let e=0;e<r.length;++e){const t=r[e];this.add(t,this.executeMoveDisplayObject),this.add(d.$generateShortcutKey(t,{shift:!0}),this.executeMoveDisplayObject)}this.add(d.$generateShortcutKey("r",{ctrl:!0}),(()=>{d.$shiftKey=!1,d.$ctrlKey=!1,d.$altKey=!1,d.$project.open()})),this.add(d.$generateShortcutKey("s",{ctrl:!0,shift:!0}),d.$project.save),this.add("Backspace",this.deleteDisplayObject),this.add(d.$generateShortcutKey("p",{ctrl:!0,shift:!0}),(()=>{d.$tweenController.deleteCurvePointer()})),this.add(d.$generateShortcutKey("ArrowUp",{ctrl:!0,shift:!0}),(()=>{d.$screenMenu.changeDepth("up")})),this.add(d.$generateShortcutKey("ArrowUp",{ctrl:!0}),(()=>{d.$screenMenu.changeDepthOne("up")})),this.add(d.$generateShortcutKey("ArrowDown",{ctrl:!0,shift:!0}),(()=>{d.$screenMenu.changeDepth("down")})),this.add(d.$generateShortcutKey("ArrowDown",{ctrl:!0}),(()=>{d.$screenMenu.changeDepthOne("down")})),this.add("1",(()=>{d.$screenMenu.alignment("left")})),this.add(d.$generateShortcutKey("!",{shift:!0}),(()=>{d.$screenMenu.alignment("left","stage")})),this.add("2",(()=>{d.$screenMenu.alignment("center")})),this.add(d.$generateShortcutKey('"',{shift:!0}),(()=>{d.$screenMenu.alignment("center","stage")})),this.add("3",(()=>{d.$screenMenu.alignment("right")})),this.add(d.$generateShortcutKey("#",{shift:!0}),(()=>{d.$screenMenu.alignment("right","stage")})),this.add("4",(()=>{d.$screenMenu.alignment("top")})),this.add(d.$generateShortcutKey("$",{shift:!0}),(()=>{d.$screenMenu.alignment("top","stage")})),this.add("5",(()=>{d.$screenMenu.alignment("middle")})),this.add(d.$generateShortcutKey("%",{shift:!0}),(()=>{d.$screenMenu.alignment("middle","stage")})),this.add("6",(()=>{d.$screenMenu.alignment("bottom")})),this.add(d.$generateShortcutKey("&",{shift:!0}),(()=>{d.$screenMenu.alignment("bottom","stage")})),this.add(d.$generateShortcutKey("d",{ctrl:!0}),(()=>{d.$screenMenu.executeScreenDistributeToLayers()})),this.add(d.$generateShortcutKey("k",{ctrl:!0}),(()=>{d.$screenMenu.executeScreenDistributeToKeyframes()})),this.add(d.$generateShortcutKey("i",{ctrl:!0}),(()=>{d.$screenMenu.executeScreenIntegratingPaths()})),this.add(d.$generateShortcutKey("p",{ctrl:!0}),(()=>{d.$tweenController.addCurvePinter()})),this.add(d.$generateShortcutKey("m",{shift:!0}),(()=>{d.$screenMenu.executeScreenChangeMovieClip()})),this.add(d.$generateShortcutKey("c",{ctrl:!0}),(()=>{d.$screenMenu.copyDisplayObject()})),this.add(d.$generateShortcutKey("v",{ctrl:!0}),(()=>{d.$screenMenu.pasteDisplayObject()})),this.add(d.$generateShortcutKey("a",{ctrl:!0}),(()=>{this.allDisplayObjectSelect()})),this.add(d.$generateShortcutKey("r",{ctrl:!0,shift:!0}),(()=>{d.$screenRuler.show()}))}allDisplayObjectSelect(){const e=d.$tools.getDefaultTool("arrow");e.activeElements.length=0;const t=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame;for(const a of t._$layers.values()){if(a.lock)continue;const t=a.getActiveCharacter(r);for(let r=0;r<t.length;++r){const a=t[r],s=document.getElementById(`character-${a.id}`);s&&e.activeElements.push(s)}}e.updateControllerProperty(),d.$transformController.show().relocation(),d.$gridController.show().relocation(),e.activeTimeline()}deleteDisplayObject(){d.$tools.getDefaultTool("arrow").deleteDisplayObject()}userSetting(){const e=document.getElementById("user-setting");"show"===this._$state||e.classList.contains("fadeIn")?(this._$state="close",d.$endMenu()):(this._$state="show",d.$userSetting.show())}activeTool(e){let t="";switch(e){case"v":t="arrow";break;case"q":t="arrow-transform";break;case"a":t="transform";break;case"p":t="pen";break;case"t":t="text";break;case"z":t="zoom";break;case"k":t="bucket";break;case"r":t="rectangle";break;case"o":t="circle";break;case"rShift":t="round-rect"}if(t){const e=d.$tools.activeTool;e&&e.dispatchEvent(j.END);const r=d.$tools.getDefaultTool(t);r.dispatchEvent(j.START),d.$tools.activeTool=r}}startHandTool(){if("hand"===d.$tools.activeTool.name)return;this._$prevTool=d.$tools.activeTool,this._$prevTool&&this._$prevTool.dispatchEvent(j.END);const e=d.$tools.getDefaultTool("hand");e.dispatchEvent(j.START),d.$tools.activeTool=e,d.$tools.getDefaultTool("arrow").endRect(),window.addEventListener("keyup",this._$endHandTool)}endHandTool(e){if(" "!==e.key)return;window.removeEventListener("keyup",this._$endHandTool);d.$tools.getDefaultTool("hand").dispatchEvent(j.END),this._$prevTool?(this._$prevTool.dispatchEvent(j.START),d.$tools.activeTool=this._$prevTool,this._$prevTool=null):d.$tools.reset()}executeMoveDisplayObject(e){const t=d.$tools.getDefaultTool("arrow");if(t.activeElements.length){switch(e){case"ArrowRight":case"ArrowRightShift":t.pageX=d.$shiftKey?10:1,t.pageY=0;break;case"ArrowLeft":case"ArrowLeftShift":t.pageX=d.$shiftKey?-10:-1,t.pageY=0;break;case"ArrowUp":case"ArrowUpShift":t.pageX=0,t.pageY=d.$shiftKey?-10:-1;break;case"ArrowDown":case"ArrowDownShift":t.pageX=0,t.pageY=d.$shiftKey?10:1;break;default:return}t.moveDisplayObject(),t._$saved=!1}}};d.$screenMenu=new class extends be{constructor(){super(),this._$state="hide",this._$copyDisplayObjects=[],this._$copyWorkSpaceId=-1,this._$copyFrame=-1}initialize(){super.initialize();const e=["screen-front","screen-front-one","screen-back-one","screen-back","screen-position-left","screen-position-right","screen-position-center","screen-position-top","screen-position-middle","screen-position-bottom","stage-position-left","stage-position-right","stage-position-center","stage-position-top","stage-position-middle","stage-position-bottom","screen-distribute-to-layers","screen-distribute-to-keyframes","screen-integrating-paths","screen-add-tween-curve-pointer","screen-delete-tween-curve-pointer","screen-change-movie-clip","screen-preview","screen-ruler"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e.target.id)}))}const t=["screen-distribute-to-layers","screen-distribute-to-keyframes","screen-integrating-paths","screen-add-tween-curve-pointer","screen-delete-tween-curve-pointer","screen-change-movie-clip","screen-preview","screen-ruler"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);r&&r.addEventListener("mouseover",(()=>{this.hideSubMenu()}))}const r=["screen-order","screen-align"];for(let e=0;e<r.length;++e){const t=document.getElementById(r[e]);t&&t.addEventListener("mouseover",(e=>{e.stopPropagation(),this.showSubMenu(e)}))}}hideSubMenu(e=""){const t=["screen-order-menu","screen-align-menu"];for(let r=0;r<t.length;++r){const a=t[r];if(e&&e===a)continue;const s=document.getElementById(a);s&&(s.classList.contains("fadeIn")&&s.setAttribute("class","fadeOut"))}}showSubMenu(e){const t=`${e.target.id}-menu`,r=document.getElementById(t);if(!r)return;this.hideSubMenu(t);const a=document.getElementById("screen-menu");r.style.left=a.offsetLeft+a.clientWidth-5+"px",r.style.top=`${a.offsetTop+20}px`,r.setAttribute("class","fadeIn")}copyDisplayObject(){this.clearCopy();const e=d.$tools.getDefaultTool("arrow"),t=e.activeElements;if(!t.length)return;this._$copyWorkSpaceId=d.$activeWorkSpaceId,this._$copyFrame=d.$timelineFrame.currentFrame;const r=d.$currentWorkSpace().scene,a=e.activeElements.length;for(let e=0;e<a;++e){const a=t[e],s=r.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);this._$copyDisplayObjects.push(new p(JSON.parse(JSON.stringify(s.toObject()))))}}clearCopy(){this._$copyFrame=-1,this._$copyWorkSpaceId=-1,this._$copyDisplayObjects.length=0}pasteDisplayObject(){if(-1===this._$copyWorkSpaceId)return;if(!this._$copyDisplayObjects.length)return;const e=d.$workSpaces[this._$copyWorkSpaceId],t=d.$currentWorkSpace();if(!e)return;let r=d.$timelineLayer.targetLayer;r||(d.$timelineLayer.attachLayer(),r=d.$timelineLayer.targetLayer);const a=t.scene.getLayer(0|r.dataset.layerId);if(this._$copyWorkSpaceId!==d.$activeWorkSpaceId){for(let t=0;this._$copyDisplayObjects.length>t;++t){const r=this._$copyDisplayObjects[t];if(!e.getLibrary(r.libraryId))return this._$copyWorkSpaceId=-1,void(this._$copyDisplayObjects.length=0)}this.save(),d.$confirmModal.clear();const r=d.$confirmModal._$mapping;for(let s=this._$copyDisplayObjects.length-1;s>-1;--s){const i=this._$copyDisplayObjects[s],n=i.libraryId;if(r.has(n)){const e=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$copyWorkSpaceId;const s=new p(JSON.parse(JSON.stringify(i.toObject())));d.$activeWorkSpaceId=e,s.libraryId=r.get(n),s._$id=t._$characterId++,d.$confirmModal.pasteDisplayObject(a,s,this._$copyFrame);continue}const o=e.getLibrary(n);if(!o)continue;const l=o.getPathWithWorkSpace(e);if(t._$nameMap.has(l)){d.$confirmModal.files.push({file:o,character:i,layer:a,path:l,copyFrame:this._$copyFrame,workSpaceId:this._$copyWorkSpaceId,type:"copy"});continue}let c=null;if(o.type===b.MOVIE_CLIP)c=d.$confirmModal.cloneMovieClip(this._$copyWorkSpaceId,o);else{const e=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$copyWorkSpaceId,c=o.clone(),d.$activeWorkSpaceId=e}c._$id=t.nextLibraryId,r.set(o.id,c.id),d.$libraryController.createInstance(c.type,c.name,c.id,c.symbol),t._$libraries.set(c.id,c),c.folderId&&d.$confirmModal.createFolder(this._$copyWorkSpaceId,c);const h=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$copyWorkSpaceId;const u=new p(JSON.parse(JSON.stringify(i.toObject())));d.$activeWorkSpaceId=h,u.libraryId=c.id,u._$id=t._$characterId++,d.$confirmModal.pasteDisplayObject(a,u,this._$copyFrame)}d.$libraryController.reload()}else{for(let e=0;this._$copyDisplayObjects.length>e;++e){const r=this._$copyDisplayObjects[e];if(!t.getLibrary(r.libraryId))return this._$copyWorkSpaceId=-1,void(this._$copyDisplayObjects.length=0)}this.save();for(let e=this._$copyDisplayObjects.length-1;e>-1;--e){const t=this._$copyDisplayObjects[e];d.$confirmModal.pasteDisplayObject(a,t.clone(),this._$copyFrame)}}a.reloadStyle(),d.$confirmModal.files.length?d.$confirmModal.show():d.$confirmModal.clear(),this.reloadScreen(),this._$saved=!1,super.focusOut()}executeScreenPreview(){d.$showPreview()}executeScreenDistributeToLayers(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;this.save();const t=[],r=d.$timelineFrame.currentFrame,a=new Map,s=d.$currentWorkSpace().scene;for(let i=0;i<e.length;++i){const n=e[i],o=s.getLayer(0|n.dataset.layerId);if(!o)continue;const l=o.getCharacter(0|n.dataset.characterId);if(!l)continue;const c=l.getRange(r);a.has(o.id)||a.set(o.id,{layer:o,range:c});const d=l.getPlace(c.startFrame);d.depth=0,t.push({libraryId:l.libraryId,place:d,startFrame:c.startFrame,endFrame:c.endFrame}),l.remove(o)}for(const e of a.values()){const t=e.layer,a=e.range,s=t.getActiveCharacter(a.startFrame);if(s.length){t.sort(s,r);for(let e=0;e<s.length;++e)s[e].getPlace(r).depth=e}else t.addEmptyCharacter(new f({startFrame:a.startFrame,endFrame:a.endFrame}));t.reloadStyle()}d.$timelineLayer.clear();const i=d.$ctrlKey;d.$ctrlKey=!0;for(let e=0;e<t.length;++e){const r=t[e],a=new p;a.libraryId=r.libraryId,a.startFrame=r.startFrame,a.endFrame=r.endFrame,a.setPlace(r.startFrame,r.place);const i=new v;i.addCharacter(a),r.startFrame>1&&i.addEmptyCharacter(new f({startFrame:1,endFrame:r.startFrame})),s.addLayer(i),d.$timelineLayer.activeLayer(document.getElementById(`layer-id-${i.id}`))}this.reloadScreen(),d.$timelineLayer.activeCharacter(),d.$ctrlKey=i,this._$saved=!1}executeScreenDistributeToKeyframes(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;this.save();const t=d.$currentWorkSpace().scene;let r=d.$timelineFrame.currentFrame;const a=new Map;for(const s of e.values()){const e=t.getLayer(0|s.dataset.layerId),i=e.getCharacter(0|s.dataset.characterId);a.has(e.id)||a.set(e.id,{range:i.getRange(r),characters:[]}),a.get(e.id).characters.push(i)}for(const[e,s]of a){let a=s.characters;if(1===a.length)continue;const i=t.getLayer(e),n=s.range,o=i.getActiveCharacter(r),l=n.endFrame-n.startFrame;switch(!0){case a.length!==o.length:{const e=new Map,t=[];for(let r=0;r<o.length;++r){const s=o[r],l=a.indexOf(s),c=s.split(i,n.startFrame,n.endFrame);l>-1&&e.set(c.id,l),t.push(c)}for(let e=0;e<i._$characters.length;++e){const t=i._$characters[e];if(!(n.endFrame>t.endFrame))if(t.startFrame>n.startFrame)t.move(a.length);else{const e=new Map;for(const[r,s]of t._$places)r>n.startFrame&&(s.frame=r+a.length),e.set(s.frame,s);t._$places=e,t.endFrame+=a.length,t._$cachePlaces.length=0}}for(let e=0;i._$emptys.length>e;++e){const t=i._$emptys[e];n.startFrame>t.startFrame||t.move(a.length)}r=n.endFrame,n.startFrame=n.endFrame,n.endFrame+=a.length;const s=[];for(let r=0;r<t.length;++r){const a=t[r];if(e.has(a.id))a.setPlace(n.startFrame,a.getPlace(a.startFrame)),a.deletePlace(a.startFrame),a.startFrame=n.startFrame,a.endFrame=n.endFrame,i.addCharacter(a),s.push(a);else for(let e=0;e<i._$characters.length;++e){const t=i._$characters[e];if(t.libraryId===a.libraryId&&t.endFrame===a.startFrame){for(const[e,r]of a._$places)t.setPlace(e,r);t.endFrame=a.endFrame;break}}}a=s}break;case a.length>l:{const e=a.length-l;for(let t=0;i._$characters.length>t;++t){const r=i._$characters[t];if(!(n.endFrame>=r.endFrame))if(r.startFrame>n.endFrame)r.move(e);else{const t=new Map;for(const[a,s]of r._$places)a>=n.endFrame&&(s.frame=a+e),t.set(s.frame,s);r._$places=t,r.endFrame+=e,r._$cachePlaces.length=0}}for(let t=0;i._$emptys.length>t;++t){const r=i._$emptys[t];n.endFrame>=r.endFrame||r.move(e)}n.endFrame+=e}break;case l>a.length:{const e=l-a.length;for(let t=0;i._$characters.length>t;++t){const r=i._$characters[t];if(!(n.endFrame>r.endFrame))if(r.startFrame>n.endFrame)r.move(-e);else{const t=new Map;for(const[a,s]of r._$places)a>=n.endFrame&&(s.frame=a-e),t.set(s.frame,s);r._$places=t,r.endFrame-=e,r._$cachePlaces.length=0}}for(let t=0;i._$emptys.length>t;++t){const r=i._$emptys[t];n.startFrame>r.startFrame||r.move(-e)}n.endFrame-=e}}a.sort(((e,t)=>{const a=e.getPlace(r).depth,s=t.getPlace(r).depth;switch(!0){case a>s:return 1;case a<s:return-1;default:return 0}}));let c=n.startFrame;for(let e=0;e<a.length;++e){let t=a[e];1!==t._$places.size&&(t=t.split(i,n.startFrame,n.endFrame),i.addCharacter(t));const s=t.getPlace(r);let o=!1;for(let e=0;e<i._$characters.length;++e){const r=i._$characters[e];if(r.id!==t.id&&(r.libraryId===t.libraryId&&r.endFrame===c)){i.deleteCharacter(t.id),r.endFrame=c+1,r.setPlace(c,s),o=!0;break}}if(o)c++;else{for(let e=0;e<i._$characters.length;++e){const r=i._$characters[e];if(r.id!==t.id&&(r.libraryId===t.libraryId&&r.startFrame===c+1)){i.deleteCharacter(t.id),r.startFrame=c,r.setPlace(c,s),o=!0;break}}o||(t.startFrame=c,t.endFrame=c+1,t.deletePlace(s.frame),t.setPlace(c,s)),c++}}i.reloadStyle()}this.reloadScreen(),this._$saved=!1}executeScreenIntegratingPaths(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;this.save();const t=d.$currentWorkSpace(),r=t.scene,a=d.$timelineFrame.currentFrame;let s=null,i=null,n=0;for(let o=0;o<e.length;++o){const l=e[o];if(l.dataset.instanceType!==b.SHAPE)continue;const c=t.getLibrary(0|l.dataset.libraryId),d=r.getLayer(0|l.dataset.layerId).getCharacter(0|l.dataset.characterId),{Graphics:h}=window.next2d.display;if(!s){i=d,s=c;for(let e=0;s._$recodes.length>e;){switch(s._$recodes[e++]){case h.BEGIN_PATH:break;case h.MOVE_TO:case h.LINE_TO:e+=2;break;case h.CURVE_TO:e+=4;break;case h.CUBIC:e+=6;break;case h.FILL_STYLE:case h.GRADIENT_FILL:case h.STROKE_STYLE:case h.GRADIENT_STROKE:n=e-1;case h.CLOSE_PATH:case h.END_STROKE:case h.END_FILL:}if(n)break}continue}const u=i.screenX-s._$bounds.xMin-d.screenX,m=i.screenY-s._$bounds.yMin-d.screenY,g=d.getPlace(a).matrix,$=[];let p=!1;for(let e=0;c._$recodes.length>e;){switch(c._$recodes[e++]){case h.BEGIN_PATH:break;case h.MOVE_TO:{const t=c._$recodes[e++],r=c._$recodes[e++];$.push(h.MOVE_TO,t*g[0]+r*g[2]-u,t*g[1]+r*g[3]-m)}break;case h.LINE_TO:{const t=c._$recodes[e++],r=c._$recodes[e++];$.push(h.LINE_TO,t*g[0]+r*g[2]-u,t*g[1]+r*g[3]-m)}break;case h.CURVE_TO:{const t=c._$recodes[e++],r=c._$recodes[e++],a=c._$recodes[e++],s=c._$recodes[e++];$.push(h.CURVE_TO,t*g[0]+r*g[2]-u,t*g[1]+r*g[3]-m,a*g[0]+s*g[2]-u,a*g[1]+s*g[3]-m)}break;case h.CUBIC:{const t=c._$recodes[e++],r=c._$recodes[e++],a=c._$recodes[e++],s=c._$recodes[e++],i=c._$recodes[e++],n=c._$recodes[e++];$.push(h.CUBIC,t*g[0]+r*g[2]-u,t*g[1]+r*g[3]-m,a*g[0]+s*g[2]-u,a*g[1]+s*g[3]-m,i*g[0]+n*g[2]-u,i*g[1]+n*g[3]-m)}break;case h.FILL_STYLE:case h.GRADIENT_FILL:case h.STROKE_STYLE:case h.GRADIENT_STROKE:p=!0,Array.prototype.splice.apply(s._$recodes,[n,0].concat($)),n+=$.length;case h.CLOSE_PATH:case h.END_STROKE:case h.END_FILL:}if(p)break}}if(s){const e=s.reloadBounds();s._$bounds.xMin=e.xMin,s._$bounds.xMax=e.xMax,s._$bounds.yMin=e.yMin,s._$bounds.yMax=e.yMax,s.cacheClear(),this.reloadScreen()}this._$saved=!1}executeScreenChangeMovieClip(){if(!d.$tools.getDefaultTool("arrow").activeElements.length)return;if(!d.$timelineLayer.targetLayer)return;const e=document.getElementById("change-movie-clip");if(!e)return;const t=document.getElementById("change-movie-clip-input");if(t){const e=d.$currentWorkSpace();t.value=`MovieClip_${e.nextLibraryId}`}d.$endMenu("change-movie-clip"),e.classList.contains("fadeIn")||e.setAttribute("class","fadeIn")}executeScreenRuler(){d.$screenRuler.show()}executeScreenAddTweenCurvePointer(){d.$tweenController.addCurvePinter()}executeScreenDeleteTweenCurvePointer(){d.$tweenController.deleteCurvePointer()}executeScreenFront(){this.changeDepth("up")}executeScreenBack(){this.changeDepth("down")}executeScreenFrontOne(){this.changeDepthOne("up")}executeScreenBackOne(){this.changeDepthOne("down")}executeStagePositionLeft(){this.alignment("left","stage")}executeScreenPositionLeft(){this.alignment("left")}executeStagePositionCenter(){this.alignment("center","stage")}executeScreenPositionCenter(){this.alignment("center")}executeStagePositionRight(){this.alignment("right","stage")}executeScreenPositionRight(){this.alignment("right")}executeStagePositionTop(){this.alignment("top","stage")}executeScreenPositionTop(){this.alignment("top")}executeStagePositionMiddle(){this.alignment("middle","stage")}executeScreenPositionMiddle(){this.alignment("middle")}executeStagePositionBottom(){this.alignment("bottom","stage")}executeScreenPositionBottom(){this.alignment("bottom")}alignment(e,t="rect"){const r=d.$tools.getDefaultTool("arrow").activeElements;if(!r.length||"rect"===t&&2>r.length)return;this.save();const a=d.$currentWorkSpace();let s=0,i=0,n=0,o=0;if("rect"===t){const e=document.getElementById("target-rect");s=e.offsetLeft-d.$offsetLeft-d.$sceneChange.offsetX,i=e.offsetTop-d.$offsetTop-d.$sceneChange.offsetY,n=e.offsetWidth,o=e.offsetHeight}else{const e=document.getElementById("scene-name-menu-list").children;let t=0;for(let r=0;r<e.length;++r){"false"!==e[r].dataset.parent&&t++}if(!t){const e=a.stage;n=e.width,o=e.height}}const l=d.$sceneChange.concatenatedMatrix,c=d.$timelineFrame.currentFrame,h=a.scene;for(let a=0;a<r.length;++a){const u=r[a],m=h.getLayer(0|u.dataset.layerId);if(!m||m.lock||m.disable)continue;const g=m.getCharacter(0|u.dataset.characterId),$=g.getPlace(c);if(!$.point){const e=g.getBounds(l),t=d.$sceneChange.offsetX+e.xMin,r=d.$sceneChange.offsetY+e.yMin,a=Math.ceil(Math.abs(e.xMax-e.xMin))/2,s=Math.ceil(Math.abs(e.yMax-e.yMin))/2;$.point={x:t+a,y:r+s}}const p=$.matrix[4],f=$.matrix[5],y=g.getBounds(l),_=Math.abs(y.xMax-y.xMin),b=Math.abs(y.yMax-y.yMin);switch(e){case"left":$.matrix[4]=p-y.xMin+s;break;case"right":$.matrix[4]=p-y.xMin+s+n-_;break;case"center":$.matrix[4]=p-y.xMin+s+n/2-_/2;break;case"top":$.matrix[5]=f-y.yMin+i;break;case"bottom":$.matrix[5]=f-y.yMin+i+o-b;break;case"middle":$.matrix[5]=f-y.yMin+i+o/2-b/2}const v=document.getElementById(`character-${g.id}`),I=g.getBounds(l),E=d.$offsetLeft+(d.$sceneChange.offsetX+I.xMin)*d.$zoomScale,S=d.$offsetTop+(d.$sceneChange.offsetY+I.yMin)*d.$zoomScale;v.style.top=`${S}px`,v.style.left=`${E}px`,g.screenX=I.xMin,g.screenY=I.yMin;const w=$.point;w.x+=$.matrix[4]-p,w.y+=$.matrix[5]-f,1===r.length&&"stage"===t&&(document.getElementById("object-x").value=`${$.matrix[4]}`,document.getElementById("object-y").value=`${$.matrix[5]}`)}d.$transformController.relocation(),this._$saved=!1}changeDepthOne(e="up"){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;this.save();const r=d.$currentWorkSpace().scene,a=d.$timelineFrame.currentFrame,s=new Map;for(let e=0;e<t.length;++e){const a=t[e],i=r.getLayer(0|a.dataset.layerId);s.has(i.id)||s.set(i.id,[]),s.get(i.id).push(i.getCharacter(0|a.dataset.characterId))}for(const[t,i]of s){const s=r.getLayer(t).getActiveCharacter(a);if(1>=s.length)continue;s.sort(((e,t)=>{const r=e.getPlace(a).depth,s=t.getPlace(a).depth;switch(!0){case r>s:return-1;case r<s:return 1;default:return 0}})),i.length>1&&("up"===e?i.sort(((e,t)=>{const r=e.getPlace(a).depth,s=t.getPlace(a).depth;switch(!0){case r>s:return-1;case r<s:return 1;default:return 0}})):i.sort(((e,t)=>{const r=e.getPlace(a).depth,s=t.getPlace(a).depth;switch(!0){case r>s:return 1;case r<s:return-1;default:return 0}})));let n=0,o=s.length-1;for(let t=0;t<i.length;++t){const r=i[t],l=r.getPlace(a);if("up"===e){if(l.depth>=o){--o;continue}l.depth++;const e=s.indexOf(r);s[e-1].getPlace(a).depth--}else{if(n>=l.depth){++n;continue}l.depth--;const e=s.indexOf(r);s[e+1].getPlace(a).depth++}s.sort(((e,t)=>{const r=e.getPlace(a).depth,s=t.getPlace(a).depth;switch(!0){case r>s:return-1;case r<s:return 1;default:return 0}}))}}this.reloadScreen(),this._$saved=!1}changeDepth(e="up"){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;this.save();const r=d.$currentWorkSpace().scene,a=d.$timelineFrame.currentFrame,s=new Map;for(let e=0;e<t.length;++e){const a=t[e],i=r.getLayer(0|a.dataset.layerId);s.has(i.id)||s.set(i.id,[]),s.get(i.id).push(i.getCharacter(0|a.dataset.characterId))}for(const[t,i]of s){const s=r.getLayer(t).getActiveCharacter(a);if(1>=s.length)continue;s.sort(((e,t)=>{const r=e.getPlace(a).depth,s=t.getPlace(a).depth;switch(!0){case r>s:return-1;case r<s:return 1;default:return 0}})),i.length>1&&("up"===e?i.sort(((e,t)=>{const r=e.getPlace(a).depth,s=t.getPlace(a).depth;switch(!0){case r>s:return-1;case r<s:return 1;default:return 0}})):i.sort(((e,t)=>{const r=e.getPlace(a).depth,s=t.getPlace(a).depth;switch(!0){case r>s:return 1;case r<s:return-1;default:return 0}})));const n=new Map;let o=0,l=s.length-1;for(let t=0;t<i.length;++t){const r=i[t],c=r.getPlace(a);if("up"===e){if(c.depth>=l){--l;continue}c.depth=l--,n.set(r.id,!0);let e=l;for(let t=0;s.length>t;++t){const r=s[t];if(!n.has(r.id)&&(r.getPlace(a).depth=e--,-1===e))break}}else{if(o>=c.depth){++o;continue}c.depth=o++,n.set(r.id,!0);let e=o;for(let t=s.length-1;t>-1;--t){const r=s[t];if(!n.has(r.id)&&(r.getPlace(a).depth=e++,e===s.length))break}}}}this.reloadScreen(),this._$saved=!1}show(e){d.$endMenu("screen-menu");const t=document.getElementById("screen-menu"),r=t.clientHeight/2+15;if(t.style.left=`${e.pageX+5}px`,t.style.top=e.pageY-r+"px",15>t.offsetTop&&(t.style.top="10px"),e.pageY+r>window.innerHeight){const a=window.innerHeight-(e.pageY+r-15);t.style.top=`${t.offsetTop+a}px`}t.setAttribute("class","fadeIn")}};class ve extends be{constructor(){super(),this._$state="hide",this._$elementIds=["ruler-top","ruler-left"],this._$size=ve.DEFAULT_SIZE,this._$mouseMove=null,this._$mouseUp=null,this._$target=null,this._$mode=""}static get DEFAULT_SIZE(){return 5}get state(){return this._$state}initialize(){super.initialize(),document.documentElement.style.setProperty("--ruler-size",ve.DEFAULT_SIZE-1+"px");for(let e=0;e<this._$elementIds.length;++e){const t=document.getElementById(this._$elementIds[e]);t&&t.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault(),this.executeFunction(e.target.id)}))}}mouseMove(e){this._$target&&window.requestAnimationFrame((()=>{this._$target&&(e.stopPropagation(),e.preventDefault(),"x"===this._$mode?this._$target.style.left=`${e.offsetX}px`:this._$target.style.top=`${e.offsetY}px`)}))}mouseUp(e){d.$tools.getDefaultTool("arrow").changeNodeEvent(),window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),this.save();const t=d.$currentWorkSpace(),r=document.getElementById("screen");if("true"===e.target.dataset.removeZone){if("x"===this._$mode){const e=Array.from(r.getElementsByClassName("ruler-border-x")).indexOf(this._$target);t._$rulerX.splice(e,1)}else{const e=Array.from(r.getElementsByClassName("ruler-border-y")).indexOf(this._$target);t._$rulerY.splice(e,1)}this._$target.remove()}else if("x"===this._$mode){const e=Array.from(r.getElementsByClassName("ruler-border-x")).indexOf(this._$target);t._$rulerX[e]=(this._$target.offsetLeft-d.$offsetLeft)/d.$zoomScale}else{const e=Array.from(r.getElementsByClassName("ruler-border-y")).indexOf(this._$target);t._$rulerY[e]=(this._$target.offsetTop-d.$offsetTop)/d.$zoomScale}this.changeNodeEvent(!0),this._$move="",this._$target=null,this._$saved=!1}changeNodeEvent(e=!0){const t=document.getElementById("screen");if(!t)return;const r=t.getElementsByClassName("ruler-border-x");for(let t=0;t<r.length;++t)r[t].style.pointerEvents=e?"":"none";const a=t.getElementsByClassName("ruler-border-y");for(let t=0;t<a.length;++t)a[t].style.pointerEvents=e?"":"none"}reload(){if("hide"===this._$state)return;const e=document.getElementById("screen");if(!e)return;const t=document.getElementById("stage-area");if(!t)return;let r="";r+=`height: ${t.offsetHeight}px;`,r+=`left: ${e.scrollLeft}px;`,document.getElementById("ruler-left").setAttribute("style",r);let a="";a+=`width: ${t.offsetWidth}px;`,a+=`top: ${e.scrollTop}px;`,document.getElementById("ruler-top").setAttribute("style",a)}executeRulerTop(){document.getElementById("stage-area")&&"arrow"===d.$tools.activeTool.name&&(this._$mode="y",this._$target=this.createBorderY(),document.getElementById("screen").prepend(this._$target),d.$currentWorkSpace()._$rulerY.unshift(this._$target.offsetTop-d.$offsetTop),this.setupMove())}createBorderY(){const e=document.getElementById("stage-area");if(!e)return;const t=document.createElement("div");return t.setAttribute("style",`width: ${e.offsetWidth}px;`),t.setAttribute("class","ruler-border-y"),t.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault(),this._$target=e.target,this._$mode="y",this.setupMove()})),t}executeRulerLeft(){document.getElementById("stage-area")&&"arrow"===d.$tools.activeTool.name&&(this._$mode="x",this._$target=this.createBorderX(),document.getElementById("screen").prepend(this._$target),d.$currentWorkSpace()._$rulerX.unshift(this._$target.offsetLeft-d.$offsetLeft),this.setupMove())}createBorderX(){const e=document.getElementById("stage-area");if(!e)return;const t=document.createElement("div");return t.setAttribute("style",`height: ${e.offsetHeight}px;`),t.setAttribute("class","ruler-border-x"),t.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault(),this._$target=e.target,this._$mode="x",this.setupMove()})),t}setupMove(){const e=d.$tools.getDefaultTool("arrow");e.clear(),e.changeNodeEvent(!1),this.changeNodeEvent(!1),this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}rebuild(){if(this.removeAll(),this._$size=ve.DEFAULT_SIZE*d.$zoomScale,document.documentElement.style.setProperty("--ruler-size",this._$size-1+"px"),"show"===this._$state){const e=document.getElementById("stage"),t=document.getElementById("stage-area");this.createRuler(document.getElementById("ruler-top"),e.offsetLeft,t.offsetWidth),this.createRuler(document.getElementById("ruler-left"),e.offsetTop,t.offsetHeight),this.reload()}this.createBorder()}createBorder(){const e=d.$currentWorkSpace(),t=document.getElementById("screen");for(let r=e._$rulerX.length-1;r>-1;--r){const a=e._$rulerX[r],s=this.createBorderX();s.style.left=`${d.$offsetLeft+a*d.$zoomScale}px`,t.prepend(s)}for(let r=e._$rulerY.length-1;r>-1;--r){const a=e._$rulerY[r],s=this.createBorderY();s.style.top=`${d.$offsetTop+a*d.$zoomScale}px`,t.prepend(s)}}createRuler(e,t,r){const a=this._$size,s=a>=ve.DEFAULT_SIZE?50:200,i=a>=ve.DEFAULT_SIZE?10:40,n=a*i,o=t/d.$zoomScale|0,l=o%s,c=l/ve.DEFAULT_SIZE;if(c){const t=document.createElement("div");t.setAttribute("class","vertical-main");const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","vertical-header");const a=document.createElement("div");t.appendChild(a),a.setAttribute("class","vertical-meter");for(let e=0;c>e;++e){const t=document.createElement("div");t.setAttribute("class",e%2==0?"vertical-line":"vertical-line-pointer"),a.appendChild(t)}e.appendChild(t)}r=r/n|0;let h=o-l;for(let t=0;r>t;++t){const t=document.createElement("div");t.setAttribute("class","vertical-main");const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","vertical-header"),r.textContent=`${Math.abs(h)}`;const a=document.createElement("div");t.appendChild(a),a.setAttribute("class","vertical-meter");for(let e=0;i>e;++e){const t=document.createElement("div");t.setAttribute("class",e%2==0?"vertical-line":"vertical-line-pointer"),a.appendChild(t)}h-=s,e.appendChild(t)}}show(){if("show"===this._$state)return void this.hide();d.$currentWorkSpace()._$ruler=!0,this._$state="show",this.rebuild()}hide(){if("hide"===this._$state)return;d.$currentWorkSpace()._$ruler=!1,this.clear(),this.createBorder()}clear(){this._$state="hide",this.removeAll()}removeAll(){for(let e=0;this._$elementIds.length>e;++e){const t=document.getElementById(this._$elementIds[e]);if(t){for(;t.firstChild;)t.firstChild.remove();t.setAttribute("style","display: none;")}}const e=document.getElementById("screen");if(!e)return;const t=e.getElementsByClassName("ruler-border-x");for(;t.length;)t[0].remove();const r=e.getElementsByClassName("ruler-border-y");for(;r.length;)r[0].remove()}}d.$screenRuler=new ve;d.$screenTab=new class{constructor(){this._$dropTab=null,this._$saved=!1}run(){for(let e=0;e<d.$workSpaces.length;++e)this.createElement(d.$workSpaces[e],e);const e=document.getElementById("view-tab-add");e&&e.addEventListener("click",(e=>{this.addTab(e)}));const t=document.getElementById("view-tab-list");t&&t.addEventListener("mousedown",(e=>{this.showTabList(e)}))}showTabList(e){e.stopPropagation();const t=document.getElementById("tab-name-menu");if(t.classList.contains("fadeIn"))return d.$endMenu();d.$endMenu("tab-name-menu");const r=e.currentTarget;t.style.left=`${r.offsetLeft+r.offsetWidth}px`,t.style.top=`${r.offsetTop+25}px`,t.setAttribute("class","fadeIn")}createElement(e,t){e.name||(e.name=`Untitled-${t+1}`);const r=document.getElementById("view-tab-area");if(!r)return;r.insertAdjacentHTML("beforeend",`\n<div draggable="true" id="tab-id-${t}" data-tab-id="${t}" class="tab">\n    <p id="tab-text-id-${t}" data-tab-id="${t}" data-detail="{{タブの移動・名前を変更}}" data-shortcut-key="ArrowLeftCtrl" data-shortcut-text="Ctrl + ◀︎ or ▶" data-area="global">${e.name}</p>\n    <input type="text" id="tab-input-id-${t}" data-tab-id="${t}" value="${e.name}" autocomplete="off">\n    <i id="tab-delete-id-${t}" data-tab-id="${t}" data-detail="{{プロジェクトを閉じる}}"></i>\n</div>`);const a=document.getElementById(`tab-id-${t}`);d.$addModalEvent(a),a.classList.add(d.$activeWorkSpaceId===t?"active":"disable"),a.addEventListener("mousedown",(e=>{this.activeTab(e)})),a.addEventListener("dragstart",(e=>{this.dragStart(e)})),a.addEventListener("dragover",(e=>{this.dragOver(e)})),a.addEventListener("dragleave",(e=>{this.dragLeave(e)})),a.addEventListener("drop",(e=>{this.drop(e)})),document.getElementById(`tab-delete-id-${t}`).addEventListener("click",(e=>{this.deleteTab(e)})),document.getElementById(`tab-text-id-${t}`).addEventListener("dblclick",(e=>{this.editStart(e)}));const s=document.getElementById(`tab-input-id-${t}`);s&&(s.style.display="none",s.addEventListener("focusout",(e=>{this.editEnd(e)})),s.addEventListener("keypress",(e=>{this.editEnd(e)}))),document.getElementById("tab-name-menu-list").insertAdjacentHTML("beforeend",`\n<div id="tab-menu-id-${t}" data-tab-id="${t}">${e.name}</div>`);const i=document.getElementById(`tab-menu-id-${t}`);i&&i.addEventListener("mousedown",(e=>{this.activeTab(e,!0)}))}drop(e){e.preventDefault(),this.save(),e.currentTarget.classList.remove("drop-target");const t=e.currentTarget.nextElementSibling;document.getElementById("view-tab-area").insertBefore(this._$dropTab,this._$dropTab===t?e.currentTarget:t),this._$dropTab=null,this._$saved=!1}dragLeave(e){e.preventDefault(),e.currentTarget.classList.remove("drop-target")}dragOver(e){e.preventDefault(),e.currentTarget.classList.add("drop-target")}dragStart(e){d.$endMenu(),this._$dropTab=e.currentTarget}activeTab(e,t=!1){d.$root._$stage._$player.stop(),d.$endMenu();const r=document.getElementById(`tab-id-${d.$activeWorkSpaceId}`);r&&(r.classList.remove("active"),r.classList.add("disable"));const a=0|e.currentTarget.dataset.tabId,s=document.getElementById(`tab-id-${a}`);if(s&&(s.classList.remove("disable"),s.classList.add("active"),t)){const e=document.getElementById("view-tab-area");s.remove(),e.prepend(s)}d.$activeWorkSpaceId!==a&&d.$changeWorkSpace(a)}deleteTab(e){e.preventDefault();const t=d.$currentLanguage.replace("{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}");if(!window.confirm(t))return;d.$root._$stage._$player.stop();const r=0|e.currentTarget.dataset.tabId,a=d.$workSpaces[r];d.$workSpaces[r]=null,document.getElementById(`tab-id-${r}`).remove(),document.getElementById(`tab-menu-id-${r}`).remove();const s=document.getElementById("library-preview-area");for(;s.children.length;)s.children[0].remove();d.$tools.getDefaultTool("arrow").clear();const i=document.getElementById("view-tab-area");if(i.children.length){if(d.$activeWorkSpaceId===r){const e=i.children[0];e.setAttribute("class","tab active"),a.stop(),d.$activeWorkSpaceId=0|e.dataset.tabId,d.$currentWorkSpace().run()}}else{d.$workSpaces.length=0,d.$activeWorkSpaceId=0;const e=new z;d.$workSpaces.push(e),this.createElement(e,0),a.stop(),e.run();i.children[0].setAttribute("class","tab active")}}editStart(e){d.$keyLock=!0;const t=e.currentTarget,r=0|t.dataset.tabId,a=document.getElementById(`tab-input-id-${r}`);if("none"===a.style.display){a.style.width=`${t.offsetWidth}px`,a.style.display="",t.style.display="none",a.focus();document.getElementById(`tab-id-${r}`).draggable=!1}}editEnd(e){if("Enter"!==e.key){if("focusout"===e.type){this.save();const t=e.currentTarget;t.style.display="none";const r=0|t.dataset.tabId,a=document.getElementById(`tab-text-id-${r}`),s=document.getElementById(`tab-menu-id-${r}`);d.$workSpaces[r].name=t.value,s.textContent=t.value,a.textContent=t.value,a.style.display="";document.getElementById(`tab-id-${r}`).draggable=!0,this._$saved=!1}}else e.target.blur()}addTab(e){d.$endMenu(),e.stopPropagation(),this.save();const t=d.$workSpaces.length,r=new z;d.$workSpaces.push(r),this.createElement(r,t),this._$saved=!1}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}};class Ie extends be{constructor(){super(),this._$currentValue=0}static get MIN_LEVEL(){return.25}static get MAX_LEVEL(){return 5}initialize(){super.initialize();const e=document.getElementById("screen-scale");e&&this.setInputEvent(e)}changeScreenScale(e){return e=d.$clamp(0|e,100*Ie.MIN_LEVEL,100*Ie.MAX_LEVEL),this.execute((e-this._$currentValue)/100),this._$currentValue=e,e}execute(e){const t=d.$zoomScale;d.$zoomScale+=e,d.$zoomScale=Math.min(Ie.MAX_LEVEL,Math.max(Ie.MIN_LEVEL,d.$zoomScale)),document.getElementById("screen-scale").value=""+(100*d.$zoomScale|0);const r=d.$currentWorkSpace(),a=d.$timelineFrame.currentFrame,s=r.scene;for(const e of s._$layers.values()){const t=e.getActiveCharacter(a);for(let e=0;e<t.length;++e)t[e].dispose()}s.changeFrame(a).then((()=>{const e=document.getElementById("stage-area");if(!e)return;let t=null;const r=e.children;for(let e=0;r.length>e;++e){const a=r[e];a.dataset.shapePointer&&(t=a,a.remove(),--e)}if(t){const e=d.$currentWorkSpace(),r=0|t.dataset.characterId,s=0|t.dataset.layerId,i=e.scene.getLayer(s).getCharacter(r),n=e.getLibrary(0|t.dataset.libraryId),o=i.getPlace(a).matrix;n.createPointer(o,s,r)}}));const i=r.stage.width*d.$zoomScale,n=r.stage.height*d.$zoomScale,o=document.getElementById("screen"),l=document.getElementById("stage-area"),c=document.getElementById("stage"),h=o.clientWidth,u=o.clientHeight,m=i+window.screen.width,g=n+window.screen.height;c.style.width=`${i}px`,c.style.height=`${n}px`,l.setAttribute("style",`width: ${m}px; height: ${g}px;`);const $=h/2,p=u/2,f=(o.scrollLeft+$-d.$offsetLeft)/t*d.$zoomScale,y=(o.scrollTop+p-d.$offsetTop)/t*d.$zoomScale;o.scrollLeft=d.$offsetLeft+f-$,o.scrollTop=d.$offsetTop+y-p,d.$rebuildRuler()}}d.$screenZoom=new Ie;d.$alignController=new class extends he{constructor(){super("align")}initialize(){super.initialize();const e=["align-position-left","align-position-center","align-position-right","align-position-top","align-position-middle","align-position-bottom","align-stage-position-left","align-stage-position-center","align-stage-position-right","align-stage-position-top","align-stage-position-middle","align-stage-position-bottom"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e.target.id)}))}}changeAlignStagePositionLeft(){d.$screenMenu.alignment("left","stage")}changeAlignPositionLeft(){d.$screenMenu.alignment("left")}changeAlignStagePositionCenter(){d.$screenMenu.alignment("center","stage")}changeAlignPositionCenter(){d.$screenMenu.alignment("center")}changeAlignStagePositionRight(){d.$screenMenu.alignment("right","stage")}changeAlignPositionRight(){d.$screenMenu.alignment("right")}changeAlignStagePositionTop(){d.$screenMenu.alignment("top","stage")}changeAlignPositionTop(){d.$screenMenu.alignment("top")}changeAlignStagePositionMiddle(){d.$screenMenu.alignment("middle","stage")}changeAlignPositionMiddle(){d.$screenMenu.alignment("middle")}changeAlignStagePositionBottom(){d.$screenMenu.alignment("bottom","stage")}changeAlignPositionBottom(){d.$screenMenu.alignment("bottom")}};d.$blendController=new class extends he{constructor(){super("blend")}initialize(){super.initialize(),this.setChangeEvent(document.getElementById("blend-select"))}changeBlendSelect(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const r=d.$currentWorkSpace().scene,a=t[0],s=r.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId),i=d.$timelineFrame.currentFrame;let n=s.getPlace(i);n.tweenFrame&&(s.endFrame-1>i&&!s.hasTween(i)&&(d.$timelineTool.executeTimelineKeyAdd(),n=s.getPlace(i)),n=s.getPlace(n.tweenFrame)),n.blendMode=`${e}`,n.tweenFrame&&s.updateTweenBlend(i),s.dispose()}};class Ee extends he{constructor(){super("color")}static get MIN_OFFSET(){return-255}static get MAX_OFFSET(){return 255}static get MIN_MULTIPLIER(){return 0}static get MAX_MULTIPLIER(){return 100}initialize(){super.initialize();const e=["color-alpha-offset","color-red-offset","color-green-offset","color-blue-offset","color-alpha-multiplier","color-red-multiplier","color-green-multiplier","color-blue-multiplier"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&this.setInputEvent(r)}}changeColorRedMultiplier(e){return e=d.$clamp(+e,Ee.MIN_MULTIPLIER,Ee.MAX_MULTIPLIER),this.updateColor(0,e/100),e}changeColorGreenMultiplier(e){return e=d.$clamp(+e,Ee.MIN_MULTIPLIER,Ee.MAX_MULTIPLIER),this.updateColor(1,e/100),e}changeColorBlueMultiplier(e){return e=d.$clamp(+e,Ee.MIN_MULTIPLIER,Ee.MAX_MULTIPLIER),this.updateColor(2,e/100),e}changeColorAlphaMultiplier(e){return e=d.$clamp(+e,Ee.MIN_MULTIPLIER,Ee.MAX_MULTIPLIER),this.updateColor(3,e/100),e}changeColorRedOffset(e){return e=d.$clamp(0|e,Ee.MIN_OFFSET,Ee.MAX_OFFSET),this.updateColor(4,e),e}changeColorGreenOffset(e){return e=d.$clamp(0|e,Ee.MIN_OFFSET,Ee.MAX_OFFSET),this.updateColor(5,e),e}changeColorBlueOffset(e){return e=d.$clamp(0|e,Ee.MIN_OFFSET,Ee.MAX_OFFSET),this.updateColor(6,e),e}changeColorAlphaOffset(e){return e=d.$clamp(0|e,Ee.MIN_OFFSET,Ee.MAX_OFFSET),this.updateColor(7,e),e}updateColor(e,t){const r=d.$tools.getDefaultTool("arrow").activeElements;if(!r.length)return;const a=d.$currentWorkSpace().scene,s=r[0],i=a.getLayer(0|s.dataset.layerId).getCharacter(0|s.dataset.characterId),n=d.$timelineFrame.currentFrame;i.getPlace(n).colorTransform[e]=t,i.relocationTween(n),i.dispose()}}d.$colorTransformController=new Ee;d.$confirmModal=new class extends he{constructor(){super(""),this._$files=[],this._$state="hide",this._$currentObject=null,this._$mapping=new Map,this._$layers=new Map,this._$ignore=new Map,this._$callback=null}get files(){return this._$files}set files(e){this._$files=e}initialize(){super.initialize();const e=["confirm-overwriting","confirm-skip","confirm-all-overwriting","confirm-all-skip"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation();return this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}))}}addCallback(e){this._$callback=e}executeConfirmAllOverwriting(){this.save();const e=[],t=d.$currentWorkSpace();this._$files.unshift(this._$currentObject);for(let r=0;r<this._$files.length;++r){const a=this._$files[r];if(!a)continue;const s=t._$nameMap.get(a.path);switch(a.type){case"move":this._$currentObject=a,this.moveOverwriting(s);break;case"copy":this._$currentObject=a,this.copyOverwriting(s);break;default:e.push(new Promise((e=>{d.$libraryController.loadFile(a.file,e,a.folderId,a.file.name,s)})))}}return this._$currentObject=null,this._$files.length=0,Promise.all(e).then((()=>{this._$callback&&this.executeCallBack(),this.hide(),d.$libraryController.reload(),this.reloadScreen(),this._$saved=!1}))}executeConfirmAllSkip(){for(let e=0;e<this._$files.length;++e){const t=this._$files[e];if("copy"!==t.type)continue;const r=t.layer,a=t.character;this._$ignore.set(a.libraryId,!0),r&&a&&r.deleteCharacter(a.id)}this._$currentObject=null,this._$files.length=0,this.hide()}cloneFolderItem(e,t,r){const a=d.$workSpaces[e],s=d.$currentWorkSpace();for(const i of a._$libraries.values()){if(i.folderId!==t)continue;if(this._$mapping.has(i.id))continue;const n=i.getPathWithWorkSpace(a);if(s._$nameMap.has(n)){this.files.push({file:i,character:null,layer:null,path:n,workSpaceId:e,type:"copy"});continue}let o=null;if(i.type===b.MOVIE_CLIP)o=this.cloneMovieClip(e,i);else{const t=d.$activeWorkSpaceId;d.$activeWorkSpaceId=e,o=i.clone(),d.$activeWorkSpaceId=t}o._$id=s.nextLibraryId,o.folderId=r.id,this._$mapping.set(i.id,o._$id),d.$libraryController.createInstance(o.type,o.name,o.id,o.symbol),s._$libraries.set(o.id,o),o.type===b.FOLDER&&this.cloneFolderItem(e,i.id,o)}}cloneMovieClip(e,t){const r=d.$workSpaces[e],a=d.$currentWorkSpace(),s=d.$activeWorkSpaceId;d.$activeWorkSpaceId=e;const i=t.clone();d.$activeWorkSpaceId=s;for(const t of i._$layers.values())for(let s=0;s<t._$characters.length;++s){const i=t._$characters[s];if(this._$mapping.has(i.libraryId)){i.libraryId=this._$mapping.get(i.libraryId);continue}const n=r.getLibrary(i.libraryId),o=n.getPathWithWorkSpace(r);if(a._$nameMap.has(o)){this.files.push({file:n,character:i,layer:t,path:o,workSpaceId:e,type:"copy"});continue}let l=null;if(n.type===b.MOVIE_CLIP)l=this.cloneMovieClip(e,n);else{const t=d.$activeWorkSpaceId;d.$activeWorkSpaceId=e,l=n.clone(),d.$activeWorkSpaceId=t}l&&(i.libraryId=l._$id=a.nextLibraryId,this._$mapping.set(n.id,l.id),l.folderId&&this.createFolder(e,n),d.$libraryController.createInstance(l.type,l.name,l.id,l.symbol),a._$libraries.set(l.id,l))}return i}copyOverwriting(e=0,t=""){const r=d.$currentWorkSpace(),a=this._$currentObject.file,s=e||r.nextLibraryId;if(!this._$mapping.has(a.id)){if(this._$mapping.set(a.id,s),e){const t=document.getElementById(`library-child-id-${e}`);if(t&&t.remove(),a.type!==b.FOLDER)for(const t of r._$libraries.values())if(t.type===b.MOVIE_CLIP)for(const r of t._$layers.values())for(let t=0;t<r._$characters.length;++t){const a=r._$characters[t];a.dispose(),a.libraryId===e&&(a.libraryId=s)}r.removeLibrary(e)}let i=null;if(a.type===b.MOVIE_CLIP)i=this.cloneMovieClip(this._$currentObject.workSpaceId,a);else{const e=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$currentObject.workSpaceId,i=a.clone(),d.$activeWorkSpaceId=e}i._$id=s,t&&(i._$name=t),d.$libraryController.createInstance(i.type,i.name,i.id,i.symbol),r._$libraries.set(i.id,i),i.folderId&&this.createFolder(this._$currentObject.workSpaceId,i)}this.addLayer(s)}pasteDisplayObject(e,t,r){const a=d.$timelineFrame.currentFrame;let s=null;const i=e.getActiveCharacter(a);if(i.length&&(s=i[0].getRange(a)),!s){const t=e.getActiveEmptyCharacter(a);t&&(s={startFrame:t.startFrame,endFrame:t.endFrame},e.deleteEmptyCharacter(t))}if(!s){d.$timelineTool.executeTimelineFrameAdd();const t=e.getActiveCharacter(a);if(t.length&&(s=t[0].getRange(a)),!s){const t=e.getActiveEmptyCharacter(a);t&&(s={startFrame:t.startFrame,endFrame:t.endFrame},e.deleteEmptyCharacter(t))}}const n=new Map,o=e.getActiveCharacter(Math.min(1,s.startFrame-1));for(let e=0;e<o.length;++e){const t=o[e];if(t.endFrame>a)continue;const r=t.libraryId;n.has(r)||n.set(r,[]),n.get(r).push(t)}const l=t.libraryId,c=t.getPlace(r);if(c.depth=e.getActiveCharacter(a).length,n.size&&n.has(l)){const e=n.get(l),t=e.pop();e.length&&n.delete(l),t.startFrame=Math.min(t.startFrame,s.startFrame),t.endFrame=Math.max(t.endFrame,s.endFrame),t.setPlace(s.startFrame,c)}else t.startFrame=s.startFrame,t.endFrame=s.endFrame,t._$places.clear(),t._$tween.clear(),t.setPlace(s.startFrame,c),e.addCharacter(t)}createFolder(e,t){const r=d.$workSpaces[e],a=d.$currentWorkSpace();let s=t,i=r.getLibrary(t.folderId);for(;;){const e=i.getPathWithWorkSpace(r);if(a._$nameMap.has(e)){s.folderId=a._$nameMap.get(e);break}const t=i.clone();if(s.folderId=t._$id=a.nextLibraryId,d.$libraryController.createInstance(t.type,t.name,t.id,t.symbol),a._$libraries.set(t.id,t),!i.folderId)break;s=i,i=r.getLibrary(i.folderId)}}checkFolder(e,t=""){const r=d.$currentWorkSpace();for(const a of r._$libraries.values()){if(a.folderId!==e.id)continue;if(a.type===b.FOLDER){const e=t?a.name:`${t}/${a.name}`;this.checkFolder(a,e)}a.folderId=0;const s=t?a.path:`${t}/${a.path}`;a.folderId=e.id,r._$nameMap.has(s)&&(d.$confirmModal.files.push({file:a,folderId:e.id,path:s,type:"move"}),d.$confirmModal.show())}}deleteFolderItem(e){const t=d.$currentWorkSpace();for(const r of t._$libraries.values())r.folderId===e.id&&(r.type===b.FOLDER?this.deleteFolderItem(r):this.removeCharacter(r.id),document.getElementById(`library-child-id-${r.id}`).remove(),t.removeLibrary(r.id))}removeCharacter(e){const t=d.$currentWorkSpace();for(const r of t._$libraries.values())if(r.type===b.MOVIE_CLIP)for(const t of r._$layers.values())for(let r=0;r<t._$characters.length;++r){const a=t._$characters[r];a.libraryId===e&&t.deleteCharacter(a.id)}}moveOverwriting(e){const t=d.$currentWorkSpace(),r=this._$currentObject.file,a=document.getElementById(`library-child-id-${e}`);a&&a.remove(),document.getElementById(`library-child-id-${r.id}`).remove();const s=t.getLibrary(e);if(r.folderId=s.folderId,r.type!==b.FOLDER){for(const a of t._$libraries.values())if(a.type===b.MOVIE_CLIP)for(const t of a._$layers.values())for(let a=0;a<t._$characters.length;++a){const s=t._$characters[a];s.libraryId===r.id&&(s.libraryId=e,s.dispose())}}else{this.deleteFolderItem(s);for(const a of t._$libraries.values())a.folderId===r.id&&(a.folderId=e)}t.removeLibrary(r.id),r._$id=e,d.$libraryController.createInstance(r.type,r.name,r.id,r.symbol),t._$libraries.set(r.id,r);const i=d.$currentWorkSpace().scene;for(const e of i._$layers.values())for(let t=0;t<e._$characters.length;++t)e._$characters[t].dispose()}executeConfirmOverwriting(){this.save();const e=document.getElementById("confirm-file-name").value;let t=this._$currentObject.file.name;t.indexOf(".swf")>-1&&(t=t.replace(".swf",""));const r=d.$currentWorkSpace();let a=0;switch(e===t&&(a=r._$nameMap.get(this._$currentObject.path)),this._$currentObject.type){case"move":if(a)this.moveOverwriting(a);else{const t=this._$currentObject.file;t.name=e,t.folderId=this._$currentObject.folderId,t.type===b.FOLDER&&(this._$files.length=0),document.getElementById(`library-child-id-${t.id}`).remove(),d.$libraryController.createInstance(t.type,t.name,t.id,t.symbol)}this.setup();break;case"copy":this.copyOverwriting(a,e),this.setup();break;default:new Promise((t=>{d.$libraryController.loadFile(this._$currentObject.file,t,this._$currentObject.folderId,e,a)})).then((()=>{this.setup()}))}this._$saved=!1}addLayer(e){const t=this._$currentObject.character;if(!t)return;t.libraryId=e;const r=this._$currentObject.layer;if(r){const e=this._$currentObject.copyFrame;e?this.pasteDisplayObject(r,t,e):(r.addCharacter(t),this._$layers.has(r.id)||this._$layers.set(r.id,r)),r.reloadStyle()}}executeConfirmSkip(){if("copy"===this._$currentObject.type){const e=this._$currentObject.layer,t=this._$currentObject.character;this._$ignore.set(t.libraryId,!0),e&&t&&e.deleteCharacter(t.id)}this.setup()}executeCallBack(){this._$callback(this._$ignore),this._$callback=null}hide(){if("hide"===this._$state)return;this._$state="hide";const e=document.getElementById("confirm-modal");e&&(e.classList.contains("fadeOut")||e.setAttribute("class","fadeOut"))}show(){if("show"===this._$state)return;this._$state="show",d.$endMenu();const e=document.getElementById("confirm-modal");e&&(e.classList.contains("fadeIn")||e.setAttribute("class","fadeIn")),this.setup()}clear(){this._$callback=null,this._$layers.clear(),this._$mapping.clear(),this._$ignore.clear()}setup(){if(this._$currentObject=this._$files.shift(),this._$currentObject&&this._$mapping.size)for(;this._$mapping.has(this._$currentObject.file.id);){const e=this._$mapping.get(this._$currentObject.file.id);if(this.addLayer(e),this._$currentObject=this._$files.shift(),!this._$currentObject)break}if(!this._$currentObject){if(this._$callback&&d.$confirmModal.executeCallBack(),this.hide(),d.$libraryController.reload(),this._$layers.size)for(const e of this._$layers.values())e.setCharacterStyle();return this.clear(),void this.reloadScreen()}const e=document.getElementById("confirm-before-preview");for(;e.firstChild;)e.firstChild.remove();const t=document.getElementById("confirm-after-preview");for(;t.firstChild;)t.firstChild.remove();const r=document.getElementById("confirm-file-name");let a=this._$currentObject.file.name;a.indexOf(".swf")>-1&&(a=a.replace(".swf","")),r.value=a,r.focus();const s=d.$currentWorkSpace(),i=s.getLibrary(s._$nameMap.get(this._$currentObject.path));i&&i.getPreview().then((t=>{e.appendChild(t)}));const n=this._$currentObject.file;switch(n.type){case"image/svg+xml":case"image/png":case"image/jpeg":case"image/gif":{const e=new Image;e.onload=()=>{t.appendChild(e)},e.src=URL.createObjectURL(n)}break;case"video/mp4":{const e=document.createElement("video");e.crossOrigin="anonymous",e.type="video/mp4",e.muted=!0,e.autoplay=!1,e.controls=!0,e.onloadedmetadata=()=>{t.appendChild(e)},e.src=URL.createObjectURL(n),e.load()}break;case"audio/mpeg":{const e=document.createElement("audio");e.preload="auto",e.autoplay=!1,e.loop=!1,e.controls=!0,e.src=URL.createObjectURL(n),e.load(),t.appendChild(e)}break;default:if("copy"===this._$currentObject.type){const e=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$currentObject.workSpaceId,this._$currentObject.file.getPreview().then((e=>{t.appendChild(e)})),d.$activeWorkSpaceId=e}else this._$currentObject.file.getPreview().then((e=>{t.appendChild(e)}))}}};d.$controller=new class extends he{initialize(){super.initialize();const e=document.getElementById("controller");e&&e.addEventListener("mouseover",(()=>{d.$setCursor("auto")}))}showObjectSetting(e){for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.setAttribute("style","")}}hideObjectSetting(e){for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.setAttribute("style","display: none;")}}default(){d.$filterController.clear(),this.hideObjectSetting(["object-area","instance-setting","fill-color-setting"]),this.showObjectSetting(["stage-setting","sound-setting","object-setting","color-setting","blend-setting","filter-setting"]);const e=d.$currentWorkSpace();if(!e)return;const t=e.scene;if(!t)return;const r=document.getElementById("object-name");r&&(r.value=t.name);const a=document.getElementById("object-symbol");a&&(a.value=t.symbol)}};class Se{constructor(){this._$pointX=0,this._$mouseMove=null,this._$mouseUp=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}static get DEFAULT_SIZE(){return 360}initialize(){document.documentElement.style.setProperty("--controller-width",`${Se.DEFAULT_SIZE}px`);const e=document.getElementById("controller-adjustment");e&&e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),d.$initializeEnd()}mouseDown(e){e.preventDefault(),e.stopPropagation(),this._$pointX=e.screenX,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){d.$setCursor("col-resize"),window.requestAnimationFrame((()=>{e.preventDefault(),e.stopPropagation();const t=d.$currentWorkSpace(),r=this._$pointX-e.screenX,a=Math.max(Se.DEFAULT_SIZE,t._$controllerWidth+r);document.documentElement.style.setProperty("--controller-width",`${a}px`),t._$controllerWidth=a,this._$pointX=e.screenX,d.$rebuildTimeline()}))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto")}}d.$controllerAdjustment=new Se;class we extends ue{constructor(){super("filter"),this._$filterId=0,this._$filters=new Map}static get MIN_BLUR(){return 0}static get MAX_BLUR(){return 255}static get MIN_ALPHA(){return 0}static get MAX_ALPHA(){return 100}static get MIN_STRENGTH(){return 0}static get MAX_STRENGTH(){return 255}static get MIN_ROTATE(){return-360}static get MAX_ROTATE(){return 360}static get MIN_DISTANCE(){return-255}static get MAX_DISTANCE(){return 255}static get MIN_COLOR(){return 0}static get MAX_COLOR(){return 16777215}static get MIN_QUALITY(){return 0}static get MAX_QUALITY(){return 16}initialize(){super.initialize();const e=document.getElementById("filter-add");e&&e.addEventListener("mousedown",(()=>{this.addFilter(),this.disposeCharacterImage(),this.reloadScreen()}))}lock(e){e.preventDefault(),e.stopPropagation();const t=0|e.currentTarget.dataset.filterId;if(!this._$filters.has(t))return;const r=this._$filters.get(t);r.lock=!r.lock,this._$currentValue=null,e.currentTarget.childNodes[1].setAttribute("class",r.lock?"active":"disable")}clickNodeTitle(e){const t=0|e.target.dataset.filterId,r=document.getElementById(`filter-view-area-${t}`);r&&("none"===r.style.display?(r.setAttribute("style",""),document.getElementById(`filter-title-arrow-${t}`).setAttribute("class","arrow active")):(r.setAttribute("style","display: none;"),document.getElementById(`filter-title-arrow-${t}`).setAttribute("class","arrow disable")))}changeState(e){const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;const r=this._$filters.get(t);r.filter.state=!r.filter.state;const a=document.getElementById(`filter-state-${t}`);a&&a.setAttribute("class",r.filter.state?"filter-active":"filter-disable"),this.disposeCharacterImage()}removeFilter(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const r=0|e.target.dataset.filterId,a=t[0],s=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId),i=d.$timelineFrame.currentFrame;let n=s.getPlace(i);n.tweenFrame&&(s.endFrame-1>i&&!s.hasTween(i)&&(d.$timelineTool.executeTimelineKeyAdd(),n=s.getPlace(i)),n=s.getPlace(n.tweenFrame));const o=this._$filters.get(r),l=n.filter.indexOf(o.filter);n.filter.splice(l,1),s.updateTweenFilter(i),this._$filters.delete(r),this._$filters.size||(document.querySelectorAll(".filter-none")[0].style.display="");const c=document.getElementById(`filter-id-${r}`);c&&c.remove(),super.focusOut(),s.dispose()}focusIn(e){super.focusIn(e),this.setLockElement(e)}mouseDown(e){super.mouseDown(e),this.setLockElement(e)}setLockElement(e){if(this._$lockTarget=null,this._$focus)return;const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;if(this._$filters.get(t).lock)switch(this._$currentTarget.dataset.name){case"blurX":this._$lockTarget=document.getElementById(`blurY-${t}`);break;case"blurY":this._$lockTarget=document.getElementById(`blurX-${t}`)}}changeBlurX(e){return e=d.$clamp(+e,we.MIN_BLUR,we.MAX_BLUR),this.updateProperty("blurX",e),e}changeBlurY(e){return e=d.$clamp(+e,we.MIN_BLUR,we.MAX_BLUR),this.updateProperty("blurY",e),e}changeStrength(e){return e=d.$clamp(+e,we.MIN_STRENGTH,we.MAX_STRENGTH),this.updateProperty("strength",e),e}changeAlpha(e){return e=d.$clamp(+e,we.MIN_ALPHA,we.MAX_ALPHA),this.updateProperty("alpha",e),e}changeShadowAlpha(e){return e=d.$clamp(+e,we.MIN_ALPHA,we.MAX_ALPHA),this.updateProperty("shadowAlpha",e),e}changeHighlightAlpha(e){return e=d.$clamp(+e,we.MIN_ALPHA,we.MAX_ALPHA),this.updateProperty("highlightAlpha",e),e}changeAngle(e){return 0>(e=d.$clamp((0|e)%360,we.MIN_ROTATE,we.MAX_ROTATE))&&(e+=360),this.updateProperty("angle",e),e}changeDistance(e){return e=d.$clamp(+e,we.MIN_DISTANCE,we.MAX_DISTANCE),this.updateProperty("distance",e),e}changeColor(e){return this.updateProperty("color",d.$clamp(0|`0x${e.slice(1)}`,we.MIN_COLOR,we.MAX_COLOR)),e}changeShadowColor(e){return this.updateProperty("shadowColor",d.$clamp(0|`0x${e.slice(1)}`,we.MIN_COLOR,we.MAX_COLOR)),e}changeHighlightColor(e){return this.updateProperty("highlightColor",d.$clamp(0|`0x${e.slice(1)}`,we.MIN_COLOR,we.MAX_COLOR)),e}changeQuality(e){e=d.$clamp(0|e,we.MIN_QUALITY,we.MAX_QUALITY),this.updateProperty("quality",e)}changeType(e){switch(e){case"inner":case"outer":case"full":this.updateProperty("type",e)}}changeKnockout(){this.updateProperty("knockout",!!this._$currentTarget.checked)}changeInner(){this.updateProperty("inner",!!this._$currentTarget.checked)}changeHideObject(){this.updateProperty("hideObject",!!this._$currentTarget.checked)}updateProperty(e,t){if(!this._$currentTarget)return;const r=0|this._$currentTarget.dataset.filterId;if(!this._$filters.has(r))return;const a=this._$filters.get(r);a.filter[e]!==t&&(a.filter[e]=t,this.disposeCharacterImage())}disposeCharacterImage(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;const t=e[0],r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);r.relocationTween(d.$timelineFrame.currentFrame),r.dispose()}setCommonEvent(e){this.setLockEvent(document.getElementById(`filter-${e}-lock`)),this.setTitleEvent(document.getElementById(`filter-name-${e}`)),this.setStateEvent(document.getElementById(`filter-state-${e}`)),this.setTrashEvent(document.getElementById(`trash-${e}`))}setLockEvent(e){e&&e.addEventListener("mousedown",(e=>{this.lock(e)}))}setTitleEvent(e){e&&e.addEventListener("mousedown",(e=>{this.clickNodeTitle(e)}))}setStateEvent(e){if(!e)return;const t=0|e.dataset.filterId;if(this._$filters.has(t)){const r=this._$filters.get(t);e.setAttribute("class",r.filter.state?"filter-active":"filter-disable")}e.addEventListener("mousedown",(e=>{this.save(),this.changeState(e),this.reloadScreen(),this._$saved=!1}))}setTrashEvent(e){e&&e.addEventListener("click",(e=>{this.removeFilter(e),this.reloadScreen()}))}addFilter(){const e=document.querySelectorAll(".filter-none")[0];e&&e.setAttribute("style","display: none;");const t=document.getElementById("filter-select");t&&this[`add${t.value}`]()}clear(){this._$filterId=0,this._$filters.clear();const e=document.getElementById("filter-setting-list");if(!e)return;const t=document.querySelectorAll(".filter-none")[0];for(;e.firstChild;)e.firstChild.remove();t.setAttribute("style",""),e.appendChild(t)}createFilter(e,t=null){if(!t){const r=d.$tools.getDefaultTool("arrow").activeElements;if(!r.length)return-1;t=new e;const a=r[0],s=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId),i=d.$timelineFrame.currentFrame;let n=s.getPlace(i);n.tweenFrame&&(s.endFrame-1>i&&!s.hasTween(i)&&(d.$timelineTool.executeTimelineKeyAdd(),n=s.getPlace(i)),n=s.getPlace(n.tweenFrame),s.updateTweenFilter(i)),n.filter.push(t)}const r=this._$filterId++;return this._$filters.set(r,{id:r,lock:!1,filter:t,context:null}),r}addDropShadowFilter(e=null,t=!0){const r=document.getElementById("filter-setting-list");if(!r)return;const a=this.createFilter(A,e);e||(e=this._$filters.get(a).filter);const s=`\n${xe.createHeaderHTML(a,"DropShadow")}\n\n        <div class="filter-view-area-right">\n        \n            <div class="filter-container">\n                ${xe.createBlurX(a,e.blurX)}\n                ${xe.createStrength(a,e.strength)}\n            </div>\n    \n            <div class="filter-container">\n                ${xe.createBlurY(a,e.blurY)}\n                ${xe.createAngle(a,e.angle)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createDistance(a,e.distance)}\n            </div>\n    \n            <div class="filter-container">\n                ${xe.createColor(a,e.color)}\n                ${xe.createAlpha(a,e.alpha)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createKnockout(a)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createInnerShadow(a)}\n            </div>\n    \n            <div class="filter-container">\n                ${xe.createHideObject(a)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createQuality(a)}\n            </div> \n            \n        </div>\n    </div>\n</div>\n`;r.insertAdjacentHTML("beforeend",s),this.setCommonEvent(a),e.knockout&&(document.getElementById(`knockout-${a}`).checked=!0),e.inner&&(document.getElementById(`inner-${a}`).checked=!0),e.hideObject&&(document.getElementById(`hideObject-${a}`).checked=!0);const i=[`blurX-${a}`,`blurY-${a}`,`strength-${a}`,`angle-${a}`,`alpha-${a}`,`distance-${a}`];for(let e=0;e<i.length;++e)this.setInputEvent(document.getElementById(i[e]));const n=[`knockout-${a}`,`inner-${a}`,`hideObject-${a}`];for(let e=0;e<n.length;++e)this.setClickEvent(document.getElementById(n[e]));const o=[`color-${a}`,`quality-${a}`];for(let e=0;e<o.length;++e)this.setChangeEvent(document.getElementById(o[e]));t&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}addBlurFilter(e=null,t=!0){const r=document.getElementById("filter-setting-list");if(!r)return;const a=this.createFilter(k,e);e||(e=this._$filters.get(a).filter);const s=`\n${xe.createHeaderHTML(a,"Blur")}\n        \n        <div class="filter-view-area-right">\n        \n            <div class="filter-container">\n                ${xe.createBlurX(a,e.blurX)}\n            </div>\n        \n            <div class="filter-container">\n                ${xe.createBlurY(a,e.blurY)}\n            </div>\n        \n            <div class="filter-container">\n                ${xe.createQuality(a)}\n            </div> \n        \n        </div>\n    </div>\n</div>\n`;r.insertAdjacentHTML("beforeend",s),this.setCommonEvent(a);const i=[`blurX-${a}`,`blurY-${a}`];for(let e=0;e<i.length;++e)this.setInputEvent(document.getElementById(i[e]));const n=[`quality-${a}`];for(let e=0;e<n.length;++e)this.setChangeEvent(document.getElementById(n[e]));t&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}addGlowFilter(e=null,t=!0){const r=document.getElementById("filter-setting-list");if(!r)return;const a=this.createFilter(T,e);e||(e=this._$filters.get(a).filter);const s=`\n${xe.createHeaderHTML(a,"Glow")}\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                ${xe.createBlurX(a,e.blurX)}\n                ${xe.createStrength(a,e.strength)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createBlurY(a,e.blurY)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createColor(a,e.color)}\n                ${xe.createAlpha(a,e.alpha)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createInnerShadow(a)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createKnockout(a)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createQuality(a)}\n            </div> \n            \n        </div>\n    </div>\n</div>\n`;r.insertAdjacentHTML("beforeend",s),this.setCommonEvent(a),e.knockout&&(document.getElementById(`knockout-${a}`).checked=!0),e.inner&&(document.getElementById(`inner-${a}`).checked=!0);const i=[`blurX-${a}`,`blurY-${a}`,`strength-${a}`,`alpha-${a}`,`distance-${a}`];for(let e=0;e<i.length;++e)this.setInputEvent(document.getElementById(i[e]));const n=[`knockout-${a}`,`inner-${a}`];for(let e=0;e<n.length;++e)this.setClickEvent(document.getElementById(n[e]));const o=[`color-${a}`,`quality-${a}`];for(let e=0;e<o.length;++e)this.setChangeEvent(document.getElementById(o[e]));t&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}addBevelFilter(e=null,t=!0){const r=document.getElementById("filter-setting-list");if(!r)return;const a=this.createFilter(F,e);if(0>a)return;e||(e=this._$filters.get(a).filter);const s=`\n${xe.createHeaderHTML(a,"Bevel")}\n        \n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                ${xe.createBlurX(a,e.blurX)}\n                ${xe.createStrength(a,e.strength)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createBlurY(a,e.blurY)}\n                ${xe.createAngle(a,e.angle)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createDistance(a,e.distance)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createShadowColor(a,e.shadowColor)}\n                ${xe.createShadowAlpha(a,e.shadowAlpha)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createHighlightColor(a,e.highlightColor)}\n                ${xe.createHighlightAlpha(a,e.highlightAlpha)}\n            </div>\n            \n            <div class="filter-container">\n                ${xe.createKnockout(a)}\n            </div>\n\n            <div class="filter-container">\n                ${xe.createBevelType(a)}\n                ${xe.createQuality(a)}\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;r.insertAdjacentHTML("beforeend",s),this.setCommonEvent(a),e.knockout&&(document.getElementById(`knockout-${a}`).checked=!0);const i=[`blurX-${a}`,`blurY-${a}`,`strength-${a}`,`angle-${a}`,`shadowAlpha-${a}`,`highlightAlpha-${a}`,`distance-${a}`];for(let e=0;e<i.length;++e)this.setInputEvent(document.getElementById(i[e]));const n=[`knockout-${a}`];for(let e=0;e<n.length;++e)this.setClickEvent(document.getElementById(n[e]));const o=[`shadowColor-${a}`,`highlightColor-${a}`,`type-${a}`,`quality-${a}`];for(let e=0;e<o.length;++e)this.setChangeEvent(document.getElementById(o[e]));t&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}}d.$filterController=new we;class xe{static createHeaderHTML(e,t){return`\n<div id="filter-id-${e}" class="filter-border">\n\n    <div class="filter-title">\n        <i id="filter-title-arrow-${e}" class="arrow active"></i>\n        <span id="filter-name-${e}" data-filter-id="${e}">${t}</span>\n        <i class="filter-active" id="filter-state-${e}" data-filter-id="${e}" data-detail="{{フィルターを表示・非表示する}}"></i>\n        <i class="trash" id="trash-${e}" data-filter-id="${e}" data-detail="{{フィルターを削除}}"></i>\n    </div>\n    \n    <div id="filter-view-area-${e}" class="filter-view-area">\n    \n        <div class="filter-view-area-left">\n        \n            <div id="filter-${e}-lock" data-filter-id="${e}" class="filter-lock">\n                ┌\n                <div class="disable" data-detail="{{比率を固定}}"></div>\n                └\n            </div>\n        \n        </div>\n`}static createBlurX(e,t){return`\n<div class="filter-text">BlurX</div>\n<div><input type="text" id="blurX-${e}" value="${t}" data-name="blurX" data-filter-id="${e}" data-detail="{{水平方向にぼかす}}" autocomplete="off"></div>\n`}static createBlurY(e,t){return`\n<div class="filter-text">BlurY</div>\n<div><input type="text" id="blurY-${e}" value="${t}" data-name="blurY" data-filter-id="${e}" data-detail="{{垂直方向にぼかす}}" autocomplete="off"></div>\n`}static createStrength(e,t){return`\n<div class="filter-text">Strength</div>\n<div><input type="text" id="strength-${e}" value="${t}" data-filter-id="${e}" data-name="strength" data-detail="{{フィルター強度}}" autocomplete="off"></div>\n`}static createAngle(e,t){return`\n<div class="filter-text">Angle</div>\n<div><input type="text" id="angle-${e}" value="${t}" data-filter-id="${e}" data-name="angle" data-detail="{{フィルター角度}}" autocomplete="off"></div>\n`}static createDistance(e,t){return`\n<div class="filter-text">Distance</div>\n<div><input type="text" id="distance-${e}" value="${t}" data-filter-id="${e}" data-name="distance" data-detail="{{フィルター距離}}" autocomplete="off"></div>\n`}static createShadowColor(e,t){return`\n<div class="filter-text">Shadow<br>Color</div>\n<div><input type="color" id="shadowColor-${e}" value="#${t.toString(16).padStart(6,"0")}" data-filter-id="${e}" data-name="shadowColor" data-detail="{{シャドウのカラー}}"></div>\n`}static createShadowAlpha(e,t){return`\n<div class="filter-text">Shadow<br>Alpha</div>\n<div><input type="text" id="shadowAlpha-${e}" value="${t}" data-filter-id="${e}" data-name="shadowAlpha" data-detail="{{シャドウのアルファ}}" autocomplete="off"></div>\n`}static createHighlightColor(e,t){return`\n<div class="filter-text">Highlight<br>Color</div>\n<div><input type="color" id="highlightColor-${e}" value="#${t.toString(16).padStart(6,"0")}" data-filter-id="${e}" data-name="highlightColor" data-detail="{{ハイライトのカラー}}"></div>\n`}static createHighlightAlpha(e,t){return`\n<div class="filter-text">Highlight<br>Alpha</div>\n<div><input type="text" id="highlightAlpha-${e}" value="${t}" data-filter-id="${e}" data-name="highlightAlpha" data-detail="{{ハイライトのアルファ}}" autocomplete="off"></div>\n`}static createKnockout(e){return`\n<div><input type="checkbox" id="knockout-${e}" data-name="knockout" data-filter-id="${e}"></div>\n<div class="filter-text-long">\n    <label for="knockout-${e}">Knockout</label>\n</div>\n`}static createBevelType(e){return`\n<div class="filter-text-long">Type</div>\n<div>\n    <select id="type-${e}" data-name="type" data-filter-id="${e}">\n        <option value="inner">Inner</option>\n        <option value="outer">Outer</option>\n        <option value="full">Full</option>\n    </select>\n</div>\n`}static createQuality(e){return`\n<div class="filter-text-long">Quality</div>\n<div>\n    <select id="quality-${e}" data-name="quality" data-filter-id="${e}">\n        <option value="1">Low</option>\n        <option value="2">Middle</option>\n        <option value="3">High</option>\n    </select>\n</div>\n`}static createInnerShadow(e){return`\n<div><input type="checkbox" id="inner-${e}" data-name="inner" data-filter-id="${e}"></div>\n<div class="filter-text-long">\n    <label for="inner-${e}">Inner Shadow</label>\n</div>\n`}static createHideObject(e){return`\n<div><input type="checkbox" id="hideObject-${e}" data-name="hideObject" data-filter-id="${e}"></div>\n<div class="filter-text-long">\n    <label for="hideObject-${e}">Hide Object</label>\n</div>\n`}static createColor(e,t){return`\n<div class="filter-text">Color</div>\n<div><input type="color" id="color-${e}" value="#${t.toString(16).padStart(6,"0")}" data-filter-id="${e}" data-name="color" data-detail="{{シャドウのカラー}}"></div>\n`}static createAlpha(e,t){return`\n<div class="filter-text">Alpha</div>\n<div><input type="text" id="alpha-${e}" value="${t}" data-filter-id="${e}" data-name="alpha" data-detail="{{シャドウのアルファ}}" autocomplete="off"></div>\n`}static createGradientColor(e){return`\n<div class="filter-text">Color</div>\n<div><input type="color" id="gradientColor-${e}" value="#000000" data-filter-id="${e}" data-name="gradientColor" data-detail="{{グラデーションカラー}}"></div>\n`}static createGradientAlpha(e){return`\n<div class="filter-text">Alpha</div>\n<div><input type="text" id="gradientAlpha-${e}" value="100" data-filter-id="${e}" data-name="gradientAlpha" data-detail="{{グラデーションのアルファ}}" autocomplete="off"></div>\n        `}static createGradientColorPalette(e){return`\n<div id="gradient-color-palette-${e}" class="gradient-color-palette">\n    <div id="color-palette-${e}" class="color-palette">\n        <canvas id="gradient-canvas-${e}"></canvas>\n    </div>\n    <div id="color-pointer-list-${e}" data-filter-id="${e}" class="color-pointer-list" data-detail="{{カラーポインターを追加}}"></div>\n</div>\n`}}d.$gridController=new class extends he{constructor(){super("nine-slice"),this._$state="hide",this._$elementIds=["grid-top-left","grid-top-right","grid-bottom-left","grid-bottom-right"],this._$gridMouseMove=null,this._$gridMouseUp=null}initialize(){super.initialize();const e=["nine-slice-setting-x","nine-slice-setting-y","nine-slice-setting-w","nine-slice-setting-h"];for(let t=0;t<e.length;++t)this.setInputEvent(document.getElementById(e[t]));for(let e=0;e<this._$elementIds.length;++e){const t=document.getElementById(this._$elementIds[e]);t&&(t.style.display="none",t.addEventListener("mousedown",(e=>{this.standbyPointer(e)})))}}standbyPointer(e){e.stopPropagation();const t=d.$tools.activeTool;t&&(e.grid=!0,t.dispatchEvent(j.MOUSE_DOWN,e))}changeNineSliceSettingX(e){return this.updateShapeGrid(+e,+document.getElementById("nine-slice-setting-y").value,+document.getElementById("nine-slice-setting-w").value,+document.getElementById("nine-slice-setting-h").value),+e}changeNineSliceSettingY(e){return this.updateShapeGrid(+document.getElementById("nine-slice-setting-x").value,+e,+document.getElementById("nine-slice-setting-w").value,+document.getElementById("nine-slice-setting-h").value),+e}changeNineSliceSettingW(e){return this.updateShapeGrid(+document.getElementById("nine-slice-setting-x").value,+document.getElementById("nine-slice-setting-y").value,+e,+document.getElementById("nine-slice-setting-h").value),+e}changeNineSliceSettingH(e){return this.updateShapeGrid(+document.getElementById("nine-slice-setting-x").value,+document.getElementById("nine-slice-setting-y").value,+document.getElementById("nine-slice-setting-w").value,+e),+e}updateShapeGrid(e,t,r,a){const s=d.$tools.getDefaultTool("arrow").activeElements;if(!s.length)return;const i=d.$currentWorkSpace().getLibrary(0|s[0].dataset.libraryId);switch(0){case e:case t:i._$grid=null,this.hide();break;default:i._$grid={x:e,y:t,w:r,h:a},this.show().relocation()}i.cacheClear()}show(){if("show"!==this._$state){this._$state="show";for(let e=0;e<this._$elementIds.length;++e){const t=document.getElementById(this._$elementIds[e]);t&&(t.style.display="")}}return this}hide(){if("hide"!==this._$state){for(let e=0;e<this._$elementIds.length;++e){const t=document.getElementById(this._$elementIds[e]);t&&(t.style.display="none")}this._$state="hide"}}relocation(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return this.hide();const t=e[0],r=0|t.dataset.characterId,a=document.getElementById(`character-${r}`);if(!a)return this.hide();const s=d.$currentWorkSpace(),i=s.getLibrary(0|t.dataset.libraryId);if(!i||i.type!==b.SHAPE)return this.hide();const n=i._$grid;if(!n)return this.hide();const o=0|t.dataset.layerId,l=s.scene.getLayer(o).getCharacter(0|t.dataset.characterId);if(l.rotation)return void this.hide();const c=l.getBounds(),h=l.getPlace(d.$timelineFrame.currentFrame).matrix,u=Math.sqrt(h[0]*h[0]+h[1]*h[1]),m=Math.sqrt(h[2]*h[2]+h[3]*h[3]),g=a.offsetLeft,$=a.offsetTop,p=l.width-Math.abs(c.xMax-c.xMin),f=l.height-Math.abs(c.yMax-c.yMin),y=document.getElementById("grid-top-left");y.style.left=g+n.x*d.$zoomScale-4+"px",y.style.top=$+n.y*d.$zoomScale-4+"px";const _=document.getElementById("grid-top-right");_.style.left=g+(n.x+n.w)*d.$zoomScale*u+p-4+"px",_.style.top=$+n.y*d.$zoomScale-4+"px";const v=document.getElementById("grid-bottom-left");v.style.left=g+n.x*d.$zoomScale-4+"px",v.style.top=$+(n.y+n.h)*d.$zoomScale*m+f-4+"px";const I=document.getElementById("grid-bottom-right");I.style.left=g+(n.x+n.w)*d.$zoomScale*u+p-4+"px",I.style.top=$+(n.y+n.h)*d.$zoomScale*m+f-4+"px"}};d.$instanceSelectController=new class extends he{initialize(){super.initialize();const e=document.getElementById("instance-setting");e&&(e.style.display="none")}createInstanceSelect(e){const t=d.$currentWorkSpace(),r=document.getElementById("instance-type-name");for(;r.children.length;)r.children[0].remove();const a=document.createElement("i");a.setAttribute("class",`library-type-${e.type}`),r.appendChild(a);const s=document.createElement("select");s.classList.add("instance-select"),s.addEventListener("change",(e=>{const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(j.CHANGE,e))}));for(const r of t._$libraries.values()){if(!r.id)continue;switch(r.type){case b.FOLDER:case b.SOUND:continue}const a=document.createElement("option");a.value=r.id;let i=r.name;if(r._$folderId){let e=r;for(;e._$folderId;)e=t.getLibrary(e._$folderId),i=`${e.name}/${i}`}a.innerHTML=i,r.id===e.id&&(a.defaultSelected=!0),s.appendChild(a)}r.appendChild(s)}};d.$javascriptController=new class{reload(){const e=document.getElementById("javascript-internal-list-box");if(!e)return;const t=e.children;for(;t.length;)t[0].remove();const r=d.$currentWorkSpace();if(r)for(const t of r._$libraries.values()){if(t._$type!==b.MOVIE_CLIP)continue;if(!t._$actions.size)continue;const r=t.id,a=`<div id="script-${r}" data-library-id="${r}" class="internal-parent"><i></i>${t._$name}</div>`;e.insertAdjacentHTML("beforeend",a);document.getElementById(`script-${r}`).addEventListener("dblclick",(e=>{d.$sceneChange.reload(0|e.currentTarget.dataset.libraryId)}));for(const a of t._$actions.keys()){const t=`<div id="script-${r}-${a}" data-library-id="${r}" data-frame="${a}" class="internal-child"><i></i>frame ${a}</div>`;e.insertAdjacentHTML("beforeend",t);document.getElementById(`script-${r}-${a}`).addEventListener("mousedown",(e=>{d.$javaScriptEditor.hide();const t=e.currentTarget,r=d.$currentWorkSpace().getLibrary(0|t.dataset.libraryId),a=0|t.dataset.frame;d.$javaScriptEditor.show(null,a,r)}))}}}};d.$libraryController=new class{constructor(){this._$saved=!1,this._$activeInstances=new Map,this._$copyMapping=new Map,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}get activeInstances(){return this._$activeInstances}set activeInstance(e){switch(!0){case d.$ctrlKey&&this.activeInstances.size>0:{const t=0|e.dataset.libraryId;this.activeInstances.has(t)?(this.activeInstances.delete(t),e.classList.remove("active")):(this.activeInstances.set(t,e),e.classList.add("active"))}break;case d.$shiftKey&&this.activeInstances.size>0:{const t=Array.from(document.getElementById("library-list-box").children),r=t.indexOf(this.activeInstances.values().next().value),a=t.indexOf(e);if(-1===a)return;if(this.clearActive(),a===r){this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active");break}if(a>r){const e=a-r+1;for(let a=0;e>a;++a){const e=t[r+a];this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active")}}else{const e=r-a+1;for(let a=0;e>a;++a){const e=t[r-a];this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active")}}}break;default:this.clearActive(),e&&(this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active"))}}cloneMovieClip(e,t){const r=d.$workSpaces[e],a=d.$currentWorkSpace(),s=d.$activeWorkSpaceId;d.$activeWorkSpaceId=e;const i=t.clone();d.$activeWorkSpaceId=s;for(const t of i._$layers.values()){const n=new v;for(let i=0;i<t._$characters.length;++i){d.$activeWorkSpaceId=e;const o=new p(JSON.parse(JSON.stringify(t._$characters[i].toObject())));o._$id=a._$characterId++,d.$activeWorkSpaceId=s;const l=r.getLibrary(o.libraryId);if(this._$copyMapping.has(l.id)){o.libraryId=this._$copyMapping.get(l.id),n.addCharacter(o);continue}l.folderId&&this.cloneFolder(e,l.id);const c=l.getPathWithWorkSpace(r);if(a._$nameMap.has(c)){d.$confirmModal.files.push({file:l,character:o,layer:n,path:c,workSpaceId:e,type:"copy"});continue}const h=l.type===b.MOVIE_CLIP?this.cloneMovieClip(l):l.clone();if(h.folderId){const e=r.getLibrary(h.folderId);h.folderId=0,e&&(h.folderId=a._$libraries.get(e.getPathWithWorkSpace(r)))}const u=a.nextLibraryId;this._$copyMapping.set(l.id,u),h._$id=o.libraryId=u,a._$libraries.set(h.id,h),d.$libraryController.createInstance(h.type,h.name,h.id,h.symbol),a._$nameMap.set(c,h.id),n.addCharacter(o)}for(let e=0;e<t._$emptys.length;++e)n.addEmptyCharacter(t._$emptys[e].clone());n.id=t.id,i.setLayer(n.id,n)}return i}cloneFolder(e,t){const r=d.$workSpaces[e],a=d.$currentWorkSpace(),s=r.getLibrary(t);if(!s)return;const i=[];let n=s;for(;n.folderId;)n=r.getLibrary(n.folderId),i.unshift(n);const o=new Map;for(let e=0;i.length>e;++e){const t=i[e],s=t.getPathWithWorkSpace(r);if(a._$nameMap.has(s)){o.set(t.id,a._$nameMap.get(s));continue}const n=t.clone();n._$id=a.nextLibraryId,a._$libraries.set(n.id,n),o.set(t.id,n.id),n.folderId&&(n.folderId=o.get(n.folderId)),d.$libraryController.createInstance(n.type,n.name,n.id,n.symbol),a._$nameMap.set(s,n.id)}}clone(e,t,r=null,a=null){const s=d.$workSpaces[e],i=d.$currentWorkSpace(),n=s.getLibrary(t);if(!n)return;n.folderId&&this.cloneFolder(e,n.id);const o=n.getPathWithWorkSpace(s);if(i._$nameMap.has(o))return void d.$confirmModal.files.push({file:n,character:a,layer:r,path:o,workSpaceId:e,type:"copy"});const l=d.$activeWorkSpaceId;d.$activeWorkSpaceId=e;const c=n.type===b.MOVIE_CLIP?this.cloneMovieClip(n):n.clone();if(d.$activeWorkSpaceId=l,c.folderId){const e=s.getLibrary(c.folderId);c.folderId=0,e&&(c.folderId=i._$libraries.get(e.getPathWithWorkSpace(s)))}c._$id=i.nextLibraryId,i._$libraries.set(c.id,c),d.$libraryController.createInstance(c.type,c.name,c.id,c.symbol),i._$nameMap.set(o,c.id),this.reload()}clearActive(){for(const e of this.activeInstances.values())e.classList.remove("active");this.activeInstances.clear(),d.$libraryPreview.dispose()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-list-box");e&&(e.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",(e=>{this.drop(e)})),e.addEventListener("dragstart",(()=>{this.dragstart()})),e.addEventListener("dragend",(()=>{this.dragend()})),e.addEventListener("mousedown",(e=>{e.stopPropagation(),e.button||this.clearActive()}))),d.$initializeEnd()}clearSoundSelect(){const e=document.getElementById("sound-select");if(e)for(;e.children.length;)e.children[0].remove()}clearLibrary(){const e=document.getElementById("library-list-box");if(e)for(;e.children.length;)e.children[0].remove();d.$currentWorkSpace()._$nameMap.clear(),d.$confirmModal.hide()}reload(e=null){const t=d.$currentWorkSpace();e||(e=Array.from(t._$libraries.values())),this.clearLibrary(),this.clearSoundSelect(),e.sort(((e,t)=>{const r=e.name.toLowerCase(),a=t.name.toLowerCase();return r<a?-1:r>a?1:0}));const r=new Map,a=new Map;for(let s=0;s<e.length;++s){const i=e[s];if(i.id){if(d.$libraryController.createInstance(i.type,i.name,i.id,i.symbol),t._$nameMap.set(i.path,i.id),"folder"===i.type&&i.mode===_.OPEN&&this.openFolder(i),i.folderId){const e=document.getElementById(`library-child-id-${i.id}`);e.remove(),a.has(i.folderId)||a.set(i.folderId,[]),a.get(i.folderId).push(e)}"folder"===i.type&&r.set(i.id,i)}}if(r.size){const e=document.getElementById("library-list-box"),t=new Map;for(;r.size!==t.size;){for(const[s,i]of r){if(!a.has(s)){t.set(s,!0);continue}if(t.has(s))continue;const r=document.getElementById(`library-child-id-${i.id}`);if(!r)continue;const n=a.get(s);for(let t=n.length-1;t>-1;--t){const a=n[t];e.insertBefore(a,r.nextElementSibling),i.mode===_.CLOSE&&(a.style.display="none")}t.set(s,!0)}for(const[e,t]of r)a.has(e)&&!t.folderId&&this.updateFolderStyle(t,t.mode)}t.clear(),r.clear(),a.clear()}}createInstance(e,t,r,a=""){const s=`\n<div draggable="true" class="library-list-box-child" id="library-child-id-${r}" data-library-id="${r}">\n    <div class="library-list-box-name">\n        <i class="library-type-${e===b.FOLDER?"arrow close":"space"}" id="arrow-${r}" data-library-id="${r}"></i>\n        <i class="library-type-${e} " id="${e}-${r}" data-library-id="${r}"></i>\n        <p>\n            <span id="library-name-${r}" class="view-text" data-type="name" data-library-id="${r}">${t}</span>\n            <input type="text" id="library-name-input-${r}" data-library-id="${r}" data-type="name" value="${t}" style="display: none;" autocomplete="off">\n        </p>\n    </div>\n    <div class="library-list-box-symbol">\n        <p>\n            <span id="library-symbol-name-${r}" class="view-symbol-text" data-type="symbol" data-library-id="${r}">${a}</span>\n            <input type="text" id="library-symbol-name-input-${r}" data-library-id="${r}" data-type="symbol" value="${a}" style="display: none;" autocomplete="off">\n        </p>\n    </div>\n</div>`;document.getElementById("library-list-box").insertAdjacentHTML("beforeend",s),e===b.MOVIE_CLIP&&document.getElementById(`${e}-${r}`).addEventListener("dblclick",(e=>{d.$screenRuler.clear(),d.$activeCharacterIds.length=0,d.$sceneChange.reload(0|e.currentTarget.dataset.libraryId)}));const i=document.getElementById(`library-child-id-${r}`);if(this.activeInstances.has(r)&&(this.activeInstances.set(r,i),i.classList.add("active")),i.addEventListener("mousedown",(e=>{this.selectInstance(e)})),"folder"===e){i.addEventListener("dragover",(e=>{e.preventDefault()})),i.addEventListener("drop",(e=>{this.folderIn(e)}));document.getElementById(`arrow-${r}`).addEventListener("mousedown",(e=>{this.clickFolder(e)}));const t=document.getElementById(`${e}-${r}`);t.addEventListener("dblclick",(e=>{this.clickFolder(e)})),t.classList.remove("library-type-folder"),t.classList.add("library-type-folder-close")}if(e===b.SOUND){const e=document.createElement("option");e.value=`${r}`,e.innerHTML=t,document.getElementById("sound-select").appendChild(e)}const n=[`library-name-${r}`];"folder"!==e&&n.push(`library-symbol-name-${r}`);for(let e=0;e<n.length;++e)document.getElementById(n[e]).addEventListener("dblclick",(e=>{this.inputStart(e)}));const o=[`library-name-input-${r}`];"folder"!==e&&o.push(`library-symbol-name-input-${r}`);for(let e=0;e<o.length;++e){const t=document.getElementById(o[e]);t.addEventListener("focusout",(e=>{this.inputEnd(e)})),t.addEventListener("keypress",(e=>{this.inputEnd(e)}))}return{id:r,type:e,name:t,symbol:a}}selectInstance(e){if(e.button||d.$keyLock)return;d.$endMenu(),e.stopPropagation();const t=e.currentTarget;(d.$ctrlKey||d.$shiftKey||!t.classList.contains("active"))&&(this.activeInstance=t,d.$libraryPreview.loadImage(0|t.dataset.libraryId))}inputStart(e){d.$keyLock=!0,e.stopPropagation();const t=e.target,r=0|t.dataset.libraryId,a=document.getElementById(`library-child-id-${r}`);a.classList.remove("active"),a.draggable=!1;const s="name"===t.dataset.type?`library-name-input-${r}`:`library-symbol-name-input-${r}`,i=document.getElementById(s);i.value=t.textContent,i.style.display="",i.focus(),t.style.display="none"}inputEnd(e){if("Enter"!==e.key){if("focusout"===e.type){this.save();const t=e.target,r=0|t.dataset.libraryId,a=d.$currentWorkSpace(),s=a.getLibrary(r),i="name"===t.dataset.type?`library-name-${r}`:`library-symbol-name-${r}`,n=document.getElementById(i);let o=t.value;if(n.textContent!==o){if("name"===t.dataset.type){const e=s.name;if(s.name=o,a._$nameMap.has(s.path)){s.name=e,o=e;const r=document.getElementById("detail-modal");r.textContent=d.$currentLanguage.replace("{{同名のアイテムが存在します}}"),r.style.left=`${t.offsetLeft}px`,r.style.top=`${t.offsetTop}px`,r.setAttribute("class","fadeIn"),r.dataset.timerId=setTimeout((()=>{r.classList.contains("fadeOut")||r.setAttribute("class","fadeOut")}),1500)}}else s.symbol=o;n.textContent=o}n.style.display="";const l=document.getElementById(`library-child-id-${r}`);this.activeInstances.has(r)&&l.classList.add("active"),t.style.display="none",l.draggable=!0,d.$keyLock=!1,this._$saved=!1,"name"===t.dataset.type&&this.reload()}}else e.target.blur()}clickFolder(e){e.stopPropagation();const t=d.$currentWorkSpace().getLibrary(0|e.target.dataset.libraryId);t.mode===_.OPEN?this.closeFolder(t):this.openFolder(t),this.updateFolderStyle(t,t.mode)}updateFolderStyle(e,t){const r=d.$currentWorkSpace(),a=document.getElementById("library-list-box").children;let s=20,i=e.folderId;if(i)for(;;){const e=r.getLibrary(i);if(!e)break;if(s+=20,i=e.folderId,!i)break}for(let i=0;i<a.length;++i){const n=a[i],o=r.getLibrary(0|n.dataset.libraryId);if(!o.folderId)continue;if(o.folderId!==e.id)continue;let l=`padding-left: ${s}px;`;t!==_.OPEN&&(l+="display: none;"),n.setAttribute("style",l),o.type===b.FOLDER&&this.updateFolderStyle(o,t===_.OPEN?o.mode:t)}}openFolder(e){e.mode=_.OPEN;const t=document.getElementById(`folder-${e.id}`);t.classList.remove("library-type-folder-close"),t.classList.add("library-type-folder-open");const r=document.getElementById(`arrow-${e.id}`);r.classList.add("open"),r.classList.remove("close")}closeFolder(e){e.mode=_.CLOSE;const t=document.getElementById(`folder-${e.id}`);t.classList.remove("library-type-folder-open"),t.classList.add("library-type-folder-close");const r=document.getElementById(`arrow-${e.id}`);r.classList.remove("open"),r.classList.add("close")}dragstart(){const e=document.getElementById("stage-area").children;for(let t=1;t<e.length;++t)e[t].style.pointerEvents="none"}dragend(){const e=document.getElementById("stage-area").children;for(let t=1;t<e.length;++t){const r=e[t];r.dataset.preview||(r.style.pointerEvents="")}}drop(e){e.preventDefault(),e.stopPropagation(),this.save();if(e.dataTransfer.items.length){if(d.$saveProgress.active)return;this.clearActive(),d.$saveProgress.start(),d.$saveProgress.loadFiles();const t=[],r=e.dataTransfer.items;for(let e=0;e<r.length;++e)t.push(this.scanFiles(r[e].webkitGetAsEntry()));Promise.all(t).then((()=>{d.$saveProgress.end()}))}else this.folderOut();this._$saved=!1}scanFiles(e,t=0){if(e.isDirectory){const r=d.$currentWorkSpace().addLibrary({id:d.$currentWorkSpace().nextLibraryId,type:"folder",name:e.name,symbol:""});return t&&(r.folderId=t),new Promise((t=>{e.createReader().readEntries((e=>{const a=[];for(let t=0;t<e.length;++t)a.push(this.scanFiles(e[t],r.id));Promise.all(a).then((()=>{this.updateFolderStyle(r,r.mode),t()}))}))}))}return new Promise((r=>{e.file((e=>{this.loadFile(e,r,t)}))}))}removeLibrary(e){const t=document.getElementById(`library-child-id-${e}`);t&&t.remove();const r=d.$currentWorkSpace(),a=r.getLibrary(e);if(a){if(a.type===b.MOVIE_CLIP){const e=new Map;for(const t of a._$layers.values())for(let a=0;a<t._$characters.length;++a){const s=t._$characters[a];e.has(s.libraryId)||e.set(s.libraryId,!0);const i=r.getLibrary(s.libraryId);i&&i.type===b.MOVIE_CLIP&&this.removeLibrary(s.libraryId)}if(e.size)for(const t of e.keys()){const e=r.getLibrary(t);if(!e)continue;const a=document.getElementById(`library-child-id-${t}`);a&&a.remove(),e.remove(),r.removeLibrary(t)}}r.removeLibrary(e)}}loadFile(e,t,r=0,a="",s=0){const i=d.$currentWorkSpace();let n=a||e.name;if(n.indexOf(".swf")>-1&&(n=n.replace(".swf","")),r){let e=i.getLibrary(r);for(n=`${e.name}/${n}`;e._$folderId;)e=i.getLibrary(e._$folderId),n=`${e.name}/${n}`}if(!s&&i._$nameMap.has(n))return d.$confirmModal.files.push({file:e,folderId:r,path:n}),d.$confirmModal.show(),t();switch(s&&this.removeLibrary(s),e.type){case"image/svg+xml":e.text().then((o=>{const l=this.createInstance(b.MOVIE_CLIP,a||e.name,s||i.nextLibraryId),c=i.addLibrary(l);i._$nameMap.set(n,l.id);const h=document.getElementById(`library-child-id-${l.id}`);if(h&&(this.activeInstances.set(l.id,h),h.classList.add("active")),r){c.folderId=r;const e=i.getLibrary(r);this.updateFolderStyle(e,e.mode)}Y.parse(o,c),d.$instanceSelectController.createInstanceSelect(c),d.$libraryController.reload(),d.$libraryPreview.loadImage(c.id),s&&this.reloadScreen(s),t()}));break;case"image/png":case"image/jpeg":case"image/gif":e.arrayBuffer().then((o=>{const l=new Blob([o],{type:e.type}),c=new Image;return c.src=URL.createObjectURL(l),c.decode().then((()=>{const o=c.width,l=c.height,h=d.$getCanvas();h.width=o,h.height=l;const u=h.getContext("2d");u.drawImage(c,0,0,o,l);const m=new Uint8Array(u.getImageData(0,0,o,l).data);d.$poolCanvas(h);const g=this.createInstance(b.BITMAP,a||e.name,s||i.nextLibraryId);i._$nameMap.set(n,g.id);const $=document.getElementById(`library-child-id-${g.id}`);$&&(this.activeInstances.set(g.id,$),$.classList.add("active")),g.width=c.width,g.height=c.height,g.imageType=e.type,g.buffer=new Uint8Array(m);const p=i.addLibrary(g);if(r){p.folderId=r;const e=i.getLibrary(r);this.updateFolderStyle(e,e.mode)}d.$instanceSelectController.createInstanceSelect(p),d.$libraryController.reload(),d.$libraryPreview.loadImage(p.id),s&&this.reloadScreen(s),t()}))}));break;case"video/mp4":e.arrayBuffer().then((o=>{const l=new Blob([o],{type:e.type}),c=document.createElement("video");c.onloadedmetadata=()=>{const l=this.createInstance(b.VIDEO,a||e.name,s||i.nextLibraryId);i._$nameMap.set(n,l.id);const h=document.getElementById(`library-child-id-${l.id}`);h&&(this.activeInstances.set(l.id,h),h.classList.add("active")),l.width=c.videoWidth,l.height=c.videoHeight,l.buffer=new Uint8Array(o);const u=i.addLibrary(l);if(r){u.folderId=r;const e=i.getLibrary(r);this.updateFolderStyle(e,e.mode)}d.$instanceSelectController.createInstanceSelect(u),d.$libraryController.reload(),d.$libraryPreview.loadImage(u.id),s&&this.reloadScreen(s),t()},c.src=URL.createObjectURL(l),c.load()}));break;case"audio/mpeg":e.arrayBuffer().then((o=>{const l=this.createInstance(b.SOUND,a||e.name,s||i.nextLibraryId);i._$nameMap.set(n,l.id);const c=document.getElementById(`library-child-id-${l.id}`);c&&(this.activeInstances.set(l.id,c),c.classList.add("active")),l.buffer=new Uint8Array(o);const h=i.addLibrary(l);if(r){h.folderId=r;const e=i.getLibrary(r);this.updateFolderStyle(e,e.mode)}d.$libraryController.reload(),d.$libraryPreview.loadImage(h.id),s&&this.reloadScreen(s),t()}));break;case"application/x-shockwave-flash":e.arrayBuffer().then((i=>{(new D).setData(new Uint8Array(i)).run(a||e.name,t,r,s)}));break;default:t()}}folderOut(){if(!this.activeInstances.size)return void this.reload();this.save();const e=d.$currentWorkSpace();let t=!1;for(const r of this.activeInstances.values()){const a=e.getLibrary(0|r.dataset.libraryId);if(!a||!a.folderId)continue;const s=a.folderId;a.folderId=0;const i=a.path;a.folderId=s,e._$nameMap.has(i)?(t=!0,d.$confirmModal.files.push({file:a,folderId:0,path:i,type:"move"}),d.$confirmModal.show()):a.folderId&&(a.folderId=0,r.setAttribute("style",""))}t||this.reload(),this._$saved=!1}folderIn(e){if(!this.activeInstances.size)return;e.stopPropagation(),e.preventDefault();const t=d.$currentWorkSpace(),r=e.currentTarget,a=t.getLibrary(0|r.dataset.libraryId);this.save();let s=!1;for(const e of this.activeInstances.values()){const r=t.getLibrary(0|e.dataset.libraryId);if(!r)continue;if(r.id===a.id)continue;const i=`${t.getLibrary(a.id).name}/${r.path}`;t._$nameMap.has(i)?(s=!0,d.$confirmModal.files.push({file:r,folderId:0,path:i,type:"move"}),d.$confirmModal.show()):r.folderId=a.id}s||this.reload(),this._$saved=!1}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}reloadScreen(e){d.$changeLibraryId=e;const t=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(t),d.$changeLibraryId=0}};class Le extends he{constructor(){super(),this._$lock=!1,this._$instance=null,this._$xScale=1,this._$yScale=1,this._$currentFrame=1,this._$startFrame=1,this._$endFrame=1,this._$width=0,this._$height=0}static get MAX_SIZE(){return 4095}static get MIN_SIZE(){return 1}static get DEFAULT_SIZE(){return 450}initialize(){super.initialize();const e=["library-menu-export","library-export-hide-icon","library-export-size-lock","library-export-execution"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{if(e.button)return;e.stopPropagation();this[`execute${e.currentTarget.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}))}const t=["export-width","export-height","export-start-frame","export-end-frame","export-current-frame"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);r&&this.setInputEvent(r)}}finishInput(e){super.finishInput(e,!1)}mouseMove(e){super.mouseMove(e,!1)}executeLibraryExportExecution(){d.$endMenu();const e=document.getElementById("library-export-file-type").value,t=document.getElementById("export-name").value;switch(this._$instance.type){case b.MOVIE_CLIP:{const r=[],a=new JSZip;for(let s=this._$startFrame;this._$endFrame>=s;++s)r.push(this.getCanvas(s).then((r=>{a.file(`${t}_frame_${s}.${e}`,r.toDataURL(`image/${e}`,1).replace(/^.*,/,""),{base64:!0}),d.$poolCanvas(r)})));Promise.all(r).then((()=>{a.generateAsync({type:"blob"}).then((e=>{const r=URL.createObjectURL(e),a=document.createElement("a");a.download=`${t}.zip`,a.href=r,a.click(),URL.revokeObjectURL(r)}))}))}break;case b.VIDEO:{const e=t.split(".");"mp4"===e[e.length-1]&&e.pop();const r=document.createElement("a");r.download=`${e.join(".")}.mp4`,r.href=URL.createObjectURL(new Blob([new Uint8Array(this._$instance._$buffer)],{type:"video/mp4"})),r.click()}break;case b.SOUND:{const e=t.split(".");"mp3"===e[e.length-1]&&e.pop();const r=document.createElement("a");r.download=`${e.join(".")}.mp3`,r.href=URL.createObjectURL(new Blob([new Uint8Array(this._$instance._$buffer)],{type:"audio/mp3"})),r.click()}break;default:this.getCanvas().then((r=>{const a=document.createElement("a");a.download=`${t}.${e}`,a.href=r.toDataURL(`image/${e}`,1),a.click(),d.$poolCanvas(r)}))}}executeLibraryExportSizeLock(e){this._$lock=!this._$lock,this._$currentValue=null,e.currentTarget.childNodes[1].setAttribute("class",this._$lock?"active":"disable")}changeExportWidth(e){const t=(e=d.$clamp(+e,Le.MIN_SIZE,Le.MAX_SIZE,1))/this._$width;return this._$lock&&(this._$yScale+=t-this._$xScale,document.getElementById("export-height").value=`${Math.ceil(this._$height*this._$yScale)}`),this._$xScale=t,this.appendImage(),e}changeExportHeight(e){const t=(e=d.$clamp(+e,Le.MIN_SIZE,Le.MAX_SIZE,1))/this._$height;return this._$lock&&(this._$xScale+=t-this._$yScale,document.getElementById("export-width").value=`${Math.ceil(this._$width*this._$xScale)}`),this._$yScale=t,this.appendImage(),e}changeExportStartFrame(e){e=d.$clamp(0|e,1,this._$instance.totalFrame),this._$startFrame=e;const t=document.getElementById("export-end-frame");return e>(0|t.value)&&(t.value=`${e}`,this._$endFrame=e),e>this._$currentFrame&&(document.getElementById("export-current-frame").value=`${e}`,this._$currentFrame=e),this.reloadMovieClip(),this.appendImage(),e}changeExportEndFrame(e){e=d.$clamp(0|e,1,this._$instance.totalFrame);const t=document.getElementById("export-start-frame");return(0|t.value)>e&&(t.value=`${e}`,this._$startFrame=e),this._$currentFrame>e&&(document.getElementById("export-current-frame").value=`${e}`,this._$currentFrame=e),this.reloadMovieClip(),this.appendImage(),e}changeExportCurrentFrame(e){return e=d.$clamp(0|e,this._$startFrame,this._$endFrame),this._$currentFrame=e,this.appendImage(),e}executeLibraryExportHideIcon(){d.$endMenu()}reloadMovieClip(){const e=this.getBounds();this._$width=Math.abs(e.xMax-e.xMin),this._$height=Math.abs(e.yMax-e.yMin),document.getElementById("export-start-frame").value=`${this._$startFrame}`,document.getElementById("export-end-frame").value=`${this._$endFrame}`,document.getElementById("export-width").value=`${Math.ceil(this._$width)}`,document.getElementById("export-height").value=`${Math.ceil(this._$height)}`}executeLibraryMenuExport(){const e=d.$libraryController.activeInstances;if(!e.size)return;const t=e.values().next().value;if(this._$instance=d.$currentWorkSpace().getLibrary(0|t.dataset.libraryId),this._$instance.type===b.FOLDER)return void d.$endMenu();this._$lock=!1,this._$xScale=1,this._$yScale=1,document.getElementById("library-export-size-lock").childNodes[1].setAttribute("class","disable");const r=document.getElementById("library-export-container-area"),a=document.getElementById("library-export-size-area"),s=document.getElementById("library-export-file-area");switch(this._$instance.type){case b.MOVIE_CLIP:this._$currentFrame=1,this._$startFrame=1,this._$endFrame=this._$instance.totalFrame,r.style.display="",a.style.display="",s.style.display="",this.reloadMovieClip();break;case b.VIDEO:case b.SOUND:r.style.display="none",a.style.display="none",s.style.display="none";break;default:{r.style.display="none",a.style.display="",s.style.display="";const e=this._$instance.getBounds();this._$width=Math.abs(e.xMax-e.xMin),this._$height=Math.abs(e.yMax-e.yMin),document.getElementById("export-width").value=`${Math.ceil(this._$width)}`,document.getElementById("export-height").value=`${Math.ceil(this._$height)}`}}document.getElementById("export-name").value=`${this._$instance.name}`,this.appendImage(),d.$endMenu("library-export-modal");const i=document.getElementById("library-export-modal");i.style.display="",i.setAttribute("class","fadeIn")}getBounds(){const e=[1,0,0,1,0,0],t={frame:1,matrix:e,colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],loop:d.$getDefaultLoopConfig()},r={startFrame:1,endFrame:this._$instance.totalFrame+1},a=d.$currentFrame;let s=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let a=this._$startFrame;this._$endFrame>=a;++a){t.frame=d.$currentFrame=a;const l=this._$instance.getBounds(e,t,r);s=Math.min(l.xMin,s),i=Math.max(l.xMax,i),n=Math.min(l.yMin,n),o=Math.max(l.yMax,o)}return d.$currentFrame=a,{xMin:s,xMax:i,yMin:n,yMax:o}}removeImage(){const e=document.getElementById("library-export-image");if(e)for(;e.firstChild;){const t=e.firstChild;d.$poolCanvas(t),t.remove()}}appendImage(){switch(this._$instance.type){case b.VIDEO:case b.SOUND:this._$instance.getPreview().then((e=>{this.removeImage(),document.getElementById("library-export-image").appendChild(e)}));break;default:this.getCanvas(this._$currentFrame,!0).then((e=>{const t=window.devicePixelRatio;e.style.width=e.width/t+"px",e.style.height=e.height/t+"px",this.removeImage(),document.getElementById("library-export-image").appendChild(e)}))}}getCanvas(e=1,t=!1){const r=d.$currentFrame,a=d.$zoomScale;d.$currentFrame=e,d.$zoomScale=1;const s=this.getBounds();let i=Math.abs(s.xMax-s.xMin),n=Math.abs(s.yMax-s.yMin);if(!i||!n)return new Image;let o=this._$xScale,l=0;t&&this._$width*this._$xScale>Le.DEFAULT_SIZE&&(l=Le.DEFAULT_SIZE/(this._$width*this._$xScale));let c=this._$yScale,h=0;return t&&this._$height*this._$yScale>Le.DEFAULT_SIZE&&(h=Le.DEFAULT_SIZE/(this._$height*this._$yScale)),l&&(o*=l,c*=l),h&&(o*=h,c*=h),this._$instance.draw(d.$getCanvas(),Math.ceil(i*o),Math.ceil(n*c),{frame:1,matrix:[o,0,0,c,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[]},null,e,!0).then((e=>(d.$zoomScale=a,d.$currentFrame=r,Promise.resolve(e))))}}d.$libraryExport=new Le;d.$libraryKeyboardCommand=new class extends V{constructor(){super("library")}initialize(){super.initialize();const e=document.getElementById("library-list-box");e&&(e.addEventListener("mouseleave",(()=>{this.active=!1})),e.addEventListener("mouseover",(()=>{this.active||(this.active=!0)})),e.addEventListener("mouseup",(()=>{this.active||(this.active=!0)}))),this.add("Backspace",(()=>{d.$libraryMenu.executeLibraryMenuDelete()})),this.add(d.$generateShortcutKey("Backspace",{ctrl:!0,shift:!0}),(()=>{d.$libraryMenu.executeLibraryMenuNoUseDelete()})),this.add(d.$generateShortcutKey("m",{ctrl:!0}),(()=>{d.$libraryMenu.executeLibraryMenuContainerAdd()})),this.add(d.$generateShortcutKey("f",{ctrl:!0}),(()=>{d.$libraryMenu.executeLibraryMenuFolderAdd()})),this.add(d.$generateShortcutKey("r",{ctrl:!0}),this.loadFile),this.add(d.$generateShortcutKey("c",{ctrl:!0}),(()=>{d.$libraryMenu.executeLibraryMenuCopy()})),this.add(d.$generateShortcutKey("v",{ctrl:!0}),(()=>{d.$libraryMenu.executeLibraryMenuPaste()})),this.add(d.$generateShortcutKey("s",{ctrl:!0,shift:!0}),(()=>{d.$libraryExport.executeLibraryMenuExport()})),this.add(d.$generateShortcutKey("s",{ctrl:!0,shift:!0}),(()=>{d.$libraryExport.executeLibraryMenuExport()})),this.add("ArrowDown",this.moveItem),this.add("ArrowUp",this.moveItem),this.add(d.$generateShortcutKey("ArrowDown",{shift:!0}),this.moveItem),this.add(d.$generateShortcutKey("ArrowUp",{shift:!0}),this.moveItem),this.add(d.$generateShortcutKey("a",{ctrl:!0}),(()=>{this.allItemSelect()}))}allItemSelect(){const e=document.getElementById("library-list-box").children,t=d.$libraryController.activeInstances;t.clear();for(let r=0;e.length>r;++r){const a=e[r];a.classList.add("active");const s=0|a.dataset.libraryId;t.set(s,a)}}moveItem(e){const t=document.getElementById("library-list-box");if(!t)return;const r=Array.from(t.children);let a=0;const s=d.$libraryController.activeInstances;if(s.size){let e=null;const t=s.values();for(let r=0;s.size>r;++r)e=t.next().value;a=r.indexOf(e)}switch(e){case"ArrowDown":case"ArrowDownShift":a++;break;case"ArrowUp":case"ArrowUpShift":a--}const i=r[a];i&&(d.$libraryController.activeInstance=i,d.$libraryPreview.loadImage(0|i.dataset.libraryId))}loadFile(){d.$shiftKey=!1,d.$ctrlKey=!1,d.$altKey=!1,document.getElementById("library-menu-file-input").click()}};d.$libraryMenu=new class{constructor(){this._$saved=!1,this._$copyWorkSpaceId=-1,this._$copyLibraries=[],this._$adjusted=!1,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-list-box");e&&(e.addEventListener("contextmenu",(e=>{this.show(e)})),e.addEventListener("mousedown",(e=>{e.button||this.hide()})));const t=["library-menu-container-add","library-menu-folder-add","library-menu-file","library-menu-delete","library-menu-no-use-delete","library-menu-empty-folder-delete","library-menu-copy","library-menu-paste","library-open-photopea"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);r&&r.addEventListener("mousedown",(e=>{if(e.button)return;d.$endMenu(),e.stopPropagation();this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}))}const r=document.getElementById("library-menu-file-input");r&&r.addEventListener("change",(e=>{if(d.$saveProgress.active)return;d.$saveProgress.start(),this.save(),d.$saveProgress.loadFiles();const t=[],r=e.target.files;for(let e=0;e<r.length;++e)t.push(new Promise((t=>{d.$libraryController.loadFile(r[e],t)})));Promise.all(t).then((()=>{d.$saveProgress.end()})),e.target.value="",this._$saved=!1})),d.$initializeEnd()}executeLibraryOpenPhotopea(){const e=d.$libraryController.activeInstances;if(!e.size)return;const t=d.$currentWorkSpace();for(let r of e.keys()){const e=t.getLibrary(r);e.type===b.BITMAP&&e.draw(d.$getCanvas(),Math.ceil(e.width),Math.ceil(e.height),{frame:1,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[]},null,0,!0).then((t=>{const r={files:[t.toDataURL(e.imageType)]};d.$poolCanvas(t);const a=document.createElement("a");a.href=`https://www.photopea.com#${encodeURI(JSON.stringify(r))}`,a.target="_blank",a.click()}))}}executeLibraryMenuContainerAdd(){this.save();const e=d.$currentWorkSpace(),t=e.nextLibraryId;e.addLibrary({id:t,type:b.MOVIE_CLIP,name:`MovieClip_${t}`,symbol:""}),this._$saved=!1,d.$libraryController.reload()}executeLibraryMenuFolderAdd(){this.save();const e=d.$currentWorkSpace(),t=e.nextLibraryId,r=e.addLibrary({id:t,type:"folder",name:`Folder_${t}`,symbol:""}),a=d.$libraryController.activeInstances;if(a.size){for(let r of a.keys()){e.getLibrary(r).folderId=t}r.mode=_.OPEN}d.$libraryController.reload(),this._$saved=!1}executeLibraryMenuFile(e){e.preventDefault(),document.getElementById("library-menu-file-input").click()}executeLibraryMenuDelete(){const e=d.$libraryController.activeInstances;if(!e.size)return;this.save();const t=d.$currentWorkSpace();for(const r of e.values()){const e=0|r.dataset.libraryId,a=t.getLibrary(e);a&&(a.remove(),r.remove(),t.removeLibrary(e))}e.clear();d.$tools.getDefaultTool("arrow").clearActiveElement(),d.$transformController.hide(),d.$gridController.hide(),d.$tweenController.clearPointer(),d.$controller.default(),d.$javascriptController.reload(),d.$libraryController.reload(),d.$libraryPreview.dispose(),d.$timelineLayer.activeCharacter(),t.scene.changeFrame(d.$timelineFrame.currentFrame),this._$saved=!1}executeLibraryMenuEmptyFolderDelete(){const e=d.$currentWorkSpace(),t=[];for(let r of e._$libraries.values())r.type===b.FOLDER&&t.push(r);if(t.length){let r=!1;for(;;){const a=[];for(let s=0;s<t.length;++s){let i=!1;const n=t[s];for(let t of e._$libraries.values())if(t.folderId===n.id){i=!0;break}i||(r=!0,document.getElementById(`library-child-id-${n.id}`).remove(),e.removeLibrary(n.id),a.push(n))}if(!a.length)break;for(let e=0;e<a.length;++e){const r=t.indexOf(a[e]);t.splice(r,1)}}r&&d.$libraryController.reload()}}executeLibraryMenuNoUseDelete(){let e=!1;const t=d.$currentWorkSpace(),r=new Map;for(let e of t._$libraries.values())if(e.type===b.MOVIE_CLIP){for(let a of e._$layers.values()){const e=a._$characters;for(let a=0;a<e.length;++a){const s=e[a].libraryId;r.has(s)||r.set(s,0);const i=r.get(s)+1;r.set(s,i);const n=t.getLibrary(s);if("shape"===n.type&&n.bitmapId){r.has(n.bitmapId)||r.set(n.bitmapId,0);const e=r.get(s)+1;r.set(s,e)}}}if(e._$sounds.size)for(const t of e._$sounds.values())for(let e=0;e<t.length;++e){const a=t[e];r.set(a.characterId,!0)}}this.save();for(let a of t._$libraries.values())if(a.id&&!r.has(a.id)&&a.type!==b.FOLDER&&!a.symbol){if(e=!0,a.type===b.MOVIE_CLIP)for(let e of a._$layers.values()){const a=e._$characters;for(let e=0;e<a.length;++e){const s=a[e].libraryId;if(!r.has(s))continue;const i=t.getLibrary(s);if(!i||i.symbol)continue;const n=r.get(s)-1;r.set(s,n)}}t.removeLibrary(a.id)}for(;;){let e=!0;for(const[a,s]of r){if(s>0)continue;const i=t.getLibrary(a);if(!i.symbol&&(e=!1,i)){if(i.type===b.MOVIE_CLIP)for(let e of i._$layers.values()){const a=e._$characters;for(let e=0;e<a.length;++e){const s=a[e].libraryId;if(!r.has(s))continue;const i=t.getLibrary(s);if(!i||i.symbol)continue;const n=r.get(s)-1;r.set(s,n)}}t.removeLibrary(a),r.delete(a)}}if(e||!r.size)break}e&&(d.$libraryController.clearActive(),d.$javascriptController.reload(),d.$libraryController.reload()),this._$saved=!1}clearCopy(){this._$adjusted=!1,this._$copyWorkSpaceId=-1,this._$copyLibraries.length=0}executeLibraryMenuCopy(){this.clearCopy(),this._$copyWorkSpaceId=d.$activeWorkSpaceId;const e=d.$currentWorkSpace(),t=d.$libraryController.activeInstances;for(const r of t.values()){const t=e.getLibrary(0|r.dataset.libraryId);t&&this._$copyLibraries.push(t.clone())}}executeLibraryMenuPaste(){if(!this._$copyLibraries.length)return;const e=d.$workSpaces[this._$copyWorkSpaceId],t=d.$currentWorkSpace();if(!this._$adjusted){this._$adjusted=!0;const t=new Map,r=[];for(let e=0;this._$copyLibraries.length>e;++e){const a=this._$copyLibraries[e];t.set(a.id,!0),a.folderId&&r.push(a)}for(let a=0;a<r.length;++a){let s=r[a];for(;s.folderId;){const i=e.getLibrary(s.folderId);if(t.has(i.id)){const e=this._$copyLibraries.indexOf(r[a]);e>-1&&this._$copyLibraries.splice(e,1);break}s=i}}}this.save();for(let r=0;this._$copyLibraries.length>r;++r){const a=this._$copyLibraries[r];let s=null;if(this._$copyWorkSpaceId===d.$activeWorkSpaceId)for(s=a.clone();;){const e=s.path;if(!t._$nameMap.has(e))break;s.name+="_copy"}else{const r=a.getPathWithWorkSpace(e);if(t._$nameMap.has(r)){d.$confirmModal.files.push({file:a,character:null,layer:null,path:r,workSpaceId:this._$copyWorkSpaceId,type:"copy"});continue}if(a.type===b.MOVIE_CLIP)s=d.$confirmModal.cloneMovieClip(this._$copyWorkSpaceId,a);else{const e=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$copyWorkSpaceId,s=a.clone(),d.$activeWorkSpaceId=e}if(!s)continue;s.folderId&&d.$confirmModal.createFolder(this._$copyWorkSpaceId,s)}s._$id=t.nextLibraryId,d.$libraryController.createInstance(s.type,s.name,s.id,s.symbol),t._$libraries.set(s.id,s),s.type===b.FOLDER&&d.$confirmModal.cloneFolderItem(this._$copyWorkSpaceId,a.id,s)}d.$libraryController.reload(),d.$confirmModal.files.length?d.$confirmModal.show():d.$confirmModal.clear(),this._$saved=!1}show(e){const t=document.getElementById("library-menu");t.style.left=t.clientWidth+e.pageX+5>window.innerWidth?e.pageX-(t.clientWidth+e.pageX+10-window.innerWidth)+"px":`${e.pageX+5}px`,t.style.top=e.pageY-t.clientHeight/2+"px",t.setAttribute("class","fadeIn"),d.$endMenu("library-menu")}hide(){d.$endMenu()}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}};d.$libraryPreview=new class{constructor(){this._$currentId=-1,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-preview-area");e&&(e.addEventListener("mousedown",(e=>{this.mousedown(e)})),e.addEventListener("dragstart",(()=>{d.$libraryController.dragstart()})),e.addEventListener("dragend",(()=>{d.$libraryController.dragend()}))),d.$initializeEnd()}mouseout(e){-1!==this._$currentId&&(e.stopPropagation(),document.getElementById("library-preview-area").draggable=!1)}mousedown(e){if(-1===this._$currentId)return;e.stopPropagation();const t=document.getElementById(`library-child-id-${this._$currentId}`);if(t){const e=document.getElementById("library-preview-area"),r=Array.from(document.getElementById("library-preview-area").children);d.$libraryController.activeInstance=t;for(let t=0;t<r.length;++t)e.appendChild(r[t]);e.draggable=!0}}dispose(){this._$currentId=-1;const e=document.getElementById("library-preview-area");if(e){for(;e.firstChild;)d.$poolCanvas(e.firstChild),e.firstChild.remove();e.draggable=!1}}loadImage(e){this.dispose();const t=d.$currentWorkSpace().getLibrary(e);t.type!==b.FOLDER&&(this._$currentId=e,t.getPreview().then((e=>{e&&document.getElementById("library-preview-area").appendChild(e),t.type===b.SOUND?d.$soundWaveform.draw(t._$buffer.slice()):d.$soundWaveform.stop()})))}};d.$librarySearch=new class{constructor(){this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-search");e&&(e.addEventListener("focusin",(()=>{d.$keyLock=!0})),e.addEventListener("focusout",(()=>{d.$keyLock=!1})),e.addEventListener("input",(e=>{this.execute(e)}))),d.$initializeEnd()}execute(e){const t=e.target.value,r=document.getElementById("library-list-box").children,a=r.length;for(let e=0;e<a;++e){const a=r[e];!t||a.children[0].innerText.indexOf(t)>-1||a.children[1].innerText.indexOf(t)>-1?a.style.display="":a.style.display="none"}}};class Me extends he{constructor(){super("loop"),this._$frameTarget="start"}initialize(){super.initialize();const e=["no-use-loop","loop-repeat","loop-no-repeat","fixed-one","loop-no-repeat-reversal","loop-repeat-reversal","frame-picker-button","target-start-button","target-end-button"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e.target.id,e)}))}const t=["loop-start-frame","loop-end-frame"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);r&&this.setInputEvent(r)}}static get DEFAULT(){return 5}static get REPEAT(){return 0}static get NO_REPEAT(){return 1}static get FIXED_ONE(){return 2}static get NO_REPEAT_REVERSAL(){return 3}static get REPEAT_REVERSAL(){return 4}changeLoopStartFrame(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return e;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return e;const s=d.$currentWorkSpace().getLibrary(a.libraryId);if(!s)return e;e=d.$clamp(0|e,1,s.totalFrame);const i=d.$timelineFrame.currentFrame,n=a.getRange(i);let o=a.getPlace(n.startFrame);return o.loop?(o.loop.start=e,a.dispose(),this.reloadScreen(),e):e}changeLoopEndFrame(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return e;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return e;const s=d.$currentWorkSpace().getLibrary(a.libraryId);if(!s)return e;e=d.$clamp(0|e,0,s.totalFrame);const i=d.$timelineFrame.currentFrame,n=a.getRange(i);let o=a.getPlace(n.startFrame);return o.loop?(o.loop.end=e,a.dispose(),this.reloadScreen(),e||"-"):e}changeFramePickerButton(){document.getElementById("loop-image-list").style.display="none",this.loadLoopFrameList()}changeTargetStartButton(){const e=document.getElementById("target-start-button");e.classList.contains("active")||e.classList.add("active"),document.getElementById("target-end-button").classList.remove("active"),this._$frameTarget="start"}changeTargetEndButton(){const e=document.getElementById("target-end-button");e.classList.contains("active")||e.classList.add("active"),document.getElementById("target-start-button").classList.remove("active"),this._$frameTarget="end"}changeLoopRepeat(){const e=document.getElementById("loop-repeat");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(0)}changeLoopNoRepeat(){const e=document.getElementById("loop-no-repeat");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(1)}changeFixedOne(){const e=document.getElementById("fixed-one");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(2)}changeLoopNoRepeatReversal(){const e=document.getElementById("loop-no-repeat-reversal");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(3)}changeLoopRepeatReversal(){const e=document.getElementById("loop-repeat-reversal");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(4)}changeNoUseLoop(){const e=document.getElementById("no-use-loop");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(5)}clearLoopButton(e){const t=e.parentNode.children;for(let e=0;e<t.length;++e)t[e].classList.remove("active")}reload(e){const t=document.getElementById("loop-setting-view-area").firstElementChild.children;for(let e=0;e<t.length;++e)t[e].classList.remove("active");const r=document.getElementById("loop-image-list"),a=r.getElementsByTagName("canvas");for(let e=0;e<a.length;++e)d.$poolCanvas(a[e]);for(;r.children.length;)r.children[0].remove();document.getElementById(["loop-repeat","loop-no-repeat","fixed-one","loop-no-repeat-reversal","loop-repeat-reversal","no-use-loop"][e.type]).classList.add("active"),document.getElementById("loop-start-frame").value=`${e.start}`,document.getElementById("loop-end-frame").value=`${e.end?e.end:"-"}`}loadLoopFrameList(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=document.getElementById("loop-image-list"),r=t.getElementsByTagName("canvas");for(let e=0;e<r.length;++e)d.$poolCanvas(r[e]);for(;t.children.length;)t.children[0].remove();const a=d.$currentWorkSpace(),s=a.scene,i=e[0],n=0|i.dataset.layerId,o=s.getLayer(n),l=0|i.dataset.characterId,c=o.getCharacter(l),h={startFrame:c.startFrame,endFrame:c.endFrame},u=a.getLibrary(c.libraryId),m=d.$timelineFrame.currentFrame,g=[],$=u.totalFrame;for(let e=1;$>=e;++e)g.push(new Promise((t=>{window.requestAnimationFrame((()=>{const{Sprite:r,BitmapData:a}=window.next2d.display,{Matrix:s,ColorTransform:i}=window.next2d.geom;d.$currentFrame=e;const n=new r,o={frame:e,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],loop:d.$getDefaultLoopConfig()},l=n.addChild(u.createInstance(o,h));l.transform.matrix=new s,l.transform.colorTransform=new i;const c=u.getBounds([1,0,0,1,0,0],o,h),m=Math.ceil(Math.abs(c.xMax-c.xMin)),g=Math.ceil(Math.abs(c.yMax-c.yMin)),$=Math.min(95/m,95/g),p=window.devicePixelRatio,f=new a(m*$*p,g*$*p,!0,0),y=new s(p,0,0,p,-c.xMin*p,-c.yMin*p);y.scale($,$),f.draw(n,y);const _=f.drawFromCanvas(d.$getCanvas());f.dispose();const b=_.canvas;return b.style.width=f.width/p+"px",b.style.height=f.height/p+"px",t({index:e-1,image:b})}))})));Promise.all(g).then((e=>{d.$currentFrame=m;const r=[];for(let t=0;t<e.length;++t){const a=e[t];r[a.index]=a.image}for(let e=0;e<r.length;++e){const a=e+1,s=document.createElement("span");s.textContent=`[ ${a} ]`;const i=document.createElement("p");i.appendChild(r[e]);const n=document.createElement("div");n.dataset.frame=`${a}`,n.appendChild(i),n.appendChild(s),n.addEventListener("click",(e=>{this.clickImage(e)})),t.appendChild(n)}t.style.display=""}))}clickImage(e){e.stopPropagation();const t=document.getElementById(`loop-${this._$frameTarget}-frame`);this.save(),t.focus(),t.value=e.currentTarget.dataset.frame,t.blur(),this._$saved=!1}updateLoopType(e=0){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const s=d.$timelineFrame.currentFrame,i=a.getRange(s);let n=a.getPlace(i.startFrame);n.loop.type!==e&&(n.loop.type=e,a.dispose(),this.reloadScreen())}}d.$loopController=new Me;d.$objectController=new class extends he{constructor(){super("object")}initialize(){super.initialize();const e=document.getElementById("object-name");e&&(e.addEventListener("focusout",(e=>{this.finishInput(e,!1)})),e.addEventListener("keypress",(e=>{this.finishInput(e,!1)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})));const t=document.getElementById("object-symbol");t&&(t.addEventListener("focusout",(e=>{this.finishInput(e,!1)})),t.addEventListener("keypress",(e=>{this.finishInput(e,!1)})),t.addEventListener("focusin",(e=>{this.focusIn(e)})))}changeObjectSymbol(e){const t=d.$tools.getDefaultTool("arrow");switch(t.activeElements.length){case 0:d.$currentWorkSpace().scene.symbol=e;break;case 1:{const r=t.activeElements[0];d.$currentWorkSpace().getLibrary(0|r.dataset.libraryId).symbol=e}}return e}changeObjectName(e){const t=d.$tools.getDefaultTool("arrow");switch(t.activeElements.length){case 0:d.$currentWorkSpace().scene.name=e;break;case 1:{const r=t.activeElements[0];d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId).name=e}}return e}};d.$pluginController=new class{constructor(){this._$saved=!1,this._$selectElement=null,this._$deleteCommand=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),this._$deleteCommand=this.deleteCommand.bind(this);const e=document.getElementById("plugin-list-box");e&&(e.addEventListener("mouseleave",(()=>{this.mouseleave()})),e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(e=>{this.dropElement(e)}))),d.$initializeEnd()}dropElement(e){this.save(),e.preventDefault();const t=d.$currentWorkSpace(),r=[],a=e.dataTransfer.files;for(let e=0;e<a.length;++e){const s=a[e];r.push(s.text().then((e=>{t._$plugins.set(s.name,{name:s.name,src:e})})))}Promise.all(r).then((()=>{this.reload(Array.from(d.$currentWorkSpace()._$plugins.values())),this._$saved=!1}))}mouseleave(){this._$selectElement&&this._$selectElement.classList.remove("active"),window.removeEventListener("keydown",this._$deleteCommand),this._$selectElement=null}reload(e){const t=["plugin-list-box","plugin-tools","plugin-menu"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);if(r)for(;r.children.length;)r.children[0].remove()}const r=document.getElementsByTagName("script");for(let e=0;e<r.length;++e){const t=r[e];t.dataset.plugin&&t.remove()}for(let t=0;t<e.length;++t){const r=e[t];document.getElementById(r.name)||(this.appendScript(r.name,r.src),this.appendNode(r.name))}}appendScript(e,t){const r=document.createElement("script");r.dataset.plugin="true",r.async=!0,r.id=e,r.type="text/javascript",r.src=URL.createObjectURL(new Blob([t],{type:"text/javascript"})),document.getElementsByTagName("head")[0].appendChild(r)}appendNode(e){const t=document.createElement("div");t.dataset.id=`${e}_node`,t.dataset.name=`${e}`,t.classList.add("plugin-list"),t.innerHTML=`<i></i>${e}`,t.addEventListener("mousedown",(e=>{this._$selectElement||window.addEventListener("keydown",this._$deleteCommand),this._$selectElement&&this._$selectElement.classList.remove("active"),this._$selectElement=e.currentTarget,this._$selectElement.classList.add("active")})),document.getElementById("plugin-list-box").appendChild(t)}deleteCommand(e){d.$keyLock||"Backspace"===e.key&&(this.save(),window.removeEventListener("keydown",this._$deleteCommand),this.dispose(this._$selectElement),this._$selectElement=null,this._$saved=!1)}dispose(e){const t=e.dataset.name,r=document.getElementById(t);r&&r.remove(),d.$currentWorkSpace()._$plugins.delete(t),e.remove()}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}};class Ce{constructor(){this._$screenX=0,this._$screenY=0,this._$moveModal=null,this._$endModal=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=["plugin-bar","plugin-hide-icon"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation();this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}))}document.documentElement.style.setProperty("--plugin-panel-width",`${Ce.PLUGIN_DEFAULT_WIDTH}px`),document.documentElement.style.setProperty("--plugin-panel-height",`${Ce.PLUGIN_DEFAULT_HEIGHT}px`),d.$initializeEnd()}static get PLUGIN_DEFAULT_WIDTH(){return 200}static get PLUGIN_DEFAULT_HEIGHT(){return 200}executePluginBar(e){this._$screenX=e.screenX,this._$screenY=e.screenY,this._$moveModal||(this._$moveModal=this.moveModal.bind(this)),this._$endModal||(this._$endModal=this.endModal.bind(this)),window.addEventListener("mousemove",this._$moveModal),window.addEventListener("mouseup",this._$endModal)}moveModal(e){const t=document.getElementById("plugin-modal");t.style.left=`${t.offsetLeft+(e.screenX-this._$screenX)}px`,t.style.top=`${t.offsetTop+(e.screenY-this._$screenY)}px`,this._$screenX=e.screenX,this._$screenY=e.screenY}endModal(){d.$setCursor("auto"),window.removeEventListener("mousemove",this._$moveModal),window.removeEventListener("mouseup",this._$endModal)}executePluginHideIcon(){window.nt.hidePanel()}}d.$pluginPanel=new Ce;d.$referenceController=new class extends he{constructor(){super("reference"),this._$pointer=null}initialize(){super.initialize(),this._$pointer={x:0,y:0};const e=["transform-reference-x","transform-reference-y"];for(let t=0;t<e.length;++t)this.setInputEvent(document.getElementById(e[t]));const t=document.getElementById("reference-point");t&&t.addEventListener("dblclick",(e=>{e.stopPropagation(),this.resetPointer()}));const r=document.getElementById("reference-setting-box");if(r){const e=r.getElementsByClassName("reference-setting-box-child");for(let t=0;t<e.length;++t){e[t].addEventListener("mousedown",(e=>{e.stopPropagation(),this.moveNineReferencePoint(e)}))}}}get pointer(){return this._$pointer}set pointer(e){this._$pointer=e}moveNineReferencePoint(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const r=d.$currentWorkSpace().scene,a=d.$sceneChange.concatenatedMatrix;let s=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let e=0;t.length>e;++e){const l=t[e],c=r.getLayer(0|l.dataset.layerId);if(!c||c.lock||c.disable)continue;const d=0|l.dataset.characterId;if(!document.getElementById(`character-${d}`))continue;const h=c.getCharacter(d).getBounds(a);s=Math.min(s,h.xMin),i=Math.max(i,h.xMin+Math.ceil(Math.abs(h.xMax-h.xMin))),n=Math.min(n,h.yMin),o=Math.max(o,h.yMin+Math.ceil(Math.abs(h.yMax-h.yMin)))}const l=s,c=n,h=i-s,u=o-n;let m=l+h/2,g=c+u/2;switch(e.target.dataset.position){case"top-left":m=l,g=c;break;case"top-center":m=l+h/2,g=c;break;case"top-right":m=l+h,g=c;break;case"center-left":m=l,g=c+u/2;break;case"center-right":m=l+h,g=c+u/2;break;case"bottom-left":m=l,g=c+u;break;case"bottom-center":m=l+h/2,g=c+u;break;case"bottom-right":m=l+h,g=c+u}if(this.save(),t.length>1)this._$pointer.x=m,this._$pointer.y=g;else{const e=t[0],r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId).getCharacter(0|e.dataset.characterId);if(!r)return;const a=d.$timelineFrame.currentFrame,s=r.getRange(a),i=r.getPlace(s.startFrame);i.point||(i.point={x:0,y:0}),i.point.x=m,i.point.y=g}this.setInputValue(m,g),d.$transformController.relocation(),this._$saved=!1}changeTransformReferenceX(e){e=d.$clamp(+e,-Number.MAX_VALUE,Number.MAX_VALUE);const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return e;if(1===t.length){const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return e;const s=d.$timelineFrame.currentFrame;a.getPlace(s).point.x=e}else this._$pointer.x=e;return e}changeTransformReferenceY(e){e=d.$clamp(+e,-Number.MAX_VALUE,Number.MAX_VALUE);const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return e;if(1===t.length){const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return e;const s=d.$timelineFrame.currentFrame;a.getPlace(s).point.y=e}else this._$pointer.y=e;return e}resetPointer(){d.$tools.getDefaultTool("arrow").activeElements.length&&(this._$pointer={x:0,y:0},this.moveNineReferencePoint({target:{dataset:{position:"center-top"}}}))}setInputValue(e=0,t=0){document.getElementById("transform-reference-x").value=`${e}`,document.getElementById("transform-reference-y").value=`${t}`}};class Fe extends he{constructor(){super("fill-color"),this._$currentPointer=null,this._$viewGradientContext=null,this._$drawGradientContext=null,this._$mouseMoveGradientColorPointer=null,this._$mouseUpGradientColorPointer=null}static get GRADIENT_CANVAS_WIDTH(){return 255}static get GRADIENT_CANVAS_HEIGHT(){return 30}static get MIN_COLOR(){return 0}static get MAX_COLOR(){return 100}static get MIN_ALPHA(){return 0}static get MAX_ALPHA(){return 100}static get MIN_STROKE(){return 1}static get MAX_STROKE(){return 255}static get MIN_GRADIENT_POINTER(){return 0}static get MAX_GRADIENT_POINTER(){return 255}initialize(){super.initialize();const e=document.getElementById("gradient-canvas");if(e){e.style.transform=`scale(${1/window.devicePixelRatio}, ${1/window.devicePixelRatio})`,e.style.backfaceVisibility="hidden",e.style.transformOrigin="0 0";const t=Fe.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,r=Fe.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio;e.width=t,e.height=r,this._$viewGradientContext=e.getContext("2d");const a=document.createElement("canvas");a.width=t,a.height=r,this._$drawGradientContext=a.getContext("2d")}const t=["fill-alpha-value","fill-stroke-width-value"];for(let e=0;e<t.length;++e)this.setInputEvent(document.getElementById(t[e]));const r=["fill-color-type-select","fill-color-value","fill-bitmap-select"];for(let e=0;e<r.length;++e)this.setChangeEvent(document.getElementById(r[e]));const a=document.getElementById("color-pointer-list");a&&a.addEventListener("mousedown",(e=>{this.setGradientColorPointerEvent(e)}))}removeGradientColorPointer(e){const t=document.getElementById("color-pointer-list");if(t.children.length>2&&d.$hitColor){const r=0|e.target.dataset.index;d.$hitColor.ratios.splice(r,1),e.target.remove();for(let e=r;e<t.children.length;++e){const r=t.children[e],a=(0|r.dataset.index)-1;r.dataset.index=`${a}`}this.updateGradientCanvas(),d.$hitColor.shape.cacheClear(),this.reloadScreen()}}setGradientColorPointerEvent(e){if(!this._$currentPointer||!d.$hitColor)return;const t=document.getElementById("fill-color-value").value,r=0|document.getElementById("fill-alpha-value").value,a=d.$intToRGB(0|`0x${t.slice(1)}`),s={R:a.R,G:a.G,B:a.B,A:r/100*255,ratio:e.offsetX/255};d.$hitColor.ratios.push(s),d.$hitColor.ratios.sort(((e,t)=>{switch(!0){case e.ratio>t.ratio:return 1;case e.ratio<t.ratio:return-1;default:return 0}})),this.initializeGradient(),d.$hitColor.shape.cacheClear(),this.reloadScreen(),this._$currentPointer=e.target.children[d.$hitColor.ratios.indexOf(s)]}changeFillAlphaValue(e){if(e=d.$clamp(0|e,Fe.MIN_ALPHA,Fe.MAX_ALPHA),d.$hitColor){const{GradientType:t}=window.next2d.display;switch(d.$hitColor.type){case t.LINEAR:case t.RADIAL:this._$currentPointer&&(this._$currentPointer.dataset.alpha=e,d.$hitColor.shape.changeColor(0|this._$currentPointer.dataset.index),this.updateGradientCanvas());break;default:d.$hitColor.shape.changeColor()}}return e}changeFillStrokeWidthValue(e){if(e=d.$clamp(0|e,Fe.MIN_STROKE,Fe.MAX_STROKE),this._$currentValue!==e&&d.$hitColor){d.$hitColor.shape.changeColor();const{GradientType:e}=window.next2d.display;switch(d.$hitColor.type){case e.LINEAR:case e.RADIAL:this.updateGradientCanvas()}}return e}changeFillColorTypeSelect(e=""){const t=document.getElementById("fill-color-gradient-container"),r=document.getElementById("fill-color-bitmap-container"),a=document.getElementById("fill-color-rgba-container"),s=document.getElementById("fill-stroke-color-rgba-container");switch(e&&(d.$hitColor.shape.bitmapId=0),document.getElementById("fill-color-type-select").value){case"rgba":t.style.display="none",r.style.display="none",a.style.display="",s.style.display=d.$hitColor.width?"":"none";break;case"bitmap":t.style.display="none",r.style.display="",a.style.display="none",s.style.display=d.$hitColor.width?"":"none",this.createBitmapList();break;default:t.style.display="",r.style.display="none",a.style.display="",s.style.display=d.$hitColor.width?"":"none",e||this.initializeGradient()}e&&d.$hitColor.shape.changeStyle(e)}changeFillColorValue(e){if(d.$hitColor)if(this._$currentPointer){const t=this._$currentPointer.getElementsByTagName("i")[0];this._$currentPointer.dataset.color=e,t.style.backgroundColor=e,d.$hitColor.shape.changeColor(0|this._$currentPointer.dataset.index),this.updateGradientCanvas()}else d.$hitColor.shape.changeColor()}changeFillBitmapSelect(e){if(!d.$hitColor)return;const t=d.$currentWorkSpace().getLibrary(0|e);d.$hitColor.shape.bitmapId=t.id,d.$hitColor.shape.cacheClear()}createBitmapList(){const e=document.getElementById("fill-bitmap-select"),t=e.children;for(;t.length;)t[0].remove();const r=document.createElement("option");r.innerHTML="Image Selection",r.defaultSelected=!0,r.disabled=!0,e.appendChild(r);const a=d.$hitColor.shape.bitmapId,s=d.$currentWorkSpace();for(const t of s._$libraries.values()){if(t.type!==b.BITMAP)continue;const r=document.createElement("option");r.value=t.id,r.innerHTML=t.name,a&&a===t.id&&(r.selected=!0),e.appendChild(r)}}initializeGradient(){if(!d.$hitColor)return;const e=document.getElementById("color-pointer-list").children;for(;e.length;)e[0].remove();const t=d.$hitColor.ratios.length;for(let e=0;e<t;++e){const r=d.$hitColor.ratios[e],a=r.R.toString(16).padStart(2,"0"),s=r.G.toString(16).padStart(2,"0"),i=r.B.toString(16).padStart(2,"0");this.addGradientColorPointer(e,255*r.ratio,`#${a}${s}${i}`,r.A/255*100),e+1===t&&(document.getElementById("fill-color-value").value=`#${a}${s}${i}`,document.getElementById("fill-alpha-value").value=r.A/255*100)}this.updateGradientCanvas()}addGradientColorPointer(e,t,r,a){const s=document.getElementById("color-pointer-list"),i=`\n<div class="color-pointer" style="left: ${t-4}px;" data-index="${e}" data-color="${r}" data-alpha="${a}">\n    <div class="color-pointer-triangle"></div>\n    <div class="color-pointer-rect">\n        <i class="pointer-color" style="background-color: ${r}"></i>\n    </div>\n</div>\n`;s.insertAdjacentHTML("beforeend",i);const n=s.lastElementChild;n.addEventListener("mousedown",(e=>{this.mouseDownGradientColorPointer(e)})),n.addEventListener("dblclick",(e=>{this.removeGradientColorPointer(e)})),this._$currentPointer=n}updateGradientCanvas(){const e=this._$drawGradientContext;e.clearRect(0,0,Fe.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,Fe.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.beginPath();const t=d.$hitColor.ratios,r=t.length,a=Math.ceil(255*t[r-1].ratio*window.devicePixelRatio),s=e.createLinearGradient(0,0,a,0);for(let e=0;e<r;++e){const r=t[e];s.addColorStop(r.ratio,`rgba(${r.R}, ${r.G}, ${r.B}, ${r.A/255})`)}e.fillStyle=s,e.rect(0,0,Fe.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,Fe.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.fill();const i=this._$viewGradientContext;i.clearRect(0,0,Fe.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,Fe.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),i.drawImage(e.canvas,0,0)}mouseDownGradientColorPointer(e){e.stopPropagation(),this._$saved=!1,this._$pointX=e.screenX,this._$currentPointer=e.target,document.getElementById("fill-color-value").value=e.target.dataset.color,document.getElementById("fill-alpha-value").value=e.target.dataset.alpha,this._$mouseMoveGradientColorPointer||(this._$mouseMoveGradientColorPointer=this.mouseMoveGradientColorPointer.bind(this)),this._$mouseUpGradientColorPointer||(this._$mouseUpGradientColorPointer=this.mouseUpGradientColorPointer.bind(this)),window.addEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.addEventListener("mouseup",this._$mouseUpGradientColorPointer)}mouseMoveGradientColorPointer(e){const t=this._$currentPointer;t&&window.requestAnimationFrame((()=>{if(!d.$hitColor)return;this.save(),e.preventDefault();const r=parseFloat(t.style.left),a=d.$clamp(r+(e.screenX-this._$pointX)+4,Fe.MIN_GRADIENT_POINTER,Fe.MAX_GRADIENT_POINTER);t.style.left=a-4+"px",d.$hitColor.ratios[t.dataset.index].ratio=a/255,this._$pointX&&(this._$pointX=e.screenX),this.updateGradientCanvas(),d.$hitColor.shape.cacheClear(),this.reloadScreen()}))}mouseUpGradientColorPointer(){window.removeEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.removeEventListener("mouseup",this._$mouseUpGradientColorPointer),d.$setCursor("auto"),super.focusOut()}}d.$shapeController=new Fe;class ke extends he{constructor(){super("sound")}static get MIN_VOLUME(){return 0}static get MAX_VOLUME(){return 100}static get MIN_LOOP_COUNT(){return 0}static get MAX_LOOP_COUNT(){return 65535}initialize(){super.initialize();const e=document.getElementById("sound-add");e&&e.addEventListener("mousedown",(()=>{const e=document.getElementById("sound-select");e&&e.options.length&&(this.save(),this.addSound(),this._$saved=!1)}))}addSound(e=null,t=0){if(!e){const r=document.getElementById("sound-select"),a=r.options[r.selectedIndex],s=d.$timelineFrame.currentFrame,i=d.$currentWorkSpace().scene;i._$sounds.has(s)||i._$sounds.set(s,[]);const n=i._$sounds.get(s);t=n.length,e={characterId:0|r.value,name:a.textContent,volume:100,loopCount:0,autoPlay:!1},n.push(e),this.setIcon(s)}const r=`\n<div id="sound-id-${t}" class="sound-border">\n    <div class="sound-title">\n      <span id="sound-name-${t}" data-sound-id="${t}">${e.name}</span>\n      <i class="trash" id="sound-trash-${t}" data-sound-id="${t}" data-detail="{{サウンドを削除}}"></i>\n    </div>\n\n    <div class="sound-container">\n        <div class="sound-setting-container">\n            <div class="sound-text">Volume</div>\n            <div><input type="text" id="sound-volume-${t}" data-sound-id="${t}" data-name="volume" value="100" data-detail="{{音量設定}}" autocomplete="off"></div>\n        \n            <div class="sound-text">Loop<br>Count</div>\n            <div><input type="text" id="sound-loop-count-${t}" data-sound-id="${t}" data-name="loop-count" value="0" data-detail="{{ループ回数}}" autocomplete="off"></div>\n        </div>\n    </div>\n</div>\n`;document.getElementById("sound-list-area").insertAdjacentHTML("beforeend",r);const a=document.getElementById(`sound-volume-${t}`);a.value=`${e.volume}`,this.setInputEvent(a);const s=document.getElementById(`sound-loop-count-${t}`);s.value=`${e.loopCount}`,this.setInputEvent(s),document.getElementById(`sound-trash-${t}`).addEventListener("click",(e=>{this.save(),this.trash(0|e.target.dataset.soundId),this.createSoundElements(),this._$saved=!1})),d.$addModalEvent(document.getElementById(`sound-id-${t}`))}changeSoundVolume(e){return e=d.$clamp(0|e,ke.MIN_VOLUME,ke.MAX_VOLUME),this.updateSoundProperty("volume",e),e}changeSoundLoopCount(e){return e=d.$clamp(0|e,ke.MIN_LOOP_COUNT,ke.MAX_LOOP_COUNT),this.updateSoundProperty("loopCount",e),e}updateSoundProperty(e,t){if(!this._$currentTarget)return;const r=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene,s=0|this._$currentTarget.dataset.soundId;a._$sounds.get(r)[s][e]=t}setIcon(e){const t=d.$timelineHeader.leftFrame;if(t>e)return;const r=e-t,a=document.getElementById("timeline-header").children[r].children[pe.SOUND_INDEX];a.classList.contains("frame-border-box-sound")||a.setAttribute("class","frame-border-box-sound")}deleteIcon(e){const t=document.getElementById("timeline-header");if(!t)return;const r=t.getElementsByClassName("frame-border-box-sound");for(let t=0;t<r.length;++t){const a=r[t];if((0|a.dataset.frame)===e){a.setAttribute("class","frame-border-box");break}}}trash(e){const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene,a=r._$sounds.get(t);a.splice(e,1),a.length||(r._$sounds.delete(t),this.deleteIcon(t))}createSoundElements(){const e=document.getElementById("sound-list-area");if(e)for(;e.children.length;)e.children[0].remove();const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene;if(r.hasSound(t)){const e=r.getSound(t);for(let t=0;t<e.length;++t)this.addSound(e[t],t)}}}d.$soundController=new ke;d.$soundWaveform=new class{constructor(){this._$width=280,this._$height=60,this._$stopFlag=!1}stop(){this._$stopFlag=!0}draw(e){this._$stopFlag=!1,this.load(e,this._$width).then((e=>{if(this._$stopFlag)return;const t=e[0],r=e[1],a=d.$getCanvas();a.width=this._$width*window.devicePixelRatio,a.height=this._$height*window.devicePixelRatio;const s=a.getContext("2d"),i=a.width/t.length,n=a.height/2;s.fillStyle="#1355a5";for(let e=0;e<t.length;++e){const a=t[e]*n;s.fillRect(e*i,n-a,i,a);const o=r[e]*n;s.fillRect(e*i,n,i,o)}a.setAttribute("style",`margin-bottom: 10px; width: ${this._$width}px; height: ${this._$height}px`),document.getElementById("library-preview-area").prepend(a)}))}load(e,t){return d.$audioContext.decodeAudioData(e.buffer).then((e=>{const r=e.getChannelData(0),a=this.getPeaks(r,t*window.devicePixelRatio),s=e.getChannelData(1);return[a,this.getPeaks(s,t*window.devicePixelRatio)]}))}getPeaks(e,t){let r;r=Math.floor(e.length/t*window.devicePixelRatio),r<1&&(r=1);let a=[];for(let t=0;t<e.length;t+=r){const s=this.getPeak(e,t,t+r);a.push(s)}return a}getPeak(e,t,r){const a=e.slice(t,r);let s=-100;for(let e=0;e<a.length;e++){const t=a[e];t>s&&(s=t)}return s}};class Ae extends he{constructor(){super("stage"),this._$stageLock=!1}static get MIN_FPS(){return 1}static get MAX_FPS(){return 60}static get MIN_STAGE_SIZE(){return 1}static get MAX_STAGE_SIZE(){return 3e3}static get MIN_STROKE_SIZE(){return 0}static get MAX_STROKE_SIZE(){return 200}initialize(){super.initialize();const e=document.getElementById("stage-lock");e&&e.addEventListener("mousedown",(e=>{this.stageLock(e)}));const t=["stage-width","stage-height","stage-fps"];for(let e=0;e<t.length;++e)this.setInputEvent(document.getElementById(t[e]));this.setChangeEvent(document.getElementById("stage-bgColor"))}focusIn(e){super.focusIn(e),this.setLockElement(e)}mouseDown(e){super.mouseDown(e),this.setLockElement(e)}setLockElement(e){if(!this._$focus)if(this._$stageLock)switch(e.target.id){case"stage-width":this._$lockTarget=document.getElementById("stage-height");break;case"stage-height":this._$lockTarget=document.getElementById("stage-width");break;default:this._$lockTarget=null}else this._$lockTarget=null}stageLock(e){const t=document.getElementById("stage-lock");t&&(e.stopPropagation(),this._$stageLock=!this._$stageLock,this._$currentValue=null,this._$stageLock||(this._$lockTarget=null),t.childNodes[1].setAttribute("class",this._$stageLock?"active":"disable"))}changeStageBgColor(e){document.getElementById("stage").style.backgroundColor=e,document.getElementById("library-preview-area").style.backgroundColor=e;d.$currentWorkSpace().stage.bgColor=e}changeStageWidth(e){e=d.$clamp(0|e,Ae.MIN_STAGE_SIZE,Ae.MAX_STAGE_SIZE);const t=document.getElementById("stage-area"),r=document.getElementById("stage"),a=d.$currentWorkSpace();return t.style.width=`${e*d.$zoomScale+window.screen.width}px`,r.style.width=e*d.$zoomScale+"px",a.stage.width=e,d.$offsetLeft=r.offsetLeft,d.$offsetTop=r.offsetTop,e}changeStageHeight(e){e=d.$clamp(0|e,Ae.MIN_STAGE_SIZE,Ae.MAX_STAGE_SIZE);const t=document.getElementById("stage-area"),r=document.getElementById("stage"),a=d.$currentWorkSpace();return t.style.height=`${e*d.$zoomScale+window.screen.height}px`,r.style.height=e*d.$zoomScale+"px",a.stage.height=e,d.$offsetLeft=r.offsetLeft,d.$offsetTop=r.offsetTop,e}changeStageFps(e){e=d.$clamp(0|e,Ae.MIN_FPS,Ae.MAX_FPS),d.$timelineHeader.rebuild();return d.$currentWorkSpace().stage.fps=e,e}}d.$stageController=new Ae;d.$tabController=new class{constructor(){this._$active=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("controller-tab-area");if(e){const t=e.children;for(let e=0;e<t.length;++e){const r=t[e];this._$active||(r.classList.add("active"),this._$active=r),r.addEventListener("click",(e=>{this.mouseDown(e)}))}}const t=document.getElementById("controller-area");if(t){const e=t.children;for(let t=0;t<e.length;++t){const r=e[t];t&&(r.style.display="none")}}d.$initializeEnd()}mouseDown(e){e.stopPropagation(),d.$endMenu(),this._$active.classList.remove("active"),this._$active.classList.add("disable"),e.target.classList.remove("disable"),e.target.classList.add("active"),this._$active=e.target;const t=document.getElementById("controller-area").children;for(let r=0;r<t.length;++r){const a=t[r];a.id===e.target.dataset.tabType?a.style.display="":a.style.display="none"}"controller-area-property"===e.target.dataset.tabType&&this.showController()}showController(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(1!==e.length)return;const t=d.$currentWorkSpace().scene,r=e[0];t.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId).showController()}};class Te extends he{constructor(){super("text")}static get MIN_SIZE(){return 0}static get MAX_SIZE(){return 255}static get MIN_FONT_SIZE(){return 10}static get MAX_FONT_SIZE(){return 255}static get MIN_STROKE_SIZE(){return 0}static get MAX_STROKE_SIZE(){return 200}initialize(){super.initialize();const e=["font-select","font-style-select","font-align-select","font-wrap-select","font-input-select","font-scroll-select","font-border-select","font-auto-size-select","font-color","font-stroke-color"];for(let t=0;t<e.length;++t)this.setChangeEvent(document.getElementById(e[t]));const t=["font-size","font-stroke-size","font-leading","font-letterSpacing","font-leftMargin","font-rightMargin"];for(let e=0;e<t.length;++e)this.setInputEvent(document.getElementById(t[e]))}changeFontLeading(e){return e=d.$clamp(0|e,Te.MIN_SIZE,Te.MAX_SIZE),this.updateText({name:"leading",value:e}),e}changeFontLetterSpacing(e){return e=d.$clamp(0|e,-Te.MAX_SIZE,Te.MAX_SIZE),this.updateText({name:"letterSpacing",value:e}),e}changeFontLeftMargin(e){return e=d.$clamp(0|e,Te.MIN_SIZE,Te.MAX_SIZE),this.updateText({name:"leftMargin",value:e}),e}changeFontRightMargin(e){return e=d.$clamp(0|e,Te.MIN_SIZE,Te.MAX_SIZE),this.updateText({name:"rightMargin",value:e}),e}changeFontStrokeSize(e){return e=d.$clamp(0|e,Te.MIN_STROKE_SIZE,Te.MAX_STROKE_SIZE),this.updateText({name:"thickness",value:e}),e}changeFontSize(e){return e=d.$clamp(0|e,Te.MIN_FONT_SIZE,Te.MAX_FONT_SIZE),this.updateText({name:"size",value:e}),e}changeFontStrokeColor(e){this.updateText({name:"thicknessColor",value:0|`0x${e.slice(1)}`})}changeFontColor(e){this.updateText({name:"color",value:0|`0x${e.slice(1)}`})}changeFontSelect(e){this.updateText({name:"font",value:e})}changeFontStyleSelect(e){e|=0,this.updateText({name:"fontType",value:d.$clamp(e,0,3)})}changeFontAlignSelect(e){switch(e){case"left":case"center":case"right":this.updateText({name:"align",value:e})}}changeFontWrapSelect(e){switch(0|e){case 0:this.updateText({name:"wordWrap",value:!1}),this.updateText({name:"multiline",value:!1});break;case 1:this.updateText({name:"wordWrap",value:!1}),this.updateText({name:"multiline",value:!0});break;case 2:this.updateText({name:"wordWrap",value:!0}),this.updateText({name:"multiline",value:!0})}}changeFontInputSelect(e){e|=0,this.updateText({name:"inputType",value:e?"input":"static"})}changeFontScrollSelect(e){this.updateText({name:"scroll",value:!!(0|e)})}changeFontBorderSelect(e){this.updateText({name:"border",value:!!(0|e)})}changeFontAutoSizeSelect(e){e|=0,this.updateText({name:"autoSize",value:d.$clamp(e,0,2)})}updateText(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const r=d.$currentWorkSpace(),a=r.scene,s=t[0],i=a.getLayer(0|s.dataset.layerId).getCharacter(0|s.dataset.characterId);r.getLibrary(i.libraryId)[e.name]=e.value,i.dispose()}}d.$textController=new Te;class Be extends he{constructor(){super("transform"),this._$state="hide",this._$sizeLock=!1,this._$scaleLock=!1,this._$screenTargets=["target-rect","scale-top-left","scale-top-right","scale-bottom-left","scale-bottom-right","scale-center-left","scale-center-top","scale-center-right","scale-center-bottom","target-rotation","reference-point"]}static get MIN_SIZE(){return 1}static get MAX_SIZE(){return 3e3}static get MIN_SCALE(){return-32768}static get MAX_SCALE(){return 32767}static get MIN_ROTATE(){return-360}static get MAX_ROTATE(){return 360}initialize(){super.initialize();for(let e=0;e<this._$screenTargets.length;++e){const t=document.getElementById(this._$screenTargets[e]);t&&(t.style.display="none",t.addEventListener("mousedown",(e=>{this.standbyPointer(e)})))}const e=document.getElementById("transform-size-lock");e&&e.addEventListener("mousedown",(e=>{this.sizeLock(e)}));const t=document.getElementById("transform-scale-lock");t&&t.addEventListener("mousedown",(e=>{this.scaleLock(e)}));const r=["object-width","object-height","object-x","object-y","transform-scale-x","transform-scale-y","transform-rotate"];for(let e=0;e<r.length;++e)this.setInputEvent(document.getElementById(r[e]))}changeObjectWidth(e){return e=d.$clamp(+e,Be.MIN_SIZE,Be.MAX_SIZE),this.updateWidth(e),e}changeObjectHeight(e){return e=d.$clamp(+e,Be.MIN_SIZE,Be.MAX_SIZE),this.updateHeight(e),e}changeObjectX(e){return e=d.$clamp(+e,Be.MIN_SCALE,Be.MAX_SCALE),this.updateX(e-this._$currentValue),e}changeObjectY(e){return e=d.$clamp(+e,Be.MIN_SCALE,Be.MAX_SCALE),this.updateY(e-this._$currentValue),e}changeTransformScaleX(e){return e=d.$clamp(+e,Be.MIN_SCALE,Be.MAX_SCALE),this.updateScaleX(e/100),e}changeTransformScaleY(e){return e=d.$clamp(+e,Be.MIN_SCALE,Be.MAX_SCALE),this.updateScaleY(e/100),e}changeTransformRotate(e){return e=d.$clamp((0|e)%360,Be.MIN_ROTATE,Be.MAX_ROTATE),this.updateRotate(e),e}focusIn(e){super.focusIn(e),this.setLockElement(e)}mouseDown(e){super.mouseDown(e),this.setLockElement(e)}setLockElement(e){if(!this._$focus)switch(e.target.id){case"object-width":this._$sizeLock&&(this._$lockTarget=document.getElementById("object-height"));break;case"object-height":this._$sizeLock&&(this._$lockTarget=document.getElementById("object-width"));break;case"transform-scale-x":this._$scaleLock&&(this._$lockTarget=document.getElementById("transform-scale-y"));break;case"transform-scale-y":this._$scaleLock&&(this._$lockTarget=document.getElementById("transform-scale-x"))}}scaleLock(e){e.stopPropagation(),this._$scaleLock=!this._$scaleLock,this._$currentValue=null,this._$scaleLock||(this._$lockTarget=null),e.currentTarget.childNodes[1].setAttribute("class",this._$scaleLock?"active":"disable")}sizeLock(e){e.stopPropagation(),this._$sizeLock=!this._$sizeLock,this._$currentValue=null,this._$sizeLock||(this._$lockTarget=null),e.currentTarget.childNodes[1].setAttribute("class",this._$sizeLock?"active":"disable")}standbyPointer(e){e.stopPropagation();const t=d.$tools.activeTool;t&&(e.transform=!0,t.dispatchEvent(j.MOUSE_DOWN,e))}show(){const e=d.$tools.getDefaultTool("arrow-transform");if("show"!==this._$state){this._$state="show";for(let t=0;t<this._$screenTargets.length;++t){const r=this._$screenTargets[t];if(!e.active&&"target-rect"!==r)continue;const a=document.getElementById(r);a&&(a.style.display="")}}return this}hide(){if("hide"===this._$state)return;for(let e=0;e<this._$screenTargets.length;++e){const t=document.getElementById(this._$screenTargets[e]);t&&t.setAttribute("style","display:none;")}const e=document.getElementById("standard-point");e&&e.setAttribute("style","display:none;"),this._$state="hide"}relocation(){if("hide"===this._$state)return;const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return this.hide();const t=d.$currentWorkSpace(),r=t.scene,a=d.$timelineFrame.currentFrame,s=d.$sceneChange.concatenatedMatrix;let i=0,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,l=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let t=0;t<e.length;++t){const a=e[t],h=r.getLayer(0|a.dataset.layerId);if(!h||h.lock||h.disable){i++;continue}const u=0|a.dataset.characterId;if(!document.getElementById(`character-${u}`))continue;const m=h.getCharacter(u).getBounds(s),g=d.$offsetLeft+(d.$sceneChange.offsetX+m.xMin)*d.$zoomScale,$=d.$offsetTop+(d.$sceneChange.offsetY+m.yMin)*d.$zoomScale;n=Math.min(n,g),o=Math.max(o,g+Math.ceil(Math.abs(m.xMax-m.xMin)*d.$zoomScale)),l=Math.min(l,$),c=Math.max(c,$+Math.ceil(Math.abs(m.yMax-m.yMin)*d.$zoomScale))}if(e.length-i==0)return this.hide();const h=document.getElementById("standard-point"),u=o-n,m=c-l;let g=null;if(1===e.length){const s=e[0],i=r.getLayer(0|s.dataset.layerId).getCharacter(0|s.dataset.characterId),n=i.getRange(a),o=i.getPlace(n.startFrame);if(!o.point){const e=i.getBounds(o.matrix),t=e.xMin,r=e.yMin,a=Math.ceil(Math.abs(e.xMax-e.xMin))/2,s=Math.ceil(Math.abs(e.yMax-e.yMin))/2;o.point={x:t+a,y:r+s}}g=o.point,d.$referenceController.setInputValue(g.x,g.y);if(!document.getElementById(`character-${i.id}`))return this.hide();if(t.getLibrary(i.libraryId).type===b.MOVIE_CLIP){h.setAttribute("style","");const e=h.clientWidth/2,t=h.clientHeight/2,r=d.$sceneChange.concatenatedMatrix,a=i.x,s=i.y,n=a*r[0]+s*r[2]+r[4],o=a*r[1]+s*r[3]+r[5],l=d.$offsetLeft+n*d.$zoomScale-e,c=d.$offsetTop+o*d.$zoomScale-t;h.setAttribute("style",`left: ${l}px; top: ${c}px;`)}else h.setAttribute("style","display: none;")}else d.$referenceController.pointer||(d.$referenceController.pointer={x:n+u/2,y:l+m/2}),g=d.$referenceController.pointer,h.setAttribute("style","display: none;");document.getElementById("target-rect").setAttribute("style",`width: ${u}px; height: ${m}px; left: ${n-1}px; top: ${l-1}px;`);if(d.$tools.getDefaultTool("arrow-transform").validity){if(g){const e=d.$offsetLeft+(d.$sceneChange.offsetX+g.x)*d.$zoomScale,t=d.$offsetTop+(d.$sceneChange.offsetY+g.y)*d.$zoomScale,r=document.getElementById("reference-point");r.setAttribute("style","");const a=e-r.offsetWidth/2,s=t-r.offsetHeight/2;r.setAttribute("style",`left: ${a}px; top: ${s}px;`)}document.getElementById("scale-top-left").setAttribute("style",`left: ${n-6}px; top: ${l-6}px;`),document.getElementById("scale-top-right").setAttribute("style",`left: ${o-5}px; top: ${l-6}px;`),document.getElementById("scale-bottom-left").setAttribute("style",`left: ${n-6}px; top: ${c-5}px;`),document.getElementById("scale-bottom-right").setAttribute("style",`left: ${o-5}px; top: ${c-5}px;`),document.getElementById("target-rotation").setAttribute("style",`left: ${o+5}px; top: ${c+5}px;`),document.getElementById("scale-center-left").setAttribute("style",`left: ${n-6}px; top: ${l+m/2-5}px;`),document.getElementById("scale-center-top").setAttribute("style",`left: ${n+u/2-5}px; top: ${l-6}px;`),document.getElementById("scale-center-right").setAttribute("style",`left: ${o-5}px; top: ${l+m/2-5}px;`),document.getElementById("scale-center-bottom").setAttribute("style",`left: ${n+u/2-5}px; top: ${c-5}px;`)}}updateX(e){const t=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame,a=d.$tools.getDefaultTool("arrow").activeElements;for(let s=0;s<a.length;++s){const i=a[s],n=0|i.dataset.layerId,o=t.getLayer(n),l=0|i.dataset.characterId,c=o.getCharacter(l);c.x+=e;const d=c.getPlace(r);if(!d.point){const e=c.getBounds();d.point={x:d.matrix[4]+(e.xMax-e.xMin)/2,y:d.matrix[5]+(e.yMax-e.yMin)/2}}d.point.x+=e,c.relocationTween(r)}if(a.length>1){d.$referenceController.pointer.x+=e}this.relocation()}updateY(e){const t=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame,a=d.$tools.getDefaultTool("arrow").activeElements;for(let s=0;s<a.length;++s){const i=a[s],n=0|i.dataset.layerId,o=t.getLayer(n),l=0|i.dataset.characterId,c=o.getCharacter(l);c.y+=e;const d=c.getPlace(r);if(!d.point){const e=c.getBounds();d.point={x:d.matrix[4]+(e.xMax-e.xMin)/2,y:d.matrix[5]+(e.yMax-e.yMin)/2}}d.point.y+=e,c.relocationTween(r)}if(a.length>1){d.$referenceController.pointer.y+=e}this.relocation()}updateWidth(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;e=d.$clamp(e,Be.MIN_SIZE,Be.MAX_SIZE);const r=d.$currentWorkSpace(),a=r.scene;if(t.length>1){let r=Number.MAX_VALUE,s=-Number.MAX_VALUE,i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let e=0;e<t.length;++e){const o=t[e],l=0|o.dataset.layerId,c=a.getLayer(l),d=0|o.dataset.characterId,h=c.getCharacter(d).getBounds();r=Math.min(r,h.xMin),s=Math.max(s,h.xMax),i=Math.min(i,h.yMin),n=Math.max(n,h.yMax)}this.updateScaleX(e/Math.abs(s-r))}else{const s=t[0],i=0|s.dataset.layerId,n=a.getLayer(i),o=0|s.dataset.characterId,l=n.getCharacter(o),c=r.getLibrary(l.libraryId).getBounds([1,0,0,1,0,0]);this.updateScaleX(e/Math.abs(c.xMax-c.xMin)),document.getElementById("transform-scale-x").value=""+100*l.scaleX}}updateScaleX(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const{Matrix:r}=window.next2d.geom;e=d.$toFixed4(d.$clamp(e,Be.MIN_SCALE,Be.MAX_SCALE));const a=d.$currentWorkSpace().scene,s=d.$timelineFrame.currentFrame;let i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MAX_VALUE,l=-Number.MAX_VALUE,c=Number.MAX_VALUE,h=-Number.MAX_VALUE;const u=d.$sceneChange.concatenatedMatrix;if(t.length>1){const i=d.$referenceController.pointer,n=new r(u[0],u[1],u[2],u[3],u[4]-d.$sceneChange.offsetX,u[5]-d.$sceneChange.offsetY);n.invert();const m=i.x*n.a+i.y*n.c+n.tx,g=i.x*n.b+i.y*n.d+n.ty,$=d.$multiplicationMatrix([e,0,0,1,0,0],[1,0,0,1,-m,-g]);for(let e=0;e<t.length;++e){const r=t[e],i=0|r.dataset.layerId,n=a.getLayer(i),u=0|r.dataset.characterId,p=n.getCharacter(u),f=p.getRange(s),y=p.getPlace(f.startFrame).point,_=d.$multiplicationMatrix($,[1,0,0,1,y.x,y.y]);y.x=_[4]+m,y.y=_[5]+g;const b=p.getPlace(s),v=d.$multiplicationMatrix($,b.matrix);b.matrix[0]=v[0],b.matrix[1]=v[1],b.matrix[2]=v[2],b.matrix[3]=v[3],b.matrix[4]=v[4]+m,b.matrix[5]=v[5]+g,b.scaleX=Math.sqrt(v[0]*v[0]+v[1]*v[1]);const I=p.getBounds();o=Math.min(o,I.xMin),l=Math.max(l,I.xMax),c=Math.min(c,I.yMin),h=Math.max(h,I.yMax),p.dispose(),p.relocationTween(s)}document.getElementById("transform-scale-y").value="100",document.getElementById("transform-scale-x").value="100"}else for(let u=0;u<t.length;++u){const m=t[u],g=0|m.dataset.layerId,$=a.getLayer(g).getCharacter(0|m.dataset.characterId);if($.scaleX!==e){const t=$.getPlace(s),a=$.getRange(s),i=$.getPlace(a.startFrame).point,n=new r(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]);n.invert();const o=i.x*n.a+i.y*n.c+n.tx,l=i.x*n.b+i.y*n.d+n.ty,c=[1,0,0,1,-o,-l],h=d.$multiplicationMatrix([t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],o,l],c),u=$.scaleX;u&&e&&(t.matrix[4]-=h[4],t.matrix[5]-=h[5]),$.scaleX=e;const m=d.$multiplicationMatrix([t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],o,l],c);u&&e&&(t.matrix[4]+=m[4],t.matrix[5]+=m[5]),$.dispose()}i=Math.min(i,$.x),n=Math.min(n,$.y);const p=$.getBounds();o=Math.min(o,p.xMin),l=Math.max(l,p.xMax),c=Math.min(c,p.yMin),h=Math.max(h,p.yMax),document.getElementById("transform-scale-x").value=""+ +(100*e).toFixed(2),$.relocationTween(s)}document.getElementById("object-x").value=""+ +i.toFixed(2),document.getElementById("object-y").value=""+ +n.toFixed(2),document.getElementById("object-width").value=""+ +Math.abs(l-o).toFixed(2),document.getElementById("object-height").value=""+ +Math.abs(h-c).toFixed(2)}updateHeight(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;e=d.$clamp(e,Be.MIN_SIZE,Be.MAX_SIZE);const r=d.$currentWorkSpace(),a=r.scene;if(t.length>1){let r=Number.MAX_VALUE,s=-Number.MAX_VALUE,i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let e=0;e<t.length;++e){const o=t[e],l=0|o.dataset.layerId,c=a.getLayer(l),d=0|o.dataset.characterId,h=c.getCharacter(d).getBounds([1,0,0,1,0,0]);r=Math.min(r,h.xMin),s=Math.max(s,h.xMax),i=Math.min(i,h.yMin),n=Math.max(n,h.yMax)}this.updateScaleY(e/Math.abs(n-i))}else{const s=t[0],i=0|s.dataset.layerId,n=a.getLayer(i),o=0|s.dataset.characterId,l=n.getCharacter(o),c=r.getLibrary(l.libraryId).getBounds([1,0,0,1,0,0]);this.updateScaleY(e/Math.abs(c.yMax-c.yMin)),document.getElementById("transform-scale-y").value=""+100*l.scaleY}}updateScaleY(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const{Matrix:r}=window.next2d.geom;e=d.$toFixed4(d.$clamp(e,Be.MIN_SCALE,Be.MAX_SCALE));const a=d.$currentWorkSpace().scene,s=d.$timelineFrame.currentFrame;let i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MAX_VALUE,l=-Number.MAX_VALUE,c=Number.MAX_VALUE,h=-Number.MAX_VALUE;const u=d.$sceneChange.concatenatedMatrix;if(t.length>1){const i=d.$referenceController.pointer,n=new r(u[0],u[1],u[2],u[3],u[4]-d.$sceneChange.offsetX,u[5]-d.$sceneChange.offsetY);n.invert();const m=i.x*n.a+i.y*n.c+n.tx,g=i.x*n.b+i.y*n.d+n.ty,$=d.$multiplicationMatrix([1,0,0,e,0,0],[1,0,0,1,-m,-g]);for(let e=0;e<t.length;++e){const r=t[e],i=0|r.dataset.layerId,n=a.getLayer(i),u=0|r.dataset.characterId,p=n.getCharacter(u),f=p.getRange(s),y=p.getPlace(f.startFrame).point,_=d.$multiplicationMatrix($,[1,0,0,1,y.x,y.y]);y.x=_[4]+m,y.y=_[5]+g;const b=p.getPlace(s),v=d.$multiplicationMatrix($,b.matrix);b.matrix[0]=v[0],b.matrix[1]=v[1],b.matrix[2]=v[2],b.matrix[3]=v[3],b.matrix[4]=v[4]+m,b.matrix[5]=v[5]+g,b.scaleY=Math.sqrt(v[2]*v[2]+v[3]*v[3]);const I=p.getBounds();o=Math.min(o,I.xMin),l=Math.max(l,I.xMax),c=Math.min(c,I.yMin),h=Math.max(h,I.yMax),p.dispose(),p.relocationTween(s)}document.getElementById("transform-scale-y").value="100",document.getElementById("transform-scale-x").value="100"}else for(let u=0;u<t.length;++u){const m=t[u],g=0|m.dataset.layerId,$=a.getLayer(g).getCharacter(0|m.dataset.characterId);if($.scaleY!==e){const t=$.getPlace(s),a=$.getRange(s),i=$.getPlace(a.startFrame).point,n=new r(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]);n.invert();const o=i.x*n.a+i.y*n.c+n.tx,l=i.x*n.b+i.y*n.d+n.ty,c=[1,0,0,1,-o,-l],h=d.$multiplicationMatrix([t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],o,l],c),u=$.scaleY;u&&e&&(t.matrix[4]-=h[4],t.matrix[5]-=h[5]),$.scaleY=e;const m=d.$multiplicationMatrix([t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],o,l],c);u&&e&&(t.matrix[4]+=m[4],t.matrix[5]+=m[5]),$.dispose()}i=Math.min(i,$.x),n=Math.min(n,$.y);const p=$.getBounds();o=Math.min(o,p.xMin),l=Math.max(l,p.xMax),c=Math.min(c,p.yMin),h=Math.max(h,p.yMax),document.getElementById("transform-scale-y").value=""+ +(100*e).toFixed(2),$.relocationTween(s)}document.getElementById("object-x").value=""+ +i.toFixed(2),document.getElementById("object-y").value=""+ +n.toFixed(2),document.getElementById("object-width").value=""+ +Math.abs(l-o).toFixed(2),document.getElementById("object-height").value=""+ +Math.abs(h-c).toFixed(2)}updateRotate(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const{Matrix:r}=window.next2d.geom,a=d.$currentWorkSpace().scene,s=d.$timelineFrame.currentFrame;let i=Number.MAX_VALUE,n=-Number.MAX_VALUE,o=Number.MAX_VALUE,l=-Number.MAX_VALUE;const c=d.$sceneChange.concatenatedMatrix;if(t.length>1){const h=d.$referenceController.pointer,u=new r(c[0],c[1],c[2],c[3],c[4]-d.$sceneChange.offsetX,c[5]-d.$sceneChange.offsetY);u.invert();const m=h.x*u.a+h.y*u.c+u.tx,g=h.x*u.b+h.y*u.d+u.ty,$=e*d.$Deg2Rad,p=d.$multiplicationMatrix([Math.cos($),Math.sin($),-Math.sin($),Math.cos($),0,0],[1,0,0,1,-m,-g]);for(let e=0;e<t.length;++e){const r=t[e],c=0|r.dataset.layerId,h=a.getLayer(c),u=0|r.dataset.characterId,$=h.getCharacter(u),f=$.getRange(s),y=$.getPlace(f.startFrame).point;y.x=m,y.y=g;const _=$.getPlace(s),b=d.$multiplicationMatrix(p,_.matrix);_.matrix[0]=b[0],_.matrix[1]=b[1],_.matrix[2]=b[2],_.matrix[3]=b[3],_.matrix[4]=b[4]+m,_.matrix[5]=b[5]+g,_.rotation=Math.atan2(b[1],b[0])*d.$Rad2Deg;const v=$.getBounds();i=Math.min(i,v.xMin),n=Math.max(n,v.xMax),o=Math.min(o,v.yMin),l=Math.max(l,v.yMax),$.dispose(),$.relocationTween(s)}document.getElementById("transform-scale-y").value="100",document.getElementById("transform-scale-x").value="100"}else for(let c=0;c<t.length;++c){const h=t[c],u=0|h.dataset.layerId,m=a.getLayer(u).getCharacter(0|h.dataset.characterId);if(m.rotation===e)return;const g=m.getPlace(s),$=new r(g.matrix[0],g.matrix[1],g.matrix[2],g.matrix[3],g.matrix[4],g.matrix[5]);$.invert();const p=m.getRange(s),f=m.getPlace(p.startFrame).point,y=f.x*$.a+f.y*$.c+$.tx,_=f.x*$.b+f.y*$.d+$.ty,b=[1,0,0,1,-y,-_],v=d.$multiplicationMatrix([g.matrix[0],g.matrix[1],g.matrix[2],g.matrix[3],y,_],b);g.matrix[4]-=v[4],g.matrix[5]-=v[5],m.rotation=e;const I=d.$multiplicationMatrix([g.matrix[0],g.matrix[1],g.matrix[2],g.matrix[3],y,_],b);g.matrix[4]+=I[4],g.matrix[5]+=I[5],m.dispose(),document.getElementById("transform-rotate").value=`${g.rotation}`,document.getElementById("transform-scale-x").value=""+100*g.scaleX,document.getElementById("transform-scale-y").value=""+100*g.scaleY;const E=m.getBounds();i=Math.min(i,E.xMin),n=Math.max(n,E.xMax),o=Math.min(o,E.yMin),l=Math.max(l,E.yMax),m.relocationTween(s)}document.getElementById("object-x").value=""+ +i.toFixed(2),document.getElementById("object-y").value=""+ +o.toFixed(2),document.getElementById("object-width").value=""+ +Math.abs(n-i).toFixed(2),document.getElementById("object-height").value=""+ +Math.abs(l-o).toFixed(2)}}d.$transformController=new Be;class Pe extends he{constructor(){super("ease"),this._$easeTarget=null,this._$viewContext=null,this._$drawContext=null,this._$moveCurvePointer=null,this._$endMoveCurvePointer=null,this._$moveEasingPointer=null,this._$endMoveEasingPointer=null,this._$deleteEasingPointer=null}static get EASE_CANVAS_WIDTH(){return 300}static get EASE_CANVAS_HEIGHT(){return 400}static get EASE_BASE_CANVAS_SIZE(){return 200}static get EASE_MIN_POINTER_X(){return 6}static get EASE_MIN_POINTER_Y(){return-5}static get EASE_MAX_POINTER_X(){return 306}static get EASE_MAX_POINTER_Y(){return 395}static get EASE_SCREEN_X(){return 57}static get EASE_SCREEN_Y(){return 94}static get EASE_MOVE_Y(){return 294}static get EASE_OFFSET_X(){return 50}static get EASE_OFFSET_Y(){return 100}static get EASE_RANGE(){return 100}initialize(){super.initialize();const e=window.devicePixelRatio,t=document.createElement("canvas");t.width=Pe.EASE_CANVAS_WIDTH*e,t.height=Pe.EASE_CANVAS_HEIGHT*e,this._$drawContext=t.getContext("2d");const r=document.getElementById("ease-custom-canvas");r&&(r.width=Pe.EASE_CANVAS_WIDTH*e,r.height=Pe.EASE_CANVAS_HEIGHT*e,r.style.transform=`scale(${1/e}, ${1/e})`,r.style.backfaceVisibility="hidden",this._$viewContext=r.getContext("2d"),r.addEventListener("dblclick",(e=>{this.addEasingPointer(e)})));const a=document.getElementById("ease-canvas-view-area");this._$deleteEasingPointer=this.deleteEasingPointer.bind(this),a&&(a.style.display="none",a.addEventListener("mouseleave",(()=>{window.removeEventListener("keydown",this._$deleteEasingPointer)})));const s=["ease-select","ease-custom-file-input"];for(let e=0;e<s.length;++e){const t=document.getElementById(s[e]);t&&t.addEventListener("change",(e=>{e.stopPropagation(),this.executeFunction(e.target.id,e)}))}const i=["ease-custom-data-export","ease-custom-data-load"];for(let e=0;e<i.length;++e){const t=document.getElementById(i[e]);t&&t.addEventListener("click",(e=>{e.stopPropagation(),this.executeFunction(e.target.id,e)}))}}changeEaseCustomDataLoad(e){e.preventDefault();document.getElementById("ease-custom-file-input").click()}changeEaseCustomDataExport(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=e[0],r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);if(!r)return;const a=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(a.startFrame))return;const s=d.$currentWorkSpace().getLibrary(r.libraryId);if(!s)return;const i=document.createElement("a");i.download=`${s.name}_${a.startFrame}.json`,i.href=URL.createObjectURL(new Blob([JSON.stringify(r.getTween(a.startFrame).custom)],{type:"application/json"})),i.click()}changeEaseCustomFileInput(e){e.target.files[0].text().then((e=>{const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const s=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(s.startFrame))return;a.getTween(s.startFrame).custom=JSON.parse(e),this._$easeTarget=null,this.clearEasingPointer(),this.createEasingPointer(),this.drawEasingGraph(),this.relocationPlace(a,s.startFrame),this.clearPointer().relocationPointer()})),e.target.value=""}addEasingPointer(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const s=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(s.startFrame))return;const i=document.getElementById("ease-cubic-pointer-area"),n=i.children,o=a.getTween(s.startFrame),l=["curve","pointer","curve"],c=[-20,0,20],h=Pe.EASE_BASE_CANVAS_SIZE/Pe.EASE_RANGE,u=(e.layerX-Pe.EASE_BASE_CANVAS_SIZE)/h,m=(Pe.EASE_BASE_CANVAS_SIZE-(e.layerY-300))/h;for(let e=0;e<l.length;++e){const t=l[e],r=u+c[e],a=m+c[e],s=this.createEasingPointerDiv(r,a,t);i.insertBefore(s,n[n.length-1]),o.custom.splice(-2,0,{type:t,x:r,y:a})}for(let e=0;e<n.length;++e){n[e].dataset.index=`${e+1}`}this._$easeTarget=null,this.drawEasingGraph(),this.relocationPlace(a,s.startFrame),this.clearPointer().relocationPointer()}changeEaseSelect(){const e=d.$timelineLayer.targetLayer;if(!e)return;const t=document.getElementById("ease-select");"custom"===t.value?this.showCustomArea():this.hideCustomArea();const r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),a=d.$timelineFrame.currentFrame,s=r.getActiveCharacter(a);if(!s.length&&s.length>1)return;const i=s[0],n=i.getRange(a);i.hasTween(n.startFrame)&&(i.getTween(n.startFrame).method=t.value,i.relocationTween(n.startFrame))}relocationPlace(e,t,r="none"){const a=e.getRange(t);if("none"===r&&a.startFrame-1>=e.startFrame){const t=e.getRange(a.startFrame-1);e.hasTween(t.startFrame)&&this.relocationPlace(e,t.startFrame,"prev")}e.updateTweenPlace(a.startFrame,a.endFrame);const s=d.$currentWorkSpace().getLibrary(e.libraryId);if(!s)return;const i=s.getBounds(),n=e.getPlace(a.startFrame),o=n.matrix,l="scaleX"in n?n.scaleX:Math.sqrt(o[0]*o[0]+o[1]*o[1]),c="scaleY"in n?n.scaleY:Math.sqrt(o[2]*o[2]+o[3]*o[3]);let h="rotation"in n?n.rotation:Math.atan2(o[1],o[0])*d.$Rad2Deg;const u=o[4],m=o[5],g=document.getElementById(`tween-marker-${e.id}-${a.startFrame}`);if(g){const e=d.$boundsMatrix(i,o),t=Math.abs(Math.ceil(e.xMax-e.xMin)/2*d.$zoomScale),r=Math.abs(Math.ceil(e.yMax-e.yMin)/2*d.$zoomScale);g.style.left=d.$offsetLeft+e.xMin*d.$zoomScale+t-2+"px",g.style.top=d.$offsetTop+e.yMin*d.$zoomScale+r-2+"px"}let $=a.endFrame-1,p=e.getPlace($);e.hasTween(a.endFrame)&&($=a.endFrame,p=e.getPlace(a.endFrame));const f=p.matrix,y="scaleX"in p?p.scaleX:Math.sqrt(f[0]*f[0]+f[1]*f[1]),_="scaleY"in p?p.scaleY:Math.sqrt(f[2]*f[2]+f[3]*f[3]);let b="rotation"in p?p.rotation:Math.atan2(f[1],f[0])*d.$Rad2Deg,v=f[4],I=f[5];const E=document.getElementById(`tween-marker-${e.id}-${$}`);if(E){const e=d.$boundsMatrix(i,f),t=Math.abs(Math.ceil(e.xMax-e.xMin)/2*d.$zoomScale),r=Math.abs(Math.ceil(e.yMax-e.yMin)/2*d.$zoomScale);E.style.left=d.$offsetLeft+e.xMin*d.$zoomScale+t-2+"px",E.style.top=d.$offsetTop+e.yMin*d.$zoomScale+r-2+"px"}const S=e.getTween(a.startFrame),w=S.method,x=$-a.startFrame;let L=v-u,M=I-m;const C=y-l,F=_-c,k=b-h,{Matrix:A}=window.next2d.geom,T=new A(o[0],o[1],o[2],o[3],o[4],o[5]);T.invert();const B=e.getPlace(a.startFrame).point,P=B.x*T.a+B.y*T.c+T.tx,O=B.x*T.b+B.y*T.d+T.ty,U=[1,0,0,1,-P,-O],D=d.$multiplicationMatrix([o[0],o[1],o[2],o[3],P,O],U),R=d.$multiplicationMatrix([f[0],f[1],f[2],f[3],P,O],U);k&&(L=v-R[4]-(u-D[4]),M=I-R[5]-(m-D[5]));const N=n.colorTransform,X=p.colorTransform,Y=X[0]-N[0],z=X[1]-N[1],W=X[2]-N[2],j=X[3]-N[3],H=X[4]-N[4],G=X[5]-N[5],V=X[6]-N[6],K=X[7]-N[7],{Easing:Z}=window.next2d.ui;let q=1;for(let t=a.startFrame+1;t<$;++t){const r=e.getPlace(t),a=q/x;let s=0;if("custom"===w)for(let e=0;e<S.custom.length;e+=3){const t=S.custom[e+1];let r=S.custom[e+3];if(r.off)for(e+=3;r=S.custom[e+3],!r.fixed&&r.off;)e+=3;if(r.x/Pe.EASE_RANGE>a){const r=S.custom[e+2];s=this.cubicBezier(t.x/Pe.EASE_RANGE,t.y/Pe.EASE_RANGE,r.x/Pe.EASE_RANGE,r.y/Pe.EASE_RANGE)(a);break}}const n=r.matrix,o=C?"custom"===w?C*s+l:Z[w](q,l,C,x):l,g=F?"custom"===w?F*s+c:Z[w](q,c,F,x):c,$=k?"custom"===w?k*s+h:Z[w](q,h,k,x)%360:h;let p=Math.atan2(n[1],n[0]),f=Math.atan2(-n[2],n[3]);const y=$*d.$Deg2Rad;if(f=f+y-p,p=y,n[0]=o*Math.cos(p),n[1]=o*Math.sin(p),n[2]=-g*Math.sin(f),n[3]=g*Math.cos(f),C&&(r.scaleX=Math.sqrt(n[0]*n[0]+n[1]*n[1])),F&&(r.scaleY=Math.sqrt(n[2]*n[2]+n[3]*n[3])),n[4]=L?"custom"===w?s*L+u:Z[w](q,u,L,x):u,n[5]=M?"custom"===w?s*M+m:Z[w](q,m,M,x):m,k){r.rotation=Math.atan2(n[1],n[0])*d.$Rad2Deg;const e=d.$multiplicationMatrix([Math.cos(y),Math.sin(y),-Math.sin(y),Math.cos(y),P,O],U);n[4]+=-D[4]+e[4],n[5]+=-D[5]+e[5]}if(S.curve.length){const e=Math.sqrt(Math.pow(L,2)+Math.pow(M,2)),t=Math.sqrt(Math.pow(n[4]-u,2)+Math.pow(n[5]-m,2));if(t&&e){const r=this.getCurvePoint(t/e,u,m,v,I,S.curve);r&&(n[4]=r.x,n[5]=r.y)}}const _=r.colorTransform;_[0]=Y?d.$clamp("custom"===w?Y*s+N[0]:Z[w](q,N[0],Y,x),Ee.MIN_MULTIPLIER,Ee.MAX_MULTIPLIER):N[0],_[1]=z?d.$clamp("custom"===w?z*s+N[1]:Z[w](q,N[1],z,x),Ee.MIN_MULTIPLIER,Ee.MAX_MULTIPLIER):N[1],_[2]=W?d.$clamp("custom"===w?W*s+N[2]:Z[w](q,N[2],W,x),Ee.MIN_MULTIPLIER,Ee.MAX_MULTIPLIER):N[2],_[3]=j?d.$clamp("custom"===w?j*s+N[3]:Z[w](q,N[3],j,x),Ee.MIN_MULTIPLIER,Ee.MAX_MULTIPLIER):N[3],_[4]=H?d.$clamp("custom"===w?H*s+N[4]:Z[w](q,N[4],H,x),Ee.MIN_OFFSET,Ee.MAX_OFFSET):N[4],_[5]=G?d.$clamp("custom"===w?G*s+N[5]:Z[w](q,N[5],G,x),Ee.MIN_OFFSET,Ee.MAX_OFFSET):N[5],_[6]=V?d.$clamp("custom"===w?V*s+N[6]:Z[w](q,N[6],V,x),Ee.MIN_OFFSET,Ee.MAX_OFFSET):N[6],_[7]=K?d.$clamp("custom"===w?K*s+N[7]:Z[w](q,N[7],K,x),Ee.MIN_OFFSET,Ee.MAX_OFFSET):N[7];const b=document.getElementById(`tween-marker-${e.id}-${t}`);if(b){const e=d.$boundsMatrix(i,n),t=Math.abs(Math.ceil(e.xMax-e.xMin)/2*d.$zoomScale),r=Math.abs(Math.ceil(e.yMax-e.yMin)/2*d.$zoomScale);b.style.left=d.$offsetLeft+e.xMin*d.$zoomScale+t-2+"px",b.style.top=d.$offsetTop+e.yMin*d.$zoomScale+r-2+"px"}q++}const J=n.filter,Q=p.filter;if(J.length&&Q.length){const t=["blurX","blurY","quality","color","alpha","distance","angle","highlightColor","highlightAlpha","shadowColor","shadowAlpha","strength"],r=J.length;for(let s=0;s<r;++s){const r=J[s],i=Q[s];if(r.name!==i.name)continue;let n=1;for(let o=a.startFrame+1;a.endFrame>o;++o){const a=e.getPlace(o).filter;a[s]||(a[s]=new d.$filterClasses[r.name]);const l=a[s];for(let e=0;e<t.length;++e){const a=t[e];if(a in l){const e=i[a]-r[a];if(!e)continue;l[a]="custom"===w?e*customValue+r[a]:Z[w](n,r[a],e,x)}}n++}}}}relocationPointer(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;const t=d.$currentWorkSpace();if(!t)return;const r=d.$sceneChange.concatenatedMatrix,a=d.$timelineFrame.currentFrame,s=t.scene;for(let t=0;t<e.length;++t){const i=e[t],n=s.getLayer(0|i.dataset.layerId);if(!n)continue;const o=n.getCharacter(0|i.dataset.characterId);if(!o)continue;const l=o.getRange(a);if(!o.hasTween(l.startFrame))continue;let c=l.startFrame;for(;o.startFrame!==c&&c>1;){const e=o.getRange(c-1);if(!o.hasTween(e.startFrame))break;c=e.startFrame}let h=l.endFrame;for(;o.hasTween(h);)h=o.getTween(h).endFrame;const u=d.$currentWorkSpace().getLibrary(o.libraryId);if(!u)continue;const m=u.getBounds(),g=document.getElementById("stage-area");for(let e=c;e<h;++e){const t=document.createElement("div"),a=o.getPlace(e).matrix,s=d.$multiplicationMatrix(r,a),i=d.$boundsMatrix(m,s),n=Math.abs(Math.ceil(i.xMax-i.xMin)/2*d.$zoomScale),l=Math.abs(Math.ceil(i.yMax-i.yMin)/2*d.$zoomScale),c=d.$offsetLeft+i.xMin*d.$zoomScale+n-2,h=d.$offsetTop+i.yMin*d.$zoomScale+l-2;t.id=`tween-marker-${o.id}-${e}`,t.dataset.child="tween",t.setAttribute("style",`left: ${c}px; top: ${h}px`),t.setAttribute("class","tween-marker"),g.appendChild(t)}const $=o.getTween(l.startFrame);for(let e=0;e<$.curve.length;++e){const t=$.curve[e];g.appendChild(this.createTweenCurveElement(t,e,n.id))}}}clearPointer(){const e=document.getElementById("stage-area");if(!e)return this;let t=0;for(;e.children.length>t;){const r=e.children[t];"tween"===r.dataset.child?r.remove():t++}return this}startMoveCurvePointer(e){e.button||(d.$endMenu(),e.stopPropagation(),this._$currentTarget=e.target,this._$pointX=e.pageX,this._$pointY=e.pageY,this._$moveCurvePointer||(this._$moveCurvePointer=this.moveCurvePointer.bind(this)),this._$endMoveCurvePointer||(this._$endMoveCurvePointer=this.endMoveCurvePointer.bind(this)),this.save(),window.addEventListener("mousemove",this._$moveCurvePointer),window.addEventListener("mouseup",this._$endMoveCurvePointer))}deleteCurvePointer(){const e=this._$currentTarget;if(!e)return;const t=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),r=d.$timelineFrame.currentFrame,a=t.getActiveCharacter(r);if(!a.length||a.length>1)return;const s=a[0],i=s.getRange(r);s.getTween(i.startFrame).curve.splice(0|e.dataset.index,1),e.remove(),this.relocationPlace(s,i.startFrame),this.clearPointer().relocationPointer(),this.save(),this._$saved=!1,this._$currentTarget=null}moveCurvePointer(e){e.preventDefault(),window.requestAnimationFrame((()=>{const t=this._$currentTarget;if(!t)return;const r=(e.pageX-this._$pointX)/d.$zoomScale,a=(e.pageY-this._$pointY)/d.$zoomScale,s=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId),i=d.$timelineFrame.currentFrame,n=s.getActiveCharacter(i);if(!n.length&&n.length>1)return;const o=n[0],l=o.getRange(i);if(!o.hasTween(l.startFrame))return;const c=o.getTween(l.startFrame).curve[t.dataset.index],h=d.$sceneChange.concatenatedMatrix,{Matrix:u}=next2d.geom,m=new u(h[0],h[1],h[2],h[3],h[4],h[5]);m.invert();const g=r*m.a+a*m.c,$=r*m.b+a*m.d;c.x+=g,c.y+=$,this.relocationPlace(o,l.startFrame),this.clearPointer().relocationPointer(),this.reloadScreen(),this._$pointX=e.pageX,this._$pointY=e.pageY}))}endMoveCurvePointer(){window.removeEventListener("mousemove",this._$moveCurvePointer),window.removeEventListener("mouseup",this._$endMoveCurvePointer),this._$saved=!1}switchingCurvePointer(e){const t=e.target,r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId),a=d.$timelineFrame.currentFrame,s=r.getActiveCharacter(a);if(!s.length&&s.length>1)return;const i=s[0],n=i.getRange(a);if(!i.hasTween(n.startFrame))return;const o=i.getTween(n.startFrame).curve[t.dataset.index];o.usePoint=!o.usePoint,o.usePoint?(t.classList.remove("tween-pointer-disabled"),t.classList.add("tween-pointer-active")):(t.classList.add("tween-pointer-disabled"),t.classList.remove("tween-pointer-active")),this.relocationPlace(i,n.startFrame),this.clearPointer().relocationPointer(),this.reloadScreen()}createTweenCurveElement(e,t,r){const a=document.createElement("div");a.classList.add("tween-pointer-marker","tween-pointer-disabled");const s=d.$timelineFrame.currentFrame;a.textContent=`${t+1}`,a.dataset.child="tween",a.dataset.curve="true",a.dataset.layerId=`${r}`,a.dataset.index=`${t}`,a.dataset.detail="{{カーブポインター(ダブルクリックでON/OFF)}}";const i=d.$currentWorkSpace().scene.getLayer(r).getActiveCharacter(s);if(!i.length||i.length>1)return null;const n=i[0],o=d.$currentWorkSpace().getLibrary(n.libraryId).getBounds(),l=d.$sceneChange.concatenatedMatrix,c=e.x*l[0]+e.y*l[2]+l[4],h=e.x*l[1]+e.y*l[3]+l[5],u=Math.abs(Math.ceil(o.xMax-o.xMin)/2*d.$zoomScale),m=Math.abs(Math.ceil(o.yMax-o.yMin)/2*d.$zoomScale);return a.style.left=d.$offsetLeft+c*d.$zoomScale+u-7+"px",a.style.top=d.$offsetTop+h*d.$zoomScale+m-7+"px",e.usePoint?(a.classList.remove("tween-pointer-disabled"),a.classList.add("tween-pointer-active")):(a.classList.add("tween-pointer-disabled"),a.classList.remove("tween-pointer-active")),a.addEventListener("mousedown",(e=>{this.startMoveCurvePointer(e)})),a.addEventListener("dblclick",(e=>{this.switchingCurvePointer(e)})),a.addEventListener("mouseover",d.$fadeIn),a.addEventListener("mouseout",d.$fadeOut),a}createEasingObject(){return[{type:"pointer",fixed:!0,x:0,y:0},{type:"curve",x:0,y:0},{type:"curve",x:100,y:100},{type:"pointer",fixed:!0,x:100,y:100}]}createEasingPointer(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=e[0],r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);if(!r)return;const a=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(a.startFrame))return;const s=r.getTween(a.startFrame),i=document.getElementById("ease-cubic-pointer-area");for(let e=0;e<s.custom.length;++e){const t=s.custom[e];if(t.fixed)continue;const r=this.createEasingPointerDiv(t.x,t.y,t.type,e);t.off&&r.classList.add("ease-cubic-disable"),i.appendChild(r)}}startMoveEasingPointer(e){this._$easeTarget=e.currentTarget,this._$pointX=e.screenX,this._$pointY=e.screenY,this._$moveEasingPointer||(this._$moveEasingPointer=this.moveEasingPointer.bind(this)),this._$endMoveEasingPointer||(this._$endMoveEasingPointer=this.endMoveEasingPointer.bind(this)),this.save(),window.addEventListener("mousemove",this._$moveEasingPointer),window.addEventListener("mouseup",this._$endMoveEasingPointer),window.removeEventListener("keydown",this._$deleteEasingPointer)}deleteEasingPointer(e){if("Backspace"!==e.key||!this._$easeTarget)return;const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const s=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(s.startFrame))return;const i=a.getTween(s.startFrame),n=0|this._$easeTarget.dataset.index;i.custom.splice(n-1,3);const o=document.getElementById("ease-cubic-pointer-area").children;o[n].remove(),o[n-1].remove(),o[n-2].remove();for(let e=0;e<o.length;++e){o[e].dataset.index=`${e+1}`}this.drawEasingGraph(),this.relocationPlace(a,s.startFrame),this.clearPointer().relocationPointer()}moveEasingPointer(e){window.requestAnimationFrame((()=>{if(!this._$easeTarget)return;const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const s=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(s.startFrame))return;const i=this._$easeTarget;let n=i.offsetLeft+e.screenX-this._$pointX,o=i.offsetTop+e.screenY-this._$pointY;this._$pointX=e.screenX,this._$pointY=e.screenY,Pe.EASE_MIN_POINTER_Y>o&&(o=Pe.EASE_MIN_POINTER_Y),Pe.EASE_MAX_POINTER_Y<o&&(o=Pe.EASE_MAX_POINTER_Y),Pe.EASE_MIN_POINTER_X>n&&(n=Pe.EASE_MIN_POINTER_X),Pe.EASE_MAX_POINTER_X<n&&(n=Pe.EASE_MAX_POINTER_X),i.style.left=`${n}px`,i.style.top=`${o}px`;const l=a.getTween(s.startFrame).custom[i.dataset.index],c=Pe.EASE_BASE_CANVAS_SIZE/Pe.EASE_RANGE;l.x=(n-Pe.EASE_SCREEN_X)/c,l.y=(Pe.EASE_MOVE_Y-o)/c,document.getElementById("ease-cubic-current-text").textContent=`(${l.x/Pe.EASE_RANGE*100|0})`,document.getElementById("ease-cubic-current-tween").textContent=`(${l.y/Pe.EASE_RANGE*100|0})`,this.drawEasingGraph(),this.relocationPlace(a,s.startFrame),this.clearPointer().relocationPointer()}))}endMoveEasingPointer(){window.removeEventListener("mousemove",this._$moveEasingPointer),window.removeEventListener("mouseup",this._$endMoveEasingPointer),window.addEventListener("keydown",this._$deleteEasingPointer),this._$saved=!1}disabledEasingPointer(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const s=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(s.startFrame))return;const i=a.getTween(s.startFrame),n=0|e.target.dataset.index,o=i.custom[n];o.off=!o.off,i.custom[n-1].off=o.off,i.custom[n+1].off=o.off;const l=document.getElementById("ease-cubic-pointer-area").children;o.off?(l[n-2].classList.add("ease-cubic-disable"),l[n-1].classList.add("ease-cubic-disable"),l[n].classList.add("ease-cubic-disable")):(l[n-2].classList.remove("ease-cubic-disable"),l[n-1].classList.remove("ease-cubic-disable"),l[n].classList.remove("ease-cubic-disable")),this._$easeTarget=null,this.drawEasingGraph(),this.relocationPlace(a,s.startFrame),this.clearPointer().relocationPointer()}createEasingPointerDiv(e=0,t=0,r="pointer",a=0){const s=document.createElement("div");s.addEventListener("mousedown",(e=>{this.startMoveEasingPointer(e)})),"pointer"===r&&s.addEventListener("dblclick",(e=>{this.disabledEasingPointer(e)})),s.classList.add(`ease-cubic-${r}`),s.dataset.index=`${a}`,s.dataset.type=`${r}`;const i=Pe.EASE_BASE_CANVAS_SIZE/Pe.EASE_RANGE;return s.style.left=`${Pe.EASE_SCREEN_X+e*i}px`,s.style.top=`${Pe.EASE_SCREEN_Y+(Pe.EASE_RANGE-t)*i}px`,s}drawEasingGraph(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=e[0],r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);if(!r)return;const a=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(a.startFrame))return;const s=r.getTween(a.startFrame),i=window.devicePixelRatio,n=Pe.EASE_OFFSET_X*i,o=Pe.EASE_OFFSET_Y*i,l=this._$drawContext;l.fillStyle="rgb(240, 240, 240)";const c=Pe.EASE_BASE_CANVAS_SIZE*i;l.setTransform(1,0,0,1,0,0),l.clearRect(0,0,l.canvas.width,l.canvas.height),l.fillRect(n,o,c,c),l.lineCap="round",l.translate(n,o),l.beginPath(),l.strokeStyle="rgba(200, 200, 200, 0.6)",l.lineWidth=10,l.moveTo(0,0),l.lineTo(c,c),l.stroke();const h=Pe.EASE_BASE_CANVAS_SIZE/Pe.EASE_RANGE*i;for(let e=0;e<s.custom.length;e+=3){const t=s.custom[e],r=s.custom[e+1];let a=s.custom[e+2],i=s.custom[e+3];if(i.off)for(e+=3;a=s.custom[e+2],i=s.custom[e+3],!i.fixed&&i.off;)e+=3;if(l.beginPath(),l.strokeStyle="rgb(160, 160, 160)",l.lineWidth=3,l.moveTo(t.x*h,t.y*h),l.lineTo(r.x*h,r.y*h),l.stroke(),l.beginPath(),l.strokeStyle="rgb(160, 160, 160)",l.lineWidth=3,l.moveTo(i.x*h,i.y*h),l.lineTo(a.x*h,a.y*h),l.stroke(),l.beginPath(),l.strokeStyle="rgb(80, 80, 80)",l.lineWidth=10,l.moveTo(t.x*h,t.y*h),l.bezierCurveTo(r.x*h,r.y*h,a.x*h,a.y*h,i.x*h,i.y*h),l.stroke(),i.fixed)break}const u=this._$viewContext;u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,l.canvas.width,l.canvas.height),u.scale(1,-1),u.translate(0,-l.canvas.height),u.drawImage(l.canvas,0,0)}getCurvePoint(e,t,r,a,s,i){const n=[];for(let e=0;e<i.length;++e){const t=i[e];t.usePoint&&n.push(t)}if(!n.length)return null;const o=1-e,l=n.length+1;for(let i=0;i<l;++i)t*=o,r*=o,a*=e,s*=e;let c=t+a,d=r+s;for(let t=0;t<n.length;++t){const r=n[t],a=t+1;let s=r.x*l,i=r.y*l;for(let t=0;t<a;++t)s*=e,i*=e;for(let e=0;e<l-a;++e)s*=o,i*=o;c+=s,d+=i}return{x:c,y:d}}cubicBezier(e,t,r,a){const s=3*e,i=3*(r-e)-s,n=1-s-i,o=3*t,l=3*(a-t)-o,c=1-o-l,d=e=>s+e*(2*i+3*n*e);return e=>{const t=(e=>{if(e<=0)return 0;if(e>=1)return 1;let t=0,r=0,a=e;for(;Math.abs(a-r)>1e-4&&(r=a,a-=((o=a)*(s+o*(i+o*n))-e)/d(a),t++,!(t>1e3)););var o;return a})(e);return t*(o+t*(l+t*c))}}clearEasingPointer(){const e=document.getElementById("ease-cubic-pointer-area");if(e)for(;e.children.length;)e.children[0].remove()}showCustomArea(){this.clearEasingPointer(),this._$easeTarget=null,document.getElementById("ease-canvas-view-area").style.display="",this.createEasingPointer(),this.drawEasingGraph()}hideCustomArea(){const e=document.getElementById("ease-canvas-view-area");e&&(e.style.display="none")}addCurvePinter(){const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),a=r.getActiveCharacter(t);if(!a.length||a.length>1)return;const s=a[0],i=s.getRange(t);if(!s.hasTween(i.startFrame))return;const n=s.getTween(i.startFrame),o=n.curve.length,l=d.$sceneChange.concatenatedMatrix,c=s.getBounds(l),h={usePoint:!0,x:c.xMin,y:c.yMin};n.curve.push(h);const u=this.createTweenCurveElement(h,o,r.id);u&&document.getElementById("stage-area").appendChild(u),this.relocationPlace(s,i.startFrame),this.clearPointer().relocationPointer()}}d.$tweenController=new Pe;class Oe extends he{constructor(){super("video")}static get MIN_VOLUME(){return 0}static get MAX_VOLUME(){return 100}initialize(){super.initialize();const e=["video-loop-select","video-auto-select"];for(let t=0;t<e.length;++t)this.setChangeEvent(document.getElementById(e[t]));this.setInputEvent(document.getElementById("video-volume"))}changeVideoLoopSelect(e){this.updateVideoProperty("loop",1==(0|e))}changeVideoAutoSelect(e){this.updateVideoProperty("autoPlay",1==(0|e))}changeVideoVolume(e){return e=d.$clamp(0|e,Oe.MIN_VOLUME,Oe.MAX_VOLUME),this.updateVideoProperty("volume",e),e}updateVideoProperty(e,t){const r=d.$tools.getDefaultTool("arrow").activeElements;if(!r.length)return;const a=r[0];d.$currentWorkSpace().getLibrary(0|a.dataset.libraryId)[e]=t}}d.$videoController=new Oe;class Ue{constructor(){this._$begin=!1}beginDraw(){this._$begin=!0}}class De{constructor(){this._$timeline=new ze,this._$library=new Ye}getTimeline(){return this._$timeline}get library(){return this._$library}}class Re{constructor(e,t){this._$character=e,this._$parent=t}get x(){return this._$character.x}set x(e){this._$character.x=e;const t=d.$currentWorkSpace().getLibrary(this._$character.libraryId);let r=d.$timelineFrame.currentFrame;const a=this._$character.getPlace(r);let s=Object.keys(a);const i={};for(let e=0;e<s.length;++e){const t=s[e];i[t]=a[t]}i.loop=d.$getDefaultLoopConfig(),i.startFrame=this._$character.startFrame,i.endFrame=this._$character.endFrame;const n=d.$boundsMatrix(t.getBounds(i),i.matrix),o=d.$offsetLeft+n.xMin*d.$zoomScale;this._$character._$screenX=o,document.getElementById(`character-${this._$character.id}`).style.left=`${o}px`}get y(){return this._$character.y}set y(e){this._$character.y=e;const t=d.$currentWorkSpace().getLibrary(this._$character.libraryId);let r=d.$timelineFrame.currentFrame;const a=this._$character.getPlace(r);let s=Object.keys(a);const i={};for(let e=0;e<s.length;++e){const t=s[e];i[t]=a[t]}i.loop=d.$getDefaultLoopConfig(),i.startFrame=this._$character.startFrame,i.endFrame=this._$character.endFrame;const n=d.$boundsMatrix(t.getBounds(i),i.matrix),o=d.$offsetTop+n.yMin*d.$zoomScale;this._$character._$screenY=o,document.getElementById(`character-${this._$character.id}`).style.top=`${o}px`}get libraryItem(){return new Ye(d.$currentWorkSpace().getLibrary(this._$character.libraryId))}get loop(){if(d.$currentWorkSpace().getLibrary(this._$character.libraryId).type!==b.MOVIE_CLIP)return"";const e=this._$character.getPlace(this._$character.startFrame);if(!e.loop)return"loop";switch(e.loop.type){case 1:case 3:return"play once";case 2:return"single frame";default:return"loop"}}set loop(e){if(d.$currentWorkSpace().getLibrary(this._$character.libraryId).type!==b.MOVIE_CLIP)return;const t=this._$character.getPlace(this._$character.startFrame);switch(e){case"loop":t.loop.type=Me.REPEAT;break;case"play once":t.loop.type=Me.NO_REPEAT;break;case"single frame":t.loop.type=Me.FIXED_ONE;break;default:t.loop.type=Me.DEFAULT}}get symbolType(){return d.$currentWorkSpace().getLibrary(this._$character.libraryId).type===b.MOVIE_CLIP?"movie clip":""}set symbolType(e){switch(e){case"button":case"movie clip":case"graphic":{const e=d.$currentWorkSpace();if(e.getLibrary(this._$character.libraryId).type===b.MOVIE_CLIP)return;const t=e.nextLibraryId,r=e.addLibrary(d.$controller.createContainer(b.MOVIE_CLIP,`MovieClip_${t}`,t)),a=this._$character.clone(),s=a._$endFrame-a._$startFrame+1,i=a._$startFrame-1,n=new Map;for(let[e,t]of a._$places)t.frame=e-i,n.set(t.frame,t);a._$places=n,a._$startFrame=1,a._$endFrame=s,a._$cachePlaces.length=0;const o=new v,l=this._$parent._$layer._$frame;for(let[e,t]of l._$classes)1>e-i||o._$frame._$classes.set(e-i,t);r.setLayer(r._$layerId++,o),o.addCharacter(a),this._$character._$currentFrame=0,this._$character._$currentPlace=null,this._$character.dispose(),this._$character._$libraryId=t;for(let e of this._$character._$places.values())e.loop=d.$getDefaultLoopConfig();e.scene.changeFrame(d.$timelineFrame.currentFrame)}}}}class Ne{constructor(e,t){this._$frame=e,this._$parent=t}get elements(){const e=this._$parent._$layer.getActiveCharacter(this._$frame),t=[];for(let r=0;r<e.length;++r)t.push(new Re(e[r],this._$parent));return t}}class Xe{constructor(e){this._$layer=e}get frames(){const e=[void 0],t=this._$layer.totalFrame;for(let r=1;t>=r;++r)e.push(new Ne(r,this));return e}get locked(){return this._$layer.lock}set locked(e){this._$layer.lock=!!e;const t=document.getElementById(`layer-lock-icon-${this._$layer.id}`);t.classList.remove("icon-disable","icon-active"),t.classList.add(this._$layer.lock?"icon-active":"icon-disable")}get name(){return this._$layer.name}}class Ye{constructor(e=null){this._$instance=e}get name(){return this._$instance?this._$instance.path:""}getItem(e){e=`${e}`;const t=d.$currentWorkSpace();for(let r of t._$libraries.values())if(r.path===e)return new Ye(r);return null}toImage(e=1){if(!this._$instance)return new Image;const t=this._$instance.getBounds([1,0,0,1,0,0],null,null,e),r=Math.abs(t.xMax-t.xMin),a=Math.abs(t.yMax-t.yMin),s=d.$currentFrame;d.$currentFrame=e;const i=this._$instance.draw(d.$getCanvas(),Math.ceil(r),Math.ceil(a),{frame:e,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],loop:d.$getDefaultLoopConfig()},null,e);d.$currentFrame=s;const n=new Image;return n.width=Math.ceil(r),n.height=Math.ceil(a),n.src=i.toDataURL(),d.$poolCanvas(i),n}addItemToDocument(e,t){if(!e||!t)return!1;t=`${t}`;const r=d.$currentWorkSpace();for(let a of r._$libraries.values())if(a.path===t)return d.$libraryController.activeInstance=document.getElementById(`library-child-id-${a.id}`),d.$dragElement={dataset:{libraryId:a.id}},d.$screen.drop({offsetX:e.x+d.$offsetLeft,offsetY:e.y+d.$offsetTop}),d.$dragElement=null,!0;return!1}}class ze{get currentFrame(){return d.$timelineFrame.currentFrame}get currentLayer(){const e=d.$timelineLayer.targetLayer;if(!e)return 0;const t=0|e.dataset.layerId,r=d.$currentWorkSpace().scene;return 0|Array.from(r._$layers.keys()).indexOf(t)}set currentLayer(e){const t=d.$currentWorkSpace().scene,r=Array.from(t._$layers.keys())[e];d.$timelineLayer.targetLayer=document.getElementById(`layer-id-${r}`)}get layers(){const e=Array.from(document.getElementById("timeline-content").children),t=d.$currentWorkSpace().scene,r=[];for(const a of t._$layers.values()){r[e.indexOf(document.getElementById(`layer-id-${a.id}`))]=new Xe(a)}return r}getSelectedLayers(){const e=[],t=Array.from(document.getElementById("timeline-content").children),r=d.$timelineLayer.targetLayers;for(const a of r.values()){const r=0|a.dataset.layerId,s=t.indexOf(document.getElementById(`layer-id-${r}`));e.push(s)}return e.length>1&&e.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}})),e}addNewLayer(e="",t="normal",r=!0){const a=d.$currentWorkSpace().scene,s=new v;switch(e&&(s.name=e),t){case"mask":s.mode=I.MASK;break;case"masked":s.mode=I.MASK_IN}const i=this.currentLayer;let n=0;const o=new Map;for(const e of a._$layers.values())r&&n===i&&o.set(n++,s),o.set(n++,e),r||n!==i+1||o.set(n++,s);return a._$layers=o,a.initialize(),d.$timelineLayer.targetLayer=document.getElementById(`layer-id-${s.id}`),d.$timelineLayer.clearActiveFrames(),d.$timelineLayer.addTargetFrame(s,this.currentFrame),new Xe(s)}setSelectedFrames(e,t){const r=d.$timelineLayer.targetLayer;if(!r)return;d.$timelineLayer.clearActiveFrames(),t=Math.max(e,t);const a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId);for(let r=e;t>=r;++r)d.$timelineLayer.addTargetFrame(a,r);d.$timelineFrame.currentFrame=e}clearKeyframes(e=-1,t=-1){const r=d.$timelineLayer.targetLayer;if(!r)return;const a=0|r.dataset.layerId;if(d.$timelineLayer.targetFrames.has(a)){const r=d.$timelineLayer.targetFrames.get(a).slice();r.length>1&&r.sort(((e,t)=>{const r=0|e,a=0|t;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}})),-1===e&&(e=r[0]),-1===t&&(t=r[r.length-1])}-1===t&&(t=e),-1!==e&&-1!==t&&this.setSelectedFrames(e,t)}convertToBlankKeyframes(e=-1,t=-1){const r=d.$timelineLayer.targetLayer;if(!r)return;const a=0|r.dataset.layerId;if(d.$timelineLayer.targetFrames.has(a)){const r=d.$timelineLayer.targetFrames.get(a).slice();r.length>1&&r.sort(((e,t)=>{const r=0|e,a=0|t;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}})),-1===e&&(e=r[0]),-1===t&&(t=r[r.length-1])}-1===t&&(t=e),-1!==e&&-1!==t&&(this.setSelectedFrames(e,t),d.$timelineTool.executeTimelineEmptyAdd())}}class We extends Z{constructor(e){super(e)}}e.nt=e.fl=new class{constructor(){this._$dom=new De,this._$panel=new Map,this._$drawingLayer=new Ue}get drawingLayer(){return this._$drawingLayer}addMenu(e,t=null){const r=document.getElementById("plugin-menu"),a=document.createElement("div");a.classList.add("screen-menu-bottom"),a.textContent=e,t&&a.addEventListener("mousedown",t),r.appendChild(a)}createPanel(e,t,r=200,a=200){this._$panel.set(e,{width:r,height:a,element:t})}showPanel(e){if(!this._$panel.has(e))return;document.getElementById("plugin-title").textContent=e;const t=this._$panel.get(e);document.getElementById("plugin-modal-element").appendChild(t.element),document.documentElement.style.setProperty("--plugin-modal-width",`${t.width}px`),document.documentElement.style.setProperty("--plugin-modal-height",`${t.height}px`);const r=document.getElementById("plugin-modal");r.style.top="100px",r.style.left="100px",r.setAttribute("class","fadeIn"),d.$endMenu("plugin-modal")}hidePanel(){d.$endMenu();const e=document.getElementById("plugin-modal-element").children;for(;e.length;)e[0].remove()}getDocumentDOM(){return this._$dom}addTool(e){return new We(e)}setShortcut(e,t,r){switch(e){case"global":d.$setShortcut(t,r);break;case"screen":d.$screenKeyboardCommand.add(t,r);break;case"timeline":d.Util.$timelineKeyboardCommand.add(t,r);break;case"library":d.Util.$libraryKeyboardCommand.add(t,r)}}deleteShortcut(e,t){switch(e){case"global":d.$deleteShortcut(t);break;case"screen":d.$screenKeyboardCommand.delete(t);break;case"timeline":d.Util.$timelineKeyboardCommand.delete(t);break;case"library":d.Util.$libraryKeyboardCommand.delete(t)}}}}(this);