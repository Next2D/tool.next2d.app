/*!
 * licenses: このプログラムを無断で利用、複製、配布を一切禁止します。
 *           但し、書き出したn2d,JSON,WebM,GIFはその限りではありません。
 *           Unauthorized use, reproduction, or distribution of this program is strictly prohibited.
 *           However, the exported n2d, JSON, WebM and GIF are exempt from this restriction.
 * version: 0.6.0
 * author: Toshiyuki Ienaga <ienaga@tvon.jp>
 * copyright: (c) 2021 Toshiyuki Ienaga.
 */
"next2d-tools"in window||function(e){"use strict";class t{constructor(){this.mapping=this.createMapping()}replace(e){return this.mapping.has(e)?this.mapping.get(e):e}}class a extends t{constructor(){super()}createMapping(){return new Map([["{{プレビューのON/OFF}}","预览开/关"],["{{フォント枠サイズ}}","字体帧大小"],["{{フォント枠カラー}}","字体帧颜色"],["{{オニオンスキン}}","洋葱皮"],["{{バケツツール}}","整体填充工具"],["{{ペンツール}}","钢笔工具"],["{{ダブルクリックでカーブポイントが追加されます}}","双击来添加一个曲线点"],["{{選択ツール}}","选择工具"],["{{Shape変形ツール}}","形状变换工具"],["{{テキストツール}}","文本工具"],["{{短形ツール}}","矩形工具"],["{{楕円ツール}}","椭圆工具"],["{{角丸矩形ツール}}","圆角矩形工具"],["{{塗りのカラー}}","填充颜色"],["{{線のカラー}}","画笔颜色"],["{{線の太さ}}","画笔宽度"],["{{プロジェクトデータの読込}}","载入工程文件"],["{{プロジェクトデータを保存}}","保存工程文件"],["{{書き出し}}","导出"],["{{Discordへ移動}}","前往discord"],["{{バグ報告}}","错误报告"],["{{設定}}","设置"],["{{タブを追加}}","添加标签页"],["{{タブの一覧を表示・移動}}","标签页列表"],["{{スクリプトを追加}}","添加一个脚本"],["{{キーフレームを追加}}","添加一个关键帧"],["{{空のキーフレームを追加}}","添加一个空的关键帧"],["{{フレームを追加}}","添加帧"],["{{フレームを削除}}","删除帧"],["{{再生}}","播放"],["{{停止}}","停止"],["{{ループ設定}}","循环设置"],["{{レイヤーを追加}}","添加图层"],["{{レイヤーを削除}}","删除图层"],["{{全てのレイヤーをハイライト}}","高亮所有图层"],["{{全てのレイヤーを非表示}}","隐藏所有图层"],["{{全てのレイヤーをロック}}","锁定所有图层"],["{{比率を固定}}","锁定比例"],["{{ステージの幅}}","画面宽度"],["{{背景色}}","背景颜色"],["{{ステージの高さ}}","画面高度"],["{{フレームレート}}","帧速率"],["{{シンボル名}}","符号名称"],["{{イージング設定}}","过渡设置"],["{{ビデオの音量設定}}","视频音量设置"],["{{自動再生}}","自动播放"],["{{テキストエリアのボーダー設定}}","文本框边框设置"],["{{テキスト入力設定}}","文本输入设置"],["{{フォント選択}}","字体选择"],["{{自動サイズ調整}}","自动调整尺寸"],["{{フォントスタイルタイプ}}","字体风格类型"],["{{行揃え}}","对齐设置"],["{{改行設定}}","换行设置"],["{{スクロール設定}}","滚动设置"],["{{フォントサイズ}}","字体大小"],["{{フォントカラー}}","字体颜色"],["{{行間}}","行间距"],["{{文字幅}}","字符宽度"],["{{左マージン}}","左边距"],["{{右マージン}}","右边距"],["{{カラー種別の選択}}","选择颜色类型"],["{{背景画像の選択}}","选择背景图片"],["{{カラーポインターを追加}}","添加颜色指针"],["{{カラー値}}","颜色"],["{{アルファ(0%-100%)}}","透明度（0%-100%）"],["{{アルファ値}}","透明度"],["{{選択対象の幅}}","选择对象的宽度"],["{{選択対象のX座標}}","选择对象的X轴坐标"],["{{選択対象の高さ}}","选择对象的高度"],["{{選択対象のY座標}}","选择对象的Y轴坐标"],["{{選択対象の幅の伸縮}}","选定对象的X轴缩放"],["{{選択対象を回転}}","旋转物体"],["{{選択対象の高さの伸縮}}","所选对象的比例Y"],["{{アルファオフセット(-255〜255)}}","透明度偏移（-255~255）"],["{{赤(0%-100%)}}","红色（0%-100%）"],["{{赤オフセット(-255〜255)}}","红色偏移（-255~255）"],["{{緑(0%-100%)}}","绿色（0%-100%）"],["{{緑オフセット(-255〜255)}}","绿色偏移（-255~255）"],["{{青(0%-100%)}}","蓝色（0%-100%）"],["{{青オフセット(-255〜255)}}","蓝色偏移（-255~255）"],["{{ブレンドモード}}","混合模式"],["{{フィルターを選択}}","选择滤镜"],["{{フィルターを追加}}","添加滤镜"],["{{サウンドを追加}}","添加声音"],["{{フィルターを表示・非表示する}}","显示和隐藏滤镜"],["{{フィルターを削除}}","删除滤镜"],["{{水平方向にぼかす}}","横向模糊"],["{{垂直方向にぼかす}}","纵向模糊"],["{{フィルター強度}}","滤镜强度"],["{{フィルター角度}}","滤镜角度"],["{{シャドウのアルファ}}","阴影透明度"],["{{シャドウのカラー}}","阴影颜色"],["{{フィルター距離}}","滤镜距离"],["{{ハイライトのカラー}}","高光色"],["{{ハイライトのアルファ}}","高光透明度"],["{{グラデーションカラー}}","渐变色"],["{{グラデーションのアルファ}}","渐变透明度"],["{{タブの移動・名前を変更}}","移动/重命名标签"],["{{プロジェクトを閉じる}}","关闭工程"],["{{上下に移動}}","上下移动"],["{{レイヤー変更(ダブルクリック)}}","改变图层（双击）"],["{{レイヤーをハイライト}}","高亮图层"],["{{レイヤーを非表示}}","隐藏图层"],["{{レイヤーをロック}}","锁定图层"],["{{カーブポインター(ダブルクリックでON/OFF)}}","曲线指针（双击打开/关闭）"],["{{インスタンス名}}","实例名称"],["{{ライブラリ内の検索}}","在库中搜索"],["{{フレームラベル}}","帧标签"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","如果工程没有保存，将无法恢复此标签页数据。 你想删除这个标签页吗？"]])}}class s extends t{constructor(){super()}createMapping(){return new Map([["{{プレビューのON/OFF}}","Preview on/off"],["{{フォント枠サイズ}}","Font Frame Size"],["{{フォント枠カラー}}","Font Frame Color"],["{{オニオンスキン}}","Onion Skin"],["{{バケツツール}}","Bucket Tools"],["{{ペンツール}}","Pen Tool"],["{{ダブルクリックでカーブポイントが追加されます}}","Double-click to add a curve point"],["{{選択ツール}}","Selection Tool"],["{{Shape変形ツール}}","Shape Transform Tool"],["{{テキストツール}}","Text Tool"],["{{短形ツール}}","Rectangle Tool"],["{{楕円ツール}}","Ellipse Tool"],["{{角丸矩形ツール}}","Rounded Rectangle Tool"],["{{塗りのカラー}}","Fill Color"],["{{線のカラー}}","Stroke Color"],["{{線の太さ}}","Stroke Width"],["{{プロジェクトデータの読込}}","Loading project data"],["{{プロジェクトデータを保存}}","Save project data"],["{{書き出し}}","Export"],["{{Discordへ移動}}","Go to discord"],["{{バグ報告}}","Bug reports"],["{{設定}}","Setting"],["{{タブを追加}}","Add a tab"],["{{タブの一覧を表示・移動}}","View and move through the list of tabs"],["{{スクリプトを追加}}","Add a script"],["{{キーフレームを追加}}","Add a keyframe"],["{{空のキーフレームを追加}}","Add an empty keyframe"],["{{フレームを追加}}","Add a frame"],["{{フレームを削除}}","Delete frame"],["{{再生}}","Play"],["{{停止}}","Stop"],["{{ループ設定}}","Loop Setting"],["{{レイヤーを追加}}","Add a layer"],["{{レイヤーを削除}}","Delete layer"],["{{全てのレイヤーをハイライト}}","Highlight all layers"],["{{全てのレイヤーを非表示}}","Hide all layers"],["{{全てのレイヤーをロック}}","Lock all layers"],["{{比率を固定}}","Fixed ratio"],["{{ステージの幅}}","Stage Width"],["{{背景色}}","Background Color"],["{{ステージの高さ}}","Stage Height"],["{{フレームレート}}","Frame Rate"],["{{シンボル名}}","Symbol Name"],["{{イージング設定}}","Easing Setting"],["{{ビデオの音量設定}}","Video Volume Setting"],["{{自動再生}}","Auto Play"],["{{テキストエリアのボーダー設定}}","Text Area Border Setting"],["{{テキスト入力設定}}","Text Input Setting"],["{{フォント選択}}","Font Select"],["{{自動サイズ調整}}","Automatic size adjustment"],["{{フォントスタイルタイプ}}","Font Style Type"],["{{行揃え}}","Align Setting"],["{{改行設定}}","Newline Setting"],["{{スクロール設定}}","Scroll Setting"],["{{フォントサイズ}}","Font Size"],["{{フォントカラー}}","Font Color"],["{{行間}}","Line Space"],["{{文字幅}}","Character Width"],["{{左マージン}}","Left Margin"],["{{右マージン}}","Right Margin"],["{{カラー種別の選択}}","Select a color type"],["{{背景画像の選択}}","Selecting a background image"],["{{カラーポインターを追加}}","Add color pointers"],["{{カラー値}}","Color"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Width of the selection object"],["{{選択対象のX座標}}","X coordinate of the selection object"],["{{選択対象の高さ}}","Height  of the selection object"],["{{選択対象のY座標}}","Y coordinate of the selection object"],["{{選択対象の幅の伸縮}}","scaleX of the selected object"],["{{選択対象を回転}}","Rotate the object"],["{{選択対象の高さの伸縮}}","scaleY of the selected object"],["{{アルファオフセット(-255〜255)}}","Alpha Offset(-255〜255)"],["{{赤(0%-100%)}}","Red(0%-100%)"],["{{赤オフセット(-255〜255)}}","Red Offset(-255〜255)"],["{{緑(0%-100%)}}","Green(0%-100%)"],["{{緑オフセット(-255〜255)}}","Green Offset(-255〜255)"],["{{青(0%-100%)}}","Blue(0%-100%)"],["{{青オフセット(-255〜255)}}","Blue Offset(-255〜255)"],["{{ブレンドモード}}","Blend Mode"],["{{フィルターを選択}}","Select a filter"],["{{フィルターを追加}}","Add a filter"],["{{サウンドを追加}}","Add a sound"],["{{フィルターを表示・非表示する}}","Show and Hide filters"],["{{フィルターを削除}}","Delete Filter"],["{{水平方向にぼかす}}","Blur Horizontally"],["{{垂直方向にぼかす}}","Blur Vertically"],["{{フィルター強度}}","Filter Strength"],["{{フィルター角度}}","Filter Angle"],["{{シャドウのアルファ}}","Shadow Alpha"],["{{シャドウのカラー}}","Shadow Color"],["{{フィルター距離}}","Filter Distance"],["{{ハイライトのカラー}}","Highlight Color"],["{{ハイライトのアルファ}}","Highlight Alpha"],["{{グラデーションカラー}}","Gradient Color"],["{{グラデーションのアルファ}}","Gradient Alpha"],["{{タブの移動・名前を変更}}","Move/Rename tabs"],["{{プロジェクトを閉じる}}","Close the project"],["{{上下に移動}}","Move up and down"],["{{レイヤー変更(ダブルクリック)}}","Layer Change(double-click)"],["{{レイヤーをハイライト}}","Highlight Layer"],["{{レイヤーを非表示}}","Hide Layer"],["{{レイヤーをロック}}","Lock the Layer"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Curve Pointer (double click to turn on/off)"],["{{インスタンス名}}","Instance Name"],["{{ライブラリ内の検索}}","Search in the library"],["{{フレームラベル}}","Frame Label"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","If the project is not saved, the project data in this tab cannot be recovered. Do you want to delete the tab?"]])}}class r extends t{constructor(){super()}createMapping(){return new Map([["{{プレビューのON/OFF}}","Activation/désactivation de la prévisualisation"],["{{フォント枠サイズ}}","Taille du cadre de la police"],["{{フォント枠カラー}}","Couleur du cadre de la police"],["{{オニオンスキン}}","Peau d'oignon"],["{{バケツツール}}","Outils à godets"],["{{ペンツール}}","Outil stylo"],["{{ダブルクリックでカーブポイントが追加されます}}","Double-cliquez pour ajouter un point de courbe"],["{{選択ツール}}","Outils de sélection"],["{{Shape変形ツール}}","Outil de transformation des formes"],["{{テキストツール}}","Outil texte"],["{{短形ツール}}","Outil Rectangle"],["{{楕円ツール}}","Outil Ellipse"],["{{角丸矩形ツール}}","Outil Rectangle arrondi"],["{{塗りのカラー}}","Couleur de remplissage"],["{{線のカラー}}","Couleur du trait"],["{{線の太さ}}","Largeur de course"],["{{プロジェクトデータの読込}}","Chargement des données du projet"],["{{プロジェクトデータを保存}}","Sauvegarder les données du projet"],["{{書き出し}}","Exportation"],["{{Discordへ移動}}","Aller sur le discord"],["{{バグ報告}}","Rapports de bogue"],["{{設定}}","Réglage de"],["{{タブを追加}}","Ajouter un onglet"],["{{タブの一覧を表示・移動}}","Visualiser et se déplacer dans la liste des onglets"],["{{スクリプトを追加}}","Ajouter un script"],["{{キーフレームを追加}}","Ajouter une image clé"],["{{空のキーフレームを追加}}","Ajouter une image clé vide"],["{{フレームを追加}}","Ajouter un cadre"],["{{フレームを削除}}","Supprimer le cadre"],["{{再生}}","Jouer"],["{{停止}}","Stop"],["{{ループ設定}}","Réglage de la boucle"],["{{レイヤーを追加}}","Ajouter une couche"],["{{レイヤーを削除}}","Supprimer la couche"],["{{全てのレイヤーをハイライト}}","Mettez en évidence toutes les couches"],["{{全てのレイヤーを非表示}}","Cacher toutes les couches"],["{{全てのレイヤーをロック}}","Verrouiller toutes les couches"],["{{比率を固定}}","Ratio fixe"],["{{ステージの幅}}","Largeur de la scène"],["{{背景色}}","Couleur de fond"],["{{ステージの高さ}}","Hauteur de la scène"],["{{フレームレート}}","Fréquence d'images"],["{{シンボル名}}","Nom du symbole"],["{{イージング設定}}","Réglage de l'assouplissement"],["{{ビデオの音量設定}}","Réglage du volume vidéo"],["{{自動再生}}","Lecture automatique"],["{{テキストエリアのボーダー設定}}","Réglage de la bordure de la zone de texte"],["{{テキスト入力設定}}","Réglage de la saisie du texte"],["{{フォント選択}}","Sélection de la police"],["{{自動サイズ調整}}","Ajustement automatique de la taille"],["{{フォントスタイルタイプ}}","Type de police"],["{{行揃え}}","Réglage de l'alignement"],["{{改行設定}}","Réglage des nouvelles lignes"],["{{スクロール設定}}","Réglage du défilement"],["{{フォントサイズ}}","Taille de la police"],["{{フォントカラー}}","Couleur de la police"],["{{行間}}","Espace linéaire"],["{{文字幅}}","Largeur des caractères"],["{{左マージン}}","Marge gauche"],["{{右マージン}}","Marge droite"],["{{カラー種別の選択}}","Sélectionnez un type de couleur"],["{{背景画像の選択}}","Sélection d'une image de fond"],["{{カラーポインターを追加}}","Ajouter des pointeurs de couleur"],["{{カラー値}}","Couleur"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Largeur de l'objet de sélection"],["{{選択対象のX座標}}","Coordonnée X de l'objet de sélection"],["{{選択対象の高さ}}","Hauteur de l'objet de sélection"],["{{選択対象のY座標}}","Coordonnée Y de l'objet de sélection"],["{{選択対象の幅の伸縮}}","scaleX de l'objet sélectionné"],["{{選択対象を回転}}","Faire pivoter l'objet"],["{{選択対象の高さの伸縮}}","scaleY de l'objet sélectionné"],["{{アルファオフセット(-255〜255)}}","Décalage alpha(-255〜255)"],["{{赤(0%-100%)}}","Rouge(0%-100%)"],["{{赤オフセット(-255〜255)}}","Décalage rouge(-255〜255)"],["{{緑(0%-100%)}}","Vert(0%-100%)"],["{{緑オフセット(-255〜255)}}","Compensation verte(-255〜255)"],["{{青(0%-100%)}}","Bleu(0%-100%)"],["{{青オフセット(-255〜255)}}","Décalage bleu(-255〜255)"],["{{ブレンドモード}}","Mode de mélange"],["{{フィルターを選択}}","Sélectionnez un filtre"],["{{フィルターを追加}}","Ajouter un filtre"],["{{サウンドを追加}}","Ajouter un son"],["{{フィルターを表示・非表示する}}","Afficher et masquer les filtres"],["{{フィルターを削除}}","Supprimer le filtre"],["{{水平方向にぼかす}}","Flou horizontal"],["{{垂直方向にぼかす}}","Flou vertical"],["{{フィルター強度}}","Résistance du filtre"],["{{フィルター角度}}","Angle du filtre"],["{{シャドウのアルファ}}","Shadow Alpha"],["{{シャドウのカラー}}","Couleur de l'ombre"],["{{フィルター距離}}","Distance du filtre"],["{{ハイライトのカラー}}","Couleur de mise en évidence"],["{{ハイライトのアルファ}}","Highlight Alpha"],["{{グラデーションカラー}}","Couleur dégradée"],["{{グラデーションのアルファ}}","Gradient Alpha"],["{{タブの移動・名前を変更}}","Déplacer/Renommer les onglets"],["{{プロジェクトを閉じる}}","Fermer le projet"],["{{上下に移動}}","Déplacement vers le haut et le bas"],["{{レイヤー変更(ダブルクリック)}}","Changement de couche (double-clic)"],["{{レイヤーをハイライト}}","Couche de mise en évidence"],["{{レイヤーを非表示}}","Masquer la couche"],["{{レイヤーをロック}}","Verrouiller le calque"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Pointeur de courbe (double-cliquez pour l'activer ou le désactiver)"],["{{インスタンス名}}","Nom de l'instance"],["{{ライブラリ内の検索}}","Recherche dans la bibliothèque"],["{{フレームラベル}}","Étiquette du cadre"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Si le projet n'est pas sauvegardé, les données du projet dans cet onglet ne peuvent pas être récupérées. Voulez-vous supprimer l'onglet ?"]])}}class i extends t{constructor(){super()}createMapping(){return new Map([["{{プレビューのON/OFF}}","Anteprima on/off"],["{{フォント枠サイズ}}","Dimensione della cornice del carattere"],["{{フォント枠カラー}}","Colore della cornice del carattere"],["{{オニオンスキン}}","Pelle di cipolla"],["{{バケツツール}}","Strumenti a secchiello"],["{{ペンツール}}","Strumento penna"],["{{ダブルクリックでカーブポイントが追加されます}}","Doppio clic per aggiungere un punto di curva"],["{{選択ツール}}","Strumenti di selezione"],["{{Shape変形ツール}}","Strumento di trasformazione della forma"],["{{テキストツール}}","Text Tool"],["{{短形ツール}}","Strumento di testo"],["{{楕円ツール}}","Strumento Ellisse"],["{{角丸矩形ツール}}","Strumento Rettangolo arrotondato"],["{{塗りのカラー}}","Colore di riempimento"],["{{線のカラー}}","Colore del tratto"],["{{線の太さ}}","Larghezza della corsa"],["{{プロジェクトデータの読込}}","Caricamento dei dati del progetto"],["{{プロジェクトデータを保存}}","Salvare i dati del progetto"],["{{書き出し}}","Esportazione"],["{{Discordへ移動}}","Vai su discordia"],["{{バグ報告}}","Segnalazioni di bug"],["{{設定}}","Impostazione"],["{{タブを追加}}","Aggiungere una scheda"],["{{タブの一覧を表示・移動}}","Visualizzare e spostarsi attraverso l'elenco delle schede"],["{{スクリプトを追加}}","Aggiungere uno script"],["{{キーフレームを追加}}","Aggiungere un keyframe"],["{{空のキーフレームを追加}}","Aggiungere un keyframe vuoto"],["{{フレームを追加}}","Aggiungere una cornice"],["{{フレームを削除}}","Cancellare la cornice"],["{{再生}}","Gioca"],["{{停止}}","Fermare"],["{{ループ設定}}","Impostazione del loop"],["{{レイヤーを追加}}","Aggiungere uno strato"],["{{レイヤーを削除}}","Cancellare il livello"],["{{全てのレイヤーをハイライト}}","Evidenzia tutti i livelli"],["{{全てのレイヤーを非表示}}","Nascondi tutti i livelli"],["{{全てのレイヤーをロック}}","Blocca tutti i livelli"],["{{比率を固定}}","Rapporto fisso"],["{{ステージの幅}}","Larghezza del palco"],["{{背景色}}","Colore di sfondo"],["{{ステージの高さ}}","Altezza del palco"],["{{フレームレート}}","Frame Rate"],["{{シンボル名}}","Nome del simbolo"],["{{イージング設定}}","Impostazione di rilassamento"],["{{ビデオの音量設定}}","Impostazione del volume video"],["{{自動再生}}","Riproduzione automatica"],["{{テキストエリアのボーダー設定}}","Impostazione del bordo dell'area di testo"],["{{テキスト入力設定}}","Impostazione dell'inserimento del testo"],["{{フォント選択}}","Seleziona il carattere"],["{{自動サイズ調整}}","Regolazione automatica delle dimensioni"],["{{フォントスタイルタイプ}}","Tipo di stile di carattere"],["{{行揃え}}","Allineare l'impostazione"],["{{改行設定}}","Impostazione Newline"],["{{スクロール設定}}","Impostazione dello scorrimento"],["{{フォントサイズ}}","Dimensione del carattere"],["{{フォントカラー}}","Colore del carattere"],["{{行間}}","Spazio di linea"],["{{文字幅}}","Larghezza del carattere"],["{{左マージン}}","Margine sinistro"],["{{右マージン}}","Margine destro"],["{{カラー種別の選択}}","Seleziona un tipo di colore"],["{{背景画像の選択}}","Selezionare un'immagine di sfondo"],["{{カラーポインターを追加}}","Aggiungere i puntatori di colore"],["{{カラー値}}","Colore"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Larghezza dell'oggetto di selezione"],["{{選択対象のX座標}}","Coordinata X dell'oggetto di selezione"],["{{選択対象の高さ}}","Altezza dell'oggetto di selezione"],["{{選択対象のY座標}}","Coordinata Y dell'oggetto di selezione"],["{{選択対象の幅の伸縮}}","scaleX dell'oggetto selezionato"],["{{選択対象を回転}}","Ruotare l'oggetto"],["{{選択対象の高さの伸縮}}","scalaY dell'oggetto selezionato"],["{{アルファオフセット(-255〜255)}}","Offset alfa(-255〜255)"],["{{赤(0%-100%)}}","Rosso(0%-100%)"],["{{赤オフセット(-255〜255)}}","Offset rosso(-255〜255)"],["{{緑(0%-100%)}}","Verde(0%-100%)"],["{{緑オフセット(-255〜255)}}","Offset Verde(-255〜255)"],["{{青(0%-100%)}}","Blu(0%-100%)"],["{{青オフセット(-255〜255)}}","Offset Blu(-255〜255)"],["{{ブレンドモード}}","Modalità di fusione"],["{{フィルターを選択}}","Seleziona un filtro"],["{{フィルターを追加}}","Aggiungere un filtro"],["{{サウンドを追加}}","Aggiungere un suono"],["{{フィルターを表示・非表示する}}","Mostrare e nascondere i filtri"],["{{フィルターを削除}}","Cancellare il filtro"],["{{水平方向にぼかす}}","Sfocatura orizzontale"],["{{垂直方向にぼかす}}","Sfocatura verticale"],["{{フィルター強度}}","Forza del filtro"],["{{フィルター角度}}","Angolo del filtro"],["{{シャドウのアルファ}}","Ombra alfa"],["{{シャドウのカラー}}","Colore dell'ombra"],["{{フィルター距離}}","Distanza del filtro"],["{{ハイライトのカラー}}","Colore in evidenza"],["{{ハイライトのアルファ}}","Evidenziare l'alfa"],["{{グラデーションカラー}}","Colore sfumato"],["{{グラデーションのアルファ}}","Gradiente alfa"],["{{タブの移動・名前を変更}}","Spostare/rinominare le schede"],["{{プロジェクトを閉じる}}","Chiudere il progetto"],["{{上下に移動}}","Sposta su e giù"],["{{レイヤー変更(ダブルクリック)}}","Cambio di livello (doppio clic)"],["{{レイヤーをハイライト}}","Strato di evidenziazione"],["{{レイヤーを非表示}}","Nascondere lo strato"],["{{レイヤーをロック}}","Bloccare il livello"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Curve Pointer (doppio clic per attivare/disattivare)"],["{{インスタンス名}}","Nome dell'istanza"],["{{ライブラリ内の検索}}","Cerca nella biblioteca"],["{{フレームラベル}}","Etichetta del telaio"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Se il progetto non viene salvato, i dati del progetto in questa scheda non possono essere recuperati. Vuoi cancellare la scheda?"]])}}class n extends t{constructor(){super()}createMapping(){return new Map([["{{プレビューのON/OFF}}","プレビューのON/OFF"],["{{フォント枠サイズ}}","フォント枠サイズ"],["{{フォント枠カラー}}","フォント枠カラー"],["{{オニオンスキン}}","オニオンスキン"],["{{バケツツール}}","バケツツール"],["{{ペンツール}}","ペンツール"],["{{ダブルクリックでカーブポイントが追加されます}}","ダブルクリックでカーブポイントが追加されます"],["{{選択ツール}}","選択ツール"],["{{Shape変形ツール}}","Shape変形ツール"],["{{テキストツール}}","テキストツール"],["{{短形ツール}}","短形ツール"],["{{楕円ツール}}","楕円ツール"],["{{角丸矩形ツール}}","角丸矩形ツール"],["{{塗りのカラー}}","塗りのカラー"],["{{線のカラー}}","線のカラー"],["{{線の太さ}}","線の太さ"],["{{プロジェクトデータの読込}}","プロジェクトデータの読込"],["{{プロジェクトデータを保存}}","プロジェクトデータを保存"],["{{書き出し}}","書き出し"],["{{Discordへ移動}}","Discordへ移動"],["{{バグ報告}}","バグ報告"],["{{設定}}","設定"],["{{タブを追加}}","タブを追加"],["{{タブの一覧を表示・移動}}","タブの一覧を表示・移動"],["{{スクリプトを追加}}","スクリプトを追加"],["{{キーフレームを追加}}","キーフレームを追加"],["{{空のキーフレームを追加}}","空のキーフレームを追加"],["{{フレームを追加}}","フレームを追加"],["{{フレームを削除}}","フレームを削除"],["{{再生}}","再生"],["{{停止}}","停止"],["{{ループ設定}}","ループ設定"],["{{レイヤーを追加}}","レイヤーを追加"],["{{レイヤーを削除}}","レイヤーを削除"],["{{全てのレイヤーをハイライト}}","全てのレイヤーをハイライト"],["{{全てのレイヤーを非表示}}","全てのレイヤーを非表示"],["{{全てのレイヤーをロック}}","全てのレイヤーをロック"],["{{比率を固定}}","比率を固定"],["{{ステージの幅}}","ステージの幅"],["{{背景色}}","背景色"],["{{ステージの高さ}}","ステージの高さ"],["{{フレームレート}}","フレームレート"],["{{シンボル名}}","シンボル名"],["{{イージング設定}}","イージング設定"],["{{ビデオの音量設定}}","ビデオの音量設定"],["{{自動再生}}","自動再生"],["{{テキストエリアのボーダー設定}}","テキストエリアのボーダー設定"],["{{テキスト入力設定}}","テキスト入力設定"],["{{フォント選択}}","フォント選択"],["{{自動サイズ調整}}","自動サイズ調整"],["{{フォントスタイルタイプ}}","フォントスタイルタイプ"],["{{行揃え}}","行揃え"],["{{改行設定}}","改行設定"],["{{スクロール設定}}","スクロール設定"],["{{フォントサイズ}}","フォントサイズ"],["{{フォントカラー}}","フォントカラー"],["{{行間}}","行間"],["{{文字幅}}","文字幅"],["{{左マージン}}","左マージン"],["{{右マージン}}","右マージン"],["{{カラー種別の選択}}","カラー種別の選択"],["{{背景画像の選択}}","背景画像の選択"],["{{カラーポインターを追加}}","カラーポインターを追加"],["{{カラー値}}","カラー値"],["{{アルファ(0%-100%)}}","アルファ(0%-100%)"],["{{アルファ値}}","アルファ値"],["{{選択対象の幅}}","選択対象の幅"],["{{選択対象のX座標}}","選択対象のX座標"],["{{選択対象の高さ}}","選択対象の高さ"],["{{選択対象のY座標}}","選択対象のY座標"],["{{選択対象の幅の伸縮}}","選択対象の幅の伸縮"],["{{選択対象を回転}}","選択対象を回転"],["{{選択対象の高さの伸縮}}","選択対象の高さの伸縮"],["{{アルファオフセット(-255〜255)}}","アルファオフセット(-255〜255)"],["{{赤(0%-100%)}}","赤(0%-100%)"],["{{赤オフセット(-255〜255)}}","赤オフセット(-255〜255)"],["{{緑(0%-100%)}}","緑(0%-100%)"],["{{緑オフセット(-255〜255)}}","緑オフセット(-255〜255)"],["{{青(0%-100%)}}","青(0%-100%)"],["{{青オフセット(-255〜255)}}","青オフセット(-255〜255)"],["{{ブレンドモード}}","ブレンドモード"],["{{フィルターを選択}}","フィルターを選択"],["{{フィルターを追加}}","フィルターを追加"],["{{サウンドを追加}}","サウンドを追加"],["{{フィルターを表示・非表示する}}","フィルターを表示・非表示する"],["{{フィルターを削除}}","フィルターを削除"],["{{水平方向にぼかす}}","水平方向にぼかす"],["{{垂直方向にぼかす}}","垂直方向にぼかす"],["{{フィルター強度}}","フィルター強度"],["{{フィルター角度}}","フィルター角度"],["{{シャドウのアルファ}}","シャドウのアルファ"],["{{シャドウのカラー}}","シャドウのカラー"],["{{フィルター距離}}","フィルター距離"],["{{ハイライトのカラー}}","ハイライトのカラー"],["{{ハイライトのアルファ}}","ハイライトのアルファ"],["{{グラデーションカラー}}","グラデーションカラー"],["{{グラデーションのアルファ}}","グラデーションのアルファ"],["{{タブの移動・名前を変更}}","タブの移動・名前を変更"],["{{プロジェクトを閉じる}}","プロジェクトを閉じる"],["{{上下に移動}}","上下に移動"],["{{レイヤー変更(ダブルクリック)}}","レイヤー変更(ダブルクリック)"],["{{レイヤーをハイライト}}","レイヤーをハイライト"],["{{レイヤーを非表示}}","レイヤーを非表示"],["{{レイヤーをロック}}","レイヤーをロック"],["{{カーブポインター(ダブルクリックでON/OFF)}}","カーブポインター(ダブルクリックでON/OFF)"],["{{インスタンス名}}","インスタンス名"],["{{ライブラリ内の検索}}","ライブラリ内の検索"],["{{フレームラベル}}","フレームラベル"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？"]])}}class o extends t{constructor(){super()}createMapping(){return new Map([["{{プレビューのON/OFF}}","프레뷰의 ON/OFF"],["{{フォント枠サイズ}}","글꼴 프레임 크기"],["{{フォント枠カラー}}","글꼴 프레임 색상"],["{{オニオンスキン}}","양파 껍질"],["{{バケツツール}}","버킷 도구"],["{{ペンツール}}","펜 도구"],["{{ダブルクリックでカーブポイントが追加されます}}","곡선 점을 추가하려면 두 번 클릭"],["{{選択ツール}}","선택 도구"],["{{Shape変形ツール}}","모양 변형 도구"],["{{テキストツール}}","텍스트 도구"],["{{短形ツール}}","너무 직사각형"],["{{楕円ツール}}","타원 도구"],["{{角丸矩形ツール}}","둥근 사각형 도구"],["{{塗りのカラー}}","채우기 색상"],["{{線のカラー}}","획 색상"],["{{線の太さ}}","획 폭"],["{{プロジェクトデータの読込}}","프로젝트 데이터 로드"],["{{プロジェクトデータを保存}}","프로젝트 데이터 저장"],["{{書き出し}}","내 보내다"],["{{Discordへ移動}}","불화로 이동"],["{{バグ報告}}","버그 보고서"],["{{設定}}","환경"],["{{タブを追加}}","탭 추가"],["{{タブの一覧を表示・移動}}","탭 목록 보기 및 이동"],["{{スクリプトを追加}}","스크립트 추가"],["{{キーフレームを追加}}","키프레임 추가"],["{{空のキーフレームを追加}}","빈 키프레임 추가"],["{{フレームを追加}}","프레임 추가"],["{{フレームを削除}}","프레임 삭제"],["{{再生}}","놀다"],["{{停止}}","중지"],["{{ループ設定}}","루프 설정"],["{{レイヤーを追加}}","레이어 추가"],["{{レイヤーを削除}}","레이어 삭제"],["{{全てのレイヤーをハイライト}}","모든 레이어 강조 표시"],["{{全てのレイヤーを非表示}}","모든 레이어 숨기기"],["{{全てのレイヤーをロック}}","모든 레이어 잠금"],["{{比率を固定}}","고정 비율"],["{{ステージの幅}}","무대 폭"],["{{背景色}}","배경색"],["{{ステージの高さ}}","무대 높이"],["{{フレームレート}}","프레임 속도"],["{{シンボル名}}","기호 이름"],["{{イージング設定}}","이징 설정"],["{{ビデオの音量設定}}","비디오 볼륨 설정"],["{{自動再生}}","자동 재생"],["{{テキストエリアのボーダー設定}}","텍스트 영역 테두리 설정"],["{{テキスト入力設定}}","텍스트 입력 설정"],["{{フォント選択}}","글꼴 선택"],["{{自動サイズ調整}}","자동 크기 조정"],["{{フォントスタイルタイプ}}","글꼴 스타일 유형"],["{{行揃え}}","정렬 설정"],["{{改行設定}}","개행 설정"],["{{スクロール設定}}","스크롤 설정"],["{{フォントサイズ}}","글꼴 크기"],["{{フォントカラー}}","글꼴 색상"],["{{行間}}","줄 간격"],["{{文字幅}}","문자 너비"],["{{左マージン}}","왼쪽 여백"],["{{右マージン}}","오른쪽 여백"],["{{カラー種別の選択}}","색상 유형 선택"],["{{背景画像の選択}}","배경 이미지 선택"],["{{カラーポインターを追加}}","색상 포인터 추가"],["{{カラー値}}","색상"],["{{アルファ(0%-100%)}}","알파(0%-100%)"],["{{アルファ値}}","알파"],["{{選択対象の幅}}","선택 개체의 너비"],["{{選択対象のX座標}}","선택 객체의 X 좌표"],["{{選択対象の高さ}}","선택 개체의 높이"],["{{選択対象のY座標}}","선택 객체의 Y 좌표"],["{{選択対象の幅の伸縮}}","선택한 객체의 scaleX"],["{{選択対象を回転}}","개체 회전"],["{{選択対象の高さの伸縮}}","선택한 객체의 scaleY"],["{{アルファオフセット(-255〜255)}}","알파 오프셋(-255〜255)"],["{{赤(0%-100%)}}","빨간색(0%-100%)"],["{{赤オフセット(-255〜255)}}","레드 오프셋(-255〜255)"],["{{緑(0%-100%)}}","녹색(0%-100%)"],["{{緑オフセット(-255〜255)}}","그린 오프셋(-255〜255)"],["{{青(0%-100%)}}","파란색(0%-100%)"],["{{青オフセット(-255〜255)}}","블루 오프셋(-255〜255)"],["{{ブレンドモード}}","혼합 모드"],["{{フィルターを選択}}","필터 선택"],["{{フィルターを追加}}","필터 추가"],["{{サウンドを追加}}","소리 추가"],["{{フィルターを表示・非表示する}}","필터 표시 및 숨기기"],["{{フィルターを削除}}","필터 삭제"],["{{水平方向にぼかす}}","수평으로 흐림"],["{{垂直方向にぼかす}}","수직으로 흐림"],["{{フィルター強度}}","필터 강도"],["{{フィルター角度}}","필터 각도"],["{{シャドウのアルファ}}","섀도우 알파"],["{{シャドウのカラー}}","그림자 색상"],["{{フィルター距離}}","필터 거리"],["{{ハイライトのカラー}}","하이라이트 색상"],["{{ハイライトのアルファ}}","하이라이트 알파"],["{{グラデーションカラー}}","그라데이션 색상"],["{{グラデーションのアルファ}}","그라디언트 알파"],["{{タブの移動・名前を変更}}","탭 이동/이름 바꾸기"],["{{プロジェクトを閉じる}}","프로젝트 닫기"],["{{上下に移動}}","위아래로 이동"],["{{レイヤー変更(ダブルクリック)}}","레이어 변경(더블 클릭)"],["{{レイヤーをハイライト}}","하이라이트 레이어"],["{{レイヤーを非表示}}","레이어 숨기기"],["{{レイヤーをロック}}","레이어 잠금"],["{{カーブポインター(ダブルクリックでON/OFF)}}","곡선 포인터(켜기/끄려면 두 번 클릭)"],["{{インスタンス名}}","인스턴스 이름"],["{{ライブラリ内の検索}}","도서관에서 검색"],["{{フレームラベル}}","프레임 라벨"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","프로젝트를 저장하지 않으면 이 탭의 프로젝트 데이터를 복구할 수 없습니다. 탭을 삭제하시겠습니까?"]])}}class l extends t{constructor(){super()}createMapping(){return new Map([["{{プレビューのON/OFF}}","Включение/выключение предварительного просмотра"],["{{フォント枠サイズ}}","Размер рамки шрифта"],["{{フォント枠カラー}}","Цвет шрифтовой рамки"],["{{オニオンスキン}}","Луковая шкурка"],["{{バケツツール}}","Ведерные инструменты"],["{{ペンツール}}",'Инструмент "Перо'],["{{ダブルクリックでカーブポイントが追加されます}}","Дважды щелкните, чтобы добавить точку кривой"],["{{選択ツール}}","Инструменты выбора"],["{{Shape変形ツール}}","Инструмент преобразования формы"],["{{テキストツール}}","Текстовый инструмент"],["{{短形ツール}}",'Инструмент "Прямоугольник'],["{{楕円ツール}}",'Инструмент "Эллипс'],["{{角丸矩形ツール}}",'Инструмент "Скругленный прямоугольник'],["{{塗りのカラー}}","Цвет заливки"],["{{線のカラー}}","Цвет штриха"],["{{線の太さ}}","Ширина штриха"],["{{プロジェクトデータの読込}}","Загрузка данных проекта"],["{{プロジェクトデータを保存}}","Сохранить данные проекта"],["{{書き出し}}","Экспорт"],["{{Discordへ移動}}","Зайдите в дискорд"],["{{バグ報告}}","Сообщения об ошибках"],["{{設定}}","Настройка"],["{{タブを追加}}","Добавить вкладку"],["{{タブの一覧を表示・移動}}","Просмотр и перемещение по списку вкладок"],["{{スクリプトを追加}}","Добавить сценарий"],["{{キーフレームを追加}}","Добавить ключевой кадр"],["{{空のキーフレームを追加}}","Добавьте пустой ключевой кадр"],["{{フレームを追加}}","Добавить рамку"],["{{フレームを削除}}","Удалить рамку"],["{{再生}}","Играть"],["{{停止}}","Остановить"],["{{ループ設定}}","Настройка контура"],["{{レイヤーを追加}}","Добавить слой"],["{{レイヤーを削除}}","Удалить слой"],["{{全てのレイヤーをハイライト}}","Выделите все слои"],["{{全てのレイヤーを非表示}}","Скрыть все слои"],["{{全てのレイヤーをロック}}","Заблокируйте все слои"],["{{比率を固定}}","Фиксированный коэффициент"],["{{ステージの幅}}","Ширина сцены"],["{{背景色}}","Цвет фона"],["{{ステージの高さ}}","Высота сцены"],["{{フレームレート}}","Частота кадров"],["{{シンボル名}}","Название символа"],["{{イージング設定}}","Установка облегчения"],["{{ビデオの音量設定}}","Настройка громкости видео"],["{{自動再生}}","Автоматическое воспроизведение"],["{{テキストエリアのボーダー設定}}","Настройка границ текстовой области"],["{{テキスト入力設定}}","Настройка ввода текста"],["{{フォント選択}}","Выбор шрифта"],["{{自動サイズ調整}}","Автоматическая регулировка размера"],["{{フォントスタイルタイプ}}","Тип стиля шрифта"],["{{行揃え}}","Настройка выравнивания"],["{{改行設定}}","Установка новой строки"],["{{スクロール設定}}","Настройка прокрутки"],["{{フォントサイズ}}","Размер шрифта"],["{{フォントカラー}}","Цвет шрифта"],["{{行間}}","Пространство линии"],["{{文字幅}}","Ширина символа"],["{{左マージン}}","Левое поле"],["{{右マージン}}","Правая граница"],["{{カラー種別の選択}}","Выберите тип цвета"],["{{背景画像の選択}}","Выбор фонового изображения"],["{{カラーポインターを追加}}","Добавьте указатели цвета"],["{{カラー値}}","Цвет"],["{{アルファ(0%-100%)}}","Альфа(0%-100%)"],["{{アルファ値}}","Альфа"],["{{選択対象の幅}}","Ширина объекта выделения"],["{{選択対象のX座標}}","X координата объекта выделения"],["{{選択対象の高さ}}","Высота объекта выделения"],["{{選択対象のY座標}}","Y координата объекта выделения"],["{{選択対象の幅の伸縮}}","масштабX выбранного объекта"],["{{選択対象を回転}}","Повернуть объект"],["{{選択対象の高さの伸縮}}","scaleY выбранного объекта"],["{{アルファオフセット(-255〜255)}}","Альфа-смещение(-255〜255)"],["{{赤(0%-100%)}}","Красный(0%-100%)"],["{{赤オフセット(-255〜255)}}","Красное смещение(-255〜255)"],["{{緑(0%-100%)}}","Зеленый(0%-100%)"],["{{緑オフセット(-255〜255)}}","Зеленый зачет(-255〜255)"],["{{青(0%-100%)}}","Голубой(0%-100%)"],["{{青オフセット(-255〜255)}}","Синее смещение(-255〜255)"],["{{ブレンドモード}}","Режим наложения"],["{{フィルターを選択}}","Выберите фильтр"],["{{フィルターを追加}}","Добавить фильтр"],["{{サウンドを追加}}","Добавить звук"],["{{フィルターを表示・非表示する}}","Показать и скрыть фильтры"],["{{フィルターを削除}}","Удалить фильтр"],["{{水平方向にぼかす}}","Размытие по горизонтали"],["{{垂直方向にぼかす}}","Размытие по вертикали"],["{{フィルター強度}}","Прочность фильтра"],["{{フィルター角度}}","Угол фильтрации"],["{{シャドウのアルファ}}","Тень Альфа"],["{{シャドウのカラー}}","Цвет теней"],["{{フィルター距離}}","Расстояние между фильтрами"],["{{ハイライトのカラー}}","Цвет подсветки"],["{{ハイライトのアルファ}}","Выделение Альфа"],["{{グラデーションカラー}}","Цвет градиента"],["{{グラデーションのアルファ}}","Градиент Альфа"],["{{タブの移動・名前を変更}}","Переместить/именовать вкладки"],["{{プロジェクトを閉じる}}","Закрыть проект"],["{{上下に移動}}","Двигайтесь вверх и вниз"],["{{レイヤー変更(ダブルクリック)}}","Смена слоя (двойной щелчок)"],["{{レイヤーをハイライト}}","Выделительный слой"],["{{レイヤーを非表示}}","Скрыть слой"],["{{レイヤーをロック}}","Заблокировать слой"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Указатель кривой (двойной щелчок для включения/выключения)"],["{{インスタンス名}}","Имя экземпляра"],["{{ライブラリ内の検索}}","Поиск в библиотеке"],["{{フレームラベル}}","Рамочная этикетка"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Если проект не сохранен, данные проекта на этой вкладке не могут быть восстановлены. Вы хотите удалить вкладку?"]])}}class c extends t{constructor(){super()}createMapping(){return new Map([["{{プレビューのON/OFF}}","Activación/desactivación de la vista previa"],["{{フォント枠サイズ}}","Tamaño del marco de la fuente"],["{{フォント枠カラー}}","Color del marco de la fuente"],["{{オニオンスキン}}","Piel de cebolla"],["{{バケツツール}}","Herramientas para cubos"],["{{ペンツール}}","Herramienta de la pluma"],["{{ダブルクリックでカーブポイントが追加されます}}","Haga doble clic para añadir un punto de curva"],["{{選択ツール}}","Herramientas de selección"],["{{Shape変形ツール}}","Herramienta de transformación de formas"],["{{テキストツール}}","Herramienta de texto"],["{{短形ツール}}","Herramienta Rectángulo"],["{{楕円ツール}}","Herramienta Elipse"],["{{角丸矩形ツール}}","Herramienta Rectángulo Redondeado"],["{{塗りのカラー}}","Color de relleno"],["{{線のカラー}}","Color del trazo"],["{{線の太さ}}","Anchura de la carrera"],["{{プロジェクトデータの読込}}","Carga de los datos del proyecto"],["{{プロジェクトデータを保存}}","Guardar los datos del proyecto"],["{{書き出し}}","Exportar"],["{{Discordへ移動}}","Ir a la discordia"],["{{バグ報告}}","Informes de errores"],["{{設定}}","Configuración"],["{{タブを追加}}","Añadir una pestaña"],["{{タブの一覧を表示・移動}}","Ver y desplazarse por la lista de pestañas"],["{{スクリプトを追加}}","Añadir una secuencia de comandos"],["{{キーフレームを追加}}","Añadir un fotograma clave"],["{{空のキーフレームを追加}}","Añadir un fotograma clave vacío"],["{{フレームを追加}}","Añadir un marco"],["{{フレームを削除}}","Borrar el marco"],["{{再生}}","Juega a"],["{{停止}}","Detener"],["{{ループ設定}}","Ajuste del bucle"],["{{レイヤーを追加}}","Añadir una capa"],["{{レイヤーを削除}}","Eliminar la capa"],["{{全てのレイヤーをハイライト}}","Resaltar todas las capas"],["{{全てのレイヤーを非表示}}","Ocultar todas las capas"],["{{全てのレイヤーをロック}}","Bloquear todas las capas"],["{{比率を固定}}","Relación fija"],["{{ステージの幅}}","Anchura del escenario"],["{{背景色}}","Color de fondo"],["{{ステージの高さ}}","Altura del escenario"],["{{フレームレート}}","Velocidad de fotogramas"],["{{シンボル名}}","Nombre del símbolo"],["{{イージング設定}}","Ajuste de la flexibilización"],["{{ビデオの音量設定}}","Ajuste del volumen de vídeo"],["{{自動再生}}","Reproducción automática"],["{{テキストエリアのボーダー設定}}","Configuración del borde del área de texto"],["{{テキスト入力設定}}","Ajuste de la entrada de texto"],["{{フォント選択}}","Selección de fuentes"],["{{自動サイズ調整}}","Ajuste automático del tamaño"],["{{フォントスタイルタイプ}}","Tipo de letra"],["{{行揃え}}","Ajuste de la alineación"],["{{改行設定}}","Ajuste de la nueva línea"],["{{スクロール設定}}","Ajuste de desplazamiento"],["{{フォントサイズ}}","Tamaño de la fuente"],["{{フォントカラー}}","Color de la fuente"],["{{行間}}","Espacio de la línea"],["{{文字幅}}","Anchura de los caracteres"],["{{左マージン}}","Margen izquierdo"],["{{右マージン}}","Margen derecho"],["{{カラー種別の選択}}","Seleccione un tipo de color"],["{{背景画像の選択}}","Seleccionar una imagen de fondo"],["{{カラーポインターを追加}}","Añadir punteros de color"],["{{カラー値}}","Color"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Anchura del objeto de selección"],["{{選択対象のX座標}}","Coordenada X del objeto de selección"],["{{選択対象の高さ}}","Altura del objeto de selección"],["{{選択対象のY座標}}","Coordenada Y del objeto de selección"],["{{選択対象の幅の伸縮}}","scaleX del objeto seleccionado"],["{{選択対象を回転}}","Girar el objeto"],["{{選択対象の高さの伸縮}}","escalaY del objeto seleccionado"],["{{アルファオフセット(-255〜255)}}","Desplazamiento alfa(-255〜255)"],["{{赤(0%-100%)}}","Rojo(0%-100%)"],["{{赤オフセット(-255〜255)}}","Compensación roja(-255〜255)"],["{{緑(0%-100%)}}","Verde(0%-100%)"],["{{緑オフセット(-255〜255)}}","Compensación verde(-255〜255)"],["{{青(0%-100%)}}","Azul(0%-100%)"],["{{青オフセット(-255〜255)}}","Offset azul(-255〜255)"],["{{ブレンドモード}}","Modo de fusión"],["{{フィルターを選択}}","Seleccione un filtro"],["{{フィルターを追加}}","Añadir un filtro"],["{{サウンドを追加}}","Añadir un sonido"],["{{フィルターを表示・非表示する}}","Mostrar y ocultar filtros"],["{{フィルターを削除}}","Eliminar el filtro"],["{{水平方向にぼかす}}","Desenfoque horizontal"],["{{垂直方向にぼかす}}","Desenfoque vertical"],["{{フィルター強度}}","Fuerza del filtro"],["{{フィルター角度}}","Ángulo del filtro"],["{{シャドウのアルファ}}","Sombra Alfa"],["{{シャドウのカラー}}","Color de la sombra"],["{{フィルター距離}}","Distancia del filtro"],["{{ハイライトのカラー}}","Color de realce"],["{{ハイライトのアルファ}}","Resaltar Alpha"],["{{グラデーションカラー}}","Color degradado"],["{{グラデーションのアルファ}}","Gradiente Alfa"],["{{タブの移動・名前を変更}}","Mover/Renombrar pestañas"],["{{プロジェクトを閉じる}}","Cerrar el proyecto"],["{{上下に移動}}","Subir y bajar"],["{{レイヤー変更(ダブルクリック)}}","Cambio de capa (doble clic)"],["{{レイヤーをハイライト}}","Capa de resaltado"],["{{レイヤーを非表示}}","Ocultar capa"],["{{レイヤーをロック}}","Bloquear la capa"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Puntero de curva (doble clic para activar/desactivar)"],["{{インスタンス名}}","Nombre de la instancia"],["{{ライブラリ内の検索}}","Buscar en la biblioteca"],["{{フレームラベル}}","Etiqueta del marco"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Si el proyecto no se guarda, los datos del proyecto en esta pestaña no se pueden recuperar. ¿Desea eliminar la pestaña?"]])}}const d={VERSION:1,PREFIX:"__next2d-tools__",STAGE_MIN_SIZE:1,STAGE_MAX_SIZE:3e3,FONT_DEFAULT_SIZE:200,FONT_MIN_SIZE:10,FONT_MAX_SIZE:255,FONT_PARAM_MIN_SIZE:0,FONT_PARAM_MAX_SIZE:255,STAGE_DEFAULT_WIDTH:550,STAGE_DEFAULT_HEIGHT:400,STAGE_DEFAULT_FPS:24,STAGE_MIN_FPS:1,STAGE_MAX_FPS:60,STROKE_MIN_SIZE:0,STROKE_MAX_SIZE:200,STAGE_DEFAULT_COLOR:"#ffffff",TOOLS_FILL_DEFAULT_COLOR:"#000000",TOOLS_STROKE_DEFAULT_COLOR:"#000000",COLOR_MIN_OFFSET:-255,COLOR_MAX_OFFSET:255,COLOR_MIN_MULTIPLIER:0,COLOR_MAX_MULTIPLIER:100,MIN_INT:-32768,MAX_INT:32767,MIN_ROTATE:-360,MAX_ROTATE:360,MIN_COLOR:0,MAX_COLOR:255,MIN_BLUR:0,MAX_BLUR:255,MIN_STRENGTH:0,MAX_STRENGTH:255,MIN_DISTANCE:-255,MAX_DISTANCE:255,LAYER_MODE_NORMAL:0,LAYER_MODE_MASK:1,LAYER_MODE_MASK_IN:2,TIMELINE_DEFAULT_SIZE:280,TIMELINE_MIN_SIZE:150,CONTROLLER_DEFAULT_SIZE:360,REVISION_LIMIT:100,STAGE_SKIP_TARGETA:10,GRADIENT_CANVAS_WIDTH:255,GRADIENT_CANVAS_HEIGHT:30,SCRIPT_MODAL_WIDTH:620,SCRIPT_MODAL_HEIGHT:450,SCRIPT_MODAL_BAR_HEIGHT:25,MIN_VOLUME:0,MAX_VOLUME:100,$activeWorkSpaceId:0,$workSpaces:[],$readStatus:0,$readEnd:5,$shiftKey:!1,$zoomScale:1,$frameWidth:65,$root:null};d.$Rad2Deg=180/Math.PI,d.$Deg2Rad=Math.PI/180,d.$keyLock=!1,d.$activeScript=!1,d.$previewMod=!1,d.$offsetLeft=0,d.$offsetTop=0,d.$currentCursor="auto",d.$useIds=new Map,d.$symbols=new Map,d.$copyWorkSpaceId=-1,d.$copyLibrary=null,d.$copyLayer=null,d.$copyCharacter=null,d.$canCopyLayer=!1,d.$canCopyCharacter=!1,d.$hitColor=null,d.$updated=!1,d.$languages=new Map,d.$currentLanguage=null,d.$shapePointerColor="#009900",d.$shapeLinkedPointerColor="#ffa500",d.$isMac=window.navigator.userAgent.indexOf("Mac")>-1;const h=document.createElement("canvas");h.width=1,h.height=1,d.$hitContext=h.getContext("2d"),d.$transformTargets=["scale-top-left","scale-top-right","scale-bottom-left","scale-bottom-right","scale-center-left","scale-center-top","scale-center-right","scale-center-bottom","target-rect","target-rotation"],d.$gridTargets=["grid-top-left","grid-top-right","grid-bottom-left","grid-bottom-right"],d.$emptyImage=new Image,d.$emptyImage.draggable=!1,d.$clamp=function(e,t,a){const s=+e;return Math.min(Math.max(t,isNaN(s)?0:s),a)},d.$isArray=function(e){return Array.isArray(e)},d.$setCursor=function(e="auto"){d.$currentCursor!==e&&(d.$currentCursor=e,document.documentElement.style.setProperty("--tool-cursor",e))},d.$addModalEvent=function(e){const t=e.querySelectorAll("[data-detail]");for(let e=0;e<t.length;++e){const a=t[e];a.addEventListener("mouseover",(function(e){const t=d.$tools.getUserPublishSetting();if("modal"in t&&!t.modal)return;const a=document.getElementById("detail-modal");switch(a.textContent=d.$currentLanguage.replace(e.currentTarget.dataset.detail),!0){case a.clientWidth+e.pageX-20>window.innerWidth:a.style.left=e.pageX-(a.clientWidth+e.pageX+10-window.innerWidth)+"px";break;case 0>e.pageX-20:a.style.left="10px";break;default:a.style.left=e.pageX-20+"px"}if(!0==a.clientHeight+e.pageY+20>window.innerHeight)a.style.top=e.pageY-a.clientHeight-20+"px";else a.style.top=`${e.pageY+20}px`;a.setAttribute("class","fadeIn"),a.dataset.timerId=setTimeout(function(){this.classList.contains("fadeOut")||this.setAttribute("class","fadeOut")}.bind(a),1500)})),a.addEventListener("mouseout",(function(){const e=d.$tools.getUserPublishSetting();if("modal"in e&&!e.modal)return;const t=document.getElementById("detail-modal");clearTimeout(0|t.dataset.timerId),t.setAttribute("class","fadeOut")}))}},d.$endMenu=function(e){const t=["timeline-menu","library-menu","tab-name-menu","timeline-layer-menu","scene-name-menu","user-setting","screen-menu","editor-modal"];for(let a=0;a<t.length;++a){const s=t[a];if(s===e)continue;const r=document.getElementById(s);r.classList.contains("fadeIn")&&r.setAttribute("class","fadeOut"),"editor-modal"===s&&d.$timeline._$actionFrame>0&&d.$timeline.saveActionScript()}},d.$changeScene=function(e){const t=document.getElementById("scene-name-menu-list");for(;t.children.length;)t.children[0].remove();const a=d.$currentWorkSpace();a.root.addSceneName(),document.getElementById("current-frame").textContent="1",document.getElementById("timeline-marker").style.left="0px";document.getElementById("timeline-controller-base").scrollLeft&&d.$timeline.moveTimeLine(0),a.scene=a.getLibrary(0|e.currentTarget.dataset.libraryId)},d.$loadSaveData=function(){const e=localStorage.getItem(`${d.PREFIX}@save-data`);if(e){let t=e.length,a=new Uint8Array(t);for(let s=0;s<t;++s)a[s]=255&e.charCodeAt(s);d.$unZlibWorker.postMessage({buffer:a,type:"local"},[a.buffer])}else d.$workSpaces.push(new O),d.$screen.initializeTab(),d.$initializeEnd()},d.$multiplicationMatrix=function(e,t){return new Float32Array([e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]])},d.$keyCommandFunction=function(e){switch(d.$shiftKey=e.shiftKey,e.code){case"ArrowRight":case"ArrowLeft":case"ArrowDown":case"ArrowUp":if(!d.$keyLock)return e.preventDefault(),!1;break;case"KeyS":if(e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)return e.preventDefault(),d.$autoSave(),!1;break;case"KeyZ":if(e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)return e.preventDefault(),d.$screen.clearActiveCharacter(),d.$screen.clearTweenMarker(),d.$tools.deactiveStageAreaNode(),d.$currentWorkSpace()&&(e.shiftKey?d.$currentWorkSpace().redo():d.$currentWorkSpace().undo()),!1;break;case"Enter":if(e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey){if(d.$previewMode)return!1;if(!d.$keyLock||d.$keyLock&&d.$activeScript)return e.preventDefault(),d.$showPreview(),!1}d.$keyLock||d.$activeScript||(e.preventDefault(),d.$timeline._$stopFlag?d.$timeline.play():d.$timeline.stop());break;case"Escape":if(d.$previewMode)return e.preventDefault(),d.$hidePreview(),!1}},d.$initialize=function(){window.removeEventListener("DOMContentLoaded",d.$initialize),d.$filterClasses={BevelFilter:x,BlurFilter:w,DropShadowFilter:M,GlowFilter:B,GradientBevelFilter:T,GradientGlowFilter:C},d.$languages.set("Japanese",n),d.$languages.set("English",s),d.$languages.set("Chinese",a),d.$languages.set("Korean",o),d.$languages.set("French",r),d.$languages.set("Russia",l),d.$languages.set("Italiano",i),d.$languages.set("Spanish",c);let e=localStorage.getItem(`${d.PREFIX}@language-setting`);if(!e)switch(navigator.language){case"ja":e="Japanese";break;case"ko":e="Korean";break;case"zh":e="Chinese";break;case"fr":e="French";break;case"ru":e="Russia";break;case"it":e="Italiano";break;case"es":e="Spanish";break;default:e="English"}const t=d.$languages.get(e);d.$currentLanguage=new t,d.$loadSaveData(),window.addEventListener("keydown",d.$keyCommandFunction),window.addEventListener("keyup",(function(){d.$shiftKey=!1})),window.addEventListener("beforeunload",(function(e){d.$updated&&(e.preventDefault(),e.returnValue="データ保存中...",d.$autoSave())}));const h=d.STAGE_DEFAULT_WIDTH,m=d.STAGE_DEFAULT_HEIGHT,u=d.STAGE_DEFAULT_FPS,f=document.getElementById("preview-display");f.style.width=`${h}px`,f.style.height=`${m}px`,d.$root=window.next2d.createRootMovieClip(h,m,u,{tagId:"preview-display"}),d.$root.stage._$player.stop(),document.getElementById("preview-stop").addEventListener("click",d.$hidePreview);document.documentElement.style.setProperty("--ad","260px"),d.$initialize=null},window.addEventListener("DOMContentLoaded",d.$initialize),d.$showPreview=function(){d.$timeline.saveActionScript(),d.$previewMode=!0,d.$keyLock=!0;const e=document.getElementById("player-preview");e.style.display="",e.style.zIndex="9999";const t=d.$currentWorkSpace(),a=document.getElementById("preview-display");a.style.width=`${t.stage.width}px`,a.style.height=`${t.stage.height}px`;const s=document.getElementById("preview-stop");s.style.top=a.offsetTop-20+"px",s.style.left=`${a.offsetLeft+t.stage.width}px`,s.addEventListener("click",d.$hidePreview);const r=d.$root.stage;r.frameRate=0|document.getElementById("stage-fps").value;const i=r._$player;i.width=t.stage.width,i.height=t.stage.height,i._$resize(),r.clearGlobalVariable(),r._$events=new Map,i._$broadcastEvents=new Map;const n=u.toJSON();d.$useIds.clear();const{Loader:o}=window.next2d.display,{URLRequest:l}=window.next2d.net,{Event:c}=window.next2d.events,h=new o;h.contentLoaderInfo.addEventListener(c.COMPLETE,(function(e){const t=e.currentTarget,a=d.$root.stage,s=a._$player,r=t._$data;s.width=r.stage.width,s.height=r.stage.height,s.stage.frameRate=r.stage.fps;const i=d.$intToRGB(0|`0x${r.stage.bgColor.substr(1)}`);for(s._$context._$setColor(i.R/255,i.G/255,i.B/255,1),s._$backgroundColor=[i.R/255,i.G/255,i.B/255,1],d.$root=null,d.$root=t.content;a.numChildren;)a.removeChildAt(0);a.addChild(d.$root),s._$cacheStore.reset(),s.play()})),h.load(new l(URL.createObjectURL(new Blob([n],{type:"application/json"})))),i._$broadcastEvents.clear(),window.next2d.media.SoundMixer.volume=1,i._$loadStatus=1,i._$updateLoadStatus()},d.$hidePreview=function(){document.getElementById("preview-stop").removeEventListener("click",d.$hidePreview);const e=document.getElementById("player-preview");for(e.style.display="none",e.style.zIndex="0",d.$previewMode=!1,d.$activeScript||(d.$keyLock=!1);d.$root.numChildren;)d.$root.removeChild(d.$root.getChildAt(0));d.$root.stage._$player.stop()},d.$toJSON=function(){const e=[],t=document.getElementById("view-tab-area").children;for(let a=0;a<t.length;++a){const s=t[a],r=d.$workSpaces[0|s.dataset.tabId];r&&e.push(r.toJSON())}return JSON.stringify(e)},d.$autoSave=function(){d.$timeline.saveActionScript();const e={object:d.$toJSON(),type:"local"};d.$zlibWorkerActive?d.$zlibQueues.push(e):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(e))},d.$currentWorkSpace=function(){return d.$workSpaces[d.$activeWorkSpaceId]},d.$initializeEnd=function(){d.$readStatus++,d.$readStatus===d.$readEnd&&(d.$currentWorkSpace().run(),d.$controller.createSoundListArea())},d.$changeWorkSpace=function(e){d.$currentWorkSpace().stop(),d.$activeWorkSpaceId=0|e,d.$currentWorkSpace().run()},d.$unZlibWorker=new Worker(URL.createObjectURL(new Blob(['/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";let t,i=this;function r(r,e){let s=r.split("."),h=i;!(s[0]in h)&&h.execScript&&h.execScript("var "+s[0]);for(var n;s.length&&(n=s.shift());)s.length||e===t?h=h[n]?h[n]:h[n]={}:h[n]=e}let e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function s(t){let i,r,s,h,n,a,f,o,l,u,c=t.length,b=0,y=Number.POSITIVE_INFINITY;for(o=0;o<c;++o)t[o]>b&&(b=t[o]),t[o]<y&&(y=t[o]);for(i=1<<b,r=new(e?Uint32Array:Array)(i),s=1,h=0,n=2;s<=b;){for(o=0;o<c;++o)if(t[o]===s){for(a=0,f=h,l=0;l<s;++l)a=a<<1|1&f,f>>=1;for(u=s<<16|o,l=a;l<i;l+=n)r[l]=u;++h}++s,h<<=1,n<<=1}return[r,b,y]}function h(t,i){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=e?new Uint8Array(t):t,this.m=!1,this.i=a,this.r=!1,!i&&(i={})||(i.index&&(this.a=i.index),i.bufferSize&&(this.h=i.bufferSize),i.bufferType&&(this.i=i.bufferType),i.resize&&(this.r=i.resize)),this.i){case n:this.b=32768,this.c=new(e?Uint8Array:Array)(32768+this.h+258);break;case a:this.b=0,this.c=new(e?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var n=0,a=1,f={t:n,s:a};h.prototype.k=function(){for(;!this.m;){let N=T(this,3);switch(1&N&&(this.m=!0),N>>>=1,N){case 0:var i=this.input,r=this.a,h=this.c,f=this.b,o=i.length,l=t,u=h.length,b=t;if(this.d=this.f=0,r+1>=o)throw Error("invalid uncompressed block header: LEN");if(l=i[r++]|i[r++]<<8,r+1>=o)throw Error("invalid uncompressed block header: NLEN");if(l===~(i[r++]|i[r++]<<8))throw Error("invalid uncompressed block header: length verify");if(r+l>i.length)throw Error("input buffer is broken");switch(this.i){case n:for(;f+l>h.length;){if(l-=b=u-f,e)h.set(i.subarray(r,r+b),f),f+=b,r+=b;else for(;b--;)h[f++]=i[r++];this.b=f,h=this.e(),f=this.b}break;case a:for(;f+l>h.length;)h=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(e)h.set(i.subarray(r,r+l),f),f+=l,r+=l;else for(;l--;)h[f++]=i[r++];this.a=r,this.b=f,this.c=h;break;case 1:this.j(E,I);break;case 2:var y,p,d,g,w=T(this,5)+257,A=T(this,5)+1,v=T(this,4)+4,k=new(e?Uint8Array:Array)(c.length),U=t,m=t,z=t,j=t,x=t;for(x=0;x<v;++x)k[c[x]]=T(this,3);if(!e)for(x=v,v=k.length;x<v;++x)k[c[x]]=0;for(y=s(k),U=new(e?Uint8Array:Array)(w+A),x=0,g=w+A;x<g;)switch(m=S(this,y)){case 16:for(j=3+T(this,2);j--;)U[x++]=z;break;case 17:for(j=3+T(this,3);j--;)U[x++]=0;z=0;break;case 18:for(j=11+T(this,7);j--;)U[x++]=0;z=0;break;default:z=U[x++]=m}p=s(e?U.subarray(0,w):U.slice(0,w)),d=s(e?U.subarray(w):U.slice(w)),this.j(p,d);break;default:throw Error("unknown BTYPE: "+N)}}return this.n()};var o,l,u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=e?new Uint16Array(u):u,b=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],y=e?new Uint16Array(b):b,p=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],d=e?new Uint8Array(p):p,g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],w=e?new Uint16Array(g):g,A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],v=e?new Uint8Array(A):A,k=new(e?Uint8Array:Array)(288);for(o=0,l=k.length;o<l;++o)k[o]=143>=o?8:255>=o?9:279>=o?7:8;var U,m,E=s(k),z=new(e?Uint8Array:Array)(30);for(U=0,m=z.length;U<m;++U)z[U]=5;var I=s(z);function T(t,i){for(var r,e=t.f,s=t.d,h=t.input,n=t.a,a=h.length;s<i;){if(n>=a)throw Error("input buffer is broken");e|=h[n++]<<s,s+=8}return r=e&(1<<i)-1,t.f=e>>>i,t.d=s-i,t.a=n,r}function S(t,i){for(var r,e,s=t.f,h=t.d,n=t.input,a=t.a,f=n.length,o=i[0],l=i[1];h<l&&!(a>=f);)s|=n[a++]<<h,h+=8;if((e=(r=o[s&(1<<l)-1])>>>16)>h)throw Error("invalid code length: "+e);return t.f=s>>e,t.d=h-e,t.a=a,65535&r}function j(t,i){let r,e;if(this.input=t,this.a=0,!i&&(i={})||(i.index&&(this.a=i.index),i.verify&&(this.A=i.verify)),r=t[this.a++],e=t[this.a++],(15&r)!==x)throw Error("unsupported compression method");if(this.method=x,0!=((r<<8)+e)%31)throw Error("invalid fcheck flag:"+((r<<8)+e)%31);if(32&e)throw Error("fdict flag is not supported");this.q=new h(t,{index:this.a,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}h.prototype.j=function(t,i){let r=this.c,e=this.b;this.o=t;for(var s,h,n,a,f=r.length-258;256!==(s=S(this,t));)if(256>s)e>=f&&(this.b=e,r=this.e(),e=this.b),r[e++]=s;else for(a=y[h=s-257],0<d[h]&&(a+=T(this,d[h])),s=S(this,i),n=w[s],0<v[s]&&(n+=T(this,v[s])),e>=f&&(this.b=e,r=this.e(),e=this.b);a--;)r[e]=r[e++-n];for(;8<=this.d;)this.d-=8,this.a--;this.b=e},h.prototype.w=function(t,i){let r=this.c,e=this.b;this.o=t;for(var s,h,n,a,f=r.length;256!==(s=S(this,t));)if(256>s)e>=f&&(r=this.e(),f=r.length),r[e++]=s;else for(a=y[h=s-257],0<d[h]&&(a+=T(this,d[h])),s=S(this,i),n=w[s],0<v[s]&&(n+=T(this,v[s])),e+a>f&&(r=this.e(),f=r.length);a--;)r[e]=r[e++-n];for(;8<=this.d;)this.d-=8,this.a--;this.b=e},h.prototype.e=function(){let t,i,r=new(e?Uint8Array:Array)(this.b-32768),s=this.b-32768,h=this.c;if(e)r.set(h.subarray(32768,r.length));else for(t=0,i=r.length;t<i;++t)r[t]=h[t+32768];if(this.g.push(r),this.l+=r.length,e)h.set(h.subarray(s,s+32768));else for(t=0;32768>t;++t)h[t]=h[s+t];return this.b=32768,h},h.prototype.z=function(t){let i,r,s,h,n=this.input.length/this.a+1|0,a=this.input,f=this.c;return t&&("number"==typeof t.p&&(n=t.p),"number"==typeof t.u&&(n+=t.u)),2>n?(r=(a.length-this.a)/this.o[2],h=r/2*258|0,s=h<f.length?f.length+h:f.length<<1):s=f.length*n,e?(i=new Uint8Array(s),i.set(f)):i=f,this.c=i},h.prototype.n=function(){let t,i,r,s,h,n=0,a=this.c,f=this.g,o=new(e?Uint8Array:Array)(this.l+(this.b-32768));if(0===f.length)return e?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(i=0,r=f.length;i<r;++i)for(t=f[i],s=0,h=t.length;s<h;++s)o[n++]=t[s];for(i=32768,r=this.b;i<r;++i)o[n++]=a[i];return this.g=[],this.buffer=o},h.prototype.v=function(){let t,i=this.b;return e?this.r?(t=new Uint8Array(i),t.set(this.c.subarray(0,i))):t=this.c.subarray(0,i):(this.c.length>i&&(this.c.length=i),t=this.c),this.buffer=t},j.prototype.k=function(){let t,i,r=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){i=(r[this.a++]<<24|r[this.a++]<<16|r[this.a++]<<8|r[this.a++])>>>0;let f=t;if("string"==typeof f){let t,i,r=f.split("");for(t=0,i=r.length;t<i;t++)r[t]=(255&r[t].charCodeAt(0))>>>0;f=r}for(var e,s=1,h=0,n=f.length,a=0;0<n;){n-=e=1024<n?1024:n;do{h+=s+=f[a++]}while(--e);s%=65521,h%=65521}if(i!==(h<<16|s)>>>0)throw Error("invalid adler-32 checksum")}return t};var x=8;r("Zlib.Inflate",j),r("Zlib.Inflate.prototype.decompress",j.prototype.k);let N,C,L,O,Z={ADAPTIVE:f.s,BLOCK:f.t};if(Object.keys)N=Object.keys(Z);else for(C in N=[],L=0,Z)N[L++]=C;for(L=0,O=N.length;L<O;++L)C=N[L],r("Zlib.Inflate.BufferType."+C,Z[C])}).call(this),this.addEventListener("message",(function(t){const i=new Zlib.Inflate(t.data.buffer).decompress();let r="";for(let t=0;t<i.length;t+=4096)r+=String.fromCharCode.apply(null,i.slice(t,t+4096));this.postMessage({json:r,type:t.data.type})}));'],{type:"text/javascript"}))),d.$unZlibWorker.onmessage=function(e){if("n2d"===e.data.type){const t=new O(decodeURIComponent(e.data.json));d.$workSpaces.push(t),d.$screen.addTab(t,d.$workSpaces.length-1)}else{const t=JSON.parse(decodeURIComponent(e.data.json));for(let e=0;e<t.length;++e)d.$workSpaces.push(new O(t[e]));d.$workSpaces.length||d.$workSpaces.push(new O),d.$screen.initializeTab(),d.$initializeEnd()}},d.$zlibWorker=new Worker(URL.createObjectURL(new Blob(['/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";let e,r=!0,t=this;function n(r,n){let a=r.split("."),i=t;!(a[0]in i)&&i.execScript&&i.execScript("var "+a[0]);for(var s;a.length&&(s=a.shift());)a.length||n===e?i=i[s]?i[s]:i[s]={}:i[s]=n}let a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function i(e,r){if(this.index="number"==typeof r?r:0,this.e=0,this.buffer=e instanceof(a?Uint8Array:Array)?e:new(a?Uint8Array:Array)(32768),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&s(this)}function s(e){let r,t=e.buffer,n=t.length,i=new(a?Uint8Array:Array)(n<<1);if(a)i.set(t);else for(r=0;r<n;++r)i[r]=t[r];return e.buffer=i}i.prototype.b=function(e,r,t){let n,a=this.buffer,i=this.index,f=this.e,h=a[i];if(t&&1<r&&(e=8<r?(l[255&e]<<24|l[e>>>8&255]<<16|l[e>>>16&255]<<8|l[e>>>24&255])>>32-r:l[e]>>8-r),8>r+f)h=h<<r|e,f+=r;else for(n=0;n<r;++n)h=h<<1|e>>r-n-1&1,8==++f&&(f=0,a[i++]=l[h],h=0,i===a.length&&(a=s(this)));a[i]=h,this.buffer=a,this.e=f,this.index=i},i.prototype.finish=function(){let e,r=this.buffer,t=this.index;return 0<this.e&&(r[t]<<=8-this.e,r[t]=l[r[t]],t++),a?e=r.subarray(0,t):(r.length=t,e=r),e};let f,h=new(a?Uint8Array:Array)(256);for(f=0;256>f;++f){for(var o=c=f,u=7,c=c>>>1;c;c>>>=1)o<<=1,o|=1&c,--u;h[f]=(o<<u&255)>>>0}var l=h;function b(e){this.buffer=new(a?Uint16Array:Array)(2*e),this.length=0}function y(e,r){this.d=g,this.i=0,this.input=a&&e instanceof Array?new Uint8Array(e):e,this.c=0,r&&(r.lazy&&(this.i=r.lazy),"number"==typeof r.compressionType&&(this.d=r.compressionType),r.outputBuffer&&(this.a=a&&r.outputBuffer instanceof Array?new Uint8Array(r.outputBuffer):r.outputBuffer),"number"==typeof r.outputIndex&&(this.c=r.outputIndex)),this.a||(this.a=new(a?Uint8Array:Array)(32768))}b.prototype.getParent=function(e){return 2*((e-2)/4|0)},b.prototype.push=function(e,r){let t,n,a,i=this.buffer;for(t=this.length,i[this.length++]=r,i[this.length++]=e;0<t&&(n=this.getParent(t),i[t]>i[n]);)a=i[t],i[t]=i[n],i[n]=a,a=i[t+1],i[t+1]=i[n+1],i[n+1]=a,t=n;return this.length},b.prototype.pop=function(){let e,r,t,n,a,i=this.buffer;for(r=i[0],e=i[1],this.length-=2,i[0]=i[this.length],i[1]=i[this.length+1],a=0;(n=2*a+2,!(n>=this.length))&&(n+2<this.length&&i[n+2]>i[n]&&(n+=2),i[n]>i[a]);)t=i[a],i[a]=i[n],i[n]=t,t=i[a+1],i[a+1]=i[n+1],i[n+1]=t,a=n;return{index:e,value:r,length:this.length}};var p,g=2,A={NONE:0,h:1,g:g,n:3},k=[];for(p=0;288>p;p++)switch(r){case 143>=p:k.push([p+48,8]);break;case 255>=p:k.push([p-144+400,9]);break;case 279>=p:k.push([p-256+0,7]);break;case 287>=p:k.push([p-280+192,8]);break;default:throw"invalid literal: "+p}function w(e,r){this.length=e,this.k=r}y.prototype.f=function(){let t,n,s,f,h=this.input;switch(this.d){case 0:for(s=0,f=h.length;s<f;){n=a?h.subarray(s,s+65535):h.slice(s,s+65535),s+=n.length;let r=n,t=s===f,i=e,o=e,u=e,c=e,l=e,b=this.a,y=this.c;if(a){for(b=new Uint8Array(this.a.buffer);b.length<=y+r.length+5;)b=new Uint8Array(b.length<<1);b.set(this.a)}if(i=t?1:0,b[y++]=0|i,o=r.length,u=65536+~o&65535,b[y++]=255&o,b[y++]=o>>>8&255,b[y++]=255&u,b[y++]=u>>>8&255,a)b.set(r,y),y+=r.length,b=b.subarray(0,y);else{for(c=0,l=r.length;c<l;++c)b[y++]=r[c];b.length=y}this.c=y,this.a=b}break;case 1:var o=new i(a?new Uint8Array(this.a.buffer):this.a,this.c);o.b(1,1,r),o.b(1,2,r);var u,c,l,b=v(this,h);for(u=0,c=b.length;u<c;u++)if(l=b[u],i.prototype.b.apply(o,k[l]),256<l)o.b(b[++u],b[++u],r),o.b(b[++u],5),o.b(b[++u],b[++u],r);else if(256===l)break;this.a=o.finish(),this.c=this.a.length;break;case g:var y,p,A,w,d,U,m,D,E,j,O,Z,B,C,I,M=new i(a?new Uint8Array(this.a.buffer):this.a,this.c),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=Array(19);for(y=g,M.b(1,1,r),M.b(y,2,r),p=v(this,h),m=N(U=x(this.m,15)),E=N(D=x(this.l,7)),A=286;257<A&&0===U[A-1];A--);for(w=30;1<w&&0===D[w-1];w--);var S,L,P,F,G,J,R=A,V=w,X=new(a?Uint32Array:Array)(R+V),Y=new(a?Uint32Array:Array)(316),q=new(a?Uint8Array:Array)(19);for(S=L=0;S<R;S++)X[L++]=U[S];for(S=0;S<V;S++)X[L++]=D[S];if(!a)for(S=0,F=q.length;S<F;++S)q[S]=0;for(S=G=0,F=X.length;S<F;S+=L){for(L=1;S+L<F&&X[S+L]===X[S];++L);if(P=L,0===X[S])if(3>P)for(;0<P--;)Y[G++]=0,q[0]++;else for(;0<P;)(J=138>P?P:138)>P-3&&J<P&&(J=P-3),10>=J?(Y[G++]=17,Y[G++]=J-3,q[17]++):(Y[G++]=18,Y[G++]=J-11,q[18]++),P-=J;else if(Y[G++]=X[S],q[X[S]]++,3>--P)for(;0<P--;)Y[G++]=X[S],q[X[S]]++;else for(;0<P;)(J=6>P?P:6)>P-3&&J<P&&(J=P-3),Y[G++]=16,Y[G++]=J-3,q[16]++,P-=J}for(t=a?Y.subarray(0,G):Y.slice(0,G),j=x(q,7),C=0;19>C;C++)z[C]=j[T[C]];for(d=19;4<d&&0===z[d-1];d--);for(O=N(j),M.b(A-257,5,r),M.b(w-1,5,r),M.b(d-4,4,r),C=0;C<d;C++)M.b(z[C],3,r);for(C=0,I=t.length;C<I;C++)if(Z=t[C],M.b(O[Z],j[Z],r),16<=Z){switch(C++,Z){case 16:B=2;break;case 17:B=3;break;case 18:B=7;break;default:throw"invalid code: "+Z}M.b(t[C],B,r)}var H,K,Q,W,$,_,ee,re,te=[m,U],ne=[E,D];for($=te[0],_=te[1],ee=ne[0],re=ne[1],H=0,K=p.length;H<K;++H)if(Q=p[H],M.b($[Q],_[Q],r),256<Q)M.b(p[++H],p[++H],r),W=p[++H],M.b(ee[W],re[W],r),M.b(p[++H],p[++H],r);else if(256===Q)break;this.a=M.finish(),this.c=this.a.length;break;default:throw"invalid compression type"}return this.a};let d=function(){function e(e){switch(r){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:throw"invalid length: "+e}}let t,n,a=[];for(t=3;258>=t;t++)n=e(t),a[t]=n[2]<<24|n[1]<<16|n[0];return a}(),U=a?new Uint32Array(d):d;function v(t,n){function i(e,t){let n,a,i,s,f=e.k,h=[],o=0;switch(n=U[e.length],h[o++]=65535&n,h[o++]=n>>16&255,h[o++]=n>>24,r){case 1===f:a=[0,f-1,0];break;case 2===f:a=[1,f-2,0];break;case 3===f:a=[2,f-3,0];break;case 4===f:a=[3,f-4,0];break;case 6>=f:a=[4,f-5,1];break;case 8>=f:a=[5,f-7,1];break;case 12>=f:a=[6,f-9,2];break;case 16>=f:a=[7,f-13,2];break;case 24>=f:a=[8,f-17,3];break;case 32>=f:a=[9,f-25,3];break;case 48>=f:a=[10,f-33,4];break;case 64>=f:a=[11,f-49,4];break;case 96>=f:a=[12,f-65,5];break;case 128>=f:a=[13,f-97,5];break;case 192>=f:a=[14,f-129,6];break;case 256>=f:a=[15,f-193,6];break;case 384>=f:a=[16,f-257,7];break;case 512>=f:a=[17,f-385,7];break;case 768>=f:a=[18,f-513,8];break;case 1024>=f:a=[19,f-769,8];break;case 1536>=f:a=[20,f-1025,9];break;case 2048>=f:a=[21,f-1537,9];break;case 3072>=f:a=[22,f-2049,10];break;case 4096>=f:a=[23,f-3073,10];break;case 6144>=f:a=[24,f-4097,11];break;case 8192>=f:a=[25,f-6145,11];break;case 12288>=f:a=[26,f-8193,12];break;case 16384>=f:a=[27,f-12289,12];break;case 24576>=f:a=[28,f-16385,13];break;case 32768>=f:a=[29,f-24577,13];break;default:throw"invalid distance"}for(n=a,h[o++]=n[0],h[o++]=n[1],h[o++]=n[2],i=0,s=h.length;i<s;++i)g[A++]=h[i];w[h[0]]++,d[h[3]]++,k=e.length+t-1,b=null}var s,f,h,o,u,c,l,b,y,p={},g=a?new Uint16Array(2*n.length):[],A=0,k=0,w=new(a?Uint32Array:Array)(286),d=new(a?Uint32Array:Array)(30),v=t.i;if(!a){for(h=0;285>=h;)w[h++]=0;for(h=0;29>=h;)d[h++]=0}for(w[256]=1,s=0,f=n.length;s<f;++s){for(h=u=0,o=3;h<o&&s+h!==f;++h)u=u<<8|n[s+h];if(p[u]===e&&(p[u]=[]),c=p[u],!(0<k--)){for(;0<c.length&&32768<s-c[0];)c.shift();if(s+3>=f){for(b&&i(b,-1),h=0,o=f-s;h<o;++h)y=n[s+h],g[A++]=y,++w[y];break}0<c.length?(l=m(n,s,c),b?b.length<l.length?(y=n[s-1],g[A++]=y,++w[y],i(l,0)):i(b,-1):l.length<v?b=l:i(l,0)):b?i(b,-1):(y=n[s],g[A++]=y,++w[y])}c.push(s)}return g[A++]=256,w[256]++,t.m=w,t.l=d,a?g.subarray(0,A):g}function m(e,r,t){let n,a,i,s,f,h,o=0,u=e.length;s=0,h=t.length;e:for(;s<h;s++){if(n=t[h-s-1],i=3,3<o){for(f=o;3<f;f--)if(e[n+f-1]!==e[r+f-1])continue e;i=o}for(;258>i&&r+i<u&&e[n+i]===e[r+i];)++i;if(i>o&&(a=n,o=i),258===i)break}return new w(o,r-a)}function x(e,r){let t,n,i,s,f,h=e.length,o=new b(572),u=new(a?Uint8Array:Array)(h);if(!a)for(s=0;s<h;s++)u[s]=0;for(s=0;s<h;++s)0<e[s]&&o.push(s,e[s]);if(t=Array(o.length/2),n=new(a?Uint32Array:Array)(o.length/2),1===t.length)return u[o.pop().index]=1,u;for(s=0,f=o.length/2;s<f;++s)t[s]=o.pop(),n[s]=t[s].value;for(i=function(e,r,t){function n(e){let t=y[e][p[e]];t===r?(n(e+1),n(e+1)):--l[t],++p[e]}var i,s,f,h,o,u=new(a?Uint16Array:Array)(t),c=new(a?Uint8Array:Array)(t),l=new(a?Uint8Array:Array)(r),b=Array(t),y=Array(t),p=Array(t),g=(1<<t)-r,A=1<<t-1;for(u[t-1]=r,s=0;s<t;++s)g<A?c[s]=0:(c[s]=1,g-=A),g<<=1,u[t-2-s]=(u[t-1-s]/2|0)+r;for(u[0]=c[0],b[0]=Array(u[0]),y[0]=Array(u[0]),s=1;s<t;++s)u[s]>2*u[s-1]+c[s]&&(u[s]=2*u[s-1]+c[s]),b[s]=Array(u[s]),y[s]=Array(u[s]);for(i=0;i<r;++i)l[i]=t;for(f=0;f<u[t-1];++f)b[t-1][f]=e[f],y[t-1][f]=f;for(i=0;i<t;++i)p[i]=0;for(1===c[t-1]&&(--l[0],++p[t-1]),s=t-2;0<=s;--s){for(h=i=0,o=p[s+1],f=0;f<u[s];f++)(h=b[s+1][o]+b[s+1][o+1])>e[i]?(b[s][f]=h,y[s][f]=r,o+=2):(b[s][f]=e[i],y[s][f]=i,++i);p[s]=0,1===c[s]&&n(s)}return l}(n,n.length,r),s=0,f=t.length;s<f;++s)u[t[s].index]=i[s];return u}function N(e){let r,t,n,i,s=new(a?Uint16Array:Array)(e.length),f=[],h=[],o=0;for(r=0,t=e.length;r<t;r++)f[e[r]]=1+(0|f[e[r]]);for(r=1,t=16;r<=t;r++)h[r]=o,o+=0|f[r],o<<=1;for(r=0,t=e.length;r<t;r++)for(o=h[e[r]],h[e[r]]+=1,n=s[r]=0,i=e[r];n<i;n++)s[r]=s[r]<<1|1&o,o>>>=1;return s}function D(e,r){this.input=e,this.a=new(a?Uint8Array:Array)(32768),this.d=E.g;let t,n={};for(t in!r&&(r={})||"number"!=typeof r.compressionType||(this.d=r.compressionType),r)n[t]=r[t];n.outputBuffer=this.a,this.j=new y(this.input,n)}var E=A;D.prototype.f=function(){let e,r,t,n,i,s,f=0;switch(s=this.a,e=Math.LOG2E*Math.log(32768)-8,r=e<<4|8,s[f++]=r,this.d){case E.NONE:n=0;break;case E.h:n=1;break;case E.g:n=2;break;default:throw Error("unsupported compression type")}t=n<<6|0,s[f++]=t|31-(256*r+t)%31;let h=this.input;if("string"==typeof h){let e,r,t=h.split("");for(e=0,r=t.length;e<r;e++)t[e]=(255&t[e].charCodeAt(0))>>>0;h=t}for(var o,u=1,c=0,l=h.length,b=0;0<l;){l-=o=1024<l?1024:l;do{c+=u+=h[b++]}while(--o);u%=65521,c%=65521}return i=(c<<16|u)>>>0,this.j.c=f,s=this.j.f(),f=s.length,a&&(s=new Uint8Array(s.buffer),s.length<=f+4&&(this.a=new Uint8Array(s.length+4),this.a.set(s),s=this.a),s=s.subarray(0,f+4)),s[f++]=i>>24&255,s[f++]=i>>16&255,s[f++]=i>>8&255,s[f++]=255&i,s},n("Zlib.Deflate",D),n("Zlib.Deflate.compress",(function(e,r){return new D(e,r).f()})),n("Zlib.Deflate.prototype.compress",D.prototype.f);let j,O,Z,B,C={NONE:E.NONE,FIXED:E.h,DYNAMIC:E.g};if(Object.keys)j=Object.keys(C);else for(O in j=[],Z=0,C)j[Z++]=O;for(Z=0,B=j.length;Z<B;++Z)O=j[Z],n("Zlib.Deflate.CompressionType."+O,C[O])}).call(this),this.addEventListener("message",(function(e){const r=Uint8Array.from(encodeURIComponent(e.data.object).split(""),(e=>e.charCodeAt(0))),t=e.data.type;if("json"===t)this.postMessage({json:JSON.stringify({buffer:Array.from(new Zlib.Deflate(r).compress()),type:"zlib"}),type:t});else{const e=new Zlib.Deflate(r).compress();this.postMessage({buffer:e,type:t},[e.buffer])}}));'],{type:"text/javascript"}))),d.$zlibWorker.onmessage=function(e){const t=e.data.type;switch(t){case"json":case"n2d":{const a=document.getElementById("save-anchor");a.href&&URL.revokeObjectURL(a.href),a.download=`${d.$currentWorkSpace().name}.${t}`,a.href="json"===t?URL.createObjectURL(new Blob([e.data.json],{type:"application/json"})):URL.createObjectURL(new Blob([e.data.buffer],{type:"text/plain"})),a.click()}break;case"local":{const t=e.data.buffer;let a="";for(let e=0;e<t.length;e+=4096)a+=String.fromCharCode.apply(null,t.slice(e,e+4096));try{localStorage.setItem(`${d.PREFIX}@save-data`,a)}catch(e){console.log(e),alert("ブラウザでキャッシュできる容量は5Mまでです。\nツールの「プロジェクトデータを保存」からデータをPCに保存してください。")}d.$updated=!1}}d.$zlibQueues.length?d.$zlibWorker.postMessage(d.$zlibQueues.pop()):d.$zlibWorkerActive=!1},d.$zlibQueues=[],d.$zlibWorkerActive=!1,d.$unzipURL=URL.createObjectURL(new Blob(['const Util={};Util.$Uint8Array=Uint8Array,Util.$Uint16Array=Uint16Array,Util.$Int16Array=Int16Array,Util.$ArrayBuffer=ArrayBuffer,Util.$max=Math.max,Util.$min=Math.min,Util.$potArrayBuffers=new Map,Util.$codeTables=[],Util.$getCodeTable=function(t,e){const i=Util.$codeTables.pop()||{key:null,value:null};return i.key=t,i.value=e,i},Util.$poolCodeTable=function(t){Util.$codeTables.push(t)},Util.$poolTypedArrayBuffer=function(t){const e=t.buffer,i=e.byteLength;if(!i||i!==Util.$upperPowerOfTwo(i))return;let r=Util.$potArrayBuffers.get(i);r||(r=[],Util.$potArrayBuffers.set(i,r)),r.push(e)},Util.$upperPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},Util.$getUint8Array=function(t){let e;const i=Util.$upperPowerOfTwo(t),r=Util.$potArrayBuffers.get(i),l=r&&r.pop();return l?(e=new Util.$Uint8Array(l,0,t),e.fill(0)):e=new Util.$Uint8Array(new Util.$ArrayBuffer(i),0,t),e},Util.$getUint16Array=function(t){let e;const i=Util.$upperPowerOfTwo(2*t),r=Util.$potArrayBuffers.get(i),l=r&&r.pop();return l?(e=new Util.$Uint16Array(l,0,t),e.fill(0)):e=new Util.$Uint16Array(new Util.$ArrayBuffer(i),0,t),e},Util.$fixedDistTable={key:new Util.$Uint16Array([5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5]),value:new Util.$Uint16Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31])},Util.$fixedLitTable={key:new Util.$Uint16Array([7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9]),value:new Util.$Uint16Array([256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,280,281,282,283,284,285,286,287,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255])},Util.$ORDER=new Util.$Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Util.$LEXT=new Util.$Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99]),Util.$LENS=new Util.$Int16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Util.$DEXT=new Util.$Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Util.$DISTS=new Util.$Int16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]);class ByteStream{constructor(){this.initialization()}initialization(){this.data=null,this.bit_offset=0,this.byte_offset=0,this.bit_buffer=null}byteAlign(){this.bit_offset&&(this.byte_offset=this.byte_offset+(this.bit_offset+7)/8|0,this.bit_offset=0)}getData(t){this.byteAlign();const e=this.byte_offset+t,i=this.data.slice(this.byte_offset,e);return this.byte_offset=e,i}setOffset(t,e){this.byte_offset=t,this.bit_offset=e}unzip(t,e=0){let i=e;const r=Util.$getUint8Array(19);let l=null,a=null;for(;;){const e=this.readUB(1),s=this.readUB(2);if(l&&(Util.$poolCodeTable(l),Util.$poolCodeTable(a)),l=null,a=null,s){if(1===s)l=Util.$fixedDistTable,a=Util.$fixedLitTable;else{const t=this.readUB(5)+257,e=this.readUB(5)+1,i=this.readUB(4)+4;for(let t=0;t<i;++t)r[Util.$ORDER[t]]=this.readUB(3);const s=this.buildHuffTable(r);r.fill(0);const f=t+e|0,o=Util.$getUint8Array(f);let n=0;for(let t=0;t<f;){const e=this.decodeSymbol(s.key,s.value);switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:o[t++]=e,n=e;break;case 16:{let e=this.readUB(2)+3|0;for(;e;)--e,o[t++]=n}break;case 17:{let e=this.readUB(3)+3|0;for(;e;)--e,o[t++]=0}break;case 18:{let e=this.readUB(7)+11|0;for(;e;)--e,o[t++]=0}}}Util.$poolCodeTable(s),l=this.buildHuffTable(o.subarray(t)),a=this.buildHuffTable(o.subarray(0,t)),Util.$poolTypedArrayBuffer(o),Util.$poolTypedArrayBuffer(s.key),Util.$poolTypedArrayBuffer(s.value)}for(;;){const e=0|this.decodeSymbol(a.key,a.value);if(256===e)break;if(e<256)t[i++]=e;else{const r=e-257|0;let a=Util.$LENS[r]+this.readUB(Util.$LEXT[r])|0;const s=this.decodeSymbol(l.key,l.value);let f=i-(Util.$DISTS[s]+this.readUB(Util.$DEXT[s])|0)|0;for(;a;)--a,t[i++]=t[f++]}}}else{this.bit_offset=8,this.bit_buffer=null;const e=0|this.readNumber(2);this.byte_offset+=2;for(let r=0;r<e;++r)t[i++]=this.readNumber(1)}if(e)break}Util.$poolTypedArrayBuffer(r)}buildHuffTable(t){const e=t.length,i=Util.$max.apply(null,t),r=Util.$getUint8Array(i),l=Util.$getUint16Array(i+1);let a=0,s=0,f=e;for(;f;)s=t[--f],s&&++r[s];let o=0;for(let t=0;t<i;)a=a+r[t++]<<1,l[t]=a,o=Util.$max(o,a);const n=o+e,U=Util.$getUint16Array(n),u=Util.$getUint16Array(n);for(let i=0;i<e;++i)if(s=t[i],s){const t=l[s];U[t]=s,u[t]=i,l[s]=t+1|0}return Util.$poolTypedArrayBuffer(r),Util.$poolTypedArrayBuffer(l),Util.$getCodeTable(U,u)}decodeSymbol(t,e){let i=0,r=0;for(;;)if(i=i<<1|this.readUB(1),++r,t[i]===r)return e[i]}readUB(t){let e=0;for(let i=0;i<t;++i)8===this.bit_offset&&(this.bit_buffer=this.readNumber(1),this.bit_offset=0),e|=(this.bit_buffer&1<<this.bit_offset++?1:0)<<i;return e}readNumber(t){let e=0;const i=this.byte_offset;let r=i+t|0;for(;r>i;)e=e<<8|this.data[--r];return this.byte_offset+=t,e}}Util.$byteStream=new ByteStream,Util.$lossless=function(t,e,i,r,l,a){const s=new Util.$Uint8Array(e*i*4);if(3===r){const r=(e+3&-4)-e;let f=0;if(a){let a=4*l;for(let l=0;l<i;++l){for(let i=0;i<e;++i){const e=4*t[a++],i=t[e+3];if(0===i){s[f++]=0,s[f++]=0,s[f++]=0,s[f++]=0;continue}const r=t[e],l=t[e+1],o=t[e+2];255!==i?(s[f++]=255&Util.$min(r/i*255,255),s[f++]=255&Util.$min(l/i*255,255),s[f++]=255&Util.$min(o/i*255,255),s[f++]=i):(s[f++]=r,s[f++]=l,s[f++]=o,s[f++]=i)}a+=r}return s}let o=3*l;for(let l=0;l<i;++l){for(let i=0;i<e;++i){const e=3*t[o++];s[f++]=t[e],s[f++]=t[e+1],s[f++]=t[e+2],s[f++]=255}o+=r}return s}const f=e*i;if(a){for(let e=0;e<f;++e){const i=4*e,r=i,l=i+1,a=i+2,f=i+3,o=t[r];0!==o?255!==o?(s[r]=255&Util.$min(t[l]/o*255,255),s[l]=255&Util.$min(t[a]/o*255,255),s[a]=255&Util.$min(t[f]/o*255,255),s[f]=o):(s[r]=t[l],s[l]=t[a],s[a]=t[f],s[f]=o):(s[r]=0,s[l]=0,s[a]=0,s[f]=0)}return s}for(let e=0;e<f;++e){const i=4*e,r=i+1,l=i+2,a=i+3;s[i]=t[r],s[r]=t[l],s[l]=t[a],s[a]=255}return s},this.addEventListener("message",(function(t){const e=Util.$byteStream;switch(t.data.mode){case"swf":{e.data=t.data.buffer;const i=t.data.fileSize,r=new Util.$Uint8Array(i),l=e.getData(8);e.setOffset(10,8),r.set(l,0),e.unzip(r,8),this.postMessage({buffer:r,mode:t.data.mode},[r.buffer])}break;case"lossless":{const i=t.data,r=new Util.$Uint8Array(i.fileSize);e.data=t.data.buffer,e.setOffset(2,8),e.unzip(r,0);const l=Util.$lossless(r,i.width,i.height,i.format,i.tableSize,i.isAlpha);this.postMessage({buffer:l,mode:t.data.mode},[l.buffer])}break;case"jpegAlpha":{const i=t.data.width*t.data.height,r=new Util.$Uint8Array(i);e.data=t.data.alphaData,e.setOffset(2,8),e.unzip(r,0),t.data.alphaData=r,this.postMessage(t.data,[t.data.buffer.buffer,t.data.alphaData.buffer])}}Util.$byteStream.initialization()}));'],{type:"text/javascript"})),d.$unzipWorker=null,d.$unzipQueues=[],d.$unzipWorkerActive=!1,d.$unzipHandler=function(e){const t=e.target;switch(t.onmessage=null,e.data.mode){case"swf":this._$byteStream._$buffer=e.data.buffer,this.parseAndBuild();break;case"lossless":{const t=d.$currentWorkSpace().getLibrary(this.libraryId);t._$buffer=e.data.buffer,t._$command=null}break;case"jpegAlpha":{const t=e.data.buffer,a=e.data.alphaData;let s=0;for(let e=0;e<t.length;e+=4)t[e+3]=a[s++];const r=d.$currentWorkSpace().getLibrary(this.libraryId);r._$buffer=t,r._$command=null}}if(d.$unzipQueues.length){const e=d.$unzipQueues.shift();switch(t.onmessage=d.$unzipHandler.bind(e),e.mode){case"swf":{const a=e._$byteStream._$buffer;t.postMessage({fileSize:e.fileSize,mode:e.mode,buffer:a},[a.buffer])}break;case"lossless":t.postMessage(e,[e.buffer.buffer]);break;case"jpegAlpha":t.postMessage(e,[e.buffer.buffer,e.alphaData.buffer])}}else d.$unzipWorkerActive=!1},d.$unlzmaWorkerURL=URL.createObjectURL(new Blob(['const LZMA={init:function(e){const t=[];t.push(e[12],e[13],e[14],e[15],e[16],e[4],e[5],e[6],e[7]);let s=8;for(let e=5;e<9;++e){if(t[e]>=s){t[e]=t[e]-s|0;break}t[e]=256+t[e]-s|0,s=1}return t.push(0,0,0,0),e.set(t,4),e.subarray(4)},reverseDecode2:function(e,t,s,i){let r=1,o=0,d=0;for(;d<i;++d){const i=s.decodeBit(e,t+r);r=r<<1|i,o|=i<<d}return o},decompress:function(e,t){const s=new Decoder,i=s.decodeHeader(e),r=i.uncompressedSize;if(s.setProperties(i),!s.decodeBody(e,t,r))throw new Error("Error in lzma data stream");return t}};class OutWindow{constructor(){this._buffer=null,this._stream=null,this._pos=0,this._streamPos=0,this._windowSize=0}create(e){this._buffer&&this._windowSize===e||(this._buffer=new Uint8Array(e)),this._windowSize=e}flush(){const e=this._pos-this._streamPos;e&&(this._stream.writeBytes(this._buffer,e),this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos)}releaseStream(){this.flush(),this._stream=null}setStream(e){this._stream=e}init(e=!1){e||(this._streamPos=0,this._pos=0)}copyBlock(e,t){let s=this._pos-e-1;for(s<0&&(s+=this._windowSize);t--;)s>=this._windowSize&&(s=0),this._buffer[this._pos++]=this._buffer[s++],this._pos>=this._windowSize&&this.flush()}putByte(e){this._buffer[this._pos++]=e,this._pos>=this._windowSize&&this.flush()}getByte(e){let t=this._pos-e-1;return t<0&&(t+=this._windowSize),this._buffer[t]}}class RangeDecoder{constructor(){this._stream=null,this._code=0,this._range=-1}setStream(e){this._stream=e}releaseStream(){this._stream=null}init(){let e=5;for(this._code=0,this._range=-1;e--;)this._code=this._code<<8|this._stream.readByte()}decodeDirectBits(e){let t=0,s=e;for(;s--;){this._range>>>=1;const e=this._code-this._range>>>31;this._code-=this._range&e-1,t=t<<1|1-e,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8)}return t}decodeBit(e,t){const s=e[t],i=(this._range>>>11)*s;return(2147483648^this._code)<(2147483648^i)?(this._range=i,e[t]+=2048-s>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=i,this._code-=i,e[t]-=s>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)}}class BitTreeDecoder{constructor(e){this._models=Array(1<<e).fill(1024),this._numBitLevels=e}decode(e){let t=1,s=this._numBitLevels;for(;s--;)t=t<<1|e.decodeBit(this._models,t);return t-(1<<this._numBitLevels)}reverseDecode(e){let t=1,s=0,i=0;for(;i<this._numBitLevels;++i){const r=e.decodeBit(this._models,t);t=t<<1|r,s|=r<<i}return s}}class LenDecoder{constructor(){this._choice=[1024,1024],this._lowCoder=[],this._midCoder=[],this._highCoder=new BitTreeDecoder(8),this._numPosStates=0}create(e){for(;this._numPosStates<e;++this._numPosStates)this._lowCoder[this._numPosStates]=new BitTreeDecoder(3),this._midCoder[this._numPosStates]=new BitTreeDecoder(3)}decode(e,t){return 0===e.decodeBit(this._choice,0)?this._lowCoder[t].decode(e):0===e.decodeBit(this._choice,1)?8+this._midCoder[t].decode(e):16+this._highCoder.decode(e)}}class Decoder2{constructor(){this._decoders=Array(768).fill(1024)}decodeNormal(e){let t=1;do{t=t<<1|e.decodeBit(this._decoders,t)}while(t<256);return 255&t}decodeWithMatchByte(e,t){let s=1;do{const i=t>>7&1;t<<=1;const r=e.decodeBit(this._decoders,(1+i<<8)+s);if(s=s<<1|r,i!==r){for(;s<256;)s=s<<1|e.decodeBit(this._decoders,s);break}}while(s<256);return 255&s}}class LiteralDecoder{create(e,t){if(this._coders&&this._numPrevBits===t&&this._numPosBits===e)return;this._numPosBits=e,this._posMask=(1<<e)-1,this._numPrevBits=t,this._coders=[];let s=1<<this._numPrevBits+this._numPosBits;for(;s--;)this._coders[s]=new Decoder2}getDecoder(e,t){return this._coders[((e&this._posMask)<<this._numPrevBits)+((255&t)>>>8-this._numPrevBits)]}}class Decoder{constructor(){this._outWindow=new OutWindow,this._rangeDecoder=new RangeDecoder,this._isMatchDecoders=Array(192).fill(1024),this._isRepDecoders=Array(12).fill(1024),this._isRepG0Decoders=Array(12).fill(1024),this._isRepG1Decoders=Array(12).fill(1024),this._isRepG2Decoders=Array(12).fill(1024),this._isRep0LongDecoders=Array(192).fill(1024),this._posDecoders=Array(114).fill(1024),this._posAlignDecoder=new BitTreeDecoder(4),this._lenDecoder=new LenDecoder,this._repLenDecoder=new LenDecoder,this._literalDecoder=new LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder=[new BitTreeDecoder(6),new BitTreeDecoder(6),new BitTreeDecoder(6),new BitTreeDecoder(6)]}setDictionarySize(e){return!(e<0)&&(this._dictionarySize!==e&&(this._dictionarySize=e,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)}setLcLpPb(e,t,s){if(e>8||t>4||s>4)return!1;const i=1<<s;return this._literalDecoder.create(t,e),this._lenDecoder.create(i),this._repLenDecoder.create(i),this._posStateMask=i-1,!0}setProperties(e){if(!this.setLcLpPb(e.lc,e.lp,e.pb))throw Error("Incorrect stream properties");if(!this.setDictionarySize(e.dictionarySize))throw Error("Invalid dictionary size")}decodeHeader(e){if(e._$size<13)return!1;let t=e.readByte();const s=t%9;t=~~(t/9);const i=t%5,r=~~(t/5);let o=e.readByte();o|=e.readByte()<<8,o|=e.readByte()<<16,o+=16777216*e.readByte();let d=e.readByte();return d|=e.readByte()<<8,d|=e.readByte()<<16,d+=16777216*e.readByte(),e.readByte(),e.readByte(),e.readByte(),e.readByte(),{lc:s,lp:i,pb:r,dictionarySize:o,uncompressedSize:d}}decodeBody(e,t,s){let i,r,o=0,d=0,h=0,c=0,n=0,_=0,a=0;for(this._rangeDecoder.setStream(e),this._rangeDecoder.init(),this._outWindow.setStream(t),this._outWindow.init(!1);_<s;){const e=_&this._posStateMask;if(0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(o<<4)+e)){const e=this._literalDecoder.getDecoder(_++,a);a=o>=7?e.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(d)):e.decodeNormal(this._rangeDecoder),this._outWindow.putByte(a),o=o<4?0:o-(o<10?3:6)}else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,o))i=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,o)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(o<<4)+e)&&(o=o<7?9:11,i=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,o)?r=h:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,o)?r=c:(r=n,n=c),c=h),h=d,d=r),0===i&&(i=2+this._repLenDecoder.decode(this._rangeDecoder,e),o=o<7?8:11);else{n=c,c=h,h=d,i=2+this._lenDecoder.decode(this._rangeDecoder,e),o=o<7?7:10;const t=this._posSlotDecoder[i<=5?i-2:3].decode(this._rangeDecoder);if(t>=4){const e=(t>>1)-1;if(d=(2|1&t)<<e,t<14)d+=LZMA.reverseDecode2(this._posDecoders,d-t-1,this._rangeDecoder,e);else if(d+=this._rangeDecoder.decodeDirectBits(e-4)<<4,d+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),d<0){if(-1===d)break;return!1}}else d=t}if(d>=_||d>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(d,i),_+=i,a=this._outWindow.getByte(0)}}return this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0}}class InStream{constructor(e){this._$data=e,this._$size=e.length,this._$offset=0}readByte(){return this._$data[this._$offset++]}}class OutStream{constructor(e){this.size=8,this.buffers=e}writeBytes(e,t){e.length===t?this.buffers.set(e,this.size):this.buffers.set(e.subarray(0,t),this.size),this.size+=t}}this.addEventListener("message",(function(e){const t=e.data.fileSize,s=e.data.buffer,i=new Uint8Array(t+8);i.set(s.slice(0,8),0),LZMA.decompress(new InStream(LZMA.init(s)),new OutStream(i)),this.postMessage(i,[i.buffer]),this.close()}));'],{type:"text/javascript"})),d.$unlzmaQueues=[],d.$unlzmaWorkerActive=!1,d.$parserURL=URL.createObjectURL(new Blob(['const Util={$tagObjects:[]};Util.$installed=new Map,Util.$swfParser=null,Util.$Rad2Deg=180/Math.PI,Util.$JCT11280=Function(\'var a="zKV33~jZ4zN=~ji36XazM93y!{~k2y!o~k0ZlW6zN?3Wz3W?{EKzK[33[`y|;-~j^YOTz$!~kNy|L1$353~jV3zKk3~k-4P4zK_2+~jY4y!xYHR~jlz$_~jk4z$e3X5He<0y!wy|X3[:~l|VU[F3VZ056Hy!nz/m1XD61+1XY1E1=1y|bzKiz!H034zKj~mEz#c5ZA3-3X$1~mBz$$3~lyz#,4YN5~mEz#{ZKZ3V%7Y}!J3X-YEX_J(3~mAz =V;kE0/y|F3y!}~m>z/U~mI~j_2+~mA~jp2;~m@~k32;~m>V}2u~mEX#2x~mBy+x2242(~mBy,;2242(~may->2&XkG2;~mIy-_2&NXd2;~mGz,{4<6:.:B*B:XC4>6:.>B*BBXSA+A:X]E&E<~r#z+625z s2+zN=`HXI@YMXIAXZYUM8X4K/:Q!Z&33 3YWX[~mB`{zKt4z (zV/z 3zRw2%Wd39]S11z$PAXH5Xb;ZQWU1ZgWP%3~o@{Dgl#gd}T){Uo{y5_d{e@}C(} WU9|cB{w}bzvV|)[} H|zT}d||0~{]Q|(l{|x{iv{dw}(5}[Z|kuZ }cq{{y|ij}.I{idbof%cu^d}Rj^y|-M{ESYGYfYsZslS`?ZdYO__gLYRZ&fvb4oKfhSf^d<Yeasc1f&a=hnYG{QY{D`Bsa|u,}Dl|_Q{C%xK|Aq}C>|c#ryW=}eY{L+`)][YF_Ub^h4}[X|?r|u_ex}TL@YR]j{SrXgo*|Gv|rK}B#mu{R1}hs|dP{C7|^Qt3|@P{YVV |8&}#D}ef{e/{Rl|>Hni}R1{Z#{D[}CQlQ||E}[s{SG_+i8eplY[=[|ec[$YXn#`hcm}YR|{Ci(_[ql|?8p3]-}^t{wy}4la&pc|3e{Rp{LqiJ],] `kc(]@chYnrM`O^,ZLYhZB]ywyfGY~aex!_Qww{a!|)*lHrM{N+n&YYj~Z b c#e_[hZSon|rOt`}hBXa^i{lh|<0||r{KJ{kni)|x,|0auY{D!^Sce{w;|@S|cA}Xn{C1h${E]Z-XgZ*XPbp]^_qbH^e[`YM|a||+=]!Lc}]vdBc=j-YSZD]YmyYLYKZ9Z>Xcczc2{Yh}9Fc#Z.l{}(D{G{{mRhC|L3b#|xK[Bepj#ut`H[,{E9Yr}1b{[e]{ZFk7[ZYbZ0XL]}Ye[(`d}c!|*y`Dg=b;gR]Hm=hJho}R-[n}9;{N![7k_{UbmN]rf#pTe[x8}!Qcs_rs[m`|>N}^V})7{^r|/E}),}HH{OYe2{Skx)e<_.cj.cjoMhc^d}0uYZd!^J_@g,[[[?{i@][|3S}Yl3|!1|eZ|5IYw|1D}e7|Cv{OHbnx-`wvb[6[4} =g+k:{C:}ed{S]|2M]-}WZ|/q{LF|dYu^}Gs^c{Z=}h>|/i|{W]:|ip{N:|zt|S<{DH[p_tvD{N<[8Axo{X4a.^o^X>Yfa59`#ZBYgY~_t^9`jZHZn`>G[oajZ;X,i)Z.^~YJe ZiZF^{][[#Zt^|]Fjx]&_5dddW]P0C[-]}]d|y {C_jUql] |OpaA[Z{lp|rz}:Mu#]_Yf6{Ep?f5`$[6^D][^u[$[6^.Z8]]ePc2U/=]K^_+^M{q*|9tYuZ,s(dS{i=|bNbB{uG}0jZOa:[-]dYtu3]:]<{DJ_SZIqr_`l=Yt`gkTnXb3d@kiq0a`Z{|!B|}e}Ww{Sp,^Z|0>_Z}36|]A|-t}lt{R6pi|v8hPu#{C>YOZHYmg/Z4nicK[}hF_Bg|YRZ7c|crkzYZY}_iXcZ.|)U|L5{R~qi^Uga@Y[xb}&qdbd6h5|Btw[}c<{Ds53[Y7]?Z<|e0{L[ZK]mXKZ#Z2^tavf0`PE[OSOaP`4gi`qjdYMgys/?[nc,}EEb,eL]g[n{E_b/vcvgb.{kcwi`~v%|0:|iK{Jh_vf5lb}KL|(oi=LrzhhY_^@`zgf[~g)[J_0fk_V{T)}I_{D&_/d9W/|MU[)f$xW}?$xr4<{Lb{y4}&u{XJ|cm{Iu{jQ}CMkD{CX|7A}G~{kt)nB|d5|<-}WJ}@||d@|Iy}Ts|iL|/^|no|0;}L6{Pm]7}$zf:|r2}?C_k{R(}-w|`G{Gy[g]bVje=_0|PT{^Y^yjtT[[[l!Ye_`ZN]@[n_)j3nEgMa]YtYpZy].d-Y_cjb~Y~[nc~sCi3|zg}B0}do{O^{|$`_|D{}U&|0+{J3|8*]iayx{a{xJ_9|,c{Ee]QXlYb]$[%YMc*]w[aafe]aVYi[fZEii[xq2YQZHg]Y~h#|Y:thre^@^|_F^CbTbG_1^qf7{L-`VFx Zr|@EZ;gkZ@slgko`[e}T:{Cu^pddZ_`yav^Ea+[#ZBbSbO`elQfLui}.F|txYcbQ`XehcGe~fc^RlV{D_0ZAej[l&jShxG[ipB_=u:eU}3e8[=j|{D(}dO{Do[BYUZ0/]AYE]ALYhZcYlYP/^-^{Yt_1_-;YT`P4BZG=IOZ&]H[e]YYd[9^F[1YdZxZ?Z{Z<]Ba2[5Yb[0Z4l?]d_;_)a?YGEYiYv`_XmZs4ZjY^Zb]6gqGaX^9Y}dXZr[g|]Y}K aFZp^k^F]M`^{O1Ys]ZCgCv4|E>}8eb7}l`{L5[Z_faQ|c2}Fj}hw^#|Ng|B||w2|Sh{v+[G}aB|MY}A{|8o}X~{E8paZ:]i^Njq]new)`-Z>haounWhN}c#{DfZ|fK]KqGZ=:u|fqoqcv}2ssm}.r{]{nIfV{JW)[K|,Z{Uxc|]l_KdCb%]cfobya3`p}G^|LZiSC]U|(X|kBlVg[kNo({O:g:|-N|qT}9?{MBiL}Sq{`P|3a|u.{Uaq:{_o|^S}jX{Fob0`;|#y_@[V[K|cw[<_ }KU|0F}d3|et{Q7{LuZttsmf^kYZ`Af`}$x}U`|Ww}d]| >}K,r&|XI|*e{C/a-bmr1fId4[;b>tQ_:]hk{b-pMge]gfpo.|(w[jgV{EC1Z,YhaY^q,_G[c_g[J0YX]`[h^hYK^_Yib,` {i6vf@YM^hdOKZZn(jgZ>bzSDc^Z%[[o9[2=/YHZ(_/Gu_`*|8z{DUZxYt^vuvZjhi^lc&gUd4|<UiA`z]$b/Z?l}YI^jaHxe|;F}l${sQ}5g}hA|e4}?o{ih}Uz{C)jPe4]H^J[Eg[|AMZMlc}:,{iz}#*|gc{Iq|/:|zK{l&}#u|myd{{M&v~nV};L|(g|I]ogddb0xsd7^V})$uQ{HzazsgxtsO^l}F>ZB]r|{7{j@cU^{{CbiYoHlng]f+nQ[bkTn/}<-d9q {KXadZYo+n|l[|lc}V2{[a{S4Zam~Za^`{HH{xx_SvF|ak=c^[v^7_rYT`ld@]:_ub%[$[m](Shu}G2{E.ZU_L_R{tz`vj(f?^}hswz}GdZ}{S:h`aD|?W|`dgG|if{a8|J1{N,}-Ao3{H#{mfsP|[ bzn+}_Q{MT{u4kHcj_q`eZj[8o0jy{p7}C|[}l){MuYY{|Ff!Ykn3{rT|m,^R|,R}$~Ykgx{P!]>iXh6[l[/}Jgcg{JYZ.^qYfYIZl[gZ#Xj[Pc7YyZD^+Yt;4;`e8YyZVbQ7YzZxXja.7SYl[s]2^/Ha$[6ZGYrb%XiYdf2]H]kZkZ*ZQ[ZYS^HZXcCc%Z|[(bVZ]]:OJQ_DZCg<[,]%Zaa [g{C00HY[c%[ChyZ,Z_`PbXa+eh`^&jPi0a[ggvhlekL]w{Yp^v}[e{~;k%a&k^|nR_z_Qng}[E}*Wq:{k^{FJZpXRhmh3^p>de^=_7`|ZbaAZtdhZ?n4ZL]u`9ZNc3g%[6b=e.ZVfC[ZZ^^^hD{E(9c(kyZ=bb|Sq{k`|vmr>izlH[u|e`}49}Y%}FT{[z{Rk}Bz{TCc/lMiAqkf(m$hDc;qooi[}^o:c^|Qm}a_{mrZ(pA`,}<2sY| adf_%|}`}Y5U;}/4|D>|$X{jw{C<|F.hK|*A{MRZ8Zsm?imZm_?brYWZrYx`yVZc3a@f?aK^ojEd {bN}/3ZH]/$YZhm^&j 9|(S|b]mF}UI{q&aM]LcrZ5^.|[j`T_V_Gak}9J[ ZCZD|^h{N9{~&[6Zd{}B}2O|cv]K}3s}Uy|l,fihW{EG`j_QOp~Z$F^zexS`dcISfhZBXP|.vn|_HYQ|)9|cr]<`&Z6]m_(ZhPcSg>`Z]5`~1`0Xcb4k1{O!bz|CN_T{LR|a/gFcD|j<{Z._[f)mPc:1`WtIaT1cgYkZOaVZOYFrEe[}T$}Ch}mk{K-^@]fH{Hdi`c*Z&|Kt{if[C{Q;{xYB`dYIX:ZB[}]*[{{p9|4GYRh2ao{DS|V+[zd$`F[ZXKadb*A] Ys]Maif~a/Z2bmclb8{Jro_rz|x9cHojbZ{GzZx_)]:{wAayeDlx}<=`g{H1{l#}9i|)=|lP{Qq}.({La|!Y{i2EZfp=c*}Cc{EDvVB|;g}2t{W4av^Bn=]ri,|y?|3+}T*ckZ*{Ffr5e%|sB{lx^0]eZb]9[SgAjS_D|uHZx]dive[c.YPkcq/}db{EQh&hQ|eg}G!ljil|BO]X{Qr_GkGl~YiYWu=c3eb}29v3|D|}4i||.{Mv})V{SP1{FX}CZW6{cm|vO{pS|e#}A~|1i}81|Mw}es|5[}3w{C`h9aL]o{}p[G`>i%a1Z@`Ln2bD[$_h`}ZOjhdTrH{[j_:k~kv[Sdu]CtL}41{I |[[{]Zp$]XjxjHt_eThoa#h>sSt8|gK|TVi[Y{t=}Bs|b7Zpr%{gt|Yo{CS[/{iteva|cf^hgn}($_c^wmb^Wm+|55jrbF|{9^ q6{C&c+ZKdJkq_xOYqZYSYXYl`8]-cxZAq/b%b*_Vsa[/Ybjac/OaGZ4fza|a)gY{P?| I|Y |,pi1n7}9bm9ad|=d{aV|2@[(}B`d&|Uz}B}{`q|/H|!JkM{FU|CB|.{}Az}#P|lk}K{|2rk7{^8^?`/|k>|Ka{Sq}Gz}io{DxZh[yK_#}9<{TRdgc]`~Z>JYmYJ]|`!ZKZ]gUcx|^E[rZCd`f9oQ[NcD_$ZlZ;Zr}mX|=!|$6ZPZYtIo%fj}CpcN|B,{VDw~gb}@hZg`Q{LcmA[(bo`<|@$|o1|Ss}9Z_}tC|G`{F/|9nd}i=}V-{L8aaeST]daRbujh^xlpq8|}zs4bj[S`J|]?G{P#{rD{]I`OlH{Hm]VYuSYUbRc*6[j`8]pZ[bt_/^Jc*[<Z?YE|Xb|?_Z^Vcas]h{t9|Uwd)_(=0^6Zb{Nc} E[qZAeX[a]P^|_J>e8`W^j_Y}R{{Jp__]Ee#e:iWb9q_wKbujrbR}CY`,{mJ}gz{Q^{t~N|? gSga`V_||:#mi}3t|/I`X{N*|ct|2g{km}gi|{={jC}F;|E}{ZZjYf*frmu}8Tdroi{T[|+~}HG{cJ}DM{Lp{Ctd&}$hi3|FZ| m}Kr|38}^c|m_|Tr{Qv|36}?Up>|;S{DV{k_as}BK{P}}9p|t`jR{sAm4{D=b4pWa[}Xi{EjwEkI}3S|E?u=X0{jf} S|NM|JC{qo^3cm]-|JUx/{Cj{s>{Crt[UXuv|D~|j|d{YXZR}Aq}0r}(_{pJfi_z}0b|-vi)Z mFe,{f4|q`b{}^Z{HM{rbeHZ|^x_o|XM|L%|uFXm}@C_{{Hhp%a7|0p[Xp+^K}9U{bP}: tT}B|}+$|b2|[^|~h{FAby[`{}xgygrt~h1[li`c4vz|,7p~b(|mviN}^pg[{N/|g3|^0c,gE|f%|7N{q[|tc|TKA{LU}I@|AZp(}G-sz{F |qZ{}F|f-}RGn6{Z]_5})B}UJ{FFb2]4ZI@v=k,]t_Dg5Bj]Z-]L]vrpdvdGlk|gF}G]|IW}Y0[G| /bo|Te^,_B}#n^^{QHYI[?hxg{[`]D^IYRYTb&kJ[cri[g_9]Ud~^_]<p@_e_XdNm-^/|5)|h_{J;{kacVopf!q;asqd}n)|.m|bf{QW|U)}b+{tL|w``N|to{t ZO|T]jF}CB|0Q{e5Zw|k |We}5:{HO{tPwf_uajjBfX}-V_C_{{r~gg|Ude;s+}KNXH}! `K}eW{Upwbk%ogaW}9EYN}YY|&v|SL{C3[5s.]Y]I]u{M6{pYZ`^,`ZbCYR[1mNg>rsk0Ym[jrE]RYiZTr*YJ{Ge|%-lf|y(`=[t}E6{k!|3)}Zk} ][G{E~cF{u3U.rJ|a9p#o#ZE|?|{sYc#vv{E=|LC}cu{N8`/`3`9rt[4|He{cq|iSYxY`}V |(Q|t4{C?]k_Vlvk)BZ^r<{CL}#h}R+[<|i=}X|{KAo]|W<`K{NW|Zx}#;|fe{IMr<|K~tJ_x}AyLZ?{GvbLnRgN}X&{H7|x~}Jm{]-| GpNu0}.ok>|c4{PYisrDZ|fwh9|hfo@{H~XSbO]Odv]%`N]b1Y]]|eIZ}_-ZA]aj,>eFn+j[aQ_+]h[J_m_g]%_wf.`%k1e#Z?{CvYu_B^|gk`Xfh^M3`afGZ-Z|[m{L}|k3cp[it ^>YUi~d>{T*}YJ{Q5{Jxa$hg|%4`}|LAgvb }G}{P=|<;Ux{_skR{cV|-*|s-{Mp|XP|$G|_J}c6cM{_=_D|*9^$ec{V;|4S{qO|w_|.7}d0|/D}e}|0G{Dq]Kdp{}dfDi>}B%{Gd|nl}lf{C-{y}|ANZr}#={T~|-(}c&{pI|ft{lsVP}){|@u}!W|bcmB{d?|iW|:dxj{PSkO|Hl]Li:}VYk@|2={fnWt{M3`cZ6|)}|Xj}BYa?vo{e4|L7|B7{L7|1W|lvYO}W8nJ|$Vih|{T{d*_1|:-n2dblk``fT{Ky|-%}m!|Xy|-a{Pz}[l{kFjz|iH}9N{WE{x,|jz}R {P|{D)c=nX|Kq|si}Ge{sh|[X{RF{t`|jsr*fYf,rK|/9}$}}Nf{y!1|<Std}4Wez{W${Fd_/^O[ooqaw_z[L`Nbv[;l7V[ii3_PeM}.h^viqYjZ*j1}+3{bt{DR[;UG}3Og,rS{JO{qw{d<_zbAh<R[1_r`iZTbv^^a}c{iEgQZ<exZFg.^Rb+`Uj{a+{z<[~r!]`[[|rZYR|?F|qppp]L|-d|}K}YZUM|=Y|ktm*}F]{D;g{uI|7kg^}%?Z%ca{N[_<q4xC]i|PqZC]n}.bDrnh0Wq{tr|OMn6tM|!6|T`{O`|>!]ji+]_bTeU}Tq|ds}n|{Gm{z,f)}&s{DPYJ`%{CGd5v4tvb*hUh~bf]z`jajiFqAii]bfy^U{Or|m+{I)cS|.9k:e3`^|xN}@Dnlis`B|Qo{`W|>||kA}Y}{ERYuYx`%[exd`]|OyiHtb}HofUYbFo![5|+]gD{NIZR|Go}.T{rh^4]S|C9_}xO^i`vfQ}C)bK{TL}cQ|79iu}9a];sj{P.o!f[Y]pM``Jda^Wc9ZarteBZClxtM{LW}l9|a.mU}KX}4@{I+f1}37|8u}9c|v${xGlz}jP{Dd1}e:}31}%3X$|22i<v+r@~mf{sN{C67G97855F4YL5}8f{DT|xy{sO{DXB334@55J1)4.G9A#JDYtXTYM4, YQD9;XbXm9SX]IB^4UN=Xn<5(;(F3YW@XkH-X_VM[DYM:5XP!T&Y`6|,^{IS-*D.H>:LXjYQ0I3XhAF:9:(==.F*3F1189K/7163D,:@|e2{LS36D4hq{Lw/84443@4.933:0307::6D7}&l{Mx657;89;,K5678H&93D(H<&<>0B90X^I;}Ag1{P%3A+>><975}[S{PZE453?4|T2{Q+5187;>447:81{C=hL6{Me^:=7ii{R=.=F<81;48?|h8}Uh{SE|,VxL{ST,7?9Y_5Xk3A#:$%YSYdXeKXOD8+TXh7(@>(YdXYHXl9J6X_5IXaL0N?3YK7Xh!1?XgYz9YEXhXaYPXhC3X`-YLY_XfVf[EGXZ5L8BXL9YHX]SYTXjLXdJ: YcXbQXg1PX]Yx4|Jr{Ys4.8YU+XIY`0N,<H%-H;:0@,74/:8546I=9177154870UC]d<C3HXl7ALYzXFXWP<<?E!88E5@03YYXJ?YJ@6YxX-YdXhYG|9o{`iXjY_>YVXe>AYFX[/(I@0841?):-B=14337:8=|14{c&93788|di{cW-0>0<097/A;N{FqYpugAFT%X/Yo3Yn,#=XlCYHYNX[Xk3YN:YRT4?)-YH%A5XlYF3C1=NWyY}>:74-C673<69545v {iT85YED=64=.F4..9878/D4378?48B3:7:7/1VX[f4{D,{l<5E75{dAbRB-8-@+;DBF/$ZfW8S<4YhXA.(5@*11YV8./S95C/0R-A4AXQYI7?68167B95HA1*<M3?1/@;/=54XbYP36}lc{qzSS38:19?,/39193574/66878Yw1X-87E6=;964X`T734:>86>1/=0;(I-1::7ALYGXhF+Xk[@W%TYbX7)KXdYEXi,H-XhYMRXfYK?XgXj.9HX_SX]YL1XmYJ>Y}WwIXiI-3-GXcYyXUYJ$X`Vs[7;XnYEZ;XF! 3;%8;PXX(N3Y[)Xi1YE&/ :;74YQ6X`33C;-(>Xm0(TYF/!YGXg8 9L5P01YPXO-5%C|qd{{/K/E6,=0144:361:955;6443@?B7*7:F89&F35YaX-CYf,XiFYRXE_e{}sF 0*7XRYPYfXa5YXXY8Xf8Y~XmA[9VjYj*#YMXIYOXk,HHX40YxYMXU8OXe;YFXLYuPXP?EB[QV0CXfY{:9XV[FWE0D6X^YVP*$4%OXiYQ(|xp|%c3{}V`1>Y`XH00:8/M6XhQ1:;3414|TE|&o@1*=81G8<3}6<|(f6>>>5-5:8;093B^3U*+*^*UT30XgYU&7*O1953)5@E78--F7YF*B&0:%P68W9Zn5974J9::3}Vk|-,C)=)1AJ4+<3YGXfY[XQXmT1M-XcYTYZXCYZXEYXXMYN,17>XIG*SaS|/eYJXbI?XdNZ+WRYP<F:R PXf;0Xg`$|1GX9YdXjLYxWX!ZIXGYaXNYm6X9YMX?9EXmZ&XZ#XQ>YeXRXfAY[4 ;0X!Zz0XdN$XhYL XIY^XGNXUYS/1YFXhYk.TXn4DXjB{jg|4DEX]:XcZMW=A.+QYL<LKXc[vV$+&PX*Z3XMYIXUQ:ZvW< YSXFZ,XBYeXMM)?Xa XiZ4/EXcP3%}&-|6~:1(-+YT$@XIYRBC<}&,|7aJ6}bp|8)K1|Xg|8C}[T|8Q.89;-964I38361<=/;883651467<7:>?1:.}le|:Z=39;1Y^)?:J=?XfLXbXi=Q0YVYOXaXiLXmJXO5?.SFXiCYW}-;|=u&D-X`N0X^,YzYRXO(QX_YW9`I|>hZ:N&X)DQXP@YH#XmNXi$YWX^=!G6YbYdX>XjY|XlX^XdYkX>YnXUXPYF)FXT[EVTMYmYJXmYSXmNXi#GXmT3X8HOX[ZiXN]IU2>8YdX1YbX<YfWuZ8XSXcZU%0;1XnXkZ_WTG,XZYX5YSX Yp 05G?XcYW(IXg6K/XlYP4XnI @XnO1W4Zp-9C@%QDYX+OYeX9>--YSXkD.YR%Q/Yo YUX].Xi<HYEZ2WdCE6YMXa7F)=,D>-@9/8@5=?7164;35387?N<618=6>7D+C50<6B03J0{Hj|N9$D,9I-,.KB3}m |NzE0::/81YqXjMXl7YG; [.W=Z0X4XQY]:MXiR,XgM?9$9>:?E;YE77VS[Y564760391?14941:0=:8B:;/1DXjFA-564=0B3XlH1+D85:0Q!B#:-6&N/:9<-R3/7Xn<*3J4.H:+334B.=>30H.;3833/76464665755:/83H6633:=;.>5645}&E|Y)?1/YG-,93&N3AE@5 <L1-G/8A0D858/30>8<549=@B8] V0[uVQYlXeD(P#ID&7T&7;Xi0;7T-$YE)E=1:E1GR):--0YI7=E<}n9|aT6783A>D7&4YG7=391W;Zx<5+>F#J39}o/|cc;6=A050EQXg8A1-}D-|d^5548083563695D?-.YOXd37I$@LYLWeYlX<Yd+YR A$;3-4YQ-9XmA0!9/XLY_YT(=5XdDI>YJ5XP1ZAW{9>X_6R(XhYO65&J%DA)C-!B:97#A9;@?F;&;(9=11/=657/H,<8}bz|j^5446>.L+&Y^8Xb6?(CYOXb*YF(8X`FYR(XPYVXmPQ%&DD(XmZXW??YOXZXfCYJ79,O)XnYF7K0!QXmXi4IYFRXS,6<%-:YO(+:-3Q!1E1:W,Zo}Am|n~;3580534*?3Zc4=9334361693:30C<6/717:<1/;>59&:4}6!|rS36=1?75<8}[B|s809983579I.A.>84758=108564741H*9E{L{|u%YQ<%6XfH.YUXe4YL@,>N}Tv|ve*G0X)Z;/)3@A74(4P&A1X:YVH97;,754*A66:1 D739E3553545558E4?-?K17/770843XAYf838A7K%N!YW4.$T19Z`WJ*0XdYJXTYOXNZ 1XaN1A+I&Xi.Xk3Z3GB&5%WhZ1+5#Y[X<4YMXhQYoQXVXbYQ8XSYUX4YXBXWDMG0WxZA[8V+Z8X;D],Va$%YeX?FXfX[XeYf<X:Z[WsYz8X_Y]%XmQ(!7BXIZFX]&YE3F$(1XgYgYE& +[+W!<YMYFXc;+PXCYI9YrWxGXY9DY[!GXiI7::)OC;*$.>N*HA@{C|}&k=:<TB83X`3YL+G4XiK]i}(fYK<=5$.FYE%4*5*H*6XkCYL=*6Xi6!Yi1KXR4YHXbC8Xj,B9ZbWx/XbYON#5B}Ue}+QKXnF1&YV5XmYQ0!*3IXBYb71?1B75XmF;0B976;H/RXU:YZX;BG-NXj;XjI>A#D3B636N;,*%<D:0;YRXY973H5)-4FXOYf0:0;/7759774;7;:/855:543L43<?6=E,.A4:C=L)%4YV!1(YE/4YF+ F3%;S;&JC:%/?YEXJ4GXf/YS-EXEYW,9;E}X$}547EXiK=51-?71C%?57;5>463553Zg90;6447?<>4:9.7538XgN{|!}9K/E&3-:D+YE1)YE/3;37/:05}n<}:UX8Yj4Yt864@JYK..G=.(A Q3%6K>3(P3#AYE$-6H/456*C=.XHY[#S.<780191;057C)=6HXj?955B:K1 E>-B/9,;5.!L?:0>/.@//:;7833YZ56<4:YE=/:7Z_WGC%3I6>XkC*&NA16X=Yz2$X:Y^&J48<99k8}CyB-61<18K946YO4{|N}E)YIB9K0L>4=46<1K0+R;6-=1883:478;4,S+3YJX`GJXh.Yp+Xm6MXcYpX(>7Yo,/:X=Z;Xi0YTYHXjYmXiXj;*;I-8S6N#XgY}.3XfYGO3C/$XjL$*NYX,1 6;YH&<XkK9C#I74.>}Hd`A748X[T450[n75<4439:18A107>|ET}Rf<1;14876/Yb983E<5.YNXd4149>,S=/4E/<306443G/06}0&}UkYSXFYF=44=-5095=88;63844,9E6644{PL}WA8:>)7+>763>>0/B3A545CCnT}Xm|dv}Xq1L/YNXk/H8;;.R63351YY747@15YE4J8;46;.38.>4A369.=-83,;Ye3?:3@YE.4-+N353;/;@(X[YYD>@/05-I*@.:551741Yf5>6A443<3535;.58/86=D4753442$635D1>0359NQ @73:3:>><Xn?;43C14 ?Y|X611YG1&<+,4<*,YLXl<1/AIXjF*N89A4Z576K1XbJ5YF.ZOWN.YGXO/YQ01:4G38Xl1;KI0YFXB=R<7;D/,/4>;$I,YGXm94@O35Yz66695385.>:6A#5}W7n^4336:4157597434433<3|XA}m`>=D>:4A.337370?-6Q96{`E|4A}C`|Qs{Mk|J+~r>|o,wHv>Vw}!c{H!|Gb|*Ca5}J||,U{t+{CN[!M65YXOY_*B,Y[Z9XaX[QYJYLXPYuZ%XcZ8LY[SYPYKZM<LMYG9OYqSQYM~[e{UJXmQYyZM_)>YjN1~[f3{aXFY|Yk:48YdH^NZ0|T){jVFYTZNFY^YTYN~[h{nPYMYn3I]`EYUYsYIZEYJ7Yw)YnXPQYH+Z.ZAZY]^Z1Y`YSZFZyGYHXLYG 8Yd#4~[i|+)YH9D?Y^F~Y7|-eYxZ^WHYdYfZQ~[j|3>~[k|3oYmYqY^XYYO=Z*4[]Z/OYLXhZ1YLZIXgYIHYEYK,<Y`YEXIGZI[3YOYcB4SZ!YHZ*&Y{Xi3~[l|JSY`Zz?Z,~[m|O=Yi>??XnYWXmYS617YVYIHZ(Z4[~L4/=~[n|Yu{P)|];YOHHZ}~[o33|a>~[r|aE]DH~[s|e$Zz~[t|kZFY~XhYXZB[`Y}~[u|{SZ&OYkYQYuZ2Zf8D~[v}% ~[w3},Q[X]+YGYeYPIS~[y}4aZ!YN^!6PZ*~[z}?E~[{3}CnZ=~[}}EdDZz/9A3(3S<,YR8.D=*XgYPYcXN3Z5 4)~[~}JW=$Yu.XX~] }KDX`PXdZ4XfYpTJLY[F5]X~[2Yp}U+DZJ::<446[m@~]#3}]1~]%}^LZwZQ5Z`/OT<Yh^ -~]&}jx[ ~m<z!%2+~ly4VY-~o>}p62yz!%2+Xf2+~ly4VY-zQ`z (=] 2z~o2",C={" ":0,"!":1},c=34,i=2,p,s="",u=String.fromCharCode,t=u(12539);for(;++c<127;)C[u(c)]=c^39&&c^92?i++:0;i=0;for(;0<=(c=C[a.charAt(i++)]);)if(16===c)if((c=C[a.charAt(i++)])<87){if(86===c)c=1879;for(;c--;)s+=u(++p)}else s+=s.substr(8272,360);else if(c<86)s+=u(p+=c<51?c-16:(c-55)*92+C[a.charAt(i++)]);else if((c=((c-86)*92+C[a.charAt(i++)])*92+C[a.charAt(i++)])<49152)s+=u(p=c<40960?c:c|57344);else{c&=511;for(;c--;)s+=t;p=12539}return s\')(),Util.$decodeToShiftJis=function(t){return t.replace(/%(8[1-9A-F]|[9E][0-9A-F]|F[0-9A-C])(%[4-689A-F][0-9A-F]|%7[0-9A-E]|[@-~])|%([0-7][0-9A-F]|A[1-9A-F]|[B-D][0-9A-F])/gi,(function(t){let e=parseInt(t.substring(1,3),16);const s=t.length;return 3===s?String.fromCharCode(e<160?e:e+65216):Util.$JCT11280.charAt(188*(e<160?e-129:e-193)+(4===s?t.charCodeAt(3)-64:(e=parseInt(t.substring(4),16))<127?e-64:e-65))}))},Util.$getTagObject=function(){return Util.$tagObjects.pop()||{placeObjects:[],sounds:[],removeObjects:[],frameLabel:[]}},Util.$poolTagObject=function(t){t.placeObjects.length=0,t.sounds.length=0,t.removeObjects.length=0,t.frameLabel.length=0,Util.$tagObjects.push(t)},Util.$createMovieClip=function(){const t={_$characterId:0,_$name:"MovieClip",_$controller:[],_$placeObjects:[],_$placeMap:[],_$labels:[],_$dictionary:[],_$sounds:[]};return t},Util.$getControllerAt=function(t,e,s){return s in t._$controller[e]?t._$controller[e][s]:null},Util.$addDictionary=function(t,e){const s=t._$dictionary.length,a={CharacterId:e.CharacterId,Depth:e.Depth,Name:null,ClipDepth:0,PlaceFlagHasImage:0|e.PlaceFlagHasImage,StartFrame:0|e.StartFrame,EndFrame:0|e.EndFrame};return e.PlaceFlagHasName&&(a.Name=e.Name),e.PlaceFlagHasClipDepth&&(a.ClipDepth=e.ClipDepth),t._$dictionary[s]=a,s},Util.$getBlendName=function(t){switch(t){default:return"normal";case 2:case"layer":return"layer";case 3:case"multiply":return"multiply";case 4:case"screen":return"screen";case 5:case"lighten":return"lighten";case 6:case"darken":return"darken";case 7:case"difference":return"difference";case 8:case"add":return"add";case 9:case"subtract":return"subtract";case 10:case"invert":return"invert";case 11:case"alpha":return"alpha";case 12:case"erase":return"erase";case 13:case"overlay":return"overlay";case 14:case"hardlight":return"hardlight"}};class ByteStream{constructor(){this.clear()}clear(){this.data=null,this.bit_offset=0,this.byte_offset=0,this.bit_buffer=null}setData(t){this.data=t}getData(t){this.byteAlign();const e=this.byte_offset+t,s=this.data.subarray(this.byte_offset,e);return this.byte_offset=e,s}byteAlign(){this.bit_offset&&(this.byte_offset=this.byte_offset+(this.bit_offset+7)/8|0,this.bit_offset=0)}getDataUntil(t=0){this.byteAlign();let e="";for(;;){const t=this.data[this.byte_offset++];if(!t)break;if(10===t||13===t){e+="\\n";continue}let s=t.toString(16);1===s.length&&(s="0"+s),e+="%"+s}if(!e.length)return"";if(e.length>5&&"\\n"===e.substr(-5)&&(e=e.slice(0,-5)),t)return Util.$decodeToShiftJis(e);try{return decodeURIComponent(e)}catch(t){return Util.$decodeToShiftJis(e)}}byteCarry(){if(this.bit_offset>7)this.byte_offset=this.byte_offset+(0|(this.bit_offset+7)/8),this.bit_offset&=7;else for(;this.bit_offset<0;)--this.byte_offset,this.bit_offset+=8}getUIBits(t){let e=0;for(;t;)e<<=1,e|=this.getUIBit(),--t;return e}getUIBit(){return this.byteCarry(),this.data[this.byte_offset]>>7-this.bit_offset++&1}getSIBits(t){const e=this.getUIBits(t),s=e&1<<t-1;return s?-(e^2*s-1)-1:e}getUI8(){return this.byteAlign(),this.data[this.byte_offset++]}getUI16(){return this.byteAlign(),this.getUI8()|this.getUI8()<<8}getUI32(){return this.byteAlign(),this.getUI8()|(this.getUI8()|(this.getUI8()|this.getUI8()<<8)<<8)<<8}getFloat16(){const t=this.data[this.byte_offset++];let e=0;return e|=this.data[this.byte_offset++]<<8,e|=t<<0,e}getFloat32(){const t=this.data[this.byte_offset++],e=this.data[this.byte_offset++],s=this.data[this.byte_offset++];let a=0;a|=this.data[this.byte_offset++]<<24,a|=s<<16,a|=e<<8,a|=t<<0;const i=a>>23&255;return a&&2147483648!==a?(2147483648&a?-1:1)*(8388608|8388607&a)*Math.pow(2,i-127-23):0}incrementOffset(t,e){this.byte_offset+=t,this.bit_offset+=e,this.byteCarry()}setOffset(t,e){this.byte_offset=t,this.bit_offset=e}}class SwfParser{constructor(){this.byteStream=new ByteStream,this.currentPosition={x:0,y:0},this.jpegTables=null,this.characters=[],this.frameInfo=[],this.fonts=new Map,this.textSettings=new Map,this.grids=new Map,this.version=0}clear(){this.byteStream.clear(),this.currentPosition.x=0,this.currentPosition.y=0,this.jpegTables=null,this.characters.length=0,this.frameInfo.length=0,this.version=0}getCharacter(t){return this.characters[t]}setCharacter(t,e,s){this.characters[t]=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:e},s)}getFont(t){return this.fonts.get(t)}setFont(t,e){this.fonts.set(t,e)}setTextSetting(t,e){this.textSettings.set(t,e)}setGrid(t,e){this.grids.set(t,e)}showFrame(t,e,s,a){let i,r;const h=s-1|0,n=e.frameLabel;i=n.length;for(let e=0;e<i;++e){const a=n[e];a.name in this.frameInfo&&(a.frame=this.frameInfo["@"+a.name]),t._$labels.push({label:a.name,frame:a.frame||s})}const o=e.sounds;i=0|o.length,i&&t._$sounds.push({frame:s,data:o.slice(0)});const l=e.removeObjects;i=l.length;for(let e=0;e<i;++e){const a=l[e],i=Util.$getControllerAt(t,h,a.Depth);t._$dictionary[i].EndFrame=s,Util.$installed.set(a.Depth,1)}s in a||(a[s]=[]),s in t._$controller||(t._$controller[s]=[]),s in t._$placeMap||(t._$placeMap[s]=[]);const c=e.placeObjects,b=h?a[h]:null;i=c.length;for(let e=0;e<i;++e){let i=null;const r=c[e];let n=null;h&&r.Depth in b&&(n=b[r.Depth]),0===r.PlaceFlagHasCharacter&&n&&(r.CharacterId=n.CharacterId);let o=!1;if((0===r.PlaceFlagMove||1===r.PlaceFlagMove&&1===r.PlaceFlagHasCharacter)&&(o=!0),h&&!o&&(i=Util.$getControllerAt(t,h,r.Depth),null===i&&(o=!0)),1===r.PlaceFlagMove&&n&&(1!==n.PlaceFlagHasMatrix||r.PlaceFlagHasMatrix||(r.PlaceFlagHasMatrix=1,r.Matrix=n.Matrix),1!==n.PlaceFlagHasColorTransform||r.PlaceFlagHasColorTransform||(r.PlaceFlagHasColorTransform=1,r.ColorTransform=n.ColorTransform),1!==n.PlaceFlagHasClipDepth||r.PlaceFlagHasClipDepth||(r.PlaceFlagHasClipDepth=1,r.ClipDepth=n.ClipDepth),1!==n.PlaceFlagHasRatio||r.PlaceFlagHasRatio||(r.PlaceFlagHasRatio=1,r.Ratio=n.Ratio),1!==n.PlaceFlagHasFilterList||r.PlaceFlagHasFilterList||(r.PlaceFlagHasFilterList=1,r.SurfaceFilterList=n.SurfaceFilterList),1!==n.PlaceFlagHasBlendMode||r.PlaceFlagHasBlendMode||(r.PlaceFlagHasBlendMode=1,r.BlendMode=n.BlendMode)),h&&!Util.$installed.has(r.Depth)){const e=Util.$getControllerAt(t,h,r.Depth);if(null!==e){const a=t._$dictionary[e];!a||0!==r.PlaceFlagMove&&1!==r.PlaceFlagHasCharacter||(a.EndFrame=0|s,t._$dictionary[e]=a,o=!0)}}if(o){if(r.StartFrame=0|s,r.EndFrame=0,1===r.PlaceFlagHasCharacter&&1===r.PlaceFlagMove){const e=Util.$getControllerAt(t,h,r.Depth),a=t._$dictionary[e];a.EndFrame=0|s,t._$dictionary[e]=a}i=Util.$addDictionary(t,r)}t._$controller[s][r.Depth]=i;const l=t._$placeObjects.length;t._$placeObjects[l]=this.buildPlaceObject(r),t._$placeMap[s][r.Depth]=l,Util.$installed.set(r.Depth,1),a[s][r.Depth]=r}if(h){let e;const n=t._$controller[h];r=Object.keys(n),i=r.length;for(let o=0;o<i;++o)e=0|r[o],Util.$installed.has(e)||(a[s][e]=a[h][e],t._$controller[s][e]=n[e]);const o=t._$placeMap[h];r=Object.keys(o),i=r.length;for(let a=0;a<i;++a)e=r[a],e in t._$placeMap[s]||(t._$placeMap[s][e]=o[e])}Util.$installed.clear()}buildPlaceObject(t){const e={matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],filters:null,blendMode:"normal"};return t.PlaceFlagHasMatrix&&(e.matrix=t.Matrix),t.PlaceFlagHasColorTransform&&(e.colorTransform=t.ColorTransform),t.PlaceFlagHasFilterList&&(e.surfaceFilterList=t.SurfaceFilterList),t.PlaceFlagHasBlendMode&&(e.blendMode=Util.$getBlendName(t.BlendMode)),t.PlaceFlagHasRatio&&(e.ratio=t.Ratio||0),e}postData(t){if(this.textSettings.size){for(let[t,e]of this.textSettings){const s=this.characters[t];s&&(s._$textSetting=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:s}))}this.textSettings.clear()}if(this.grids.size){for(let[t,e]of this.grids){const s=this.characters[t];s&&(s._$grid=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:s}))}this.grids.clear()}if(this.fonts.size){for(let[t,e]of this.fonts){if(!e._$hasLayout){globalThis.postMessage({infoKey:"font",index:t,piece:e});continue}const s=e._$glyphShapeTable,a=e._$zoneTable;e._$glyphShapeTable=[],e._$zoneTable=a?[]:null,globalThis.postMessage({infoKey:"font",index:t,piece:e},[e._$advanceTable.buffer,e._$codeTable.buffer]);const i=s.length;if(i){const e=[],a=[];for(let r=0;r<i;++r){const i=s[r];e.push(i),a.push(i.records.buffer),e.length>256&&(globalThis.postMessage({infoKey:"font_shape",index:t,pieces:e},a),a.length=0,e.length=0)}e.length&&globalThis.postMessage({infoKey:"font_shape",index:t,pieces:e},a)}if(a)for(;a.length;){const e=Math.min(256,a.length);globalThis.postMessage({infoKey:"font_zone",index:t,pieces:a.splice(0,e)})}}this.fonts.clear()}for(let e=1;e<t._$controller.length;++e){const s=t._$controller[e];t._$controller[e]=s.filter((()=>!0))}this.setCharacter(0,t)}parseTags(t,e){const s=Util.$getTagObject();let a=1;const i=[],r=this.byteStream;for(;r.byte_offset<t;){const h=r.byte_offset;if(h+2>t)break;const n=r.getUI16(),o=n>>6;let l=63&n;if(63===l){if(h+6>t){r.byte_offset=h,r.bit_offset=0;break}l=r.getUI32()}const c=r.byte_offset;this.parseTag(o,l,e,a,s,i),1===o&&(++a,s.placeObjects.length=0,s.sounds.length=0,s.removeObjects.length=0,s.frameLabel.length=0);const b=r.byte_offset-c|0;b!==l&&b<l&&(r.byte_offset=r.byte_offset+(l-b)),r.bit_offset=0}Util.$poolTagObject(s)}parseTag(t,e,s,a,i,r){switch(t){case 28:i.removeObjects.push({Frame:a,Depth:this.byteStream.getUI16()});break;case 4:case 26:case 70:i.placeObjects.push(this.parsePlaceObject(t,e));break;case 39:{const t=this.byteStream.byte_offset+e,s=this.byteStream.getUI16();this.byteStream.getUI16();const a=Util.$createMovieClip();a._$characterId=s,this.parseTags(t,a);for(let t=1;t<a._$controller.length;++t){const e=a._$controller[t];a._$controller[t]=e.filter((()=>!0))}this.setCharacter(s,a)}break;case 1:this.showFrame(s,i,a,r);break;case 2:case 22:case 32:case 83:e<10?this.byteStream.byte_offset+=e:this.parseDefineShape(t);break;case 20:case 36:this.parseDefineBitsLossLess(t,e);break;case 6:case 21:case 35:case 90:this.parseDefineBits(t,e,this.jpegTables);break;case 15:case 89:i.sounds.push(this.parseStartSound(t));break;case 10:case 48:case 75:this.parseDefineFont(t,e);break;case 14:this.parseDefineSound(e);break;case 13:case 62:this.parseDefineFontInfo(t,e);break;case 43:i.frameLabel.push(this.parseFrameLabel());break;case 11:case 33:this.parseDefineText(t);break;case 37:this.parseDefineEditText(t);break;case 7:case 34:this.parseDefineButton(t,e);break;case 88:this.parseDefineFontName();break;case 8:e&&(this.jpegTables=this.parseJPEGTables(e));break;case 46:case 84:this.parseDefineMorphShape(t);break;case 18:case 45:this.parseSoundStreamHead(t);break;case 17:this.parseDefineButtonSound();break;case 73:this.parseDefineFontAlignZones();break;case 74:this.parseCSMTextSettings(t);break;case 19:this.parseSoundStreamBlock(t,e);break;case 78:this.parseDefineScalingGrid();break;case 5:console.log("TODO RemoveObject type 5."),i.removeObjects.push({CharacterId:this.byteStream.getUI16(),Depth:this.byteStream.getUI16()});break;default:break;case 86:case 76:case 56:case 9:case 40:case 24:case 63:case 64:case 69:case 65:case 77:case 60:case 61:case 41:case 87:case 59:case 12:case 72:case 82:this.byteStream.byte_offset+=e;break;case 3:case 16:case 23:case 25:case 29:case 31:case 38:case 42:case 44:case 47:case 49:case 52:case 53:case 54:case 55:case 57:case 58:case 66:case 71:case 91:case 93:console.log("[TODO] tagType -> "+t)}}parseDefineShape(t){const e=0|this.byteStream.getUI16(),s=this.rect();if(83===t){const t={};this.rect(),this.byteStream.getUIBits(5),t.UsesFillWindingRule=this.byteStream.getUIBits(1),t.UsesNonScalingStrokes=this.byteStream.getUIBits(1),t.UsesScalingStrokes=this.byteStream.getUIBits(1)}const a=this.shapeWithStyle(t);this.setCharacter(e,{_$records:a,_$name:"Shape",_$bounds:s,_$characterId:e},[a.ShapeData.records.buffer])}rect(){this.byteStream.byteAlign();const t=this.byteStream.getUIBits(5);return{xMin:this.byteStream.getSIBits(t)/20,xMax:this.byteStream.getSIBits(t)/20,yMin:this.byteStream.getSIBits(t)/20,yMax:this.byteStream.getSIBits(t)/20}}shapeWithStyle(t){const e={};switch(t){case 46:case 84:break;default:e.fillStyles=this.fillStyleArray(t),e.lineStyles=this.lineStyleArray(t)}const s=this.byteStream.getUI8(),a=s>>4,i=15&s;return e.ShapeData=this.shapeRecords(t,{FillBits:a,LineBits:i}),e}fillStyleArray(t){let e=0|this.byteStream.getUI8();t>2&&255===e&&(e=this.byteStream.getUI16());const s=[];for(let a=0;a<e;++a)s[s.length]=this.fillStyle(t);return s}fillStyle(t){const e=this.byteStream.getUI8(),s={};switch(s.fillStyleType=e,e){case 0:switch(t){case 32:case 83:s.Color=this.rgba();break;case 46:case 84:s.StartColor=this.rgba(),s.EndColor=this.rgba();break;default:s.Color=this.rgb()}break;case 16:case 18:switch(t){case 46:case 84:s.startGradientMatrix=this.matrix(),s.endGradientMatrix=this.matrix(),s.gradient=this.gradient(t);break;default:s.gradientMatrix=this.matrix(),s.gradient=this.gradient(t)}break;case 19:s.gradientMatrix=this.matrix(),s.gradient=this.focalGradient(t);break;case 64:case 65:case 66:case 67:switch(s.bitmapId=this.byteStream.getUI16(),t){case 46:case 84:s.startBitmapMatrix=this.matrix(),s.endBitmapMatrix=this.matrix();break;default:s.bitmapMatrix=this.matrix()}}return s}rgb(){return{R:0|this.byteStream.getUI8(),G:0|this.byteStream.getUI8(),B:0|this.byteStream.getUI8(),A:1}}rgba(){return{R:this.byteStream.getUI8(),G:this.byteStream.getUI8(),B:this.byteStream.getUI8(),A:this.byteStream.getUI8()/255}}matrix(){this.byteStream.byteAlign();const t=[1,0,0,1,0,0];if(this.byteStream.getUIBit()){const e=this.byteStream.getUIBits(5);t[0]=this.byteStream.getSIBits(e)/65536,t[3]=this.byteStream.getSIBits(e)/65536}if(this.byteStream.getUIBit()){const e=this.byteStream.getUIBits(5);t[1]=this.byteStream.getSIBits(e)/65536,t[2]=this.byteStream.getSIBits(e)/65536}const e=this.byteStream.getUIBits(5);return t[4]=this.byteStream.getSIBits(e)/20,t[5]=this.byteStream.getSIBits(e)/20,t}gradient(t){let e,s=0,a=0;switch(this.byteStream.byteAlign(),t){case 46:case 84:e=this.byteStream.getUI8();break;default:s=this.byteStream.getUIBits(2),a=this.byteStream.getUIBits(2),e=this.byteStream.getUIBits(4)}const i=[];for(let s=0;s<e;++s)i[i.length]=this.gradientRecord(t);return{SpreadMode:s,InterpolationMode:a,GradientRecords:i,FocalPoint:0}}gradientRecord(t){switch(t){case 46:case 84:return{StartRatio:this.byteStream.getUI8()/255,StartColor:this.rgba(),EndRatio:this.byteStream.getUI8()/255,EndColor:this.rgba()};default:return{Ratio:this.byteStream.getUI8()/255,Color:t<32?this.rgb():this.rgba()}}}focalGradient(t){this.byteStream.byteAlign();const e=this.byteStream.getUIBits(2),s=this.byteStream.getUIBits(2),a=this.byteStream.getUIBits(4),i=[];for(let e=0;e<a;++e)i[i.length]=this.gradientRecord(t);return{SpreadMode:e,InterpolationMode:s,GradientRecords:i,FocalPoint:this.byteStream.getFloat16()}}lineStyleArray(t){let e=this.byteStream.getUI8();t>2&&255===e&&(e=this.byteStream.getUI16());const s=[];for(let a=0;a<e;++a)s[s.length]=this.lineStyles(t);return s}lineStyles(t){const e={fillStyleType:0};switch(t){case 46:e.StartWidth=this.byteStream.getUI16()/20,e.EndWidth=this.byteStream.getUI16()/20,e.StartColor=this.rgba(),e.EndColor=this.rgba();break;case 84:e.StartWidth=this.byteStream.getUI16()/20,e.EndWidth=this.byteStream.getUI16()/20,e.StartCapStyle=this.byteStream.getUIBits(2),e.JoinStyle=this.byteStream.getUIBits(2),e.HasFillFlag=this.byteStream.getUIBit(),e.NoHScaleFlag=this.byteStream.getUIBit(),e.NoVScaleFlag=this.byteStream.getUIBit(),e.PixelHintingFlag=this.byteStream.getUIBit(),this.byteStream.getUIBits(5),e.NoClose=this.byteStream.getUIBit(),e.EndCapStyle=this.byteStream.getUIBits(2),2===e.JoinStyle&&(e.MiterLimitFactor=this.byteStream.getUI16()/20),e.HasFillFlag?e.FillType=this.fillStyle(t):(e.StartColor=this.rgba(),e.EndColor=this.rgba());break;case 83:e.Width=this.byteStream.getUI16()/20,e.StartCapStyle=this.byteStream.getUIBits(2),e.JoinStyle=this.byteStream.getUIBits(2),e.HasFillFlag=this.byteStream.getUIBit(),e.NoHScaleFlag=this.byteStream.getUIBit(),e.NoVScaleFlag=this.byteStream.getUIBit(),e.PixelHintingFlag=this.byteStream.getUIBit(),this.byteStream.getUIBits(5),e.NoClose=this.byteStream.getUIBit(),e.EndCapStyle=this.byteStream.getUIBits(2),2===e.JoinStyle&&(e.MiterLimitFactor=this.byteStream.getUI16()),e.HasFillFlag?e.FillType=this.fillStyle(t):e.Color=this.rgba();break;case 32:e.Width=this.byteStream.getUI16()/20,e.Color=this.rgba(),e.JoinStyle=0,e.StartCapStyle=0,e.EndCapStyle=0;break;default:e.Width=this.byteStream.getUI16()/20,e.Color=this.rgb(),e.JoinStyle=0,e.StartCapStyle=0,e.EndCapStyle=0}return e}shapeRecords(t,e){this.currentPosition.x=0,this.currentPosition.y=0;const s=[],a=[];for(;;){const i=this.byteStream.getUIBits(6);if(32&i){const e=15&i;if(16&i){this.straightEdgeRecord(t,e,s);continue}this.curvedEdgeRecord(t,e,s)}else{if(!i){s.push(-1),this.byteStream.byteAlign();break}this.styleChangeRecord(t,i,e,s,a)}}const i={records:new Int32Array(s)};return a.length&&(i.styles=a),i}straightEdgeRecord(t,e,s){let a=0,i=0;this.byteStream.getUIBit()?(a=this.byteStream.getSIBits(e+2),i=this.byteStream.getSIBits(e+2)):this.byteStream.getUIBit()?i=this.byteStream.getSIBits(e+2):a=this.byteStream.getSIBits(e+2);let r=a,h=i;switch(t){case 46:case 84:break;default:r=this.currentPosition.x+a,h=this.currentPosition.y+i,this.currentPosition.x=r,this.currentPosition.y=h}s.push(0,0,r,h)}curvedEdgeRecord(t,e,s){const a=this.byteStream.getSIBits(e+2),i=this.byteStream.getSIBits(e+2),r=this.byteStream.getSIBits(e+2),h=this.byteStream.getSIBits(e+2);let n=a,o=i,l=r,c=h;switch(t){case 46:case 84:break;default:n=this.currentPosition.x+a,o=this.currentPosition.y+i,l=n+r,c=o+h,this.currentPosition.x=l,this.currentPosition.y=c}s.push(0,1,n,o,l,c)}styleChangeRecord(t,e,s,a,i){const r=e>>4&1,h=e>>3&1,n=e>>2&1,o=e>>1&1,l=1&e;let c=0,b=0;if(l){const t=this.byteStream.getUIBits(5);c=this.byteStream.getSIBits(t),b=this.byteStream.getSIBits(t),this.currentPosition.x=c,this.currentPosition.y=b}const g=o?this.byteStream.getUIBits(s.FillBits):0,y=n?this.byteStream.getUIBits(s.FillBits):0,S=h?this.byteStream.getUIBits(s.LineBits):0;let m=null,f=null,d=0,Y=0;if(r){m=this.fillStyleArray(t),f=this.lineStyleArray(t);const e=this.byteStream.getUI8();s.FillBits=d=e>>4,s.LineBits=Y=15&e}a.push(1,r),r&&(a.push(d,Y),i.push({FillStyles:m,LineStyles:f})),a.push(l),l&&a.push(c,b),a.push(o),o&&a.push(g),a.push(n),n&&a.push(y),a.push(h),h&&a.push(S)}parseDefineBitsLossLess(t,e){const s=this.byteStream.byte_offset,a=this.byteStream.getUI16(),i=this.byteStream.getUI8(),r=this.byteStream.getUI16(),h=this.byteStream.getUI16(),n=36===t,o=3===i?this.byteStream.getUI8()+1:0;let l=r*h*4;if(3===i){l=(r+((r+3&-4)-r|0))*h+o*(n?4:3)}const c=e-(this.byteStream.byte_offset-s),b=this.byteStream.byte_offset;this.byteStream.byte_offset+=c;const g=this.byteStream.data.slice(b,this.byteStream.byte_offset),y={width:r,height:h,format:i,fileSize:l,tableSize:o,isAlpha:n,color:n?4278190080:0,_$name:"lossless",_$characterId:a,buffer:g};this.setCharacter(a,y,[g.buffer])}parseJPEGTables(t){const e=this.byteStream.byte_offset;return this.byteStream.byte_offset+=t,{offset:e,length:this.byteStream.byte_offset}}parseDefineBits(t,e,s=null){const a=this.byteStream.byte_offset,i=this.byteStream.getUI16(),r=this.byteStream.byte_offset-a,h=35===t||90===t?this.byteStream.getUI32():e-r;if(90===t){const t=this.byteStream.getUI16();console.log("TODO DeblockParam",t)}const n=this.byteStream.byte_offset;this.byteStream.byte_offset+=h;let o=this.byteStream.data.slice(n,this.byteStream.byte_offset);if(s){const t=this.byteStream.data.subarray(s.offset,s.length);if(t.length>4&&255===o[0]&&216===o[1]){const e=t.length-2,s=o.length,a=new Uint8Array(e+s);a.set(t.subarray(0,e),0),a.set(o.subarray(2,s),e),o=a}}const l={infoKey:"character",_$name:"imageData",_$characterId:i,jpegData:o,alphaData:null},c=[];c.push(o.buffer);let b=!1;const g=a+e-this.byteStream.byte_offset;if(g){b=!0;const t=this.byteStream.byte_offset;this.byteStream.byte_offset+=g;const e=this.byteStream.data.slice(t,this.byteStream.byte_offset);l.alphaData=e,c.push(e.buffer)}l.isAlpha=b,l.color=b?4278190080:0,this.setCharacter(i,l,c)}parseDefineFont(t,e){const s=this.byteStream.byte_offset+e|0,a=this.byteStream.getUI16(),i=this.getFont(a)||{};let r=0,h=0,n=0;if(48===t||75===t){const t=this.byteStream.getUI8();i._$hasLayout=t>>>7&1,i._$shiftJIS=t>>>6&1,i._$smallText=t>>>5&1,i._$ANSI=t>>>4&1,h=t>>>3&1,n=t>>>2&1,i._$italic=t>>>1&1,i._$bold=1&t,this.byteStream.byteAlign(),i._$languageCode=this.byteStream.getUI8();const e=this.byteStream.getUI8();if(e){const t=0|this.byteStream.byte_offset;i._$fontName=this.getFontName(this.byteStream.getDataUntil()),this.byteStream.byte_offset=t+e|0}r=this.byteStream.getUI16(),i._$numGlyphs=r}const o=0|this.byteStream.byte_offset;if(10===t&&(r=this.byteStream.getUI16()),r){const e=[];10===t&&(e[0]=r,r/=2,r-=1);let s=0;if(1===h){for(let t=0;t<r;++t)e[e.length]=this.byteStream.getUI32();10!==t&&(s=this.byteStream.getUI32())}else{for(let t=0;t<r;++t)e[e.length]=this.byteStream.getUI16();10!==t&&(s=this.byteStream.getUI16())}const a=[];10===t&&(r+=1);for(let s=0;s<r;++s){this.byteStream.setOffset(e[s]+o,0);const i=this.byteStream.getUI8(),r={FillBits:i>>4,LineBits:15&i};a[a.length]=this.shapeRecords(t,r)}switch(i._$glyphShapeTable=a,t){case 48:case 75:if(this.byteStream.setOffset(s+o,0),1===n){const t=new Uint16Array(r);for(let e=0;e<r;++e)t[e]=this.byteStream.getUI16();i._$codeTable=t}else{const t=new Uint8Array(r);for(let e=0;e<r;++e)t[e]=this.byteStream.getUI8();i._$codeTable=t}if(i._$hasLayout){i._$ascent=this.byteStream.getUI16(),i._$descent=this.byteStream.getUI16(),i._$leading=this.byteStream.getUI16();const e=new Uint16Array(r);for(let t=0;t<r;++t)e[t]=this.byteStream.getUI16();i._$advanceTable=e;const s=[];for(let t=0;t<r;++t)s[s.length]=this.rect();if(75===t){const t=this.byteStream.getUI16(),e=[];for(let s=0;s<t;++s){const t=n?this.byteStream.getUI16():this.byteStream.getUI8(),s=n?this.byteStream.getUI16():this.byteStream.getUI8(),a=this.byteStream.getSIBits(16);e[e.length]={FontKerningCode1:t,FontKerningCode2:s,FontKerningAdjustment:a}}i._$kerningRecords=e}}}}this.byteStream.byte_offset=0|s,this.setFont(a,i)}parseDefineFontInfo(t,e){const s=this.byteStream.byte_offset+e|0,a=this.byteStream.getUI16();let i=this.getFont(a);i||(i={});const r=this.byteStream.getUI8(),h=this.byteStream.getData(r);let n="";for(let t=0;t<r;++t)h[t]>127||(n+=String.fromCharCode(h[t]));this.byteStream.getUIBits(2),i._$smallText=this.byteStream.getUIBits(1),i._$shiftJIS=this.byteStream.getUIBits(1),i._$ANSI=this.byteStream.getUIBits(1),i._$italic=this.byteStream.getUIBits(1),i._$bold=this.byteStream.getUIBits(1);const o=this.byteStream.getUIBits(1);62===t&&(i._$languageCode=this.byteStream.getUI8());const l=i._$shiftJIS||2===i._$languageCode?Util.$decodeToShiftJis(n):decodeURIComponent(n);i._$fontName=this.getFontName(l),this.byteStream.byteAlign();const c=[];let b=null;if(!0==(1===o||62===t)){for(;this.byteStream.byte_offset<s;)c[c.length]=this.byteStream.getUI16();b=new Uint16Array(c)}else{for(;this.byteStream.byte_offset<s;)c[c.length]=this.byteStream.getUI8();b=new Uint8Array(c)}i._$codeTable=b,this.setFont(a,i)}getFontName(t){const e=0|t.length;switch(0===t.substr(e-1).charCodeAt(0)&&(t=t.slice(0,-1)),t){case"_sans":return"_sans";case"_serif":return"_serif";case"_typewriter":return"_typewriter";case"_等幅":return"Osaka";default:return"_"===t.substr(0,1)?"sans-serif":t}}parseDefineFontName(){this.byteStream.getUI16(),this.byteStream.getDataUntil(),this.byteStream.getDataUntil()}parseDefineText(t){const e={_$name:"StaticText"};e._$characterId=0|this.byteStream.getUI16(),e._$bounds=this.rect(),e._$baseMatrix=this.matrix(),e._$shapeRecords=null;const s=this.byteStream.getUI8(),a=this.byteStream.getUI8();e._$textRecords=this.getTextRecords(t,s,a),this.setCharacter(e._$characterId,e)}getTextRecords(t,e,s){const a=[];for(;0!==this.byteStream.getUI8();){this.byteStream.incrementOffset(-1,0);const i={};i.TextRecordType=this.byteStream.getUIBits(1),i.StyleFlagsReserved=this.byteStream.getUIBits(3),i.StyleFlagsHasFont=this.byteStream.getUIBits(1),i.StyleFlagsHasColor=this.byteStream.getUIBits(1),i.StyleFlagsHasYOffset=this.byteStream.getUIBits(1),i.StyleFlagsHasXOffset=this.byteStream.getUIBits(1),i.StyleFlagsHasFont&&(i.FontId=this.byteStream.getUI16()),i.StyleFlagsHasColor&&(i.TextColor=11===t?this.rgb():this.rgba()),i.StyleFlagsHasXOffset&&(i.XOffset=this.byteStream.getUI16()/20),i.StyleFlagsHasYOffset&&(i.YOffset=this.byteStream.getUI16()/20),i.StyleFlagsHasFont&&(i.TextHeight=this.byteStream.getUI16()),i.GlyphCount=this.byteStream.getUI8(),i.GlyphEntries=this.getGlyphEntries(i.GlyphCount,e,s),a[a.length]=i}return a}getGlyphEntries(t,e,s){const a=[];for(let i=0;i<t;++i)a[a.length]={GlyphIndex:this.byteStream.getUIBits(e),GlyphAdvance:this.byteStream.getSIBits(s)/20};return a}parseDefineEditText(){const t={_$ns:["flash","text"],_$name:"TextField"},e={},s=this.byteStream.getUI16();t._$characterId=s,t._$bounds=this.rect();const a=this.byteStream.getUI8(),i=a>>>7&1;t._$wordWrap=a>>>6&1,t._$multiline=a>>>5&1,t._$displayAsPassword=a>>>4&1;const r=a>>>3&1;t._$type="dynamic",r||(t._$type="input");const h=a>>>2&1,n=a>>>1&1,o=1&a,l=this.byteStream.getUI8(),c=l>>>7&1,b=l>>>5&1;t._$selectable=l>>>4&1,t._$border=l>>>3&1;const g=l>>>1&1,y=1&l;t._$border&&(t._$background=!0);let S=0;if(o){const s=this.byteStream.getUI16(),a=this.getFont(s);if(a){if(S=a._$shiftJIS,c){const t=this.byteStream.getDataUntil();console.log("TODO HasFontClass: ",t)}e._$font=a._$fontName,e._$size=this.byteStream.getUI16()/20,t._$fontId=0|s,t._$embedFonts=!(!y&&"embedded"!==a.fontType||t.displayAsPassword)}}if(h){const e=this.rgba();t._$textColor=(e.R<<16)+(e.G<<8)+e.B+255*e.A*16777216}if(n&&(t._$maxChars=this.byteStream.getUI16()),b){switch(this.byteStream.getUI8()){case 0:e._$align="left";break;case 1:e._$align="right";break;case 2:e._$align="center";break;case 3:e._$align="justify"}e._$leftMargin=this.byteStream.getUI16()/20,e._$rightMargin=this.byteStream.getUI16()/20,e._$indent=this.byteStream.getUI16(),e._$indent>=32768&&(e._$indent-=65536),e._$leading=this.byteStream.getUI16(),e._$leading>=32768&&(e._$leading-=65536),e._$indent/=20,e._$leading/=20}const m=this.byteStream.getDataUntil(S)+"";if(t._$text="",i){const e=this.byteStream.getDataUntil(S);if(!0==(1===g))t._$htmlText=e,t._$initText=!0;else t._$text=e}""!==m&&console.log("VariableName: ",m),t._$defaultTextFormat=[null,e._$font,e._$size,e._$color,e._$bold,e._$italic,e._$underline,e._$url,e._$target,e._$align,e._$leftMargin,e._$rightMargin,0,e._$leading,e._$indent],this.setCharacter(s,t)}parseDefineMorphShape(t){const e={};e.CharacterId=this.byteStream.getUI16(),e.StartBounds=this.rect(),e.EndBounds=this.rect(),84===t&&(e.StartEdgeBounds=this.rect(),e.EndEdgeBounds=this.rect(),this.byteStream.getUIBits(6),e.UsesNonScalingStrokes=this.byteStream.getUIBits(1),e.UsesScalingStrokes=this.byteStream.getUIBits(1));const s=this.byteStream.getUI32(),a=this.byteStream.byte_offset+s;e.MorphFillStyles=this.fillStyleArray(t),e.MorphLineStyles=this.lineStyleArray(t),e.StartEdges=this.shapeWithStyle(t),this.byteStream.byte_offset!==a&&(this.byteStream.byte_offset=a),e.EndEdges=this.shapeWithStyle(t);const i={x:0,y:0},r={x:0,y:0},h=e.StartEdges.ShapeData.records,n=e.EndEdges.ShapeData.records,o=h.length,l=n.length;let c=Math.max(o,l);const b=[],g=[];let y=0,S=0;for(;c>y||c>S;){const t=h[y++],e=n[S++];if(-1===t&&-1===e)break;switch(!0){case-1===t:case void 0===t:if(e){const t=n[S++];if(g.push(1,t),b.push(1,t),t){const t=n[S++],e=n[S++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=n[S++];if(g.push(e),b.push(e),e){const t=n[S++],e=n[S++];r.x=t,r.y=e,g.push(t,e),b.push(t,e)}const s=n[S++];if(g.push(s),b.push(s),s){const t=n[S++];g.push(t),b.push(t)}const a=n[S++];if(g.push(a),b.push(a),a){const t=n[S++];g.push(t),b.push(t)}const i=n[S++];if(g.push(i),b.push(i),i){const t=n[S++];g.push(t),b.push(t)}break}if(n[S++]){const t=n[S++],e=n[S++],s=n[S++],a=n[S++];r.x+=t+s,r.y+=e+a,g.push(0,1,t,e,s,a),b.push(0,1,t,e,s,a)}else{const t=n[S++],e=n[S++];r.x+=t,r.y+=e,g.push(0,0,t,e),b.push(0,0,t,e)}break;case-1===e:case void 0===e:if(t){const t=h[y++];if(g.push(1,t),b.push(1,t),t){const t=h[y++],e=h[y++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=h[y++];if(g.push(e),b.push(e),e){const t=h[y++],e=h[y++];i.x=t,i.y=e,g.push(t,e),b.push(t,e)}const s=h[y++];if(g.push(s),b.push(s),s){const t=h[y++];g.push(t),b.push(t)}const a=h[y++];if(g.push(a),b.push(a),a){const t=h[y++];g.push(t),b.push(t)}const r=h[y++];if(g.push(r),b.push(r),r){const t=h[y++];g.push(t),b.push(t)}break}if(h[y++]){const t=h[y++],e=h[y++],s=h[y++],a=h[y++];i.x+=t+s,i.y+=e+a,g.push(0,1,t,e,s,a),b.push(0,1,t,e,s,a)}else{const t=h[S++],e=h[S++];i.x+=t,i.y+=e,g.push(0,0,t,e),b.push(0,0,t,e)}break;case 1===t&&1===e:const s=h[y++];if(b.push(1,s),s){const t=h[y++],e=h[y++];b.push(t,e),console.log("TODO Parse Morph NewStyles")}const a=h[y++];if(b.push(a),a){const t=h[y++],e=h[y++];i.x=t,i.y=e,b.push(t,e)}const o=h[y++];if(b.push(o),o){const t=h[y++];b.push(t)}const l=h[y++];if(b.push(l),l){const t=h[y++];b.push(t)}const c=h[y++];if(b.push(c),c){const t=h[y++];b.push(t)}const m=n[S++];if(g.push(1,m),m){const t=n[S++],e=n[S++];g.push(t,e),console.log("TODO Parse Morph NewStyles")}const f=n[S++];if(g.push(f),f){const t=n[S++],e=n[S++];i.x=t,i.y=e,g.push(t,e)}const d=n[S++];if(g.push(d),d){const t=n[S++];g.push(t)}const Y=n[S++];if(g.push(Y),Y){const t=n[S++];g.push(t)}const I=n[S++];if(g.push(I),I){const t=n[S++];g.push(t)}break;case 0===t&&0===e:if(h[y++]){const t=h[y++],e=h[y++],s=h[y++],a=h[y++];i.x=s,i.y=a,b.push(0,1,t,e,s,a)}else{const t=h[y++],e=h[y++];i.x=t,i.y=e,b.push(0,0,t,e)}if(n[S++]){const t=n[S++],e=n[S++],s=n[S++],a=n[S++];r.x=s,r.y=a,g.push(0,1,t,e,s,a)}else{const t=n[S++],e=n[S++];r.x=t,r.y=e,g.push(0,0,t,e)}break;case 1===t&&0===e:{const t=h[y++];if(g.push(1,t),b.push(1,t),t){const t=h[y++],e=h[y++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=h[y++];if(g.push(e),b.push(e),e){const t=h[y++],e=h[y++];i.x=t,i.y=e,g.push(t,e),b.push(t,e)}const s=h[y++];if(g.push(s),b.push(s),s){const t=h[y++];g.push(t),b.push(t)}const a=h[y++];if(g.push(a),b.push(a),a){const t=h[y++];g.push(t),b.push(t)}const r=h[y++];if(g.push(r),b.push(r),r){const t=h[y++];g.push(t),b.push(t)}--S}break;case 0===t&&1===e:{const t=n[S++];if(g.push(1,t),b.push(1,t),t){const t=n[S++],e=n[S++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=n[S++];if(g.push(e),b.push(e),e){const t=n[S++],e=n[S++];r.x=t,r.y=e,g.push(t,e),b.push(t,e)}const s=n[S++];if(g.push(s),b.push(s),s){const t=n[S++];g.push(t),b.push(t)}const a=n[S++];if(g.push(a),b.push(a),a){const t=n[S++];g.push(t),b.push(t)}const i=n[S++];if(g.push(i),b.push(i),i){const t=n[S++];g.push(t),b.push(t)}--y}}}b.push(-1),g.push(-1),e.StartEdges.ShapeData.records=new Int32Array(b),e.EndEdges.ShapeData.records=new Int32Array(g),this.setCharacter(e.CharacterId,{_$ns:["flash","display"],_$name:"MorphShape",_$characterId:e.CharacterId,_$endBounds:e.EndBounds,_$endEdges:e.EndEdges,_$fillStyles:e.MorphFillStyles,_$lineStyles:e.MorphLineStyles,_$startBounds:e.StartBounds,_$startEdges:e.StartEdges,_$shapes:null,_$frameData:[],_$frameCreated:!1},[e.StartEdges.ShapeData.records.buffer,e.EndEdges.ShapeData.records.buffer])}parseFrameLabel(){return{name:this.byteStream.getDataUntil(),frame:0}}parseDefineButton(t,e){const s=this.byteStream.byte_offset+e|0,a={_$ns:["flash","display"],_$name:"SimpleButton"};a._$characterId=0|this.byteStream.getUI16();let i=0;7!==t&&(this.byteStream.getUIBits(7),a._$trackAsMenu=!!this.byteStream.getUIBits(1),i=0|this.byteStream.getUI16()),a._$characters=this.buttonCharacters(s),7===t?(i=s-this.byteStream.byte_offset|0,this.byteStream.byte_offset+=i):i>0&&(a._$actions=this.buttonActions(s)),this.setCharacter(a._$characterId,a),this.byteStream.byte_offset!==s&&(this.byteStream.byte_offset=0|s)}buttonCharacters(t){const e=[];for(;0!==this.byteStream.getUI8();){this.byteStream.incrementOffset(-1,0);const s=0|this.byteStream.byte_offset,a=this.buttonRecord();if(this.byteStream.byte_offset>t){this.byteStream.byte_offset=0|s;break}e[e.length]=a}return e}buttonRecord(){this.byteStream.getUIBits(2);const t={};return t.PlaceFlagHasBlendMode=this.byteStream.getUIBits(1),t.PlaceFlagHasFilterList=this.byteStream.getUIBits(1),t.ButtonStateHitTest=this.byteStream.getUIBits(1),t.ButtonStateDown=this.byteStream.getUIBits(1),t.ButtonStateOver=this.byteStream.getUIBits(1),t.ButtonStateUp=this.byteStream.getUIBits(1),t.CharacterId=this.byteStream.getUI16(),t.Depth=this.byteStream.getUI16(),t.PlaceFlagHasMatrix=1,t.Matrix=this.matrix(),t.ColorTransform=this.colorTransform(),t.PlaceFlagHasColorTransform=void 0===t.ColorTransform?0:1,t.PlaceFlagHasBlendMode&&(t.BlendMode=this.byteStream.getUI8()),t.PlaceFlagHasFilterList&&(t.SurfaceFilterList=this.getFilterList()),t.PlaceFlagHasRatio=0,t.PlaceFlagHasClipDepth=0,t.Sound=null,t}buttonActions(t){for(;;){const e={},s=0|this.byteStream.byte_offset,a=this.byteStream.getUI16();e.CondIdleToOverDown=this.byteStream.getUIBits(1),e.CondOutDownToIdle=this.byteStream.getUIBits(1),e.CondOutDownToOverDown=this.byteStream.getUIBits(1),e.CondOverDownToOutDown=this.byteStream.getUIBits(1),e.CondOverDownToOverUp=this.byteStream.getUIBits(1),e.CondOverUpToOverDown=this.byteStream.getUIBits(1),e.CondOverUpToIdle=this.byteStream.getUIBits(1),e.CondIdleToOverUp=this.byteStream.getUIBits(1),e.CondKeyPress=this.byteStream.getUIBits(7),e.CondOverDownToIdle=this.byteStream.getUIBits(1);const i=t-this.byteStream.byte_offset+1|0;if(this.byteStream.byte_offset+=i,!a)break;this.byteStream.byte_offset=s+a|0}return[]}parsePlaceObject(t,e){const s=this.byteStream.byte_offset,a={};if(a.tagType=t,4===t)return a.CharacterId=this.byteStream.getUI16(),a.Depth=this.byteStream.getUI16(),a.Matrix=this.matrix(),a.PlaceFlagHasMatrix=1,this.byteStream.byteAlign(),this.byteStream.byte_offset-s<e&&(a.ColorTransform=this.colorTransform(),a.PlaceFlagHasColorTransform=1),this.byteStream.byteAlign(),this.byteStream.byte_offset=s+e,a;const i=this.swfVersion;if(a.PlaceFlagHasClipActions=this.byteStream.getUIBits(1),a.PlaceFlagHasClipDepth=this.byteStream.getUIBits(1),a.PlaceFlagHasName=this.byteStream.getUIBits(1),a.PlaceFlagHasRatio=this.byteStream.getUIBits(1),a.PlaceFlagHasColorTransform=this.byteStream.getUIBits(1),a.PlaceFlagHasMatrix=this.byteStream.getUIBits(1),a.PlaceFlagHasCharacter=this.byteStream.getUIBits(1),a.PlaceFlagMove=this.byteStream.getUIBits(1),70===t&&(this.byteStream.getUIBits(1),a.PlaceFlagOpaqueBackground=this.byteStream.getUIBits(1),a.PlaceFlagHasVisible=this.byteStream.getUIBits(1),a.PlaceFlagHasImage=this.byteStream.getUIBits(1),a.PlaceFlagHasClassName=this.byteStream.getUIBits(1),a.PlaceFlagHasCacheAsBitmap=this.byteStream.getUIBits(1),a.PlaceFlagHasBlendMode=this.byteStream.getUIBits(1),a.PlaceFlagHasFilterList=this.byteStream.getUIBits(1)),a.Depth=this.byteStream.getUI16(),a.PlaceFlagHasClassName&&(a.ClassName=this.byteStream.getDataUntil(),console.log("TODO ",a.ClassName)),a.PlaceFlagHasCharacter&&(a.CharacterId=this.byteStream.getUI16()),a.PlaceFlagHasMatrix&&(a.Matrix=this.matrix()),a.PlaceFlagHasColorTransform&&(a.ColorTransform=this.colorTransform()),a.PlaceFlagHasRatio&&(a.Ratio=this.byteStream.getUI16()),a.PlaceFlagHasName&&(a.Name=this.byteStream.getDataUntil()),a.PlaceFlagHasClipDepth&&(a.ClipDepth=this.byteStream.getUI16()),70===t&&(a.PlaceFlagHasFilterList&&(a.SurfaceFilterList=this.getFilterList()),a.PlaceFlagHasBlendMode&&(a.BlendMode=this.byteStream.getUI8()),a.PlaceFlagHasCacheAsBitmap&&(a.BitmapCache=this.byteStream.getUI8()),a.PlaceFlagHasVisible&&(a.Visible=this.byteStream.getUI8()),a.PlaceFlagOpaqueBackground&&(a.BackgroundColor=this.rgba())),a.PlaceFlagHasClipActions){this.byteStream.getUI16(),a.AllEventFlags=this.parseClipEventFlags();const t=s+e;for(;this.byteStream.byte_offset<t;){const e=this.parseClipActionRecord(t);if(t<=this.byteStream.byte_offset)break;if(!(i<=5?this.byteStream.getUI16():this.byteStream.getUI32()))break;this.byteStream.byte_offset-=i<=5?2:4,e.KeyCode&&(this.byteStream.byte_offset-=1)}}return this.byteStream.byteAlign(),this.byteStream.byte_offset=s+e,a}parseClipActionRecord(t){const e={},s=this.parseClipEventFlags();if(t>this.byteStream.byte_offset){const t=this.byteStream.getUI32();s.keyPress&&(e.KeyCode=this.byteStream.getUI8()),this.byteStream.byte_offset+=t}return e}parseClipEventFlags(){const t=this.swfVersion,e={};return e.keyUp=this.byteStream.getUIBits(1),e.keyDown=this.byteStream.getUIBits(1),e.mouseUp=this.byteStream.getUIBits(1),e.mouseDown=this.byteStream.getUIBits(1),e.mouseMove=this.byteStream.getUIBits(1),e.unload=this.byteStream.getUIBits(1),e.enterFrame=this.byteStream.getUIBits(1),e.load=this.byteStream.getUIBits(1),t>=6&&(e.dragOver=this.byteStream.getUIBits(1),e.rollOut=this.byteStream.getUIBits(1),e.rollOver=this.byteStream.getUIBits(1),e.releaseOutside=this.byteStream.getUIBits(1),e.release=this.byteStream.getUIBits(1),e.press=this.byteStream.getUIBits(1),e.initialize=this.byteStream.getUIBits(1)),e.data=this.byteStream.getUIBits(1),t>=6&&(this.byteStream.getUIBits(5),e.construct=this.byteStream.getUIBits(1),e.keyPress=this.byteStream.getUIBits(1),e.dragOut=this.byteStream.getUIBits(1),this.byteStream.getUIBits(8)),this.byteStream.byteAlign(),e}getFilterList(){const t=0|this.byteStream.getUI8(),e=[];for(let s=0;s<t;++s){const t=this.getFilter();t&&(e[e.length]=t)}return e.length?e:null}getFilter(){switch(0|this.byteStream.getUI8()){case 0:return this.dropShadowFilter();case 1:return this.blurFilter();case 2:return this.glowFilter();case 3:return this.bevelFilter();case 4:return this.gradientGlowFilter();case 5:return this.convolutionFilter();case 6:return this.colorMatrixFilter();case 7:return this.gradientBevelFilter()}}dropShadowFilter(){const t={},e=this.rgba(),s=e.A,a=e.R<<16|e.G<<8|e.B,i=this.byteStream.getUI32()/65536,r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536*Util.$Rad2Deg,n=this.byteStream.getUI32()/65536,o=this.byteStream.getFloat16()/256,l=!!this.byteStream.getUIBits(1),c=!!this.byteStream.getUIBits(1),b=!this.byteStream.getUIBits(1),g=this.byteStream.getUIBits(5);return t._$ns=["flash","filters"],t._$name="DropShadowFilter",t.params=[null,n,h,a,s,i,r,o,g,l,c,b],t}blurFilter(){const t={},e=this.byteStream.getUI32()/65536,s=this.byteStream.getUI32()/65536,a=this.byteStream.getUIBits(5);return this.byteStream.getUIBits(3),t._$ns=["flash","filters"],t._$name="BlurFilter",t.params=[null,e,s,a],t}glowFilter(){const t={},e=this.rgba(),s=e.A,a=e.R<<16|e.G<<8|e.B,i=this.byteStream.getUI32()/65536,r=this.byteStream.getUI32()/65536,h=this.byteStream.getFloat16()/256,n=!!this.byteStream.getUIBits(1),o=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const l=this.byteStream.getUIBits(5);return t._$ns=["flash","filters"],t._$name="GlowFilter",t.params=[null,a,s,i,r,h,l,n,o],t}bevelFilter(){const t={};let e=this.rgba();const s=e.A,a=e.R<<16|e.G<<8|e.B;e=this.rgba();const i=e.A,r=e.R<<16|e.G<<8|e.B,h=this.byteStream.getUI32()/65536,n=this.byteStream.getUI32()/65536,o=this.byteStream.getUI32()/65536*Util.$Rad2Deg,l=this.byteStream.getUI32()/65536,c=this.byteStream.getFloat16()/256,b=!!this.byteStream.getUIBits(1),g=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const y=this.byteStream.getUIBits(1),S=this.byteStream.getUIBits(4);let m="inner";return b||(m=y?"full":"outer"),t._$ns=["flash","filters"],t._$name="BevelFilter",t.params=[null,l,o,a,s,r,i,h,n,c,S,m,g],t}gradientGlowFilter(){const t={},e=0|this.byteStream.getUI8(),s=[],a=[];for(let t=0;t<e;++t){const t=this.rgba();a[a.length]=t.A,s[s.length]=t.R<<16|t.G<<8|t.B|0}const i=[];for(let t=0;t<e;++t)i[i.length]=+this.byteStream.getUI8()/255;const r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536,n=this.byteStream.getUI32()/65536*Util.$Rad2Deg,o=this.byteStream.getUI32()/65536,l=this.byteStream.getFloat16()/256,c=!!this.byteStream.getUIBits(1),b=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const g=this.byteStream.getUIBits(1),y=this.byteStream.getUIBits(4);let S="inner";return c||(S=g?"full":"outer"),t._$ns=["flash","filters"],t._$name="GradientGlowFilter",t.params=[null,o,n,s,a,i,r,h,l,y,S,b],t}convolutionFilter(){const t={},e=this.byteStream.getUI8(),s=this.byteStream.getUI8(),a=this.byteStream.getFloat32,i=this.byteStream.getFloat32,r=e*s,h=[];for(let t=0;t<r;++t)h[h.length]=this.byteStream.getFloat32();const n=this.rgba();this.byteStream.getUIBits(6);const o=!!this.byteStream.getUIBits(1),l=!!this.byteStream.getUIBits(1);return t._$ns=["flash","filters"],t._$name="ConvolutionFilter",t.params=[null,e,s,h,a,i,l,o,n],t}gradientBevelFilter(){const t={},e=0|this.byteStream.getUI8(),s=[],a=[];for(let t=0;t<e;++t){const t=this.rgba();a[a.length]=t.A,s[s.length]=t.R<<16|t.G<<8|t.B|0}const i=[];for(let t=0;t<e;++t)i[i.length]=+this.byteStream.getUI8()/255;const r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536,n=this.byteStream.getUI32()/65536*Util.$Rad2Deg,o=this.byteStream.getUI32()/65536,l=this.byteStream.getFloat16()/256,c=!!this.byteStream.getUIBits(1),b=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const g=this.byteStream.getUIBits(1),y=this.byteStream.getUIBits(4);let S="inner";return c||(S=g?"full":"outer"),t._$ns=["flash","filters"],t._$name="GradientBevelFilter",t.params=[null,o,n,s,a,i,r,h,l,y,S,b],t}colorMatrixFilter(){const t={},e=[];for(let t=0;t<20;t++)e[e.length]=this.byteStream.getFloat32();return t._$ns=["flash","filters"],t._$name="ColorMatrixFilter",t.params=[null,e],t}colorTransform(){this.byteStream.byteAlign();const t=[1,1,1,1,0,0,0,0],e=this.byteStream.getUIBits(6),s=e>>5,a=15&e;return e>>4&1&&(t[0]=this.byteStream.getSIBits(a)/256,t[1]=this.byteStream.getSIBits(a)/256,t[2]=this.byteStream.getSIBits(a)/256,t[3]=this.byteStream.getSIBits(a)/256),s&&(t[4]=this.byteStream.getSIBits(a),t[5]=this.byteStream.getSIBits(a),t[6]=this.byteStream.getSIBits(a),t[7]=this.byteStream.getSIBits(a)),t}parseSoundStreamHead(t){const e={};e.tagType=t,this.byteStream.getUIBits(4),e.PlaybackSoundRate=this.byteStream.getUIBits(2),e.PlaybackSoundSize=this.byteStream.getUIBits(1),e.PlaybackSoundType=this.byteStream.getUIBits(1),e.StreamSoundCompression=this.byteStream.getUIBits(4),e.StreamSoundRate=this.byteStream.getUIBits(2),e.StreamSoundSize=this.byteStream.getUIBits(1),e.StreamSoundType=this.byteStream.getUIBits(1),e.StreamSoundSampleCount=this.byteStream.getUI16(),2===e.StreamSoundCompression&&(e.LatencySeek=this.byteStream.getSIBits(2))}parseDefineSound(t){const e=this.byteStream.byte_offset,s=this.byteStream.getUI16();this.byteStream.getUIBits(4),this.byteStream.getUIBits(2),this.byteStream.getUIBit(),this.byteStream.getUIBit(),this.byteStream.getUI32();const a=t-(this.byteStream.byte_offset-e),i={_$characterId:s,_$data:null,_$buffer:null};i._$length=this.byteStream.byte_offset+a,i._$offset=this.byteStream.byte_offset,this.byteStream.byte_offset=e+t,this.setCharacter(s,i)}parseStartSound(t){const e={};return e.SoundId=this.byteStream.getUI16(),89===t&&(e.SoundClassName=this.byteStream.getDataUntil()),e.SoundInfo=this.parseSoundInfo(),e}parseDefineButtonSound(){const t=this.byteStream.getUI16(),e=this.getCharacter(t);for(let t=0;t<4;t++){const s=this.byteStream.getUI16();if(s){const a=this.parseSoundInfo();switch(t){case 0:e.ButtonStateUpSoundInfo=a,e.ButtonStateUpSoundId=s;break;case 1:e.ButtonStateOverSoundInfo=a,e.ButtonStateOverSoundId=s;break;case 2:e.ButtonStateDownSoundInfo=a,e.ButtonStateDownSoundId=s;break;case 3:e.ButtonStateHitTestSoundInfo=a,e.ButtonStateHitTestSoundId=s}}}this.setCharacter(t,e)}parseSoundInfo(){this.byteStream.getUIBits(2);const t={};if(t.SyncStop=this.byteStream.getUIBit(),t.SyncNoMultiple=this.byteStream.getUIBit(),t.HasEnvelope=this.byteStream.getUIBit(),t.HasLoops=this.byteStream.getUIBit(),t.HasOutPoint=this.byteStream.getUIBit(),t.HasInPoint=this.byteStream.getUIBit(),t.HasInPoint&&(t.InPoint=this.byteStream.getUI32()),t.HasOutPoint&&(t.OutPoint=this.byteStream.getUI32()),t.HasLoops&&(t.LoopCount=this.byteStream.getUI16()),t.HasEnvelope){const e=this.byteStream.getUI8(),s=[];for(let t=0;t<e;++t)s[t]={Pos44:this.byteStream.getUI32(),LeftLevel:this.byteStream.getUI16(),RightLevel:this.byteStream.getUI16()};t.EnvPoints=e,t.EnvelopeRecords=s}return t}parseDefineFontAlignZones(){const t=this.byteStream.getUI16(),e=this.getFont(t)||{};e._$CSMTableHint=this.byteStream.getUIBits(2),this.byteStream.getUIBits(6);const s=0|e._$numGlyphs,a=[];for(let t=0;t<s;++t){const e=this.byteStream.getUI8(),s=[];for(let t=0;t<e;++t)s.push(this.byteStream.getFloat16()),s.push(this.byteStream.getFloat16());this.byteStream.getUIBits(6),this.byteStream.getUIBits(1),this.byteStream.getUIBits(1),a[t]=s}this.byteStream.byteAlign(),e._$zoneTable=a,this.setFont(t,e)}parseCSMTextSettings(t){const e=this.byteStream.getUI16(),s={};s.tagType=t,s.UseFlashType=this.byteStream.getUIBits(2),s.GridFit=this.byteStream.getUIBits(3),this.byteStream.getUIBits(3),s.Thickness=this.byteStream.getUI32(),s.Sharpness=this.byteStream.getUI32(),this.byteStream.getUI8(),this.setTextSetting(e,s)}parseSoundStreamBlock(t,e){const s={};s.tagType=t,s.compressed=this.byteStream.getData(e)}parseDefineScalingGrid(){const t=this.byteStream.getUI16(),e=this.rect();this.setGrid(t,e)}postCharacter(t,e){globalThis.postMessage({infoKey:"_$characters",characters:t},e),t.length=0,e&&(e.length=0)}}Util.$swfParser=new SwfParser,this.addEventListener("message",(function(t){const e=Util.$swfParser;e.version=t.data.version,e.byteStream.setData(t.data.buffer),e.byteStream.byte_offset=t.data.offset;const s=Util.$createMovieClip();e.parseTags(t.data.buffer.length,s),e.postData(s),e.clear()}));'],{type:"text/javascript"})),d.$parserWorker=null,d.$parserQueues=[],d.$parserWorkerWait=!1,d.$unlzmaHandler=function(e){if(e.target.onmessage=null,d.$unlzmaQueues.length){const e=d.$unlzmaQueues.shift(),t=new Worker(d.$unlzmaWorkerURL);t.onmessage=d.$unlzmaHandler.bind(e);const a=e._$byteStream._$buffer;t.postMessage({fileSize:e.fileSize,mode:e.mode,buffer:a},[a.buffer])}else d.$unlzmaWorkerActive=!1;this._$byteStream._$buffer=e.data,this.parseAndBuild()},d.$getImageType=function(e){switch(!0){case 255===e[0]&&216===e[1]:return"jpeg";case 71===e[0]&&73===e[1]&&70===e[2]:return"gif";case 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]:return"png";case 66===e[0]&&77===e[1]:return"bmp";default:return null}},d.$jpegDecodeHandler=function(){const e=this.image,t=e.width,a=e.height,s=document.createElement("canvas");s.width=t,s.height=a;const r=s.getContext("2d");r.drawImage(e,0,0,t,a);const i=new Uint8Array(r.getImageData(0,0,t,a).data);this.jpegData=null,this.image=null;const n=d.$currentWorkSpace().getLibrary(this.libraryId);if(n.width=t,n.height=a,this.isAlpha){if(this.buffer=i,this.width=t,this.height=a,d.$unzipWorkerActive)return void d.$unzipQueues.push(this);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const e=d.$unzipWorker;e.onmessage=d.$unzipHandler.bind(this),e.postMessage(this,[this.buffer.buffer,this.alphaData.buffer])}else n._$buffer=i},d.$characters=new Map,d.$fonts=new Map,d.$texts=new Map,d.$parserHandler=function(e){const t=e.target;switch(e.data.infoKey){case"character":{const t=e.data.piece,a=d.$currentWorkSpace(),s=a.nextLibraryId;switch(t.libraryId=s,t._$name){case"Shape":{const e=d.$controller.createContainer("shape",`Shape_${s}`,s);e.recodes=d.$vtc.convert(t._$records),e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax},a.addLibrary(e),d.$characters.set(t._$characterId,s)}break;case"MovieClip":{for(let e=0;e<t._$dictionary.length;++e){const a=t._$dictionary[e];a.LibraryId=d.$characters.get(a.CharacterId)}const e=d.$controller.createContainer("container",`MovieClip_${s}`,s),r=a.addLibrary(e);let i=new Map,n=[];for(let e=0;e<t._$dictionary.length;++e){const a=t._$dictionary[e];-1===n.indexOf(a.Depth)&&(n.push(a.Depth),a.ClipDepth&&i.set(a.Depth,e))}if(n.sort((function(e,t){switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}})),i.size)for(const[e,a]of i){const s=[],r=t._$dictionary[a];for(let a=0;t._$dictionary.length>a;++a){const i=t._$dictionary[a];if(i.Depth>r.ClipDepth)break;i.Depth>e&&s.push(i)}for(let e=0;e<s.length;++e){const t=s[e],a=n.indexOf(t.Depth),i=n.splice(a,1)[0],o=n.indexOf(r.Depth);n.splice(o,0,i)}}let o=-1,l=-1;const c=n.length-1,h=new Map,m=[];for(let e=c;e>-1;--e){const t=new _;t.name="Layer_"+(c-e);const a=n[e];i.size&&(l>-1&&(a>l?(t.mode=d.LAYER_MODE_MASK_IN,t.maskId=o):(o=-1,l=-1)),i.has(a)&&(l=a,o=c-e,t.mode=d.LAYER_MODE_MASK)),m.push(t),h.set(a,t)}for(let e=0;e<n.length;++e)r.setLayer(e,m[e]);const u=[],f=t._$controller.length-1;for(let e=0;e<t._$dictionary.length;++e){const a=t._$dictionary[e],s=new $;s.libraryId=a.LibraryId,s.startFrame=a.StartFrame,s.endFrame=a.EndFrame||f+1,s.name=a.Name||"",u.push(s)}const g=new Map;for(let e=1;e<t._$controller.length;++e){const a=t._$controller[e];for(let s=0;s<a.length;++s){const r=a[s],i=t._$dictionary[r],n=h.get(i.Depth),o=u[r];g.has(r)||(g.set(r,-1),n.addCharacter(o));const l=t._$placeMap[e][i.Depth];if(g.get(r)!==l){const a=t._$placeObjects[l];o.setPlace(e,{frame:e,depth:0,matrix:a.matrix,colorTransform:a.colorTransform,blendMode:a.blendMode,filter:a.filters?a.filters:[]}),g.set(r,l)}}}for(let e=0;e<m.length;++e){const t=m[e];for(let e=1;e<=f;++e){const a=t.getActiveCharacter(e)[0];if(a)if(e-1){const s=t._$frame.getClasses(e-1);switch(!0){case-1!==s.indexOf("key-frame"):e===f?a.hasPlace(e)?t._$frame.setClasses(e,["key-frame"]):(s.push("key-frame-join"),t._$frame.setClasses(e-1,s),t._$frame.setClasses(e,["key-space-frame-end"])):a.hasPlace(e)?t._$frame.setClasses(e,["key-frame"]):(s.push("key-frame-join"),t._$frame.setClasses(e-1,s),t._$frame.setClasses(e,["key-space-frame"]));break;case-1!==s.indexOf("empty-space-frame"):t._$frame.setClasses(e-1,["empty-space-frame-end"]),t._$frame.setClasses(e,["key-frame"]);break;case-1!==s.indexOf("empty-key-frame"):t._$frame.setClasses(e,["key-frame"]);break;default:e===f?t._$frame.setClasses(e,["key-space-frame-end"]):a.hasPlace(e)?(t._$frame.setClasses(e-1,["key-space-frame-end"]),t._$frame.setClasses(e,["key-frame"])):t._$frame.setClasses(e,["key-space-frame"])}}else t._$frame.setClasses(e,["key-frame"]);else if(e-1){const a=t._$frame.getClasses(e-1);switch(!0){case-1!==a.indexOf("empty-key-frame"):a.push("empty-key-frame-join"),t._$frame.setClasses(e-1,a),e===f?t._$frame.setClasses(e,["empty-space-frame-end"]):t._$frame.setClasses(e,["empty-space-frame"]);break;case-1!==a.indexOf("key-space-frame"):t._$frame.setClasses(e-1,["key-space-frame-end"]),t._$frame.setClasses(e,["empty-key-frame"]);break;case-1!==a.indexOf("key-frame"):t._$frame.setClasses(e,["empty-key-frame"]);break;default:e===f?t._$frame.setClasses(e,["empty-space-frame-end"]):t._$frame.setClasses(e,["empty-space-frame"])}}else t._$frame.setClasses(e,["empty-key-frame"])}}d.$characters.set(t._$characterId,s)}break;case"lossless":{const e=d.$controller.createContainer("bitmap",`Bitmap_${s}`,s);if(t.mode="lossless",e.imageType="image/png",e.buffer=null,e.width=t.width,e.height=t.height,a.addLibrary(e),d.$characters.set(t._$characterId,s),d.$unzipWorkerActive)return void d.$unzipQueues.push(t);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const r=d.$unzipWorker;r.onmessage=d.$unzipHandler.bind(t),r.postMessage(t,[t.buffer.buffer])}break;case"imageData":{const e=d.$controller.createContainer("bitmap",`Bitmap_${s}`,s),r=`image/${d.$getImageType(t.jpegData)}`;t.mode="jpegAlpha",t.imageType=r,e.imageType=r,e.buffer=null,e.width=0,e.height=0,a.addLibrary(e),d.$characters.set(t._$characterId,s),t.image=new Image,t.image.decoding="async",t.image.src=URL.createObjectURL(new Blob([t.jpegData],{type:t.imageType})),t.image.decode().then(d.$jpegDecodeHandler.bind(t))}break;case"StaticText":{const e=d.$controller.createContainer("shape",`ShapeText_${s}`,s);e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax},a.addLibrary(e),d.$characters.set(t._$characterId,s),d.$texts.set(d.$texts.size,t)}break;case"SimpleButton":{console.log("TODO SimpleButton: ",t);const e=d.$controller.createContainer("button",`Button_${s}`,s);e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax},a.addLibrary(e),d.$characters.set(t._$characterId,s)}break;case"TextField":{const e=d.$controller.createContainer("text",`Text_${s}`,s);e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax},e.text=t._$text,e.inputType=t._$type,e.color=t._$textColor,e.font=t._$defaultTextFormat[1],e.size=t._$defaultTextFormat[2],e.align=t._$defaultTextFormat[7],e.leftMargin=t._$defaultTextFormat[8],e.rightMargin=t._$defaultTextFormat[9],e.leading=t._$defaultTextFormat[10],e.multiline=1===t._$multiline,e.wordWrap=1===t._$wordWrap,e.border=1===t._$border,t._$defaultTextFormat[4]&&t._$defaultTextFormat[5]?e.fontType=3:t._$defaultTextFormat[4]?e.fontType=2:t._$defaultTextFormat[5]&&(e.fontType=1),e.htmlText=t._$htmlText,a.addLibrary(e),d.$characters.set(t._$characterId,s)}break;default:console.log("TODO: ",t)}if(t._$characterId)return}break;case"font":return void d.$fonts.set(e.data.index,e.data.piece);case"font_shape":{const t=d.$fonts.get(e.data.index);t._$glyphShapeTable.push.apply(t._$glyphShapeTable,e.data.pieces),d.$fonts.set(e.data.index,t)}return;case"font_zone":{const t=d.$fonts.get(e.data.index);t._$zoneTable.push.apply(t._$zoneTable,e.data.pieces),d.$fonts.set(e.data.index,t)}return}if(d.$texts.size){const{Graphics:e}=window.next2d.display,t=d.$currentWorkSpace();for(const a of d.$texts.values()){const s=t.getLibrary(a.libraryId);let r=0,i=0,n=null,o=null,l=null,c=0,h=!1;const m=a._$baseMatrix,u=a._$textRecords;for(let t=0;t<u.length;++t){const a=u[t];if("FontId"in a){const e=d.$fonts.get(a.FontId);o=e._$codeTable,l=e._$glyphShapeTable,h=null!==e._$zoneTable}"XOffset"in a&&(r=a.XOffset),"YOffset"in a&&(i=a.YOffset),"TextColor"in a&&(n=a.TextColor),"TextHeight"in a&&(c=a.TextHeight,h&&(c/=20));const f=a.GlyphEntries,g=a.GlyphCount,y=c/1024;for(let t=0;t<g;++t){const a=f[t],o=0|a.GlyphIndex,c=d.$vtc.convert({ShapeData:l[o],lineStyles:[],fillStyles:[{Color:n,fillStyleType:0}]}),h=[y,m[1],m[2],y,m[4]+r,m[5]+i];for(let t=0;t<c.length;){const a=c[t++];switch(s._$recodes.push(a),a){case e.MOVE_TO:case e.LINE_TO:{const e=c[t++],a=c[t++],r=e*h[0]+a*h[2]+h[4],i=e*h[1]+a*h[3]+h[5];s._$recodes.push(r,i)}break;case e.CURVE_TO:{const e=c[t++],a=c[t++],r=e*h[0]+a*h[2]+h[4],i=e*h[1]+a*h[3]+h[5];s._$recodes.push(r,i);const n=c[t++],o=c[t++],l=n*h[0]+o*h[2]+h[4],d=n*h[1]+o*h[3]+h[5];s._$recodes.push(l,d)}break;case e.FILL_STYLE:s._$recodes.push(c[t++],c[t++],c[t++],c[t++]);case e.BEGIN_PATH:case e.END_FILL:}}r+=a.GlyphAdvance}}}}if(d.$characters.clear(),d.$fonts.clear(),d.$texts.clear(),t.onmessage=null,d.$parserQueues.length){const e=d.$parserQueues.shift();t.onmessage=d.$parserHandler.bind(e);const a=e._$byteStream._$buffer;t.postMessage({version:e._$swfVersion,offset:e._$offset,buffer:a},[a.buffer])}else d.$parserWorkerWait=!1},d.$boundsMatrix=function(e,t){const a=e.xMax*t[0]+e.yMax*t[2]+t[4],s=e.xMax*t[0]+e.yMin*t[2]+t[4],r=e.xMin*t[0]+e.yMax*t[2]+t[4],i=e.xMin*t[0]+e.yMin*t[2]+t[4],n=e.xMax*t[1]+e.yMax*t[3]+t[5],o=e.xMax*t[1]+e.yMin*t[3]+t[5],l=e.xMin*t[1]+e.yMax*t[3]+t[5],c=e.xMin*t[1]+e.yMin*t[3]+t[5];return{xMin:Math.min(Number.MAX_VALUE,a,s,r,i),xMax:Math.max(-Number.MAX_VALUE,a,s,r,i),yMin:Math.min(Number.MAX_VALUE,n,o,l,c),yMax:Math.max(-Number.MAX_VALUE,n,o,l,c)}},d.$intToRGB=function(e){return{R:(16711680&e)>>16,G:(65280&e)>>8,B:255&e}},d.$getCurvePoint=function(e,t,a,s,r,i){const n=[];for(let e=0;e<i.length;++e){const t=i[e];t.usePoint&&n.push(t)}if(!n.length)return null;const o=1-e,l=n.length+1;for(let i=0;i<l;++i)t*=o,a*=o,s*=e,r*=e;let c=t+s,d=a+r;for(let t=0;t<n.length;++t){const a=n[t],s=t+1;let r=a.x*l,i=a.y*l;for(let t=0;t<s;++t)r*=e,i*=e;for(let e=0;e<l-s;++e)r*=o,i*=o;c+=r,d+=i}return{x:c,y:d}},d.$copyContainer=function(e,t){const a=d.$currentWorkSpace(),s=d.$workSpaces[d.$copyWorkSpaceId];t.has(e.id)||t.set(e.id,a.nextLibraryId),e.id=t.get(e.id),a.addLibrary(e);for(let r=0;r<e.layers.length;++r){const i=e.layers[r];for(let e=0;e<i.characters.length;++e){const r=i.characters[e];if(!t.has(r.libraryId)){t.set(r.libraryId,a.nextLibraryId);const e=s.getLibrary(r.libraryId).toObject();"container"===e.type?d.$copyContainer(e,t):(e.id=t.get(r.libraryId),a.addLibrary(e))}r.libraryId=t.get(r.libraryId)}}a.addLibrary(e)},d.$clearShapePointer=function(){const e=document.getElementById("stage-area").children;for(let t=0;e.length>t;++t){const a=e[t];a.dataset.shapePointer&&(a.remove(),--t)}},d.$clearPenPointer=function(){const e=document.getElementById("stage-area").children;for(let t=0;e.length>t;++t){const a=e[t];a.dataset.penPointer&&(a.remove(),--t)}};class m{constructor(e,t=0,a=0,s=60,r=!0){this._$pngs=e,this._$width=t,this._$height=a,this._$fps=s,this._$loop=r?0:1,this._$crcTable=new Uint32Array(256);for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;this._$crcTable[e]=t}}_$crcUpdate(e,t,a,s){for(let r=0;r<s;r++)e=this._$crcTable[255&(e^t[a+r])]^e>>>8;return e}_$crc(e,t,a){return 4294967295^this._$crcUpdate(4294967295,e,t,a)}_$writeString(e,t,a){for(let s=0;s<a.length;s++)e[t+s]=a.charCodeAt(s)}encode(){return new Promise((e=>{let t=0,a=0;const s=[],r=new FileReader,i=new Uint8Array([137,80,78,71,13,10,26,10]);s.push(i.buffer);const n=new Uint8Array(25),o=new DataView(n.buffer);o.setUint32(0,13),this._$writeString(n,4,"IHDR"),o.setUint32(8,this._$width),o.setUint32(12,this._$height),o.setUint8(16,8),o.setUint8(17,6),o.setUint8(18,0),o.setUint8(19,0),o.setUint8(20,0),o.setUint32(21,this._$crc(n,4,17)),s.push(n.buffer);const l=new Uint8Array(20),c=new DataView(l.buffer);c.setUint32(0,8),this._$writeString(l,4,"acTL"),c.setUint32(8,this._$pngs.length),c.setUint32(12,this._$loop),c.setUint32(16,this._$crc(l,4,12)),s.push(l.buffer),r.onload=()=>{const i=new DataView(r.result);let n=8;const o=new Uint8Array(38),l=new DataView(o.buffer);l.setUint32(0,26),this._$writeString(o,4,"fcTL"),l.setUint32(8,t++),l.setUint32(12,this._$width),l.setUint32(16,this._$height),l.setUint32(20,0),l.setUint32(24,0),l.setUint16(28,1e3/this._$fps),l.setUint16(30,1e3),l.setUint8(32,0),l.setUint8(33,0),l.setUint32(34,this._$crc(o,4,30)),s.push(o.buffer);const c=r.result.byteLength;for(;;){const e=i.getUint32(n);if(1229209940===i.getUint32(n+4))if(a){let a=new Uint8Array(4),i=new DataView(a.buffer);i.setUint32(0,e+4),s.push(a.buffer),a=new Uint8Array(r.result.slice(n,n+e+8+4)),i=new DataView(a.buffer),this._$writeString(a,0,"fdAT"),i.setUint32(4,t++),i.setUint32(e+8,this._$crc(a,0,e+8)),s.push(a.buffer)}else s.push(r.result.slice(n,n+e+8+4));if(n+=e+12,n>=c)break}a++,this._$pngs.length>a?r.readAsArrayBuffer(this._$pngs[a]):(s.push(new Uint8Array([0,0,0,0,73,69,78,68,174,66,96,130]).buffer),e(new Blob(s,{type:"image/apng"})))},r.readAsArrayBuffer(this._$pngs[0])}))}}d.$controller=new class{constructor(){this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler),this._$active=null,this._$stageLock=!1,this._$sizeLock=!1,this._$scaleLock=!1,this._$focus=!1,this._$menuMode=!1,this._$target=null,this._$libraryTarget=null,this._$sourceTarget=null,this._$libraryHit=!1,this._$inputMode=!1,this._$resizeMode=!1,this._$currentValue=null,this._$lockTarget=null,this._$gradientTarget=null,this._$gradientPointer=null,this._$filterGradientTarget=null,this._$filterGradientPointer=null,this._$filters=new Map,this._$filterId=0,this._$pointX=0,this._$scriptId=0,this._$saved=!0,this._$blurDownEvent=null,this._$blurFocusInEvent=null,this._$gradientContext=null}initialize(){window.removeEventListener("DOMContentLoaded",this._$handler);document.getElementById("controller-adjustment").addEventListener("mousedown",function(e){this._$resizeMode=!0,this._$pointX=e.screenX,d.$setCursor("row-resize")}.bind(this)),window.addEventListener("mouseup",function(){if(this._$resizeMode&&(this._$resizeMode=!1,this._$pointX=0,d.$setCursor("auto")),this._$filterGradientPointer){const e=0|this._$filterGradientPointer.dataset.index;if(e){const t=0|this._$filterGradientPointer.dataset.filterId,a=this._$filters.get(t).filter;a.ratios[e]=parseFloat(this._$filterGradientPointer.style.left)+4,this.disposeCharacterImage(),this.updateFilterGradientCanvas(t,a)}this._$filterGradientPointer=null}this._$gradientPointer&&(this._$gradientPointer=null)}.bind(this)),window.addEventListener("mousemove",function(e){if(this._$resizeMode){const t=this._$pointX-e.screenX,a=0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0];document.documentElement.style.setProperty("--controller-width",`${Math.max(d.CONTROLLER_DEFAULT_SIZE,a+t)}px`),this._$pointX=e.screenX}if(this._$filterGradientPointer){0|this._$filterGradientPointer.dataset.index&&window.requestAnimationFrame(function(e,t,a){const s=parseFloat(t.style.left),r=d.$clamp(s+(e.screenX-a)+4,d.MIN_COLOR,d.MAX_COLOR);t.style.left=r-4+"px";const i=0|t.dataset.filterId,n=this._$filters.get(i).filter,o=0|t.dataset.index;n._$ratios[o]=r,this._$pointX&&(this._$pointX=e.screenX),this.disposeCharacterImage(),this.updateFilterGradientCanvas(i,n)}.bind(this,e,this._$filterGradientPointer,this._$pointX))}this._$gradientPointer&&d.$hitColor&&window.requestAnimationFrame(function(e,t,a){if(!d.$hitColor)return;const s=parseFloat(t.style.left),r=d.$clamp(s+(e.screenX-a)+4,d.MIN_COLOR,d.MAX_COLOR);t.style.left=r-4+"px",d.$hitColor.ratios[t.dataset.index].ratio=r/255,this._$pointX&&(this._$pointX=e.screenX),d.$hitColor.shape.cacheClear();const i=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(i),this.updateGradientCanvas()}.bind(this,e,this._$gradientPointer,this._$pointX))}.bind(this)),document.documentElement.style.setProperty("--controller-width",`${d.CONTROLLER_DEFAULT_SIZE}px`),this.initializeTab(),this.initializeArea(),this.initializeLibrary(),d.$initializeEnd(),this._$handler=null}initializeTab(){const e=document.getElementById("controller-tab-area").children,t=function(e){d.$endMenu(),this._$active.classList.remove("active"),this._$active.classList.add("disable"),e.target.classList.remove("disable"),e.target.classList.add("active"),this._$active=e.target;const t=document.getElementById("controller-area").children;for(let a=0;a<t.length;++a){const s=t[a];s.id===e.target.dataset.tabType?s.style.display="":s.style.display="none"}const a=document.getElementById("library-preview-area");for(;a.children.length;)a.children[0].remove()}.bind(this);for(let a=0;a<e.length;++a){const s=e[a];this._$active||(s.classList.add("active"),this._$active=s),s.addEventListener("mousedown",t)}const a=document.getElementById("controller-area").children;for(let e=0;e<a.length;++e){const t=a[e];e&&(t.style.display="none")}}initializeArea(){this.initializeStageSetting(),this.initializeObjectSetting(),this.initializeSoundSetting(),this.initializeTransformSetting(),this.initializeColorSetting(),this.initializeBlendSetting(),this.initializeFilterSetting(),this.initializeTextSetting(),this.initializeVideoSetting(),this.initializeEaseSetting(),window.addEventListener("mouseup",this.mouseUp.bind(this)),window.addEventListener("mousemove",this.mouseMove.bind(this))}mouseOver(e){this._$focus||this._$target||null!==this._$currentValue||(d.$setCursor("ew-resize"),e.target.style.cursor="ew-resize")}mouseOut(e){!this._$focus&&this._$target||(d.$setCursor("auto"),e.target.style.cursor="")}mouseDown(e){this._$focus||(e.preventDefault(),this._$saved=!1,this._$pointX=e.screenX,this._$target=e.target,this._$currentValue=+e.target.value,d.$setCursor("ew-resize"))}mouseUp(e){this._$pointX=0,d.$setCursor("auto"),this._$target&&(d.$setCursor("auto"),e.target.style.cursor="",this._$focus||this._$target.dispatchEvent(new FocusEvent("focusout")),e.target===this._$target&&this._$target.focus(),this._$target=null)}mouseMove(e){this._$target&&!this._$focus&&window.requestAnimationFrame(function(e){if(!this._$target||this._$focus)return;e.preventDefault(),d.$setCursor("ew-resize");const t=e.screenX-this._$pointX,a=+this._$target.value;if(this._$target.value=a+t,this.updateProperty(this._$target,t),this._$currentValue=+this._$target.value,this._$lockTarget){const e=+this._$lockTarget.value;this._$lockTarget.value=e+t,this.updateProperty(this._$lockTarget,t)}this._$pointX=e.screenX;const s=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(s)}.bind(this,e))}showStageSetting(){document.getElementById("instance-setting").style.display="none",document.getElementById("stage-setting").style.display=""}hideStageSetting(){document.getElementById("stage-setting").style.display="none"}showObjectSetting(e){for(let t=0;t<e.length;++t)document.getElementById(e[t]).style.display=""}hideObjectSetting(e){for(let t=0;t<e.length;++t)document.getElementById(e[t]).style.display="none"}showObjectArea(){document.getElementById("object-area").style.display=""}hideObjectArea(){document.getElementById("object-area").style.display="none"}setDefaultController(){const e=d.$currentWorkSpace().scene;this.hideObjectSetting(["object-area","instance-setting"]),this.showObjectSetting(["stage-setting","object-setting"]),document.getElementById("object-name").value=e.name,document.getElementById("object-symbol").value=e.symbol}updateProperty(e,t=0){switch(this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved()),e.id){case"object-width":d.$screen.updateWidth(Math.max(1,+e.value));break;case"object-height":d.$screen.updateHeight(Math.max(1,+e.value));break;case"object-x":t&&(d.$screen.updateX(t),d.$screen.placeTransformTarget());break;case"object-y":t&&(d.$screen.updateY(t),d.$screen.placeTransformTarget());break;case"transform-scale-x":d.$screen.updateScaleX(+e.value/100);break;case"transform-scale-y":d.$screen.updateScaleY(+e.value/100);break;case"transform-rotate":d.$screen.updateRotate(+e.value%360);break;case"color-red-multiplier":d.$screen.updateColorMultiplier(+e.value,0);break;case"color-green-multiplier":d.$screen.updateColorMultiplier(+e.value,1);break;case"color-blue-multiplier":d.$screen.updateColorMultiplier(+e.value,2);break;case"color-alpha-multiplier":d.$screen.updateColorMultiplier(+e.value,3);break;case"fill-stroke-width-value":case"fill-alpha-value":d.$hitColor&&(d.$hitColor.shape.changeColor(0|d.$hitColor.width),this._$gradientTarget&&(this._$gradientTarget.dataset.alpha=e.value,this.updateGradientCanvas()));break;case"color-red-offset":d.$screen.updateColorOffset(0|e.value,4);break;case"color-green-offset":d.$screen.updateColorOffset(0|e.value,5);break;case"color-blue-offset":d.$screen.updateColorOffset(0|e.value,6);break;case"color-alpha-offset":d.$screen.updateColorOffset(0|e.value,7);break;case"font-size":d.$screen.updateText({name:"size",value:d.$clamp(0|e.value,d.FONT_MIN_SIZE,d.FONT_MAX_SIZE)});break;case"font-color":d.$screen.updateText({name:"color",value:0|`0x${e.value.substr(1)}`});break;case"font-stroke-size":d.$screen.updateText({name:"thickness",value:d.$clamp(0|e.value,d.STROKE_MIN_SIZE,d.STROKE_MAX_SIZE)});break;case"font-stroke-color":d.$screen.updateText({name:"thicknessColor",value:0|`0x${e.value.substr(1)}`});break;case"font-letterSpacing":d.$screen.updateText({name:e.id.split("-")[1],value:d.$clamp(0|e.value,-d.FONT_PARAM_MAX_SIZE,d.FONT_PARAM_MAX_SIZE)});break;case"font-leading":case"font-leftMargin":case"font-rightMargin":d.$screen.updateText({name:e.id.split("-")[1],value:d.$clamp(0|e.value,d.FONT_PARAM_MIN_SIZE,d.FONT_PARAM_MAX_SIZE)});break;case"video-volume":d.$screen.updateVideoVolume(e);break;case"nine-slice-setting-x":case"nine-slice-setting-y":case"nine-slice-setting-w":case"nine-slice-setting-h":t&&d.$screen.updateShapeGrid();break;default:switch(e.dataset.name){case"volume":this.updateSoundVolume(e);break;case"blurX":case"blurY":this.updateFilterBlur(e);break;case"gradientAlpha":this.updateFilterGradientAlpha(e);break;case"alpha":case"highlightAlpha":case"shadowAlpha":this.updateFilterAlpha(e);break;case"strength":this.updateFilterStrength(e);break;case"angle":this.updateFilterAngle(e);break;case"distance":this.updateFilterDistance(e)}}}stageWidthOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=d.$clamp(0|e.target.value,d.STAGE_MIN_SIZE,d.STAGE_MAX_SIZE),a=document.getElementById("stage-area"),s=document.getElementById("stage");a.style.width=`${t+window.screen.width}px`,s.style.width=`${t}px`;const r=d.$currentWorkSpace();if(r.stage.width=t,e.target.value=t,this._$stageLock&&this._$lockTarget&&null!==this._$currentValue){const e=t-this._$currentValue,i=d.$clamp((0|this._$lockTarget.value)+e,d.STAGE_MIN_SIZE,d.STAGE_MAX_SIZE);this._$lockTarget.value=i,a.style.height=`${i+window.screen.height}px`,s.style.height=`${i}px`,r.stage.height=i}this._$focus=!1,this._$lockTarget=null,this._$currentValue=null,d.$keyLock=!1,d.$offsetLeft=s.offsetLeft,d.$offsetTop=s.offsetTop}}else e.target.blur()}stageHeightOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=d.$clamp(0|e.target.value,d.STAGE_MIN_SIZE,d.STAGE_MAX_SIZE),a=document.getElementById("stage-area"),s=document.getElementById("stage");a.style.height=`${t+window.screen.height}px`,s.style.height=`${t}px`;const r=d.$currentWorkSpace();if(r.stage.height=t,e.target.value=t,this._$stageLock&&this._$lockTarget&&null!==this._$currentValue){const e=t-this._$currentValue,i=d.$clamp((0|this._$lockTarget.value)+e,d.STAGE_MIN_SIZE,d.STAGE_MAX_SIZE);this._$lockTarget.value=i,a.style.width=`${i+window.screen.width}px`,s.style.width=`${i}px`,r.stage.width=i}this._$focus=!1,this._$lockTarget=null,this._$currentValue=null,d.$keyLock=!1,d.$offsetLeft=s.offsetLeft,d.$offsetTop=s.offsetTop}}else e.currentTarget.blur()}stageFpsOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=d.$clamp(e.target.value,d.STAGE_MIN_FPS,d.STAGE_MAX_FPS);d.$timeline.buildTimeline();d.$currentWorkSpace().stage.fps=t,e.target.value=t,this._$focus=!1,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!1}}else e.currentTarget.blur()}strokeSizeOut(e){"Enter"!==e.code?"focusout"===e.type&&(e.target.value=d.$clamp(e.target.value,d.STROKE_MIN_SIZE,d.STROKE_MAX_SIZE),this._$focus=!1,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!1):e.currentTarget.blur()}initializeStageSetting(){document.getElementById("stage-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("stage-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))})),document.getElementById("stage-lock").addEventListener("mousedown",function(){this._$stageLock=!this._$stageLock,this._$currentValue=null;document.getElementById("stage-lock").childNodes[1].setAttribute("class",this._$stageLock?"active":"disable");d.$currentWorkSpace().stage.lock=this._$stageLock}.bind(this));const e=document.getElementById("stroke-size");e.value=1,e.addEventListener("mouseover",this.mouseOver.bind(this)),e.addEventListener("mouseout",this.mouseOut.bind(this)),e.addEventListener("mousedown",this.mouseDown.bind(this)),e.addEventListener("focusin",function(){this._$focus=!0,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!0}.bind(this)),e.addEventListener("focusout",this.strokeSizeOut.bind(this)),e.addEventListener("keypress",this.strokeSizeOut.bind(this));const t=document.getElementById("stage-width");t.value=d.STAGE_DEFAULT_WIDTH,t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("mousedown",function(){!this._$focus&&this._$stageLock&&(this._$lockTarget=document.getElementById("stage-height"))}.bind(this)),t.addEventListener("focusin",function(){this._$focus=!0,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!0,this._$stageLock&&(this._$lockTarget=document.getElementById("stage-height"))}.bind(this)),t.addEventListener("focusout",this.stageWidthOut.bind(this)),t.addEventListener("keypress",this.stageWidthOut.bind(this));const a=document.getElementById("stage-height");a.value=d.STAGE_DEFAULT_HEIGHT,a.addEventListener("mouseover",this.mouseOver.bind(this)),a.addEventListener("mouseout",this.mouseOut.bind(this)),a.addEventListener("mousedown",this.mouseDown.bind(this)),a.addEventListener("mousedown",function(){!this._$focus&&this._$stageLock&&(this._$lockTarget=document.getElementById("stage-width"))}.bind(this)),a.addEventListener("focusin",function(){this._$focus=!0,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!0,this._$stageLock&&(this._$lockTarget=document.getElementById("stage-width"))}.bind(this)),a.addEventListener("focusout",this.stageHeightOut.bind(this)),a.addEventListener("keypress",this.stageHeightOut.bind(this)),document.getElementById("stage-bgColor").addEventListener("change",(function(e){const t=e.target.value;document.getElementById("stage").style.backgroundColor=t,document.getElementById("library-preview-area").style.backgroundColor=t;d.$currentWorkSpace().stage.bgColor=t}));const s=document.getElementById("stage-fps");s.value=d.STAGE_DEFAULT_FPS,s.addEventListener("mouseover",this.mouseOver.bind(this)),s.addEventListener("mouseout",this.mouseOut.bind(this)),s.addEventListener("mousedown",this.mouseDown.bind(this)),s.addEventListener("focusin",function(){this._$focus=!0,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!0}.bind(this)),s.addEventListener("focusout",this.stageFpsOut.bind(this)),s.addEventListener("keypress",this.stageFpsOut.bind(this))}objectVolumeSizeOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=d.$clamp(0|e.target.value,d.MIN_VOLUME,d.MAX_VOLUME);e.target.value=t,this._$currentValue!==t&&this.updateProperty(e.target),this._$focus=!1,this._$currentValue=null,d.$keyLock=!1}}else e.currentTarget.blur()}objectFontSizeOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=d.$clamp(0|e.target.value,d.FONT_MIN_SIZE,d.FONT_MAX_SIZE);e.target.value=t,this._$currentValue!==t&&this.updateProperty(e.target),this._$focus=!1,this._$currentValue=null,d.$keyLock=!1}}else e.currentTarget.blur()}objectFontStrokeSizeOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=d.$clamp(0|e.target.value,d.STROKE_MIN_SIZE,d.STROKE_MAX_SIZE);e.target.value=t,this._$currentValue!==t&&this.updateProperty(e.target),this._$focus=!1,this._$currentValue=null,d.$keyLock=!1}}else e.currentTarget.blur()}objectFontParamOut(e){if("Enter"!==e.code){if("focusout"===e.type){let t=0|e.target.value;t="font-letterSpacing"===e.target.id?d.$clamp(t,-d.FONT_PARAM_MAX_SIZE,d.FONT_PARAM_MAX_SIZE):d.$clamp(t,d.FONT_PARAM_MIN_SIZE,d.FONT_PARAM_MAX_SIZE),e.target.value=t,this._$currentValue!==t&&this.updateProperty(e.target),this._$focus=!1,this._$currentValue=null,d.$keyLock=!1}}else e.currentTarget.blur()}objectSizeOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=d.$clamp(+e.target.value,d.STAGE_MIN_SIZE,d.STAGE_MAX_SIZE);if(e.target.value=t,this._$currentValue!==t){this.updateProperty(e.target),this._$sizeLock&&this._$lockTarget&&null!==this._$currentValue&&(this._$lockTarget.value=d.$clamp(+this._$lockTarget.value+t-this._$currentValue,d.STAGE_MIN_SIZE,d.STAGE_MAX_SIZE),this.updateProperty(this._$lockTarget));const a=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(a)}this._$focus=!1,this._$lockTarget=null,this._$currentValue=null,d.$keyLock=!1}}else e.currentTarget.blur()}objectPointOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=+e.target.value;e.target.value=d.$clamp(t,d.MIN_INT,d.MAX_INT),this.updateProperty(e.target,t-this._$currentValue),this._$focus=!1,this._$lockTarget=null,this._$currentValue=null,d.$keyLock=!1}}else e.currentTarget.blur()}objectNameOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=d.$currentWorkSpace().scene,a=d.$screen._$moveTargets;if(1===a.length){const s=a[0].target,r=0|s.dataset.layerId,i=t.getLayer(r),n=0|s.dataset.characterId;i.getCharacter(n).name=e.currentTarget.value}else t.name=e.currentTarget.value;d.$keyLock=!1}}else e.currentTarget.blur()}objectSymbolOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=d.$currentWorkSpace();if(d.$screen._$moveTargets.length){const a=d.$screen._$moveTargets[0].target;t.getLibrary(0|a.dataset.libraryId).symbol=e.currentTarget.value}else t.scene.symbol=e.currentTarget.value;d.$keyLock=!1}}else e.currentTarget.blur()}initializeObjectSetting(){document.getElementById("instance-setting").style.display="none",document.getElementById("object-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("object-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))}));const e=document.getElementById("object-name");e.addEventListener("focusout",this.objectNameOut.bind(this)),e.addEventListener("keypress",this.objectNameOut.bind(this)),e.addEventListener("focusin",(function(){d.$keyLock=!0}));const t=document.getElementById("object-symbol");t.addEventListener("focusout",this.objectSymbolOut.bind(this)),t.addEventListener("keypress",this.objectSymbolOut.bind(this)),t.addEventListener("focusin",(function(){d.$keyLock=!0})),document.getElementById("transform-size-lock").addEventListener("mousedown",function(){this._$sizeLock=!this._$sizeLock,this._$currentValue=null;document.getElementById("transform-size-lock").childNodes[1].setAttribute("class",this._$sizeLock?"active":"disable")}.bind(this));const a=["object-width","object-height"],s=function(){!this._$focus&&this._$sizeLock&&(this._$lockTarget=document.getElementById("object-height"))}.bind(this),r=function(){!this._$focus&&this._$sizeLock&&(this._$lockTarget=document.getElementById("object-width"))}.bind(this),i=function(e){this._$focus=!0,this._$currentValue=+e.target.value,this._$lockTarget=null,d.$keyLock=!0,this._$sizeLock&&(this._$lockTarget=document.getElementById(name))}.bind(this);for(let e=0;e<a.length;++e){const t=document.getElementById(a[e]);t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("mousedown",e?r:s),t.addEventListener("focusin",i),t.addEventListener("focusout",this.objectSizeOut.bind(this)),t.addEventListener("keypress",this.objectSizeOut.bind(this))}const n=["object-x","object-y"],o=function(e){this._$focus=!0,this._$currentValue=+e.target.value,this._$lockTarget=null,d.$keyLock=!0}.bind(this);for(let e=0;e<n.length;++e){const t=document.getElementById(n[e]);t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("focusin",o),t.addEventListener("focusout",this.objectPointOut.bind(this)),t.addEventListener("keypress",this.objectPointOut.bind(this))}}transformScaleOut(e){if("Enter"!==e.code){if("focusout"===e.type){const t=d.$clamp(+e.target.value,d.MIN_INT,d.MAX_INT);if(e.target.value=t,this._$currentValue!==t){if(this.updateProperty(e.target),this._$scaleLock&&this._$lockTarget&&null!==this._$currentValue){const e=t-this._$currentValue;this._$lockTarget.value=d.$clamp(+this._$lockTarget.value+e,d.MIN_INT,d.MAX_INT),this.updateProperty(this._$lockTarget)}const a=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(a)}this._$focus=!1,this._$lockTarget=null,this._$currentValue=null,d.$keyLock=!1}}else e.currentTarget.blur()}transformRotateOut(e){if("Enter"!==e.code){if("focusout"===e.type){let t=d.$clamp((0|e.target.value)%360,d.MIN_ROTATE,d.MAX_ROTATE);0>t&&(t+=360),e.target.value=t,this.updateProperty(e.target),this._$focus=!1,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!1;const a=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(a)}}else e.currentTarget.blur()}initializeTransformSetting(){document.getElementById("transform-setting-title").addEventListener("mousedown",function(e){const t=document.getElementById("transform-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))}.bind(this)),document.getElementById("transform-scale-lock").addEventListener("mousedown",function(){this._$scaleLock=!this._$scaleLock,this._$currentValue=null;document.getElementById("transform-scale-lock").childNodes[1].setAttribute("class",this._$scaleLock?"active":"disable")}.bind(this));const e=["transform-scale-x","transform-scale-y"],t=function(){!this._$focus&&this._$scaleLock&&(this._$lockTarget=document.getElementById("transform-scale-y"))}.bind(this),a=function(){!this._$focus&&this._$scaleLock&&(this._$lockTarget=document.getElementById("transform-scale-x"))}.bind(this),s=function(e){this._$focus=!0,this._$currentValue=+e.target.value,this._$lockTarget=null,d.$keyLock=!0,this._$scaleLock&&(this._$lockTarget=document.getElementById("transform-scale-y"))}.bind(this),r=function(e){this._$focus=!0,this._$currentValue=+e.target.value,this._$lockTarget=null,d.$keyLock=!0,this._$scaleLock&&(this._$lockTarget=document.getElementById("transform-scale-x"))}.bind(this);for(let i=0;i<e.length;++i){const n=document.getElementById(e[i]);n.addEventListener("mouseover",this.mouseOver.bind(this)),n.addEventListener("mouseout",this.mouseOut.bind(this)),n.addEventListener("mousedown",this.mouseDown.bind(this)),n.addEventListener("mousedown",i?a:t),n.addEventListener("focusin",i?r:s),n.addEventListener("focusout",this.transformScaleOut.bind(this)),n.addEventListener("keypress",this.transformScaleOut.bind(this))}const i=document.getElementById("transform-rotate");i.addEventListener("mouseover",this.mouseOver.bind(this)),i.addEventListener("mouseout",this.mouseOut.bind(this)),i.addEventListener("mousedown",this.mouseDown.bind(this)),i.addEventListener("focusin",function(e){this._$focus=!0,this._$currentValue=+e.target.value,this._$lockTarget=null,d.$keyLock=!0}.bind(this)),i.addEventListener("focusout",this.transformRotateOut.bind(this)),i.addEventListener("keypress",this.transformRotateOut.bind(this))}colorMultiplierOut(e){if("Enter"!==e.code){if("focusout"===e.type){e.target.value=d.$clamp(0|e.target.value,d.COLOR_MIN_MULTIPLIER,d.COLOR_MAX_MULTIPLIER);const t=+e.target.value;if(this._$currentValue!==t){let a=0;switch(e.target.id){case"color-red-multiplier":a=0;break;case"color-green-multiplier":a=1;break;case"color-blue-multiplier":a=2;break;case"color-alpha-multiplier":a=3;break;case"fill-alpha-value":a=4}4===a?d.$hitColor&&d.$hitColor.shape.changeColor():d.$screen.updateColorMultiplier(t,a);const s=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(s)}this._$focus=!1,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!1}}else e.currentTarget.blur()}colorOffsetOut(e){if("Enter"!==e.code){if("focusout"===e.type){e.target.value=d.$clamp(0|e.target.value,d.COLOR_MIN_OFFSET,d.COLOR_MAX_OFFSET);const t=+e.target.value;if(this._$currentValue!==t){let a=4;switch(e.target.id){case"color-red-offset":a=4;break;case"color-green-offset":a=5;break;case"color-blue-offset":a=6;break;case"color-alpha-offset":a=7}d.$screen.updateColorOffset(t,a);const s=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(s)}this._$focus=!1,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!1}}else e.currentTarget.blur()}colorShapeOut(e){if("Enter"!==e.code){if("focusout"===e.type){e.target.value=d.$clamp(0|e.target.value,d.COLOR_MIN_MULTIPLIER,d.COLOR_MAX_MULTIPLIER);const t=+e.target.value;if(this._$currentValue!==t&&d.$hitColor){d.$hitColor.shape.changeColor();const e=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(e);const{GradientType:t}=window.next2d.display;switch(d.$hitColor.type){case t.LINEAR:case t.RADIAL:this.updateGradientCanvas()}}this._$focus=!1,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!1}}else e.currentTarget.blur()}initializeColorSetting(){document.getElementById("color-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("color-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))}));const e=["color-alpha-multiplier","color-red-multiplier","color-green-multiplier","color-blue-multiplier"],t=function(e){this._$focus=!0,this._$currentValue=+e.target.value,this._$lockTarget=null,d.$keyLock=!0}.bind(this);for(let a=0;a<e.length;++a){const s=document.getElementById(e[a]);s.addEventListener("mouseover",this.mouseOver.bind(this)),s.addEventListener("mouseout",this.mouseOut.bind(this)),s.addEventListener("mousedown",this.mouseDown.bind(this)),s.addEventListener("focusin",t),s.addEventListener("focusout",this.colorMultiplierOut.bind(this)),s.addEventListener("keypress",this.colorMultiplierOut.bind(this))}const a=["color-alpha-offset","color-red-offset","color-green-offset","color-blue-offset"],s=function(e){this._$focus=!0,this._$currentValue=+e.target.value,this._$lockTarget=null,d.$keyLock=!0}.bind(this);for(let e=0;e<a.length;++e){const t=document.getElementById(a[e]);t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("focusin",s),t.addEventListener("focusout",this.colorOffsetOut.bind(this)),t.addEventListener("keypress",this.colorOffsetOut.bind(this))}document.getElementById("fill-color-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("fill-color-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))})),document.getElementById("nine-slice-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("nine-slice-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))}));const r=["nine-slice-setting-x","nine-slice-setting-y","nine-slice-setting-w","nine-slice-setting-h"];for(let e=0;e<r.length;++e){const t=document.getElementById(r[e]);t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("focusin",function(e){this._$focus=!0,this._$currentValue=+e.target.value,this._$lockTarget=null,d.$keyLock=!0}.bind(this)),t.addEventListener("focusout",this.objectPointOut.bind(this)),t.addEventListener("keypress",this.objectPointOut.bind(this))}document.getElementById("fill-color-type-select").addEventListener("change",this.changeShapeColor.bind(this)),document.getElementById("fill-color-value").addEventListener("change",function(e){if(d.$hitColor){if(this._$gradientTarget){const t=this._$gradientTarget.getElementsByTagName("i")[0];this._$gradientTarget.dataset.color=e.target.value,t.style.backgroundColor=e.target.value,d.$hitColor.shape.changeColor(),this.updateGradientCanvas()}else d.$hitColor.shape.changeColor();const t=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(t)}}.bind(this));const i=document.getElementById("fill-alpha-value");i.addEventListener("mouseover",this.mouseOver.bind(this)),i.addEventListener("mouseout",this.mouseOut.bind(this)),i.addEventListener("mousedown",this.mouseDown.bind(this)),i.addEventListener("focusin",function(e){this._$focus=!0,this._$currentValue=+e.target.value,this._$lockTarget=null,d.$keyLock=!0}.bind(this)),i.addEventListener("focusout",this.colorShapeOut.bind(this)),i.addEventListener("keypress",this.colorShapeOut.bind(this));const n=document.getElementById("fill-stroke-width-value");n.addEventListener("mouseover",this.mouseOver.bind(this)),n.addEventListener("mouseout",this.mouseOut.bind(this)),n.addEventListener("mousedown",this.mouseDown.bind(this)),n.addEventListener("focusin",function(e){this._$focus=!0,this._$currentValue=+e.target.value,this._$lockTarget=null,d.$keyLock=!0}.bind(this)),n.addEventListener("focusout",this.colorShapeOut.bind(this)),n.addEventListener("keypress",this.colorShapeOut.bind(this)),document.getElementById("color-pointer-list").addEventListener("mousedown",function(e){if(this._$gradientPointer||!d.$hitColor)return;const t=document.getElementById("fill-color-value").value,a=0|document.getElementById("fill-alpha-value").value,s=d.$intToRGB(0|`0x${t.substr(1)}`),r={R:s.R,G:s.G,B:s.B,A:a/100*255,ratio:e.offsetX/255};d.$hitColor.ratios.push(r),d.$hitColor.ratios.sort((function(e,t){switch(!0){case e.ratio>t.ratio:return 1;case e.ratio<t.ratio:return-1;default:return 0}})),d.$hitColor.shape.cacheClear();const i=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(i),this.initializeGradient(),this._$gradientTarget=document.getElementById("color-pointer-list").children[d.$hitColor.ratios.indexOf(r)]}.bind(this));const o=document.getElementById("gradient-canvas");o.width=d.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,o.height=d.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,o.style.transform=`scale(${1/window.devicePixelRatio}, ${1/window.devicePixelRatio})`,o.style.backfaceVisibility="hidden",o.style.transformOrigin="0 0",this._$gradientContext=o.getContext("2d"),document.getElementById("fill-bitmap-select").addEventListener("change",(function(e){if(!d.$hitColor)return;const t=d.$currentWorkSpace().getLibrary(0|e.target.value);d.$hitColor.shape.bitmapId=t.id,d.$hitColor.shape.cacheClear();const a=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(a)}))}changeShapeColor(e=null){this._$gradientPointer=null,this._$gradientTarget=null;const t=document.getElementById("fill-color-type-select").value,a=document.getElementById("fill-color-gradient-container"),s=document.getElementById("fill-color-bitmap-container"),r=document.getElementById("fill-color-rgba-container"),i=document.getElementById("fill-stroke-color-rgba-container");switch(e&&(d.$hitColor.shape.bitmapId=0),t){case"rgba":a.style.display="none",s.style.display="none",r.style.display="",i.style.display=d.$hitColor.width?"":"none";break;case"bitmap":a.style.display="none",s.style.display="",r.style.display="none",i.style.display=d.$hitColor.width?"":"none",this.createBitmapList();break;default:a.style.display="",s.style.display="none",r.style.display="",i.style.display=d.$hitColor.width?"":"none",e||this.initializeGradient()}e&&d.$hitColor.shape.changeStyle(t)}createBitmapList(){const e=document.getElementById("fill-bitmap-select"),t=e.children;for(;t.length;)t[0].remove();const a=document.createElement("option");a.innerHTML="Select Bitmap",a.defaultSelected=!0,a.disabled=!0,e.appendChild(a);const s=d.$hitColor.shape.bitmapId,r=d.$currentWorkSpace();for(const t of r._$libraries.values()){if("bitmap"!==t.type)continue;const a=document.createElement("option");a.value=t.id,a.innerHTML=t.name,s&&s===t.id&&(a.selected=!0),e.appendChild(a)}}initializeBlendSetting(){document.getElementById("blend-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("blend-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))})),document.getElementById("blend-select").addEventListener("change",(function(e){d.$screen.updateBlendMode(e.target.value)}))}initializeFilterSetting(){document.getElementById("filter-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("filter-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))})),document.getElementById("filter-add").addEventListener("mousedown",function(){document.querySelectorAll(".filter-none")[0].style.display="none";this[`add${document.getElementById("filter-select").value}`](document.getElementById("filter-setting-list"))}.bind(this))}initializeVideoSetting(){document.getElementById("video-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("video-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))})),document.getElementById("video-loop-select").addEventListener("change",(function(e){const t=d.$screen._$moveTargets[0].target;d.$currentWorkSpace().getLibrary(0|t.dataset.libraryId).loop=1==(0|e.target.value)})),document.getElementById("video-auto-select").addEventListener("change",(function(e){const t=d.$screen._$moveTargets[0].target;d.$currentWorkSpace().getLibrary(0|t.dataset.libraryId).autoPlay=1==(0|e.target.value)}));const e=document.getElementById("video-volume");e.addEventListener("mouseover",this.mouseOver.bind(this)),e.addEventListener("mouseout",this.mouseOut.bind(this)),e.addEventListener("mousedown",this.mouseDown.bind(this)),e.addEventListener("focusin",function(e){this._$focus=!0,this._$currentValue=0|e.target.value,d.$keyLock=!0}.bind(this)),e.addEventListener("focusout",this.objectVolumeSizeOut.bind(this)),e.addEventListener("keypress",this.objectVolumeSizeOut.bind(this))}initializeEaseSetting(){document.getElementById("ease-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("ease-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))})),document.getElementById("ease-select").addEventListener("change",(function(){const e=d.$currentWorkSpace().scene,t=d.$timeline._$targetLayer;d.$screen.executeTween(e.getLayer(0|t.dataset.layerId),!0),d.$screen.createTweenMarker();document.getElementById("timeline-onion-skin").classList.contains("onion-skin-active")&&d.$currentWorkSpace().scene.changeFrame(0|document.getElementById("current-frame").textContent)}))}initializeTextSetting(){document.getElementById("text-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("text-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))})),document.getElementById("font-select").addEventListener("change",(function(e){d.$screen.updateText({name:"font",value:e.target.value})})),document.getElementById("font-style-select").addEventListener("change",(function(e){d.$screen.updateText({name:"fontType",value:e.target.value})})),document.getElementById("font-align-select").addEventListener("change",(function(e){d.$screen.updateText({name:"align",value:e.target.value})})),document.getElementById("font-wrap-select").addEventListener("change",(function(e){switch(0|e.target.value){case 0:d.$screen.updateText({name:"wordWrap",value:!1}),d.$screen.updateText({name:"multiline",value:!1});break;case 1:d.$screen.updateText({name:"wordWrap",value:!1}),d.$screen.updateText({name:"multiline",value:!0});break;case 2:d.$screen.updateText({name:"wordWrap",value:!0}),d.$screen.updateText({name:"multiline",value:!0})}})),document.getElementById("font-input-select").addEventListener("change",(function(e){switch(0|e.target.value){case 0:d.$screen.updateText({name:"inputType",value:"static"});break;case 1:d.$screen.updateText({name:"inputType",value:"input"})}})),document.getElementById("font-scroll-select").addEventListener("change",(function(e){switch(0|e.target.value){case 0:d.$screen.updateText({name:"scroll",value:!1});break;case 1:d.$screen.updateText({name:"scroll",value:!0})}})),document.getElementById("font-border-select").addEventListener("change",(function(e){switch(0|e.target.value){case 0:d.$screen.updateText({name:"border",value:0|e.target.value});break;case 1:d.$screen.updateText({name:"border",value:!0})}})),document.getElementById("font-auto-size-select").addEventListener("change",(function(e){d.$screen.updateText({name:"autoSize",value:0|e.target.value})}));const e=document.getElementById("font-size");e.addEventListener("mouseover",this.mouseOver.bind(this)),e.addEventListener("mouseout",this.mouseOut.bind(this)),e.addEventListener("mousedown",this.mouseDown.bind(this)),e.addEventListener("focusin",function(e){this._$focus=!0,this._$currentValue=+e.target.value,d.$keyLock=!0}.bind(this)),e.addEventListener("focusout",this.objectFontSizeOut.bind(this)),e.addEventListener("keypress",this.objectFontSizeOut.bind(this)),document.getElementById("font-color").addEventListener("change",function(e){this.updateProperty(e.target)}.bind(this));const t=document.getElementById("font-stroke-size");t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("focusin",function(e){this._$focus=!0,this._$currentValue=+e.target.value,d.$keyLock=!0}.bind(this)),t.addEventListener("focusout",this.objectFontStrokeSizeOut.bind(this)),t.addEventListener("keypress",this.objectFontStrokeSizeOut.bind(this)),document.getElementById("font-stroke-color").addEventListener("change",function(e){this.updateProperty(e.target)}.bind(this));const a=["font-leading","font-letterSpacing","font-leftMargin","font-rightMargin"],s=function(e){this._$focus=!0,this._$currentValue=+e.target.value,d.$keyLock=!0}.bind(this);for(let e=0;e<a.length;++e){const t=a[e],r=document.getElementById(t);r.addEventListener("mouseover",this.mouseOver.bind(this)),r.addEventListener("mouseout",this.mouseOut.bind(this)),r.addEventListener("mousedown",this.mouseDown.bind(this)),r.addEventListener("focusin",s),r.addEventListener("focusout",this.objectFontParamOut.bind(this)),r.addEventListener("keypress",this.objectFontParamOut.bind(this))}}disposeCharacterImage(){const e=0|document.getElementById("current-frame").textContent,t=d.$screen._$moveTargets[0].target,a=0|t.dataset.layerId,s=d.$currentWorkSpace().scene,r=s.getLayer(a),i=0|t.dataset.characterId;r.getCharacter(i)._$image=null,document.getElementById(`${a}-${e}`).classList.contains("tween-frame")&&(d.$screen.executeTween(r),d.$screen.createTweenMarker()),s.changeFrame(e)}clearFilters(){this._$filterId=0,this._$filters.clear();const e=document.getElementById("filter-setting-list"),t=document.querySelectorAll(".filter-none")[0];for(;e.children.length;)e.children[0].remove();t.style.display="",e.appendChild(t)}updateFilterBlur(e){const t=0|e.dataset.filterId;if(this._$filters.has(t)){const a=this._$filters.get(t),s=d.$clamp(+e.value,d.MIN_BLUR,d.MAX_BLUR);a.filter[e.dataset.name]=s,e.value=s,this.disposeCharacterImage()}}updateFilterAlpha(e){const t=0|e.dataset.filterId;if(this._$filters.has(t)){e.value=d.$clamp(+e.value,d.COLOR_MIN_MULTIPLIER,d.COLOR_MAX_MULTIPLIER);this._$filters.get(t).filter[e.dataset.name]=+e.value,this.disposeCharacterImage()}}updateFilterGradientAlpha(e){if(!this._$filterGradientTarget)return;const t=0|this._$filterGradientTarget.dataset.index;if(!t)return void(e.value="0");const a=0|this._$filterGradientTarget.dataset.filterId;if(this._$filters.has(a)){e.value=d.$clamp(+e.value,d.COLOR_MIN_MULTIPLIER,d.COLOR_MAX_MULTIPLIER);const s=this._$filters.get(a).filter;s._$alphas[t]=+e.value,this.disposeCharacterImage(),this.updateFilterGradientCanvas(a,s)}}updateFilterStrength(e){const t=0|e.dataset.filterId;if(this._$filters.has(t)){e.value=d.$clamp(+e.value,d.MIN_STRENGTH,d.MAX_STRENGTH);this._$filters.get(t).filter.strength=+e.value,this.disposeCharacterImage()}}updateFilterAngle(e){const t=0|e.dataset.filterId;if(this._$filters.has(t)){let a=d.$clamp((0|e.value)%360,d.MIN_ROTATE,d.MAX_ROTATE);0>a&&(a+=360);this._$filters.get(t).filter.angle=a,e.value=`${a}`,this.disposeCharacterImage()}}updateFilterDistance(e){const t=0|e.dataset.filterId;if(this._$filters.has(t)){e.value=d.$clamp(+e.value,d.MIN_DISTANCE,d.MAX_DISTANCE);this._$filters.get(t).filter.distance=+e.value,this.disposeCharacterImage()}}blurDownEvent(e){const t=e.target.dataset;if(!this._$focus&&this[`_$filter-${t.filterId}-lock`]){const a="blurX"===t.name?"blurY":"blurX";this._$lockTarget=document.getElementById(`${a}-${t.filterId}`),this._$currentValue=+e.target.value}}blurFocusInEvent(e){const t=e.target;if(this._$currentValue=+t.value,this._$focus=!0,this._$lockTarget=null,d.$keyLock=!0,this[`_$filter-${t.dataset.filterId}-lock`]){const e="blurX"===t.dataset.name?"blurY":"blurX";this._$lockTarget=document.getElementById(`${e}-${t.dataset.filterId}`)}}blurFocusOutEvent(e){if(this.updateFilterBlur(e.target),this._$lockTarget&&null!==this._$currentValue){const t=+e.target.value-this._$currentValue,a=+this._$lockTarget.value;this._$lockTarget.value=a+t,this.updateProperty(this._$lockTarget,t)}d.$keyLock=!1,this._$focus=!1,this._$lockTarget=null,this._$currentValue=null}commonFilterEvent(e,t=1){const a=[`blurX-${e}`,`blurY-${e}`];this._$blurDownEvent||(this._$blurDownEvent=this.blurDownEvent.bind(this)),this._$blurFocusInEvent||(this._$blurFocusInEvent=this.blurFocusInEvent.bind(this)),this._$blurFocusOutEvent||(this._$blurFocusOutEvent=this.blurFocusOutEvent.bind(this));for(let e=0;e<a.length;++e){const t=document.getElementById(a[e]);t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("mousedown",this._$blurDownEvent),t.addEventListener("focusin",this._$blurFocusInEvent),t.addEventListener("focusout",this._$blurFocusOutEvent),t.addEventListener("keypress",(function(e){"Enter"===e.code&&e.target.blur()}))}const s=document.getElementById(`quality-${e}`);s.addEventListener("change",function(e){const t=e.target,a=0|t.dataset.filterId;this._$filters.get(a).filter.quality=+t.value,this.disposeCharacterImage()}.bind(this));const r=s.children;for(let e=0;e<r.length;++e){const a=r[e];if(+a.value===t){a.selected=!0;break}}document.getElementById(`filter-${e}-lock`).addEventListener("mousedown",function(e){const t=e.currentTarget.dataset.filterId;this[`_$filter-${t}-lock`]=!this[`_$filter-${t}-lock`],this._$currentValue=null;document.getElementById(`filter-${t}-lock`).childNodes[1].setAttribute("class",this[`_$filter-${t}-lock`]?"active":"disable")}.bind(this)),document.getElementById(`filter-name-${e}`).addEventListener("mousedown",function(e){const t=e.target.dataset.filterId,a=document.getElementById(`filter-view-area-${t}`);"none"===a.style.display?(a.style.display="",document.getElementById(`filter-title-arrow-${t}`).setAttribute("class","arrow active")):(a.style.display="none",document.getElementById(`filter-title-arrow-${t}`).setAttribute("class","arrow disable"))}.bind(this)),document.getElementById(`filter-state-${e}`).addEventListener("mousedown",function(e){const t=0|e.target.dataset.filterId,a=this._$filters.get(t);a.filter.state=!a.filter.state,document.getElementById(`filter-state-${t}`).setAttribute("class",a.filter.state?"filter-active":"filter-disable"),this.disposeCharacterImage()}.bind(this)),document.getElementById(`filter-state-${e}`).setAttribute("class",this._$filters.get(e).filter.state?"filter-active":"filter-disable"),document.getElementById(`trash-${e}`).addEventListener("click",function(e){const t=0|e.target.dataset.filterId,a=d.$screen._$moveTargets[0].target,s=0|a.dataset.layerId,r=d.$currentWorkSpace().scene,i=r.getLayer(s),n=0|a.dataset.characterId,o=i.getCharacter(n),l=0|document.getElementById("current-frame").textContent,c=o.getPlace(l),h=this._$filters.get(t),m=c.filter.indexOf(h.filter);if(document.getElementById(`${s}-${l}`).classList.contains("tween-frame")){let e=l;for(;e>1;){if(document.getElementById(`${s}-${e}`).classList.contains("key-frame"))break;--e}let t=l;for(;;){++t;if(!document.getElementById(`${s}-${t}`).classList.contains("tween-frame"))break}for(let a=e;a<t;++a){o.getPlace(a).filter.splice(m,1)}}else c.filter.splice(m,1);this._$filters.delete(t),this._$filters.size||(document.querySelectorAll(".filter-none")[0].style.display=""),document.getElementById(`filter-id-${t}`).remove(),this._$focus=!1,this._$lockTarget=null,this._$currentValue=null,o._$image=null,r.changeFrame(l)}.bind(this))}createAlphaEvent(e,t){const a=document.getElementById(`${t}-${e}`);a.addEventListener("mouseover",this.mouseOver.bind(this)),a.addEventListener("mouseout",this.mouseOut.bind(this)),a.addEventListener("mousedown",this.mouseDown.bind(this)),a.addEventListener("focusin",function(){d.$keyLock=!0,this._$focus=!0,this._$currentValue=null,this._$lockTarget=null}.bind(this)),a.addEventListener("focusout",function(e){this.updateFilterAlpha(e.target),this._$focus=!1,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!1}.bind(this)),a.addEventListener("keypress",(function(e){"Enter"===e.code&&e.target.blur()}))}createStrengthEvent(e){const t=document.getElementById(`strength-${e}`);t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("focusin",function(){d.$keyLock=!0,this._$focus=!0,this._$currentValue=null,this._$lockTarget=null}.bind(this)),t.addEventListener("focusout",function(e){this.updateFilterStrength(e.target),d.$keyLock=!1,this._$focus=!1,this._$currentValue=null,this._$lockTarget=null}.bind(this)),t.addEventListener("keypress",(function(e){"Enter"===e.code&&e.target.blur()}))}createAngleEvent(e){const t=document.getElementById(`angle-${e}`);t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("focusin",function(){d.$keyLock=!0,this._$focus=!0,this._$currentValue=null,this._$lockTarget=null}.bind(this)),t.addEventListener("focusout",function(e){this.updateFilterAngle(e.target),d.$keyLock=!1,this._$focus=!1,this._$currentValue=null,this._$lockTarget=null}.bind(this)),t.addEventListener("keypress",(function(e){"Enter"===e.code&&e.target.blur()}))}createDistanceEvent(e){const t=document.getElementById(`distance-${e}`);t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("focusin",function(){d.$keyLock=!0,this._$focus=!0,this._$currentValue=null,this._$lockTarget=null}.bind(this)),t.addEventListener("focusout",function(e){this.updateFilterDistance(e.target),d.$keyLock=!1,this._$focus=!1,this._$currentValue=null,this._$lockTarget=null}.bind(this)),t.addEventListener("keypress",(function(e){"Enter"===e.code&&e.target.blur()}))}createColorEvent(e,t){document.getElementById(`${t}-${e}`).addEventListener("change",function(e){const t=e.target,a=0|t.dataset.filterId;this._$filters.get(a).filter[t.dataset.name]=0|`0x${t.value.substr(1)}`,this._$focus=!1,this._$currentValue=null,this._$lockTarget=null,this.disposeCharacterImage()}.bind(this))}createCheckBoxEvent(e,t){document.getElementById(`${t}-${e}`).addEventListener("click",function(e){const t=e.target,a=0|t.dataset.filterId;this._$filters.get(a).filter[t.dataset.name]=t.checked,this.disposeCharacterImage()}.bind(this))}createTypeEvent(e,t){const a=document.getElementById(`type-${e}`);a.addEventListener("change",function(e){const t=e.target,a=0|t.dataset.filterId;this._$filters.get(a).filter.type=t.value,this.disposeCharacterImage()}.bind(this));const s=a.children;for(let e=0;e<s.length;++e){const a=s[e];if(a.value===t){a.selected=!0;break}}}createGradientColorPointerEvent(e,t,a,s){const r=document.getElementById(`color-pointer-list-${e}`);for(let r=0;r<t.length;++r){const i=t[r],n=`#${a[r].toString(16).padStart(6,"0")}`,o=s[r];this.addFilterGradientColorPointer(e,r,i,n,o)}r.addEventListener("mousedown",function(e){if(this._$filterGradientPointer)return;const t=0|e.target.dataset.filterId,a=this._$filters.get(t).filter;this._$filterGradientTarget=null;const s=a.ratios.length,i=e.offsetX,n=document.getElementById(`color-${t}`).value,o=0|document.getElementById(`alpha-${t}`).value;a.ratios.push(i),a.colors.push(0|`0x${n.substr(1)}`),a.alphas.push(o),this.addFilterGradientColorPointer(t,s,i,n,o),this._$filterGradientTarget=r.lastElementChild,this.updateFilterGradientCanvas(t,a),this.disposeCharacterImage()}.bind(this))}createGradientColorEvent(e){document.getElementById(`color-${e}`).addEventListener("change",function(e){const t=e.target;if(this._$filterGradientTarget){const e=this._$filterGradientTarget.getElementsByTagName("i")[0];this._$filterGradientTarget.dataset.color=t.value,e.style.backgroundColor=t.value;const a=0|this._$filterGradientTarget.dataset.filterId,s=this._$filters.get(a).filter,r=0|this._$filterGradientTarget.dataset.index;s._$colors[r]=0|`0x${t.value.substr(1)}`,this.disposeCharacterImage(),this.updateFilterGradientCanvas(a,s)}}.bind(this))}createGradientAlphaEvent(e){const t=document.getElementById(`alpha-${e}`);t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("focusin",function(){d.$keyLock=!0,this._$focus=!0,this._$currentValue=null,this._$lockTarget=null}.bind(this)),t.addEventListener("focusout",function(e){this.updateFilterGradientAlpha(e.target),this._$focus=!1,this._$currentValue=null,this._$lockTarget=null,d.$keyLock=!1}.bind(this)),t.addEventListener("keypress",(function(e){"Enter"===e.code&&e.target.blur()}))}addGradientColorPointer(e,t,a,s){const r=document.getElementById("color-pointer-list"),i=`\n<div class="color-pointer" style="left: ${t-4}px;" data-index="${e}" data-color="${a}" data-alpha="${s}">\n    <div class="color-pointer-triangle"></div>\n    <div class="color-pointer-rect">\n        <i class="pointer-color" style="background-color: ${a}"></i>\n    </div>\n</div>\n`;r.insertAdjacentHTML("beforeend",i);const n=r.lastElementChild;n.addEventListener("mousedown",function(e){const t=e.target;document.getElementById("fill-color-value").value=t.dataset.color,document.getElementById("fill-alpha-value").value=t.dataset.alpha,this._$pointX=e.screenX,this._$gradientTarget=t,this._$gradientPointer=t}.bind(this)),n.addEventListener("dblclick",function(e){const t=document.getElementById("color-pointer-list");if(t.children.length>2&&d.$hitColor){const a=0|e.target.dataset.index;d.$hitColor.ratios.splice(a,1),e.target.remove();for(let e=a;e<t.children.length;++e){const a=t.children[e],s=(0|a.dataset.index)-1;a.dataset.index=`${s}`}this._$gradientPointer=null,this._$gradientTarget=null,d.$hitColor.shape.cacheClear();const s=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(s),this.updateGradientCanvas()}}.bind(this)),this._$gradientTarget=n}addFilterGradientColorPointer(e,t,a,s,r){const i=document.getElementById(`color-pointer-list-${e}`),n=`\n<div class="color-pointer" style="left: ${a-4}px;" data-filter-id="${e}" data-index="${t}" data-color="${s}" data-alpha="${r}">\n    <div class="color-pointer-triangle"></div>\n    <div class="color-pointer-rect">\n        <i class="pointer-color" style="background-color: ${s}"></i>\n    </div>\n</div>\n`;i.insertAdjacentHTML("beforeend",n);const o=i.lastElementChild;o.addEventListener("mousedown",function(e){const t=e.target,a=t.dataset.filterId;document.getElementById(`color-${a}`).value=t.dataset.color,document.getElementById(`alpha-${a}`).value=t.dataset.alpha,this._$pointX=e.screenX,this._$filterGradientTarget=t,this._$filterGradientPointer=t}.bind(this)),t&&o.addEventListener("dblclick",function(e){const t=0|e.target.dataset.filterId,a=document.getElementById(`color-pointer-list-${t}`);if(a.children.length>2){const s=0|e.target.dataset.index,r=this._$filters.get(t).filter;r.ratios.splice(s,1),r.colors.splice(s,1),r.alphas.splice(s,1),e.target.remove();for(let e=s;e<a.children.length;++e){const t=a.children[e],s=(0|t.dataset.index)-1;t.dataset.index=`${s}`}this._$filterGradientPointer=null,this._$filterGradientTarget=null,this.disposeCharacterImage(),this.updateFilterGradientCanvas(t,r)}}.bind(this))}updateGradientCanvas(){const e=this._$gradientContext;e.clearRect(0,0,d.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,d.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.beginPath();const t=d.$hitColor.ratios,a=t.length,s=Math.ceil(255*t[a-1].ratio*window.devicePixelRatio),r=e.createLinearGradient(0,0,s,0);for(let e=0;e<a;++e){const a=t[e];r.addColorStop(a.ratio,`rgba(${a.R}, ${a.G}, ${a.B}, ${a.A/255})`)}e.fillStyle=r,e.rect(0,0,d.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,d.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.fill()}updateFilterGradientCanvas(e,t){const a=this[`_$filter-${e}-context`];a.clearRect(0,0,d.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,d.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio);const s=t.adjustment();a.beginPath();const r=s.ratios.length,i=Math.ceil(255*s.ratios[r-1]*window.devicePixelRatio),n=a.createLinearGradient(0,0,i,0);for(let e=0;e<r;++e){const t=d.$intToRGB(s.colors[e]);n.addColorStop(s.ratios[e],`rgba(${t.R}, ${t.G}, ${t.B}, ${s.alphas[e]})`)}a.fillStyle=n,a.rect(0,0,d.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,d.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),a.fill()}getFilterHeaderHTML(e,t){return`\n<div id="filter-id-${e}" class="filter-border">\n\n    <div class="filter-title">\n        <i id="filter-title-arrow-${e}" class="arrow active"></i>\n        <span id="filter-name-${e}" data-filter-id="${e}">${t}</span>\n        <i class="filter-active" id="filter-state-${e}" data-filter-id="${e}" data-detail="{{フィルターを表示・非表示する}}"></i>\n        <i class="trash" id="trash-${e}" data-filter-id="${e}" data-detail="{{フィルターを削除}}"></i>\n    </div>\n    \n    <div id="filter-view-area-${e}" class="filter-view-area">\n    \n        <div class="filter-view-area-left">\n        \n            <div id="filter-${e}-lock" data-filter-id="${e}" class="filter-lock">\n                ┌\n                <div class="disable" data-detail="{{比率を固定}}"></div>\n                └\n            </div>\n        \n        </div>\n`}createFilter(e,t=null){const a=this._$filterId++;if(!t){t=new e;const a=d.$screen._$moveTargets[0].target,s=0|a.dataset.layerId,r=d.$currentWorkSpace().scene.getLayer(s),i=0|a.dataset.characterId,n=r.getCharacter(i),o=0|document.getElementById("current-frame").textContent;if(n.getPlace(o).filter.push(t),document.getElementById(`${s}-${o}`).classList.contains("tween-frame")){let a=o;for(;a>1;){if(document.getElementById(`${s}-${a}`).classList.contains("key-frame"))break;--a}let r=o;for(;;){++r;if(!document.getElementById(`${s}-${r}`).classList.contains("tween-frame"))break}for(let s=a;s<r;++s){const a=n.getPlace(s);a.filter.indexOf(t)>-1||a.filter.push(new e)}}}return this._$filters.set(a,{id:a,filter:t}),a}addDropShadowFilter(e,t=null,a=!0){const s=this.createFilter(M,t);t||(t=this._$filters.get(s).filter);const r=this.getFilterHeaderHTML(s,"DropShadow")+`\n\n        <div class="filter-view-area-right">\n        \n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${s}" value="${t.blurX}" data-name="blurX" data-filter-id="${s}" data-detail="{{水平方向にぼかす}}"></div>\n                \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${s}" value="${t.strength}" data-filter-id="${s}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n    \n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${s}" value="${t.blurY}" data-name="blurY" data-filter-id="${s}" data-detail="{{垂直方向にぼかす}}"></div>\n                \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${s}" value="${t.angle}" data-filter-id="${s}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${s}" value="${t.distance}" data-filter-id="${s}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n    \n            <div class="filter-container">\n                <div class="filter-text">Shadow</div>\n                <div><input type="color" id="color-${s}" value="#${t.color.toString(16).padStart(6,"0")}" data-filter-id="${s}" data-name="color" data-detail="[[シャドウのカラー]]"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="alpha-${s}" value="${t.alpha}" data-filter-id="${s}" data-name="alpha" data-detail="{{シャドウのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${s}" data-name="knockout" data-filter-id="${s}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${s}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div><input type="checkbox" id="inner-${s}" data-name="inner" data-filter-id="${s}"></div>\n                <div class="filter-text-long">\n                    <label for="inner-${s}">Inner Shadow</label>\n                </div>\n            </div>\n    \n            <div class="filter-container">\n                <div><input type="checkbox" id="hideObject-${s}" data-name="hideObject" data-filter-id="${s}"></div>\n                <div class="filter-text-long">\n                    <label for="hideObject-${s}">Hide Object</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${s}" data-name="quality" data-filter-id="${s}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div> \n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",r),t.knockout&&(document.getElementById(`knockout-${s}`).checked=!0),t.inner&&(document.getElementById(`inner-${s}`).checked=!0),t.hideObject&&(document.getElementById(`hideObject-${s}`).checked=!0),this[`_$filter-${s}-lock`]=!1,this.commonFilterEvent(s,t.quality),this.createAlphaEvent(s,"alpha"),this.createColorEvent(s,"color"),this.createStrengthEvent(s),this.createAngleEvent(s),this.createDistanceEvent(s),this.createCheckBoxEvent(s,"knockout"),this.createCheckBoxEvent(s,"inner"),this.createCheckBoxEvent(s,"hideObject"),a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${s}`))}addBlurFilter(e,t=null,a=!0){const s=this.createFilter(w,t);t||(t=this._$filters.get(s).filter);const r=this.getFilterHeaderHTML(s,"Blur")+`\n    \n        <div class="filter-view-area-right">\n        \n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${s}" value="${t.blurX}" data-name="blurX" data-filter-id="${s}" data-detail="{{水平方向にぼかす}}"></div>\n            </div>\n        \n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${s}" value="${t.blurY}" data-name="blurY" data-filter-id="${s}" data-detail="{{垂直方向にぼかす}}"></div>\n            </div>\n        \n            <div class="filter-container">\n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${s}" data-name="quality" data-filter-id="${s}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div> \n        \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",r),this[`_$filter-${s}-lock`]=!1,this.commonFilterEvent(s,t.quality),a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${s}`))}addGlowFilter(e,t=null,a=!0){const s=this.createFilter(B,t);t||(t=this._$filters.get(s).filter);const r=this.getFilterHeaderHTML(s,"Glow")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${s}" value="${t.blurX}" data-name="blurX" data-filter-id="${s}" data-detail="{{水平方向にぼかす}}"></div>\n                \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${s}" value="${t.strength}" data-filter-id="${s}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${s}" value="${t.blurY}" data-name="blurY" data-filter-id="${s}" data-detail="{{垂直方向にぼかす}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Color</div>\n                <div><input type="color" id="color-${s}" value="#${t.color.toString(16).padStart(6,"0")}" data-filter-id="${s}" data-name="color" data-detail="{{シャドウのカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="alpha-${s}" value="${t.alpha}" data-filter-id="${s}" data-name="alpha" data-detail="{{シャドウのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="inner-${s}" data-name="inner" data-filter-id="${s}"></div>\n                <div class="filter-text-long">\n                    <label for="inner-${s}">Inner Glow</label>\n                </div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${s}" data-name="knockout" data-filter-id="${s}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${s}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${s}" data-name="quality" data-filter-id="${s}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div> \n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",r),this[`_$filter-${s}-lock`]=!1,this.commonFilterEvent(s,t.quality),this.createAlphaEvent(s,"alpha"),this.createColorEvent(s,"color"),this.createStrengthEvent(s),this.createCheckBoxEvent(s,"knockout"),this.createCheckBoxEvent(s,"inner"),a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${s}`))}addBevelFilter(e,t=null,a=!0){const s=this.createFilter(x,t);t||(t=this._$filters.get(s).filter);const r=this.getFilterHeaderHTML(s,"Bevel")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${s}" value="${t.blurX}" data-name="blurX" data-filter-id="${s}" data-detail="{{水平方向にぼかす}}"></div>\n                 \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${s}" value="${t.strength}" data-filter-id="${s}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${s}" value="${t.blurY}" data-name="blurY" data-filter-id="${s}" data-detail="{{垂直方向にぼかす}}"></div>\n                               \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${s}" value="${t.angle}" data-filter-id="${s}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${s}" value="${t.distance}" data-filter-id="${s}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Shadow<br>Color</div>\n                <div><input type="color" id="shadowColor-${s}" value="#${t.shadowColor.toString(16).padStart(6,"0")}" data-filter-id="${s}" data-name="shadowColor" data-detail="{{シャドウのカラー}}"></div>\n                \n                <div class="filter-text">Shadow<br>Alpha</div>\n                <div><input type="text" id="shadowAlpha-${s}" value="${t.shadowAlpha}" data-filter-id="${s}" data-name="shadowAlpha" data-detail="{{シャドウのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Highlight<br>Color</div>\n                <div><input type="color" id="highlightColor-${s}" value="#${t.highlightColor.toString(16).padStart(6,"0")}" data-filter-id="${s}" data-name="highlightColor" data-detail="{{ハイライトのカラー}}"></div>\n                \n                <div class="filter-text">Highlight<br>Alpha</div>\n                <div><input type="text" id="highlightAlpha-${s}" value="${t.highlightAlpha}" data-filter-id="${s}" data-name="highlightAlpha" data-detail="{{ハイライトのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${s}" data-name="knockout" data-filter-id="${s}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${s}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Type</div>\n                <div>\n                    <select id="type-${s}" data-name="type" data-filter-id="${s}">\n                        <option value="inner">Inner</option>\n                        <option value="outer">Outer</option>\n                        <option value="full">Full</option>\n                    </select>\n                </div>\n    \n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${s}" data-name="quality" data-filter-id="${s}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",r),this[`_$filter-${s}-lock`]=!1,t.knockout&&(document.getElementById(`knockout-${s}`).checked=!0),this.commonFilterEvent(s,t.quality),this.createStrengthEvent(s),this.createAngleEvent(s),this.createDistanceEvent(s),this.createColorEvent(s,"highlightColor"),this.createAlphaEvent(s,"highlightAlpha"),this.createColorEvent(s,"shadowColor"),this.createAlphaEvent(s,"shadowAlpha"),this.createCheckBoxEvent(s,"knockout"),this.createTypeEvent(s,t.type),a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${s}`))}addGradientGlowFilter(e,t=null,a=!0){const s=this.createFilter(C,t);t||(t=this._$filters.get(s).filter);const r=this.getFilterHeaderHTML(s,"GradientGlow")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${s}" value="${t.blurX}" data-name="blurX" data-filter-id="${s}" data-detail="{{水平方向にぼかす}}"></div>\n                          \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${s}" value="${t.strength}" data-filter-id="${s}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${s}" value="${t.blurY}" data-name="blurY" data-filter-id="${s}" data-detail="{{垂直方向にぼかす}}"></div>\n            \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${s}" value="${t.angle}" data-filter-id="${s}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${s}" value="${t.distance}" data-filter-id="${s}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div id="gradient-color-palette-${s}" class="gradient-color-palette">\n                    <div id="color-palette-${s}" class="color-palette">\n                        <canvas id="gradient-canvas-${s}"></canvas>\n                    </div>\n                    <div id="color-pointer-list-${s}" data-filter-id="${s}" class="color-pointer-list" data-detail="{{カラーポインターを追加}}"></div>\n                </div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Color</div>\n                <div><input type="color" id="color-${s}" value="#000000" data-detail="{{グラデーションカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="alpha-${s}" value="100" data-name="gradientAlpha" data-detail="{{グラデーションのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${s}" data-name="knockout" data-filter-id="${s}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${s}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Type</div>\n                <div>\n                    <select id="type-${s}" data-name="type" data-filter-id="${s}">\n                        <option value="inner">Inner</option>\n                        <option value="outer">Outer</option>\n                        <option value="full">Full</option>\n                    </select>\n                </div>\n    \n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${s}" data-name="quality" data-filter-id="${s}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n</div>\n        `;e.insertAdjacentHTML("beforeend",r);const i=document.getElementById(`gradient-canvas-${s}`);i.width=d.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,i.height=d.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,i.style.transform=`scale(${1/window.devicePixelRatio}, ${1/window.devicePixelRatio})`,i.style.backfaceVisibility="hidden",i.style.transformOrigin="0 0";const n=i.getContext("2d");this[`_$filter-${s}-lock`]=!1,this[`_$filter-${s}-context`]=n,t.knockout&&(document.getElementById(`knockout-${s}`).checked=!0),this.commonFilterEvent(s,t.quality),this.createStrengthEvent(s),this.createAngleEvent(s),this.createDistanceEvent(s),this.createGradientColorPointerEvent(s,t.ratios,t.colors,t.alphas),this.createGradientColorEvent(s),this.createGradientAlphaEvent(s),this.createCheckBoxEvent(s,"knockout"),this.createTypeEvent(s,t.type),this.updateFilterGradientCanvas(s,t),a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${s}`))}addGradientBevelFilter(e,t=null,a=!0){const s=this.createFilter(T,t);t||(t=this._$filters.get(s).filter);const r=this.getFilterHeaderHTML(s,"GradientBevel")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${s}" value="${t.blurX}" data-name="blurX" data-filter-id="${s}" data-detail="水平方向にぼかす"></div>\n                                \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${s}" value="${t.strength}" data-filter-id="${s}" data-name="strength" data-detail="フィルター強度"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${s}" value="${t.blurY}" data-name="blurY" data-filter-id="${s}" data-detail="{{垂直方向にぼかす}}"></div>\n                \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${s}" value="${t.angle}" data-filter-id="${s}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${s}" value="${t.distance}" data-filter-id="${s}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div id="gradient-color-palette-${s}" class="gradient-color-palette">\n                    <div id="color-palette-${s}" class="color-palette">\n                        <canvas id="gradient-canvas-${s}"></canvas>\n                    </div>\n                    <div id="color-pointer-list-${s}" data-filter-id="${s}" class="color-pointer-list" data-detail="{{カラーポインターを追加}}"></div>\n                </div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Color</div>\n                <div><input type="color" id="color-${s}" value="#000000" data-detail="{{グラデーションカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="alpha-${s}" value="100" data-name="gradientAlpha" data-detail="{{グラデーションのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${s}" data-name="knockout" data-filter-id="${s}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${s}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Type</div>\n                <div>\n                    <select id="type-${s}" data-name="type" data-filter-id="${s}">\n                        <option value="inner">Inner</option>\n                        <option value="outer">Outer</option>\n                        <option value="full">Full</option>\n                    </select>\n                </div>\n    \n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${s}" data-name="quality" data-filter-id="${s}">\n                        <option value="1">Low</option>\n                        <option value="2">Middel</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",r);const i=document.getElementById(`gradient-canvas-${s}`);i.width=d.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,i.height=d.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,i.style.transform=`scale(${1/window.devicePixelRatio}, ${1/window.devicePixelRatio})`,i.style.backfaceVisibility="hidden",i.style.transformOrigin="0 0";const n=i.getContext("2d");this[`_$filter-${s}-lock`]=!1,this[`_$filter-${s}-context`]=n,t.knockout&&(document.getElementById(`knockout-${s}`).checked=!0),this.commonFilterEvent(s,t.quality),this.createStrengthEvent(s),this.createAngleEvent(s),this.createDistanceEvent(s),this.createGradientColorPointerEvent(s,t.ratios,t.colors,t.alphas),this.createGradientColorEvent(s),this.createGradientAlphaEvent(s),this.createCheckBoxEvent(s,"knockout"),this.createTypeEvent(s,t.type),this.updateFilterGradientCanvas(s,t),a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${s}`))}initializeLibrary(){const e=document.getElementById("library-list-box");e.addEventListener("mouseleave",function(){this._$menuMode||this._$libraryTarget&&(this._$libraryTarget.classList.remove("active"),this._$libraryTarget=null)}.bind(this)),e.addEventListener("contextmenu",function(e){this._$menuMode=!0;const t=document.getElementById("library-menu");t.style.left=t.clientWidth+e.pageX+5>window.innerWidth?e.pageX-(t.clientWidth+e.pageX+10-window.innerWidth)+"px":`${e.pageX+5}px`,t.style.top=e.pageY-t.clientHeight/2+"px",t.setAttribute("class","fadeIn"),d.$endMenu("library-menu")}.bind(this)),e.addEventListener("mousedown",function(){this._$menuMode||(!this._$libraryHit&&this._$libraryTarget&&(this._$libraryTarget.classList.remove("active"),this._$libraryTarget=null),this._$libraryHit=!1)}.bind(this)),e.addEventListener("drop",function(e){if(this._$libraryTarget){e.preventDefault();const t=this._$libraryTarget;t.style.display="";const a=d.$currentWorkSpace().getLibrary(0|t.dataset.libraryId);a.folderId&&(a.folderId=0,t.classList.remove("folder"),t.remove(),e.currentTarget.appendChild(t)),this._$libraryTarget=null}}.bind(this)),document.body.addEventListener("click",function(){if(!this._$menuMode)return;this._$menuMode=!1;document.getElementById("library-menu").setAttribute("class","fadeOut")}.bind(this)),document.getElementById("library-menu-container-add").addEventListener("click",function(e){d.$currentWorkSpace().temporarilySaved(),this.newContainer(e)}.bind(this)),document.getElementById("library-menu-folder-add").addEventListener("click",function(e){d.$currentWorkSpace().temporarilySaved(),this.newContainer(e)}.bind(this)),document.getElementById("library-menu-content-shape-clone").addEventListener("click",function(){if(this._$libraryTarget){const e=d.$currentWorkSpace(),t=e.getLibrary(0|this._$libraryTarget.dataset.libraryId);if("shape"===t.type){e.temporarilySaved();const a=e.nextLibraryId,s=e.addLibrary(this.createContainer(t.type,`Shape_${a}`,a));t.copyFrom(s)}}}.bind(this));const t=document.getElementById("library-search");t.addEventListener("focusin",(()=>{d.$keyLock=!0})),t.addEventListener("focusout",(()=>{d.$keyLock=!1})),t.addEventListener("input",function(e){const t=e.target.value,a=document.getElementById("library-list-box").children,s=a.length;for(let e=0;e<s;++e){const s=a[e];!t||s.children[0].innerText.indexOf(t)>-1||s.children[1].innerText.indexOf(t)>-1?s.style.display="":s.style.display="none"}}.bind(this));const a=document.getElementById("library-menu-delete"),s=function(e){if(d.$keyLock)return!1;if(this._$inputMode)return!1;if(this._$libraryTarget){let t=!1;if("keydown"===e.type&&(this._$menuMode||"Backspace"!==e.code&&"Delete"!==e.code)||(t=!0),t){const e=d.$currentWorkSpace();e.temporarilySaved();const t=0|this._$libraryTarget.dataset.libraryId,a=e.getLibrary(t);if("folder"===a.type)for(const t of e._$libraries.values())t.folderId&&t.folderId===a.id&&(document.getElementById(`library-child-id-${t.id}`).remove(),e.removeLibrary(t.id));e.removeLibrary(t),this._$libraryTarget.remove(),this._$libraryTarget=null;const s=document.getElementById("library-preview-area");for(;s.children.length;)s.children[0].remove();d.$screen.clearActiveCharacter();const r=0|document.getElementById("current-frame").textContent;e.scene.changeFrame(r)}}}.bind(this);a.addEventListener("click",s),window.addEventListener("keydown",s);const r=function(e){switch(e.code){case"KeyC":if(!this._$libraryTarget)return!1;if((e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)&&(d.$copyLibrary=null,d.$copyLayer=null,d.$copyCharacter=null,!d.$keyLock&&!d.$activeScript)){e.preventDefault(),d.$copyWorkSpaceId=d.$activeWorkSpaceId;const t=0|this._$libraryTarget.dataset.libraryId;d.$copyLibrary=d.$currentWorkSpace().getLibrary(t);const a=document.getElementById("detail-modal");return a.textContent="copy",a.style.left=`${this._$libraryTarget.offsetLeft+5}px`,a.style.top=`${this._$libraryTarget.offsetTop+9}px`,a.setAttribute("class","fadeIn"),a.dataset.timerId=setTimeout(function(){this.classList.contains("fadeOut")||this.setAttribute("class","fadeOut")}.bind(a),1500),!1}break;case"KeyV":if((e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)&&!d.$keyLock&&!d.$activeScript){if(d.$copyWorkSpaceId!==d.$activeWorkSpaceId&&d.$copyLibrary){e.preventDefault();const t=d.$currentWorkSpace(),a=d.$copyLibrary.toObject();if("container"===a.type){const e=new Map;d.$copyContainer(a,e)}else a.id=t.nextLibraryId,t.addLibrary(a);t.initializeLibrary(),d.$copyWorkSpaceId=-1,d.$copyLibrary=null}return!1}}}.bind(this);window.addEventListener("keydown",r);document.getElementById("library-menu-file").addEventListener("click",(function(e){document.getElementById("library-menu-file-input").click(),e.preventDefault()}));document.getElementById("library-menu-file-input").addEventListener("change",function(e){d.$currentWorkSpace().temporarilySaved();const t=e.target.files;for(let e=0;e<t.length;++e)this.loadFile(t[e]);e.target.value=""}.bind(this)),e.addEventListener("dragstart",(function(e){const t=e.target,a=d.$currentWorkSpace().scene;d.$dragElement=a.id!==(0|t.dataset.libraryId)?t:null;const s=document.getElementById("stage-area").children;for(let e=1;e<s.length;++e)s[e].style.pointerEvents="none"})),e.addEventListener("dragend",(function(){d.$dragElement=null;const e=document.getElementById("stage-area").children;for(let t=1;t<e.length;++t)e[t].style.pointerEvents=""})),e.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",function(e){e.preventDefault();const t=e.dataTransfer.files;for(let e=0;e<t.length;++e)this.loadFile(t[e])}.bind(this))}newContainer(e){const t=e.currentTarget.dataset.containerType,a="container"===t?"MovieClip":"Folder",s=d.$currentWorkSpace(),r=s.nextLibraryId;s.addLibrary(this.createContainer(t,`${a}_${r}`,r))}loadFile(e){switch(e.type){case"image/svg+xml":e.text().then((t=>{const a=d.$currentWorkSpace().addLibrary(this.createContainer("container",e.name,d.$currentWorkSpace().nextLibraryId));U.parse(t,a)}));break;case"image/png":case"image/jpeg":case"image/gif":{const t={name:e.name,type:e.type,image:new Image,callback:this.createContainer.bind(this)};e.arrayBuffer().then(function(e){const t=new Blob([e],{type:this.type});this.image.src=URL.createObjectURL(t),this.image.decode().then(function(){const e=this.image.width,t=this.image.height,a=document.createElement("canvas");a.width=e,a.height=t;const s=a.getContext("2d");s.drawImage(this.image,0,0,e,t);const r=new Uint8Array(s.getImageData(0,0,e,t).data),i=this.callback("bitmap",this.name,d.$currentWorkSpace().nextLibraryId);i.width=this.image.width,i.height=this.image.height,i.imageType=this.type,i.buffer=new Uint8Array(r),d.$currentWorkSpace().addLibrary(i),this.callback=null,this.image=null}.bind(this))}.bind(t))}break;case"video/mp4":{const t={name:e.name,type:e.type,video:document.createElement("video"),callback:this.createContainer.bind(this)};e.arrayBuffer().then(function(e){const t=new Blob([e],{type:this.type});this.video.onloadedmetadata=function(){const t=this.callback("video",this.name,d.$currentWorkSpace().nextLibraryId);t.width=this.video.videoWidth,t.height=this.video.videoHeight,t.buffer=new Uint8Array(e),d.$currentWorkSpace().addLibrary(t),this.callback=null,this.video=null}.bind(this),this.video.src=URL.createObjectURL(t),this.video.load()}.bind(t))}break;case"audio/mpeg":e.arrayBuffer().then(function(t){const a=this.createContainer("sound",e.name,d.$currentWorkSpace().nextLibraryId);a.buffer=new Uint8Array(t),d.$currentWorkSpace().addLibrary(a)}.bind(this));break;case"application/x-shockwave-flash":e.arrayBuffer().then((e=>{(new F).setData(new Uint8Array(e)).run((function(e){console.log(e)}))}))}}createContainer(e,t,a,s=""){const r=`\n<div draggable="true" class="library-list-box-child" id="library-child-id-${a}" data-library-id="${a}">\n    <div class="library-list-box-name">\n        <i class="library-type-${e}" id="${e}-${a}" data-library-id="${a}"></i>\n        <p>\n            <span id="library-name-${a}" class="view-text" data-library-id="${a}">${t}</span>\n            <input type="text" id="library-name-input-${a}" data-library-id="${a}" value="${t}" style="display: none;">\n        </p>\n    </div>\n    <div class="library-list-box-symbol">\n        <p>\n            <span id="library-symbol-name-${a}" class="view-symbol-text" data-library-id="${a}"></span>\n            <input type="text" id="library-symbol-name-input-${a}" data-library-id="${a}" value="" style="display: none;">\n        </p>\n    </div>\n</div>`;if(document.getElementById("library-list-box").insertAdjacentHTML("beforeend",r),"container"===e){document.getElementById(`${e}-${a}`).addEventListener("dblclick",d.$changeScene)}const i=document.getElementById(`library-child-id-${a}`);if("folder"===e){const t=document.getElementById(`${e}-${a}`);t.addEventListener("dblclick",(function(e){const t=d.$currentWorkSpace(),a=e.target,s=t.getLibrary(0|a.dataset.libraryId),r=document.getElementById("library-list-box").children;"open"===s.mode?(s.mode="clone",a.classList.remove("library-type-folder-open"),a.classList.add("library-type-folder-close")):(s.mode="open",a.classList.remove("library-type-folder-close"),a.classList.add("library-type-folder-open"));for(let e=0;e<r.length;++e){const a=r[e],i=t.getLibrary(0|a.dataset.libraryId);i.folderId&&(i.folderId===s.id&&(a.style.display="open"===s.mode?"":"none"))}})),i.addEventListener("drop",function(e){if(this._$libraryTarget){e.preventDefault();const t=d.$currentWorkSpace(),a=this._$libraryTarget,s=t.getLibrary(0|a.dataset.libraryId);if("folder"===s.type)return;const r=e.currentTarget,i=t.getLibrary(0|r.dataset.libraryId);s.folderId=i.id,a.remove(),r.parentNode.insertBefore(a,r.nextElementSibling),a.classList.contains("folder")||a.classList.add("folder"),a.style.display="open"===i.mode?"":"none",this._$libraryTarget=null}}.bind(this)),t.classList.remove("library-type-folder"),t.classList.add("library-type-folder-close")}if("sound"===e){const e=document.createElement("option");e.value=`${a}`,e.innerHTML=t,document.getElementById("sound-select").appendChild(e)}"folder"!==e?i.addEventListener("mousedown",function(e){this._$libraryHit=!0;const t=document.getElementById("library-list-box").children;for(let e=0;e<t.length;++e){t[e].classList.remove("active")}if(this._$libraryTarget=null,this._$inputMode||this._$menuMode)return;const a=e.currentTarget;a.classList.remove("active"),a.classList.add("active"),this._$libraryTarget=a;const s=d.$currentWorkSpace().getLibrary(0|a.dataset.libraryId),r=document.getElementById("library-preview-area");for(;r.children.length;)r.children[0].remove();r.appendChild(s.preview)}.bind(this)):i.addEventListener("mousedown",function(e){this._$libraryHit=!0;const t=document.getElementById("library-list-box").children;for(let e=0;e<t.length;++e){t[e].classList.remove("active")}if(this._$libraryTarget=null,this._$inputMode||this._$menuMode)return;const a=e.currentTarget;a.classList.remove("active"),a.classList.add("active"),this._$libraryTarget=a}.bind(this));document.getElementById(`library-name-${a}`).addEventListener("dblclick",function(e){d.$keyLock=!0,this._$inputMode=!0;const t=0|e.target.dataset.libraryId,a=document.getElementById(`library-child-id-${t}`);a.classList.remove("active"),a.draggable=!1;const s=document.getElementById(`library-name-input-${t}`);s.value=e.target.textContent,s.style.display="",s.focus(),e.target.style.display="none"}.bind(this));const n=document.getElementById(`library-name-input-${a}`),o=function(e){if("Enter"!==e.code){if("focusout"===e.type){const t=0|e.target.dataset.libraryId,a=document.getElementById(`library-name-${t}`);d.$currentWorkSpace().getLibrary(t).name=e.target.value,a.textContent=e.target.value,a.style.display="",e.target.style.display="none";document.getElementById(`library-child-id-${t}`).draggable=!0,d.$keyLock=!1,this._$inputMode=!1}}else e.target.blur()}.bind(this);if(n.addEventListener("focusout",o),n.addEventListener("keypress",o),"folder"!==e){const e=document.getElementById(`library-symbol-name-${a}`);e.textContent=s,e.addEventListener("dblclick",function(e){d.$keyLock=!0,this._$libraryTarget=null,this._$inputMode=!0;const t=0|e.target.dataset.libraryId,a=document.getElementById(`library-child-id-${t}`);a.classList.remove("active"),a.draggable=!1;const s=document.getElementById(`library-symbol-name-input-${t}`);s.value=e.target.textContent,s.style.display="",s.focus(),e.target.style.display="none"}.bind(this));const t=document.getElementById(`library-symbol-name-input-${a}`);t.value=s;const r=function(e){if("Enter"!==e.code){if("focusout"===e.type){const t=0|e.target.dataset.libraryId,a=document.getElementById(`library-symbol-name-${t}`);d.$currentWorkSpace().getLibrary(t).symbol=e.target.value,a.textContent=e.target.value,a.style.display="",e.target.style.display="none";document.getElementById(`library-child-id-${t}`).draggable=!0,d.$keyLock=!1,this._$inputMode=!1}}else e.target.blur()}.bind(this);t.addEventListener("focusout",r),t.addEventListener("keypress",r)}return{id:a,type:e,name:t,symbol:s}}initializeSoundSetting(){document.getElementById("sound-setting-title").addEventListener("mousedown",(function(e){const t=document.getElementById("sound-setting-view-area"),a=e.target.children.length?e.target.children[0]:e.target;"none"===t.style.display?(t.style.display="",a.setAttribute("class","active")):(t.style.display="none",a.setAttribute("class","disable"))})),document.getElementById("sound-add").addEventListener("mousedown",function(){document.getElementById("sound-select").options.length&&this.addSound()}.bind(this))}createSoundListArea(){const e=document.getElementById("sound-list-area");for(;e.children.length;)e.children[0].remove();const t=0|document.getElementById("current-frame").textContent,a=d.$currentWorkSpace().scene;if(a._$sounds.has(t)){const e=a._$sounds.get(t);for(let t=0;t<e.length;++t)this.addSound(e[t],t)}}addSound(e=null,t=null){if(!e){const a=document.getElementById("sound-select"),s=a.options[a.selectedIndex],r=0|document.getElementById("current-frame").textContent,i=d.$currentWorkSpace().scene;i._$sounds.has(r)||i._$sounds.set(r,[]);const n=i._$sounds.get(r);t=n.length,e={characterId:0|a.value,name:s.textContent,volume:100,autoPlay:!1},n.push(e);const o=document.getElementById(`frame-label-sound-${r}`);o.classList.contains("frame-border-box-sound")||o.setAttribute("class","frame-border-box-sound")}const a=`\n<div id="sound-id-${t}" class="sound-border">\n    <div class="sound-title">\n      <span id="sound-name-${t}" data-sound-id="${t}">${e.name}</span>\n      <i class="trash" id="sound-trash-${t}" data-sound-id="${t}" data-detail="サウンドを削除"></i>\n    </div>\n\n    <div class="sound-container">\n        <div class="sound-setting-container">\n            <div class="sound-text">Volume</div>\n            <div><input type="text" id="sound-volume-${t}" data-sound-id="${t}" data-name="volume" value="100" data-detail="音量設定"></div>\n        \n            <div class="sound-text">Loop</div>\n            <select id="sound-loop-select-${t}" data-sound-id="${t}" data-detail="ループ">\n                <option value="0">Off</option>\n                <option value="1">On</option>\n            </select>\n        </div>\n    </div>\n</div>\n`;document.getElementById("sound-list-area").insertAdjacentHTML("beforeend",a);const s=document.getElementById(`sound-volume-${t}`);s.addEventListener("mouseover",this.mouseOver.bind(this)),s.addEventListener("mouseout",this.mouseOut.bind(this)),s.addEventListener("mousedown",this.mouseDown.bind(this)),s.addEventListener("focusin",function(e){this._$focus=!0,this._$currentValue=0|e.target.value,d.$keyLock=!0}.bind(this)),s.addEventListener("focusout",this.objectVolumeSizeOut.bind(this)),s.addEventListener("keypress",this.objectVolumeSizeOut.bind(this)),s.value=`${e.volume}`,document.getElementById(`sound-trash-${t}`).addEventListener("click",function(e){const t=0|document.getElementById("current-frame").textContent,a=d.$currentWorkSpace().scene,s=a._$sounds.get(t),r=0|e.target.dataset.soundId;s.splice(r,1),s.length||(a._$sounds.delete(t),document.getElementById(`frame-label-sound-${t}`).setAttribute("class","frame-border-box")),this.createSoundListArea()}.bind(this));const r=document.getElementById(`sound-loop-select-${t}`);r.addEventListener("change",(function(e){const t=0|document.getElementById("current-frame").textContent,a=d.$currentWorkSpace().scene,s=0|e.target.dataset.soundId;a._$sounds.get(t)[s].loop="1"===e.target.value})),r.children[e.loop?1:0].selected=!0}updateSoundVolume(e){const t=0|document.getElementById("current-frame").textContent,a=d.$currentWorkSpace().scene,s=0|e.dataset.soundId;a._$sounds.get(t)[s].volume=0|e.value}initializeGradient(){if(!d.$hitColor)return;const e=document.getElementById("color-pointer-list").children;for(;e.length;)e[0].remove();const t=d.$hitColor.ratios.length;for(let e=0;e<t;++e){const a=d.$hitColor.ratios[e],s=a.R.toString(16).padStart(2,"0"),r=a.G.toString(16).padStart(2,"0"),i=a.B.toString(16).padStart(2,"0");this.addGradientColorPointer(e,255*a.ratio,`#${s}${r}${i}`,a.A/255*100),e+1===t&&(document.getElementById("fill-color-value").value=`#${s}${r}${i}`,document.getElementById("fill-alpha-value").value=a.A/255*100)}this.updateGradientCanvas()}};class u{static toObject(){const e=d.$currentWorkSpace(),t=e.stage,a=e._$libraries,s=[];for(let[e,t]of a)switch(!0){case 0===e:case""!==t.symbol:case d.$useIds.has(e):{const a=t.toPublish();a.symbol&&d.$symbols.set(a.symbol,s.length),s[e]=a}break;default:s[e]=null}let r=d.$useIds.size;for(;;){for(let[e,t]of a){if(s[e])continue;if(!d.$useIds.has(e))continue;const a=t.toPublish();a.symbol&&d.$symbols.set(a.symbol,s.length),s[e]=a}if(r===d.$useIds.size)break;r=d.$useIds.size}return{stage:{width:t.width,height:t.height,fps:t.fps,bgColor:t.bgColor},characters:s}}static toJSON(){d.$symbols.size&&d.$symbols.clear();const e=u.toObject();return e.symbols=Array.from(d.$symbols),e.type="json",JSON.stringify(e)}static toZlib(){d.$symbols.size&&d.$symbols.clear();const e=u.toObject();e.symbols=Array.from(d.$symbols);const t={object:JSON.stringify(e),type:"json"};d.$zlibWorkerActive?d.$zlibQueues.push(t):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(t))}static toWebM(){const e=document.getElementById("__next2d__").children[0].captureStream(0|document.getElementById("stage-fps").value),t=[],a="video/webm;codecs=h264",s=new MediaRecorder(e,{mimeType:a});s.addEventListener("dataavailable",(e=>{t.push(e.data)})),s.addEventListener("stop",(()=>{d.$hidePreview();const e=document.getElementById("save-anchor");e.download=`${d.$currentWorkSpace().name}.webm`,e.href=URL.createObjectURL(new Blob(t,{type:a})),e.click()}));const r=function(){if(d.$root.numChildren)return d.$root.currentFrame>=d.$root.totalFrames?s.stop():void requestAnimationFrame(r);requestAnimationFrame(r)};r(),d.$showPreview(),s.start(0)}static toGIF(e=0){const t=new GIF({repeat:e,workerScript:"./assets/js/gif.worker.js"});t.on("finished",(e=>{const t=document.getElementById("save-anchor");t.download=`${d.$currentWorkSpace().name}.gif`,t.href=URL.createObjectURL(e),t.click()}));const a=function(){if(!d.$root.numChildren)return void requestAnimationFrame(a);const e=document.getElementById("__next2d__").children[0],s=document.createElement("canvas");s.width=e.width,s.height=e.height;const r=s.getContext("2d");if(r.drawImage(e,0,0,e.width,e.height),t.addFrame(r.canvas,{delay:20}),d.$root.currentFrame>=d.$root.totalFrames)return d.$hidePreview(),void t.render();requestAnimationFrame(a)};a(),d.$showPreview()}static toPng(){const e=()=>{if(!d.$root.numChildren)return void requestAnimationFrame(e);const t=d.$root.stage;if(!t)return void requestAnimationFrame(e);if(t._$player._$stopFlag)return void requestAnimationFrame(e);const a=document.getElementById("__next2d__").children[0],s=document.getElementById("save-anchor");s.download=`${d.$currentWorkSpace().name}.png`,s.href=a.toDataURL(),s.click(),d.$hidePreview()};e(),d.$showPreview()}static toApng(e=!0){const t=[];let a=0;const s=()=>{if(d.$root.stage._$player._$stopFlag||!d.$root.numChildren||a===d.$root.currentFrame)return void requestAnimationFrame(s);a=d.$root.currentFrame;const r=document.getElementById("__next2d__").children[0],i=document.createElement("canvas");i.width=r.width,i.height=r.height;if(i.getContext("2d").drawImage(r,0,0,r.width,r.height),r.toBlob((e=>{t.push(e)})),t.length+1===d.$root.totalFrames)return d.$hidePreview(),new m(t,r.width,r.height,0|document.getElementById("stage-fps").value,e).encode().then((e=>{const t=document.getElementById("save-anchor");t.download=`${d.$currentWorkSpace().name}.apng`,t.href=URL.createObjectURL(e),t.click()}));requestAnimationFrame(s)};s(),d.$showPreview()}}d.$screen=new class{constructor(){this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler),this.clear()}clear(){this.clearActiveCharacter(),this._$dropTab=null,this._$rectPosition=null,this._$offsetPosition=null,this._$menuMode=!1,this._$objectClicked=!1,this._$inputMode=!1,this._$penMode=!1,this._$bucketMode=!1,this._$rectMode=!1,this._$drawMode=!1,this._$drawType=null,this._$textMode=!1,this._$multiMode=!1,this._$moveMode=!1,this._$saved=!0,this._$gridMode=0,this._$transformMode=0,this._$positionX=null,this._$positionY=null,this._$baseX=null,this._$baseY=null,this._$baseRotate=null,this._$moveTargets=[],this._$instances=[],this._$tweenMode=!1,this._$tweenController=null,this._$tweenDelete=null,this._$cursorCache=null,this._$shapeTransformMode=!1,this._$shapeMovePointer=!1,this._$shapeMoveTarget=null,this._$shapeAddPointer=!1}initialize(){d.$setCursor("auto"),window.removeEventListener("DOMContentLoaded",this._$handler);const e=document.getElementById("screen");e.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",function(e){e.preventDefault(),d.$dragElement&&this.dropObject(e)}.bind(this)),e.addEventListener("mousedown",function(e){if(this._$shapeAddPointer=!1,d.$canCopyLayer=!1,d.$endMenu(),!this._$inputMode)if(this._$objectClicked)this._$objectClicked=!1;else{if(d.$keyLock=!1,d.$activeScript=!1,d.$controller.showStageSetting(),document.getElementById("object-name").blur(),document.getElementById("object-symbol").blur(),this._$tweenMode)return void(this._$offsetPosition={x:e.offsetX,y:e.offsetY});if(d.$tools._$activeTool){switch(d.$tools._$activeTool.dataset.name){case"arrow":this._$rectMode=!0;break;case"draw-rectangle":case"draw-circle":case"draw-round-rect":this._$drawMode=!0,this._$drawType=d.$tools._$activeTool.dataset.name;break;case"draw-text":this._$textMode=!0;break;case"transform":this._$shapeTransformMode=!0;break;case"draw-pen":this._$penMode=!0;break;case"color-bucket":this._$bucketMode=!0}if(this._$rectMode||this._$drawMode||this._$textMode){this._$rectPosition={x:e.pageX,y:e.pageY};let t=e.offsetX,a=e.offsetY;"stage-area"!==e.target.id&&(t+=e.target.offsetLeft,a+=e.target.offsetTop),this._$offsetPosition={x:t,y:a};let s=null;switch(!0){case this._$rectMode:s=document.getElementById("stage-rect");break;case this._$drawMode:s=document.getElementById("draw-rect");break;case this._$textMode:s=document.getElementById("draw-text")}if(s.style.left=`${e.pageX}px`,s.style.top=`${e.pageY}px`,s.style.width="0px",s.style.height="0px",s.style.display="",this._$textMode&&(s.style.border="1px dashed gray"),this._$drawMode){s.style.background=document.getElementById("fill-color").value,s.style.borderRadius="",s.style.border="";const e=0|document.getElementById("stroke-size").value;e&&(s.style.borderRadius=`${e}px`,s.style.border=`${e}px solid ${document.getElementById("stroke-color").value}`)}}if(this._$penMode){d.$clearPenPointer();let t=e.offsetX,a=e.offsetY;"stage-area"!==e.target.id&&(t+=e.target.offsetLeft,a+=e.target.offsetTop),this._$offsetPosition={x:t,y:a}}}if(this._$drawMode||this._$textMode||this._$shapeTransformMode||this._$penMode||this._$bucketMode)return;if(!this._$multiMode){this.clearActiveCharacter(),d.$controller.hideObjectArea(),d.$controller.showObjectSetting(["object-setting","color-setting","blend-setting","filter-setting"]);const e=d.$currentWorkSpace().scene;document.getElementById("object-name").value=e.name,document.getElementById("object-symbol").value=e.symbol}d.$timeline.resetFrames();const t=d.$timeline._$targetLayer;t&&t.classList.remove("active"),d.$timeline._$targetLayer=null}}.bind(this)),e.addEventListener("dblclick",function(e){if(this._$inputMode)return;if(this._$shapeTransformMode&&!this._$shapeAddPointer){const t=0|document.getElementById("current-frame").textContent;let a=null,s=Number.MAX_VALUE;const r=document.getElementById("stage-area").children,i=d.$currentWorkSpace(),n=i.scene;let o=e.offsetX,l=e.offsetY;if("stage-area"!==e.target.id){const t=0|e.target.dataset.layerId,a=0|e.target.dataset.characterId,s=n.getLayer(t).getCharacter(a);o=s.screenX+d.$offsetLeft+e.offsetX,l=s.screenY+d.$offsetTop+e.offsetY}for(let e=0;e<r.length;++e){const t=r[e];if(!t.dataset.shapePointer)continue;if("true"===t.dataset.curve)continue;const i=Math.sqrt(Math.pow(t.offsetLeft-o,2)+Math.pow(t.offsetTop-l,2));s>i&&(a=t),s=Math.min(s,i)}if(!a)return;const c=i.getLibrary(0|a.dataset.libraryId);if(!c)return;const h=[],m=0|a.dataset.position;for(let e=m+1;e<r.length;++e){const t=r[e];if("true"!==t.dataset.curve){h.push(t);break}}if(!h.length)for(let e=0;e<r.length;++e){const t=r[e];if(t.dataset.shapePointer&&"true"!==t.dataset.curve){h.push(t);break}}for(let e=m-1;;--e){const t=r[e];if(!t.dataset.shapePointer)break;if("true"!==t.dataset.curve){h.push(t);break}}if(1===h.length)for(let e=r.length-1;;--e){const t=r[e];if(!t.dataset.shapePointer)break;if("true"!==t.dataset.curve){h.push(t);break}}let u=null;s=Number.MAX_VALUE;for(let e=0;e<h.length;++e){const t=h[e],a=Math.sqrt(Math.pow(t.offsetLeft-o,2)+Math.pow(t.offsetTop-l,2));s>a&&(u=t),s=Math.min(s,a)}const{Graphics:f}=window.next2d.display,g=0|a.dataset.layerId,y=0|a.dataset.characterId,$=n.getLayer(g).getCharacter(y),p=$.getPlace(t).matrix,b=Math.sqrt(p[0]*p[0]+p[1]*p[1]),_=Math.sqrt(p[2]*p[2]+p[3]*p[3]),v=0|a.dataset.index,I=0|u.dataset.index;I>v?c._$recodes.splice(v+2,0,f.LINE_TO,(o-d.$offsetLeft-$.screenX+c._$bounds.xMin)/b,(l-d.$offsetTop-$.screenY+c._$bounds.yMin)/_):c._$recodes.splice(I+2,0,f.LINE_TO,(o-d.$offsetLeft-$.screenX+c._$bounds.xMin)/b,(l-d.$offsetTop-$.screenY+c._$bounds.yMin)/_);for(let e=0;e<r.length;++e){const t=r[e];t.dataset.shapePointer&&("true"!==t.dataset.curve&&(t.remove(),--e))}const k=c.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);if(c._$bounds.xMin=k.xMin,c._$bounds.xMax=k.xMax,c._$bounds.yMin=k.yMin,c._$bounds.yMax=k.yMax,c.cacheClear(),n.changeFrame(t),$){const e=$.getPlace(t).matrix;c.createPointer(e,g,y)}return}if(this._$objectClicked)return void(this._$objectClicked=!1);if(this._$moveTargets.length)return;const t=document.getElementById("scene-name-menu-list").lastElementChild;if(t){const e=0|t.dataset.frame;document.getElementById("current-frame").textContent=`${e}`;const a=d.$currentWorkSpace();a.scene=a.getLibrary(0|t.dataset.libraryId);const s=13*(e-1);document.getElementById("timeline-marker").style.left=`${s}px`;const r=document.getElementById("timeline-controller-base"),i=s>r.offsetWidth/2?s-r.offsetWidth/2:0;d.$timeline.moveTimeLine(i),t.remove()}}.bind(this)),e.addEventListener("mouseover",function(){this._$cursorCache&&d.$setCursor(this._$cursorCache)}.bind(this)),e.addEventListener("mouseleave",function(){this._$cursorCache="auto"===d.$currentCursor?null:d.$currentCursor,this._$rectMode=!1,this._$drawMode=!1,this._$textMode=!1,this._$shapeTransformMode=!1,this._$rectPosition=null,this._$offsetPosition=null,document.getElementById("stage-rect").style.display="none",document.getElementById("draw-rect").style.display="none",d.$setCursor("auto")}.bind(this)),e.addEventListener("mousewheel",(function(e){if(e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey){e.preventDefault();const t=e.deltaX||e.deltaY;return t&&window.requestAnimationFrame(function(e=0){d.$zoomScale+=e,d.$zoomScale=Math.min(3,Math.max(.25,d.$zoomScale));document.getElementById("stage-area").style.transform=`scale(${d.$zoomScale})`}.bind(this,t/100*-1)),!1}}),{passive:!1}),window.addEventListener("mousemove",function(e){if(this._$rectMode&&window.requestAnimationFrame(function(e){if(!this._$rectPosition)return;e.preventDefault();const t=e.pageX,a=e.pageY,s=document.getElementById("stage-rect");this._$rectPosition.x>t&&(s.style.left=`${t}px`),this._$rectPosition.y>a&&(s.style.top=`${a}px`),s.style.width=`${Math.abs(t-this._$rectPosition.x)}px`,s.style.height=`${Math.abs(a-this._$rectPosition.y)}px`}.bind(this,e)),this._$textMode&&window.requestAnimationFrame(function(e){if(!this._$rectPosition)return;e.preventDefault();const t=e.pageX,a=e.pageY,s=document.getElementById("draw-text");this._$rectPosition.x>t&&(this._$offsetPosition.x=e.offsetX,s.style.left=`${t}px`),this._$rectPosition.y>a&&(this._$offsetPosition.y=e.offsetY,s.style.top=`${a}px`),s.style.width=`${Math.abs(t-this._$rectPosition.x)}px`,s.style.height=`${Math.abs(a-this._$rectPosition.y)}px`}.bind(this,e)),this._$drawMode&&window.requestAnimationFrame(function(e){if(!this._$rectPosition)return;e.preventDefault();const t=e.pageX,a=e.pageY,s=document.getElementById("draw-rect");if("draw-circle"===d.$tools._$activeTool.dataset.name&&(s.style.borderRadius="50%"),d.$shiftKey){const r=Math.max(Math.abs(t-this._$rectPosition.x),Math.abs(a-this._$rectPosition.y));this._$rectPosition.x<t&&(s.style.left=`${this._$rectPosition.x}px`),this._$rectPosition.y<a&&(s.style.top=`${this._$rectPosition.y}px`),this._$rectPosition.x>t&&(this._$offsetPosition.x=e.offsetX,s.style.left=this._$rectPosition.x-r+"px"),this._$rectPosition.y>a&&(this._$offsetPosition.y=e.offsetY,s.style.top=this._$rectPosition.y-r+"px"),s.style.width=`${r}px`,s.style.height=`${r}px`}else this._$rectPosition.x>t&&(this._$offsetPosition.x=e.offsetX,s.style.left=`${t}px`),this._$rectPosition.y>a&&(this._$offsetPosition.y=e.offsetY,s.style.top=`${a}px`),s.style.width=`${Math.abs(t-this._$rectPosition.x)}px`,s.style.height=`${Math.abs(a-this._$rectPosition.y)}px`;if("draw-round-rect"===d.$tools._$activeTool.dataset.name){const e=Math.min(parseFloat(s.style.width),parseFloat(s.style.height));s.style.borderRadius=(e/8|0)+"px"}}.bind(this,e)),this._$gridMode&&window.requestAnimationFrame(function(e){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved()),e.preventDefault();const t=e.pageX-this._$positionX,a=e.pageY-this._$positionY;let s=+document.getElementById("nine-slice-setting-x").value,r=+document.getElementById("nine-slice-setting-y").value,i=+document.getElementById("nine-slice-setting-w").value,n=+document.getElementById("nine-slice-setting-h").value;switch(this._$gridMode){case 1:s+=t,i-=t,r+=a,n-=a;break;case 2:i+=t,r+=a;break;case 3:s+=t,i-=t,n+=a;break;case 4:i+=t,n+=a}document.getElementById("nine-slice-setting-x").value=`${s}`,document.getElementById("nine-slice-setting-y").value=`${r}`,document.getElementById("nine-slice-setting-w").value=`${i}`,document.getElementById("nine-slice-setting-h").value=`${n}`,this._$positionX=e.pageX,this._$positionY=e.pageY,this.updateShapeGrid();const o=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(o)}.bind(this,e)),this._$transformMode&&window.requestAnimationFrame(function(e){switch(this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved()),e.preventDefault(),this._$transformMode){case 1:if(Math.max(this.updateLeftScaleX(e),this.updateTopScaleY(e))){d.$shiftKey&&this.adjustmentScale();const e=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(e)}break;case 2:if(this.updateLeftScaleX(e)){const e=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(e)}break;case 3:if(Math.max(this.updateLeftScaleX(e),this.updateBottomScaleY(e))){d.$shiftKey&&this.adjustmentScale();const e=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(e)}break;case 4:if(this.updateTopScaleY(e)){const e=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(e)}break;case 5:if(Math.max(this.updateRightScaleX(e),this.updateTopScaleY(e))){d.$shiftKey&&this.adjustmentScale();const e=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(e)}break;case 6:if(this.updateRightScaleX(e)){const e=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(e)}break;case 7:if(Math.max(this.updateRightScaleX(e),this.updateBottomScaleY(e))){d.$shiftKey&&this.adjustmentScale();const e=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(e)}break;case 8:if(this.updateBottomScaleY(e)){const e=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(e)}break;case 9:{const t=document.getElementById("scale-top-left"),a=t.offsetLeft,s=t.offsetTop,r=document.getElementById("scale-bottom-right"),i=a+(r.offsetLeft-a)/2,n=s+(r.offsetTop-s)/2,o=this._$baseX+e.pageX-this._$positionX,l=this._$baseY+e.pageY-this._$positionY,c=180*Math.atan2(l-n,o-i)/Math.PI+315;if(c){let e=(this._$baseRotate+c)%360;0>e&&(e+=360),this.updateRotate(e),document.getElementById("transform-rotate").value=e;const t=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(t)}}}}.bind(this,e)),this._$shapeMovePointer&&window.requestAnimationFrame(function(e){if(!this._$rectPosition||!this._$shapeMoveTarget)return;const t=this._$shapeMoveTarget,a=d.$currentWorkSpace(),s=a.getLibrary(0|t.dataset.libraryId);if(!s)return this._$shapeMovePointer=!1,this._$shapeMoveTarget=null,void d.$clearShapePointer();e.preventDefault();const r=0|document.getElementById("current-frame").textContent,i=0|t.dataset.layerId,n=0|t.dataset.characterId,o=a.scene,l=o.getLayer(i).getCharacter(n).getPlace(r).matrix,c=e.pageX-this._$rectPosition.x,h=e.pageY-this._$rectPosition.y,m=Math.atan2(l[1],l[0])*d.$Rad2Deg,u=Math.sqrt(l[0]*l[0]+l[1]*l[1]),f=Math.sqrt(l[2]*l[2]+l[3]*l[3]);let g=(c-t.offsetLeft)/u,y=(h-t.offsetTop)/f;if(m){const e=(360-m)*(Math.PI/180);g*=Math.cos(e),y*=Math.sin(e)}const $=0|t.dataset.index;s._$recodes[$]+=g,s._$recodes[$+1]+=y;const p=0|t.dataset.syncId;p&&(s._$recodes[p]+=g,s._$recodes[p+1]+=y),t.style.left=`${c}px`,t.style.top=`${h}px`;const b=s.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);s._$bounds.xMin=b.xMin,s._$bounds.xMax=b.xMax,s._$bounds.yMin=b.yMin,s._$bounds.yMax=b.yMax,s.cacheClear(),o.changeFrame(r)}.bind(this,e)),this._$tweenController&&window.requestAnimationFrame(function(e){if(!this._$rectPosition)return;e.preventDefault();const t=this._$tweenController,a=e.pageX-this._$rectPosition.x,s=e.pageY-this._$rectPosition.y,r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId),i=0|t.dataset.tweenIndex,n=r.getActiveCharacter(i)[0],o=n.getPlace(i).matrix,l=n.getBounds(),c=d.$boundsMatrix(l,o),h=Math.abs(Math.ceil(c.xMax-c.xMin)/2),m=Math.abs(Math.ceil(c.yMax-c.yMin)/2),u=n._$tween.get(n.startFrame).curve[t.dataset.index];u.x=a-d.$offsetLeft-h-l.xMin,u.y=s-d.$offsetTop-m-l.yMin,t.style.left=`${d.$offsetLeft+u.x+l.xMin+h}px`,t.style.top=`${d.$offsetTop+u.y+l.yMin+m}px`,this.executeTween(r),this.createTweenMarker(),d.$currentWorkSpace().scene.changeFrame(0|document.getElementById("current-frame").textContent)}.bind(this,e)),this._$penMode){const t=0|document.getElementById("stroke-size").value;t&&window.requestAnimationFrame(function(e){e.preventDefault();let a=e.offsetX,s=e.offsetY;"stage-area"!==e.target.id&&(a+=e.target.offsetLeft,s+=e.target.offsetTop);const r=document.getElementById("stage-area"),i=document.createElement("div");i.dataset.penPointer="true",i.classList.add("pen-pointer"),i.style.width=`${t}px`,i.style.height=`${t}px`,i.style.left=`${a}px`,i.style.top=`${s}px`,i.style.backgroundColor=document.getElementById("stroke-color").value,i.style.borderRadius=t/2+"px",r.appendChild(i)}.bind(this,e))}this._$moveMode&&!this._$multiMode&&this._$moveTargets.length&&window.requestAnimationFrame(function(e){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved()),d.$setCursor("move"),e.preventDefault();const t=0|document.getElementById("current-frame").textContent,a=d.$currentWorkSpace().scene;let s=Number.MAX_VALUE,r=Number.MAX_VALUE;for(let i=0;i<this._$moveTargets.length;++i){const n=this._$moveTargets[i],o=n.target,l=0|o.dataset.layerId,c=a.getLayer(l),h=c.getCharacter(0|o.dataset.characterId);this.initPlace(h,l,t);const m=e.pageX-n.moveX,u=e.pageY-n.moveY,f=h.getPlace(t).matrix,g=m-parseFloat(o.style.left),y=u-parseFloat(o.style.top);if(f[4]+=g,f[5]+=y,h.screenX+=g,h.screenY+=y,null!==c.maskId){const e=a.getLayer(c.maskId);if(e.lock&&e._$characters.length){const t=e._$characters[0],a=t.screenX-h.screenX,s=t.screenY-h.screenY;o.style.webkitMaskPosition=`${a}px ${s}px`}}if(o.style.left=`${m}px`,o.style.top=`${u}px`,s=Math.min(s,h.x),r=Math.min(r,h.y),c._$frame.hasClasses(t)){if(c._$frame.getClasses(t).indexOf("tween-frame")>-1){this.executeTween(c),this.createTweenMarker();document.getElementById("timeline-onion-skin").classList.contains("onion-skin-active")&&d.$currentWorkSpace().scene.changeFrame(t)}}}document.getElementById("object-x").value=s,document.getElementById("object-y").value=r,this.placeTransformTarget(),this.placeGridTarget()}.bind(this,e))}.bind(this)),window.addEventListener("mouseup",function(e){if(this._$rectMode){this.clearTweenMarker();const e=document.getElementById("stage-rect"),t=parseFloat(e.style.left),a=parseFloat(e.style.top),s=t+parseFloat(e.style.width),r=a+parseFloat(e.style.height),i=document.getElementById("stage-area").children;for(let e=0;e<i.length;++e){const n=i[e];if(!n.dataset.child||"tween"===n.dataset.child)continue;const o=n.getBoundingClientRect();switch(!0){case o.bottom<a:case o.top>r:case o.right<t:case o.left>s:continue}const l=0|n.dataset.layerId;document.getElementById(`layer-lock-icon-${l}`).classList.contains("icon-active")||this.addTarget(n)}this._$rectMode=!1,this._$rectPosition=null,this._$offsetPosition=null,e.style.display="none",this._$moveTargets.length&&(d.$controller.showObjectArea(),this.updatePropertyArea())}if(this._$textMode){if(!d.$timeline._$targetLayer){const e=document.getElementById("timeline-content");if(!e.children.length)return;const t=e.children[0],a=document.getElementById(`${t.dataset.layerId}-1`);if(!a)return;d.$timeline._$targetLayer=a}const e=document.getElementById("draw-text");if(d.$timeline._$targetLayer){const t=this._$offsetPosition.x-d.$offsetLeft,a=this._$offsetPosition.y-d.$offsetTop,s=parseFloat(e.style.width),r=parseFloat(e.style.height),i=d.$currentWorkSpace().nextLibraryId;this.addTextField({id:i,type:"text",name:`Text_${i}`,symbol:"",bounds:{xMin:0,xMax:s,yMin:0,yMax:r},originBounds:{xMin:0,xMax:s,yMin:0,yMax:r}},t,a);const n=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(n)}this._$textMode=!1,this._$rectPosition=null,this._$offsetPosition=null,e.style.display="none",d.$tools.reset()}if(this._$drawMode){if(!d.$timeline._$targetLayer){const e=document.getElementById("timeline-content");if(!e.children.length)return;const t=e.children[0],a=document.getElementById(`${t.dataset.layerId}-1`);if(!a)return;d.$timeline._$targetLayer=a}const e=document.getElementById("draw-rect");if(d.$timeline._$targetLayer){const{Graphics:t}=window.next2d.display,a=0|document.getElementById("stroke-size").value,s=parseFloat(e.style.width)+a,r=parseFloat(e.style.height)+a;if(s&&r){const e=new t;switch(e.beginFill(document.getElementById("fill-color").value,1),this._$drawType){case"draw-rectangle":e.drawRect(0,0,s,r);break;case"draw-circle":e.drawEllipse(0,0,s,r);break;case"draw-round-rect":e.drawRoundRect(0,0,s,r,Math.min(s,r)/4)}e.endFill();const i=this._$offsetPosition.x-d.$offsetLeft,n=this._$offsetPosition.y-d.$offsetTop,o=d.$currentWorkSpace().nextLibraryId;if(this.addShape({id:o,type:"shape",name:`Shape_${o}`,symbol:"",recodes:e._$recode?e._$recode.slice(0):[],bounds:{xMin:0,xMax:s,yMin:0,yMax:r}},i+a/2,n+a/2),a){const e=new t;switch(e.lineStyle(a,document.getElementById("stroke-color").value),this._$drawType){case"draw-rectangle":e.drawRect(0,0,s,r);break;case"draw-circle":e.drawEllipse(0,0,s,r);break;case"draw-round-rect":e.drawRoundRect(0,0,s,r,Math.min(s,r)/4)}e.endLine();const i=Math.abs(e._$xMax-e._$xMin)-s,n=Math.abs(e._$yMax-e._$yMin)-r,o=this._$offsetPosition.x-d.$offsetLeft,l=this._$offsetPosition.y-d.$offsetTop,c=d.$currentWorkSpace().nextLibraryId;this.addShape({id:c,type:"shape",name:`Shape_${c}`,symbol:"",recodes:e._$recode?e._$recode.slice(0):[],bounds:{xMin:-i/2,xMax:s+i/2,yMin:-n/2,yMax:r+n/2}},o+i/2,l+n/2)}const l=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(l)}}this._$drawMode=!1,this._$rectPosition=null,this._$offsetPosition=null,e.style.display="none",d.$tools.reset()}if((this._$transformMode||this._$gridMode||this._$moveMode)&&(d.$setCursor("auto"),this._$moveTargets.length)){const e=d.$currentWorkSpace().scene;for(let t=0;t<this._$moveTargets.length;++t){const a=this._$moveTargets[t].target;e.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId)._$image=null}this.updatePropertyArea()}if(this._$penMode){if(this._$penMode=!1,!d.$timeline._$targetLayer){const e=document.getElementById("timeline-content");if(!e.children.length)return;const t=e.children[0],a=document.getElementById(`${t.dataset.layerId}-1`);if(!a)return;d.$timeline._$targetLayer=a}if(d.$timeline._$targetLayer){const{Shape:e}=window.next2d.display,t=0|document.getElementById("stroke-size").value,a=new e;a.graphics.lineStyle(t,document.getElementById("stroke-color").value);const s=this._$offsetPosition.x-d.$offsetLeft,r=this._$offsetPosition.y-d.$offsetTop;a.graphics.moveTo(0,0);const i=document.getElementById("stage-area").children;for(let e=0;i.length>e;++e){const t=i[e];t.dataset.penPointer&&(a.graphics.lineTo(t.offsetLeft-d.$offsetLeft-s,t.offsetTop-d.$offsetTop-r),t.remove(),--e)}a.graphics.endLine();const n=d.$currentWorkSpace().nextLibraryId;this.addShape({id:n,type:"shape",name:`Shape_${n}`,symbol:"",recodes:a.graphics._$recode.slice(0),bounds:{xMin:a.graphics._$xMin,xMax:a.graphics._$xMax,yMin:a.graphics._$yMin,yMax:a.graphics._$yMax}},s+t/2,r+t/2)}}if(this._$bucketMode){this._$bucketMode=!1;const t=e.target;if("shape"===t.dataset.instanceType){const{Graphics:e}=window.next2d.display,a=d.$currentWorkSpace(),s=0|document.getElementById("current-frame").textContent,r=a.getLibrary(0|t.dataset.libraryId),i=d.$intToRGB(0|`0x${document.getElementById("fill-color").value.substr(1)}`);switch(r._$recodes[r._$recodes.length-1]){case e.END_FILL:r._$recodes.splice(r._$recodes.length-6,6,e.FILL_STYLE,i.R,i.G,i.B,255,e.END_FILL);break;case e.END_STROKE:r._$recodes.push(e.FILL_STYLE,i.R,i.G,i.B,255,e.END_FILL)}r.cacheClear(),a.scene.changeFrame(s)}}this._$tweenMode&&(this._$tweenMode=!1,this._$tweenController=null,this._$rectPosition=null,this._$offsetPosition=null),this._$moveMode=!1,this._$gridMode=0,this._$transformMode=0,this._$shapeMovePointer=!1}.bind(this)),window.addEventListener("keydown",this.keyCommandFunction.bind(this)),window.addEventListener("keyup",function(e){this._$multiMode&&!e.shiftKey&&(this._$multiMode=!1)}.bind(this));const t=document.getElementById("screen-copy");t.children[0].classList.add(d.$isMac?"mac-icon":"win-icon"),t.addEventListener("mousedown",function(e){this.keyCommandFunction({code:"KeyC",ctrlKey:!0,metaKey:!1,preventDefault:function(){return this.preventDefault()}.bind(e)})}.bind(this));const a=document.getElementById("screen-paste");a.children[0].classList.add(d.$isMac?"mac-icon":"win-icon"),a.addEventListener("mousedown",function(e){this.keyCommandFunction({code:"KeyV",ctrlKey:!0,metaKey:!1,preventDefault:function(){return this.preventDefault()}.bind(e)})}.bind(this)),document.getElementById("screen-delete").addEventListener("mousedown",function(){this.keyCommandFunction({code:"Delete"})}.bind(this));const s=document.getElementById("screen-preview");s.children[0].classList.add(d.$isMac?"mac-icon":"win-icon"),s.addEventListener("mousedown",function(e){d.$keyCommandFunction({code:"Enter",ctrlKey:!0,metaKey:!1,preventDefault:function(){return this.preventDefault()}.bind(e)})}.bind(this)),this.initializeContextMenu(),this.initializeTransformTarget(),this.initializeGridTarget(),d.$initializeEnd(),this._$handler=null}keyCommandFunction(e){if(e.shiftKey)return this._$multiMode=!0,!1;if(d.$keyLock)return!1;switch(e.code){case"ArrowRight":if(this._$moveTargets.length){const e=d.$currentWorkSpace().scene,t=0|document.getElementById("current-frame").textContent;let a=Number.MAX_VALUE,s=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let n=0;n<this._$moveTargets.length;++n){const o=this._$moveTargets[n].target,l=parseFloat(o.style.left);o.style.left=`${l+1}px`;const c=0|o.dataset.layerId,d=e.getLayer(c),h=0|o.dataset.characterId,m=d.getCharacter(h);this.initPlace(m,c,t);m.getPlace(t).matrix[4]++,a=Math.min(a,m.x),s=Math.max(s,m.x+m.width),r=Math.min(r,m.y),i=Math.max(i,m.y+m.height),m._$image=null}this.placeTransformTarget(),this.updatePropertyArea(!1)}break;case"ArrowLeft":if(this._$moveTargets.length){const e=d.$currentWorkSpace().scene,t=0|document.getElementById("current-frame").textContent;let a=Number.MAX_VALUE,s=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let n=0;n<this._$moveTargets.length;++n){const o=this._$moveTargets[n].target,l=parseFloat(o.style.left);o.style.left=l-1+"px";const c=0|o.dataset.layerId,d=e.getLayer(c),h=0|o.dataset.characterId,m=d.getCharacter(h);this.initPlace(m,c,t);m.getPlace(t).matrix[4]--,a=Math.min(a,m.x),s=Math.max(s,m.x+m.width),r=Math.min(r,m.y),i=Math.max(i,m.y+m.height),m._$image=null}this.placeTransformTarget(),this.updatePropertyArea(!1)}break;case"ArrowDown":if(this._$moveTargets.length){const e=d.$currentWorkSpace().scene,t=0|document.getElementById("current-frame").textContent;let a=Number.MAX_VALUE,s=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let n=0;n<this._$moveTargets.length;++n){const o=this._$moveTargets[n].target,l=parseFloat(o.style.top);o.style.top=`${l+1}px`;const c=0|o.dataset.layerId,d=e.getLayer(c),h=0|o.dataset.characterId,m=d.getCharacter(h);this.initPlace(m,c,t);m.getPlace(t).matrix[5]++,a=Math.min(a,m.x),s=Math.max(s,m.x+m.width),r=Math.min(r,m.y),i=Math.max(i,m.y+m.height),m._$image=null}this.placeTransformTarget(),this.updatePropertyArea(!1)}break;case"ArrowUp":if(this._$moveTargets.length){const e=d.$currentWorkSpace().scene,t=0|document.getElementById("current-frame").textContent;let a=Number.MAX_VALUE,s=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let n=0;n<this._$moveTargets.length;++n){const o=this._$moveTargets[n].target,l=parseFloat(o.style.top);o.style.top=l-1+"px";const c=0|o.dataset.layerId,d=e.getLayer(c),h=0|o.dataset.characterId,m=d.getCharacter(h);this.initPlace(m,c,t);m.getPlace(t).matrix[5]--,a=Math.min(a,m.x),s=Math.max(s,m.x+m.width),r=Math.min(r,m.y),i=Math.max(i,m.y+m.height),m._$image=null}this.placeTransformTarget(),this.updatePropertyArea(!1)}break;case"Backspace":case"Delete":{const e=d.$currentWorkSpace().scene,t=0|document.getElementById("current-frame").textContent;if(this._$tweenDelete){const a=this._$tweenDelete,s=e.getLayer(0|a.dataset.layerId),r=s.getActiveCharacter(t)[0];return r._$tween.get(r.startFrame).curve.splice(0|a.dataset.index,1),a.remove(),this.clearTweenMarker(),this.executeTween(s),void this.createTweenMarker(!1)}if(this._$moveTargets.length){d.$currentWorkSpace().temporarilySaved();for(let a=0;a<this._$moveTargets.length;++a){const s=this._$moveTargets[a].target,r=0|s.dataset.layerId,i=e.getLayer(r),n=0|s.dataset.characterId,o=i.getCharacter(n);if(!o)continue;for(let[e,t]of o._$places){const a=t.depth;for(let t=0;t<i._$characters.length;++t){const s=i._$characters[t];if(s.id!==o.id&&s.hasPlace(e)){const t=s.getPlace(e);t.depth>a&&t.depth--}}}let l=!1,c=t;for(;;){if("key-frame"===document.getElementById(`${r}-${c}`).dataset.frameState&&(l=!0),l)break;c--}l=!1;let d=t;for(;;){switch(document.getElementById(`${r}-${++d}`).dataset.frameState){case"empty":case"empty-key-frame":case"key-frame":l=!0;break;case"key-space-frame-end":l=!0,d++}if(l)break}switch(!0){case o.startFrame!==c:if(o.endFrame!==d){const e=o.clone();e.startFrame=d;for(const t of e._$places.keys())d>t&&e.deletePlace(t);i.addCharacter(e)}o.endFrame=c;for(const e of o._$places.keys())e>=c&&o.deletePlace(e);break;case o.endFrame!==d:{const e=o.getPlace(o.startFrame);o.deletePlace(o.startFrame),o.startFrame=d,o.hasPlace(d)||o.setPlace(d,e)}break;default:i.deleteCharacter(n),s.remove()}i.getActiveCharacter(c).length||this.clearFrames(i,c,d)}this.clearActiveCharacter(),d.$controller.setDefaultController(),e.changeFrame(t)}if(this._$shapeMoveTarget){let a=0;const s=document.getElementById("stage-area").children;for(let e=0;s.length>e;++e){const t=s[e];t.dataset.shapePointer&&("false"===t.dataset.curve&&a++)}const r=this._$shapeMoveTarget,i="true"===r.dataset.curve;if(!r.dataset.syncId&&(a>2||i)){d.$currentWorkSpace().temporarilySaved();const{Graphics:a}=window.next2d.display,s=d.$currentWorkSpace().getLibrary(0|r.dataset.libraryId),n=0|r.dataset.index;switch(0|r.dataset.type){case a.MOVE_TO:break;case a.LINE_TO:s._$recodes.splice(n-1,3);break;case a.CUBIC:{let e=n;for(;s._$recodes[--e]!==a.CUBIC;);i?(s._$recodes[e]=a.CURVE_TO,s._$recodes.splice(n,2)):s._$recodes.splice(e,7)}break;case a.CURVE_TO:{let e=n;for(;s._$recodes[--e]!==a.CURVE_TO;);i?(s._$recodes[e]=a.LINE_TO,s._$recodes.splice(n,2)):s._$recodes.splice(e,5)}}const o=s.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);s._$bounds.xMin=o.xMin,s._$bounds.xMax=o.xMax,s._$bounds.yMin=o.yMin,s._$bounds.yMax=o.yMax,s.cacheClear(),e.changeFrame(t);const l=0|r.dataset.layerId,c=0|r.dataset.characterId,h=e.getLayer(l).getCharacter(c);if(h){const e=h.getPlace(t).matrix;s.createPointer(e,l,c)}}this._$shapeMoveTarget=null}}break;case"KeyC":if(!d.$canCopyCharacter||!this._$moveTargets)return!1;if((e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)&&(d.$copyLibrary=null,d.$copyLayer=null,d.$copyCharacter=null,!d.$keyLock&&!d.$activeScript)){e.preventDefault(),d.$copyCharacter=[];const t=d.$currentWorkSpace().scene;d.$copyWorkSpaceId=d.$activeWorkSpaceId;for(let e=0;e<this._$moveTargets.length;++e){const a=this._$moveTargets[e].target,s=t.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId),r=s.x+s.width/2,i=s.y+s.height/2;d.$copyCharacter.push({offsetX:r+d.$offsetLeft,offsetY:i+d.$offsetTop,target:a})}const a=document.getElementById("scale-top-left"),s=document.getElementById("screen"),r=document.getElementById("detail-modal"),i=a.offsetLeft-s.scrollLeft+s.offsetLeft,n=a.offsetTop-s.scrollTop+s.offsetTop;return r.textContent="copy",r.style.left=`${i}px`,r.style.top=`${n}px`,r.setAttribute("class","fadeIn"),r.dataset.timerId=setTimeout(function(){this.classList.contains("fadeOut")||this.setAttribute("class","fadeOut")}.bind(r),1500),!1}break;case"KeyV":if((e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)&&!d.$keyLock&&!d.$activeScript&&d.$copyCharacter){e.preventDefault();const t=0|document.getElementById("current-frame").textContent,a=d.$currentWorkSpace().scene;if(d.$copyWorkSpaceId===d.$activeWorkSpaceId)for(let e=0;e<d.$copyCharacter.length;++e){const t=d.$copyCharacter[e];d.$dragElement=t.target,this.dropObject({offsetX:t.offsetX,offsetY:t.offsetY})}return d.$dragElement=null,a.changeFrame(t),!1}}}initializeContextMenu(){document.getElementById("screen-front").addEventListener("mousedown",function(){this.changeDepth("up")}.bind(this)),document.getElementById("screen-front-one").addEventListener("mousedown",function(){this.changeDepthOne("up")}.bind(this)),document.getElementById("screen-back-one").addEventListener("mousedown",function(){this.changeDepthOne("down")}.bind(this)),document.getElementById("screen-back").addEventListener("mousedown",function(){this.changeDepth("down")}.bind(this)),document.getElementById("screen-position-left").addEventListener("mousedown",function(){this.alignment("left")}.bind(this)),document.getElementById("screen-position-right").addEventListener("mousedown",function(){this.alignment("right")}.bind(this)),document.getElementById("screen-position-center").addEventListener("mousedown",function(){this.alignment("center")}.bind(this)),document.getElementById("screen-position-top").addEventListener("mousedown",function(){this.alignment("top")}.bind(this)),document.getElementById("screen-position-bottom").addEventListener("mousedown",function(){this.alignment("bottom")}.bind(this)),document.getElementById("screen-integrating-paths").addEventListener("mousedown",function(){if(2>this._$moveTargets.length)return;const e=0|document.getElementById("current-frame").textContent,t=d.$currentWorkSpace();t.temporarilySaved();const a=t.scene;let s=null,r=null,i=0;for(let n=0;n<this._$moveTargets.length;++n){const o=this._$moveTargets[n].target;if("shape"!==o.dataset.instanceType)continue;const l=t.getLibrary(0|o.dataset.libraryId),c=a.getLayer(0|o.dataset.layerId).getCharacter(0|o.dataset.characterId),{Graphics:d}=window.next2d.display;if(!s){r=c,s=l;for(let e=0;s._$recodes.length>e;){switch(s._$recodes[e++]){case d.BEGIN_PATH:break;case d.MOVE_TO:case d.LINE_TO:e+=2;break;case d.CURVE_TO:e+=4;break;case d.CUBIC:e+=6;break;case d.FILL_STYLE:case d.GRADIENT_FILL:case d.STROKE_STYLE:case d.GRADIENT_STROKE:i=e-1;case d.CLOSE_PATH:case d.END_STROKE:case d.END_FILL:}if(i)break}continue}const h=r.screenX-s._$bounds.xMin-c.screenX,m=r.screenY-s._$bounds.yMin-c.screenY,u=c.getPlace(e).matrix,f=[];let g=!1;for(let e=0;l._$recodes.length>e;){switch(l._$recodes[e++]){case d.BEGIN_PATH:break;case d.MOVE_TO:{const t=l._$recodes[e++],a=l._$recodes[e++];f.push(d.MOVE_TO,t*u[0]+a*u[2]-h,t*u[1]+a*u[3]-m)}break;case d.LINE_TO:{const t=l._$recodes[e++],a=l._$recodes[e++];f.push(d.LINE_TO,t*u[0]+a*u[2]-h,t*u[1]+a*u[3]-m)}break;case d.CURVE_TO:{const t=l._$recodes[e++],a=l._$recodes[e++],s=l._$recodes[e++],r=l._$recodes[e++];f.push(d.CURVE_TO,t*u[0]+a*u[2]-h,t*u[1]+a*u[3]-m,s*u[0]+r*u[2]-h,s*u[1]+r*u[3]-m)}break;case d.CUBIC:{const t=l._$recodes[e++],a=l._$recodes[e++],s=l._$recodes[e++],r=l._$recodes[e++],i=l._$recodes[e++],n=l._$recodes[e++];f.push(d.CUBIC,t*u[0]+a*u[2]-h,t*u[1]+a*u[3]-m,s*u[0]+r*u[2]-h,s*u[1]+r*u[3]-m,i*u[0]+n*u[2]-h,i*u[1]+n*u[3]-m)}break;case d.FILL_STYLE:case d.GRADIENT_FILL:case d.STROKE_STYLE:case d.GRADIENT_STROKE:g=!0,Array.prototype.splice.apply(s._$recodes,[i,0].concat(f)),i+=f.length;case d.CLOSE_PATH:case d.END_STROKE:case d.END_FILL:}if(g)break}}if(s){const t=s.reloadBounds();s._$bounds.xMin=t.xMin,s._$bounds.xMax=t.xMax,s._$bounds.yMin=t.yMin,s._$bounds.yMax=t.yMax,s.cacheClear(),a.changeFrame(e)}}.bind(this)),document.getElementById("screen-tween-curve-pointer").addEventListener("mousedown",function(){this.addTweenPointer()}.bind(this))}alignment(e){if(1===this._$moveTargets.length)return;const t=d.$currentWorkSpace().scene;let a=Number.MAX_VALUE,s=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=-Number.MAX_VALUE;const n=[];for(let e=0;e<this._$moveTargets.length;++e){const o=this._$moveTargets[e].target,l=t.getLayer(0|o.dataset.layerId).getCharacter(0|o.dataset.characterId);a=Math.min(a,l.x),s=Math.max(s,l.x+l.width),r=Math.min(r,l.y),i=Math.max(i,l.y+l.height),n.push(l)}for(let t=0;t<n.length;++t){const o=n[t];switch(e){case"left":o.x=a;break;case"right":o.x=s-o.width;break;case"center":o.x=a+(s-a)/2-o.width/2;break;case"top":o.y=r;break;case"bottom":o.y=i-o.height}o._$image=null}const o=0|document.getElementById("current-frame").textContent;t.changeFrame(o),this.updatePropertyArea(),d.$endMenu()}changeDepthOne(e="up"){"up"===e?this._$moveTargets.sort((function(e,t){switch(!0){case e.depth>t.depth:return-1;case e.depth<t.depth:return 1;default:return 0}})):this._$moveTargets.sort((function(e,t){switch(!0){case e.depth>t.depth:return 1;case e.depth<t.depth:return-1;default:return 0}}));const t=d.$currentWorkSpace().scene,a=0|document.getElementById("current-frame").textContent,s=new Map;for(let r=0;r<this._$moveTargets.length;++r){const i=this._$moveTargets[r].target,n=t.getLayer(0|i.dataset.layerId);if(!s.has(n.id)){const e=[],t=n._$characters;for(let s=0;s<t.length;++s){const r=t[s];e.push(r.getPlace(a))}s.set(n.id,e)}const o=s.get(n.id);if(1===o.length)continue;"up"===e?o.sort((function(e,t){switch(!0){case e.depth>t.depth:return-1;case e.depth<t.depth:return 1;default:return 0}})):o.sort((function(e,t){switch(!0){case e.depth>t.depth:return 1;case e.depth<t.depth:return-1;default:return 0}}));const l=n.getCharacter(0|i.dataset.characterId).getPlace(a);for(let t=0;t<o.length;++t){const a=o[t];a.depth===l.depth&&("up"===e?a.depth!==o.length-1&&(a.depth++,o[t-1].depth--):a.depth&&(a.depth--,t&&o[t-1].depth++))}}s.clear(),t.changeFrame(a),d.$endMenu()}changeDepth(e="up"){const t=d.$currentWorkSpace().scene,a=0|document.getElementById("current-frame").textContent,s=new Map;for(let e=0;e<this._$moveTargets.length;++e){const a=this._$moveTargets[e].target,r=t.getLayer(0|a.dataset.layerId);s.has(r.id)||s.set(r.id,[]),s.get(r.id).push(a)}const r=[],i=new Map;for(let[n,o]of s){const s=t.getLayer(n),l=s._$characters;if(1===l.length)continue;let c="up"===e?l.length-1:0;for(let t=0;t<o.length;++t){const r=o[t],n=s.getCharacter(0|r.dataset.characterId);i.set(n.id,!0);const d=n.getPlace(a);if("up"===e){if(d.depth===l.length-1){c--;continue}d.depth=c--}else{if(d.depth===c){c++;continue}d.depth=c++}}for(let e=0;e<l.length;++e){const t=l[e];i.has(t.id)||r.push(t.getPlace(a))}if(r.length){"up"===e?r.sort((function(e,t){switch(!0){case e.depth>t.depth:return-1;case e.depth<t.depth:return 1;default:return 0}})):r.sort((function(e,t){switch(!0){case e.depth>t.depth:return 1;case e.depth<t.depth:return-1;default:return 0}}));for(let t=0;t<r.length;++t){const a=r[t];a.depth="up"===e?c--:c++}}r.length=0,i.clear()}t.changeFrame(a),d.$endMenu()}adjustmentScale(){const e=+document.getElementById("transform-scale-x").value,t=+document.getElementById("transform-scale-y").value;e>t?(this.updateScaleX(t/100),document.getElementById("transform-scale-x").value=t):(this.updateScaleY(e/100),document.getElementById("transform-scale-y").value=e)}updateLeftScaleX(e){const t=this._$positionX-e.pageX;if(t){const a=+document.getElementById("transform-scale-x").value,s=d.$clamp(a+t,d.MIN_INT,d.MAX_INT);return document.getElementById("transform-scale-x").value=s,this.updateScaleX(s/100),this._$positionX=e.pageX,1}return 0}updateTopScaleY(e){const t=this._$positionY-e.pageY;if(t){const a=+document.getElementById("transform-scale-y").value,s=d.$clamp(a+t,d.MIN_INT,d.MAX_INT);return document.getElementById("transform-scale-y").value=s,this.updateScaleY(s/100),this._$positionY=e.pageY,1}return 0}updateRightScaleX(e){const t=e.pageX-this._$positionX;if(t){const a=+document.getElementById("transform-scale-x").value,s=d.$clamp(a+t,d.MIN_INT,d.MAX_INT);return document.getElementById("transform-scale-x").value=s,this.updateScaleX(s/100),this._$positionX=e.pageX,1}return 0}updateBottomScaleY(e){const t=e.pageY-this._$positionY;if(t){const a=+document.getElementById("transform-scale-y").value,s=d.$clamp(a+t,d.MIN_INT,d.MAX_INT);return document.getElementById("transform-scale-y").value=s,this.updateScaleY(s/100),this._$positionY=e.pageY,1}return 0}initializeGridTarget(){this.hideGridTarget(),document.getElementById("grid-top-left").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$gridMode=1,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("grid-top-right").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$gridMode=2,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("grid-bottom-left").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$gridMode=3,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("grid-bottom-right").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$gridMode=4,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this))}initializeTransformTarget(){this.hideTransformTarget(),document.getElementById("scale-top-left").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$transformMode=1,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("scale-center-left").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$transformMode=2,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("scale-bottom-left").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$transformMode=3,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("scale-center-top").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$transformMode=4,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("scale-top-right").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$transformMode=5,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("scale-center-right").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$transformMode=6,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("scale-bottom-right").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$transformMode=7,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("scale-center-bottom").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$transformMode=8,this._$positionX=e.pageX,this._$positionY=e.pageY}.bind(this)),document.getElementById("target-rotation").addEventListener("mousedown",function(e){this._$objectClicked=!0,this._$transformMode=9;const t=document.getElementById("scale-bottom-right");this._$baseX=t.offsetLeft,this._$baseY=t.offsetTop,this._$baseRotate=0|document.getElementById("transform-rotate").value,this._$positionX=e.pageX,this._$positionY=e.pageY,d.$setCursor("ew-resize")}.bind(this))}initPlace(e,t,a){let s=a;for(;;){if("key-frame"===document.getElementById(`${t}-${s}`).dataset.frameState){e._$places.has(s)||e.setPlace(s,e.clonePlace(s,s));break}s--}}clearFrames(e,t,a){const s=e.id;for(let r=t;a>r;++r){const t=document.getElementById(`${s}-${r}`);switch(t.dataset.frameState){case"key-frame":{const a=["empty-key-frame"];t.classList.remove("key-frame","tween-frame","tween-key-frame","morph-frame","morph-key-frame"),t.classList.add("empty-key-frame"),t.classList.contains("key-frame-join")&&(t.classList.remove("key-frame-join"),t.classList.add("empty-key-frame-join"),a.push("empty-key-frame-join")),t.dataset.frameState="empty-key-frame",e._$frame.setClasses(r,a)}break;case"key-space-frame":t.classList.remove("key-space-frame"),t.classList.remove("tween-frame","morph-frame"),t.classList.add("empty-space-frame"),t.dataset.frameState="empty-space-frame",e._$frame.setClasses(r,["empty-space-frame"]);break;case"key-space-frame-end":t.classList.remove("key-space-frame-end","tween-frame","tween-frame-end","morph-frame","morph-frame-end"),t.classList.add("empty-space-frame-end"),t.dataset.frameState="empty-space-frame-end",e._$frame.setClasses(r,["empty-space-frame-end"])}}this.clearTweenMarker()}initializeTab(){for(let e=0;e<d.$workSpaces.length;++e)this.addTab(d.$workSpaces[e],e);document.getElementById("view-tab-add").addEventListener("click",function(){const e=d.$workSpaces.length,t=new O;d.$workSpaces.push(t),this.addTab(t,e),d.$updated=!0}.bind(this));document.getElementById("view-tab-list").addEventListener("mousedown",function(e){const t=document.getElementById("tab-name-menu");if(this._$menuMode)this._$menuMode=!1,t.classList.contains("fadeIn")&&t.setAttribute("class","fadeOut");else{this._$menuMode=!0;const a=e.currentTarget;t.style.left=`${a.offsetLeft+a.offsetWidth}px`,t.style.top=`${a.offsetTop+10}px`,t.setAttribute("class","fadeIn"),d.$endMenu("tab-name-menu")}}.bind(this)),document.body.addEventListener("click",function(e){if(!this._$menuMode)return;let t=e.target;switch(t.id){case"view-tab-list":case"tab-name-menu":return;default:for(;;){if(t=t.parentNode,!t){this._$menuMode=!1;const e=document.getElementById("tab-name-menu");e.classList.contains("fadeIn")&&e.setAttribute("class","fadeOut");break}if("tab-name-menu"===t.id)break}}}.bind(this))}addTab(e,t){e.name||(e.name=`Untitled-${t+1}`);const a=`\n<div draggable="true" id="tab-id-${t}" data-tab-id="${t}" class="tab">\n    <p id="tab-text-id-${t}" data-tab-id="${t}" data-detail="{{タブの移動・名前を変更}}">${e.name}</p>\n    <input type="text" id="tab-input-id-${t}" data-tab-id="${t}" value="${e.name}">\n    <i id="tab-delete-id-${t}" data-tab-id="${t}" data-detail="{{プロジェクトを閉じる}}"></i>\n</div>`;document.getElementById("view-tab-area").insertAdjacentHTML("beforeend",a);const s=document.getElementById(`tab-id-${t}`);d.$addModalEvent(s),d.$activeWorkSpaceId===t?s.classList.add("active"):s.classList.add("disable"),s.addEventListener("click",(function(e){const t=0|e.currentTarget.dataset.tabId,a=document.getElementById(`tab-id-${t}`);if(a){const e=document.getElementById(`tab-id-${d.$activeWorkSpaceId}`);e.classList.remove("active"),e.classList.add("disable"),a.classList.remove("disable"),a.classList.add("active"),d.$activeWorkSpaceId!==t&&d.$changeWorkSpace(t)}})),s.addEventListener("dragstart",function(e){this._$dropTab=e.currentTarget}.bind(this)),s.addEventListener("dragover",(function(e){e.preventDefault();const t=e.currentTarget;t.classList.contains("drop-target")||t.classList.add("drop-target")})),s.addEventListener("dragleave",(function(e){e.preventDefault(),e.currentTarget.classList.remove("drop-target")})),s.addEventListener("drop",function(e){e.preventDefault(),e.currentTarget.classList.remove("drop-target");const t=e.currentTarget.nextElementSibling,a=document.getElementById("view-tab-area");this._$dropTab===t?a.insertBefore(this._$dropTab,e.currentTarget):a.insertBefore(this._$dropTab,t),this._$dropTab=null}.bind(this));document.getElementById(`tab-delete-id-${t}`).addEventListener("click",function(e){const t=d.$currentLanguage.replace("{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}");if(!window.confirm(t))return;const a=0|e.currentTarget.dataset.tabId;d.$workSpaces[a]=null,document.getElementById(`tab-id-${a}`).remove(),document.getElementById(`tab-menu-id-${a}`).remove();const s=document.getElementById("library-preview-area");for(;s.children.length;)s.children[0].remove();const r=document.getElementById("view-tab-area");if(r.children.length){if(d.$activeWorkSpaceId===a){const e=r.children[0];e.setAttribute("class","tab active"),d.$activeWorkSpaceId=0|e.dataset.tabId,d.$currentWorkSpace().run()}}else{d.$workSpaces.length=0,d.$activeWorkSpaceId=0;const e=new O;d.$workSpaces.push(e),this.addTab(e,0),e.run();r.children[0].setAttribute("class","tab active")}}.bind(this));document.getElementById(`tab-text-id-${t}`).addEventListener("dblclick",(function(e){d.$keyLock=!0;const t=e.currentTarget,a=0|t.dataset.tabId,s=document.getElementById(`tab-input-id-${a}`);if("none"===s.style.display){s.style.width=`${t.offsetWidth}px`,s.style.display="",t.style.display="none",s.focus();document.getElementById(`tab-id-${a}`).draggable=!1}}));const r=document.getElementById(`tab-input-id-${t}`);r.style.display="none";const i=function(e){if("focusout"===e.type||"Enter"===e.code){const t=e.currentTarget;t.style.display="none";const a=0|t.dataset.tabId,s=document.getElementById(`tab-text-id-${a}`),r=document.getElementById(`tab-menu-id-${a}`);d.$workSpaces[a].name=t.value,r.textContent=t.value,s.textContent=t.value,s.style.display="";document.getElementById(`tab-id-${a}`).draggable=!0}};r.addEventListener("focusout",i),r.addEventListener("keypress",i);const n=`\n<div id="tab-menu-id-${t}" data-tab-id="${t}">${e.name}</div>\n        `;document.getElementById("tab-name-menu-list").insertAdjacentHTML("beforeend",n);document.getElementById(`tab-menu-id-${t}`).addEventListener("click",function(e){const t=0|e.currentTarget.dataset.tabId,a=document.getElementById(`tab-id-${t}`),s=document.getElementById(`tab-id-${d.$activeWorkSpaceId}`);s.classList.remove("active"),s.classList.add("disable"),a.classList.remove("disable"),a.classList.add("active");const r=document.getElementById("view-tab-area");a.remove(),r.prepend(a),this._$menuMode=!1,document.getElementById("tab-name-menu").setAttribute("class","fadeOut"),d.$activeWorkSpaceId!==t&&d.$changeWorkSpace(t)}.bind(this))}executeTween(e,t=!1){const a=0|document.getElementById("current-frame").textContent;let s=a;for(;s>1;){if(document.getElementById(`${e.id}-${s}`).classList.contains("key-frame"))break;--s}let r=a;for(;;){++r;const t=document.getElementById(`${e.id}-${r}`);if(!t.classList.contains("tween-frame")||t.classList.contains("key-frame")){--r;break}if(t.classList.contains("key-space-frame-end"))break}const i=e.getActiveCharacter(a);if(!i.length)return;const n=i[0];for(let e=s;e<=r;++e)n.hasPlace(e)||n.setPlace(e,n.clonePlace(r,e));const o=d.$currentWorkSpace().getLibrary(n.libraryId).createInstance(),l=o.width/2,c=o.height/2,h=o.getBounds(),m=[1,0,0,1,-l-h.x,-c-h.y],u=n.getPlace(s),f=u.matrix,g=Math.sqrt(f[0]*f[0]+f[1]*f[1]),y=Math.sqrt(f[2]*f[2]+f[3]*f[3]);let $=Math.atan2(f[1],f[0])*d.$Rad2Deg;0>$&&($+=360);const p=d.$multiplicationMatrix([f[0],f[1],f[2],f[3],0,0],m),b=f[4]-(p[4]+l+h.x),_=f[5]-(p[5]+c+h.y),v=n.getPlace(r),I=v.matrix,k=Math.sqrt(I[0]*I[0]+I[1]*I[1]),E=Math.sqrt(I[2]*I[2]+I[3]*I[3]);let S=Math.atan2(I[1],I[0])*d.$Rad2Deg;0>S&&(S+=360);const L=d.$multiplicationMatrix([I[0],I[1],I[2],I[3],0,0],m),x=I[4]-(L[4]+l+h.x),w=I[5]-(L[5]+c+h.y);n._$tween.has(s)||n._$tween.set(s,{method:"linear",curve:[]}),t&&(n._$tween.get(s).method=document.getElementById("ease-select").value);const M=n._$tween.get(s),B=M.method,T=r-s;s++;const C=x-b,A=w-_,F=k-g,U=E-y,O=S-$,X=u.colorTransform,Y=v.colorTransform,P=Y[0]-X[0],D=Y[1]-X[1],R=Y[2]-X[2],j=Y[3]-X[3],N=Y[4]-X[4],z=Y[5]-X[5],W=Y[6]-X[6],G=Y[7]-X[7],{Easing:H}=window.next2d.ui;let Z=1;for(let e=s;e<r;++e){const t=n.getPlace(e);if(t.fixed)continue;const a=t.matrix,s=H[B](Z,g,F,T),r=H[B](Z,y,U,T),i=H[B](Z,$,O,T)%360;let o=Math.atan2(a[1],a[0]),u=Math.atan2(-a[2],a[3]);const f=i*d.$Deg2Rad;if(u=u+f-o,o=f,a[0]=s*Math.cos(o),a[1]=s*Math.sin(o),a[2]=-r*Math.sin(u),a[3]=r*Math.cos(u),a[4]=H[B](Z,b,C,T),a[5]=H[B](Z,_,A,T),M.curve.length){const e=Math.sqrt(Math.pow(C,2)+Math.pow(A,2)),t=Math.sqrt(Math.pow(a[4]-b,2)+Math.pow(a[5]-_,2));if(t&&e){const s=d.$getCurvePoint(t/e,b,_,x,w,M.curve);s&&(a[4]=s.x,a[5]=s.y)}}const p=d.$multiplicationMatrix([a[0],a[1],a[2],a[3],0,0],m);a[4]+=p[4]+l+h.x,a[5]+=p[5]+c+h.y;const v=t.colorTransform;v[0]=d.$clamp(H[B](Z,X[0],P,T),d.COLOR_MIN_MULTIPLIER,d.COLOR_MAX_MULTIPLIER),v[1]=d.$clamp(H[B](Z,X[1],D,T),d.COLOR_MIN_MULTIPLIER,d.COLOR_MAX_MULTIPLIER),v[2]=d.$clamp(H[B](Z,X[2],R,T),d.COLOR_MIN_MULTIPLIER,d.COLOR_MAX_MULTIPLIER),v[3]=d.$clamp(H[B](Z,X[3],j,T),d.COLOR_MIN_MULTIPLIER,d.COLOR_MAX_MULTIPLIER),v[4]=d.$clamp(H[B](Z,X[4],N,T),d.COLOR_MIN_OFFSET,d.COLOR_MAX_OFFSET),v[5]=d.$clamp(H[B](Z,X[5],z,T),d.COLOR_MIN_OFFSET,d.COLOR_MAX_OFFSET),v[6]=d.$clamp(H[B](Z,X[6],W,T),d.COLOR_MIN_OFFSET,d.COLOR_MAX_OFFSET),v[7]=d.$clamp(H[B](Z,X[7],G,T),d.COLOR_MIN_OFFSET,d.COLOR_MAX_OFFSET),Z++}const V=u.filter,K=v.filter;if(V.length&&K.length){const e=["blurX","blurY","quality","color","alpha","distance","angle","highlightColor","highlightAlpha","shadowColor","shadowAlpha","strength"],t=V.length;for(let a=0;a<t;++a){const t=V[a],i=K[a];if(t.name!==i.name)continue;let o=1;for(let l=s;r>l;++l){const s=n.getPlace(l).filter;s[a]||(s[a]=new d.$filterClasses[t.name]);const r=s[a];for(let a=0;a<e.length;++a){const s=e[a];s in r&&(r[s]=H[B](o,t[s],i[s]-t[s],T))}o++}}}n._$image=null}addTarget(e,t=0,a=0,s=!1){if(s)for(let t=0;t<this._$moveTargets.length;++t){if(this._$moveTargets[t].target===e)return}this._$moveTargets.push({target:e,moveX:t,moveY:a}),d.$canCopyCharacter=!0,this.activeFrame(e),this.setTransformTarget()}setTransformTarget(){this.showTransformTarget(),this.placeTransformTarget()}placeTransformTarget(){if(!this._$moveTargets.length)return;const e=d.$currentWorkSpace().scene;let t=Number.MAX_VALUE,a=-Number.MAX_VALUE,s=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<this._$moveTargets.length;++i){const n=this._$moveTargets[i].target,o=e.getLayer(0|n.dataset.layerId);if(!o||o.lock||o.disable)continue;const l=0|n.dataset.characterId,c=document.getElementById(`character-${l}`);if(!c)continue;const d=c.offsetLeft,h=c.offsetTop;t=Math.min(t,d),a=Math.max(a,d+c.offsetWidth),s=Math.min(s,h),r=Math.max(r,h+c.offsetHeight)}const i=a-t,n=r-s,o=document.getElementById("target-rect");o.style.width=i-2+"px",o.style.height=n-2+"px",o.style.left=`${t}px`,o.style.top=`${s}px`;const l=document.getElementById("scale-top-left");l.style.left=t-5+"px",l.style.top=s-5+"px";const c=document.getElementById("scale-top-right");c.style.left=a-4+"px",c.style.top=s-5+"px";const h=document.getElementById("scale-bottom-left");h.style.left=t-5+"px",h.style.top=r-5+"px";const m=document.getElementById("scale-bottom-right");m.style.left=a-4+"px",m.style.top=r-4+"px";const u=document.getElementById("target-rotation");u.style.left=`${a+5}px`,u.style.top=`${r+5}px`;const f=document.getElementById("scale-center-left");f.style.left=t-5+"px",f.style.top=s+n/2-5+"px";const g=document.getElementById("scale-center-top");g.style.left=t+i/2-5+"px",g.style.top=s-5+"px";const y=document.getElementById("scale-center-right");y.style.left=a-4+"px",y.style.top=s+n/2-6+"px";const $=document.getElementById("scale-center-bottom");$.style.left=t+i/2-5+"px",$.style.top=r-4+"px"}placeGridTarget(){if(1!==this._$moveTargets.length)return void this.hideGridTarget();const e=this._$moveTargets[0].target,t=0|e.dataset.characterId,a=document.getElementById(`character-${t}`);if(!a)return void this.hideGridTarget();const s=d.$currentWorkSpace(),r=s.getLibrary(0|e.dataset.libraryId);if(!r||"shape"!==r.type)return void this.hideGridTarget();const i=r._$grid;if(!i)return void this.hideGridTarget();const n=0|e.dataset.layerId,o=s.scene.getLayer(n).getCharacter(0|e.dataset.characterId);if(o.rotation)return void this.hideGridTarget();const l=o.getBounds(),c=o.width-Math.abs(l.xMax-l.xMin),h=o.height-Math.abs(l.yMax-l.yMin),m=a.offsetLeft,u=a.offsetTop,f=document.getElementById("grid-top-left");f.style.left=m+i.x-4+"px",f.style.top=u+i.y-4+"px";const g=document.getElementById("grid-top-right");g.style.left=m+i.x+i.w+c-4+"px",g.style.top=u+i.y-4+"px";const y=document.getElementById("grid-bottom-left");y.style.left=m+i.x-4+"px",y.style.top=u+i.y+i.h+h-4+"px";const $=document.getElementById("grid-bottom-right");$.style.left=m+i.x+i.w+c-4+"px",$.style.top=u+i.y+i.h+h-4+"px"}showGridTarget(){for(let e=0;e<d.$gridTargets.length;++e)document.getElementById(d.$gridTargets[e]).style.display=""}hideGridTarget(){for(let e=0;e<d.$gridTargets.length;++e)document.getElementById(d.$gridTargets[e]).style.display="none"}showTransformTarget(){for(let e=0;e<d.$transformTargets.length;++e)document.getElementById(d.$transformTargets[e]).style.display=""}hideTransformTarget(){for(let e=0;e<d.$transformTargets.length;++e)document.getElementById(d.$transformTargets[e]).style.display="none"}updateWidth(e){const t=d.$currentWorkSpace().scene,a=0|document.getElementById("current-frame").textContent;if(this._$moveTargets.length>1){let s=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let e=0;e<this._$moveTargets.length;++e){const o=this._$moveTargets[e].target,l=0|o.dataset.layerId,c=t.getLayer(l),h=0|o.dataset.characterId,m=c.getCharacter(h),u=m.getPlace(a),f=d.$boundsMatrix(m.getBounds(),u.matrix);s=Math.min(s,f.xMin),r=Math.max(r,f.xMax),i=Math.min(i,f.yMin),n=Math.max(n,f.yMax)}this.updateScaleX(e/Math.abs(r-s))}else{const a=this._$moveTargets[0].target,s=0|a.dataset.layerId,r=t.getLayer(s),i=0|a.dataset.characterId,n=r.getCharacter(i),o=n.getBounds();this.updateScaleX(e/Math.abs(o.xMax-o.xMin)),document.getElementById("transform-scale-x").value=100*n.scaleX}}updateHeight(e){const t=d.$currentWorkSpace().scene,a=0|document.getElementById("current-frame").textContent;if(this._$moveTargets.length>1){let s=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let e=0;e<this._$moveTargets.length;++e){const o=this._$moveTargets[e].target,l=0|o.dataset.layerId,c=t.getLayer(l),h=0|o.dataset.characterId,m=c.getCharacter(h),u=m.getPlace(a),f=d.$boundsMatrix(m.getBounds(),u.matrix);s=Math.min(s,f.xMin),r=Math.max(r,f.xMax),i=Math.min(i,f.yMin),n=Math.max(n,f.yMax)}this.updateScaleY(e/Math.abs(n-i))}else{const a=this._$moveTargets[0].target,s=0|a.dataset.layerId,r=t.getLayer(s),i=0|a.dataset.characterId,n=r.getCharacter(i),o=n.getBounds();this.updateScaleY(e/Math.abs(o.yMax-o.yMin)),document.getElementById("transform-scale-y").value=100*n.scaleY}}updateX(e){const t=d.$currentWorkSpace().scene,a=0|document.getElementById("current-frame").textContent;for(let s=0;s<this._$moveTargets.length;++s){const r=this._$moveTargets[s].target,i=0|r.dataset.layerId,n=t.getLayer(i),o=0|r.dataset.characterId,l=n.getCharacter(o);l.x+=e,l.screenX+=e,document.getElementById(`character-${o}`).style.left=`${d.$offsetLeft+l.screenX}px`,document.getElementById(`${i}-${a}`).classList.contains("tween-frame")&&(this.executeTween(n),this.createTweenMarker())}}updateY(e){const t=d.$currentWorkSpace().scene,a=0|document.getElementById("current-frame").textContent;for(let s=0;s<this._$moveTargets.length;++s){const r=this._$moveTargets[s].target,i=0|r.dataset.layerId,n=t.getLayer(i),o=0|r.dataset.characterId,l=n.getCharacter(o);l.y+=e,l.screenY+=e,document.getElementById(`character-${o}`).style.top=`${d.$offsetTop+l.screenY}px`,document.getElementById(`${i}-${a}`).classList.contains("tween-frame")&&(this.executeTween(n),this.createTweenMarker())}}updateScaleX(e){const t=d.$currentWorkSpace(),a=t.scene,s=0|document.getElementById("current-frame").textContent;let r=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,l=Number.MAX_VALUE,c=-Number.MAX_VALUE;if(this._$moveTargets.length>1){let t=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let e=0;e<this._$moveTargets.length;++e){const n=this._$moveTargets[e].target,o=0|n.dataset.layerId,l=a.getLayer(o),c=0|n.dataset.characterId,m=l.getCharacter(c),u=d.$boundsMatrix(m.getBounds(),m.getPlace(s).matrix);t=Math.min(t,u.xMin),r=Math.max(r,u.xMax),i=Math.min(i,u.yMin),h=Math.max(h,u.yMax)}const m=Math.abs(r-t)/2,u=Math.abs(h-i)/2,f=d.$multiplicationMatrix([e,0,0,1,0,0],[1,0,0,1,-m-t,-u-i]);for(let e=0;e<this._$moveTargets.length;++e){const r=this._$moveTargets[e].target,h=0|r.dataset.layerId,g=a.getLayer(h),y=0|r.dataset.characterId,$=g.getCharacter(y),p=$.getPlace(s),b=d.$multiplicationMatrix(f,p.matrix);p.matrix[0]=b[0],p.matrix[1]=b[1],p.matrix[2]=b[2],p.matrix[3]=b[3],p.matrix[4]=b[4]+m+t,p.matrix[5]=b[5]+u+i;const _=d.$boundsMatrix($.getBounds(),p.matrix);n=Math.min(n,_.xMin),o=Math.max(o,_.xMax),l=Math.min(l,_.yMin),c=Math.max(c,_.yMax),$._$image=null}document.getElementById("transform-scale-y").value=100,document.getElementById("transform-scale-x").value=100}else for(let h=0;h<this._$moveTargets.length;++h){const m=this._$moveTargets[h].target,u=0|m.dataset.layerId,f=a.getLayer(u),g=0|m.dataset.characterId,y=f.getCharacter(g),$=t.getLibrary(y.libraryId).createInstance().getBounds(),p=y.getBounds(),b=Math.abs(p.xMax-p.xMin)/2,_=Math.abs(p.yMax-p.yMin)/2,v=y.getPlace(s),I=[1,0,0,1,-b-$.x,-_-$.y],k=d.$multiplicationMatrix([v.matrix[0],v.matrix[1],v.matrix[2],v.matrix[3],b+$.x,_+$.y],I);y.x-=k[4],y.y-=k[5],y.scaleX=e;const E=d.$multiplicationMatrix([v.matrix[0],v.matrix[1],v.matrix[2],v.matrix[3],b+$.x,_+$.y],I);y.x+=E[4],y.y+=E[5],y._$image=null,r=Math.min(r,y.x),i=Math.min(i,y.y);const S=d.$boundsMatrix(y.getBounds(),v.matrix);n=Math.min(n,S.xMin),o=Math.max(o,S.xMax),l=Math.min(l,S.yMin),c=Math.max(c,S.yMax),document.getElementById(`${u}-${s}`).classList.contains("tween-frame")&&(this.executeTween(f),this.createTweenMarker())}document.getElementById("object-x").value=r,document.getElementById("object-y").value=i,document.getElementById("object-width").value=Math.abs(o-n),document.getElementById("object-height").value=Math.abs(c-l)}updateScaleY(e){const t=d.$currentWorkSpace(),a=t.scene,s=0|document.getElementById("current-frame").textContent;let r=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,l=Number.MAX_VALUE,c=-Number.MAX_VALUE;if(this._$moveTargets.length>1){let t=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let e=0;e<this._$moveTargets.length;++e){const n=this._$moveTargets[e].target,o=0|n.dataset.layerId,l=a.getLayer(o),c=0|n.dataset.characterId,m=l.getCharacter(c),u=d.$boundsMatrix(m.getBounds(),m.getPlace(s).matrix);t=Math.min(t,u.xMin),r=Math.max(r,u.xMax),i=Math.min(i,u.yMin),h=Math.max(h,u.yMax)}const m=Math.abs(r-t)/2,u=Math.abs(h-i)/2,f=d.$multiplicationMatrix([1,0,0,e,0,0],[1,0,0,1,-m-t,-u-i]);for(let e=0;e<this._$moveTargets.length;++e){const r=this._$moveTargets[e].target,h=0|r.dataset.layerId,g=a.getLayer(h),y=0|r.dataset.characterId,$=g.getCharacter(y),p=$.getPlace(s),b=d.$multiplicationMatrix(f,p.matrix);p.matrix[0]=b[0],p.matrix[1]=b[1],p.matrix[2]=b[2],p.matrix[3]=b[3],p.matrix[4]=b[4]+m+t,p.matrix[5]=b[5]+u+i;const _=d.$boundsMatrix($.getBounds(),p.matrix);n=Math.min(n,_.xMin),o=Math.max(o,_.xMax),l=Math.min(l,_.yMin),c=Math.max(c,_.yMax),$._$image=null}document.getElementById("transform-scale-y").value=100,document.getElementById("transform-scale-x").value=100}else for(let h=0;h<this._$moveTargets.length;++h){const m=this._$moveTargets[h].target,u=0|m.dataset.layerId,f=a.getLayer(u),g=0|m.dataset.characterId,y=f.getCharacter(g),$=t.getLibrary(y.libraryId).createInstance().getBounds(),p=y.getBounds(),b=Math.abs(p.xMax-p.xMin)/2,_=Math.abs(p.yMax-p.yMin)/2,v=y.getPlace(s),I=[1,0,0,1,-b-$.x,-_-$.y],k=d.$multiplicationMatrix([v.matrix[0],v.matrix[1],v.matrix[2],v.matrix[3],b+$.x,_+$.y],I);y.x-=k[4],y.y-=k[5],y.scaleY=e;const E=d.$multiplicationMatrix([v.matrix[0],v.matrix[1],v.matrix[2],v.matrix[3],b+$.x,_+$.y],I);y.x+=E[4],y.y+=E[5],y._$image=null,r=Math.min(r,y.x),i=Math.min(i,y.y);const S=d.$boundsMatrix(y.getBounds(),v.matrix);n=Math.min(n,S.xMin),o=Math.max(o,S.xMax),l=Math.min(l,S.yMin),c=Math.max(c,S.yMax),document.getElementById(`${u}-${s}`).classList.contains("tween-frame")&&(this.executeTween(f),this.createTweenMarker())}document.getElementById("object-x").value=r,document.getElementById("object-y").value=i,document.getElementById("object-width").value=Math.abs(o-n),document.getElementById("object-height").value=Math.abs(c-l)}updateRotate(e){const t=d.$currentWorkSpace(),a=t.scene,s=0|document.getElementById("current-frame").textContent;let r=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,l=Number.MAX_VALUE,c=-Number.MAX_VALUE;const h=this._$moveTargets.length>1;if(h){let t=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let e=0;e<this._$moveTargets.length;++e){const n=this._$moveTargets[e].target,o=0|n.dataset.layerId,l=a.getLayer(o),c=0|n.dataset.characterId,m=l.getCharacter(c),u=d.$boundsMatrix(m.getBounds(),m.getPlace(s).matrix);t=Math.min(t,u.xMin),r=Math.max(r,u.xMax),i=Math.min(i,u.yMin),h=Math.max(h,u.yMax)}const m=Math.abs(r-t)/2,u=Math.abs(h-i)/2,f=e*d.$Deg2Rad,g=d.$multiplicationMatrix([Math.cos(f),Math.sin(f),-Math.sin(f),Math.cos(f),0,0],[1,0,0,1,-m-t,-u-i]);for(let e=0;e<this._$moveTargets.length;++e){const r=this._$moveTargets[e].target,h=0|r.dataset.layerId,f=a.getLayer(h),y=0|r.dataset.characterId,$=f.getCharacter(y),p=$.getPlace(s),b=d.$multiplicationMatrix(g,p.matrix);p.matrix[0]=b[0],p.matrix[1]=b[1],p.matrix[2]=b[2],p.matrix[3]=b[3],p.matrix[4]=b[4]+m+t,p.matrix[5]=b[5]+u+i;const _=d.$boundsMatrix($.getBounds(),p.matrix);n=Math.min(n,_.xMin),o=Math.max(o,_.xMax),l=Math.min(l,_.yMin),c=Math.max(c,_.yMax),$._$image=null}}else for(let h=0;h<this._$moveTargets.length;++h){const m=this._$moveTargets[h].target,u=0|m.dataset.layerId,f=a.getLayer(u),g=0|m.dataset.characterId,y=f.getCharacter(g);if(y.rotation===e)return;const $=y.getBounds(),p=Math.abs($.xMax-$.xMin)/2,b=Math.abs($.yMax-$.yMin)/2,_=t.getLibrary(y.libraryId).createInstance().getBounds(),v=y.getPlace(s),I=[1,0,0,1,-p-_.x,-b-_.y],k=d.$multiplicationMatrix([v.matrix[0],v.matrix[1],v.matrix[2],v.matrix[3],p+_.x,b+_.y],I);y.x-=k[4],y.y-=k[5],y.rotation=e;const E=d.$multiplicationMatrix([v.matrix[0],v.matrix[1],v.matrix[2],v.matrix[3],p+_.x,b+_.y],I);y.x+=E[4],y.y+=E[5],y._$image=null;let S=y.scaleX;Math.atan2(v.matrix[1],v.matrix[0])>=Math.PI&&(S*=-1),document.getElementById("transform-scale-x").value=100*S,document.getElementById("transform-scale-y").value=100*y.scaleY,r=Math.min(r,y.x),i=Math.min(i,y.y);const L=d.$boundsMatrix(y.getBounds(),v.matrix);n=Math.min(n,L.xMin),o=Math.max(o,L.xMax),l=Math.min(l,L.yMin),c=Math.max(c,L.yMax),document.getElementById(`${u}-${s}`).classList.contains("tween-frame")&&(this.executeTween(f),this.createTweenMarker())}document.getElementById("object-x").value=r,document.getElementById("object-y").value=i,document.getElementById("object-width").value=Math.abs(o-n),document.getElementById("object-height").value=Math.abs(c-l),h&&(document.getElementById("transform-scale-y").value=100,document.getElementById("transform-scale-x").value=100)}updateColorMultiplier(e,t){const a=d.$currentWorkSpace().scene,s=0|document.getElementById("current-frame").textContent,r=this._$moveTargets[0].target,i=0|r.dataset.layerId,n=a.getLayer(i),o=0|r.dataset.characterId,l=n.getCharacter(o);l.getPlace(s).colorTransform[t]=d.$clamp(e,d.COLOR_MIN_MULTIPLIER,d.COLOR_MAX_MULTIPLIER)/100,l._$image=null,document.getElementById(`${i}-${s}`).classList.contains("tween-frame")&&(this.executeTween(n),this.createTweenMarker())}updateColorOffset(e,t){const a=d.$currentWorkSpace().scene,s=0|document.getElementById("current-frame").textContent,r=this._$moveTargets[0].target,i=0|r.dataset.layerId,n=a.getLayer(i),o=0|r.dataset.characterId,l=n.getCharacter(o);l.getPlace(s).colorTransform[t]=d.$clamp(0|e,d.COLOR_MIN_OFFSET,d.COLOR_MAX_OFFSET),l._$image=null,document.getElementById(`${i}-${s}`).classList.contains("tween-frame")&&(this.executeTween(n),this.createTweenMarker())}updateBlendMode(e){const t=d.$currentWorkSpace().scene,a=0|document.getElementById("current-frame").textContent,s=this._$moveTargets[0].target,r=0|s.dataset.layerId,i=t.getLayer(r),n=0|s.dataset.characterId,o=i.getCharacter(n);o.getPlace(a).blendMode=e,o._$image=null,t.changeFrame(a)}updateVideoVolume(e){const t=this._$moveTargets[0].target;d.$currentWorkSpace().getLibrary(0|t.dataset.libraryId).volume=0|e.value}updateShapeGrid(){const e=this._$moveTargets[0].target,t=d.$currentWorkSpace().getLibrary(0|e.dataset.libraryId),a=+document.getElementById("nine-slice-setting-x").value,s=+document.getElementById("nine-slice-setting-y").value,r=+document.getElementById("nine-slice-setting-w").value,i=+document.getElementById("nine-slice-setting-h").value;switch(0){case a:case s:t._$grid=null,this.hideGridTarget();break;default:t._$grid={x:a,y:s,w:r,h:i},this.showGridTarget(),this.placeGridTarget()}t.cacheClear()}updateText(e){const t=d.$currentWorkSpace(),a=t.scene,s=0|document.getElementById("current-frame").textContent,r=this._$moveTargets[0].target,i=0|r.dataset.layerId,n=a.getLayer(i),o=0|r.dataset.characterId,l=n.getCharacter(o);t.getLibrary(l.libraryId)[e.name]=e.value,l._$image=null,a.changeFrame(s)}activeFrame(e){const t=0|e.dataset.layerId,a=document.getElementById(`layer-id-${t}`),s=d.$timeline;s._$targetLayer&&s._$targetLayer.classList.remove("active"),a.classList.contains("active")||a.classList.add("active"),s._$targetLayer=a;const r=document.getElementById("current-frame").textContent,i=document.getElementById(`${t}-${r}`);i.classList.contains("frame-active")||(i.classList.add("frame-active"),s._$targetFrame=i,s._$targetFrames.push(i))}createTweenMarker(e=!0){const t=d.$timeline._$targetLayer;if(!t)return;const a=0|t.dataset.layerId,s=0|document.getElementById("current-frame").textContent;let r=s;for(;r>1;){if(document.getElementById(`${a}-${r}`).classList.contains("key-frame"))break;--r}let i=s;for(;;){++i;if(!document.getElementById(`${a}-${i}`).classList.contains("tween-frame"))break}const n=d.$currentWorkSpace().scene.getLayer(a).getActiveCharacter(s)[0],o=n._$tween.get(r),l=o.method,c=document.getElementById("ease-select").children;for(let e=0;e<c.length;++e){const t=c[e];if(t.value===l){t.selected=!0;break}}const h=document.getElementById("stage-area"),m=[];if(e){const e=h.children;for(let t=0;t<e.length;++t){const a=e[t];"tween"===a.dataset.child&&("true"!==a.dataset.curve&&m.push(a))}}if(!m.length)for(let e=r;e<i;++e)m.push(document.createElement("div"));const u=n.getBounds();let f=0;for(let t=r;t<i;++t){const a=m[f++];e||(h.appendChild(a),a.classList.add("tween-marker"),a.dataset.child="tween");const s=n.getPlace(t).matrix,r=d.$boundsMatrix(u,s),i=Math.abs(Math.ceil(r.xMax-r.xMin)/2),o=Math.abs(Math.ceil(r.yMax-r.yMin)/2);a.style.left=d.$offsetLeft+r.xMin+i-2+"px",a.style.top=d.$offsetTop+r.yMin+o-2+"px"}if(!e)for(let e=0;e<o.curve.length;++e){const t=o.curve[e],a=this.createTweenCurveElement(t,e);h.appendChild(a)}document.getElementById("ease-setting").style.display=""}createTweenCurveElement(e,t){const a=d.$timeline._$targetLayer;if(!a)return null;const s=0|a.dataset.layerId,r=document.createElement("div");r.classList.add("tween-pointer-marker","tween-pointer-disabled");const i=0|document.getElementById("current-frame").textContent;r.textContent=`${t+1}`,r.dataset.child="tween",r.dataset.curve="true",r.dataset.layerId=`${s}`,r.dataset.tweenIndex=`${i}`,r.dataset.index=`${t}`,r.dataset.detail="{{カーブポインター(ダブルクリックでON/OFF)}}";const n=d.$currentWorkSpace().scene.getLayer(s).getActiveCharacter(i)[0];if(!n)return null;const o=n.getPlace(i).matrix,l=n.getBounds(),c=d.$boundsMatrix(l,o),h=Math.abs(Math.ceil(c.xMax-c.xMin)/2),m=Math.abs(Math.ceil(c.yMax-c.yMin)/2);return r.style.left=`${d.$offsetLeft+e.x+l.xMin+h}px`,r.style.top=`${d.$offsetTop+e.y+l.yMin+m}px`,e.usePoint?(r.classList.remove("tween-pointer-disabled"),r.classList.add("tween-pointer-active")):(r.classList.add("tween-pointer-disabled"),r.classList.remove("tween-pointer-active")),r.addEventListener("mousedown",function(e){this._$tweenMode=!0,this._$tweenController=e.target,this._$tweenDelete=e.target,this._$rectPosition={x:e.pageX-e.target.offsetLeft,y:e.pageY-e.target.offsetTop},d.$timeline._$targetLayer||(d.$timeline._$targetLayer=document.getElementById(`layer-id-${e.target.dataset.layerId}`))}.bind(this)),r.addEventListener("dblclick",function(e){const t=e.target,a=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId),s=0|t.dataset.tweenIndex,r=a.getActiveCharacter(s)[0],i=r._$tween.get(r.startFrame).curve[t.dataset.index];i.usePoint=!i.usePoint,i.usePoint?(t.classList.remove("tween-pointer-disabled"),t.classList.add("tween-pointer-active")):(t.classList.add("tween-pointer-disabled"),t.classList.remove("tween-pointer-active")),d.$timeline._$targetLayer||(d.$timeline._$targetLayer=document.getElementById(`layer-id-${e.target.dataset.layerId}`)),this.executeTween(a),this.createTweenMarker();document.getElementById("timeline-onion-skin").classList.contains("onion-skin-active")&&d.$currentWorkSpace().scene.changeFrame(s)}.bind(this)),r.addEventListener("mouseover",(function(e){const t=d.$tools.getUserPublishSetting();if("modal"in t&&!t.modal)return;const a=document.getElementById("detail-modal");a.textContent=d.$currentLanguage.replace(e.currentTarget.dataset.detail),a.style.left=e.pageX-20+"px",a.style.top=`${e.pageY+20}px`,a.setAttribute("class","fadeIn"),a.dataset.timerId=setTimeout(function(){this.classList.contains("fadeOut")||this.setAttribute("class","fadeOut")}.bind(a),1500)})),r.addEventListener("mouseout",function(){this._$tweenDelete=null,d.$setCursor("auto");const e=d.$tools.getUserPublishSetting();if("modal"in e&&!e.modal)return;const t=document.getElementById("detail-modal");clearTimeout(0|t.dataset.timerId),t.setAttribute("class","fadeOut")}.bind(this)),r}addTweenPointer(){const e=d.$timeline._$targetLayer;if(!e)return;const t=0|e.dataset.layerId,a=0|document.getElementById("current-frame").textContent,s=d.$currentWorkSpace().scene.getLayer(t).getActiveCharacter(a);if(s.length>1)return;const r=s[0];if(!r._$tween.has(r.startFrame))return;const i=r._$tween.get(r.startFrame),n=i.curve.length,o=r.getPlace(r.startFrame).matrix,l=r.getBounds(),c=d.$boundsMatrix(l,o),h={usePoint:!0,x:c.xMin-l.xMin-5,y:c.yMin-l.yMin-5};i.curve.push(h);const m=this.createTweenCurveElement(h,n);m&&document.getElementById("stage-area").appendChild(m)}clearTweenMarker(){const e=document.getElementById("stage-area");let t=0;for(;e.children.length>t;){const a=e.children[t];"tween"===a.dataset.child?a.remove():t++}document.getElementById("ease-setting").style.display="none"}clearActiveFrame(e){const t=0|e.dataset.layerId,a=document.getElementById(`layer-id-${t}`);if(!a)return;a.classList.contains("active")&&a.classList.remove("active"),d.$timeline._$targetLayer=null;const s=0|document.getElementById("current-frame").textContent,r=document.getElementById(`${t}-${s}`);d.$timeline._$targetFrames.indexOf(r)>-1&&r.classList.contains("frame-active")&&r.classList.remove("frame-active")}clearActiveCharacter(){if(this._$moveTargets&&this._$moveTargets.length){for(let e=0;e<this._$moveTargets.length;++e){const t=this._$moveTargets[e].target;this.clearActiveFrame(t)}this._$moveTargets.length=0,this.hideTransformTarget(),this.hideGridTarget(),d.$controller.clearFilters()}}addTextField(e,t=0,a=0){const s=d.$currentWorkSpace().scene,r=0|d.$timeline._$targetLayer.dataset.layerId,i=s.getLayer(0|r);if(i.lock)return;d.$controller.createContainer("text",e.name,e.id);const n=d.$currentWorkSpace().addLibrary(e),o=0|document.getElementById("current-frame").textContent,l=document.getElementById(`${r}-${o}`);d.$timeline.dropKeyFrame(l);const c=new $;c.libraryId=n.id,c.startFrame=o,c.endFrame=i.getEndFrame(o+1),c.setPlace(o,{frame:o,matrix:[1,0,0,1,t,a],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:i._$characters.length}),i.addCharacter(c),this.appendCharacter(c,o,0|r,"none")}addShape(e,t=0,a=0){const s=d.$currentWorkSpace().scene,r=0|d.$timeline._$targetLayer.dataset.layerId,i=s.getLayer(0|r);if(i.lock)return;d.$controller.createContainer("shape",e.name,e.id);const n=d.$currentWorkSpace().addLibrary(e),o=0|document.getElementById("current-frame").textContent,l=document.getElementById(`${r}-${o}`);d.$timeline.dropKeyFrame(l);const c=new $;c.libraryId=n.id,c.startFrame=o,c.endFrame=i.getEndFrame(o+1),c.setPlace(o,{frame:o,matrix:[1,0,0,1,t,a],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:i._$characters.length}),i.addCharacter(c),this.appendCharacter(c,o,0|r,"none")}dropObject(e){const t=0|d.$dragElement.dataset.libraryId;switch(d.$currentWorkSpace().getLibrary(t).type){case"folder":case"sound":return}if(!d.$timeline._$targetLayer){const e=document.getElementById("timeline-content");if(!e.children.length)return;const t=e.children[0],a=document.getElementById(`${t.dataset.layerId}-1`);if(!a)return;d.$timeline._$targetLayer=a}const a=d.$currentWorkSpace().scene,s=0|d.$timeline._$targetLayer.dataset.layerId,r=a.getLayer(0|s);if(r.lock)return;const i=0|document.getElementById("current-frame").textContent,n=document.getElementById(`${s}-${i}`);if(n.classList.contains("tween-frame"))return;if(n.classList.contains("morph-frame"))return;d.$timeline.dropKeyFrame(n);const o=e.offsetX-d.$offsetLeft,l=e.offsetY-d.$offsetTop,c=r.getEndFrame(i+1),h={start:null,end:null},m=r._$characters;for(let e=0;e<m.length;++e){const a=m[e];if(a.libraryId===t)switch(!0){case i>1&&a.endFrame===i:h.start=a;break;case a.startFrame===c:h.end=a}}const u={frame:i,matrix:[1,0,0,1,o,l],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:r._$characters.length};let f=null;if(h.start&&(f=h.start,f.endFrame=c),h.end)if(f){f.endFrame=h.end.endFrame;for(let[e,t]of h.end._$places)f.setPlace(e,t);r.deleteCharacter(h.end.id)}else f=h.end,f.startFrame=i;if(f){f.setPlace(i,u);let e=f.width;e||(e=10);let t=f.height;t||(t=10);const a=f.getBounds();u.matrix[4]-=a.xMin+e/2,u.matrix[5]-=a.yMin+t/2}else{f=new $,f.libraryId=t,f.startFrame=i,f.endFrame=c,f.setPlace(i,u);let e=f.width;e||(e=10);let a=f.height;a||(a=10);const n=f.getBounds();u.matrix[4]-=n.xMin+e/2,u.matrix[5]-=n.yMin+a/2,r.addCharacter(f),this.appendCharacter(f,i,0|s)}a.changeFrame(i),d.$controller._$libraryTarget&&(d.$controller._$libraryTarget.classList.remove("active"),d.$controller._$libraryTarget=null)}appendOnionCharacter(e,t){const a=d.$currentWorkSpace().scene,s=e.image.cloneNode(!0);s.style.left=`${e.offsetX}px`,s.style.top=`${e.offsetY}px`;const r=document.createElement("div");r.dataset.child="true",r.appendChild(s);const i=a.getLayer(t);if(null!==i.maskId){const t=a.getLayer(i.maskId);if(t||(i.maskId=null),t&&t.lock&&t._$characters.length){const a=t._$characters[0],s=a.image,i=a.screenX-e.screenX,n=a.screenY-e.screenY;r.style.webkitMask=`url(${s.src}), none`,r.style.webkitMaskSize=`${s.width}px ${s.height}px`,r.style.webkitMaskRepeat="no-repeat",r.style.webkitMaskPosition=`${i}px ${n}px`}else r.style.webkitMask="",r.style.webkitMaskSize="",r.style.webkitMaskRepeat="",r.style.webkitMaskPosition=""}r.style.position="absolute",r.style.left=`${d.$offsetLeft+e.screenX}px`,r.style.top=`${d.$offsetTop+e.screenY}px`,r.style.pointerEvents="none",r.style.opacity="0.25",document.getElementById("stage-area").appendChild(r)}appendCharacter(e,t,a,s="auto"){const r=d.$currentWorkSpace(),i=r.scene,n=e.getPlace(t),o=r.getLibrary(e.libraryId);if(n!==e._$currentPlace){let t=!e._$currentPlace;if(e._$currentPlace){const a=n.matrix,s=e._$currentPlace.matrix;switch(!0){case a[0]!==s[0]:case a[1]!==s[1]:case a[2]!==s[2]:case a[3]!==s[3]:t=!0;break;default:e._$screenX+=-s[4]+a[4],e._$screenY+=-s[5]+a[5]}if(!t){const a=n.colorTransform,s=e._$currentPlace.colorTransform;switch(!0){case a[0]!==s[0]:case a[1]!==s[1]:case a[2]!==s[2]:case a[3]!==s[3]:case a[4]!==s[4]:case a[5]!==s[5]:case a[6]!==s[6]:case a[7]!==s[7]:t=!0}}if(t||n.blendMode===e._$currentPlace.blendMode||(t=!0),!t&&(e._$currentPlace.filter.length!==n.filter.length&&(t=!0),!t))for(let a=0;a<n.filter.length;++a){const s=n.filter[a],r=e._$currentPlace[a];if(!s||!r){t=!0;break}if(r.constructor!==s.constructor){t=!0;break}if(!r.isSame(s)){t=!0;break}}}e._$currentPlace=n,t&&(e._$image=null)}const l=e.image;l.style.left=`${e.offsetX}px`,l.style.top=`${e.offsetY}px`;const c=document.createElement("div");c.appendChild(l);const h=i.getLayer(a);if(null!==h.maskId){const t=i.getLayer(h.maskId);if(t||(h.maskId=null),t&&t.lock&&t._$characters.length){const a=t._$characters[0],s=a.image,r=a.screenX-e.screenX,i=a.screenY-e.screenY;c.style.webkitMask=`url(${s.src}), none`,c.style.webkitMaskSize=`${s.width}px ${s.height}px`,c.style.webkitMaskRepeat="no-repeat",c.style.webkitMaskPosition=`${r}px ${i}px`,c.style.mixBlendMode=l.style.mixBlendMode,c.style.filter=l.style.filter}else c.style.webkitMask="",c.style.webkitMaskSize="",c.style.webkitMaskRepeat="",c.style.webkitMaskPosition="",c.style.mixBlendMode="",c.style.filter=""}c.id=`character-${e.id}`,c.dataset.characterId=`${e.id}`,c.dataset.layerId=`${a}`,c.dataset.instanceType=o.type,c.dataset.libraryId=`${e.libraryId}`,c.dataset.child="true";let m=d.$offsetLeft+e.screenX,u=d.$offsetTop+e.screenY;c.style.position="absolute",c.style.left=`${m}px`,c.style.top=`${u}px`;let f=e.width;f||(f=10);let g=e.height;switch(g||(g=10),c.style.width=`${f}px`,c.style.height=`${g}px`,c.style.pointerEvents=s,c.addEventListener("contextmenu",function(e){this._$objectClicked=!0;const t=document.getElementById("screen-menu");t.style.left=`${e.pageX+5}px`,t.style.top=e.pageY-t.clientHeight/2+"px",0>t.offsetTop&&(t.style.top="10px"),e.pageY+t.clientHeight/2>window.innerHeight&&(t.style.top=window.innerHeight-e.pageY+"px"),t.setAttribute("class","fadeIn"),d.$endMenu("screen-menu")}.bind(this)),c.addEventListener("mouseover",function(e){if(d.$tools._$activeTool&&"arrow"!==d.$tools._$activeTool.dataset.name)return;if(this._$moveMode)return;const t=0|e.currentTarget.dataset.layerId;document.getElementById(`layer-lock-icon-${t}`).classList.contains("icon-active")||d.$setCursor("move")}.bind(this)),c.addEventListener("mouseout",(function(){d.$tools._$activeTool&&"arrow"!==d.$tools._$activeTool.dataset.name||d.$setCursor("auto")})),c.addEventListener("mousedown",function(e){if(d.$endMenu(),d.$tools._$activeTool)switch(d.$tools._$activeTool.dataset.name){case"arrow":case"transform":break;default:return}this._$objectClicked=!0;const t=e.currentTarget,a=0|t.dataset.layerId;if("transform"===d.$tools._$activeTool.dataset.name&&"shape"===t.dataset.instanceType){this._$shapeTransformMode=!0,this.clearActiveCharacter();const a=0|document.getElementById("current-frame").textContent,s=d.$currentWorkSpace(),r=0|t.dataset.layerId,i=0|t.dataset.characterId,n=s.scene.getLayer(r).getCharacter(i),o=s.getLibrary(0|t.dataset.libraryId),l=n.getPlace(a).matrix,c=d.$hitColor;return o.setHitColor(e.offsetX,e.offsetY,l),void(d.$hitColor?o.createPointer(l,r,i):d.$hitColor=c)}if(this._$shapeTransformMode)return;if(document.getElementById(`layer-lock-icon-${a}`).classList.contains("icon-active"))return;const s=0|document.getElementById("current-frame").textContent;let r=d.$timeline._$targetFrame;if(r)switch(r.dataset.frameState){case"empty":case"empty-key-frame":case"empty-space-frame":case"empty-space-frame-end":this.clearActiveFrame(r)}else r=document.getElementById(`${a}-${s}`);if(this._$moveMode=!0,this._$multiMode){let e=!1;for(let a=0;a<this._$moveTargets.length;++a){if(this._$moveTargets[a].target===t){this._$moveTargets.splice(a,1),this.clearActiveFrame(t),e=!0;break}}if(!this._$moveTargets.length)return void d.$controller.hideObjectArea();e||this.addTarget(t),r.classList.contains("tween-frame")&&this.clearTweenMarker()}else{let i=!0;for(let a=0;a<this._$moveTargets.length;++a){const s=this._$moveTargets[a];s.target===t&&(i=!1),s.moveX=e.pageX-s.target.offsetLeft,s.moveY=e.pageY-s.target.offsetTop}i&&(this.clearActiveCharacter(),this.addTarget(t,e.pageX-t.offsetLeft,e.pageY-t.offsetTop));const n=d.$currentWorkSpace(),o=n.scene.getLayer(a);r.classList.contains("tween-frame")&&(this.clearTweenMarker(),this.executeTween(o),this.createTweenMarker(!1));const l=o.getCharacter(0|t.dataset.characterId);document.getElementById("object-name").value=l.name;const c=n.getLibrary(l.libraryId);if("shape"===c.type){const t=l.getPlace(s).matrix;c.setHitColor(e.offsetX,e.offsetY,t)}}this.updatePropertyArea(!1),this._$saved=!1}.bind(this)),o._$type){case"container":c.addEventListener("dblclick",(function(e){const t=d.$currentWorkSpace();t.scene.addSceneName(),document.getElementById("current-frame").textContent="1",document.getElementById("timeline-marker").style.left="0px";document.getElementById("timeline-controller-base").scrollLeft&&d.$timeline.moveTimeLine(0),t.scene=t.getLibrary(0|e.currentTarget.dataset.libraryId)}));break;case"text":{const e=document.createElement("div");e.style.width=f-2+"px",e.style.height=g-2+"px",e.style.pointerEvents="none",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.border=o._$border?"1px solid gray":"1px dashed gray",c.appendChild(e),c.addEventListener("dblclick",function(e){this._$inputMode=!0,this._$objectClicked=!0,this.hideTransformTarget(),this.hideGridTarget();const t=document.getElementById("stage-area").children;for(let e=0;e<t.length;++e){t[e].style.pointerEvents="none"}const s=e.currentTarget;s.style.pointerEvents="";const i=s.firstChild;i.remove();const n=window.document.createElement("textarea");s.style.display="none",s.parentNode.appendChild(n);const o=d.$currentWorkSpace().scene,l=0|s.dataset.layerId,c=o.getLayer(l),h=0|s.dataset.characterId,m=c.getCharacter(h),u=r.getLibrary(m.libraryId);n.value=u._$text,n.style.border=u._$border?"1px solid gray":"1px dashed gray",n.style.fontSize=`${u._$size}px`,n.style.fontFamily=u._$font,n.style.width=i.width-4+"px",n.style.height=`${i.height}px`,n.style.position="absolute",n.style.left=s.style.left,n.style.top=s.style.top,n.style.pointerEvents="auto",u._$border||(n.style.backgroundColor="transparent"),n.dataset.characterId=`${m.id}`,n.dataset.layerId=`${a}`,n.dataset.libraryId=`${m.libraryId}`,n.dataset.child="true",u._$multiline||n.addEventListener("keydown",(function(e){if("Enter"===e.code)return e.preventDefault(),!1})),n.addEventListener("focusin",(function(){d.$keyLock=!0})),n.addEventListener("focusout",function(e){const t=e.target,a=d.$currentWorkSpace().scene,s=0|t.dataset.layerId,i=a.getLayer(s),n=0|t.dataset.characterId,o=i.getCharacter(n);r.getLibrary(o.libraryId)._$text=t.value,o._$image=null,d.$keyLock=!1,this._$inputMode=!1;const l=document.getElementById("stage-area").children;for(let e=0;e<l.length;++e){l[e].style.pointerEvents=""}const c=0|document.getElementById("current-frame").textContent;a.changeFrame(c)}.bind(this)),n.focus()}.bind(this))}}document.getElementById("stage-area").appendChild(c)}updatePropertyArea(e=!0){const t=d.$currentWorkSpace(),a=t.scene,s=0|document.getElementById("current-frame").textContent;let r=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,l=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let e=0;e<this._$moveTargets.length;++e){const t=this._$moveTargets[e].target,h=0|t.dataset.layerId,m=a.getLayer(h),u=0|t.dataset.characterId,f=m.getCharacter(u);r=Math.min(r,f.x),i=Math.min(i,f.y);const g=f.getPlace(s).matrix,y=d.$boundsMatrix(f.getBounds(),g);n=Math.min(n,y.xMin),o=Math.max(o,y.xMax),l=Math.min(l,y.yMin),c=Math.max(c,y.yMax)}if(d.$controller.showObjectArea(),d.$controller.hideStageSetting(),document.getElementById("object-width").value=Math.abs(o-n),document.getElementById("object-height").value=Math.abs(c-l),document.getElementById("object-x").value=r,document.getElementById("object-y").value=i,this._$moveTargets.length>1)d.$controller.hideObjectSetting(["object-setting","color-setting","blend-setting","filter-setting","video-setting","instance-setting","text-setting","fill-color-setting","nine-slice-setting"]),document.getElementById("transform-scale-x").value=100,document.getElementById("transform-scale-y").value=100,document.getElementById("transform-rotate").value=0;else{const r=this._$moveTargets[0].target,i=0|r.dataset.layerId,n=a.getLayer(i),o=0|r.dataset.characterId,l=n.getCharacter(o),c=t.getLibrary(l.libraryId);d.$controller.showObjectSetting(["object-setting","color-setting","blend-setting","filter-setting","instance-setting"]);const h=document.getElementById("instance-type-name");for(;h.children.length;)h.children[0].remove();const m=document.createElement("i");m.setAttribute("class",`library-type-${c.type}`),h.appendChild(m);const u=document.createElement("span");u.textContent=c.name,h.appendChild(u);const f=l.getPlace(s);switch(c.type){default:d.$controller.hideObjectSetting(["text-setting","video-setting","fill-color-setting","nine-slice-setting"]);break;case"text":{d.$controller.hideObjectSetting(["video-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["text-setting"]),document.getElementById("object-name").value=f.name?f.name:"";const e=document.getElementById("font-select");e.children[0].selected=!0;for(let t=0;t<e.children.length;++t){const a=e.children[t];if(a.value===c._$font){a.selected=!0;break}}const t=document.getElementById("font-style-select");for(let e=0;e<t.children.length;++e){const a=t.children[e];if((0|a.value)===c._$fontType){a.selected=!0;break}}const a=document.getElementById("font-align-select");for(let e=0;e<a.children.length;++e){const t=a.children[e];if(t.value===c._$align){t.selected=!0;break}}const s=document.getElementById("font-wrap-select");switch(!0){case!c._$wordWrap&&!c._$multiline:s.children[0].selected=!0;break;case!c._$wordWrap&&c._$multiline:s.children[1].selected=!0;break;case c._$wordWrap&&c._$multiline:s.children[2].selected=!0}const r=document.getElementById("font-input-select");switch(c._$inputType){case"static":r.children[0].selected=!0;break;case"input":r.children[1].selected=!0}document.getElementById("font-size").value=`${c._$size}`,document.getElementById("font-color").value=`#${c._$color.toString(16).padStart(6,"0")}`,document.getElementById("font-stroke-size").value=`${c._$thickness}`,document.getElementById("font-stroke-color").value=`#${c._$thicknessColor.toString(16).padStart(6,"0")}`;const i=["font-leading","font-letterSpacing","font-leftMargin","font-rightMargin"];for(let e=0;e<i.length;++e){const t=i[e];document.getElementById(t).value=`${c[t.split("-")[1]]}`}document.getElementById("font-auto-size-select").children[c._$autoSize].selected=!0,c._$border&&(document.getElementById("font-border-select").children[1].selected=!0),c._$scroll&&(document.getElementById("font-scroll-select").children[0].selected=!0)}break;case"video":d.$controller.hideObjectSetting(["text-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["video-setting"]),document.getElementById("video-volume").value=c.volume,document.getElementById("video-loop-select").children[c.loop?1:0].selected=!0,document.getElementById("video-auto-select").children[c.autoPlay?1:0].selected=!0;break;case"shape":if(document.getElementById("nine-slice-setting-x").value="0",document.getElementById("nine-slice-setting-y").value="0",document.getElementById("nine-slice-setting-w").value="0",document.getElementById("nine-slice-setting-h").value="0",d.$controller.hideObjectSetting(["text-setting","video-setting","fill-color-setting","nine-slice-setting"]),d.$hitColor){d.$controller.showObjectSetting(["fill-color-setting","nine-slice-setting"]);const e=c._$grid;e&&e.x&&e.y&&(document.getElementById("nine-slice-setting-x").value=`${c._$grid.x}`,document.getElementById("nine-slice-setting-y").value=`${c._$grid.y}`,document.getElementById("nine-slice-setting-w").value=`${c._$grid.w}`,document.getElementById("nine-slice-setting-h").value=`${c._$grid.h}`,this.showGridTarget(),this.placeGridTarget())}}document.getElementById("object-name").value=l.name?l.name:"",document.getElementById("object-symbol").value=c.symbol?c.symbol:"";const g=f.matrix,y=Math.sqrt(g[0]*g[0]+g[1]*g[1]),$=Math.sqrt(g[2]*g[2]+g[3]*g[3]),p=Math.atan2(g[1],g[0])*d.$Rad2Deg,b=Math.atan2(-g[2],g[3])*d.$Rad2Deg;document.getElementById("transform-scale-x").value=Math.abs(Math.ceil(p-b))>=180?-100*y:100*y,document.getElementById("transform-scale-y").value=100*$,document.getElementById("transform-rotate").value=p;const _=f.colorTransform;document.getElementById("color-red-multiplier").value=100*_[0],document.getElementById("color-green-multiplier").value=100*_[1],document.getElementById("color-blue-multiplier").value=100*_[2],document.getElementById("color-alpha-multiplier").value=100*_[3],document.getElementById("color-red-offset").value=_[4],document.getElementById("color-green-offset").value=_[5],document.getElementById("color-blue-offset").value=_[6],document.getElementById("color-alpha-offset").value=_[7];const v=document.getElementById("blend-select").children;for(let e=0;e<v.length;++e){const t=v[e];if(t.value===f.blendMode){t.selected=!0;break}}d.$controller.clearFilters();const I=document.getElementById("filter-setting-list"),k=f.filter.length;k&&(document.querySelectorAll(".filter-none")[0].style.display="none");for(let t=0;t<k;++t){const a=f.filter[t];d.$controller[`add${a.name}`](I,a,e)}}}};class f{constructor(e=null){e?(this._$width=e.width,this._$height=e.height,this._$fps=e.fps,this._$bgColor=e.bgColor,this._$lock=e.lock):(this._$width=d.STAGE_DEFAULT_WIDTH,this._$height=d.STAGE_DEFAULT_HEIGHT,this._$fps=d.STAGE_DEFAULT_FPS,this._$bgColor="#ffffff",this._$lock=!1)}initialize(){const e=document.getElementById("stage");e.style.width=`${this.width}px`,e.style.height=`${this.height}px`,e.style.backgroundColor=this.bgColor,document.getElementById("library-preview-area").style.backgroundColor=this.bgColor;const t=document.getElementById("stage-area");t.style.transformOrigin="50% 50%",t.style.width=`${this.width+window.screen.width}px`,t.style.height=`${this.height+window.screen.height}px`,document.getElementById("label-name").value="",document.getElementById("stage-width").value=this.width,document.getElementById("stage-height").value=this.height,document.getElementById("stage-fps").value=this.fps,document.getElementById("stage-bgColor").value=this.bgColor;document.getElementById("stage-lock").childNodes[1].setAttribute("class",this.lock?"active":"disable"),d.$controller._$stageLock=this.lock;const a=document.getElementById("screen");a.scrollLeft=window.screen.width/2-(a.clientWidth-this.width)/2,a.scrollTop=window.screen.height/2-(a.clientHeight-this.height)/2,d.$offsetLeft=e.offsetLeft,d.$offsetTop=e.offsetTop}toObject(){return{width:this.width,height:this.height,fps:this.fps,bgColor:this.bgColor,lock:this.lock}}get width(){return this._$width}set width(e){this._$width=e}get height(){return this._$height}set height(e){this._$height=e}get fps(){return this._$fps}set fps(e){this._$fps=e}get bgColor(){return this._$bgColor}set bgColor(e){this._$bgColor=e}get lock(){return this._$lock}set lock(e){this._$lock=e}}d.$timeline=new class{constructor(){this.initializeParams(),this._$editor=null,this._$run=this.run.bind(this),this._$showLayerMenu=this.showLayerMenu.bind(this),this._$showTimeLineContextMenu=this.showTimeLineContextMenu.bind(this),this._$previewTimerId=-1,this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)}initialize(){window.removeEventListener("DOMContentLoaded",this._$handler),this.initializeTool();const e=document.getElementById("target-group");e.style.display="none",e.addEventListener("mousemove",function(e){const t=e.currentTarget,a=t.offsetLeft;let s=0|t.dataset.layerId,r=0|t.dataset.frame;const i=document.getElementById(`frame-scroll-id-${s}`),n=0|t.dataset.positionL;if(e.clientX-n>13){if(t.offsetLeft+t.offsetWidth+13>i.offsetLeft+i.offsetWidth)return;return t.style.left=`${a+13}px`,t.dataset.positionL=`${n+13}`,t.dataset.positionR=`${n+26}`,void(t.dataset.frame=""+ ++r)}const o=0|t.dataset.positionR;if(o-e.clientX>13){if(i.offsetLeft>t.offsetLeft-13)return;t.style.left=a-13+"px",t.dataset.positionL=""+(o-26),t.dataset.positionR=""+(o-13),t.dataset.frame=""+--r}}.bind(this)),e.addEventListener("mouseup",function(e){this._$targetFrames.sort(this.frameSort);const t=e.currentTarget;t.style.display="none";const a=0|t.dataset.frame,s=0|this._$targetFrames[0].dataset.frame;if(a===s)return;d.$currentWorkSpace().temporarilySaved();const r=[];let i=0,n=0;const o=[];for(let e=0;e<this._$targetFrames.length;++e){const t=this._$targetFrames[e];switch(t.dataset.frameState){case"empty":continue;case"key-frame":n||(n=0|t.dataset.frame,o[i]={move:!0,beforeStartFrame:n,afterStartFrame:a+e});break;case"key-space-frame":case"key-space-frame-end":n||(n=0|t.dataset.frame,o[i]={copy:!0,beforeStartFrame:n,afterStartFrame:a+e});break;case"empty-key-frame":o[i].beforeEndFrame=0|t.dataset.frame,o[i].afterEndFrame=a+e,i++,n=0}n&&(o[i].beforeEndFrame=1+(0|t.dataset.frame),o[i].afterEndFrame=a+e+1);const s=t.classList.length,l=[];for(let e=0;e<s;++e){const a=t.classList[e];switch(a){case"frame":case"frame-active":case"frame-pointer":continue;default:l.push(a)}}r.push({afterFrame:a+e,frameState:t.dataset.frameState,values:l})}if(!r.length)return;const l=0|t.dataset.layerId,c=d.$currentWorkSpace().scene,h=c.getLayer(l);for(let e=0;e<o.length;++e){const t=o[e],a=t.afterStartFrame-t.beforeStartFrame,s=[];for(let e=t.beforeStartFrame;e<t.beforeEndFrame;++e){const t=h.getActiveCharacter(e);for(let e=0;e<t.length;++e){const a=t[e];s.indexOf(a)>-1||s.push(a)}}const r=[];for(let e=0;e<s.length;++e){const i=s[e],n=i.clone();t.beforeStartFrame>n.startFrame?n.startFrame=t.afterStartFrame:n.startFrame=i.startFrame-t.beforeStartFrame+t.afterStartFrame,n.endFrame=i.endFrame-t.beforeStartFrame+t.afterStartFrame;const o=[],l=n._$places.keys();for(const e of l)e<t.beforeStartFrame||t.beforeEndFrame<=e||(o.push(n.clonePlace(e,e+a)),n.deletePlace(e));for(let e=0;e<o.length;++e){const t=o[e];n.setPlace(t.frame,t)}r.push(n)}for(let e=t.afterStartFrame;e<t.afterEndFrame;++e){const t=h.getActiveCharacter(e);for(let a=0;a<t.length;++a){const r=t[a];if(!(s.indexOf(r)>-1))if(r.startFrame===e){for(let t=e;t<r.endFrame;++t){const e=document.getElementById(`${l}-${t}`),a=e.dataset.frameState;switch(this.removeFrameClass(e),a){case"key-frame":{const a=["empty-key-frame"];e.classList.add("empty-key-frame"),r.endFrame-r.startFrame>1&&(a.push("empty-key-frame-join"),e.classList.add("empty-key-frame-join")),e.dataset.frameState="empty-key-frame",h._$frame.setClasses(t,a)}break;case"key-space-frame":e.classList.add("empty-space-frame"),e.dataset.frameState="empty-space-frame",h._$frame.setClasses(t,["empty-space-frame"]);break;case"key-space-frame-end":e.classList.add("empty-space-frame-end"),e.dataset.frameState="empty-space-frame-end",h._$frame.setClasses(t,["empty-space-frame-end"])}}h.deleteCharacter(r.id)}else{if(r.endFrame-e==1){const t=document.getElementById(`${l}-${e}`);this.removeFrameClass(t),t.classList.add("empty-key-frame"),t.dataset.frameState="empty-key-frame",h._$frame.setClasses(e,["empty-key-frame"])}else{const t=document.getElementById(`${l}-${e}`);this.removeFrameClass(t),t.classList.add("empty-key-frame"),t.classList.add("empty-key-frame-join"),t.dataset.frameState="empty-key-frame",h._$frame.setClasses(e,["empty-key-frame","empty-key-frame-join"]);for(let t=e+1;t<r.endFrame;++t){const e=document.getElementById(`${l}-${t}`);this.removeFrameClass(e),r.endFrame===t+1?(e.classList.add("empty-space-frame-end"),e.dataset.frameState="empty-space-frame-end",h._$frame.setClasses(t,["empty-space-frame-end"])):(e.classList.add("empty-space-frame"),e.dataset.frameState="empty-space-frame",h._$frame.setClasses(t,["empty-space-frame"]))}}const t=r._$places.keys();for(const a of t)e>a||r.deletePlace(a);r.endFrame=e}}}for(let e=0;e<r.length;++e){let t=r[e],a=!1;const s=t.startFrame-1;if(s){const e=h.getActiveCharacter(s);for(let s=0;s<e.length;++s){const r=e[s];if(r.libraryId===t.libraryId&&r.endFrame===t.startFrame){r.endFrame=t.endFrame;for(let[e,a]of t._$places)r.setPlace(e,a);t=r,a=!0;break}}}const i=t.endFrame,n=h.getActiveCharacter(i);for(let e=0;e<n.length;++e){const s=n[e];if(s.libraryId===t.libraryId&&s.startFrame===i){s.startFrame=t.startFrame;for(let[e,a]of t._$places)s.setPlace(e,a);a=!0,h.deleteCharacter(t.id);break}}a||h.addCharacter(t)}}const m=0|r[0].afterFrame;for(let e=0;e<r.length;++e){const t=r[e],a=document.getElementById(`${l}-${t.afterFrame}`);this.removeFrameClass(a),a.dataset.frameState=t.frameState;const s=t.values.length;for(let e=0;e<s;++e)a.classList.add(t.values[e]);h._$frame.setClasses(t.afterFrame,t.values)}const u=document.getElementById(`${l}-${m}`);switch(u.dataset.frameState){case"key-frame":case"empty-key-frame":break;case"key-space-frame":case"key-space-frame-end":this.removeFrameClass(u),u.classList.add("key-frame"),u.dataset.frameState="key-frame";switch(document.getElementById(`${l}-${m+1}`).dataset.frameState){case"key-space-frame":case"key-space-frame-end":u.classList.add("key-frame-join"),h._$frame.setClasses(m,["key-frame","key-frame-join"]);break;default:h._$frame.setClasses(m,["key-frame"])}break;case"empty-space-frame":case"empty-space-frame-end":this.removeFrameClass(u),u.classList.add("empty-key-frame"),u.dataset.frameState="empty-key-frame";switch(document.getElementById(`${l}-${m+1}`).dataset.frameState){case"empty-space-frame":case"empty-space-frame-end":u.classList.add("empty-key-frame-join"),h._$frame.setClasses(m,["empty-key-frame","empty-key-frame-join"]);break;default:h._$frame.setClasses(m,["empty-key-frame"])}}const f=0|r[r.length-1].afterFrame,g=document.getElementById(`${l}-${f}`);switch(g.dataset.frameState){case"key-frame":g.classList.remove("key-frame-join"),h._$frame.setClasses(f,["key-frame"]);break;case"empty-key-frame":g.classList.remove("empty-key-frame-join"),h._$frame.setClasses(f,["empty-key-frame"]);break;case"empty-space-frame":this.removeFrameClass(g),g.classList.add("empty-space-frame-end"),g.dataset.frameState="empty-space-frame-end",h._$frame.setClasses(f,["empty-space-frame-end"]);break;case"key-space-frame":this.removeFrameClass(g),g.classList.add("key-space-frame-end"),g.dataset.frameState="key-space-frame-end",h._$frame.setClasses(f,["key-space-frame-end"])}const y=document.getElementById(`${l}-${f+1}`);switch(y.dataset.frameState){case"empty-space-frame-end":this.removeFrameClass(y),y.classList.add("empty-key-frame"),y.dataset.frameState="empty-key-frame",h._$frame.setClasses(f+1,["empty-key-frame"]);break;case"empty-space-frame":this.removeFrameClass(y),y.classList.add("empty-key-frame"),y.classList.add("empty-key-frame-join"),y.dataset.frameState="empty-key-frame",h._$frame.setClasses(f+1,["empty-key-frame","empty-key-frame-join"]);break;case"key-space-frame-end":this.removeFrameClass(y),y.classList.add("key-frame"),y.dataset.frameState="key-frame",h._$frame.setClasses(f+1,["key-frame"]);break;case"key-space-frame":this.removeFrameClass(y),y.classList.add("key-frame"),y.classList.add("key-frame-join"),y.dataset.frameState="key-frame",h._$frame.setClasses(f+1,["key-frame","key-frame-join"])}if(m>1){const e=document.getElementById(`${l}-${m-1}`);switch(e.dataset.frameState){case"empty":{this.removeFrameClass(e);let t=m-1;if(1===t)e.classList.add("empty-key-frame"),e.dataset.frameState="empty-key-frame",h._$frame.setClasses(t,["empty-key-frame"]);else for(e.classList.add("empty-space-frame-end"),e.dataset.frameState="empty-space-frame-end",h._$frame.setClasses(t,["empty-space-frame-end"]);;){const e=document.getElementById(`${l}-${--t}`);if(!e)break;if("empty"!==e.dataset.frameState){const e=document.getElementById(`${l}-${++t}`);this.removeFrameClass(e);const a=["empty-key-frame"];e.classList.add("empty-key-frame"),t!==m-1&&(e.classList.add("empty-key-frame-join"),a.push("empty-key-frame-join")),e.dataset.frameState="empty-key-frame",h._$frame.setClasses(t,a);break}if(1===t){e.classList.add("empty-key-frame"),e.classList.add("empty-key-frame-join"),e.dataset.frameState="empty-key-frame",h._$frame.setClasses(t,["empty-key-frame","empty-key-frame-join"]);break}e.classList.add("empty-space-frame"),e.dataset.frameState="empty-space-frame",h._$frame.setClasses(t,["empty-space-frame"])}}break;case"key-frame":e.classList.remove("key-frame-join"),h._$frame.setClasses(m-1,["key-frame"]);break;case"empty-key-frame":e.classList.remove("empty-key-frame-join"),h._$frame.setClasses(m-1,["empty-key-frame"]);break;case"key-space-frame":this.removeFrameClass(e),e.classList.add("key-space-frame-end"),e.dataset.frameState="key-space-frame-end",h._$frame.setClasses(m-1,["key-space-frame-end"]);break;case"empty-space-frame":this.removeFrameClass(e),e.classList.add("empty-space-frame-end"),e.dataset.frameState="empty-space-frame-end",h._$frame.setClasses(m-1,["empty-space-frame-end"])}}c.changeFrame(s)}.bind(this)),document.body.addEventListener("click",function(e){if(this._$menuMode)return this._$menuMode=!1,void document.getElementById("timeline-menu").setAttribute("class","fadeOut");if(this._$layerMenuMode){this._$layerMenuMode=!1;const e=document.getElementById("timeline-layer-menu");return void(e.classList.contains("fadeIn")&&e.setAttribute("class","fadeOut"))}let t=e.target;switch(t.id){case"scene-list":case"scene-name-menu":return;default:for(;;){if(t=t.parentNode,!t){this._$sceneMode=!1;const e=document.getElementById("scene-name-menu");e.classList.contains("fadeIn")&&e.setAttribute("class","fadeOut");break}if("scene-name-menu"===t.id)break}}}.bind(this));document.getElementById("scene-list").addEventListener("mousedown",function(e){if(!document.getElementById("scene-name-menu-list").children.length)return;const t=document.getElementById("scene-name-menu");if(this._$sceneMode)this._$sceneMode=!1,t.classList.contains("fadeIn")&&t.setAttribute("class","fadeOut");else{this._$sceneMode=!0;const a=e.currentTarget;t.style.left=`${a.offsetLeft+a.offsetWidth}px`,t.style.top=`${a.offsetTop+10}px`,t.setAttribute("class","fadeIn"),d.$endMenu("scene-name-menu")}}.bind(this)),window.addEventListener("mouseup",function(){if(this._$moveTarget){this._$moveTarget.classList.remove("move-target");const e=d.$currentWorkSpace().scene;if(this._$moveTarget!==this._$moveLayer){const t=e.getLayer(0|this._$moveTarget.dataset.layerId),a=0|this._$moveLayer.dataset.layerId,s=e.getLayer(a);if(s._$mode===d.LAYER_MODE_MASK&&(t._$mode===d.LAYER_MODE_MASK||t._$mode===d.LAYER_MODE_MASK_IN))return;t.mode===d.LAYER_MODE_MASK||t.mode===d.LAYER_MODE_MASK_IN?s.mode!==d.LAYER_MODE_MASK_IN&&s.mode===d.LAYER_MODE_NORMAL&&(s.maskId=null===t.maskId?t.id:t.maskId,s.mode=d.LAYER_MODE_MASK_IN,s.showIcon()):s.mode===d.LAYER_MODE_MASK_IN&&(s.maskId=null,s.mode=d.LAYER_MODE_NORMAL,s.showIcon());let r=null;const i=document.getElementById("timeline-content");if(s._$mode===d.LAYER_MODE_MASK){const t=i.children;for(let a=0;a<t.length;++a){const i=t[a];if(s.id===(0|i.dataset.layerId)){r=[];continue}if(!r)continue;if(e.getLayer(0|i.dataset.layerId)._$mode!==d.LAYER_MODE_MASK_IN)break;r.push(i)}if(r)for(let e=0;e<r.length;++e)i.removeChild(r[e])}if(this._$moveLayer===this._$moveTarget.nextElementSibling){if(t._$mode===d.LAYER_MODE_MASK)return;i.insertBefore(this._$moveLayer,this._$moveTarget)}else i.insertBefore(this._$moveLayer,this._$moveTarget.nextElementSibling);if(r)for(let e=0;e<r.length;++e)i.insertBefore(r[e],this._$moveLayer.nextElementSibling);this._$moveLayer.lastElementChild.scrollLeft=this._$moveTarget.lastElementChild.scrollLeft;const n=[],o=i.children;for(let t=0;t<o.length;++t)n.push(e.getLayer(0|o[t].dataset.layerId));e.clearLayer();for(let t=0;t<n.length;++t){const a=n[t];e.setLayer(a.id,a)}e.changeFrame(0|document.getElementById("current-frame").textContent)}}this._$moveId=-1,this._$moveLayer=null,this._$moveTarget=null,this._$moveScriptModal=!1,d.$setCursor("auto")}.bind(this)),document.getElementById("timeline-layer-normal").addEventListener("click",function(){if(this._$targetLayer){const e=d.$currentWorkSpace().scene,t=0|this._$targetLayer.dataset.layerId;let a=!1;for(const s of e._$layers.values())if(s.id!==t){if(a){if(s.mode!==d.LAYER_MODE_MASK_IN)break;s.maskId=null,s.mode=d.LAYER_MODE_NORMAL,s.showIcon()}}else{const e=s.mode;if(s.mode=d.LAYER_MODE_NORMAL,s.showIcon(),e!==d.LAYER_MODE_MASK)break;a=!0}}}.bind(this)),document.getElementById("timeline-layer-mask").addEventListener("click",function(){if(this._$targetLayer){const e=d.$currentWorkSpace().scene,t=0|this._$targetLayer.dataset.layerId,a=e.getLayer(t);a.mode=d.LAYER_MODE_MASK,a.showIcon()}}.bind(this));const t=function(e){if(d.$keyLock||d.$activeScript)return!1;if(d.$shiftKey)return e.preventDefault(),!1;switch(e.code){case"Semicolon":if(e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)return e.preventDefault(),d.$currentWorkSpace().scene.addLayer(),!1;break;case"Minus":if(e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)return e.preventDefault(),this.removeLayer(),!1;break;case"KeyC":if(!d.$canCopyLayer||!this._$targetLayer)return!1;if((e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)&&(d.$copyLibrary=null,d.$copyLayer=null,d.$copyCharacter=null,!d.$keyLock&&!d.$activeScript)){e.preventDefault(),d.$copyWorkSpaceId=d.$activeWorkSpaceId;const t=0|this._$targetLayer.dataset.layerId;d.$copyLayer=d.$currentWorkSpace().scene.getLayer(t);const a=document.getElementById("detail-modal");return a.textContent="copy",a.style.left=`${this._$targetLayer.offsetLeft+5}px`,a.style.top=`${this._$targetLayer.offsetTop+5}px`,a.setAttribute("class","fadeIn"),a.dataset.timerId=setTimeout(function(){this.classList.contains("fadeOut")||this.setAttribute("class","fadeOut")}.bind(a),1500),!1}break;case"KeyV":if((e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)&&!d.$keyLock&&!d.$activeScript&&d.$copyLayer){e.preventDefault();const t=0|document.getElementById("current-frame").textContent,a=d.$currentWorkSpace(),s=a.scene;if(d.$copyWorkSpaceId===d.$activeWorkSpaceId){const e=d.$copyLayer.toObject();for(let t=0;t<e.characters.length;++t){e.characters[t].id=a._$characterId++}s.addLayer(new _(e))}else{const e=d.$workSpaces[d.$copyWorkSpaceId],t=new Map,r=d.$copyLayer.toObject();for(let s=0;s<r.characters.length;++s){const i=r.characters[s];i.id=a._$characterId++;const n=e.getLibrary(i.libraryId).toObject();"container"===n.type?d.$copyContainer(n,t):t.has(i.libraryId)||(t.set(i.libraryId,a.nextLibraryId),n.id=t.get(i.libraryId),e.addLibrary(n)),i.libraryId=t.get(i.libraryId)}s.addLayer(new _(r)),a.initializeLibrary()}return d.$copyWorkSpaceId=-1,d.$copyLayer=null,s.changeFrame(t),!1}}}.bind(this);window.addEventListener("keydown",t),d.$initializeEnd(),this._$handler=null}initializeTool(){document.documentElement.style.setProperty("--timeline-height",`${d.TIMELINE_DEFAULT_SIZE}px`);document.getElementById("timeline-adjustment").addEventListener("mousedown",function(e){this._$resizeMode=!0,this._$pointY=e.screenY,d.$setCursor("row-resize")}.bind(this)),window.addEventListener("mouseup",function(){this._$resizeMode&&(this._$resizeMode=!1,this._$pointY=0,d.$setCursor("auto")),this._$markerMode&&(this._$markerMode=!1,d.$setCursor("ew-resize"))}.bind(this)),window.addEventListener("mousemove",function(e){if(this._$resizeMode){const t=this._$pointY-e.screenY,a=0|document.documentElement.style.getPropertyValue("--timeline-height").split("px")[0];document.documentElement.style.setProperty("--timeline-height",`${Math.max(d.TIMELINE_MIN_SIZE,a+t)}px`),this._$pointY=e.screenY}if(this._$moveScriptModal){const t=document.getElementById("editor-modal");t.style.left=`${parseFloat(t.style.left)+(e.screenX-this._$pointX)}px`,t.style.top=`${parseFloat(t.style.top)+(e.screenY-this._$pointY)}px`,this._$pointX=e.screenX,this._$pointY=e.screenY}}.bind(this)),this._$editor=ace.edit("editor"),this._$editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this._$editor.setTheme("ace/theme/monokai"),this._$editor.session.setMode("ace/mode/javascript");const e=[{word:"next2d",meta:"window.next2d"},{word:"toString",value:"toString()",meta:"common method"},{word:"namespace",meta:"common property"}],t=Object.keys(window.next2d);for(let a=1;a<t.length;++a){const s=t[a];e.push({word:`next2d.${s}`,meta:`next2d.${s}`});const r=Object.keys(window.next2d[s]);for(let t=0;t<r.length;++t){const a=r[t];e.push({word:a,meta:`next2d.${s}.${a}`});const i=window.next2d[s][a],n=Object.getOwnPropertyDescriptors(i),o=Object.getOwnPropertyNames(i);for(let t=0;t<o.length;++t){const s=o[t];switch(s){case"length":case"prototype":case"toString":case"namespace":case"name":continue;default:{const t=n[s];if("value"in t){const r=t.value.toString().replace(/ |\n/g,"").split("{")[0].split("(")[1];e.push({word:s,value:`${s}()`,meta:`${a}.${s}(${r}`})}else e.push({word:s,meta:`${a}.${s}`})}}}const l=Object.getOwnPropertyDescriptors(i.prototype),c=Object.getOwnPropertyNames(i.prototype);for(let t=0;t<c.length;++t){const s=c[t];switch(s){case"constructor":case"toString":case"namespace":case"name":continue;default:{if(s.indexOf("_$")>-1)continue;const t=l[s];if("value"in t){const r=t.value.toString().replace(/ |\n/g,"").split("{")[0].split("(")[1];e.push({word:s,value:`${s}()`,meta:`${a}.${s}(${r}`})}else e.push({word:s,meta:`${a}.${s}`})}}}}}ace.require("ace/ext/language_tools").addCompleter({getCompletions:function(t,a,s,r,i){i(null,e.map((function(e){return{caption:e.word,value:e.value||e.word,meta:e.meta,score:0}})))}}),document.getElementById("timeline-script-add").addEventListener("mousedown",this.showScriptArea.bind(this)),document.getElementById("context-menu-script-add").addEventListener("mousedown",this.showScriptArea.bind(this)),document.getElementById("editor-hide-icon").addEventListener("mousedown",this.hideScriptArea.bind(this)),document.documentElement.style.setProperty("--script-modal-width",`${d.SCRIPT_MODAL_WIDTH}px`),document.documentElement.style.setProperty("--script-modal-height",`${d.SCRIPT_MODAL_HEIGHT}px`),document.documentElement.style.setProperty("--script-modal-bar-height",`${d.SCRIPT_MODAL_BAR_HEIGHT}px`);const a=new ResizeObserver(function(e){e.forEach((function(e){const t=e.target,a=parseFloat(document.documentElement.style.getPropertyValue("--script-modal-width")),s=parseFloat(document.documentElement.style.getPropertyValue("--script-modal-height"));a!==t.clientWidth&&document.documentElement.style.setProperty("--script-modal-width",`${t.clientWidth}px`),s!==t.clientHeight&&document.documentElement.style.setProperty("--script-modal-height",`${t.clientHeight+d.SCRIPT_MODAL_BAR_HEIGHT}px`)})),this._$editor.resize()}.bind(this));a.observe(document.getElementById("editor-modal")),document.getElementById("editor-bar").addEventListener("mousedown",function(e){this._$pointX=e.screenX,this._$pointY=e.screenY,this._$moveScriptModal=!0}.bind(this)),document.getElementById("timeline-frame-add").addEventListener("mousedown",this.addSpaceFrame.bind(this)),document.getElementById("context-menu-frame-add").addEventListener("mousedown",this.addSpaceFrame.bind(this)),document.getElementById("timeline-key-add").addEventListener("mousedown",this.addKeyFrame.bind(this)),document.getElementById("context-menu-key-frame-add").addEventListener("mousedown",this.addKeyFrame.bind(this)),document.getElementById("timeline-empty-add").addEventListener("mousedown",this.addEmptyFrame.bind(this)),document.getElementById("context-menu-empty-key-frame-add").addEventListener("mousedown",this.addEmptyFrame.bind(this)),document.getElementById("timeline-frame-delete").addEventListener("click",this.deleteFrame.bind(this)),document.getElementById("context-menu-frame-delete").addEventListener("click",this.deleteFrame.bind(this)),document.getElementById("timeline-onion-skin").addEventListener("click",function(e){const t=d.$currentWorkSpace().scene,a=e.target;if(a.classList.contains("onion-skin-active")){a.classList.remove("onion-skin-active");for(const e of t._$layers.values())for(let t=0;t<e._$characters.length;++t){e._$characters[t]._$image=null}}else a.classList.add("onion-skin-active");t.changeFrame(0|document.getElementById("current-frame").textContent)}.bind(this)),document.getElementById("timeline-preview").addEventListener("click",function(e){const t=e.target;t.classList.contains("timeline-preview-active")?t.classList.remove("timeline-preview-active"):t.classList.add("timeline-preview-active")}.bind(this));const s=document.getElementById("label-name");s.addEventListener("focusin",function(){d.$keyLock=!0,this._$labelFrame=0|document.getElementById("current-frame").textContent}.bind(this)),s.addEventListener("keypress",this.setLabelMarker.bind(this)),s.addEventListener("blur",(function(){d.$keyLock=!1})),document.getElementById("timeline-layer-add").addEventListener("mousedown",(function(){const e=d.$currentWorkSpace();e.temporarilySaved(),e.scene.addLayer()})),document.getElementById("timeline-layer-trash").addEventListener("click",this.removeLayer.bind(this)),document.getElementById("timeline-layer-light-all").addEventListener("mousedown",function(){this._$lightAll=!this._$lightAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene,a=e.children.length;for(let s=0;s<a;++s){const a=e.children[s],r=0|a.dataset.layerId,i=document.getElementById(`layer-light-icon-${r}`),n=t.getLayer(r);this._$lightAll?(i.classList.remove("icon-disable"),i.classList.add("icon-active"),a.classList.add("light-active"),n.light=!0):(i.classList.remove("icon-active"),i.classList.add("icon-disable"),a.classList.remove("light-active"),n.light=!1)}}.bind(this)),document.getElementById("timeline-layer-disable-all").addEventListener("mousedown",function(){this._$disableAll=!this._$disableAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene,a=e.children.length;for(let s=0;s<a;++s){const a=0|e.children[s].dataset.layerId,r=document.getElementById(`layer-disable-icon-${a}`),i=t.getLayer(a);this._$disableAll?(r.classList.remove("icon-disable"),r.classList.add("icon-active"),i.disable=!0):(r.classList.remove("icon-active"),r.classList.add("icon-disable"),i.disable=!1)}t.changeFrame(0|document.getElementById("current-frame").textContent),d.$screen.hideTransformTarget(),d.$screen.hideGridTarget()}.bind(this)),document.getElementById("timeline-layer-lock-all").addEventListener("mousedown",function(){this._$lockAll=!this._$lockAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene,a=e.children.length;for(let s=0;s<a;++s){const a=0|e.children[s].dataset.layerId,r=document.getElementById(`layer-lock-icon-${a}`),i=t.getLayer(a);this._$lockAll?(r.classList.remove("icon-disable"),r.classList.add("icon-active"),i.lock=!0):(r.classList.remove("icon-active"),r.classList.add("icon-disable"),i.lock=!1)}t.changeFrame(0|document.getElementById("current-frame").textContent),d.$screen.hideTransformTarget(),d.$screen.hideGridTarget()}.bind(this));document.getElementById("timeline-controller-base").addEventListener("wheel",function(e){const t=e.deltaX||e.deltaY;if(!t)return!1;e.preventDefault(),this._$scrollX+=0|t,this.moveTimeLine(this._$scrollX)}.bind(this),{passive:!1});document.getElementById("timeline-marker").addEventListener("mousedown",function(e){for(let e=0;e<this._$targetFrames.length;++e)this._$targetFrames[e].classList.remove("frame-active");d.$screen.clearActiveCharacter(),d.$controller.setDefaultController(),this._$targetFrames.length=0,this._$markerMode=!0,this._$pointX=e.pageX,d.$setCursor("ew-resize")}.bind(this)),document.getElementById("timeline-play").addEventListener("mousedown",this.play.bind(this)),document.getElementById("timeline-stop").addEventListener("mousedown",this.stop.bind(this)),document.getElementById("timeline-repeat").addEventListener("mousedown",function(e){e.target.style.display="none",document.getElementById("timeline-no-repeat").style.display="",this._$repeat=!1}.bind(this)),document.getElementById("timeline-no-repeat").addEventListener("mousedown",function(e){e.target.style.display="none",document.getElementById("timeline-repeat").style.display="",this._$repeat=!0}.bind(this)),document.getElementById("timeline-stop").style.display="none",document.getElementById("timeline-repeat").style.display="none",document.getElementById("context-menu-tween-add").addEventListener("mousedown",function(){if(d.$endMenu(),this._$targetLayer){const e=d.$currentWorkSpace().scene,t=0|this._$targetLayer.dataset.layerId,a=e.getLayer(t),s=0|document.getElementById("current-frame").textContent,r=a.getActiveCharacter(s);if(!r.length)return;if(r.length>1)return void alert("If you want to add motion tweening to multiple objects, please do so in a single MovieClip.");let i=s;for(;;){++i;const e=document.getElementById(`${t}-${i}`);if("empty"===e.dataset.frameState){--i;break}if(e.classList.contains("key-frame")||e.classList.contains("empty-key-frame")){--i;break}if(e.classList.contains("key-space-frame-end"))break}let n=s;for(;n>0;){if(document.getElementById(`${t}-${n}`).classList.contains("key-frame"))break;--n}const o=document.getElementById(`${t}-${n}`);if(o.classList.contains("tween-key-frame"))return;d.$currentWorkSpace().temporarilySaved(),o.classList.add("tween-key-frame");const l=r[0];for(let e=n;i>=e;++e){const s=document.getElementById(`${t}-${e}`);if(s.classList.contains("frame-active")&&s.classList.remove("frame-active"),s.classList.contains("tween-frame")||(s.classList.add("tween-frame"),a._$frame.getClasses(e).push("tween-frame")),e>n&&l.setPlace(e,l.clonePlace(n,e)),s.classList.contains("key-space-frame-end"))break}a._$frame.getClasses(n).push("tween-key-frame");document.getElementById(`${t}-${i}`).classList.add("tween-frame-end"),a._$frame.getClasses(i).push("tween-frame-end"),l._$image=null}}.bind(this)),document.getElementById("context-menu-tween-delete").addEventListener("mousedown",function(){if(d.$endMenu(),this._$targetLayer){const e=d.$currentWorkSpace().scene,t=0|this._$targetLayer.dataset.layerId,a=e.getLayer(t),s=0|document.getElementById("current-frame").textContent,r=a.getActiveCharacter(s);if(!r.length)return;d.$currentWorkSpace().temporarilySaved();let i=0|document.getElementById("current-frame").textContent;for(;i>0;){if(document.getElementById(`${t}-${i}`).classList.contains("key-frame"))break;--i}const n=r[0],o=n.endFrame-1;for(let e=i;o>=e;++e){const s=document.getElementById(`${t}-${e}`);if(s.classList.contains("frame-active")&&s.classList.remove("frame-active"),!s.classList.contains("tween-frame"))continue;if(e!==i&&s.classList.contains("ket-frame"))break;s.classList.remove("tween-frame","tween-key-frame","tween-frame-end");const r=a._$frame.getClasses(e),o=r.indexOf("tween-frame");if(o>-1&&(r.splice(o,1),a._$frame.setClasses(e,r)),e>i&&n.deletePlace(e),s.classList.contains("key-space-frame-end"))break}n._$image=null,n._$tween.delete(i),document.getElementById("ease-select")[0].selected=!0,d.$screen.clearTweenMarker(),e.changeFrame(s)}}.bind(this))}play(){if(this._$stopFlag&&(d.$endMenu(),this._$totalFrame=d.$currentWorkSpace().scene.totalFrame,this._$totalFrame>1)){this._$stopFlag=!1,this._$timerId>-1&&window.cancelAnimationFrame(this._$timerId);const e=document.getElementById("current-frame");if(1+(0|e.textContent)>this._$totalFrame){e.textContent="1",document.getElementById("timeline-marker").style.left="0px";document.getElementById("timeline-controller-base").scrollLeft&&this.moveTimeLine(0),d.$currentWorkSpace().scene.changeFrame(1)}document.getElementById("timeline-play").style.display="none",document.getElementById("timeline-stop").style.display="",document.getElementById("target-group").style.display="none",this.resetFrames(),d.$screen.clearActiveCharacter(),d.$controller.setDefaultController(),this._$startTime=window.performance.now(),this._$fps=1e3/(0|document.getElementById("stage-fps").value),this._$timerId=window.requestAnimationFrame(this._$run)}}stop(){window.cancelAnimationFrame(this._$timerId),this._$stopFlag=!0,this._$timerId=-1,document.getElementById("timeline-play").style.display="",document.getElementById("timeline-stop").style.display="none";document.getElementById("timeline-onion-skin").classList.contains("onion-skin-active")&&d.$currentWorkSpace().scene.changeFrame(0|document.getElementById("current-frame").textContent)}run(e=0){if(this._$stopFlag)return;let t=e-this._$startTime;if(t>this._$fps){const a=document.getElementById("current-frame"),s=document.getElementById("timeline-controller-base");let r=1+(0|a.textContent);if(r>this._$totalFrame){if(!this._$repeat)return this.stop();r=1,s.scrollLeft&&this.moveTimeLine(0)}a.textContent=`${r}`,this._$startTime=e-t%this._$fps,d.$currentWorkSpace().scene.changeFrame(r);const i=13*(r-1);document.getElementById("timeline-marker").style.left=`${i}px`,i>s.offsetWidth/2&&this.moveTimeLine(i-s.offsetWidth/2)}this._$timerId=window.requestAnimationFrame(this._$run)}initializeParams(){this._$scrollX=0,this._$pointX=0,this._$pointY=0,this._$moveId=-1,this._$targetFrame=null,this._$targetLayer=null,this._$moveLayer=null,this._$moveTarget=null,this._$lightAll=!1,this._$disableAll=!1,this._$lockAll=!1,this._$multiMode=!1,this._$menuMode=!1,this._$sceneMode=!1,this._$resizeMode=!1,this._$markerMode=!1,this._$stopFlag=!0,this._$repeat=!1,this._$timerId=-1,this._$startTime=-1,this._$fps=-1,this._$totalFrame=1,this._$layerMenuMode=!1,this._$labelFrame=0,this._$targetFrames=[],this._$actionFrame=-1,this._$actionScene=null,this._$moveScriptModal=!1}setLabelMarker(e){if(this._$labelFrame&&"Enter"===e.code){const t=e.currentTarget.value,a=t?"frame-border-box-marker":"frame-border-box";document.getElementById(`frame-label-marker-${this._$labelFrame}`).setAttribute("class",a);const s=d.$currentWorkSpace();t?s.scene.setLabel(this._$labelFrame,t):s.scene.deleteLabel(this._$labelFrame),this._$labelFrame=0,"keypress"===e.type&&e.currentTarget.blur()}}removeFrameClass(e){const t=["key-frame","empty-key-frame","key-space-frame","empty-space-frame","key-space-frame-end","empty-space-frame-end","empty-key-frame-join","key-frame-join","tween-frame","tween-key-frame","tween-frame-end","morph-frame","morph-key-frame","morph-frame-end"];for(let a=0;a<t.length;++a)e.classList.remove(t[a]);e.dataset.frameState="empty"}frameSort(e,t){const a=0|e.dataset.frame,s=0|t.dataset.frame;switch(!0){case a>s:return 1;case a<s:return-1;default:return 0}}showScriptArea(e=null){d.$keyLock=!0,d.$activeScript=!0,this._$actionFrame=0|document.getElementById("current-frame").textContent,this._$editor.setValue("",-1);const t=d.$currentWorkSpace().scene;if(t.hasAction(this._$actionFrame)&&this._$editor.setValue(t.getAction(this._$actionFrame),-1),document.getElementById("editor-title").textContent=`${t.name} / frame[${this._$actionFrame}]`,e){const t=document.getElementById("editor-modal");t.style.display="",t.style.left=`${e.pageX+5}px`,t.style.top=e.pageY-t.clientHeight/2+"px",t.setAttribute("class","fadeIn"),d.$endMenu("editor-modal")}this._$editor.focus()}hideScriptArea(){this.saveActionScript(),this._$editor.setValue("",0),this._$actionFrame=-1,this._$actionScene=null,d.$keyLock=!1,d.$activeScript=!1,d.$endMenu()}saveActionScript(){if(-1===this._$actionFrame)return;const e=this._$editor.getValue(0),t=document.getElementById(`frame-label-action-${this._$actionFrame}`),a=this._$actionScene||d.$currentWorkSpace().scene;e?(a.setAction(this._$actionFrame,e.trim()),this._$actionScene||t.classList.contains("frame-border-box-action")||t.setAttribute("class","frame-border-box-action")):(a.deleteAction(this._$actionFrame),this._$actionScene||t.setAttribute("class","frame-border-box"))}addSpaceFrame(){const e=this._$targetFrames.length;if(!e)return;d.$currentWorkSpace().temporarilySaved(),this._$targetFrames.sort(this.frameSort);const t=[],a=this._$targetFrames[0],s=0|a.dataset.layerId;let r=0|a.dataset.frame;const i=d.$currentWorkSpace().scene,n=i.getLayer(s);let o=0,l=r,c=r,h=e,m=!1,u=a.classList.contains("tween-frame"),f=a.classList.contains("morph-frame");const g=a.dataset.frameState;if("empty"===g){if(1===r)a.classList.add("empty-key-frame"),e>1?(a.classList.add("empty-key-frame-join"),n._$frame.setClasses(l,["empty-key-frame","empty-key-frame-join"])):n._$frame.setClasses(l,["empty-key-frame"]),a.dataset.frameState="empty-key-frame";else{let t=!1;for(;l;){const e=document.getElementById(`${s}-${--l}`);switch(e.dataset.frameState){case"empty":1===l?(e.classList.add("empty-key-frame"),e.classList.add("empty-key-frame-join"),e.dataset.frameState="empty-key-frame",n._$frame.setClasses(l,["empty-key-frame","empty-key-frame-join"]),t=!0):(e.classList.add("empty-space-frame"),e.dataset.frameState="empty-space-frame",n._$frame.setClasses(l,["empty-space-frame"]));break;case"empty-space-frame-end":e.classList.remove("empty-space-frame-end"),e.classList.add("empty-space-frame"),e.dataset.frameState="empty-space-frame",n._$frame.setClasses(l,["empty-space-frame"]),t=!0;break;case"empty-key-frame":e.classList.add("empty-key-frame-join"),n._$frame.setClasses(l,["empty-key-frame","empty-key-frame-join"]),t=!0;break;case"key-frame":{u=e.classList.contains("tween-frame"),f=e.classList.contains("morph-frame"),e.classList.add("key-frame-join");const a=["key-frame","key-frame-join"];u&&(e.classList.remove("tween-frame-end"),a.push("tween-frame")),f&&(e.classList.remove("morph-frame-end"),a.push("morph-frame")),n._$frame.setClasses(l,a),m=!0,t=!0}break;case"key-space-frame-end":{u=e.classList.contains("tween-frame"),f=e.classList.contains("morph-frame"),this.removeFrameClass(e),e.classList.add("key-space-frame"),e.dataset.frameState="key-space-frame";const a=["key-space-frame"];u&&(e.classList.add("tween-frame"),a.push("tween-frame")),f&&(e.classList.add("morph-frame"),a.push("morph-frame")),n._$frame.setClasses(l,a),m=!0,t=!0}}if(t)break}if(m){if(c=l,h=r-c,e>1){h=(0|this._$targetFrames[this._$targetFrames.length-1].dataset.frame)-c}for(;;){const t=document.getElementById(`${s}-${++l}`);this.removeFrameClass(t),t.classList.add("key-space-frame");const a=["key-space-frame"];if(u&&(t.classList.add("tween-frame"),a.push("tween-frame")),f&&(t.classList.add("morph-frame"),a.push("morph-frame")),t.dataset.frameState="key-space-frame",n._$frame.setClasses(l,a),l===r){if(1===e){this.removeFrameClass(t),t.classList.add("key-space-frame-end");const e=["key-space-frame-end"];u&&(t.classList.add("tween-frame","tween-frame-end"),e.push("tween-frame","tween-frame-end")),f&&(t.classList.add("morph-frame","morph-frame-end"),e.push("morph-frame","morph-frame-end")),t.dataset.frameState="key-space-frame-end",n._$frame.setClasses(l,e)}break}}}}const t=m?"key":"empty";for(let a=1===r?1:0;a<e;++a){const s=this._$targetFrames[a],r=0|s.dataset.frame;if(e===a+1){s.classList.add(`${t}-space-frame-end`),s.dataset.frameState=`${t}-space-frame-end`;const e=[`${t}-space-frame-end`];u&&(s.classList.add("tween-frame","tween-frame-end"),e.push("tween-frame","tween-frame-end")),f&&(s.classList.add("morph-frame","morph-frame-end"),e.push("morph-frame","morph-frame-end")),n._$frame.setClasses(r,e);break}s.classList.add(`${t}-space-frame`),s.dataset.frameState=`${t}-space-frame`;const i=[`${t}-space-frame`];u&&(s.classList.add("tween-frame"),i.push("tween-frame")),f&&(s.classList.add("morph-frame"),i.push("morph-frame")),n._$frame.setClasses(r,i)}}else{switch(g){case"key-frame":if(o++,u=a.classList.contains("tween-frame"),f=a.classList.contains("morph-frame"),!a.classList.contains("key-frame-join")){a.classList.add("key-frame-join");const e=["key-frame","key-frame-join"];u&&(a.classList.add("tween-frame"),a.classList.remove("tween-frame-end"),e.push("tween-frame")),f&&(a.classList.add("morph-frame"),a.classList.remove("morph-frame-end"),e.push("morph-frame")),n._$frame.setClasses(r,e)}break;case"empty-key-frame":o++,a.classList.contains("empty-key-frame-join")||(a.classList.add("empty-key-frame-join"),n._$frame.setClasses(r,["empty-key-frame","empty-key-frame-join"]))}let i=!1,l=!1,c=r+o;for(;;){switch(document.getElementById(`${s}-${c++}`).dataset.frameState){case"empty":case"key-frame":case"empty-key-frame":i=!0;break;case"key-space-frame-end":case"empty-space-frame-end":l=!0,i=!0}if(i)break}let d=this.getMoveFrames(s,r+o,t);const h="key-frame"===g||"key-space-frame"===g||"key-space-frame-end"===g?"key":"empty";let m=0;for(c=r+o;e>m;){m++;const t=document.getElementById(`${s}-${c}`);if(d&&(d--,t.classList.add("frame-active")),!l&&e===m){t.classList.add(`${h}-space-frame-end`),t.dataset.frameState=`${h}-space-frame-end`;const e=[`${h}-space-frame-end`];u&&(t.classList.add("tween-frame","tween-frame-end"),e.push("tween-frame","tween-frame-end")),f&&(t.classList.add("morph-frame","morph-frame-end"),e.push("morph-frame","morph-frame-end")),n._$frame.setClasses(c++,e);break}t.classList.add(`${h}-space-frame`),t.dataset.frameState=`${h}-space-frame`;const a=[`${h}-space-frame`];u&&(t.classList.add("tween-frame"),a.push("tween-frame")),f&&(t.classList.add("morph-frame"),a.push("morph-frame")),n._$frame.setClasses(c++,a)}t.length&&this.moveFrames(s,r+e+o,t)}const y=n._$characters;for(let e=0;e<y.length;++e){const t=y[e];if(c>=t.endFrame)continue;t.endFrame+=h,t.startFrame>c&&(t.startFrame+=h);const a=[];for(let[e,s]of t._$places)c>=e||(t.deletePlace(e),s.frame+=h,a.push(s));for(let e=0;e<a.length;++e){const s=a[e];t.setPlace(s.frame,s)}}u&&(d.$screen.clearTweenMarker(),d.$screen.executeTween(n)),this.adjTimeline(),i.changeFrame(c)}adjTimeline(){const e=d.$currentWorkSpace().scene;let t=Math.ceil(1.5*window.parent.screen.width+(e.totalFrame/5|0)*d.$frameWidth);const a=document.getElementById("timeline-frame-marker");if(t>a.scrollWidth){let s=1+(0|a.lastElementChild.lastElementChild.lastElementChild.dataset.frame);const r=0|document.getElementById("stage-fps").value;let i=Math.ceil(s/r);const n=a.scrollWidth;let o="",l=s,c=t-n;for(;c>0;)o+=`\n<div class="frame-group">\n    <div class="frame-border-sec-group">\n        <div class="frame-border" data-frame="${l}">${l%r==0&&r>4?i+++"s":""}</div>\n        <div class="frame-border" data-frame="${l+1}">${(l+1)%r==0&&r>4?i+++"s":""}</div>\n        <div class="frame-border" data-frame="${l+2}">${(l+2)%r==0&&r>4?i+++"s":""}</div>\n        <div class="frame-border" data-frame="${l+3}">${(l+3)%r==0&&r>4?i+++"s":""}</div>\n        <div class="frame-border" data-frame="${l+4}">${(l+4)%r==0&&r>4?i+++"s":""}</div>\n    </div>\n    <div class="frame-border-box-group">\n        <div id="frame-label-marker-${l}"     class="frame-border-box" data-frame="${l}"></div>\n        <div id="frame-label-marker-${l+1}" class="frame-border-box" data-frame="${l+1}"></div>\n        <div id="frame-label-marker-${l+2}" class="frame-border-box" data-frame="${l+2}"></div>\n        <div id="frame-label-marker-${l+3}" class="frame-border-box" data-frame="${l+3}"></div>\n        <div id="frame-label-marker-${l+4}" class="frame-border-box" data-frame="${l+4}"></div>\n    </div>\n    <div class="frame-border-box-group">\n        <div id="frame-label-action-${l}"     class="frame-border-box" data-frame="${l}"></div>\n        <div id="frame-label-action-${l+1}" class="frame-border-box" data-frame="${l+1}"></div>\n        <div id="frame-label-action-${l+2}" class="frame-border-box" data-frame="${l+2}"></div>\n        <div id="frame-label-action-${l+3}" class="frame-border-box" data-frame="${l+3}"></div>\n        <div id="frame-label-action-${l+4}" class="frame-border-box" data-frame="${l+4}"></div>\n    </div>\n        <div class="frame-border-box-group">\n        <div id="frame-label-sound-${l}"     class="frame-border-box" data-frame="${l}"></div>\n        <div id="frame-label-sound-${l+1}" class="frame-border-box" data-frame="${l+1}"></div>\n        <div id="frame-label-sound-${l+2}" class="frame-border-box" data-frame="${l+2}"></div>\n        <div id="frame-label-sound-${l+3}" class="frame-border-box" data-frame="${l+3}"></div>\n        <div id="frame-label-sound-${l+4}" class="frame-border-box" data-frame="${l+4}"></div>\n    </div>\n    <div class="frame-number-group">\n        <div class="frame-number-space" data-frame="${l}"></div>\n        <div class="frame-number-space" data-frame="${l+1}"></div>\n        <div class="frame-number-space" data-frame="${l+2}"></div>\n        <div class="frame-number-space" data-frame="${l+3}"></div>\n        <div class="frame-number" data-frame="${l+4}">${l+4}</div>\n    </div>\n</div>`,l+=5,c-=d.$frameWidth;a.insertAdjacentHTML("beforeend",o);const h=["frame-border","frame-border-box","frame-number-space","frame-number"],m=this.markerOver.bind(this),u=this.markerMove.bind(this);for(let e=0;e<h.length;++e){const t=a.getElementsByClassName(h[e]);for(let e=0;e<t.length;++e){const a=t[e];a.addEventListener("mouseover",m),a.addEventListener("mousedown",u)}}for(const a of e._$layers.keys()){const e=document.getElementById(`frame-scroll-id-${a}`);if(!e)continue;let r="",i=s,o=t-n;for(;o>0;)r+=`\n<div class="timeline-frame-group">\n    <div class="frame" data-click-type="frame" data-frame-state="empty" data-layer-id="${a}" id="${a}-${i}" data-frame="${i}"></div>\n    <div class="frame" data-click-type="frame" data-frame-state="empty" data-layer-id="${a}" id="${a}-${i+1}" data-frame="${i+1}"></div>\n    <div class="frame" data-click-type="frame" data-frame-state="empty" data-layer-id="${a}" id="${a}-${i+2}" data-frame="${i+2}"></div>\n    <div class="frame" data-click-type="frame" data-frame-state="empty" data-layer-id="${a}" id="${a}-${i+3}" data-frame="${i+3}"></div>\n    <div class="frame frame-pointer" data-click-type="frame-pointer" data-frame-state="empty" data-layer-id="${a}" id="${a}-${i+4}" data-frame="${i+4}"></div>\n</div>`,i+=5,o-=d.$frameWidth;e.firstElementChild.insertAdjacentHTML("beforeend",r)}}}moveFrames(e,t,a){const s=d.$currentWorkSpace().scene.getLayer(e);for(let r=0;r<a.length;++r){const i=document.getElementById(`${e}-${t}`),n=a[r],o=n.classValues.length;for(let e=0;e<o;++e)i.classList.add(n.classValues[e]);i.dataset.frameState=n.frameState,s._$frame.setClasses(t,n.classValues),t++}}getMoveFrames(e,t,a){const s=d.$currentWorkSpace().scene.getLayer(e);let r=0;for(;;){const i=document.getElementById(`${e}-${t}`),n=i.dataset.frameState;if("empty"===n)return r;const o=[],l=i.classList.length;for(let e=0;e<l;++e){const t=i.classList[e];switch(t){case"frame":case"frame-pointer":continue;case"frame-active":r++;continue;default:o.push(t)}}a.push({frame:t,frameState:n,classValues:o}),this.removeFrameClass(i),s._$frame.deleteClasses(t++)}}addEmptyFrame(){if(this._$targetFrames.length){this._$targetFrames.sort(this.frameSort);const e=this._$targetFrames[0];if(e.classList.contains("tween-frame"))return;if(e.classList.contains("morph-frame"))return;d.$currentWorkSpace().temporarilySaved();const t=0|e.dataset.layerId;let a=0|e.dataset.frame;const s=d.$currentWorkSpace().scene,r=s.getLayer(t);if(!r)return;switch(e.dataset.frameState){default:break;case"key-space-frame-end":{this.removeFrameClass(e),e.classList.add("empty-key-frame"),e.dataset.frameState="empty-key-frame",r._$frame.setClasses(a,["empty-key-frame"]);const i=document.getElementById(`${t}-${a-1}`);"key-frame"===i.dataset.frameState?(i.classList.remove("key-frame-join"),r._$frame.setClasses(a-1,["key-frame"])):(this.removeFrameClass(i),i.classList.add("key-space-frame-end"),i.dataset.frameState="key-space-frame-end",r._$frame.setClasses(a-1,["key-space-frame-end"])),this.splitCharacters(s,r,0|e.dataset.frame,a)}break;case"key-space-frame":{this.removeFrameClass(e),e.classList.add("empty-key-frame"),e.classList.add("empty-key-frame-join"),e.dataset.frameState="empty-key-frame",r._$frame.setClasses(a,["empty-key-frame","empty-key-frame-join"]);const i=document.getElementById(`${t}-${a-1}`);"key-frame"===i.dataset.frameState?(i.classList.remove("key-frame-join"),r._$frame.setClasses(a-1,["key-frame"])):(this.removeFrameClass(i),i.classList.add("key-space-frame-end"),i.dataset.frameState="key-space-frame-end",r._$frame.setClasses(a-1,["key-space-frame-end"]));let n=!1;for(;;){const e=document.getElementById(`${t}-${++a}`),s=e.dataset.frameState;if(this.removeFrameClass(e),"key-space-frame-end"===s?(e.classList.add("empty-space-frame-end"),e.dataset.frameState="empty-space-frame-end",r._$frame.setClasses(a,["empty-space-frame-end"]),n=!0):(e.classList.add("empty-space-frame"),e.dataset.frameState="empty-space-frame",r._$frame.setClasses(a,["empty-space-frame"])),n)break}this.splitCharacters(s,r,0|e.dataset.frame,a)}break;case"empty-space-frame-end":{this.removeFrameClass(e),e.classList.add("empty-key-frame"),e.dataset.frameState="empty-key-frame",r._$frame.setClasses(a,["empty-key-frame"]);const s=document.getElementById(`${t}-${a-1}`);"empty-key-frame"===s.dataset.frameState?(s.classList.remove("empty-key-frame-join"),r._$frame.setClasses(a-1,["empty-key-frame","empty-key-frame-join"])):(this.removeFrameClass(s),s.classList.add("empty-space-frame-end"),s.dataset.frameState="empty-space-frame-end",r._$frame.setClasses(a-1,["empty-space-frame-end"]))}break;case"empty-space-frame":{this.removeFrameClass(e),e.classList.add("empty-key-frame"),e.classList.add("empty-key-frame-join"),e.dataset.frameState="empty-key-frame",r._$frame.setClasses(a,["empty-key-frame","empty-key-frame-join"]);const s=document.getElementById(`${t}-${a-1}`);"empty-key-frame"===s.dataset.frameState?(s.classList.remove("empty-key-frame-join"),r._$frame.setClasses(a-1,["empty-key-frame","empty-key-frame-join"])):(this.removeFrameClass(s),s.classList.add("empty-space-frame-end"),s.dataset.frameState="empty-space-frame-end",r._$frame.setClasses(a-1,["empty-space-frame-end"]))}break;case"empty":if(this.removeFrameClass(e),e.classList.add("empty-key-frame"),e.dataset.frameState="empty-key-frame",r._$frame.setClasses(a,["empty-key-frame"]),1===a)return;let i=!1,n=!1,o=!1,l=a;for(;l;){const e=document.getElementById(`${t}-${--l}`);switch(e.dataset.frameState){case"empty":1===l?(n=!0,e.classList.add("empty-key-frame"),e.dataset.frameState="empty-key-frame",o?(e.classList.add("empty-key-frame-join"),r._$frame.setClasses(l,["empty-key-frame","empty-key-frame-join"])):r._$frame.setClasses(l,["empty-key-frame"])):o?(e.classList.add("empty-space-frame"),e.dataset.frameState="empty-space-frame",r._$frame.setClasses(l,["empty-space-frame"])):(o=!0,e.classList.add("empty-space-frame-end"),e.dataset.frameState="empty-space-frame-end",r._$frame.setClasses(l,["empty-space-frame-end"]));break;case"empty-key-frame":n=!0,o?e.classList.contains("empty-key-frame-join")||(e.classList.add("empty-key-frame-join"),r._$frame.setClasses(l,["empty-key-frame","empty-key-frame-join"])):(e.classList.remove("empty-key-frame-join"),r._$frame.setClasses(l,["empty-key-frame"]));break;case"empty-space-frame-end":n=!0,o&&(e.classList.remove("empty-space-frame-end"),e.classList.add("empty-space-frame"),e.dataset.frameState="empty-space-frame",r._$frame.setClasses(l,["empty-space-frame"]));break;case"key-frame":n=!0,o?(e.classList.contains("key-frame-join")||(e.classList.add("key-frame-join"),r._$frame.setClasses(l,["key-frame","key-frame-join"])),i=!0):(e.classList.remove("key-frame-join"),r._$frame.setClasses(l,["key-frame"]));break;case"key-space-frame-end":n=!0,o&&(e.classList.remove("key-space-frame-end"),e.classList.add("key-space-frame"),e.dataset.frameState="key-space-frame",r._$frame.setClasses(l,["key-space-frame"]),i=!0)}if(n)break}if(i){const e=r.getActiveCharacter(l);for(let t=0;t<e.length;++t){e[t].endFrame=a}for(;;){const e=document.getElementById(`${t}-${++l}`),a=e.dataset.frameState;if(this.removeFrameClass(e),"empty-space-frame-end"===a){e.classList.add("key-space-frame-end"),e.dataset.frameState="key-space-frame-end",r._$frame.setClasses(l,["key-space-frame-end"]);break}e.classList.add("key-space-frame"),e.dataset.frameState="key-space-frame",r._$frame.setClasses(l,["key-space-frame"])}}}this.adjTimeline()}}splitCharacters(e,t,a,s){const r=t.getActiveCharacter(a);for(let e=0;e<r.length;++e){const i=r[e];if(s+1===i.endFrame){for(const e of i._$places.keys())a>e||i.deletePlace(e);i.endFrame=a;continue}const n=i.clone();n.startFrame=s+1;for(const e of n._$places.keys())e>s||n.deletePlace(e);n._$places.size||n.setPlace(n.startFrame,i.clonePlace(a,n.startFrame)),t.addCharacter(n);for(const e of i._$places.keys())a>e||i.deletePlace(e);i.endFrame=a}r.length&&e.changeFrame(a)}deleteFrame(){const e=this._$targetFrames.length;if(e){d.$currentWorkSpace().temporarilySaved(),this._$targetFrames.sort(this.frameSort);const t=this._$targetFrames[0],a=0|t.dataset.layerId,s=0|t.dataset.frame;let r=s,i=!1;const n=t.classList.contains("tween-frame"),o=t.classList.contains("morph-frame"),l=d.$currentWorkSpace().scene,c=l.getLayer(a);let h=!1,m=!1;for(let t=0;t<e;++t){const e=this._$targetFrames[t],s=0|e.dataset.frame;switch(e.dataset.frameState){case"empty-key-frame":h?m=!0:(i=!0,h=!0,e.classList.contains("empty-key-frame-join")||(m=!0),this.removeFrameClass(e),c._$frame.deleteClasses(s));break;case"key-frame":h?m=!0:(i=!0,h=!0,this.removeFrameClass(e),c._$frame.deleteClasses(s));break;case"key-space-frame-end":case"empty-space-frame-end":m=!0;let t=s;for(;;){const e=document.getElementById(`${a}-${--t}`);if(!e)break;let s=!1;switch(e.dataset.frameState){case"empty-key-frame":s=!0,e.classList.remove("empty-key-frame-join"),c._$frame.setClasses(t,["empty-key-frame"]);break;case"key-frame":{s=!0,e.classList.remove("key-frame-join");const a=["key-frame"];n&&(e.classList.add("tween-frame-end"),a.push("tween-frame","tween-frame-end")),o&&(e.classList.add("morph-frame-end"),a.push("morph-frame","morph-frame-end")),c._$frame.setClasses(t,a)}break;case"empty-space-frame":s=!0,e.classList.remove("empty-space-frame"),e.classList.add("empty-space-frame-end"),e.dataset.frameState="empty-space-frame-end",c._$frame.setClasses(t,["empty-space-frame-end"]);break;case"key-space-frame":{s=!0,e.classList.remove("key-space-frame"),e.classList.add("key-space-frame-end"),e.dataset.frameState="key-space-frame-end";const a=["key-space-frame-end"];n&&(e.classList.add("tween-frame-end"),a.push("tween-frame","tween-frame-end")),o&&(e.classList.add("morph-frame-end"),a.push("morph-frame","morph-frame-end")),c._$frame.setClasses(t,a)}break;case"key-space-frame-end":case"empty-space-frame-end":s=!0}if(s)break}this.removeFrameClass(e),c._$frame.deleteClasses(s);break;default:this.removeFrameClass(e),c._$frame.deleteClasses(s)}if(++r,m)break}const u=[];if(this.getMoveFrames(a,r,u),u.length){const e=document.getElementById(`${a}-${s-1}`);if(e)switch(e.dataset.frameState){case"key-space-frame-end":case"empty-space-frame-end":i=!0}else i=!0;if(i){const e=u[0];switch(e.frameState){case"empty-space-frame":case"empty-space-frame-end":e.classValues[0]="empty-key-frame",e.frameState="empty-key-frame",u.length>1&&"empty-key-frame"!==u[1].frameState&&"key-frame"!==u[1].frameState&&e.classValues.push("empty-key-frame-join");break;case"key-space-frame":case"key-space-frame-end":e.classValues[0]="key-frame",e.frameState="key-frame",u.length>1&&"key-frame"!==u[1].frameState&&"empty-key-frame"!==u[1].frameState&&e.classValues.push("key-frame-join")}}this.moveFrames(a,s,u)}for(let t=0;t<e;++t){const e=0|this._$targetFrames[t].dataset.frame,s=document.getElementById(`${a}-${e}`);s.classList.contains("frame-active")||s.classList.add("frame-active")}const f=r-s,g=c._$characters;for(let e=0;e<g.length;++e){const t=g[e];if(s>=t.endFrame)continue;if(t.startFrame===s&&t.endFrame===s+f){c.deleteCharacter(t.id);continue}t.endFrame-=f,t.startFrame>s&&(t.startFrame-=f);const a=Array.from(t._$places);a.sort((function(e,t){switch(!0){case e[0]>t[0]:return 1;case e[0]<t[0]:return-1;default:return 0}}));const r=[];for(let e=0;e<a.length;++e){const i=a[e][1];s>i.frame||(t.deletePlace(i.frame),s!==i.frame&&(i.frame-=f),t.endFrame>i.frame&&r.push(i))}for(let e=0;e<r.length;++e){const a=r[e];t.setPlace(a.frame,a)}}if(s>1){const e=c.getActiveCharacter(s-1),t=c.getActiveCharacter(s);for(let a=0;a<e.length;++a){const r=e[a];if(r.endFrame===s)for(let e=0;e<t.length;++e){const a=t[e];if(a.startFrame===s&&r.libraryId===a.libraryId){r.endFrame=a.endFrame;for(let[e,t]of a._$places)r.setPlace(e,t);c.deleteCharacter(a.id),t.splice(t.indexOf(a),-1);break}}}}d.$screen.clearTweenMarker(),d.$screen.hideTransformTarget(),d.$screen.hideGridTarget(),l.changeFrame(s)}}moveTimeLine(e=0){0>e&&(e=0);const t=document.getElementById("timeline-controller-base"),a=t.scrollWidth-t.offsetWidth;e>a&&(e=a);const s=document.getElementById("timeline-content").children,r=s.length;for(let t=0;t<r;++t)document.getElementById(`frame-scroll-id-${s[t].dataset.layerId}`).scrollLeft=e;t.scrollLeft=e,this._$scrollX=e}getFrameGroupTag(e){return`\n<div class="frame-group">\n    <div class="frame-border-sec-group">\n        <div class="frame-border" data-frame="${e}">${e%fps==0&&fps>4?sec+++"s":""}</div>\n        <div class="frame-border" data-frame="${e+1}">${(e+1)%fps==0&&fps>4?sec+++"s":""}</div>\n        <div class="frame-border" data-frame="${e+2}">${(e+2)%fps==0&&fps>4?sec+++"s":""}</div>\n        <div class="frame-border" data-frame="${e+3}">${(e+3)%fps==0&&fps>4?sec+++"s":""}</div>\n        <div class="frame-border" data-frame="${e+4}">${(e+4)%fps==0&&fps>4?sec+++"s":""}</div>\n    </div>\n    <div class="frame-border-box-group">\n        <div id="frame-label-marker-${e}"     class="frame-border-box" data-frame="${e}"></div>\n        <div id="frame-label-marker-${e+1}" class="frame-border-box" data-frame="${e+1}"></div>\n        <div id="frame-label-marker-${e+2}" class="frame-border-box" data-frame="${e+2}"></div>\n        <div id="frame-label-marker-${e+3}" class="frame-border-box" data-frame="${e+3}"></div>\n        <div id="frame-label-marker-${e+4}" class="frame-border-box" data-frame="${e+4}"></div>\n    </div>\n    <div class="frame-border-box-group">\n        <div id="frame-label-action-${e}"     class="frame-border-box" data-frame="${e}"></div>\n        <div id="frame-label-action-${e+1}" class="frame-border-box" data-frame="${e+1}"></div>\n        <div id="frame-label-action-${e+2}" class="frame-border-box" data-frame="${e+2}"></div>\n        <div id="frame-label-action-${e+3}" class="frame-border-box" data-frame="${e+3}"></div>\n        <div id="frame-label-action-${e+4}" class="frame-border-box" data-frame="${e+4}"></div>\n    </div>\n        <div class="frame-border-box-group">\n        <div id="frame-label-sound-${e}"     class="frame-border-box" data-frame="${e}"></div>\n        <div id="frame-label-sound-${e+1}" class="frame-border-box" data-frame="${e+1}"></div>\n        <div id="frame-label-sound-${e+2}" class="frame-border-box" data-frame="${e+2}"></div>\n        <div id="frame-label-sound-${e+3}" class="frame-border-box" data-frame="${e+3}"></div>\n        <div id="frame-label-sound-${e+4}" class="frame-border-box" data-frame="${e+4}"></div>\n    </div>\n    <div class="frame-number-group">\n        <div class="frame-number-space" data-frame="${e}"></div>\n        <div class="frame-number-space" data-frame="${e+1}"></div>\n        <div class="frame-number-space" data-frame="${e+2}"></div>\n        <div class="frame-number-space" data-frame="${e+3}"></div>\n        <div class="frame-number" data-frame="${e+4}">${e+4}</div>\n    </div>\n</div>`}buildTimeline(){const e=document.getElementById("timeline-frame-marker");for(;e.children.length;)e.children[0].remove();const t=0|document.getElementById("stage-fps").value;let a=1,s=1,r=Math.ceil(1.5*window.parent.screen.width+(d.$currentWorkSpace().scene.totalFrame/5|0)*d.$frameWidth);for(;r>0;){const i=`\n<div class="frame-group">\n    <div class="frame-border-sec-group">\n        <div class="frame-border" data-frame="${s}">${s%t==0&&t>4?a+++"s":""}</div>\n        <div class="frame-border" data-frame="${s+1}">${(s+1)%t==0&&t>4?a+++"s":""}</div>\n        <div class="frame-border" data-frame="${s+2}">${(s+2)%t==0&&t>4?a+++"s":""}</div>\n        <div class="frame-border" data-frame="${s+3}">${(s+3)%t==0&&t>4?a+++"s":""}</div>\n        <div class="frame-border" data-frame="${s+4}">${(s+4)%t==0&&t>4?a+++"s":""}</div>\n    </div>\n    <div class="frame-border-box-group">\n        <div id="frame-label-marker-${s}"     class="frame-border-box" data-frame="${s}"></div>\n        <div id="frame-label-marker-${s+1}" class="frame-border-box" data-frame="${s+1}"></div>\n        <div id="frame-label-marker-${s+2}" class="frame-border-box" data-frame="${s+2}"></div>\n        <div id="frame-label-marker-${s+3}" class="frame-border-box" data-frame="${s+3}"></div>\n        <div id="frame-label-marker-${s+4}" class="frame-border-box" data-frame="${s+4}"></div>\n    </div>\n    <div class="frame-border-box-group">\n        <div id="frame-label-action-${s}"     class="frame-border-box" data-frame="${s}"></div>\n        <div id="frame-label-action-${s+1}" class="frame-border-box" data-frame="${s+1}"></div>\n        <div id="frame-label-action-${s+2}" class="frame-border-box" data-frame="${s+2}"></div>\n        <div id="frame-label-action-${s+3}" class="frame-border-box" data-frame="${s+3}"></div>\n        <div id="frame-label-action-${s+4}" class="frame-border-box" data-frame="${s+4}"></div>\n    </div>\n        <div class="frame-border-box-group">\n        <div id="frame-label-sound-${s}"     class="frame-border-box" data-frame="${s}"></div>\n        <div id="frame-label-sound-${s+1}" class="frame-border-box" data-frame="${s+1}"></div>\n        <div id="frame-label-sound-${s+2}" class="frame-border-box" data-frame="${s+2}"></div>\n        <div id="frame-label-sound-${s+3}" class="frame-border-box" data-frame="${s+3}"></div>\n        <div id="frame-label-sound-${s+4}" class="frame-border-box" data-frame="${s+4}"></div>\n    </div>\n    <div class="frame-number-group">\n        <div class="frame-number-space" data-frame="${s}"></div>\n        <div class="frame-number-space" data-frame="${s+1}"></div>\n        <div class="frame-number-space" data-frame="${s+2}"></div>\n        <div class="frame-number-space" data-frame="${s+3}"></div>\n        <div class="frame-number" data-frame="${s+4}">${s+4}</div>\n    </div>\n</div>\n`;s+=5,e.insertAdjacentHTML("beforeend",i);const n=["frame-border","frame-border-box","frame-number-space","frame-number"],o=this.markerOver.bind(this),l=this.markerMove.bind(this);for(let t=0;t<n.length;++t){const a=e.getElementsByClassName(n[t]);for(let e=0;e<a.length;++e){const t=a[e];t.addEventListener("mouseover",o),t.addEventListener("mousedown",l)}}r-=d.$frameWidth}}markerMove(e){const t=0|e.currentTarget.dataset.frame,a=document.getElementById("current-frame");if((0|a.textContent)===t)return;a.textContent=`${t}`,document.getElementById("timeline-marker").style.left=13*(t-1)+"px",this.resetFrames(),this.changeTarget(),d.$screen.clearActiveCharacter(),d.$controller.setDefaultController(),d.$controller.createSoundListArea();const s=d.$currentWorkSpace().scene;s.changeFrame(t);const r=s.gerLabel(t);document.getElementById("label-name").value=r||"",this._$markerMode||(this._$markerMode=!0,d.$setCursor("ew-resize"))}markerOver(e){this._$markerMode&&this.markerMove(e)}showLayerMenu(e){d.$endMenu("timeline-layer-menu"),this._$layerMenuMode=!0;const t=0|e.currentTarget.dataset.layerId;this._$targetLayer=document.getElementById(`layer-id-${t}`);const a=document.getElementById("timeline-layer-menu");a.style.left=`${e.pageX+5}px`,a.style.top=e.pageY-a.offsetHeight+"px",a.setAttribute("class","fadeIn")}layerNameEditEnd(e){if("focusout"===e.type||"Enter"===e.code){const t=0|e.target.dataset.layerId,a=document.getElementById(`layer-name-${t}`);d.$currentWorkSpace().scene.getLayer(t).name=e.target.value,a.textContent=e.target.value,a.style.display="",e.target.style.display="none",d.$keyLock=!1}}createChild(){const e=d.$currentWorkSpace().scene,t=e._$layerId,a=document.getElementById("timeline-content");let s=1,r=`\n<div class="timeline-content-child" id="layer-id-${t}" data-layer-id="${t}">\n\n    <div class="timeline-layer-controller">\n        <i class="timeline-layer-move-icon" id="move-id-${t}" data-layer-id="${t}" data-detail="{{上下に移動}}"></i>\n        <i class="timeline-layer-icon" id="layer-icon-${t}" data-layer-id="${t}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-mask-icon" id="layer-mask-icon-${t}" data-layer-id="${t}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-mask-in-icon" id="layer-mask-in-icon-${t}"></i>\n        <i class="timeline-sound-icon" id="layer-sound-icon-${t}" data-layer-id="${t}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <div class="view-text" id="layer-name-${t}" data-layer-id="${t}">layer_${t}</div>\n        <input type="text" class="view-text-input" id="layer-name-input-${t}" data-layer-id="${t}" value="layer_${t}" style="display: none;">\n        <i class="timeline-layer-light-one icon-disable" id="layer-light-icon-${t}" data-click-type="light" data-layer-id="${t}" data-detail="{{レイヤーをハイライト}}"></i>\n        <i class="timeline-layer-disable-one icon-disable" id="layer-disable-icon-${t}" data-click-type="disable" data-layer-id="${t}" data-detail="{{レイヤーを非表示}}"></i>\n        <i class="timeline-layer-lock-one icon-disable" id="layer-lock-icon-${t}" data-click-type="lock" data-layer-id="${t}" data-detail="{{レイヤーをロック}}"></i>\n    </div>\n\n    <div class="timeline-frame-controller" id="frame-scroll-id-${t}">\n        <div class="timeline-frame">\n`,i=Math.ceil(1.5*window.parent.screen.width+(d.$currentWorkSpace().scene.totalFrame/5|0)*d.$frameWidth);for(;i>0;)r+=`\n<div class="timeline-frame-group">\n    <div class="frame" data-click-type="frame" data-frame-state="empty" data-layer-id="${t}" id="${t}-${s}" data-frame="${s++}"></div>\n    <div class="frame" data-click-type="frame" data-frame-state="empty" data-layer-id="${t}" id="${t}-${s}" data-frame="${s++}"></div>\n    <div class="frame" data-click-type="frame" data-frame-state="empty" data-layer-id="${t}" id="${t}-${s}" data-frame="${s++}"></div>\n    <div class="frame" data-click-type="frame" data-frame-state="empty" data-layer-id="${t}" id="${t}-${s}" data-frame="${s++}"></div>\n    <div class="frame frame-pointer" data-click-type="frame-pointer" data-frame-state="empty" data-layer-id="${t}" id="${t}-${s}" data-frame="${s++}"></div>\n</div>\n`,i-=d.$frameWidth;r+="\n        </div>\n    </div>\n</div>\n",a.insertAdjacentHTML("beforeend",r),document.getElementById(`move-id-${t}`).addEventListener("mousedown",function(e){this._$moveId=0|e.target.dataset.layerId,this._$moveLayer=document.getElementById(`layer-id-${this._$moveId}`)}.bind(this)),document.getElementById(`layer-name-${t}`).addEventListener("dblclick",function(e){d.$keyLock=!0;const t=0|e.target.dataset.layerId,a=document.getElementById(`layer-name-input-${t}`);a.value=e.target.textContent,a.style.display="",a.focus(),e.target.style.display="none"}.bind(this));const n=document.getElementById(`layer-name-input-${t}`);n.addEventListener("focusout",this.layerNameEditEnd),n.addEventListener("keypress",this.layerNameEditEnd),document.getElementById(`layer-icon-${t}`).addEventListener("dblclick",this._$showLayerMenu),document.getElementById(`layer-mask-icon-${t}`).addEventListener("dblclick",this._$showLayerMenu),document.getElementById(`layer-sound-icon-${t}`).addEventListener("dblclick",this._$showLayerMenu);const o=document.getElementById(`layer-id-${t}`);d.$addModalEvent(o),o.addEventListener("wheel",function(e){const t=0|e.deltaX;if(!t)return!1;e.preventDefault(),this._$scrollX+=t,this.moveTimeLine(this._$scrollX)}.bind(this),{passive:!1}),o.addEventListener("mouseover",function(e){const t=0|e.currentTarget.dataset.layerId;this._$moveId>-1&&this._$moveId!==t&&(this._$moveTarget=e.currentTarget,this._$moveTarget.classList.contains("move-target")||this._$moveTarget.classList.add("move-target"));const a=e.target;switch(a.dataset.clickType){case"frame":case"frame-pointer":if(document.getElementById("timeline-preview").classList.contains("timeline-preview-active")){const s=d.$currentWorkSpace(),r=0|a.dataset.frame,i=s.scene.getLayer(t),n=i.getActiveCharacter(r);if(n.length){clearTimeout(this._$previewTimerId),i.sort(n,r);const t=document.getElementById("timeline-preview-modal");let a="";t.children.length&&(a=t.children[0].dataset.cacheKey);const o=[];for(let e=0;e<n.length;++e){const t=n[e];if(t.hasPlace(r)){o.length=0;break}o.push(t.id)}if(!o.length||a!==o.join("_")){const{Sprite:e,BitmapData:a}=window.next2d.display,{Matrix:i,ColorTransform:l}=window.next2d.geom,c=new e;let h=Number.MAX_VALUE,m=-Number.MAX_VALUE,u=Number.MAX_VALUE,f=-Number.MAX_VALUE;o.length=0;for(let e=0;e<n.length;++e){const t=n[e];o.push(t.id);const a=t.getPlace(r),g=d.$boundsMatrix(t.getBounds(),a.matrix);h=Math.min(h,g.xMin),m=Math.max(m,g.xMax),u=Math.min(u,g.yMin),f=Math.max(f,g.yMax);const y=s.getLibrary(t.libraryId).createInstance();y.transform.matrix=new i(a.matrix[0],a.matrix[1],a.matrix[2],a.matrix[3],a.matrix[4],a.matrix[5]),y.transform.colorTransform=new l(a.colorTransform[0],a.colorTransform[1],a.colorTransform[2],a.colorTransform[3],a.colorTransform[4],a.colorTransform[5],a.colorTransform[6],a.colorTransform[7]),c.addChild(y)}const g=Math.ceil(Math.abs(m-h)),y=Math.ceil(Math.abs(f-u)),$=Math.min(120/g,120/y),p=window.devicePixelRatio,b=new a(g*$*p,y*$*p,!0,0),_=new i(p,0,0,p,-h*p,-u*p);for(_.scale($,$),b.draw(c,_);t.children.length;)t.children[0].remove();const v=b.toImage();v.width=v.width/p,v.height=v.height/p,t.appendChild(v),v.dataset.cacheKey=o.join("_")}t.style.display="",t.style.backgroundColor=document.getElementById("stage-bgColor").value,t.style.left=`${e.pageX+10}px`,t.style.top=e.pageY-t.offsetHeight-10+"px",t.classList.contains("fadeIn")||t.setAttribute("class","fadeIn")}}}}.bind(this)),o.addEventListener("mouseout",function(e){const t=0|e.currentTarget.dataset.layerId;this._$moveId>-1&&this._$moveId!==t&&(e.currentTarget.classList.remove("move-target"),this._$moveTarget=null);const a=document.getElementById("timeline-preview-modal");a.classList.contains("fadeOut")||(this._$previewTimerId=setTimeout(function(){this.classList.contains("fadeOut")||this.setAttribute("class","fadeOut")}.bind(a),1e3))}.bind(this)),o.addEventListener("mousedown",function(e){if(2===e.button)return;const t=document.getElementById("timeline-preview-modal");t.classList.contains("fadeOut")||t.setAttribute("class","fadeOut"),e.currentTarget!==this._$targetLayer&&(this._$targetLayer&&this._$targetLayer.classList.remove("active"),d.$screen.clearActiveCharacter(),this._$targetLayer=e.currentTarget,this._$targetLayer.classList.add("active"));switch(e.target.dataset.clickType){case"frame":case"frame-pointer":{const t=document.getElementById("label-name"),a=document.getElementById("current-frame");this._$labelFrame&&this.setLabelMarker({code:"Enter",currentTarget:{value:t.value}}),t.value="";const s=e.target,r=0|s.dataset.frame,i=d.$currentWorkSpace().scene,n=i.gerLabel(r);if(n&&(t.value=n),s.classList.contains("key-frame")||s.classList.contains("key-space-frame")||s.classList.contains("key-space-frame-end")?d.$controller.showObjectArea():d.$controller.hideObjectArea(),s.classList.contains("tween-frame")||d.$screen.clearTweenMarker(),s.classList.contains("frame-active")){this._$targetFrames.sort(this.frameSort);const t=this._$targetFrames[0],a=document.getElementById("target-group");let s=t.offsetLeft-this._$scrollX;const r=document.getElementById("timeline-content");for(a.style.display="",a.style.width=13*this._$targetFrames.length-5+"px",a.style.left=`${s}px`,a.style.top=t.offsetTop-r.scrollTop+"px";!(s+13>e.clientX);)s+=13;a.dataset.positionL=`${s}`,a.dataset.positionR=`${s+13}`,a.dataset.layerId=t.dataset.layerId,a.dataset.frame=t.dataset.frame}else d.$screen.clear(),a.textContent=`${r}`,document.getElementById("timeline-marker").style.left=13*(r-1)+"px",this.resetFrames(),this._$multiMode=!0,this._$targetFrames.push(e.target),this._$targetFrame=e.target,this._$targetFrame.classList.add("frame-active"),i.currentFrame!==r&&i.changeFrame(r);i.clearActiveCharacter();const o=i.getLayer(0|e.target.dataset.layerId).getActiveCharacter(r);for(let e=0;e<o.length;++e){const t=document.getElementById(`character-${o[e].id}`);t&&d.$screen.addTarget(t,0,0,!0)}d.$activeScript&&i.hasAction(this._$actionFrame)&&(this.saveActionScript(),this.showScriptArea()),d.$controller.setDefaultController(),d.$controller.createSoundListArea(),d.$canCopyLayer=!1,d.$canCopyCharacter=!0}break;default:this.resetFrames(),this.changeTarget(),d.$canCopyLayer=!0,d.$canCopyCharacter=!1}}.bind(this)),o.addEventListener("mousemove",function(e){if(this._$multiMode){if(this._$targetLayer&&e.currentTarget.dataset.layerId!==this._$targetLayer.dataset.layerId)return;let t=null;const a=e.target.dataset.clickType;if("frame"===a||"frame-pointer"===a){const a=e.target.classList;a.contains("frame-active")||(this._$targetFrames.push(e.target),a.add("frame-active")),t=0|e.target.id.split("-")[1]}if(t){const e=0|this._$targetFrame.id.split("-")[1],a=Math.min(e,t),s=Math.max(e,t)+1,r=s-a;if(this._$targetFrames.length!==r){const e=this._$targetFrame;this.resetFrames();const t=e.dataset.layerId;for(let e=a;e<s;++e){const a=document.getElementById(`${t}-${e}`);a.classList.add("frame-active"),this._$targetFrames.push(a)}this._$targetFrame=e}}}else{switch(e.target.dataset.clickType){case"frame":case"frame-pointer":const t=document.getElementById("target-group");if("none"!==t.style.display){const a=e.target;let s=0|a.dataset.layerId;const r=document.getElementById(`frame-scroll-id-${s}`);if(a.offsetLeft+a.offsetWidth>r.offsetLeft+r.offsetWidth)return;if(r.offsetLeft>a.offsetLeft-13)return;const i=document.getElementById("timeline-content"),n=a.offsetLeft-this._$scrollX;if((0|t.dataset.layerId)!==s)return t.dataset.layerId=a.dataset.layerId,t.dataset.frame=a.dataset.frame,a.offsetTop+a.offsetHeight>i.offsetTop+i.offsetHeight&&(i.scrollTop+=a.offsetTop+a.offsetHeight-(i.offsetTop+i.offsetHeight)+10),i.offsetTop+i.scrollTop>a.offsetTop&&(i.scrollTop=a.offsetTop-i.offsetTop-10),void(t.style.top=a.offsetTop-i.scrollTop+"px");t.dataset.layerId=a.dataset.layerId,t.dataset.frame=a.dataset.frame,t.style.left=`${n}px`,t.style.top=a.offsetTop-i.scrollTop+"px",t.dataset.positionL=`${n}`,t.dataset.positionR=`${n+13}`}}}}.bind(this)),o.addEventListener("mouseup",function(e){if(!this._$multiMode&&-1===this._$moveId){const t=e.target.dataset.clickType,a=e.target.classList;switch(t){case"light":case"disable":case"lock":const s=0|e.target.dataset.layerId,r=document.getElementById(`layer-id-${s}`),i=d.$currentWorkSpace().scene,n=i.getLayer(s);if(a.contains("icon-disable")?(a.remove("icon-disable"),a.add("icon-active"),r.classList.add(`${t}-active`),n[t]=!0):(a.remove("icon-active"),a.add("icon-disable"),r.classList.remove(`${t}-active`),n[t]=!1),"light"!==t){const e=0|document.getElementById("current-frame").textContent;i.changeFrame(e),d.$screen.hideTransformTarget(),d.$screen.hideGridTarget()}}}this._$multiMode=!1,document.getElementById("target-group").style.display="none"}.bind(this));const l=document.getElementById(`frame-scroll-id-${t}`);l.addEventListener("contextmenu",this._$showTimeLineContextMenu),l.scrollLeft=this._$scrollX,e._$layerId++}showTimeLineContextMenu(e){this._$multiMode=!1,this._$menuMode=!0;const t=document.getElementById("timeline-menu");t.style.left=`${e.pageX+5}px`,t.style.top=e.pageY-t.clientHeight+"px",t.setAttribute("class","fadeIn"),d.$endMenu("timeline-menu")}removeLayer(){if(this._$targetLayer){d.$currentWorkSpace().temporarilySaved();const e=d.$currentWorkSpace().scene,t=document.getElementById("timeline-content"),a=Array.from(t.children).indexOf(this._$targetLayer),s=0|this._$targetLayer.dataset.layerId;if(e.getLayer(s)._$mode===d.LAYER_MODE_MASK){const s=t.children;for(let t=a+1;t<s.length;++t){const a=s[t],r=e.getLayer(0|a.dataset.layerId);if(r._$mode!==d.LAYER_MODE_MASK_IN)break;r._$mode=d.LAYER_MODE_NORMAL,r.showIcon()}}this._$targetLayer.remove(),this._$targetLayer=null,t.children.length&&(this._$targetLayer=t.children.length>a?t.children[a]:t.children[a-1],this._$targetLayer.classList.add("active")),d.$screen.clearTweenMarker(),e.deleteLayer(s),e.changeFrame(0|document.getElementById("current-frame").textContent)}}resetFrames(){const e=this._$targetFrames.length;if(e){for(let t=0;t<e;++t){this._$targetFrames[t].classList.remove("frame-active")}this._$targetFrames.length=0}this._$targetFrame=null}changeTarget(){if(this._$targetLayer){const e=0|document.getElementById("current-frame").textContent,t=0|this._$targetLayer.dataset.layerId,a=document.getElementById(`${t}-${e}`);a.classList.add("frame-active"),this._$targetFrame=a,this._$targetFrames.push(a)}}addKeyFrame(){if(this._$targetFrames.length){this._$targetFrames.sort(this.frameSort);const e=this._$targetFrames[0];if(e.classList.contains("tween-frame"))return;if(e.classList.contains("morph-frame"))return;switch(e.dataset.frameState){case"key-space-frame":case"key-space-frame-end":this.dropKeyFrame(e);break;default:this.addEmptyFrame(),this.adjTimeline()}}}dropKeyFrame(e){d.$currentWorkSpace().temporarilySaved();const t=0|e.dataset.layerId,a=0|e.dataset.frame,s=d.$currentWorkSpace().scene.getLayer(t),r=e.dataset.frameState;switch(r){case"empty":if(e.classList.add("key-frame"),e.dataset.frameState="key-frame",s._$frame.setClasses(a,["key-frame"]),a>1){let e=a;for(;e>0;){const r=document.getElementById(`${t}-${--e}`);if("empty"===r.dataset.frameState)if(1===e){const t=["empty-key-frame"];r.classList.add("empty-key-frame"),a>2&&(r.classList.add("empty-key-frame-join"),t.push("empty-key-frame-join")),r.dataset.frameState="empty-key-frame",s._$frame.setClasses(e,t),e=0}else r.classList.add("empty-space-frame"),r.dataset.frameState="empty-space-frame",s._$frame.setClasses(e,["empty-space-frame"]);else{if(++e,a!==e){const a=document.getElementById(`${t}-${e}`);this.removeFrameClass(a),a.classList.add("empty-key-frame"),a.dataset.frameState="empty-key-frame",s._$frame.setClasses(e,["empty-key-frame"]);document.getElementById(`${t}-${++e}`).dataset.frameState.indexOf("empty-space-frame")>-1&&(a.classList.add("empty-key-frame-join"),s._$frame.setClasses(e-1,["empty-key-frame","empty-key-frame-join"]))}e=0}}const r=document.getElementById(`${t}-${a-1}`);"empty-space-frame"===r.dataset.frameState&&(this.removeFrameClass(r),r.classList.add("empty-space-frame-end"),r.dataset.frameState="empty-space-frame-end",s._$frame.setClasses(a-1,["empty-space-frame-end"]))}break;case"key-space-frame-end":case"key-space-frame":{this.removeFrameClass(e),e.classList.add("key-frame"),e.dataset.frameState="key-frame","key-space-frame"===r?(e.classList.add("key-frame-join"),s._$frame.setClasses(a,["key-frame","key-frame-join"])):s._$frame.setClasses(a,["key-frame"]);let i=a;const n=document.getElementById(`${t}-${--i}`);switch(n.dataset.frameState){case"key-frame":n.classList.remove("key-frame-join"),s._$frame.setClasses(i,["key-frame"]);break;case"key-space-frame":this.removeFrameClass(n),n.classList.add("key-space-frame-end"),n.dataset.frameState="key-space-frame-end",s._$frame.setClasses(i,["key-space-frame-end"])}const o=s.getActiveCharacter(a);for(let e=0;e<o.length;++e){const t=o[e];t.setPlace(a,t.clonePlace(a,a))}}break;case"empty-key-frame":{this.removeFrameClass(e),e.classList.add("key-frame"),e.dataset.frameState="key-frame",s._$frame.setClasses(a,["key-frame"]);let r=a;switch(document.getElementById(`${t}-${r+1}`).dataset.frameState){case"empty":case"key-frame":case"empty-key-frame":break;default:for(e.classList.add("key-frame-join"),s._$frame.setClasses(r,["key-frame","key-frame-join"]);;){const e=document.getElementById(`${t}-${++r}`),a="empty-space-frame"===e.dataset.frameState?"key-space-frame":"key-space-frame-end";if(this.removeFrameClass(e),e.classList.add(a),e.dataset.frameState=a,s._$frame.setClasses(r,[a]),"key-space-frame-end"===a)break}}}break;case"empty-space-frame-end":{this.removeFrameClass(e),e.classList.add("key-frame"),e.dataset.frameState="key-frame",s._$frame.setClasses(a,["key-frame"]);let r=a;const i=document.getElementById(`${t}-${--r}`);"empty-space-frame"===i.dataset.frameState?(this.removeFrameClass(i),i.classList.add("empty-space-frame-end"),i.dataset.frameState="empty-space-frame-end",s._$frame.setClasses(r,["empty-space-frame-end"])):(i.classList.remove("empty-key-frame-join"),s._$frame.setClasses(r,["empty-key-frame"]))}break;case"empty-space-frame":{this.removeFrameClass(e),e.classList.add("key-frame"),e.dataset.frameState="key-frame",s._$frame.setClasses(a,["key-frame"]);let r=a;const i=document.getElementById(`${t}-${r-1}`);switch(i.dataset.frameState){case"key-frame":i.classList.remove("key-frame-join"),s._$frame.setClasses(r-1,["key-frame"]);break;case"empty-key-frame":i.classList.remove("empty-key-frame-join"),s._$frame.setClasses(r-1,["empty-key-frame"]);break;case"key-space-frame":this.removeFrameClass(i),i.classList.add("key-space-frame-end"),i.dataset.frameState="key-space-frame-end",s._$frame.setClasses(r-1,["key-space-frame-end"]);break;case"empty-space-frame":this.removeFrameClass(i),i.classList.add("empty-space-frame-end"),i.dataset.frameState="empty-space-frame-end",s._$frame.setClasses(r-1,["empty-space-frame-end"])}for(;;){const i=document.getElementById(`${t}-${++r}`),n="empty-space-frame"===i.dataset.frameState?"key-space-frame":"key-space-frame-end";if(this.removeFrameClass(i),i.classList.add(n),i.dataset.frameState=n,s._$frame.setClasses(r,[n]),"key-space-frame-end"===n){e.classList.add("key-frame-join"),s._$frame.setClasses(a,["key-frame","key-frame-join"]);break}}}}d.$timeline.adjTimeline()}};d.$tools=new class{constructor(){this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler),this._$activeTool=null}initialize(){window.removeEventListener("DOMContentLoaded",this._$handler),d.$addModalEvent(document);const e=document.getElementById("tools").children;for(let t=0;t<e.length;++t){const a=e[t];if("tool"!==a.dataset.mode)continue;const s=a.getElementsByTagName("span")[0];s&&(this._$activeTool||(s.classList.add("active"),this._$activeTool=s),s.addEventListener("mousedown",function(e){this._$activeTool&&this._$activeTool.classList.remove("active");const t=e.target;t.classList.add("active"),this._$activeTool=t}.bind(this)))}const t=document.getElementById("fill-color");t.value=localStorage.getItem(`${d.PREFIX}@fill-color`)||d.TOOLS_FILL_DEFAULT_COLOR,t.addEventListener("change",(function(e){localStorage.setItem(`${d.PREFIX}@fill-color`,e.target.value)}));const a=document.getElementById("stroke-color");a.value=localStorage.getItem(`${d.PREFIX}@stroke-color`)||d.TOOLS_STROKE_DEFAULT_COLOR,a.addEventListener("change",function(e){switch(localStorage.setItem(`${d.PREFIX}@stroke-color`,e.target.value),d.$tools._$activeTool.dataset.name){case"draw-pen":this.setPenColor();break;case"color-bucket":this.setBucketColor()}}.bind(this));const s=document.getElementById("stroke-size");s.value=localStorage.getItem(`${d.PREFIX}@stroke-size`)||d.STROKE_MIN_SIZE,s.addEventListener("focusout",function(e){switch(localStorage.setItem(`${d.PREFIX}@stroke-size`,e.target.value),d.$tools._$activeTool.dataset.name){case"draw-pen":this.setPenColor();break;case"color-bucket":this.setBucketColor()}}.bind(this)),this.initializeData(),this.initializeSetting(),this.initializeUserSetting(),d.$initializeEnd(),this._$handler=null}initializeSetting(){document.getElementById("tools-discord").addEventListener("click",(function(){const e=document.createElement("a");e.href="https://discord.gg/6c9rv5Uns5",e.target="_blank",e.rel="noopener noreferrer",e.click()})),document.getElementById("tools-bug").addEventListener("click",(function(){const e=document.createElement("a");e.href="https://github.com/Next2D/tool.next2d.app/issues",e.target="_blank",e.rel="noopener noreferrer",e.click()})),document.getElementById("tools-usage").addEventListener("click",(function(){const e=document.createElement("a");e.href="https://next2d.app/en/usage/",e.target="_blank",e.rel="noopener noreferrer",e.click()})),document.getElementById("tools-arrow").addEventListener("click",function(){d.$screen._$cursorCache=null,this.activeStageAreaNode(),d.$setCursor("auto")}.bind(this)),document.getElementById("tools-rectangle").addEventListener("click",function(){d.$screen._$cursorCache=null,this.deactiveStageAreaNode(),d.$setCursor('url(\'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path d="M24 11h-2.051c-.469-4.725-4.224-8.48-8.949-8.95v-2.05h-2v2.05c-4.725.47-8.48 4.225-8.949 8.95h-2.051v2h2.051c.469 4.725 4.224 8.48 8.949 8.95v2.05h2v-2.05c4.725-.469 8.48-4.225 8.949-8.95h2.051v-2zm-11 8.931v-3.931h-2v3.931c-3.611-.454-6.478-3.32-6.931-6.931h3.931v-2h-3.931c.453-3.611 3.32-6.477 6.931-6.931v3.931h2v-3.931c3.611.454 6.478 3.319 6.931 6.931h-3.931v2h3.931c-.453 3.611-3.32 6.477-6.931 6.931zm1-7.931c0 1.104-.896 2-2 2s-2-.896-2-2 .896-2 2-2 2 .896 2 2z"/></svg>\'),auto')}.bind(this)),document.getElementById("tools-circle").addEventListener("click",function(){d.$screen._$cursorCache=null,this.deactiveStageAreaNode(),d.$setCursor('url(\'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path d="M24 11h-2.051c-.469-4.725-4.224-8.48-8.949-8.95v-2.05h-2v2.05c-4.725.47-8.48 4.225-8.949 8.95h-2.051v2h2.051c.469 4.725 4.224 8.48 8.949 8.95v2.05h2v-2.05c4.725-.469 8.48-4.225 8.949-8.95h2.051v-2zm-11 8.931v-3.931h-2v3.931c-3.611-.454-6.478-3.32-6.931-6.931h3.931v-2h-3.931c.453-3.611 3.32-6.477 6.931-6.931v3.931h2v-3.931c3.611.454 6.478 3.319 6.931 6.931h-3.931v2h3.931c-.453 3.611-3.32 6.477-6.931 6.931zm1-7.931c0 1.104-.896 2-2 2s-2-.896-2-2 .896-2 2-2 2 .896 2 2z"/></svg>\'),auto')}.bind(this)),document.getElementById("tools-round-rect").addEventListener("click",function(){d.$screen._$cursorCache=null,this.deactiveStageAreaNode(),d.$setCursor('url(\'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path d="M24 11h-2.051c-.469-4.725-4.224-8.48-8.949-8.95v-2.05h-2v2.05c-4.725.47-8.48 4.225-8.949 8.95h-2.051v2h2.051c.469 4.725 4.224 8.48 8.949 8.95v2.05h2v-2.05c4.725-.469 8.48-4.225 8.949-8.95h2.051v-2zm-11 8.931v-3.931h-2v3.931c-3.611-.454-6.478-3.32-6.931-6.931h3.931v-2h-3.931c.453-3.611 3.32-6.477 6.931-6.931v3.931h2v-3.931c3.611.454 6.478 3.319 6.931 6.931h-3.931v2h3.931c-.453 3.611-3.32 6.477-6.931 6.931zm1-7.931c0 1.104-.896 2-2 2s-2-.896-2-2 .896-2 2-2 2 .896 2 2z"/></svg>\'),auto')}.bind(this)),document.getElementById("tools-text").addEventListener("click",function(){d.$screen._$cursorCache=null,this.deactiveStageAreaNode(),d.$setCursor("text")}.bind(this)),document.getElementById("tools-transform").addEventListener("click",function(){d.$screen._$cursorCache=null,this.activeStageAreaNode(),d.$setCursor('url(\'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48"><path fill="white" d="M27.8,39.7c-0.1,0-0.2,0-0.4-0.1c-0.2-0.1-0.4-0.3-0.6-0.5l-3.7-8.6l-4.5,4.2C18.5,34.9,18.3,35,18,35c-0.1,0-0.3,0-0.4-0.1C17.3,34.8,17,34.4,17,34l0-22c0-0.4,0.2-0.8,0.6-0.9C17.7,11,17.9,11,18,11c0.2,0,0.5,0.1,0.7,0.3l16,15c0.3,0.3,0.4,0.7,0.3,1.1c-0.1,0.4-0.5,0.6-0.9,0.7l-6.3,0.6l3.9,8.5c0.1,0.2,0.1,0.5,0,0.8c-0.1,0.2-0.3,0.5-0.5,0.6l-2.9,1.3C28.1,39.7,27.9,39.7,27.8,39.7z"/><path fill="black" d="M18,12l16,15l-7.7,0.7l4.5,9.8l-2.9,1.3l-4.3-9.9L18,34L18,12 M18,10c-0.3,0-0.5,0.1-0.8,0.2c-0.7,0.3-1.2,1-1.2,1.8l0,22c0,0.8,0.5,1.5,1.2,1.8C17.5,36,17.8,36,18,36c0.5,0,1-0.2,1.4-0.5l3.4-3.2l3.1,7.3c0.2,0.5,0.6,0.9,1.1,1.1c0.2,0.1,0.5,0.1,0.7,0.1c0.3,0,0.5-0.1,0.8-0.2l2.9-1.3c0.5-0.2,0.9-0.6,1.1-1.1c0.2-0.5,0.2-1.1,0-1.5l-3.3-7.2l4.9-0.4c0.8-0.1,1.5-0.6,1.7-1.3c0.3-0.7,0.1-1.6-0.5-2.1l-16-15C19,10.2,18.5,10,18,10L18,10z"/></svg>\'),auto')}.bind(this)),document.getElementById("tools-pen").addEventListener("click",function(){d.$screen._$cursorCache=null,this.activeStageAreaNode(),this.setPenColor()}.bind(this)),document.getElementById("tools-bucket").addEventListener("click",function(){d.$screen._$cursorCache=null,this.activeStageAreaNode(),this.setBucketColor()}.bind(this)),document.getElementById("tools-setting").addEventListener("click",(function(e){const t=document.getElementById("user-setting");t.style.display="",t.style.left=`${e.pageX+30}px`,t.style.top=e.pageY-t.clientHeight+"px",t.setAttribute("class","fadeIn"),d.$endMenu("user-setting")}))}getUserPublishSetting(){const e=localStorage.getItem(`${d.PREFIX}@user-publish-setting`);return e?JSON.parse(e):{layer:!1,type:"zlib"}}initializeUserSetting(){const e=this.getUserPublishSetting(),t=document.getElementById("publish-layer-setting");t.children[e.layer?1:0].selected=!0,t.addEventListener("change",function(e){const t=this.getUserPublishSetting();t.layer="1"===e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))}.bind(this));const a=document.getElementById("publish-type-setting");for(let t=0;t<a.children.length;++t){const s=a.children[t];if(e.type===s.value){s.selected=!0;break}}a.addEventListener("change",function(e){const t=this.getUserPublishSetting();t.type=e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))}.bind(this));const s=document.getElementById("modal-setting");"modal"in e&&(s.children[e.modal?0:1].selected=!0),s.addEventListener("change",function(e){const t=this.getUserPublishSetting();t.modal="1"===e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))}.bind(this))}deactiveStageAreaNode(){d.$screen._$shapeMovePointer=!1,d.$screen._$shapeMoveTarget=null,d.$hitColor=null;const e=document.getElementById("stage-area").children;for(let t=0;t<e.length;++t){const a=e[t];a.dataset.shapePointer?(a.remove(),--t):a.dataset.child&&(a.style.pointerEvents="none")}}setPenColor(){const e=d.$intToRGB(0|`0x${document.getElementById("stroke-color").value.substr(1)}`),t=0|document.getElementById("stroke-size").value;d.$setCursor(`url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${t}" viewBox="0 0 24 24"><circle fill="rgb(${e.R},${e.G},${e.B})" cx="12" cy="12" r="12"/></svg>'),auto`)}setBucketColor(){const e=d.$intToRGB(0|`0x${document.getElementById("fill-color").value.substr(1)}`);d.$setCursor(`url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="rgb(${e.R},${e.G},${e.B})" d="M24 19.007c0-3.167-1.409-6.771-2.835-9.301l-.006-.01-.014-.026c-.732-1.392-1.914-3.052-3.619-4.757-2.976-2.976-5.476-3.912-6.785-3.913-.413 0-.708.094-.859.245l-.654.654c-1.898-.236-3.42.105-4.294.982-.876.875-1.164 2.159-.792 3.524.242.893.807 1.891 1.752 2.836.867.867 2.062 1.684 3.615 2.327.488-.839 1.654-1.019 2.359-.315.586.586.584 1.533-.002 2.119s-1.533.589-2.121 0c-.229-.229-.366-.515-.416-.812-1.646-.657-3.066-1.534-4.144-2.612-.728-.728-1.289-1.528-1.664-2.349l-2.835 2.832c-.445.447-.685 1.064-.686 1.82.001 1.635 1.122 3.915 3.714 6.506 2.764 2.764 5.58 4.243 7.431 4.243.649 0 1.181-.195 1.548-.562l8.086-8.079c.911.875-.777 3.541-.777 4.65 0 1.104.896 1.999 2 1.998 1.104 0 1.998-.895 1.998-2zm-18.912-12.974c-.236-.978-.05-1.845.554-2.444.526-.53 1.471-.791 2.656-.761l-3.21 3.205zm9.138 2.341l-.03-.029c-1.29-1.291-3.802-4.354-3.095-5.062.715-.715 3.488 1.521 5.062 3.095.862.863 2.088 2.248 2.938 3.459-1.718-1.073-3.493-1.469-4.875-1.463zm-3.875 12.348c-.547-.082-1.5-.547-1.9-.928l7.086-7.086c.351.37 1.264.931 1.753 1.075l-6.939 6.939z"/></svg>'),auto`)}activeStageAreaNode(){d.$screen._$shapeMovePointer=!1,d.$screen._$shapeMoveTarget=null,d.$hitColor=null;const e=document.getElementById("stage-area").children;for(let t=0;t<e.length;++t){const a=e[t];a.dataset.shapePointer?(a.remove(),--t):a.dataset.child&&(a.style.pointerEvents="auto")}}initializeData(){document.getElementById("tools-load").addEventListener("click",(function(e){document.getElementById("tools-load-file-input").click(),e.preventDefault()}));document.getElementById("tools-load-file-input").addEventListener("change",function(e){const t=e.target.files;for(let e=0;e<t.length;++e)this.loadSaveFile(t[e]);e.target.value=""}.bind(this));document.getElementById("tools-save").addEventListener("click",(function(){const e={object:d.$currentWorkSpace().toJSON(),type:"n2d"};d.$zlibWorkerActive?d.$zlibQueues.push(e):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(e))}));document.getElementById("tools-export").addEventListener("click",(function(){const e=document.getElementById("save-anchor");e.href&&URL.revokeObjectURL(e.href);switch(document.getElementById("publish-type-setting").value){case"json":e.download=`${d.$currentWorkSpace().name}.json`,e.href=URL.createObjectURL(new Blob([u.toJSON()],{type:"application/json"})),e.click();break;case"zlib":u.toZlib();break;case"webm":u.toWebM();break;case"gif-loop":u.toGIF();break;case"gif":u.toGIF(-1);break;case"png":u.toPng();break;case"apng-loop":u.toApng(!0);break;case"apng":u.toApng(!1);break;case"custom":"CustomPublish"in window&&window.CustomPublish.execute(u.toObject())}}));const e=document.getElementById("language-setting"),t=localStorage.getItem(`${d.PREFIX}@language-setting`);if(t){const a=e.children;for(let e=0;e<a.length;++e){const s=a[e];if(s.value===t){s.selected=!0;break}}}e.addEventListener("change",(function(e){const t=e.target.value,a=d.$languages.get(t);d.$currentLanguage=new a,localStorage.setItem(`${d.PREFIX}@language-setting`,t),d.$addModalEvent(document)}))}loadSaveFile(e){e.arrayBuffer().then((function(e){const t=new Uint8Array(e);d.$unZlibWorker.postMessage({buffer:t,type:"n2d"},[t.buffer])}))}reset(){this.activeStageAreaNode(),d.$setCursor("auto"),this._$activeTool&&this._$activeTool.classList.remove("active");const e=document.getElementById("tools-arrow").firstChild;e.classList.add("active"),this._$activeTool=e,d.$screen._$penMode=!1,d.$screen._$cursorCache=null}};class g{constructor(e){this._$id=e.id,this._$name=e.name,this._$type=e.type,this._$symbol=e.symbol,this._$folderId=0|e.folderId,this._$startFrame=1,this._$endFrame=0}initialize(){}toObject(){}toImage(e,t,a){if(!e||!t)return d.$emptyImage;const{Sprite:s,BitmapData:r}=window.next2d.display,{Matrix:i,ColorTransform:n,Rectangle:o}=window.next2d.geom,l=this.createInstance(),c=l.getBounds(),h=window.devicePixelRatio,m=d.$multiplicationMatrix(d.$multiplicationMatrix([h,0,0,h,0,0],[a.matrix[0],a.matrix[1],a.matrix[2],a.matrix[3],0,0]),[1,0,0,1,-l.width/2-c.x,-l.height/2-c.y]),u=new i(h,0,0,h);u.translate(m[4]+e*h/2,m[5]+t*h/2);let f=Math.sqrt(a.matrix[0]*a.matrix[0]+a.matrix[1]*a.matrix[1]),g=Math.sqrt(a.matrix[2]*a.matrix[2]+a.matrix[3]*a.matrix[3]),y=0,$=0,p=new o(0,0,e,t);if(a.filter.length){const s=[];for(let e=0;e<a.filter.length;++e){const t=a.filter[e];if(!t.state)continue;const r=t.createInstance();p=r._$generateFilterRect(p,f,g),s.push(r)}l.filters=s,e=Math.ceil(p.width),t=Math.ceil(p.height),y=p.x,$=p.y}const b=new s;b.addChild(new s).addChild(l),l.transform.matrix=new i(a.matrix[0],a.matrix[1],a.matrix[2],a.matrix[3],0,0),l.transform.colorTransform=new n(a.colorTransform[0],a.colorTransform[1],a.colorTransform[2],a.colorTransform[3],a.colorTransform[4],a.colorTransform[5],a.colorTransform[6],a.colorTransform[7]),0>y&&u.translate(-y*h,0),0>$&&u.translate(0,-$*h);const _=new r(Math.ceil(e*h),Math.ceil(t*h),!0,0);_.draw(b,u);const v=_.toImage();v.width=e,v.height=t,v.draggable=!1;const I=d.$boundsMatrix(this.getBounds(),a.matrix);return v._$tx=I.xMin,v._$ty=I.yMin,v.style.position="relative",v._$offsetX=0>y?y:0,v._$offsetY=0>$?$:0,v}toPublish(){}get defaultSymbol(){}createInstance(){}getBounds(){}get preview(){const e=this.getBounds();let t=Math.abs(e.xMax-e.xMin),a=Math.abs(e.yMax-e.yMin);if(!t||!a)return d.$emptyImage;let s=1;const r=150/a;t=t*r|0,a=a*r|0;const i=(0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0])-10;t>i&&(s=i/t,t=t*s|0,a=a*s|0);const n=this.toImage(t,a,{matrix:[r*s,0,0,r*s,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[]});if(n.height!==a){const e=Math.min(150,n.height);n.width*=e/n.height,n.height=e}return n}get id(){return this._$id}set id(e){this._$id=0|e}get folderId(){return this._$folderId}set folderId(e){this._$folderId=0|e}get name(){return this._$name}set name(e){if(this._$name=`${e}`,this.id){document.getElementById(`library-name-${this.id}`).textContent=this._$name}d.$currentWorkSpace().scene.id===this.id&&(document.getElementById("object-name").value=this._$name,document.getElementById("scene-name").textContent=this._$name)}get type(){return this._$type}set type(e){this._$type=`${e}`}get symbol(){return this._$symbol}set symbol(e){if(this._$symbol=`${e}`,this.id){document.getElementById(`library-symbol-name-${this.id}`).textContent=this._$symbol}d.$currentWorkSpace().scene.id===this.id&&(document.getElementById("object-symbol").value=this._$symbol)}}class y extends g{constructor(e){super(e),this.imageType=e.imageType,this.width=e.width,this.height=e.height,this._$buffer=null,e.buffer&&(this.buffer=e.buffer),this._$command=null,this._$binary=""}initialize(){}getBounds(){return{xMin:0,xMax:this.width,yMin:0,yMax:this.height}}get defaultSymbol(){return window.next2d.display.Shape.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let a=0;a<t;++a)this._$buffer[a]=255&e.charCodeAt(a);this._$binary=e}}}get imageType(){return this._$imageType}set imageType(e){this._$imageType=e}get width(){return this._$width}set width(e){this._$width=e}get height(){return this._$height}set height(e){this._$height=e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,width:this.width,height:this.height,imageType:this.imageType,buffer:this.buffer}}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,buffer:Array.from(this._$buffer),bounds:this.getBounds()}}createInstance(){const{Shape:e,BitmapData:t}=window.next2d.display,{width:a,height:s}=this,r=new e,i=new t(a,s,!0,0);return i._$buffer=this._$buffer,r.graphics.beginBitmapFill(i,null,!1).drawRect(0,0,a,s).endFill(),r.graphics._$maxAlpha=1,r.graphics._$canDraw=!0,r.graphics._$xMin=0,r.graphics._$xMax=this.width,r.graphics._$yMin=0,r.graphics._$yMax=this.height,r.graphics._$command=this._$command,r}}class ${constructor(e=null){this._$libraryId=-1,this._$places=new Map,this._$image=null,this._$currentPlace=null,this._$screenX=0,this._$screenY=0,this._$offsetX=0,this._$offsetY=0,this._$name="",this._$tween=new Map,e?(this._$id=e.id,this._$libraryId=e.libraryId,this.places=e.places,this._$name=e.name||"",this._$startFrame=e.startFrame,this._$endFrame=e.endFrame,this.tween=e.tween):(this._$id=d.$currentWorkSpace()._$characterId++,this._$startFrame=1,this._$endFrame=0)}clone(){const e=new $(this.toObject());return e._$id=d.$currentWorkSpace()._$characterId++,e}copy(e){const t=this.clone();return t.startFrame=e,t.setPlace(e,this.clonePlace(this.startFrame,e)),t}clonePlace(e,t){const a=this.getPlace(e),s=[],r=a.filter.length;for(let e=0;e<r;++e)s.push(a.filter[e].clone());return{frame:t,matrix:a.matrix.slice(0),colorTransform:a.colorTransform.slice(0),blendMode:a.blendMode,filter:s,depth:a.depth}}getBounds(e=!1){return d.$currentWorkSpace().getLibrary(this.libraryId).getBounds(e)}get rotation(){const e=0|document.getElementById("current-frame").textContent,t=this.getPlace(e).matrix;return Math.atan2(t[1],t[0])*d.$Rad2Deg}set rotation(e){const t=0|document.getElementById("current-frame").textContent,a=this.getPlace(t).matrix;let s=Math.atan2(a[1],a[0]),r=Math.atan2(-a[2],a[3]);const i=Math.sqrt(a[0]*a[0]+a[1]*a[1]),n=Math.sqrt(a[2]*a[2]+a[3]*a[3]),o=e*d.$Deg2Rad;r=r+o-s,s=o,a[0]=i*Math.cos(s),a[1]=i*Math.sin(s),a[2]=-n*Math.sin(r),a[3]=n*Math.cos(r)}get width(){const e=0|document.getElementById("current-frame").textContent,t=d.$boundsMatrix(this.getBounds(),this.getPlace(e).matrix),a=+Math.abs(t.xMax-t.xMin);return a!==1/0?a:0}set width(e){const t=this.getBounds(),a=Math.abs(t.xMax-t.xMin);this.scaleX=e/a}get scaleX(){const e=0|document.getElementById("current-frame").textContent,t=this.getPlace(e).matrix;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}set scaleX(e){const t=0|document.getElementById("current-frame").textContent,a=this.getPlace(t).matrix;if(a[1]){const t=Math.atan2(a[1],a[0]);a[1]=e*Math.sin(t),1===a[1]||-1===a[1]?a[0]=0:a[0]=e*Math.cos(t)}else a[0]=e}get height(){const e=0|document.getElementById("current-frame").textContent,t=d.$boundsMatrix(this.getBounds(),this.getPlace(e).matrix),a=+Math.abs(t.yMax-t.yMin);return a!==1/0?a:0}set height(e){const t=this.getBounds(),a=Math.abs(t.yMax-t.yMin);this.scaleY=e/a}get scaleY(){const e=0|document.getElementById("current-frame").textContent,t=this.getPlace(e).matrix;return Math.sqrt(t[2]*t[2]+t[3]*t[3])}set scaleY(e){const t=0|document.getElementById("current-frame").textContent,a=this.getPlace(t).matrix;if(a[2]){const t=Math.atan2(-a[2],a[3]);a[2]=-e*Math.sin(t),1===a[2]||-1===a[2]?a[3]=0:a[3]=e*Math.cos(t)}else a[3]=e}get x(){const e=0|document.getElementById("current-frame").textContent;return this.getPlace(e).matrix[4]}set x(e){const t=0|document.getElementById("current-frame").textContent;this.getPlace(t).matrix[4]=e}get y(){const e=0|document.getElementById("current-frame").textContent;return this.getPlace(e).matrix[5]}set y(e){const t=0|document.getElementById("current-frame").textContent;this.getPlace(t).matrix[5]=e}get image(){if(!this._$image){const e=d.$currentWorkSpace().getLibrary(this.libraryId),t=0|document.getElementById("current-frame").textContent,a=this.getPlace(t);switch(a.blendMode){case"alpha":case"erase":return d.$emptyImage;case"invert":this._$image=e.toImage(Math.ceil(this.width),Math.ceil(this.height),{matrix:a.matrix,colorTransform:[0,0,0,a.colorTransform[3],0,0,0,a.colorTransform[7]],blendMode:a.blendMode,filter:a.filter});break;default:this._$image=e.toImage(Math.ceil(this.width),Math.ceil(this.height),a)}switch(a.blendMode){case"add":this._$image.style.mixBlendMode="color-dodge";break;case"subtract":this._$image.style.filter="invert(100%)",this._$image.style.mixBlendMode="multiply";break;case"invert":this._$image.style.filter="invert(100%)",this._$image.style.mixBlendMode="difference";break;case"hardlight":this._$image.style.mixBlendMode="hard-light";break;case"alpha":case"erase":case"layer":break;default:this._$image.style.mixBlendMode=a.blendMode}this._$screenX=this._$image._$tx,this._$screenY=this._$image._$ty,this._$offsetX=this._$image._$offsetX,this._$offsetY=this._$image._$offsetY}return this._$image}get offsetX(){return this._$offsetX}get offsetY(){return this._$offsetY}get screenX(){return this._$screenX}set screenX(e){this._$screenX=e}get screenY(){return this._$screenY}set screenY(e){this._$screenY=e}get id(){return this._$id}get libraryId(){return this._$libraryId}set libraryId(e){this._$libraryId=0|e}get name(){return this._$name}set name(e){(e+="").replace(" ",""),this._$name=e.trim()}get tween(){const e=[];for(let[t,a]of this._$tween)e.push({frame:t,value:a});return e}set tween(e){for(let t=0;t<e.length;++t){const a=e[t];this._$tween.set(0|a.frame,a.value)}}get places(){const e=[];for(let[t,a]of this._$places){a.frame=t;const s=[];for(let e=0;e<a.filter.length;++e)s.push(a.filter[e].toObject());e.push({frame:t,fixed:!!a.fixed,depth:a.depth,blendMode:a.blendMode,filter:s,matrix:a.matrix.slice(0),colorTransform:a.colorTransform.slice(0)})}return e}set places(e){for(let t=0;t<e.length;++t){const a=e[t],s=[];for(let e=0;a.filter.length>e;++e){const t=a.filter[e];s.push(new d.$filterClasses[t.name](t))}a.filter=null,a.filter=s,this._$places.set(0|a.frame,a)}}getPlace(e){if(this.hasPlace(e))return this._$places.get(0|e);const t=Array.from(this._$places);for(t.sort((function(e,t){switch(!0){case e[0]>t[0]:return 1;case e[0]<t[0]:return-1;default:return 0}}));t.length;){const a=0|t.pop()[0];if(e>a)return this._$places.get(a)}}setPlace(e,t){t.frame=0|e,this._$places.set(0|e,t)}hasPlace(e){return this._$places.has(0|e)}deletePlace(e){this._$places.delete(0|e)}get startFrame(){return this._$startFrame}set startFrame(e){this._$startFrame=0|e}get endFrame(){return this._$endFrame}set endFrame(e){this._$endFrame=0|e}split(e,t){const a=new $;a._$id=d.$currentWorkSpace()._$characterId++,a._$libraryId=this._$libraryId,a._$places=new Map(Array.from(this._$places)),a._$startFrame=e,a._$endFrame=t;for(let[s,r]of this._$places)e>s||s>t||a._$places.set(s,r);return a}toObject(){return{id:this.id,name:this.name,libraryId:this.libraryId,places:this.places,startFrame:this.startFrame,endFrame:this.endFrame,tween:this.tween}}}class p extends g{constructor(e){super(e),this._$mode="clone",e.mode&&(this._$mode=e.mode)}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,mode:this.mode}}get mode(){return this._$mode}set mode(e){this._$mode=e}}class b{constructor(e=null){this._$layerId=0,this._$classes=new Map,e&&(this.classes=e.classes)}initialize(){for(let[e,t]of this._$classes){const a=document.getElementById(`${this._$layerId}-${e}`);d.$timeline.removeFrameClass(a);const s=a.classList;for(let e=0;e<t.length;++e)s.add(t[e]);a.dataset.frameState=t[0]}}get classes(){const e=[];for(let[t,a]of this._$classes)e.push({frame:t,classes:a});return e}set classes(e){for(let t=0;t<e.length;++t){const a=e[t];this._$classes.set(0|a.frame,a.classes)}}hasClasses(e){return this._$classes.has(0|e)}getClasses(e){return this._$classes.get(0|e)}setClasses(e,t){this._$classes.set(0|e,t)}deleteClasses(e){this._$classes.delete(0|e)}toObject(){return{classes:this.classes}}}class _{constructor(e=null){this._$id=0,this._$characters=[],this._$instances=new Map,this._$maskId=null,this._$name=null,this._$light=!1,this._$disable=!1,this._$lock=!1,this._$mode=d.LAYER_MODE_NORMAL,this._$frame=new b,e&&(this._$name=e.name,this._$light=e.light,this._$disable=e.disable,this._$lock=e.lock,this._$mode=e.mode,this._$maskId=e.maskId,this.frame=new b(e.frames),this.characters=e.characters)}initialize(){d.$timeline.createChild();const e=document.getElementById("timeline-content").lastElementChild;this.id=0|e.dataset.layerId,this._$frame._$layerId=this.id;const t=document.getElementById(`layer-name-${this.id}`);if(this.name?(t.textContent=this.name,document.getElementById(`layer-name-input-${this.id}`).value=this.name):this.name=t.textContent,this.light){const t=document.getElementById(`layer-light-icon-${this.id}`);t.classList.remove("icon-disable"),t.classList.add("icon-active"),e.classList.add("light-active")}if(this.disable){const e=document.getElementById(`layer-disable-icon-${this.id}`);e.classList.remove("icon-disable"),e.classList.add("icon-active")}if(this.lock){const e=document.getElementById(`layer-lock-icon-${this.id}`);e.classList.remove("icon-disable"),e.classList.add("icon-active")}this.showIcon(),this._$frame.initialize()}appendCharacter(e=1){if(this.disable)return;if(document.getElementById("timeline-onion-skin").classList.contains("onion-skin-active")&&d.$timeline._$stopFlag){const t=this._$frame._$classes;let a=e;if(t.has(e))for(;a>1&&!(t.get(a).indexOf("key-frame")>-1||t.get(a).indexOf("empty-key-frame")>-1||t.get(a).indexOf("tween-frame")>-1);)--a;const s=0|document.getElementById("current-frame").textContent,r=t.size+1;for(let e=1;e<r;++e){if(a===e)continue;if(!t.has(e))continue;if(-1===t.get(e).indexOf("key-frame")&&-1===t.get(e).indexOf("tween-frame"))continue;document.getElementById("current-frame").textContent=`${e}`;const s=this.getActiveCharacter(e);if(s.length){this.sort(s,e);for(let e=0;e<s.length;++e){const t=s[e];t._$image=null,d.$screen.appendOnionCharacter(t,this.id)}}}document.getElementById("current-frame").textContent=`${s}`;const i=this.getActiveCharacter(s);if(i.length){this.sort(i,s);const e=this.lock?"none":"auto";for(let t=0;t<i.length;++t){const a=i[t];a._$image=null,d.$screen.appendCharacter(a,s,this.id,e)}}}else{const t=this.getActiveCharacter(e);if(t.length){this.sort(t,e);const a=this.lock?"none":"auto";for(let s=0;s<t.length;++s)d.$screen.appendCharacter(t[s],e,this.id,a)}}}sort(e,t){e.sort(((e,a)=>{const s=e.getPlace(t).depth,r=a.getPlace(t).depth;switch(!0){case s>r:return 1;case s<r:return-1;default:return 0}}))}getActiveCharacter(e=1){const t=[];for(let a=0;a<this._$characters.length;++a){const s=this._$characters[a];s.startFrame>e||(e>=s.endFrame||t.push(s))}return t}clearActiveCharacter(){for(let e=0;e<this._$characters.length;++e){const t=this._$characters[e],a=document.getElementById(`character-${t.id}`);a&&(a.style.border="")}}showIcon(){const e=document.getElementById(`layer-name-${this.id}`);e.classList.remove("mask-in-view-text"),e.classList.add("view-text");switch(document.getElementById(`layer-name-input-${this.id}`).classList.remove("view-text-input-mask-in"),this._$mode){case d.LAYER_MODE_NORMAL:document.getElementById(`layer-icon-${this.id}`).style.display="",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-sound-icon-${this.id}`).style.display="none";break;case d.LAYER_MODE_MASK:document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-sound-icon-${this.id}`).style.display="none";break;case d.LAYER_MODE_MASK_IN:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="",document.getElementById(`layer-sound-icon-${this.id}`).style.display="none";const e=document.getElementById(`layer-name-${this.id}`);e.classList.remove("view-text"),e.classList.add("mask-in-view-text");document.getElementById(`layer-name-input-${this.id}`).classList.add("view-text-input-mask-in")}}}get id(){return this._$id}set id(e){this._$id=0|e}get name(){return this._$name}set name(e){this._$name=e}get light(){return this._$light}set light(e){this._$light=e}get disable(){return this._$disable}set disable(e){this._$disable=e}get lock(){return this._$lock}set lock(e){this._$lock=e}get frame(){return this._$frame.toObject()}set frame(e){this._$frame=e}get characters(){const e=[];for(let t=0;t<this._$characters.length;++t)e.push(this._$characters[t].toObject());return e}set characters(e){for(let t=0;t<e.length;++t){const a=new $(e[t]);this._$instances.set(a.id,a),this._$characters.push(a)}}getCharacter(e){return this._$instances.get(0|e)}addCharacter(e){this._$characters.push(e),this._$instances.set(e.id,e)}deleteCharacter(e){if(this._$instances.has(0|e)){const t=this._$instances.get(0|e);this._$characters.splice(this._$characters.indexOf(t),1),this._$instances.delete(0|e)}}getEndFrame(e){for(;this._$frame.hasClasses(e);){const t=this._$frame.getClasses(e);switch(!0){case t.indexOf("key-frame")>-1:case t.indexOf("empty-key-frame")>-1:return e;case t.indexOf("key-space-frame-end")>-1:case t.indexOf("empty-space-frame-end")>-1:return e+1}e++}return e}get mode(){return this._$mode}set mode(e){this._$mode=e}get maskId(){return this._$maskId}set maskId(e){this._$maskId=0|e}toObject(){return{name:this.name,light:this.light,disable:this.disable,lock:this.lock,mode:this.mode,maskId:this.maskId,frames:this.frame,characters:this.characters}}}class v extends g{constructor(e){super(e),this._$currentFrame=0,this._$layerId=0,this._$parent=null,this._$labels=new Map,this._$layers=new Map,this._$placeMap=new Map,this._$actions=new Map,this._$sounds=new Map,e.layers&&(this.layers=e.layers),e.labels&&(this.labels=e.labels),e.placeMap&&(this.placeMap=e.placeMap),e.sounds&&(this.sounds=e.sounds),e.actions&&(this.actions=e.actions)}initialize(){if(this.clearStageArea(),d.$screen.clearTweenMarker(),d.$screen.hideTransformTarget(),d.$screen.hideGridTarget(),document.getElementById("scene-name").textContent=this.name,document.getElementById("object-name").value=this.name,document.getElementById("object-symbol").value=this.symbol,0===this.id){const e=document.getElementById("scene-name-menu-list");for(;e.children.length;)e.children[0].remove()}d.$timeline.initializeParams(),d.$timeline.buildTimeline();for(const e of this._$labels.keys()){document.getElementById(`frame-label-marker-${e}`).setAttribute("class","frame-border-box-marker")}for(const e of this._$actions.keys()){document.getElementById(`frame-label-action-${e}`).setAttribute("class","frame-border-box-action")}for(const e of this._$sounds.keys()){document.getElementById(`frame-label-sound-${e}`).setAttribute("class","frame-border-box-sound")}const e=document.getElementById("label-name");e.value="",this._$labels.has(1)&&(e.value=this._$labels.get(1));const t=document.getElementById("timeline-content").children;for(;t.length;)t[0].remove();this._$layerId=0;for(const e of this._$layers.values())e.initialize();if(this._$layers.size||this.addLayer(),this.id){document.getElementById(`library-child-id-${this.id}`).draggable=!1,document.getElementById("stage-setting").style.display="none",document.getElementById("object-area").style.display="none"}else document.getElementById("stage-setting").style.display="",document.getElementById("object-area").style.display="none";d.$controller.createSoundListArea(),this.changeFrame(0|document.getElementById("current-frame").textContent)}get currentFrame(){return this._$currentFrame}get totalFrame(){let e=1;for(const t of this._$layers.values())for(const a of t._$frame._$classes.keys())e=Math.max(e,a);return e}clearStageArea(){const e=document.getElementById("stage-area");let t=0;for(;e.children.length>t;){const a=e.children[t];a.dataset.child&&"tween"!==a.dataset.child?a.remove():t++}}changeFrame(e=1){this.clearStageArea();const t=document.getElementById("stage-area"),a=[],s=t.children;for(let e=0;s.length>e;++e){const t=s[e];t.dataset.shapePointer&&(t.remove(),a.push(t),--e)}const r=Array.from(this._$layers);for(;r.length;){const t=r.pop()[1];t.mode===d.LAYER_MODE_MASK&&t.lock||t.appendCharacter(e)}this._$currentFrame=e,d.$screen.placeTransformTarget(),d.$screen.placeGridTarget();for(let e=0;a.length>e;++e)t.appendChild(a[e])}clearActiveCharacter(){for(const e of this._$layers.values())e.clearActiveCharacter()}addSceneName(){const e=d.$currentWorkSpace().getLibrary(0|this.id),t=0|document.getElementById("current-frame").textContent,a=`\n<div id="scene-instance-id-${e.id}" data-library-id="${e.id}" data-frame="${t}">${e.name}</div>\n        `;document.getElementById("scene-name-menu-list").insertAdjacentHTML("beforeend",a);document.getElementById(`scene-instance-id-${e.id}`).addEventListener("click",(function(e){const t=e.currentTarget,a=0|t.dataset.frame;document.getElementById("current-frame").textContent=`${a}`;const s=d.$currentWorkSpace();s.scene=s.getLibrary(0|t.dataset.libraryId);const r=13*(a-1);document.getElementById("timeline-marker").style.left=`${r}px`;const i=document.getElementById("timeline-controller-base"),n=r>i.offsetWidth/2?r-i.offsetWidth/2:0;d.$timeline.moveTimeLine(n),t.remove()}))}stop(){const e=[];for(const t of this._$layers.values()){e.push(t);const a=t._$characters;for(let e=0;e<a.length;++e)a[e]._$image=null}this._$layers.clear();for(let t=0;t<e.length;++t)this._$layers.set(t,e[t]);if(this.id){document.getElementById(`library-child-id-${this.id}`).draggable=!0}}get labels(){const e=[];for(let[t,a]of this._$labels)e.push({frame:t,name:a});return e}set labels(e){for(let t=0;t<e.length;++t){const a=e[t];this._$labels.set(0|a.frame,a.name)}}setLabel(e,t){this._$labels.set(0|e,t)}gerLabel(e){return this._$labels.has(e)?this._$labels.get(0|e):null}deleteLabel(e){this._$labels.delete(0|e)}get parent(){return this._$parent}get layers(){const e=[];for(const t of this._$layers.values())e.push(t.toObject());return e}set layers(e){for(let t=0;t<e.length;++t)this._$layers.set(t,new _(e[t]))}addLayer(e=null){e||(e=new _),this._$layers.set(this._$layerId,e),e.initialize()}getLayer(e){return this._$layers.get(0|e)}setLayer(e,t){this._$layers.set(0|e,t)}deleteLayer(e){this._$layers.delete(0|e)}clearLayer(){this._$layers.clear()}get placeMap(){const e=[];for(let[t,a]of this._$placeMap)e.push({frame:t,values:a});return e}set placeMap(e){for(let t=0;t<e.length;++t){const a=e[t];this._$placeMap.set(0|a.frame,a.values)}}get sounds(){const e=[];for(let[t,a]of this._$sounds)e.push({frame:t,sound:a});return e}set sounds(e){for(let t=0;t<e.length;++t){const a=e[t];this._$sounds.set(0|a.frame,a.sound)}}get actions(){const e=[];for(let[t,a]of this._$actions)e.push({frame:t,action:a});return e}set actions(e){for(let t=0;t<e.length;++t){const a=e[t];this._$actions.set(0|a.frame,a.action)}}getAction(e){return this._$actions.get(e)}setAction(e,t){this._$actions.set(e,t),d.$currentWorkSpace().initializeInternalScript()}hasAction(e){return this._$actions.has(e)}deleteAction(e){this._$actions.delete(e),d.$currentWorkSpace().initializeInternalScript()}getPlaceMap(e){return this._$placeMap.get(e)}hasPlaceMap(e){return this._$placeMap.has(e)}getBounds(){if(!this._$layers.size)return{xMin:0,xMax:0,yMin:0,yMax:0};let e=Number.MAX_VALUE,t=-Number.MAX_VALUE,a=Number.MAX_VALUE,s=-Number.MAX_VALUE;for(const r of this._$layers.values()){if(r.disable)continue;const i=1,n=r.getActiveCharacter(i),o=n.length;for(let r=0;r<o;++r){const o=n[r],l=o.getPlace(i).matrix;let c=null;c=o.width&&o.height?d.$boundsMatrix(o.getBounds(),l):{xMin:l[4],xMax:l[4],yMin:l[5],yMax:l[5]},e=Math.min(c.xMin,e),t=Math.max(c.xMax,t),a=Math.min(c.yMin,a),s=Math.max(c.yMax,s)}}return{xMin:e,xMax:t,yMin:a,yMax:s}}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,parent:this.parent,layers:this.layers,labels:this.labels,placeMap:this.placeMap,sounds:this.sounds,actions:this.actions}}toPublish(){const e=[],t=[],a=[],s=[],r=d.$currentWorkSpace(),i=new Map;let n=0;for(const e of r._$libraries.keys())i.set(e,n++);let o=0,l=!1,c=0;const h=d.$tools.getUserPublishSetting(),m=Array.from(this._$layers),u=[];let f=0,g=0;for(let i=m.length-1;i>-1;--i){if(c&&!u.length){c=0,f=0;continue}const n=!l&&u.length?u.shift():m[i][1];if(!h.layer&&n.disable)continue;if(n.mode!==d.LAYER_MODE_MASK_IN||l||c||(l=!0,c=i),l&&n.mode===d.LAYER_MODE_MASK_IN){f+=n._$characters.length,u.push(n);continue}const y=n._$characters,$=n.mode===d.LAYER_MODE_MASK?Math.min(1,y.length):y.length;let p=n.mode===d.LAYER_MODE_MASK?$-1:0;for(;;){const i=e.length,l=y[p];if(!l)break;const c=l.startFrame,h=l.endFrame,m=r._$libraries.get(l.libraryId);d.$useIds.has(m.id)||d.$useIds.set(m.id,!0),e.push({name:l.name,characterId:m.id,endFrame:h,startFrame:c,clipDepth:n.mode===d.LAYER_MODE_MASK?p+f+o:0});let u=0;for(let e=c;e<h;++e){e in t||(t[e]=[]),e in a||(a[e]=[]);const r=l.getPlace(e);if(l.hasPlace(e)){u=s.length;const e=[];for(let t=0;t<r.filter.length;++t){const a=r.filter[t];a.state&&e.push({class:a.name,params:a.toParamArray()})}s.push({matrix:r.matrix,colorTransform:r.colorTransform,blendMode:r.blendMode,surfaceFilterList:e})}t[e][g+r.depth]=i,a[e][g+r.depth]=u}if(n.mode===d.LAYER_MODE_MASK){if(--p,-1===p)break}else if(++p,p===$)break}o+=$,l&&u.length&&(i=c+1,l=!1),g++}for(let e=1;t.length>e;++e){if(!(e in t))continue;const s=t[e],r=a[e];t[e]=s.filter((e=>"number"==typeof e)),a[e]=r.filter((e=>"number"==typeof e))}const y=[];for(let[e,t]of this._$sounds){const a={frame:e,sound:[]};for(let e=0;e<t.length;++e){const s=t[e],r=0|s.characterId;a.sound.push({characterId:r,volume:s.volume/100,autoPlay:s.autoPlay,loop:s.loop}),d.$useIds.has(r)||d.$useIds.set(r,!0)}y.push(a)}const $=[];for(let[e,t]of this._$actions){const a=t.replace(/("[^"]*\/\/.*?")|\/\/(?:.|\r?\n)*?(?:\r?\n|.*)?/g,"$1").replace(/(["'][^"']*\/\*.*?\*\/[^"']*["'])|\/\*(?:.|\r?\n)*?\*\//g,"$1").replace(/^\s+|\s+$/g,"").replace(/ +/g," ").split(/\r?\n/);let s=[];for(let e=0;e<a.length;++e){const t=a[e].trim();t.length&&s.push(t)}$.push({frame:e,action:s.join("\n")})}return{actions:$,symbol:this.symbol,extends:this.defaultSymbol,totalFrame:this.totalFrame,controller:t,dictionary:e,labels:this.labels,placeMap:a,placeObjects:s,sounds:y}}get defaultSymbol(){return window.next2d.display.MovieClip.namespace}createInstance(){const{Sprite:e}=window.next2d.display,{Matrix:t,ColorTransform:a}=window.next2d.geom,s=d.$currentWorkSpace(),r=new e;for(const i of this._$layers.values()){if(i.disable)continue;const n=i.getActiveCharacter(1);n.sort(((e,t)=>{const a=e.getPlace(1).depth,s=t.getPlace(1).depth;switch(!0){case a>s:return-1;case s>a:return 1;default:return 0}}));const o=n.length;for(let i=0;i<o;++i){const o=n[i];if(!o.width||!o.height)continue;const l=s.getLibrary(o.libraryId),c=o.getPlace(1);let d=null;switch(l.type){case"container":d=l._$layers.size?l.createInstance():new e;break;case"shape":d=l.createInstance(),d._$bitmapId=l._$bitmapId;break;default:d=l.createInstance()}d.transform.matrix=new t(c.matrix[0],c.matrix[1],c.matrix[2],c.matrix[3],c.matrix[4],c.matrix[5]),d.transform.colorTransform=new a(c.colorTransform[0],c.colorTransform[1],c.colorTransform[2],c.colorTransform[3],c.colorTransform[4],c.colorTransform[5],c.colorTransform[6],c.colorTransform[7]),d.blendMode=c.blendMode;const h=[];for(let e=0;e<c.filter.length;++e)h.push(c.filter[e].createInstance());d.filters=h,r.addChildAt(d,0)}}return r}}class I extends g{constructor(e=null){super(e),this._$bitmapId=0,this._$bounds=null,this._$grid=null,this._$recodes=[],e.recodes&&(this.recodes=e.recodes),e.bounds&&(this.bounds=e.bounds),e.bitmapId&&(this.bitmapId=e.bitmapId),e.grid&&(this.grid=e.grid)}getBounds(){return this._$bounds}get width(){return Math.abs(this._$bounds.xMax-this._$bounds.xMin)}get height(){return Math.abs(this._$bounds.yMax-this._$bounds.yMin)}get defaultSymbol(){return window.next2d.display.Shape.namespace}get recodes(){return this._$recodes}set recodes(e){this._$recodes=e}get bounds(){return this._$bounds}set bounds(e){this._$bounds=e}get offset(){return this._$offset}set offset(e){this._$offset=e}get bitmapId(){return this._$bitmapId}set bitmapId(e){this._$bitmapId=0|e}get grid(){return this._$grid}set grid(e){this._$grid=e}createPointer(e,t,a){d.$clearShapePointer();const s=document.getElementById("stage-area");let r=2;const{Graphics:i}=window.next2d.display;for(let s=0;s<this._$recodes.length;)switch(this._$recodes[s++]){case i.MOVE_TO:r=s,s+=2;break;case i.LINE_TO:this.addPointer(t,a,s,this._$recodes[s++],this._$recodes[s++],e,i.LINE_TO),this.adjustmentPointer(s,e,t,a,r);break;case i.CUBIC:for(let r=0;2>r;++r)this.addPointer(t,a,s,this._$recodes[s++],this._$recodes[s++],e,i.CUBIC,!0);this.addPointer(t,a,s,this._$recodes[s++],this._$recodes[s++],e,i.CUBIC,!1),this.adjustmentPointer(s,e,t,a,r);break;case i.CURVE_TO:this.addPointer(t,a,s,this._$recodes[s++],this._$recodes[s++],e,i.CURVE_TO,!0),this.addPointer(t,a,s,this._$recodes[s++],this._$recodes[s++],e,i.CURVE_TO),this.adjustmentPointer(s,e,t,a,r);break;case i.FILL_STYLE:s+=4;break;case i.STROKE_STYLE:s+=8;break;case i.GRADIENT_FILL:s+=6;break;case i.GRADIENT_STROKE:s+=10;case i.BEGIN_PATH:case i.END_FILL:case i.END_STROKE:}d.$addModalEvent(s)}adjustmentPointer(e,t,a,s,r){const{Graphics:i}=window.next2d.display;switch(this._$recodes[e]){case i.MOVE_TO:case i.FILL_STYLE:case i.GRADIENT_FILL:{const e=document.getElementById("stage-area").children;e[e.length-1].dataset.syncId=`${r}`}break;case i.STROKE_STYLE:case i.GRADIENT_STROKE:this.addPointer(a,s,5,this._$recodes[5],this._$recodes[6],t,i.MOVE_TO)}}addPointer(e,t,a,s,r,i,n,o=!1){const l=document.getElementById("stage-area"),c=document.createElement("div");c.classList.add("transform"),c.dataset.shapePointer="true",c.dataset.layerId=`${e}`,c.dataset.characterId=`${t}`,c.dataset.index=`${a}`,c.dataset.libraryId=`${this.id}`,c.dataset.curve=`${o}`,c.dataset.type=`${n}`,c.dataset.position=`${l.children.length}`;const h=s*i[0]+r*i[2]+i[4],m=s*i[1]+r*i[3]+i[5];c.style.left=h+d.$offsetLeft-3+"px",c.style.top=m+d.$offsetTop-3+"px",o?c.style.borderRadius="5px":c.dataset.detail="{{ダブルクリックでカーブポイントが追加されます}}",c.addEventListener("mousedown",(e=>{const{Graphics:t}=window.next2d.display,a=document.getElementById("stage-area"),s=d.$screen._$shapeMoveTarget;if(s){d.$screen._$objectClicked=!0,s.style.backgroundColor="";const e=0|s.dataset.position,r=0|s.dataset.type,i="true"===s.dataset.curve;switch(r){case t.CURVE_TO:i?a.children[e+1].style.backgroundColor="":a.children[e-1].style.backgroundColor="";break;case t.CUBIC:if(i)for(let t=1;t<3;++t){const s=a.children[e+t];if(s.style.backgroundColor="","true"!==s.dataset.curve){1===t&&(a.children[e-1].style.backgroundColor="");break}}else a.children[e-1].style.backgroundColor="",a.children[e-2].style.backgroundColor=""}}const r=e.target;r.style.backgroundColor=d.$shapePointerColor;const i=0|r.dataset.position,n=0|r.dataset.type,o="true"===r.dataset.curve;switch(n){case t.CURVE_TO:o?a.children[i+1].style.backgroundColor=d.$shapeLinkedPointerColor:a.children[i-1].style.backgroundColor=d.$shapeLinkedPointerColor;break;case t.CUBIC:if(o)for(let e=1;e<3;++e){const t=a.children[i+e];if(t.style.backgroundColor=d.$shapeLinkedPointerColor,"true"!==t.dataset.curve){1===e&&(a.children[i-1].style.backgroundColor=d.$shapeLinkedPointerColor);break}}else a.children[i-1].style.backgroundColor=d.$shapeLinkedPointerColor,a.children[i-2].style.backgroundColor=d.$shapeLinkedPointerColor}d.$screen._$shapeMovePointer=!0,d.$screen._$shapeMoveTarget=r,d.$screen._$rectPosition={x:e.pageX-r.offsetLeft,y:e.pageY-r.offsetTop},d.$currentWorkSpace().temporarilySaved(),d.$screen._$shapeAddPointer=!1})),c.addEventListener("dblclick",(a=>{const{Graphics:s}=window.next2d.display,r=d.$currentWorkSpace(),n=d.$screen._$shapeMoveTarget;if(n){d.$screen._$objectClicked=!0,n.style.backgroundColor="";const e=0|n.dataset.position,t=0|n.dataset.type,a="true"===n.dataset.curve;switch(t){case s.CURVE_TO:a?l.children[e+1].style.backgroundColor="":l.children[e-1].style.backgroundColor="";break;case s.CUBIC:if(a)for(let t=1;t<3;++t){const a=l.children[e+t];if(a.style.backgroundColor="","true"!==a.dataset.curve){1===t&&(l.children[e-1].style.backgroundColor="");break}}else l.children[e-1].style.backgroundColor="",l.children[e-2].style.backgroundColor=""}}const o=a.target;if(!("true"===o.dataset.curve)){const a=0|o.dataset.type,n=0|o.dataset.index,l=r.getLibrary(0|o.dataset.libraryId);switch(a){case s.LINE_TO:{r.temporarilySaved(),l._$recodes[n-1]=s.CURVE_TO;const a=l._$recodes[n],o=l._$recodes[n+1];l._$recodes.splice(n+2,0,a,o),l._$recodes[n]+=20,l._$recodes[n+1]+=20,l.cacheClear();const c=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(c),l.createPointer(i,e,t)}break;case s.CURVE_TO:{r.temporarilySaved(),l._$recodes[n-3]=s.CUBIC;const a=l._$recodes[n],o=l._$recodes[n+1];l._$recodes.splice(n+2,0,a,o),l._$recodes[n]+=20,l._$recodes[n+1]+=20,l.cacheClear();const c=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(c),l.createPointer(i,e,t)}}}d.$screen._$shapeAddPointer=!0})),l.appendChild(c)}reloadBounds(e=0){const{Graphics:t,Shape:a}=window.next2d.display,s=new a;e?s.graphics.lineStyle(e):s.graphics.beginFill();for(let e=0;e<this._$recodes.length;)switch(this._$recodes[e++]){case t.MOVE_TO:s.graphics.moveTo(this._$recodes[e++],this._$recodes[e++]);break;case t.LINE_TO:s.graphics.lineTo(this._$recodes[e++],this._$recodes[e++]);break;case t.CUBIC:s.graphics.cubicCurveTo(this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++]);break;case t.CURVE_TO:s.graphics.curveTo(this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++]);break;case t.FILL_STYLE:e+=4;break;case t.STROKE_STYLE:e+=8;break;case t.GRADIENT_FILL:{const{Matrix:t}=window.next2d.geom,a=new t,r=this.width/2/819.2,i=this.height/2/819.2;a.scale(r,i),a.translate(this.width/2+s.graphics._$xMin,this.height/2+s.graphics._$yMin),this._$recodes[e+2]=Array.from(a._$matrix),e+=6}break;case t.GRADIENT_STROKE:{const{Matrix:t}=window.next2d.geom,a=new t,r=this.width/2/819.2,i=this.height/2/819.2;a.scale(r,i),a.translate(this.width/2+s.graphics._$xMin,this.height/2+s.graphics._$yMin),this._$recodes[e+6]=Array.from(a._$matrix),e+=10}case t.BEGIN_PATH:case t.END_FILL:case t.END_STROKE:}return{xMin:s.graphics._$xMin,xMax:s.graphics._$xMax,yMin:s.graphics._$yMin,yMax:s.graphics._$yMax}}copyFrom(e){return e._$recodes=this._$recodes.slice(),e._$bounds={xMin:this._$bounds.xMin,xMax:this._$bounds.xMax,yMin:this._$bounds.yMin,yMax:this._$bounds.yMax},e._$bitmapId=this._$bitmapId,e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,bitmapId:this.bitmapId,grid:this.grid,recodes:this.recodes,bounds:this.bounds}}toPublish(){return this._$bitmapId&&d.$useIds.set(this._$bitmapId,!0),{symbol:this.symbol,extends:this.defaultSymbol,bitmapId:this.bitmapId,grid:this.grid,recodes:this.recodes,bounds:{xMin:this._$bounds.xMin,xMax:this._$bounds.xMax,yMin:this._$bounds.yMin,yMax:this._$bounds.yMax}}}changeStyle(e){const{Graphics:t,GradientType:a}=window.next2d.display,s=d.$hitColor.index;switch(d.$hitColor.style){case t.BITMAP_FILL:case t.FILL_STYLE:switch(document.getElementById("fill-color-type-select").value){case a.LINEAR:case a.RADIAL:{const a=document.getElementById("fill-color-value").value,r=d.$intToRGB(0|`0x${a.substr(1)}`),i=(0|document.getElementById("fill-alpha-value").value)/100*255;this.changeGradient(s,e,t.GRADIENT_FILL,6,r,i)}}break;case t.GRADIENT_FILL:{const a=document.getElementById("fill-color-type-select"),r=this._$recodes[s+1].pop();switch(a.value){case"bitmap":case"rgba":this._$recodes.splice(s-1,12,t.FILL_STYLE,r.R,r.G,r.B,r.A,t.END_FILL),d.$hitColor={index:s,style:t.FILL_STYLE,shape:this};break;default:this.changeGradient(s,e,t.GRADIENT_FILL,12,r,r.A)}}break;case t.STROKE_STYLE:switch(document.getElementById("fill-color-type-select").value){case a.LINEAR:case a.RADIAL:{const a=document.getElementById("fill-color-value").value,r=d.$intToRGB(0|`0x${a.substr(1)}`),i=(0|document.getElementById("fill-alpha-value").value)/100*255;this.changeGradient(s,e,t.GRADIENT_STROKE,5,r,i)}}break;case t.GRADIENT_STROKE:{const a=document.getElementById("fill-color-type-select"),r=this._$recodes[s+5].pop(),i=this._$recodes[s],n=this._$recodes[s+1],o=this._$recodes[s+2],l=this._$recodes[s+3];switch(a.value){case"bitmap":case"rgba":this._$recodes.splice(s-1,11,t.STROKE_STYLE,i,n,o,l,r.R,r.G,r.B,r.A,t.END_STROKE),d.$hitColor={index:s,width:i,style:t.STROKE_STYLE,shape:this};break;default:this.changeGradient(s,e,t.GRADIENT_STROKE,6,r,r.A)}}}this.cacheClear();const r=0|document.getElementById("current-frame").textContent;d.$currentWorkSpace().scene.changeFrame(r)}changeGradient(e,t,a,s,r,i){const{Graphics:n,SpreadMethod:o,InterpolationMethod:l}=window.next2d.display,{Matrix:c}=window.next2d.geom,h=new c,m=this.width/2/819.2,u=this.height/2/819.2;h.scale(m,u),h.translate(this.width/2+this._$bounds.xMin,this.height/2+this._$bounds.yMin);const f=[{ratio:0,R:255,G:255,B:255,A:255},{ratio:1,R:r.R,G:r.G,B:r.B,A:i}];d.$hitColor={index:e,style:a,type:t,ratios:f,shape:this},n.GRADIENT_STROKE===a?(this._$recodes[e-1]=n.GRADIENT_STROKE,this._$recodes.splice(e+4,s,t,f,Array.from(h._$matrix),o.PAD,l.RGB,0),d.$hitColor.width=this._$recodes[e]):this._$recodes.splice(e-1,s,a,t,f,Array.from(h._$matrix),o.PAD,l.RGB,0),d.$controller.initializeGradient()}changeColor(){const{Graphics:e}=window.next2d.display,t=d.$hitColor.index;switch(d.$hitColor.style){case e.BITMAP_FILL:break;case e.BITMAP_STROKE:{const e=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[t]!==e){d.$hitColor.width=e,this._$recodes[t]=e;const a=this.reloadBounds(e);this._$bounds.xMin=a.xMin,this._$bounds.xMax=a.xMax,this._$bounds.yMin=a.yMin,this._$bounds.yMax=a.yMax,this.cacheClear()}}break;case e.FILL_STYLE:{const e=document.getElementById("fill-color-value").value,a=d.$intToRGB(0|`0x${e.substr(1)}`);this._$recodes[t]=a.R,this._$recodes[t+1]=a.G,this._$recodes[t+2]=a.B,this._$recodes[t+3]=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255)}break;case e.GRADIENT_FILL:{const e=this._$recodes[t+1],a=d.$controller._$gradientTarget,s=e[a?a.dataset.index:e.length-1],r=document.getElementById("fill-color-value").value,i=d.$intToRGB(0|`0x${r.substr(1)}`);s.R=i.R,s.G=i.G,s.B=i.B,s.A=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255)}break;case e.STROKE_STYLE:{const e=document.getElementById("fill-color-value").value,a=d.$intToRGB(0|`0x${e.substr(1)}`);this._$recodes[t+4]=a.R,this._$recodes[t+5]=a.G,this._$recodes[t+6]=a.B,this._$recodes[t+7]=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255);const s=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[t]!==s){d.$hitColor.width=s,this._$recodes[t]=s;const e=this.reloadBounds(s);this._$bounds.xMin=e.xMin,this._$bounds.xMax=e.xMax,this._$bounds.yMin=e.yMin,this._$bounds.yMax=e.yMax,this.cacheClear()}}break;case e.GRADIENT_STROKE:{const e=this._$recodes[t+5],a=d.$controller._$gradientTarget,s=e[a?a.dataset.index:e.length-1],r=document.getElementById("fill-color-value").value,i=d.$intToRGB(0|`0x${r.substr(1)}`);s.R=i.R,s.G=i.G,s.B=i.B,s.A=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255);const n=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[t]!==n){d.$hitColor.width=n,this._$recodes[t]=n;const e=this.reloadBounds(n);this._$bounds.xMin=e.xMin,this._$bounds.xMax=e.xMax,this._$bounds.yMin=e.yMin,this._$bounds.yMax=e.yMax,this.cacheClear()}}}this.cacheClear()}cacheClear(){const e=d.$currentWorkSpace().scene._$layers.values();for(const t of e){const e=t._$characters.length;for(let a=0;a<e;++a){const e=t._$characters[a];e.libraryId===this.id&&(e._$image=null)}}}setHitColor(e,t,a){const{Graphics:s,GradientType:r}=window.next2d.display,{Point:i,Matrix:n}=window.next2d.geom,o=new n,l=Math.sqrt(a[0]*a[0]+a[1]*a[1]),c=Math.sqrt(a[2]*a[2]+a[3]*a[3]);o.scale(l,c);const h=Math.atan2(a[1],a[0]);h&&(o.translate(-this.width/2,-this.height/2),o.rotate(h),o.translate(this.width/2,this.height/2));const m=o.transformPoint(new i(0,0)),u=o.transformPoint(new i(this.width,0)),f=o.transformPoint(new i(0,this.height)),g=o.transformPoint(new i(this.width,this.height)),y=Math.min(m.x,u.x,f.x,g.x),$=Math.min(m.y,u.y,f.y,g.y);o.translate(-y,-$),d.$hitColor=null,d.$hitContext.lineWidth=0,d.$hitContext.beginPath(),d.$hitContext.setTransform(o._$matrix[0],o._$matrix[1],o._$matrix[2],o._$matrix[3],-this._$bounds.xMin*l+o._$matrix[4],-this._$bounds.yMin*c+o._$matrix[5]);const p=this._$recodes,b=p.length;for(let a=0;a<b;)switch(p[a++]){case s.BEGIN_PATH:d.$hitContext.beginPath();break;case s.MOVE_TO:d.$hitContext.moveTo(p[a++],p[a++]);break;case s.LINE_TO:d.$hitContext.lineTo(p[a++],p[a++]);break;case s.CURVE_TO:d.$hitContext.quadraticCurveTo(p[a++],p[a++],p[a++],p[a++]);break;case s.CUBIC:d.$hitContext.bezierCurveTo(p[a++],p[a++],p[a++],p[a++],p[a++],p[a++]);break;case s.FILL_STYLE:if(d.$hitContext.isPointInPath(e,t)){if(this._$bitmapId)d.$hitColor={index:a,style:s.BITMAP_FILL,shape:this},document.getElementById("fill-color-type-select")[1].selected=!0;else{d.$hitColor={index:a,style:s.FILL_STYLE,shape:this};const e=p[a].toString(16).padStart(2,"0"),t=p[a+1].toString(16).padStart(2,"0"),r=p[a+2].toString(16).padStart(2,"0");document.getElementById("fill-color-type-select")[0].selected=!0,document.getElementById("fill-color-value").value=`#${e}${t}${r}`,document.getElementById("fill-alpha-value").value=""+p[a+3]/255*100}d.$controller.changeShapeColor()}a+=4;break;case s.GRADIENT_FILL:d.$hitContext.isPointInPath(e,t)&&(document.getElementById("fill-color-type-select")[p[a]===r.LINEAR?2:3].selected=!0,d.$hitColor={index:a,style:s.GRADIENT_FILL,type:p[a],ratios:p[a+1],shape:this},d.$controller.changeShapeColor()),a+=6;break;case s.STROKE_STYLE:if(d.$hitContext.lineWidth=0|p[a],d.$hitContext.isPointInStroke(e,t)){if(this._$bitmapId)d.$hitColor={index:a,width:d.$hitContext.lineWidth,style:s.BITMAP_STROKE,shape:this},document.getElementById("fill-color-type-select")[1].selected=!0;else{d.$hitColor={index:a,width:d.$hitContext.lineWidth,style:s.STROKE_STYLE,shape:this};const e=p[a+4].toString(16).padStart(2,"0"),t=p[a+5].toString(16).padStart(2,"0"),r=p[a+6].toString(16).padStart(2,"0");document.getElementById("fill-color-type-select")[0].selected=!0,document.getElementById("fill-color-value").value=`#${e}${t}${r}`,document.getElementById("fill-alpha-value").value=""+p[a+7]/255*100}document.getElementById("fill-stroke-width-value").value=`${d.$hitContext.lineWidth}`,d.$controller.changeShapeColor()}a+=8;break;case s.GRADIENT_STROKE:d.$hitContext.lineWidth=p[a],d.$hitContext.isPointInStroke(e,t)&&(document.getElementById("fill-color-type-select")[p[a+4]===r.LINEAR?2:3].selected=!0,d.$hitColor={index:a,width:p[a],style:s.GRADIENT_STROKE,type:p[a+4],ratios:p[a+5],shape:this},d.$controller.changeShapeColor()),a+=10;case s.CLOSE_PATH:case s.END_STROKE:case s.END_FILL:}}createInstance(){const{Shape:e,Graphics:t}=window.next2d.display,a=new e;if(this._$grid){const{Rectangle:e}=window.next2d.geom;a.scale9Grid=new e(this._$grid.x,this._$grid.y,this._$grid.w,this._$grid.h)}const s=a.graphics;if(s._$maxAlpha=1,s._$canDraw=!0,s._$xMin=this._$bounds.xMin,s._$xMax=this._$bounds.xMax,s._$yMin=this._$bounds.yMin,s._$yMax=this._$bounds.yMax,this._$bitmapId){const{BitmapData:e}=window.next2d.display,r=d.$currentWorkSpace().getLibrary(this._$bitmapId);if(r){a._$bitmapId=this._$bitmapId,s._$recode=[];const i=new e(r.width,r.height,!0,0);i._$buffer=r._$buffer;const n=this._$recodes;if(n[n.length-1]===t.END_FILL){const e=n.length-6;for(let t=0;t<e;++t)s._$recode.push(n[t]);s._$recode.push(t.BITMAP_FILL,i,null,"repeat",!1)}else{const e=this._$recodes[n.length-9],a=this._$recodes[n.length-8],r=this._$recodes[n.length-7],o=this._$recodes[n.length-6],l=n.length-10;for(let e=0;e<l;++e)s._$recode.push(n[e]);s._$recode.push(t.BITMAP_STROKE,e,a,r,o,i,[1,0,0,1,s._$xMin,s._$yMin],"repeat",!1)}}else s._$recode=this._$recodes.slice(0)}else s._$recode=this._$recodes.slice(0);return a}}class k extends g{constructor(e){super(e),this.buffer=e.buffer,this._$binary="",this._$volume=100,this._$loop=!1,"volume"in e&&(this.volume=e.volume),"loop"in e&&(this.loop=e.loop),this._$audio=document.createElement("audio"),this._$audio.preload="auto",this._$audio.autoplay=!1,this._$audio.loop=!1,this._$audio.controls=!0,this._$audio.src=URL.createObjectURL(new Blob([new Uint8Array(this._$buffer)],{type:"audio/mp3"})),this._$audio.load()}initialize(){}get preview(){const e=this.getBounds();let t=Math.abs(e.xMax-e.xMin),a=Math.abs(e.yMax-e.yMin),s=1;const r=150/a;t=t*r|0,a=a*r|0;const i=(0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0])-10;return t>i&&(s=i/t,t=t*s|0,a=a*s|0),this._$audio.style.width=`${t}px`,this._$audio.style.height=`${a}px`,this._$audio.controls=!0,this._$audio}get defaultSymbol(){return window.next2d.media.Sound.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let a=0;a<t;++a)this._$buffer[a]=255&e.charCodeAt(a);this._$binary=e}}}get volume(){return this._$volume}set volume(e){this._$volume=e}get loop(){return this._$loop}set loop(e){this._$loop=e}getBounds(){return{xMin:0,xMax:d.CONTROLLER_DEFAULT_SIZE,yMin:0,yMax:150}}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,buffer:this.buffer,volume:this.volume,loop:this.loop}}toPublish(){return{buffer:Array.from(this._$buffer),audioBuffer:null,init:!1}}}class E extends g{constructor(e=null){super(e),this._$text="",this._$font="sans-serif",this._$size=12,this._$align="left",this._$color=0,this._$fontType=0,this._$inputType="static",this._$leading=0,this._$letterSpacing=0,this._$leftMargin=0,this._$rightMargin=0,this._$autoSize=0,this._$multiline=!0,this._$wordWrap=!0,this._$border=!1,this._$scroll=!0,this._$cache=null,this._$htmlText=null,this._$thickness=0,this._$thicknessColor=0,this._$bounds={xMin:0,xMax:d.FONT_DEFAULT_SIZE,yMin:0,yMax:d.FONT_DEFAULT_SIZE},this._$originBounds={xMin:0,xMax:d.FONT_DEFAULT_SIZE,yMin:0,yMax:d.FONT_DEFAULT_SIZE},e.text&&(this.text=e.text),e.font&&(this.font=e.font),e.fontType&&(this.fontType=e.fontType),e.inputType&&(this.inputType=e.inputType),e.size&&(this.size=e.size),e.align&&(this.align=e.align),e.color&&(this.color=e.color),e.leading&&(this.leading=e.leading),e.letterSpacing&&(this.letterSpacing=e.letterSpacing),e.leftMargin&&(this.leftMargin=e.leftMargin),e.rightMargin&&(this.rightMargin=e.rightMargin),"multiline"in e&&(this.multiline=e.multiline),"wordWrap"in e&&(this.wordWrap=e.wordWrap),e.autoFontSize&&(this.autoFontSize=e.autoFontSize),"scroll"in e&&(this.scroll=e.scroll),e.border&&(this.border=e.border),e.bounds&&(this.bounds=e.bounds),e.originBounds&&(this.originBounds=e.originBounds),e.autoSize&&(this.autoSize=e.autoSize),e.thickness&&(this.thickness=e.thickness),e.thicknessColor&&(this.thicknessColor=e.thicknessColor)}initialize(){}getBounds(){return{xMin:-this._$thickness,xMax:this._$bounds.xMax+this._$thickness,yMin:-this._$thickness,yMax:this._$bounds.yMax+4+this._$thickness}}get text(){return this._$text}set text(e){this._$text=e,this.resize()}get size(){return this._$size}set size(e){this._$size=0|e,this.resize()}get font(){return this._$font}set font(e){this._$font=e,this.resize()}get fontType(){return this._$fontType}set fontType(e){this._$fontType=0|e,this.resize()}get inputType(){return this._$inputType}set inputType(e){this._$inputType=e}get align(){return this._$align}set align(e){this._$align=e}get color(){return this._$color}set color(e){this._$color=0|e}get leading(){return this._$leading}set leading(e){this._$leading=0|e,this.resize()}get letterSpacing(){return this._$letterSpacing}set letterSpacing(e){this._$letterSpacing=0|e,this.resize()}get leftMargin(){return this._$leftMargin}set leftMargin(e){this._$leftMargin=0|e,this.resize()}get rightMargin(){return this._$rightMargin}set rightMargin(e){this._$rightMargin=0|e,this.resize()}get multiline(){return this._$multiline}set multiline(e){this._$multiline=!!e,this.resize()}get border(){return this._$border}set border(e){this._$border=!!e}get scroll(){return this._$scroll}set scroll(e){this._$scroll=!!e}get wordWrap(){return this._$wordWrap}set wordWrap(e){this._$wordWrap=!!e,this.resize()}get bounds(){return this._$bounds}set bounds(e){this._$bounds=e}get originBounds(){return this._$originBounds}set originBounds(e){this._$originBounds=e}get autoSize(){return this._$autoSize}set autoSize(e){this._$autoSize=0|e,1!==this._$autoSize&&(this._$bounds.xMax=this._$originBounds.xMax,this._$bounds.yMax=this._$originBounds.yMax),this.resize()}get thickness(){return this._$thickness}set thickness(e){this._$thickness=0|e,this.resize()}get thicknessColor(){return this._$thicknessColor}set thicknessColor(e){this._$thicknessColor=0|e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,text:this.text,font:this.font,fontType:this.fontType,inputType:this.inputType,size:this.size,align:this.align,color:this.color,leading:this.leading,letterSpacing:this.letterSpacing,leftMargin:this.leftMargin,rightMargin:this.rightMargin,multiline:this.multiline,wordWrap:this.wordWrap,border:this.border,autoSize:this.autoSize,scroll:this.scroll,originBounds:this.originBounds,bounds:this.bounds,thickness:this.thickness,thicknessColor:this.thicknessColor}}get defaultSymbol(){return window.next2d.text.TextField.namespace}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,text:this.text,font:this.font,fontType:this.fontType,inputType:this.inputType,size:this.size,align:this.align,color:this.color,leading:this.leading,letterSpacing:this.letterSpacing,leftMargin:this.leftMargin,rightMargin:this.rightMargin,multiline:this.multiline,wordWrap:this.wordWrap,border:this.border,autoSize:this.autoSize,scroll:this.scroll,originBounds:this.originBounds,bounds:this.bounds,thickness:this.thickness,thicknessColor:this.thicknessColor}}resize(){const e=this.createInstance();this._$bounds={xMin:e._$bounds.xMin,xMax:e._$bounds.xMax,yMin:e._$bounds.yMin,yMax:e._$bounds.yMax}}createInstance(){const{TextField:e}=window.next2d.text,t=new e;t._$bounds={xMin:this._$originBounds.xMin,xMax:this._$originBounds.xMax,yMin:this._$originBounds.yMin,yMax:this._$originBounds.yMax},t._$originBounds={xMin:this._$originBounds.xMin,xMax:this._$originBounds.xMax,yMin:this._$originBounds.yMin,yMax:this._$originBounds.yMax};const a=t.defaultTextFormat;switch(a.font=this._$font,a.size=this._$size,a.align=this._$align,a.color=this._$color,a.leading=this._$leading,a.letterSpacing=this._$letterSpacing,a.leftMargin=this._$leftMargin,a.rightMargin=this._$rightMargin,this._$fontType){case 1:a.bold=!0;break;case 2:a.italic=!0;break;case 3:a.bold=!0,a.italic=!0}switch(this._$autoSize){case 1:t.autoSize=this._$align;break;case 2:t.autoFontSize=!0}return t.multiline=this._$multiline,t.wordWrap=this._$wordWrap,t.border=this._$border,t.scroll=this._$scroll,t.thickness=this._$thickness,t.thicknessColor=this._$thicknessColor,t.text=this._$text,t}toImage(e,t,a){const s=super.toImage(e,t,a);s._$tx-=this._$thickness,s._$ty-=this._$thickness;let r=0;switch(this._$autoSize){case 0:"right"===this._$align&&(r=-4);break;case 1:switch(this._$align){case"center":r=(this._$bounds.xMax-this._$originBounds.xMax)/2,r&&(r-=2);break;case"right":r=this._$originBounds.xMax-this._$bounds.xMax,r&&(r+=2,r*=-1)}}return 1===this._$autoSize&&(s._$tx-=r),s}}class S extends g{constructor(e){super(e),this._$volume=100,this._$loop=!1,this._$autoPlay=!0,this._$binary="",this._$queue=[],this._$loaded=!1,this.buffer=e.buffer,this.width=e.width,this.height=e.height,"volume"in e&&(this.volume=e.volume),"loop"in e&&(this.loop=e.loop),"autoPlay"in e&&(this.autoPlay=e.autoPlay),this._$video=document.createElement("video"),this._$video.crossOrigin="anonymous",this._$video.type="video/mp4",this._$video.muted=!0,this._$video.autoplay=!1;const t=e=>{e.target.removeEventListener("canplaythrough",t),e.target.play(),e.target.currentTime=1,e.target.pause(),this._$loaded=!0,setTimeout((()=>{this.delayImage()}),150)};this._$video.addEventListener("canplaythrough",t),this._$video.src=URL.createObjectURL(new Blob([new Uint8Array(this._$buffer)],{type:"video/mp4"})),this._$video.load()}initialize(){}get preview(){const e=this.getBounds();let t=Math.abs(e.xMax-e.xMin),a=Math.abs(e.yMax-e.yMin),s=1;const r=150/a;t=t*r|0,a=a*r|0;const i=(0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0])-10;return t>i&&(s=i/t,t=t*s|0,a=a*s|0),this._$video.style.width=`${t}px`,this._$video.style.height=`${a}px`,this._$video.controls=!0,this._$video}getBounds(){return{xMin:0,xMax:this.width,yMin:0,yMax:this.height}}get defaultSymbol(){return window.next2d.media.Video.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let a=0;a<t;++a)this._$buffer[a]=255&e.charCodeAt(a);this._$binary=e}}}get volume(){return this._$volume}set volume(e){this._$volume=e}get loop(){return this._$loop}set loop(e){this._$loop=e}get autoPlay(){return this._$autoPlay}set autoPlay(e){this._$autoPlay=e}get width(){return this._$width}set width(e){this._$width=e}get height(){return this._$height}set height(e){this._$height=e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,width:this.width,height:this.height,buffer:this.buffer,volume:this.volume,loop:this.loop,autoPlay:this.autoPlay}}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,buffer:Array.from(this._$buffer),bounds:this.getBounds(),volume:this.volume/100,loop:this.loop,autoPlay:this.autoPlay}}createInstance(){const{Video:e}=window.next2d.media,t=this._$loaded?new e(this._$video.videoWidth,this._$video.videoHeight):new e(this.width,this.height);if(t._$video=this._$video,this._$loaded){const e=d.$root.stage._$player._$context;t._$texture=e.frameBuffer.createTextureFromVideo(t._$video,t._$smoothing)}return t}delayImage(){for(let e=0;e<this._$queue.length;++e){const t=this._$queue[e];t.image.src=this.toImage(t.width,t.height,t.place).src}this._$queue.length=0}toImage(e,t,a){const s=super.toImage(e,t,a);return this._$loaded||this._$queue.push({image:s,width:e,height:t,place:a}),s}}class L{constructor(e=null){this._$blurX=4,this._$blurY=4,this._$quality=1,this._$state=!0,this._$name="",e&&(this.blurX=e.blurX,this.blurY=e.blurY,this.quality=0|e.quality,this.state=e.state)}clone(){return new this.constructor(this.toObject())}isSame(e){return this._$quality===e._$quality&&(this._$blurX===e._$blurX&&this._$blurY===e._$blurY)}get blurX(){return this._$blurX}set blurX(e){this._$blurX=d.$clamp(+e,d.MIN_BLUR,d.MAX_BLUR)}get blurY(){return this._$blurY}set blurY(e){this._$blurY=d.$clamp(+e,d.MIN_BLUR,d.MAX_BLUR)}get quality(){return this._$quality}set quality(e){this._$quality=d.$clamp(0|e,1,3)}get state(){return this._$state}set state(e){this._$state=e}get name(){return this._$name}set name(e){this._$name=e}}class x extends L{constructor(e=null){super(e),this.name="BevelFilter",this._$distance=4,this._$angle=45,this._$highlightColor=16777215,this._$highlightAlpha=100,this._$shadowColor=0,this._$shadowAlpha=100,this._$strength=1,this._$type="inner",this._$knockout=!1,e&&(this.distance=e.distance,this.angle=e.angle,this.highlightColor=0|e.highlightColor,this.highlightAlpha=100*e.highlightAlpha,this.shadowColor=0|e.shadowColor,this.shadowAlpha=100*e.shadowAlpha,this.strength=e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,d.MIN_DISTANCE,d.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get highlightColor(){return this._$highlightColor}set highlightColor(e){this._$highlightColor=d.$clamp(0|e,0,16777215)}get highlightAlpha(){return this._$highlightAlpha}set highlightAlpha(e){this._$highlightAlpha=d.$clamp(+e,0,100)}get shadowColor(){return this._$shadowColor}set shadowColor(e){this._$shadowColor=d.$clamp(0|e,0,16777215)}get shadowAlpha(){return this._$shadowAlpha}set shadowAlpha(e){this._$shadowAlpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,d.MIN_STRENGTH,d.MAX_STRENGTH)}get type(){return this._$type}set type(e){this._$type=e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=e}isSame(e){return this._$distance===e._$distance&&(this._$angle===e._$angle&&(this._$highlightColor===e._$highlightColor&&(this._$highlightAlpha===e._$highlightAlpha&&(this._$shadowColor===e._$shadowColor&&(this._$shadowAlpha===e._$shadowAlpha&&(this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))))))))}createInstance(){return new window.next2d.filters.BevelFilter(this.distance,this.angle,this.highlightColor,this.highlightAlpha/100,this.shadowColor,this.shadowAlpha/100,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){return[null,this.distance,this.angle,this.highlightColor,this.highlightAlpha/100,this.shadowColor,this.shadowAlpha/100,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,highlightColor:this.highlightColor,highlightAlpha:this.highlightAlpha/100,shadowColor:this.shadowColor,shadowAlpha:this.shadowAlpha/100,strength:this.strength,type:this.type,knockout:this.knockout}}}class w extends L{constructor(e=null){super(e),this.name="BlurFilter"}createInstance(){return new window.next2d.filters.BlurFilter(this.blurX,this.blurY,this.quality)}toParamArray(){return[null,this.blurX,this.blurY,this.quality]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state}}}class M extends L{constructor(e=null){super(e),this.name="DropShadowFilter",this._$distance=4,this._$angle=45,this._$color=0,this._$alpha=100,this._$strength=1,this._$inner=!1,this._$knockout=!1,this._$hideObject=!1,e&&(this.distance=e.distance,this.angle=e.angle,this.color=e.color,this.alpha=100*e.alpha,this.strength=e.strength,this.inner=e.inner,this.knockout=e.knockout,this.hideObject=e.hideObject)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,d.MIN_DISTANCE,d.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get color(){return this._$color}set color(e){this._$color=d.$clamp(0|e,0,16777215)}get alpha(){return this._$alpha}set alpha(e){this._$alpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,d.MIN_STRENGTH,d.MAX_STRENGTH)}get inner(){return this._$inner}set inner(e){this._$inner=e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=e}get hideObject(){return this._$hideObject}set hideObject(e){this._$hideObject=e}isSame(e){return this._$distance===e._$distance&&(this._$angle===e._$angle&&(this._$color===e._$color&&(this._$alpha===e._$alpha&&(this._$strength===e._$strength&&(this._$inner===e._$inner&&(this._$knockout===e._$knockout&&(this._$hideObject===e._$hideObject&&super.isSame(e))))))))}createInstance(){return new window.next2d.filters.DropShadowFilter(this.distance,this.angle,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout,this.hideObject)}toParamArray(){return[null,this.distance,this.angle,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout,this.hideObject]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,color:this.color,alpha:this.alpha/100,strength:this.strength,inner:this.inner,knockout:this.knockout,hideObject:this.hideObject}}}class B extends L{constructor(e=null){super(e),this.name="GlowFilter",this._$color=0,this._$alpha=100,this._$strength=1,this._$inner=!1,this._$knockout=!1,e&&(this.color=e.color,this.alpha=100*e.alpha,this.strength=e.strength,this.inner=e.inner,this.knockout=e.knockout)}get color(){return this._$color}set color(e){this._$color=+e}get alpha(){return this._$alpha}set alpha(e){this._$alpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,d.MIN_STRENGTH,d.MAX_STRENGTH)}get inner(){return this._$inner}set inner(e){this._$inner=e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=e}isSame(e){return this._$color===e._$color&&(this._$alpha===e._$alpha&&(this._$strength===e._$strength&&(this._$inner===e._$inner&&(this._$knockout===e._$knockout&&super.isSame(e)))))}createInstance(){return new window.next2d.filters.GlowFilter(this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout)}toParamArray(){return[null,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,color:this.color,alpha:this.alpha/100,strength:this.strength,inner:this.inner,knockout:this.knockout}}}class T extends L{constructor(e=null){super(e),this.name="GradientBevelFilter",this._$distance=4,this._$angle=45,this._$colors=[16777215,16711680,0],this._$alphas=[100,0,100],this._$ratios=[0,128,255],this._$strength=1,this._$type="inner",this._$knockout=!1,e&&(this.distance=+e.distance,this.angle=+e.angle,this.colors=e.colors,this.alphas=e.alphas,this.ratios=e.ratios,this.strength=+e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,d.MIN_DISTANCE,d.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get colors(){return this._$colors}set colors(e){this._$colors.length=0,this._$colors=e}get alphas(){return this._$alphas}set alphas(e){this._$alphas.length=0;for(let t=0;t<e.length;++t)this._$alphas.push(100*e[t])}get ratios(){return this._$ratios}set ratios(e){this._$ratios.length=0;for(let t=0;t<e.length;++t)this._$ratios.push(255*e[t])}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,d.MIN_STRENGTH,d.MAX_STRENGTH)}get type(){return this._$type}set type(e){this._$type=e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=e}adjustment(){const e=[],t=[],a=[],s=new Map;for(let t=0;t<this._$ratios.length;++t){const a=this._$ratios[t]/255;e.push(a),s.set(a,t)}e.sort((function(e,t){switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let r=0;r<e.length;++r){const i=s.get(e[r]);t.push(this._$colors[i]),a.push(this._$alphas[i]/100)}return{ratios:e,colors:t,alphas:a}}isSame(e){if(this._$distance!==e._$distance)return!1;if(this._$angle!==e._$angle)return!1;for(let t=0;t<this._$colors.length;++t)if(this._$colors[t]!==e._$colors[t])return!1;for(let t=0;t<this._$alphas.length;++t)if(this._$alphas[t]!==e._$alphas[t])return!1;for(let t=0;t<this._$ratios.length;++t)if(this._$ratios[t]!==e._$ratios[t])return!1;return this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))}createInstance(){const e=this.adjustment();return new window.next2d.filters.GradientBevelFilter(this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){const e=this.adjustment();return[null,this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){const e=this.adjustment();return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,colors:e.colors,alphas:e.alphas,ratios:e.ratios,strength:this.strength,type:this.type,knockout:this.knockout}}}class C extends L{constructor(e=null){super(e),this.name="GradientGlowFilter",this._$distance=4,this._$angle=45,this._$colors=[16777215,0],this._$alphas=[0,100],this._$ratios=[0,255],this._$strength=1,this._$type="outer",this._$knockout=!1,e&&(this.distance=+e.distance,this.angle=+e.angle,this.colors=e.colors,this.alphas=e.alphas,this.ratios=e.ratios,this.strength=+e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,d.MIN_DISTANCE,d.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get colors(){return this._$colors}set colors(e){this._$colors.length=0,this._$colors=e}get alphas(){return this._$alphas}set alphas(e){this._$alphas.length=0;for(let t=0;t<e.length;++t)this._$alphas.push(100*e[t])}get ratios(){return this._$ratios}set ratios(e){this._$ratios.length=0;for(let t=0;t<e.length;++t)this._$ratios.push(255*e[t])}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,d.MIN_STRENGTH,d.MAX_STRENGTH)}get type(){return this._$type}set type(e){this._$type=e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=e}adjustment(){const e=[],t=[],a=[],s=new Map;for(let t=0;t<this._$ratios.length;++t){const a=this._$ratios[t]/255;e.push(a),s.set(a,t)}e.sort((function(e,t){switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let r=0;r<e.length;++r){const i=s.get(e[r]);t.push(this._$colors[i]),a.push(this._$alphas[i]/100)}return{ratios:e,colors:t,alphas:a}}isSame(e){if(this._$distance!==e._$distance)return!1;if(this._$angle!==e._$angle)return!1;for(let t=0;t<this._$colors.length;++t)if(this._$colors[t]!==e._$colors[t])return!1;for(let t=0;t<this._$alphas.length;++t)if(this._$alphas[t]!==e._$alphas[t])return!1;for(let t=0;t<this._$ratios.length;++t)if(this._$ratios[t]!==e._$ratios[t])return!1;return this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))}createInstance(){const e=this.adjustment();return new window.next2d.filters.GradientGlowFilter(this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){const e=this.adjustment();return[null,this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){const e=this.adjustment();return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,colors:e.colors,alphas:e.alphas,ratios:e.ratios,strength:this.strength,type:this.type,knockout:this.knockout}}}class A{constructor(){this._$buffer=null,this._$bitOffset=0,this._$byteOffset=0}setData(e){this._$buffer=e}getData(e){this.byteAlign();const t=this._$byteOffset+e,a=this._$buffer.slice(this._$byteOffset,t);return this._$byteOffset=t,a}getHeaderSignature(){let e="",t=3;for(;t;){const a=this.getUI8();switch(a){case 32:case 96:case 127:continue}e+=String.fromCharCode(a),--t}return e}getVersion(){return this.getUI8()}byteAlign(){this._$bitOffset&&(this._$byteOffset=this._$byteOffset+(this._$bitOffset+7)/8|0,this._$bitOffset=0)}byteCarry(){if(this._$bitOffset>7)this._$byteOffset=this._$byteOffset+(0|(this._$bitOffset+7)/8),this._$bitOffset&=7;else for(;this._$bitOffset<0;)--this._$byteOffset,this._$bitOffset+=8}getUIBits(e){let t=0;for(;e;)t<<=1,t|=this.getUIBit(),--e;return t}getUIBit(){return this.byteCarry(),this._$buffer[this._$byteOffset]>>7-this._$bitOffset++&1}getSIBits(e){const t=this.getUIBits(e),a=t&1<<e-1;return a?-(t^2*a-1)-1:t}getUI8(){return this.byteAlign(),this._$buffer[this._$byteOffset++]}getUI16(){return this.byteAlign(),this.getUI8()|this.getUI8()<<8}getUI32(){return this.byteAlign(),this.getUI8()|(this.getUI8()|(this.getUI8()|this.getUI8()<<8)<<8)<<8}}class F{constructor(){this._$byteStream=new A,this._$callback=null,this._$bounds={xMin:0,xMax:0,yMin:0,yMax:0},this._$swfVersion=0,this._$info=null,this._$buildData=null,this._$fileSize=0,this._$mode="swf",this._$offset=0}setData(e){return this._$byteStream.setData(e),this}run(e=null){this._$callback=e;const t=this._$byteStream.getHeaderSignature();this._$byteStream.getVersion();switch(this._$fileSize=this._$byteStream.getUI32(),this._$mode="swf",t){case"FWS":return this.parseAndBuild();case"CWS":{if(d.$unzipWorkerActive)return void d.$unzipQueues.push(this);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const e=d.$unzipWorker;e.onmessage=d.$unzipHandler.bind(this);const t=this._$byteStream._$buffer;e.postMessage({fileSize:this._$fileSize,mode:this._$mode,buffer:t},[t.buffer])}break;case"ZWS":{if(d.$unlzmaWorkerActive)return void d.$unlzmaQueues.push(this);d.$unlzmaWorkerActive=!0;const e=new Worker(d.$unlzmaWorkerURL);e.onmessage=d.$unlzmaHandler.bind(this);const t=this._$byteStream._$buffer;e.postMessage({fileSize:this._$fileSize,mode:this._$mode,buffer:t},[t.buffer])}break;default:throw new Error("this data is not swf.")}}parseAndBuild(){this._$byteStream.byteAlign();const e=this._$byteStream.getUIBits(5);if(this._$bounds.xMin=this._$byteStream.getSIBits(e),this._$bounds.xMax=this._$byteStream.getSIBits(e),this._$bounds.yMin=this._$byteStream.getSIBits(e),this._$bounds.yMax=this._$byteStream.getSIBits(e),this._$byteStream.getUI16(),this._$byteStream.getUI16(),this._$offset=this._$byteStream._$byteOffset,d.$parserWorkerWait)return void d.$parserQueues.push(this);d.$parserWorkerWait=!0,d.$parserWorker||(d.$parserWorker=new Worker(d.$parserURL)),d.$parserWorker.onmessage=d.$parserHandler.bind(this);const t=this._$byteStream._$buffer;d.$parserWorker.postMessage({version:this._$swfVersion,offset:this._$offset,buffer:t},[t.buffer])}build(){const e=this.buildData.info,t=this.buildData.parent;this.loaderInfo._$bytes._$byteArray=this.buildData.buffer,this.loaderInfo._$actionScriptVersion=e._$asv;let a=!1,s=this.loaderInfo._$symbols.length;if(s){const e=this.loaderInfo._$applicationDomain,t=d.$getArray();for(let r=0;r<s;++r){const s=this.loaderInfo._$symbols[r],i=s.tagId;switch(0===i&&(a=!0),!0){case i in this.loaderInfo._$characters:case this.loaderInfo._$fonts.has(i):{const t=d.$getPackage(e,s.path);if(t._$loaderInfoId===this.loaderInfo._$id||!("__$$characterId"in t.prototype)){t.prototype.__$$characterId=i,t.prototype.__$$loaderInfoId=this.loaderInfo._$id;const e=t.__$$slots,a=d.$Object.keys(e),s=a.length;for(let t=0;t<s;++t){const s=e[a[t]];s.__$$classInit&&s.__$$classInit()}d.$poolArray(a)}}}t[i]=s.path}this.loaderInfo._$symbols=t}if(a){const e=d.$buildAVM2(this.loaderInfo._$applicationDomain,this.loaderInfo._$symbols[0]);e._$root=e,e._$symbolBuild(0,this.loaderInfo._$id,t),this.loaderInfo._$content=e}else v._$targetBuild(this.loaderInfo._$content,t),this.loaderInfo._$content._$characterBuild();if(s=e._$sceneInfo.length,s){const t=d.$getArray();for(let a=0;a<s;++a){const s=e._$sceneInfo[a],r=new Scene(s.name,d.$getArray(),1);r._$offset=s.offset;const i=a+1|0;let n=this.loaderInfo._$content._$totalFrames;i in e._$sceneInfo&&(n=0|e._$sceneInfo[i].offset),r._$numFrames=n-r._$offset|0;const o=this.loaderInfo._$content.currentLabels;if(o){const e=o.length,t=d.$getArray();for(let a=0;a<e;++a){const e=o[a];e.frame>s.offset&&e.frame<=n&&(t[t.length]=e)}r._$labels=t}t[t.length]=r}this.loaderInfo._$content._$scenes=t}this._$callback(this.loaderInfo._$content)}}class U{static parse(e,t){const a=/<defs>(.*)<\/defs>/gis.exec(e)[1],s=U.parseXML(`${e.replace(/<defs>(.*)<\/defs>/gis,"")}`);if(s){U.parsePath(s,a,t);const e=[];for(const a of t._$layers.values())e.unshift(a);t.clearLayer();for(let a=0;a<e.length;++a)t.setLayer(a,e[a])}}static parseXML(e){const t=/<((path|rect|circle|polygon).+?)\/>/gi,a=[];for(let s="1";s;)s=t.exec(e),s&&a.push(s[1]);return a}static parsePath(e,t,a){const{Shape:s,Graphics:r}=window.next2d.display,i=d.$currentWorkSpace();for(let t=0;t<e.length;++t){const n=(new s).graphics,o=e[t];let l=/stroke-width=\"(.+?)\"/gi.exec(o);if(l||(l=/stroke-width:(.+?)["|;]/gi.exec(o)),l&&(l=+l[1],l)){let e=/stroke=\"(.+?)\"/gi.exec(o);e||(e=/stroke:(.+?)["|;]/gi.exec(o)),n.lineStyle(l,e?e[1]:0)}let c=/fill=\"(.+?)\"/gi.exec(o);c||(c=/fill:(.+?)["|;]/gi.exec(o));let h=1,m=/style=\"(.+?)\"/gi.exec(o);m&&m[1].indexOf("opacity")>-1&&(h=m[1].split(":")[1]),c?n.beginFill(c[1],+h):l||n.beginFill(0,+h);const u=i.nextLibraryId,f=i.addLibrary(d.$controller.createContainer("shape",`Shape_${u}`,u)),g=new _;g.name=`Layer_${a._$layers.size}`,g._$frame.setClasses(1,["key-frame"]),a.setLayer(a._$layers.size,g);const y=new $;if(y.libraryId=f.id,y.startFrame=1,y.endFrame=g.getEndFrame(2),y.setPlace(1,{frame:1,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:g._$characters.length}),g.addCharacter(y),o.indexOf("rect")>-1){const e=o.replace("rect",""),t=+/x=\"(.+?)\"/gi.exec(e)[1],a=+/y=\"(.+?)\"/gi.exec(e)[1],s=+/width=\"(.+?)\"/gi.exec(e)[1],r=+/height=\"(.+?)\"/gi.exec(e)[1],i=+/rx=\"(.+?)\"/gi.exec(e)[1];n.drawRoundRect(t,a,s,r,2*i).endFill(),f._$recodes=n._$recode.slice(),f._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax};continue}if(o.indexOf("circle")>-1){const e=o.replace("rect",""),t=+/cx=\"(.+?)\"/gi.exec(e)[1],a=+/cy=\"(.+?)\"/gi.exec(e)[1],s=+/r=\"(.+?)\"/gi.exec(e)[1];n.drawCircle(t,a,s).endFill(),f._$recodes=n._$recode.slice(),f._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax};continue}if(o.indexOf("polygon")>-1){const e=o.replace("polygon","");let t=/points=\"(.+?)\"/gi.exec(e)[1];t=t.replace(/,/g," "),t=t.replace(/-/g," -"),t=t.trim().split(" "),t=U._$adjParam(t),n.moveTo(+t[0],+t[1]);for(let e=2;e<t.length;e+=2)n.lineTo(+t[e],+t[e+1]);n.endFill(),f._$recodes=n._$recode.slice(),f._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax};continue}let p=!1,b=0,v=0;const I=[0,0],k=[0,0],E=/([a-z])([^a-z]*)/gi,S=/d=\"(.+?)\"/gi.exec(o)[1];for(let e="1";e;)if(e=E.exec(S),e){const t=`${e[1]}`;let a=e[2];switch(t){case"m":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a),I[0]+=+a[0],I[1]+=+a[1],p||(p=!0,b=I[0],v=I[1]),n.moveTo(I[0],I[1]);for(let e=2;e<a.length;e+=2)I[0]+=+a[e],I[1]+=+a[e+1],k[0]=I[0],k[1]=I[1],n.lineTo(I[0],I[1]);break;case"M":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a),I[0]=+a[0],I[1]=+a[1],p||(p=!0,b=I[0],v=I[1]),n.moveTo(I[0],I[1]);for(let e=2;e<a.length;e+=2)I[0]=+a[e],I[1]=+a[e+1],k[0]=I[0],k[1]=I[1],n.lineTo(I[0],I[1]);break;case"l":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a);for(let e=0;e<a.length;e+=2)I[0]+=+a[e],I[1]+=+a[e+1],k[0]=I[0],k[1]=I[1],n.lineTo(I[0],I[1]);break;case"L":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a);for(let e=0;e<a.length;e+=2)I[0]=+a[e],I[1]=+a[e+1],k[0]=I[0],k[1]=I[1],n.lineTo(I[0],I[1]);break;case"h":I[0]+=+a,k[0]=I[0],n.lineTo(I[0],I[1]);break;case"H":I[0]=+a,k[0]=I[0],n.lineTo(I[0],I[1]);break;case"v":I[1]+=+a,k[1]=I[1],n.lineTo(I[0],I[1]);break;case"V":I[1]=+a,k[1]=I[1],n.lineTo(I[0],I[1]);break;case"q":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a);for(let e=0;e<a.length;e+=4)a[e]=+a[e]+I[0],a[e+1]=+a[e+1]+I[1],a[e+2]=+a[e+2]+I[0],a[e+3]=+a[e+3]+I[1],n.curveTo(a[e],a[e+1],a[e+2],a[e+3]),I[0]=a[e+2],I[1]=a[e+3],k[0]=I[0],k[1]=I[1];break;case"Q":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a);for(let e=0;e<a.length;e+=4)a[e]=+a[e],a[e+1]=+a[e+1],a[e+2]=+a[e+2],a[e+3]=+a[e+3],n.curveTo(a[e],a[e+1],a[e+2],a[e+3]),I[0]=a[e+2],I[1]=a[e+3],k[0]=I[0],k[1]=I[1];break;case"c":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a);for(let e=0;e<a.length;e+=6)a[e]=+a[e]+I[0],a[e+1]=+a[e+1]+I[1],a[e+2]=+a[e+2]+I[0],a[e+3]=+a[e+3]+I[1],a[e+4]=+a[e+4]+I[0],a[e+5]=+a[e+5]+I[1],n.cubicCurveTo(a[e],a[e+1],a[e+2],a[e+3],a[e+4],a[e+5]),I[0]=a[e+4],I[1]=a[e+5],k[0]=2*a[e+4]-a[e+2],k[1]=2*a[e+5]-a[e+3];break;case"C":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a);for(let e=0;e<a.length;e+=6)a[e]=+a[e],a[e+1]=+a[e+1],a[e+2]=+a[e+2],a[e+3]=+a[e+3],a[e+4]=+a[e+4],a[e+5]=+a[e+5],n.cubicCurveTo(a[e],a[e+1],a[e+2],a[e+3],a[e+4],a[e+5]),I[0]=a[e+4],I[1]=a[e+5],k[0]=2*a[e+4]-a[e+2],k[1]=2*a[e+5]-a[e+3];break;case"s":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a);for(let e=0;e<a.length;e+=4)a[e]=+a[e]+I[0],a[e+1]=+a[e+1]+I[1],a[e+2]=+a[e+2]+I[0],a[e+3]=+a[e+3]+I[1],n.cubicCurveTo(k[0],k[1],a[e],a[e+1],a[e+2],a[e+3]),I[0]=a[e+2],I[1]=a[e+3],k[0]=2*a[e+2]-a[e],k[1]=2*a[e+3]-a[e+1];break;case"S":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a);for(let e=0;e<a.length;e+=4)a[e]=+a[e],a[e+1]=+a[e+1],a[e+2]=+a[e+2],a[e+3]=+a[e+3],n.cubicCurveTo(k[0],k[1],a[e],a[e+1],a[e+2],a[e+3]),I[0]=a[e+2],I[1]=a[e+3],k[0]=2*a[e+2]-a[e],k[1]=2*a[e+3]-a[e+1];break;case"a":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a);for(let e=0;e<a.length;e+=7){a[e]=+a[e],a[e+1]=+a[e+1],a[e+2]=+a[e+2],a[e+3]=+a[e+3],a[e+4]=+a[e+4],a[e+5]=+a[e+5]+I[0],a[e+6]=+a[e+6]+I[1];const t=U._$arcToCurve(I[0],I[1],a[e+5],a[e+6],a[e+3],a[e+4],a[e],a[e+1],a[e+2]);for(let e=0;e<t.length;++e){const a=t[e];n.cubicCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])}I[0]=a[e+5],I[1]=a[e+6],k[0]=I[0],k[1]=I[1]}break;case"A":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=U._$adjParam(a);for(let e=0;e<a.length;e+=7){a[e]=+a[e],a[e+1]=+a[e+1],a[e+2]=+a[e+2],a[e+3]=+a[e+3],a[e+4]=+a[e+4],a[e+5]=+a[e+5],a[e+6]=+a[e+6];const t=U._$arcToCurve(I[0],I[1],a[e+5],a[e+6],a[e+3],a[e+4],a[e],a[e+1],a[e+2]);for(let e=0;e<t.length;++e){const a=t[e];n.cubicCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])}I[0]=a[e+5],I[1]=a[e+6],k[0]=I[0],k[1]=I[1]}break;case"z":case"Z":n._$fills&&n._$fills.push(r.CLOSE_PATH),n._$lines&&n._$lines.push(r.CLOSE_PATH),I[0]=b,I[1]=v,k[0]=I[0],k[1]=I[1],p=!1;break;default:console.log("TODO: ",t,a)}}n.endLine(),n.endFill(),n._$recode&&(f._$recodes=n._$recode.slice()),f._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax}}}static _$adjParam(e){for(;;){let t=0;for(let a=0;a<e.length;++a){const s=e[a];if(!isNaN(s)){t++;continue}const r=s.split(".");e.splice(a+1,0,`0.${r.pop()}`),e[a]=r.join(".")}if(e.length===t)break}return e}static _$arc(e,t,a,s,r,i){let n=Math.min(Math.ceil(2*s+1),1024);if(n<1)return;r=void 0===r?0:r;const o=((i=void 0===i?2*Math.PI:i)-r)/n;for(let i=0;i<=n;i++){const n=r+i*o;e.lineTo(t+Math.cos(n)*s,a+Math.sin(n)*s)}}static _$arcToCurve(e,t,a,s,r,i,n,o,l){const c=2*Math.PI,d=Math.sin(l*c/360),h=Math.cos(l*c/360),m=h*(e-a)/2+d*(t-s)/2,u=-d*(e-a)/2+h*(t-s)/2;if(0===m&&0===u||0===n||0===o)return[];n=Math.abs(n),o=Math.abs(o);const f=m*m/(n*n)+u*u/(o*o);f>1&&(n*=Math.sqrt(f),o*=Math.sqrt(f));const g=U._$getArcCenter(e,t,a,s,r,i,n,o,d,h),y=[];let $=g[2],p=g[3];const b=Math.max(Math.ceil(Math.abs(p)/(c/4)),1);p/=b;for(let e=0;e<b;e++)y.push(U._$approximateUnitArc($,p)),$+=p;return y.map((e=>{for(let t=0;t<e.length;t+=2){let a=e[t],s=e[t+1];a*=n,s*=o;const r=h*a-d*s,i=d*a+h*s;e[t]=r+g[0],e[t+1]=i+g[1]}return e.shift(),e.shift(),e}))}static _$approximateUnitArc(e,t){const a=4/3*Math.tan(t/4),s=Math.cos(e),r=Math.sin(e),i=Math.cos(e+t),n=Math.sin(e+t);return[s,r,s-r*a,r+s*a,i+n*a,n-i*a,i,n]}static _$getArcCenter(e,t,a,s,r,i,n,o,l,c){const d=2*Math.PI,h=c*(e-a)/2+l*(t-s)/2,m=-l*(e-a)/2+c*(t-s)/2,u=n*n,f=o*o,g=h*h,y=m*m;let $=u*f-u*y-f*g;$<0&&($=0),$/=u*y+f*g,$=Math.sqrt($)*(r===i?-1:1);const p=$*n/o*m,b=$*-o/n*h,_=c*p-l*b+(e+a)/2,v=l*p+c*b+(t+s)/2,I=(h-p)/n,k=(m-b)/o,E=(-h-p)/n,S=(-m-b)/o,L=U._$unitVectorAngle(1,0,I,k);let x=U._$unitVectorAngle(I,k,E,S);return 0===i&&x>0&&(x-=d),1===i&&x<0&&(x+=d),[_,v,L,x]}static _$unitVectorAngle(e,t,a,s){let r=e*a+t*s;return r>1&&(r=1),r<-1&&(r=-1),(e*s-t*a<0?-1:1)*Math.acos(r)}}d.$vtc=new class{clone(e){const t=function(e,a){const s=Object.keys(e),r=0|s.length;for(let i=0;i<r;++i){const r=s[i],n=e[r];switch(!0){case d.$isArray(n):a[r]=[],t(n,a[r]);break;case"object"==typeof n:a[r]={},t(n,a[r]);break;default:a[r]=n}}},a={};return t(e,a),a}convert(e,t=!1){let a=e.lineStyles,s=e.fillStyles,r=0,i={},n=[],o=0,l=0,c=0,d=0,h=0,m=0,u=0,f=0,g=0,y=[],$=[],p=[],b=[],_=0;const v=e.ShapeData,I=v.records,k=v.styles;let E=0,S=0;for(;;){const e=I[E++];if(-1===e){b=this.setStack(b,this.fillMerge(y,$,t)),b=this.setStack(b,p);break}if(e){if(++_,I[E++]){b=this.setStack(b,this.fillMerge(y,$,t)),b=this.setStack(b,p),o=0,l=0,y=[],$=[],p=[];const e=k[S++];I[E++]&&(s=e.FillStyles),I[E++]&&(a=e.LineStyles)}c=o,d=l,I[E++]&&(c=o=I[E++]/20,d=o=I[E++]/20),h=c,m=d,I[E++]&&(u=I[E++]),I[E++]&&(f=I[E++]),I[E++]&&(g=I[E++]);continue}const v=I[E++],L=v?I[E++]/20:0,x=v?I[E++]/20:0;o=I[E++]/20,l=I[E++]/20;const w={isCurved:v,ControlX:L,ControlY:x,AnchorX:o,AnchorY:l};if(u&&(r=u-1|0,r in y||(y[r]=[]),_ in y[r]||(y[r][_]={obj:s?s[r]:null,startX:c,startY:d,endX:0,endY:0,cache:[]}),i=y[r][_],n=i.cache,n[n.length]=this.clone(w),i.endX=o,i.endY=l),f&&(r=f-1|0,r in $||($[r]=[]),_ in $[r]||($[r][_]={obj:s?s[r]:null,startX:c,startY:d,endX:0,endY:0,cache:[]}),i=$[r][_],n=i.cache,n[n.length]=this.clone(w),i.endX=o,i.endY=l),g){r=g-1|0,r in p||(p[r]={obj:a?a[r]:null,cache:[]}),i=p[r],n=i.cache,n[n.length]=[0,h,m];let e=[2,o,l];v&&(e=[1,L,x,o,l]),n[n.length]=e}h=o,m=l}return this.toGraphicPath(b)}toGraphicPath(e){const{Graphics:t,GradientType:a,InterpolationMethod:s,SpreadMethod:r,CapsStyle:i,JointStyle:n}=window.next2d.display,o=[];for(let l=0;l<e.length;++l){const c=e[l];o.push(t.BEGIN_PATH);for(let e=0;e<c.recode.length;++e)o.push.apply(o,c.recode[e]);const h="Width"in c.object;let m=0,u=i.NONE,f=0,g=n.ROUND;if(h){switch(m=c.object.Width,c.object.StartCapStyle){case 0:u=i.ROUND;break;case 1:u=i.NONE;break;case 2:u=i.SQUARE}switch(c.object.JoinStyle){case 0:g=n.ROUND;break;case 1:g=n.BEVEL;break;case 2:g=n.MITER,f=c.object.MiterLimitFactor}}const y=c.object.HasFillFlag?c.object.FillType:c.object;switch(y.fillStyleType){case 0:h?o.push(t.STROKE_STYLE,m,u,g,f,y.Color.R,y.Color.G,y.Color.B,255*y.Color.A,t.END_STROKE):o.push(t.FILL_STYLE,y.Color.R,y.Color.G,y.Color.B,255*y.Color.A,t.END_FILL);break;case 16:case 18:case 19:{const e=y.gradient,i=[],n=e.GradientRecords;for(let e=0;e<n.length;++e){const t=n[e];i.push({ratio:t.Ratio,R:t.Color.R,G:t.Color.G,B:t.Color.B,A:255*t.Color.A})}const l=0===e.InterpolationMode?s.RGB:s.LINEAR_RGB;let c=r.PAD;switch(e.SpreadMode){case 0:c=r.PAD;break;case 1:c=r.REFLECT;break;case 2:c=r.REPEAT}h?o.push(t.GRADIENT_STROKE,m,u,g,f,16===y.fillStyleType?a.LINEAR:a.RADIAL,i,y.gradientMatrix,c,l,e.FocalPoint):o.push(t.GRADIENT_FILL,16===y.fillStyleType?a.LINEAR:a.RADIAL,i,y.gradientMatrix,c,l,e.FocalPoint)}break;case 64:case 65:case 66:case 67:{const e=d.$currentWorkSpace().getLibrary(d.$characters.get(y.bitmapId)),a=function(e,s){if(!this._$buffer)return requestAnimationFrame(a);const r=64===s.fillStyleType||65===s.fillStyleType,i=64===s.fillStyleType||66===s.fillStyleType,n=d.$multiplicationMatrix(s.bitmapMatrix,[.05,0,0,.05,0,0]),{BitmapData:o}=window.next2d.display,l=new o(this.width,this.height,!0,0);l._$buffer=this._$buffer,e.push(t.BITMAP_FILL,l,n,i?"repeat":"no-repeat",r)}.bind(e,o,y);a()}}}return o}fillMerge(e,t,a){if((e=this.fillReverse(e)).length){const a=Object.keys(e),s=0|a.length;for(let r=0;r<s;++r){const s=a[r],i=e[s];if(s in t){const e=t[s],a=Object.keys(i),r=0|a.length;for(let t=0;t<r;++t)e[e.length]=i[a[t]]}else t[s]=i}}return this.coordinateAdjustment(t,a)}fillReverse(e){if(!e.length)return e;const t=Object.keys(e),a=0|t.length;for(let s=0;s<a;++s){const a=e[t[s]],r=Object.keys(a),i=0|r.length;for(let e=0;e<i;++e){let t=0,s=0;const i=a[r[e]];let n=i.startX,o=i.startY;const l=i.cache;let c=0|l.length;if(c){const e=Object.keys(l),a=0|e.length;for(let r=0;r<a;++r){const a=l[e[r]];t=a.AnchorX,s=a.AnchorY,a.AnchorX=n,a.AnchorY=o,n=t,o=s}const r=[];if(c>0)for(;c;)--c,r[r.length]=l[c];i.cache=r}n=i.startX,o=i.startY,i.startX=i.endX,i.startY=i.endY,i.endX=n,i.endY=o}}return e}coordinateAdjustment(e,t){const a=Object.keys(e),s=0|a.length;for(let r=0;r<s;++r){const s=a[r],i=[],n=e[s],o=Object.keys(n),l=0|o.length;for(let e=0;e<l;++e)i[i.length]=n[o[e]];let c=[];if(!0==(i.length>1&&!t))for(;i.length;){const e=i.shift();if(e.startX===e.endX&&e.startY===e.endY){c[c.length]=e;continue}let t=0,a=0|i.length;for(;a;){--a;const s=i[a];if(s.startX===e.endX&&s.startY===e.endY){e.endX=s.endX,e.endY=s.endY;const r=e.cache,n=s.cache,o=0|n.length;for(let e=0;e<o;++e)r[r.length]=n[e];i.splice(a,1),i.unshift(e),t=1;break}}t||i.unshift(e)}else c=i;const d=0|c.length,h=[];let m={};for(let e=0;e<d;++e){const t=c[e];m=t.obj;const a=t.cache,s=0|a.length;h[h.length]=[0,t.startX,t.startY];for(let e=0;e<s;++e){const t=a[e];h[h.length]=t.isCurved?[1,t.ControlX,t.ControlY,t.AnchorX,t.AnchorY]:[2,t.AnchorX,t.AnchorY]}}e[s]={cache:h,obj:m}}return e}setStack(e,t){if(t.length){const a=Object.keys(t),s=0|a.length;for(let r=0;r<s;++r){const s=t[a[r]];e.push({object:s.obj,recode:s.cache})}}return e}};class O{constructor(e=""){if(this._$name="",this._$stage=null,this._$libraries=new Map,this._$position=0,this._$characterId=0,this._$revision=[],this._$currentData=null,e&&this.load(e),!this._$libraries.has(0)){const e=new v({id:0,type:"container",name:"main",symbol:""});this._$libraries.set(0,e)}this._$stage||(this._$stage=new f)}run(){this.stage.initialize(),this.initialize(this.root)}initialize(e){this.scene=e,this.initializeLibrary(),this.initializeInternalScript()}initializeLibrary(){const e=document.getElementById("library-list-box");for(;e.children.length;)e.children[0].remove();const t=document.getElementById("sound-select");for(;t.children.length;)t.children[0].remove();const a=new Map,s=new Map;for(const e of this._$libraries.values())if(e.id){if(d.$controller.createContainer(e.type,e.name,e.id,e.symbol),e.folderId){const t=document.getElementById(`library-child-id-${e.id}`);t.remove(),s.has(e.folderId)||s.set(e.folderId,[]),s.get(e.folderId).unshift(t)}if("folder"===e.type&&(a.set(e.id,e),"open"===e.mode)){const t=document.getElementById(`${e.type}-${e.id}`);t.classList.remove("library-type-folder-close"),t.classList.add("library-type-folder-open")}}if(a.size){for(const[e,t]of a){if(!s.has(e))continue;const a=document.getElementById(`library-child-id-${t.id}`),r=s.get(e);for(let e=0;e<r.length;++e){const s=r[e];a.parentNode.insertBefore(s,a.nextElementSibling),s.classList.add("folder"),s.style.display="open"===t.mode?"":"none"}}a.clear(),s.clear()}}initializeInternalScript(){const e=document.getElementById("javascript-internal-list-box"),t=e.children;for(;t.length;)t[0].remove();for(const t of this._$libraries.values()){if("container"!==t._$type)continue;if(!t._$actions.size)continue;const a=t.id,s=`<div id="script-${a}" data-library-id="${a}" class="internal-parent"><i></i>${t._$name}</div>`;e.insertAdjacentHTML("beforeend",s);document.getElementById(`script-${a}`).addEventListener("dblclick",d.$changeScene);for(const s of t._$actions.keys()){const t=`<div id="script-${a}-${s}" data-library-id="${a}" data-frame="${s}" class="internal-child"><i></i>frame ${s}</div>`;e.insertAdjacentHTML("beforeend",t);document.getElementById(`script-${a}-${s}`).addEventListener("mousedown",(function(e){const t=e.currentTarget;d.$keyLock=!0,d.$activeScript=!0;const a=0|t.dataset.frame;d.$timeline._$actionFrame=a;const s=d.$currentWorkSpace().getLibrary(0|t.dataset.libraryId);d.$timeline._$actionScene=s;const r=d.$timeline._$editor;r.setValue(s.getAction(a),-1),document.getElementById("editor-title").textContent=`${s.name} / frame[${a}]`,r.focus();const i=document.getElementById("editor-modal");i.style.display="",isNaN(parseFloat(i.style.left))&&(i.style.left="200px",i.style.top=300-i.clientHeight/2+"px"),i.setAttribute("class","fadeIn"),d.$endMenu("editor-modal")}))}}}stop(){this._$scene&&(this._$scene.stop(),this._$scene=null)}get scene(){return this._$scene}set scene(e){this._$scene&&this._$scene.stop(),this._$scene=e,e.initialize()}load(e){const t=JSON.parse(e);this._$characterId=0|t.characterId,this._$name=t.name,this._$stage=new f(t.stage),this._$libraries.size&&this._$libraries.clear();const a=t.libraries;for(let e=0;e<a.length;++e)this.addLibrary(a[e])}toJSON(){const e=[];for(const t of this._$libraries.values())e.push(t.toObject());return JSON.stringify({version:d.VERSION,name:this.name,characterId:this._$characterId,stage:this.stage.toObject(),libraries:e})}async temporarilySaved(){d.$updated=!0,this._$currentData&&(this._$currentData=null),this._$position!==this._$revision.length&&(this._$revision.length=this._$position),this._$revision.push(this.toJSON()),this._$position++,this._$revision.length>d.REVISION_LIMIT&&(this._$revision.shift(),this._$position=this._$revision.length)}async undo(){if(!this._$position)return;this._$currentData||(this._$currentData=this.toJSON());const e=this._$scene.id;this._$scene.stop(),this._$scene=null,this.load(this._$revision[--this._$position]),this.initialize(this.getLibrary(e)),this.scene.changeFrame(0|document.getElementById("current-frame").textContent)}async redo(){if(!this._$revision.length||this._$position===this._$revision.length)return;let e=null;if(this._$position+1===this._$revision.length){if(!this._$currentData)return;e=this._$currentData,this._$position++,this._$currentData=null}else e=this._$revision[++this._$position];if(!e)return;const t=this._$scene.id;this._$scene.stop(),this._$scene=null,this.load(e),this.initialize(this.getLibrary(t)),this.scene.changeFrame(0|document.getElementById("current-frame").textContent)}get root(){return this._$libraries.get(0)}get stage(){return this._$stage}get name(){return this._$name}set name(e){this._$name=`${e}`}addLibrary(e){let t;switch(e.type){case"container":t=new v(e);break;case"button":t=new Button(e);break;case"bitmap":t=new y(e);break;case"text":t=new E(e);break;case"sound":t=new k(e);break;case"video":t=new S(e);break;case"shape":t=new I(e);break;case"folder":t=new p(e)}return this._$libraries.set(t.id,t),t}getLibrary(e){return this._$libraries.get(0|e)}removeLibrary(e){this._$libraries.delete(0|e);for(let[t,a]of this._$libraries)if("container"===a.type)for(let[t,s]of a._$layers){const t=s._$characters.slice(0),a=t.length;for(let r=0;r<a;++r){const a=t[r];if(a.libraryId!==e)continue;s.deleteCharacter(a.id);for(let e=a.startFrame;a.endFrame>e;++e)s.getActiveCharacter(e).length||d.$screen.clearFrames(s,e,e+1)}}document.getElementById("object-area").style.display="none",this.initializeInternalScript()}get nextLibraryId(){const e=Array.from(this._$libraries.keys());return e.sort((function(e,t){return e>t?1:e<t?-1:0})),1+(0|this._$libraries.get(0|e.pop()).id)}}e["next2d-tools"]=d}(this);