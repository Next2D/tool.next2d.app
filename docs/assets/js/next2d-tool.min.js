/*!
 * licenses: MIT Licenses.
 * version: 0.111.0
 * author: Toshiyuki Ienaga <ienaga@tvon.jp>
 * copyright: (c) 2021-2022 Toshiyuki Ienaga.
 */
"nt"in window||function(e){"use strict";class t{constructor(){this.mapping=this.createMapping(),requestAnimationFrame(this.initialize.bind(this))}initialize(){const e=document.getElementsByClassName("language");for(let t=0;t<e.length;++t){const r=e[t],a=r.dataset.text;if(!this.mapping.has(a))continue;let i=this.mapping.get(a),s=r.dataset.shortcutKey;if(s){const e=d.$shortcutSetting.viewMapping.get(r.dataset.area);i+=` (${e.has(s)?e.get(s).text:r.dataset.shortcutText})`}r.innerText=i}}replace(e){return this.mapping.has(e)?this.mapping.get(e):e}}class r extends t{createMapping(){return new Map([["{{同名のアイテムが存在します}}","存在相同名称的项目"],["{{追加ファイル}}","附加文件"],["{{既存のコンテンツ}}","现有的内容"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","你可以选择覆盖、重命名和添加文件或跳过"],["{{全て上書き}}","覆盖所有"],["{{全てスキップ}}","跳过所有"],["{{追加・上書き}}","添加和覆盖"],["{{スキップ}}","跳过"],["{{表示確認したいフレームを指定}}","指定你要检查显示的框架"],["{{ファイル名を指定}}","指定文件名"],["{{ファイル名}}","文件名"],["{{終了フレームを指定}}","指定终端框架"],["{{開始フレームを指定}}","指定起始框架"],["{{フレーム設定}}","框架设置"],["{{書き出し設定}}","出口设置"],["{{ファイル形式の選択}}","选择文件格式"],["{{ファイル形式}}","文件格式"],["{{サイズ設定}}","尺寸"],["{{左上}}","左上"],["{{中央上}}","中-上"],["{{右上}}","右上"],["{{中央左}}","中间偏左"],["{{中央}}","中央"],["{{中央右}}","中右翼"],["{{左下}}","左下角"],["{{中央下}}","中下级"],["{{右下}}","右下"],["{{中心点のX座標}}","中心点的X坐标"],["{{中心点のY座標}}","中心点的Y坐标"],["{{MovieClipに変換}}","转换为MovieClip"],["{{変換}}","蜕变"],["{{ループ回数}}","循环次数"],["{{カーブポインターの削除}}","删除曲线指针"],["{{ステージ基準}}","阶段性标准"],["{{閉じる}}","贴近"],["{{保存}}","储存"],["{{リセット}}","重置"],["{{スクリーン}}","筛选"],["{{ショートカット設定}}","捷径设置"],["{{レイヤーカラー}}","分层色"],["{{Next2Dを支援する}}","支持Next2D"],["{{サポート}}","支持"],["{{未使用のアイテムを削除}}","删除未使用的项目"],["{{レイヤーをペースト}}","粘贴层"],["{{レイヤーをコピー}}","复制层"],["{{フレームをペースト}}","粘贴框架"],["{{フレームをコピー}}","复制框架"],["{{キーフレームを削除}}","删除关键帧"],["{{キーフレームに空のキーフレームを追加できません}}","不能向关键帧添加空关键帧"],["{{ズームツール}}","缩放工具"],["{{タイムライン幅の拡大・縮小}}","时间线宽度 扩大/缩小"],["{{ガイドレイヤー}}","指导层"],["{{音量設定}}","音量设置"],["{{サウンドを削除}}","移除声音"],["{{カスタムループ}}","定制的循环"],["{{読込のみ}}","只读"],["{{書込を許可}}","职位许可"],["{{単一行}}","单线"],["{{複数行}}","多线"],["{{自動で折り返し}}","自动绕行"],["{{左寄せ}}","左对齐"],["{{中央揃え}}","定心"],["{{右寄せ}}","右对齐"],["{{放射状グラデーション}}","径向梯度"],["{{線形グラデーション}}","线性梯度"],["{{画像}}","图片"],["{{画像選択}}","图像选择"],["{{種別}}","分类"],["{{Shapeの色設定}}","形状颜色设置"],["{{変形}}","变形"],["{{カラー効果}}","颜色转换"],["{{フィルター}}","滤镜"],["{{Shapeを複製}}","复制的形状"],["{{読み込み}}","读在"],["{{新規フォルダー}}","新文件夹"],["{{新規MovieClip}}","新的电影剪辑"],["{{枠に合わせてテキストをリサイズ}}","调整文字大小以适应框架"],["{{テキストに合わせて枠をリサイズ}}","调整框架的大小以适应文本"],["{{リサイズしない}}","不调整大小"],["{{フォント}}","字体"],["{{テキスト}}","文本"],["{{ループ}}","循环"],["{{音量}}","音量"],["{{ビデオ}}","视频"],["{{イージング}}","缓和"],["{{サウンド}}","声音"],["{{シンボル}}","符号"],["{{名前}}","命名"],["{{オブジェクト}}","对象"],["{{ステージ設定}}","舞台设置"],["{{プレビュー}}","预览"],["{{削除}}","删除"],["{{ペースト}}","粘贴"],["{{コピー}}","拷贝"],["{{プラグインメニュー}}","插件菜单"],["{{トゥイーン}}","嫩枝"],["{{カーブポインターの追加}}","额外的曲线指示器"],["{{パスの結合}}","路径合并"],["{{シェイプ}}","形状"],["{{キーフレームに配分}}","分配给关键帧"],["{{レイヤーに配分}}","分配到各层"],["{{タイムライン}}","时间线"],["{{整列}}","对齐"],["{{最背面}}","最 后"],["{{ひとつ背面へ}}","一个背影"],["{{ひとつ前面へ}}","一个正面"],["{{最前面}}","最前线"],["{{重ね順}}","继承顺序"],["{{プラグイン}}","插件"],["{{ライブラリ}}","图书馆"],["{{プロパティ}}","财产"],["{{マスクレイヤー}}","掩膜层"],["{{通常レイヤー}}","普通层"],["{{モーショントゥイーンの削除}}","删去了运动推理的内容"],["{{モーショントゥイーンの追加}}","额外的议案推理"],["{{モーダル表示}}","模态指示"],["{{言語}}","语言"],["{{フォーマット}}","格式"],["{{含める}}","包括"],["{{含めない}}","不包括"],["{{使い方、リファレンス}}","用法，参考"],["{{非表示レイヤー}}","隐藏层"],["{{設定}}","设置"],["{{デフォルトのループを利用する}}","使用默认的循环"],["{{フレームピッカー}}","选框机"],["{{ステージ左揃え}}","舞台左侧对齐"],["{{ステージ中央揃え(水平方向)}}","对准舞台中心（水平）"],["{{ステージ右揃え}}","舞台右侧的对齐"],["{{ステージ上揃え}}","对齐舞台"],["{{ステージ中央揃え(垂直方向)}}","对准舞台中心（垂直）"],["{{ステージ下揃え}}","对准舞台底部"],["{{左揃え}}","左对齐"],["{{中央揃え(水平方向)}}","居中（水平方向）"],["{{右揃え}}","右对齐"],["{{上揃え}}","上对齐"],["{{中央揃え(垂直方向)}}","居中（垂直方向）"],["{{下揃え}}","下对齐"],["{{開始フレーム}}","起始框架"],["{{終了フレーム}}","终端框架"],["{{ループで再生}}","循环播放"],["{{1回再生}}","1次播放"],["{{指定したフレームで固定}}","固定在指定的框架内"],["{{1回逆再生}}","1 反向播放"],["{{逆ループで再生}}","反向循环播放"],["{{画面の拡大・縮小}}","画面的放大和缩小"],["{{カスタムイージングデータを保存}}","保存自定义缓和数据"],["{{カスタムイージングデータの読込}}","读取自定义宽松数据"],["{{プレビューのON/OFF}}","预览开/关"],["{{フォント枠サイズ}}","字体帧大小"],["{{フォント枠カラー}}","字体帧颜色"],["{{オニオンスキン}}","洋葱皮"],["{{バケツツール}}","整体填充工具"],["{{ペンツール}}","钢笔工具"],["{{ダブルクリックでカーブポイントが追加されます}}","双击来添加一个曲线点"],["{{選択ツール}}","选择工具"],["{{Shape変形ツール}}","形状变换工具"],["{{テキストツール}}","文本工具"],["{{矩形ツール}}","矩形工具"],["{{楕円ツール}}","椭圆工具"],["{{角丸矩形ツール}}","圆角矩形工具"],["{{塗りのカラー}}","填充颜色"],["{{線のカラー}}","画笔颜色"],["{{線の太さ}}","画笔宽度"],["{{プロジェクトデータの読込}}","载入工程文件"],["{{プロジェクトデータを保存}}","保存工程文件"],["{{書き出し}}","导出"],["{{Discordへ移動}}","前往discord"],["{{バグ報告}}","错误报告"],["{{設定}}","设置"],["{{タブを追加}}","添加标签页"],["{{タブの一覧を表示・移動}}","标签页列表"],["{{スクリプトを追加}}","添加一个脚本"],["{{キーフレームを追加}}","添加一个关键帧"],["{{空のキーフレームを追加}}","添加一个空的关键帧"],["{{フレームを追加}}","添加帧"],["{{フレームを削除}}","删除帧"],["{{再生}}","播放"],["{{停止}}","停止"],["{{ループ設定}}","循环设置"],["{{レイヤーを追加}}","添加图层"],["{{レイヤーを削除}}","删除图层"],["{{全てのレイヤーをハイライト}}","高亮所有图层"],["{{全てのレイヤーを非表示}}","隐藏所有图层"],["{{全てのレイヤーをロック}}","锁定所有图层"],["{{比率を固定}}","锁定比例"],["{{ステージの幅}}","画面宽度"],["{{背景色}}","背景颜色"],["{{ステージの高さ}}","画面高度"],["{{フレームレート}}","帧速率"],["{{シンボル名}}","符号名称"],["{{イージング設定}}","过渡设置"],["{{ビデオの音量設定}}","视频音量设置"],["{{自動再生}}","自动播放"],["{{テキストエリアのボーダー設定}}","文本框边框设置"],["{{テキスト入力設定}}","文本输入设置"],["{{フォント選択}}","字体选择"],["{{自動サイズ調整}}","自动调整尺寸"],["{{フォントスタイルタイプ}}","字体风格类型"],["{{行揃え}}","对齐"],["{{改行設定}}","换行设置"],["{{スクロール設定}}","滚动设置"],["{{フォントサイズ}}","字体大小"],["{{フォントカラー}}","字体颜色"],["{{行間}}","行间距"],["{{文字幅}}","字符宽度"],["{{左マージン}}","左边距"],["{{右マージン}}","右边距"],["{{カラー種別の選択}}","选择颜色类型"],["{{背景画像の選択}}","选择背景图片"],["{{カラーポインターを追加}}","添加颜色指针"],["{{カラー値}}","颜色"],["{{アルファ(0%-100%)}}","透明度（0%-100%）"],["{{アルファ値}}","透明度"],["{{選択対象の幅}}","选择对象的宽度"],["{{選択対象のX座標}}","选择对象的X轴坐标"],["{{選択対象の高さ}}","选择对象的高度"],["{{選択対象のY座標}}","选择对象的Y轴坐标"],["{{選択対象の幅の伸縮}}","选定对象的X轴缩放"],["{{選択対象を回転}}","旋转物体"],["{{選択対象の高さの伸縮}}","所选对象的比例Y"],["{{アルファオフセット(-255〜255)}}","透明度偏移（-255~255）"],["{{赤(0%-100%)}}","红色（0%-100%）"],["{{赤オフセット(-255〜255)}}","红色偏移（-255~255）"],["{{緑(0%-100%)}}","绿色（0%-100%）"],["{{緑オフセット(-255〜255)}}","绿色偏移（-255~255）"],["{{青(0%-100%)}}","蓝色（0%-100%）"],["{{青オフセット(-255〜255)}}","蓝色偏移（-255~255）"],["{{ブレンドモード}}","混合模式"],["{{フィルターを選択}}","选择滤镜"],["{{フィルターを追加}}","添加滤镜"],["{{サウンドを追加}}","添加声音"],["{{フィルターを表示・非表示する}}","显示和隐藏滤镜"],["{{フィルターを削除}}","删除滤镜"],["{{水平方向にぼかす}}","横向模糊"],["{{垂直方向にぼかす}}","纵向模糊"],["{{フィルター強度}}","滤镜强度"],["{{フィルター角度}}","滤镜角度"],["{{シャドウのアルファ}}","阴影透明度"],["{{シャドウのカラー}}","阴影颜色"],["{{フィルター距離}}","滤镜距离"],["{{ハイライトのカラー}}","高光色"],["{{ハイライトのアルファ}}","高光透明度"],["{{グラデーションカラー}}","渐变色"],["{{グラデーションのアルファ}}","渐变透明度"],["{{タブの移動・名前を変更}}","移动/重命名标签"],["{{プロジェクトを閉じる}}","关闭工程"],["{{上下に移動}}","上下移动"],["{{レイヤー変更(ダブルクリック)}}","改变图层（双击）"],["{{レイヤーをハイライト}}","高亮图层"],["{{レイヤーを非表示}}","隐藏图层"],["{{レイヤーをロック}}","锁定图层"],["{{カーブポインター(ダブルクリックでON/OFF)}}","曲线指针（双击打开/关闭）"],["{{インスタンス名}}","实例名称"],["{{ライブラリ内の検索}}","在库中搜索"],["{{フレームラベル}}","帧标签"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","如果工程没有保存，将无法恢复此标签页数据。 你想删除这个标签页吗？"]])}}class a extends t{createMapping(){return new Map([["{{同名のアイテムが存在します}}","An item of the same name exists"],["{{追加ファイル}}","Additional File"],["{{既存のコンテンツ}}","Existing Content"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","You can choose to overwrite, rename and add files, or skip"],["{{全て上書き}}","Overwrite All"],["{{全てスキップ}}","Skip All"],["{{追加・上書き}}","Add or Overwrite"],["{{スキップ}}","Skip"],["{{表示確認したいフレームを指定}}","Specify the frame you want to check the display"],["{{ファイル名を指定}}","Specify File Name"],["{{ファイル名}}","File Name"],["{{終了フレームを指定}}","Specify End Frame"],["{{開始フレームを指定}}","Specify Start Frame"],["{{フレーム設定}}","Frame Setting"],["{{書き出し設定}}","Export Settings"],["{{ファイル形式の選択}}","Select File Format"],["{{ファイル形式}}","File Formats"],["{{サイズ設定}}","Size Setting"],["{{左上}}","Top Left"],["{{中央上}}","Top Center"],["{{右上}}","Top Right"],["{{中央左}}","Center Left"],["{{中央}}","Center"],["{{中央右}}","Center Right"],["{{左下}}","Bottom Left"],["{{中央下}}","Bottom Center"],["{{右下}}","Bottom Right"],["{{中心点のX座標}}","X coordinate of the center point"],["{{中心点のY座標}}","Y coordinate of the center point"],["{{MovieClipに変換}}","Convert to MovieClip"],["{{変換}}","Conversion"],["{{ループ回数}}","Loop Count"],["{{カーブポインターの削除}}","Delete curve pointer"],["{{ステージ基準}}","Stage Criteria"],["{{閉じる}}","Close"],["{{保存}}","Save"],["{{リセット}}","Reset"],["{{スクリーン}}","Screen"],["{{ショートカット設定}}","Shortcut Settings"],["{{レイヤーカラー}}","Layer Color"],["{{Next2Dを支援する}}","Support Next2D"],["{{サポート}}","Support"],["{{未使用のアイテムを削除}}","Delete unused items"],["{{レイヤーをペースト}}","Paste Layer"],["{{レイヤーをコピー}}","Copy Layer"],["{{フレームをペースト}}","Paste Frame"],["{{フレームをコピー}}","Copy Frame"],["{{キーフレームを削除}}","Delete keyframe"],["{{キーフレームに空のキーフレームを追加できません}}","Cannot add an empty keyframe to a keyframe"],["{{ズームツール}}","Zoom Tool"],["{{タイムライン幅の拡大・縮小}}","Timeline Width Expand/Reduce"],["{{ガイドレイヤー}}","Guide Layer"],["{{音量設定}}","Volume Setting"],["{{サウンドを削除}}","Remove Sound"],["{{カスタムループ}}","Custom Loop"],["{{読込のみ}}","ReadOnly"],["{{書込を許可}}","Writeable"],["{{単一行}}","Single line"],["{{複数行}}","Multiline"],["{{自動で折り返し}}","Auto Wrap"],["{{左寄せ}}","Left"],["{{中央揃え}}","Center"],["{{右寄せ}}","Right"],["{{放射状グラデーション}}","Radial Gradient"],["{{線形グラデーション}}","Linear Gradient"],["{{画像}}","Image"],["{{画像選択}}","Image Selection"],["{{種別}}","Type"],["{{Shapeの色設定}}","Shape color settings"],["{{変形}}","Transform"],["{{カラー効果}}","Color Transform"],["{{フィルター}}","Filter"],["{{Shapeを複製}}","Duplicate Shape"],["{{読み込み}}","Read in"],["{{新規フォルダー}}","Added Folder"],["{{新規MovieClip}}","Added MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Resize text to fit the frame"],["{{テキストに合わせて枠をリサイズ}}","Resize the frame to fit the text"],["{{リサイズしない}}","No Resize"],["{{フォント}}","Font"],["{{テキスト}}","Text"],["{{ループ}}","Loop"],["{{音量}}","Volume"],["{{ビデオ}}","Video"],["{{イージング}}","Easing"],["{{サウンド}}","Sound"],["{{シンボル}}","Symbol"],["{{名前}}","Name"],["{{オブジェクト}}","Object"],["{{ステージ設定}}","Stage Setting"],["{{プレビュー}}","Preview"],["{{削除}}","Delete"],["{{ペースト}}","Paste"],["{{コピー}}","Copy"],["{{プラグインメニュー}}","Plugin Menu"],["{{トゥイーン}}","Tween"],["{{カーブポインターの追加}}","Added Curve Pointer"],["{{パスの結合}}","Integrating paths"],["{{シェイプ}}","Shape"],["{{キーフレームに配分}}","Distribute to Keyframes"],["{{レイヤーに配分}}","Distribute to Layers"],["{{タイムライン}}","Timeline"],["{{整列}}","Align"],["{{最背面}}","Send to Back"],["{{ひとつ背面へ}}","Send to Backward"],["{{ひとつ前面へ}}","Bring to Forward"],["{{最前面}}","Bring to Front"],["{{重ね順}}","Arrange"],["{{プラグイン}}","Plugin"],["{{ライブラリ}}","Library"],["{{プロパティ}}","Property"],["{{マスクレイヤー}}","Mask Layer"],["{{通常レイヤー}}","Normal Layer"],["{{モーショントゥイーンの削除}}","Deleted Motion Tweening"],["{{モーショントゥイーンの追加}}","Added Motion Tweening"],["{{モーダル表示}}","Modal Indication"],["{{言語}}","Language"],["{{フォーマット}}","Format"],["{{含める}}","Include"],["{{含めない}}","Not Including"],["{{使い方、リファレンス}}","Usage, Reference"],["{{非表示レイヤー}}","Hidden Layers"],["{{設定}}","Setting"],["{{デフォルトのループを利用する}}","Use the default loop"],["{{フレームピッカー}}","Frame Picker"],["{{ステージ左揃え}}","Align Stage Left"],["{{ステージ中央揃え(水平方向)}}","Align Stage Center (Horizontal)"],["{{ステージ右揃え}}","Align Stage Right"],["{{ステージ上揃え}}","Align Stage Top"],["{{ステージ中央揃え(垂直方向)}}","Center Stage (Vertical)"],["{{ステージ下揃え}}","Align Bottom of Stage"],["{{左揃え}}","Left"],["{{中央揃え(水平方向)}}","Center (Horizontal)"],["{{右揃え}}","Right"],["{{上揃え}}","Top"],["{{中央揃え(垂直方向)}}","Center (Vertical)"],["{{下揃え}}","Bottom"],["{{開始フレーム}}","Start Frame"],["{{終了フレーム}}","End Frame"],["{{ループで再生}}","Play in loop"],["{{1回再生}}","1 playback"],["{{指定したフレームで固定}}","Fixed at the specified frame"],["{{1回逆再生}}","1 reverse playback"],["{{逆ループで再生}}","Playback in reverse loop"],["{{画面の拡大・縮小}}","Zoom in/out of screen"],["{{カスタムイージングデータを保存}}","Save custom easing data"],["{{カスタムイージングデータの読込}}","Reading custom easing data"],["{{プレビューのON/OFF}}","Preview on/off"],["{{フォント枠サイズ}}","Font Frame Size"],["{{フォント枠カラー}}","Font Frame Color"],["{{オニオンスキン}}","Onion Skin"],["{{バケツツール}}","Bucket Tools"],["{{ペンツール}}","Pen Tool"],["{{ダブルクリックでカーブポイントが追加されます}}","Double-click to add a curve point"],["{{選択ツール}}","Selection Tool"],["{{Shape変形ツール}}","Shape Transform Tool"],["{{テキストツール}}","Text Tool"],["{{矩形ツール}}","Rectangle Tool"],["{{楕円ツール}}","Ellipse Tool"],["{{角丸矩形ツール}}","Rounded Rectangle Tool"],["{{塗りのカラー}}","Fill Color"],["{{線のカラー}}","Stroke Color"],["{{線の太さ}}","Stroke Width"],["{{プロジェクトデータの読込}}","Loading project data"],["{{プロジェクトデータを保存}}","Save project data"],["{{書き出し}}","Export"],["{{Discordへ移動}}","Go to discord"],["{{バグ報告}}","Bug reports"],["{{設定}}","Setting"],["{{タブを追加}}","Add a tab"],["{{タブの一覧を表示・移動}}","View and move through the list of tabs"],["{{スクリプトを追加}}","Add a script"],["{{キーフレームを追加}}","Add a keyframe"],["{{空のキーフレームを追加}}","Add an empty keyframe"],["{{フレームを追加}}","Add a frame"],["{{フレームを削除}}","Delete frame"],["{{再生}}","Play"],["{{停止}}","Stop"],["{{ループ設定}}","Loop Setting"],["{{レイヤーを追加}}","Add a layer"],["{{レイヤーを削除}}","Delete layer"],["{{全てのレイヤーをハイライト}}","Highlight all layers"],["{{全てのレイヤーを非表示}}","Hide all layers"],["{{全てのレイヤーをロック}}","Lock all layers"],["{{比率を固定}}","Fixed ratio"],["{{ステージの幅}}","Stage Width"],["{{背景色}}","Background Color"],["{{ステージの高さ}}","Stage Height"],["{{フレームレート}}","Frame Rate"],["{{シンボル名}}","Symbol Name"],["{{イージング設定}}","Easing Setting"],["{{ビデオの音量設定}}","Video Volume Setting"],["{{自動再生}}","Auto Play"],["{{テキストエリアのボーダー設定}}","Text Area Border Setting"],["{{テキスト入力設定}}","Text Input Setting"],["{{フォント選択}}","Font Select"],["{{自動サイズ調整}}","Automatic size adjustment"],["{{フォントスタイルタイプ}}","Font Style Type"],["{{行揃え}}","Align"],["{{改行設定}}","Newline Setting"],["{{スクロール設定}}","Scroll Setting"],["{{フォントサイズ}}","Font Size"],["{{フォントカラー}}","Font Color"],["{{行間}}","Line Space"],["{{文字幅}}","Character Width"],["{{左マージン}}","Left Margin"],["{{右マージン}}","Right Margin"],["{{カラー種別の選択}}","Select a color type"],["{{背景画像の選択}}","Selecting a background image"],["{{カラーポインターを追加}}","Add color pointers"],["{{カラー値}}","Color"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Width of the selection object"],["{{選択対象のX座標}}","X coordinate of the selection object"],["{{選択対象の高さ}}","Height  of the selection object"],["{{選択対象のY座標}}","Y coordinate of the selection object"],["{{選択対象の幅の伸縮}}","scaleX of the selected object"],["{{選択対象を回転}}","Rotate the object"],["{{選択対象の高さの伸縮}}","scaleY of the selected object"],["{{アルファオフセット(-255〜255)}}","Alpha Offset(-255〜255)"],["{{赤(0%-100%)}}","Red(0%-100%)"],["{{赤オフセット(-255〜255)}}","Red Offset(-255〜255)"],["{{緑(0%-100%)}}","Green(0%-100%)"],["{{緑オフセット(-255〜255)}}","Green Offset(-255〜255)"],["{{青(0%-100%)}}","Blue(0%-100%)"],["{{青オフセット(-255〜255)}}","Blue Offset(-255〜255)"],["{{ブレンドモード}}","Blend Mode"],["{{フィルターを選択}}","Select a filter"],["{{フィルターを追加}}","Add a filter"],["{{サウンドを追加}}","Add a sound"],["{{フィルターを表示・非表示する}}","Show and Hide filters"],["{{フィルターを削除}}","Delete Filter"],["{{水平方向にぼかす}}","Blur Horizontally"],["{{垂直方向にぼかす}}","Blur Vertically"],["{{フィルター強度}}","Filter Strength"],["{{フィルター角度}}","Filter Angle"],["{{シャドウのアルファ}}","Shadow Alpha"],["{{シャドウのカラー}}","Shadow Color"],["{{フィルター距離}}","Filter Distance"],["{{ハイライトのカラー}}","Highlight Color"],["{{ハイライトのアルファ}}","Highlight Alpha"],["{{グラデーションカラー}}","Gradient Color"],["{{グラデーションのアルファ}}","Gradient Alpha"],["{{タブの移動・名前を変更}}","Move/Rename tabs"],["{{プロジェクトを閉じる}}","Close the project"],["{{上下に移動}}","Move up and down"],["{{レイヤー変更(ダブルクリック)}}","Layer Change(double-click)"],["{{レイヤーをハイライト}}","Highlight Layer"],["{{レイヤーを非表示}}","Hide Layer"],["{{レイヤーをロック}}","Lock the Layer"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Curve Pointer (double click to turn on/off)"],["{{インスタンス名}}","Instance Name"],["{{ライブラリ内の検索}}","Search in the library"],["{{フレームラベル}}","Frame Label"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","If the project is not saved, the project data in this tab cannot be recovered. Do you want to delete the tab?"]])}}class i extends t{createMapping(){return new Map([["{{同名のアイテムが存在します}}","Un ou plusieurs articles du même nom existent"],["{{追加ファイル}}","Fichier supplémentaire"],["{{既存のコンテンツ}}","Contenu existant"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","Vous pouvez choisir d'écraser, de renommer et d'ajouter des fichiers, ou de ne pas le faire"],["{{全て上書き}}","Ecraser tout"],["{{全てスキップ}}","Ignorer tout"],["{{追加・上書き}}","Ajouter ou Écraser"],["{{スキップ}}","Ignorer"],["{{表示確認したいフレームを指定}}","Specify the frame you want to check the display"],["{{ファイル名を指定}}","Spécifier le nom du fichier"],["{{ファイル名}}","nom du fichier"],["{{終了フレームを指定}}","Spécifier le cadre de fin"],["{{開始フレームを指定}}","Spécifier le cadre de départ"],["{{フレーム設定}}","Réglage du cadre"],["{{書き出し設定}}","Paramètres d'exportation"],["{{ファイル形式の選択}}","Sélectionner le format du fichier"],["{{ファイル形式}}","Formats de fichiers"],["{{サイズ設定}}","Réglage de la taille"],["{{左上}}","En haut à gauche"],["{{中央上}}","Centre supérieur"],["{{右上}}","Haut Droite"],["{{中央左}}","Centre gauche"],["{{中央}}","Centre"],["{{中央右}}","Centre droit"],["{{左下}}","Bas gauche"],["{{中央下}}","Bas Centre"],["{{右下}}","Bas droit"],["{{中心点のX座標}}","Coordonnée X du point central"],["{{中心点のY座標}}","Coordonnée Y du point central"],["{{MovieClipに変換}}","Convertir en MovieClip"],["{{変換}}","transformation"],["{{ループ回数}}","Nombre de boucles"],["{{カーブポインターの削除}}","Supprimer le pointeur de courbe"],["{{ステージ基準}}","Critères d'étape"],["{{閉じる}}","Fermer"],["{{保存}}","Sauvez"],["{{リセット}}","réinitialiser"],["{{スクリーン}}","Écran"],["{{ショートカット設定}}","Paramètres des raccourcis"],["{{レイヤーカラー}}","couleur superposée"],["{{Next2Dを支援する}}","Soutenez Next2D"],["{{サポート}}","soutien"],["{{未使用のアイテムを削除}}","Retirer les articles non utilisés"],["{{レイヤーをペースト}}","Couche de pâte"],["{{レイヤーをコピー}}","Copie de la couche"],["{{フレームをペースト}}","Coller le cadre"],["{{フレームをコピー}}","Cadre de copie"],["{{キーフレームを削除}}","Supprimez les images clés"],["{{キーフレームに空のキーフレームを追加できません}}","Impossible d'ajouter des images clés vides à des images clés"],["{{ズームツール}}","Outil de zoom"],["{{タイムライン幅の拡大・縮小}}","Largeur de la ligne de temps Développer/réduire"],["{{ガイドレイヤー}}","couche de guidage"],["{{音量設定}}","Réglage du volume"],["{{サウンドを削除}}","Supprimer le son"],["{{カスタムループ}}","boucle personnalisée"],["{{読込のみ}}","Lecture seulement"],["{{書込を許可}}","autorisation de poste"],["{{単一行}}","Ligne unique"],["{{複数行}}","Multiline"],["{{自動で折り返し}}","Enveloppe automatique"],["{{左寄せ}}","Gauche"],["{{中央揃え}}","Centre"],["{{右寄せ}}","Droite"],["{{放射状グラデーション}}","gradation radiale"],["{{線形グラデーション}}","gradient linéaire"],["{{画像}}","Image"],["{{画像選択}}","Sélection d'images"],["{{種別}}","Type"],["{{Shapeの色設定}}","Paramètres de couleur de la forme"],["{{変形}}","déformation"],["{{カラー効果}}","Transformation des couleurs"],["{{フィルター}}","filtre"],["{{Shapeを複製}}","Dupliquer la forme"],["{{読み込み}}","lire dans"],["{{新規フォルダー}}","Nouveau dossier"],["{{新規MovieClip}}","Nouveau MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Redimensionnez le texte pour l'adapter au cadre"],["{{テキストに合わせて枠をリサイズ}}","Redimensionnez le cadre pour l'adapter au texte"],["{{リサイズしない}}","Pas de redimensionnement"],["{{フォント}}","police"],["{{テキスト}}","Texte"],["{{ループ}}","boucle"],["{{音量}}","volume"],["{{ビデオ}}","Vidéo"],["{{イージング}}","facilitant"],["{{サウンド}}","son"],["{{シンボル}}","Symbole"],["{{名前}}","Nom"],["{{オブジェクト}}","objet"],["{{ステージ設定}}","Mise en scène"],["{{プレビュー}}","Prévisualisation"],["{{削除}}","Supprimer"],["{{ペースト}}","Pâte"],["{{コピー}}","Copie"],["{{プラグインメニュー}}","Menu plug-in"],["{{トゥイーン}}","entre"],["{{カーブポインターの追加}}","Pointeur de courbe supplémentaire"],["{{パスの結合}}","Fusion de chemins"],["{{シェイプ}}","forme"],["{{キーフレームに配分}}","Attribution aux images clés"],["{{レイヤーに配分}}","Affectation aux couches"],["{{タイムライン}}","chronologie"],["{{整列}}","Aligner"],["{{最背面}}","La plupart des dos"],["{{ひとつ背面へ}}","Un à l'arrière"],["{{ひとつ前面へ}}","Un front"],["{{最前面}}","Frontmost"],["{{重ね順}}","Organiser"],["{{プラグイン}}","plug-in"],["{{ライブラリ}}","bibliothèque"],["{{プロパティ}}","propriété"],["{{マスクレイヤー}}","couche de masque"],["{{通常レイヤー}}","Couche normale"],["{{モーショントゥイーンの削除}}","Suppression des tweens de mouvement"],["{{モーショントゥイーンの追加}}","Des tweens de mouvement supplémentaires"],["{{モーダル表示}}","indication modale"],["{{言語}}","Langue"],["{{フォーマット}}","format"],["{{含める}}","inclure"],["{{含めない}}","à ne pas inclure"],["{{使い方、リファレンス}}","Utilisation, référence"],["{{非表示レイヤー}}","couche cachée"],["{{設定}}","configuration"],["{{デフォルトのループを利用する}}","Utilisez la boucle par défaut"],["{{フレームピッカー}}","ramasseur de cadres"],["{{ステージ左揃え}}","Aligner la scène à gauche"],["{{ステージ中央揃え(水平方向)}}","Aligner le centre de la scène (horizontal)"],["{{ステージ右揃え}}","Aligner la scène à droite"],["{{ステージ上揃え}}","Aligner la scène vers le haut"],["{{ステージ中央揃え(垂直方向)}}","Aligner le centre de la scène (vertical)"],["{{ステージ下揃え}}","Aligner le fond de la scène"],["{{左揃え}}","Gauche"],["{{中央揃え(水平方向)}}","Centre(sens horizontal)"],["{{右揃え}}","Droit"],["{{上揃え}}","Top"],["{{中央揃え(垂直方向)}}","Centre(Vertical)"],["{{下揃え}}","Fond"],["{{開始フレーム}}","cadre de départ"],["{{終了フレーム}}","cadre terminal"],["{{ループで再生}}","Lecture en boucle"],["{{1回再生}}","1 lecture"],["{{指定したフレームで固定}}","Fixé dans le cadre spécifié"],["{{1回逆再生}}","1 lecture en sens inverse"],["{{逆ループで再生}}","Lecture en boucle inversée"],["{{画面の拡大・縮小}}","Zoom avant et arrière sur l'écran"],["{{カスタムイージングデータを保存}}","Enregistrez les données d'assouplissement personnalisées"],["{{カスタムイージングデータの読込}}","Lecture des données de l'assouplissement personnalisé"],["{{プレビューのON/OFF}}","Activation/désactivation de la prévisualisation"],["{{フォント枠サイズ}}","Taille du cadre de la police"],["{{フォント枠カラー}}","Couleur du cadre de la police"],["{{オニオンスキン}}","Peau d'oignon"],["{{バケツツール}}","Outils à godets"],["{{ペンツール}}","Outil stylo"],["{{ダブルクリックでカーブポイントが追加されます}}","Double-cliquez pour ajouter un point de courbe"],["{{選択ツール}}","Outils de sélection"],["{{Shape変形ツール}}","Outil de transformation des formes"],["{{テキストツール}}","Outil texte"],["{{矩形ツール}}","Outil Rectangle"],["{{楕円ツール}}","Outil Ellipse"],["{{角丸矩形ツール}}","Outil Rectangle arrondi"],["{{塗りのカラー}}","Couleur de remplissage"],["{{線のカラー}}","Couleur du trait"],["{{線の太さ}}","Largeur de course"],["{{プロジェクトデータの読込}}","Chargement des données du projet"],["{{プロジェクトデータを保存}}","Sauvegarder les données du projet"],["{{書き出し}}","Exportation"],["{{Discordへ移動}}","Aller sur le discord"],["{{バグ報告}}","Rapports de bogue"],["{{設定}}","Réglage de"],["{{タブを追加}}","Ajouter un onglet"],["{{タブの一覧を表示・移動}}","Visualiser et se déplacer dans la liste des onglets"],["{{スクリプトを追加}}","Ajouter un script"],["{{キーフレームを追加}}","Ajouter une image clé"],["{{空のキーフレームを追加}}","Ajouter une image clé vide"],["{{フレームを追加}}","Ajouter un cadre"],["{{フレームを削除}}","Supprimer le cadre"],["{{再生}}","Jouer"],["{{停止}}","Stop"],["{{ループ設定}}","Réglage de la boucle"],["{{レイヤーを追加}}","Ajouter une couche"],["{{レイヤーを削除}}","Supprimer la couche"],["{{全てのレイヤーをハイライト}}","Mettez en évidence toutes les couches"],["{{全てのレイヤーを非表示}}","Cacher toutes les couches"],["{{全てのレイヤーをロック}}","Verrouiller toutes les couches"],["{{比率を固定}}","Ratio fixe"],["{{ステージの幅}}","Largeur de la scène"],["{{背景色}}","Couleur de fond"],["{{ステージの高さ}}","Hauteur de la scène"],["{{フレームレート}}","Fréquence d'images"],["{{シンボル名}}","Nom du symbole"],["{{イージング設定}}","Réglage de l'assouplissement"],["{{ビデオの音量設定}}","Réglage du volume vidéo"],["{{自動再生}}","Lecture automatique"],["{{テキストエリアのボーダー設定}}","Réglage de la bordure de la zone de texte"],["{{テキスト入力設定}}","Réglage de la saisie du texte"],["{{フォント選択}}","Sélection de la police"],["{{自動サイズ調整}}","Ajustement automatique de la taille"],["{{フォントスタイルタイプ}}","Type de police"],["{{行揃え}}","Aligner"],["{{改行設定}}","Réglage des nouvelles lignes"],["{{スクロール設定}}","Réglage du défilement"],["{{フォントサイズ}}","Taille de la police"],["{{フォントカラー}}","Couleur de la police"],["{{行間}}","Espace linéaire"],["{{文字幅}}","Largeur des caractères"],["{{左マージン}}","Marge gauche"],["{{右マージン}}","Marge droite"],["{{カラー種別の選択}}","Sélectionnez un type de couleur"],["{{背景画像の選択}}","Sélection d'une image de fond"],["{{カラーポインターを追加}}","Ajouter des pointeurs de couleur"],["{{カラー値}}","Couleur"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Largeur de l'objet de sélection"],["{{選択対象のX座標}}","Coordonnée X de l'objet de sélection"],["{{選択対象の高さ}}","Hauteur de l'objet de sélection"],["{{選択対象のY座標}}","Coordonnée Y de l'objet de sélection"],["{{選択対象の幅の伸縮}}","scaleX de l'objet sélectionné"],["{{選択対象を回転}}","Faire pivoter l'objet"],["{{選択対象の高さの伸縮}}","scaleY de l'objet sélectionné"],["{{アルファオフセット(-255〜255)}}","Décalage alpha(-255〜255)"],["{{赤(0%-100%)}}","Rouge(0%-100%)"],["{{赤オフセット(-255〜255)}}","Décalage rouge(-255〜255)"],["{{緑(0%-100%)}}","Vert(0%-100%)"],["{{緑オフセット(-255〜255)}}","Compensation verte(-255〜255)"],["{{青(0%-100%)}}","Bleu(0%-100%)"],["{{青オフセット(-255〜255)}}","Décalage bleu(-255〜255)"],["{{ブレンドモード}}","Mode de mélange"],["{{フィルターを選択}}","Sélectionnez un filtre"],["{{フィルターを追加}}","Ajouter un filtre"],["{{サウンドを追加}}","Ajouter un son"],["{{フィルターを表示・非表示する}}","Afficher et masquer les filtres"],["{{フィルターを削除}}","Supprimer le filtre"],["{{水平方向にぼかす}}","Flou horizontal"],["{{垂直方向にぼかす}}","Flou vertical"],["{{フィルター強度}}","Résistance du filtre"],["{{フィルター角度}}","Angle du filtre"],["{{シャドウのアルファ}}","Shadow Alpha"],["{{シャドウのカラー}}","Couleur de l'ombre"],["{{フィルター距離}}","Distance du filtre"],["{{ハイライトのカラー}}","Couleur de mise en évidence"],["{{ハイライトのアルファ}}","Highlight Alpha"],["{{グラデーションカラー}}","Couleur dégradée"],["{{グラデーションのアルファ}}","Gradient Alpha"],["{{タブの移動・名前を変更}}","Déplacer/Renommer les onglets"],["{{プロジェクトを閉じる}}","Fermer le projet"],["{{上下に移動}}","Déplacement vers le haut et le bas"],["{{レイヤー変更(ダブルクリック)}}","Changement de couche (double-clic)"],["{{レイヤーをハイライト}}","Couche de mise en évidence"],["{{レイヤーを非表示}}","Masquer la couche"],["{{レイヤーをロック}}","Verrouiller le calque"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Pointeur de courbe (double-cliquez pour l'activer ou le désactiver)"],["{{インスタンス名}}","Nom de l'instance"],["{{ライブラリ内の検索}}","Recherche dans la bibliothèque"],["{{フレームラベル}}","Étiquette du cadre"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Si le projet n'est pas sauvegardé, les données du projet dans cet onglet ne peuvent pas être récupérées. Voulez-vous supprimer l'onglet ?"]])}}class s extends t{createMapping(){return new Map([["{{同名のアイテムが存在します}}","Esistono voci con lo stesso nome"],["{{追加ファイル}}","File aggiuntivo"],["{{既存のコンテンツ}}","Contenuto esistente"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","È possibile scegliere di sovrascrivere, rinominare e aggiungere i file, o di saltare"],["{{全て上書き}}","Sovrascrivi tutto"],["{{全てスキップ}}","Salta tutto"],["{{追加・上書き}}","Aggiungi o sovrascrivi"],["{{スキップ}}","Salta"],["{{表示確認したいフレームを指定}}","Specificare la cornice di cui si desidera controllare la visualizzazione"],["{{ファイル名を指定}}","Specificare il nome del file"],["{{ファイル名}}","nome del file"],["{{終了フレームを指定}}","Specificare la cornice finale"],["{{開始フレームを指定}}","Specificare il fotogramma iniziale"],["{{フレーム設定}}","Impostazione del telaio"],["{{書き出し設定}}","Impostazioni di esportazione"],["{{ファイル形式の選択}}","Selezionare il formato del file"],["{{ファイル形式}}","Formati dei file"],["{{サイズ設定}}","Impostazione delle dimensioni"],["{{左上}}","In alto a sinistra"],["{{中央上}}","In alto al centro"],["{{右上}}","In alto a destra"],["{{中央左}}","Centro Sinistra"],["{{中央}}","Centro"],["{{中央右}}","Centro Destra"],["{{左下}}","In basso a sinistra"],["{{中央下}}","In basso al centro"],["{{右下}}","In basso a destra"],["{{中心点のX座標}}","Coordinata X del punto centrale"],["{{中心点のY座標}}","Coordinata Y del punto centrale"],["{{MovieClipに変換}}","Convertire in MovieClip"],["{{変換}}","trasformazione"],["{{ループ回数}}","Conteggio dei cicli"],["{{カーブポインターの削除}}","Elimina il puntatore di curva"],["{{ステージ基準}}","Criteri di fase"],["{{閉じる}}","Chiudere"],["{{保存}}","Risparmiare"],["{{リセット}}","azzeramento"],["{{スクリーン}}","Schermo"],["{{ショートカット設定}}","Impostazioni delle scorciatoie"],["{{レイヤーカラー}}","colore stratificato"],["{{Next2Dを支援する}}","Supporto Next2D"],["{{サポート}}","supporto"],["{{未使用のアイテムを削除}}","Rimuovere gli articoli inutilizzati"],["{{レイヤーをペースト}}","Strato di pasta"],["{{レイヤーをコピー}}","Copiare il livello"],["{{フレームをペースト}}","Incolla la cornice"],["{{フレームをコピー}}","Cornice di copia"],["{{キーフレームを削除}}","Elimina i fotogrammi chiave"],["{{キーフレームに空のキーフレームを追加できません}}","Impossibile aggiungere keyframes vuoti ai keyframes"],["{{ズームツール}}","Strumento zoom"],["{{タイムライン幅の拡大・縮小}}","Larghezza della timeline Espandere/ridurre"],["{{ガイドレイヤー}}","strato guida"],["{{音量設定}}","Regolazione del volume"],["{{サウンドを削除}}","Rimuovere il suono"],["{{カスタムループ}}","anello personalizzato"],["{{読込のみ}}","Leggere solo"],["{{書込を許可}}","autorizzazione del post"],["{{単一行}}","Linea singola"],["{{複数行}}","Multiline"],["{{自動で折り返し}}","Avvolgimento automatico"],["{{左寄せ}}","Sinistra"],["{{中央揃え}}","Centro"],["{{右寄せ}}","Destra"],["{{放射状グラデーション}}","gradazione radiale"],["{{線形グラデーション}}","gradiente lineare"],["{{画像}}","Immagine"],["{{画像選択}}","Selezione dell'immagine"],["{{種別}}","Tipo"],["{{Shapeの色設定}}","Impostazioni del colore della forma"],["{{変形}}","deformazione"],["{{カラー効果}}","Trasformazione del colore"],["{{フィルター}}","filtro"],["{{Shapeを複製}}","Forma duplicata"],["{{読み込み}}","leggere in"],["{{新規フォルダー}}","Nuova cartella"],["{{新規MovieClip}}","Nuovo MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Ridimensiona il testo per adattarlo alla cornice"],["{{テキストに合わせて枠をリサイズ}}","Ridimensiona la cornice per adattarla al testo"],["{{リサイズしない}}","Nessun ridimensionamento"],["{{フォント}}","font"],["{{テキスト}}","Testo"],["{{ループ}}","loop"],["{{音量}}","volume"],["{{ビデオ}}","Video"],["{{イージング}}","facilitando"],["{{サウンド}}","suono"],["{{シンボル}}","Simbolo"],["{{名前}}","Nome"],["{{オブジェクト}}","oggetto"],["{{ステージ設定}}","Scenario"],["{{プレビュー}}","Anteprima"],["{{削除}}","Cancellare"],["{{ペースト}}","Incolla"],["{{コピー}}","Copia"],["{{プラグインメニュー}}","Menu del plug-in"],["{{トゥイーン}}","tween"],["{{カーブポインターの追加}}","Puntatore di curva supplementare"],["{{パスの結合}}","Fusione di percorsi"],["{{シェイプ}}","forma"],["{{キーフレームに配分}}","Assegnazione ai fotogrammi chiave"],["{{レイヤーに配分}}","Assegnazione ai livelli"],["{{タイムライン}}","Timeline"],["{{整列}}","Allineare"],["{{最背面}}","La maggior parte della schiena"],["{{ひとつ背面へ}}","Uno sul retro"],["{{ひとつ前面へ}}","Una parte anteriore"],["{{最前面}}","In prima linea"],["{{重ね順}}","Organizzare"],["{{プラグイン}}","plug-in"],["{{ライブラリ}}","biblioteca"],["{{プロパティ}}","proprietà"],["{{マスクレイヤー}}","strato di maschera"],["{{通常レイヤー}}","Strato normale"],["{{モーショントゥイーンの削除}}","Soppressione dei tweens di movimento"],["{{モーショントゥイーンの追加}}","Ulteriori tween di movimento"],["{{モーダル表示}}","indicazione modale"],["{{言語}}","Lingua"],["{{フォーマット}}","formato"],["{{含める}}","includere"],["{{含めない}}","non includere"],["{{使い方、リファレンス}}","Uso, riferimento"],["{{非表示レイヤー}}","strato nascosto"],["{{設定}}","setup"],["{{デフォルトのループを利用する}}","Utilizzare il ciclo predefinito"],["{{フレームピッカー}}","raccoglitore di cornici"],["{{ステージ左揃え}}","Allineare il palco a sinistra"],["{{ステージ中央揃え(水平方向)}}","Allineare il centro del palco (orizzontale)"],["{{ステージ右揃え}}","Allineare il palco a destra"],["{{ステージ上揃え}}","Allineare il palco in alto"],["{{ステージ中央揃え(垂直方向)}}","Allineare il centro del palco (verticale)"],["{{ステージ下揃え}}","Allineare il fondo del palco"],["{{左揃え}}","Sinistra"],["{{中央揃え(水平方向)}}","Centro (Orizzontalità)"],["{{右揃え}}","Destra"],["{{上揃え}}","Top"],["{{中央揃え(垂直方向)}}","Centro (Verticale)"],["{{下揃え}}","Fondo"],["{{開始フレーム}}","telaio di partenza"],["{{終了フレーム}}","telaio finale"],["{{ループで再生}}","Gioca in loop"],["{{1回再生}}","1 riproduzione"],["{{指定したフレームで固定}}","Fissato nella cornice specificata"],["{{1回逆再生}}","1 riproduzione inversa"],["{{逆ループで再生}}","Riproduzione in loop inverso"],["{{画面の拡大・縮小}}","Ingrandire e rimpicciolire lo schermo"],["{{カスタムイージングデータを保存}}","Salva i dati di easing personalizzati"],["{{カスタムイージングデータの読込}}","Lettura dei dati di easing personalizzati"],["{{プレビューのON/OFF}}","Anteprima on/off"],["{{フォント枠サイズ}}","Dimensione della cornice del carattere"],["{{フォント枠カラー}}","Colore della cornice del carattere"],["{{オニオンスキン}}","Pelle di cipolla"],["{{バケツツール}}","Strumenti a secchiello"],["{{ペンツール}}","Strumento penna"],["{{ダブルクリックでカーブポイントが追加されます}}","Doppio clic per aggiungere un punto di curva"],["{{選択ツール}}","Strumenti di selezione"],["{{Shape変形ツール}}","Strumento di trasformazione della forma"],["{{テキストツール}}","Text Tool"],["{{矩形ツール}}","Strumento di testo"],["{{楕円ツール}}","Strumento Ellisse"],["{{角丸矩形ツール}}","Strumento Rettangolo arrotondato"],["{{塗りのカラー}}","Colore di riempimento"],["{{線のカラー}}","Colore del tratto"],["{{線の太さ}}","Larghezza della corsa"],["{{プロジェクトデータの読込}}","Caricamento dei dati del progetto"],["{{プロジェクトデータを保存}}","Salvare i dati del progetto"],["{{書き出し}}","Esportazione"],["{{Discordへ移動}}","Vai su discordia"],["{{バグ報告}}","Segnalazioni di bug"],["{{設定}}","Impostazione"],["{{タブを追加}}","Aggiungere una scheda"],["{{タブの一覧を表示・移動}}","Visualizzare e spostarsi attraverso l'elenco delle schede"],["{{スクリプトを追加}}","Aggiungere uno script"],["{{キーフレームを追加}}","Aggiungere un keyframe"],["{{空のキーフレームを追加}}","Aggiungere un keyframe vuoto"],["{{フレームを追加}}","Aggiungere una cornice"],["{{フレームを削除}}","Cancellare la cornice"],["{{再生}}","Gioca"],["{{停止}}","Fermare"],["{{ループ設定}}","Impostazione del loop"],["{{レイヤーを追加}}","Aggiungere uno strato"],["{{レイヤーを削除}}","Cancellare il livello"],["{{全てのレイヤーをハイライト}}","Evidenzia tutti i livelli"],["{{全てのレイヤーを非表示}}","Nascondi tutti i livelli"],["{{全てのレイヤーをロック}}","Blocca tutti i livelli"],["{{比率を固定}}","Rapporto fisso"],["{{ステージの幅}}","Larghezza del palco"],["{{背景色}}","Colore di sfondo"],["{{ステージの高さ}}","Altezza del palco"],["{{フレームレート}}","Frame Rate"],["{{シンボル名}}","Nome del simbolo"],["{{イージング設定}}","Impostazione di rilassamento"],["{{ビデオの音量設定}}","Impostazione del volume video"],["{{自動再生}}","Riproduzione automatica"],["{{テキストエリアのボーダー設定}}","Impostazione del bordo dell'area di testo"],["{{テキスト入力設定}}","Impostazione dell'inserimento del testo"],["{{フォント選択}}","Seleziona il carattere"],["{{自動サイズ調整}}","Regolazione automatica delle dimensioni"],["{{フォントスタイルタイプ}}","Tipo di stile di carattere"],["{{行揃え}}","Allineare"],["{{改行設定}}","Impostazione Newline"],["{{スクロール設定}}","Impostazione dello scorrimento"],["{{フォントサイズ}}","Dimensione del carattere"],["{{フォントカラー}}","Colore del carattere"],["{{行間}}","Spazio di linea"],["{{文字幅}}","Larghezza del carattere"],["{{左マージン}}","Margine sinistro"],["{{右マージン}}","Margine destro"],["{{カラー種別の選択}}","Seleziona un tipo di colore"],["{{背景画像の選択}}","Selezionare un'immagine di sfondo"],["{{カラーポインターを追加}}","Aggiungere i puntatori di colore"],["{{カラー値}}","Colore"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Larghezza dell'oggetto di selezione"],["{{選択対象のX座標}}","Coordinata X dell'oggetto di selezione"],["{{選択対象の高さ}}","Altezza dell'oggetto di selezione"],["{{選択対象のY座標}}","Coordinata Y dell'oggetto di selezione"],["{{選択対象の幅の伸縮}}","scaleX dell'oggetto selezionato"],["{{選択対象を回転}}","Ruotare l'oggetto"],["{{選択対象の高さの伸縮}}","scalaY dell'oggetto selezionato"],["{{アルファオフセット(-255〜255)}}","Offset alfa(-255〜255)"],["{{赤(0%-100%)}}","Rosso(0%-100%)"],["{{赤オフセット(-255〜255)}}","Offset rosso(-255〜255)"],["{{緑(0%-100%)}}","Verde(0%-100%)"],["{{緑オフセット(-255〜255)}}","Offset Verde(-255〜255)"],["{{青(0%-100%)}}","Blu(0%-100%)"],["{{青オフセット(-255〜255)}}","Offset Blu(-255〜255)"],["{{ブレンドモード}}","Modalità di fusione"],["{{フィルターを選択}}","Seleziona un filtro"],["{{フィルターを追加}}","Aggiungere un filtro"],["{{サウンドを追加}}","Aggiungere un suono"],["{{フィルターを表示・非表示する}}","Mostrare e nascondere i filtri"],["{{フィルターを削除}}","Cancellare il filtro"],["{{水平方向にぼかす}}","Sfocatura orizzontale"],["{{垂直方向にぼかす}}","Sfocatura verticale"],["{{フィルター強度}}","Forza del filtro"],["{{フィルター角度}}","Angolo del filtro"],["{{シャドウのアルファ}}","Ombra alfa"],["{{シャドウのカラー}}","Colore dell'ombra"],["{{フィルター距離}}","Distanza del filtro"],["{{ハイライトのカラー}}","Colore in evidenza"],["{{ハイライトのアルファ}}","Evidenziare l'alfa"],["{{グラデーションカラー}}","Colore sfumato"],["{{グラデーションのアルファ}}","Gradiente alfa"],["{{タブの移動・名前を変更}}","Spostare/rinominare le schede"],["{{プロジェクトを閉じる}}","Chiudere il progetto"],["{{上下に移動}}","Sposta su e giù"],["{{レイヤー変更(ダブルクリック)}}","Cambio di livello (doppio clic)"],["{{レイヤーをハイライト}}","Strato di evidenziazione"],["{{レイヤーを非表示}}","Nascondere lo strato"],["{{レイヤーをロック}}","Bloccare il livello"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Curve Pointer (doppio clic per attivare/disattivare)"],["{{インスタンス名}}","Nome dell'istanza"],["{{ライブラリ内の検索}}","Cerca nella biblioteca"],["{{フレームラベル}}","Etichetta del telaio"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Se il progetto non viene salvato, i dati del progetto in questa scheda non possono essere recuperati. Vuoi cancellare la scheda?"]])}}class n extends t{createMapping(){return new Map([["{{同名のアイテムが存在します}}","同名のアイテムが存在します"],["{{追加ファイル}}","追加ファイル"],["{{既存のコンテンツ}}","既存のコンテンツ"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます"],["{{全て上書き}}","全て上書き"],["{{全てスキップ}}","全てスキップ"],["{{追加・上書き}}","追加・上書き"],["{{スキップ}}","スキップ"],["{{表示確認したいフレームを指定}}","表示確認したいフレームを指定"],["{{ファイル名を指定}}","ファイル名を指定"],["{{ファイル名}}","ファイル名"],["{{終了フレームを指定}}","終了フレームを指定"],["{{開始フレームを指定}}","開始フレームを指定"],["{{フレーム設定}}","フレーム設定"],["{{書き出し設定}}","書き出し設定"],["{{ファイル形式の選択}}","ファイル形式の選択"],["{{ファイル形式}}","ファイル形式"],["{{サイズ設定}}","サイズ設定"],["{{左上}}","左上"],["{{中央上}}","中央上"],["{{右上}}","右上"],["{{中央左}}","中央左"],["{{中央}}","中央"],["{{中央右}}","中央右"],["{{左下}}","左下"],["{{中央下}}","中央下"],["{{右下}}","右下"],["{{中心点のX座標}}","中心点のX座標"],["{{中心点のY座標}}","中心点のY座標"],["{{MovieClipに変換}}","MovieClipに変換"],["{{変換}}","変換"],["{{ループ回数}}","ループ回数"],["{{カーブポインターの削除}}","カーブポインターの削除"],["{{ステージ基準}}","ステージ基準"],["{{閉じる}}","閉じる"],["{{保存}}","保存"],["{{リセット}}","リセット"],["{{スクリーン}}","スクリーン"],["{{ショートカット設定}}","ショートカット設定"],["{{レイヤーカラー}}","レイヤーカラー"],["{{Next2Dを支援する}}","Next2Dを支援する"],["{{サポート}}","サポート"],["{{未使用のアイテムを削除}}","未使用のアイテムを削除"],["{{レイヤーをペースト}}","レイヤーをペースト"],["{{レイヤーをコピー}}","レイヤーをコピー"],["{{フレームをペースト}}","フレームをペースト"],["{{フレームをコピー}}","フレームをコピー"],["{{キーフレームを削除}}","キーフレームを削除"],["{{キーフレームに空のキーフレームを追加できません}}","キーフレームに空のキーフレームを追加できません"],["{{ズームツール}}","ズームツール"],["{{タイムライン幅の拡大・縮小}}","タイムライン幅の拡大・縮小"],["{{ガイドレイヤー}}","ガイドレイヤー"],["{{音量設定}}","音量設定"],["{{サウンドを削除}}","サウンドを削除"],["{{カスタムループ}}","カスタムループ"],["{{読込のみ}}","読込のみ"],["{{書込を許可}}","書込を許可"],["{{単一行}}","単一行"],["{{複数行}}","複数行"],["{{自動で折り返し}}","自動で折り返し"],["{{左寄せ}}","左寄せ"],["{{中央揃え}}","中央揃え"],["{{右寄せ}}","右寄せ"],["{{放射状グラデーション}}","放射状グラデーション"],["{{線形グラデーション}}","線形グラデーション"],["{{画像}}","画像"],["{{画像選択}}","画像選択"],["{{種別}}","種別"],["{{Shapeの色設定}}","Shapeの色設定"],["{{変形}}","変形"],["{{カラー効果}}","カラー効果"],["{{フィルター}}","フィルター"],["{{Shapeを複製}}","Shapeを複製"],["{{読み込み}}","読み込み"],["{{新規フォルダー}}","新規フォルダー"],["{{新規MovieClip}}","新規MovieClip"],["{{枠に合わせてテキストをリサイズ}}","枠に合わせてテキストをリサイズ"],["{{テキストに合わせて枠をリサイズ}}","テキストに合わせて枠をリサイズ"],["{{リサイズしない}}","リサイズしない"],["{{フォント}}","フォント"],["{{テキスト}}","テキスト"],["{{ループ}}","ループ"],["{{音量}}","音量"],["{{ビデオ}}","ビデオ"],["{{イージング}}","イージング"],["{{サウンド}}","サウンド"],["{{シンボル}}","シンボル"],["{{名前}}","名前"],["{{オブジェクト}}","オブジェクト"],["{{ステージ設定}}","ステージ設定"],["{{プレビュー}}","プレビュー"],["{{削除}}","削除"],["{{ペースト}}","ペースト"],["{{コピー}}","コピー"],["{{プラグインメニュー}}","プラグインメニュー"],["{{トゥイーン}}","トゥイーン"],["{{カーブポインターの追加}}","カーブポインターの追加"],["{{パスの結合}}","パスの結合"],["{{シェイプ}}","シェイプ"],["{{キーフレームに配分}}","キーフレームに配分"],["{{レイヤーに配分}}","レイヤーに配分"],["{{タイムライン}}","タイムライン"],["{{整列}}","整列"],["{{最背面}}","最背面"],["{{ひとつ背面へ}}","ひとつ背面へ"],["{{ひとつ前面へ}}","ひとつ前面へ"],["{{最前面}}","最前面"],["{{重ね順}}","重ね順"],["{{プラグイン}}","プラグイン"],["{{ライブラリ}}","ライブラリ"],["{{プロパティ}}","プロパティ"],["{{マスクレイヤー}}","マスクレイヤー"],["{{通常レイヤー}}","通常レイヤー"],["{{モーショントゥイーンの削除}}","モーショントゥイーンの削除"],["{{モーショントゥイーンの追加}}","モーショントゥイーンの追加"],["{{モーダル表示}}","モーダル表示"],["{{言語}}","言語"],["{{フォーマット}}","フォーマット"],["{{含める}}","含める"],["{{含めない}}","含めない"],["{{使い方、リファレンス}}","使い方、リファレンス"],["{{非表示レイヤー}}","非表示レイヤー"],["{{設定}}","設定"],["{{デフォルトのループを利用する}}","デフォルトのループを利用する"],["{{フレームピッカー}}","フレームピッカー"],["{{ステージ左揃え}}","ステージ左揃え"],["{{ステージ中央揃え(水平方向)}}","ステージ中央揃え(水平方向)"],["{{ステージ右揃え}}","ステージ右揃え"],["{{ステージ上揃え}}","ステージ上揃え"],["{{ステージ中央揃え(垂直方向)}}","ステージ中央揃え(垂直方向)"],["{{ステージ下揃え}}","ステージ下揃え"],["{{左揃え}}","左揃え"],["{{中央揃え(水平方向)}}","中央揃え(水平方向)"],["{{右揃え}}","右揃え"],["{{上揃え}}","上揃え"],["{{中央揃え(垂直方向)}}","中央揃え(垂直方向)"],["{{下揃え}}","下揃え"],["{{開始フレーム}}","開始フレーム"],["{{終了フレーム}}","終了フレーム"],["{{ループで再生}}","ループで再生"],["{{1回再生}}","1回再生"],["{{指定したフレームで固定}}","指定したフレームで固定"],["{{1回逆再生}}","1回逆再生"],["{{逆ループで再生}}","逆ループで再生"],["{{画面の拡大・縮小}}","画面の拡大・縮小"],["{{カスタムイージングデータを保存}}","カスタムイージングデータを保存"],["{{カスタムイージングデータの読込}}","カスタムイージングデータの読込"],["{{プレビューのON/OFF}}","プレビューのON/OFF"],["{{フォント枠サイズ}}","フォント枠サイズ"],["{{フォント枠カラー}}","フォント枠カラー"],["{{オニオンスキン}}","オニオンスキン"],["{{バケツツール}}","バケツツール"],["{{ペンツール}}","ペンツール"],["{{ダブルクリックでカーブポイントが追加されます}}","ダブルクリックでカーブポイントが追加されます"],["{{選択ツール}}","選択ツール"],["{{Shape変形ツール}}","Shape変形ツール"],["{{テキストツール}}","テキストツール"],["{{矩形ツール}}","矩形ツール"],["{{楕円ツール}}","楕円ツール"],["{{角丸矩形ツール}}","角丸矩形ツール"],["{{塗りのカラー}}","塗りのカラー"],["{{線のカラー}}","線のカラー"],["{{線の太さ}}","線の太さ"],["{{プロジェクトデータの読込}}","プロジェクトデータの読込"],["{{プロジェクトデータを保存}}","プロジェクトデータを保存"],["{{書き出し}}","書き出し"],["{{Discordへ移動}}","Discordへ移動"],["{{バグ報告}}","バグ報告"],["{{設定}}","設定"],["{{タブを追加}}","タブを追加"],["{{タブの一覧を表示・移動}}","タブの一覧を表示・移動"],["{{スクリプトを追加}}","スクリプトを追加"],["{{キーフレームを追加}}","キーフレームを追加"],["{{空のキーフレームを追加}}","空のキーフレームを追加"],["{{フレームを追加}}","フレームを追加"],["{{フレームを削除}}","フレームを削除"],["{{再生}}","再生"],["{{停止}}","停止"],["{{ループ設定}}","ループ設定"],["{{レイヤーを追加}}","レイヤーを追加"],["{{レイヤーを削除}}","レイヤーを削除"],["{{全てのレイヤーをハイライト}}","全てのレイヤーをハイライト"],["{{全てのレイヤーを非表示}}","全てのレイヤーを非表示"],["{{全てのレイヤーをロック}}","全てのレイヤーをロック"],["{{比率を固定}}","比率を固定"],["{{ステージの幅}}","ステージの幅"],["{{背景色}}","背景色"],["{{ステージの高さ}}","ステージの高さ"],["{{フレームレート}}","フレームレート"],["{{シンボル名}}","シンボル名"],["{{イージング設定}}","イージング設定"],["{{ビデオの音量設定}}","ビデオの音量設定"],["{{自動再生}}","自動再生"],["{{テキストエリアのボーダー設定}}","テキストエリアのボーダー設定"],["{{テキスト入力設定}}","テキスト入力設定"],["{{フォント選択}}","フォント選択"],["{{自動サイズ調整}}","自動サイズ調整"],["{{フォントスタイルタイプ}}","フォントスタイルタイプ"],["{{行揃え}}","行揃え"],["{{改行設定}}","改行設定"],["{{スクロール設定}}","スクロール設定"],["{{フォントサイズ}}","フォントサイズ"],["{{フォントカラー}}","フォントカラー"],["{{行間}}","行間"],["{{文字幅}}","文字幅"],["{{左マージン}}","左マージン"],["{{右マージン}}","右マージン"],["{{カラー種別の選択}}","カラー種別の選択"],["{{背景画像の選択}}","背景画像の選択"],["{{カラーポインターを追加}}","カラーポインターを追加"],["{{カラー値}}","カラー値"],["{{アルファ(0%-100%)}}","アルファ(0%-100%)"],["{{アルファ値}}","アルファ値"],["{{選択対象の幅}}","選択対象の幅"],["{{選択対象のX座標}}","選択対象のX座標"],["{{選択対象の高さ}}","選択対象の高さ"],["{{選択対象のY座標}}","選択対象のY座標"],["{{選択対象の幅の伸縮}}","選択対象の幅の伸縮"],["{{選択対象を回転}}","選択対象を回転"],["{{選択対象の高さの伸縮}}","選択対象の高さの伸縮"],["{{アルファオフセット(-255〜255)}}","アルファオフセット(-255〜255)"],["{{赤(0%-100%)}}","赤(0%-100%)"],["{{赤オフセット(-255〜255)}}","赤オフセット(-255〜255)"],["{{緑(0%-100%)}}","緑(0%-100%)"],["{{緑オフセット(-255〜255)}}","緑オフセット(-255〜255)"],["{{青(0%-100%)}}","青(0%-100%)"],["{{青オフセット(-255〜255)}}","青オフセット(-255〜255)"],["{{ブレンドモード}}","ブレンドモード"],["{{フィルターを選択}}","フィルターを選択"],["{{フィルターを追加}}","フィルターを追加"],["{{サウンドを追加}}","サウンドを追加"],["{{フィルターを表示・非表示する}}","フィルターを表示・非表示する"],["{{フィルターを削除}}","フィルターを削除"],["{{水平方向にぼかす}}","水平方向にぼかす"],["{{垂直方向にぼかす}}","垂直方向にぼかす"],["{{フィルター強度}}","フィルター強度"],["{{フィルター角度}}","フィルター角度"],["{{シャドウのアルファ}}","シャドウのアルファ"],["{{シャドウのカラー}}","シャドウのカラー"],["{{フィルター距離}}","フィルター距離"],["{{ハイライトのカラー}}","ハイライトのカラー"],["{{ハイライトのアルファ}}","ハイライトのアルファ"],["{{グラデーションカラー}}","グラデーションカラー"],["{{グラデーションのアルファ}}","グラデーションのアルファ"],["{{タブの移動・名前を変更}}","タブの移動・名前を変更"],["{{プロジェクトを閉じる}}","プロジェクトを閉じる"],["{{上下に移動}}","上下に移動"],["{{レイヤー変更(ダブルクリック)}}","レイヤー変更(ダブルクリック)"],["{{レイヤーをハイライト}}","レイヤーをハイライト"],["{{レイヤーを非表示}}","レイヤーを非表示"],["{{レイヤーをロック}}","レイヤーをロック"],["{{カーブポインター(ダブルクリックでON/OFF)}}","カーブポインター(ダブルクリックでON/OFF)"],["{{インスタンス名}}","インスタンス名"],["{{ライブラリ内の検索}}","ライブラリ内の検索"],["{{フレームラベル}}","フレームラベル"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？"]])}}class o extends t{createMapping(){return new Map([["{{同名のアイテムが存在します}}","같은 이름의 항목이 존재합니다"],["{{追加ファイル}}","추가 파일"],["{{既存のコンテンツ}}","기존 콘텐츠"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","파일을 덮어쓰거나 이름을 변경하고 추가하거나 건너뛰도록 선택할 수 있습니다"],["{{全て上書き}}","모두 덮어쓰기"],["{{全てスキップ}}","모두 건너뛰기"],["{{追加・上書き}}","추가 또는 덮어쓰기"],["{{スキップ}}","건너뛰다"],["{{表示確認したいフレームを指定}}","표시 확인할 프레임 지정"],["{{ファイル名を指定}}","파일 이름 지정"],["{{ファイル名}}","파일 이름"],["{{終了フレームを指定}}","끝 프레임 지정"],["{{開始フレームを指定}}","시작 프레임 지정"],["{{フレーム設定}}","프레임 설정"],["{{書き出し設定}}","내보내기 설정"],["{{ファイル形式の選択}}","파일 형식 선택"],["{{ファイル形式}}","파일 형식"],["{{サイズ設定}}","사이즈 설정"],["{{左上}}","왼쪽 상단"],["{{中央上}}","상단 중앙"],["{{右上}}","오른쪽 상단"],["{{中央左}}","중앙 왼쪽"],["{{中央}}","센터"],["{{中央右}}","중앙 오른쪽"],["{{左下}}","왼쪽 하단"],["{{中央下}}","하단 중앙"],["{{右下}}","오른쪽 하단"],["{{中心点のX座標}}","중심점의 X 좌표"],["{{中心点のY座標}}","중심점의 Y 좌표"],["{{MovieClipに変換}}","MovieClip로 변환"],["{{変換}}","변환"],["{{ループ回数}}","루프 횟수"],["{{カーブポインターの削除}}","곡선 테이블의"],["{{ステージ基準}}","스테이지 기준"],["{{閉じる}}","닫다"],["{{保存}}","저장"],["{{リセット}}","리셋"],["{{スクリーン}}","스크린"],["{{ショートカット設定}}","바로 가기 설정"],["{{レイヤーカラー}}","레이어 색상"],["{{Next2Dを支援する}}","Next2D 지원"],["{{サポート}}","지원"],["{{未使用のアイテムを削除}}","사용하지 않는 항목 삭제"],["{{レイヤーをペースト}}","레이어 붙여넣기"],["{{レイヤーをコピー}}","레이어 복사"],["{{フレームをペースト}}","프레임을 붙여넣기"],["{{フレームをコピー}}","프레임 복사"],["{{キーフレームを削除}}","키프레임 삭제"],["{{キーフレームに空のキーフレームを追加できません}}","키프레임에 빈 키프레임을 추가할 수 없음"],["{{ズームツール}}","줌 도구"],["{{タイムライン幅の拡大・縮小}}","타임라인 폭 확대·축소"],["{{ガイドレイヤー}}","가이드레이야"],["{{音量設定}}","볼륨 설정"],["{{サウンドを削除}}","사운드 삭제"],["{{カスタムループ}}","맞춤형 루프"],["{{読込のみ}}","로드 전용"],["{{書込を許可}}","쓰기 허용"],["{{単一行}}","단일 행"],["{{複数行}}","여러 줄"],["{{自動で折り返し}}","자동으로 되감기"],["{{左寄せ}}","왼쪽"],["{{中央揃え}}","센터"],["{{右寄せ}}","권리"],["{{放射状グラデーション}}","방사형 그라데이션"],["{{線形グラデーション}}","선형 그라데이션"],["{{画像}}","이미지"],["{{画像選択}}","이미지 선택"],["{{種別}}","종별"],["{{Shapeの色設定}}","Shape 색상 설정"],["{{変形}}","변형"],["{{カラー効果}}","색상 변환"],["{{フィルター}}","필터"],["{{Shapeを複製}}","Shape 복제"],["{{読み込み}}","로딩"],["{{新規フォルダー}}","새 폴더"],["{{新規MovieClip}}","새로운 MovieClip"],["{{枠に合わせてテキストをリサイズ}}","프레임에 맞게 텍스트를 크기 조정"],["{{テキストに合わせて枠をリサイズ}}","텍스트에 맞게 프레임을 크기 조정"],["{{リサイズしない}}","크기 조정하지 않음"],["{{フォント}}","글꼴"],["{{テキスト}}","텍스트"],["{{ループ}}","루프"],["{{音量}}","볼륨"],["{{ビデオ}}","동영상"],["{{イージング}}","부드럽게"],["{{サウンド}}","소리"],["{{シンボル}}","상징"],["{{名前}}","이름"],["{{オブジェクト}}","개체"],["{{ステージ設定}}","스테이지 설정"],["{{プレビュー}}","미리보기"],["{{削除}}","삭제"],["{{ペースト}}","붙여넣기"],["{{コピー}}","복사"],["{{プラグインメニュー}}","플러그인 메뉴"],["{{トゥイーン}}","트윈"],["{{カーブポインターの追加}}","커브 포인터 추가"],["{{パスの結合}}","경로 결합"],["{{シェイプ}}","모양"],["{{キーフレームに配分}}","키프레임에 할당"],["{{レイヤーに配分}}","레이어에 배포"],["{{タイムライン}}","타임라인"],["{{整列}}","맞추다"],["{{最背面}}","최후면"],["{{ひとつ背面へ}}","하나의 뒷면으로"],["{{ひとつ前面へ}}","하나 앞으로"],["{{最前面}}","최전면"],["{{重ね順}}","겹침 순서"],["{{プラグイン}}","플러그인"],["{{ライブラリ}}","도서관"],["{{プロパティ}}","속성"],["{{マスクレイヤー}}","마스크 레이어"],["{{通常レイヤー}}","일반 레이어"],["{{モーショントゥイーンの削除}}","모션 트윈 삭제"],["{{モーショントゥイーンの追加}}","모션 트윈 추가"],["{{モーダル表示}}","모달 표시"],["{{言語}}","언어"],["{{フォーマット}}","형식"],["{{含める}}","포함"],["{{含めない}}","포함하지 않음"],["{{使い方、リファレンス}}","사용법, 참조"],["{{非表示レイヤー}}","숨겨진 레이어"],["{{設定}}","설정"],["{{デフォルトのループを利用する}}","기본 루프 사용"],["{{フレームピッカー}}","프레임 선택기"],["{{ステージ左揃え}}","스테이지 왼쪽 정렬"],["{{ステージ中央揃え(水平方向)}}","스테이지 중앙 정렬(수평 방향)"],["{{ステージ右揃え}}","스테이지 오른쪽 정렬"],["{{ステージ上揃え}}","무대에서 정렬"],["{{ステージ中央揃え(垂直方向)}}","스테이지 중앙 정렬(수직 방향)"],["{{ステージ下揃え}}","무대 아래 정렬"],["{{左揃え}}","왼쪽 정렬"],["{{中央揃え(水平方向)}}","중앙 정렬(수평 방향)"],["{{右揃え}}","오른쪽 정렬"],["{{上揃え}}","상단 정렬"],["{{中央揃え(垂直方向)}}","중앙 정렬(수직 방향)"],["{{下揃え}}","아래 정렬"],["{{開始フレーム}}","시작 프레임"],["{{終了フレーム}}","종료 프레임"],["{{ループで再生}}","루프로 재생"],["{{1回再生}}","한 번 재생"],["{{指定したフレームで固定}}","지정된 프레임으로 고정"],["{{1回逆再生}}","1회 역재생"],["{{逆ループで再生}}","역 루프로 재생"],["{{画面の拡大・縮小}}","화면 확대/축소"],["{{カスタムイージングデータを保存}}","맞춤형 여유 데이터 저장"],["{{カスタムイージングデータの読込}}","사용자 정의 여유 데이터 읽기"],["{{プレビューのON/OFF}}","프레뷰의 ON/OFF"],["{{フォント枠サイズ}}","글꼴 프레임 크기"],["{{フォント枠カラー}}","글꼴 프레임 색상"],["{{オニオンスキン}}","양파 껍질"],["{{バケツツール}}","버킷 도구"],["{{ペンツール}}","펜 도구"],["{{ダブルクリックでカーブポイントが追加されます}}","곡선 점을 추가하려면 두 번 클릭"],["{{選択ツール}}","선택 도구"],["{{Shape変形ツール}}","모양 변형 도구"],["{{テキストツール}}","텍스트 도구"],["{{矩形ツール}}","너무 직사각형"],["{{楕円ツール}}","타원 도구"],["{{角丸矩形ツール}}","둥근 사각형 도구"],["{{塗りのカラー}}","채우기 색상"],["{{線のカラー}}","획 색상"],["{{線の太さ}}","획 폭"],["{{プロジェクトデータの読込}}","프로젝트 데이터 로드"],["{{プロジェクトデータを保存}}","프로젝트 데이터 저장"],["{{書き出し}}","내 보내다"],["{{Discordへ移動}}","불화로 이동"],["{{バグ報告}}","버그 보고서"],["{{設定}}","환경"],["{{タブを追加}}","탭 추가"],["{{タブの一覧を表示・移動}}","탭 목록 보기 및 이동"],["{{スクリプトを追加}}","스크립트 추가"],["{{キーフレームを追加}}","키프레임 추가"],["{{空のキーフレームを追加}}","빈 키프레임 추가"],["{{フレームを追加}}","프레임 추가"],["{{フレームを削除}}","프레임 삭제"],["{{再生}}","놀다"],["{{停止}}","중지"],["{{ループ設定}}","루프 설정"],["{{レイヤーを追加}}","레이어 추가"],["{{レイヤーを削除}}","레이어 삭제"],["{{全てのレイヤーをハイライト}}","모든 레이어 강조 표시"],["{{全てのレイヤーを非表示}}","모든 레이어 숨기기"],["{{全てのレイヤーをロック}}","모든 레이어 잠금"],["{{比率を固定}}","고정 비율"],["{{ステージの幅}}","무대 폭"],["{{背景色}}","배경색"],["{{ステージの高さ}}","무대 높이"],["{{フレームレート}}","프레임 속도"],["{{シンボル名}}","기호 이름"],["{{イージング設定}}","이징 설정"],["{{ビデオの音量設定}}","비디오 볼륨 설정"],["{{自動再生}}","자동 재생"],["{{テキストエリアのボーダー設定}}","텍스트 영역 테두리 설정"],["{{テキスト入力設定}}","텍스트 입력 설정"],["{{フォント選択}}","글꼴 선택"],["{{自動サイズ調整}}","자동 크기 조정"],["{{フォントスタイルタイプ}}","글꼴 스타일 유형"],["{{行揃え}}","맞추다"],["{{改行設定}}","개행 설정"],["{{スクロール設定}}","스크롤 설정"],["{{フォントサイズ}}","글꼴 크기"],["{{フォントカラー}}","글꼴 색상"],["{{行間}}","줄 간격"],["{{文字幅}}","문자 너비"],["{{左マージン}}","왼쪽 여백"],["{{右マージン}}","오른쪽 여백"],["{{カラー種別の選択}}","색상 유형 선택"],["{{背景画像の選択}}","배경 이미지 선택"],["{{カラーポインターを追加}}","색상 포인터 추가"],["{{カラー値}}","색상"],["{{アルファ(0%-100%)}}","알파(0%-100%)"],["{{アルファ値}}","알파"],["{{選択対象の幅}}","선택 개체의 너비"],["{{選択対象のX座標}}","선택 객체의 X 좌표"],["{{選択対象の高さ}}","선택 개체의 높이"],["{{選択対象のY座標}}","선택 객체의 Y 좌표"],["{{選択対象の幅の伸縮}}","선택한 객체의 scaleX"],["{{選択対象を回転}}","개체 회전"],["{{選択対象の高さの伸縮}}","선택한 객체의 scaleY"],["{{アルファオフセット(-255〜255)}}","알파 오프셋(-255〜255)"],["{{赤(0%-100%)}}","빨간색(0%-100%)"],["{{赤オフセット(-255〜255)}}","레드 오프셋(-255〜255)"],["{{緑(0%-100%)}}","녹색(0%-100%)"],["{{緑オフセット(-255〜255)}}","그린 오프셋(-255〜255)"],["{{青(0%-100%)}}","파란색(0%-100%)"],["{{青オフセット(-255〜255)}}","블루 오프셋(-255〜255)"],["{{ブレンドモード}}","혼합 모드"],["{{フィルターを選択}}","필터 선택"],["{{フィルターを追加}}","필터 추가"],["{{サウンドを追加}}","소리 추가"],["{{フィルターを表示・非表示する}}","필터 표시 및 숨기기"],["{{フィルターを削除}}","필터 삭제"],["{{水平方向にぼかす}}","수평으로 흐림"],["{{垂直方向にぼかす}}","수직으로 흐림"],["{{フィルター強度}}","필터 강도"],["{{フィルター角度}}","필터 각도"],["{{シャドウのアルファ}}","섀도우 알파"],["{{シャドウのカラー}}","그림자 색상"],["{{フィルター距離}}","필터 거리"],["{{ハイライトのカラー}}","하이라이트 색상"],["{{ハイライトのアルファ}}","하이라이트 알파"],["{{グラデーションカラー}}","그라데이션 색상"],["{{グラデーションのアルファ}}","그라디언트 알파"],["{{タブの移動・名前を変更}}","탭 이동/이름 바꾸기"],["{{プロジェクトを閉じる}}","프로젝트 닫기"],["{{上下に移動}}","위아래로 이동"],["{{レイヤー変更(ダブルクリック)}}","레이어 변경(더블 클릭)"],["{{レイヤーをハイライト}}","하이라이트 레이어"],["{{レイヤーを非表示}}","레이어 숨기기"],["{{レイヤーをロック}}","레이어 잠금"],["{{カーブポインター(ダブルクリックでON/OFF)}}","곡선 포인터(켜기/끄려면 두 번 클릭)"],["{{インスタンス名}}","인스턴스 이름"],["{{ライブラリ内の検索}}","도서관에서 검색"],["{{フレームラベル}}","프레임 라벨"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","프로젝트를 저장하지 않으면 이 탭의 프로젝트 데이터를 복구할 수 없습니다. 탭을 삭제하시겠습니까?"]])}}class l extends t{createMapping(){return new Map([["{{同名のアイテムが存在します}}","Существуют предметы с таким же названием"],["{{追加ファイル}}","Дополнительный файл"],["{{既存のコンテンツ}}","Существующее содержание"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","Вы можете выбрать перезапись, переименование и добавление файлов или пропуск"],["{{全て上書き}}","Переписать все"],["{{全てスキップ}}","Пропустить все"],["{{追加・上書き}}","Добавить или перезаписать"],["{{スキップ}}","Пропустить"],["{{表示確認したいフレームを指定}}","Укажите кадр, отображение которого вы хотите проверить"],["{{ファイル名を指定}}","Укажите имя файла"],["{{ファイル名}}","имя файла"],["{{終了フレームを指定}}","Укажите конечную рамку"],["{{開始フレームを指定}}","Укажите начальный кадр"],["{{フレーム設定}}","Установка рамы"],["{{書き出し設定}}","Настройки экспорта"],["{{ファイル形式の選択}}","Выберите формат файла"],["{{ファイル形式}}","Форматы файлов"],["{{サイズ設定}}","Установка размера"],["{{左上}}","Вверху слева"],["{{中央上}}","Вверху по центру"],["{{右上}}","Верхний правый"],["{{中央左}}","Центр Левый"],["{{中央}}","Центр"],["{{中央右}}","Центр Правый"],["{{左下}}","Низ Левый"],["{{中央下}}","Нижняя часть Центр"],["{{右下}}","Дно справа"],["{{中心点のX座標}}","X-координата центральной точки"],["{{中心点のY座標}}","Y-координата центральной точки"],["{{MovieClipに変換}}","Конвертировать в MovieClip"],["{{変換}}","трансформация"],["{{ループ回数}}","Количество циклов"],["{{カーブポインターの削除}}","Удалить указатель кривой"],["{{ステージ基準}}","Критерии этапа"],["{{閉じる}}","Закрыть"],["{{保存}}","Сохранить"],["{{リセット}}","сброс"],["{{スクリーン}}","Экран"],["{{ショートカット設定}}","Настройки ярлыков"],["{{レイヤーカラー}}","слоистый цвет"],["{{Next2Dを支援する}}","Поддержите Next2D"],["{{サポート}}","поддержка"],["{{未使用のアイテムを削除}}","Удалите неиспользуемые предметы"],["{{レイヤーをペースト}}","Слой пасты"],["{{レイヤーをコピー}}","Копирование слоя"],["{{フレームをペースト}}","Вставить рамку"],["{{フレームをコピー}}","Копировальная рама"],["{{キーフレームを削除}}","Удалить ключевые кадры"],["{{キーフレームに空のキーフレームを追加できません}}","Невозможно добавить пустые ключевые кадры в ключевые кадры"],["{{ズームツール}}","Инструмент масштабирования"],["{{タイムライン幅の拡大・縮小}}","Ширина временной шкалы Расширение/сокращение"],["{{ガイドレイヤー}}","направляющий слой"],["{{音量設定}}","Настройка громкости"],["{{サウンドを削除}}","Удалить звук"],["{{カスタムループ}}","индивидуальная петля"],["{{読込のみ}}","Только чтение"],["{{書込を許可}}","разрешение на публикацию"],["{{単一行}}","Одиночная линия"],["{{複数行}}","Многолинейный"],["{{自動で折り返し}}","Автоматический обхват"],["{{左寄せ}}","Слева"],["{{中央揃え}}","Центр"],["{{右寄せ}}","Правый"],["{{放射状グラデーション}}","радиальная градация"],["{{線形グラデーション}}","линейный градиент"],["{{画像}}","Изображение"],["{{画像選択}}","Выбор изображения"],["{{種別}}","Тип"],["{{Shapeの色設定}}","Настройки цвета формы"],["{{変形}}","деформация"],["{{カラー効果}}","Трансформация цвета"],["{{フィルター}}","фильтр"],["{{Shapeを複製}}","Дублировать форму"],["{{読み込み}}","читать в"],["{{新規フォルダー}}","Новая папка"],["{{新規MovieClip}}","Новый MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Измените размер текста, чтобы он поместился в рамку"],["{{テキストに合わせて枠をリサイズ}}","Измените размер рамки, чтобы вместить текст"],["{{リサイズしない}}","Отсутствие изменения размера"],["{{フォント}}","шрифт"],["{{テキスト}}","Текст"],["{{ループ}}","петля"],["{{音量}}","громкость"],["{{ビデオ}}","Видео"],["{{イージング}}","облегчение"],["{{サウンド}}","звук"],["{{シンボル}}","Символ"],["{{名前}}","Имя"],["{{オブジェクト}}","объект"],["{{ステージ設定}}","Постановка сцены"],["{{プレビュー}}","Предварительный просмотр"],["{{削除}}","Удалить"],["{{ペースト}}","Паста"],["{{コピー}}","Копировать"],["{{プラグインメニュー}}","Меню подключаемых модулей"],["{{トゥイーン}}","между"],["{{カーブポインターの追加}}","Дополнительный указатель кривой"],["{{パスの結合}}","Объединение путей"],["{{シェイプ}}","форма"],["{{キーフレームに配分}}","Распределение по ключевым кадрам"],["{{レイヤーに配分}}","Распределение по слоям"],["{{タイムライン}}","временная шкала"],["{{整列}}","Выровнять"],["{{最背面}}","Большая часть спины"],["{{ひとつ背面へ}}","Один в задней части"],["{{ひとつ前面へ}}","Один фронт"],["{{最前面}}","На переднем крае"],["{{重ね順}}","Организуйте"],["{{プラグイン}}","плагин"],["{{ライブラリ}}","библиотека"],["{{プロパティ}}","собственность"],["{{マスクレイヤー}}","слой маски"],["{{通常レイヤー}}","Нормальный слой"],["{{モーショントゥイーンの削除}}","Удаление твинов движения"],["{{モーショントゥイーンの追加}}","Дополнительные твины движения"],["{{モーダル表示}}","модальная индикация"],["{{言語}}","Язык"],["{{フォーマット}}","формат"],["{{含める}}","включать"],["{{含めない}}","не включать"],["{{使い方、リファレンス}}","Использование, ссылка"],["{{非表示レイヤー}}","скрытый слой"],["{{設定}}","настройка"],["{{デフォルトのループを利用する}}","Используйте цикл по умолчанию"],["{{フレームピッカー}}","подборщик рам"],["{{ステージ左揃え}}","Выровнять сцену слева"],["{{ステージ中央揃え(水平方向)}}","Выровняйте центр сцены (горизонтально)"],["{{ステージ右揃え}}","Выровнять сцену вправо"],["{{ステージ上揃え}}","Выровнять сцену вверх"],["{{ステージ中央揃え(垂直方向)}}","Выровняйте центр сцены (вертикально)"],["{{ステージ下揃え}}","Выровнять дно сцены"],["{{左揃え}}","Слева"],["{{中央揃え(水平方向)}}","Центр (горизонтальность)"],["{{右揃え}}","Справа"],["{{上揃え}}","Топ"],["{{中央揃え(垂直方向)}}","Центр (вертикальный)"],["{{下揃え}}","Дно"],["{{開始フレーム}}","начальная рамка"],["{{終了フレーム}}","торцевая рама"],["{{ループで再生}}","Воспроизведение по кругу"],["{{1回再生}}","1 воспроизведение"],["{{指定したフレームで固定}}","Фиксируется в указанном кадре"],["{{1回逆再生}}","1 воспроизведение в обратном направлении"],["{{逆ループで再生}}","Воспроизведение в обратном цикле"],["{{画面の拡大・縮小}}","Увеличение и уменьшение масштаба экрана"],["{{カスタムイージングデータを保存}}","Сохраните данные пользовательского смягчения"],["{{カスタムイージングデータの読込}}","Чтение пользовательских данных о смягчении"],["{{プレビューのON/OFF}}","Включение/выключение предварительного просмотра"],["{{フォント枠サイズ}}","Размер рамки шрифта"],["{{フォント枠カラー}}","Цвет шрифтовой рамки"],["{{オニオンスキン}}","Луковая шкурка"],["{{バケツツール}}","Ведерные инструменты"],["{{ペンツール}}",'Инструмент "Перо'],["{{ダブルクリックでカーブポイントが追加されます}}","Дважды щелкните, чтобы добавить точку кривой"],["{{選択ツール}}","Инструменты выбора"],["{{Shape変形ツール}}","Инструмент преобразования формы"],["{{テキストツール}}","Текстовый инструмент"],["{{矩形ツール}}",'Инструмент "Прямоугольник'],["{{楕円ツール}}",'Инструмент "Эллипс'],["{{角丸矩形ツール}}",'Инструмент "Скругленный прямоугольник'],["{{塗りのカラー}}","Цвет заливки"],["{{線のカラー}}","Цвет штриха"],["{{線の太さ}}","Ширина штриха"],["{{プロジェクトデータの読込}}","Загрузка данных проекта"],["{{プロジェクトデータを保存}}","Сохранить данные проекта"],["{{書き出し}}","Экспорт"],["{{Discordへ移動}}","Зайдите в дискорд"],["{{バグ報告}}","Сообщения об ошибках"],["{{設定}}","Настройка"],["{{タブを追加}}","Добавить вкладку"],["{{タブの一覧を表示・移動}}","Просмотр и перемещение по списку вкладок"],["{{スクリプトを追加}}","Добавить сценарий"],["{{キーフレームを追加}}","Добавить ключевой кадр"],["{{空のキーフレームを追加}}","Добавьте пустой ключевой кадр"],["{{フレームを追加}}","Добавить рамку"],["{{フレームを削除}}","Удалить рамку"],["{{再生}}","Играть"],["{{停止}}","Остановить"],["{{ループ設定}}","Настройка контура"],["{{レイヤーを追加}}","Добавить слой"],["{{レイヤーを削除}}","Удалить слой"],["{{全てのレイヤーをハイライト}}","Выделите все слои"],["{{全てのレイヤーを非表示}}","Скрыть все слои"],["{{全てのレイヤーをロック}}","Заблокируйте все слои"],["{{比率を固定}}","Фиксированный коэффициент"],["{{ステージの幅}}","Ширина сцены"],["{{背景色}}","Цвет фона"],["{{ステージの高さ}}","Высота сцены"],["{{フレームレート}}","Частота кадров"],["{{シンボル名}}","Название символа"],["{{イージング設定}}","Установка облегчения"],["{{ビデオの音量設定}}","Настройка громкости видео"],["{{自動再生}}","Автоматическое воспроизведение"],["{{テキストエリアのボーダー設定}}","Настройка границ текстовой области"],["{{テキスト入力設定}}","Настройка ввода текста"],["{{フォント選択}}","Выбор шрифта"],["{{自動サイズ調整}}","Автоматическая регулировка размера"],["{{フォントスタイルタイプ}}","Тип стиля шрифта"],["{{行揃え}}","Выровнять"],["{{改行設定}}","Установка новой строки"],["{{スクロール設定}}","Настройка прокрутки"],["{{フォントサイズ}}","Размер шрифта"],["{{フォントカラー}}","Цвет шрифта"],["{{行間}}","Пространство линии"],["{{文字幅}}","Ширина символа"],["{{左マージン}}","Левое поле"],["{{右マージン}}","Правая граница"],["{{カラー種別の選択}}","Выберите тип цвета"],["{{背景画像の選択}}","Выбор фонового изображения"],["{{カラーポインターを追加}}","Добавьте указатели цвета"],["{{カラー値}}","Цвет"],["{{アルファ(0%-100%)}}","Альфа(0%-100%)"],["{{アルファ値}}","Альфа"],["{{選択対象の幅}}","Ширина объекта выделения"],["{{選択対象のX座標}}","X координата объекта выделения"],["{{選択対象の高さ}}","Высота объекта выделения"],["{{選択対象のY座標}}","Y координата объекта выделения"],["{{選択対象の幅の伸縮}}","масштабX выбранного объекта"],["{{選択対象を回転}}","Повернуть объект"],["{{選択対象の高さの伸縮}}","scaleY выбранного объекта"],["{{アルファオフセット(-255〜255)}}","Альфа-смещение(-255〜255)"],["{{赤(0%-100%)}}","Красный(0%-100%)"],["{{赤オフセット(-255〜255)}}","Красное смещение(-255〜255)"],["{{緑(0%-100%)}}","Зеленый(0%-100%)"],["{{緑オフセット(-255〜255)}}","Зеленый зачет(-255〜255)"],["{{青(0%-100%)}}","Голубой(0%-100%)"],["{{青オフセット(-255〜255)}}","Синее смещение(-255〜255)"],["{{ブレンドモード}}","Режим наложения"],["{{フィルターを選択}}","Выберите фильтр"],["{{フィルターを追加}}","Добавить фильтр"],["{{サウンドを追加}}","Добавить звук"],["{{フィルターを表示・非表示する}}","Показать и скрыть фильтры"],["{{フィルターを削除}}","Удалить фильтр"],["{{水平方向にぼかす}}","Размытие по горизонтали"],["{{垂直方向にぼかす}}","Размытие по вертикали"],["{{フィルター強度}}","Прочность фильтра"],["{{フィルター角度}}","Угол фильтрации"],["{{シャドウのアルファ}}","Тень Альфа"],["{{シャドウのカラー}}","Цвет теней"],["{{フィルター距離}}","Расстояние между фильтрами"],["{{ハイライトのカラー}}","Цвет подсветки"],["{{ハイライトのアルファ}}","Выделение Альфа"],["{{グラデーションカラー}}","Цвет градиента"],["{{グラデーションのアルファ}}","Градиент Альфа"],["{{タブの移動・名前を変更}}","Переместить/именовать вкладки"],["{{プロジェクトを閉じる}}","Закрыть проект"],["{{上下に移動}}","Двигайтесь вверх и вниз"],["{{レイヤー変更(ダブルクリック)}}","Смена слоя (двойной щелчок)"],["{{レイヤーをハイライト}}","Выделительный слой"],["{{レイヤーを非表示}}","Скрыть слой"],["{{レイヤーをロック}}","Заблокировать слой"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Указатель кривой (двойной щелчок для включения/выключения)"],["{{インスタンス名}}","Имя экземпляра"],["{{ライブラリ内の検索}}","Поиск в библиотеке"],["{{フレームラベル}}","Рамочная этикетка"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Если проект не сохранен, данные проекта на этой вкладке не могут быть восстановлены. Вы хотите удалить вкладку?"]])}}class c extends t{createMapping(){return new Map([["{{同名のアイテムが存在します}}","Existen artículos con el mismo nombre"],["{{追加ファイル}}","Archivo adicional"],["{{既存のコンテンツ}}","Contenido existente"],["{{上書きするか、ファイル名を変更して追加するか、スキップを選択する事ができます}}","Puede elegir entre sobrescribir, renombrar y añadir archivos, u omitir"],["{{全て上書き}}","Sobrescribir todo"],["{{全てスキップ}}","Omitir todo"],["{{追加・上書き}}","Añadir o sobrescribir"],["{{スキップ}}","Omitir"],["{{表示確認したいフレームを指定}}","Especifique el marco del que desea comprobar la visualización"],["{{ファイル名を指定}}","Especifique el nombre del archivo"],["{{ファイル名}}","nombre del archivo"],["{{終了フレームを指定}}","Especifique el marco final"],["{{開始フレームを指定}}","Especifique el marco de inicio"],["{{フレーム設定}}","Ajuste del marco"],["{{書き出し設定}}","Configuración de la exportación"],["{{ファイル形式の選択}}","Seleccione el formato de archivo"],["{{ファイル形式}}","Formatos de archivo"],["{{サイズ設定}}","Ajuste del tamaño"],["{{左上}}","Arriba a la izquierda"],["{{中央上}}","Centro superior"],["{{右上}}","Arriba Derecha"],["{{中央左}}","Centro Izquierda"],["{{中央}}","Centro"],["{{中央右}}","Centro derecha"],["{{左下}}","Abajo a la izquierda"],["{{中央下}}","Abajo Centro"],["{{右下}}","Abajo a la derecha"],["{{中心点のX座標}}","Coordenada X del punto central"],["{{中心点のY座標}}","Coordenada Y del punto central"],["{{MovieClipに変換}}","Convertir a MovieClip"],["{{変換}}","transformación"],["{{ループ回数}}","Recuento de bucles"],["{{カーブポインターの削除}}","Borrar el puntero de la curva"],["{{ステージ基準}}","Criterios de la etapa"],["{{閉じる}}","Cerrar"],["{{保存}}","Guardar"],["{{リセット}}","restablecer"],["{{スクリーン}}","Pantalla"],["{{ショートカット設定}}","Configuración de los accesos directos"],["{{レイヤーカラー}}","color en capas"],["{{Next2Dを支援する}}","Apoya a Next2D"],["{{サポート}}","soporte"],["{{未使用のアイテムを削除}}","Eliminar los elementos no utilizados"],["{{レイヤーをペースト}}","Capa de pasta"],["{{レイヤーをコピー}}","Copiar capa"],["{{フレームをペースト}}","Pegar el marco"],["{{フレームをコピー}}","Copiar marco"],["{{キーフレームを削除}}","Eliminar fotogramas clave"],["{{キーフレームに空のキーフレームを追加できません}}","No se pueden añadir fotogramas clave vacíos a los fotogramas clave"],["{{ズームツール}}","Herramienta de zoom"],["{{タイムライン幅の拡大・縮小}}","Anchura de la línea de tiempo Ampliar/reducir"],["{{ガイドレイヤー}}","capa de guía"],["{{音量設定}}","Ajuste del volumen"],["{{サウンドを削除}}","Eliminar el sonido"],["{{カスタムループ}}","bucle personalizado"],["{{読込のみ}}","Sólo para leer"],["{{書込を許可}}","permiso de correos"],["{{単一行}}","Línea única"],["{{複数行}}","Multilínea"],["{{自動で折り返し}}","Envoltura automática"],["{{左寄せ}}","Izquierda"],["{{中央揃え}}","Centro"],["{{右寄せ}}","Derecha"],["{{放射状グラデーション}}","gradación radial"],["{{線形グラデーション}}","gradiente lineal"],["{{画像}}","Imagen"],["{{画像選択}}","Selección de imágenes"],["{{種別}}","Tipo"],["{{Shapeの色設定}}","Configuración del color de la forma"],["{{変形}}","deformación"],["{{カラー効果}}","Transformación del color"],["{{フィルター}}","filtro"],["{{Shapeを複製}}","Duplicar la forma"],["{{読み込み}}","leer en"],["{{新規フォルダー}}","Carpeta nueva"],["{{新規MovieClip}}","Nuevo MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Cambia el tamaño del texto para que se ajuste al marco"],["{{テキストに合わせて枠をリサイズ}}","Cambia el tamaño del marco para que se ajuste al texto"],["{{リサイズしない}}","No hay cambio de tamaño"],["{{フォント}}","fuente"],["{{テキスト}}","Texto"],["{{ループ}}","bucle"],["{{音量}}","volumen"],["{{ビデオ}}","Vídeo"],["{{イージング}}","facilitando"],["{{サウンド}}","sonido"],["{{シンボル}}","Símbolo"],["{{名前}}","Nombre"],["{{オブジェクト}}","objeto"],["{{ステージ設定}}","Puesta en escena"],["{{プレビュー}}","Previsualización"],["{{削除}}","Borrar"],["{{ペースト}}","Pegar"],["{{コピー}}","Copiar"],["{{プラグインメニュー}}","Menú de complementos"],["{{トゥイーン}}","tween"],["{{カーブポインターの追加}}","Puntero de curva adicional"],["{{パスの結合}}","Fusión de caminos"],["{{シェイプ}}","forma"],["{{キーフレームに配分}}","Asignación a los fotogramas clave"],["{{レイヤーに配分}}","Asignación a las capas"],["{{タイムライン}}","línea de tiempo"],["{{整列}}","Alinear"],["{{最背面}}","La mayor parte de la espalda"],["{{ひとつ背面へ}}","Uno en la parte trasera"],["{{ひとつ前面へ}}","Un frente"],["{{最前面}}","Frontmost"],["{{重ね順}}","Organice"],["{{プラグイン}}","plug-in"],["{{ライブラリ}}","biblioteca"],["{{プロパティ}}","propiedad"],["{{マスクレイヤー}}","capa de máscara"],["{{通常レイヤー}}","Capa normal"],["{{モーショントゥイーンの削除}}","Supresión de los tweens de movimiento"],["{{モーショントゥイーンの追加}}","Tweens de movimiento adicionales"],["{{モーダル表示}}","indicación modal"],["{{言語}}","El idioma"],["{{フォーマット}}","formato"],["{{含める}}","incluir"],["{{含めない}}","no incluir"],["{{使い方、リファレンス}}","Uso, referencia"],["{{非表示レイヤー}}","capa oculta"],["{{設定}}","configuración"],["{{デフォルトのループを利用する}}","Utiliza el bucle por defecto"],["{{フレームピッカー}}","Recogedor de marcos"],["{{ステージ左揃え}}","Alinear el escenario a la izquierda"],["{{ステージ中央揃え(水平方向)}}","Alinear el centro del escenario (horizontal)"],["{{ステージ右揃え}}","Alinear el escenario a la derecha"],["{{ステージ上揃え}}","Alinear el escenario hacia arriba"],["{{ステージ中央揃え(垂直方向)}}","Alinear el centro del escenario (vertical)"],["{{ステージ下揃え}}","Alinear el fondo del escenario"],["{{左揃え}}","Izquierda"],["{{中央揃え(水平方向)}}","Centro (Horizontal)"],["{{右揃え}}","Derecho"],["{{上揃え}}","Arriba"],["{{中央揃え(垂直方向)}}","Centro (Vertical)"],["{{下揃え}}","Fondo"],["{{開始フレーム}}","marco de inicio"],["{{終了フレーム}}","marco final"],["{{ループで再生}}","Reproducir en bucle"],["{{1回再生}}","1 reproducción"],["{{指定したフレームで固定}}","Fijado en el marco especificado"],["{{1回逆再生}}","1 reproducción inversa"],["{{逆ループで再生}}","Reproducción en bucle invertido"],["{{画面の拡大・縮小}}","Acercar y alejar la pantalla"],["{{カスタムイージングデータを保存}}","Guarda los datos de la flexión personalizada"],["{{カスタムイージングデータの読込}}","Lectura de datos de flexibilización personalizados"],["{{プレビューのON/OFF}}","Activación/desactivación de la vista previa"],["{{フォント枠サイズ}}","Tamaño del marco de la fuente"],["{{フォント枠カラー}}","Color del marco de la fuente"],["{{オニオンスキン}}","Piel de cebolla"],["{{バケツツール}}","Herramientas para cubos"],["{{ペンツール}}","Herramienta de la pluma"],["{{ダブルクリックでカーブポイントが追加されます}}","Haga doble clic para añadir un punto de curva"],["{{選択ツール}}","Herramientas de selección"],["{{Shape変形ツール}}","Herramienta de transformación de formas"],["{{テキストツール}}","Herramienta de texto"],["{{矩形ツール}}","Herramienta Rectángulo"],["{{楕円ツール}}","Herramienta Elipse"],["{{角丸矩形ツール}}","Herramienta Rectángulo Redondeado"],["{{塗りのカラー}}","Color de relleno"],["{{線のカラー}}","Color del trazo"],["{{線の太さ}}","Anchura de la carrera"],["{{プロジェクトデータの読込}}","Carga de los datos del proyecto"],["{{プロジェクトデータを保存}}","Guardar los datos del proyecto"],["{{書き出し}}","Exportar"],["{{Discordへ移動}}","Ir a la discordia"],["{{バグ報告}}","Informes de errores"],["{{設定}}","Configuración"],["{{タブを追加}}","Añadir una pestaña"],["{{タブの一覧を表示・移動}}","Ver y desplazarse por la lista de pestañas"],["{{スクリプトを追加}}","Añadir una secuencia de comandos"],["{{キーフレームを追加}}","Añadir un fotograma clave"],["{{空のキーフレームを追加}}","Añadir un fotograma clave vacío"],["{{フレームを追加}}","Añadir un marco"],["{{フレームを削除}}","Borrar el marco"],["{{再生}}","Juega a"],["{{停止}}","Detener"],["{{ループ設定}}","Ajuste del bucle"],["{{レイヤーを追加}}","Añadir una capa"],["{{レイヤーを削除}}","Eliminar la capa"],["{{全てのレイヤーをハイライト}}","Resaltar todas las capas"],["{{全てのレイヤーを非表示}}","Ocultar todas las capas"],["{{全てのレイヤーをロック}}","Bloquear todas las capas"],["{{比率を固定}}","Relación fija"],["{{ステージの幅}}","Anchura del escenario"],["{{背景色}}","Color de fondo"],["{{ステージの高さ}}","Altura del escenario"],["{{フレームレート}}","Velocidad de fotogramas"],["{{シンボル名}}","Nombre del símbolo"],["{{イージング設定}}","Ajuste de la flexibilización"],["{{ビデオの音量設定}}","Ajuste del volumen de vídeo"],["{{自動再生}}","Reproducción automática"],["{{テキストエリアのボーダー設定}}","Configuración del borde del área de texto"],["{{テキスト入力設定}}","Ajuste de la entrada de texto"],["{{フォント選択}}","Selección de fuentes"],["{{自動サイズ調整}}","Ajuste automático del tamaño"],["{{フォントスタイルタイプ}}","Tipo de letra"],["{{行揃え}}","Alinear"],["{{改行設定}}","Ajuste de la nueva línea"],["{{スクロール設定}}","Ajuste de desplazamiento"],["{{フォントサイズ}}","Tamaño de la fuente"],["{{フォントカラー}}","Color de la fuente"],["{{行間}}","Espacio de la línea"],["{{文字幅}}","Anchura de los caracteres"],["{{左マージン}}","Margen izquierdo"],["{{右マージン}}","Margen derecho"],["{{カラー種別の選択}}","Seleccione un tipo de color"],["{{背景画像の選択}}","Seleccionar una imagen de fondo"],["{{カラーポインターを追加}}","Añadir punteros de color"],["{{カラー値}}","Color"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Anchura del objeto de selección"],["{{選択対象のX座標}}","Coordenada X del objeto de selección"],["{{選択対象の高さ}}","Altura del objeto de selección"],["{{選択対象のY座標}}","Coordenada Y del objeto de selección"],["{{選択対象の幅の伸縮}}","scaleX del objeto seleccionado"],["{{選択対象を回転}}","Girar el objeto"],["{{選択対象の高さの伸縮}}","escalaY del objeto seleccionado"],["{{アルファオフセット(-255〜255)}}","Desplazamiento alfa(-255〜255)"],["{{赤(0%-100%)}}","Rojo(0%-100%)"],["{{赤オフセット(-255〜255)}}","Compensación roja(-255〜255)"],["{{緑(0%-100%)}}","Verde(0%-100%)"],["{{緑オフセット(-255〜255)}}","Compensación verde(-255〜255)"],["{{青(0%-100%)}}","Azul(0%-100%)"],["{{青オフセット(-255〜255)}}","Offset azul(-255〜255)"],["{{ブレンドモード}}","Modo de fusión"],["{{フィルターを選択}}","Seleccione un filtro"],["{{フィルターを追加}}","Añadir un filtro"],["{{サウンドを追加}}","Añadir un sonido"],["{{フィルターを表示・非表示する}}","Mostrar y ocultar filtros"],["{{フィルターを削除}}","Eliminar el filtro"],["{{水平方向にぼかす}}","Desenfoque horizontal"],["{{垂直方向にぼかす}}","Desenfoque vertical"],["{{フィルター強度}}","Fuerza del filtro"],["{{フィルター角度}}","Ángulo del filtro"],["{{シャドウのアルファ}}","Sombra Alfa"],["{{シャドウのカラー}}","Color de la sombra"],["{{フィルター距離}}","Distancia del filtro"],["{{ハイライトのカラー}}","Color de realce"],["{{ハイライトのアルファ}}","Resaltar Alpha"],["{{グラデーションカラー}}","Color degradado"],["{{グラデーションのアルファ}}","Gradiente Alfa"],["{{タブの移動・名前を変更}}","Mover/Renombrar pestañas"],["{{プロジェクトを閉じる}}","Cerrar el proyecto"],["{{上下に移動}}","Subir y bajar"],["{{レイヤー変更(ダブルクリック)}}","Cambio de capa (doble clic)"],["{{レイヤーをハイライト}}","Capa de resaltado"],["{{レイヤーを非表示}}","Ocultar capa"],["{{レイヤーをロック}}","Bloquear la capa"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Puntero de curva (doble clic para activar/desactivar)"],["{{インスタンス名}}","Nombre de la instancia"],["{{ライブラリ内の検索}}","Buscar en la biblioteca"],["{{フレームラベル}}","Etiqueta del marco"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Si el proyecto no se guarda, los datos del proyecto en esta pestaña no se pueden recuperar. ¿Desea eliminar la pestaña?"]])}}const d={VERSION:1,PREFIX:"__next2d-tools__",DATABASE_NAME:"save-data",STORE_KEY:"local",REVISION_LIMIT:100,$activeWorkSpaceId:0,$workSpaces:[],$readStatus:0,$readEnd:1,$shiftKey:!1,$ctrlKey:!1,$altKey:!1,$zoomScale:1,$currentFrame:1,$root:null};d.$Rad2Deg=180/Math.PI,d.$Deg2Rad=Math.PI/180,d.$keyLock=!1,d.$activeScript=!1,d.$previewMode=!1,d.$offsetLeft=0,d.$offsetTop=0,d.$currentCursor="auto",d.$useIds=new Map,d.$symbols=new Map,d.$copyWorkSpaceId=-1,d.$copyLibrary=null,d.$copyLayer=null,d.$copyCharacter=null,d.$canCopyLayer=!1,d.$canCopyCharacter=!1,d.$hitColor=null,d.$updated=!1,d.$languages=new Map,d.$currentLanguage=null,d.$shapePointerColor="#009900",d.$shapeLinkedPointerColor="#ffa500",d.$shortcut=new Map,d.$useShortcutSetting=!1,d.$changeLibraryId=0,d.$canvases=[];const h=window.navigator.userAgentData;h?h.getHighEntropyValues(["platform"]).then((e=>{d.$isMac=e.platform.indexOf("mac")>-1})):d.$isMac=window.navigator.userAgent.indexOf("Mac")>-1;const u=document.createElement("canvas");u.width=1,u.height=1,d.$hitContext=u.getContext("2d"),d.$getCanvas=()=>d.$canvases.length?d.$canvases.pop():document.createElement("canvas"),d.$poolCanvas=e=>{if(!(e instanceof CanvasRenderingContext2D))return;const t=e.canvas,r=t.width,a=t.height;e.clearRect(0,0,r+1,a+1),t.width=t.height=1,d.$canvases.push(t)},d.$clamp=(e,t,r)=>{const a=+e;return Math.min(Math.max(t,isNaN(a)||!isFinite(a)?0:a),r)},d.$generateShortcutKey=(e,t=null)=>{let r=1===e.length?e.toLowerCase():e;return t&&(t.shift&&(r+="Shift"),t.alt&&(r+="Alt"),t.ctrl&&(r+="Ctrl")),r},d.$isArray=e=>Array.isArray(e),d.$setCursor=(e="auto")=>{d.$currentCursor!==e&&(d.$currentCursor=e,document.documentElement.style.setProperty("--tool-cursor",e))},d.$addModalEvent=e=>{const t=e.querySelectorAll("[data-detail]");for(let e=0;e<t.length;++e){const r=t[e];r.addEventListener("mouseover",d.$fadeIn),r.addEventListener("mouseout",d.$fadeOut)}},d.$fadeIn=e=>{const t=d.$userSetting.getPublishSetting();if("modal"in t&&!t.modal)return;const r=e.currentTarget;let a=d.$currentLanguage.replace(r.dataset.detail),i=r.dataset.shortcutKey;if(i){const e=d.$shortcutSetting.viewMapping.get(r.dataset.area);a+=` (${e.has(i)?e.get(i).text:r.dataset.shortcutText})`}const s=document.getElementById("detail-modal");switch(s.textContent!==a&&(s.textContent=a),!0){case s.clientWidth+e.pageX-20>window.innerWidth:s.style.left=e.pageX-(s.clientWidth+e.pageX+10-window.innerWidth)+"px";break;case 0>e.pageX-20:s.style.left="10px";break;default:s.style.left=e.pageX-20+"px"}if(!0==s.clientHeight+e.pageY+20>window.innerHeight)s.style.top=e.pageY-s.clientHeight-20+"px";else s.style.top=`${e.pageY+20}px`;s.setAttribute("class","fadeIn"),s.dataset.timerId=setTimeout((()=>{s.classList.contains("fadeOut")||s.setAttribute("class","fadeOut")}),1500)},d.$fadeOut=()=>{const e=d.$userSetting.getPublishSetting();if("modal"in e&&!e.modal)return;const t=document.getElementById("detail-modal");clearTimeout(0|t.dataset.timerId),t.setAttribute("class","fadeOut")},d.$endMenu=e=>{const t=["timeline-menu","library-menu","tab-name-menu","timeline-layer-menu","scene-name-menu","user-setting","screen-menu","editor-modal","plugin-modal","shortcut-setting-menu","library-export-modal"];for(let r=0;r<t.length;++r){const a=t[r];if(a===e)continue;"editor-modal"===a&&d.$javaScriptEditor.active&&d.$javaScriptEditor.hide();const i=document.getElementById(a);i.classList.contains("fadeIn")&&i.setAttribute("class","fadeOut")}},d.$loadSaveData=()=>{const e=localStorage.getItem(`${d.PREFIX}@${d.DATABASE_NAME}`);if(e){localStorage.removeItem(`${d.PREFIX}@${d.DATABASE_NAME}`);const t=e.length,r=new Uint8Array(t);for(let a=0;a<t;++a)r[a]=255&e.charCodeAt(a);d.$unZlibWorker.postMessage({buffer:r,type:"local"},[r.buffer])}else{d.$launchDB().onsuccess=e=>{const t=e.target.result;t.transaction(`${d.DATABASE_NAME}`,"readonly").objectStore(`${d.DATABASE_NAME}`).get(d.STORE_KEY).onsuccess=e=>{const r=e.target.result;if(r){const e=r.length,t=new Uint8Array(e);for(let a=0;a<e;++a)t[a]=255&r.charCodeAt(a);d.$unZlibWorker.postMessage({buffer:t,type:"local"},[t.buffer])}else d.$workSpaces.push(new D),d.$screenTab.run(),d.$initializeEnd();t.close()}}}},d.$multiplicationMatrix=(e,t)=>new Float32Array([e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]),d.$setShortcut=(e,t)=>{d.$shortcut.set(e,t)},d.$deleteShortcut=e=>{d.$shortcut.has(e)&&d.$shortcut.delete(e)},d.$executeKeyCommand=e=>{if(d.$shiftKey=e.shiftKey,d.$ctrlKey=e.ctrlKey||e.metaKey,d.$altKey=e.altKey,d.$ctrlKey)switch(e.key){case"-":case"+":case";":e.stopPropagation(),e.preventDefault()}if(d.$keyLock)return;if(d.$useShortcutSetting)return e.stopPropagation(),void e.preventDefault();const t=d.$generateShortcutKey(e.key,{alt:d.$altKey,shift:d.$shiftKey,ctrl:d.$ctrlKey});d.$shortcut.has(t)&&(e.stopPropagation(),e.preventDefault(),d.$shortcut.get(t)(e))},d.$initialize=()=>{window.removeEventListener("DOMContentLoaded",d.$initialize),d.$filterClasses={BevelFilter:F,BlurFilter:k,DropShadowFilter:A,GlowFilter:T,GradientBevelFilter:B,GradientGlowFilter:P},d.$languages.set("Japanese",n),d.$languages.set("English",a),d.$languages.set("Chinese",r),d.$languages.set("Korean",o),d.$languages.set("French",i),d.$languages.set("Russia",l),d.$languages.set("Italiano",s),d.$languages.set("Spanish",c);let e=localStorage.getItem(`${d.PREFIX}@language-setting`);if(!e)switch(navigator.language){case"ja":e="Japanese";break;case"ko":e="Korean";break;case"zh":e="Chinese";break;case"fr":e="French";break;case"ru":e="Russia";break;case"it":e="Italiano";break;case"es":e="Spanish";break;default:e="English"}const t=d.$languages.get(e);d.$currentLanguage=new t,d.$loadSaveData(),window.addEventListener("keydown",d.$executeKeyCommand),window.addEventListener("keyup",(()=>{d.$shiftKey=!1,d.$ctrlKey=!1,d.$altKey=!1})),window.addEventListener("beforeunload",(e=>{d.$updated&&(e.preventDefault(),e.returnValue="データ保存中...",d.$autoSave())})),document.documentElement.style.setProperty("--timeline-frame-width","12px"),document.documentElement.style.setProperty("--screen-height",window.innerHeight-50+"px");const h=x.STAGE_DEFAULT_WIDTH,u=x.STAGE_DEFAULT_HEIGHT,m=x.STAGE_DEFAULT_FPS,g=document.getElementById("preview-display");g&&(g.style.width=`${h}px`,g.style.height=`${u}px`),"next2d"in window&&(d.$root=window.next2d.createRootMovieClip(h,u,m,{tagId:"preview-display"}),d.$root.stage._$player.stop());const p=document.getElementById("preview-stop");p&&p.addEventListener("click",d.$hidePreview),document.documentElement.style.setProperty("--ad","260px"),d.$initialize=null},window.addEventListener("DOMContentLoaded",d.$initialize),window.addEventListener("resize",(()=>{d.$rebuildTimeline()})),d.$rebuildTimeline=()=>{d.$timelineHeader._$currentFrame=-1,d.$timelineHeader.setWidth(),d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),d.$timelineScroll.setX()},d.$showPreview=()=>{d.$timelinePlayer.executeTimelineStop(),d.$javaScriptEditor.save(),d.$previewMode=!0,d.$keyLock=!0;const e=document.getElementById("player-preview");e.style.display="",e.style.zIndex="9999";const t=d.$currentWorkSpace(),r=document.getElementById("preview-display");r.style.width=`${t.stage.width}px`,r.style.height=`${t.stage.height}px`;const a=document.getElementById("preview-stop");a.style.top=r.offsetTop-20+"px",a.style.left=`${r.offsetLeft+t.stage.width}px`,a.addEventListener("click",d.$hidePreview);const i=d.$root.stage;i.frameRate=0|document.getElementById("stage-fps").value;const s=i._$player;s.width=t.stage.width,s.height=t.stage.height,s._$resize(),i.clearGlobalVariable(),i._$events=new Map,s._$broadcastEvents=new Map;const n=W.toJSON();d.$useIds.clear();const{Loader:o}=window.next2d.display,{URLRequest:l}=window.next2d.net,{Event:c}=window.next2d.events,h=new o;h.contentLoaderInfo.addEventListener(c.COMPLETE,(e=>{const t=e.currentTarget,r=d.$root.stage,a=r._$player,i=t._$data;a.width=i.stage.width,a.height=i.stage.height,a.stage.frameRate=i.stage.fps;const s=d.$intToRGB(0|`0x${i.stage.bgColor.slice(1)}`);for(a._$context._$setColor(s.R/255,s.G/255,s.B/255,1),a._$backgroundColor=[s.R/255,s.G/255,s.B/255,1],d.$root=null,d.$root=t.content;r.numChildren;)r.removeChildAt(0);r.addChild(d.$root),a._$cacheStore.reset();const{BlendMode:n}=window.next2d.display,o=a._$context;o._$globalAlpha=1,o._$globalCompositeOperation=n.NORMAL,o._$imageSmoothingEnabled=!1,o.frameBuffer.unbind(),o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,o.canvas.width,o.canvas.height),o._$bind(a._$buffer),a.play()})),h.load(new l(URL.createObjectURL(new Blob([n],{type:"application/json"})))),s._$broadcastEvents.clear(),window.next2d.media.SoundMixer.volume=1,s._$loadStatus=1,s._$updateLoadStatus()},d.$hidePreview=()=>{document.getElementById("preview-stop").removeEventListener("click",d.$hidePreview);const e=document.getElementById("player-preview");for(e.style.display="none",e.style.zIndex="0",d.$previewMode=!1,d.$activeScript||(d.$keyLock=!1);d.$root.numChildren;)d.$root.removeChild(d.$root.getChildAt(0));d.$root.stage._$player.stop()},d.$toJSON=()=>{const e=d.$activeWorkSpaceId,t=document.getElementById("view-tab-area").children,r=[];for(let e=0;e<t.length;++e){const a=t[e],i=d.$workSpaces[0|a.dataset.tabId];i&&(d.$activeWorkSpaceId=0|a.dataset.tabId,r.push(i.toJSON()))}return d.$activeWorkSpaceId=e,JSON.stringify(r)},d.$autoSave=()=>{d.$javaScriptEditor.save();const e={object:d.$toJSON(),type:"local"};d.$zlibWorkerActive?d.$zlibQueues.push(e):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(e))},d.$inverseMatrix=e=>{const t=e[2]*e[5]-e[3]*e[4],r=e[1]*e[4]-e[0]*e[5];let a=e[0]*e[3]-e[2]*e[1];if(!a||!isFinite(a))return[e[3],-e[1],-e[2],e[0],t,r];const i=1/a;return[e[3]*i,-e[1]*i,-e[2]*i,e[0]*i,t*i,r*i]},d.$toFixed4=e=>{const t=e.toString(),r=t.indexOf("e");return r>-1&&(e=+t.slice(0,r)),+e.toFixed(4)},d.$currentWorkSpace=()=>d.$workSpaces[d.$activeWorkSpaceId],d.$initializeEnd=()=>{d.$readStatus++,d.$readStatus===d.$readEnd&&(d.$addModalEvent(document),d.$currentWorkSpace().run())},d.$changeWorkSpace=e=>{d.$useIds.clear(),d.$symbols.clear(),d.$currentWorkSpace().stop(),d.$activeWorkSpaceId=0|e,d.$currentWorkSpace().run()},d.$unZlibWorker=new Worker(URL.createObjectURL(new Blob(['/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";let t,i=this;function r(r,e){let s=r.split("."),h=i;!(s[0]in h)&&h.execScript&&h.execScript("var "+s[0]);for(var n;s.length&&(n=s.shift());)s.length||e===t?h=h[n]?h[n]:h[n]={}:h[n]=e}let e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function s(t){let i,r,s,h,n,a,f,o,l,u,c=t.length,b=0,y=Number.POSITIVE_INFINITY;for(o=0;o<c;++o)t[o]>b&&(b=t[o]),t[o]<y&&(y=t[o]);for(i=1<<b,r=new(e?Uint32Array:Array)(i),s=1,h=0,n=2;s<=b;){for(o=0;o<c;++o)if(t[o]===s){for(a=0,f=h,l=0;l<s;++l)a=a<<1|1&f,f>>=1;for(u=s<<16|o,l=a;l<i;l+=n)r[l]=u;++h}++s,h<<=1,n<<=1}return[r,b,y]}function h(t,i){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=e?new Uint8Array(t):t,this.m=!1,this.i=a,this.r=!1,!i&&(i={})||(i.index&&(this.a=i.index),i.bufferSize&&(this.h=i.bufferSize),i.bufferType&&(this.i=i.bufferType),i.resize&&(this.r=i.resize)),this.i){case n:this.b=32768,this.c=new(e?Uint8Array:Array)(32768+this.h+258);break;case a:this.b=0,this.c=new(e?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var n=0,a=1,f={t:n,s:a};h.prototype.k=function(){for(;!this.m;){let N=T(this,3);switch(1&N&&(this.m=!0),N>>>=1,N){case 0:var i=this.input,r=this.a,h=this.c,f=this.b,o=i.length,l=t,u=h.length,b=t;if(this.d=this.f=0,r+1>=o)throw Error("invalid uncompressed block header: LEN");if(l=i[r++]|i[r++]<<8,r+1>=o)throw Error("invalid uncompressed block header: NLEN");if(l===~(i[r++]|i[r++]<<8))throw Error("invalid uncompressed block header: length verify");if(r+l>i.length)throw Error("input buffer is broken");switch(this.i){case n:for(;f+l>h.length;){if(l-=b=u-f,e)h.set(i.subarray(r,r+b),f),f+=b,r+=b;else for(;b--;)h[f++]=i[r++];this.b=f,h=this.e(),f=this.b}break;case a:for(;f+l>h.length;)h=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(e)h.set(i.subarray(r,r+l),f),f+=l,r+=l;else for(;l--;)h[f++]=i[r++];this.a=r,this.b=f,this.c=h;break;case 1:this.j(E,I);break;case 2:var y,p,d,g,w=T(this,5)+257,A=T(this,5)+1,v=T(this,4)+4,k=new(e?Uint8Array:Array)(c.length),m=t,U=t,z=t,j=t,x=t;for(x=0;x<v;++x)k[c[x]]=T(this,3);if(!e)for(x=v,v=k.length;x<v;++x)k[c[x]]=0;for(y=s(k),m=new(e?Uint8Array:Array)(w+A),x=0,g=w+A;x<g;)switch(U=S(this,y)){case 16:for(j=3+T(this,2);j--;)m[x++]=z;break;case 17:for(j=3+T(this,3);j--;)m[x++]=0;z=0;break;case 18:for(j=11+T(this,7);j--;)m[x++]=0;z=0;break;default:z=m[x++]=U}p=s(e?m.subarray(0,w):m.slice(0,w)),d=s(e?m.subarray(w):m.slice(w)),this.j(p,d);break;default:throw Error("unknown BTYPE: "+N)}}return this.n()};var o,l,u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=e?new Uint16Array(u):u,b=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],y=e?new Uint16Array(b):b,p=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],d=e?new Uint8Array(p):p,g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],w=e?new Uint16Array(g):g,A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],v=e?new Uint8Array(A):A,k=new(e?Uint8Array:Array)(288);for(o=0,l=k.length;o<l;++o)k[o]=143>=o?8:255>=o?9:279>=o?7:8;var m,U,E=s(k),z=new(e?Uint8Array:Array)(30);for(m=0,U=z.length;m<U;++m)z[m]=5;var I=s(z);function T(t,i){for(var r,e=t.f,s=t.d,h=t.input,n=t.a,a=h.length;s<i;){if(n>=a)throw Error("input buffer is broken");e|=h[n++]<<s,s+=8}return r=e&(1<<i)-1,t.f=e>>>i,t.d=s-i,t.a=n,r}function S(t,i){for(var r,e,s=t.f,h=t.d,n=t.input,a=t.a,f=n.length,o=i[0],l=i[1];h<l&&!(a>=f);)s|=n[a++]<<h,h+=8;if((e=(r=o[s&(1<<l)-1])>>>16)>h)throw Error("invalid code length: "+e);return t.f=s>>e,t.d=h-e,t.a=a,65535&r}function j(t,i){let r,e;if(this.input=t,this.a=0,!i&&(i={})||(i.index&&(this.a=i.index),i.verify&&(this.A=i.verify)),r=t[this.a++],e=t[this.a++],(15&r)!==x)throw Error("unsupported compression method");if(this.method=x,0!=((r<<8)+e)%31)throw Error("invalid fcheck flag:"+((r<<8)+e)%31);if(32&e)throw Error("fdict flag is not supported");this.q=new h(t,{index:this.a,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}h.prototype.j=function(t,i){let r=this.c,e=this.b;this.o=t;for(var s,h,n,a,f=r.length-258;256!==(s=S(this,t));)if(256>s)e>=f&&(this.b=e,r=this.e(),e=this.b),r[e++]=s;else for(a=y[h=s-257],0<d[h]&&(a+=T(this,d[h])),s=S(this,i),n=w[s],0<v[s]&&(n+=T(this,v[s])),e>=f&&(this.b=e,r=this.e(),e=this.b);a--;)r[e]=r[e++-n];for(;8<=this.d;)this.d-=8,this.a--;this.b=e},h.prototype.w=function(t,i){let r=this.c,e=this.b;this.o=t;for(var s,h,n,a,f=r.length;256!==(s=S(this,t));)if(256>s)e>=f&&(r=this.e(),f=r.length),r[e++]=s;else for(a=y[h=s-257],0<d[h]&&(a+=T(this,d[h])),s=S(this,i),n=w[s],0<v[s]&&(n+=T(this,v[s])),e+a>f&&(r=this.e(),f=r.length);a--;)r[e]=r[e++-n];for(;8<=this.d;)this.d-=8,this.a--;this.b=e},h.prototype.e=function(){let t,i,r=new(e?Uint8Array:Array)(this.b-32768),s=this.b-32768,h=this.c;if(e)r.set(h.subarray(32768,r.length));else for(t=0,i=r.length;t<i;++t)r[t]=h[t+32768];if(this.g.push(r),this.l+=r.length,e)h.set(h.subarray(s,s+32768));else for(t=0;32768>t;++t)h[t]=h[s+t];return this.b=32768,h},h.prototype.z=function(t){let i,r,s,h,n=this.input.length/this.a+1|0,a=this.input,f=this.c;return t&&("number"==typeof t.p&&(n=t.p),"number"==typeof t.u&&(n+=t.u)),2>n?(r=(a.length-this.a)/this.o[2],h=r/2*258|0,s=h<f.length?f.length+h:f.length<<1):s=f.length*n,e?(i=new Uint8Array(s),i.set(f)):i=f,this.c=i},h.prototype.n=function(){let t,i,r,s,h,n=0,a=this.c,f=this.g,o=new(e?Uint8Array:Array)(this.l+(this.b-32768));if(0===f.length)return e?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(i=0,r=f.length;i<r;++i)for(t=f[i],s=0,h=t.length;s<h;++s)o[n++]=t[s];for(i=32768,r=this.b;i<r;++i)o[n++]=a[i];return this.g=[],this.buffer=o},h.prototype.v=function(){let t,i=this.b;return e?this.r?(t=new Uint8Array(i),t.set(this.c.subarray(0,i))):t=this.c.subarray(0,i):(this.c.length>i&&(this.c.length=i),t=this.c),this.buffer=t},j.prototype.k=function(){let t,i,r=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){i=(r[this.a++]<<24|r[this.a++]<<16|r[this.a++]<<8|r[this.a++])>>>0;let f=t;if("string"==typeof f){let t,i,r=f.split("");for(t=0,i=r.length;t<i;t++)r[t]=(255&r[t].charCodeAt(0))>>>0;f=r}for(var e,s=1,h=0,n=f.length,a=0;0<n;){n-=e=1024<n?1024:n;do{h+=s+=f[a++]}while(--e);s%=65521,h%=65521}if(i!==(h<<16|s)>>>0)throw Error("invalid adler-32 checksum")}return t};var x=8;r("Zlib.Inflate",j),r("Zlib.Inflate.prototype.decompress",j.prototype.k);let N,C,L,O,Z={ADAPTIVE:f.s,BLOCK:f.t};if(Object.keys)N=Object.keys(Z);else for(C in N=[],L=0,Z)N[L++]=C;for(L=0,O=N.length;L<O;++L)C=N[L],r("Zlib.Inflate.BufferType."+C,Z[C])}).call(this),this.addEventListener("message",(function(t){const i=new Zlib.Inflate(t.data.buffer).decompress();let r="";for(let t=0;t<i.length;t+=4096)r+=String.fromCharCode.apply(null,i.slice(t,t+4096));this.postMessage({json:r,name:t.data.name,type:t.data.type})}));'],{type:"text/javascript"}))),d.$unZlibWorker.onmessage=e=>{if("n2d"===e.data.type){const t=new D(decodeURIComponent(e.data.json));t.name=e.data.name,d.$workSpaces.push(t),d.$screenTab.createElement(t,d.$workSpaces.length-1)}else{const t=JSON.parse(decodeURIComponent(e.data.json));for(let e=0;e<t.length;++e)d.$workSpaces.push(new D(t[e]));d.$workSpaces.length||d.$workSpaces.push(new D),d.$screenTab.run(),d.$initializeEnd()}},d.$zlibWorker=new Worker(URL.createObjectURL(new Blob(['/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";let e,r=!0,t=this;function n(r,n){let a=r.split("."),i=t;!(a[0]in i)&&i.execScript&&i.execScript("var "+a[0]);for(var s;a.length&&(s=a.shift());)a.length||n===e?i=i[s]?i[s]:i[s]={}:i[s]=n}let a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function i(e,r){if(this.index="number"==typeof r?r:0,this.e=0,this.buffer=e instanceof(a?Uint8Array:Array)?e:new(a?Uint8Array:Array)(32768),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&s(this)}function s(e){let r,t=e.buffer,n=t.length,i=new(a?Uint8Array:Array)(n<<1);if(a)i.set(t);else for(r=0;r<n;++r)i[r]=t[r];return e.buffer=i}i.prototype.b=function(e,r,t){let n,a=this.buffer,i=this.index,f=this.e,h=a[i];if(t&&1<r&&(e=8<r?(l[255&e]<<24|l[e>>>8&255]<<16|l[e>>>16&255]<<8|l[e>>>24&255])>>32-r:l[e]>>8-r),8>r+f)h=h<<r|e,f+=r;else for(n=0;n<r;++n)h=h<<1|e>>r-n-1&1,8==++f&&(f=0,a[i++]=l[h],h=0,i===a.length&&(a=s(this)));a[i]=h,this.buffer=a,this.e=f,this.index=i},i.prototype.finish=function(){let e,r=this.buffer,t=this.index;return 0<this.e&&(r[t]<<=8-this.e,r[t]=l[r[t]],t++),a?e=r.subarray(0,t):(r.length=t,e=r),e};let f,h=new(a?Uint8Array:Array)(256);for(f=0;256>f;++f){for(var o=u=f,c=7,u=u>>>1;u;u>>>=1)o<<=1,o|=1&u,--c;h[f]=(o<<c&255)>>>0}var l=h;function b(e){this.buffer=new(a?Uint16Array:Array)(2*e),this.length=0}function y(e,r){this.d=g,this.i=0,this.input=a&&e instanceof Array?new Uint8Array(e):e,this.c=0,r&&(r.lazy&&(this.i=r.lazy),"number"==typeof r.compressionType&&(this.d=r.compressionType),r.outputBuffer&&(this.a=a&&r.outputBuffer instanceof Array?new Uint8Array(r.outputBuffer):r.outputBuffer),"number"==typeof r.outputIndex&&(this.c=r.outputIndex)),this.a||(this.a=new(a?Uint8Array:Array)(32768))}b.prototype.getParent=function(e){return 2*((e-2)/4|0)},b.prototype.push=function(e,r){let t,n,a,i=this.buffer;for(t=this.length,i[this.length++]=r,i[this.length++]=e;0<t&&(n=this.getParent(t),i[t]>i[n]);)a=i[t],i[t]=i[n],i[n]=a,a=i[t+1],i[t+1]=i[n+1],i[n+1]=a,t=n;return this.length},b.prototype.pop=function(){let e,r,t,n,a,i=this.buffer;for(r=i[0],e=i[1],this.length-=2,i[0]=i[this.length],i[1]=i[this.length+1],a=0;(n=2*a+2,!(n>=this.length))&&(n+2<this.length&&i[n+2]>i[n]&&(n+=2),i[n]>i[a]);)t=i[a],i[a]=i[n],i[n]=t,t=i[a+1],i[a+1]=i[n+1],i[n+1]=t,a=n;return{index:e,value:r,length:this.length}};var p,g=2,A={NONE:0,h:1,g:g,n:3},k=[];for(p=0;288>p;p++)switch(r){case 143>=p:k.push([p+48,8]);break;case 255>=p:k.push([p-144+400,9]);break;case 279>=p:k.push([p-256+0,7]);break;case 287>=p:k.push([p-280+192,8]);break;default:throw"invalid literal: "+p}function w(e,r){this.length=e,this.k=r}y.prototype.f=function(){let t,n,s,f,h=this.input;switch(this.d){case 0:for(s=0,f=h.length;s<f;){n=a?h.subarray(s,s+65535):h.slice(s,s+65535),s+=n.length;let r=n,t=s===f,i=e,o=e,c=e,u=e,l=e,b=this.a,y=this.c;if(a){for(b=new Uint8Array(this.a.buffer);b.length<=y+r.length+5;)b=new Uint8Array(b.length<<1);b.set(this.a)}if(i=t?1:0,b[y++]=0|i,o=r.length,c=65536+~o&65535,b[y++]=255&o,b[y++]=o>>>8&255,b[y++]=255&c,b[y++]=c>>>8&255,a)b.set(r,y),y+=r.length,b=b.subarray(0,y);else{for(u=0,l=r.length;u<l;++u)b[y++]=r[u];b.length=y}this.c=y,this.a=b}break;case 1:var o=new i(a?new Uint8Array(this.a.buffer):this.a,this.c);o.b(1,1,r),o.b(1,2,r);var c,u,l,b=v(this,h);for(c=0,u=b.length;c<u;c++)if(l=b[c],i.prototype.b.apply(o,k[l]),256<l)o.b(b[++c],b[++c],r),o.b(b[++c],5),o.b(b[++c],b[++c],r);else if(256===l)break;this.a=o.finish(),this.c=this.a.length;break;case g:var y,p,A,w,d,U,m,D,E,j,O,Z,B,C,I,M=new i(a?new Uint8Array(this.a.buffer):this.a,this.c),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=Array(19);for(y=g,M.b(1,1,r),M.b(y,2,r),p=v(this,h),m=N(U=x(this.m,15)),E=N(D=x(this.l,7)),A=286;257<A&&0===U[A-1];A--);for(w=30;1<w&&0===D[w-1];w--);var S,L,P,F,G,J,R=A,V=w,X=new(a?Uint32Array:Array)(R+V),Y=new(a?Uint32Array:Array)(316),q=new(a?Uint8Array:Array)(19);for(S=L=0;S<R;S++)X[L++]=U[S];for(S=0;S<V;S++)X[L++]=D[S];if(!a)for(S=0,F=q.length;S<F;++S)q[S]=0;for(S=G=0,F=X.length;S<F;S+=L){for(L=1;S+L<F&&X[S+L]===X[S];++L);if(P=L,0===X[S])if(3>P)for(;0<P--;)Y[G++]=0,q[0]++;else for(;0<P;)(J=138>P?P:138)>P-3&&J<P&&(J=P-3),10>=J?(Y[G++]=17,Y[G++]=J-3,q[17]++):(Y[G++]=18,Y[G++]=J-11,q[18]++),P-=J;else if(Y[G++]=X[S],q[X[S]]++,3>--P)for(;0<P--;)Y[G++]=X[S],q[X[S]]++;else for(;0<P;)(J=6>P?P:6)>P-3&&J<P&&(J=P-3),Y[G++]=16,Y[G++]=J-3,q[16]++,P-=J}for(t=a?Y.subarray(0,G):Y.slice(0,G),j=x(q,7),C=0;19>C;C++)z[C]=j[T[C]];for(d=19;4<d&&0===z[d-1];d--);for(O=N(j),M.b(A-257,5,r),M.b(w-1,5,r),M.b(d-4,4,r),C=0;C<d;C++)M.b(z[C],3,r);for(C=0,I=t.length;C<I;C++)if(Z=t[C],M.b(O[Z],j[Z],r),16<=Z){switch(C++,Z){case 16:B=2;break;case 17:B=3;break;case 18:B=7;break;default:throw"invalid code: "+Z}M.b(t[C],B,r)}var H,K,Q,W,$,_,ee,re,te=[m,U],ne=[E,D];for($=te[0],_=te[1],ee=ne[0],re=ne[1],H=0,K=p.length;H<K;++H)if(Q=p[H],M.b($[Q],_[Q],r),256<Q)M.b(p[++H],p[++H],r),W=p[++H],M.b(ee[W],re[W],r),M.b(p[++H],p[++H],r);else if(256===Q)break;this.a=M.finish(),this.c=this.a.length;break;default:throw"invalid compression type"}return this.a};let d=function(){function e(e){switch(r){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:throw"invalid length: "+e}}let t,n,a=[];for(t=3;258>=t;t++)n=e(t),a[t]=n[2]<<24|n[1]<<16|n[0];return a}(),U=a?new Uint32Array(d):d;function v(t,n){function i(e,t){let n,a,i,s,f=e.k,h=[],o=0;switch(n=U[e.length],h[o++]=65535&n,h[o++]=n>>16&255,h[o++]=n>>24,r){case 1===f:a=[0,f-1,0];break;case 2===f:a=[1,f-2,0];break;case 3===f:a=[2,f-3,0];break;case 4===f:a=[3,f-4,0];break;case 6>=f:a=[4,f-5,1];break;case 8>=f:a=[5,f-7,1];break;case 12>=f:a=[6,f-9,2];break;case 16>=f:a=[7,f-13,2];break;case 24>=f:a=[8,f-17,3];break;case 32>=f:a=[9,f-25,3];break;case 48>=f:a=[10,f-33,4];break;case 64>=f:a=[11,f-49,4];break;case 96>=f:a=[12,f-65,5];break;case 128>=f:a=[13,f-97,5];break;case 192>=f:a=[14,f-129,6];break;case 256>=f:a=[15,f-193,6];break;case 384>=f:a=[16,f-257,7];break;case 512>=f:a=[17,f-385,7];break;case 768>=f:a=[18,f-513,8];break;case 1024>=f:a=[19,f-769,8];break;case 1536>=f:a=[20,f-1025,9];break;case 2048>=f:a=[21,f-1537,9];break;case 3072>=f:a=[22,f-2049,10];break;case 4096>=f:a=[23,f-3073,10];break;case 6144>=f:a=[24,f-4097,11];break;case 8192>=f:a=[25,f-6145,11];break;case 12288>=f:a=[26,f-8193,12];break;case 16384>=f:a=[27,f-12289,12];break;case 24576>=f:a=[28,f-16385,13];break;case 32768>=f:a=[29,f-24577,13];break;default:throw"invalid distance"}for(n=a,h[o++]=n[0],h[o++]=n[1],h[o++]=n[2],i=0,s=h.length;i<s;++i)g[A++]=h[i];w[h[0]]++,d[h[3]]++,k=e.length+t-1,b=null}var s,f,h,o,c,u,l,b,y,p={},g=a?new Uint16Array(2*n.length):[],A=0,k=0,w=new(a?Uint32Array:Array)(286),d=new(a?Uint32Array:Array)(30),v=t.i;if(!a){for(h=0;285>=h;)w[h++]=0;for(h=0;29>=h;)d[h++]=0}for(w[256]=1,s=0,f=n.length;s<f;++s){for(h=c=0,o=3;h<o&&s+h!==f;++h)c=c<<8|n[s+h];if(p[c]===e&&(p[c]=[]),u=p[c],!(0<k--)){for(;0<u.length&&32768<s-u[0];)u.shift();if(s+3>=f){for(b&&i(b,-1),h=0,o=f-s;h<o;++h)y=n[s+h],g[A++]=y,++w[y];break}0<u.length?(l=m(n,s,u),b?b.length<l.length?(y=n[s-1],g[A++]=y,++w[y],i(l,0)):i(b,-1):l.length<v?b=l:i(l,0)):b?i(b,-1):(y=n[s],g[A++]=y,++w[y])}u.push(s)}return g[A++]=256,w[256]++,t.m=w,t.l=d,a?g.subarray(0,A):g}function m(e,r,t){let n,a,i,s,f,h,o=0,c=e.length;s=0,h=t.length;e:for(;s<h;s++){if(n=t[h-s-1],i=3,3<o){for(f=o;3<f;f--)if(e[n+f-1]!==e[r+f-1])continue e;i=o}for(;258>i&&r+i<c&&e[n+i]===e[r+i];)++i;if(i>o&&(a=n,o=i),258===i)break}return new w(o,r-a)}function x(e,r){let t,n,i,s,f,h=e.length,o=new b(572),c=new(a?Uint8Array:Array)(h);if(!a)for(s=0;s<h;s++)c[s]=0;for(s=0;s<h;++s)0<e[s]&&o.push(s,e[s]);if(t=Array(o.length/2),n=new(a?Uint32Array:Array)(o.length/2),1===t.length)return c[o.pop().index]=1,c;for(s=0,f=o.length/2;s<f;++s)t[s]=o.pop(),n[s]=t[s].value;for(i=function(e,r,t){function n(e){let t=y[e][p[e]];t===r?(n(e+1),n(e+1)):--l[t],++p[e]}var i,s,f,h,o,c=new(a?Uint16Array:Array)(t),u=new(a?Uint8Array:Array)(t),l=new(a?Uint8Array:Array)(r),b=Array(t),y=Array(t),p=Array(t),g=(1<<t)-r,A=1<<t-1;for(c[t-1]=r,s=0;s<t;++s)g<A?u[s]=0:(u[s]=1,g-=A),g<<=1,c[t-2-s]=(c[t-1-s]/2|0)+r;for(c[0]=u[0],b[0]=Array(c[0]),y[0]=Array(c[0]),s=1;s<t;++s)c[s]>2*c[s-1]+u[s]&&(c[s]=2*c[s-1]+u[s]),b[s]=Array(c[s]),y[s]=Array(c[s]);for(i=0;i<r;++i)l[i]=t;for(f=0;f<c[t-1];++f)b[t-1][f]=e[f],y[t-1][f]=f;for(i=0;i<t;++i)p[i]=0;for(1===u[t-1]&&(--l[0],++p[t-1]),s=t-2;0<=s;--s){for(h=i=0,o=p[s+1],f=0;f<c[s];f++)(h=b[s+1][o]+b[s+1][o+1])>e[i]?(b[s][f]=h,y[s][f]=r,o+=2):(b[s][f]=e[i],y[s][f]=i,++i);p[s]=0,1===u[s]&&n(s)}return l}(n,n.length,r),s=0,f=t.length;s<f;++s)c[t[s].index]=i[s];return c}function N(e){let r,t,n,i,s=new(a?Uint16Array:Array)(e.length),f=[],h=[],o=0;for(r=0,t=e.length;r<t;r++)f[e[r]]=1+(0|f[e[r]]);for(r=1,t=16;r<=t;r++)h[r]=o,o+=0|f[r],o<<=1;for(r=0,t=e.length;r<t;r++)for(o=h[e[r]],h[e[r]]+=1,n=s[r]=0,i=e[r];n<i;n++)s[r]=s[r]<<1|1&o,o>>>=1;return s}function D(e,r){this.input=e,this.a=new(a?Uint8Array:Array)(32768),this.d=E.g;let t,n={};for(t in!r&&(r={})||"number"!=typeof r.compressionType||(this.d=r.compressionType),r)n[t]=r[t];n.outputBuffer=this.a,this.j=new y(this.input,n)}var E=A;D.prototype.f=function(){let e,r,t,n,i,s,f=0;switch(s=this.a,e=Math.LOG2E*Math.log(32768)-8,r=e<<4|8,s[f++]=r,this.d){case E.NONE:n=0;break;case E.h:n=1;break;case E.g:n=2;break;default:throw Error("unsupported compression type")}t=n<<6|0,s[f++]=t|31-(256*r+t)%31;let h=this.input;if("string"==typeof h){let e,r,t=h.split("");for(e=0,r=t.length;e<r;e++)t[e]=(255&t[e].charCodeAt(0))>>>0;h=t}for(var o,c=1,u=0,l=h.length,b=0;0<l;){l-=o=1024<l?1024:l;do{u+=c+=h[b++]}while(--o);c%=65521,u%=65521}return i=(u<<16|c)>>>0,this.j.c=f,s=this.j.f(),f=s.length,a&&(s=new Uint8Array(s.buffer),s.length<=f+4&&(this.a=new Uint8Array(s.length+4),this.a.set(s),s=this.a),s=s.subarray(0,f+4)),s[f++]=i>>24&255,s[f++]=i>>16&255,s[f++]=i>>8&255,s[f++]=255&i,s},n("Zlib.Deflate",D),n("Zlib.Deflate.compress",(function(e,r){return new D(e,r).f()})),n("Zlib.Deflate.prototype.compress",D.prototype.f);let j,O,Z,B,C={NONE:E.NONE,FIXED:E.h,DYNAMIC:E.g};if(Object.keys)j=Object.keys(C);else for(O in j=[],Z=0,C)j[Z++]=O;for(Z=0,B=j.length;Z<B;++Z)O=j[Z],n("Zlib.Deflate.CompressionType."+O,C[O])}).call(this),this.addEventListener("message",(function(e){const r=encodeURIComponent(e.data.object),t=new Uint8Array(r.length);for(let e=0;e<r.length;++e)t[e]=r[e].charCodeAt(0);const n=e.data.type;if("json"===n)this.postMessage({json:JSON.stringify({buffer:Array.from(new Zlib.Deflate(t).compress()),type:"zlib"}),type:n});else{const e=new Zlib.Deflate(t).compress();this.postMessage({buffer:e,type:n},[e.buffer])}}));'],{type:"text/javascript"}))),d.$zlibWorker.onmessage=e=>{const t=e.data.type;switch(t){case"json":case"n2d":{const r=document.getElementById("save-anchor");r.href&&URL.revokeObjectURL(r.href),r.download=`${d.$currentWorkSpace().name}.${t}`,r.href="json"===t?URL.createObjectURL(new Blob([e.data.json],{type:"application/json"})):URL.createObjectURL(new Blob([e.data.buffer],{type:"text/plain"})),r.click()}break;case"local":{const t=e.data.buffer;let r="";for(let e=0;e<t.length;e+=4096)r+=String.fromCharCode.apply(null,t.slice(e,e+4096));d.$launchDB().onsuccess=e=>{const t=e.target.result.transaction(`${d.DATABASE_NAME}`,"readwrite");t.objectStore(`${d.DATABASE_NAME}`).put(r,d.STORE_KEY),t.oncomplete=e=>{e.target.db.close(),d.$updated=!1},t.commit()}}}d.$zlibQueues.length?d.$zlibWorker.postMessage(d.$zlibQueues.pop()):d.$zlibWorkerActive=!1},d.$zlibQueues=[],d.$zlibWorkerActive=!1,d.$unzipURL=URL.createObjectURL(new Blob(['const Util={};Util.$Uint8Array=Uint8Array,Util.$Uint16Array=Uint16Array,Util.$Int16Array=Int16Array,Util.$ArrayBuffer=ArrayBuffer,Util.$max=Math.max,Util.$min=Math.min,Util.$potArrayBuffers=new Map,Util.$codeTables=[],Util.$getCodeTable=function(t,e){const i=Util.$codeTables.pop()||{key:null,value:null};return i.key=t,i.value=e,i},Util.$poolCodeTable=function(t){Util.$codeTables.push(t)},Util.$poolTypedArrayBuffer=function(t){const e=t.buffer,i=e.byteLength;if(!i||i!==Util.$upperPowerOfTwo(i))return;let r=Util.$potArrayBuffers.get(i);r||(r=[],Util.$potArrayBuffers.set(i,r)),r.push(e)},Util.$upperPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},Util.$getUint8Array=function(t){let e;const i=Util.$upperPowerOfTwo(t),r=Util.$potArrayBuffers.get(i),l=r&&r.pop();return l?(e=new Util.$Uint8Array(l,0,t),e.fill(0)):e=new Util.$Uint8Array(new Util.$ArrayBuffer(i),0,t),e},Util.$getUint16Array=function(t){let e;const i=Util.$upperPowerOfTwo(2*t),r=Util.$potArrayBuffers.get(i),l=r&&r.pop();return l?(e=new Util.$Uint16Array(l,0,t),e.fill(0)):e=new Util.$Uint16Array(new Util.$ArrayBuffer(i),0,t),e},Util.$fixedDistTable={key:new Util.$Uint16Array([5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5]),value:new Util.$Uint16Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31])},Util.$fixedLitTable={key:new Util.$Uint16Array([7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9]),value:new Util.$Uint16Array([256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,280,281,282,283,284,285,286,287,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255])},Util.$ORDER=new Util.$Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Util.$LEXT=new Util.$Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99]),Util.$LENS=new Util.$Int16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Util.$DEXT=new Util.$Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Util.$DISTS=new Util.$Int16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]);class ByteStream{constructor(){this.initialization()}initialization(){this.data=null,this.bit_offset=0,this.byte_offset=0,this.bit_buffer=null}byteAlign(){this.bit_offset&&(this.byte_offset=this.byte_offset+(this.bit_offset+7)/8|0,this.bit_offset=0)}getData(t){this.byteAlign();const e=this.byte_offset+t,i=this.data.slice(this.byte_offset,e);return this.byte_offset=e,i}setOffset(t,e){this.byte_offset=t,this.bit_offset=e}unzip(t,e=0){let i=e;const r=Util.$getUint8Array(19);let l=null,a=null;for(;;){const e=this.readUB(1),s=this.readUB(2);if(l&&(Util.$poolCodeTable(l),Util.$poolCodeTable(a)),l=null,a=null,s){if(1===s)l=Util.$fixedDistTable,a=Util.$fixedLitTable;else{const t=this.readUB(5)+257,e=this.readUB(5)+1,i=this.readUB(4)+4;for(let t=0;t<i;++t)r[Util.$ORDER[t]]=this.readUB(3);const s=this.buildHuffTable(r);r.fill(0);const f=t+e|0,o=Util.$getUint8Array(f);let n=0;for(let t=0;t<f;){const e=this.decodeSymbol(s.key,s.value);switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:o[t++]=e,n=e;break;case 16:{let e=this.readUB(2)+3|0;for(;e;)--e,o[t++]=n}break;case 17:{let e=this.readUB(3)+3|0;for(;e;)--e,o[t++]=0}break;case 18:{let e=this.readUB(7)+11|0;for(;e;)--e,o[t++]=0}}}Util.$poolCodeTable(s),l=this.buildHuffTable(o.subarray(t)),a=this.buildHuffTable(o.subarray(0,t)),Util.$poolTypedArrayBuffer(o),Util.$poolTypedArrayBuffer(s.key),Util.$poolTypedArrayBuffer(s.value)}for(;;){const e=0|this.decodeSymbol(a.key,a.value);if(256===e)break;if(e<256)t[i++]=e;else{const r=e-257|0;let a=Util.$LENS[r]+this.readUB(Util.$LEXT[r])|0;const s=this.decodeSymbol(l.key,l.value);let f=i-(Util.$DISTS[s]+this.readUB(Util.$DEXT[s])|0)|0;for(;a;)--a,t[i++]=t[f++]}}}else{this.bit_offset=8,this.bit_buffer=null;const e=0|this.readNumber(2);this.byte_offset+=2;for(let r=0;r<e;++r)t[i++]=this.readNumber(1)}if(e)break}Util.$poolTypedArrayBuffer(r)}buildHuffTable(t){const e=t.length,i=Util.$max.apply(null,t),r=Util.$getUint8Array(i),l=Util.$getUint16Array(i+1);let a=0,s=0,f=e;for(;f;)s=t[--f],s&&++r[s];let o=0;for(let t=0;t<i;)a=a+r[t++]<<1,l[t]=a,o=Util.$max(o,a);const n=o+e,U=Util.$getUint16Array(n),u=Util.$getUint16Array(n);for(let i=0;i<e;++i)if(s=t[i],s){const t=l[s];U[t]=s,u[t]=i,l[s]=t+1|0}return Util.$poolTypedArrayBuffer(r),Util.$poolTypedArrayBuffer(l),Util.$getCodeTable(U,u)}decodeSymbol(t,e){let i=0,r=0;for(;;)if(i=i<<1|this.readUB(1),++r,t[i]===r)return e[i]}readUB(t){let e=0;for(let i=0;i<t;++i)8===this.bit_offset&&(this.bit_buffer=this.readNumber(1),this.bit_offset=0),e|=(this.bit_buffer&1<<this.bit_offset++?1:0)<<i;return e}readNumber(t){let e=0;const i=this.byte_offset;let r=i+t|0;for(;r>i;)e=e<<8|this.data[--r];return this.byte_offset+=t,e}}Util.$byteStream=new ByteStream,Util.$lossless=function(t,e,i,r,l,a){const s=new Util.$Uint8Array(e*i*4);if(3===r){const r=(e+3&-4)-e;let f=0;if(a){let a=4*l;for(let l=0;l<i;++l){for(let i=0;i<e;++i){const e=4*t[a++],i=t[e+3];if(0===i){s[f++]=0,s[f++]=0,s[f++]=0,s[f++]=0;continue}const r=t[e],l=t[e+1],o=t[e+2];255!==i?(s[f++]=255&Util.$min(r/i*255,255),s[f++]=255&Util.$min(l/i*255,255),s[f++]=255&Util.$min(o/i*255,255),s[f++]=i):(s[f++]=r,s[f++]=l,s[f++]=o,s[f++]=i)}a+=r}return s}let o=3*l;for(let l=0;l<i;++l){for(let i=0;i<e;++i){const e=3*t[o++];s[f++]=t[e],s[f++]=t[e+1],s[f++]=t[e+2],s[f++]=255}o+=r}return s}const f=e*i;if(a){for(let e=0;e<f;++e){const i=4*e,r=i,l=i+1,a=i+2,f=i+3,o=t[r];0!==o?255!==o?(s[r]=255&Util.$min(t[l]/o*255,255),s[l]=255&Util.$min(t[a]/o*255,255),s[a]=255&Util.$min(t[f]/o*255,255),s[f]=o):(s[r]=t[l],s[l]=t[a],s[a]=t[f],s[f]=o):(s[r]=0,s[l]=0,s[a]=0,s[f]=0)}return s}for(let e=0;e<f;++e){const i=4*e,r=i+1,l=i+2,a=i+3;s[i]=t[r],s[r]=t[l],s[l]=t[a],s[a]=255}return s},this.addEventListener("message",(function(t){const e=Util.$byteStream;switch(t.data.mode){case"swf":{e.data=t.data.buffer;const i=t.data.fileSize,r=new Util.$Uint8Array(i),l=e.getData(8);e.setOffset(10,8),r.set(l,0),e.unzip(r,8),this.postMessage({buffer:r,mode:t.data.mode},[r.buffer])}break;case"lossless":{const i=t.data,r=new Util.$Uint8Array(i.fileSize);e.data=t.data.buffer,e.setOffset(2,8),e.unzip(r,0);const l=Util.$lossless(r,i.width,i.height,i.format,i.tableSize,i.isAlpha);this.postMessage({buffer:l,mode:t.data.mode},[l.buffer])}break;case"jpegAlpha":{const i=t.data.width*t.data.height,r=new Util.$Uint8Array(i);e.data=t.data.alphaData,e.setOffset(2,8),e.unzip(r,0),t.data.alphaData=r,this.postMessage(t.data,[t.data.buffer.buffer,t.data.alphaData.buffer])}}Util.$byteStream.initialization()}));'],{type:"text/javascript"})),d.$unzipWorker=null,d.$unzipQueues=[],d.$unzipWorkerActive=!1,d.$launchDB=()=>{const e=indexedDB.open(`${d.PREFIX}@${d.DATABASE_NAME}`);return e.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(`${d.DATABASE_NAME}`)||t.createObjectStore(`${d.DATABASE_NAME}`)},e},d.$unzipHandler=function(e){const t=e.target;switch(t.onmessage=null,e.data.mode){case"swf":this._$byteStream._$buffer=e.data.buffer,this.parseAndBuild();break;case"lossless":{const t=d.$currentWorkSpace().getLibrary(this.libraryId);t._$buffer=e.data.buffer,t._$command=null}break;case"jpegAlpha":{const t=e.data.buffer,r=e.data.alphaData;let a=0;for(let e=0;e<t.length;e+=4)t[e+3]=r[a++];const i=d.$currentWorkSpace().getLibrary(this.libraryId);i._$buffer=t,i._$command=null}}if(d.$unzipQueues.length){const e=d.$unzipQueues.shift();switch(t.onmessage=d.$unzipHandler.bind(e),e.mode){case"swf":{const r=e._$byteStream._$buffer;t.postMessage({fileSize:e.fileSize,mode:e.mode,buffer:r},[r.buffer])}break;case"lossless":t.postMessage(e,[e.buffer.buffer]);break;case"jpegAlpha":t.postMessage(e,[e.buffer.buffer,e.alphaData.buffer])}}else d.$unzipWorkerActive=!1},d.$unlzmaWorkerURL=URL.createObjectURL(new Blob(['const LZMA={init:function(e){const t=[];t.push(e[12],e[13],e[14],e[15],e[16],e[4],e[5],e[6],e[7]);let s=8;for(let e=5;e<9;++e){if(t[e]>=s){t[e]=t[e]-s|0;break}t[e]=256+t[e]-s|0,s=1}return t.push(0,0,0,0),e.set(t,4),e.subarray(4)},reverseDecode2:function(e,t,s,i){let r=1,o=0,d=0;for(;d<i;++d){const i=s.decodeBit(e,t+r);r=r<<1|i,o|=i<<d}return o},decompress:function(e,t){const s=new Decoder,i=s.decodeHeader(e),r=i.uncompressedSize;if(s.setProperties(i),!s.decodeBody(e,t,r))throw new Error("Error in lzma data stream");return t}};class OutWindow{constructor(){this._buffer=null,this._stream=null,this._pos=0,this._streamPos=0,this._windowSize=0}create(e){this._buffer&&this._windowSize===e||(this._buffer=new Uint8Array(e)),this._windowSize=e}flush(){const e=this._pos-this._streamPos;e&&(this._stream.writeBytes(this._buffer,e),this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos)}releaseStream(){this.flush(),this._stream=null}setStream(e){this._stream=e}init(e=!1){e||(this._streamPos=0,this._pos=0)}copyBlock(e,t){let s=this._pos-e-1;for(s<0&&(s+=this._windowSize);t--;)s>=this._windowSize&&(s=0),this._buffer[this._pos++]=this._buffer[s++],this._pos>=this._windowSize&&this.flush()}putByte(e){this._buffer[this._pos++]=e,this._pos>=this._windowSize&&this.flush()}getByte(e){let t=this._pos-e-1;return t<0&&(t+=this._windowSize),this._buffer[t]}}class RangeDecoder{constructor(){this._stream=null,this._code=0,this._range=-1}setStream(e){this._stream=e}releaseStream(){this._stream=null}init(){let e=5;for(this._code=0,this._range=-1;e--;)this._code=this._code<<8|this._stream.readByte()}decodeDirectBits(e){let t=0,s=e;for(;s--;){this._range>>>=1;const e=this._code-this._range>>>31;this._code-=this._range&e-1,t=t<<1|1-e,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8)}return t}decodeBit(e,t){const s=e[t],i=(this._range>>>11)*s;return(2147483648^this._code)<(2147483648^i)?(this._range=i,e[t]+=2048-s>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=i,this._code-=i,e[t]-=s>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)}}class BitTreeDecoder{constructor(e){this._models=Array(1<<e).fill(1024),this._numBitLevels=e}decode(e){let t=1,s=this._numBitLevels;for(;s--;)t=t<<1|e.decodeBit(this._models,t);return t-(1<<this._numBitLevels)}reverseDecode(e){let t=1,s=0,i=0;for(;i<this._numBitLevels;++i){const r=e.decodeBit(this._models,t);t=t<<1|r,s|=r<<i}return s}}class LenDecoder{constructor(){this._choice=[1024,1024],this._lowCoder=[],this._midCoder=[],this._highCoder=new BitTreeDecoder(8),this._numPosStates=0}create(e){for(;this._numPosStates<e;++this._numPosStates)this._lowCoder[this._numPosStates]=new BitTreeDecoder(3),this._midCoder[this._numPosStates]=new BitTreeDecoder(3)}decode(e,t){return 0===e.decodeBit(this._choice,0)?this._lowCoder[t].decode(e):0===e.decodeBit(this._choice,1)?8+this._midCoder[t].decode(e):16+this._highCoder.decode(e)}}class Decoder2{constructor(){this._decoders=Array(768).fill(1024)}decodeNormal(e){let t=1;do{t=t<<1|e.decodeBit(this._decoders,t)}while(t<256);return 255&t}decodeWithMatchByte(e,t){let s=1;do{const i=t>>7&1;t<<=1;const r=e.decodeBit(this._decoders,(1+i<<8)+s);if(s=s<<1|r,i!==r){for(;s<256;)s=s<<1|e.decodeBit(this._decoders,s);break}}while(s<256);return 255&s}}class LiteralDecoder{create(e,t){if(this._coders&&this._numPrevBits===t&&this._numPosBits===e)return;this._numPosBits=e,this._posMask=(1<<e)-1,this._numPrevBits=t,this._coders=[];let s=1<<this._numPrevBits+this._numPosBits;for(;s--;)this._coders[s]=new Decoder2}getDecoder(e,t){return this._coders[((e&this._posMask)<<this._numPrevBits)+((255&t)>>>8-this._numPrevBits)]}}class Decoder{constructor(){this._outWindow=new OutWindow,this._rangeDecoder=new RangeDecoder,this._isMatchDecoders=Array(192).fill(1024),this._isRepDecoders=Array(12).fill(1024),this._isRepG0Decoders=Array(12).fill(1024),this._isRepG1Decoders=Array(12).fill(1024),this._isRepG2Decoders=Array(12).fill(1024),this._isRep0LongDecoders=Array(192).fill(1024),this._posDecoders=Array(114).fill(1024),this._posAlignDecoder=new BitTreeDecoder(4),this._lenDecoder=new LenDecoder,this._repLenDecoder=new LenDecoder,this._literalDecoder=new LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder=[new BitTreeDecoder(6),new BitTreeDecoder(6),new BitTreeDecoder(6),new BitTreeDecoder(6)]}setDictionarySize(e){return!(e<0)&&(this._dictionarySize!==e&&(this._dictionarySize=e,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)}setLcLpPb(e,t,s){if(e>8||t>4||s>4)return!1;const i=1<<s;return this._literalDecoder.create(t,e),this._lenDecoder.create(i),this._repLenDecoder.create(i),this._posStateMask=i-1,!0}setProperties(e){if(!this.setLcLpPb(e.lc,e.lp,e.pb))throw Error("Incorrect stream properties");if(!this.setDictionarySize(e.dictionarySize))throw Error("Invalid dictionary size")}decodeHeader(e){if(e._$size<13)return!1;let t=e.readByte();const s=t%9;t=~~(t/9);const i=t%5,r=~~(t/5);let o=e.readByte();o|=e.readByte()<<8,o|=e.readByte()<<16,o+=16777216*e.readByte();let d=e.readByte();return d|=e.readByte()<<8,d|=e.readByte()<<16,d+=16777216*e.readByte(),e.readByte(),e.readByte(),e.readByte(),e.readByte(),{lc:s,lp:i,pb:r,dictionarySize:o,uncompressedSize:d}}decodeBody(e,t,s){let i,r,o=0,d=0,h=0,c=0,n=0,_=0,a=0;for(this._rangeDecoder.setStream(e),this._rangeDecoder.init(),this._outWindow.setStream(t),this._outWindow.init(!1);_<s;){const e=_&this._posStateMask;if(0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(o<<4)+e)){const e=this._literalDecoder.getDecoder(_++,a);a=o>=7?e.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(d)):e.decodeNormal(this._rangeDecoder),this._outWindow.putByte(a),o=o<4?0:o-(o<10?3:6)}else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,o))i=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,o)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(o<<4)+e)&&(o=o<7?9:11,i=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,o)?r=h:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,o)?r=c:(r=n,n=c),c=h),h=d,d=r),0===i&&(i=2+this._repLenDecoder.decode(this._rangeDecoder,e),o=o<7?8:11);else{n=c,c=h,h=d,i=2+this._lenDecoder.decode(this._rangeDecoder,e),o=o<7?7:10;const t=this._posSlotDecoder[i<=5?i-2:3].decode(this._rangeDecoder);if(t>=4){const e=(t>>1)-1;if(d=(2|1&t)<<e,t<14)d+=LZMA.reverseDecode2(this._posDecoders,d-t-1,this._rangeDecoder,e);else if(d+=this._rangeDecoder.decodeDirectBits(e-4)<<4,d+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),d<0){if(-1===d)break;return!1}}else d=t}if(d>=_||d>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(d,i),_+=i,a=this._outWindow.getByte(0)}}return this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0}}class InStream{constructor(e){this._$data=e,this._$size=e.length,this._$offset=0}readByte(){return this._$data[this._$offset++]}}class OutStream{constructor(e){this.size=8,this.buffers=e}writeBytes(e,t){e.length===t?this.buffers.set(e,this.size):this.buffers.set(e.subarray(0,t),this.size),this.size+=t}}this.addEventListener("message",(function(e){const t=e.data.fileSize,s=e.data.buffer,i=new Uint8Array(t+8);i.set(s.slice(0,8),0),LZMA.decompress(new InStream(LZMA.init(s)),new OutStream(i)),this.postMessage(i,[i.buffer]),this.close()}));'],{type:"text/javascript"})),d.$unlzmaQueues=[],d.$unlzmaWorkerActive=!1,d.$parserURL=URL.createObjectURL(new Blob(['const Util={$tagObjects:[]};Util.$installed=new Map,Util.$swfParser=null,Util.$Rad2Deg=180/Math.PI,Util.$JCT11280=Function(\'var a="zKV33~jZ4zN=~ji36XazM93y!{~k2y!o~k0ZlW6zN?3Wz3W?{EKzK[33[`y|;-~j^YOTz$!~kNy|L1$353~jV3zKk3~k-4P4zK_2+~jY4y!xYHR~jlz$_~jk4z$e3X5He<0y!wy|X3[:~l|VU[F3VZ056Hy!nz/m1XD61+1XY1E1=1y|bzKiz!H034zKj~mEz#c5ZA3-3X$1~mBz$$3~lyz#,4YN5~mEz#{ZKZ3V%7Y}!J3X-YEX_J(3~mAz =V;kE0/y|F3y!}~m>z/U~mI~j_2+~mA~jp2;~m@~k32;~m>V}2u~mEX#2x~mBy+x2242(~mBy,;2242(~may->2&XkG2;~mIy-_2&NXd2;~mGz,{4<6:.:B*B:XC4>6:.>B*BBXSA+A:X]E&E<~r#z+625z s2+zN=`HXI@YMXIAXZYUM8X4K/:Q!Z&33 3YWX[~mB`{zKt4z (zV/z 3zRw2%Wd39]S11z$PAXH5Xb;ZQWU1ZgWP%3~o@{Dgl#gd}T){Uo{y5_d{e@}C(} WU9|cB{w}bzvV|)[} H|zT}d||0~{]Q|(l{|x{iv{dw}(5}[Z|kuZ }cq{{y|ij}.I{idbof%cu^d}Rj^y|-M{ESYGYfYsZslS`?ZdYO__gLYRZ&fvb4oKfhSf^d<Yeasc1f&a=hnYG{QY{D`Bsa|u,}Dl|_Q{C%xK|Aq}C>|c#ryW=}eY{L+`)][YF_Ub^h4}[X|?r|u_ex}TL@YR]j{SrXgo*|Gv|rK}B#mu{R1}hs|dP{C7|^Qt3|@P{YVV |8&}#D}ef{e/{Rl|>Hni}R1{Z#{D[}CQlQ||E}[s{SG_+i8eplY[=[|ec[$YXn#`hcm}YR|{Ci(_[ql|?8p3]-}^t{wy}4la&pc|3e{Rp{LqiJ],] `kc(]@chYnrM`O^,ZLYhZB]ywyfGY~aex!_Qww{a!|)*lHrM{N+n&YYj~Z b c#e_[hZSon|rOt`}hBXa^i{lh|<0||r{KJ{kni)|x,|0auY{D!^Sce{w;|@S|cA}Xn{C1h${E]Z-XgZ*XPbp]^_qbH^e[`YM|a||+=]!Lc}]vdBc=j-YSZD]YmyYLYKZ9Z>Xcczc2{Yh}9Fc#Z.l{}(D{G{{mRhC|L3b#|xK[Bepj#ut`H[,{E9Yr}1b{[e]{ZFk7[ZYbZ0XL]}Ye[(`d}c!|*y`Dg=b;gR]Hm=hJho}R-[n}9;{N![7k_{UbmN]rf#pTe[x8}!Qcs_rs[m`|>N}^V})7{^r|/E}),}HH{OYe2{Skx)e<_.cj.cjoMhc^d}0uYZd!^J_@g,[[[?{i@][|3S}Yl3|!1|eZ|5IYw|1D}e7|Cv{OHbnx-`wvb[6[4} =g+k:{C:}ed{S]|2M]-}WZ|/q{LF|dYu^}Gs^c{Z=}h>|/i|{W]:|ip{N:|zt|S<{DH[p_tvD{N<[8Axo{X4a.^o^X>Yfa59`#ZBYgY~_t^9`jZHZn`>G[oajZ;X,i)Z.^~YJe ZiZF^{][[#Zt^|]Fjx]&_5dddW]P0C[-]}]d|y {C_jUql] |OpaA[Z{lp|rz}:Mu#]_Yf6{Ep?f5`$[6^D][^u[$[6^.Z8]]ePc2U/=]K^_+^M{q*|9tYuZ,s(dS{i=|bNbB{uG}0jZOa:[-]dYtu3]:]<{DJ_SZIqr_`l=Yt`gkTnXb3d@kiq0a`Z{|!B|}e}Ww{Sp,^Z|0>_Z}36|]A|-t}lt{R6pi|v8hPu#{C>YOZHYmg/Z4nicK[}hF_Bg|YRZ7c|crkzYZY}_iXcZ.|)U|L5{R~qi^Uga@Y[xb}&qdbd6h5|Btw[}c<{Ds53[Y7]?Z<|e0{L[ZK]mXKZ#Z2^tavf0`PE[OSOaP`4gi`qjdYMgys/?[nc,}EEb,eL]g[n{E_b/vcvgb.{kcwi`~v%|0:|iK{Jh_vf5lb}KL|(oi=LrzhhY_^@`zgf[~g)[J_0fk_V{T)}I_{D&_/d9W/|MU[)f$xW}?$xr4<{Lb{y4}&u{XJ|cm{Iu{jQ}CMkD{CX|7A}G~{kt)nB|d5|<-}WJ}@||d@|Iy}Ts|iL|/^|no|0;}L6{Pm]7}$zf:|r2}?C_k{R(}-w|`G{Gy[g]bVje=_0|PT{^Y^yjtT[[[l!Ye_`ZN]@[n_)j3nEgMa]YtYpZy].d-Y_cjb~Y~[nc~sCi3|zg}B0}do{O^{|$`_|D{}U&|0+{J3|8*]iayx{a{xJ_9|,c{Ee]QXlYb]$[%YMc*]w[aafe]aVYi[fZEii[xq2YQZHg]Y~h#|Y:thre^@^|_F^CbTbG_1^qf7{L-`VFx Zr|@EZ;gkZ@slgko`[e}T:{Cu^pddZ_`yav^Ea+[#ZBbSbO`elQfLui}.F|txYcbQ`XehcGe~fc^RlV{D_0ZAej[l&jShxG[ipB_=u:eU}3e8[=j|{D(}dO{Do[BYUZ0/]AYE]ALYhZcYlYP/^-^{Yt_1_-;YT`P4BZG=IOZ&]H[e]YYd[9^F[1YdZxZ?Z{Z<]Ba2[5Yb[0Z4l?]d_;_)a?YGEYiYv`_XmZs4ZjY^Zb]6gqGaX^9Y}dXZr[g|]Y}K aFZp^k^F]M`^{O1Ys]ZCgCv4|E>}8eb7}l`{L5[Z_faQ|c2}Fj}hw^#|Ng|B||w2|Sh{v+[G}aB|MY}A{|8o}X~{E8paZ:]i^Njq]new)`-Z>haounWhN}c#{DfZ|fK]KqGZ=:u|fqoqcv}2ssm}.r{]{nIfV{JW)[K|,Z{Uxc|]l_KdCb%]cfobya3`p}G^|LZiSC]U|(X|kBlVg[kNo({O:g:|-N|qT}9?{MBiL}Sq{`P|3a|u.{Uaq:{_o|^S}jX{Fob0`;|#y_@[V[K|cw[<_ }KU|0F}d3|et{Q7{LuZttsmf^kYZ`Af`}$x}U`|Ww}d]| >}K,r&|XI|*e{C/a-bmr1fId4[;b>tQ_:]hk{b-pMge]gfpo.|(w[jgV{EC1Z,YhaY^q,_G[c_g[J0YX]`[h^hYK^_Yib,` {i6vf@YM^hdOKZZn(jgZ>bzSDc^Z%[[o9[2=/YHZ(_/Gu_`*|8z{DUZxYt^vuvZjhi^lc&gUd4|<UiA`z]$b/Z?l}YI^jaHxe|;F}l${sQ}5g}hA|e4}?o{ih}Uz{C)jPe4]H^J[Eg[|AMZMlc}:,{iz}#*|gc{Iq|/:|zK{l&}#u|myd{{M&v~nV};L|(g|I]ogddb0xsd7^V})$uQ{HzazsgxtsO^l}F>ZB]r|{7{j@cU^{{CbiYoHlng]f+nQ[bkTn/}<-d9q {KXadZYo+n|l[|lc}V2{[a{S4Zam~Za^`{HH{xx_SvF|ak=c^[v^7_rYT`ld@]:_ub%[$[m](Shu}G2{E.ZU_L_R{tz`vj(f?^}hswz}GdZ}{S:h`aD|?W|`dgG|if{a8|J1{N,}-Ao3{H#{mfsP|[ bzn+}_Q{MT{u4kHcj_q`eZj[8o0jy{p7}C|[}l){MuYY{|Ff!Ykn3{rT|m,^R|,R}$~Ykgx{P!]>iXh6[l[/}Jgcg{JYZ.^qYfYIZl[gZ#Xj[Pc7YyZD^+Yt;4;`e8YyZVbQ7YzZxXja.7SYl[s]2^/Ha$[6ZGYrb%XiYdf2]H]kZkZ*ZQ[ZYS^HZXcCc%Z|[(bVZ]]:OJQ_DZCg<[,]%Zaa [g{C00HY[c%[ChyZ,Z_`PbXa+eh`^&jPi0a[ggvhlekL]w{Yp^v}[e{~;k%a&k^|nR_z_Qng}[E}*Wq:{k^{FJZpXRhmh3^p>de^=_7`|ZbaAZtdhZ?n4ZL]u`9ZNc3g%[6b=e.ZVfC[ZZ^^^hD{E(9c(kyZ=bb|Sq{k`|vmr>izlH[u|e`}49}Y%}FT{[z{Rk}Bz{TCc/lMiAqkf(m$hDc;qooi[}^o:c^|Qm}a_{mrZ(pA`,}<2sY| adf_%|}`}Y5U;}/4|D>|$X{jw{C<|F.hK|*A{MRZ8Zsm?imZm_?brYWZrYx`yVZc3a@f?aK^ojEd {bN}/3ZH]/$YZhm^&j 9|(S|b]mF}UI{q&aM]LcrZ5^.|[j`T_V_Gak}9J[ ZCZD|^h{N9{~&[6Zd{}B}2O|cv]K}3s}Uy|l,fihW{EG`j_QOp~Z$F^zexS`dcISfhZBXP|.vn|_HYQ|)9|cr]<`&Z6]m_(ZhPcSg>`Z]5`~1`0Xcb4k1{O!bz|CN_T{LR|a/gFcD|j<{Z._[f)mPc:1`WtIaT1cgYkZOaVZOYFrEe[}T$}Ch}mk{K-^@]fH{Hdi`c*Z&|Kt{if[C{Q;{xYB`dYIX:ZB[}]*[{{p9|4GYRh2ao{DS|V+[zd$`F[ZXKadb*A] Ys]Maif~a/Z2bmclb8{Jro_rz|x9cHojbZ{GzZx_)]:{wAayeDlx}<=`g{H1{l#}9i|)=|lP{Qq}.({La|!Y{i2EZfp=c*}Cc{EDvVB|;g}2t{W4av^Bn=]ri,|y?|3+}T*ckZ*{Ffr5e%|sB{lx^0]eZb]9[SgAjS_D|uHZx]dive[c.YPkcq/}db{EQh&hQ|eg}G!ljil|BO]X{Qr_GkGl~YiYWu=c3eb}29v3|D|}4i||.{Mv})V{SP1{FX}CZW6{cm|vO{pS|e#}A~|1i}81|Mw}es|5[}3w{C`h9aL]o{}p[G`>i%a1Z@`Ln2bD[$_h`}ZOjhdTrH{[j_:k~kv[Sdu]CtL}41{I |[[{]Zp$]XjxjHt_eThoa#h>sSt8|gK|TVi[Y{t=}Bs|b7Zpr%{gt|Yo{CS[/{iteva|cf^hgn}($_c^wmb^Wm+|55jrbF|{9^ q6{C&c+ZKdJkq_xOYqZYSYXYl`8]-cxZAq/b%b*_Vsa[/Ybjac/OaGZ4fza|a)gY{P?| I|Y |,pi1n7}9bm9ad|=d{aV|2@[(}B`d&|Uz}B}{`q|/H|!JkM{FU|CB|.{}Az}#P|lk}K{|2rk7{^8^?`/|k>|Ka{Sq}Gz}io{DxZh[yK_#}9<{TRdgc]`~Z>JYmYJ]|`!ZKZ]gUcx|^E[rZCd`f9oQ[NcD_$ZlZ;Zr}mX|=!|$6ZPZYtIo%fj}CpcN|B,{VDw~gb}@hZg`Q{LcmA[(bo`<|@$|o1|Ss}9Z_}tC|G`{F/|9nd}i=}V-{L8aaeST]daRbujh^xlpq8|}zs4bj[S`J|]?G{P#{rD{]I`OlH{Hm]VYuSYUbRc*6[j`8]pZ[bt_/^Jc*[<Z?YE|Xb|?_Z^Vcas]h{t9|Uwd)_(=0^6Zb{Nc} E[qZAeX[a]P^|_J>e8`W^j_Y}R{{Jp__]Ee#e:iWb9q_wKbujrbR}CY`,{mJ}gz{Q^{t~N|? gSga`V_||:#mi}3t|/I`X{N*|ct|2g{km}gi|{={jC}F;|E}{ZZjYf*frmu}8Tdroi{T[|+~}HG{cJ}DM{Lp{Ctd&}$hi3|FZ| m}Kr|38}^c|m_|Tr{Qv|36}?Up>|;S{DV{k_as}BK{P}}9p|t`jR{sAm4{D=b4pWa[}Xi{EjwEkI}3S|E?u=X0{jf} S|NM|JC{qo^3cm]-|JUx/{Cj{s>{Crt[UXuv|D~|j|d{YXZR}Aq}0r}(_{pJfi_z}0b|-vi)Z mFe,{f4|q`b{}^Z{HM{rbeHZ|^x_o|XM|L%|uFXm}@C_{{Hhp%a7|0p[Xp+^K}9U{bP}: tT}B|}+$|b2|[^|~h{FAby[`{}xgygrt~h1[li`c4vz|,7p~b(|mviN}^pg[{N/|g3|^0c,gE|f%|7N{q[|tc|TKA{LU}I@|AZp(}G-sz{F |qZ{}F|f-}RGn6{Z]_5})B}UJ{FFb2]4ZI@v=k,]t_Dg5Bj]Z-]L]vrpdvdGlk|gF}G]|IW}Y0[G| /bo|Te^,_B}#n^^{QHYI[?hxg{[`]D^IYRYTb&kJ[cri[g_9]Ud~^_]<p@_e_XdNm-^/|5)|h_{J;{kacVopf!q;asqd}n)|.m|bf{QW|U)}b+{tL|w``N|to{t ZO|T]jF}CB|0Q{e5Zw|k |We}5:{HO{tPwf_uajjBfX}-V_C_{{r~gg|Ude;s+}KNXH}! `K}eW{Upwbk%ogaW}9EYN}YY|&v|SL{C3[5s.]Y]I]u{M6{pYZ`^,`ZbCYR[1mNg>rsk0Ym[jrE]RYiZTr*YJ{Ge|%-lf|y(`=[t}E6{k!|3)}Zk} ][G{E~cF{u3U.rJ|a9p#o#ZE|?|{sYc#vv{E=|LC}cu{N8`/`3`9rt[4|He{cq|iSYxY`}V |(Q|t4{C?]k_Vlvk)BZ^r<{CL}#h}R+[<|i=}X|{KAo]|W<`K{NW|Zx}#;|fe{IMr<|K~tJ_x}AyLZ?{GvbLnRgN}X&{H7|x~}Jm{]-| GpNu0}.ok>|c4{PYisrDZ|fwh9|hfo@{H~XSbO]Odv]%`N]b1Y]]|eIZ}_-ZA]aj,>eFn+j[aQ_+]h[J_m_g]%_wf.`%k1e#Z?{CvYu_B^|gk`Xfh^M3`afGZ-Z|[m{L}|k3cp[it ^>YUi~d>{T*}YJ{Q5{Jxa$hg|%4`}|LAgvb }G}{P=|<;Ux{_skR{cV|-*|s-{Mp|XP|$G|_J}c6cM{_=_D|*9^$ec{V;|4S{qO|w_|.7}d0|/D}e}|0G{Dq]Kdp{}dfDi>}B%{Gd|nl}lf{C-{y}|ANZr}#={T~|-(}c&{pI|ft{lsVP}){|@u}!W|bcmB{d?|iW|:dxj{PSkO|Hl]Li:}VYk@|2={fnWt{M3`cZ6|)}|Xj}BYa?vo{e4|L7|B7{L7|1W|lvYO}W8nJ|$Vih|{T{d*_1|:-n2dblk``fT{Ky|-%}m!|Xy|-a{Pz}[l{kFjz|iH}9N{WE{x,|jz}R {P|{D)c=nX|Kq|si}Ge{sh|[X{RF{t`|jsr*fYf,rK|/9}$}}Nf{y!1|<Std}4Wez{W${Fd_/^O[ooqaw_z[L`Nbv[;l7V[ii3_PeM}.h^viqYjZ*j1}+3{bt{DR[;UG}3Og,rS{JO{qw{d<_zbAh<R[1_r`iZTbv^^a}c{iEgQZ<exZFg.^Rb+`Uj{a+{z<[~r!]`[[|rZYR|?F|qppp]L|-d|}K}YZUM|=Y|ktm*}F]{D;g{uI|7kg^}%?Z%ca{N[_<q4xC]i|PqZC]n}.bDrnh0Wq{tr|OMn6tM|!6|T`{O`|>!]ji+]_bTeU}Tq|ds}n|{Gm{z,f)}&s{DPYJ`%{CGd5v4tvb*hUh~bf]z`jajiFqAii]bfy^U{Or|m+{I)cS|.9k:e3`^|xN}@Dnlis`B|Qo{`W|>||kA}Y}{ERYuYx`%[exd`]|OyiHtb}HofUYbFo![5|+]gD{NIZR|Go}.T{rh^4]S|C9_}xO^i`vfQ}C)bK{TL}cQ|79iu}9a];sj{P.o!f[Y]pM``Jda^Wc9ZarteBZClxtM{LW}l9|a.mU}KX}4@{I+f1}37|8u}9c|v${xGlz}jP{Dd1}e:}31}%3X$|22i<v+r@~mf{sN{C67G97855F4YL5}8f{DT|xy{sO{DXB334@55J1)4.G9A#JDYtXTYM4, YQD9;XbXm9SX]IB^4UN=Xn<5(;(F3YW@XkH-X_VM[DYM:5XP!T&Y`6|,^{IS-*D.H>:LXjYQ0I3XhAF:9:(==.F*3F1189K/7163D,:@|e2{LS36D4hq{Lw/84443@4.933:0307::6D7}&l{Mx657;89;,K5678H&93D(H<&<>0B90X^I;}Ag1{P%3A+>><975}[S{PZE453?4|T2{Q+5187;>447:81{C=hL6{Me^:=7ii{R=.=F<81;48?|h8}Uh{SE|,VxL{ST,7?9Y_5Xk3A#:$%YSYdXeKXOD8+TXh7(@>(YdXYHXl9J6X_5IXaL0N?3YK7Xh!1?XgYz9YEXhXaYPXhC3X`-YLY_XfVf[EGXZ5L8BXL9YHX]SYTXjLXdJ: YcXbQXg1PX]Yx4|Jr{Ys4.8YU+XIY`0N,<H%-H;:0@,74/:8546I=9177154870UC]d<C3HXl7ALYzXFXWP<<?E!88E5@03YYXJ?YJ@6YxX-YdXhYG|9o{`iXjY_>YVXe>AYFX[/(I@0841?):-B=14337:8=|14{c&93788|di{cW-0>0<097/A;N{FqYpugAFT%X/Yo3Yn,#=XlCYHYNX[Xk3YN:YRT4?)-YH%A5XlYF3C1=NWyY}>:74-C673<69545v {iT85YED=64=.F4..9878/D4378?48B3:7:7/1VX[f4{D,{l<5E75{dAbRB-8-@+;DBF/$ZfW8S<4YhXA.(5@*11YV8./S95C/0R-A4AXQYI7?68167B95HA1*<M3?1/@;/=54XbYP36}lc{qzSS38:19?,/39193574/66878Yw1X-87E6=;964X`T734:>86>1/=0;(I-1::7ALYGXhF+Xk[@W%TYbX7)KXdYEXi,H-XhYMRXfYK?XgXj.9HX_SX]YL1XmYJ>Y}WwIXiI-3-GXcYyXUYJ$X`Vs[7;XnYEZ;XF! 3;%8;PXX(N3Y[)Xi1YE&/ :;74YQ6X`33C;-(>Xm0(TYF/!YGXg8 9L5P01YPXO-5%C|qd{{/K/E6,=0144:361:955;6443@?B7*7:F89&F35YaX-CYf,XiFYRXE_e{}sF 0*7XRYPYfXa5YXXY8Xf8Y~XmA[9VjYj*#YMXIYOXk,HHX40YxYMXU8OXe;YFXLYuPXP?EB[QV0CXfY{:9XV[FWE0D6X^YVP*$4%OXiYQ(|xp|%c3{}V`1>Y`XH00:8/M6XhQ1:;3414|TE|&o@1*=81G8<3}6<|(f6>>>5-5:8;093B^3U*+*^*UT30XgYU&7*O1953)5@E78--F7YF*B&0:%P68W9Zn5974J9::3}Vk|-,C)=)1AJ4+<3YGXfY[XQXmT1M-XcYTYZXCYZXEYXXMYN,17>XIG*SaS|/eYJXbI?XdNZ+WRYP<F:R PXf;0Xg`$|1GX9YdXjLYxWX!ZIXGYaXNYm6X9YMX?9EXmZ&XZ#XQ>YeXRXfAY[4 ;0X!Zz0XdN$XhYL XIY^XGNXUYS/1YFXhYk.TXn4DXjB{jg|4DEX]:XcZMW=A.+QYL<LKXc[vV$+&PX*Z3XMYIXUQ:ZvW< YSXFZ,XBYeXMM)?Xa XiZ4/EXcP3%}&-|6~:1(-+YT$@XIYRBC<}&,|7aJ6}bp|8)K1|Xg|8C}[T|8Q.89;-964I38361<=/;883651467<7:>?1:.}le|:Z=39;1Y^)?:J=?XfLXbXi=Q0YVYOXaXiLXmJXO5?.SFXiCYW}-;|=u&D-X`N0X^,YzYRXO(QX_YW9`I|>hZ:N&X)DQXP@YH#XmNXi$YWX^=!G6YbYdX>XjY|XlX^XdYkX>YnXUXPYF)FXT[EVTMYmYJXmYSXmNXi#GXmT3X8HOX[ZiXN]IU2>8YdX1YbX<YfWuZ8XSXcZU%0;1XnXkZ_WTG,XZYX5YSX Yp 05G?XcYW(IXg6K/XlYP4XnI @XnO1W4Zp-9C@%QDYX+OYeX9>--YSXkD.YR%Q/Yo YUX].Xi<HYEZ2WdCE6YMXa7F)=,D>-@9/8@5=?7164;35387?N<618=6>7D+C50<6B03J0{Hj|N9$D,9I-,.KB3}m |NzE0::/81YqXjMXl7YG; [.W=Z0X4XQY]:MXiR,XgM?9$9>:?E;YE77VS[Y564760391?14941:0=:8B:;/1DXjFA-564=0B3XlH1+D85:0Q!B#:-6&N/:9<-R3/7Xn<*3J4.H:+334B.=>30H.;3833/76464665755:/83H6633:=;.>5645}&E|Y)?1/YG-,93&N3AE@5 <L1-G/8A0D858/30>8<549=@B8] V0[uVQYlXeD(P#ID&7T&7;Xi0;7T-$YE)E=1:E1GR):--0YI7=E<}n9|aT6783A>D7&4YG7=391W;Zx<5+>F#J39}o/|cc;6=A050EQXg8A1-}D-|d^5548083563695D?-.YOXd37I$@LYLWeYlX<Yd+YR A$;3-4YQ-9XmA0!9/XLY_YT(=5XdDI>YJ5XP1ZAW{9>X_6R(XhYO65&J%DA)C-!B:97#A9;@?F;&;(9=11/=657/H,<8}bz|j^5446>.L+&Y^8Xb6?(CYOXb*YF(8X`FYR(XPYVXmPQ%&DD(XmZXW??YOXZXfCYJ79,O)XnYF7K0!QXmXi4IYFRXS,6<%-:YO(+:-3Q!1E1:W,Zo}Am|n~;3580534*?3Zc4=9334361693:30C<6/717:<1/;>59&:4}6!|rS36=1?75<8}[B|s809983579I.A.>84758=108564741H*9E{L{|u%YQ<%6XfH.YUXe4YL@,>N}Tv|ve*G0X)Z;/)3@A74(4P&A1X:YVH97;,754*A66:1 D739E3553545558E4?-?K17/770843XAYf838A7K%N!YW4.$T19Z`WJ*0XdYJXTYOXNZ 1XaN1A+I&Xi.Xk3Z3GB&5%WhZ1+5#Y[X<4YMXhQYoQXVXbYQ8XSYUX4YXBXWDMG0WxZA[8V+Z8X;D],Va$%YeX?FXfX[XeYf<X:Z[WsYz8X_Y]%XmQ(!7BXIZFX]&YE3F$(1XgYgYE& +[+W!<YMYFXc;+PXCYI9YrWxGXY9DY[!GXiI7::)OC;*$.>N*HA@{C|}&k=:<TB83X`3YL+G4XiK]i}(fYK<=5$.FYE%4*5*H*6XkCYL=*6Xi6!Yi1KXR4YHXbC8Xj,B9ZbWx/XbYON#5B}Ue}+QKXnF1&YV5XmYQ0!*3IXBYb71?1B75XmF;0B976;H/RXU:YZX;BG-NXj;XjI>A#D3B636N;,*%<D:0;YRXY973H5)-4FXOYf0:0;/7759774;7;:/855:543L43<?6=E,.A4:C=L)%4YV!1(YE/4YF+ F3%;S;&JC:%/?YEXJ4GXf/YS-EXEYW,9;E}X$}547EXiK=51-?71C%?57;5>463553Zg90;6447?<>4:9.7538XgN{|!}9K/E&3-:D+YE1)YE/3;37/:05}n<}:UX8Yj4Yt864@JYK..G=.(A Q3%6K>3(P3#AYE$-6H/456*C=.XHY[#S.<780191;057C)=6HXj?955B:K1 E>-B/9,;5.!L?:0>/.@//:;7833YZ56<4:YE=/:7Z_WGC%3I6>XkC*&NA16X=Yz2$X:Y^&J48<99k8}CyB-61<18K946YO4{|N}E)YIB9K0L>4=46<1K0+R;6-=1883:478;4,S+3YJX`GJXh.Yp+Xm6MXcYpX(>7Yo,/:X=Z;Xi0YTYHXjYmXiXj;*;I-8S6N#XgY}.3XfYGO3C/$XjL$*NYX,1 6;YH&<XkK9C#I74.>}Hd`A748X[T450[n75<4439:18A107>|ET}Rf<1;14876/Yb983E<5.YNXd4149>,S=/4E/<306443G/06}0&}UkYSXFYF=44=-5095=88;63844,9E6644{PL}WA8:>)7+>763>>0/B3A545CCnT}Xm|dv}Xq1L/YNXk/H8;;.R63351YY747@15YE4J8;46;.38.>4A369.=-83,;Ye3?:3@YE.4-+N353;/;@(X[YYD>@/05-I*@.:551741Yf5>6A443<3535;.58/86=D4753442$635D1>0359NQ @73:3:>><Xn?;43C14 ?Y|X611YG1&<+,4<*,YLXl<1/AIXjF*N89A4Z576K1XbJ5YF.ZOWN.YGXO/YQ01:4G38Xl1;KI0YFXB=R<7;D/,/4>;$I,YGXm94@O35Yz66695385.>:6A#5}W7n^4336:4157597434433<3|XA}m`>=D>:4A.337370?-6Q96{`E|4A}C`|Qs{Mk|J+~r>|o,wHv>Vw}!c{H!|Gb|*Ca5}J||,U{t+{CN[!M65YXOY_*B,Y[Z9XaX[QYJYLXPYuZ%XcZ8LY[SYPYKZM<LMYG9OYqSQYM~[e{UJXmQYyZM_)>YjN1~[f3{aXFY|Yk:48YdH^NZ0|T){jVFYTZNFY^YTYN~[h{nPYMYn3I]`EYUYsYIZEYJ7Yw)YnXPQYH+Z.ZAZY]^Z1Y`YSZFZyGYHXLYG 8Yd#4~[i|+)YH9D?Y^F~Y7|-eYxZ^WHYdYfZQ~[j|3>~[k|3oYmYqY^XYYO=Z*4[]Z/OYLXhZ1YLZIXgYIHYEYK,<Y`YEXIGZI[3YOYcB4SZ!YHZ*&Y{Xi3~[l|JSY`Zz?Z,~[m|O=Yi>??XnYWXmYS617YVYIHZ(Z4[~L4/=~[n|Yu{P)|];YOHHZ}~[o33|a>~[r|aE]DH~[s|e$Zz~[t|kZFY~XhYXZB[`Y}~[u|{SZ&OYkYQYuZ2Zf8D~[v}% ~[w3},Q[X]+YGYeYPIS~[y}4aZ!YN^!6PZ*~[z}?E~[{3}CnZ=~[}}EdDZz/9A3(3S<,YR8.D=*XgYPYcXN3Z5 4)~[~}JW=$Yu.XX~] }KDX`PXdZ4XfYpTJLY[F5]X~[2Yp}U+DZJ::<446[m@~]#3}]1~]%}^LZwZQ5Z`/OT<Yh^ -~]&}jx[ ~m<z!%2+~ly4VY-~o>}p62yz!%2+Xf2+~ly4VY-zQ`z (=] 2z~o2",C={" ":0,"!":1},c=34,i=2,p,s="",u=String.fromCharCode,t=u(12539);for(;++c<127;)C[u(c)]=c^39&&c^92?i++:0;i=0;for(;0<=(c=C[a.charAt(i++)]);)if(16===c)if((c=C[a.charAt(i++)])<87){if(86===c)c=1879;for(;c--;)s+=u(++p)}else s+=s.substr(8272,360);else if(c<86)s+=u(p+=c<51?c-16:(c-55)*92+C[a.charAt(i++)]);else if((c=((c-86)*92+C[a.charAt(i++)])*92+C[a.charAt(i++)])<49152)s+=u(p=c<40960?c:c|57344);else{c&=511;for(;c--;)s+=t;p=12539}return s\')(),Util.$decodeToShiftJis=function(t){return t.replace(/%(8[1-9A-F]|[9E][0-9A-F]|F[0-9A-C])(%[4-689A-F][0-9A-F]|%7[0-9A-E]|[@-~])|%([0-7][0-9A-F]|A[1-9A-F]|[B-D][0-9A-F])/gi,(function(t){let e=parseInt(t.substring(1,3),16);const s=t.length;return 3===s?String.fromCharCode(e<160?e:e+65216):Util.$JCT11280.charAt(188*(e<160?e-129:e-193)+(4===s?t.charCodeAt(3)-64:(e=parseInt(t.substring(4),16))<127?e-64:e-65))}))},Util.$getTagObject=function(){return Util.$tagObjects.pop()||{placeObjects:[],sounds:[],removeObjects:[],frameLabel:[]}},Util.$poolTagObject=function(t){t.placeObjects.length=0,t.sounds.length=0,t.removeObjects.length=0,t.frameLabel.length=0,Util.$tagObjects.push(t)},Util.$createMovieClip=function(){const t={_$characterId:0,_$name:"MovieClip",_$controller:[],_$placeObjects:[],_$placeMap:[],_$labels:[],_$dictionary:[],_$sounds:[]};return t},Util.$getControllerAt=function(t,e,s){return s in t._$controller[e]?t._$controller[e][s]:null},Util.$addDictionary=function(t,e){const s=t._$dictionary.length,a={CharacterId:e.CharacterId,Depth:e.Depth,Name:null,ClipDepth:0,PlaceFlagHasImage:0|e.PlaceFlagHasImage,StartFrame:0|e.StartFrame,EndFrame:0|e.EndFrame};return e.PlaceFlagHasName&&(a.Name=e.Name),e.PlaceFlagHasClipDepth&&(a.ClipDepth=e.ClipDepth),t._$dictionary[s]=a,s},Util.$getBlendName=function(t){switch(t){case 1:case"normal":default:return"normal";case 2:case"layer":return"layer";case 3:case"multiply":return"multiply";case 4:case"screen":return"screen";case 5:case"lighten":return"lighten";case 6:case"darken":return"darken";case 7:case"difference":return"difference";case 8:case"add":return"add";case 9:case"subtract":return"subtract";case 10:case"invert":return"invert";case 11:case"alpha":return"alpha";case 12:case"erase":return"erase";case 13:case"overlay":return"overlay";case 14:case"hardlight":return"hardlight"}};class ByteStream{constructor(){this.clear()}clear(){this.data=null,this.bit_offset=0,this.byte_offset=0,this.bit_buffer=null}setData(t){this.data=t}getData(t){this.byteAlign();const e=this.byte_offset+t,s=this.data.subarray(this.byte_offset,e);return this.byte_offset=e,s}byteAlign(){this.bit_offset&&(this.byte_offset=this.byte_offset+(this.bit_offset+7)/8|0,this.bit_offset=0)}getDataUntil(t=0){this.byteAlign();let e="";for(;;){const t=this.data[this.byte_offset++];if(!t)break;if(10===t||13===t){e+="\\n";continue}let s=t.toString(16);1===s.length&&(s="0"+s),e+="%"+s}if(!e.length)return"";if(e.length>5&&"\\n"===e.substr(-5)&&(e=e.slice(0,-5)),t)return Util.$decodeToShiftJis(e);try{return decodeURIComponent(e)}catch(t){return Util.$decodeToShiftJis(e)}}byteCarry(){if(this.bit_offset>7)this.byte_offset=this.byte_offset+(0|(this.bit_offset+7)/8),this.bit_offset&=7;else for(;this.bit_offset<0;)--this.byte_offset,this.bit_offset+=8}getUIBits(t){let e=0;for(;t;)e<<=1,e|=this.getUIBit(),--t;return e}getUIBit(){return this.byteCarry(),this.data[this.byte_offset]>>7-this.bit_offset++&1}getSIBits(t){const e=this.getUIBits(t),s=e&1<<t-1;return s?-(e^2*s-1)-1:e}getUI8(){return this.byteAlign(),this.data[this.byte_offset++]}getUI16(){return this.byteAlign(),this.getUI8()|this.getUI8()<<8}getUI32(){return this.byteAlign(),this.getUI8()|(this.getUI8()|(this.getUI8()|this.getUI8()<<8)<<8)<<8}getFloat16(){const t=this.data[this.byte_offset++];let e=0;return e|=this.data[this.byte_offset++]<<8,e|=t<<0,e}getFloat32(){const t=this.data[this.byte_offset++],e=this.data[this.byte_offset++],s=this.data[this.byte_offset++];let a=0;a|=this.data[this.byte_offset++]<<24,a|=s<<16,a|=e<<8,a|=t<<0;const i=a>>23&255;return a&&2147483648!==a?(2147483648&a?-1:1)*(8388608|8388607&a)*Math.pow(2,i-127-23):0}incrementOffset(t,e){this.byte_offset+=t,this.bit_offset+=e,this.byteCarry()}setOffset(t,e){this.byte_offset=t,this.bit_offset=e}}class SwfParser{constructor(){this.byteStream=new ByteStream,this.currentPosition={x:0,y:0},this.jpegTables=null,this.characters=[],this.frameInfo=[],this.fonts=new Map,this.textSettings=new Map,this.grids=new Map,this.version=0}clear(){this.byteStream.clear(),this.currentPosition.x=0,this.currentPosition.y=0,this.jpegTables=null,this.characters.length=0,this.frameInfo.length=0,this.version=0}getCharacter(t){return this.characters[t]}setCharacter(t,e,s){this.characters[t]=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:e},s)}getFont(t){return this.fonts.get(t)}setFont(t,e){this.fonts.set(t,e)}setTextSetting(t,e){this.textSettings.set(t,e)}setGrid(t,e){this.grids.set(t,e)}showFrame(t,e,s,a){let i,r;const h=s-1|0,o=e.frameLabel;i=o.length;for(let e=0;e<i;++e){const a=o[e];a.name in this.frameInfo&&(a.frame=this.frameInfo["@"+a.name]),t._$labels.push({label:a.name,frame:a.frame||s})}const n=e.sounds;i=0|n.length,i&&t._$sounds.push({frame:s,data:n.slice(0)});const l=e.removeObjects;i=l.length;for(let e=0;e<i;++e){const a=l[e],i=Util.$getControllerAt(t,h,a.Depth);t._$dictionary[i].EndFrame=s,Util.$installed.set(a.Depth,1)}s in a||(a[s]=[]),s in t._$controller||(t._$controller[s]=[]),s in t._$placeMap||(t._$placeMap[s]=[]);const c=e.placeObjects,b=h?a[h]:null;i=c.length;for(let e=0;e<i;++e){let i=null;const r=c[e];let o=null;h&&r.Depth in b&&(o=b[r.Depth]),0===r.PlaceFlagHasCharacter&&o&&(r.CharacterId=o.CharacterId);let n=!1;if((0===r.PlaceFlagMove||1===r.PlaceFlagMove&&1===r.PlaceFlagHasCharacter)&&(n=!0),h&&!n&&(i=Util.$getControllerAt(t,h,r.Depth),null===i&&(n=!0)),1===r.PlaceFlagMove&&o&&(1!==o.PlaceFlagHasMatrix||r.PlaceFlagHasMatrix||(r.PlaceFlagHasMatrix=1,r.Matrix=o.Matrix),1!==o.PlaceFlagHasColorTransform||r.PlaceFlagHasColorTransform||(r.PlaceFlagHasColorTransform=1,r.ColorTransform=o.ColorTransform),1!==o.PlaceFlagHasClipDepth||r.PlaceFlagHasClipDepth||(r.PlaceFlagHasClipDepth=1,r.ClipDepth=o.ClipDepth),1!==o.PlaceFlagHasRatio||r.PlaceFlagHasRatio||(r.PlaceFlagHasRatio=1,r.Ratio=o.Ratio),1!==o.PlaceFlagHasFilterList||r.PlaceFlagHasFilterList||(r.PlaceFlagHasFilterList=1,r.SurfaceFilterList=o.SurfaceFilterList),1!==o.PlaceFlagHasBlendMode||r.PlaceFlagHasBlendMode||(r.PlaceFlagHasBlendMode=1,r.BlendMode=o.BlendMode)),h&&!Util.$installed.has(r.Depth)){const e=Util.$getControllerAt(t,h,r.Depth);if(null!==e){const a=t._$dictionary[e];!a||0!==r.PlaceFlagMove&&1!==r.PlaceFlagHasCharacter||(a.EndFrame=0|s,t._$dictionary[e]=a,n=!0)}}if(n){if(r.StartFrame=0|s,r.EndFrame=0,1===r.PlaceFlagHasCharacter&&1===r.PlaceFlagMove){const e=Util.$getControllerAt(t,h,r.Depth),a=t._$dictionary[e];a.EndFrame=0|s,t._$dictionary[e]=a}i=Util.$addDictionary(t,r)}t._$controller[s][r.Depth]=i;const l=t._$placeObjects.length;t._$placeObjects[l]=this.buildPlaceObject(r),t._$placeMap[s][r.Depth]=l,Util.$installed.set(r.Depth,1),a[s][r.Depth]=r}if(h){let e;const o=t._$controller[h];r=Object.keys(o),i=r.length;for(let n=0;n<i;++n)e=0|r[n],Util.$installed.has(e)||(a[s][e]=a[h][e],t._$controller[s][e]=o[e]);const n=t._$placeMap[h];r=Object.keys(n),i=r.length;for(let a=0;a<i;++a)e=r[a],e in t._$placeMap[s]||(t._$placeMap[s][e]=n[e])}Util.$installed.clear()}buildPlaceObject(t){const e={matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],filters:null,blendMode:"normal"};return t.PlaceFlagHasMatrix&&(e.matrix=t.Matrix),t.PlaceFlagHasColorTransform&&(e.colorTransform=t.ColorTransform),t.PlaceFlagHasFilterList&&(e.surfaceFilterList=t.SurfaceFilterList),t.PlaceFlagHasBlendMode&&(e.blendMode=Util.$getBlendName(t.BlendMode)),t.PlaceFlagHasRatio&&(e.ratio=t.Ratio||0),e}postData(t){if(this.textSettings.size){for(let[t,e]of this.textSettings){const s=this.characters[t];s&&(s._$textSetting=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:s}))}this.textSettings.clear()}if(this.grids.size){for(let[t,e]of this.grids){const s=this.characters[t];s&&(s._$grid=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:s}))}this.grids.clear()}if(this.fonts.size){for(let[t,e]of this.fonts){if(!e._$hasLayout){globalThis.postMessage({infoKey:"font",index:t,piece:e});continue}const s=e._$glyphShapeTable,a=e._$zoneTable;e._$glyphShapeTable=[],e._$zoneTable=a?[]:null,globalThis.postMessage({infoKey:"font",index:t,piece:e},[e._$advanceTable.buffer,e._$codeTable.buffer]);const i=s.length;if(i){const e=[],a=[];for(let r=0;r<i;++r){const i=s[r];e.push(i),a.push(i.records.buffer),e.length>256&&(globalThis.postMessage({infoKey:"font_shape",index:t,pieces:e},a),a.length=0,e.length=0)}e.length&&globalThis.postMessage({infoKey:"font_shape",index:t,pieces:e},a)}if(a)for(;a.length;){const e=Math.min(256,a.length);globalThis.postMessage({infoKey:"font_zone",index:t,pieces:a.splice(0,e)})}}this.fonts.clear()}for(let e=1;e<t._$controller.length;++e){const s=t._$controller[e];t._$controller[e]=s.filter((()=>!0))}this.setCharacter(0,t)}parseTags(t,e){const s=Util.$getTagObject();let a=1;const i=[],r=this.byteStream;for(;r.byte_offset<t;){const h=r.byte_offset;if(h+2>t)break;const o=r.getUI16(),n=o>>6;let l=63&o;if(63===l){if(h+6>t){r.byte_offset=h,r.bit_offset=0;break}l=r.getUI32()}const c=r.byte_offset;this.parseTag(n,l,e,a,s,i),1===n&&(++a,s.placeObjects.length=0,s.sounds.length=0,s.removeObjects.length=0,s.frameLabel.length=0);const b=r.byte_offset-c|0;b!==l&&b<l&&(r.byte_offset=r.byte_offset+(l-b)),r.bit_offset=0}Util.$poolTagObject(s)}parseTag(t,e,s,a,i,r){switch(t){case 28:i.removeObjects.push({Frame:a,Depth:this.byteStream.getUI16()});break;case 4:case 26:case 70:i.placeObjects.push(this.parsePlaceObject(t,e));break;case 39:{const t=this.byteStream.byte_offset+e,s=this.byteStream.getUI16();this.byteStream.getUI16();const a=Util.$createMovieClip();a._$characterId=s,this.parseTags(t,a);for(let t=1;t<a._$controller.length;++t){const e=a._$controller[t];a._$controller[t]=e.filter((()=>!0))}this.setCharacter(s,a)}break;case 1:this.showFrame(s,i,a,r);break;case 2:case 22:case 32:case 83:e<10?this.byteStream.byte_offset+=e:this.parseDefineShape(t);break;case 20:case 36:this.parseDefineBitsLossLess(t,e);break;case 6:case 21:case 35:case 90:this.parseDefineBits(t,e,this.jpegTables);break;case 15:case 89:i.sounds.push(this.parseStartSound(t));break;case 10:case 48:case 75:this.parseDefineFont(t,e);break;case 14:this.parseDefineSound(e);break;case 13:case 62:this.parseDefineFontInfo(t,e);break;case 43:i.frameLabel.push(this.parseFrameLabel());break;case 11:case 33:this.parseDefineText(t);break;case 37:this.parseDefineEditText(t);break;case 7:case 34:this.parseDefineButton(t,e);break;case 88:this.parseDefineFontName();break;case 8:e&&(this.jpegTables=this.parseJPEGTables(e));break;case 46:case 84:this.parseDefineMorphShape(t);break;case 18:case 45:this.parseSoundStreamHead(t);break;case 17:this.parseDefineButtonSound();break;case 73:this.parseDefineFontAlignZones();break;case 74:this.parseCSMTextSettings(t);break;case 19:this.parseSoundStreamBlock(t,e);break;case 78:this.parseDefineScalingGrid();break;case 5:console.log("TODO RemoveObject type 5."),i.removeObjects.push({CharacterId:this.byteStream.getUI16(),Depth:this.byteStream.getUI16()});break;case 76:this.parseSymbolClass();break;case 0:case 27:case 30:case 67:case 68:case 79:case 80:case 81:case 85:case 92:default:break;case 86:case 56:case 9:case 40:case 24:case 63:case 64:case 69:case 65:case 77:case 60:case 61:case 41:case 87:case 59:case 12:case 72:case 82:this.byteStream.byte_offset+=e;break;case 3:case 16:case 23:case 25:case 29:case 31:case 38:case 42:case 44:case 47:case 49:case 52:case 53:case 54:case 55:case 57:case 58:case 66:case 71:case 91:case 93:console.log("[TODO] tagType -> "+t)}}parseSymbolClass(){const t=this.byteStream.getUI16();if(t){const e=[];for(let s=0;s<t;++s){const t=this.byteStream.getUI16(),s=this.byteStream.getDataUntil();e[e.length]={tagId:t,ns:s},128===e.length&&(globalThis.postMessage({infoKey:"_$symbols",pieces:e}),e.length=0)}e.length&&globalThis.postMessage({infoKey:"_$symbols",pieces:e})}}parseDefineShape(t){const e=0|this.byteStream.getUI16(),s=this.rect();if(83===t){const t={};this.rect(),this.byteStream.getUIBits(5),t.UsesFillWindingRule=this.byteStream.getUIBits(1),t.UsesNonScalingStrokes=this.byteStream.getUIBits(1),t.UsesScalingStrokes=this.byteStream.getUIBits(1)}const a=this.shapeWithStyle(t);this.setCharacter(e,{_$records:a,_$name:"Shape",_$bounds:s,_$characterId:e},[a.ShapeData.records.buffer])}rect(){this.byteStream.byteAlign();const t=this.byteStream.getUIBits(5);return{xMin:this.byteStream.getSIBits(t)/20,xMax:this.byteStream.getSIBits(t)/20,yMin:this.byteStream.getSIBits(t)/20,yMax:this.byteStream.getSIBits(t)/20}}shapeWithStyle(t){const e={};switch(t){case 46:case 84:break;default:e.fillStyles=this.fillStyleArray(t),e.lineStyles=this.lineStyleArray(t)}const s=this.byteStream.getUI8(),a=s>>4,i=15&s;return e.ShapeData=this.shapeRecords(t,{FillBits:a,LineBits:i}),e}fillStyleArray(t){let e=0|this.byteStream.getUI8();t>2&&255===e&&(e=this.byteStream.getUI16());const s=[];for(let a=0;a<e;++a)s[s.length]=this.fillStyle(t);return s}fillStyle(t){const e=this.byteStream.getUI8(),s={};switch(s.fillStyleType=e,e){case 0:switch(t){case 32:case 83:s.Color=this.rgba();break;case 46:case 84:s.StartColor=this.rgba(),s.EndColor=this.rgba();break;default:s.Color=this.rgb()}break;case 16:case 18:switch(t){case 46:case 84:s.startGradientMatrix=this.matrix(),s.endGradientMatrix=this.matrix(),s.gradient=this.gradient(t);break;default:s.gradientMatrix=this.matrix(),s.gradient=this.gradient(t)}break;case 19:s.gradientMatrix=this.matrix(),s.gradient=this.focalGradient(t);break;case 64:case 65:case 66:case 67:switch(s.bitmapId=this.byteStream.getUI16(),t){case 46:case 84:s.startBitmapMatrix=this.matrix(),s.endBitmapMatrix=this.matrix();break;default:s.bitmapMatrix=this.matrix()}}return s}rgb(){return{R:0|this.byteStream.getUI8(),G:0|this.byteStream.getUI8(),B:0|this.byteStream.getUI8(),A:1}}rgba(){return{R:this.byteStream.getUI8(),G:this.byteStream.getUI8(),B:this.byteStream.getUI8(),A:this.byteStream.getUI8()/255}}matrix(){this.byteStream.byteAlign();const t=[1,0,0,1,0,0];if(this.byteStream.getUIBit()){const e=this.byteStream.getUIBits(5);t[0]=this.byteStream.getSIBits(e)/65536,t[3]=this.byteStream.getSIBits(e)/65536}if(this.byteStream.getUIBit()){const e=this.byteStream.getUIBits(5);t[1]=this.byteStream.getSIBits(e)/65536,t[2]=this.byteStream.getSIBits(e)/65536}const e=this.byteStream.getUIBits(5);return t[4]=this.byteStream.getSIBits(e)/20,t[5]=this.byteStream.getSIBits(e)/20,t}gradient(t){let e,s=0,a=0;switch(this.byteStream.byteAlign(),t){case 46:case 84:e=this.byteStream.getUI8();break;default:s=this.byteStream.getUIBits(2),a=this.byteStream.getUIBits(2),e=this.byteStream.getUIBits(4)}const i=[];for(let s=0;s<e;++s)i[i.length]=this.gradientRecord(t);return{SpreadMode:s,InterpolationMode:a,GradientRecords:i,FocalPoint:0}}gradientRecord(t){switch(t){case 46:case 84:return{StartRatio:this.byteStream.getUI8()/255,StartColor:this.rgba(),EndRatio:this.byteStream.getUI8()/255,EndColor:this.rgba()};default:return{Ratio:this.byteStream.getUI8()/255,Color:t<32?this.rgb():this.rgba()}}}focalGradient(t){this.byteStream.byteAlign();const e=this.byteStream.getUIBits(2),s=this.byteStream.getUIBits(2),a=this.byteStream.getUIBits(4),i=[];for(let e=0;e<a;++e)i[i.length]=this.gradientRecord(t);return{SpreadMode:e,InterpolationMode:s,GradientRecords:i,FocalPoint:this.byteStream.getFloat16()}}lineStyleArray(t){let e=this.byteStream.getUI8();t>2&&255===e&&(e=this.byteStream.getUI16());const s=[];for(let a=0;a<e;++a)s[s.length]=this.lineStyles(t);return s}lineStyles(t){const e={fillStyleType:0};switch(t){case 46:e.StartWidth=this.byteStream.getUI16()/20,e.EndWidth=this.byteStream.getUI16()/20,e.StartColor=this.rgba(),e.EndColor=this.rgba();break;case 84:e.StartWidth=this.byteStream.getUI16()/20,e.EndWidth=this.byteStream.getUI16()/20,e.StartCapStyle=this.byteStream.getUIBits(2),e.JoinStyle=this.byteStream.getUIBits(2),e.HasFillFlag=this.byteStream.getUIBit(),e.NoHScaleFlag=this.byteStream.getUIBit(),e.NoVScaleFlag=this.byteStream.getUIBit(),e.PixelHintingFlag=this.byteStream.getUIBit(),this.byteStream.getUIBits(5),e.NoClose=this.byteStream.getUIBit(),e.EndCapStyle=this.byteStream.getUIBits(2),2===e.JoinStyle&&(e.MiterLimitFactor=this.byteStream.getUI16()/20),e.HasFillFlag?e.FillType=this.fillStyle(t):(e.StartColor=this.rgba(),e.EndColor=this.rgba());break;case 83:e.Width=this.byteStream.getUI16()/20,e.StartCapStyle=this.byteStream.getUIBits(2),e.JoinStyle=this.byteStream.getUIBits(2),e.HasFillFlag=this.byteStream.getUIBit(),e.NoHScaleFlag=this.byteStream.getUIBit(),e.NoVScaleFlag=this.byteStream.getUIBit(),e.PixelHintingFlag=this.byteStream.getUIBit(),this.byteStream.getUIBits(5),e.NoClose=this.byteStream.getUIBit(),e.EndCapStyle=this.byteStream.getUIBits(2),2===e.JoinStyle&&(e.MiterLimitFactor=this.byteStream.getUI16()),e.HasFillFlag?e.FillType=this.fillStyle(t):e.Color=this.rgba();break;case 32:e.Width=this.byteStream.getUI16()/20,e.Color=this.rgba(),e.JoinStyle=0,e.StartCapStyle=0,e.EndCapStyle=0;break;default:e.Width=this.byteStream.getUI16()/20,e.Color=this.rgb(),e.JoinStyle=0,e.StartCapStyle=0,e.EndCapStyle=0}return e}shapeRecords(t,e){this.currentPosition.x=0,this.currentPosition.y=0;const s=[],a=[];for(;;){const i=this.byteStream.getUIBits(6);if(32&i){const e=15&i;if(16&i){this.straightEdgeRecord(t,e,s);continue}this.curvedEdgeRecord(t,e,s)}else{if(!i){s.push(-1),this.byteStream.byteAlign();break}this.styleChangeRecord(t,i,e,s,a)}}const i={records:new Int32Array(s)};return a.length&&(i.styles=a),i}straightEdgeRecord(t,e,s){let a=0,i=0;this.byteStream.getUIBit()?(a=this.byteStream.getSIBits(e+2),i=this.byteStream.getSIBits(e+2)):this.byteStream.getUIBit()?i=this.byteStream.getSIBits(e+2):a=this.byteStream.getSIBits(e+2);let r=a,h=i;switch(t){case 46:case 84:break;default:r=this.currentPosition.x+a,h=this.currentPosition.y+i,this.currentPosition.x=r,this.currentPosition.y=h}s.push(0,0,r,h)}curvedEdgeRecord(t,e,s){const a=this.byteStream.getSIBits(e+2),i=this.byteStream.getSIBits(e+2),r=this.byteStream.getSIBits(e+2),h=this.byteStream.getSIBits(e+2);let o=a,n=i,l=r,c=h;switch(t){case 46:case 84:break;default:o=this.currentPosition.x+a,n=this.currentPosition.y+i,l=o+r,c=n+h,this.currentPosition.x=l,this.currentPosition.y=c}s.push(0,1,o,n,l,c)}styleChangeRecord(t,e,s,a,i){const r=e>>4&1,h=e>>3&1,o=e>>2&1,n=e>>1&1,l=1&e;let c=0,b=0;if(l){const t=this.byteStream.getUIBits(5);c=this.byteStream.getSIBits(t),b=this.byteStream.getSIBits(t),this.currentPosition.x=c,this.currentPosition.y=b}const g=n?this.byteStream.getUIBits(s.FillBits):0,y=o?this.byteStream.getUIBits(s.FillBits):0,S=h?this.byteStream.getUIBits(s.LineBits):0;let m=null,f=null,d=0,Y=0;if(r){m=this.fillStyleArray(t),f=this.lineStyleArray(t);const e=this.byteStream.getUI8();s.FillBits=d=e>>4,s.LineBits=Y=15&e}a.push(1,r),r&&(a.push(d,Y),i.push({FillStyles:m,LineStyles:f})),a.push(l),l&&a.push(c,b),a.push(n),n&&a.push(g),a.push(o),o&&a.push(y),a.push(h),h&&a.push(S)}parseDefineBitsLossLess(t,e){const s=this.byteStream.byte_offset,a=this.byteStream.getUI16(),i=this.byteStream.getUI8(),r=this.byteStream.getUI16(),h=this.byteStream.getUI16(),o=36===t,n=3===i?this.byteStream.getUI8()+1:0;let l=r*h*4;if(3===i){l=(r+((r+3&-4)-r|0))*h+n*(o?4:3)}const c=e-(this.byteStream.byte_offset-s),b=this.byteStream.byte_offset;this.byteStream.byte_offset+=c;const g=this.byteStream.data.slice(b,this.byteStream.byte_offset),y={width:r,height:h,format:i,fileSize:l,tableSize:n,isAlpha:o,color:o?4278190080:0,_$name:"lossless",_$characterId:a,buffer:g};this.setCharacter(a,y,[g.buffer])}parseJPEGTables(t){const e=this.byteStream.byte_offset;return this.byteStream.byte_offset+=t,{offset:e,length:this.byteStream.byte_offset}}parseDefineBits(t,e,s=null){const a=this.byteStream.byte_offset,i=this.byteStream.getUI16(),r=this.byteStream.byte_offset-a,h=35===t||90===t?this.byteStream.getUI32():e-r;if(90===t){const t=this.byteStream.getUI16();console.log("TODO DeblockParam",t)}const o=this.byteStream.byte_offset;this.byteStream.byte_offset+=h;let n=this.byteStream.data.slice(o,this.byteStream.byte_offset);if(s){const t=this.byteStream.data.subarray(s.offset,s.length);if(t.length>4&&255===n[0]&&216===n[1]){const e=t.length-2,s=n.length,a=new Uint8Array(e+s);a.set(t.subarray(0,e),0),a.set(n.subarray(2,s),e),n=a}}const l={infoKey:"character",_$name:"imageData",_$characterId:i,jpegData:n,alphaData:null},c=[];c.push(n.buffer);let b=!1;const g=a+e-this.byteStream.byte_offset;if(g){b=!0;const t=this.byteStream.byte_offset;this.byteStream.byte_offset+=g;const e=this.byteStream.data.slice(t,this.byteStream.byte_offset);l.alphaData=e,c.push(e.buffer)}l.isAlpha=b,l.color=b?4278190080:0,this.setCharacter(i,l,c)}parseDefineFont(t,e){const s=this.byteStream.byte_offset+e|0,a=this.byteStream.getUI16(),i=this.getFont(a)||{};let r=0,h=0,o=0;if(48===t||75===t){const t=this.byteStream.getUI8();i._$hasLayout=t>>>7&1,i._$shiftJIS=t>>>6&1,i._$smallText=t>>>5&1,i._$ANSI=t>>>4&1,h=t>>>3&1,o=t>>>2&1,i._$italic=t>>>1&1,i._$bold=1&t,this.byteStream.byteAlign(),i._$languageCode=this.byteStream.getUI8();const e=this.byteStream.getUI8();if(e){const t=0|this.byteStream.byte_offset;i._$fontName=this.getFontName(this.byteStream.getDataUntil()),this.byteStream.byte_offset=t+e|0}r=this.byteStream.getUI16(),i._$numGlyphs=r}const n=0|this.byteStream.byte_offset;if(10===t&&(r=this.byteStream.getUI16()),r){const e=[];10===t&&(e[0]=r,r/=2,r-=1);let s=0;if(1===h){for(let t=0;t<r;++t)e[e.length]=this.byteStream.getUI32();10!==t&&(s=this.byteStream.getUI32())}else{for(let t=0;t<r;++t)e[e.length]=this.byteStream.getUI16();10!==t&&(s=this.byteStream.getUI16())}const a=[];10===t&&(r+=1);for(let s=0;s<r;++s){this.byteStream.setOffset(e[s]+n,0);const i=this.byteStream.getUI8(),r={FillBits:i>>4,LineBits:15&i};a[a.length]=this.shapeRecords(t,r)}switch(i._$glyphShapeTable=a,t){case 48:case 75:if(this.byteStream.setOffset(s+n,0),1===o){const t=new Uint16Array(r);for(let e=0;e<r;++e)t[e]=this.byteStream.getUI16();i._$codeTable=t}else{const t=new Uint8Array(r);for(let e=0;e<r;++e)t[e]=this.byteStream.getUI8();i._$codeTable=t}if(i._$hasLayout){i._$ascent=this.byteStream.getUI16(),i._$descent=this.byteStream.getUI16(),i._$leading=this.byteStream.getUI16();const e=new Uint16Array(r);for(let t=0;t<r;++t)e[t]=this.byteStream.getUI16();i._$advanceTable=e;const s=[];for(let t=0;t<r;++t)s[s.length]=this.rect();if(75===t){const t=this.byteStream.getUI16(),e=[];for(let s=0;s<t;++s){const t=o?this.byteStream.getUI16():this.byteStream.getUI8(),s=o?this.byteStream.getUI16():this.byteStream.getUI8(),a=this.byteStream.getSIBits(16);e[e.length]={FontKerningCode1:t,FontKerningCode2:s,FontKerningAdjustment:a}}i._$kerningRecords=e}}}}this.byteStream.byte_offset=0|s,this.setFont(a,i)}parseDefineFontInfo(t,e){const s=this.byteStream.byte_offset+e|0,a=this.byteStream.getUI16();let i=this.getFont(a);i||(i={});const r=this.byteStream.getUI8(),h=this.byteStream.getData(r);let o="";for(let t=0;t<r;++t)h[t]>127||(o+=String.fromCharCode(h[t]));this.byteStream.getUIBits(2),i._$smallText=this.byteStream.getUIBits(1),i._$shiftJIS=this.byteStream.getUIBits(1),i._$ANSI=this.byteStream.getUIBits(1),i._$italic=this.byteStream.getUIBits(1),i._$bold=this.byteStream.getUIBits(1);const n=this.byteStream.getUIBits(1);62===t&&(i._$languageCode=this.byteStream.getUI8());const l=i._$shiftJIS||2===i._$languageCode?Util.$decodeToShiftJis(o):decodeURIComponent(o);i._$fontName=this.getFontName(l),this.byteStream.byteAlign();const c=[];let b=null;if(!0==(1===n||62===t)){for(;this.byteStream.byte_offset<s;)c[c.length]=this.byteStream.getUI16();b=new Uint16Array(c)}else{for(;this.byteStream.byte_offset<s;)c[c.length]=this.byteStream.getUI8();b=new Uint8Array(c)}i._$codeTable=b,this.setFont(a,i)}getFontName(t){const e=0|t.length;switch(0===t.substr(e-1).charCodeAt(0)&&(t=t.slice(0,-1)),t){case"_sans":return"_sans";case"_serif":return"_serif";case"_typewriter":return"_typewriter";case"_等幅":return"Osaka";default:return"_"===t.substr(0,1)?"sans-serif":t}}parseDefineFontName(){this.byteStream.getUI16(),this.byteStream.getDataUntil(),this.byteStream.getDataUntil()}parseDefineText(t){const e={_$name:"StaticText"};e._$characterId=0|this.byteStream.getUI16(),e._$bounds=this.rect(),e._$baseMatrix=this.matrix(),e._$shapeRecords=null;const s=this.byteStream.getUI8(),a=this.byteStream.getUI8();e._$textRecords=this.getTextRecords(t,s,a),this.setCharacter(e._$characterId,e)}getTextRecords(t,e,s){const a=[];for(;0!==this.byteStream.getUI8();){this.byteStream.incrementOffset(-1,0);const i={};i.TextRecordType=this.byteStream.getUIBits(1),i.StyleFlagsReserved=this.byteStream.getUIBits(3),i.StyleFlagsHasFont=this.byteStream.getUIBits(1),i.StyleFlagsHasColor=this.byteStream.getUIBits(1),i.StyleFlagsHasYOffset=this.byteStream.getUIBits(1),i.StyleFlagsHasXOffset=this.byteStream.getUIBits(1),i.StyleFlagsHasFont&&(i.FontId=this.byteStream.getUI16()),i.StyleFlagsHasColor&&(i.TextColor=11===t?this.rgb():this.rgba()),i.StyleFlagsHasXOffset&&(i.XOffset=this.byteStream.getUI16()/20),i.StyleFlagsHasYOffset&&(i.YOffset=this.byteStream.getUI16()/20),i.StyleFlagsHasFont&&(i.TextHeight=this.byteStream.getUI16()),i.GlyphCount=this.byteStream.getUI8(),i.GlyphEntries=this.getGlyphEntries(i.GlyphCount,e,s),a[a.length]=i}return a}getGlyphEntries(t,e,s){const a=[];for(let i=0;i<t;++i)a[a.length]={GlyphIndex:this.byteStream.getUIBits(e),GlyphAdvance:this.byteStream.getSIBits(s)/20};return a}parseDefineEditText(){const t={_$ns:["flash","text"],_$name:"TextField"},e={},s=this.byteStream.getUI16();t._$characterId=s,t._$bounds=this.rect();const a=this.byteStream.getUI8(),i=a>>>7&1;t._$wordWrap=a>>>6&1,t._$multiline=a>>>5&1,t._$displayAsPassword=a>>>4&1;const r=a>>>3&1;t._$type="dynamic",r||(t._$type="input");const h=a>>>2&1,o=a>>>1&1,n=1&a,l=this.byteStream.getUI8(),c=l>>>7&1,b=l>>>5&1;t._$selectable=l>>>4&1,t._$border=l>>>3&1;const g=l>>>1&1,y=1&l;t._$border&&(t._$background=!0);let S=0;if(n){const s=this.byteStream.getUI16(),a=this.getFont(s);if(a){if(S=a._$shiftJIS,c){const t=this.byteStream.getDataUntil();console.log("TODO HasFontClass: ",t)}e._$font=a._$fontName,e._$size=this.byteStream.getUI16()/20,t._$fontId=0|s,t._$embedFonts=!(!y&&"embedded"!==a.fontType||t.displayAsPassword)}}if(h){const e=this.rgba();t._$textColor=(e.R<<16)+(e.G<<8)+e.B+255*e.A*16777216}if(o&&(t._$maxChars=this.byteStream.getUI16()),b){switch(this.byteStream.getUI8()){case 0:e._$align="left";break;case 1:e._$align="right";break;case 2:e._$align="center";break;case 3:e._$align="justify"}e._$leftMargin=this.byteStream.getUI16()/20,e._$rightMargin=this.byteStream.getUI16()/20,e._$indent=this.byteStream.getUI16(),e._$indent>=32768&&(e._$indent-=65536),e._$leading=this.byteStream.getUI16(),e._$leading>=32768&&(e._$leading-=65536),e._$indent/=20,e._$leading/=20}const m=this.byteStream.getDataUntil(S)+"";if(t._$text="",i){const e=this.byteStream.getDataUntil(S);if(!0==(1===g))t._$htmlText=e,t._$initText=!0;else t._$text=e}""!==m&&console.log("VariableName: ",m),t._$defaultTextFormat=[null,e._$font,e._$size,e._$color,e._$bold,e._$italic,e._$underline,e._$url,e._$target,e._$align,e._$leftMargin,e._$rightMargin,0,e._$leading,e._$indent],this.setCharacter(s,t)}parseDefineMorphShape(t){const e={};e.CharacterId=this.byteStream.getUI16(),e.StartBounds=this.rect(),e.EndBounds=this.rect(),84===t&&(e.StartEdgeBounds=this.rect(),e.EndEdgeBounds=this.rect(),this.byteStream.getUIBits(6),e.UsesNonScalingStrokes=this.byteStream.getUIBits(1),e.UsesScalingStrokes=this.byteStream.getUIBits(1));const s=this.byteStream.getUI32(),a=this.byteStream.byte_offset+s;e.MorphFillStyles=this.fillStyleArray(t),e.MorphLineStyles=this.lineStyleArray(t),e.StartEdges=this.shapeWithStyle(t),this.byteStream.byte_offset!==a&&(this.byteStream.byte_offset=a),e.EndEdges=this.shapeWithStyle(t);const i={x:0,y:0},r={x:0,y:0},h=e.StartEdges.ShapeData.records,o=e.EndEdges.ShapeData.records,n=h.length,l=o.length;let c=Math.max(n,l);const b=[],g=[];let y=0,S=0;for(;c>y||c>S;){const t=h[y++],e=o[S++];if(-1===t&&-1===e)break;switch(!0){case-1===t:case void 0===t:if(e){const t=o[S++];if(g.push(1,t),b.push(1,t),t){const t=o[S++],e=o[S++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=o[S++];if(g.push(e),b.push(e),e){const t=o[S++],e=o[S++];r.x=t,r.y=e,g.push(t,e),b.push(t,e)}const s=o[S++];if(g.push(s),b.push(s),s){const t=o[S++];g.push(t),b.push(t)}const a=o[S++];if(g.push(a),b.push(a),a){const t=o[S++];g.push(t),b.push(t)}const i=o[S++];if(g.push(i),b.push(i),i){const t=o[S++];g.push(t),b.push(t)}break}if(o[S++]){const t=o[S++],e=o[S++],s=o[S++],a=o[S++];r.x+=t+s,r.y+=e+a,g.push(0,1,t,e,s,a),b.push(0,1,t,e,s,a)}else{const t=o[S++],e=o[S++];r.x+=t,r.y+=e,g.push(0,0,t,e),b.push(0,0,t,e)}break;case-1===e:case void 0===e:if(t){const t=h[y++];if(g.push(1,t),b.push(1,t),t){const t=h[y++],e=h[y++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=h[y++];if(g.push(e),b.push(e),e){const t=h[y++],e=h[y++];i.x=t,i.y=e,g.push(t,e),b.push(t,e)}const s=h[y++];if(g.push(s),b.push(s),s){const t=h[y++];g.push(t),b.push(t)}const a=h[y++];if(g.push(a),b.push(a),a){const t=h[y++];g.push(t),b.push(t)}const r=h[y++];if(g.push(r),b.push(r),r){const t=h[y++];g.push(t),b.push(t)}break}if(h[y++]){const t=h[y++],e=h[y++],s=h[y++],a=h[y++];i.x+=t+s,i.y+=e+a,g.push(0,1,t,e,s,a),b.push(0,1,t,e,s,a)}else{const t=h[S++],e=h[S++];i.x+=t,i.y+=e,g.push(0,0,t,e),b.push(0,0,t,e)}break;case 1===t&&1===e:const s=h[y++];if(b.push(1,s),s){const t=h[y++],e=h[y++];b.push(t,e),console.log("TODO Parse Morph NewStyles")}const a=h[y++];if(b.push(a),a){const t=h[y++],e=h[y++];i.x=t,i.y=e,b.push(t,e)}const n=h[y++];if(b.push(n),n){const t=h[y++];b.push(t)}const l=h[y++];if(b.push(l),l){const t=h[y++];b.push(t)}const c=h[y++];if(b.push(c),c){const t=h[y++];b.push(t)}const m=o[S++];if(g.push(1,m),m){const t=o[S++],e=o[S++];g.push(t,e),console.log("TODO Parse Morph NewStyles")}const f=o[S++];if(g.push(f),f){const t=o[S++],e=o[S++];i.x=t,i.y=e,g.push(t,e)}const d=o[S++];if(g.push(d),d){const t=o[S++];g.push(t)}const Y=o[S++];if(g.push(Y),Y){const t=o[S++];g.push(t)}const I=o[S++];if(g.push(I),I){const t=o[S++];g.push(t)}break;case 0===t&&0===e:if(h[y++]){const t=h[y++],e=h[y++],s=h[y++],a=h[y++];i.x=s,i.y=a,b.push(0,1,t,e,s,a)}else{const t=h[y++],e=h[y++];i.x=t,i.y=e,b.push(0,0,t,e)}if(o[S++]){const t=o[S++],e=o[S++],s=o[S++],a=o[S++];r.x=s,r.y=a,g.push(0,1,t,e,s,a)}else{const t=o[S++],e=o[S++];r.x=t,r.y=e,g.push(0,0,t,e)}break;case 1===t&&0===e:{const t=h[y++];if(g.push(1,t),b.push(1,t),t){const t=h[y++],e=h[y++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=h[y++];if(g.push(e),b.push(e),e){const t=h[y++],e=h[y++];i.x=t,i.y=e,g.push(t,e),b.push(t,e)}const s=h[y++];if(g.push(s),b.push(s),s){const t=h[y++];g.push(t),b.push(t)}const a=h[y++];if(g.push(a),b.push(a),a){const t=h[y++];g.push(t),b.push(t)}const r=h[y++];if(g.push(r),b.push(r),r){const t=h[y++];g.push(t),b.push(t)}--S}break;case 0===t&&1===e:{const t=o[S++];if(g.push(1,t),b.push(1,t),t){const t=o[S++],e=o[S++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=o[S++];if(g.push(e),b.push(e),e){const t=o[S++],e=o[S++];r.x=t,r.y=e,g.push(t,e),b.push(t,e)}const s=o[S++];if(g.push(s),b.push(s),s){const t=o[S++];g.push(t),b.push(t)}const a=o[S++];if(g.push(a),b.push(a),a){const t=o[S++];g.push(t),b.push(t)}const i=o[S++];if(g.push(i),b.push(i),i){const t=o[S++];g.push(t),b.push(t)}--y}}}b.push(-1),g.push(-1),e.StartEdges.ShapeData.records=new Int32Array(b),e.EndEdges.ShapeData.records=new Int32Array(g),this.setCharacter(e.CharacterId,{_$ns:["flash","display"],_$name:"MorphShape",_$characterId:e.CharacterId,_$endBounds:e.EndBounds,_$endEdges:e.EndEdges,_$fillStyles:e.MorphFillStyles,_$lineStyles:e.MorphLineStyles,_$startBounds:e.StartBounds,_$startEdges:e.StartEdges,_$shapes:null,_$frameData:[],_$frameCreated:!1},[e.StartEdges.ShapeData.records.buffer,e.EndEdges.ShapeData.records.buffer])}parseFrameLabel(){return{name:this.byteStream.getDataUntil(),frame:0}}parseDefineButton(t,e){const s=this.byteStream.byte_offset+e|0,a={_$ns:["flash","display"],_$name:"SimpleButton"};a._$characterId=0|this.byteStream.getUI16();let i=0;7!==t&&(this.byteStream.getUIBits(7),a._$trackAsMenu=!!this.byteStream.getUIBits(1),i=0|this.byteStream.getUI16()),a._$characters=this.buttonCharacters(s),7===t?(i=s-this.byteStream.byte_offset|0,this.byteStream.byte_offset+=i):i>0&&(a._$actions=this.buttonActions(s)),this.setCharacter(a._$characterId,a),this.byteStream.byte_offset!==s&&(this.byteStream.byte_offset=0|s)}buttonCharacters(t){const e=[];for(;0!==this.byteStream.getUI8();){this.byteStream.incrementOffset(-1,0);const s=0|this.byteStream.byte_offset,a=this.buttonRecord();if(this.byteStream.byte_offset>t){this.byteStream.byte_offset=0|s;break}e[e.length]=a}return e}buttonRecord(){this.byteStream.getUIBits(2);const t={};return t.PlaceFlagHasBlendMode=this.byteStream.getUIBits(1),t.PlaceFlagHasFilterList=this.byteStream.getUIBits(1),t.ButtonStateHitTest=this.byteStream.getUIBits(1),t.ButtonStateDown=this.byteStream.getUIBits(1),t.ButtonStateOver=this.byteStream.getUIBits(1),t.ButtonStateUp=this.byteStream.getUIBits(1),t.CharacterId=this.byteStream.getUI16(),t.Depth=this.byteStream.getUI16(),t.PlaceFlagHasMatrix=1,t.Matrix=this.matrix(),t.ColorTransform=this.colorTransform(),t.PlaceFlagHasColorTransform=void 0===t.ColorTransform?0:1,t.PlaceFlagHasBlendMode&&(t.BlendMode=this.byteStream.getUI8()),t.PlaceFlagHasFilterList&&(t.SurfaceFilterList=this.getFilterList()),t.PlaceFlagHasRatio=0,t.PlaceFlagHasClipDepth=0,t.Sound=null,t}buttonActions(t){for(;;){const e={},s=0|this.byteStream.byte_offset,a=this.byteStream.getUI16();e.CondIdleToOverDown=this.byteStream.getUIBits(1),e.CondOutDownToIdle=this.byteStream.getUIBits(1),e.CondOutDownToOverDown=this.byteStream.getUIBits(1),e.CondOverDownToOutDown=this.byteStream.getUIBits(1),e.CondOverDownToOverUp=this.byteStream.getUIBits(1),e.CondOverUpToOverDown=this.byteStream.getUIBits(1),e.CondOverUpToIdle=this.byteStream.getUIBits(1),e.CondIdleToOverUp=this.byteStream.getUIBits(1),e.CondKeyPress=this.byteStream.getUIBits(7),e.CondOverDownToIdle=this.byteStream.getUIBits(1);const i=t-this.byteStream.byte_offset+1|0;if(this.byteStream.byte_offset+=i,!a)break;this.byteStream.byte_offset=s+a|0}return[]}parsePlaceObject(t,e){const s=this.byteStream.byte_offset,a={};if(a.tagType=t,4===t)return a.CharacterId=this.byteStream.getUI16(),a.Depth=this.byteStream.getUI16(),a.Matrix=this.matrix(),a.PlaceFlagHasMatrix=1,this.byteStream.byteAlign(),this.byteStream.byte_offset-s<e&&(a.ColorTransform=this.colorTransform(),a.PlaceFlagHasColorTransform=1),this.byteStream.byteAlign(),this.byteStream.byte_offset=s+e,a;const i=this.swfVersion;if(a.PlaceFlagHasClipActions=this.byteStream.getUIBits(1),a.PlaceFlagHasClipDepth=this.byteStream.getUIBits(1),a.PlaceFlagHasName=this.byteStream.getUIBits(1),a.PlaceFlagHasRatio=this.byteStream.getUIBits(1),a.PlaceFlagHasColorTransform=this.byteStream.getUIBits(1),a.PlaceFlagHasMatrix=this.byteStream.getUIBits(1),a.PlaceFlagHasCharacter=this.byteStream.getUIBits(1),a.PlaceFlagMove=this.byteStream.getUIBits(1),70===t&&(this.byteStream.getUIBits(1),a.PlaceFlagOpaqueBackground=this.byteStream.getUIBits(1),a.PlaceFlagHasVisible=this.byteStream.getUIBits(1),a.PlaceFlagHasImage=this.byteStream.getUIBits(1),a.PlaceFlagHasClassName=this.byteStream.getUIBits(1),a.PlaceFlagHasCacheAsBitmap=this.byteStream.getUIBits(1),a.PlaceFlagHasBlendMode=this.byteStream.getUIBits(1),a.PlaceFlagHasFilterList=this.byteStream.getUIBits(1)),a.Depth=this.byteStream.getUI16(),a.PlaceFlagHasClassName&&(a.ClassName=this.byteStream.getDataUntil(),console.log("TODO ",a.ClassName)),a.PlaceFlagHasCharacter&&(a.CharacterId=this.byteStream.getUI16()),a.PlaceFlagHasMatrix&&(a.Matrix=this.matrix()),a.PlaceFlagHasColorTransform&&(a.ColorTransform=this.colorTransform()),a.PlaceFlagHasRatio&&(a.Ratio=this.byteStream.getUI16()),a.PlaceFlagHasName&&(a.Name=this.byteStream.getDataUntil()),a.PlaceFlagHasClipDepth&&(a.ClipDepth=this.byteStream.getUI16()),70===t&&(a.PlaceFlagHasFilterList&&(a.SurfaceFilterList=this.getFilterList()),a.PlaceFlagHasBlendMode&&(a.BlendMode=this.byteStream.getUI8()),a.PlaceFlagHasCacheAsBitmap&&(a.BitmapCache=this.byteStream.getUI8()),a.PlaceFlagHasVisible&&(a.Visible=this.byteStream.getUI8()),a.PlaceFlagOpaqueBackground&&(a.BackgroundColor=this.rgba())),a.PlaceFlagHasClipActions){this.byteStream.getUI16(),a.AllEventFlags=this.parseClipEventFlags();const t=s+e;for(;this.byteStream.byte_offset<t;){const e=this.parseClipActionRecord(t);if(t<=this.byteStream.byte_offset)break;if(!(i<=5?this.byteStream.getUI16():this.byteStream.getUI32()))break;this.byteStream.byte_offset-=i<=5?2:4,e.KeyCode&&(this.byteStream.byte_offset-=1)}}return this.byteStream.byteAlign(),this.byteStream.byte_offset=s+e,a}parseClipActionRecord(t){const e={},s=this.parseClipEventFlags();if(t>this.byteStream.byte_offset){const t=this.byteStream.getUI32();s.keyPress&&(e.KeyCode=this.byteStream.getUI8()),this.byteStream.byte_offset+=t}return e}parseClipEventFlags(){const t=this.swfVersion,e={};return e.keyUp=this.byteStream.getUIBits(1),e.keyDown=this.byteStream.getUIBits(1),e.mouseUp=this.byteStream.getUIBits(1),e.mouseDown=this.byteStream.getUIBits(1),e.mouseMove=this.byteStream.getUIBits(1),e.unload=this.byteStream.getUIBits(1),e.enterFrame=this.byteStream.getUIBits(1),e.load=this.byteStream.getUIBits(1),t>=6&&(e.dragOver=this.byteStream.getUIBits(1),e.rollOut=this.byteStream.getUIBits(1),e.rollOver=this.byteStream.getUIBits(1),e.releaseOutside=this.byteStream.getUIBits(1),e.release=this.byteStream.getUIBits(1),e.press=this.byteStream.getUIBits(1),e.initialize=this.byteStream.getUIBits(1)),e.data=this.byteStream.getUIBits(1),t>=6&&(this.byteStream.getUIBits(5),e.construct=this.byteStream.getUIBits(1),e.keyPress=this.byteStream.getUIBits(1),e.dragOut=this.byteStream.getUIBits(1),this.byteStream.getUIBits(8)),this.byteStream.byteAlign(),e}getFilterList(){const t=0|this.byteStream.getUI8(),e=[];for(let s=0;s<t;++s){const t=this.getFilter();t&&(e[e.length]=t)}return e.length?e:null}getFilter(){switch(0|this.byteStream.getUI8()){case 0:return this.dropShadowFilter();case 1:return this.blurFilter();case 2:return this.glowFilter();case 3:return this.bevelFilter();case 4:return this.gradientGlowFilter();case 5:return this.convolutionFilter();case 6:return this.colorMatrixFilter();case 7:return this.gradientBevelFilter()}}dropShadowFilter(){const t={},e=this.rgba(),s=e.A,a=e.R<<16|e.G<<8|e.B,i=this.byteStream.getUI32()/65536,r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536*Util.$Rad2Deg,o=this.byteStream.getUI32()/65536,n=this.byteStream.getFloat16()/256,l=!!this.byteStream.getUIBits(1),c=!!this.byteStream.getUIBits(1),b=!this.byteStream.getUIBits(1),g=this.byteStream.getUIBits(5);return t._$ns=["flash","filters"],t._$name="DropShadowFilter",t.params=[null,o,h,a,s,i,r,n,g,l,c,b],t}blurFilter(){const t={},e=this.byteStream.getUI32()/65536,s=this.byteStream.getUI32()/65536,a=this.byteStream.getUIBits(5);return this.byteStream.getUIBits(3),t._$ns=["flash","filters"],t._$name="BlurFilter",t.params=[null,e,s,a],t}glowFilter(){const t={},e=this.rgba(),s=e.A,a=e.R<<16|e.G<<8|e.B,i=this.byteStream.getUI32()/65536,r=this.byteStream.getUI32()/65536,h=this.byteStream.getFloat16()/256,o=!!this.byteStream.getUIBits(1),n=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const l=this.byteStream.getUIBits(5);return t._$ns=["flash","filters"],t._$name="GlowFilter",t.params=[null,a,s,i,r,h,l,o,n],t}bevelFilter(){const t={};let e=this.rgba();const s=e.A,a=e.R<<16|e.G<<8|e.B;e=this.rgba();const i=e.A,r=e.R<<16|e.G<<8|e.B,h=this.byteStream.getUI32()/65536,o=this.byteStream.getUI32()/65536,n=this.byteStream.getUI32()/65536*Util.$Rad2Deg,l=this.byteStream.getUI32()/65536,c=this.byteStream.getFloat16()/256,b=!!this.byteStream.getUIBits(1),g=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const y=this.byteStream.getUIBits(1),S=this.byteStream.getUIBits(4);let m="inner";return b||(m=y?"full":"outer"),t._$ns=["flash","filters"],t._$name="BevelFilter",t.params=[null,l,n,a,s,r,i,h,o,c,S,m,g],t}gradientGlowFilter(){const t={},e=0|this.byteStream.getUI8(),s=[],a=[];for(let t=0;t<e;++t){const t=this.rgba();a[a.length]=t.A,s[s.length]=t.R<<16|t.G<<8|t.B|0}const i=[];for(let t=0;t<e;++t)i[i.length]=+this.byteStream.getUI8()/255;const r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536,o=this.byteStream.getUI32()/65536*Util.$Rad2Deg,n=this.byteStream.getUI32()/65536,l=this.byteStream.getFloat16()/256,c=!!this.byteStream.getUIBits(1),b=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const g=this.byteStream.getUIBits(1),y=this.byteStream.getUIBits(4);let S="inner";return c||(S=g?"full":"outer"),t._$ns=["flash","filters"],t._$name="GradientGlowFilter",t.params=[null,n,o,s,a,i,r,h,l,y,S,b],t}convolutionFilter(){const t={},e=this.byteStream.getUI8(),s=this.byteStream.getUI8(),a=this.byteStream.getFloat32,i=this.byteStream.getFloat32,r=e*s,h=[];for(let t=0;t<r;++t)h[h.length]=this.byteStream.getFloat32();const o=this.rgba();this.byteStream.getUIBits(6);const n=!!this.byteStream.getUIBits(1),l=!!this.byteStream.getUIBits(1);return t._$ns=["flash","filters"],t._$name="ConvolutionFilter",t.params=[null,e,s,h,a,i,l,n,o],t}gradientBevelFilter(){const t={},e=0|this.byteStream.getUI8(),s=[],a=[];for(let t=0;t<e;++t){const t=this.rgba();a[a.length]=t.A,s[s.length]=t.R<<16|t.G<<8|t.B|0}const i=[];for(let t=0;t<e;++t)i[i.length]=+this.byteStream.getUI8()/255;const r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536,o=this.byteStream.getUI32()/65536*Util.$Rad2Deg,n=this.byteStream.getUI32()/65536,l=this.byteStream.getFloat16()/256,c=!!this.byteStream.getUIBits(1),b=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const g=this.byteStream.getUIBits(1),y=this.byteStream.getUIBits(4);let S="inner";return c||(S=g?"full":"outer"),t._$ns=["flash","filters"],t._$name="GradientBevelFilter",t.params=[null,n,o,s,a,i,r,h,l,y,S,b],t}colorMatrixFilter(){const t={},e=[];for(let t=0;t<20;t++)e[e.length]=this.byteStream.getFloat32();return t._$ns=["flash","filters"],t._$name="ColorMatrixFilter",t.params=[null,e],t}colorTransform(){this.byteStream.byteAlign();const t=[1,1,1,1,0,0,0,0],e=this.byteStream.getUIBits(6),s=e>>5,a=15&e;return e>>4&1&&(t[0]=this.byteStream.getSIBits(a)/256,t[1]=this.byteStream.getSIBits(a)/256,t[2]=this.byteStream.getSIBits(a)/256,t[3]=this.byteStream.getSIBits(a)/256),s&&(t[4]=this.byteStream.getSIBits(a),t[5]=this.byteStream.getSIBits(a),t[6]=this.byteStream.getSIBits(a),t[7]=this.byteStream.getSIBits(a)),t}parseSoundStreamHead(t){const e={};e.tagType=t,this.byteStream.getUIBits(4),e.PlaybackSoundRate=this.byteStream.getUIBits(2),e.PlaybackSoundSize=this.byteStream.getUIBits(1),e.PlaybackSoundType=this.byteStream.getUIBits(1),e.StreamSoundCompression=this.byteStream.getUIBits(4),e.StreamSoundRate=this.byteStream.getUIBits(2),e.StreamSoundSize=this.byteStream.getUIBits(1),e.StreamSoundType=this.byteStream.getUIBits(1),e.StreamSoundSampleCount=this.byteStream.getUI16(),2===e.StreamSoundCompression&&(e.LatencySeek=this.byteStream.getSIBits(2))}parseDefineSound(t){const e=this.byteStream.byte_offset,s=this.byteStream.getUI16();this.byteStream.getUIBits(4),this.byteStream.getUIBits(2),this.byteStream.getUIBit(),this.byteStream.getUIBit(),this.byteStream.getUI32();const a=t-(this.byteStream.byte_offset-e),i={_$characterId:s,_$data:null,_$buffer:null};i._$length=this.byteStream.byte_offset+a,i._$offset=this.byteStream.byte_offset,this.byteStream.byte_offset=e+t,this.setCharacter(s,i)}parseStartSound(t){const e={};return e.SoundId=this.byteStream.getUI16(),89===t&&(e.SoundClassName=this.byteStream.getDataUntil()),e.SoundInfo=this.parseSoundInfo(),e}parseDefineButtonSound(){const t=this.byteStream.getUI16(),e=this.getCharacter(t);for(let t=0;t<4;t++){const s=this.byteStream.getUI16();if(s){const a=this.parseSoundInfo();switch(t){case 0:e.ButtonStateUpSoundInfo=a,e.ButtonStateUpSoundId=s;break;case 1:e.ButtonStateOverSoundInfo=a,e.ButtonStateOverSoundId=s;break;case 2:e.ButtonStateDownSoundInfo=a,e.ButtonStateDownSoundId=s;break;case 3:e.ButtonStateHitTestSoundInfo=a,e.ButtonStateHitTestSoundId=s}}}this.setCharacter(t,e)}parseSoundInfo(){this.byteStream.getUIBits(2);const t={};if(t.SyncStop=this.byteStream.getUIBit(),t.SyncNoMultiple=this.byteStream.getUIBit(),t.HasEnvelope=this.byteStream.getUIBit(),t.HasLoops=this.byteStream.getUIBit(),t.HasOutPoint=this.byteStream.getUIBit(),t.HasInPoint=this.byteStream.getUIBit(),t.HasInPoint&&(t.InPoint=this.byteStream.getUI32()),t.HasOutPoint&&(t.OutPoint=this.byteStream.getUI32()),t.HasLoops&&(t.LoopCount=this.byteStream.getUI16()),t.HasEnvelope){const e=this.byteStream.getUI8(),s=[];for(let t=0;t<e;++t)s[t]={Pos44:this.byteStream.getUI32(),LeftLevel:this.byteStream.getUI16(),RightLevel:this.byteStream.getUI16()};t.EnvPoints=e,t.EnvelopeRecords=s}return t}parseDefineFontAlignZones(){const t=this.byteStream.getUI16(),e=this.getFont(t)||{};e._$CSMTableHint=this.byteStream.getUIBits(2),this.byteStream.getUIBits(6);const s=0|e._$numGlyphs,a=[];for(let t=0;t<s;++t){const e=this.byteStream.getUI8(),s=[];for(let t=0;t<e;++t)s.push(this.byteStream.getFloat16()),s.push(this.byteStream.getFloat16());this.byteStream.getUIBits(6),this.byteStream.getUIBits(1),this.byteStream.getUIBits(1),a[t]=s}this.byteStream.byteAlign(),e._$zoneTable=a,this.setFont(t,e)}parseCSMTextSettings(t){const e=this.byteStream.getUI16(),s={};s.tagType=t,s.UseFlashType=this.byteStream.getUIBits(2),s.GridFit=this.byteStream.getUIBits(3),this.byteStream.getUIBits(3),s.Thickness=this.byteStream.getUI32(),s.Sharpness=this.byteStream.getUI32(),this.byteStream.getUI8(),this.setTextSetting(e,s)}parseSoundStreamBlock(t,e){const s={};s.tagType=t,s.compressed=this.byteStream.getData(e)}parseDefineScalingGrid(){const t=this.byteStream.getUI16(),e=this.rect();this.setGrid(t,e)}postCharacter(t,e){globalThis.postMessage({infoKey:"_$characters",characters:t},e),t.length=0,e&&(e.length=0)}}Util.$swfParser=new SwfParser,this.addEventListener("message",(function(t){const e=Util.$swfParser;e.version=t.data.version,e.byteStream.setData(t.data.buffer),e.byteStream.byte_offset=t.data.offset;const s=Util.$createMovieClip();e.parseTags(t.data.buffer.length,s),e.postData(s),e.clear()}));'],{type:"text/javascript"})),d.$parserWorker=null,d.$parserQueues=[],d.$parserWorkerWait=!1,d.$unlzmaHandler=function(e){if(e.target.onmessage=null,d.$unlzmaQueues.length){const e=d.$unlzmaQueues.shift(),t=new Worker(d.$unlzmaWorkerURL);t.onmessage=d.$unlzmaHandler.bind(e);const r=e._$byteStream._$buffer;t.postMessage({fileSize:e.fileSize,mode:e.mode,buffer:r},[r.buffer])}else d.$unlzmaWorkerActive=!1;this._$byteStream._$buffer=e.data,this.parseAndBuild()},d.$getImageType=e=>{switch(!0){case 255===e[0]&&216===e[1]:return"jpeg";case 71===e[0]&&73===e[1]&&70===e[2]:return"gif";case 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]:return"png";case 66===e[0]&&77===e[1]:return"bmp";default:return null}},d.$jpegDecodeHandler=()=>{const e=this.image,t=e.width,r=e.height,a=document.createElement("canvas");a.width=t,a.height=r;const i=a.getContext("2d");i.drawImage(e,0,0,t,r);const s=new Uint8Array(i.getImageData(0,0,t,r).data);this.jpegData=null,this.image=null;const n=d.$currentWorkSpace().getLibrary(this.libraryId);if(n.width=t,n.height=r,this.isAlpha){if(this.buffer=s,this.width=t,this.height=r,d.$unzipWorkerActive)return void d.$unzipQueues.push(this);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const e=d.$unzipWorker;e.onmessage=d.$unzipHandler.bind(this),e.postMessage(this,[this.buffer.buffer,this.alphaData.buffer])}else n._$buffer=s},d.$characters=new Map,d.$symbols=new Map,d.$fonts=new Map,d.$texts=new Map,d.$parserHandler=function(e){const t=e.target;switch(e.data.infoKey){case"character":{const t=e.data.piece,r=d.$currentWorkSpace(),a=r.nextLibraryId;switch(t.libraryId=a,t._$name){case"Shape":{const e=d.$libraryController.createInstance(b.SHAPE,`Shape_${a}`,a);e.recodes=d.$vtc.convert(t._$records),e.inBitmap=e.recodes.pop(),e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax};const i=r.addLibrary(e);this._$folderId&&(i.folderId=this._$folderId),d.$characters.set(t._$characterId,a)}break;case"MovieClip":{for(let e=0;e<t._$dictionary.length;++e){const r=t._$dictionary[e];r.LibraryId=d.$characters.get(r.CharacterId)}const e=t._$characterId?`MovieClip_${a}`:this._$fileName;let i=!t._$characterId&&this._$libraryId?this._$libraryId:a;const s=d.$libraryController.createInstance(b.MOVIE_CLIP,e,i),n=r.addLibrary(s);this._$folderId&&(n.folderId=this._$folderId);let o=new Map,l=[];for(let e=0;e<t._$dictionary.length;++e){const r=t._$dictionary[e];-1===l.indexOf(r.Depth)&&(l.push(r.Depth),r.ClipDepth&&o.set(r.Depth,e))}if(l.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}})),o.size)for(const[e,r]of o){const a=[],i=t._$dictionary[r];for(let r=0;t._$dictionary.length>r;++r){const s=t._$dictionary[r];if(s.Depth>i.ClipDepth)break;s.Depth>e&&a.push(s)}for(let e=0;e<a.length;++e){const t=a[e],r=l.indexOf(t.Depth),s=l.splice(r,1)[0],n=l.indexOf(i.Depth);l.splice(n,0,s)}}let c=-1,h=-1;const u=l.length-1,m=new Map,g=[];for(let e=u;e>-1;--e){const t=new v;t.name="Layer_"+(u-e);const r=l[e];o.size&&(h>-1&&(r>h?(t.mode=I.MASK_IN,t.maskId=c):(c=-1,h=-1)),o.has(r)&&(h=r,c=u-e,t.mode=I.MASK)),g.push(t),m.set(r,t)}for(let e=0;e<l.length;++e)n.setLayer(e,g[e]);const p=[],y=t._$controller.length-1;for(let e=0;e<t._$dictionary.length;++e){const r=t._$dictionary[e],a=new $;a.libraryId=r.LibraryId,a.startFrame=r.StartFrame,a.endFrame=r.EndFrame||y+1,a.name=r.Name||"",p.push(a)}const _=new Map;for(let e=1;e<t._$controller.length;++e){const r=t._$controller[e];for(let a=0;a<r.length;++a){const i=r[a],s=t._$dictionary[i],n=m.get(s.Depth),o=p[i];_.has(i)||(_.set(i,-1),n.addCharacter(o));const l=t._$placeMap[e][s.Depth];if(_.get(i)!==l){const r=t._$placeObjects[l];o.setPlace(e,{frame:e,depth:0,matrix:r.matrix,colorTransform:r.colorTransform,blendMode:r.blendMode,filter:r.filters?r.filters:[],loop:d.$getDefaultLoopConfig()}),_.set(i,l)}}}for(let e=0;e<g.length;++e){const t={startFrame:-1},r=g[e];for(let e=1;e<=y;++e){r.getActiveCharacter(e).length?t.startFrame>0&&(r.addEmptyCharacter(new f({startFrame:t.startFrame,endFrame:e})),t.startFrame=-1):-1===t.startFrame&&(t.startFrame=e)}}d.$characters.set(t._$characterId,a)}break;case"lossless":{const e=d.$libraryController.createInstance(b.BITMAP,`Bitmap_${a}`,a);t.mode="lossless",e.imageType="image/png",e.buffer=null,e.width=t.width,e.height=t.height;const i=r.addLibrary(e);if(this._$folderId&&(i.folderId=this._$folderId),d.$characters.set(t._$characterId,a),d.$unzipWorkerActive)return void d.$unzipQueues.push(t);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const s=d.$unzipWorker;s.onmessage=d.$unzipHandler.bind(t),s.postMessage(t,[t.buffer.buffer])}break;case"imageData":{const e=d.$libraryController.createInstance(b.BITMAP,`Bitmap_${a}`,a),i=`image/${d.$getImageType(t.jpegData)}`;t.mode="jpegAlpha",t.imageType=i,e.imageType=i,e.buffer=null,e.width=0,e.height=0;const s=r.addLibrary(e);this._$folderId&&(s.folderId=this._$folderId),d.$characters.set(t._$characterId,a),t.image=new Image,t.image.decoding="async",t.image.src=URL.createObjectURL(new Blob([t.jpegData],{type:t.imageType})),t.image.decode().then(d.$jpegDecodeHandler.bind(t))}break;case"StaticText":{const e=d.$libraryController.createInstance(b.SHAPE,`ShapeText_${a}`,a);e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax};const i=r.addLibrary(e);this._$folderId&&(i.folderId=this._$folderId),d.$characters.set(t._$characterId,a),d.$texts.set(d.$texts.size,t)}break;case"SimpleButton":console.log("TODO SimpleButton: ",t);d.$libraryController.createInstance(b.BUTTON,`Button_${a}`,a).bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax},d.$characters.set(t._$characterId,a);break;case"TextField":{const e=d.$libraryController.createInstance(b.TEXT,`Text_${a}`,a);e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax},e.text=t._$text,e.inputType=t._$type,e.color=t._$textColor,e.font=t._$defaultTextFormat[1],e.size=t._$defaultTextFormat[2],e.align=t._$defaultTextFormat[7],e.leftMargin=t._$defaultTextFormat[8],e.rightMargin=t._$defaultTextFormat[9],e.leading=t._$defaultTextFormat[10],e.multiline=1===t._$multiline,e.wordWrap=1===t._$wordWrap,e.border=1===t._$border,t._$defaultTextFormat[4]&&t._$defaultTextFormat[5]?e.fontType=3:t._$defaultTextFormat[4]?e.fontType=2:t._$defaultTextFormat[5]&&(e.fontType=1),e.htmlText=t._$htmlText;const i=r.addLibrary(e);this._$folderId&&(i.folderId=this._$folderId),d.$characters.set(t._$characterId,a)}break;default:console.log("TODO: ",t)}if(t._$characterId)return;this._$libraryId&&(d.$changeLibraryId=this._$libraryId,r.scene.changeFrame(d.$timelineFrame.currentFrame),d.$changeLibraryId=0)}break;case"_$symbols":for(let t=0;t<e.data.pieces.length;++t){const r=e.data.pieces[t];d.$symbols.set(r.tagId,r.ns)}return;case"font":return void d.$fonts.set(e.data.index,e.data.piece);case"font_shape":{const t=d.$fonts.get(e.data.index);t._$glyphShapeTable.push.apply(t._$glyphShapeTable,e.data.pieces),d.$fonts.set(e.data.index,t)}return;case"font_zone":{const t=d.$fonts.get(e.data.index);t._$zoneTable.push.apply(t._$zoneTable,e.data.pieces),d.$fonts.set(e.data.index,t)}return}const r=d.$currentWorkSpace();for(const[e,t]of d.$symbols){r.getLibrary(e)._$symbol=`${t}`}if(d.$characters.clear(),d.$symbols.clear(),d.$fonts.clear(),d.$texts.clear(),d.$libraryController.reload(Array.from(r._$libraries.values())),t.onmessage=null,d.$parserQueues.length){const e=d.$parserQueues.shift();t.onmessage=d.$parserHandler.bind(e);const r=e._$byteStream._$buffer;t.postMessage({version:e._$swfVersion,offset:e._$offset,buffer:r},[r.buffer])}else d.$parserWorkerWait=!1},d.$boundsMatrix=(e,t)=>{const r=e.xMax*t[0]+e.yMax*t[2]+t[4],a=e.xMax*t[0]+e.yMin*t[2]+t[4],i=e.xMin*t[0]+e.yMax*t[2]+t[4],s=e.xMin*t[0]+e.yMin*t[2]+t[4],n=e.xMax*t[1]+e.yMax*t[3]+t[5],o=e.xMax*t[1]+e.yMin*t[3]+t[5],l=e.xMin*t[1]+e.yMax*t[3]+t[5],c=e.xMin*t[1]+e.yMin*t[3]+t[5];return{xMin:Math.min(Number.MAX_VALUE,r,a,i,s),xMax:Math.max(-Number.MAX_VALUE,r,a,i,s),yMin:Math.min(Number.MAX_VALUE,n,o,l,c),yMax:Math.max(-Number.MAX_VALUE,n,o,l,c)}},d.$intToRGB=e=>({R:(16711680&e)>>16,G:(65280&e)>>8,B:255&e}),d.$copyContainer=(e,t)=>{const r=d.$currentWorkSpace(),a=d.$workSpaces[d.$copyWorkSpaceId];t.has(e.id)||t.set(e.id,r.nextLibraryId),e.id=t.get(e.id),r.addLibrary(e);for(let i=0;i<e.layers.length;++i){const s=e.layers[i];for(let e=0;e<s.characters.length;++e){const i=s.characters[e];if(!t.has(i.libraryId)){t.set(i.libraryId,r.nextLibraryId);const e=a.getLibrary(i.libraryId).toObject();e.type===b.MOVIE_CLIP?d.$copyContainer(e,t):(e.id=t.get(i.libraryId),r.addLibrary(e))}i.libraryId=t.get(i.libraryId)}}r.addLibrary(e)},d.$clearShapePointer=()=>{const e=document.getElementById("stage-area");if(!e)return;const t=e.children;for(let e=0;t.length>e;++e){const r=t[e];r.dataset.shapePointer&&(r.remove(),--e)}},d.$getDefaultLoopConfig=()=>({type:_e.DEFAULT,start:1,end:0}),d.$getFrame=(e,t,r,a,i=0)=>{const s=r-t.startFrame;let n=1;switch(e.loop.type){case _e.REPEAT:{const t=e.loop.end?e.loop.end:a;n=e.loop.start;for(let r=0;r<s;++r)++n,n>t&&(n=e.loop.start)}break;case _e.NO_REPEAT:{const t=e.loop.end?e.loop.end:a;n=e.loop.start;for(let e=0;e<s;++e)if(++n,n>t){n=t;break}}break;case _e.FIXED_ONE:n=e.loop.start;break;case _e.NO_REPEAT_REVERSAL:n=e.loop.end?e.loop.end:a;for(let t=0;t<s;++t)if(--n,e.loop.start>n){n=e.loop.start;break}break;case _e.REPEAT_REVERSAL:{const t=e.loop.end?e.loop.end:a;n=t;for(let r=0;r<s;++r)--n,e.loop.start>n&&(n=t)}break;case _e.DEFAULT:if(0===i){n=1;for(let e=0;e<s;++e)++n,n>a&&(n=1)}else n=i,n>a&&(n=1)}return n};d.$globalKeyboardCommand=new class{constructor(){this._$activeTool=null,this._$executeMulti=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),d.$setShortcut(d.$generateShortcutKey("z",{ctrl:!0}),this.undo),d.$setShortcut(d.$generateShortcutKey("z",{ctrl:!0,shift:!0}),this.redo),d.$setShortcut(d.$generateShortcutKey("s",{ctrl:!0}),d.$autoSave),d.$setShortcut("Enter",(()=>{d.$timelinePlayer.executeTimelinePlay()})),d.$setShortcut(d.$generateShortcutKey("Enter",{ctrl:!0}),d.$showPreview),d.$setShortcut(d.$generateShortcutKey("Enter",{ctrl:!0,shift:!0}),d.$project.publish),d.$setShortcut("Escape",d.$hidePreview),d.$setShortcut(d.$generateShortcutKey("p",{ctrl:!0}),this.changeRepeatMode),d.$setShortcut(d.$generateShortcutKey("ArrowRight",{ctrl:!0}),this.changeProject),d.$setShortcut(d.$generateShortcutKey("ArrowLeft",{ctrl:!0}),this.changeProject),d.$initializeEnd()}redo(){const e=d.$currentWorkSpace();e&&e.redo()}undo(){const e=d.$currentWorkSpace();e&&e.undo()}changeRepeatMode(){d.$timelinePlayer.repeat?d.$timelinePlayer.executeTimelineRepeat():d.$timelinePlayer.executeTimelineNoRepeat()}changeProject(e){const t=Array.from(document.getElementById("view-tab-area").children);let r=0;for(let e=0;e<t.length;++e){if((0|t[e].dataset.tabId)===d.$activeWorkSpaceId){r=e;break}}let a=null;if("ArrowLeft"===e.key?(a=t[r-1],a||(a=t[t.length-1])):(a=t[r+1],a||(a=t[0])),a){const e=0|a.dataset.tabId;d.$activeWorkSpaceId!==e&&d.$screenTab.activeTab({currentTarget:{dataset:{tabId:e}}})}}};class m{constructor(e,t=0,r=0,a=60,i=!0){this._$pngs=e,this._$width=t,this._$height=r,this._$fps=a,this._$loop=i?0:1,this._$crcTable=new Uint32Array(256);for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;this._$crcTable[e]=t}}_$crcUpdate(e,t,r,a){for(let i=0;i<a;i++)e=this._$crcTable[255&(e^t[r+i])]^e>>>8;return e}_$crc(e,t,r){return 4294967295^this._$crcUpdate(4294967295,e,t,r)}_$writeString(e,t,r){for(let a=0;a<r.length;a++)e[t+a]=r.charCodeAt(a)}encode(){return new Promise((e=>{requestAnimationFrame((()=>{let t=0,r=0;const a=[],i=new FileReader,s=new Uint8Array([137,80,78,71,13,10,26,10]);a.push(s.buffer);const n=new Uint8Array(25),o=new DataView(n.buffer);o.setUint32(0,13),this._$writeString(n,4,"IHDR"),o.setUint32(8,this._$width),o.setUint32(12,this._$height),o.setUint8(16,8),o.setUint8(17,6),o.setUint8(18,0),o.setUint8(19,0),o.setUint8(20,0),o.setUint32(21,this._$crc(n,4,17)),a.push(n.buffer);const l=new Uint8Array(20),c=new DataView(l.buffer);c.setUint32(0,8),this._$writeString(l,4,"acTL"),c.setUint32(8,this._$pngs.length),c.setUint32(12,this._$loop),c.setUint32(16,this._$crc(l,4,12)),a.push(l.buffer),i.onload=()=>{const s=new DataView(i.result);let n=8;const o=new Uint8Array(38),l=new DataView(o.buffer);l.setUint32(0,26),this._$writeString(o,4,"fcTL"),l.setUint32(8,t++),l.setUint32(12,this._$width),l.setUint32(16,this._$height),l.setUint32(20,0),l.setUint32(24,0),l.setUint16(28,1e3/this._$fps),l.setUint16(30,1e3),l.setUint8(32,0),l.setUint8(33,0),l.setUint32(34,this._$crc(o,4,30)),a.push(o.buffer);const c=i.result.byteLength;for(;;){const e=s.getUint32(n);if(1229209940===s.getUint32(n+4))if(r){let r=new Uint8Array(4),s=new DataView(r.buffer);s.setUint32(0,e+4),a.push(r.buffer),r=new Uint8Array(i.result.slice(n,n+e+8+4)),s=new DataView(r.buffer),this._$writeString(r,0,"fdAT"),s.setUint32(4,t++),s.setUint32(e+8,this._$crc(r,0,e+8)),a.push(r.buffer)}else a.push(i.result.slice(n,n+e+8+4));if(n+=e+12,n>=c)break}r++,this._$pngs.length>r?i.readAsArrayBuffer(this._$pngs[r]):(a.push(new Uint8Array([0,0,0,0,73,69,78,68,174,66,96,130]).buffer),e(new Blob(a,{type:"image/apng"})))},i.readAsArrayBuffer(this._$pngs[0])}))}))}}class g{constructor(e){this._$id=e.id,this._$name=e.name,this._$type=e.type,this._$symbol=e.symbol||"",this._$folderId=0|e.folderId}initialize(){}toObject(){}toPublish(){}get defaultSymbol(){}createInstance(){}getBounds(e=null){}get id(){return this._$id}set id(e){this._$id=0|e}get folderId(){return this._$folderId}set folderId(e){this._$folderId=0|e}get path(){const e=d.$currentWorkSpace();let t=this._$name;if(this._$folderId){let r=this;for(;r._$folderId;)r=e.getLibrary(r._$folderId),t=`${r._$name}/${t}`}return t}getPathWithWorkSpace(e){let t=this._$name;if(this._$folderId){let r=this;for(;r._$folderId;)r=e.getLibrary(r._$folderId),t=`${r._$name}/${t}`}return t}get name(){return this._$name}set name(e){if(this._$name=`${e}`,this.id){const e=document.getElementById(`library-name-${this.id}`);e&&(e.textContent=`${this._$name}`)}const t=d.$currentWorkSpace();if(t&&t.scene.id===this.id){const e=document.getElementById("object-name");e&&(e.value=`${this._$name}`);const t=document.getElementById("scene-name");t&&(t.textContent=`${this._$name}`)}}get type(){return this._$type}set type(e){switch(e=`${e}`.toLowerCase()){case b.SHAPE:case b.BITMAP:case b.VIDEO:case b.FOLDER:case b.SOUND:case b.MOVIE_CLIP:case b.TEXT:this._$type=e}}get symbol(){return this._$symbol}set symbol(e){if(this._$symbol=`${e}`,this.id){const t=document.getElementById(`library-symbol-name-${this.id}`);t&&(t.textContent=`${e}`)}}showController(e,t=""){d.$controller.hideObjectSetting(["sound-setting","ease-setting"]),d.$controller.showObjectSetting(["object-setting","reference-setting","transform-setting","color-setting","blend-setting","filter-setting","instance-setting"]),d.$instanceSelectController.createInstanceSelect(this),document.getElementById("object-name").value=t,document.getElementById("object-symbol").value=this.symbol;const r=e.matrix,a=Math.sqrt(r[0]*r[0]+r[1]*r[1]),i=Math.sqrt(r[2]*r[2]+r[3]*r[3]),s=Math.atan2(r[1],r[0])*d.$Rad2Deg,n=Math.atan2(-r[2],r[3])*d.$Rad2Deg;document.getElementById("transform-scale-x").value=Math.abs(Math.ceil(s-n))>=180?-100*a:100*a,document.getElementById("transform-scale-y").value=100*i,document.getElementById("transform-rotate").value=s;const o=e.colorTransform;document.getElementById("color-red-multiplier").value=100*o[0],document.getElementById("color-green-multiplier").value=100*o[1],document.getElementById("color-blue-multiplier").value=100*o[2],document.getElementById("color-alpha-multiplier").value=100*o[3],document.getElementById("color-red-offset").value=o[4],document.getElementById("color-green-offset").value=o[5],document.getElementById("color-blue-offset").value=o[6],document.getElementById("color-alpha-offset").value=o[7];const l=document.getElementById("blend-select").children;for(let t=0;t<l.length;++t){const r=l[t];if(r.value===e.blendMode){r.selected=!0;break}}d.$filterController.clearFilters();const c=document.getElementById("filter-setting-list"),h=e.filter.length;h&&(document.querySelectorAll(".filter-none")[0].style.display="none");for(let t=0;t<h;++t){const r=e.filter[t];d.$filterController[`add${r.name}`](c,r,!1)}}draw(e,t,r,a,i=null,s=0){if(!t||!r)return e.width=0,e.height=0,e.getContext("2d");const{Matrix:n}=window.next2d.geom,o=this.createInstance(a,i,s),l=this.calcFilter(t,r,a);o.filters=l.filters;const c=this.createContainer(o,a),h=this.createBitmapData(l.width,l.height),u=window.devicePixelRatio*d.$zoomScale,m=c.getBounds(c);let g=-m.x;0>l.offsetX&&(g-=l.offsetX*u);let p=-m.y;0>l.offsetY&&(p-=l.offsetY*u),h.draw(c,new n(1,0,0,1,g,p));const $=h.drawFromCanvas(e);h.dispose(),e._$width=l.width,e._$height=l.height,e.draggable=!1;const f=this.getBounds(a.matrix,a,i);return e._$tx=f.xMin,e._$ty=f.yMin,e._$offsetX=0>l.offsetX?l.offsetX:0,e._$offsetY=0>l.offsetY?l.offsetY:0,$}calcFilter(e,t,r){const{Rectangle:a}=window.next2d.geom;let i=Math.sqrt(r.matrix[0]*r.matrix[0]+r.matrix[1]*r.matrix[1]),s=Math.sqrt(r.matrix[2]*r.matrix[2]+r.matrix[3]*r.matrix[3]);const n={width:e,height:t,offsetX:0,offsetY:0,filters:[]};if(r.filter.length){let o=new a(0,0,e,t);for(let e=0;e<r.filter.length;++e){const t=r.filter[e];if(!t.state)continue;const a=t.createInstance();o=a._$generateFilterRect(o,i,s),n.filters.push(a)}n.width=Math.ceil(o.width),n.height=Math.ceil(o.height),n.offsetX=o.x,n.offsetY=o.y}return n}createContainer(e,t){const{Sprite:r}=window.next2d.display,{Matrix:a,ColorTransform:i}=window.next2d.geom;e.transform.matrix=new a(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),e.transform.colorTransform=new i(t.colorTransform[0],t.colorTransform[1],t.colorTransform[2],t.colorTransform[3],t.colorTransform[4],t.colorTransform[5],t.colorTransform[6],t.colorTransform[7]);const s=new r;s.addChild(e);const n=window.devicePixelRatio*d.$zoomScale;s.scaleX=n,s.scaleY=n;const o=new r;return o.addChild(s),o}createBitmapData(e,t){const{BitmapData:r}=window.next2d.display,a=window.devicePixelRatio*d.$zoomScale;return new r(Math.ceil(e*a),Math.ceil(t*a),!0,0)}getPreview(){if(this.type===b.FOLDER)return new Image;const e=this.getBounds([1,0,0,1,0,0]);let t=Math.abs(e.xMax-e.xMin),r=Math.abs(e.yMax-e.yMin);if(!t||!r)return new Image;let a=1;const i=150/r;t=t*i|0,r=r*i|0;const s=(0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0])-10;t>s&&(a=s/t,t=t*a|0,r=r*a|0);const n=d.$getCanvas();if(this.draw(n,Math.ceil(t),Math.ceil(r),{frame:1,matrix:[i*a,0,0,i*a,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[]},null,0,!0),n.height!==r){const e=Math.min(150,n.height);n.style.width=n.width*e/n.height+"px",n.style.height=`${e}px`}return n}remove(){const e=d.$currentWorkSpace(),t=e.scene;for(let r of e._$libraries.values())if(r.type===b.MOVIE_CLIP&&r.id!==this.id){for(let e of r._$layers.values()){let a=!1;const i=e._$characters.slice();for(let t=0;t<i.length;++t){const r=i[t];if(this.id===r.libraryId){for(const t of r._$places.keys()){const a=r.getRange(t);if(e.getActiveEmptyCharacter(t))continue;const i=e.getActiveCharacter(t);let s=!1;for(let e=0;e<i.length;++e){i[e].id!==r.id&&(s=!0)}s||e.addEmptyCharacter(new f({startFrame:a.startFrame,endFrame:a.endFrame}))}e.deleteCharacter(r.id),a=!0}}a&&t.id===r.id&&e.reloadStyle()}if(r._$sounds.size)for(const[e,t]of r._$sounds){const a=[];for(let e=0;e<t.length;++e){const r=t[e];this.id!==r.characterId&&a.push(r)}r._$sounds.set(e,a)}}}}class p extends g{constructor(e){super(e),this.imageType=e.imageType,this.width=e.width,this.height=e.height,this._$buffer=null,e.buffer&&(this.buffer=e.buffer),this._$command=null,this._$binary=""}clone(){return new p(JSON.parse(JSON.stringify(this.toObject())))}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["text-setting","loop-setting","video-setting","fill-color-setting","nine-slice-setting"])}getBounds(e=null){const t={xMin:0,xMax:this.width,yMin:0,yMax:this.height};return e?d.$boundsMatrix(t,e):t}get defaultSymbol(){return window.next2d.display.Shape.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let r=0;r<t;++r)this._$buffer[r]=255&e.charCodeAt(r);this._$binary=e}}}get imageType(){return this._$imageType}set imageType(e){this._$imageType=e}get width(){return this._$width}set width(e){this._$width=e}get height(){return this._$height}set height(e){this._$height=e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,width:this.width,height:this.height,imageType:this.imageType,buffer:this.buffer}}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,buffer:Array.from(this._$buffer),bounds:this.getBounds()}}createInstance(){const{Shape:e,BitmapData:t}=window.next2d.display,{width:r,height:a}=this,i=new e,s=new t(r,a,!0,0);return s._$buffer=this._$buffer,i.graphics.beginBitmapFill(s,null,!1).drawRect(0,0,r,a).endFill(),i.graphics._$maxAlpha=1,i.graphics._$canDraw=!0,i.graphics._$xMin=0,i.graphics._$xMax=this.width,i.graphics._$yMin=0,i.graphics._$yMax=this.height,i.graphics._$command=this._$command,i}}class ${constructor(e=null){this._$libraryId=-1,this._$layerId=-1,this._$places=new Map,this._$tween=new Map,this._$context=null,this._$currentFrame=0,this._$currentPlace=null,this._$screenX=0,this._$screenY=0,this._$offsetX=0,this._$offsetY=0,this._$name="",this._$cachePlaces=[],this._$referencePoint={x:0,y:0},e?(this._$id=e.id,this._$libraryId=e.libraryId,this._$name=e.name||"",this._$startFrame=e.startFrame,this._$endFrame=e.endFrame,this.places=e.places||[],this.tween=e.tween||[]):(this._$id=d.$currentWorkSpace()._$characterId++,this._$startFrame=1,this._$endFrame=2)}showController(){const e=d.$currentWorkSpace().getLibrary(this.libraryId),t=d.$timelineFrame.currentFrame;e.showController(this.getPlace(t),this.name);const r=this.getRange(t);if(this.hasTween(r.startFrame)){d.$controller.showObjectSetting(["ease-setting"]);const e=this.getTween(r.startFrame),t=document.getElementById("ease-select").children;for(let r=0;r<t.length;++r){const a=t[r];if(a.value===e.method){a.selected=!0;break}}"custom"===e.method?d.$tweenController.showCustomArea():d.$tweenController.hideCustomArea()}}showShapeColor(e){d.$controller.hideObjectSetting(["fill-color-setting"]);const t=d.$currentWorkSpace().getLibrary(this.libraryId);if(t.type!==b.SHAPE)return;const r=d.$timelineFrame.currentFrame;t.showShapeColor(this.getPlace(r),e)}clone(){const e=new $(JSON.parse(JSON.stringify(this.toObject())));return e._$layerId=-1,e._$id=d.$currentWorkSpace()._$characterId++,e}remove(e){if(1===this._$places.size)return void e.deleteCharacter(this.id);const t=this.getRange(d.$timelineFrame.currentFrame);switch(!0){case t.startFrame===this.startFrame:this._$places.delete(t.startFrame),this.startFrame=t.endFrame;break;case t.endFrame===this.endFrame:this._$places.delete(t.startFrame),this.endFrame=t.startFrame;break;default:this.split(e,t.startFrame,t.endFrame)._$tween.size&&d.$tweenController.clearPointer()}if(this._$tween.has(t.startFrame)){this._$tween.delete(t.startFrame);for(let e=t.startFrame;e<t.endFrame;++e)this._$places.has(e)&&this._$places.delete(e);d.$tweenController.clearPointer()}}relocationTween(e){if(!this._$tween.size)return;const t=this.getRange(e);this.hasTween(t.startFrame)&&(this.endFrame-1>e&&!this.hasTween(e)&&d.$timelineTool.executeTimelineKeyAdd(),d.$tweenController.relocationPlace(this,t.startFrame),d.$tweenController.clearPointer().relocationPointer())}getRange(e){if(1===this._$places.size)return{startFrame:this.startFrame,endFrame:this.endFrame};let t=this._$cachePlaces;t.length||(t=Array.from(this._$places.keys()),t.sort(((e,t)=>{switch(!0){case e>t:return-1;case e<t:return 1;default:return 0}})));let r=0;for(let a=0;a<t.length;++a){const i=t[a];if(e>=i){const e=this.getPlace(i);if(e.tweenFrame){const t=this.getTween(e.tweenFrame);return{startFrame:t.startFrame,endFrame:t.endFrame}}return{startFrame:i,endFrame:r||this.endFrame}}r=i}}getCloneTween(e){return JSON.parse(JSON.stringify(this.getTween(e)))}getTween(e){return this.hasTween(e)?this._$tween.get(e):null}setTween(e,t){this._$tween.set(e,t)}hasTween(e){return this._$tween.has(e)}deleteTween(e){return this._$tween.delete(0|e)}getBounds(){const e=d.$currentWorkSpace().getLibrary(this.libraryId),t=d.$timelineFrame.currentFrame,r=this.getPlace(t),a=r.loop&&r.loop.type===_e.DEFAULT?{startFrame:this.startFrame,endFrame:this.endFrame}:this.getRange(t),i=d.$currentFrame;d.$currentFrame=t;const s=e.getBounds(r.matrix,r,a);return d.$currentFrame=i,s}get rotation(){const e=d.$timelineFrame.currentFrame,t=this.getPlace(e).matrix;return Math.atan2(t[1],t[0])*d.$Rad2Deg}set rotation(e){const t=d.$timelineFrame.currentFrame,r=this.getPlace(t).matrix;let a=Math.atan2(r[1],r[0]),i=Math.atan2(-r[2],r[3]);const s=Math.sqrt(r[0]*r[0]+r[1]*r[1]),n=Math.sqrt(r[2]*r[2]+r[3]*r[3]),o=e*d.$Deg2Rad;i=i+o-a,a=o,r[0]=s*Math.cos(a),r[1]=s*Math.sin(a),r[2]=-n*Math.sin(i),r[3]=n*Math.cos(i)}get width(){const e=this.getBounds(),t=+Math.abs(e.xMax-e.xMin);return t!==1/0?t:0}set width(e){const t=this.getBounds(),r=Math.abs(t.xMax-t.xMin);this.scaleX=e/r}get scaleX(){const e=d.$timelineFrame.currentFrame,t=this.getPlace(e).matrix;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}set scaleX(e){e=d.$toFixed4(e);const t=d.$timelineFrame.currentFrame,r=this.getPlace(t).matrix;if(r[1]){const t=Math.atan2(r[1],r[0]);r[1]=e*Math.sin(t),1===r[1]||-1===r[1]?r[0]=0:r[0]=e*Math.cos(t)}else r[0]=e}get height(){const e=this.getBounds(),t=+Math.abs(e.yMax-e.yMin);return t!==1/0?t:0}set height(e){const t=this.getBounds(),r=Math.abs(t.yMax-t.yMin);this.scaleY=e/r}get scaleY(){const e=d.$timelineFrame.currentFrame,t=this.getPlace(e).matrix;return Math.sqrt(t[2]*t[2]+t[3]*t[3])}set scaleY(e){e=d.$toFixed4(e);const t=d.$timelineFrame.currentFrame,r=this.getPlace(t).matrix;if(r[2]){const t=Math.atan2(-r[2],r[3]);r[2]=-e*Math.sin(t),1===r[2]||-1===r[2]?r[3]=0:r[3]=e*Math.cos(t)}else r[3]=e}get x(){const e=d.$timelineFrame.currentFrame;return this.getPlace(e).matrix[4]}set x(e){const t=d.$timelineFrame.currentFrame;this.getPlace(t).matrix[4]=e;const r=this.getBounds();this.screenX=r.xMin;const a=document.getElementById(`character-${this.id}`);a&&(a.style.left=`${d.$offsetLeft+r.xMin*d.$zoomScale}px`)}get y(){const e=d.$timelineFrame.currentFrame;return this.getPlace(e).matrix[5]}set y(e){const t=d.$timelineFrame.currentFrame;this.getPlace(t).matrix[5]=e;const r=this.getBounds();this.screenY=r.yMin;const a=document.getElementById(`character-${this.id}`);a&&(a.style.top=`${d.$offsetTop+r.yMin*d.$zoomScale}px`)}draw(e){if(this._$context)return e instanceof HTMLCanvasElement&&d.$canvases.push(e),this._$context.canvas;const t=d.$currentWorkSpace().getLibrary(this.libraryId),r=d.$timelineFrame.currentFrame,a=this.getPlace(r),i=a.loop&&a.loop.type===_e.DEFAULT?{startFrame:this.startFrame,endFrame:this.endFrame}:this.getRange(r);d.$currentFrame=r;const s=t.getBounds(a.matrix,a,i),n=+Math.ceil(Math.abs(s.xMax-s.xMin)),o=+Math.ceil(Math.abs(s.yMax-s.yMin));e.setAttribute("style","");let l=null;switch(a.blendMode){case"invert":l=t.draw(e,n,o,{frame:a.frame,matrix:a.matrix,colorTransform:[0,0,0,a.colorTransform[3],0,0,0,a.colorTransform[7]],blendMode:a.blendMode,filter:a.filter,tweenFrame:a.tweenFrame,loop:a.loop},i);break;case"alpha":case"erase":{const t=this.getBounds(a.matrix,a,i);e._$tx=t.xMin,e._$ty=t.yMin,e._$offsetX=0,e._$offsetY=0,e._$width=0,e._$height=0,e.draggable=!1,e.width=e.height=0,l=e.getContext("2d")}break;default:l=t.draw(e,n,o,a,i)}switch(this._$context=l,a.blendMode){case"normal":case"alpha":case"erase":case"layer":break;case"add":e.style.mixBlendMode="color-dodge";break;case"subtract":e.style.filter="invert(100%)",e.style.mixBlendMode="multiply";break;case"invert":e.style.filter="invert(100%)",e.style.mixBlendMode="difference";break;case"hardlight":e.style.mixBlendMode="hard-light";break;default:e.style.mixBlendMode=a.blendMode}return this.screenX=e._$tx,this.screenY=e._$ty,this._$offsetX=e._$offsetX,this._$offsetY=e._$offsetY,e}get offsetX(){return this._$offsetX}get offsetY(){return this._$offsetY}get screenX(){return this._$screenX}set screenX(e){this._$screenX=d.$clamp(+e,-Number.MAX_VALUE,Number.MAX_VALUE,0)}get screenY(){return this._$screenY}set screenY(e){this._$screenY=d.$clamp(+e,-Number.MAX_VALUE,Number.MAX_VALUE,0)}get id(){return this._$id}get libraryId(){return this._$libraryId}set libraryId(e){this._$libraryId=0|e}get name(){return this._$name}set name(e){this._$name=`${e}`.replace(/ /g,"").trim()}get referencePoint(){return{x:this._$referencePoint.x,y:this._$referencePoint.y}}set referencePoint(e){e&&(this._$referencePoint.x=d.$clamp(+e.x,-Number.MAX_VALUE,Number.MAX_VALUE,0),this._$referencePoint.y=d.$clamp(+e.y,-Number.MAX_VALUE,Number.MAX_VALUE,0))}get tween(){const e=[];for(let[t,r]of this._$tween)e.push({frame:t,value:r});return e}set tween(e){for(let t=0;t<e.length;++t){const r=e[t];r.value.custom||(r.value.custom=d.$tweenController.createEasingObject()),this._$tween.set(0|r.frame,r.value)}}get places(){const e=d.$currentWorkSpace().getLibrary(this.libraryId);if(!e)return[];const t=[];for(let[r,a]of this._$places){a.frame=r;const i=[];for(let e=0;e<a.filter.length;++e)i.push(a.filter[e].toObject());const s={frame:r,depth:a.depth,blendMode:a.blendMode,filter:i,matrix:a.matrix.slice(0),colorTransform:a.colorTransform.slice(0),point:a.point};a.tweenFrame&&(s.tweenFrame=a.tweenFrame),e.type===b.MOVIE_CLIP&&(a.loop?s.loop={type:a.loop.type,start:a.loop.start,end:a.loop.end}:s.loop=d.$getDefaultLoopConfig()),t.push(s)}return t}set places(e){for(let t=0;t<e.length;++t){const r=e[t],a=[];for(let e=0;r.filter.length>e;++e){const t=r.filter[e];a.push(new d.$filterClasses[t.name](t))}r.filter=null,r.filter=a,r.loop||(r.loop=d.$getDefaultLoopConfig()),this._$places.set(0|r.frame,r)}}getClonePlace(e){return JSON.parse(JSON.stringify(this.getPlace(e)))}getPlace(e){return 1===this._$places.size?this._$places.get(this.startFrame):this.hasPlace(e)?this._$places.get(0|e):this._$places.get(this.getNearPlaceFrame(0|e))}getNearPlaceFrame(e){if(!d.$timelinePlayer._$stopFlag){this._$cachePlaces.length||(this._$cachePlaces=Array.from(this._$places.keys()),this._$cachePlaces.sort(((e,t)=>{switch(!0){case e>t:return-1;case e<t:return 1;default:return 0}})));let t=0;for(;this._$cachePlaces.length>t;){const r=0|this._$cachePlaces[t++];if(e>r)return r}return 1}this._$cachePlaces.length&&(this._$cachePlaces.length=0);const t=Array.from(this._$places.keys());t.sort(((e,t)=>{switch(!0){case e>t:return-1;case e<t:return 1;default:return 0}}));for(let r=0;r<t.length;++r){const a=t[r];if(e>a)return a}return 1}setPlace(e,t){t.frame=0|e,this._$places.set(0|e,t)}hasPlace(e){return this._$places.has(0|e)}deletePlace(e){this._$places.delete(0|e)}get startFrame(){return this._$startFrame}set startFrame(e){this._$startFrame=d.$clamp(0|e,1,Number.MAX_VALUE,1)}get endFrame(){return this._$endFrame}set endFrame(e){this._$endFrame=d.$clamp(0|e,2,Number.MAX_VALUE,2)}updateTweenPlace(e,t){for(let r=e;r<t;++r){const a=this.hasPlace(r)?this.getPlace(r):this.getClonePlace(t);a.tweenFrame=e,this.setPlace(r,a)}}updateTweenBlend(e){if(!this._$tween.size)return;const t=this.getRange(e),r=this.getPlace(t.startFrame);for(let e=t.startFrame;e<t.endFrame;++e)if(this.hasPlace(e))this.getPlace(e).blendMode=r.blendMode;else{const a=this.getClonePlace(t.startFrame);a.blendMode=r.blendMode,this.setPlace(e,a)}}updateTweenFilter(e){if(!this._$tween.size)return;const t=this.getRange(e),r=this.getPlace(t.startFrame);for(let e=t.startFrame;e<t.endFrame;++e){const a=[],i=r.filter.length;for(let e=0;e<i;++e)a.push(r.filter[e].clone());if(this.hasPlace(e))this.getPlace(e).filter=a;else{const r=this.getClonePlace(t.startFrame);r.filter=a,this.setPlace(e,r)}}}move(e){const t=new Map;for(const[r,a]of this._$places)a.frame=r+e,a.tweenFrame&&(a.tweenFrame+=e),t.set(a.frame,a);if(this._$places=t,this._$tween.size){const t=new Map;for(const[r,a]of this._$tween)a.startFrame+=e,a.endFrame+=e,t.set(r+e,a);this._$tween=t}this.startFrame+=e,this.endFrame+=e}split(e,t,r){if(t===this.startFrame&&r===this.endFrame)return e.deleteCharacter(this.id),this;if(t>this.startFrame){const r=new $;r._$libraryId=this._$libraryId,r._$startFrame=this.startFrame,r._$endFrame=t;const a=new Map;for(const[e,i]of this._$places)t>e?r.setPlace(e,i):a.set(e,i);const i=new Map;for(const[e,a]of this._$tween)t>e?r.setTween(e,a):i.set(e,a);e.addCharacter(r),this._$tween=i,this._$places=a,this._$startFrame=t}const a=new $;a._$libraryId=this._$libraryId,a._$startFrame=t,a._$endFrame=r;const i=[];for(const[e,s]of this._$places)t>e||e>=r||(i.push(e),a._$places.set(e,s));for(let e=0;e<i.length;++e)this._$places.delete(i[e]);i.length=0;for(const[e,s]of this._$tween)t>e||e>=r||(i.push(e),a._$tween.set(e,s));for(let e=0;e<i.length;++e)this._$tween.delete(i[e]);if(this._$places.size){const e=Array.from(this._$places.keys());this._$places.size>1&&e.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}})),this._$startFrame=0|e[0]}else e.deleteCharacter(this.id);return a}toObject(){return{id:this.id,name:this.name,libraryId:this.libraryId,places:this.places,startFrame:this.startFrame,endFrame:this.endFrame,tween:this.tween}}dispose(){this._$context&&(d.$poolCanvas(this._$context),this._$context=null)}}class f{constructor(e=null){this._$startFrame=e?e.startFrame:1,this._$endFrame=e?e.endFrame:2}get startFrame(){return this._$startFrame}set startFrame(e){this._$startFrame=0|e}get endFrame(){return this._$endFrame}set endFrame(e){this._$endFrame=0|e}clone(){return new f(JSON.parse(JSON.stringify(this.toObject())))}toObject(){return{startFrame:this.startFrame,endFrame:this.endFrame}}move(e){this._$startFrame+=e,this._$endFrame+=e}split(e,t,r){e.deleteEmptyCharacter(this),t>this.startFrame&&e.addEmptyCharacter(new f({startFrame:this.startFrame,endFrame:t})),this.endFrame>r&&e.addEmptyCharacter(new f({startFrame:r,endFrame:this.endFrame}))}}class y extends g{constructor(e){super(e),this._$mode=_.CLOSE,e.mode&&(this._$mode=e.mode)}clone(){return new y(JSON.parse(JSON.stringify(this.toObject())))}get mode(){return this._$mode}set mode(e){this._$mode=_.OPEN===`${e}`.toLowerCase()?_.OPEN:_.CLOSE}remove(){const e=d.$currentWorkSpace();for(let t of e._$libraries.values())t.folderId&&t.folderId===this.id&&(t.remove(),e.removeLibrary(t.id))}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,mode:this.mode}}getInstanceIds(e){const t=d.$currentWorkSpace();for(const r of t._$libraries.values())r.folderId&&r.folderId===this.id&&(r.type!==b.FOLDER?e.push(r.id):r.getInstanceIds(e))}}class _{static get OPEN(){return"open"}static get CLOSE(){return"close"}}class b{static get SHAPE(){return"shape"}static get BITMAP(){return"bitmap"}static get VIDEO(){return"video"}static get FOLDER(){return"folder"}static get SOUND(){return"sound"}static get MOVIE_CLIP(){return"container"}static get TEXT(){return"text"}}class v{constructor(e=null){this._$id=0,this._$characters=[],this._$emptys=[],this._$instances=new Map,this._$children=[],this._$maskId=null,this._$guideId=null,this._$name="",this._$display="",this._$light=!1,this._$disable=!1,this._$lock=!1,this._$mode=I.NORMAL,this._$color=de.color,e&&(this._$name=e.name,this._$light=e.light,this._$disable=e.disable,this._$lock=e.lock,this._$mode=e.mode,this._$maskId=e.maskId,this._$guideId=e.guideId,this._$color=e.color||this._$color,this.characters=e.characters,this.emptyCharacters=e.emptyCharacters||[])}initialize(){const e=document.getElementById("timeline-content");if(!e)return;this._$children=[],this._$display="",d.$timelineLayer.create(this._$id);const t=e.lastElementChild;if(!t)return;const r=document.getElementById(`layer-name-${this.id}`);this.name?(r.textContent=this.name,document.getElementById(`layer-name-input-${this.id}`).value=this.name):this.name=r.textContent;const a=document.getElementById(`layer-light-icon-${this.id}`);if(a.style.backgroundImage=`url('${this.getHighlightURL()}')`,this.light&&(a.classList.remove("icon-disable"),a.classList.add("light-icon-active"),t.style.borderBottom=`1px solid ${this.color}`),this.disable){const e=document.getElementById(`layer-disable-icon-${this.id}`);e.classList.remove("icon-disable"),e.classList.add("icon-active")}if(this.lock){const e=document.getElementById(`layer-lock-icon-${this.id}`);e.classList.remove("icon-disable"),e.classList.add("icon-active")}this.showIcon()}get display(){return this._$display}set display(e){this._$display="none"===e?e:""}getHighlightURL(){const e=d.$intToRGB(0|`0x${this.color.slice(1)}`);return`data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"><path fill="rgb(${e.R},${e.G},${e.B})" d="M14 19h-4c-.276 0-.5.224-.5.5s.224.5.5.5h4c.276 0 .5-.224.5-.5s-.224-.5-.5-.5zm0 2h-4c-.276 0-.5.224-.5.5s.224.5.5.5h4c.276 0 .5-.224.5-.5s-.224-.5-.5-.5zm.25 2h-4.5l1.188.782c.154.138.38.218.615.218h.895c.234 0 .461-.08.615-.218l1.187-.782zm3.75-13.799c0 3.569-3.214 5.983-3.214 8.799h-1.989c-.003-1.858.87-3.389 1.721-4.867.761-1.325 1.482-2.577 1.482-3.932 0-2.592-2.075-3.772-4.003-3.772-1.925 0-3.997 1.18-3.997 3.772 0 1.355.721 2.607 1.482 3.932.851 1.478 1.725 3.009 1.72 4.867h-1.988c0-2.816-3.214-5.23-3.214-8.799 0-3.723 2.998-5.772 5.997-5.772 3.001 0 6.003 2.051 6.003 5.772zm4-.691v1.372h-2.538c.02-.223.038-.448.038-.681 0-.237-.017-.464-.035-.69h2.535zm-10.648-6.553v-1.957h1.371v1.964c-.242-.022-.484-.035-.726-.035-.215 0-.43.01-.645.028zm-3.743 1.294l-1.04-1.94 1.208-.648 1.037 1.933c-.418.181-.822.401-1.205.655zm10.586 1.735l1.942-1.394.799 1.115-2.054 1.473c-.191-.43-.423-.827-.687-1.194zm-3.01-2.389l1.038-1.934 1.208.648-1.041 1.941c-.382-.254-.786-.473-1.205-.655zm-10.068 3.583l-2.054-1.472.799-1.115 1.942 1.393c-.264.366-.495.763-.687 1.194zm13.707 6.223l2.354.954-.514 1.271-2.425-.982c.21-.397.408-.812.585-1.243zm-13.108 1.155l-2.356 1.06-.562-1.251 2.34-1.052c.173.433.371.845.578 1.243zm-1.178-3.676h-2.538v-1.372h2.535c-.018.226-.035.454-.035.691 0 .233.018.458.038.681z"/></svg>`}clone(){return new v(JSON.parse(JSON.stringify(this.toObject())))}appendCharacter(e=1){if(this.disable)return;if(document.getElementById("timeline-onion-skin").classList.contains("onion-skin-active")&&d.$timelinePlayer.stopFlag){const e=d.$timelineFrame.currentFrame,t=new Map;for(let e=0;e<this._$characters.length;++e){const r=this._$characters[e];for(let e of r._$places.keys())t.set(e,!0)}const r=this.getActiveCharacter(e);if(r.length){const a=r[0].getRange(e);t.delete(a.startFrame)}for(const e of t.keys()){d.$timelineFrame.currentFrame=e;const t=this.getActiveCharacter(e);if(t.length){t.length>1&&this.sort(t,e);for(let e=0;e<t.length;++e){const r=t[e];r.dispose(),d.$screen.appendOnionCharacter(r,this.id)}}}d.$timelineFrame.currentFrame=e;const a=this.getActiveCharacter(e);if(a.length){a.length>1&&this.sort(a,e);const t=this.lock?"none":"auto";for(let r=0;r<a.length;++r){const i=a[r];i.dispose(),d.$screen.appendCharacter(i,e,this.id,t)}}}else{const t=this.getActiveCharacter(e);if(t.length){t.length>1&&this.sort(t,e);const r=this.lock?"none":"auto";for(let a=0;a<t.length;++a)d.$screen.appendCharacter(t[a],e,this.id,r)}}}sort(e,t){e.sort(((e,r)=>{const a=e.getPlace(t).depth,i=r.getPlace(t).depth;switch(!0){case a>i:return 1;case a<i:return-1;default:return 0}}))}getActiveCharacter(e=1){const t=[];for(let r=0;r<this._$characters.length;++r){const a=this._$characters[r];a.startFrame>e||(e>=a.endFrame||t.push(a))}return t}getChildren(e=1){const t=d.$timelineHeader.leftFrame;return t>e?null:this._$children[e-t]}getActiveEmptyCharacter(e=1){for(let t=0;t<this._$emptys.length;++t){const r=this._$emptys[t];if(!(r.startFrame>e)&&!(e>=r.endFrame))return r}return null}showIcon(){const e=document.getElementById(`layer-name-${this.id}`);e.classList.remove("in-view-text"),e.classList.add("view-text");switch(document.getElementById(`layer-name-input-${this.id}`).classList.remove("in-view-text-input"),this._$mode){case I.NORMAL:document.getElementById(`layer-icon-${this.id}`).style.display="",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-in-icon-${this.id}`).style.display="none";break;case I.MASK:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-in-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-icon-${this.id}`);e.style.display="",e.style.opacity="0"}break;case I.MASK_IN:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-in-icon-${this.id}`);e.style.display="",e.style.opacity="0";const t=document.getElementById(`layer-name-${this.id}`);t.classList.remove("view-text"),t.classList.add("in-view-text");document.getElementById(`layer-name-input-${this.id}`).classList.add("in-view-text-input")}break;case I.GUIDE:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-in-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-icon-${this.id}`);e.style.display="",e.style.opacity="0"}break;case I.GUIDE_IN:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="",document.getElementById(`timeline-exit-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-in-icon-${this.id}`);e.style.display="",e.style.opacity="0";const t=document.getElementById(`layer-name-${this.id}`);t.classList.remove("view-text"),t.classList.add("in-view-text");document.getElementById(`layer-name-input-${this.id}`).classList.add("in-view-text-input")}}}reloadStyle(){this.resetStyle(),this.setEmptyStyle(),this.setCharacterStyle()}setCharacterStyle(){const e=d.$timelineHeader.leftFrame,t=e+this._$children.length,r=new Map;for(let a=0;a<this._$characters.length;++a){const i=this._$characters[a];if(i.startFrame>t)continue;if(e>=i.endFrame)continue;const s=Array.from(i._$places.keys());s.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let t=0;t<s.length;++t){const a=s[t];if(r.has(a))continue;r.set(a,!0);const n=s[t+1]||i.endFrame;if(a===n-1){if(e>a)continue;const t=this._$children[a-e];if(!t)return;if(t.dataset.frameState="key-frame",i.hasTween(a)){t.classList.add("tween-key-frame");const e=i.getTween(a);(e.endFrame-e.startFrame>1||i.hasTween(e.endFrame))&&t.classList.add("tween-key-frame-join")}else{const e=i.getPlace(a);if(e.tweenFrame){const r=i.getTween(e.tweenFrame);r.endFrame-1===a?i.hasTween(r.endFrame)?t.classList.add("tween-space-frame"):t.classList.add("tween-frame-end"):t.classList.add("tween-space-frame")}else t.classList.add("key-frame")}continue}let o=a;if(e>o)o++;else{const t=o-e,r=this._$children[t];o++,r&&(r.dataset.frameState="key-frame",i.hasTween(a)?r.classList.add("tween-key-frame","tween-key-frame-join"):r.classList.add("key-frame","key-frame-join"))}const l=n-1;for(;o<l;){if(e>o){o++;continue}const t=o-e,r=this._$children[t];o++,r&&(r.dataset.frameState="key-space-frame",i.hasTween(a)?r.classList.add("tween-space-frame"):r.classList.add("key-space-frame"))}if(e>o)continue;const c=this._$children[o-e];c&&(c.dataset.frameState="key-space-frame-end",i.hasTween(a)?c.classList.add("tween-frame-end"):c.classList.add("key-space-frame-end"))}}}setEmptyStyle(){const e=d.$timelineHeader.leftFrame,t=e+this._$children.length;for(let r=0;r<this._$emptys.length;++r){const a=this._$emptys[r];if(a.startFrame>t)continue;if(e>=a.endFrame)continue;if(a.startFrame===a.endFrame-1){if(e>a.startFrame)continue;const t=a.startFrame-e,r=this._$children[t];r&&(r.dataset.frameState="empty-key-frame",r.classList.add("empty-key-frame"));continue}let i=a.startFrame;if(e>i)i++;else{const t=i-e,r=this._$children[t];r&&(r.dataset.frameState="empty-key-frame",r.classList.add("empty-key-frame","empty-key-frame-join")),i++}const s=a.endFrame-1;for(;i<s;){if(e>i){i++;continue}const t=i-e,r=this._$children[t];i++,r&&(r.dataset.frameState="empty-space-frame",r.classList.add("empty-space-frame"))}if(e>i)continue;const n=i-e,o=this._$children[n];o&&(o.dataset.frameState="empty-space-frame-end",o.classList.add("empty-space-frame-end"))}}resetStyle(){let e=d.$timelineHeader.leftFrame;for(let t=0;t<this._$children.length;++t){const r=this._$children[t];if(!r||"empty"===r.dataset.frameState)return;r.setAttribute("class",e%5!=0?"frame":"frame frame-pointer"),r.setAttribute("data-frame-state","empty"),e++}}get id(){return this._$id}set id(e){this._$id=d.$clamp(0|e,0,65535)}get name(){return this._$name}set name(e){this._$name=`${e}`}get light(){return this._$light}set light(e){this._$light=!!e}get disable(){return this._$disable}set disable(e){this._$disable=!!e}get lock(){return this._$lock}set lock(e){this._$lock=!!e}get emptyCharacters(){const e=[];for(let t=0;t<this._$emptys.length;++t)e.push(this._$emptys[t].toObject());return e}set emptyCharacters(e){for(let t=0;t<e.length;++t){const r=new f(e[t]);this._$emptys.push(r)}}get characters(){const e=[];for(let t=0;t<this._$characters.length;++t)e.push(this._$characters[t].toObject());return e}set characters(e){for(let t=0;t<e.length;++t){const r=new $(e[t]);r._$layerId=this.id,this._$instances.set(r.id,r),this._$characters.push(r)}}getCharacter(e){return this._$instances.get(0|e)}addCharacter(e){this._$instances.has(e.id)||(e._$layerId=this.id,this._$characters.push(e),this._$instances.set(e.id,e))}deleteCharacter(e){if(!this._$instances.has(0|e))return;const t=this._$instances.get(0|e);t._$layerId=-1,this._$characters.splice(this._$characters.indexOf(t),1),this._$instances.delete(0|e)}addEmptyCharacter(e){this._$emptys.push(e)}deleteEmptyCharacter(e){const t=this._$emptys.indexOf(e);t>-1&&this._$emptys.splice(t,1)}adjustmentLocation(e){const t=this.getActiveEmptyCharacter(e);if(t)return this.deleteEmptyCharacter(t),{startFrame:t.startFrame,endFrame:t.endFrame};const r=this.getActiveCharacter(e);if(r.length){let t=1,a=Number.MAX_VALUE;for(let i=0;i<r.length;++i){const s=r[i];t=Math.max(t,s.startFrame),a=Math.min(a,s.endFrame);for(const r of s._$places.keys())r>e&&(a=Math.min(a,r)),e>=r&&(t=Math.max(t,r))}return{startFrame:t,endFrame:a}}if(e>1){let t=1;for(;e-t>0;++t){const r=this.getActiveEmptyCharacter(e-t);if(r){r.endFrame=e;break}const a=this.getActiveCharacter(e-t);if(a.length){for(let t=0;t<a.length;++t)a[t].endFrame=e;break}}e-t||this.addEmptyCharacter(new f({startFrame:1,endFrame:e}))}return{startFrame:e,endFrame:e+1}}get totalFrame(){let e=0;for(let t=0;t<this._$characters.length;++t){const r=this._$characters[t];e=Math.max(e,r.endFrame)}for(let t=0;t<this._$emptys.length;++t){const r=this._$emptys[t];e=Math.max(e,r.endFrame)}return e}get mode(){return this._$mode}set mode(e){switch(e|=0){case I.NORMAL:case I.MASK:case I.MASK_IN:case I.GUIDE:case I.GUIDE_IN:this._$mode=e;break;default:this._$mode=I.NORMAL}}get maskId(){return this._$maskId}set maskId(e){this._$maskId="number"==typeof e?d.$clamp(0|e,0,65535):null}get guideId(){return this._$guideId}set guideId(e){this._$guideId="number"==typeof e?d.$clamp(0|e,0,65535):null}get color(){return this._$color}set color(e){this._$color=`${e}`}toObject(){return{name:this.name,light:this.light,disable:this.disable,lock:this.lock,mode:this.mode,maskId:this.maskId,guideId:this.guideId,color:this.color,characters:this.characters,emptyCharacters:this.emptyCharacters}}}class I{static get NORMAL(){return 0}static get MASK(){return 1}static get MASK_IN(){return 2}static get GUIDE(){return 3}static get GUIDE_IN(){return 4}}class E extends g{constructor(e){super(e),this._$currentFrame=1,this._$layerId=0,this._$labels=new Map,this._$layers=new Map,this._$actions=new Map,this._$sounds=new Map,this._$publishObject=null,e.layers&&(this.layers=e.layers),e.labels&&(this.labels=e.labels),e.placeMap&&(this.placeMap=e.placeMap),e.sounds&&(this.sounds=e.sounds),e.actions&&(this.actions=e.actions),e.currentFrame&&(this._$currentFrame=Math.max(1,0|e.currentFrame))}clone(){return new E(JSON.parse(JSON.stringify(this.toObject())))}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["text-setting","video-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["loop-setting"]),d.$loopController.reload(e.loop),document.getElementById("loop-image-list").style.display="none"}initialize(){d.$tools.reset(),d.$screen.clearStageArea(),d.$clearShapePointer();const e=document.getElementById("scene-name");e&&(e.textContent=this.name);const t=document.getElementById("object-name");t&&(t.value=this.name);const r=document.getElementById("object-symbol");if(r&&(r.value=this.symbol),0===this.id){const e=document.getElementById("scene-name-menu-list");if(e)for(;e.children.length;)e.children[0].remove()}d.$timelineLayer.removeAll();const a=this.currentFrame;d.$timelineFrame.currentFrame=a,d.$timelineHeader.setWidth(),d.$timelineHeader.scrollX=(this.currentFrame-1)*d.$timelineTool.timelineWidth,d.$timelineHeader.rebuild(),d.$timelineMarker.move(),d.$timelineLayer.changeLabel(a),d.$timelineLayer.updateClientHeight(),d.$timelineScroll._$y=1,d.$timelineScroll.execute(-d.$timelineScroll.y),this._$layerId=0;for(const e of this._$layers.values())e._$id=this._$layerId++,e.initialize();if(this._$layers.size||this.addLayer(),d.$controller.default(),this.id){const e=document.getElementById(`library-child-id-${this.id}`);e&&(e.draggable=!1)}d.$soundController.createSoundElements(),this.changeFrame(d.$timelineFrame.currentFrame)}get currentFrame(){return this._$currentFrame}get totalFrame(){let e=1;for(const t of this._$layers.values())e=Math.max(e,t.totalFrame-1);return e}changeFrame(e=1){d.$screen.clearStageArea();const t=document.getElementById("stage-area");if(!t)return;const r=[],a=t.children;for(let e=0;a.length>e;++e){const t=a[e];t.dataset.shapePointer&&(t.remove(),r.push(t),--e)}const i=Array.from(this._$layers.values());for(;i.length;){const t=i.pop();t.mode===I.MASK&&t.lock||t.appendCharacter(e)}this._$currentFrame=e,d.$transformController.relocation(),d.$gridController.relocation();for(let e=0;r.length>e;++e)t.appendChild(r[e]);d.$tweenController.clearPointer().relocationPointer()}addSceneName(){const e=d.$currentWorkSpace().getLibrary(0|this.id),t=`\n<div id="scene-instance-id-${e.id}" data-library-id="${e.id}">${e.name}</div>\n`;document.getElementById("scene-name-menu-list").insertAdjacentHTML("beforeend",t);const r=document.getElementById(`scene-instance-id-${e.id}`);r.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault()})),r.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.sceneChange(e)}))}sceneChange(e){d.$endMenu();const t=e.currentTarget;d.$sceneChange.execute(0|t.dataset.libraryId),t.remove()}stop(){if(this.id){const e=document.getElementById(`library-child-id-${this.id}`);e&&(e.draggable=!0);for(let e of this._$layers.values())e._$children.length=0}d.$tools.getDefaultTool("arrow").clear()}get labels(){const e=[];for(let[t,r]of this._$labels)e.push({frame:t,name:r});return e}set labels(e){for(let t=0;t<e.length;++t){const r=e[t];this._$labels.set(0|r.frame,r.name)}}setLabel(e,t){this._$labels.set(0|e,t)}getLabel(e){return this.hasLabel(e)?this._$labels.get(0|e):null}hasLabel(e){return this._$labels.has(e)}deleteLabel(e){this._$labels.delete(0|e)}get layers(){let e=0,t=null;const r=[];for(const a of this._$layers.values()){const i=a.toObject();switch(i.mode){case I.MASK:case I.GUIDE:t=e;break;case I.MASK_IN:i.maskId=t;break;case I.GUIDE_IN:i.guideId=t;break;default:t=null}r.push(i),e++}return r}set layers(e){for(let t=0;t<e.length;++t)this._$layers.set(t,new v(e[t]))}addLayer(e=null){e||(e=new v),e._$id=this._$layerId++,this._$layers.set(e._$id,e),e.initialize()}getLayer(e){return this._$layers.get(0|e)}setLayer(e,t){this._$layers.set(0|e,t)}deleteLayer(e){this._$layers.delete(0|e)}clearLayer(){this._$layers.clear()}get sounds(){const e=[];for(let[t,r]of this._$sounds)e.push({frame:t,sound:r});return e}set sounds(e){for(let t=0;t<e.length;++t){const r=e[t];this._$sounds.set(0|r.frame,r.sound)}}get actions(){const e=[];for(let[t,r]of this._$actions)e.push({frame:t,action:r});return e}set actions(e){for(let t=0;t<e.length;++t){const r=e[t];this._$actions.set(0|r.frame,r.action)}}getSound(e){return this._$sounds.get(e)}setSound(e,t){return this._$sounds.set(e,t)}hasSound(e){return this._$sounds.has(e)}deleteSound(e){this._$sounds.delete(e)}getAction(e){return this._$actions.get(e)}setAction(e,t){this._$actions.set(e,t),d.$javascriptController.reload()}hasAction(e){return this._$actions.has(e)}deleteAction(e){this._$actions.delete(e),d.$javascriptController.reload()}getBounds(e=[1,0,0,1,0,0],t=null,r=null,a=0){if(!this._$layers.size)return{xMin:0,xMax:0,yMin:0,yMax:0};let i=Number.MAX_VALUE,s=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE;const l=d.$currentFrame;let c=a||1;t&&r&&(c=d.$getFrame(t,r,l,this.totalFrame,a)),c>this.totalFrame&&(c=1);const h=e;d.$currentFrame=c;const u=d.$currentWorkSpace();for(const e of this._$layers.values()){if(e.disable)continue;const t=e.getActiveCharacter(c),r=t.length;for(let e=0;e<r;++e){const r=t[e],a=r.getPlace(c),l=a.loop&&a.loop.type===_e.DEFAULT?{startFrame:r.startFrame,endFrame:r.endFrame}:r.getRange(c),m=u.getLibrary(0|r.libraryId),g=d.$multiplicationMatrix(h,a.matrix),p=m.getBounds(g,a,l,c),$=p.xMax-p.xMin,f=p.yMax-p.yMin;$&&f||(p.xMin=g[4],p.xMax=g[4],p.yMin=g[5],p.yMax=g[5]),i=Math.min(p.xMin,i),s=Math.max(p.xMax,s),n=Math.min(p.yMin,n),o=Math.max(p.yMax,o)}}return d.$currentFrame=l,{xMin:i,xMax:s,yMin:n,yMax:o}}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,currentFrame:this.currentFrame,layers:this.layers,labels:this.labels,sounds:this.sounds,actions:this.actions}}toPublish(){const e=[],t=[],r=[],a=[],i=d.$currentWorkSpace(),s=new Map;let n=0;for(const e of i._$libraries.keys())s.set(e,n++);let o=0,l=!1,c=0;const h=d.$userSetting.getPublishSetting(),u=Array.from(this._$layers),m=[];let g=0,p=0;for(let s=u.length-1;s>-1;--s){if(c&&!m.length){c=0,g=0;continue}const n=!l&&m.length?m.shift():u[s][1];if(!h.layer&&n.disable)continue;if(n.mode===I.GUIDE)continue;if(n.mode!==I.MASK_IN||l||c||(l=!0,c=s),l&&n.mode===I.MASK_IN){g+=n._$characters.length,m.push(n);continue}const $=n._$characters,f=n.mode===I.MASK?Math.min(1,$.length):$.length;let y=n.mode===I.MASK?f-1:0;for(;;){const s=e.length,l=$[y];if(!l)break;const c=l.startFrame,h=l.endFrame,u=i._$libraries.get(l.libraryId);d.$useIds.has(u.id)||d.$useIds.set(u.id,!0),e.push({name:l.name,characterId:u.id,endFrame:h,startFrame:c,clipDepth:n.mode===I.MASK?y+g+o:0});let m=0;for(let e=c;e<h;++e){e in t||(t[e]=[]),e in r||(r[e]=[]);const i=l.getPlace(e);if(l.hasPlace(e)){m=a.length;const e=[];for(let t=0;t<i.filter.length;++t){const r=i.filter[t];r.state&&e.push({class:r.name,params:r.toParamArray()})}const t={matrix:i.matrix,colorTransform:i.colorTransform,blendMode:i.blendMode,surfaceFilterList:e};if(u.type===b.MOVIE_CLIP&&_e.DEFAULT>i.loop.type){if(i.loop.referenceFrame){const e=l.getPlace(i.loop.referenceFrame);t.loop={type:e.loop.type,frame:e.frame,start:e.loop.start,end:e.loop.end}}else t.loop={type:i.loop.type,frame:i.frame,start:i.loop.start,end:i.loop.end};i.loop.tweenFrame&&(t.loop.tweenFrame=i.loop.tweenFrame)}a.push(t)}t[e][p+i.depth]=s,r[e][p+i.depth]=m}if(n.mode===I.MASK){if(--y,-1===y)break}else if(++y,y===f)break}o+=f,p+=f,l&&m.length&&(s=c+1,l=!1)}for(let e=1;t.length>e;++e){if(!(e in t))continue;const a=t[e],i=r[e];t[e]=a.filter((e=>"number"==typeof e)),r[e]=i.filter((e=>"number"==typeof e))}const $=[];for(let[e,t]of this._$sounds){const r={frame:e,sound:[]};for(let e=0;e<t.length;++e){const a=t[e],i=0|a.characterId;r.sound.push({characterId:i,volume:a.volume/100,autoPlay:a.autoPlay,loopCount:a.loopCount}),d.$useIds.has(i)||d.$useIds.set(i,!0)}$.push(r)}const f=[];for(let[e,t]of this._$actions){const r=t.replace(/("[^"]*\/\/.*?")|\/\/(?:.|\r?\n)*?(?:\r?\n|.*)?/g,"$1").replace(/(["'][^"']*\/\*.*?\*\/[^"']*["'])|\/\*(?:.|\r?\n)*?\*\//g,"$1").replace(/^\s+|\s+$/g,"").replace(/ +/g," ").split(/\r?\n/);let a=[];for(let e=0;e<r.length;++e){const t=r[e].trim();t.length&&a.push(t)}f.push({frame:e,action:a.join("\n")})}return{actions:f,symbol:this.symbol,extends:this.defaultSymbol,totalFrame:this.totalFrame,controller:t,dictionary:e,labels:this.labels,placeMap:r,placeObjects:a,sounds:$}}get defaultSymbol(){return window.next2d.display.MovieClip.namespace}createInstance(e,t,r=0){const{MovieClip:a}=window.next2d.display,{Matrix:i,ColorTransform:s}=window.next2d.geom,n=d.$currentWorkSpace(),o=new a,l=d.$currentFrame;d.$useIds.clear();let c=null;d.$timelinePlayer._$stopFlag?(this._$publishObject&&(this._$publishObject=null),c=this.toPublish()):(this._$publishObject||(this._$publishObject=this.toPublish()),c=this._$publishObject);let h=r||1;e&&t&&(h=d.$getFrame(e,t,l,this.totalFrame,r)),h>this.totalFrame&&(h=1),d.$currentFrame=h,o._$currentFrame=h;const u=c.controller[h];if(!u)return o;const m=c.placeMap[h];for(let e=0;u.length>e;++e){const r=c.dictionary[u[e]],a=n.getLibrary(r.characterId),l=c.placeObjects[m[e]];l.loop||(l.loop=d.$getDefaultLoopConfig());let g=null;switch(a.type){case b.MOVIE_CLIP:{if(!a._$layers.size)continue;const r=Array.from(a._$layers.values()).reverse();let i=null,s=-1;for(let t=0;t<r.length;++t){if(s++,s!==e)continue;const a=r[t].getActiveCharacter(h);a.length>1&&a.sort(((e,t)=>{const r=e.getPlace(h).depth,a=t.getPlace(h).depth;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}})),a.length&&(i=a[0].getRange(h))}l&&(l.frame=h,l.loop.type===_e.DEFAULT&&(i=t)),g=a.createInstance(l,i,h)}break;case b.SHAPE:g=a.createInstance(),g._$bitmapId=a._$bitmapId;break;default:g=a.createInstance()}g.transform.matrix=new i(l.matrix[0],l.matrix[1],l.matrix[2],l.matrix[3],l.matrix[4],l.matrix[5]),g.transform.colorTransform=new s(l.colorTransform[0],l.colorTransform[1],l.colorTransform[2],l.colorTransform[3],l.colorTransform[4],l.colorTransform[5],l.colorTransform[6],l.colorTransform[7]),g.blendMode=l.blendMode;const p=[];for(let e=0;e<l.surfaceFilterList.length;++e){const t=l.surfaceFilterList[e],r=window.next2d.filters[t.class];p.push(new(r.bind.apply(r,t.params)))}g.filters=p,g._$placeId=e,g._$clipDepth=r.clipDepth,g._$loaderInfo={_$id:0},g._$characterId=r.characterId,o.addChild(g)}return d.$currentFrame=l,o}}class S extends g{constructor(e=null){super(e),this._$bitmapId=0,this._$bounds=null,this._$grid=null,this._$inBitmap=!1,this._$recodes=[],e.inBitmap&&(this.inBitmap=e.inBitmap),e.recodes&&(this.recodes=e.recodes),e.bounds&&(this.bounds=e.bounds),e.bitmapId&&(this.bitmapId=e.bitmapId),e.grid&&(this.grid=e.grid)}clone(){return new S(JSON.parse(JSON.stringify(this.toObject())))}showController(e,t=""){super.showController(e,t),document.getElementById("nine-slice-setting-x").value="0",document.getElementById("nine-slice-setting-y").value="0",document.getElementById("nine-slice-setting-w").value="0",document.getElementById("nine-slice-setting-h").value="0",d.$controller.showObjectSetting(["nine-slice-setting"]),d.$controller.hideObjectSetting(["text-setting","loop-setting","video-setting","fill-color-setting"])}showShapeColor(e,t){this.setHitColor(t.offsetX,t.offsetY,e.matrix);const r=this._$grid;r&&r.x&&r.y&&(document.getElementById("nine-slice-setting-x").value=`${r.x}`,document.getElementById("nine-slice-setting-y").value=`${r.y}`,document.getElementById("nine-slice-setting-w").value=`${r.w}`,document.getElementById("nine-slice-setting-h").value=`${r.h}`,d.$gridController.show().relocation()),d.$hitColor&&d.$controller.showObjectSetting(["fill-color-setting","nine-slice-setting"])}getBounds(e=null){return e?d.$boundsMatrix(this._$bounds,e):this._$bounds}get inBitmap(){return this._$inBitmap}set inBitmap(e){this._$inBitmap=!!e}get width(){return Math.abs(this._$bounds.xMax-this._$bounds.xMin)}get height(){return Math.abs(this._$bounds.yMax-this._$bounds.yMin)}get defaultSymbol(){return window.next2d.display.Shape.namespace}get recodes(){if(!this._$inBitmap)return this._$recodes;const e=[],{BitmapData:t}=window.next2d.display;for(let r=0;this._$recodes.length>r;++r){const a=this._$recodes[r];e[r]=a,"object"==typeof a&&(a.namespace===t.namespace&&(e[r]={buffer:Array.from(a._$buffer),width:a.width,height:a.height}))}return e}set recodes(e){if(this._$recodes=e,this._$inBitmap){const{BitmapData:e}=window.next2d.display;for(let t=0;this._$recodes.length>t;++t){const r=this._$recodes[t];if("object"!=typeof r)continue;if(r.namespace===e.namespace)continue;if(!r.buffer)continue;const a=new e(r.width,r.height,!0,0);a._$buffer=new Uint8Array(r.buffer),this._$recodes[t]=a}}}get bounds(){return this._$bounds}set bounds(e){this._$bounds=e}get bitmapId(){return this._$bitmapId}set bitmapId(e){this._$bitmapId=0|e}get grid(){return this._$grid}set grid(e){this._$grid=e}createPointer(e,t,r){d.$clearShapePointer();const a=document.getElementById("stage-area");let i=2;const{Graphics:s}=window.next2d.display;for(let a=0;a<this._$recodes.length;)switch(this._$recodes[a++]){case s.MOVE_TO:i=a,a+=2;break;case s.LINE_TO:this.addPointer(t,r,a,this._$recodes[a++],this._$recodes[a++],e,s.LINE_TO),this._$adjustmentPointer(a,e,t,r,i);break;case s.CUBIC:for(let i=0;2>i;++i)this.addPointer(t,r,a,this._$recodes[a++],this._$recodes[a++],e,s.CUBIC,!0);this.addPointer(t,r,a,this._$recodes[a++],this._$recodes[a++],e,s.CUBIC,!1),this._$adjustmentPointer(a,e,t,r,i);break;case s.CURVE_TO:this.addPointer(t,r,a,this._$recodes[a++],this._$recodes[a++],e,s.CURVE_TO,!0),this.addPointer(t,r,a,this._$recodes[a++],this._$recodes[a++],e,s.CURVE_TO),this._$adjustmentPointer(a,e,t,r,i);break;case s.FILL_STYLE:a+=4;break;case s.STROKE_STYLE:a+=8;break;case s.GRADIENT_FILL:a+=6;break;case s.GRADIENT_STROKE:a+=10;case s.BEGIN_PATH:case s.END_FILL:case s.END_STROKE:}d.$addModalEvent(a)}_$adjustmentPointer(e,t,r,a,i){const{Graphics:s}=window.next2d.display;switch(this._$recodes[e]){case s.MOVE_TO:case s.FILL_STYLE:case s.GRADIENT_FILL:{const e=document.getElementById("stage-area").children;e[e.length-1].dataset.syncId=`${i}`}break;case s.STROKE_STYLE:case s.GRADIENT_STROKE:this.addPointer(r,a,5,this._$recodes[5],this._$recodes[6],t,s.MOVE_TO)}}addPointer(e,t,r,a,i,s,n,o=!1){const l=document.getElementById("stage-area"),c=document.createElement("div");c.classList.add("transform"),c.dataset.shapePointer="true",c.dataset.layerId=`${e}`,c.dataset.characterId=`${t}`,c.dataset.index=`${r}`,c.dataset.libraryId=`${this.id}`,c.dataset.curve=`${o}`,c.dataset.type=`${n}`,c.dataset.position=`${l.children.length}`;const h=a*s[0]+i*s[2]+s[4],u=a*s[1]+i*s[3]+s[5];c.style.left=h*d.$zoomScale+d.$offsetLeft-3+"px",c.style.top=u*d.$zoomScale+d.$offsetTop-3+"px",o?c.style.borderRadius="5px":c.dataset.detail="{{ダブルクリックでカーブポイントが追加されます}}",c.addEventListener("mousedown",(e=>{if(e.button)return;e.stopPropagation();const t=d.$tools.activeTool;t&&(e.shapePointer=!0,t.dispatchEvent(Y.MOUSE_DOWN,e))})),c.addEventListener("dblclick",(e=>{e.stopPropagation();const t=d.$tools.activeTool;t&&(e.shapePointer=!0,e.matrix=s,t.dispatchEvent(Y.DBL_CLICK,e))})),l.appendChild(c)}reloadBounds(e=0){const{Graphics:t,Shape:r}=window.next2d.display,a=new r;e?a.graphics.lineStyle(e):a.graphics.beginFill();for(let e=0;e<this._$recodes.length;)switch(this._$recodes[e++]){case t.MOVE_TO:a.graphics.moveTo(this._$recodes[e++],this._$recodes[e++]);break;case t.LINE_TO:a.graphics.lineTo(this._$recodes[e++],this._$recodes[e++]);break;case t.CUBIC:a.graphics.cubicCurveTo(this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++]);break;case t.CURVE_TO:a.graphics.curveTo(this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++]);break;case t.FILL_STYLE:e+=4;break;case t.STROKE_STYLE:e+=8;break;case t.GRADIENT_FILL:{const{Matrix:t}=window.next2d.geom,r=new t,i=this.width/2/819.2,s=this.height/2/819.2;r.scale(i,s),r.translate(this.width/2+a.graphics._$xMin,this.height/2+a.graphics._$yMin),this._$recodes[e+2]=Array.from(r._$matrix),e+=6}break;case t.GRADIENT_STROKE:{const{Matrix:t}=window.next2d.geom,r=new t,i=this.width/2/819.2,s=this.height/2/819.2;r.scale(i,s),r.translate(this.width/2+a.graphics._$xMin,this.height/2+a.graphics._$yMin),this._$recodes[e+6]=Array.from(r._$matrix),e+=10}case t.BEGIN_PATH:case t.END_FILL:case t.END_STROKE:}return{xMin:a.graphics._$xMin,xMax:a.graphics._$xMax,yMin:a.graphics._$yMin,yMax:a.graphics._$yMax}}copyFrom(e){return e._$recodes=this._$recodes.slice(),e._$bounds={xMin:this._$bounds.xMin,xMax:this._$bounds.xMax,yMin:this._$bounds.yMin,yMax:this._$bounds.yMax},e._$bitmapId=this._$bitmapId,e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,bitmapId:this.bitmapId,grid:this.grid,inBitmap:this.inBitmap,recodes:this.recodes,bounds:this.bounds}}toPublish(){return this._$bitmapId&&d.$useIds.set(this._$bitmapId,!0),{symbol:this.symbol,extends:this.defaultSymbol,bitmapId:this.bitmapId,grid:this.grid,inBitmap:this.inBitmap,recodes:this.recodes,bounds:{xMin:this._$bounds.xMin,xMax:this._$bounds.xMax,yMin:this._$bounds.yMin,yMax:this._$bounds.yMax}}}changeStyle(e){const{Graphics:t,GradientType:r}=window.next2d.display,a=d.$hitColor.index;switch(d.$hitColor.style){case t.BITMAP_FILL:case t.FILL_STYLE:switch(document.getElementById("fill-color-type-select").value){case r.LINEAR:case r.RADIAL:{const r=document.getElementById("fill-color-value").value,i=d.$intToRGB(0|`0x${r.slice(1)}`),s=(0|document.getElementById("fill-alpha-value").value)/100*255;this.changeGradient(a,e,t.GRADIENT_FILL,6,i,s)}}break;case t.GRADIENT_FILL:{const r=document.getElementById("fill-color-type-select"),i=this._$recodes[a+1].pop();switch(r.value){case"bitmap":case"rgba":this._$recodes.splice(a-1,12,t.FILL_STYLE,i.R,i.G,i.B,i.A,t.END_FILL),d.$hitColor={index:a,style:t.FILL_STYLE,shape:this};break;default:this.changeGradient(a,e,t.GRADIENT_FILL,12,i,i.A)}}break;case t.STROKE_STYLE:switch(document.getElementById("fill-color-type-select").value){case r.LINEAR:case r.RADIAL:{const r=document.getElementById("fill-color-value").value,i=d.$intToRGB(0|`0x${r.slice(1)}`),s=(0|document.getElementById("fill-alpha-value").value)/100*255;this.changeGradient(a,e,t.GRADIENT_STROKE,5,i,s)}}break;case t.GRADIENT_STROKE:{const r=document.getElementById("fill-color-type-select"),i=this._$recodes[a+5].pop(),s=this._$recodes[a],n=this._$recodes[a+1],o=this._$recodes[a+2],l=this._$recodes[a+3];switch(r.value){case"bitmap":case"rgba":this._$recodes.splice(a-1,11,t.STROKE_STYLE,s,n,o,l,i.R,i.G,i.B,i.A,t.END_STROKE),d.$hitColor={index:a,width:s,style:t.STROKE_STYLE,shape:this};break;default:this.changeGradient(a,e,t.GRADIENT_STROKE,6,i,i.A)}}}this.cacheClear();const i=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(i)}changeGradient(e,t,r,a,i,s){const{Graphics:n,SpreadMethod:o,InterpolationMethod:l}=window.next2d.display,{Matrix:c}=window.next2d.geom,h=new c,u=this.width/2/819.2,m=this.height/2/819.2;h.scale(u,m),h.translate(this.width/2+this._$bounds.xMin,this.height/2+this._$bounds.yMin);const g=[{ratio:0,R:255,G:255,B:255,A:255},{ratio:1,R:i.R,G:i.G,B:i.B,A:s}];d.$hitColor={index:e,style:r,type:t,ratios:g,shape:this},n.GRADIENT_STROKE===r?(this._$recodes[e-1]=n.GRADIENT_STROKE,this._$recodes.splice(e+4,a,t,g,Array.from(h._$matrix),o.PAD,l.RGB,0),d.$hitColor.width=this._$recodes[e]):this._$recodes.splice(e-1,a,r,t,g,Array.from(h._$matrix),o.PAD,l.RGB,0),d.$shapeController.initializeGradient()}changeColor(e=-1){const{Graphics:t}=window.next2d.display,r=d.$hitColor.index;switch(d.$hitColor.style){case t.BITMAP_FILL:break;case t.BITMAP_STROKE:{const e=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[r]!==e){d.$hitColor.width=e,this._$recodes[r]=e;const t=this.reloadBounds(e);this._$bounds.xMin=t.xMin,this._$bounds.xMax=t.xMax,this._$bounds.yMin=t.yMin,this._$bounds.yMax=t.yMax,this.cacheClear()}}break;case t.FILL_STYLE:{const e=document.getElementById("fill-color-value").value,t=d.$intToRGB(0|`0x${e.slice(1)}`);this._$recodes[r]=t.R,this._$recodes[r+1]=t.G,this._$recodes[r+2]=t.B,this._$recodes[r+3]=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255)}break;case t.GRADIENT_FILL:{const t=this._$recodes[r+1],a=t[e>-1?e:t.length-1],i=document.getElementById("fill-color-value").value,s=d.$intToRGB(0|`0x${i.slice(1)}`);a.R=s.R,a.G=s.G,a.B=s.B,a.A=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255)}break;case t.STROKE_STYLE:{const e=document.getElementById("fill-color-value").value,t=d.$intToRGB(0|`0x${e.slice(1)}`);this._$recodes[r+4]=t.R,this._$recodes[r+5]=t.G,this._$recodes[r+6]=t.B,this._$recodes[r+7]=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255);const a=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[r]!==a){d.$hitColor.width=a,this._$recodes[r]=a;const e=this.reloadBounds(a);this._$bounds.xMin=e.xMin,this._$bounds.xMax=e.xMax,this._$bounds.yMin=e.yMin,this._$bounds.yMax=e.yMax,this.cacheClear()}}break;case t.GRADIENT_STROKE:{const t=this._$recodes[r+5],a=t[e>-1?e:t.length-1],i=document.getElementById("fill-color-value").value,s=d.$intToRGB(0|`0x${i.slice(1)}`);a.R=s.R,a.G=s.G,a.B=s.B,a.A=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255);const n=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[r]!==n){d.$hitColor.width=n,this._$recodes[r]=n;const e=this.reloadBounds(n);this._$bounds.xMin=e.xMin,this._$bounds.xMax=e.xMax,this._$bounds.yMin=e.yMin,this._$bounds.yMax=e.yMax,this.cacheClear()}}}this.cacheClear()}cacheClear(){const e=d.$currentWorkSpace().scene;for(const t of e._$layers.values()){const e=t._$characters.length;for(let r=0;r<e;++r){const e=t._$characters[r];e.libraryId===this.id&&e.dispose()}}}setHitColor(e,t,r){if(!this._$recodes.length)return;const{Graphics:a,GradientType:i}=window.next2d.display,{Point:s,Matrix:n}=window.next2d.geom,o=new n,l=Math.sqrt(r[0]*r[0]+r[1]*r[1])*d.$zoomScale,c=Math.sqrt(r[2]*r[2]+r[3]*r[3])*d.$zoomScale;o.scale(l,c);const h=Math.atan2(r[1],r[0]);h&&(o.translate(-this.width/2,-this.height/2),o.rotate(h),o.translate(this.width/2,this.height/2));const u=o.transformPoint(new s(0,0)),m=o.transformPoint(new s(this.width,0)),g=o.transformPoint(new s(0,this.height)),p=o.transformPoint(new s(this.width,this.height)),$=Math.min(u.x,m.x,g.x,p.x),f=Math.min(u.y,m.y,g.y,p.y);o.translate(-$,-f),d.$hitColor=null,d.$hitContext.lineWidth=0,d.$hitContext.beginPath(),d.$hitContext.setTransform(o._$matrix[0],o._$matrix[1],o._$matrix[2],o._$matrix[3],-this._$bounds.xMin*l+o._$matrix[4],-this._$bounds.yMin*c+o._$matrix[5]);const y=this._$recodes,_=y.length;for(let r=0;r<_;)switch(y[r++]){case a.BEGIN_PATH:d.$hitContext.beginPath();break;case a.MOVE_TO:d.$hitContext.moveTo(y[r++],y[r++]);break;case a.LINE_TO:d.$hitContext.lineTo(y[r++],y[r++]);break;case a.CURVE_TO:d.$hitContext.quadraticCurveTo(y[r++],y[r++],y[r++],y[r++]);break;case a.CUBIC:d.$hitContext.bezierCurveTo(y[r++],y[r++],y[r++],y[r++],y[r++],y[r++]);break;case a.FILL_STYLE:if(d.$hitContext.isPointInPath(e,t)){if(this._$bitmapId)d.$hitColor={index:r,style:a.BITMAP_FILL,shape:this},document.getElementById("fill-color-type-select")[1].selected=!0;else{d.$hitColor={index:r,style:a.FILL_STYLE,shape:this};const e=y[r].toString(16).padStart(2,"0"),t=y[r+1].toString(16).padStart(2,"0"),i=y[r+2].toString(16).padStart(2,"0");document.getElementById("fill-color-type-select")[0].selected=!0,document.getElementById("fill-color-value").value=`#${e}${t}${i}`,document.getElementById("fill-alpha-value").value=""+y[r+3]/255*100}d.$shapeController.changeFillColorTypeSelect()}r+=4;break;case a.GRADIENT_FILL:d.$hitContext.isPointInPath(e,t)&&(document.getElementById("fill-color-type-select")[y[r]===i.LINEAR?2:3].selected=!0,d.$hitColor={index:r,style:a.GRADIENT_FILL,type:y[r],ratios:y[r+1],shape:this},d.$shapeController.changeFillColorTypeSelect()),r+=6;break;case a.STROKE_STYLE:if(d.$hitContext.lineWidth=0|y[r],d.$hitContext.isPointInStroke(e,t)){if(this._$bitmapId)d.$hitColor={index:r,width:d.$hitContext.lineWidth,style:a.BITMAP_STROKE,shape:this},document.getElementById("fill-color-type-select")[1].selected=!0;else{d.$hitColor={index:r,width:d.$hitContext.lineWidth,style:a.STROKE_STYLE,shape:this};const e=y[r+4].toString(16).padStart(2,"0"),t=y[r+5].toString(16).padStart(2,"0"),i=y[r+6].toString(16).padStart(2,"0");document.getElementById("fill-color-type-select")[0].selected=!0,document.getElementById("fill-color-value").value=`#${e}${t}${i}`,document.getElementById("fill-alpha-value").value=""+y[r+7]/255*100}document.getElementById("fill-stroke-width-value").value=`${d.$hitContext.lineWidth}`,d.$shapeController.changeFillColorTypeSelect()}r+=8;break;case a.GRADIENT_STROKE:d.$hitContext.lineWidth=y[r],d.$hitContext.isPointInStroke(e,t)&&(document.getElementById("fill-color-type-select")[y[r+4]===i.LINEAR?2:3].selected=!0,d.$hitColor={index:r,width:y[r],style:a.GRADIENT_STROKE,type:y[r+4],ratios:y[r+5],shape:this},d.$shapeController.changeFillColorTypeSelect()),r+=10;case a.CLOSE_PATH:case a.END_STROKE:case a.END_FILL:}}createInstance(){const{Shape:e,Graphics:t}=window.next2d.display,r=new e;if(this._$grid){const{Rectangle:e}=window.next2d.geom;r.scale9Grid=new e(this._$grid.x,this._$grid.y,this._$grid.w,this._$grid.h)}const a=r.graphics;if(a._$maxAlpha=1,a._$canDraw=!0,a._$xMin=this._$bounds.xMin,a._$xMax=this._$bounds.xMax,a._$yMin=this._$bounds.yMin,a._$yMax=this._$bounds.yMax,this._$bitmapId){const{BitmapData:e}=window.next2d.display,i=d.$currentWorkSpace().getLibrary(this._$bitmapId);if(i){r._$bitmapId=this._$bitmapId,a._$recode=[];const s=new e(i.width,i.height,!0,0);s._$buffer=i._$buffer;const n=this._$recodes;if(n[n.length-1]===t.END_FILL){const e=n.length-6;for(let t=0;t<e;++t)a._$recode.push(n[t]);a._$recode.push(t.BITMAP_FILL,s,null,"repeat",!1)}else{const e=this._$recodes[n.length-9],r=this._$recodes[n.length-8],i=this._$recodes[n.length-7],o=this._$recodes[n.length-6],l=n.length-10;for(let e=0;e<l;++e)a._$recode.push(n[e]);a._$recode.push(t.BITMAP_STROKE,e,r,i,o,s,[1,0,0,1,a._$xMin,a._$yMin],"repeat",!1)}}else a._$recode=this._$recodes.slice(0)}else a._$recode=this._$recodes.slice(0);return r}}class w extends g{constructor(e){super(e),this.buffer=e.buffer,this._$binary="",this._$volume=100,this._$loopCount=0,"volume"in e&&(this.volume=e.volume),"loopCount"in e&&(this.loopCount=e.loopCount),this._$audio=document.createElement("audio"),this._$audio.preload="auto",this._$audio.autoplay=!1,this._$audio.loop=!1,this._$audio.controls=!0,this._$audio.src=URL.createObjectURL(new Blob([new Uint8Array(this._$buffer)],{type:"audio/mp3"})),this._$audio.load()}getPreview(){return this._$audio}get defaultSymbol(){return window.next2d.media.Sound.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let r=0;r<t;++r)this._$buffer[r]=255&e.charCodeAt(r);this._$binary=e}}}get volume(){return this._$volume}set volume(e){this._$volume=e}get loopCount(){return this._$loopCount}set loopCount(e){this._$loopCount=e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,buffer:this.buffer,volume:this.volume,loopCount:this.loopCount}}toPublish(){return{buffer:Array.from(this._$buffer),audioBuffer:null,init:!1}}}class x{constructor(e=null){e?(this._$width=e.width,this._$height=e.height,this._$fps=e.fps,this._$bgColor=e.bgColor,this._$lock=e.lock):(this._$width=x.STAGE_DEFAULT_WIDTH,this._$height=x.STAGE_DEFAULT_HEIGHT,this._$fps=x.STAGE_DEFAULT_FPS,this._$bgColor="#ffffff",this._$lock=!1)}static get STAGE_DEFAULT_WIDTH(){return 550}static get STAGE_DEFAULT_HEIGHT(){return 400}static get STAGE_DEFAULT_FPS(){return 24}initialize(){d.$zoomScale=1;const e=document.getElementById("screen-scale");e&&(e.value="100");const t=document.getElementById("stage");t&&(t.style.width=`${this.width}px`,t.style.height=`${this.height}px`,t.style.backgroundColor=this.bgColor);const r=document.getElementById("library-preview-area");r&&(r.style.backgroundColor=this.bgColor);const a=document.getElementById("stage-area");a&&(a.style.transformOrigin="50% 50%",a.style.width=`${this.width+window.screen.width}px`,a.style.height=`${this.height+window.screen.height}px`);const i=document.getElementById("label-name");i&&(i.value="");const s=document.getElementById("stage-width");s&&(s.value=this.width);const n=document.getElementById("stage-height");n&&(n.value=this.height);const o=document.getElementById("stage-fps");o&&(o.value=this.fps);const l=document.getElementById("stage-bgColor");l&&(l.value=this.bgColor);const c=document.getElementById("stage-lock");if(c){c.childNodes[1].setAttribute("class",this.lock?"active":"disable")}d.$controller._$stageLock=this.lock;const h=document.getElementById("screen");h&&(h.scrollLeft=window.screen.width/2-(h.clientWidth-this.width)/2,h.scrollTop=window.screen.height/2-(h.clientHeight-this.height)/2),t&&(d.$offsetLeft=t.offsetLeft,d.$offsetTop=t.offsetTop)}get width(){return this._$width}set width(e){this._$width=d.$clamp(+e,1,4096)}get height(){return this._$height}set height(e){this._$height=d.$clamp(+e,1,4096)}get fps(){return this._$fps}set fps(e){this._$fps=d.$clamp(0|e,1,60)}get bgColor(){return this._$bgColor}set bgColor(e){this._$bgColor=`${e}`.toLowerCase()}get lock(){return this._$lock}set lock(e){this._$lock=!!e}toObject(){return{width:this.width,height:this.height,fps:this.fps,bgColor:this.bgColor,lock:this.lock}}}class L extends g{constructor(e=null){super(e),this._$text="",this._$font="sans-serif",this._$size=12,this._$align="left",this._$color=0,this._$fontType=0,this._$inputType="static",this._$leading=0,this._$letterSpacing=0,this._$leftMargin=0,this._$rightMargin=0,this._$autoSize=0,this._$multiline=!0,this._$wordWrap=!0,this._$border=!1,this._$scroll=!0,this._$cache=null,this._$htmlText=null,this._$thickness=0,this._$thicknessColor=0,this._$bounds={xMin:0,xMax:L.FONT_DEFAULT_SIZE,yMin:0,yMax:L.FONT_DEFAULT_SIZE},this._$originBounds={xMin:0,xMax:L.FONT_DEFAULT_SIZE,yMin:0,yMax:L.FONT_DEFAULT_SIZE},e.text&&(this.text=e.text),e.font&&(this.font=e.font),e.fontType&&(this.fontType=e.fontType),e.inputType&&(this.inputType=e.inputType),e.size&&(this.size=e.size),e.align&&(this.align=e.align),e.color&&(this.color=e.color),e.leading&&(this.leading=e.leading),e.letterSpacing&&(this.letterSpacing=e.letterSpacing),e.leftMargin&&(this.leftMargin=e.leftMargin),e.rightMargin&&(this.rightMargin=e.rightMargin),"multiline"in e&&(this.multiline=e.multiline),"wordWrap"in e&&(this.wordWrap=e.wordWrap),e.autoFontSize&&(this.autoFontSize=e.autoFontSize),"scroll"in e&&(this.scroll=e.scroll),e.border&&(this.border=e.border),e.bounds&&(this.bounds=e.bounds),e.originBounds&&(this.originBounds=e.originBounds),e.autoSize&&(this.autoSize=e.autoSize),e.thickness&&(this.thickness=e.thickness),e.thicknessColor&&(this.thicknessColor=e.thicknessColor)}static get FONT_DEFAULT_SIZE(){return 200}clone(){return new L(JSON.parse(JSON.stringify(this.toObject())))}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["video-setting","loop-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["text-setting"]);const r=document.getElementById("font-select");r.children[0].selected=!0;for(let e=0;e<r.children.length;++e){const t=r.children[e];if(t.value===this._$font){t.selected=!0;break}}const a=document.getElementById("font-style-select");for(let e=0;e<a.children.length;++e){const t=a.children[e];if((0|t.value)===this._$fontType){t.selected=!0;break}}const i=document.getElementById("font-align-select");for(let e=0;e<i.children.length;++e){const t=i.children[e];if(t.value===this._$align){t.selected=!0;break}}const s=document.getElementById("font-wrap-select");switch(!0){case!this._$wordWrap&&!this._$multiline:s.children[0].selected=!0;break;case!this._$wordWrap&&this._$multiline:s.children[1].selected=!0;break;case this._$wordWrap&&this._$multiline:s.children[2].selected=!0}document.getElementById("font-input-select").children["static"===this._$inputType?0:1].selected=!0,document.getElementById("font-size").value=`${this._$size}`,document.getElementById("font-color").value=`#${this._$color.toString(16).padStart(6,"0")}`,document.getElementById("font-stroke-size").value=`${this._$thickness}`,document.getElementById("font-stroke-color").value=`#${this._$thicknessColor.toString(16).padStart(6,"0")}`;const n=["font-leading","font-letterSpacing","font-leftMargin","font-rightMargin"];for(let e=0;e<n.length;++e){const t=n[e];document.getElementById(t).value=`${this[t.split("-")[1]]}`}document.getElementById("font-auto-size-select").children[this._$autoSize].selected=!0,this._$border&&(document.getElementById("font-border-select").children[1].selected=!0),this._$scroll&&(document.getElementById("font-scroll-select").children[0].selected=!0)}getBounds(e=null){const t={xMin:-this._$thickness,xMax:this._$bounds.xMax+this._$thickness,yMin:-this._$thickness,yMax:this._$bounds.yMax+4+this._$thickness};return e?d.$boundsMatrix(t,e):t}get text(){return this._$text}set text(e){this._$text=`${e}`,this.resize()}get size(){return this._$size}set size(e){this._$size=0|e,this.resize()}get font(){return this._$font}set font(e){this._$font=`${e}`,this.resize()}get fontType(){return this._$fontType}set fontType(e){this._$fontType=0|e,this.resize()}get inputType(){return this._$inputType}set inputType(e){e=`${e}`.toLowerCase(),this._$inputType="static"===e?e:"input"}get align(){return this._$align}set align(e){switch(e=`${e}`.toLowerCase()){case"right":case"center":this._$align=e;break;default:this._$align="left"}this._$align=e}get color(){return this._$color}set color(e){this._$color=0|e}get leading(){return this._$leading}set leading(e){this._$leading=0|e,this.resize()}get letterSpacing(){return this._$letterSpacing}set letterSpacing(e){this._$letterSpacing=0|e,this.resize()}get leftMargin(){return this._$leftMargin}set leftMargin(e){this._$leftMargin=0|e,this.resize()}get rightMargin(){return this._$rightMargin}set rightMargin(e){this._$rightMargin=0|e,this.resize()}get multiline(){return this._$multiline}set multiline(e){this._$multiline=!!e,this.resize()}get border(){return this._$border}set border(e){this._$border=!!e}get scroll(){return this._$scroll}set scroll(e){this._$scroll=!!e}get wordWrap(){return this._$wordWrap}set wordWrap(e){this._$wordWrap=!!e,this.resize()}get bounds(){return this._$bounds}set bounds(e){this._$bounds=e}get originBounds(){return this._$originBounds}set originBounds(e){this._$originBounds=e}get autoSize(){return this._$autoSize}set autoSize(e){this._$autoSize=0|e,1!==this._$autoSize&&(this._$bounds.xMax=this._$originBounds.xMax,this._$bounds.yMax=this._$originBounds.yMax),this.resize()}get thickness(){return this._$thickness}set thickness(e){this._$thickness=0|e,this.resize()}get thicknessColor(){return this._$thicknessColor}set thicknessColor(e){this._$thicknessColor=0|e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,text:this.text,font:this.font,fontType:this.fontType,inputType:this.inputType,size:this.size,align:this.align,color:this.color,leading:this.leading,letterSpacing:this.letterSpacing,leftMargin:this.leftMargin,rightMargin:this.rightMargin,multiline:this.multiline,wordWrap:this.wordWrap,border:this.border,autoSize:this.autoSize,scroll:this.scroll,originBounds:this.originBounds,bounds:this.bounds,thickness:this.thickness,thicknessColor:this.thicknessColor}}get defaultSymbol(){return window.next2d.text.TextField.namespace}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,text:this.text,font:this.font,fontType:this.fontType,inputType:this.inputType,size:this.size,align:this.align,color:this.color,leading:this.leading,letterSpacing:this.letterSpacing,leftMargin:this.leftMargin,rightMargin:this.rightMargin,multiline:this.multiline,wordWrap:this.wordWrap,border:this.border,autoSize:this.autoSize,scroll:this.scroll,originBounds:this.originBounds,bounds:this.bounds,thickness:this.thickness,thicknessColor:this.thicknessColor}}resize(){const e=this.createInstance();this._$bounds={xMin:e._$bounds.xMin,xMax:e._$bounds.xMax,yMin:e._$bounds.yMin,yMax:e._$bounds.yMax}}createInstance(){const{TextField:e}=window.next2d.text,t=new e;t._$bounds={xMin:this._$originBounds.xMin,xMax:this._$originBounds.xMax,yMin:this._$originBounds.yMin,yMax:this._$originBounds.yMax},t._$originBounds={xMin:this._$originBounds.xMin,xMax:this._$originBounds.xMax,yMin:this._$originBounds.yMin,yMax:this._$originBounds.yMax};const r=t.defaultTextFormat;switch(r.font=this._$font,r.size=this._$size,r.align=this._$align,r.color=this._$color,r.leading=this._$leading,r.letterSpacing=this._$letterSpacing,r.leftMargin=this._$leftMargin,r.rightMargin=this._$rightMargin,this._$fontType){case 1:r.bold=!0;break;case 2:r.italic=!0;break;case 3:r.bold=!0,r.italic=!0}switch(this._$autoSize){case 1:t.autoSize=this._$align;break;case 2:t.autoFontSize=!0}return t.multiline=this._$multiline,t.wordWrap=this._$wordWrap,t.border=this._$border,t.scroll=this._$scroll,t.thickness=this._$thickness,t.thicknessColor=this._$thicknessColor,t.text=this._$text,t}draw(e,t,r,a,i=null,s=0){const n=super.draw(e,t,r,a,i,s);n.canvas._$tx-=this._$thickness,n.canvas._$ty-=this._$thickness;let o=0;switch(this._$autoSize){case 0:"right"===this._$align&&(o=-4);break;case 1:switch(this._$align){case"center":o=(this._$bounds.xMax-this._$originBounds.xMax)/2,o&&(o-=2);break;case"right":o=this._$originBounds.xMax-this._$bounds.xMax,o&&(o+=2,o*=-1)}}return 1===this._$autoSize&&(n.canvas._$tx-=o),n}}class M extends g{constructor(e){super(e),this._$volume=100,this._$loop=!1,this._$autoPlay=!0,this._$binary="",this._$queue=[],this._$loaded=!1,this.buffer=e.buffer,this.width=0|e.width,this.height=0|e.height,"volume"in e&&(this.volume=e.volume),"loop"in e&&(this.loop=e.loop),"autoPlay"in e&&(this.autoPlay=e.autoPlay),this._$video=document.createElement("video"),this._$video.crossOrigin="anonymous",this._$video.type="video/mp4",this._$video.muted=!0,this._$video.autoplay=!1;const t=e=>{e.target.removeEventListener("canplaythrough",t),e.target.play(),e.target.currentTime=1,e.target.pause(),this._$loaded=!0,setTimeout((()=>{this.delayImage()}),150)};this._$video.addEventListener("canplaythrough",t),this._$video.src=URL.createObjectURL(new Blob([new Uint8Array(this._$buffer)],{type:"video/mp4"})),this._$video.load()}clone(){return new M(JSON.parse(JSON.stringify(this.toObject())))}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["text-setting","loop-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["video-setting"]),document.getElementById("video-volume").value=this.volume,document.getElementById("video-loop-select").children[this.loop?1:0].selected=!0,document.getElementById("video-auto-select").children[this.autoPlay?1:0].selected=!0}getPreview(){const e=this.getBounds();let t=Math.abs(e.xMax-e.xMin),r=Math.abs(e.yMax-e.yMin),a=1;const i=150/r;t=t*i|0,r=r*i|0;const s=(0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0])-10;return t>s&&(a=s/t,t=t*a|0,r=r*a|0),this._$video.style.width=`${t}px`,this._$video.style.height=`${r}px`,this._$video.controls=!0,this._$video}getBounds(e=null){const t={xMin:0,xMax:this.width,yMin:0,yMax:this.height};return e?d.$boundsMatrix(t,e):t}get defaultSymbol(){return window.next2d.media.Video.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let r=0;r<t;++r)this._$buffer[r]=255&e.charCodeAt(r);this._$binary=e}}}get volume(){return this._$volume}set volume(e){this._$volume=d.$clamp(0|e,0,100)}get loop(){return this._$loop}set loop(e){this._$loop=!!e}get autoPlay(){return this._$autoPlay}set autoPlay(e){this._$autoPlay=!!e}get width(){return this._$width}set width(e){this._$width=0|e}get height(){return this._$height}set height(e){this._$height=0|e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,width:this.width,height:this.height,buffer:this.buffer,volume:this.volume,loop:this.loop,autoPlay:this.autoPlay}}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,buffer:Array.from(this._$buffer),bounds:this.getBounds(),volume:this.volume/100,loop:this.loop,autoPlay:this.autoPlay}}createInstance(e){e||console.log(e);const{Video:t}=window.next2d.media,r=this._$loaded?new t(this._$video.videoWidth,this._$video.videoHeight):new t(this.width,this.height);if(r._$characterId=this.id,r._$video=this._$video,this._$loaded){const e=d.$root.stage._$player._$context,t=d.$timelineFrame.currentFrame;r._$video.currentTime=t/60,r._$texture=e.frameBuffer.createTextureFromVideo(r._$video,r._$smoothing)}return r}delayImage(){for(let e=0;e<this._$queue.length;++e){const t=this._$queue[e];this.draw(t.canvas,t.width,t.height,t.place,t.range,t.staticFrame)}this._$queue.length=0}draw(e,t,r,a,i=null,s=0){const n=super.draw(e,t,r,a,i,s);return this._$loaded||this._$queue.push({canvas:e,width:t,height:r,place:a,range:i,staticFrame:s}),n}}class C{constructor(e=null){this._$blurX=4,this._$blurY=4,this._$quality=1,this._$state=!0,this._$name="",e&&(this.blurX=e.blurX,this.blurY=e.blurY,this.quality=0|e.quality,this.state=e.state)}clone(){return new this.constructor(JSON.parse(JSON.stringify(this.toObject())))}isSame(e){return this._$quality===e._$quality&&(this._$blurX===e._$blurX&&this._$blurY===e._$blurY)}get blurX(){return this._$blurX}set blurX(e){this._$blurX=d.$clamp(+e,fe.MIN_BLUR,fe.MAX_BLUR)}get blurY(){return this._$blurY}set blurY(e){this._$blurY=d.$clamp(+e,fe.MIN_BLUR,fe.MAX_BLUR)}get quality(){return this._$quality}set quality(e){this._$quality=d.$clamp(0|e,1,3)}get state(){return this._$state}set state(e){this._$state=e}get name(){return this._$name}set name(e){this._$name=e}}class F extends C{constructor(e=null){super(e),this.name="BevelFilter",this._$distance=4,this._$angle=45,this._$highlightColor=16777215,this._$highlightAlpha=100,this._$shadowColor=0,this._$shadowAlpha=100,this._$strength=1,this._$type="inner",this._$knockout=!1,e&&(this.distance=e.distance,this.angle=e.angle,this.highlightColor=0|e.highlightColor,this.highlightAlpha=100*e.highlightAlpha,this.shadowColor=0|e.shadowColor,this.shadowAlpha=100*e.shadowAlpha,this.strength=e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,fe.MIN_DISTANCE,fe.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get highlightColor(){return this._$highlightColor}set highlightColor(e){this._$highlightColor=d.$clamp(0|e,0,16777215)}get highlightAlpha(){return this._$highlightAlpha}set highlightAlpha(e){this._$highlightAlpha=d.$clamp(+e,0,100)}get shadowColor(){return this._$shadowColor}set shadowColor(e){this._$shadowColor=d.$clamp(0|e,0,16777215)}get shadowAlpha(){return this._$shadowAlpha}set shadowAlpha(e){this._$shadowAlpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,fe.MIN_STRENGTH,fe.MAX_STRENGTH)}get type(){return this._$type}set type(e){switch(e=`${e}`.toLowerCase()){case"outer":case"inner":this._$type=e;break;default:this._$type="full"}}get knockout(){return this._$knockout}set knockout(e){this._$knockout=!!e}isSame(e){return this._$distance===e._$distance&&(this._$angle===e._$angle&&(this._$highlightColor===e._$highlightColor&&(this._$highlightAlpha===e._$highlightAlpha&&(this._$shadowColor===e._$shadowColor&&(this._$shadowAlpha===e._$shadowAlpha&&(this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))))))))}createInstance(){return new window.next2d.filters.BevelFilter(this.distance,this.angle,this.highlightColor,this.highlightAlpha/100,this.shadowColor,this.shadowAlpha/100,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){return[null,this.distance,this.angle,this.highlightColor,this.highlightAlpha/100,this.shadowColor,this.shadowAlpha/100,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,highlightColor:this.highlightColor,highlightAlpha:this.highlightAlpha/100,shadowColor:this.shadowColor,shadowAlpha:this.shadowAlpha/100,strength:this.strength,type:this.type,knockout:this.knockout}}}class k extends C{constructor(e=null){super(e),this.name="BlurFilter"}createInstance(){return new window.next2d.filters.BlurFilter(this.blurX,this.blurY,this.quality)}toParamArray(){return[null,this.blurX,this.blurY,this.quality]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state}}}class A extends C{constructor(e=null){super(e),this.name="DropShadowFilter",this._$distance=4,this._$angle=45,this._$color=0,this._$alpha=100,this._$strength=1,this._$inner=!1,this._$knockout=!1,this._$hideObject=!1,e&&(this.distance=e.distance,this.angle=e.angle,this.color=e.color,this.alpha=100*e.alpha,this.strength=e.strength,this.inner=e.inner,this.knockout=e.knockout,this.hideObject=e.hideObject)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,fe.MIN_DISTANCE,fe.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get color(){return this._$color}set color(e){this._$color=d.$clamp(0|e,0,16777215)}get alpha(){return this._$alpha}set alpha(e){this._$alpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,fe.MIN_STRENGTH,fe.MAX_STRENGTH)}get inner(){return this._$inner}set inner(e){this._$inner=!!e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=!!e}get hideObject(){return this._$hideObject}set hideObject(e){this._$hideObject=!!e}isSame(e){return this._$distance===e._$distance&&(this._$angle===e._$angle&&(this._$color===e._$color&&(this._$alpha===e._$alpha&&(this._$strength===e._$strength&&(this._$inner===e._$inner&&(this._$knockout===e._$knockout&&(this._$hideObject===e._$hideObject&&super.isSame(e))))))))}createInstance(){return new window.next2d.filters.DropShadowFilter(this.distance,this.angle,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout,this.hideObject)}toParamArray(){return[null,this.distance,this.angle,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout,this.hideObject]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,color:this.color,alpha:this.alpha/100,strength:this.strength,inner:this.inner,knockout:this.knockout,hideObject:this.hideObject}}}class T extends C{constructor(e=null){super(e),this.name="GlowFilter",this._$color=0,this._$alpha=100,this._$strength=1,this._$inner=!1,this._$knockout=!1,e&&(this.color=e.color,this.alpha=100*e.alpha,this.strength=e.strength,this.inner=e.inner,this.knockout=e.knockout)}get color(){return this._$color}set color(e){this._$color=d.$clamp(0|e,0,16777215)}get alpha(){return this._$alpha}set alpha(e){this._$alpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,fe.MIN_STRENGTH,fe.MAX_STRENGTH)}get inner(){return this._$inner}set inner(e){this._$inner=!!e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=!!e}isSame(e){return this._$color===e._$color&&(this._$alpha===e._$alpha&&(this._$strength===e._$strength&&(this._$inner===e._$inner&&(this._$knockout===e._$knockout&&super.isSame(e)))))}createInstance(){return new window.next2d.filters.GlowFilter(this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout)}toParamArray(){return[null,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,color:this.color,alpha:this.alpha/100,strength:this.strength,inner:this.inner,knockout:this.knockout}}}class B extends C{constructor(e=null){super(e),this.name="GradientBevelFilter",this._$distance=4,this._$angle=45,this._$colors=[16777215,16711680,0],this._$alphas=[100,0,100],this._$ratios=[0,128,255],this._$strength=1,this._$type="inner",this._$knockout=!1,e&&(this.distance=+e.distance,this.angle=+e.angle,this.colors=e.colors,this.alphas=e.alphas,this.ratios=e.ratios,this.strength=+e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,fe.MIN_DISTANCE,fe.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get colors(){return this._$colors}set colors(e){this._$colors.length=0,this._$colors=e}get alphas(){return this._$alphas}set alphas(e){this._$alphas.length=0;for(let t=0;t<e.length;++t)this._$alphas.push(100*e[t])}get ratios(){return this._$ratios}set ratios(e){this._$ratios.length=0;for(let t=0;t<e.length;++t)this._$ratios.push(255*e[t])}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,fe.MIN_STRENGTH,fe.MAX_STRENGTH)}get type(){return this._$type}set type(e){switch(e=`${e}`.toLowerCase()){case"outer":case"full":this._$type=e;break;default:this._$type="inner"}}get knockout(){return this._$knockout}set knockout(e){this._$knockout=!!e}adjustment(){const e=[],t=[],r=[],a=new Map;for(let t=0;t<this._$ratios.length;++t){const r=this._$ratios[t]/255;e.push(r),a.set(r,t)}e.sort((function(e,t){switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let i=0;i<e.length;++i){const s=a.get(e[i]);t.push(this._$colors[s]),r.push(this._$alphas[s]/100)}return{ratios:e,colors:t,alphas:r}}isSame(e){if(this._$distance!==e._$distance)return!1;if(this._$angle!==e._$angle)return!1;for(let t=0;t<this._$colors.length;++t)if(this._$colors[t]!==e._$colors[t])return!1;for(let t=0;t<this._$alphas.length;++t)if(this._$alphas[t]!==e._$alphas[t])return!1;for(let t=0;t<this._$ratios.length;++t)if(this._$ratios[t]!==e._$ratios[t])return!1;return this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))}createInstance(){const e=this.adjustment();return new window.next2d.filters.GradientBevelFilter(this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){const e=this.adjustment();return[null,this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){const e=this.adjustment();return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,colors:e.colors,alphas:e.alphas,ratios:e.ratios,strength:this.strength,type:this.type,knockout:this.knockout}}}class P extends C{constructor(e=null){super(e),this.name="GradientGlowFilter",this._$distance=4,this._$angle=45,this._$colors=[16777215,0],this._$alphas=[0,100],this._$ratios=[0,255],this._$strength=1,this._$type="outer",this._$knockout=!1,e&&(this.distance=+e.distance,this.angle=+e.angle,this.colors=e.colors,this.alphas=e.alphas,this.ratios=e.ratios,this.strength=+e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,fe.MIN_DISTANCE,fe.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get colors(){return this._$colors}set colors(e){this._$colors.length=0,this._$colors=e}get alphas(){return this._$alphas}set alphas(e){this._$alphas.length=0;for(let t=0;t<e.length;++t)this._$alphas.push(100*e[t])}get ratios(){return this._$ratios}set ratios(e){this._$ratios.length=0;for(let t=0;t<e.length;++t)this._$ratios.push(255*e[t])}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,fe.MIN_STRENGTH,fe.MAX_STRENGTH)}get type(){return this._$type}set type(e){switch(e=`${e}`.toLowerCase()){case"outer":case"full":this._$type=e;break;default:this._$type="inner"}}get knockout(){return this._$knockout}set knockout(e){this._$knockout=!!e}adjustment(){const e=[],t=[],r=[],a=new Map;for(let t=0;t<this._$ratios.length;++t){const r=this._$ratios[t]/255;e.push(r),a.set(r,t)}e.sort((function(e,t){switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let i=0;i<e.length;++i){const s=a.get(e[i]);t.push(this._$colors[s]),r.push(this._$alphas[s]/100)}return{ratios:e,colors:t,alphas:r}}isSame(e){if(this._$distance!==e._$distance)return!1;if(this._$angle!==e._$angle)return!1;for(let t=0;t<this._$colors.length;++t)if(this._$colors[t]!==e._$colors[t])return!1;for(let t=0;t<this._$alphas.length;++t)if(this._$alphas[t]!==e._$alphas[t])return!1;for(let t=0;t<this._$ratios.length;++t)if(this._$ratios[t]!==e._$ratios[t])return!1;return this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))}createInstance(){const e=this.adjustment();return new window.next2d.filters.GradientGlowFilter(this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){const e=this.adjustment();return[null,this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){const e=this.adjustment();return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,colors:e.colors,alphas:e.alphas,ratios:e.ratios,strength:this.strength,type:this.type,knockout:this.knockout}}}class U{constructor(){this._$buffer=null,this._$bitOffset=0,this._$byteOffset=0}setData(e){this._$buffer=e}getData(e){this.byteAlign();const t=this._$byteOffset+e,r=this._$buffer.slice(this._$byteOffset,t);return this._$byteOffset=t,r}getHeaderSignature(){let e="",t=3;for(;t;){const r=this.getUI8();switch(r){case 32:case 96:case 127:continue}e+=String.fromCharCode(r),--t}return e}getVersion(){return this.getUI8()}byteAlign(){this._$bitOffset&&(this._$byteOffset=this._$byteOffset+(this._$bitOffset+7)/8|0,this._$bitOffset=0)}byteCarry(){if(this._$bitOffset>7)this._$byteOffset=this._$byteOffset+(0|(this._$bitOffset+7)/8),this._$bitOffset&=7;else for(;this._$bitOffset<0;)--this._$byteOffset,this._$bitOffset+=8}getUIBits(e){let t=0;for(;e;)t<<=1,t|=this.getUIBit(),--e;return t}getUIBit(){return this.byteCarry(),this._$buffer[this._$byteOffset]>>7-this._$bitOffset++&1}getSIBits(e){const t=this.getUIBits(e),r=t&1<<e-1;return r?-(t^2*r-1)-1:t}getUI8(){return this.byteAlign(),this._$buffer[this._$byteOffset++]}getUI16(){return this.byteAlign(),this.getUI8()|this.getUI8()<<8}getUI32(){return this.byteAlign(),this.getUI8()|(this.getUI8()|(this.getUI8()|this.getUI8()<<8)<<8)<<8}}class O{constructor(){this._$folderId=0,this._$libraryId=0,this._$fileName="",this._$byteStream=new U,this._$bounds={xMin:0,xMax:0,yMin:0,yMax:0},this._$swfVersion=0,this._$info=null,this._$buildData=null,this._$fileSize=0,this._$mode="swf",this._$offset=0}get mode(){return this._$mode}get fileSize(){return this._$fileSize}setData(e){return this._$byteStream.setData(e),this}run(e,t=0,r=0){this._$fileName=e.replace(".swf",""),this._$folderId=t,this._$libraryId=r;const a=this._$byteStream.getHeaderSignature();switch(this._$byteStream.getVersion(),this._$fileSize=this._$byteStream.getUI32(),this._$mode="swf",a){case"FWS":return this.parseAndBuild();case"CWS":{if(d.$unzipWorkerActive)return void d.$unzipQueues.push(this);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const e=d.$unzipWorker;e.onmessage=d.$unzipHandler.bind(this);const t=this._$byteStream._$buffer;e.postMessage({fileSize:this._$fileSize,mode:this._$mode,buffer:t},[t.buffer])}break;case"ZWS":{if(d.$unlzmaWorkerActive)return void d.$unlzmaQueues.push(this);d.$unlzmaWorkerActive=!0;const e=new Worker(d.$unlzmaWorkerURL);e.onmessage=d.$unlzmaHandler.bind(this);const t=this._$byteStream._$buffer;e.postMessage({fileSize:this._$fileSize,mode:this._$mode,buffer:t},[t.buffer])}break;default:throw new Error("this data is not swf.")}}parseAndBuild(){this._$byteStream.byteAlign();const e=this._$byteStream.getUIBits(5);if(this._$bounds.xMin=this._$byteStream.getSIBits(e),this._$bounds.xMax=this._$byteStream.getSIBits(e),this._$bounds.yMin=this._$byteStream.getSIBits(e),this._$bounds.yMax=this._$byteStream.getSIBits(e),this._$byteStream.getUI16(),this._$byteStream.getUI16(),this._$offset=this._$byteStream._$byteOffset,d.$parserWorkerWait)return void d.$parserQueues.push(this);d.$parserWorkerWait=!0,d.$parserWorker||(d.$parserWorker=new Worker(d.$parserURL)),d.$parserWorker.onmessage=d.$parserHandler.bind(this);const t=this._$byteStream._$buffer;d.$parserWorker.postMessage({version:this._$swfVersion,offset:this._$offset,buffer:t},[t.buffer])}build(){const e=this.buildData.info,t=this.buildData.parent;this.loaderInfo._$bytes._$byteArray=this.buildData.buffer,this.loaderInfo._$actionScriptVersion=e._$asv;let r=!1,a=this.loaderInfo._$symbols.length;if(a){const e=this.loaderInfo._$applicationDomain,t=d.$getArray();for(let i=0;i<a;++i){const a=this.loaderInfo._$symbols[i],s=a.tagId;switch(0===s&&(r=!0),!0){case s in this.loaderInfo._$characters:case this.loaderInfo._$fonts.has(s):{const t=d.$getPackage(e,a.path);if(t._$loaderInfoId===this.loaderInfo._$id||!("__$$characterId"in t.prototype)){t.prototype.__$$characterId=s,t.prototype.__$$loaderInfoId=this.loaderInfo._$id;const e=t.__$$slots,r=d.$Object.keys(e),a=r.length;for(let t=0;t<a;++t){const a=e[r[t]];a.__$$classInit&&a.__$$classInit()}d.$poolArray(r)}}}t[s]=a.path}this.loaderInfo._$symbols=t}if(r){const e=d.$buildAVM2(this.loaderInfo._$applicationDomain,this.loaderInfo._$symbols[0]);e._$root=e,e._$symbolBuild(0,this.loaderInfo._$id,t),this.loaderInfo._$content=e}else E._$targetBuild(this.loaderInfo._$content,t),this.loaderInfo._$content._$characterBuild();if(a=e._$sceneInfo.length,a){const t=d.$getArray();for(let r=0;r<a;++r){const a=e._$sceneInfo[r],i=new Scene(a.name,d.$getArray(),1);i._$offset=a.offset;const s=r+1|0;let n=this.loaderInfo._$content._$totalFrames;s in e._$sceneInfo&&(n=0|e._$sceneInfo[s].offset),i._$numFrames=n-i._$offset|0;const o=this.loaderInfo._$content.currentLabels;if(o){const e=o.length,t=d.$getArray();for(let r=0;r<e;++r){const e=o[r];e.frame>a.offset&&e.frame<=n&&(t[t.length]=e)}i._$labels=t}t[t.length]=i}this.loaderInfo._$content._$scenes=t}}}class X{static parse(e,t){const r=/<defs>(.*)<\/defs>/gis.exec(e),a=X.parseXML(`${e.replace(/<defs>(.*)<\/defs>/gis,"")}`);if(a){X.parsePath(a,t,r?r[1]:null);const e=[];for(const r of t._$layers.values())e.unshift(r);t.clearLayer();for(let r=0;r<e.length;++r)t.setLayer(r,e[r])}}static parseXML(e){const t=/<((path|rect|circle|polygon).+?)\/>/gi,r=[];for(let a="1";a;)a=t.exec(e),a&&r.push(a[1]);return r}static parsePath(e,t,r=null){const{Shape:a,Graphics:i}=window.next2d.display,s=d.$currentWorkSpace();for(let r=0;r<e.length;++r){const n=(new a).graphics,o=e[r];let l=/stroke-width=\"(.+?)\"/gi.exec(o);if(l||(l=/stroke-width:(.+?)["|;]/gi.exec(o)),l&&(l=+l[1],l)){let e=/stroke=\"(.+?)\"/gi.exec(o);e||(e=/stroke:(.+?)["|;]/gi.exec(o)),n.lineStyle(l,e?e[1]:0)}let c=/fill=\"(.+?)\"/gi.exec(o);c||(c=/fill:(.+?)["|;]/gi.exec(o));let h=1,u=/style=\"(.+?)\"/gi.exec(o);u&&u[1].indexOf("opacity")>-1&&(h=u[1].split(":")[1]),c?n.beginFill(c[1],+h):l||n.beginFill(0,+h);const m=s.nextLibraryId,g=s.addLibrary(d.$libraryController.createInstance(b.SHAPE,`Shape_${m}`,m)),p=new v;p.name=`Layer_${t._$layers.size}`,t.setLayer(t._$layers.size,p);const f=new $;f.libraryId=g.id;const y=p.adjustmentLocation(1);if(f.startFrame=y.startFrame,f.endFrame=y.endFrame,f.setPlace(y.startFrame,{frame:y.startFrame,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:p._$characters.length}),p.addCharacter(f),o.indexOf("rect")>-1){const e=o.replace("rect",""),t=+/x=\"(.+?)\"/gi.exec(e)[1],r=+/y=\"(.+?)\"/gi.exec(e)[1],a=+/width=\"(.+?)\"/gi.exec(e)[1],i=+/height=\"(.+?)\"/gi.exec(e)[1],s=+/rx=\"(.+?)\"/gi.exec(e)[1];n.drawRoundRect(t,r,a,i,2*s).endFill(),g._$recodes=n._$recode.slice(),g._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax};continue}if(o.indexOf("circle")>-1){const e=o.replace("rect",""),t=+/cx=\"(.+?)\"/gi.exec(e)[1],r=+/cy=\"(.+?)\"/gi.exec(e)[1],a=+/r=\"(.+?)\"/gi.exec(e)[1];n.drawCircle(t,r,a).endFill(),g._$recodes=n._$recode.slice(),g._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax};continue}if(o.indexOf("polygon")>-1){const e=o.replace("polygon","");let t=/points=\"(.+?)\"/gi.exec(e)[1];t=t.replace(/,/g," "),t=t.replace(/-/g," -"),t=t.trim().split(" "),t=X._$adjParam(t),n.moveTo(+t[0],+t[1]);for(let e=2;e<t.length;e+=2)n.lineTo(+t[e],+t[e+1]);n.endFill(),g._$recodes=n._$recode.slice(),g._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax};continue}let _=!1,I=0,E=0;const S=[0,0],w=[0,0],x=/([a-z])([^a-z]*)/gi,L=/ d=\"(.+?)\"/gi.exec(o)[1];for(let e="1";e;)if(e=x.exec(L),e){const t=`${e[1]}`;let r=e[2];switch(t){case"m":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r),S[0]+=+r[0],S[1]+=+r[1],_||(_=!0,I=S[0],E=S[1]),n.moveTo(S[0],S[1]);for(let e=2;e<r.length;e+=2)S[0]+=+r[e],S[1]+=+r[e+1],w[0]=S[0],w[1]=S[1],n.lineTo(S[0],S[1]);break;case"M":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r),S[0]=+r[0],S[1]=+r[1],_||(_=!0,I=S[0],E=S[1]),n.moveTo(S[0],S[1]);for(let e=2;e<r.length;e+=2)S[0]=+r[e],S[1]=+r[e+1],w[0]=S[0],w[1]=S[1],n.lineTo(S[0],S[1]);break;case"l":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r);for(let e=0;e<r.length;e+=2)S[0]+=+r[e],S[1]+=+r[e+1],w[0]=S[0],w[1]=S[1],n.lineTo(S[0],S[1]);break;case"L":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r);for(let e=0;e<r.length;e+=2)S[0]=+r[e],S[1]=+r[e+1],w[0]=S[0],w[1]=S[1],n.lineTo(S[0],S[1]);break;case"h":S[0]+=+r,w[0]=S[0],n.lineTo(S[0],S[1]);break;case"H":S[0]=+r,w[0]=S[0],n.lineTo(S[0],S[1]);break;case"v":S[1]+=+r,w[1]=S[1],n.lineTo(S[0],S[1]);break;case"V":S[1]=+r,w[1]=S[1],n.lineTo(S[0],S[1]);break;case"q":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r);for(let e=0;e<r.length;e+=4)r[e]=+r[e]+S[0],r[e+1]=+r[e+1]+S[1],r[e+2]=+r[e+2]+S[0],r[e+3]=+r[e+3]+S[1],n.curveTo(r[e],r[e+1],r[e+2],r[e+3]),S[0]=r[e+2],S[1]=r[e+3],w[0]=S[0],w[1]=S[1];break;case"Q":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r);for(let e=0;e<r.length;e+=4)r[e]=+r[e],r[e+1]=+r[e+1],r[e+2]=+r[e+2],r[e+3]=+r[e+3],n.curveTo(r[e],r[e+1],r[e+2],r[e+3]),S[0]=r[e+2],S[1]=r[e+3],w[0]=S[0],w[1]=S[1];break;case"c":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r);for(let e=0;e<r.length;e+=6)r[e]=+r[e]+S[0],r[e+1]=+r[e+1]+S[1],r[e+2]=+r[e+2]+S[0],r[e+3]=+r[e+3]+S[1],r[e+4]=+r[e+4]+S[0],r[e+5]=+r[e+5]+S[1],n.cubicCurveTo(r[e],r[e+1],r[e+2],r[e+3],r[e+4],r[e+5]),S[0]=r[e+4],S[1]=r[e+5],w[0]=2*r[e+4]-r[e+2],w[1]=2*r[e+5]-r[e+3];break;case"C":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r);for(let e=0;e<r.length;e+=6)r[e]=+r[e],r[e+1]=+r[e+1],r[e+2]=+r[e+2],r[e+3]=+r[e+3],r[e+4]=+r[e+4],r[e+5]=+r[e+5],n.cubicCurveTo(r[e],r[e+1],r[e+2],r[e+3],r[e+4],r[e+5]),S[0]=r[e+4],S[1]=r[e+5],w[0]=2*r[e+4]-r[e+2],w[1]=2*r[e+5]-r[e+3];break;case"s":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r);for(let e=0;e<r.length;e+=4)r[e]=+r[e]+S[0],r[e+1]=+r[e+1]+S[1],r[e+2]=+r[e+2]+S[0],r[e+3]=+r[e+3]+S[1],n.cubicCurveTo(w[0],w[1],r[e],r[e+1],r[e+2],r[e+3]),S[0]=r[e+2],S[1]=r[e+3],w[0]=2*r[e+2]-r[e],w[1]=2*r[e+3]-r[e+1];break;case"S":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r);for(let e=0;e<r.length;e+=4)r[e]=+r[e],r[e+1]=+r[e+1],r[e+2]=+r[e+2],r[e+3]=+r[e+3],n.cubicCurveTo(w[0],w[1],r[e],r[e+1],r[e+2],r[e+3]),S[0]=r[e+2],S[1]=r[e+3],w[0]=2*r[e+2]-r[e],w[1]=2*r[e+3]-r[e+1];break;case"a":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r);for(let e=0;e<r.length;e+=7){r[e]=+r[e],r[e+1]=+r[e+1],r[e+2]=+r[e+2],r[e+3]=+r[e+3],r[e+4]=+r[e+4],r[e+5]=+r[e+5]+S[0],r[e+6]=+r[e+6]+S[1];const t=X._$arcToCurve(S[0],S[1],r[e+5],r[e+6],r[e+3],r[e+4],r[e],r[e+1],r[e+2]);for(let e=0;e<t.length;++e){const r=t[e];n.cubicCurveTo(r[0],r[1],r[2],r[3],r[4],r[5])}S[0]=r[e+5],S[1]=r[e+6],w[0]=S[0],w[1]=S[1]}break;case"A":r=r.replace(/,/g," "),r=r.replace(/-/g," -"),r=r.trim().split(" "),r=X._$adjParam(r);for(let e=0;e<r.length;e+=7){r[e]=+r[e],r[e+1]=+r[e+1],r[e+2]=+r[e+2],r[e+3]=+r[e+3],r[e+4]=+r[e+4],r[e+5]=+r[e+5],r[e+6]=+r[e+6];const t=X._$arcToCurve(S[0],S[1],r[e+5],r[e+6],r[e+3],r[e+4],r[e],r[e+1],r[e+2]);for(let e=0;e<t.length;++e){const r=t[e];n.cubicCurveTo(r[0],r[1],r[2],r[3],r[4],r[5])}S[0]=r[e+5],S[1]=r[e+6],w[0]=S[0],w[1]=S[1]}break;case"z":case"Z":n._$fills&&n._$fills.push(i.CLOSE_PATH),n._$lines&&n._$lines.push(i.CLOSE_PATH),S[0]=I,S[1]=E,w[0]=S[0],w[1]=S[1],_=!1;break;default:console.log("TODO: ",t,r)}}n.endLine(),n.endFill(),n._$recode&&(g._$recodes=n._$recode.slice()),g._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax}}}static _$adjParam(e){for(;;){let t=0;for(let r=0;r<e.length;++r){const a=e[r];if(!isNaN(a)){t++;continue}const i=a.split(".");e.splice(r+1,0,`0.${i.pop()}`),e[r]=i.join(".")}if(e.length===t)break}return e}static _$arc(e,t,r,a,i,s){let n=Math.min(Math.ceil(2*a+1),1024);if(n<1)return;i=void 0===i?0:i;const o=((s=void 0===s?2*Math.PI:s)-i)/n;for(let s=0;s<=n;s++){const n=i+s*o;e.lineTo(t+Math.cos(n)*a,r+Math.sin(n)*a)}}static _$arcToCurve(e,t,r,a,i,s,n,o,l){const c=2*Math.PI,d=Math.sin(l*c/360),h=Math.cos(l*c/360),u=h*(e-r)/2+d*(t-a)/2,m=-d*(e-r)/2+h*(t-a)/2;if(0===u&&0===m||0===n||0===o)return[];n=Math.abs(n),o=Math.abs(o);const g=u*u/(n*n)+m*m/(o*o);g>1&&(n*=Math.sqrt(g),o*=Math.sqrt(g));const p=X._$getArcCenter(e,t,r,a,i,s,n,o,d,h),$=[];let f=p[2],y=p[3];const _=Math.max(Math.ceil(Math.abs(y)/(c/4)),1);y/=_;for(let e=0;e<_;e++)$.push(X._$approximateUnitArc(f,y)),f+=y;return $.map((e=>{for(let t=0;t<e.length;t+=2){let r=e[t],a=e[t+1];r*=n,a*=o;const i=h*r-d*a,s=d*r+h*a;e[t]=i+p[0],e[t+1]=s+p[1]}return e.shift(),e.shift(),e}))}static _$approximateUnitArc(e,t){const r=4/3*Math.tan(t/4),a=Math.cos(e),i=Math.sin(e),s=Math.cos(e+t),n=Math.sin(e+t);return[a,i,a-i*r,i+a*r,s+n*r,n-s*r,s,n]}static _$getArcCenter(e,t,r,a,i,s,n,o,l,c){const d=2*Math.PI,h=c*(e-r)/2+l*(t-a)/2,u=-l*(e-r)/2+c*(t-a)/2,m=n*n,g=o*o,p=h*h,$=u*u;let f=m*g-m*$-g*p;f<0&&(f=0),f/=m*$+g*p,f=Math.sqrt(f)*(i===s?-1:1);const y=f*n/o*u,_=f*-o/n*h,b=c*y-l*_+(e+r)/2,v=l*y+c*_+(t+a)/2,I=(h-y)/n,E=(u-_)/o,S=(-h-y)/n,w=(-u-_)/o,x=X._$unitVectorAngle(1,0,I,E);let L=X._$unitVectorAngle(I,E,S,w);return 0===s&&L>0&&(L-=d),1===s&&L<0&&(L+=d),[b,v,x,L]}static _$unitVectorAngle(e,t,r,a){let i=e*r+t*a;return i>1&&(i=1),i<-1&&(i=-1),(e*a-t*r<0?-1:1)*Math.acos(i)}}d.$vtc=new class{clone(e){const t=function(e,r){const a=Object.keys(e),i=0|a.length;for(let s=0;s<i;++s){const i=a[s],n=e[i];switch(!0){case d.$isArray(n):r[i]=[],t(n,r[i]);break;case"object"==typeof n:r[i]={},t(n,r[i]);break;default:r[i]=n}}},r={};return t(e,r),r}convert(e,t=!1){let r=e.lineStyles,a=e.fillStyles,i=0,s={},n=[],o=0,l=0,c=0,d=0,h=0,u=0,m=0,g=0,p=0,$=[],f=[],y=[],_=[],b=0;const v=e.ShapeData,I=v.records,E=v.styles;let S=0,w=0;for(;;){const e=I[S++];if(-1===e){_=this.setStack(_,this.fillMerge($,f,t)),_=this.setStack(_,y);break}if(e){if(++b,I[S++]){_=this.setStack(_,this.fillMerge($,f,t)),_=this.setStack(_,y),o=0,l=0,$=[],f=[],y=[];const e=E[w++];I[S++]&&(a=e.FillStyles),I[S++]&&(r=e.LineStyles)}c=o,d=l,I[S++]&&(c=o=I[S++]/20,d=o=I[S++]/20),h=c,u=d,I[S++]&&(m=I[S++]),I[S++]&&(g=I[S++]),I[S++]&&(p=I[S++]);continue}const v=I[S++],x=v?I[S++]/20:0,L=v?I[S++]/20:0;o=I[S++]/20,l=I[S++]/20;const M={isCurved:v,ControlX:x,ControlY:L,AnchorX:o,AnchorY:l};if(m&&(i=m-1|0,i in $||($[i]=[]),b in $[i]||($[i][b]={obj:a?a[i]:null,startX:c,startY:d,endX:0,endY:0,cache:[]}),s=$[i][b],n=s.cache,n[n.length]=this.clone(M),s.endX=o,s.endY=l),g&&(i=g-1|0,i in f||(f[i]=[]),b in f[i]||(f[i][b]={obj:a?a[i]:null,startX:c,startY:d,endX:0,endY:0,cache:[]}),s=f[i][b],n=s.cache,n[n.length]=this.clone(M),s.endX=o,s.endY=l),p){i=p-1|0,i in y||(y[i]={obj:r?r[i]:null,cache:[]}),s=y[i],n=s.cache,n[n.length]=[0,h,u];let e=[2,o,l];v&&(e=[1,x,L,o,l]),n[n.length]=e}h=o,u=l}return this.toGraphicPath(_)}toGraphicPath(e){const{Graphics:t,GradientType:r,InterpolationMethod:a,SpreadMethod:i,CapsStyle:s,JointStyle:n}=window.next2d.display;let o=!1;const l=[];for(let c=0;c<e.length;++c){const h=e[c];l.push(t.BEGIN_PATH);for(let e=0;e<h.recode.length;++e)l.push.apply(l,h.recode[e]);const u="Width"in h.object;let m=0,g=s.NONE,p=0,$=n.ROUND;if(u){switch(m=h.object.Width,h.object.StartCapStyle){case 0:g=s.ROUND;break;case 1:g=s.NONE;break;case 2:g=s.SQUARE}switch(h.object.JoinStyle){case 0:$=n.ROUND;break;case 1:$=n.BEVEL;break;case 2:$=n.MITER,p=h.object.MiterLimitFactor}}const f=h.object.HasFillFlag?h.object.FillType:h.object;switch(f.fillStyleType){case 0:u?l.push(t.STROKE_STYLE,m,g,$,p,f.Color.R,f.Color.G,f.Color.B,255*f.Color.A,t.END_STROKE):l.push(t.FILL_STYLE,f.Color.R,f.Color.G,f.Color.B,255*f.Color.A,t.END_FILL);break;case 16:case 18:case 19:{const e=f.gradient,s=[],n=e.GradientRecords;for(let e=0;e<n.length;++e){const t=n[e];s.push({ratio:t.Ratio,R:t.Color.R,G:t.Color.G,B:t.Color.B,A:255*t.Color.A})}const o=0===e.InterpolationMode?a.RGB:a.LINEAR_RGB;let c=i.PAD;switch(e.SpreadMode){case 0:c=i.PAD;break;case 1:c=i.REFLECT;break;case 2:c=i.REPEAT}u?l.push(t.GRADIENT_STROKE,m,g,$,p,16===f.fillStyleType?r.LINEAR:r.RADIAL,s,f.gradientMatrix,c,o,e.FocalPoint):l.push(t.GRADIENT_FILL,16===f.fillStyleType?r.LINEAR:r.RADIAL,s,f.gradientMatrix,c,o,e.FocalPoint)}break;case 64:case 65:case 66:case 67:{o=!0;const e=d.$currentWorkSpace().getLibrary(d.$characters.get(f.bitmapId)),r=function(e,a){if(!this._$buffer)return requestAnimationFrame(r);const i=64===a.fillStyleType||65===a.fillStyleType,s=64===a.fillStyleType||66===a.fillStyleType,n=d.$multiplicationMatrix(a.bitmapMatrix,[.05,0,0,.05,0,0]),{BitmapData:o}=window.next2d.display,l=new o(this.width,this.height,!0,0);l._$buffer=this._$buffer,e.push(t.BITMAP_FILL,l,Array.from(n),s?"repeat":"no-repeat",i)}.bind(e,l,f);r()}}}return l.push(o),l}fillMerge(e,t,r){if((e=this.fillReverse(e)).length){const r=Object.keys(e),a=0|r.length;for(let i=0;i<a;++i){const a=r[i],s=e[a];if(a in t){const e=t[a],r=Object.keys(s),i=0|r.length;for(let t=0;t<i;++t)e[e.length]=s[r[t]]}else t[a]=s}}return this.coordinateAdjustment(t,r)}fillReverse(e){if(!e.length)return e;const t=Object.keys(e),r=0|t.length;for(let a=0;a<r;++a){const r=e[t[a]],i=Object.keys(r),s=0|i.length;for(let e=0;e<s;++e){let t=0,a=0;const s=r[i[e]];let n=s.startX,o=s.startY;const l=s.cache;let c=0|l.length;if(c){const e=Object.keys(l),r=0|e.length;for(let i=0;i<r;++i){const r=l[e[i]];t=r.AnchorX,a=r.AnchorY,r.AnchorX=n,r.AnchorY=o,n=t,o=a}const i=[];if(c>0)for(;c;)--c,i[i.length]=l[c];s.cache=i}n=s.startX,o=s.startY,s.startX=s.endX,s.startY=s.endY,s.endX=n,s.endY=o}}return e}coordinateAdjustment(e,t){const r=Object.keys(e),a=0|r.length;for(let i=0;i<a;++i){const a=r[i],s=[],n=e[a],o=Object.keys(n),l=0|o.length;for(let e=0;e<l;++e)s[s.length]=n[o[e]];let c=[];if(!0==(s.length>1&&!t))for(;s.length;){const e=s.shift();if(e.startX===e.endX&&e.startY===e.endY){c[c.length]=e;continue}let t=0,r=0|s.length;for(;r;){--r;const a=s[r];if(a.startX===e.endX&&a.startY===e.endY){e.endX=a.endX,e.endY=a.endY;const i=e.cache,n=a.cache,o=0|n.length;for(let e=0;e<o;++e)i[i.length]=n[e];s.splice(r,1),s.unshift(e),t=1;break}}t||s.unshift(e)}else c=s;const d=0|c.length,h=[];let u={};for(let e=0;e<d;++e){const t=c[e];u=t.obj;const r=t.cache,a=0|r.length;h[h.length]=[0,t.startX,t.startY];for(let e=0;e<a;++e){const t=r[e];h[h.length]=t.isCurved?[1,t.ControlX,t.ControlY,t.AnchorX,t.AnchorY]:[2,t.AnchorX,t.AnchorY]}}e[a]={cache:h,obj:u}}return e}setStack(e,t){if(t.length){const r=Object.keys(t),a=0|r.length;for(let i=0;i<a;++i){const a=t[r[i]];e.push({object:a.obj,recode:a.cache})}}return e}};class D{constructor(e=""){if(this._$name="",this._$scene=null,this._$stage=null,this._$libraries=new Map,this._$nameMap=new Map,this._$plugins=new Map,this._$position=0,this._$characterId=0,this._$revision=[],this._$currentData=null,this._$timelineHeight=le.TIMELINE_DEFAULT_SIZE,this._$controllerWidth=$e.DEFAULT_SIZE,e&&this.load(e),!this._$libraries.has(0)){const e=new E({id:0,type:b.MOVIE_CLIP,name:"main",symbol:""});this._$libraries.set(0,e)}this._$stage||(this._$stage=new x)}get root(){return this._$libraries.get(0)}get stage(){return this._$stage}get name(){return this._$name}set name(e){this._$name=`${e}`}get scene(){return this._$scene}set scene(e){this._$scene&&this._$scene.stop(),this._$scene=e,e.initialize()}get nextLibraryId(){const e=Array.from(this._$libraries.keys());e.sort((function(e,t){return e>t?1:e<t?-1:0}));return(0|this._$libraries.get(0|e.pop()).id)+1}initialize(e){this.scene=e,d.$libraryController.clearActive(),d.$libraryController.reload(Array.from(this._$libraries.values())),d.$javascriptController.reload(),d.$pluginController.reload(Array.from(this._$plugins.values())),d.$timelineScroll.setX()}run(){document.documentElement.style.setProperty("--timeline-height",`${this._$timelineHeight}px`),document.documentElement.style.setProperty("--controller-width",`${this._$controllerWidth}px`),this.stage.initialize(),this.initialize(this.root)}stop(){this._$scene&&(this._$scene.stop(),this._$scene=null)}load(e){const t=JSON.parse(e);if(this._$characterId=0|t.characterId,this._$name=t.name,this._$stage=new x(t.stage),this._$plugins.size&&this._$plugins.clear(),t.plugins)for(let e=0;e<t.plugins.length;++e){const r=t.plugins[e];this._$plugins.set(r.name,r)}this._$libraries.size&&this._$libraries.clear();const r=t.libraries;for(let e=0;e<r.length;++e)this.addLibrary(r[e]);t.setting&&(this._$timelineHeight=t.setting.timelineHeight,this._$controllerWidth=t.setting.controllerWidth)}toJSON(){const e=[];for(const t of this._$libraries.values())e.push(t.toObject());return JSON.stringify({version:d.VERSION,name:this.name,characterId:this._$characterId,stage:this.stage.toObject(),libraries:e,plugins:Array.from(this._$plugins.values()),setting:{timelineHeight:this._$timelineHeight,controllerWidth:this._$controllerWidth}})}temporarilySaved(){d.$updated=!0,this._$currentData&&(this._$currentData=null),this._$position!==this._$revision.length&&(this._$revision.length=this._$position),this._$revision.push(this.toJSON()),this._$position++,this._$revision.length>d.REVISION_LIMIT&&(this._$revision.shift(),this._$position=this._$revision.length)}undo(){this._$position&&(this._$currentData||(this._$currentData=this.toJSON()),this.reloadData(this._$revision[--this._$position]))}redo(){if(!this._$revision.length||this._$position===this._$revision.length)return;let e=null;if(this._$position+1===this._$revision.length){if(!this._$currentData)return;e=this._$currentData,this._$position++,this._$currentData=null}else e=this._$revision[++this._$position];e&&this.reloadData(e)}reloadData(e){const t=[],r=d.$timelineLayer.targetLayers;for(const e of r.keys())t.push(e);d.$tools.getDefaultTool("arrow").clear(),d.$tools.reset();const a=this._$scene.currentFrame,i=this._$scene.id;this._$scene.stop(),this._$scene=null,this.load(e);const s=this.getLibrary(i);if(s._$currentFrame=a,this.initialize(s),t.length){const e=d.$ctrlKey;d.$ctrlKey=!0;for(let e=0;e<t.length;++e){const r=document.getElementById(`${t[e]}`);r&&d.$timelineLayer.activeLayer(r)}d.$ctrlKey=e}}addLibrary(e){let t;switch(e.type){case b.MOVIE_CLIP:t=new E(e);break;case b.BITMAP:t=new p(e);break;case b.TEXT:t=new L(e);break;case b.SOUND:t=new w(e);break;case b.VIDEO:t=new M(e);break;case b.SHAPE:t=new S(e);break;case b.FOLDER:t=new y(e)}return this._$libraries.set(t.id,t),t}getLibrary(e){return this._$libraries.get(0|e)}removeLibrary(e){this._$libraries.delete(0|e)}}class Y{static get MOUSE_DOWN(){return"mousedown"}static get MOUSE_UP(){return"mouseup"}static get MOUSE_MOVE(){return"mousemove"}static get START(){return"start"}static get END(){return"end"}static get DBL_CLICK(){return"dblclick"}static get CHANGE(){return"change"}static get MOUSE_OVER(){return"mouseover"}static get MOUSE_OUT(){return"mouseout"}static get KEY_DOWN(){return"keydown"}static get MOUSE_LEAVE(){return"mouseleave"}}class N{constructor(){this._$saved=!1,this._$focus=!1,this._$currentEvent=null,this._$currentTarget=null,this._$mouseMove=null,this._$mouseUp=null}setInputEvent(e){e&&(e.addEventListener("mouseover",(e=>{this.mouseOver(e)})),e.addEventListener("mouseout",(e=>{this.mouseOut(e)})),e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})),e.addEventListener("focusout",(e=>{this.finishInput(e)})),e.addEventListener("keypress",(e=>{this.finishInput(e)})))}changeFunction(e,t){let r=e.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("");return this[`change${r}`](t)}mouseOver(e){switch(e.stopPropagation(),!0){case this._$focus:case null!==this._$currentTarget:return;default:d.$setCursor("ew-resize"),e.target.style.cursor="ew-resize"}this._$currentValue=+e.target.value}mouseOut(e){e.stopPropagation(),!this._$focus&&this._$currentTarget||(d.$setCursor("auto"),e.target.style.cursor="")}mouseDown(e){this._$focus||(e.preventDefault(),this._$saved=!1,this._$pointX=e.screenX,this._$currentTarget=e.target,d.$setCursor("ew-resize"),this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto"),this._$currentTarget&&(this._$currentTarget.style.cursor="",this._$currentTarget.focus())}mouseMove(e){!this._$focus&&this._$currentTarget&&window.requestAnimationFrame((()=>{if(this._$focus||!this._$currentTarget)return;e.preventDefault(),d.$setCursor("ew-resize");const t=e.screenX-this._$pointX;let r=+this._$currentTarget.value;isNaN(r)&&(r=0),this._$currentTarget.value=this.changeFunction(this._$currentTarget.id,r+t),this._$pointX=e.screenX}))}focusIn(){this._$focus=!0,d.$keyLock=!0}focusOut(){this._$saved=!1,this._$focus=!1,this._$currentTarget=null,d.$keyLock=!1}finishInput(e){"Enter"!==e.key?"focusout"===e.type&&(this._$currentTarget=e.target,e.target.value=this.changeFunction(this._$currentTarget.id,this._$currentTarget.value),this.focusOut()):e.currentTarget.blur()}reloadScreen(){const e=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(e)}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}}class R{constructor(e){this._$areaName=e,this._$active=!1,this._$mapping=new Map,this._$execute=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}get areaName(){return this._$areaName}get active(){return this._$active}set active(e){this._$active=!!e,this._$active?window.addEventListener("keydown",this._$execute):window.removeEventListener("keydown",this._$execute)}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),this._$execute=this.execute.bind(this),d.$initializeEnd()}add(e,t){this._$mapping.set(e,t)}delete(e){this._$mapping.delete(e)}execute(e){if(d.$keyLock||!this._$active)return;let t=d.$generateShortcutKey(e.key,{alt:d.$altKey,shift:d.$shiftKey,ctrl:d.$ctrlKey});const r=d.$shortcutSetting.commandMapping.get(this.areaName);if(r.has(t))t=r.get(t);else{if(d.$shortcutSetting.viewMapping.get(this.areaName).has(t))return}this._$mapping.has(t)&&(d.$endMenu(),e.stopPropagation(),e.preventDefault(),this._$mapping.get(t)(t))}}d.$keyboardCommand=new R;class z extends N{constructor(){super(),this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}static get FILL_DEFAULT_COLOR(){return"#000000"}static get STROKE_DEFAULT_COLOR(){return"#000000"}static get STROKE_DEFAULT_SIZE(){return 0}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("fill-color");e&&(e.value=localStorage.getItem(`${d.PREFIX}@${e.id}`)||z.FILL_DEFAULT_COLOR,e.addEventListener("change",(e=>{const t=e.target;localStorage.setItem(`${d.PREFIX}@${t.id}`,e.target.value)})));const t=document.getElementById("stroke-color");t&&(t.value=localStorage.getItem(`${d.PREFIX}@${t.id}`)||z.STROKE_DEFAULT_COLOR,t.addEventListener("change",(e=>{const t=e.target;localStorage.setItem(`${d.PREFIX}@${t.id}`,t.value)})));const r=document.getElementById("stroke-size");r&&(r.value=localStorage.getItem(`${d.PREFIX}@${r.id}`)||z.STROKE_DEFAULT_SIZE,this.setInputEvent(r)),d.$initializeEnd()}changeStrokeSize(e){return e=d.$clamp(0|e,0,255),localStorage.setItem(`${d.PREFIX}@stroke-size`,e),e}}d.$colorTool=new z;class j extends class extends class{constructor(){this._$events=new Map}addEventListener(e,t){this._$events.has(e)||this._$events.set(e,[]),this._$events.get(e).push(t)}dispatchEvent(e,t=null){if(!this._$events.has(e))return;const r=this._$events.get(e);for(let e=0;e<r.length;++e){(0,r[e])(t)}}}{constructor(){super(),this._$active=!1,this._$target=null,this._$events.set(Y.MOUSE_DOWN,[e=>{this.activation(e)}]),this._$events.set(Y.MOUSE_UP,[()=>{this.termination()}]),this._$events.set(Y.START,[()=>{this.toolStart()}]),this._$events.set(Y.END,[()=>{this.toolEnd()}])}get active(){return this._$active}set active(e){this._$active=!!e}get target(){return this._$target}set target(e){this._$target=e}activation(e){this.active=!0,this.target=e.currentTarget}termination(){this.active=!1,this.target=null}toolStart(){d.$setCursor("auto");const e=document.getElementById(`tools-${this._$name}`);e&&e.classList.add("active")}toolEnd(){const e=document.getElementById(`tools-${this._$name}`);e&&e.classList.remove("active")}}{constructor(e){if(super(),this._$name=e,this._$cursor="auto",this._$pageX=0,this._$pageY=0,this._$offsetX=0,this._$offsetY=0,e){d.$tools.setTool(e,this);let t=document.getElementById(`tools-${e}`);if(!t){const r=document.getElementById("plugin-tools");if(r){const a=document.createElement("div");a.id=`tools-${e}`,a.classList.add("item"),a.dataset.mode="tool",a.dataset.name=e,r.appendChild(a),t=a}}t&&t.addEventListener(Y.MOUSE_DOWN,(()=>{d.$tools.activeTool&&d.$tools.activeTool.dispatchEvent(Y.END),this.dispatchEvent(Y.START),d.$tools.activeTool=this}))}}get name(){return this._$name}get pageX(){return this._$pageX}set pageX(e){this._$pageX=e}get pageY(){return this._$pageY}set pageY(e){this._$pageY=e}get offsetX(){return this._$offsetX}set offsetX(e){this._$offsetX=e}get offsetY(){return this._$offsetY}set offsetY(e){this._$offsetY=e}setIcon(e){const t=document.getElementById(`tools-${this._$name}`),r=t.children;for(;r.length;)r[0].remove();t.appendChild(e)}setToolTip(e){const t=document.getElementById(`tools-${this._$name}`);t&&(t.dataset.detail=`${e}`)}setCursor(e="auto"){this._$cursor=`${e}`}}d.$project=new class{initialize(){const e=document.getElementById("tools-load");e&&e.addEventListener("click",(e=>{e.preventDefault(),this.open()}));const t=document.getElementById("tools-load-file-input");t&&t.addEventListener("change",(e=>{const t=e.target.files;for(let e=0;e<t.length;++e)this.load(t[e]);e.target.value=""}));const r=document.getElementById("tools-save");r&&r.addEventListener("click",(e=>{e.preventDefault(),this.save()}));const a=document.getElementById("tools-export");a&&a.addEventListener("click",(e=>{e.preventDefault(),this.publish()}));const i=document.getElementById("language-setting");if(i){const e=localStorage.getItem(`${d.PREFIX}@language-setting`);if(e){const t=i.children;for(let r=0;r<t.length;++r){const a=t[r];if(a.value===e){a.selected=!0;break}}}i.addEventListener("change",(e=>{const t=e.target.value,r=d.$languages.get(t);d.$currentLanguage=new r,localStorage.setItem(`${d.PREFIX}@language-setting`,t),d.$addModalEvent(document)}))}}publish(){const e=document.getElementById("save-anchor");e.href&&URL.revokeObjectURL(e.href);switch(document.getElementById("publish-type-setting").value){case"json":e.download=`${d.$currentWorkSpace().name}.json`,e.href=URL.createObjectURL(new Blob([W.toJSON()],{type:"application/json"})),e.click();break;case"zlib":W.toZlib();break;case"webm":W.toWebM();break;case"gif-loop":W.toGIF();break;case"gif":W.toGIF(-1);break;case"png":W.toPng();break;case"apng-loop":W.toApng(!0);break;case"apng":W.toApng(!1);break;case"custom":"CustomPublish"in window&&window.CustomPublish.execute(W.toObject())}}load(e){e.arrayBuffer().then((t=>{const r=new Uint8Array(t);d.$unZlibWorker.postMessage({buffer:r,name:e.name.replace(".n2d",""),type:"n2d"},[r.buffer])}))}open(){document.getElementById("tools-load-file-input").click()}save(){const e={object:d.$currentWorkSpace().toJSON(),type:"n2d"};d.$zlibWorkerActive?d.$zlibQueues.push(e):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(e))}};class W{static toObject(){const e=d.$currentWorkSpace(),t=e.stage,r=e._$libraries,a=[];for(let[e,t]of r)switch(!0){case 0===e:case"folder"!==t.type:case""!==t.symbol:case d.$useIds.has(e):{const r=t.toPublish();r.symbol&&d.$symbols.set(r.symbol,a.length),a[e]=r}break;default:a[e]=null}let i=d.$useIds.size;for(;;){for(let[e,t]of r){if(a[e])continue;if(!d.$useIds.has(e))continue;const r=t.toPublish();r.symbol&&d.$symbols.set(r.symbol,a.length),a[e]=r}if(i===d.$useIds.size)break;i=d.$useIds.size}return{stage:{width:t.width,height:t.height,fps:t.fps,bgColor:t.bgColor},characters:a}}static toJSON(){d.$symbols.size&&d.$symbols.clear();const e=W.toObject();return e.symbols=Array.from(d.$symbols),e.type="json",JSON.stringify(e)}static toZlib(){d.$symbols.size&&d.$symbols.clear();const e=W.toObject();e.symbols=Array.from(d.$symbols);const t={object:JSON.stringify(e),type:"json"};d.$zlibWorkerActive?d.$zlibQueues.push(t):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(t))}static toWebM(){const e=document.getElementById("__next2d__").children[0].captureStream(0|document.getElementById("stage-fps").value),t=[],r="video/webm;codecs=h264",a=new MediaRecorder(e,{mimeType:r});a.addEventListener("dataavailable",(e=>{t.push(e.data)})),a.addEventListener("stop",(()=>{d.$hidePreview();const e=document.getElementById("save-anchor");e.download=`${d.$currentWorkSpace().name}.webm`,e.href=URL.createObjectURL(new Blob(t,{type:r})),e.click()}));const i=function(){if(d.$root.numChildren)return d.$root.currentFrame>=d.$root.totalFrames?a.stop():void requestAnimationFrame(i);requestAnimationFrame(i)};i(),d.$showPreview(),a.start(0)}static toGIF(e=0){const t=new GIF({repeat:e,workerScript:"./assets/js/gif.worker.js"});t.on("finished",(e=>{const t=document.getElementById("save-anchor");t.download=`${d.$currentWorkSpace().name}.gif`,t.href=URL.createObjectURL(e),t.click()}));const r=function(){if(!d.$root.numChildren)return void requestAnimationFrame(r);const e=document.getElementById("__next2d__").children[0],a=document.createElement("canvas");a.width=e.width,a.height=e.height;const i=a.getContext("2d");if(i.drawImage(e,0,0,e.width,e.height),t.addFrame(i.canvas,{delay:20}),d.$root.currentFrame>=d.$root.totalFrames)return d.$hidePreview(),void t.render();requestAnimationFrame(r)};r(),d.$showPreview()}static toPng(){const e=()=>{if(!d.$root.numChildren)return void requestAnimationFrame(e);const t=d.$root.stage;if(!t)return void requestAnimationFrame(e);if(t._$player._$stopFlag)return void requestAnimationFrame(e);const r=document.getElementById("__next2d__").children[0],a=document.getElementById("save-anchor");a.download=`${d.$currentWorkSpace().name}.png`,a.href=r.toDataURL(),a.click(),d.$hidePreview()};e(),d.$showPreview()}static toApng(e=!0){const t=[];let r=0;const a=()=>{if(d.$root.stage._$player._$stopFlag||!d.$root.numChildren||r===d.$root.currentFrame)return void requestAnimationFrame(a);r=d.$root.currentFrame;const i=document.getElementById("__next2d__").children[0],s=document.createElement("canvas");s.width=i.width,s.height=i.height,i.toBlob((r=>{if(t.push(r),t.length===d.$root.totalFrames)return d.$hidePreview(),new m(t,i.width,i.height,0|document.getElementById("stage-fps").value,e).encode().then((e=>{const t=document.getElementById("save-anchor");t.download=`${d.$currentWorkSpace().name}.apng`,t.href=URL.createObjectURL(e),t.click()}))})),d.$root.currentFrame>=d.$root.totalFrames||requestAnimationFrame(a)};a(),d.$showPreview()}}d.$shortcutSetting=new class{constructor(){this._$names=["screen","timeline","library"],this._$default={screen:[{key:"v",text:"V",css:"tools-arrow",description:"{{選択ツール}}"},{key:"a",text:"A",css:"tools-transform",description:"{{Shape変形ツール}}"},{key:"p",text:"P",css:"tools-pen",description:"{{ペンツール}}"},{key:"k",text:"K",css:"tools-bucket",description:"{{バケツツール}}"},{key:"r",text:"R",css:"tools-rectangle",description:"{{矩形ツール}}"},{key:"o",text:"O",css:"tools-circle",description:"{{楕円ツール}}"},{key:"rShift",text:"Shift + R",css:"tools-round-rect",description:"{{角丸矩形ツール}}"},{key:"t",text:"T",css:"tools-text",description:"{{テキストツール}}"},{key:"z",text:"Z",css:"tools-zoom",description:"{{ズームツール}}"},{key:"rCtrl",text:"Ctrl + R",css:"tools-load",description:"{{プロジェクトデータの読込}}"},{key:"sShiftCtrl",text:"Ctrl + Shift + S",css:"tools-save",description:"{{プロジェクトデータを保存}}"},{key:"EnterShiftCtrl",text:"Ctrl + Shift + Enter",css:"tools-export",description:"{{書き出し}}"},{key:"s",text:"S",css:"tools-setting",description:"{{設定}}"},{key:"ArrowUpShiftCtrl",text:"Ctrl + Shift + ArrowUp",css:"screen-front",description:"{{最前面}}"},{key:"ArrowUpCtrl",text:"Ctrl + ArrowUp",css:"screen-front-one",description:"{{ひとつ前面へ}}"},{key:"ArrowDownCtrl",text:"Ctrl + ArrowDown",css:"screen-menu-bottom",description:"{{ひとつ背面へ}}"},{key:"ArrowDownShiftCtrl",text:"Ctrl + Shift + ArrowDown",css:"screen-back",description:"{{最背面}}"},{key:"1",text:"1",css:"screen-position-left",description:"{{左揃え}}"},{key:"2",text:"2",css:"screen-position-center",description:"{{中央揃え(水平方向)}}"},{key:"3",text:"3",css:"screen-position-right",description:"{{右揃え}}"},{key:"4",text:"4",css:"screen-position-top",description:"{{上揃え}}"},{key:"5",text:"5",css:"screen-position-middle",description:"{{中央揃え(垂直方向)}}"},{key:"6",text:"6",css:"screen-position-bottom",description:"{{下揃え}}"},{key:"!Shift",text:"Shift + 1",css:"stage-position-left",description:"{{ステージ左揃え}}"},{key:'"Shift',text:"Shift + 2",css:"stage-position-center",description:"{{ステージ中央揃え(水平方向)}}"},{key:"#Shift",text:"Shift + 3",css:"stage-position-right",description:"{{ステージ右揃え}}"},{key:"$Shift",text:"Shift + 4",css:"stage-position-top",description:"{{ステージ上揃え}}"},{key:"%Shift",text:"Shift + 5",css:"stage-position-middle",description:"{{ステージ中央揃え(垂直方向)}}"},{key:"&Shift",text:"Shift + 6",css:"stage-position-bottom",description:"{{ステージ下揃え}}"},{key:"dCtrl",text:"Ctrl + D",css:"screen-distribute-to-layers",description:"{{レイヤーに配分}}"},{key:"kCtrl",text:"Ctrl + K",css:"screen-distribute-to-keyframes",description:"{{キーフレームに配分}}"},{key:"iCtrl",text:"Ctrl + I",css:"screen-integrating-paths",description:"{{パスの結合}}"},{key:"pCtrl",text:"Ctrl + P",css:"screen-add-tween-curve-pointer",description:"{{カーブポインターの追加}}"},{key:"pShiftCtrl",text:"Ctrl + Shift + P",css:"screen-delete-tween-curve-pointer",description:"{{カーブポインターの削除}}"},{key:"mShift",text:"Shift + M",css:"screen-change-movie-clip",description:"{{MovieClipに変換}}"}],timeline:[{key:"nShift",text:"Shift + N",css:"timeline-layer-normal",description:"{{通常レイヤー}}"},{key:"mShift",text:"Shift + M",css:"timeline-layer-mask",description:"{{マスクレイヤー}}"},{key:"gShift",text:"Shift + G",css:"timeline-layer-guide",description:"{{ガイドレイヤー}}"},{key:";Ctrl",text:"Ctrl + +",css:"timeline-layer-add",description:"{{レイヤーを追加}}"},{key:"BackspaceCtrl",text:"Ctrl + Delete",css:"timeline-layer-trash",description:"{{レイヤーを削除}}"},{key:"hShift",text:"Shift + H",css:"timeline-layer-light-all",description:"{{全てのレイヤーをハイライト}}"},{key:"dShift",text:"Shift + D",css:"timeline-layer-disable-all",description:"{{全てのレイヤーを非表示}}"},{key:"lShift",text:"Shift + L",css:"timeline-layer-lock-all",description:"{{全てのレイヤーをロック}}"},{key:"m",text:"M",css:"context-menu-tween-add",description:"{{モーショントゥイーンの追加}}"},{key:"mCtrl",text:"Ctrl + M",css:"context-menu-tween-delete",description:"{{モーショントゥイーンの削除}}"},{key:"s",text:"S",css:"timeline-script-add",description:"{{スクリプトを追加}}"},{key:"k",text:"K",css:"timeline-key-add",description:"{{キーフレームを追加}}"},{key:"kCtrl",text:"Ctrl + K",css:"timeline-key-delete",description:"{{キーフレームを削除}}"},{key:"e",text:"E",css:"timeline-empty-add",description:"{{空のキーフレームを追加}}"},{key:"f",text:"F",css:"timeline-frame-add",description:"{{フレームを追加}}"},{key:"fCtrl",text:"Ctrl + F",css:"timeline-frame-delete",description:"{{フレームを削除}}"},{key:"oCtrl",text:"Ctrl + O",css:"timeline-onion-skin",description:"{{オニオンスキン}}"},{key:"p",text:"P",css:"timeline-preview",description:"{{プレビューのON/OFF}}"},{key:"pCtrl",text:"Ctrl + P",css:"timeline-repeat",description:"{{ループ設定}}"},{key:"l",text:"L",css:"label-name",description:"{{フレームラベル}}"},{key:"z",text:"Z",css:"timeline-scale",description:"{{タイムライン幅の拡大・縮小}}"}],library:[{key:"mCtrl",text:"Ctrl + M",css:"library-menu-container-add",description:"{{新規MovieClip}}"},{key:"fCtrl",text:"Ctrl + F",css:"library-menu-folder-add",description:"{{新規フォルダー}}"},{key:"sAlt",text:"Alt + S",css:"library-menu-content-shape-clone",description:"{{Shapeを複製}}"},{key:"rCtrl",text:"Ctrl + R",css:"library-menu-file",description:"{{読み込み}}"},{key:"rCtrl",text:"Ctrl + R",css:"library-menu-export",description:"{{書き出し}}"},{key:"Backspace",text:"Delete",css:"library-menu-delete",description:"{{削除}}"},{key:"BackspaceShiftCtrl",text:"Shift + Ctrl + Delete",css:"library-menu-no-use-delete",description:"{{未使用のアイテムを削除}}"}]},this._$commandMapping=new Map([["screen",new Map],["timeline",new Map],["library",new Map],["global",new Map]]),this._$viewMapping=new Map([["screen",new Map],["timeline",new Map],["library",new Map],["global",new Map]]),this._$active=!1,this._$selectNode=null,this._$selectArea="",this._$keydownEvent=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}get commandMapping(){return this._$commandMapping}get viewMapping(){return this._$viewMapping}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=["shortcut-setting-screen","shortcut-setting-timeline","shortcut-setting-library","shortcut-setting-reset","shortcut-setting-save","shortcut-setting-close"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.executeFunction(e)}))}this.createShortcutMap();for(let e=0;e<this._$names.length;++e){const t=this._$names[e],r=document.getElementById(`shortcut-list-${t}`);if(!r)continue;const a=this.viewMapping.get(t),i=this._$default[t];for(let e=0;e<i.length;++e){const t=i[e],s=`\n<div class="shortcut-item">\n    <i class="${t.css}"></i>\n    <div class="description">\n        <span class="language" data-text="${t.description}">${d.$currentLanguage.replace(t.description)}</span>\n    </div>\n    <div class="command" data-key="${t.key}" data-default-text="${t.text}">${t.text}</div>\n</div>`;r.insertAdjacentHTML("beforeend",s);const n=r.lastElementChild;n.addEventListener("mousedown",(e=>{this.selectNode(e)}));const o=n.lastElementChild;if(!a.has(o.dataset.key))continue;const l=a.get(o.dataset.key);o.dataset.map=l.map,o.textContent=l.text}}this._$keydownEvent=this.keydownEvent.bind(this),d.$initializeEnd()}createShortcutMap(){const e=localStorage.getItem(`${d.PREFIX}@shortcut`);if(!e)return;const t=JSON.parse(e),r=Object.keys(t);for(let e=0;e<r.length;++e){const a=r[e];this.viewMapping.get(a).clear(),this.commandMapping.get(a).clear();const i=t[a];for(let e=0;e<i.length;++e){const t=i[e];this.viewMapping.get(a).set(t.key,{map:t.map,text:t.text}),this.commandMapping.get(a).set(t.map,t.key)}}}keydownEvent(e){if(document.getElementById("shortcut-setting-menu").classList.contains("fadeOut"))return d.$useShortcutSetting=!1,this._$active=!1,void window.removeEventListener("keydown",this._$keydownEvent);if(!this._$selectNode||!this._$selectArea)return;const t=[];switch(d.$shiftKey&&t.push("Shift"),d.$altKey&&t.push("Alt"),d.$ctrlKey&&t.push("Ctrl"),!0){case"ArrowRight"===e.key:case"ArrowLeft"===e.key:case"ArrowUp"===e.key:case"ArrowDown"===e.key:t.push(e.key);break;case" "===e.key:t.push(e.code);break;case 1===e.key.length:t.push(e.key.toUpperCase());break;default:return}const r=this._$selectNode.lastElementChild;r.textContent=`${t.join(" + ")}`;const a=d.$generateShortcutKey(e.key,{alt:d.$altKey,shift:d.$shiftKey,ctrl:d.$ctrlKey});a!==r.dataset.key?(r.dataset.map=a,r.dataset.text=r.textContent):(delete r.dataset.map,delete r.dataset.text)}selectNode(e){this._$selectNode&&this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=e.target,this._$selectNode.classList.add("shortcut-active")}executeFunction(e){this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}executeShortcutSettingScreen(){document.getElementById("shortcut-setting-screen").classList.add("shortcut-active"),document.getElementById("shortcut-setting-timeline").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-library").classList.remove("shortcut-active"),document.getElementById("shortcut-list-screen").style.display="",document.getElementById("shortcut-list-timeline").style.display="none",document.getElementById("shortcut-list-library").style.display="none",this._$selectArea="screen",this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null)}executeShortcutSettingTimeline(){document.getElementById("shortcut-setting-screen").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-timeline").classList.add("shortcut-active"),document.getElementById("shortcut-setting-library").classList.remove("shortcut-active"),document.getElementById("shortcut-list-screen").style.display="none",document.getElementById("shortcut-list-timeline").style.display="",document.getElementById("shortcut-list-library").style.display="none",this._$selectArea="timeline",this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null)}executeShortcutSettingLibrary(){document.getElementById("shortcut-setting-screen").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-timeline").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-library").classList.add("shortcut-active"),document.getElementById("shortcut-list-screen").style.display="none",document.getElementById("shortcut-list-timeline").style.display="none",document.getElementById("shortcut-list-library").style.display="",this._$selectArea="library",this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null)}executeShortcutSettingReset(){localStorage.removeItem(`${d.PREFIX}@shortcut`);for(let e=0;e<this._$names.length;++e){const t=this._$names[e],r=document.getElementById(`shortcut-list-${t}`).children;for(let e=0;e<r.length;++e){const t=r[e].lastElementChild;t.textContent=t.dataset.defaultText,t.dataset.map&&(delete t.dataset.map,delete t.dataset.text)}this.viewMapping.get(t).clear(),this.commandMapping.get(t).clear()}this.createShortcutMap()}executeShortcutSettingSave(){localStorage.removeItem(`${d.PREFIX}@shortcut`);const e={};for(let t=0;t<this._$names.length;++t){const r=this._$names[t],a=document.getElementById(`shortcut-list-${r}`).children;for(let t=0;t<a.length;++t){const i=a[t].lastElementChild;i.dataset.map&&(e[r]||(e[r]=[]),e[r].push({key:i.dataset.key,map:i.dataset.map,text:i.textContent}))}}localStorage.setItem(`${d.PREFIX}@shortcut`,JSON.stringify(e)),this.createShortcutMap()}executeShortcutSettingClose(){d.$userSetting.show(),this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null,this._$selectArea="")}show(){const e=document.getElementById("shortcut-setting-menu");this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null,this._$selectArea=""),this.executeShortcutSettingScreen(),this._$active||(d.$useShortcutSetting=!0,this._$active=!0,window.addEventListener("keydown",this._$keydownEvent)),d.$endMenu("shortcut-setting-menu");const t=document.getElementById("user-setting");e.style.display="",e.style.left=`${t.offsetLeft}px`,e.style.top=`${t.offsetTop}px`,e.setAttribute("class","fadeIn")}};d.$tools=new class{constructor(){this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize(),this._$activeTool=null,this._$tools=new Map,this._$externalTools=new Map}get activeTool(){return this._$activeTool}set activeTool(e){this._$activeTool=e}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=[Z,re,Q,K,ee,J,V,te,ae,q];for(let t=0;t<e.length;++t){const r=new(0,e[t]);this._$tools.set(r.name,r)}const t=document.getElementById("tools");t&&(t.addEventListener("mousemove",(e=>{const t=this.activeTool;t&&(e.tools=!0,t.dispatchEvent(Y.MOUSE_MOVE,e))})),t.addEventListener("mouseout",(e=>{d.$setCursor("auto"),e.stopPropagation()}))),d.$project.initialize(),d.$userSetting.initialize(),d.$initializeEnd()}setTool(e,t){this._$externalTools.set(e,t)}getTool(e){return this._$externalTools.has(e)?this._$externalTools.get(e):null}getDefaultTool(e){return this._$tools.get(e)}reset(){const e=this.activeTool;e&&e.dispatchEvent(Y.END);const t=this.getDefaultTool("arrow");t.dispatchEvent(Y.START),this.activeTool=t}};d.$userSetting=new class{initialize(){const e=document.getElementById("tools-setting");e&&e.addEventListener("click",(e=>{this.show(e)}));const t=this.getPublishSetting(),r=document.getElementById("publish-layer-setting");r&&(r.children[t.layer?1:0].selected=!0,r.addEventListener("change",(e=>{const t=this.getPublishSetting();t.layer="1"===e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))})));const a=document.getElementById("publish-type-setting");if(a){for(let e=0;e<a.children.length;++e){const r=a.children[e];if(t.type===r.value){r.selected=!0;break}}a.addEventListener("change",(e=>{const t=this.getPublishSetting();t.type=e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))}))}const i=document.getElementById("modal-setting");i&&("modal"in t&&(i.children[t.modal?0:1].selected=!0),i.addEventListener("change",(e=>{const t=this.getPublishSetting();t.modal="1"===e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))})));const s=document.getElementById("shortcut-setting");s&&s.addEventListener("click",(()=>{d.$shortcutSetting.show()}))}getPublishSetting(){const e=localStorage.getItem(`${d.PREFIX}@user-publish-setting`);return e?JSON.parse(e):{layer:!1,type:"zlib"}}show(){const e=document.getElementById("user-setting");d.$endMenu("user-setting");const t=document.getElementById("tools-setting");e.style.display="",e.style.left=`${t.offsetLeft+30}px`,e.style.top=t.offsetTop-e.clientHeight+80+"px",e.setAttribute("class","fadeIn")}};class H extends j{constructor(e){super(e),this.initialize()}initialize(){}changeNodeEvent(e=!0){d.$hitColor=null;const t=document.getElementById("stage-area");if(t){const r=t.children;for(let t=0;t<r.length;++t){const a=r[t];a.dataset.shapePointer?(a.remove(),--t):a.dataset.child&&(a.style.pointerEvents=e?"auto":"none")}}}createShape(e,t=0,r=0){const a=d.$currentWorkSpace().scene,i=0|d.$timelineLayer.targetLayer.dataset.layerId,s=a.getLayer(0|i);if(s.lock)return;const n=d.$currentWorkSpace().addLibrary(e),o=d.$timelineFrame.currentFrame,l=s.adjustmentLocation(o),c=new $;c.libraryId=n.id,c.startFrame=l.startFrame,c.endFrame=l.endFrame,c.setPlace(l.startFrame,{frame:l.startFrame,matrix:[1,0,0,1,t,r],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:s._$characters.length}),s.addCharacter(c),s.reloadStyle(),d.$libraryController.reload()}createTextField(e,t=0,r=0){const a=d.$currentWorkSpace().scene,i=0|d.$timelineLayer.targetLayer.dataset.layerId,s=a.getLayer(0|i);if(s.lock)return;const n=d.$currentWorkSpace().addLibrary(e),o=d.$timelineFrame.currentFrame,l=s.adjustmentLocation(o),c=new $;c.libraryId=n.id,c.startFrame=l.startFrame,c.endFrame=l.endFrame,c.setPlace(l.startFrame,{frame:l.startFrame,matrix:[1,0,0,1,t,r],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:s._$characters.length}),s.addCharacter(c),s.reloadStyle(),d.$libraryController.reload()}reloadScreen(){const e=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(e)}}class G extends H{constructor(e){super(e)}initialize(){this.setCursor("crosshair"),this.addEventListener(Y.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(!1)})),this.addEventListener(Y.MOUSE_DOWN,(e=>{d.$setCursor(this._$cursor),this.active=!!e.screen,e.screen&&this.mouseDown(e)})),this.addEventListener(Y.MOUSE_MOVE,(e=>{d.$setCursor(this._$cursor),e.screen&&this.active&&(e.stopPropagation(),this.mouseMove(e))})),this.addEventListener(Y.MOUSE_UP,(e=>{d.$setCursor(this._$cursor),e.stopPropagation(),e.screen&&(d.$timelineLayer.attachLayer(),this.createCharacter(),document.getElementById("draw-rect").style.display="none",d.$tools.reset())}))}createCharacter(e){const t=document.getElementById("draw-rect"),{Graphics:r}=window.next2d.display,a=0|document.getElementById("stroke-size").value,i=(parseFloat(t.style.width)+a)/d.$zoomScale,s=(parseFloat(t.style.height)+a)/d.$zoomScale;if(i&&s){const t=d.$currentWorkSpace();t.temporarilySaved();const n=new r;switch(n.beginFill(document.getElementById("fill-color").value,1),e){case"rectangle":n.drawRect(0,0,i,s);break;case"circle":n.drawEllipse(0,0,i,s);break;case"round-rect":n.drawRoundRect(0,0,i,s,Math.min(i,s)/4)}n.endFill();const o=(this.offsetX-d.$offsetLeft)/d.$zoomScale,l=(this.offsetY-d.$offsetTop)/d.$zoomScale,c=t.nextLibraryId;if(this.createShape({id:c,type:b.SHAPE,name:`Shape_${c}`,symbol:"",recodes:n._$recode?n._$recode.slice(0):[],bounds:{xMin:0,xMax:i,yMin:0,yMax:s}},o+a/2,l+a/2),a){const n=new r;switch(n.lineStyle(a,document.getElementById("stroke-color").value),e){case"rectangle":n.drawRect(0,0,i,s);break;case"circle":n.drawEllipse(0,0,i,s);break;case"round-rect":n.drawRoundRect(0,0,i,s,Math.min(i,s)/4)}n.endLine();const o=Math.abs(n._$xMax-n._$xMin)-i,l=Math.abs(n._$yMax-n._$yMin)-s,c=this.offsetX-d.$offsetLeft,h=this.offsetY-d.$offsetTop,u=t.nextLibraryId;this.createShape({id:u,type:b.SHAPE,name:`Shape_${u}`,symbol:"",recodes:n._$recode?n._$recode.slice(0):[],bounds:{xMin:-o/2,xMax:i+o/2,yMin:-l/2,yMax:s+l/2}},c+o/2,h+l/2)}this.reloadScreen()}}mouseDown(e){this.pageX=e.pageX,this.pageY=e.pageY,this.offsetX=e.offsetX,this.offsetY=e.offsetY,"stage-area"!==e.target.id&&(this.offsetX+=e.target.offsetLeft,this.offsetY+=e.target.offsetTop);const t=document.getElementById("draw-rect");t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,t.style.width="0px",t.style.height="0px",t.style.display="",t.style.background=document.getElementById("fill-color").value,t.style.borderRadius="",t.style.border="";const r=0|document.getElementById("stroke-size").value;r&&(t.style.borderRadius=`${r}px`,t.style.border=`${r}px solid ${document.getElementById("stroke-color").value}`)}mouseMove(e){e.preventDefault();const t=e.pageX,r=e.pageY,a=document.getElementById("draw-rect");if("circle"===this.name&&(a.style.borderRadius="50%"),d.$shiftKey){const i=Math.max(Math.abs(t-this.pageX),Math.abs(r-this.pageY));this.pageX<t&&(a.style.left=`${this.pageX}px`),this.pageY<r&&(a.style.top=`${this.pageY}px`),this.pageX>t&&(this.offsetX=e.offsetX,a.style.left=this.pageX-i+"px"),this.pageY>r&&(this.offsetY=e.offsetY,a.style.top=this.pageY-i+"px"),a.style.width=`${i}px`,a.style.height=`${i}px`}else this.pageX>t&&(this.offsetX=e.offsetX,a.style.left=`${t}px`),this.pageY>r&&(this.offsetY=e.offsetY,a.style.top=`${r}px`),a.style.width=`${Math.abs(t-this.pageX)}px`,a.style.height=`${Math.abs(r-this.pageY)}px`;if("round-rect"===this.name){const e=Math.min(parseFloat(a.style.width),parseFloat(a.style.height));a.style.borderRadius=(e/8|0)+"px"}}}class Z extends H{constructor(){super("arrow"),this._$saved=!1,this._$activeElement="",this._$activeElements=[]}initialize(){this.addEventListener(Y.MOUSE_OVER,(e=>{const t=0|e.currentTarget.dataset.layerId,r=document.getElementById(`layer-lock-icon-${t}`);r&&!r.classList.contains("icon-active")&&d.$setCursor("move")})),this.addEventListener(Y.MOUSE_OUT,(()=>{d.$setCursor("auto")})),this.addEventListener(Y.CHANGE,(e=>{this.changeCharacter(e)})),this.addEventListener(Y.MOUSE_LEAVE,(()=>{this.active=!1})),this.addEventListener(Y.MOUSE_DOWN,(e=>{switch(this.active=!1,!0){case e.displayObject:this.active=!0,this._$activeElement=Z.DISPLAY_OBJECT,d.$endMenu(),this.activateElement(e);break;case e.screen:this.active=!0,this._$activeElement=Z.SCREEN,d.$endMenu(),this.clear(),this.startRect(e);break;case e.transform:this.active=!0,this._$activeElement=Z.TRANSFORM,d.$endMenu(),this.startPosition(e);break;case e.grid:this.active=!0,this._$activeElement=Z.GRID,d.$endMenu(),this.startPosition(e);break;default:this._$activeElement=""}})),this.addEventListener(Y.MOUSE_MOVE,(e=>{if(this.active)switch(e.stopPropagation(),e.preventDefault(),this._$activeElement){case Z.DISPLAY_OBJECT:this.moveDisplayObject(e);break;case Z.SCREEN:this.moveRect(e);break;case Z.TRANSFORM:this.moveTransform(e);break;case Z.GRID:this.moveGrid(e)}})),this.addEventListener(Y.MOUSE_UP,(e=>{if(this._$activeElement){if(this._$activeElement===Z.SCREEN)e.stopPropagation(),this.endRect();this._$activeElement="",this._$saved=!1}})),this.addEventListener(Y.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent()})),this.addEventListener(Y.END,(()=>{this.clearActiveElement(),d.$transformController.hide(),d.$gridController.hide(),d.$tweenController.clearPointer(),d.$controller.default()})),this.addEventListener(Y.DBL_CLICK,(e=>{e.screen&&!this._$activeElements.length&&this.moveScene()})),this.dispatchEvent(Y.START),d.$tools.activeTool=this}get activeElements(){return this._$activeElements}static get SCREEN(){return"screen"}static get TRANSFORM(){return"transform"}static get DISPLAY_OBJECT(){return"displayObject"}static get GRID(){return"grid"}clear(){this.clearActiveElement(),d.$clearShapePointer(),d.$transformController.hide(),d.$gridController.hide(),d.$tweenController.clearPointer(),d.$controller.default(),d.$timelineLayer.clear(),d.$referenceController.resetPointer()}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}clearActiveElement(){this._$activeElements.length=0}deleteDisplayObject(){const e=this.activeElements;if(!e.length)return;this.save();const t=d.$timelineFrame.currentFrame,r=new Map,a=d.$currentWorkSpace().scene;for(let i=0;i<e.length;++i){const s=e[i],n=a.getLayer(0|s.dataset.layerId);if(!n)continue;const o=n.getCharacter(0|s.dataset.characterId);o&&(r.has(n.id)||r.set(n.id,{layer:n,range:o.getRange(t)}),o.remove(n))}this.clearActiveElement();for(const e of r.values()){const r=e.layer,a=e.range,i=r.getActiveCharacter(a.startFrame);if(i.length){r.sort(i,t);for(let e=0;e<i.length;++e)i[e].getPlace(t).depth=e}else r.addEmptyCharacter(new f({startFrame:a.startFrame,endFrame:a.endFrame}));r.reloadStyle()}this.reloadScreen(),this._$saved=!1}addElement(e,t=!1){for(let t=0;t<this._$activeElements.length;++t){if(this._$activeElements[t].dataset.characterId===e.dataset.characterId)return d.$shiftKey?(d.$tweenController.clearPointer(),this._$activeElements.splice(t,1),d.$referenceController.pointer=null):this._$activeElements.splice(t,1,e),!1}t||d.$shiftKey?d.$referenceController.pointer=null:this.clearActiveElement(),this._$activeElements.push(e);const r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId).getCharacter(0|e.dataset.characterId),a=r.getRange(d.$timelineFrame.currentFrame);return r.hasTween(a.startFrame)&&d.$tweenController.clearPointer().relocationPointer(),!0}activateElement(e){let t=this.target;const r=0|t.dataset.layerId,a=d.$currentWorkSpace().scene.getLayer(r);if(a.lock)return;this.pageX=e.pageX,this.pageY=e.pageY,d.$timelineLayer.clear();const i=a.getCharacter(0|t.dataset.characterId);if(d.$altKey){const e=i.clone();for(const[t,r]of e._$places){let e=0;const i=a.getActiveCharacter(t);for(let r=0;r<i.length;++r)e=Math.max(i[r].getPlace(t).depth,e);r.depth=e+1}a.addCharacter(e);const r=d.$timelineFrame.currentFrame;d.$screen.appendCharacter(e,r,a.id),t=document.getElementById(`character-${e.id}`)}this.addElement(t),this.updateControllerProperty(),1===this._$activeElements.length&&i.showShapeColor(e),d.$transformController.show().relocation(),d.$gridController.show().relocation(),this.activeTimeline()}activeTimeline(){d.$timelineLayer.clear();const e=d.$timelineFrame.currentFrame,t=d.$ctrlKey;d.$ctrlKey=this._$activeElements.length>1;const r=d.$currentWorkSpace().scene;for(let t=0;t<this._$activeElements.length;++t){const a=0|this._$activeElements[t].dataset.layerId,i=document.getElementById(`layer-id-${a}`);d.$timelineLayer.targetLayers.has(i.id)||(d.$timelineLayer.targetLayer=i);const s=r.getLayer(a);d.$timelineLayer.addTargetFrame(s,e)}d.$ctrlKey=t}changeCharacter(e){if(1!==this._$activeElements.length)return;const t=d.$currentWorkSpace(),r=t.scene,a=this._$activeElements[0],i=0|a.dataset.layerId,s=r.getLayer(i),n=0|a.dataset.characterId,o=s.getCharacter(n);o._$libraryId=0|e.target.value,o.dispose();const l=t.getLibrary(o._$libraryId);if(l.type===b.MOVIE_CLIP)for(const e of o._$places.values())e.loop=d.$getDefaultLoopConfig();const c=o.getRange(d.$timelineFrame.currentFrame);o.hasTween(c.startFrame)&&d.$tweenController.clearPointer().relocationPointer();document.getElementById("instance-type-name").getElementsByTagName("i")[0].setAttribute("class",`library-type-${l.type}`),this.reloadScreen(),d.$transformController.show().relocation()}startRect(e){this.pageX=e.pageX,this.pageY=e.pageY;const t=document.getElementById("stage-rect");t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,t.style.width="0px",t.style.height="0px",t.style.display=""}moveRect(e){const t=e.pageX,r=e.pageY,a=document.getElementById("stage-rect");this.pageX>t&&(a.style.left=`${t}px`),this.pageY>r&&(a.style.top=`${r}px`),a.style.width=`${Math.abs(t-this.pageX)}px`,a.style.height=`${Math.abs(r-this.pageY)}px`}endRect(){const e=document.getElementById("stage-rect");e.style.display="none";const t=parseFloat(e.style.width),r=parseFloat(e.style.height);if(!t||!r)return;const a=parseFloat(e.style.left),i=parseFloat(e.style.top),s=a+t,n=i+r,o=document.getElementById("stage-area").children;for(let e=0;e<o.length;++e){const t=o[e];switch(!0){case!t.dataset.child:case"tween"===t.dataset.child:case"true"===t.dataset.preview:continue}const r=t.getBoundingClientRect();switch(!0){case r.bottom<i:case r.top>n:case r.right<a:case r.left>s:continue}const l=0|t.dataset.layerId;document.getElementById(`layer-lock-icon-${l}`).classList.contains("icon-active")||this.addElement(t,!0)}this._$activeElements.length&&(this.updateControllerProperty(),d.$transformController.show().relocation(),this.activeTimeline())}startPosition(e){this.pageX=e.pageX,this.pageY=e.pageY}moveGrid(e){d.$setCursor("move"),e.preventDefault();const t=(e.pageX-this.pageX)/d.$zoomScale,r=(e.pageY-this.pageY)/d.$zoomScale;let a=+document.getElementById("nine-slice-setting-x").value,i=+document.getElementById("nine-slice-setting-y").value,s=+document.getElementById("nine-slice-setting-w").value,n=+document.getElementById("nine-slice-setting-h").value;switch(this.target.id){case"grid-top-left":a+=t,s-=t,i+=r,n-=r;break;case"grid-top-right":s+=t,i+=r;break;case"grid-bottom-left":a+=t,s-=t,n+=r;break;case"grid-bottom-right":s+=t,n+=r}document.getElementById("nine-slice-setting-x").value=`${a}`,document.getElementById("nine-slice-setting-y").value=`${i}`,document.getElementById("nine-slice-setting-w").value=`${s}`,document.getElementById("nine-slice-setting-h").value=`${n}`,this.startPosition(e),d.$gridController.updateShapeGrid(a,i,s,n),this.reloadScreen()}moveTransform(e){d.$setCursor("move"),e.preventDefault(),this.save();let t=!1;switch(this.target.id){case"scale-top-left":{const r=this.updateLeftScaleX(e),a=this.updateTopScaleY(e);(r||a)&&(t=!0,d.$shiftKey&&this.adjustmentScale(r,a))}break;case"scale-center-left":this.updateLeftScaleX(e)&&(t=!0);break;case"scale-bottom-left":{const r=this.updateLeftScaleX(e),a=this.updateBottomScaleY(e);(r||a)&&(t=!0,d.$shiftKey&&this.adjustmentScale(r,a))}break;case"scale-center-bottom":this.updateBottomScaleY(e)&&(t=!0);break;case"scale-bottom-right":{const r=this.updateRightScaleX(e),a=this.updateBottomScaleY(e);(r||a)&&(t=!0,d.$shiftKey&&this.adjustmentScale(r,a))}break;case"scale-center-right":this.updateRightScaleX(e)&&(t=!0);break;case"scale-top-right":{const r=this.updateRightScaleX(e),a=this.updateTopScaleY(e);(r||a)&&(t=!0,d.$shiftKey&&this.adjustmentScale(r,a))}break;case"scale-center-top":this.updateTopScaleY(e)&&(t=!0);break;case"target-rotation":this.updateRotate(e)&&(t=!0);break;case"reference-point":this.updateReferencePoint(e);break;default:return}this.startPosition(e),t&&this.reloadScreen()}adjustmentScale(e=0,t=0){if(e!==t){if(e){const t=+document.getElementById("transform-scale-y").value;d.$transformController.updateScaleY((t+e)/100)}if(t){const e=+document.getElementById("transform-scale-x").value;d.$transformController.updateScaleX((e+t)/100)}}}updateTopScaleY(e){const t=this.pageY-e.pageY;if(!t)return 0;const r=+document.getElementById("transform-scale-y").value;return d.$transformController.updateScaleY((r+t)/100),t}updateRotate(e){const t=e.pageX-this.pageX;if(!t)return 0;let r=+document.getElementById("transform-rotate").value+t;return r=d.$clamp((0|r)%360,we.MIN_ROTATE,we.MAX_ROTATE),0>r&&(r+=360),d.$transformController.updateRotate(r),1}updateReferencePoint(e){const t=(e.pageX-this.pageX)/d.$zoomScale,r=(e.pageY-this.pageY)/d.$zoomScale,a=d.$tools.getDefaultTool("arrow").activeElements,i=document.getElementById("reference-point");if(a.length>1){const e=d.$referenceController.pointer;e.x+=t,e.y+=r,d.$referenceController.setInputValue(e.x,e.y),i.style.left=`${i.offsetLeft+t}px`,i.style.top=`${i.offsetTop+r}px`}else{const e=a[0],s=0|e.dataset.layerId,n=d.$currentWorkSpace().scene.getLayer(s).getCharacter(0|e.dataset.characterId),o=d.$timelineFrame.currentFrame,l=n.getPlace(o);if(!l.point){const e=n.getBounds();l.point={x:l.matrix[4]+Math.abs(e.xMax-e.xMin)/2,y:l.matrix[5]+Math.abs(e.yMax-e.yMin)/2}}l.point.x+=t,l.point.y+=r,d.$referenceController.setInputValue(l.point.x,l.point.y);const c=d.$offsetLeft+l.point.x*d.$zoomScale-8,h=d.$offsetTop+l.point.y*d.$zoomScale-8;i.setAttribute("style",`left: ${c}px; top: ${h}px;`)}}updateLeftScaleX(e){const t=this.pageX-e.pageX;if(!t)return 0;const r=+document.getElementById("transform-scale-x").value;return d.$transformController.updateScaleX((r+t)/100),t}updateBottomScaleY(e){const t=e.pageY-this.pageY;if(!t)return 0;const r=+document.getElementById("transform-scale-y").value;return d.$transformController.updateScaleY((r+t)/100),t}updateRightScaleX(e){const t=e.pageX-this.pageX;if(!t)return 0;const r=+document.getElementById("transform-scale-x").value;return d.$transformController.updateScaleX((r+t)/100),t}moveDisplayObject(e=null){this.save();const t=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame,a=e?e.pageX-this.pageX:this.pageX,i=e?e.pageY-this.pageY:this.pageY;let s=Number.MAX_VALUE,n=Number.MAX_VALUE;for(let e=0;e<this._$activeElements.length;++e){const o=this._$activeElements[e],l=document.getElementById(o.id);if(!l)continue;const c=0|l.dataset.layerId,h=t.getLayer(c),u=h.getCharacter(0|l.dataset.characterId);this.initPlace(u,c,r);const m=u.getPlace(r),g=m.matrix;g[4]+=a/d.$zoomScale,g[5]+=i/d.$zoomScale;const p=u.getBounds();m.point?(m.point.x+=a/d.$zoomScale,m.point.y+=i/d.$zoomScale):m.point={x:p.xMin+Math.abs(p.xMax-p.xMin)/2,y:p.yMin+Math.abs(p.yMax-p.yMin)/2},u.screenX=p.xMin,u.screenY=p.yMin;let $="position: absolute;";if($+=`pointer-events: ${l.dataset.pointer};`,null!==h.maskId){const e=t.getLayer(h.maskId);if(e.lock&&e._$characters.length){const t=d.$getCanvas(),r=e._$characters[0],a=r.draw(t),i=a.toDataURL(),s=a._$width*d.$zoomScale,n=a._$height*d.$zoomScale,o=(r.screenX-u.screenX)*d.$zoomScale,l=(r.screenY-u.screenY)*d.$zoomScale;$+=`mask: url(${i}), none;`,$+=`-webkit-mask: url(${i}), none;`,$+=`mask-size: ${s}px ${n}px;`,$+=`-webkit-mask-size: ${s}px ${n}px;`,$+="mask-repeat: no-repeat;",$+="-webkit-mask-repeat: no-repeat;",$+=`mask-position: ${o}px ${l}px;`,$+=`-webkit-mask-position: ${o}px ${l}px;`;const c=d.$getCanvas(),h=u.draw(c);$+=`mix-blend-mode: ${h.style.mixBlendMode};`,$+=`filter: ${h.style.filter};`}}const f=d.$offsetLeft+p.xMin*d.$zoomScale,y=d.$offsetTop+p.yMin*d.$zoomScale;$+=`left: ${f}px;`,$+=`top: ${y}px;`,l.setAttribute("style",$),s=Math.min(s,u.x),n=Math.min(n,u.y),u.relocationTween(r)}if(e&&(this.pageX=e.pageX,this.pageY=e.pageY),document.getElementById("object-x").value=s,document.getElementById("object-y").value=n,this._$activeElements.length>1){const e=d.$referenceController.pointer;e.x+=a,e.y+=i}d.$transformController.show().relocation(),d.$gridController.show().relocation();const o=document.getElementById("timeline-onion-skin");o&&o.classList.contains("onion-skin-active")&&this.reloadScreen()}initPlace(e,t,r){const a=d.$currentWorkSpace().scene.getLayer(t);let i=r;for(;i>0;){const t=a.getChildren(i);if(t&&"key-frame"===t.dataset.frameState){e._$places.has(i)||e.setPlace(i,e.getClonePlace(i));break}i--}}updateControllerProperty(){const e=d.$currentWorkSpace().scene;let t=null,r=Number.MAX_VALUE,a=Number.MAX_VALUE,i=Number.MAX_VALUE,s=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let l=0;l<this._$activeElements.length;++l){const c=this._$activeElements[l],d=0|c.dataset.layerId;t=e.getLayer(d).getCharacter(0|c.dataset.characterId),r=Math.min(r,t.x),a=Math.min(a,t.y);const h=t.getBounds();i=Math.min(i,h.xMin),s=Math.max(s,h.xMax),n=Math.min(n,h.yMin),o=Math.max(o,h.yMax)}const l=Math.abs(s-i),c=Math.abs(o-n);document.getElementById("object-width").value=`${l}`,document.getElementById("object-height").value=`${c}`,document.getElementById("object-x").value=`${r}`,document.getElementById("object-y").value=`${a}`,d.$controller.showObjectSetting(["object-area"]),d.$controller.hideObjectSetting(["stage-setting","fill-color-setting"]),this._$activeElements.length>1?(d.$controller.hideObjectSetting(["object-setting","color-setting","blend-setting","loop-setting","filter-setting","video-setting","instance-setting","text-setting","nine-slice-setting","sound-setting","ease-setting"]),d.$referenceController.pointer||(d.$referenceController.pointer={x:i+l/2,y:n+c/2}),document.getElementById("transform-scale-x").value=100,document.getElementById("transform-scale-y").value=100,document.getElementById("transform-rotate").value=0):t.showController()}moveScene(){const e=document.getElementById("scene-name-menu-list").lastElementChild;e&&(d.$sceneChange.execute(0|e.dataset.libraryId),e.remove())}}class V extends H{constructor(){super("bucket")}initialize(){this.addEventListener(Y.START,(()=>{this.setCursor(),this.changeNodeEvent()})),this.addEventListener(Y.MOUSE_DOWN,(e=>{this.setCursor(),e.stopPropagation(),e.displayObject&&this.mouseDown(e)})),this.addEventListener(Y.MOUSE_MOVE,(e=>{this.setCursor(),e.stopPropagation()})),this.addEventListener(Y.MOUSE_UP,(e=>{this.setCursor(),e.stopPropagation(),d.$tools.reset()}))}setCursor(){const e=d.$intToRGB(0|`0x${document.getElementById("fill-color").value.slice(1)}`);d.$setCursor(`url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="rgb(${e.R},${e.G},${e.B})" d="M24 19.007c0-3.167-1.409-6.771-2.835-9.301l-.006-.01-.014-.026c-.732-1.392-1.914-3.052-3.619-4.757-2.976-2.976-5.476-3.912-6.785-3.913-.413 0-.708.094-.859.245l-.654.654c-1.898-.236-3.42.105-4.294.982-.876.875-1.164 2.159-.792 3.524.242.893.807 1.891 1.752 2.836.867.867 2.062 1.684 3.615 2.327.488-.839 1.654-1.019 2.359-.315.586.586.584 1.533-.002 2.119s-1.533.589-2.121 0c-.229-.229-.366-.515-.416-.812-1.646-.657-3.066-1.534-4.144-2.612-.728-.728-1.289-1.528-1.664-2.349l-2.835 2.832c-.445.447-.685 1.064-.686 1.82.001 1.635 1.122 3.915 3.714 6.506 2.764 2.764 5.58 4.243 7.431 4.243.649 0 1.181-.195 1.548-.562l8.086-8.079c.911.875-.777 3.541-.777 4.65 0 1.104.896 1.999 2 1.998 1.104 0 1.998-.895 1.998-2zm-18.912-12.974c-.236-.978-.05-1.845.554-2.444.526-.53 1.471-.791 2.656-.761l-3.21 3.205zm9.138 2.341l-.03-.029c-1.29-1.291-3.802-4.354-3.095-5.062.715-.715 3.488 1.521 5.062 3.095.862.863 2.088 2.248 2.938 3.459-1.718-1.073-3.493-1.469-4.875-1.463zm-3.875 12.348c-.547-.082-1.5-.547-1.9-.928l7.086-7.086c.351.37 1.264.931 1.753 1.075l-6.939 6.939z"/></svg>'),auto`)}mouseDown(e){const t=e.target;if(t.dataset.instanceType===b.SHAPE){const{Graphics:e}=window.next2d.display,r=d.$currentWorkSpace();r.temporarilySaved();const a=r.getLibrary(0|t.dataset.libraryId),i=d.$intToRGB(0|`0x${document.getElementById("fill-color").value.slice(1)}`);switch(a._$recodes[a._$recodes.length-1]){case e.END_FILL:a._$recodes.splice(a._$recodes.length-6,6,e.FILL_STYLE,i.R,i.G,i.B,255,e.END_FILL);break;case e.END_STROKE:a._$recodes.push(e.FILL_STYLE,i.R,i.G,i.B,255,e.END_FILL)}a.cacheClear(),this.reloadScreen()}}}class K extends G{constructor(){super("circle")}createCharacter(){super.createCharacter("circle")}}class q extends H{constructor(){super("hand")}initialize(){this.setCursor("grab"),this.addEventListener(Y.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(!1)})),this.addEventListener(Y.MOUSE_MOVE,(e=>{if(d.$setCursor(this._$cursor),!this.active)return;const t=document.getElementById("screen");t.scrollLeft+=this.pageX-e.pageX,t.scrollTop+=this.pageY-e.pageY,this.pageX=e.pageX,this.pageY=e.pageY})),this.addEventListener(Y.MOUSE_UP,(()=>{this.active=!1,this.setCursor("grab"),d.$setCursor(this._$cursor)})),this.addEventListener(Y.MOUSE_DOWN,(e=>{this.active=!0,this.setCursor("grabbing"),d.$setCursor(this._$cursor),this.pageX=e.pageX,this.pageY=e.pageY}))}}class J extends H{constructor(){super("pen")}initialize(){this.addEventListener(Y.START,(()=>{this.setCursor(),this.changeNodeEvent(!1)})),this.addEventListener(Y.MOUSE_DOWN,(e=>{this.setCursor(),e.stopPropagation(),this.clearPenPointer();let t=e.offsetX,r=e.offsetY;"stage-area"!==e.target.id&&(t+=e.target.offsetLeft,r+=e.target.offsetTop),this.offsetX=t,this.offsetY=r})),this.addEventListener(Y.MOUSE_MOVE,(e=>{this.setCursor(),e.stopPropagation(),e.screen&&this.active&&this.mouseMove(e)})),this.addEventListener(Y.MOUSE_UP,(e=>{this.setCursor(),e.stopPropagation(),this.mouseUp()}))}clearPenPointer(){const e=document.getElementById("stage-area");for(let t=0;e.children.length>t;++t){const r=e.children[t];r.dataset.penPointer&&(r.remove(),--t)}}setCursor(){const e=d.$intToRGB(0|`0x${document.getElementById("stroke-color").value.slice(1)}`);d.$setCursor(`url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24"><path fill="rgb(${e.R},${e.G},${e.B})" d="M1.438 16.875l5.688 5.689-7.126 1.436 1.438-7.125zm22.562-11.186l-15.46 15.46-5.688-5.689 15.459-15.46 5.689 5.689zm-4.839-2.017l-.849-.849-12.614 12.599.85.849 12.613-12.599z"/></svg>') 0 12, auto`)}mouseMove(e){const t=0|document.getElementById("stroke-size").value;if(t){e.preventDefault();let r=e.offsetX,a=e.offsetY;"stage-area"!==e.target.id&&(r+=e.target.offsetLeft,a+=e.target.offsetTop);const i=document.getElementById("stage-area"),s=document.createElement("div");s.dataset.penPointer="true",s.classList.add("pen-pointer"),s.style.width=`${t}px`,s.style.height=`${t}px`,s.style.left=`${r}px`,s.style.top=`${a}px`,s.style.backgroundColor=document.getElementById("stroke-color").value,s.style.borderRadius=t/2+"px",i.appendChild(s)}}mouseUp(){d.$timelineLayer.attachLayer();const{Shape:e}=window.next2d.display,t=0|document.getElementById("stroke-size").value,r=new e;r.graphics.lineStyle(t,document.getElementById("stroke-color").value);const a=this.offsetX-d.$offsetLeft,i=this.offsetY-d.$offsetTop;r.graphics.moveTo(0,0);const s=document.getElementById("stage-area").children;for(let e=0;s.length>e;++e){const t=s[e];t.dataset.penPointer&&(r.graphics.lineTo((t.offsetLeft-d.$offsetLeft-a)/d.$zoomScale,(t.offsetTop-d.$offsetTop-i)/d.$zoomScale),t.remove(),--e)}r.graphics.endLine();const n=d.$currentWorkSpace().nextLibraryId,o=(a+t)/2/d.$zoomScale,l=(i+t)/2/d.$zoomScale;this.createShape({id:n,type:b.SHAPE,name:`Shape_${n}`,symbol:"",recodes:r.graphics._$recode.slice(0),bounds:{xMin:r.graphics._$xMin,xMax:r.graphics._$xMax,yMin:r.graphics._$yMin,yMax:r.graphics._$yMax}},o,l),this.reloadScreen(),d.$tools.reset()}}class Q extends G{constructor(){super("rectangle")}createCharacter(){super.createCharacter("rectangle")}}class ee extends G{constructor(){super("round-rect")}createCharacter(){super.createCharacter("round-rect")}}class te extends H{constructor(){super("text")}initialize(){this.addEventListener(Y.START,(()=>{d.$setCursor("text"),this.changeNodeEvent(!1)})),this.addEventListener(Y.MOUSE_DOWN,(e=>{d.$setCursor("text"),e.stopPropagation(),e.screen&&this.mouseDown(e)})),this.addEventListener(Y.MOUSE_MOVE,(e=>{d.$setCursor("text"),e.stopPropagation(),e.screen&&this.mouseMove(e)})),this.addEventListener(Y.MOUSE_UP,(e=>{d.$setCursor("text"),e.screen&&(e.stopPropagation(),this.mouseUp(),d.$tools.reset())}))}mouseDown(e){let t=e.offsetX,r=e.offsetY;"stage-area"!==e.target.id&&(t+=e.target.offsetLeft,r+=e.target.offsetTop),this.pageX=e.pageX,this.pageY=e.pageY,this.offsetX=t,this.offsetY=r;const a=document.getElementById("draw-text");a.style.left=`${e.pageX}px`,a.style.top=`${e.pageY}px`,a.style.width="0px",a.style.height="0px",a.style.display="",a.style.border="1px dashed gray"}mouseMove(e){e.preventDefault();const t=e.pageX,r=e.pageY,a=document.getElementById("draw-text");this.pageX>t&&(this.offsetX=e.offsetX,a.style.left=`${t}px`),this.pageY>r&&(this.offsetY=e.offsetY,a.style.top=`${r}px`),a.style.width=`${Math.abs(t-this.pageX)}px`,a.style.height=`${Math.abs(r-this.pageY)}px`}mouseUp(){d.$timelineLayer.attachLayer();const e=document.getElementById("draw-text"),t=d.$currentWorkSpace();t.temporarilySaved();const r=(this.offsetX-d.$offsetLeft)/d.$zoomScale,a=(this.offsetY-d.$offsetTop)/d.$zoomScale,i=parseFloat(e.style.width)/d.$zoomScale,s=parseFloat(e.style.height)/d.$zoomScale,n=t.nextLibraryId;this.createTextField({id:n,type:b.TEXT,name:`Text_${n}`,symbol:"",bounds:{xMin:0,xMax:i,yMin:0,yMax:s},originBounds:{xMin:0,xMax:i,yMin:0,yMax:s}},r,a),this.reloadScreen(),e.style.display="none"}}class re extends H{constructor(){super("transform"),this._$element=null,this._$deletePointer=null}initialize(){this.setCursor('url(\'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 48 48"><path fill="white" d="M27.8,39.7c-0.1,0-0.2,0-0.4-0.1c-0.2-0.1-0.4-0.3-0.6-0.5l-3.7-8.6l-4.5,4.2C18.5,34.9,18.3,35,18,35c-0.1,0-0.3,0-0.4-0.1C17.3,34.8,17,34.4,17,34l0-22c0-0.4,0.2-0.8,0.6-0.9C17.7,11,17.9,11,18,11c0.2,0,0.5,0.1,0.7,0.3l16,15c0.3,0.3,0.4,0.7,0.3,1.1c-0.1,0.4-0.5,0.6-0.9,0.7l-6.3,0.6l3.9,8.5c0.1,0.2,0.1,0.5,0,0.8c-0.1,0.2-0.3,0.5-0.5,0.6l-2.9,1.3C28.1,39.7,27.9,39.7,27.8,39.7z"/><path fill="black" d="M18,12l16,15l-7.7,0.7l4.5,9.8l-2.9,1.3l-4.3-9.9L18,34L18,12 M18,10c-0.3,0-0.5,0.1-0.8,0.2c-0.7,0.3-1.2,1-1.2,1.8l0,22c0,0.8,0.5,1.5,1.2,1.8C17.5,36,17.8,36,18,36c0.5,0,1-0.2,1.4-0.5l3.4-3.2l3.1,7.3c0.2,0.5,0.6,0.9,1.1,1.1c0.2,0.1,0.5,0.1,0.7,0.1c0.3,0,0.5-0.1,0.8-0.2l2.9-1.3c0.5-0.2,0.9-0.6,1.1-1.1c0.2-0.5,0.2-1.1,0-1.5l-3.3-7.2l4.9-0.4c0.8-0.1,1.5-0.6,1.7-1.3c0.3-0.7,0.1-1.6-0.5-2.1l-16-15C19,10.2,18.5,10,18,10L18,10z"/></svg>\') 6 6,auto'),this.addEventListener(Y.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(),this._$deletePointer=this.deletePointer.bind(this),window.addEventListener("keydown",this._$deletePointer)})),this.addEventListener(Y.END,(()=>{window.removeEventListener("keydown",this._$deletePointer)})),this.addEventListener(Y.MOUSE_DOWN,(e=>{switch(d.$setCursor(this._$cursor),!0){case e.displayObject:this._$element=null,this.mouseDownForDisplayObject(e);break;case e.shapePointer:this.mouseDownForPointer(e);break;default:this._$element=null}})),this.addEventListener(Y.DBL_CLICK,(e=>{switch(d.$setCursor(this._$cursor),e.stopPropagation(),!0){case e.shapePointer:this.addCurvePointer(e);break;case e.screen:this.addPointer(e)}})),this.addEventListener(Y.MOUSE_UP,(e=>{d.$setCursor(this._$cursor),e.stopPropagation()})),this.addEventListener(Y.MOUSE_MOVE,(e=>{d.$setCursor(this._$cursor),this.active&&(e.stopPropagation(),this.movePointer(e))}))}addPointer(e){this.clearActivePointer();const t=d.$timelineFrame.currentFrame;let r=null,a=Number.MAX_VALUE;const i=document.getElementById("stage-area").children,s=d.$currentWorkSpace(),n=s.scene;let o=e.offsetX,l=e.offsetY;if("stage-area"!==e.target.id){const t=0|e.target.dataset.layerId,r=0|e.target.dataset.characterId,a=n.getLayer(t).getCharacter(r);o=a.screenX+d.$offsetLeft+e.offsetX,l=a.screenY+d.$offsetTop+e.offsetY}for(let e=0;e<i.length;++e){const t=i[e];if(!t.dataset.shapePointer)continue;if("true"===t.dataset.curve)continue;const s=Math.sqrt(Math.pow(t.offsetLeft-o,2)+Math.pow(t.offsetTop-l,2));a>s&&(r=t),a=Math.min(a,s)}if(!r)return;const c=s.getLibrary(0|r.dataset.libraryId);if(!c)return;const h=[],u=0|r.dataset.position;for(let e=u+1;e<i.length;++e){const t=i[e];if("true"!==t.dataset.curve){h.push(t);break}}if(!h.length)for(let e=0;e<i.length;++e){const t=i[e];if(t.dataset.shapePointer&&"true"!==t.dataset.curve){h.push(t);break}}for(let e=u-1;;--e){const t=i[e];if(!t.dataset.shapePointer)break;if("true"!==t.dataset.curve){h.push(t);break}}if(1===h.length)for(let e=i.length-1;;--e){const t=i[e];if(!t.dataset.shapePointer)break;if("true"!==t.dataset.curve){h.push(t);break}}let m=null;a=Number.MAX_VALUE;for(let e=0;e<h.length;++e){const t=h[e],r=Math.sqrt(Math.pow(t.offsetLeft-o,2)+Math.pow(t.offsetTop-l,2));a>r&&(m=t),a=Math.min(a,r)}const{Graphics:g}=window.next2d.display,p=0|r.dataset.layerId,$=0|r.dataset.characterId,f=n.getLayer(p).getCharacter($),y=f.getPlace(t).matrix,_=Math.sqrt(y[0]*y[0]+y[1]*y[1]),b=Math.sqrt(y[2]*y[2]+y[3]*y[3]),v=0|r.dataset.index,I=0|m.dataset.index;I>v?c._$recodes.splice(v+2,0,g.LINE_TO,(o-d.$offsetLeft-f.screenX+c._$bounds.xMin)/_,(l-d.$offsetTop-f.screenY+c._$bounds.yMin)/b):c._$recodes.splice(I+2,0,g.LINE_TO,(o-d.$offsetLeft-f.screenX+c._$bounds.xMin)/_,(l-d.$offsetTop-f.screenY+c._$bounds.yMin)/b);for(let e=0;e<i.length;++e){const t=i[e];t.dataset.shapePointer&&("true"!==t.dataset.curve&&(t.remove(),--e))}const E=c.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);if(c._$bounds.xMin=E.xMin,c._$bounds.xMax=E.xMax,c._$bounds.yMin=E.yMin,c._$bounds.yMax=E.yMax,c.cacheClear(),n.changeFrame(t),f){const e=f.getPlace(t).matrix;c.createPointer(e,p,$)}}addCurvePointer(e){this.clearActivePointer();const{Graphics:t}=window.next2d.display,r=d.$currentWorkSpace(),a=e.target;if(!("true"===a.dataset.curve)){const i=0|a.dataset.type,s=0|a.dataset.index,n=0|a.dataset.layerId,o=0|a.dataset.characterId,l=r.getLibrary(0|a.dataset.libraryId);switch(i){case t.LINE_TO:{r.temporarilySaved(),l._$recodes[s-1]=t.CURVE_TO;const a=l._$recodes[s],i=l._$recodes[s+1];l._$recodes.splice(s+2,0,a,i),l._$recodes[s]+=20,l._$recodes[s+1]+=20,l.cacheClear();const c=d.$timelineFrame.currentFrame;r.scene.changeFrame(c),l.createPointer(e.matrix,n,o)}break;case t.CURVE_TO:{r.temporarilySaved(),l._$recodes[s-3]=t.CUBIC;const a=l._$recodes[s],i=l._$recodes[s+1];l._$recodes.splice(s+2,0,a,i),l._$recodes[s]+=20,l._$recodes[s+1]+=20,l.cacheClear();const c=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(c),l.createPointer(e.matrix,n,o)}}}}clearActivePointer(){const{Graphics:e}=window.next2d.display,t=document.getElementById("stage-area"),r=this._$element;if(r){r.style.backgroundColor="";const a=0|r.dataset.position,i=0|r.dataset.type,s="true"===r.dataset.curve;switch(i){case e.CURVE_TO:s?t.children[a+1].style.backgroundColor="":t.children[a-1].style.backgroundColor="";break;case e.CUBIC:if(s)for(let e=1;e<3;++e){const r=t.children[a+e];if(r.style.backgroundColor="","true"!==r.dataset.curve){1===e&&(t.children[a-1].style.backgroundColor="");break}}else t.children[a-1].style.backgroundColor="",t.children[a-2].style.backgroundColor=""}}}mouseDownForPointer(e){d.$currentWorkSpace().temporarilySaved();const{Graphics:t}=window.next2d.display,r=document.getElementById("stage-area");this.clearActivePointer();const a=this.target;this._$element=a,this.pageX=e.pageX-a.offsetLeft,this.pageY=e.pageY-a.offsetTop;const i=this.target;i.style.backgroundColor=d.$shapePointerColor;const s=0|i.dataset.position,n=0|i.dataset.type,o="true"===i.dataset.curve;switch(n){case t.CURVE_TO:o?r.children[s+1].style.backgroundColor=d.$shapeLinkedPointerColor:r.children[s-1].style.backgroundColor=d.$shapeLinkedPointerColor;break;case t.CUBIC:if(o)for(let e=1;e<3;++e){const t=r.children[s+e];if(t.style.backgroundColor=d.$shapeLinkedPointerColor,"true"!==t.dataset.curve){1===e&&(r.children[s-1].style.backgroundColor=d.$shapeLinkedPointerColor);break}}else r.children[s-1].style.backgroundColor=d.$shapeLinkedPointerColor,r.children[s-2].style.backgroundColor=d.$shapeLinkedPointerColor}}mouseDownForDisplayObject(e){const t=this.target;if(t.dataset.instanceType!==b.SHAPE)return;d.$tools.getDefaultTool("arrow").clear();const r=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace(),i=0|t.dataset.layerId,s=0|t.dataset.characterId,n=a.scene.getLayer(i).getCharacter(s),o=a.getLibrary(0|t.dataset.libraryId),l=n.getPlace(r).matrix,c=d.$hitColor;o.setHitColor(e.offsetX,e.offsetY,l),d.$hitColor?o.createPointer(l,i,s):d.$hitColor=c}movePointer(e){const t=this.target;if("true"!==t.dataset.shapePointer)return;const r=d.$currentWorkSpace(),a=r.getLibrary(0|t.dataset.libraryId);if(!a)return void d.$clearShapePointer();e.preventDefault();const i=d.$timelineFrame.currentFrame,s=0|t.dataset.layerId,n=0|t.dataset.characterId,o=r.scene,l=o.getLayer(s).getCharacter(n).getPlace(i).matrix,c=e.pageX-this.pageX,h=e.pageY-this.pageY,u=Math.atan2(l[1],l[0])*d.$Rad2Deg,m=Math.sqrt(l[0]*l[0]+l[1]*l[1]),g=Math.sqrt(l[2]*l[2]+l[3]*l[3]);let p=(c-t.offsetLeft)/m,$=(h-t.offsetTop)/g;if(u){const e=(360-u)*(Math.PI/180);p*=Math.cos(e),$*=Math.sin(e)}const f=0|t.dataset.index;a._$recodes[f]+=p/d.$zoomScale,a._$recodes[f+1]+=$/d.$zoomScale;const y=0|t.dataset.syncId;y&&(a._$recodes[y]+=p/d.$zoomScale,a._$recodes[y+1]+=$/d.$zoomScale),t.style.left=`${c}px`,t.style.top=`${h}px`;const _=a.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);a._$bounds.xMin=_.xMin,a._$bounds.xMax=_.xMax,a._$bounds.yMin=_.yMin,a._$bounds.yMax=_.yMax,a.cacheClear(),o.changeFrame(i)}deletePointer(e){if(d.$setCursor(this._$cursor),d.$keyLock||"Backspace"!==e.key)return;e.stopPropagation();let t=0;const r=document.getElementById("stage-area").children;for(let e=0;r.length>e;++e){const a=r[e];a.dataset.shapePointer&&("false"===a.dataset.curve&&t++)}const a=this._$element;if(!a)return;const i="true"===a.dataset.curve;if(!a.dataset.syncId&&(t>2||i)){const e=d.$currentWorkSpace();e.temporarilySaved();const{Graphics:t}=window.next2d.display,r=e.getLibrary(0|a.dataset.libraryId),s=0|a.dataset.index;switch(0|a.dataset.type){case t.MOVE_TO:break;case t.LINE_TO:r._$recodes.splice(s-1,3);break;case t.CUBIC:{let e=s;for(;r._$recodes[--e]!==t.CUBIC;);i?(r._$recodes[e]=t.CURVE_TO,r._$recodes.splice(s,2)):r._$recodes.splice(e,7)}break;case t.CURVE_TO:{let e=s;for(;r._$recodes[--e]!==t.CURVE_TO;);i?(r._$recodes[e]=t.LINE_TO,r._$recodes.splice(s,2)):r._$recodes.splice(e,5)}}const n=r.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);r._$bounds.xMin=n.xMin,r._$bounds.xMax=n.xMax,r._$bounds.yMin=n.yMin,r._$bounds.yMax=n.yMax,r.cacheClear();const o=d.$timelineFrame.currentFrame,l=e.scene;l.changeFrame(o);const c=0|a.dataset.layerId,h=0|a.dataset.characterId,u=l.getLayer(c).getCharacter(h);if(u){const e=u.getPlace(o).matrix;r.createPointer(e,c,h)}}}}class ae extends H{constructor(){super("zoom")}initialize(){this.setCursor('url(\'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><path d="M13 10h-3v3h-2v-3h-3v-2h3v-3h2v3h3v2zm8.172 14l-7.387-7.387c-1.388.874-3.024 1.387-4.785 1.387-4.971 0-9-4.029-9-9s4.029-9 9-9 9 4.029 9 9c0 1.761-.514 3.398-1.387 4.785l7.387 7.387-2.828 2.828zm-12.172-8c3.859 0 7-3.14 7-7s-3.141-7-7-7-7 3.14-7 7 3.141 7 7 7z"/></svg>\') 6 6,auto'),this.addEventListener(Y.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(!1)})),this.addEventListener(Y.MOUSE_DOWN,(e=>{this.startRect(e)})),this.addEventListener(Y.MOUSE_MOVE,(e=>{this.moveRect(e)})),this.addEventListener(Y.MOUSE_UP,(e=>{this.execute(e)}))}startRect(e){this.active=!0,d.$setCursor(this._$cursor),this.pageX=e.pageX,this.pageY=e.pageY;const t=document.getElementById("stage-rect");t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,t.style.width="0px",t.style.height="0px",t.style.display=""}moveRect(e){if(d.$setCursor(this._$cursor),!this.active)return;const t=e.pageX,r=e.pageY,a=document.getElementById("stage-rect");this.pageX>t&&(a.style.left=`${t}px`),this.pageY>r&&(a.style.top=`${r}px`),a.style.width=`${Math.abs(t-this.pageX)}px`,a.style.height=`${Math.abs(r-this.pageY)}px`}execute(){this.active=!1,d.$setCursor(this._$cursor);const e=document.getElementById("stage-rect");e.style.display="none";const t=parseFloat(e.style.width),r=parseFloat(e.style.height);if(!t||!r)return;const a=d.$currentWorkSpace(),i=Math.max(a.stage.width/t,a.stage.height/r,d.$zoomScale);d.$zoomScale=0,d.$screenZoom.execute(i),d.$tools.activeTool&&d.$tools.activeTool.dispatchEvent(Y.END);const s=d.$tools.getDefaultTool("zoom");s.dispatchEvent(Y.START),d.$tools.activeTool=s}}class ie{constructor(e=""){this._$name=e,this._$saved=!1,this._$pointX=0,this._$pointY=0,this._$focus=!1,this._$currentValue=null,this._$currentTarget=null,this._$lockTarget=null,this._$mouseMove=null,this._$mouseUp=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){if(this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),this.name){const e=document.getElementById(`${this.name}-setting-title`);e&&e.addEventListener("mousedown",(()=>{this.clickTitle()}))}d.$initializeEnd()}focusIn(e){this._$focus=!0,this._$currentValue=+e.target.value,d.$keyLock=!0}focusOut(){this._$focus=!1,this._$currentValue=null,this._$currentTarget=null,this._$lockTarget=null,d.$keyLock=!1}mouseOut(e){e.stopPropagation(),!this._$focus&&this._$currentTarget||(d.$setCursor("auto"),e.target.style.cursor="")}mouseDown(e){this._$focus||(e.preventDefault(),this._$saved=!1,this._$pointX=e.screenX,this._$currentTarget=e.target,this._$currentValue=+e.target.value,d.$setCursor("ew-resize"),this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto"),this._$currentTarget&&(this._$currentTarget.style.cursor="",this._$currentTarget.focus())}mouseMove(e){!this._$focus&&this._$currentTarget&&window.requestAnimationFrame((()=>{if(this._$focus||!this._$currentTarget)return;e.preventDefault(),d.$setCursor("ew-resize");const t=e.screenX-this._$pointX;let r=+this._$currentTarget.value;isNaN(r)&&(r=0),this._$currentTarget.value=this.executeFunction(this._$currentTarget.id,r+t),this._$currentValue=+this._$currentTarget.value,this._$lockTarget&&(this._$lockTarget.value=this.executeFunction(this._$lockTarget.id,+this._$lockTarget.value+t)),this._$pointX=e.screenX,this.reloadScreen()}))}reloadScreen(){const e=d.$currentWorkSpace();if(!e)return;const t=e.scene;t&&t.changeFrame(d.$timelineFrame.currentFrame)}mouseOver(e){switch(e.stopPropagation(),!0){case this._$focus:case null!==this._$currentTarget:case null!==this._$currentValue:return;default:d.$setCursor("ew-resize"),e.target.style.cursor="ew-resize"}}clickTitle(){const e=document.getElementById(`${this.name}-setting-view-area`),t=document.getElementById(`${this.name}-setting-title`).getElementsByTagName("i")[0];"none"===e.style.display?(e.style.display="",t.setAttribute("class","active")):(e.style.display="none",t.setAttribute("class","disable"))}executeFunction(e,t){this.save();const r=e.split("-");let a=r.map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("");return`change${a}`in this||(r.pop(),a=r.map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")),this[`change${a}`](t)}finishInput(e,t=!0){if("Enter"!==e.key){if("focusout"===e.type){this._$currentTarget=e.target;const r=this.executeFunction(e.target.id,e.target.value);this._$lockTarget&&(this._$lockTarget.value=this.executeFunction(this._$lockTarget.id,+this._$lockTarget.value+r-this._$currentValue)),e.target.value=r,this._$currentValue=r,this.focusOut(),t&&this.reloadScreen()}}else e.currentTarget.blur()}save(){if(this._$saved)return;this._$saved=!0;const e=d.$currentWorkSpace();e&&e.temporarilySaved()}setChangeEvent(e){e&&e.addEventListener("change",(e=>{this._$currentTarget=e.target,this.executeFunction(e.target.id,e.target.value),this._$currentTarget=null,this.reloadScreen()}))}setInputEvent(e){e&&(e.addEventListener("mouseover",(e=>{this.mouseOver(e)})),e.addEventListener("mouseout",(e=>{this.mouseOut(e)})),e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})),e.addEventListener("focusout",(e=>{this.finishInput(e)})),e.addEventListener("keypress",(e=>{this.finishInput(e)})))}setClickEvent(e){e&&e.addEventListener("click",(e=>{this._$currentTarget=e.target,this.executeFunction(e.target.id,e.target.value),this._$currentTarget=null,this.reloadScreen()}))}get name(){return this._$name}}class se extends ie{constructor(e){super(e),this._$currentPointer=null,this._$drawGradientContext=null,this._$mouseMoveGradientColorPointer=null,this._$mouseUpGradientColorPointer=null}static get GRADIENT_CANVAS_WIDTH(){return 255}static get GRADIENT_CANVAS_HEIGHT(){return 30}static get MIN_GRADIENT_POINTER(){return 0}static get MAX_GRADIENT_POINTER(){return 255}initialize(){super.initialize();const e=document.createElement("canvas");e.width=se.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,e.height=se.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,this._$drawGradientContext=e.getContext("2d")}changeGradientColor(e){const t=0|this._$currentTarget.dataset.filterId;if(this._$filters.has(t)){if(this._$currentPointer){const r=this._$filters.get(t).filter,a=0|this._$currentPointer.dataset.index;r._$colors[a]=0|`0x${e.slice(1)}`,this._$currentPointer.dataset.color=e,this._$currentPointer.getElementsByTagName("i")[0].style.backgroundColor=e,this.updateFilterGradientCanvas(r),this.disposeCharacterImage(),this.reloadScreen()}return e}}changeGradientAlpha(e){const t=0|this._$currentTarget.dataset.filterId;if(this._$filters.has(t)){if(e=d.$clamp(+e,fe.MIN_ALPHA,fe.MAX_ALPHA),this._$currentPointer){const r=this._$filters.get(t).filter,a=0|this._$currentPointer.dataset.index;r._$alphas[a]=e,this._$currentPointer.dataset.alpha=e,this.updateFilterGradientCanvas(r),this.disposeCharacterImage(),this.reloadScreen()}return e}}addGradientBevelFilter(e,t=null,r=!0){const a=this.createFilter(B,t);t||(t=this._$filters.get(a).filter);const i=this.getFilterHeaderHTML(a,"GradientBevel")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${a}" value="${t.blurX}" data-name="blurX" data-filter-id="${a}" data-detail="水平方向にぼかす"></div>\n                                \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${a}" value="${t.strength}" data-filter-id="${a}" data-name="strength" data-detail="フィルター強度"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${a}" value="${t.blurY}" data-name="blurY" data-filter-id="${a}" data-detail="{{垂直方向にぼかす}}"></div>\n                \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${a}" value="${t.angle}" data-filter-id="${a}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${a}" value="${t.distance}" data-filter-id="${a}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div id="gradient-color-palette-${a}" class="gradient-color-palette">\n                    <div id="color-palette-${a}" class="color-palette">\n                        <canvas id="gradient-canvas-${a}"></canvas>\n                    </div>\n                    <div id="color-pointer-list-${a}" data-filter-id="${a}" class="color-pointer-list" data-detail="{{カラーポインターを追加}}"></div>\n                </div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Color</div>\n                <div><input type="color" id="gradientColor-${a}" value="#000000" data-detail="{{グラデーションカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="gradientAlpha-${a}" value="100" data-name="gradientAlpha" data-detail="{{グラデーションのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${a}" data-name="knockout" data-filter-id="${a}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${a}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Type</div>\n                <div>\n                    <select id="type-${a}" data-name="type" data-filter-id="${a}">\n                        <option value="inner">Inner</option>\n                        <option value="outer">Outer</option>\n                        <option value="full">Full</option>\n                    </select>\n                </div>\n    \n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${a}" data-name="quality" data-filter-id="${a}">\n                        <option value="1">Low</option>\n                        <option value="2">Middel</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",i);const s=document.getElementById(`gradient-canvas-${a}`);s.width=se.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,s.height=se.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,s.style.transform=`scale(${1/window.devicePixelRatio}, ${1/window.devicePixelRatio})`,s.style.backfaceVisibility="hidden",s.style.transformOrigin="0 0",t.context=s.getContext("2d"),this.setCommonEvent(a),t.knockout&&(document.getElementById(`knockout-${a}`).checked=!0);const n=[`blurX-${a}`,`blurY-${a}`,`strength-${a}`,`angle-${a}`,`gradientAlpha-${a}`,`distance-${a}`];for(let e=0;e<n.length;++e)this.setInputEvent(document.getElementById(n[e]));const o=[`knockout-${a}`];for(let e=0;e<o.length;++e)this.setClickEvent(document.getElementById(o[e]));const l=[`gradientColor-${a}`,`type-${a}`,`quality-${a}`];for(let e=0;e<l.length;++e)this.setChangeEvent(document.getElementById(l[e]));for(let e=0;e<t.ratios.length;++e){const r=t.ratios[e],i=`#${t.colors[e].toString(16).padStart(6,"0")}`,s=t.alphas[e];this.addFilterGradientColorPointer(a,e,r,i,s)}this.setCreateGradientColorPointerEvent(a),this.updateFilterGradientCanvas(t),r&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}addGradientColorPointer(e){const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;const r=this._$filters.get(t).filter,a=r.ratios.length,i=e.offsetX,s=document.getElementById(`gradientColor-${t}`).value,n=0|document.getElementById(`gradientAlpha-${t}`).value;r.ratios.push(i),r.colors.push(0|`0x${s.slice(1)}`),r.alphas.push(n),this.addFilterGradientColorPointer(t,a,i,s,n),this.updateFilterGradientCanvas(r),this.disposeCharacterImage(),this.reloadScreen()}setCreateGradientColorPointerEvent(e){const t=document.getElementById(`color-pointer-list-${e}`);t&&t.addEventListener("mousedown",(e=>{this.addGradientColorPointer(e)}))}updateFilterGradientCanvas(e){const t=this._$drawGradientContext;t.clearRect(0,0,se.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,se.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio);const r=e.adjustment();t.beginPath();const a=r.ratios.length,i=Math.ceil(255*r.ratios[a-1]*window.devicePixelRatio),s=t.createLinearGradient(0,0,i,0);for(let e=0;e<a;++e){const t=d.$intToRGB(r.colors[e]);s.addColorStop(r.ratios[e],`rgba(${t.R}, ${t.G}, ${t.B}, ${r.alphas[e]})`)}t.fillStyle=s,t.rect(0,0,se.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,se.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),t.fill(),e.context.clearRect(0,0,se.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,se.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.context.drawImage(t.canvas,0,0)}addFilterGradientColorPointer(e,t,r,a,i){const s=document.getElementById(`color-pointer-list-${e}`),n=`\n<div class="color-pointer" style="left: ${r-4}px;" data-filter-id="${e}" data-index="${t}" data-color="${a}" data-alpha="${i}">\n    <div class="color-pointer-triangle"></div>\n    <div class="color-pointer-rect">\n        <i class="pointer-color" style="background-color: ${a}"></i>\n    </div>\n</div>\n`;s.insertAdjacentHTML("beforeend",n);const o=s.lastElementChild;o.addEventListener("mousedown",(e=>{this.mouseDownGradientColorPointer(e)})),t&&o.addEventListener("dblclick",(e=>{this.removeGradientColorPointer(e)})),this._$currentPointer=o}removeGradientColorPointer(e){const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;const r=document.getElementById(`color-pointer-list-${t}`);if(2>=r.children.length)return;const a=0|e.target.dataset.index,i=this._$filters.get(t).filter;i.ratios.splice(a,1),i.colors.splice(a,1),i.alphas.splice(a,1),e.target.remove();for(let e=a;e<r.children.length;++e){const t=r.children[e],a=(0|t.dataset.index)-1;t.dataset.index=`${a}`}super.focusOut(),this.updateFilterGradientCanvas(i),this.disposeCharacterImage(),this.reloadScreen()}mouseDownGradientColorPointer(e){e.stopPropagation(),this._$saved=!1,this._$pointX=e.screenX,this._$currentTarget=e.target,this._$currentPointer=e.target;const t=e.target.dataset.filterId;document.getElementById(`gradientColor-${t}`).value=e.target.dataset.color,document.getElementById(`gradientAlpha-${t}`).value=e.target.dataset.alpha,this._$mouseMoveGradientColorPointer||(this._$mouseMoveGradientColorPointer=this.mouseMoveGradientColorPointer.bind(this)),this._$mouseUpGradientColorPointer||(this._$mouseUpGradientColorPointer=this.mouseUpGradientColorPointer.bind(this)),window.addEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.addEventListener("mouseup",this._$mouseUpGradientColorPointer)}mouseMoveGradientColorPointer(e){const t=this._$currentTarget;if(!t)return;const r=0|t.dataset.index;r&&window.requestAnimationFrame((()=>{e.preventDefault();const a=0|t.dataset.filterId;if(!this._$filters.has(a))return;const i=parseFloat(t.style.left),s=d.$clamp(i+(e.screenX-this._$pointX)+4,se.MIN_GRADIENT_POINTER,se.MAX_GRADIENT_POINTER);t.style.left=s-4+"px";const n=this._$filters.get(a).filter;n._$ratios[r]=s,this._$pointX&&(this._$pointX=e.screenX),this.updateFilterGradientCanvas(n),this.disposeCharacterImage(),this.reloadScreen()}))}mouseUpGradientColorPointer(){window.removeEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.removeEventListener("mouseup",this._$mouseUpGradientColorPointer),d.$setCursor("auto"),super.focusOut()}}d.$view=new class{constructor(){this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("view");e&&e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),d.$initializeEnd()}mouseDown(e){e.button||d.$endMenu()}};class ne extends N{constructor(){super(),this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),d.$initializeEnd()}reloadScreen(){const e=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(e)}executeFunction(e){this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}}class oe extends ne{constructor(){super(),this._$editor=null,this._$active=!1,this._$frame=-1,this._$scene=null,this._$screenX=0,this._$screenY=0,this._$mouseMove=null,this._$mouseUp=null}static get SCRIPT_MODAL_WIDTH(){return 620}static get SCRIPT_MODAL_HEIGHT(){return 450}static get SCRIPT_MODAL_BAR_HEIGHT(){return 25}get active(){return this._$active}initialize(){super.initialize(),this.createEditor();const e=["editor-hide-icon","editor-bar"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),d.$endMenu("editor-modal"),this.executeFunction(e)}))}document.documentElement.style.setProperty("--script-modal-width",`${oe.SCRIPT_MODAL_WIDTH}px`),document.documentElement.style.setProperty("--script-modal-height",`${oe.SCRIPT_MODAL_HEIGHT}px`),document.documentElement.style.setProperty("--script-modal-bar-height",`${oe.SCRIPT_MODAL_BAR_HEIGHT}px`)}createEditor(){if(!("ace"in window))return;this._$editor=ace.edit("editor"),this._$editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this._$editor.setTheme("ace/theme/monokai"),this._$editor.session.setMode("ace/mode/javascript");const e=[{word:"next2d",meta:"window.next2d"},{word:"toString",value:"toString()",meta:"common method"},{word:"namespace",meta:"common property"}],t=Object.keys(window.next2d);for(let r=1;r<t.length;++r){const a=t[r];e.push({word:`next2d.${a}`,meta:`next2d.${a}`});const i=Object.keys(window.next2d[a]);for(let t=0;t<i.length;++t){const r=i[t];e.push({word:r,meta:`next2d.${a}.${r}`});const s=window.next2d[a][r],n=Object.getOwnPropertyDescriptors(s),o=Object.getOwnPropertyNames(s);for(let t=0;t<o.length;++t){const a=o[t];switch(a){case"length":case"prototype":case"toString":case"namespace":case"name":continue}const i=n[a];if("value"in i){const t=i.value.toString().replace(/ |\n/g,"").split("{")[0].split("(")[1];e.push({word:a,value:`${a}()`,meta:`${r}.${a}(${t}`})}else e.push({word:a,meta:`${r}.${a}`})}const l=Object.getOwnPropertyDescriptors(s.prototype),c=Object.getOwnPropertyNames(s.prototype);for(let t=0;t<c.length;++t){const a=c[t];switch(a){case"constructor":case"toString":case"namespace":case"name":continue}if(a.indexOf("_$")>-1)continue;const i=l[a];if("value"in i){const t=i.value.toString().replace(/ |\n/g,"").split("{")[0].split("(")[1];e.push({word:a,value:`${a}()`,meta:`${r}.${a}(${t}`})}else e.push({word:a,meta:`${r}.${a}`})}}}ace.require("ace/ext/language_tools").addCompleter({getCompletions:(t,r,a,i,s)=>{s(null,e.map((e=>({caption:e.word,value:e.value||e.word,meta:e.meta,score:0}))))}});const r=new ResizeObserver((e=>{e.forEach((e=>{const t=e.target,r=parseFloat(document.documentElement.style.getPropertyValue("--script-modal-width")),a=parseFloat(document.documentElement.style.getPropertyValue("--script-modal-height"));r!==t.clientWidth&&document.documentElement.style.setProperty("--script-modal-width",`${t.clientWidth}px`),a!==t.clientHeight&&document.documentElement.style.setProperty("--script-modal-height",`${t.clientHeight+oe.SCRIPT_MODAL_BAR_HEIGHT}px`)})),this._$editor.resize()})),a=document.getElementById("editor-modal");a&&r.observe(a)}executeTimelineScriptAdd(e){this.show(e)}executeContextMenuScriptAdd(e){this.show(e)}executeEditorHideIcon(){this.hide()}executeEditorBar(e){this._$screenX=e.screenX,this._$screenY=e.screenY,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){window.requestAnimationFrame((()=>{const t=document.getElementById("editor-modal");t.style.left=`${parseFloat(t.style.left)+(e.screenX-this._$screenX)}px`,t.style.top=`${parseFloat(t.style.top)+(e.screenY-this._$screenY)}px`,this._$screenX=e.screenX,this._$screenY=e.screenY}))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto")}show(e=null,t=0,r=null){d.$keyLock=!0,this._$active=!0,this._$frame=t||d.$timelineFrame.currentFrame,this._$editor.setValue("",-1),(r=r||d.$currentWorkSpace().scene).hasAction(this._$frame)&&this._$editor.setValue(r.getAction(this._$frame),-1),document.getElementById("editor-title").textContent=`${r.name} / frame[${this._$frame}]`;const a=document.getElementById("editor-modal");e&&(a.style.display="",a.style.left=`${e.pageX+5}px`,a.style.top=e.pageY-a.clientHeight/2+"px"),isNaN(parseFloat(a.style.left))&&(a.style.left="200px",a.style.top=300-a.clientHeight/2+"px"),a.setAttribute("class","fadeIn"),d.$endMenu("editor-modal"),this._$editor.focus()}hide(){this.save(),this._$editor.setValue("",0),this._$frame=-1,this._$scene=null,this._$active=!1,d.$keyLock=!1,d.$endMenu()}save(){if(-1===this._$frame)return;const e=d.$timelineHeader.leftFrame;if(e>this._$frame)return;const t=this._$frame-e,r=document.getElementById("timeline-header").children[t].children[ce.ACTION_INDEX],a=this._$editor.getValue(0),i=this._$scene||d.$currentWorkSpace().scene;a?(i.setAction(this._$frame,a.trim()),this._$scene||r.classList.contains("frame-border-box-action")||r.setAttribute("class","frame-border-box-action")):(i.deleteAction(this._$frame),this._$scene||r.setAttribute("class","frame-border-box"))}}d.$javaScriptEditor=new oe;class le extends ne{constructor(){super(),this._$pointY=0,this._$mouseMove=null,this._$mouseUp=null}static get TIMELINE_DEFAULT_SIZE(){return 280}static get TIMELINE_MIN_SIZE(){return 150}initialize(){super.initialize(),document.documentElement.style.setProperty("--timeline-height",`${le.TIMELINE_DEFAULT_SIZE}px`);const e=document.getElementById("timeline-adjustment");e&&e.addEventListener("mousedown",(e=>{this.mouseDown(e)}))}mouseDown(e){e.preventDefault(),this._$pointY=e.screenY,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){d.$setCursor("row-resize"),window.requestAnimationFrame((()=>{const t=this._$pointY-e.screenY,r=0|document.documentElement.style.getPropertyValue("--timeline-height").split("px")[0],a=Math.max(le.TIMELINE_MIN_SIZE,r+t);document.documentElement.style.setProperty("--timeline-height",`${a}px`),d.$currentWorkSpace()._$timelineHeight=a,this._$pointY=e.screenY,d.$timelineLayer.updateClientHeight()}))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$timelineLayer.moveTimeLine(),d.$setCursor("auto"),d.$timelineLayer.updateClientHeight()}}d.$timelineAdjustment=new le;d.$timelineFrame=new class extends ne{constructor(){super(),this._$pointX=0,this._$currentValue=null,this._$currentTarget=null,this._$mouseMove=null,this._$mouseUp=null}get currentFrame(){const e=document.getElementById("current-frame");return e?0|e.value:1}set currentFrame(e){const t=document.getElementById("current-frame");t&&(t.value=""+(0|Math.max(1,e)))}initialize(){super.initialize();const e=document.getElementById("current-frame");e&&(e.addEventListener("mouseover",(e=>{this.mouseOver(e)})),e.addEventListener("mouseout",(e=>{this.mouseOut(e)})),e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})),e.addEventListener("focusout",(e=>{this.finishInput(e)})),e.addEventListener("keypress",(e=>{this.finishInput(e)})))}focusIn(e){super.focusIn(),this._$currentValue=+e.target.value,this._$currentTarget=e.target}focusOut(){super.focusOut(),this._$currentValue=null,this._$currentTarget=null}mouseOver(e){switch(e.stopPropagation(),!0){case this._$focus:case null!==this._$currentTarget:case null!==this._$currentValue:return;default:d.$setCursor("ew-resize"),e.target.style.cursor="ew-resize"}}mouseOut(e){e.stopPropagation(),!this._$focus&&this._$currentTarget||(d.$setCursor("auto"),e.target.style.cursor="")}mouseDown(e){this._$focus||(e.preventDefault(),this._$pointX=e.screenX,this._$currentTarget=e.target,this._$currentValue=+e.target.value,d.$setCursor("ew-resize"),this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),d.$timelineLayer.clear(),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto"),this._$currentTarget&&(this._$currentTarget.style.cursor="",this._$currentTarget.focus())}mouseMove(e){!this._$focus&&this._$currentTarget&&window.requestAnimationFrame((()=>{if(this._$focus||!this._$currentTarget)return;e.preventDefault(),d.$setCursor("ew-resize");const t=e.screenX-this._$pointX;let r=+this._$currentTarget.value;isNaN(r)&&(r=1);const a=Math.max(1,r+t);this._$currentTarget.value=`${a}`,this._$currentValue=a,this._$pointX=e.screenX,this.moveTimeline(),this.reloadScreen()}))}finishInput(e){"Enter"!==e.key?"focusout"===e.type&&(e.target.value=`${Math.max(1,0|e.target.value)}`,this.moveTimeline(),this.focusOut(),this.reloadScreen()):e.currentTarget.blur()}moveTimeline(){const e=document.getElementById("timeline-controller-base");if(!e)return;const t=d.$timelineTool.timelineWidth,r=d.$timelineFrame.currentFrame,a=(r-(d.$timelineHeader.scrollX/t|0))*(t+1);(0>=a||a>e.clientWidth)&&(d.$timelineHeader.scrollX=(r-1)*t),d.$timelineHeader.rebuild(),d.$timelineMarker.move(),d.$timelineLayer.moveTimeLine()}};class ce extends ne{constructor(){super(),this._$width=0,this._$scrollX=0,this._$targetElement=null,this._$deleteIcon=null}static get MARKER_INDEX(){return 1}static get ACTION_INDEX(){return 2}static get SOUND_INDEX(){return 3}get width(){return this._$width}get scrollX(){return this._$scrollX}get leftFrame(){return d.$timelineTool.timelineWidth||(d.$timelineTool.timelineWidth=d.$timelineTool.DEFAULT_TIMELINE_WIDTH),1+this._$scrollX/d.$timelineTool.timelineWidth|0}set scrollX(e){this._$scrollX=0|Math.max(e,0)}initialize(){super.initialize(),this._$deleteIcon||(this._$deleteIcon=this.deleteIcon.bind(this));const e=document.getElementById("timeline-controller-base");e&&(e.addEventListener("wheel",(e=>{if(e.stopPropagation(),e.preventDefault(),d.$altKey){const t=0|e.deltaY;if(!t)return!1;window.requestAnimationFrame((()=>{d.$timelineTool.timelineWidth=d.$clamp(d.$timelineTool.timelineWidth+t,5,240)}))}else{const t=0|(e.deltaX||e.deltaY);if(!t)return!1;if(!this._$scrollX&&0>t)return!1;if(this._$scrollX>=Number.MAX_VALUE)return!1;window.requestAnimationFrame((()=>{this._$scrollX=d.$clamp(this._$scrollX+t,0,Number.MAX_VALUE),this.rebuild(),d.$timelineMarker.move(),d.$timelineLayer.moveTimeLine()}))}}),{passive:!1}),e.addEventListener("mouseleave",(()=>{this.clearParams(),window.removeEventListener("keydown",this._$deleteIcon)})),e.addEventListener("mouseover",(()=>{window.addEventListener("keydown",this._$deleteIcon)})))}setWidth(){const e=document.getElementById("timeline-controller-base");e&&(this._$width=0|e.clientWidth)}rebuild(){const e=document.getElementById("timeline-header");if(!e)return;d.$timelineTool.timelineWidth||(d.$timelineTool.timelineWidth=d.$timelineTool.DEFAULT_TIMELINE_WIDTH);const t=d.$timelineTool.timelineWidth,r=this.width/(t+1)|0;if(!e.children.length)for(let t=0;r>=t;++t)this.createElement(e,t+1);if(e.children.length+1>r){const t=r+1;for(;e.children.length>t;)e.children[t].remove()}if(r>e.children.length){let t=0|e.lastElementChild.dataset.frame;const a=r-e.children.length;for(let r=1;a>=r;++r)this.createElement(e,t++)}const a=0|document.getElementById("stage-fps").value;let i=this.leftFrame,s=Math.max(1,1+(i/24|0));const n=d.$currentWorkSpace().scene,o=e.children,l=o.length;for(let e=0;l>e;++e){const t=i+e,r=o[e];(0|r.dataset.frame)!==t&&r.setAttribute("data-frame",`${t}`);const l=r.children,c=l.length;for(let e=0;c>e;++e){const r=l[e];switch((0|r.dataset.frame)!==t&&r.setAttribute("data-frame",`${t}`),e){case 0:if(t%5==0?r.classList.contains("frame-border-end")||r.setAttribute("class","frame-border-end"):r.classList.contains("frame-border")||r.setAttribute("class","frame-border"),t%a==0&&a>4){const e=s+++"s";r.innerHTML&&r.innerHTML===e||(r.innerHTML=e)}else r.innerHTML&&(r.innerHTML="");break;case ce.MARKER_INDEX:n.hasLabel(t)?r.classList.contains("frame-border-box-marker")||r.setAttribute("class","frame-border-box-marker"):r.classList.contains("frame-border-box")||r.setAttribute("class","frame-border-box");break;case ce.ACTION_INDEX:n.hasAction(t)?r.classList.contains("frame-border-box-action")||r.setAttribute("class","frame-border-box-action"):r.classList.contains("frame-border-box")||r.setAttribute("class","frame-border-box");break;case ce.SOUND_INDEX:n.hasSound(t)?r.classList.contains("frame-border-box-sound")||r.setAttribute("class","frame-border-box-sound"):r.classList.contains("frame-border-box")||r.setAttribute("class","frame-border-box");break;case 4:if(t%5==0){const e=`${t}`;r.innerHTML&&r.innerHTML===e||(r.innerHTML=e)}else r.innerHTML&&(r.innerHTML="")}}}}createElement(e,t=1){const r=`\n<div class="frame-header-parent" data-frame="${t}">\n    <div class="frame-sec ${t%5==0?"frame-border-end":"frame-border"}" data-frame="${t}"></div>\n    <div class="frame-border-box" data-type="marker" data-frame="${t}"></div>\n    <div class="frame-border-box" data-type="action" data-frame="${t}"></div>\n    <div class="frame-border-box" data-type="sound" data-frame="${t}"></div>\n    <div class="frame-number" data-frame="${t}">${t%5==0?t:""}</div>\n</div>\n`;e.insertAdjacentHTML("beforeend",r);const a=e.lastElementChild;a.addEventListener("mousedown",(e=>{e.button||this.moveMarker(e)}));for(let e=0;e<3;++e){const t=a.children[1+e];t&&(t.addEventListener("mousedown",(e=>{this.dragIcon(e)})),t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(e=>{this.dropIcon(e)})))}}clearParams(){this._$targetElement=null}dragIcon(e){const t=e.target;t.classList.contains("frame-border-box")||(e.stopPropagation(),t.draggable=!0,this._$targetElement=t)}deleteIcon(e){if(d.$keyLock)return;if("Backspace"!==e.key)return;if(!this._$targetElement)return;this.save();const t=0|this._$targetElement.dataset.frame,r=d.$currentWorkSpace().scene;switch(this._$targetElement.dataset.type){case"marker":r.deleteLabel(t);break;case"action":r.deleteAction(t);break;case"sound":r.deleteSound(t)}this._$targetElement.setAttribute("class","frame-border-box"),this._$targetElement=null,super.focusOut()}dropIcon(e){if(!this._$targetElement)return;e.preventDefault(),this._$targetElement.draggable=!1;const t=e.target,r=0|this._$targetElement.dataset.frame,a=0|t.dataset.frame;if(r!==a){this.save();const e=d.$currentWorkSpace().scene,i=this._$targetElement.dataset.type;let s=null;const n=t.parentElement;switch(i){case"marker":s=n.children[1],e.setLabel(a,e.getLabel(r));break;case"action":s=n.children[2],e.setAction(a,e.getAction(r));break;case"sound":s=n.children[3],e.setSound(a,e.getSound(r))}d.$altKey||this.deleteIcon({key:"Backspace"}),s&&(this._$targetElement=s,s.setAttribute("class",`frame-border-box-${i}`))}super.focusOut()}moveMarker(e){e.stopPropagation(),this.clearParams(),d.$timelineFrame.currentFrame=0|e.target.dataset.frame,d.$timelineMarker.move(),d.$soundController.createSoundElements(),d.$timelineMarker.startMarker(),this.reloadScreen()}}d.$timelineHeader=new ce;class de{static get color(){const e=["#ef857d","#ffedab","#a3d6cc","#8d93c8","#e3acae","#ea5550","#00947a","#4d4398","#915da3","#ed6d35","#bd6856","#72640c","#98605e","#6c3524","#f8f4e6","#6a1917","#7f1184","#00afcc","#e3e548","#af0082","#0073a8","#e4007f"];return e[Math.random()*e.length|0]}}d.$timelineKeyboardCommand=new class extends R{constructor(){super("timeline")}initialize(){super.initialize();const e=document.getElementById("timeline");e&&(e.addEventListener("mouseleave",(()=>{this.active=!1})),e.addEventListener("mouseover",(()=>{this.active||(this.active=!0)}))),this.add(d.$generateShortcutKey("+",{ctrl:!0}),this.addLayer),this.add(d.$generateShortcutKey(";",{ctrl:!0}),this.addLayer),this.add(d.$generateShortcutKey("Backspace",{ctrl:!0}),this.deleteLayer),this.add("Backspace",this.removeFrameCharacter),this.add("ArrowDown",this.selectLayer),this.add("ArrowUp",this.selectLayer),this.add("ArrowLeft",this.moveFrame),this.add("ArrowRight",this.moveFrame),this.add("f",this.addFrame),this.add(d.$generateShortcutKey("f",{ctrl:!0}),this.deleteFrame),this.add("k",this.addKeyFrame),this.add(d.$generateShortcutKey("k",{ctrl:!0}),this.deleteKeyFrame),this.add("l",this.focusLabel),this.add("e",this.addEmptyKey),this.add("s",this.openScriptModal),this.add("v",this.activePropertyTab),this.add("z",this.focusZoom),this.add("p",d.$timelineTool.executeTimelinePreview),this.add("o",(()=>{d.$timelineTool.executeTimelineOnionSkin()})),this.add("m",(()=>{d.$timelineMenu.executeContextMenuTweenAdd()})),this.add(d.$generateShortcutKey("m",{ctrl:!0}),(()=>{d.$timelineMenu.executeContextMenuTweenDelete()})),this.add(d.$generateShortcutKey("h",{shift:!0}),(()=>{d.$timelineTool.executeTimelineLayerLightAll()})),this.add(d.$generateShortcutKey("l",{shift:!0}),(()=>{d.$timelineTool.executeTimelineLayerLockAll()})),this.add(d.$generateShortcutKey("d",{shift:!0}),(()=>{d.$timelineTool.executeTimelineLayerDisableAll()})),this.add(d.$generateShortcutKey("n",{shift:!0}),(()=>{d.$timelineLayerMenu.executeTimelineLayerNormal()})),this.add(d.$generateShortcutKey("m",{shift:!0}),(()=>{d.$timelineLayerMenu.executeTimelineLayerMask()})),this.add(d.$generateShortcutKey("g",{shift:!0}),(()=>{d.$timelineLayerMenu.executeTimelineLayerGuide()}))}activePropertyTab(){document.getElementById("controller-tab-area").children[0].click()}openScriptModal(){d.$javaScriptEditor.show()}focusZoom(){document.getElementById("timeline-scale").focus()}focusLabel(){document.getElementById("label-name").focus()}deleteFrame(){d.$timelineTool.executeTimelineFrameDelete()}addFrame(){d.$timelineTool.executeTimelineFrameAdd()}moveFrame(e){const t=d.$timelineLayer.targetLayer;if(!t)return;const r=e?"ArrowRight"===e?1:-1:0,a=Math.max(1,d.$timelineFrame.currentFrame+r);d.$tools.getDefaultTool("arrow").clear(),d.$timelineLayer.changeLabel(a),d.$timelineLayer.moveFrame(a),d.$timelineLayer.activeLayer(t)}selectLayer(e){let t=null;const r=document.getElementById("timeline-content"),a=d.$timelineLayer.targetLayer;if(a)if("ArrowDown"===e){if(t=a.nextElementSibling,!t)return;t.offsetTop+t.offsetHeight>window.innerHeight&&d.$timelineScroll.execute(he.LAYER_HEIGHT)}else{if(t=a.previousElementSibling,!t)return;r.offsetTop>t.offsetTop&&d.$timelineScroll.execute(-he.LAYER_HEIGHT)}else"ArrowDown"===e?(t=r.firstElementChild,d.$timelineScroll.execute(-d.$timelineScroll.y)):(t=r.lastElementChild,d.$timelineScroll.execute(d.$timelineLayer.clientHeight));d.$timelineLayer.activeLayer(t)}deleteLayer(){d.$timelineTool.executeTimelineLayerTrash()}removeFrameCharacter(){d.$timelineLayer.removeFrame()}addLayer(){d.$timelineTool.executeTimelineLayerAdd()}addEmptyKey(){d.$timelineTool.executeTimelineEmptyAdd()}addKeyFrame(){d.$timelineTool.executeTimelineKeyAdd()}deleteKeyFrame(){d.$timelineTool.executeTimelineKeyDelete()}};class he extends ne{constructor(){super(),this._$targetFrames=new Map,this._$activeKeyEvent=!1,this._$targetLayers=new Map,this._$clientX=0,this._$clientY=0,this._$clientHeight=0,this._$scrollIndex=0,this._$moveLayerId=-1,this._$selectLayerId=-1,this._$destLayer=null,this._$timerId=-1,this._$exitLayer=null,this._$executeMoveLayer=null,this._$moveLayer=null,this._$endInput=null,this._$moveTargetGroup=null,this._$endTargetGroup=null,this._$multiSelect=null,this._$endMultiSelect=null}static get LAYER_HEIGHT(){return 31}get clientHeight(){return this._$clientHeight}set clientHeight(e){this._$clientHeight=0|e,d.$timelineScroll.updateHeight()}get targetFrames(){return this._$targetFrames}get targetFrame(){return this.targetFrames.size?this.targetFrames.values().next().value[0]:null}get targetLayers(){return this._$targetLayers}get targetLayer(){return this.targetLayers.size?this.targetLayers.values().next().value:null}set targetLayer(e){switch(!0){case d.$ctrlKey:e&&(this.targetLayers.has(e.id)?(e.classList.remove("active"),this.targetLayers.delete(e.id)):(e.classList.add("active"),this.targetLayers.set(e.id,e)));break;case d.$shiftKey:if(e){const t=this.targetLayer;if(!t||t.id===e.id)return;this.clearActiveLayers(),this.clearActiveFrames();const r=Array.from(document.getElementById("timeline-content").children),a=r.indexOf(t),i=r.indexOf(e),s=Math.min(a,i),n=Math.max(a,i);this.targetLayers.set(t.id,t);for(let e=s;e<=n;++e){const t=r[e];t.classList.add("active"),this.targetLayers.has(t.id)||this.targetLayers.set(t.id,t)}}break;default:this.clearActiveLayers(),this.clearActiveFrames(),e&&(e.classList.add("active"),this.targetLayers.set(e.id,e))}}addTargetFrame(e,t){this.targetFrames.has(e.id)||this.targetFrames.set(e.id,[]);this.targetFrames.get(e.id).push(t);const r=e.getChildren(t);r&&r.classList.add("frame-active")}initialize(){super.initialize();const e=document.getElementById("timeline");e&&e.addEventListener("mouseover",(()=>{d.$setCursor("auto")}));const t=document.getElementById("timeline-content");t&&t.addEventListener("wheel",(e=>{const t=0|e.deltaY;if(!t)return!1;e.stopPropagation(),e.preventDefault(),d.$altKey?window.requestAnimationFrame((()=>{d.$timelineTool.timelineWidth=d.$clamp(d.$timelineTool.timelineWidth+t,5,240)})):window.requestAnimationFrame((()=>{d.$timelineScroll.execute(t)}))}),{passive:!1}),this.hideTargetGroup()}updateClientHeight(){const e=document.getElementById("timeline-content");e&&this.clientHeight!==e.clientHeight&&(this.clientHeight=e.clientHeight,d.$timelineScroll.execute())}updateScrollY(e=0){const t=d.$currentWorkSpace();if(!t)return;const r=t.scene;if(!r)return;const a=r._$layers.size*he.LAYER_HEIGHT,i=this.scrollY;if(this.clientHeight>a)this.scrollY=0;else{const t=this.clientHeight/he.LAYER_HEIGHT|0;this.scrollY=Math.max(0,Math.min(this.scrollY+e,(r._$layers.size-t)*he.LAYER_HEIGHT))}i!==this.scrollY&&this.moveTimeLine()}activeCharacter(){if(!this.targetLayers.size)return;const e=d.$tools.getDefaultTool("arrow");e.clearActiveElement(),d.$transformController.hide(),d.$gridController.hide();const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene,a=d.$shiftKey;d.$shiftKey=!0;for(const a of this.targetFrames.keys()){const i=r.getLayer(a).getActiveCharacter(t);for(let t=0;t<i.length;++t){const r=i[t],a=document.getElementById(`character-${r.id}`);a&&e.addElement(a,!0)}}d.$shiftKey=a,d.$controller.default(),e.activeElements.length?(e.updateControllerProperty(),d.$transformController.show().relocation(),d.$gridController.show().relocation()):d.$tweenController.clearPointer()}clear(){this.clearActiveLayers(),this.clearActiveFrames()}removeAll(){const e=document.getElementById("timeline-content");if(e)for(;e.firstChild;)e.firstChild.remove()}create(e){if(!d.$currentWorkSpace())return;const t=document.getElementById("timeline-content");if(!t)return;if(!document.getElementById(`frame-scroll-id-${e}`)){t.insertAdjacentHTML("beforeend",`\n<div class="timeline-content-child" id="layer-id-${e}" data-layer-id="${e}">\n\n    <div class="timeline-layer-controller">\n        <i class="timeline-exit-icon" id="timeline-exit-icon-${e}" data-layer-id="${e}"></i>\n        <i class="timeline-exit-in-icon" id="timeline-exit-in-icon-${e}" data-layer-id="${e}"></i>\n        <i class="timeline-layer-icon" id="layer-icon-${e}" data-layer-id="${e}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-mask-icon" id="layer-mask-icon-${e}" data-layer-id="${e}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-mask-in-icon" id="layer-mask-in-icon-${e}" data-layer-id="${e}"></i>\n        <i class="timeline-guide-icon" id="layer-guide-icon-${e}" data-layer-id="${e}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-guide-in-icon" id="layer-guide-in-icon-${e}" data-layer-id="${e}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <div class="view-text" id="layer-name-${e}" data-layer-id="${e}">layer_${e}</div>\n        <input type="text" class="view-text-input" id="layer-name-input-${e}" data-layer-id="${e}" value="layer_${e}" style="display: none;">\n        <i class="timeline-layer-light-one icon-disable" id="layer-light-icon-${e}" data-click-type="light" data-layer-id="${e}" data-detail="{{レイヤーをハイライト}}"></i>\n        <i class="timeline-layer-disable-one icon-disable" id="layer-disable-icon-${e}" data-click-type="disable" data-layer-id="${e}" data-detail="{{レイヤーを非表示}}"></i>\n        <i class="timeline-layer-lock-one icon-disable" id="layer-lock-icon-${e}" data-click-type="lock" data-layer-id="${e}" data-detail="{{レイヤーをロック}}"></i>\n    </div>\n\n    <div class="timeline-frame-controller" id="frame-scroll-id-${e}"></div>\n</div>\n`),document.getElementById(`layer-name-${e}`).addEventListener("dblclick",(e=>{this.showInput(e)})),document.getElementById(`layer-icon-${e}`).addEventListener("dblclick",(e=>{this.showLayerMenu(e)}));const r=document.getElementById(`layer-guide-icon-${e}`);r.addEventListener("dblclick",(e=>{this.showLayerMenu(e)})),r.addEventListener("mouseover",(e=>{this.exitLayer(e)})),r.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const a=document.getElementById(`layer-mask-icon-${e}`);a.addEventListener("dblclick",(e=>{this.showLayerMenu(e)})),a.addEventListener("mouseover",(e=>{this.exitLayer(e)})),a.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const i=document.getElementById(`timeline-exit-icon-${e}`);i.addEventListener("mouseover",(e=>{this.exitLayer(e)})),i.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const s=document.getElementById(`timeline-exit-in-icon-${e}`);s.addEventListener("mouseover",(e=>{this.exitLayer(e)})),s.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const n=document.getElementById(`layer-id-${e}`);d.$addModalEvent(n),n.addEventListener("mousedown",(e=>{this.selectLayer(e)}));const o=n.getElementsByClassName("timeline-layer-controller")[0];o.addEventListener("mouseover",(e=>{this.activeMoveLayer(e)})),o.addEventListener("mouseout",(e=>{this.inactiveMoveLayer(e)})),o.addEventListener("contextmenu",(e=>{this.showLayerMenu(e)}));const l=n.getElementsByClassName("timeline-frame-controller")[0];l.addEventListener("wheel",(e=>{const t=0|e.deltaY,r=0|e.deltaX;if(!r||t>0)return!1;e.stopPropagation(),e.preventDefault();const a=d.$timelineHeader.scrollX;if(!a&&0>r)return!1;window.requestAnimationFrame((()=>{d.$timelineHeader.scrollX=d.$clamp(a+r,0,Number.MAX_VALUE),d.$timelineHeader.rebuild(),d.$timelineMarker.move(),this.moveTimeLine()}))}),{passive:!1}),l.addEventListener("mouseover",(e=>{this.showLayerPreview(e)})),l.addEventListener("mouseout",(()=>{this.hideLayerPreview()})),l.addEventListener("mousedown",(e=>{this.selectFrame(e)})),document.getElementById(`layer-light-icon-${e}`).addEventListener("mousedown",(e=>{this.clickLight(e)})),document.getElementById(`layer-disable-icon-${e}`).addEventListener("mousedown",(e=>{this.clickDisable(e)})),document.getElementById(`layer-lock-icon-${e}`).addEventListener("mousedown",(e=>{this.clickLock(e)}));document.getElementById(`frame-scroll-id-${e}`).addEventListener("contextmenu",(e=>{d.$timelineMenu.show(e)}))}this.rebuild(e)}rebuild(e){const t=document.getElementById(`frame-scroll-id-${e}`);if(!t)return;const r=d.$currentWorkSpace().scene.getLayer(e),a=d.$timelineTool.timelineWidth,i=d.$timelineHeader.width/(a+1)|0;if(!t.children.length){for(let r=0;i>=r;++r)this.createElement(t,e,r+1);r._$children=[]}if(t.children.length>i+1){const e=i+1;for(;t.children.length>e;)t.children[e].remove();r._$children=[]}if(i>t.children.length){let a=0|t.lastElementChild.dataset.frame;const s=i-t.children.length;for(let r=0;s>=r;++r)this.createElement(t,e,++a);r._$children=[]}r._$children.length||(r._$children=Array.from(t.children));let s=d.$timelineHeader.leftFrame;for(let e=0;r._$children.length>e;++e){const t=s+e,a=r._$children[e];a.setAttribute("data-frame",`${t}`),a.setAttribute("data-frame-state","empty"),a.setAttribute("class",t%5!=0?"frame":"frame frame-pointer")}r.reloadStyle()}createElement(e,t,r=1){e.insertAdjacentHTML("beforeend",`<div class="${r%5!=0?"frame":"frame frame-pointer"}" data-frame-state="empty" data-layer-id="${t}" data-frame="${r}"></div>`)}removeFrame(){if(!this.targetLayer)return;this.save();let e=!1;const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene,a=this.targetFrames;for(const i of a.keys()){const a=r.getLayer(i),s=a.getActiveCharacter(t);if(!s.length)continue;e=!0;let n=null;for(let e=0;e<s.length;++e){const r=s[e];n||(n=r.getRange(t)),r.remove(a)}a.addEmptyCharacter(new f({startFrame:n.startFrame,endFrame:n.endFrame})),a.reloadStyle()}this.clearActiveFrames(),this.activeCharacter(),e&&this.reloadScreen(),super.focusOut()}attachLayer(){if(!this.targetLayer){let e=document.getElementById("timeline-content").children[0];e||(d.$currentWorkSpace().scene.addLayer(),e=document.getElementById("timeline-content").children[0]);const t=d.$shiftKey,r=d.$ctrlKey;d.$shiftKey=!1,d.$ctrlKey=!1,this.targetLayer=e,d.$shiftKey=t,d.$ctrlKey=r}}exitLayer(e){if(-1===this._$moveLayerId)return;const t=0|e.target.dataset.layerId;let r=document.getElementById(`layer-id-${t}`);const a=Array.from(document.getElementById("timeline-content").children),i=d.$currentWorkSpace().scene,s=a.indexOf(r),n=a[s+1];if(n){switch(i.getLayer(0|n.dataset.layerId).mode){case I.MASK_IN:case I.GUIDE_IN:return}}this._$exitLayer=r,document.getElementById(`timeline-exit-icon-${t}`).style.opacity="1",document.getElementById(`timeline-exit-in-icon-${t}`).style.opacity="1"}endExitLayer(e){if(-1===this._$moveLayerId)return;this._$exitLayer=null;const t=0|e.target.dataset.layerId;document.getElementById(`timeline-exit-icon-${t}`).style.opacity="0",document.getElementById(`timeline-exit-in-icon-${t}`).style.opacity="0"}clickLight(e){e.button||(e.stopPropagation(),this.changeType(e.target,"light"))}clickLock(e){e.button||(e.stopPropagation(),this.changeType(e.target,"lock"),d.$transformController.show().relocation())}clickDisable(e){e.button||(e.stopPropagation(),this.changeType(e.target,"disable"),d.$transformController.show(),d.$clearShapePointer(),this.reloadScreen())}changeType(e,t){const r=0|e.dataset.layerId,a=document.getElementById(`layer-id-${r}`),i=d.$currentWorkSpace().scene.getLayer(r);i[t]=!i[t],i[t]?(e.classList.remove("icon-disable"),"light"===t?(e.classList.add("light-icon-active"),a.style.borderBottom=`1px solid ${i.color}`):(e.classList.add("icon-active"),a.classList.add(`${t}-active`))):(e.classList.add("icon-disable"),"light"===t?(e.classList.remove("light-icon-active"),a.style.borderBottom=""):(e.classList.remove("icon-active"),a.classList.remove(`${t}-active`))),"lock"===t&&this.reloadScreen()}showLayerMenu(e){e.preventDefault(),e.stopPropagation();const t=0|e.target.dataset.layerId;d.$timelineLayer.targetLayers.has(`layer-id-${t}`)||(this.targetLayer=document.getElementById(`layer-id-${t}`)),d.$timelineLayerMenu.show(e)}showInput(e){e.stopPropagation(),d.$keyLock=!0;const t=0|e.target.dataset.layerId,r=document.getElementById(`layer-name-input-${t}`);r.value=e.target.textContent,r.style.display="",r.focus(),e.target.style.display="none",this._$endInput||(this._$endInput=this.endInput.bind(this)),r.addEventListener("focusout",this._$endInput),r.addEventListener("keypress",this._$endInput)}endInput(e){if("Enter"===e.key)return void e.target.blur();if("focusout"!==e.type)return;this.save(),e.stopPropagation();const t=e.target,r=0|t.dataset.layerId;d.$currentWorkSpace().scene.getLayer(r).name=t.value;const a=document.getElementById(`layer-name-${r}`);a.textContent=t.value,a.style.display="",t.style.display="none",t.removeEventListener("focusout",this._$endInput),t.removeEventListener("keypress",this._$endInput),super.focusOut()}moveLayer(e){d.$setCursor("grabbing"),window.requestAnimationFrame((()=>{const t=document.getElementById("timeline-content");e.pageY+20>window.innerHeight&&(t.scrollTop+=e.pageY+20-window.innerHeight),t.scrollTop>0&&t.offsetTop>e.pageY-8&&(t.scrollTop+=e.pageY-t.offsetTop-8)}))}executeMoveLayer(){window.removeEventListener("mousemove",this._$moveLayer),window.removeEventListener("mouseup",this._$executeMoveLayer);let e=null;const t=d.$currentWorkSpace().scene;if(this._$exitLayer){switch(e=t.getLayer(0|this._$exitLayer.dataset.layerId),e.mode){case I.MASK_IN:for(const t of this.targetLayers.values())if(t.id===e.maskId)return this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,void d.$setCursor("auto");break;case I.GUIDE_IN:for(const t of this.targetLayers.values())if(t.id===e.guideId)return this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,void d.$setCursor("auto")}document.getElementById(`timeline-exit-icon-${e.id}`).style.opacity="0",document.getElementById(`timeline-exit-in-icon-${e.id}`).style.opacity="0",this._$destLayer=this._$exitLayer}if(this._$destLayer){this._$destLayer.classList.remove("move-target");const r=t.getLayer(0|this._$destLayer.dataset.layerId);if(null===e)switch(r.mode){case I.MASK:case I.MASK_IN:case I.GUIDE:case I.GUIDE_IN:for(const e of this.targetLayers.values()){switch(t.getLayer(0|e.dataset.layerId).mode){case I.MASK:case I.GUIDE:return this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,void d.$setCursor("auto")}}}this.save();const a=document.getElementById("timeline-content"),i=Array.from(this.targetLayers.values());if(i.length>1){for(let e=0;e<i.length;++e){const r=i[e],a=t.getLayer(0|r.dataset.layerId);switch(a.mode){case I.MASK_IN:{const t=document.getElementById(`layer-id-${a.maskId}`);i.indexOf(t)>-1&&(i.splice(e,1),--e)}break;case I.GUIDE_IN:{const t=document.getElementById(`layer-id-${a.guideId}`);i.indexOf(t)>-1&&(i.splice(e,1),--e)}}}const e=Array.from(a.children);i.sort(((t,r)=>{const a=e.indexOf(t),i=e.indexOf(r);switch(!0){case a>i:return-1;case a<i:return 1;default:return 0}}))}const s=[];for(let n=0;n<i.length;++n){const o=i[n],l=t.getLayer(0|o.dataset.layerId);switch(r.mode){case I.MASK:case I.MASK_IN:e?null!==e.maskId&&e.maskId===l.maskId&&(l.maskId=null,l.mode=I.NORMAL,l.showIcon()):(l.maskId=null===r.maskId?r.id:r.maskId,l.mode=I.MASK_IN,l.showIcon());break;case I.GUIDE:case I.GUIDE_IN:e?null!==e.guideId&&e.guideId===l.guideId&&(l.guideId=null,l.mode=I.NORMAL,l.showIcon()):(l.guideId=null===r.guideId?r.id:r.guideId,l.mode=I.GUIDE_IN,l.showIcon());break;default:switch(l.mode){case I.MASK_IN:l.maskId=null,l.mode=I.NORMAL,l.showIcon();break;case I.GUIDE_IN:l.guideId=null,l.mode=I.NORMAL,l.showIcon()}}switch(s.length&&(s.length=0),l.mode){case I.MASK:{const e=Array.from(a.children);let r=e.indexOf(o);for(;;){const a=e[++r];if(!a)break;if(t.getLayer(0|a.dataset.layerId).mode!==I.MASK_IN)break;s.unshift(a)}}break;case I.GUIDE:{const e=Array.from(a.children);let r=e.indexOf(o);for(;;){const a=e[++r];if(!a)break;if(t.getLayer(0|a.dataset.layerId).mode!==I.GUIDE_IN)break;s.unshift(a)}}}if(a.insertBefore(o,this._$destLayer.nextElementSibling),s.length)for(let e=0;e<s.length;++e)a.insertBefore(s[e],o.nextElementSibling);o.lastElementChild.scrollLeft=this._$destLayer.lastElementChild.scrollLeft}const n=[],o=a.children;for(let e=0;e<o.length;++e)n.push(t.getLayer(0|o[e].dataset.layerId));t.clearLayer();for(let e=0;e<n.length;++e){const r=n[e];t.setLayer(r.id,r)}this.reloadScreen()}else if(this._$moveLayerId!==this._$selectLayerId){const e=document.getElementById(`layer-id-${this._$moveLayerId}`);this.activeLayer(e)}super.focusOut(),this._$selectLayerId=-1,this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,d.$setCursor("auto")}activeMoveLayer(e){if(this._$destLayer=null,-1===this._$moveLayerId)return;e.stopPropagation();const t=e.currentTarget.parentNode;this.targetLayers.has(t.id)||(this._$destLayer=t,t.classList.add("move-target"))}inactiveMoveLayer(e){-1!==this._$moveLayerId&&this._$destLayer&&(e.stopPropagation(),this._$destLayer.classList.remove("move-target"),this._$destLayer=null)}moveTimeLine(){const e=d.$currentWorkSpace().scene,t=this.clientHeight,r=d.$timelineScroll.y/he.LAYER_HEIGHT|0;let a=0,i=0;for(const s of e._$layers.values())if(r>a){if("none"!==s.display){const e=document.getElementById(`layer-id-${s.id}`);e&&(s.display=e.style.display="none")}a++}else{if("none"===s.display){const e=document.getElementById(`layer-id-${s.id}`);e&&(s.display=e.style.display="")}if(this.rebuild(s.id),he.LAYER_HEIGHT*++i>t)break;a++}this.moveActiveFrame()}showLayerPreview(e){if(!document.getElementById("timeline-preview").classList.contains("timeline-preview-active"))return;const t=0|e.target.dataset.layerId,r=e.target;window.requestAnimationFrame((()=>{const a=d.$currentWorkSpace(),i=0|r.dataset.frame,s=a.scene.getLayer(t),n=d.$currentFrame;d.$currentFrame=i;const o=s.getActiveCharacter(i);if(o.length){clearTimeout(this._$timerId),s.sort(o,i);const t=document.getElementById("timeline-preview-modal"),{Sprite:r,BitmapData:n}=window.next2d.display,{Matrix:l,ColorTransform:c}=window.next2d.geom,d=new r;let h=Number.MAX_VALUE,u=-Number.MAX_VALUE,m=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let e=0;e<o.length;++e){const t=o[e],r=t.getRange(i),s=t.getPlace(i),n=a.getLibrary(t.libraryId).createInstance(s,r);n.transform.matrix=new l(s.matrix[0],s.matrix[1],s.matrix[2],s.matrix[3],s.matrix[4],s.matrix[5]),n.transform.colorTransform=new c(s.colorTransform[0],s.colorTransform[1],s.colorTransform[2],s.colorTransform[3],s.colorTransform[4],s.colorTransform[5],s.colorTransform[6],s.colorTransform[7]);const p=a.getLibrary(t.libraryId).getBounds(s.matrix,s,r);h=Math.min(h,p.xMin),u=Math.max(u,p.xMax),m=Math.min(m,p.yMin),g=Math.max(g,p.yMax),d.addChild(n)}const p=Math.ceil(Math.abs(u-h)),$=Math.ceil(Math.abs(g-m)),f=Math.min(120/p,120/$),y=window.devicePixelRatio,_=new n(p*f*y,$*f*y,!0,0),b=new l(y,0,0,y,-h*y,-m*y);for(b.scale(f,f),_.draw(d,b);t.children.length;)t.children[0].remove();const v=new Image;v.onload=()=>{t.appendChild(v),t.style.display="",t.style.left=`${e.pageX+10}px`,t.style.top=e.pageY-t.offsetHeight-10+"px",t.style.backgroundColor=document.getElementById("stage-bgColor").value,t.classList.contains("fadeIn")||t.setAttribute("class","fadeIn")},v.src=_.toDataURL(),v.width=_.width/y,v.height=_.height/y,_.dispose()}d.$currentFrame=n}))}hideLayerPreview(){if(!document.getElementById("timeline-preview").classList.contains("timeline-preview-active"))return;const e=document.getElementById("timeline-preview-modal");e.classList.contains("fadeOut")||(this._$timerId=setTimeout((()=>{e.classList.contains("fadeOut")||e.setAttribute("class","fadeOut")}),1e3))}selectLayer(e){if(e.button)return;e.stopPropagation(),d.$endMenu();const t=e.currentTarget;t.classList.contains("active")||this.activeLayer(t),this._$moveLayer||(this._$moveLayer=this.moveLayer.bind(this)),this._$executeMoveLayer||(this._$executeMoveLayer=this.executeMoveLayer.bind(this)),this._$moveLayerId=0|t.dataset.layerId,window.addEventListener("mousemove",this._$moveLayer),window.addEventListener("mouseup",this._$executeMoveLayer)}activeLayer(e){this.clearActiveFrames(),this.targetLayer=e,this._$selectLayerId=0|e.dataset.layerId;const t=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame;for(const e of this.targetLayers.values()){const a=0|e.dataset.layerId,i=t.getLayer(a);this.targetFrames.delete(a),this.addTargetFrame(i,r)}d.$timelineMarker.move(),this.activeCharacter()}selectFrame(e){if(e.button)return;e.stopPropagation(),d.$endMenu();const t=document.getElementById("timeline-preview-modal");t.classList.contains("fadeOut")||t.setAttribute("class","fadeOut");const r=e.target,a=0|r.dataset.frame;this.changeLabel(a);const i=d.$tools.getDefaultTool("arrow");if(r.classList.contains("frame-active")){const t=this.targetFrames.values().next().value;if(!t.length)return;const r=Array.from(document.getElementById("timeline-content").children);let a=r.indexOf(this.targetLayer);if(this.targetFrames.size>1)for(const e of this.targetFrames.keys()){const t=document.getElementById(`layer-id-${e}`);t&&(a=Math.min(a,r.indexOf(t)))}let i=Number.MAX_VALUE;for(let e=0;e<t.length;++e)i=Math.min(i,t[e]);const s=d.$currentWorkSpace().scene.getLayer(0|r[a].dataset.layerId).getChildren(i),n=document.getElementById("timeline-content"),o=t.length*(d.$timelineTool.timelineWidth+1)-5;this._$clientX=s.offsetLeft,this._$clientY=s.offsetTop-n.scrollTop;const l=document.getElementById("target-group");l.style.display="",l.style.width=`${o}px`,l.style.height=this.targetFrames.size*he.LAYER_HEIGHT-5+"px",l.style.left=`${this._$clientX}px`,l.style.top=`${this._$clientY}px`,l.dataset.frame=`${i}`,l.dataset.index=`${a}`;const c=d.$timelineTool.timelineWidth+1;for(;!(this._$clientX+c>e.clientX);)this._$clientX+=c;for(;!(this._$clientY+30>e.clientY);)this._$clientY+=30;this._$endTargetGroup||(this._$endTargetGroup=this.endTargetGroup.bind(this)),this._$moveTargetGroup||(this._$moveTargetGroup=this.moveTargetGroup.bind(this)),window.addEventListener("mousemove",this._$moveTargetGroup),window.addEventListener("mouseup",this._$endTargetGroup)}else{d.$ctrlKey||i.clear();const e=0|r.dataset.layerId;this.targetLayer=document.getElementById(`layer-id-${e}`);const t=d.$currentWorkSpace().scene.getLayer(e);this.addTargetFrame(t,a),this._$multiSelect||(this._$multiSelect=this.multiSelect.bind(this)),this._$endMultiSelect||(this._$endMultiSelect=this.endMultiSelect.bind(this)),window.addEventListener("mousemove",this._$multiSelect),window.addEventListener("mouseup",this._$endMultiSelect),this.moveFrame(a)}}changeLabel(e){const t=document.getElementById("label-name");if(!t)return;t.blur(),t.value="";const r=d.$currentWorkSpace().scene;r.hasLabel(e)&&(t.value=r.getLabel(e))}moveFrame(e){if(d.$timelineFrame.currentFrame!==e){d.$timelineFrame.currentFrame=e;const t=d.$timelineTool.timelineWidth,r=d.$timelineHeader.leftFrame,a=d.$timelineHeader.width/(t+1)|0;switch(!0){case r>e:case e>r+a-1:d.$timelineHeader.scrollX=(e-1)*t,d.$timelineHeader.rebuild(),this.moveTimeLine()}d.$timelineMarker.move(),d.$soundController.createSoundElements(),this.reloadScreen()}this.activeCharacter()}moveTargetGroup(e){window.requestAnimationFrame((()=>{const t=document.getElementById("target-group"),r=this.targetLayer;if(!r)return;const a=document.getElementById(`frame-scroll-id-${r.dataset.layerId}`),i=d.$timelineTool.timelineWidth,s=i+1,n=0|t.dataset.frame,o=0|t.dataset.index;if(e.clientX-this._$clientX>s){if(t.offsetLeft+t.offsetWidth+s>a.offsetLeft+a.offsetWidth){const r=document.getElementById("timeline-controller-base");return void(e.pageX>r.offsetLeft+r.offsetWidth&&(d.$timelineHeader.scrollX+=i,d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),t.dataset.frame=`${n+1}`))}return t.style.left=`${t.offsetLeft+s}px`,t.dataset.frame=`${n+1}`,void(this._$clientX+=s)}if(this._$clientX-e.clientX>s){if(a.offsetLeft>t.offsetLeft-s){const r=document.getElementById("timeline-controller-base");return void(d.$timelineHeader.scrollX>0&&r.offsetLeft>e.pageX&&(d.$timelineHeader.scrollX-=i,d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),t.dataset.frame=""+(n-1)))}return t.style.left=t.offsetLeft-s+"px",t.dataset.frame=""+(n-1),void(this._$clientX-=s)}if(e.clientY-this._$clientY>he.LAYER_HEIGHT-1){const e=document.getElementById("timeline-content"),r=Math.min(e.children.length*he.LAYER_HEIGHT,e.offsetHeight);return t.offsetTop+t.offsetHeight+he.LAYER_HEIGHT>e.offsetTop+r?void(d.$timelineScroll.maxY>=d.$timelineScroll.y+he.LAYER_HEIGHT&&(t.dataset.index=`${o+1}`,d.$timelineScroll.execute(he.LAYER_HEIGHT))):(t.style.top=`${t.offsetTop+he.LAYER_HEIGHT}px`,t.dataset.index=`${o+1}`,void(this._$clientY+=he.LAYER_HEIGHT-1))}if(this._$clientY-e.clientY>0){if(document.getElementById("timeline-content").offsetTop>t.offsetTop-he.LAYER_HEIGHT)return void(d.$timelineScroll.y>0&&(t.dataset.index=""+(o-1),d.$timelineScroll.execute(-he.LAYER_HEIGHT)));t.style.top=t.offsetTop-he.LAYER_HEIGHT+"px",t.dataset.index=""+(o-1),this._$clientY-=he.LAYER_HEIGHT-1}}))}endTargetGroup(){window.removeEventListener("mousemove",this._$moveTargetGroup),window.removeEventListener("mouseup",this._$endTargetGroup);const e=document.getElementById("target-group"),t=0|e.dataset.frame;let r=0|e.dataset.index;const a=Array.from(document.getElementById("timeline-content").children);this.hideTargetGroup();const i=0|a[r].dataset.layerId,s=0|this.targetLayer.dataset.layerId,n=d.$timelineTool.getFirstFrame();if(i===s&&n===t)return;this.save();const o=d.$currentWorkSpace().scene;for(const[e,s]of this.targetFrames){const l=t+s.length,c=s.slice();c.length>1&&c.sort(((e,t)=>{const r=0|e,a=0|t;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}}));const h=o.getLayer(e),u=0|a[r++].dataset.layerId,m=o.getLayer(u),g=new Map,p=[];let y=null,_=1;for(let e=0;e<c.length;++e){const t=c[e];if(h.getActiveEmptyCharacter(t)||h.getActiveCharacter(t).length){const e=h.getActiveCharacter(t);if(e.length){y&&(y.endFrame=t,p.push(y),y=null);for(let r=0;r<e.length;++r){const a=e[r];if(!g.has(a.id)){const e=new $;e.libraryId=a.libraryId,e.startFrame=t,e.endFrame=t+1,e.screenX=a.screenX,e.screenY=a.screenY;const r=a.getClonePlace(t);if(e.setPlace(t,r),r.tweenFrame){const i=a.getCloneTween(r.tweenFrame);i.startFrame=t,i.endFrame=t+1,r.tweenFrame=t,e.setTween(t,i)}g.set(a.id,e),_=Math.max(e.endFrame,_);continue}const i=g.get(a.id);if(a.hasPlace(t)){const e=a.getClonePlace(t);i.setPlace(t,e),e.tweenFrame&&(e.tweenFrame=i.startFrame,i.getTween(e.tweenFrame).endFrame=t+1)}i.endFrame=t+1,_=Math.max(i.endFrame,_)}continue}if(!y){y=new f,y.startFrame=t,y.endFrame=t+1,_=Math.max(y.endFrame,_);continue}y.endFrame=t+1,_=Math.max(y.endFrame,_)}else{if(y){y.endFrame=t+1;continue}if(g.size){for(const e of g.values()){if(e.endFrame!==_)continue;const r=e.endFrame-1;if(e.hasPlace(r)){const a=e.getPlace(r);a.tweenFrame&&(e.setPlace(t,e.getClonePlace(r)),e.getTween(a.tweenFrame).endFrame=t+1,d.$tweenController.relocationPlace(e,r))}e.endFrame=t+1,_=t+1}continue}y=new f,y.startFrame=t,y.endFrame=t+1}}y&&p.push(y);let b=l;const v=m._$characters.slice();for(let e=0;e<v.length;++e){const r=v[e];if(!(t>r.endFrame-1)&&!(r.startFrame>=l))if(r.startFrame>=t&&l>=r.endFrame)m.deleteCharacter(r.id);else{const e=r.getRange(l);b=Math.max(e.endFrame,b);for(let e=t;l>e;++e){if(!r.hasPlace(e))continue;const a=r.getPlace(e);if(a.tweenFrame){const i=r.getRange(e);if(r.hasTween(e)){for(let e=i.startFrame;i.endFrame>e;++e)r.deletePlace(e);r.deleteTween(e)}else{for(let e=t;i.endFrame>e;++e)r.deletePlace(e);r.getTween(a.tweenFrame).endFrame=t,d.$tweenController.relocationPlace(r,a.tweenFrame)}}r.deletePlace(e)}if(r._$places.size){if(r.hasPlace(e.endFrame)){if(i===u&&g.has(r.id)){const e=g.get(r.id);for(const t of e._$places.keys())r.hasPlace(t)&&(b=Math.max(r.getRange(t).endFrame,b),r.deletePlace(t))}const t=r.clone();t.startFrame=e.endFrame;const a=new Map;for(const[i,s]of t._$places)e.endFrame>i||(r.deletePlace(i),a.set(i,s));if(a.size){const i=new Map;for(const[a,s]of t._$tween)e.endFrame>a||(r.deleteTween(a),i.set(a,s));t._$places=a,t._$tween=i,m.addCharacter(t)}}r.endFrame=t,r.hasTween(e.startFrame)&&(r.getTween(e.startFrame).endFrame=t)}else m.deleteCharacter(r.id)}}const I=m._$emptys.slice();for(let e=0;e<I.length;++e){const r=I[e];t>r.endFrame-1||(r.startFrame>=l||(m.getActiveCharacter(r.endFrame).length&&(b=r.endFrame),t>r.startFrame?r.endFrame=t:m.deleteEmptyCharacter(r)))}if(!d.$altKey){const e=n+s.length;for(const t of g.keys()){const r=h.getCharacter(t);if(r){if(i===u&&r.hasPlace(n)){const e=r.getRange(n);e.startFrame===r.startFrame&&e.startFrame===b&&(b=Math.max(e.endFrame,b))}for(let a=n;e>a;++a){if(!r.hasPlace(a))continue;const e=r.getRange(a);if(r.hasTween(a)){const e=r.getTween(a);for(let t=e.startFrame;e.endFrame>t;++t)r.deletePlace(t);r.deleteTween(a);const t=a-1;if(t>1&&t>=r.startFrame){const a=r.getPlace(t);if(a.tweenFrame){for(let a=t+1;e.endFrame>a;++a)r.setPlace(a,r.getClonePlace(t));r.getTween(a.tweenFrame).endFrame=e.endFrame,d.$tweenController.relocationPlace(r,t)}}}else{if(r.getPlace(a).tweenFrame)continue}if(r.deletePlace(a),!r._$places.size){if(h.deleteCharacter(t),!h.getActiveEmptyCharacter(a)){const t=h.getActiveEmptyCharacter(a-1);t?t.endFrame=e.endFrame:h.addEmptyCharacter(new f({startFrame:e.startFrame,endFrame:e.endFrame}))}break}if(r.startFrame===a){r.startFrame=e.endFrame;const t=a-1;if(t){const r=h.getActiveCharacter(t);if(r.length)for(let t=0;r.length>t;++t){const a=r[t],i=a.endFrame-1;if(a.hasPlace(i)){const t=a.getPlace(i);if(t.tweenFrame){const r=a.getTween(t.tweenFrame);for(let t=i+1;e.endFrame>t;++t)a.setPlace(t,a.getClonePlace(i));r.endFrame=e.endFrame,d.$tweenController.relocationPlace(a,i)}}a.endFrame=e.endFrame}else{const r=h.getActiveEmptyCharacter(t);r?r.endFrame=e.endFrame:h.addEmptyCharacter(new f({startFrame:e.startFrame,endFrame:e.endFrame}))}}else{h.getActiveEmptyCharacter(t)||h.addEmptyCharacter(new f({startFrame:e.startFrame,endFrame:e.endFrame}))}}}}}for(let t=0;t<h._$emptys.length;++t){const r=h._$emptys[t];if(!(r.startFrame>e)&&!(n>=r.endFrame))for(let t=n;e>t;++t){if(r.startFrame!==t)continue;const e=r.startFrame-1;if(e){b=Math.max(r.endFrame,b),h.deleteEmptyCharacter(r);const t=h.getActiveCharacter(e);if(t.length){for(let e=0;e<t.length;++e){const a=t[e],i=a.endFrame-1;if(a.hasPlace(i)){const e=a.getPlace(i);if(e.tweenFrame){for(let e=i+1;r.endFrame>e;++e)a.setPlace(e,a.getClonePlace(i));a.getTween(e.tweenFrame).endFrame=r.endFrame,d.$tweenController.relocationPlace(a,i)}}a.endFrame=r.endFrame}break}const a=h.getActiveEmptyCharacter(e);a?a.endFrame=r.endFrame:i!==u&&h.addEmptyCharacter(new f({startFrame:1,endFrame:r.endFrame}))}break}}}for(const e of g.values()){if(t!==n&&e.move(t-n),e.endFrame===l&&b>l){const t=e.endFrame-1;if(e.hasPlace(t)){const r=e.getPlace(t);if(r.tweenFrame){for(let r=t+1;b>r;++r)e.setPlace(r,e.getClonePlace(t));e.getTween(r.tweenFrame).endFrame=b,d.$tweenController.relocationPlace(e,t)}}e.endFrame=b}m.addCharacter(e);const r=m.getActiveEmptyCharacter(e.startFrame);r&&m.deleteEmptyCharacter(r)}for(let e=0;e<p.length;++e){const r=p[e];t!==n&&r.move(t-n),r.endFrame===l&&b>l&&(r.endFrame=b),m.addEmptyCharacter(r)}if(t>1){const e=m.getActiveCharacter(t-1),r=m.getActiveEmptyCharacter(t-1);if(!e.length&&!r){let e=null,r=null,a=1;for(;(e=m.getActiveCharacter(t-a),!e.length)&&(r=m.getActiveEmptyCharacter(t-a),!r)&&!(0>=t-a);++a);switch(e.length||(e=null),!0){case null!==e:for(let r=0;r<e.length;++r){const a=e[r];let i=t;const s=a.endFrame-1;if(a.hasPlace(s)){const e=a.getPlace(s);if(e.tweenFrame){for(let e=s+1;t>e;++e)a.setPlace(e,a.getClonePlace(s));if(g.has(a.id)){const t=g.get(a.id);for(let r=t.startFrame;t.endFrame>r;++r){const i=t.getClonePlace(r);i.tweenFrame=e.tweenFrame,a.setPlace(r,i)}a.getTween(e.tweenFrame).endFrame=t.endFrame,i=t.endFrame,g.delete(a.id),m.deleteCharacter(t.id)}else a.getTween(e.tweenFrame).endFrame=i;d.$tweenController.relocationPlace(a,e.tweenFrame)}}a.endFrame=i}break;case null!==r:r.endFrame=t;break;default:m.addEmptyCharacter(new f({startFrame:t-a+1,endFrame:t}))}}}for(const e of g.values()){let t=e;const r=e.startFrame-1;if(r){const a=m.getActiveCharacter(r);for(let r=0;r<a.length;++r){const i=a[r];if(i.libraryId===e.libraryId&&i.endFrame===e.startFrame){t=i;for(const[r,a]of e._$places)t.setPlace(r,a);for(const[r,a]of e._$tween)t.setTween(r,a);t.endFrame=e.endFrame,m.deleteCharacter(e.id);break}}}const a=e.endFrame,i=m.getActiveCharacter(a);for(let e=0;e<i.length;++e){const r=i[e];if(r.libraryId===t.libraryId&&r.startFrame===t.endFrame){for(const[e,a]of r._$places)t.setPlace(e,a);for(const[e,a]of r._$tween)t.setTween(e,a);t.endFrame=r.endFrame,m.deleteCharacter(r.id);break}}}u===e?h.reloadStyle():(h.reloadStyle(),m.reloadStyle())}d.$tools.getDefaultTool("arrow").clear(),this.reloadScreen(),this._$saved=!1}clearActiveLayers(){for(const e of this.targetLayers.values())e.classList.remove("active");this.targetLayers.clear()}moveActiveFrame(){const e=d.$timelineTool.timelineWidth,t=d.$timelineHeader.width/(e+1)|0,r=d.$timelineHeader.leftFrame,a=r+t,i=d.$timelineFrame.currentFrame,s=d.$currentWorkSpace().scene;for(const[e,t]of this._$targetFrames){const n=s.getLayer(e);if(n)for(let e=0;e<t.length;++e){const t=i+e;if(r>t)continue;if(t>a)continue;const s=n.getChildren(t);s&&s.classList.add("frame-active")}}}clearActiveFrames(){const e=d.$currentWorkSpace();if(!e)return this._$targetFrames.clear(),void this.hideTargetGroup();const t=e.scene;if(!t)return this._$targetFrames.clear(),void this.hideTargetGroup();for(const[e,r]of this._$targetFrames){const a=t.getLayer(e);if(a)for(let e=0;e<r.length;++e){const t=a.getChildren(r[e]);t&&t.classList.remove("frame-active")}}this._$targetFrames.clear(),this.hideTargetGroup()}hideTargetGroup(){const e=document.getElementById("target-group");e&&(e.style.display="none")}multiSelect(e,t=null){const r=e?e.target:t,a=0|r.dataset.frame;if(!a)return;if(!("layerId"in r.dataset))return;const i=this.targetLayer;if(!i)return;e&&(e.stopPropagation(),e.preventDefault());const s=0|this.targetFrames.keys().next().value,n=this.targetFrames.values().next().value[0],o=Math.min(a,n),l=Math.max(a,n)+1,c=[s],h=0|r.dataset.layerId;if(s!==h){const e=Array.from(document.getElementById("timeline-content").children),t=e.indexOf(i),r=e.indexOf(document.getElementById(`layer-id-${h}`));if(r>t){const a=r-t+1;for(let r=1;r<a;++r)c.push(0|e[t+r].dataset.layerId)}else{const a=t-r+1;for(let r=1;r<a;++r)c.push(0|e[t-r].dataset.layerId)}}this.clearActiveFrames();const u=d.$currentWorkSpace().scene;for(let e=0;e<c.length;++e){const t=0|c[e],r=u.getLayer(t);for(let e=o;e<l;++e)this.addTargetFrame(r,e)}const m=this.targetFrames.get(s);m.splice(m.indexOf(n),1),m.unshift(n),this.activeCharacter()}endMultiSelect(){d.$setCursor("auto"),window.removeEventListener("mousemove",this._$multiSelect),window.removeEventListener("mouseup",this._$endMultiSelect)}}d.$timelineLayer=new he;d.$timelineLayerMenu=new class extends ne{initialize(){super.initialize();const e=["timeline-layer-normal","timeline-layer-mask","timeline-layer-guide","timeline-layer-copy","timeline-layer-paste"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e)}))}const t=document.getElementById("timeline-layer-color");t&&t.addEventListener("change",(e=>{e.stopPropagation(),this.changeLayerHighlightColor(e)}))}executeTimelineLayerNormal(){d.$endMenu();const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$currentWorkSpace().scene,r=0|e.dataset.layerId,a=t.getLayer(r);if(a.mode===I.NORMAL)return;this.save();const i=this.resetLayer(e);a.mode=I.NORMAL,a.showIcon(),i&&this.reloadScreen(),super.focusOut()}executeTimelineLayerMask(){d.$endMenu();const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId);if(t.mode===I.MASK)return;this.save();const r=this.resetLayer(e);t.mode=I.MASK,t.showIcon(),(r||t.lock)&&this.reloadScreen(),super.focusOut()}executeTimelineLayerCopy(){d.$endMenu(),d.$timelineMenu.executeContextMenuLayerCopy()}executeTimelineLayerPaste(){d.$endMenu(),d.$timelineMenu.executeContextMenuLayerPaste()}executeTimelineLayerGuide(){d.$endMenu();const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId);if(t.mode===I.GUIDE)return;this.save();const r=this.resetLayer(e);t.mode=I.GUIDE,t.showIcon(),r&&this.reloadScreen(),super.focusOut()}changeLayerHighlightColor(e){this.save();const t=0|e.target.dataset.layerId,r=d.$currentWorkSpace().scene.getLayer(t);r.color=e.target.value;document.getElementById(`layer-light-icon-${t}`).style.backgroundImage=`url('${r.getHighlightURL()}')`,r.light&&(document.getElementById(`layer-id-${t}`).style.borderBottom=`1px solid ${r.color}`),super.focusOut(),d.$endMenu()}resetLayer(e){const t=d.$currentWorkSpace().scene,r=t.getLayer(0|e.dataset.layerId),a=Array.from(document.getElementById("timeline-content").children);let i=!1,s=a.indexOf(e);switch(r.mode){case I.MASK:for(;;){const e=a[++s];if(!e)break;const r=t.getLayer(0|e.dataset.layerId);if(r.mode!==I.MASK_IN)break;r.maskId=null,r.mode=I.NORMAL,r.showIcon(),i=!0}break;case I.GUIDE:for(;;){const e=a[++s];if(!e)break;const r=t.getLayer(0|e.dataset.layerId);if(r.mode!==I.GUIDE_IN)break;r.guideId=null,r.mode=I.NORMAL,r.showIcon()}}return i}show(e){e.stopPropagation(),d.$endMenu("timeline-layer-menu");const t=0|e.target.dataset.layerId,r=d.$currentWorkSpace().scene.getLayer(t),a=document.getElementById("timeline-layer-color");a.dataset.layerId=`${t}`,a.value=r.color;const i=document.getElementById("timeline-layer-menu");i.style.left=`${e.pageX+5}px`,i.style.top=e.pageY-i.clientHeight+"px",15>i.offsetTop&&(i.style.top="10px"),e.pageY+15>window.innerHeight&&(i.style.top=e.pageY-i.clientHeight-15+"px"),i.setAttribute("class","fadeIn")}};d.$timelineMarker=new class extends ne{constructor(){super(),this._$left=0,this._$pointerEvents="",this._$moveMarker=null,this._$endMarker=null}initialize(){super.initialize();const e=document.getElementById("timeline-marker");e&&e.addEventListener("mousedown",(e=>{e.button||this.startMarker()}))}startMarker(){d.$tools.getDefaultTool("arrow").clear(),this._$pointerEvents="none",document.getElementById("timeline-marker").setAttribute("style",`left: ${this._$left}px; pointer-events: none;`),this._$moveMarker||(this._$moveMarker=this.moveMarker.bind(this)),this._$endMarker||(this._$endMarker=this.endMarker.bind(this)),window.addEventListener("mousemove",this._$moveMarker),window.addEventListener("mouseup",this._$endMarker),document.getElementById("label-name").blur()}moveMarker(e){d.$setCursor("ew-resize"),window.requestAnimationFrame((()=>{const t=document.getElementById("timeline-controller-base"),r=d.$timelineTool.timelineWidth;if(e.pageX+r>t.offsetLeft+t.offsetWidth){const a=(e.pageX+2*r-(t.offsetLeft+t.offsetWidth))/r|0;if(!a)return;return d.$timelineFrame.currentFrame+=a,d.$timelineHeader.scrollX+=a*r,d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),this.move(),void this.reloadScreen()}if(t.offsetLeft>e.pageX-r){let a=(t.offsetLeft-e.pageX-r)/r|0;if(!a||1===d.$timelineFrame.currentFrame)return;return a>0&&(a*=-1),d.$timelineFrame.currentFrame+=a,d.$timelineHeader.scrollX+=a*r,d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),this.move(),void this.reloadScreen()}let a=0|e.target.dataset.frame;if(!a)return;d.$timelineFrame.currentFrame!==a&&(d.$timelineFrame.currentFrame=a,this.move(),this.reloadScreen())}))}endMarker(){d.$setCursor("auto"),window.removeEventListener("mousemove",this._$moveMarker),window.removeEventListener("mouseup",this._$endMarker),this._$pointerEvents="",document.getElementById("timeline-marker").setAttribute("style",`left: ${this._$left}px;`);const e=d.$currentWorkSpace().scene.getLabel(d.$timelineFrame.currentFrame);document.getElementById("label-name").value=e||""}move(){const e=document.getElementById("timeline-marker");if(!e)return;const t=d.$timelineTool.timelineWidth,r=t+1,a=1+d.$timelineHeader.scrollX/t|0;this._$left=(d.$timelineFrame.currentFrame-a)*r;let i=`left: ${this._$left}px;`;this._$pointerEvents&&(i+="pointer-events: none;"),e.setAttribute("style",i)}};d.$timelineMenu=new class extends ne{constructor(){super(),this._$copyWorkSpaceId=-1,this._$copyLayers=[],this._$copyFrames=[],this._$copyMapping=new Map,this._$instanceMap=new Map}initialize(){super.initialize();const e=["context-menu-script-add","context-menu-frame-add","context-menu-key-frame-add","context-menu-empty-key-frame-add","context-menu-frame-delete","context-menu-key-frame-delete","context-menu-tween-add","context-menu-tween-delete","context-menu-frame-copy","context-menu-frame-paste","context-menu-layer-copy","context-menu-layer-paste"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),d.$endMenu(),this.executeFunction(e)}))}}executeContextMenuFrameCopy(){this._$copyWorkSpaceId=d.$activeWorkSpaceId,this._$copyFrames.length=0}executeContextMenuFramePaste(){console.log("TODO executeContextMenuFramePaste")}executeContextMenuLayerCopy(){this._$copyWorkSpaceId=d.$activeWorkSpaceId,this._$copyLayers.length=0;const e=d.$timelineLayer.targetLayers,t=d.$currentWorkSpace().scene;for(const r of e.values()){const e=t.getLayer(0|r.dataset.layerId);this._$copyLayers.push(e.clone())}}cloneMovieClip(e){const t=d.$currentWorkSpace(),r=d.$workSpaces[this._$copyWorkSpaceId],a=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$copyWorkSpaceId;const i=e.clone();d.$activeWorkSpaceId=a;for(const e of i._$layers.values()){const s=new v;for(let i=0;i<e._$characters.length;++i){d.$activeWorkSpaceId=this._$copyWorkSpaceId;const n=new $(JSON.parse(JSON.stringify(e._$characters[i].toObject())));n._$layerId=-1,n._$id=t._$characterId++,d.$activeWorkSpaceId=a;const o=r.getLibrary(n.libraryId);if(this._$copyMapping.has(o.id)){n.libraryId=this._$copyMapping.get(o.id),s.addCharacter(n);continue}const l=[];let c=o;for(;c._$folderId;)c=r.getLibrary(c._$folderId),l.unshift(c);for(let e=0;l.length>e;++e){const a=l[e];if(this._$copyMapping.has(a.id))continue;const i=a.getPathWithWorkSpace(r);if(t._$nameMap.has(i)){this._$instanceMap.has(a.id)||this._$instanceMap.set(a.id,[]),this._$instanceMap.get(a.id).push({layer:null,path:i,character:a});continue}const s=a.clone(),n=t.nextLibraryId;this._$copyMapping.set(s.id,n),s._$id=n,s.folderId&&this._$copyMapping.has(s.folderId)&&(s.folderId=this._$copyMapping.get(s.folderId)),t._$libraries.set(s.id,s),d.$libraryController.createInstance(s.type,s.name,s.id,s.symbol)}const h=o.getPathWithWorkSpace(r);if(t._$nameMap.has(h)){this._$instanceMap.has(o.id)||this._$instanceMap.set(o.id,[]),this._$instanceMap.get(o.id).push({layer:s,path:h,character:n});continue}const u=o.type===b.MOVIE_CLIP?this.cloneMovieClip(o):o.clone(),m=t.nextLibraryId;this._$copyMapping.set(o.id,m),n.libraryId=m,u._$id=m,t._$libraries.set(u.id,u),u.folderId&&this._$copyMapping.has(u.folderId)&&(u.folderId=this._$copyMapping.get(u.folderId)),d.$libraryController.createInstance(u.type,u.name,u.id,u.symbol),t._$nameMap.set(h,u.id),s.addCharacter(n)}for(let t=0;t<e._$emptys.length;++t)s.addEmptyCharacter(e._$emptys[t].clone());s.id=e.id,i.setLayer(s.id,s)}return i}executeContextMenuLayerPaste(){const e=document.getElementById("timeline-content");if(!e)return;this.save();let t=d.$timelineLayer.targetLayer;t||(d.$timelineLayer.attachLayer(),t=d.$timelineLayer.targetLayer);const r=d.$currentWorkSpace(),a=r.scene;if(this._$instanceMap.clear(),this._$copyWorkSpaceId!==d.$activeWorkSpaceId){const i=d.$workSpaces[this._$copyWorkSpaceId];if(!i)return;const s=t.lastElementChild.scrollLeft;this._$copyMapping.clear();const n=d.$activeWorkSpaceId;for(let o=0;o<this._$copyLayers.length;++o){const l=this._$copyLayers[o],c=new v;for(let e=0;e<l._$characters.length;++e){d.$activeWorkSpaceId=this._$copyWorkSpaceId;const t=new $(JSON.parse(JSON.stringify(l._$characters[e].toObject())));t._$layerId=-1,t._$id=r._$characterId++,d.$activeWorkSpaceId=n;const a=i.getLibrary(t.libraryId);if(this._$copyMapping.has(a.id)){t.libraryId=this._$copyMapping.get(a.id),c.addCharacter(t);continue}const s=[];let o=a;for(;o._$folderId;)o=i.getLibrary(o._$folderId),s.unshift(o);for(let e=0;s.length>e;++e){const t=s[e];if(this._$copyMapping.has(t.id))continue;const a=t.getPathWithWorkSpace(i);if(r._$nameMap.has(a)){this._$instanceMap.has(t.id)||this._$instanceMap.set(t.id,[]),this._$instanceMap.get(t.id).push({layer:null,path:a,character:t});continue}const n=t.clone(),o=r.nextLibraryId;this._$copyMapping.set(n.id,o),n._$id=o,n.folderId&&this._$copyMapping.has(n.folderId)&&(n.folderId=this._$copyMapping.get(n.folderId)),r._$libraries.set(n.id,n),d.$libraryController.createInstance(n.type,n.name,n.id,n.symbol)}const h=a.getPathWithWorkSpace(i);if(r._$nameMap.has(h)){this._$instanceMap.has(a.id)||this._$instanceMap.set(a.id,[]),this._$instanceMap.get(a.id).push({layer:c,path:h,character:t});continue}const u=a.type===b.MOVIE_CLIP?this.cloneMovieClip(a):a.clone(),m=r.nextLibraryId;this._$copyMapping.set(a.id,m),t.libraryId=m,u._$id=m,r._$libraries.set(u.id,u),u.folderId&&this._$copyMapping.has(u.folderId)&&(u.folderId=this._$copyMapping.get(u.folderId)),d.$libraryController.createInstance(u.type,u.name,u.id,u.symbol),r._$nameMap.set(h,u.id),c.addCharacter(t)}for(let e=0;e<l._$emptys.length;++e)c.addEmptyCharacter(l._$emptys[e].clone());a.addLayer(c);const h=e.lastElementChild;e.insertBefore(h,t),s&&(h.lastElementChild.scrollLeft=s)}d.$libraryController.reload()}else{const i=[];for(let e=0;e<this._$copyLayers.length;++e){const t=this._$copyLayers[e],s=t.clone();s.id=a._$layerId++,i.push(s);for(let e=0;e<s._$characters.length;++e){const t=s._$characters[e];s._$instances.delete(t.id),t._$id=r._$characterId++,t._$layerId=s.id,s._$instances.set(t.id,t)}for(let e=0;e<t._$emptys.length;++e)s.addEmptyCharacter(t._$emptys[e].clone())}const s=t.lastElementChild.scrollLeft;for(let r=0;r<i.length;++r){const n=i[r];a.addLayer(n);const o=e.lastElementChild;e.insertBefore(o,t),s&&(o.lastElementChild.scrollLeft=s)}}const i=[];for(let t=0;t<e.children.length;++t)i.push(a.getLayer(0|e.children[t].dataset.layerId));a.clearLayer();for(let e=0;e<i.length;++e){const t=i[e];a.setLayer(t.id,t)}this._$instanceMap.size?(this.setConfirmModalFiles(),d.$confirmModal.show()):this.reloadScreen(),super.focusOut()}setConfirmModalFiles(){for(const[e,t]of this._$instanceMap){const r=d.$workSpaces[this._$copyWorkSpaceId];for(let a=0;a<t.length;++a){const i=t[a];d.$confirmModal.files.push({file:r.getLibrary(e),character:i.character,layer:i.layer,path:i.path,workSpaceId:this._$copyWorkSpaceId,type:"copy"})}}this._$instanceMap.clear()}executeContextMenuScriptAdd(){d.$javaScriptEditor.show()}executeContextMenuFrameAdd(){d.$timelineTool.executeTimelineFrameAdd()}executeContextMenuKeyFrameAdd(){d.$timelineTool.executeTimelineKeyAdd()}executeContextMenuKeyFrameDelete(){d.$timelineTool.executeTimelineKeyDelete()}executeContextMenuEmptyKeyFrameAdd(){d.$timelineTool.executeTimelineEmptyAdd()}executeContextMenuFrameDelete(){d.$timelineTool.executeTimelineFrameDelete()}executeContextMenuTweenAdd(){const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),a=r.getActiveCharacter(t);if(!a.length)return;if(a.length>1)return void alert("If you want to add motion tweening to multiple objects, please do so in a single MovieClip.");const i=a[0],s=i.getRange(t);i.hasTween(s.startFrame)||(this.save(),i.setTween(s.startFrame,{method:"linear",curve:[],custom:d.$tweenController.createEasingObject(),startFrame:s.startFrame,endFrame:s.endFrame}),i.updateTweenPlace(s.startFrame,s.endFrame),i.relocationTween(s.startFrame),r.reloadStyle(),i.dispose(),this.reloadScreen(),this._$saved=!1)}executeContextMenuTweenDelete(){const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),a=r.getActiveCharacter(t);if(!a.length||a.length>1)return;const i=a[0],s=i.getRange(t);if(!i.hasTween(s.startFrame))return;this.save();for(let e=s.startFrame+1;s.endFrame>e;++e)i.hasPlace(e)&&i.deletePlace(e);i.deleteTween(s.startFrame);delete i.getPlace(s.startFrame).tweenFrame,d.$tweenController.clearPointer(),r.reloadStyle(),i.dispose(),this.reloadScreen(),this._$saved=!1}show(e){d.$endMenu("timeline-menu");const t=document.getElementById("timeline-menu");t.style.left=`${e.pageX+5}px`,t.style.top=e.pageY-t.clientHeight+"px",15>t.offsetTop&&(t.style.top="10px"),e.pageY+15>window.innerHeight&&(t.style.top=e.pageY-t.clientHeight-15+"px"),t.setAttribute("class","fadeIn")}};d.$timelinePlayer=new class extends ne{constructor(){super(),this._$stopFlag=!0,this._$repeat=!1,this._$totalFrame=0,this._$startTime=0,this._$fps=0,this._$timerId=-1,this._$baseOffsetHalfWidth=0,this._$clientWidth=0,this._$run=null}get repeat(){return this._$repeat}get stopFlag(){return this._$stopFlag}initialize(){super.initialize();const e=["timeline-play","timeline-stop","timeline-repeat","timeline-no-repeat"];for(let t=0;t<e.length;++t){const r=e[t],a=document.getElementById(r);if(a){switch(r){case"timeline-stop":case"timeline-repeat":a.style.display="none"}a.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e),d.$endMenu()}))}}this._$run=this.run.bind(this)}executeTimelinePlay(){if(this._$stopFlag){if(this._$totalFrame=d.$currentWorkSpace().scene.totalFrame,this._$totalFrame>1){this._$stopFlag=!1,this._$timerId>-1&&window.cancelAnimationFrame(this._$timerId),d.$timelineFrame.currentFrame>=this._$totalFrame&&(d.$timelineFrame.currentFrame=1,d.$timelineHeader.scrollX=0,d.$timelineHeader.rebuild(),d.$timelineLayer.moveTimeLine(),d.$timelineMarker.move(),this.reloadScreen());d.$tools.getDefaultTool("arrow").clear(),document.getElementById("timeline-play").style.display="none",document.getElementById("timeline-stop").style.display="";const e=document.getElementById("timeline-controller-base");this._$baseOffsetHalfWidth=e.offsetWidth/2,this._$clientWidth=e.clientWidth,this._$startTime=window.performance.now(),this._$fps=1e3/(0|document.getElementById("stage-fps").value),this._$timerId=window.requestAnimationFrame(this._$run)}}else this.executeTimelineStop()}executeTimelineStop(){window.cancelAnimationFrame(this._$timerId),this._$stopFlag=!0,this._$timerId=-1,document.getElementById("timeline-play").style.display="",document.getElementById("timeline-stop").style.display="none",this.reloadScreen()}executeTimelineRepeat(){document.getElementById("timeline-repeat").style.display="none",document.getElementById("timeline-no-repeat").style.display="",this._$repeat=!1}executeTimelineNoRepeat(){document.getElementById("timeline-repeat").style.display="",document.getElementById("timeline-no-repeat").style.display="none",this._$repeat=!0}run(e=0){if(this._$stopFlag)return;let t=e-this._$startTime;if(t>this._$fps){let r=d.$timelineFrame.currentFrame+1;if(r>this._$totalFrame){if(!this._$repeat)return this.executeTimelineStop();r=1,d.$timelineHeader.scrollX=0,d.$timelineLayer.moveTimeLine()}d.$timelineFrame.currentFrame=r;const a=d.$timelineTool.timelineWidth,i=(r-(d.$timelineHeader.scrollX/a|0))*(a+1);(0>=i||i>this._$clientWidth)&&(d.$timelineHeader.scrollX=(r-1)*a),d.$timelineHeader.rebuild(),d.$timelineMarker.move();(r-1)*(d.$timelineTool.timelineWidth+1)>this._$baseOffsetHalfWidth&&d.$timelineLayer.moveTimeLine(),this._$startTime=e-t%this._$fps,this.reloadScreen()}this._$timerId=window.requestAnimationFrame(this._$run)}};d.$timelineScroll=new class extends ne{constructor(){super(),this._$y=0}get y(){return this._$y}set y(e){this._$y=e,this.view()}setX(){const e=document.getElementById("timeline");if(e){const t=document.getElementById("timeline-scroll-bar"),r=e.offsetLeft+e.offsetWidth;t.style.left=r-7+"px"}}get maxY(){const e=d.$currentWorkSpace().scene,t=d.$timelineLayer.clientHeight/he.LAYER_HEIGHT|0;return(e._$layers.size-t)*he.LAYER_HEIGHT}execute(e=0){const t=d.$currentWorkSpace();if(!t)return;const r=t.scene;if(!r)return;const a=r._$layers.size*he.LAYER_HEIGHT,i=this.y;if(d.$timelineLayer.clientHeight>a)this.y=0;else{if((d.$timelineLayer.clientHeight/he.LAYER_HEIGHT|0)>=r._$layers.size)return void this.view();this.y=Math.max(0,Math.min(this.y+e,this.maxY))}i!==this.y&&d.$timelineLayer.moveTimeLine()}updateHeight(){const e=d.$currentWorkSpace();if(!e)return;const t=e.scene;if(!t)return;const r=d.$timelineLayer.clientHeight,a=r/he.LAYER_HEIGHT|0,i=r/(t._$layers.size*he.LAYER_HEIGHT);if(t._$layers.size>a){const e=(r-(r-(a*he.LAYER_HEIGHT|0)))*i|0;document.documentElement.style.setProperty("--timeline-scroll-bar-height",e-2+"px")}this.view(),this.execute(0)}view(){const e=document.getElementById("timeline-scroll-bar");if(e){clearTimeout(0|e.dataset.timerId);const t=d.$timelineLayer.clientHeight/he.LAYER_HEIGHT|0,r=d.$currentWorkSpace();if(!r)return;const a=r.scene;if(!a)return;if(t>=a._$layers.size)return void(e.style.display="none");e.style.display="",e.classList.contains("fadeIn")||e.setAttribute("class","fadeIn"),e.dataset.timerId=setTimeout((()=>{e.classList.contains("fadeOut")||e.setAttribute("class","fadeOut")}),1e3);const i=document.getElementById("timeline-content"),s=d.$timelineLayer.clientHeight/(a._$layers.size*he.LAYER_HEIGHT),n=this.y*s|0;e.style.top=`${i.offsetTop+n}px`}}};class ue extends ne{constructor(){super(),this._$labelFrame=0,this._$timelineWidth=ue.DEFAULT_TIMELINE_WIDTH,this._$lightAll=!1,this._$lockAll=!1,this._$disableAll=!1}initialize(){super.initialize();const e=["timeline-layer-add","timeline-layer-trash","timeline-layer-light-all","timeline-layer-disable-all","timeline-layer-lock-all","timeline-script-add","timeline-frame-add","timeline-key-add","timeline-empty-add","timeline-frame-delete","timeline-onion-skin","timeline-preview","scene-list"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e)}))}const t=["label-name"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);r&&(r.addEventListener("focusin",(e=>{this.focusIn(e)})),r.addEventListener("keypress",(e=>{"Enter"===e.key&&e.target.blur()})),r.addEventListener("focusout",(e=>{this.executeFunction(e)})))}const r=document.getElementById("timeline-scale");r&&this.setInputEvent(r)}static get DEFAULT_TIMELINE_WIDTH(){return 12}get timelineWidth(){return this._$timelineWidth}set timelineWidth(e){this._$timelineWidth=e,document.documentElement.style.setProperty("--timeline-frame-width",`${e}px`),document.documentElement.style.setProperty("--marker-width",`${d.$clamp(e,4,ue.DEFAULT_TIMELINE_WIDTH)}px`),document.getElementById("timeline-scale").value=""+(e/ue.DEFAULT_TIMELINE_WIDTH*100|0),d.$timelineHeader.rebuild(),d.$timelineMarker.move()}focusIn(){super.focusIn(),this._$labelFrame=d.$timelineFrame.currentFrame}executeLabelName(e){if(!this._$labelFrame)return;const t=d.$timelineHeader.leftFrame;if(t>this._$labelFrame)return;const r=this._$labelFrame-t,a=document.getElementById("timeline-header").children[r].children[ce.MARKER_INDEX],i=e.target.value,s=d.$currentWorkSpace().scene;if(i)this.save(),s.setLabel(this._$labelFrame,i),a.setAttribute("class","frame-border-box-marker");else{s.getLabel(this._$labelFrame)&&(this.save(),s.deleteLabel(this._$labelFrame),a.setAttribute("class","frame-border-box"))}super.focusOut(),this._$labelFrame=0}changeTimelineScale(e){return e=d.$clamp(0|e,41,2e3),this.timelineWidth=ue.DEFAULT_TIMELINE_WIDTH*e/100,d.$timelineHeader._$currentFrame=-1,d.$timelineHeader.rebuild(),d.$timelineMarker.move(),d.$timelineLayer.moveTimeLine(),e}executeTimelineLayerLockAll(){this._$lockAll=!this._$lockAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene;let r=!1;const a=e.children.length;for(let i=0;i<a;++i){const a=0|e.children[i].dataset.layerId,s=document.getElementById(`layer-lock-icon-${a}`),n=t.getLayer(a);n.mode===I.MASK&&(r=!0),this._$lockAll?(s.classList.remove("icon-disable"),s.classList.add("icon-active"),n.lock=!0):(s.classList.remove("icon-active"),s.classList.add("icon-disable"),n.lock=!1),r&&this.reloadScreen()}d.$tools.getDefaultTool("arrow").clear()}executeTimelineLayerDisableAll(){this._$disableAll=!this._$disableAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene,r=e.children.length;for(let a=0;a<r;++a){const r=0|e.children[a].dataset.layerId,i=document.getElementById(`layer-disable-icon-${r}`),s=t.getLayer(r);this._$disableAll?(i.classList.remove("icon-disable"),i.classList.add("icon-active"),s.disable=!0):(i.classList.remove("icon-active"),i.classList.add("icon-disable"),s.disable=!1);d.$tools.getDefaultTool("arrow").clear(),this.reloadScreen()}}executeTimelineLayerLightAll(){this._$lightAll=!this._$lightAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene,r=e.children.length;for(let a=0;a<r;++a){const r=0|e.children[a].dataset.layerId,i=document.getElementById(`layer-light-icon-${r}`),s=document.getElementById(`layer-id-${r}`),n=t.getLayer(r);this._$lightAll?(i.classList.remove("icon-disable"),i.classList.add("light-icon-active"),s.style.borderBottom=`1px solid ${n.color}`,n.light=!0):(i.classList.remove("light-icon-active"),i.classList.add("icon-disable"),s.style.borderBottom="",n.light=!1)}}executeTimelineLayerTrash(){const e=d.$timelineLayer.targetLayers;if(e.size){this.save();const t=d.$currentWorkSpace().scene,r=document.getElementById("timeline-content");let a=Array.from(r.children).indexOf(d.$timelineLayer.targetLayer),i=!1;const s=d.$timelineFrame.currentFrame;for(const a of e.values()){const e=Array.from(r.children).indexOf(a),n=0|a.dataset.layerId,o=t.getLayer(n),l=r.children;switch(o.mode){case I.MASK:for(let r=e+1;r<l.length;++r){const e=l[r],a=t.getLayer(0|e.dataset.layerId);if(a.mode!==I.MASK_IN)break;a.mode=I.NORMAL,a.showIcon()}break;case I.GUIDE:for(let r=e+1;r<l.length;++r){const e=l[r],a=t.getLayer(0|e.dataset.layerId);if(a.mode!==I.GUIDE_IN)break;a.mode=I.NORMAL,a.showIcon()}}o.getActiveCharacter(s).length&&(i=!0),a.remove(),t.deleteLayer(n)}if(d.$tools.getDefaultTool("arrow").clear(),r.children.length){let e=null;for(;;)if(e=r.children[a--],e){d.$timelineLayer.activeLayer(e);break}}d.$timelineLayer.moveTimeLine(),d.$timelineScroll.updateHeight(),i&&this.reloadScreen()}}executeTimelineLayerAdd(e,t=null){this.save();const r=d.$timelineLayer.targetLayer||document.getElementById("timeline-content").children[0],a=d.$currentWorkSpace().scene;if(a.addLayer(t),r){const e=document.getElementById("timeline-content"),t=a.getLayer(0|r.dataset.layerId),i=e.lastElementChild;switch(t.mode){case I.MASK_IN:{const e=a.getLayer(0|i.dataset.layerId);e.maskId=null===t.maskId?t.id:t.maskId,e.mode=I.MASK_IN,e.showIcon()}break;case I.GUIDE_IN:{const e=a.getLayer(0|i.dataset.layerId);e.guideId=null===t.guideId?t.id:t.guideId,e.mode=I.GUIDE_IN,e.showIcon()}}e.insertBefore(i,r);const s=r.lastElementChild.scrollLeft;s&&(i.lastElementChild.scrollLeft=s);const n=[];for(let t=0;t<e.children.length;++t)n.push(a.getLayer(0|e.children[t].dataset.layerId));a.clearLayer();for(let e=0;e<n.length;++e){const t=n[e];a.setLayer(t.id,t)}d.$timelineLayer.moveTimeLine(),d.$timelineScroll.updateHeight()}super.focusOut(e)}executeTimelineScriptAdd(e){d.$javaScriptEditor.show(e)}executeTimelineFrameAdd(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=this.getFirstFrame(),r=d.$currentWorkSpace().scene;for(const[a,i]of e){const e=t+i.length,s=r.getLayer(a),n=s.getChildren(t);if(n){if("empty"===n.dataset.frameState){let t=!1,r=1;for(let e=0;e<s._$characters.length;++e)r=Math.max(s._$characters[e].endFrame-1,r);for(let e=0;e<s._$emptys.length;++e)r=Math.max(s._$emptys[e].endFrame-1,r);const a=s.getActiveCharacter(r);if(a.length){for(let t=0;t<a.length;++t){const i=a[t],s=i.getRange(r);if(i.hasTween(s.startFrame)){i.getTween(s.startFrame).endFrame=e,i.updateTweenPlace(s.startFrame,e),i.relocationTween(s.startFrame)}i.endFrame=e}t=!0}const i=s.getActiveEmptyCharacter(r);!t&&i&&(i.endFrame=e,t=!0),t||s.addEmptyCharacter(new f({startFrame:r,endFrame:e}))}else{for(let e=0;e<s._$characters.length;++e){const r=s._$characters[e];t>=r.startFrame||r.move(i.length)}for(let e=0;e<s._$emptys.length;++e){const r=s._$emptys[e];t>=r.startFrame||r.move(i.length)}const e=s.getActiveCharacter(t);if(e.length)for(let r=0;r<e.length;++r){const a=e[r],s=a.getRange(t),n=new Map;for(const[e,t]of a._$places)s.startFrame>e||e>=s.startFrame&&s.endFrame>e?n.set(e,t):(t.frame=e+i.length,t.tweenFrame&&(t.tweenFrame+=i.length),n.set(t.frame,t));if(a._$places=n,a._$tween.size){const e=new Map;for(const[t,r]of a._$tween)s.startFrame>=t?e.set(t,r):(r.startFrame+=i.length,r.endFrame+=i.length,e.set(r.startFrame,r));if(a._$tween=e,a.hasTween(s.startFrame)){a.getTween(s.startFrame).endFrame+=i.length,a.updateTweenPlace(s.startFrame,s.endFrame+i.length),a.relocationTween(s.startFrame)}}a.endFrame+=i.length}else{const e=s.getActiveEmptyCharacter(t);e&&(e.endFrame+=i.length)}}s.reloadStyle()}}this.setActiveFrame(),this.reloadScreen(),super.focusOut()}executeTimelineKeyAdd(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene;for(const a of e.keys()){const e=r.getLayer(a),i=e.getActiveCharacter(t);if(i.length)for(let e=0;e<i.length;++e){const r=i[e];if(r.hasPlace(t)){const e=r.getPlace(t);if(e.tweenFrame){const a=r.getRange(t),i=r.getTween(e.tweenFrame);i.endFrame=t,r.setTween(t,{method:i.method,curve:[],custom:d.$tweenController.createEasingObject(),startFrame:t,endFrame:a.endFrame}),r.updateTweenPlace(t,a.endFrame),d.$tweenController.relocationPlace(r,t),d.$tweenController.clearPointer().relocationPointer()}}else r.setPlace(t,r.getClonePlace(t))}else this.addEmptyCharacter(e);e.reloadStyle()}this.setActiveFrame(),this.reloadScreen(),super.focusOut()}executeTimelineKeyDelete(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=d.$currentWorkSpace().scene,r=this.getFirstFrame();for(const a of e.keys()){const e=t.getLayer(a);if(!e._$characters.length&&!e._$emptys.length)continue;const i=e.totalFrame,s=e.getActiveCharacter(r);if(s.length){for(let t=0;t<s.length;++t){const a=s[t];if(!a.hasPlace(r))continue;const i=a.getPlace(r);if(!i.tweenFrame||i.tweenFrame===r){if(a.hasTween(r)){const e=a.getTween(r);switch(!0){case a.startFrame===e.startFrame&&a.endFrame===e.endFrame:a._$places.clear();break;case a.startFrame===e.startFrame:for(let t=e.startFrame;t<e.endFrame;++t)a.deletePlace(t);break;default:{const t=a.getRange(e.startFrame-1);if(a.hasTween(t.startFrame)){for(let r=e.startFrame;r<e.endFrame;++r){a.getPlace(r).tweenFrame=t.startFrame}a.getTween(t.startFrame).endFrame=e.endFrame,a.updateTweenFilter(t.startFrame),a.updateTweenBlend(t.startFrame),a.relocationTween(t.startFrame)}else for(let t=e.startFrame;t<e.endFrame;++t)a.deletePlace(t)}}a.deleteTween(r)}else a.deletePlace(r);if(a._$places.size){if(r===a.startFrame){let e=a.endFrame;for(const t of a._$places.keys())e=Math.min(e,t);a.startFrame=e}}else e.deleteCharacter(a.id)}}e.getActiveCharacter(r).length||this.adjustmentKeyFrame(e,r,i),e.reloadStyle();continue}const n=e.getActiveEmptyCharacter(r);n&&n.startFrame===r&&(e.deleteEmptyCharacter(n),this.adjustmentKeyFrame(e,r,i),e.reloadStyle())}this.setActiveFrame(),d.$timelineLayer.activeCharacter(),this.reloadScreen(),super.focusOut()}executeTimelineEmptyAdd(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;d.$tools.getDefaultTool("arrow").clearActiveElement(),this.save();const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene;for(const a of e.keys()){const e=r.getLayer(a),i=e.getActiveCharacter(t);if(i.length){const r=e.getChildren(t);if("key-frame"===r.dataset.frameState){d.$fadeIn({currentTarget:{dataset:{detail:"{{キーフレームに空のキーフレームを追加できません}}"}},pageX:r.offsetLeft,pageY:r.offsetTop});continue}let a=Number.MAX_VALUE;for(let e=0;e<i.length;++e){const r=i[e];a=Math.min(a,r.endFrame);for(let e of r._$places.keys())t>e||(a=Math.min(a,e))}for(let r=0;r<i.length;++r){const s=i[r];s.split(e,t,a),s.endFrame>a&&e.addCharacter(s.split(e,a,s.endFrame))}const s=new f;s.startFrame=t,s.endFrame=a,e.addEmptyCharacter(s)}else this.addEmptyCharacter(e);e.reloadStyle()}this.setActiveFrame(),this.reloadScreen(),super.focusOut()}addEmptyCharacter(e){const t=d.$timelineFrame.currentFrame,r=e.getActiveEmptyCharacter(t);if(r){const a=e.getChildren(t);if(a&&"empty-key-frame"===a.dataset.frameState)return;r.startFrame!==t&&(e.addEmptyCharacter(new f({startFrame:t,endFrame:r.endFrame})),r.endFrame=t)}else{if(t>1){let r=1;for(let t=0;t<e._$characters.length;++t)r=Math.max(e._$characters[t].endFrame-1,r);for(let t=0;t<e._$emptys.length;++t)r=Math.max(e._$emptys[t].endFrame-1,r);const a=e.getActiveCharacter(r);if(a.length)for(let e=0;e<a.length;++e){a[e].endFrame=t}else{const a=e.getActiveEmptyCharacter(r);a?a.endFrame=t:e.addEmptyCharacter(new f({startFrame:r,endFrame:t}))}}const r=new f;r.startFrame=t,r.endFrame=t+1,e.addEmptyCharacter(r)}}executeTimelineFrameDelete(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=this.getFirstFrame(),r=d.$currentWorkSpace().scene;for(const[a,i]of e){const e=r.getLayer(a),s=e.getChildren(t);if(!s||"empty"===s.dataset.frameState)continue;const n=e.getActiveCharacter(t);let o=0;if(n.length)for(let r=0;r<n.length;++r){const a=n[r],s=a.getRange(t);if(a.hasPlace(t)&&i.length>=s.endFrame-s.startFrame){if(a.hasTween(t)){for(let e=s.startFrame;e<s.endFrame;++e)a.deletePlace(e);a.deleteTween(t),d.$tweenController.clearPointer()}a.deletePlace(t)}if(o=Math.min(s.endFrame,t+i.length)-t,a._$places.size){const e=new Map;for(const[t,r]of a._$places)s.startFrame>t?e.set(t,r):t>=s.startFrame&&s.endFrame>t?(s.endFrame-o>t&&e.set(t,r),s.endFrame-1===t&&e.set(s.endFrame-o-1,r)):(r.frame=t-o,r.tweenFrame&&(r.tweenFrame-=o),e.set(r.frame,r));if(a._$places=e,a._$tween.size){const e=new Map;for(const[t,r]of a._$tween)s.startFrame>=t?(s.startFrame===t&&(r.endFrame-=o),e.set(t,r)):(r.startFrame-=o,r.endFrame-=o,e.set(r.startFrame,r));a._$tween=e,a.relocationTween(s.startFrame)}a.endFrame-=o}else e.deleteCharacter(a.id)}else{const r=e.getActiveEmptyCharacter(t);if(r){const a=r.endFrame-r.startFrame;o=Math.min(r.endFrame,t+i.length)-t,o>=a?e.deleteEmptyCharacter(r):r.endFrame-=o}}for(let r=0;r<e._$characters.length;++r){const a=e._$characters[r];t>=a.startFrame||a.move(-o)}for(let r=0;r<e._$emptys.length;++r){const a=e._$emptys[r];t>=a.startFrame||a.move(-o)}e.reloadStyle()}this.setActiveFrame(),d.$timelineLayer.activeCharacter(),this.reloadScreen(),super.focusOut()}executeTimelineOnionSkin(){const e=document.getElementById("timeline-onion-skin");if(e.classList.contains("onion-skin-active")){e.classList.remove("onion-skin-active");const t=d.$currentWorkSpace().scene._$layers;for(const e of t.values())for(let t=0;t<e._$characters.length;++t)e._$characters[t].dispose()}else e.classList.add("onion-skin-active");this.reloadScreen()}executeTimelinePreview(){const e=document.getElementById("timeline-preview");e.classList.contains("timeline-preview-active")?e.classList.remove("timeline-preview-active"):e.classList.add("timeline-preview-active")}executeSceneList(e){if(!document.getElementById("scene-name-menu-list").children.length)return;const t=document.getElementById("scene-name-menu");if(t.classList.contains("fadeIn"))t.setAttribute("class","fadeOut");else{const r=e.currentTarget;t.style.left=`${r.offsetLeft+r.offsetWidth}px`,t.style.top=`${r.offsetTop+10}px`,t.setAttribute("class","fadeIn"),d.$endMenu("scene-name-menu")}}setActiveFrame(){const e=this.timelineWidth,t=d.$timelineHeader.width/(e+1)|0,r=d.$timelineHeader.leftFrame,a=r+t,i=d.$currentWorkSpace().scene;for(const[e,t]of d.$timelineLayer.targetFrames){const s=i.getLayer(e);for(let e=0;e<t.length;++e){const i=t[e];if(r>i)continue;if(i>a)continue;const n=s.getChildren(i);n&&n.classList.add("frame-active")}}}adjustmentKeyFrame(e,t,r){if(t>1){let a=r;for(let i=1;r>t+i;++i){const r=t+i;if(e.getActiveCharacter(r).length){a=r;break}if(e.getActiveEmptyCharacter(r)){a=r;break}}for(let r=1;t-r>0;++r){const i=t-r,s=e.getActiveCharacter(i);if(s.length){for(let e=0;e<s.length;++e){const t=s[e],r=t.endFrame-1;if(t.hasPlace(r)){const e=t.getPlace(r);if(e.tweenFrame){t.getTween(e.tweenFrame).endFrame=a;for(let e=r+1;a>e;++e)t.setPlace(e,t.getClonePlace(r));d.$tweenController.relocationPlace(t,r)}}s[e].endFrame=a}break}const n=e.getActiveEmptyCharacter(i);if(n){n.endFrame=a;break}}}else if(e._$characters.length||e._$emptys.length)for(let t=1;;++t){const r=1+t,a=e.getActiveCharacter(r);if(a.length){for(let e=0;e<a.length;++e){const t=a[e];let r=t.endFrame;for(let e of t._$places.keys())r=Math.min(r,e);const i=t.getPlace(r);t.deletePlace(r),t.setPlace(1,i),t.startFrame=1}break}const i=e.getActiveEmptyCharacter(r);if(i){i.startFrame=1;break}}else e.addEmptyCharacter(new f({startFrame:t,endFrame:r}))}getFirstFrame(){if(!d.$timelineLayer.targetFrame)return 1;const e=d.$timelineLayer.targetFrames.values().next().value;let t=Number.MAX_VALUE;for(let r=0;r<e.length;++r)t=Math.min(t,e[r]);return t}}d.$timelineTool=new ue;class me extends N{constructor(){super(),this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),d.$initializeEnd()}executeFunction(e){d.$endMenu();this[`execute${e.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`]()}}d.$sceneChange=new class extends me{initialize(){super.initialize()}reload(e){const t=document.getElementById("scene-name-menu-list");for(;t.children.length;)t.children[0].remove();d.$currentWorkSpace().root.addSceneName(),d.$sceneChange.execute(e)}execute(e){const t=d.$currentWorkSpace(),r=t.getLibrary(e),a=r.currentFrame;d.$timelineFrame.currentFrame=a,d.$timelineMarker.move();const i=document.getElementById("timeline-controller-base"),s=(a-1)*(d.$timelineTool.timelineWidth+1);s>i.offsetWidth/2&&d.$timelineLayer.moveTimeLine(s-i.offsetWidth/2),t.scene=r}};d.$screen=new class extends me{initialize(){super.initialize();const e=document.getElementById("screen");e&&(e.addEventListener("contextmenu",(e=>{d.$screenMenu.show(e)})),e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(e=>{e.preventDefault(),this.drop(e)})),e.addEventListener("mousedown",(e=>{if(e.button)return;d.$canCopyLayer=!1,d.$endMenu();const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(Y.MOUSE_DOWN,e))})),e.addEventListener("dblclick",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(Y.DBL_CLICK,e))})),e.addEventListener("mouseleave",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(Y.MOUSE_LEAVE,e)),document.getElementById("stage-rect").style.display="none",document.getElementById("draw-rect").style.display="none",d.$setCursor("auto")})),e.addEventListener("mousewheel",(e=>{if(e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey){const t=e.deltaX||e.deltaY;return t&&(e.preventDefault(),window.requestAnimationFrame((()=>{d.$screenZoom.execute(t/100*-1)}))),!1}}),{passive:!1}),e.addEventListener("mousemove",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,window.requestAnimationFrame((()=>{t.dispatchEvent(Y.MOUSE_MOVE,e)})))})),e.addEventListener("mouseup",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(Y.MOUSE_UP,e))})))}drop(e){const t=d.$libraryController.activeInstances;if(!t.size)return;const r=d.$currentWorkSpace(),a=r.scene;d.$timelineLayer.attachLayer();const i=0|d.$timelineLayer.targetLayer.dataset.layerId,s=a.getLayer(i);if(s.lock)return;const n=d.$timelineFrame.currentFrame;this.save();const o=[],l=[];for(const e of t.keys()){const t=r.getLibrary(e);if(t&&t.id!==a.id)switch(t.type){case b.SOUND:o.push(e);break;case b.FOLDER:t.getInstanceIds(l);break;default:l.push(e)}}if(o.length){a.hasSound(n)||a.setSound(n,[]);const e=a.getSound(n);for(let t=0;t<o.length;++t){const a=r.getLibrary(o[t]);e.push({characterId:a.id,name:a.name,volume:100,autoPlay:!1,loopCount:0})}d.$soundController.setIcon(n),d.$soundController.createSoundElements()}const c=s.getActiveCharacter(n);if(c.length){const e=c[0],t=e.getRange(n);if(e.hasTween(t.startFrame))return}if(l.length){const t=e.offsetX-d.$offsetLeft,a=e.offsetY-d.$offsetTop,i=s.adjustmentLocation(n),o=i.endFrame,c=i.startFrame;for(let e=0;e<l.length;++e){const n=l[e],h={start:null,end:null},u=s._$characters;for(let e=0;e<u.length;++e){const t=u[e];if(t.libraryId===n)switch(!0){case c>1&&t.endFrame===c:h.start=t;break;case t.startFrame===o:h.end=t}}const m=r.getLibrary(n),g={frame:i.startFrame,matrix:[1,0,0,1,t/d.$zoomScale,a/d.$zoomScale],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:s._$characters.length,point:{x:t/d.$zoomScale,y:a/d.$zoomScale}};m.type===b.MOVIE_CLIP&&(g.loop=d.$getDefaultLoopConfig());let p=null;if(h.start&&(p=h.start,p.endFrame=o),h.end)if(p){p.endFrame=h.end.endFrame;for(let[e,t]of h.end._$places)p.setPlace(e,t);for(let[e,t]of h.end._$tween)p.setTween(e,t);s.deleteCharacter(h.end.id)}else p=h.end,p.startFrame=c;p?p.setPlace(c,g):(p=new $,p.libraryId=n,p.startFrame=c,p.endFrame=o,p.setPlace(c,g),s.addCharacter(p));let f=0,y=0;if(m.type===b.MOVIE_CLIP){const e=m.getBounds([1,0,0,1,0,0]);f=e.xMin,y=e.yMin}let _=p.width;_||(_=10);let v=p.height;v||(v=10),f+=_/2,y+=v/2,g.matrix[4]-=f,g.matrix[5]-=y}s.reloadStyle(),this.reloadScreen()}this._$saved=!1}appendOnionCharacter(e,t){const r=d.$currentWorkSpace().scene,a=document.createElement("div");a.dataset.child="true",a.dataset.preview="true";const i=d.$getCanvas(),s=e._$context;e._$context=null;const n=e.draw(i);a.appendChild(n),e._$context=s,n.style.width=n._$width*d.$zoomScale+"px",n.style.height=n._$height*d.$zoomScale+"px",n.style.left=`${e.offsetX}px`,n.style.top=`${e.offsetY}px`;let o="";const l=r.getLayer(t);if(null!==l.maskId){const t=r.getLayer(l.maskId);if(t||(l.maskId=null),t&&t.lock&&t._$characters.length){const r=t._$characters[0];r.dispose();const a=d.$getCanvas(),i=r.draw(a),s=(r.screenX-e.screenX)*d.$zoomScale,l=(r.screenY-e.screenY)*d.$zoomScale,c=i.toDataURL(),h=i._$width*d.$zoomScale,u=i._$height*d.$zoomScale;o+=`mask: url(${c}), none;`,o+=`-webkit-mask: url(${c}), none;`,o+=`mask-size: ${h}px ${u}px;`,o+=`-webkit-mask-size: ${h}px ${u}px;`,o+="mask-repeat: no-repeat;",o+="-webkit-mask-repeat: no-repeat;",o+=`mask-position: ${s}px ${l}px;`,o+=`-webkit-mask-position: ${s}px ${l}px;`,o+=`mix-blend-mode: ${n.style.mixBlendMode};`,o+=`filter: ${n.style.filter};`}}o+="position: absolute;",o+="pointer-events: none;",o+="opacity: 0.25;";o+=`left: ${d.$offsetLeft+e.screenX*d.$zoomScale}px;`,o+=`top: ${d.$offsetTop+e.screenY*d.$zoomScale}px;`,a.setAttribute("style",o),document.getElementById("stage-area").appendChild(a)}appendCharacter(e,t,r,a="auto"){const i=d.$currentWorkSpace(),s=i.scene,n=e.getPlace(t),o=i.getLibrary(e.libraryId);if(!o)return;let l=e.libraryId===d.$changeLibraryId;switch(o.type){case b.MOVIE_CLIP:o.totalFrame>1&&e._$currentFrame!==t&&(l=!0,e._$currentFrame=t);break;case b.VIDEO:e._$currentFrame!==t&&(l=!0,e._$currentFrame=t)}if(n!==e._$currentPlace){if(e._$currentPlace){const t=n.matrix,r=e._$currentPlace.matrix;switch(!0){case t[0]!==r[0]:case t[1]!==r[1]:case t[2]!==r[2]:case t[3]!==r[3]:l=!0;break;default:e._$screenX+=-r[4]+t[4],e._$screenY+=-r[5]+t[5]}if(!l){const t=n.colorTransform,r=e._$currentPlace.colorTransform;switch(!0){case t[0]!==r[0]:case t[1]!==r[1]:case t[2]!==r[2]:case t[3]!==r[3]:case t[4]!==r[4]:case t[5]!==r[5]:case t[6]!==r[6]:case t[7]!==r[7]:l=!0}}if(l||n.blendMode===e._$currentPlace.blendMode||(l=!0),!l&&(e._$currentPlace.filter.length!==n.filter.length&&(l=!0),!l))for(let t=0;t<n.filter.length;++t){const r=n.filter[t],a=e._$currentPlace[t];if(!r||!a){l=!0;break}if(a.constructor!==r.constructor){l=!0;break}if(!a.isSame(r)){l=!0;break}}}e._$currentPlace=n}l&&e.dispose();const c=document.createElement("div"),h=e.draw(d.$getCanvas());c.appendChild(h),c.id=`character-${e.id}`,c.dataset.characterId=`${e.id}`,c.dataset.layerId=`${r}`,c.dataset.instanceType=o.type,c.dataset.libraryId=`${e.libraryId}`,c.dataset.child="true",c.dataset.pointer=`${a}`;let u="position: absolute;";u+=`pointer-events: ${a};`,c.addEventListener("mouseover",(e=>{e.stopPropagation();const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(Y.MOUSE_OVER,e))})),c.addEventListener("mouseout",(e=>{e.stopPropagation();const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(Y.MOUSE_OUT,e))})),c.addEventListener("mousedown",(e=>{if(e.button)return;e.stopPropagation();const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(Y.MOUSE_DOWN,e))}));let m=e.width*d.$zoomScale;m||(m=10);let g=e.height*d.$zoomScale;g||(g=10),u+=`width: ${Math.ceil(m)}px;`,u+=`height: ${Math.ceil(g)}px;`;const p=e.getBounds();u+=`left: ${d.$offsetLeft+p.xMin*d.$zoomScale}px;`,u+=`top: ${d.$offsetTop+p.yMin*d.$zoomScale}px;`;let $=h.getAttribute("style");$+=`width: ${h._$width*d.$zoomScale}px;`,$+=`height: ${h._$height*d.$zoomScale}px;`,e.offsetX&&($+=`left: ${e.offsetX*d.$zoomScale}px;`),e.offsetY&&($+=`top: ${e.offsetY*d.$zoomScale}px;`),h.setAttribute("style",$);const f=s.getLayer(r);if(null!==f.maskId){const t=s.getLayer(f.maskId);if(t||(f.maskId=null),t&&t.lock&&t._$characters.length){const r=t._$characters[0];r.dispose();const a=r.draw(d.$getCanvas()),i=(r.screenX-e.screenX)*d.$zoomScale,s=(r.screenY-e.screenY)*d.$zoomScale,n=a.toDataURL(),o=a._$width*d.$zoomScale,l=a._$height*d.$zoomScale;u+=`mask: url(${n}), none;`,u+=`-webkit-mask: url(${n}), none;`,u+=`mask-size: ${o}px ${l}px;`,u+=`-webkit-mask-size: ${o}px ${l}px;`,u+="mask-repeat: no-repeat;",u+="-webkit-mask-repeat: no-repeat;",u+=`mask-position: ${i}px ${s}px;`,u+=`-webkit-mask-position: ${i}px ${s}px;`,u+=`mix-blend-mode: ${image.style.mixBlendMode};`,u+=`filter: ${image.style.filter};`}}switch(c.setAttribute("style",u),o._$type){case b.MOVIE_CLIP:c.addEventListener("dblclick",(e=>{e.stopPropagation(),d.$currentWorkSpace().scene.addSceneName(),d.$sceneChange.execute(0|e.currentTarget.dataset.libraryId)}));break;case b.TEXT:{const e=document.createElement("div");e.style.width=m-2+"px",e.style.height=g-2+"px",e.style.pointerEvents="none",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.border=o._$border?"1px solid gray":"1px dashed gray",c.appendChild(e),c.addEventListener("dblclick",(e=>{e.stopPropagation(),d.$tools.reset();const t=document.getElementById("stage-area").children;for(let e=0;e<t.length;++e){t[e].style.pointerEvents="none"}const a=e.currentTarget;a.style.pointerEvents="";const s=a.firstChild;s.remove();const n=window.document.createElement("textarea");a.style.display="none",a.parentNode.appendChild(n);const o=d.$currentWorkSpace().scene,l=0|a.dataset.layerId,c=o.getLayer(l),h=0|a.dataset.characterId,u=c.getCharacter(h),m=i.getLibrary(u.libraryId);n.value=m._$text,n.style.border=m._$border?"1px solid gray":"1px dashed gray",n.style.fontSize=`${m._$size}px`,n.style.fontFamily=m._$font,n.style.width=parseFloat(s.style.width)-4+"px",n.style.height=`${parseFloat(s.style.height)}px`,n.style.position="absolute",n.style.left=a.style.left,n.style.top=a.style.top,n.style.pointerEvents="auto",m._$border||(n.style.backgroundColor="transparent"),n.dataset.characterId=`${u.id}`,n.dataset.layerId=`${r}`,n.dataset.libraryId=`${u.libraryId}`,n.dataset.child="true",m._$multiline||n.addEventListener("keydown",(e=>{if("Enter"===e.key)return e.preventDefault(),!1})),n.addEventListener("focusin",(()=>{d.$keyLock=!0})),n.addEventListener("focusout",(e=>{const t=e.target,r=d.$currentWorkSpace().scene,a=0|t.dataset.layerId,s=r.getLayer(a),n=0|t.dataset.characterId,o=s.getCharacter(n);i.getLibrary(o.libraryId)._$text=t.value,o.dispose(),d.$keyLock=!1;const l=document.getElementById("stage-area").children;for(let e=0;e<l.length;++e){l[e].style.pointerEvents=""}const c=d.$timelineFrame.currentFrame;r.changeFrame(c)})),n.focus()}))}}document.getElementById("stage-area").appendChild(c)}clearStageArea(){const e=document.getElementById("stage-area");if(!e)return;let t=0;for(;e.children.length>t;){const r=e.children[t];r.dataset.child?r.remove():t++}}};d.$screenKeyboardCommand=new class extends R{constructor(){super("screen"),this._$state="close",this._$prevTool=null,this._$activeTool=null,this._$endHandTool=null}initialize(){super.initialize();const e=document.getElementById("screen");e&&(e.addEventListener("mouseleave",(()=>{this.active=!1})),e.addEventListener("mouseover",(()=>{this.active||(this.active=!0)}))),this._$endHandTool=this.endHandTool.bind(this),this.add(" ",this.startHandTool.bind(this));const t=["v","a","p","t","k","o","r","z"];this._$activeTool=this.activeTool.bind(this);for(let e=0;e<t.length;++e)this.add(t[e],this._$activeTool);this.add(d.$generateShortcutKey("r",{shift:!0}),this._$activeTool),this.add("s",this.userSetting.bind(this));const r=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"];for(let e=0;e<r.length;++e){const t=r[e];this.add(t,this.executeMoveDisplayObject),this.add(d.$generateShortcutKey(t,{shift:!0}),this.executeMoveDisplayObject)}this.add(d.$generateShortcutKey("r",{ctrl:!0}),(()=>{d.$shiftKey=!1,d.$ctrlKey=!1,d.$altKey=!1,d.$project.open()})),this.add(d.$generateShortcutKey("s",{ctrl:!0,shift:!0}),d.$project.save),this.add("Backspace",this.deleteDisplayObject),this.add(d.$generateShortcutKey("p",{ctrl:!0,shift:!0}),this.deleteTweenCurvePointer),this.add(d.$generateShortcutKey("ArrowUp",{ctrl:!0,shift:!0}),this.screenFront),this.add(d.$generateShortcutKey("ArrowUp",{ctrl:!0}),this.screenFrontOne),this.add(d.$generateShortcutKey("ArrowDown",{ctrl:!0,shift:!0}),this.screenBack),this.add(d.$generateShortcutKey("ArrowDown",{ctrl:!0}),this.screenBackOne),this.add("1",this.screenPositionLeft),this.add(d.$generateShortcutKey("!",{shift:!0}),this.stagePositionLeft),this.add("2",this.screenPositionCenter),this.add(d.$generateShortcutKey('"',{shift:!0}),this.stagePositionCenter),this.add("3",this.screenPositionRight),this.add(d.$generateShortcutKey("#",{shift:!0}),this.stagePositionRight),this.add("4",this.screenPositionTop),this.add(d.$generateShortcutKey("$",{shift:!0}),this.stagePositionTop),this.add("5",this.screenPositionMiddle),this.add(d.$generateShortcutKey("%",{shift:!0}),this.stagePositionMiddle),this.add("6",this.screenPositionBottom),this.add(d.$generateShortcutKey("&",{shift:!0}),this.stagePositionBottom),this.add(d.$generateShortcutKey("d",{ctrl:!0}),this.distributeToLayers),this.add(d.$generateShortcutKey("k",{ctrl:!0}),this.distributeToKeyframes),this.add(d.$generateShortcutKey("i",{ctrl:!0}),this.integratingPaths),this.add(d.$generateShortcutKey("p",{ctrl:!0}),(()=>{d.$tweenController.addCurvePinter()})),this.add(d.$generateShortcutKey("m",{shift:!0}),(()=>{d.$screenMenu.executeScreenChangeMovieClip()}))}integratingPaths(){d.$screenMenu.executeScreenIntegratingPaths()}distributeToKeyframes(){d.$screenMenu.executeScreenDistributeToKeyframes()}distributeToLayers(){d.$screenMenu.executeScreenDistributeToLayers()}screenPositionBottom(){d.$screenMenu.alignment("bottom")}stagePositionBottom(){d.$screenMenu.alignment("bottom","stage")}screenPositionMiddle(){d.$screenMenu.alignment("middle")}stagePositionMiddle(){d.$screenMenu.alignment("middle","stage")}screenPositionTop(){d.$screenMenu.alignment("top")}stagePositionTop(){d.$screenMenu.alignment("top","stage")}screenPositionCenter(){d.$screenMenu.alignment("center")}stagePositionCenter(){d.$screenMenu.alignment("center","stage")}stagePositionRight(){d.$screenMenu.alignment("right","stage")}screenPositionRight(){d.$screenMenu.alignment("right")}stagePositionLeft(){d.$screenMenu.alignment("left","stage")}screenPositionLeft(){d.$screenMenu.alignment("left")}screenBack(){d.$screenMenu.changeDepth("down")}screenBackOne(){d.$screenMenu.changeDepthOne("down")}screenFront(){d.$screenMenu.changeDepth("up")}screenFrontOne(){d.$screenMenu.changeDepthOne("up")}deleteTweenCurvePointer(){d.$tweenController.deleteCurvePointer()}deleteDisplayObject(){d.$tools.getDefaultTool("arrow").deleteDisplayObject()}userSetting(){const e=document.getElementById("user-setting");"show"===this._$state||e.classList.contains("fadeIn")?(this._$state="close",d.$endMenu()):(this._$state="show",d.$userSetting.show())}activeTool(e){let t="";switch(e){case"v":t="arrow";break;case"a":t="transform";break;case"p":t="pen";break;case"t":t="text";break;case"z":t="zoom";break;case"k":t="bucket";break;case"r":t="rectangle";break;case"o":t="circle";break;case"rShift":t="round-rect"}if(t){const e=d.$tools.activeTool;e&&e.dispatchEvent(Y.END);const r=d.$tools.getDefaultTool(t);r.dispatchEvent(Y.START),d.$tools.activeTool=r}}startHandTool(){if("hand"===d.$tools.activeTool.name)return;this._$prevTool=d.$tools.activeTool,this._$prevTool&&this._$prevTool.dispatchEvent(Y.END);const e=d.$tools.getDefaultTool("hand");e.dispatchEvent(Y.START),d.$tools.activeTool=e,d.$tools.getDefaultTool("arrow").endRect(),window.addEventListener("keyup",this._$endHandTool)}endHandTool(e){if(" "!==e.key)return;window.removeEventListener("keyup",this._$endHandTool);d.$tools.getDefaultTool("hand").dispatchEvent(Y.END),this._$prevTool?(this._$prevTool.dispatchEvent(Y.START),d.$tools.activeTool=this._$prevTool,this._$prevTool=null):d.$tools.reset()}executeMoveDisplayObject(e){const t=d.$tools.getDefaultTool("arrow");if(t.activeElements.length){switch(e){case"ArrowRight":case"ArrowRightShift":t.pageX=d.$shiftKey?10:1,t.pageY=0;break;case"ArrowLeft":case"ArrowLeftShift":t.pageX=d.$shiftKey?-10:-1,t.pageY=0;break;case"ArrowUp":case"ArrowUpShift":t.pageX=0,t.pageY=d.$shiftKey?-10:-1;break;case"ArrowDown":case"ArrowDownShift":t.pageX=0,t.pageY=d.$shiftKey?10:1;break;default:return}t.moveDisplayObject(),t._$saved=!1}}};d.$screenMenu=new class extends me{constructor(){super(),this._$state="hide"}initialize(){super.initialize();const e=["screen-front","screen-front-one","screen-back-one","screen-back","screen-position-left","screen-position-right","screen-position-center","screen-position-top","screen-position-middle","screen-position-bottom","stage-position-left","stage-position-right","stage-position-center","stage-position-top","stage-position-middle","stage-position-bottom","screen-distribute-to-layers","screen-distribute-to-keyframes","screen-integrating-paths","screen-add-tween-curve-pointer","screen-delete-tween-curve-pointer","screen-change-movie-clip","screen-preview"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e.target.id)}))}}executeScreenPreview(){d.$showPreview()}executeScreenDistributeToLayers(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;this.save();const t=[],r=d.$timelineFrame.currentFrame,a=new Map,i=d.$currentWorkSpace().scene;for(let s=0;s<e.length;++s){const n=e[s],o=i.getLayer(0|n.dataset.layerId);if(!o)continue;const l=o.getCharacter(0|n.dataset.characterId);if(!l)continue;const c=l.getRange(r);a.has(o.id)||a.set(o.id,{layer:o,range:c});const d=l.getPlace(c.startFrame);d.depth=0,t.push({libraryId:l.libraryId,place:d,startFrame:c.startFrame,endFrame:c.endFrame}),l.remove(o)}for(const e of a.values()){const t=e.layer,a=e.range,i=t.getActiveCharacter(a.startFrame);if(i.length){t.sort(i,r);for(let e=0;e<i.length;++e)i[e].getPlace(r).depth=e}else t.addEmptyCharacter(new f({startFrame:a.startFrame,endFrame:a.endFrame}));t.reloadStyle()}d.$timelineLayer.clear();const s=d.$ctrlKey;d.$ctrlKey=!0;for(let e=0;e<t.length;++e){const r=t[e],a=new $;a.libraryId=r.libraryId,a.startFrame=r.startFrame,a.endFrame=r.endFrame,a.setPlace(r.startFrame,r.place);const s=new v;s.addCharacter(a),r.startFrame>1&&s.addEmptyCharacter(new f({startFrame:1,endFrame:r.startFrame})),i.addLayer(s),d.$timelineLayer.activeLayer(document.getElementById(`layer-id-${s.id}`))}this.reloadScreen(),d.$timelineLayer.activeCharacter(),d.$ctrlKey=s,this._$saved=!1}executeScreenDistributeToKeyframes(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;this.save();const t=d.$currentWorkSpace().scene;let r=d.$timelineFrame.currentFrame;const a=new Map;for(const i of e.values()){const e=t.getLayer(0|i.dataset.layerId),s=e.getCharacter(0|i.dataset.characterId);a.has(e.id)||a.set(e.id,{range:s.getRange(r),characters:[]}),a.get(e.id).characters.push(s)}for(const[e,i]of a){let a=i.characters;if(1===a.length)continue;const s=t.getLayer(e),n=i.range,o=s.getActiveCharacter(r),l=n.endFrame-n.startFrame;switch(!0){case a.length!==o.length:{const e=new Map,t=[];for(let r=0;r<o.length;++r){const i=o[r],l=a.indexOf(i),c=i.split(s,n.startFrame,n.endFrame);l>-1&&e.set(c.id,l),t.push(c)}for(let e=0;e<s._$characters.length;++e){const t=s._$characters[e];if(!(n.endFrame>t.endFrame))if(t.startFrame>n.startFrame)t.move(a.length);else{const e=new Map;for(const[r,i]of t._$places)r>n.startFrame&&(i.frame=r+a.length),e.set(i.frame,i);t._$places=e,t.endFrame+=a.length}}for(let e=0;s._$emptys.length>e;++e){const t=s._$emptys[e];n.startFrame>t.startFrame||t.move(a.length)}r=n.endFrame,n.startFrame=n.endFrame,n.endFrame+=a.length;const i=[];for(let r=0;r<t.length;++r){const a=t[r];if(e.has(a.id))a.setPlace(n.startFrame,a.getPlace(a.startFrame)),a.deletePlace(a.startFrame),a.startFrame=n.startFrame,a.endFrame=n.endFrame,s.addCharacter(a),i.push(a);else for(let e=0;e<s._$characters.length;++e){const t=s._$characters[e];if(t.libraryId===a.libraryId&&t.endFrame===a.startFrame){for(const[e,r]of a._$places)t.setPlace(e,r);t.endFrame=a.endFrame;break}}}a=i}break;case a.length>l:{const e=a.length-l;for(let t=0;s._$characters.length>t;++t){const r=s._$characters[t];if(!(n.endFrame>=r.endFrame))if(r.startFrame>n.endFrame)r.move(e);else{const t=new Map;for(const[a,i]of r._$places)a>=n.endFrame&&(i.frame=a+e),t.set(i.frame,i);r._$places=t,r.endFrame+=e}}for(let t=0;s._$emptys.length>t;++t){const r=s._$emptys[t];n.endFrame>=r.endFrame||r.move(e)}n.endFrame+=e}break;case l>a.length:{const e=l-a.length;for(let t=0;s._$characters.length>t;++t){const r=s._$characters[t];if(!(n.endFrame>r.endFrame))if(r.startFrame>n.endFrame)r.move(-e);else{const t=new Map;for(const[a,i]of r._$places)a>=n.endFrame&&(i.frame=a-e),t.set(i.frame,i);r._$places=t,r.endFrame-=e}}for(let t=0;s._$emptys.length>t;++t){const r=s._$emptys[t];n.startFrame>r.startFrame||r.move(-e)}n.endFrame-=e}}a.sort(((e,t)=>{const a=e.getPlace(r).depth,i=t.getPlace(r).depth;switch(!0){case a>i:return 1;case a<i:return-1;default:return 0}}));let c=n.startFrame;for(let e=0;e<a.length;++e){let t=a[e];1!==t._$places.size&&(t=t.split(s,n.startFrame,n.endFrame),s.addCharacter(t));const i=t.getPlace(r);let o=!1;for(let e=0;e<s._$characters.length;++e){const r=s._$characters[e];if(r.id!==t.id&&(r.libraryId===t.libraryId&&r.endFrame===c)){s.deleteCharacter(t.id),r.endFrame=c+1,r.setPlace(c,i),o=!0;break}}if(o)c++;else{for(let e=0;e<s._$characters.length;++e){const r=s._$characters[e];if(r.id!==t.id&&(r.libraryId===t.libraryId&&r.startFrame===c+1)){s.deleteCharacter(t.id),r.startFrame=c,r.setPlace(c,i),o=!0;break}}o||(t.startFrame=c,t.endFrame=c+1,t.deletePlace(i.frame),t.setPlace(c,i)),c++}}s.reloadStyle()}this.reloadScreen(),this._$saved=!1}executeScreenIntegratingPaths(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;this.save();const t=d.$currentWorkSpace(),r=t.scene,a=d.$timelineFrame.currentFrame;let i=null,s=null,n=0;for(let o=0;o<e.length;++o){const l=e[o];if(l.dataset.instanceType!==b.SHAPE)continue;const c=t.getLibrary(0|l.dataset.libraryId),d=r.getLayer(0|l.dataset.layerId).getCharacter(0|l.dataset.characterId),{Graphics:h}=window.next2d.display;if(!i){s=d,i=c;for(let e=0;i._$recodes.length>e;){switch(i._$recodes[e++]){case h.BEGIN_PATH:break;case h.MOVE_TO:case h.LINE_TO:e+=2;break;case h.CURVE_TO:e+=4;break;case h.CUBIC:e+=6;break;case h.FILL_STYLE:case h.GRADIENT_FILL:case h.STROKE_STYLE:case h.GRADIENT_STROKE:n=e-1;case h.CLOSE_PATH:case h.END_STROKE:case h.END_FILL:}if(n)break}continue}const u=s.screenX-i._$bounds.xMin-d.screenX,m=s.screenY-i._$bounds.yMin-d.screenY,g=d.getPlace(a).matrix,p=[];let $=!1;for(let e=0;c._$recodes.length>e;){switch(c._$recodes[e++]){case h.BEGIN_PATH:break;case h.MOVE_TO:{const t=c._$recodes[e++],r=c._$recodes[e++];p.push(h.MOVE_TO,t*g[0]+r*g[2]-u,t*g[1]+r*g[3]-m)}break;case h.LINE_TO:{const t=c._$recodes[e++],r=c._$recodes[e++];p.push(h.LINE_TO,t*g[0]+r*g[2]-u,t*g[1]+r*g[3]-m)}break;case h.CURVE_TO:{const t=c._$recodes[e++],r=c._$recodes[e++],a=c._$recodes[e++],i=c._$recodes[e++];p.push(h.CURVE_TO,t*g[0]+r*g[2]-u,t*g[1]+r*g[3]-m,a*g[0]+i*g[2]-u,a*g[1]+i*g[3]-m)}break;case h.CUBIC:{const t=c._$recodes[e++],r=c._$recodes[e++],a=c._$recodes[e++],i=c._$recodes[e++],s=c._$recodes[e++],n=c._$recodes[e++];p.push(h.CUBIC,t*g[0]+r*g[2]-u,t*g[1]+r*g[3]-m,a*g[0]+i*g[2]-u,a*g[1]+i*g[3]-m,s*g[0]+n*g[2]-u,s*g[1]+n*g[3]-m)}break;case h.FILL_STYLE:case h.GRADIENT_FILL:case h.STROKE_STYLE:case h.GRADIENT_STROKE:$=!0,Array.prototype.splice.apply(i._$recodes,[n,0].concat(p)),n+=p.length;case h.CLOSE_PATH:case h.END_STROKE:case h.END_FILL:}if($)break}}if(i){const e=i.reloadBounds();i._$bounds.xMin=e.xMin,i._$bounds.xMax=e.xMax,i._$bounds.yMin=e.yMin,i._$bounds.yMax=e.yMax,i.cacheClear(),this.reloadScreen()}this._$saved=!1}executeScreenChangeMovieClip(){const e=d.$tools.getDefaultTool("arrow"),t=e.activeElements;if(!t.length)return;if(!d.$timelineLayer.targetLayer)return;this.save();const r=d.$currentWorkSpace(),a=r.scene,i=d.$timelineFrame.currentFrame,s=r.nextLibraryId,n=r.addLibrary(d.$libraryController.createInstance(b.MOVIE_CLIP,`MovieClip_${s}`,s)),o=new v;n.setLayer(0,o);const l=+document.getElementById("object-x").value,c=+document.getElementById("object-y").value,h=l+ +document.getElementById("object-width").value/2,u=c+ +document.getElementById("object-height").value/2,m=new Map;for(let e=0;e<t.length;++e){const r=t[e],s=a.getLayer(0|r.dataset.layerId),n=s.getCharacter(0|r.dataset.characterId),l=n.getRange(i);m.has(s.id)||m.set(s.id,{layer:s,range:l});const c=new $;c.libraryId=n.libraryId;const g=n.getPlace(l.startFrame),p={frame:1,matrix:g.matrix.slice(),colorTransform:g.colorTransform.slice(),blendMode:g.blendMode,filter:g.filter.slice(),loop:d.$getDefaultLoopConfig(),depth:o._$characters.length};g.loop&&(p.loop=g.loop),c.setPlace(1,p),c.x-=h,c.y-=u,o.addCharacter(c),n.remove(s)}for(const e of m.values()){const t=e.layer,r=e.range,a=t.getActiveCharacter(r.startFrame);if(a.length){t.sort(a,i);for(let e=0;e<a.length;++e)a[e].getPlace(i).depth=e}else t.addEmptyCharacter(new f({startFrame:r.startFrame,endFrame:r.endFrame}));t.reloadStyle()}e.clearActiveElement();const g=new $;g.libraryId=n.id,g.endFrame=i+1,g.setPlace(i,{frame:i,matrix:[1,0,0,1,h/d.$zoomScale,u/d.$zoomScale],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:0,loop:d.$getDefaultLoopConfig()});const p=new v;p.addCharacter(g),a.addLayer(p),i>1&&p.addEmptyCharacter(new f({startFrame:1,endFrame:i})),p.reloadStyle(),this.reloadScreen(),this._$saved=!1}executeScreenAddTweenCurvePointer(){d.$tweenController.addCurvePinter()}executeScreenDeleteTweenCurvePointer(){d.$tweenController.deleteCurvePointer()}executeScreenFront(){this.changeDepth("up")}executeScreenBack(){this.changeDepth("down")}executeScreenFrontOne(){this.changeDepthOne("up")}executeScreenBackOne(){this.changeDepthOne("down")}executeStagePositionLeft(){this.alignment("left","stage")}executeScreenPositionLeft(){this.alignment("left")}executeStagePositionCenter(){this.alignment("center","stage")}executeScreenPositionCenter(){this.alignment("center")}executeStagePositionRight(){this.alignment("right","stage")}executeScreenPositionRight(){this.alignment("right")}executeStagePositionTop(){this.alignment("top","stage")}executeScreenPositionTop(){this.alignment("top")}executeStagePositionMiddle(){this.alignment("middle","stage")}executeScreenPositionMiddle(){this.alignment("middle")}executeStagePositionBottom(){this.alignment("bottom","stage")}executeScreenPositionBottom(){this.alignment("bottom")}alignment(e,t="rect"){const r=d.$tools.getDefaultTool("arrow").activeElements;if(!r.length||"rect"===t&&2>r.length)return;this.save();const a=d.$currentWorkSpace(),i=a.stage;let s=0,n=0,o=0,l=0;if("rect"===t){const e=document.getElementById("target-rect");s=e.offsetLeft-d.$offsetLeft,n=e.offsetTop-d.$offsetTop,o=e.offsetWidth,l=e.offsetHeight}else o=i.width,l=i.height;const c=d.$timelineFrame.currentFrame,h=a.scene;for(let t=0;t<r.length;++t){const a=r[t],i=h.getLayer(0|a.dataset.layerId);if(!i||i.lock||i.disable)continue;const d=i.getCharacter(0|a.dataset.characterId),u=d.getPlace(c).point;switch(e){case"left":if(d.x===d.screenX)u.x+=s-d.x,d.x=s;else{const e=s-d.screenX+d.x;u.x+=e-d.x,d.x=e}break;case"right":if(d.x===d.screenX){const e=s+o-d.width;u.x+=e-d.x,d.x=e}else{const e=s+o-d.width-d.screenX+d.x;u.x+=e-d.x,d.x=e}break;case"center":if(d.x===d.screenX){const e=s+o/2-d.width/2;u.x+=e-d.x,d.x=e}else{const e=s+o/2-d.width/2-d.screenX+d.x;u.x+=e-d.x,d.x=e}break;case"top":if(d.y===d.screenY)u.y+=n-d.y,d.y=n;else{const e=n-d.screenY+d.y;u.y+=e-d.y,d.y=e}break;case"bottom":if(d.y===d.screenY){const e=n+l-d.height;u.y+=e-d.y,d.y=n+l-d.height}else{const e=n+l-d.height-d.screenY+d.y;u.y+=e-d.y,d.y=n+l-d.height-d.screenY+d.y}break;case"middle":if(d.y===d.screenY){const e=n+l/2-d.height/2;u.y+=e-d.y,d.y=n+l/2-d.height/2}else{const e=n+l/2-d.height/2-d.screenY+d.y;u.y+=e-d.y,d.y=n+l/2-d.height/2-d.screenY+d.y}}}d.$transformController.relocation(),this._$saved=!1}changeDepthOne(e="up"){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;this.save();const r=d.$currentWorkSpace().scene,a=d.$timelineFrame.currentFrame,i=new Map;for(let e=0;e<t.length;++e){const a=t[e],s=r.getLayer(0|a.dataset.layerId);i.has(s.id)||i.set(s.id,[]),i.get(s.id).push(s.getCharacter(0|a.dataset.characterId))}for(const[t,s]of i){const i=r.getLayer(t).getActiveCharacter(a);if(1>=i.length)continue;i.sort(((e,t)=>{const r=e.getPlace(a).depth,i=t.getPlace(a).depth;switch(!0){case r>i:return-1;case r<i:return 1;default:return 0}})),s.length>1&&("up"===e?s.sort(((e,t)=>{const r=e.getPlace(a).depth,i=t.getPlace(a).depth;switch(!0){case r>i:return-1;case r<i:return 1;default:return 0}})):s.sort(((e,t)=>{const r=e.getPlace(a).depth,i=t.getPlace(a).depth;switch(!0){case r>i:return 1;case r<i:return-1;default:return 0}})));let n=0,o=i.length-1;for(let t=0;t<s.length;++t){const r=s[t],l=r.getPlace(a);if("up"===e){if(l.depth>=o){--o;continue}l.depth++;const e=i.indexOf(r);i[e-1].getPlace(a).depth--}else{if(n>=l.depth){++n;continue}l.depth--;const e=i.indexOf(r);i[e+1].getPlace(a).depth++}i.sort(((e,t)=>{const r=e.getPlace(a).depth,i=t.getPlace(a).depth;switch(!0){case r>i:return-1;case r<i:return 1;default:return 0}}))}}this.reloadScreen(),this._$saved=!1}changeDepth(e="up"){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;this.save();const r=d.$currentWorkSpace().scene,a=d.$timelineFrame.currentFrame,i=new Map;for(let e=0;e<t.length;++e){const a=t[e],s=r.getLayer(0|a.dataset.layerId);i.has(s.id)||i.set(s.id,[]),i.get(s.id).push(s.getCharacter(0|a.dataset.characterId))}for(const[t,s]of i){const i=r.getLayer(t).getActiveCharacter(a);if(1>=i.length)continue;i.sort(((e,t)=>{const r=e.getPlace(a).depth,i=t.getPlace(a).depth;switch(!0){case r>i:return-1;case r<i:return 1;default:return 0}})),s.length>1&&("up"===e?s.sort(((e,t)=>{const r=e.getPlace(a).depth,i=t.getPlace(a).depth;switch(!0){case r>i:return-1;case r<i:return 1;default:return 0}})):s.sort(((e,t)=>{const r=e.getPlace(a).depth,i=t.getPlace(a).depth;switch(!0){case r>i:return 1;case r<i:return-1;default:return 0}})));const n=new Map;let o=0,l=i.length-1;for(let t=0;t<s.length;++t){const r=s[t],c=r.getPlace(a);if("up"===e){if(c.depth>=l){--l;continue}c.depth=l--,n.set(r.id,!0);let e=l;for(let t=0;i.length>t;++t){const r=i[t];if(!n.has(r.id)&&(r.getPlace(a).depth=e--,-1===e))break}}else{if(o>=c.depth){++o;continue}c.depth=o++,n.set(r.id,!0);let e=o;for(let t=i.length-1;t>-1;--t){const r=i[t];if(!n.has(r.id)&&(r.getPlace(a).depth=e++,e===i.length))break}}}}this.reloadScreen(),this._$saved=!1}show(e){d.$endMenu("screen-menu");const t=document.getElementById("screen-menu"),r=t.clientHeight/2+15;if(t.style.left=`${e.pageX+5}px`,t.style.top=e.pageY-r+"px",15>t.offsetTop&&(t.style.top="10px"),e.pageY+r>window.innerHeight){const a=window.innerHeight-(e.pageY+r-15);t.style.top=`${t.offsetTop+a}px`}t.setAttribute("class","fadeIn")}};d.$screenTab=new class{constructor(){this._$dropTab=null,this._$saved=!1}run(){for(let e=0;e<d.$workSpaces.length;++e)this.createElement(d.$workSpaces[e],e);const e=document.getElementById("view-tab-add");e&&e.addEventListener("click",(e=>{this.addTab(e)}));const t=document.getElementById("view-tab-list");t&&t.addEventListener("mousedown",(e=>{this.showTabList(e)}))}showTabList(e){e.stopPropagation();const t=document.getElementById("tab-name-menu");if(t.classList.contains("fadeIn"))return d.$endMenu();d.$endMenu("tab-name-menu");const r=e.currentTarget;t.style.left=`${r.offsetLeft+r.offsetWidth}px`,t.style.top=`${r.offsetTop+25}px`,t.setAttribute("class","fadeIn")}createElement(e,t){e.name||(e.name=`Untitled-${t+1}`);const r=document.getElementById("view-tab-area");if(!r)return;r.insertAdjacentHTML("beforeend",`\n<div draggable="true" id="tab-id-${t}" data-tab-id="${t}" class="tab">\n    <p id="tab-text-id-${t}" data-tab-id="${t}" data-detail="{{タブの移動・名前を変更}}" data-shortcut-key="ArrowLeftCtrl" data-shortcut-text="Ctrl + ◀︎ or ▶" data-area="global">${e.name}</p>\n    <input type="text" id="tab-input-id-${t}" data-tab-id="${t}" value="${e.name}">\n    <i id="tab-delete-id-${t}" data-tab-id="${t}" data-detail="{{プロジェクトを閉じる}}"></i>\n</div>`);const a=document.getElementById(`tab-id-${t}`);d.$addModalEvent(a),a.classList.add(d.$activeWorkSpaceId===t?"active":"disable"),a.addEventListener("mousedown",(e=>{this.activeTab(e)})),a.addEventListener("dragstart",(e=>{this.dragStart(e)})),a.addEventListener("dragover",(e=>{this.dragOver(e)})),a.addEventListener("dragleave",(e=>{this.dragLeave(e)})),a.addEventListener("drop",(e=>{this.drop(e)})),document.getElementById(`tab-delete-id-${t}`).addEventListener("click",(e=>{this.deleteTab(e)})),document.getElementById(`tab-text-id-${t}`).addEventListener("dblclick",(e=>{this.editStart(e)}));const i=document.getElementById(`tab-input-id-${t}`);i&&(i.style.display="none",i.addEventListener("focusout",(e=>{this.editEnd(e)})),i.addEventListener("keypress",(e=>{this.editEnd(e)}))),document.getElementById("tab-name-menu-list").insertAdjacentHTML("beforeend",`\n<div id="tab-menu-id-${t}" data-tab-id="${t}">${e.name}</div>`);const s=document.getElementById(`tab-menu-id-${t}`);s&&s.addEventListener("mousedown",(e=>{this.activeTab(e,!0)}))}drop(e){e.preventDefault(),this.save(),e.currentTarget.classList.remove("drop-target");const t=e.currentTarget.nextElementSibling;document.getElementById("view-tab-area").insertBefore(this._$dropTab,this._$dropTab===t?e.currentTarget:t),this._$dropTab=null,this._$saved=!1}dragLeave(e){e.preventDefault(),e.currentTarget.classList.remove("drop-target")}dragOver(e){e.preventDefault(),e.currentTarget.classList.add("drop-target")}dragStart(e){d.$endMenu(),this._$dropTab=e.currentTarget}activeTab(e,t=!1){d.$endMenu();const r=document.getElementById(`tab-id-${d.$activeWorkSpaceId}`);r&&(r.classList.remove("active"),r.classList.add("disable"));const a=0|e.currentTarget.dataset.tabId,i=document.getElementById(`tab-id-${a}`);if(i&&(i.classList.remove("disable"),i.classList.add("active"),t)){const e=document.getElementById("view-tab-area");i.remove(),e.prepend(i)}d.$activeWorkSpaceId!==a&&d.$changeWorkSpace(a)}deleteTab(e){e.preventDefault();const t=d.$currentLanguage.replace("{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}");if(!window.confirm(t))return;const r=0|e.currentTarget.dataset.tabId;d.$workSpaces[r]=null,document.getElementById(`tab-id-${r}`).remove(),document.getElementById(`tab-menu-id-${r}`).remove();const a=document.getElementById("library-preview-area");for(;a.children.length;)a.children[0].remove();d.$tools.getDefaultTool("arrow").clear();const i=document.getElementById("view-tab-area");if(i.children.length){if(d.$activeWorkSpaceId===r){const e=i.children[0];e.setAttribute("class","tab active"),d.$activeWorkSpaceId=0|e.dataset.tabId,d.$currentWorkSpace().run()}}else{d.$workSpaces.length=0,d.$activeWorkSpaceId=0;const e=new D;d.$workSpaces.push(e),this.createElement(e,0),e.run();i.children[0].setAttribute("class","tab active")}}editStart(e){d.$keyLock=!0;const t=e.currentTarget,r=0|t.dataset.tabId,a=document.getElementById(`tab-input-id-${r}`);if("none"===a.style.display){a.style.width=`${t.offsetWidth}px`,a.style.display="",t.style.display="none",a.focus();document.getElementById(`tab-id-${r}`).draggable=!1}}editEnd(e){if("Enter"!==e.key){if("focusout"===e.type){this.save();const t=e.currentTarget;t.style.display="none";const r=0|t.dataset.tabId,a=document.getElementById(`tab-text-id-${r}`),i=document.getElementById(`tab-menu-id-${r}`);d.$workSpaces[r].name=t.value,i.textContent=t.value,a.textContent=t.value,a.style.display="";document.getElementById(`tab-id-${r}`).draggable=!0,this._$saved=!1}}else e.target.blur()}addTab(e){d.$endMenu(),e.stopPropagation(),this.save();const t=d.$workSpaces.length,r=new D;d.$workSpaces.push(r),this.createElement(r,t),this._$saved=!1}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}};class ge extends me{constructor(){super(),this._$currentValue=0}static get MIN_LEVEL(){return.25}static get MAX_LEVEL(){return 5}initialize(){super.initialize();const e=document.getElementById("screen-scale");e&&this.setInputEvent(e)}changeScreenScale(e){return e=d.$clamp(0|e,100*ge.MIN_LEVEL,100*ge.MAX_LEVEL),this.execute((e-this._$currentValue)/100),this._$currentValue=e,e}execute(e){d.$zoomScale+=e,d.$zoomScale=Math.min(ge.MAX_LEVEL,Math.max(ge.MIN_LEVEL,d.$zoomScale)),document.getElementById("screen-scale").value=""+(100*d.$zoomScale|0);const t=d.$currentWorkSpace(),r=t.stage.width*d.$zoomScale,a=t.stage.height*d.$zoomScale,i=document.getElementById("screen"),s=document.getElementById("stage-area"),n=document.getElementById("stage"),o=i.clientWidth/(s.clientWidth/i.clientWidth),l=i.clientHeight/(s.clientHeight/i.clientHeight),c=i.scrollLeft/i.scrollWidth,h=i.scrollTop/i.scrollHeight;n.style.width=`${r}px`,n.style.height=`${a}px`,s.style.width=`${r+window.screen.width}px`,s.style.height=`${a+window.screen.height}px`;const u=i.clientWidth/(s.clientWidth/i.clientWidth),m=i.clientHeight/(s.clientHeight/i.clientHeight);i.scrollLeft=i.scrollWidth*c+(o-u),i.scrollTop=i.scrollHeight*h+(l-m);const g=d.$timelineFrame.currentFrame,p=t.scene;for(const e of p._$layers.values()){const t=e.getActiveCharacter(g);for(let e=0;e<t.length;++e)t[e].dispose()}p.changeFrame(g)}}d.$screenZoom=new ge;d.$blendController=new class extends ie{constructor(){super("blend")}initialize(){super.initialize(),this.setChangeEvent(document.getElementById("blend-select"))}changeBlendSelect(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const r=d.$currentWorkSpace().scene,a=t[0],i=r.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId),s=d.$timelineFrame.currentFrame;let n=i.getPlace(s);n.tweenFrame&&(i.endFrame-1>s&&!i.hasTween(s)&&(d.$timelineTool.executeTimelineKeyAdd(),n=i.getPlace(s)),n=i.getPlace(n.tweenFrame)),n.blendMode=`${e}`,n.tweenFrame&&i.updateTweenBlend(s),i.dispose()}};class pe extends ie{constructor(){super("color")}static get MIN_OFFSET(){return-255}static get MAX_OFFSET(){return 255}static get MIN_MULTIPLIER(){return 0}static get MAX_MULTIPLIER(){return 100}initialize(){super.initialize();const e=["color-alpha-offset","color-red-offset","color-green-offset","color-blue-offset","color-alpha-multiplier","color-red-multiplier","color-green-multiplier","color-blue-multiplier"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&this.setInputEvent(r)}}changeColorRedMultiplier(e){return e=d.$clamp(+e,pe.MIN_MULTIPLIER,pe.MAX_MULTIPLIER),this.updateColor(0,e/100),e}changeColorGreenMultiplier(e){return e=d.$clamp(+e,pe.MIN_MULTIPLIER,pe.MAX_MULTIPLIER),this.updateColor(1,e/100),e}changeColorBlueMultiplier(e){return e=d.$clamp(+e,pe.MIN_MULTIPLIER,pe.MAX_MULTIPLIER),this.updateColor(2,e/100),e}changeColorAlphaMultiplier(e){return e=d.$clamp(+e,pe.MIN_MULTIPLIER,pe.MAX_MULTIPLIER),this.updateColor(3,e/100),e}changeColorRedOffset(e){return e=d.$clamp(0|e,pe.MIN_OFFSET,pe.MAX_OFFSET),this.updateColor(4,e),e}changeColorGreenOffset(e){return e=d.$clamp(0|e,pe.MIN_OFFSET,pe.MAX_OFFSET),this.updateColor(5,e),e}changeColorBlueOffset(e){return e=d.$clamp(0|e,pe.MIN_OFFSET,pe.MAX_OFFSET),this.updateColor(6,e),e}changeColorAlphaOffset(e){return e=d.$clamp(0|e,pe.MIN_OFFSET,pe.MAX_OFFSET),this.updateColor(7,e),e}updateColor(e,t){const r=d.$tools.getDefaultTool("arrow").activeElements;if(!r.length)return;const a=d.$currentWorkSpace().scene,i=r[0],s=a.getLayer(0|i.dataset.layerId).getCharacter(0|i.dataset.characterId),n=d.$timelineFrame.currentFrame;s.getPlace(n).colorTransform[e]=t,s.relocationTween(n),s.dispose()}}d.$colorTransformController=new pe;d.$confirmModal=new class extends ie{constructor(){super(""),this._$files=[],this._$state="hide",this._$currentObject=null,this._$mapping=new Map,this._$layers=new Map}get files(){return this._$files}set files(e){this._$files=e}initialize(){super.initialize();const e=["confirm-overwriting","confirm-skip","confirm-all-overwriting","confirm-all-skip"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation();return this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}))}}executeConfirmAllOverwriting(){this.save();const e=[],t=d.$currentWorkSpace();this._$files.unshift(this._$currentObject);for(let r=0;r<this._$files.length;++r){const a=this._$files[r];if(!a)continue;const i=t._$nameMap.get(a.path);switch(a.type){case"move":this._$currentObject=a,this.moveOverwriting(i);break;case"copy":this._$currentObject=a,this.copyOverwriting(i);break;default:e.push(d.$libraryController.loadFile(a.file,a.folderId,a.file.name,i))}}return this._$currentObject=null,this._$files.length=0,Promise.all(e).then((()=>{this.hide(),d.$libraryController.reload(),this.reloadScreen(),this._$saved=!1}))}executeConfirmAllSkip(){this._$currentObject=null,this._$files.length=0,this.hide()}copyOverwriting(e=0,t=""){const r=d.$currentWorkSpace(),a=this._$currentObject.file;if(!this._$mapping.has(a.id)&&(this._$mapping.set(a.id,e||r.nextLibraryId),e)){const t=document.getElementById(`library-child-id-${e}`);t&&t.remove();for(const e of r._$libraries.values())if(e.type===b.MOVIE_CLIP)for(const t of e._$layers.values())for(let e=0;e<t._$characters.length;++e)t._$characters[e].dispose();r.removeLibrary(e)}const i=this._$mapping.get(a.id);if(this.addLayer(i),!r._$libraries.has(i)){const e=a.type===b.MOVIE_CLIP?d.$timelineMenu.cloneMovieClip(a):a.clone();a.type===b.MOVIE_CLIP&&d.$timelineMenu.setConfirmModalFiles(),e._$id=i,t&&(e._$name=t),e.folderId&&this._$mapping.has(e.folderId)&&(e.folderId=this._$mapping.get(e.folderId)),r._$libraries.set(e.id,e),d.$libraryController.createInstance(e.type,e.name,e.id,e.symbol)}}moveOverwriting(e){const t=d.$currentWorkSpace(),r=this._$currentObject.file,a=document.getElementById(`library-child-id-${e}`);a&&a.remove(),document.getElementById(`library-child-id-${r.id}`).remove(),t.removeLibrary(r.id);for(const a of t._$libraries.values())if(a.type===b.MOVIE_CLIP)for(const t of a._$layers.values())for(let a=0;a<t._$characters.length;++a){const i=t._$characters[a];i.libraryId===r.id&&(i.libraryId=e,i.dispose())}if(r.type===b.FOLDER)for(const a of t._$libraries.values())a.folderId===r.id&&(a.folderId=e);r._$id=e;const i=t.getLibrary(e);r.folderId=i.folderId,d.$libraryController.createInstance(r.type,r.name,e,r.symbol),t._$libraries.set(r.id,r);const s=d.$currentWorkSpace().scene;for(const e of s._$layers.values())for(let t=0;t<e._$characters.length;++t)e._$characters[t].dispose()}executeConfirmOverwriting(){this.save();const e=document.getElementById("confirm-file-name").value;let t=this._$currentObject.file.name;t.indexOf(".swf")>-1&&(t=t.replace(".swf",""));const r=d.$currentWorkSpace();let a=0;switch(e===t&&(a=r._$nameMap.get(this._$currentObject.path)),this._$currentObject.type){case"move":if(a)this.moveOverwriting(a);else{const t=this._$currentObject.file;t.name=e,t.folderId=this._$currentObject.folderId,t.type===b.FOLDER&&(this._$files.length=0),document.getElementById(`library-child-id-${t.id}`).remove(),d.$libraryController.createInstance(t.type,t.name,t.id,t.symbol)}this.setup();break;case"copy":this.copyOverwriting(a,e),this.setup();break;default:d.$libraryController.loadFile(this._$currentObject.file,this._$currentObject.folderId,e,a).then((()=>{this.setup()}))}this._$saved=!1}addLayer(e){const t=this._$currentObject.character;t.libraryId=e;const r=this._$currentObject.layer;r&&(r.addCharacter(t),this._$layers.has(r.id)||this._$layers.set(r.id,r))}executeConfirmSkip(){this.setup()}hide(){this._$state="hide";const e=document.getElementById("confirm-modal");e&&e.setAttribute("class","fadeOut")}show(){if("show"===this._$state)return;this._$state="show",d.$endMenu();const e=document.getElementById("confirm-modal");e&&e.setAttribute("class","fadeIn"),this.setup()}setup(){if(this._$currentObject=this._$files.shift(),this._$currentObject&&this._$mapping.size)for(;this._$mapping.has(this._$currentObject.file.id);){const e=this._$mapping.get(this._$currentObject.file.id);if(this.addLayer(e),this._$currentObject=this._$files.shift(),!this._$currentObject)break}if(!this._$currentObject){if(this.hide(),d.$libraryController.reload(),this._$mapping.clear(),this._$layers.size)for(const e of this._$layers.values())e.setCharacterStyle();return this._$layers.clear(),void this.reloadScreen()}const e=document.getElementById("confirm-before-preview");for(;e.firstChild;)e.firstChild.remove();const t=document.getElementById("confirm-after-preview");for(;t.firstChild;)t.firstChild.remove();const r=document.getElementById("confirm-file-name");let a=this._$currentObject.file.name;a.indexOf(".swf")>-1&&(a=a.replace(".swf","")),r.value=a,r.focus();const i=d.$currentWorkSpace(),s=i.getLibrary(i._$nameMap.get(this._$currentObject.path));s&&e.appendChild(s.getPreview());const n=this._$currentObject.file;switch(n.type){case"image/svg+xml":case"image/png":case"image/jpeg":case"image/gif":{const e=new Image;e.onload=()=>{t.appendChild(e)},e.src=URL.createObjectURL(n)}break;case"video/mp4":{const e=document.createElement("video");e.crossOrigin="anonymous",e.type="video/mp4",e.muted=!0,e.autoplay=!1,e.controls=!0,e.onloadedmetadata=()=>{t.appendChild(e)},e.src=URL.createObjectURL(n),e.load()}break;case"audio/mpeg":{const e=document.createElement("audio");e.preload="auto",e.autoplay=!1,e.loop=!1,e.controls=!0,e.src=URL.createObjectURL(n),e.load(),t.appendChild(e)}break;default:if("copy"===this._$currentObject.type){const e=d.$activeWorkSpaceId;d.$activeWorkSpaceId=this._$currentObject.workSpaceId,t.appendChild(this._$currentObject.file.getPreview()),d.$activeWorkSpaceId=e}else t.appendChild(this._$currentObject.file.getPreview())}}};d.$controller=new class extends ie{initialize(){super.initialize();const e=document.getElementById("controller");e&&e.addEventListener("mouseover",(()=>{d.$setCursor("auto")}))}showObjectSetting(e){for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.setAttribute("style","")}}hideObjectSetting(e){for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.setAttribute("style","display: none;")}}default(){d.$filterController.clearFilters(),this.hideObjectSetting(["object-area","instance-setting","fill-color-setting"]),this.showObjectSetting(["stage-setting","sound-setting","object-setting","color-setting","blend-setting","filter-setting"]);const e=d.$currentWorkSpace();if(!e)return;const t=e.scene;if(!t)return;const r=document.getElementById("object-name");r&&(r.value=t.name);const a=document.getElementById("object-symbol");a&&(a.value=t.symbol)}};class $e{constructor(){this._$pointX=0,this._$mouseMove=null,this._$mouseUp=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}static get DEFAULT_SIZE(){return 360}initialize(){document.documentElement.style.setProperty("--controller-width",`${$e.DEFAULT_SIZE}px`);const e=document.getElementById("controller-adjustment");e&&e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),d.$initializeEnd()}mouseDown(e){e.preventDefault(),e.stopPropagation(),this._$pointX=e.screenX,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){d.$setCursor("col-resize"),window.requestAnimationFrame((()=>{e.preventDefault(),e.stopPropagation();const t=d.$currentWorkSpace(),r=this._$pointX-e.screenX,a=Math.max($e.DEFAULT_SIZE,t._$controllerWidth+r);document.documentElement.style.setProperty("--controller-width",`${a}px`),t._$controllerWidth=a,this._$pointX=e.screenX,d.$rebuildTimeline()}))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto")}}d.$controllerAdjustment=new $e;class fe extends se{constructor(){super("filter"),this._$filterId=0,this._$filters=new Map}static get MIN_BLUR(){return 0}static get MAX_BLUR(){return 255}static get MIN_ALPHA(){return 0}static get MAX_ALPHA(){return 100}static get MIN_STRENGTH(){return 0}static get MAX_STRENGTH(){return 255}static get MIN_ROTATE(){return-360}static get MAX_ROTATE(){return 360}static get MIN_DISTANCE(){return-255}static get MAX_DISTANCE(){return 255}static get MIN_COLOR(){return 0}static get MAX_COLOR(){return 16777215}static get MIN_QUALITY(){return 0}static get MAX_QUALITY(){return 16}initialize(){super.initialize();const e=document.getElementById("filter-add");e&&e.addEventListener("mousedown",(()=>{this.addFilter(),this.disposeCharacterImage(),this.reloadScreen()}))}lock(e){e.preventDefault(),e.stopPropagation();const t=0|e.currentTarget.dataset.filterId;if(!this._$filters.has(t))return;const r=this._$filters.get(t);r.lock=!r.lock,this._$currentValue=null,e.currentTarget.childNodes[1].setAttribute("class",r.lock?"active":"disable")}clickNodeTitle(e){const t=0|e.target.dataset.filterId,r=document.getElementById(`filter-view-area-${t}`);"none"===r.style.display?(r.style.display="",document.getElementById(`filter-title-arrow-${t}`).setAttribute("class","arrow active")):(r.style.display="none",document.getElementById(`filter-title-arrow-${t}`).setAttribute("class","arrow disable"))}changeState(e){const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;const r=this._$filters.get(t);r.filter.state=!r.filter.state,document.getElementById(`filter-state-${t}`).setAttribute("class",r.filter.state?"filter-active":"filter-disable"),this.disposeCharacterImage()}removeFilter(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const r=0|e.target.dataset.filterId,a=t[0],i=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId),s=d.$timelineFrame.currentFrame;let n=i.getPlace(s);n.tweenFrame&&(i.endFrame-1>s&&!i.hasTween(s)&&(d.$timelineTool.executeTimelineKeyAdd(),n=i.getPlace(s)),n=i.getPlace(n.tweenFrame));const o=this._$filters.get(r),l=n.filter.indexOf(o.filter);n.filter.splice(l,1),i.updateTweenFilter(s),this._$filters.delete(r),this._$filters.size||(document.querySelectorAll(".filter-none")[0].style.display=""),document.getElementById(`filter-id-${r}`).remove(),super.focusOut(),i.dispose()}focusIn(e){super.focusIn(e),this.setLockElement(e)}mouseDown(e){super.mouseDown(e),this.setLockElement(e)}setLockElement(e){if(this._$focus)return;const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;if(this._$filters.get(t).lock)switch(this._$currentTarget.dataset.name){case"blurX":this._$lockTarget=document.getElementById(`blurY-${t}`);break;case"blurY":this._$lockTarget=document.getElementById(`blurX-${t}`)}}changeBlurX(e){return e=d.$clamp(+e,fe.MIN_BLUR,fe.MAX_BLUR),this.updateProperty("blurX",e),e}changeBlurY(e){return e=d.$clamp(+e,fe.MIN_BLUR,fe.MAX_BLUR),this.updateProperty("blurY",e),e}changeStrength(e){return e=d.$clamp(+e,fe.MIN_STRENGTH,fe.MAX_STRENGTH),this.updateProperty("strength",e),e}changeAlpha(e){return e=d.$clamp(+e,fe.MIN_ALPHA,fe.MAX_ALPHA),this.updateProperty("alpha",e),e}changeShadowAlpha(e){return e=d.$clamp(+e,fe.MIN_ALPHA,fe.MAX_ALPHA),this.updateProperty("shadowAlpha",e),e}changeHighlightAlpha(e){return e=d.$clamp(+e,fe.MIN_ALPHA,fe.MAX_ALPHA),this.updateProperty("highlightAlpha",e),e}changeAngle(e){return 0>(e=d.$clamp((0|e)%360,fe.MIN_ROTATE,fe.MAX_ROTATE))&&(e+=360),this.updateProperty("angle",e),e}changeDistance(e){return e=d.$clamp(+e,fe.MIN_DISTANCE,fe.MAX_DISTANCE),this.updateProperty("distance",e),e}changeColor(e){return this.updateProperty("color",d.$clamp(0|`0x${e.slice(1)}`,fe.MIN_COLOR,fe.MAX_COLOR)),e}changeShadowColor(e){return this.updateProperty("shadowColor",d.$clamp(0|`0x${e.slice(1)}`,fe.MIN_COLOR,fe.MAX_COLOR)),e}changeHighlightColor(e){return this.updateProperty("highlightColor",d.$clamp(0|`0x${e.slice(1)}`,fe.MIN_COLOR,fe.MAX_COLOR)),e}changeQuality(e){e=d.$clamp(0|e,fe.MIN_QUALITY,fe.MAX_QUALITY),this.updateProperty("quality",e)}changeType(e){switch(e){case"inner":case"outer":case"full":this.updateProperty("type",e)}}changeKnockout(){this.updateProperty("knockout",this._$currentTarget.checked)}changeInner(){this.updateProperty("inner",this._$currentTarget.checked)}changeHideObject(){this.updateProperty("hideObject",this._$currentTarget.checked)}updateProperty(e,t){const r=0|this._$currentTarget.dataset.filterId;if(!this._$filters.has(r))return;const a=this._$filters.get(r);a.filter[e]!==t&&(a.filter[e]=t,this.disposeCharacterImage())}disposeCharacterImage(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;const t=e[0],r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);r.relocationTween(d.$timelineFrame.currentFrame),r.dispose()}setCommonEvent(e){this.setLockEvent(document.getElementById(`filter-${e}-lock`)),this.setTitleEvent(document.getElementById(`filter-name-${e}`)),this.setStateEvent(document.getElementById(`filter-state-${e}`)),this.setTrashEvent(document.getElementById(`trash-${e}`))}setLockEvent(e){e&&e.addEventListener("mousedown",(e=>{this.lock(e)}))}setTitleEvent(e){e&&e.addEventListener("mousedown",(e=>{this.clickNodeTitle(e)}))}setStateEvent(e){if(!e)return;const t=0|e.dataset.filterId;if(this._$filters.has(t)){const r=this._$filters.get(t);e.setAttribute("class",r.filter.state?"filter-active":"filter-disable")}e.addEventListener("mousedown",(e=>{this.save(),this.changeState(e),this.reloadScreen(),this._$saved=!1}))}setTrashEvent(e){e&&e.addEventListener("click",(e=>{this.removeFilter(e),this.reloadScreen()}))}addFilter(){document.querySelectorAll(".filter-none")[0].style.display="none";this[`add${document.getElementById("filter-select").value}`](document.getElementById("filter-setting-list"))}clearFilters(){this._$filterId=0,this._$filters.clear();const e=document.getElementById("filter-setting-list");if(!e)return;const t=document.querySelectorAll(".filter-none")[0];for(;e.children.length;)e.children[0].remove();t.style.display="",e.appendChild(t)}createFilter(e,t=null){const r=this._$filterId++;if(!t){t=new e;const r=d.$tools.getDefaultTool("arrow").activeElements;if(!r.length)return;const a=r[0],i=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId),s=d.$timelineFrame.currentFrame;let n=i.getPlace(s);n.tweenFrame&&(i.endFrame-1>s&&!i.hasTween(s)&&(d.$timelineTool.executeTimelineKeyAdd(),n=i.getPlace(s)),n=i.getPlace(n.tweenFrame)),n.filter.push(t),i.updateTweenFilter(s)}return this._$filters.set(r,{id:r,lock:!1,filter:t,context:null}),r}getFilterHeaderHTML(e,t){return`\n<div id="filter-id-${e}" class="filter-border">\n\n    <div class="filter-title">\n        <i id="filter-title-arrow-${e}" class="arrow active"></i>\n        <span id="filter-name-${e}" data-filter-id="${e}">${t}</span>\n        <i class="filter-active" id="filter-state-${e}" data-filter-id="${e}" data-detail="{{フィルターを表示・非表示する}}"></i>\n        <i class="trash" id="trash-${e}" data-filter-id="${e}" data-detail="{{フィルターを削除}}"></i>\n    </div>\n    \n    <div id="filter-view-area-${e}" class="filter-view-area">\n    \n        <div class="filter-view-area-left">\n        \n            <div id="filter-${e}-lock" data-filter-id="${e}" class="filter-lock">\n                ┌\n                <div class="disable" data-detail="{{比率を固定}}"></div>\n                └\n            </div>\n        \n        </div>\n`}addDropShadowFilter(e,t=null,r=!0){const a=this.createFilter(A,t);t||(t=this._$filters.get(a).filter);const i=this.getFilterHeaderHTML(a,"DropShadow")+`\n\n        <div class="filter-view-area-right">\n        \n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${a}" value="${t.blurX}" data-name="blurX" data-filter-id="${a}" data-detail="{{水平方向にぼかす}}"></div>\n                \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${a}" value="${t.strength}" data-filter-id="${a}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n    \n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${a}" value="${t.blurY}" data-name="blurY" data-filter-id="${a}" data-detail="{{垂直方向にぼかす}}"></div>\n                \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${a}" value="${t.angle}" data-filter-id="${a}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${a}" value="${t.distance}" data-filter-id="${a}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n    \n            <div class="filter-container">\n                <div class="filter-text">Shadow</div>\n                <div><input type="color" id="color-${a}" value="#${t.color.toString(16).padStart(6,"0")}" data-filter-id="${a}" data-name="color" data-detail="{{シャドウのカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="alpha-${a}" value="${t.alpha}" data-filter-id="${a}" data-name="alpha" data-detail="{{シャドウのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${a}" data-name="knockout" data-filter-id="${a}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${a}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div><input type="checkbox" id="inner-${a}" data-name="inner" data-filter-id="${a}"></div>\n                <div class="filter-text-long">\n                    <label for="inner-${a}">Inner Shadow</label>\n                </div>\n            </div>\n    \n            <div class="filter-container">\n                <div><input type="checkbox" id="hideObject-${a}" data-name="hideObject" data-filter-id="${a}"></div>\n                <div class="filter-text-long">\n                    <label for="hideObject-${a}">Hide Object</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${a}" data-name="quality" data-filter-id="${a}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div> \n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",i),this.setCommonEvent(a),t.knockout&&(document.getElementById(`knockout-${a}`).checked=!0),t.inner&&(document.getElementById(`inner-${a}`).checked=!0),t.hideObject&&(document.getElementById(`hideObject-${a}`).checked=!0);const s=[`blurX-${a}`,`blurY-${a}`,`strength-${a}`,`angle-${a}`,`alpha-${a}`,`distance-${a}`];for(let e=0;e<s.length;++e)this.setInputEvent(document.getElementById(s[e]));const n=[`knockout-${a}`,`inner-${a}`,`hideObject-${a}`];for(let e=0;e<n.length;++e)this.setClickEvent(document.getElementById(n[e]));const o=[`color-${a}`,`quality-${a}`];for(let e=0;e<o.length;++e)this.setChangeEvent(document.getElementById(o[e]));r&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}addBlurFilter(e,t=null,r=!0){const a=this.createFilter(k,t);t||(t=this._$filters.get(a).filter);const i=this.getFilterHeaderHTML(a,"Blur")+`\n    \n        <div class="filter-view-area-right">\n        \n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${a}" value="${t.blurX}" data-name="blurX" data-filter-id="${a}" data-detail="{{水平方向にぼかす}}"></div>\n            </div>\n        \n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${a}" value="${t.blurY}" data-name="blurY" data-filter-id="${a}" data-detail="{{垂直方向にぼかす}}"></div>\n            </div>\n        \n            <div class="filter-container">\n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${a}" data-name="quality" data-filter-id="${a}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div> \n        \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",i),this.setCommonEvent(a);const s=[`blurX-${a}`,`blurY-${a}`];for(let e=0;e<s.length;++e)this.setInputEvent(document.getElementById(s[e]));const n=[`quality-${a}`];for(let e=0;e<n.length;++e)this.setChangeEvent(document.getElementById(n[e]));r&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}addGlowFilter(e,t=null,r=!0){const a=this.createFilter(T,t);t||(t=this._$filters.get(a).filter);const i=this.getFilterHeaderHTML(a,"Glow")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${a}" value="${t.blurX}" data-name="blurX" data-filter-id="${a}" data-detail="{{水平方向にぼかす}}"></div>\n                \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${a}" value="${t.strength}" data-filter-id="${a}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${a}" value="${t.blurY}" data-name="blurY" data-filter-id="${a}" data-detail="{{垂直方向にぼかす}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Color</div>\n                <div><input type="color" id="color-${a}" value="#${t.color.toString(16).padStart(6,"0")}" data-filter-id="${a}" data-name="color" data-detail="{{シャドウのカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="alpha-${a}" value="${t.alpha}" data-filter-id="${a}" data-name="alpha" data-detail="{{シャドウのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="inner-${a}" data-name="inner" data-filter-id="${a}"></div>\n                <div class="filter-text-long">\n                    <label for="inner-${a}">Inner Glow</label>\n                </div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${a}" data-name="knockout" data-filter-id="${a}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${a}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${a}" data-name="quality" data-filter-id="${a}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div> \n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",i),this.setCommonEvent(a),t.knockout&&(document.getElementById(`knockout-${a}`).checked=!0),t.inner&&(document.getElementById(`inner-${a}`).checked=!0);const s=[`blurX-${a}`,`blurY-${a}`,`strength-${a}`,`alpha-${a}`,`distance-${a}`];for(let e=0;e<s.length;++e)this.setInputEvent(document.getElementById(s[e]));const n=[`knockout-${a}`,`inner-${a}`];for(let e=0;e<n.length;++e)this.setClickEvent(document.getElementById(n[e]));const o=[`color-${a}`,`quality-${a}`];for(let e=0;e<o.length;++e)this.setChangeEvent(document.getElementById(o[e]));r&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}addBevelFilter(e,t=null,r=!0){const a=this.createFilter(F,t);t||(t=this._$filters.get(a).filter);const i=this.getFilterHeaderHTML(a,"Bevel")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${a}" value="${t.blurX}" data-name="blurX" data-filter-id="${a}" data-detail="{{水平方向にぼかす}}"></div>\n                 \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${a}" value="${t.strength}" data-filter-id="${a}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${a}" value="${t.blurY}" data-name="blurY" data-filter-id="${a}" data-detail="{{垂直方向にぼかす}}"></div>\n                               \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${a}" value="${t.angle}" data-filter-id="${a}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${a}" value="${t.distance}" data-filter-id="${a}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Shadow<br>Color</div>\n                <div><input type="color" id="shadowColor-${a}" value="#${t.shadowColor.toString(16).padStart(6,"0")}" data-filter-id="${a}" data-name="shadowColor" data-detail="{{シャドウのカラー}}"></div>\n                \n                <div class="filter-text">Shadow<br>Alpha</div>\n                <div><input type="text" id="shadowAlpha-${a}" value="${t.shadowAlpha}" data-filter-id="${a}" data-name="shadowAlpha" data-detail="{{シャドウのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Highlight<br>Color</div>\n                <div><input type="color" id="highlightColor-${a}" value="#${t.highlightColor.toString(16).padStart(6,"0")}" data-filter-id="${a}" data-name="highlightColor" data-detail="{{ハイライトのカラー}}"></div>\n                \n                <div class="filter-text">Highlight<br>Alpha</div>\n                <div><input type="text" id="highlightAlpha-${a}" value="${t.highlightAlpha}" data-filter-id="${a}" data-name="highlightAlpha" data-detail="{{ハイライトのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${a}" data-name="knockout" data-filter-id="${a}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${a}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Type</div>\n                <div>\n                    <select id="type-${a}" data-name="type" data-filter-id="${a}">\n                        <option value="inner">Inner</option>\n                        <option value="outer">Outer</option>\n                        <option value="full">Full</option>\n                    </select>\n                </div>\n    \n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${a}" data-name="quality" data-filter-id="${a}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",i),this.setCommonEvent(a),t.knockout&&(document.getElementById(`knockout-${a}`).checked=!0);const s=[`blurX-${a}`,`blurY-${a}`,`strength-${a}`,`angle-${a}`,`shadowAlpha-${a}`,`highlightAlpha-${a}`,`distance-${a}`];for(let e=0;e<s.length;++e)this.setInputEvent(document.getElementById(s[e]));const n=[`knockout-${a}`];for(let e=0;e<n.length;++e)this.setClickEvent(document.getElementById(n[e]));const o=[`shadowColor-${a}`,`highlightColor-${a}`,`type-${a}`,`quality-${a}`];for(let e=0;e<o.length;++e)this.setChangeEvent(document.getElementById(o[e]));r&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}addGradientGlowFilter(e,t=null,r=!0){const a=this.createFilter(P,t);t||(t=this._$filters.get(a).filter);const i=this.getFilterHeaderHTML(a,"GradientGlow")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${a}" value="${t.blurX}" data-name="blurX" data-filter-id="${a}" data-detail="{{水平方向にぼかす}}"></div>\n                          \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${a}" value="${t.strength}" data-filter-id="${a}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${a}" value="${t.blurY}" data-name="blurY" data-filter-id="${a}" data-detail="{{垂直方向にぼかす}}"></div>\n            \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${a}" value="${t.angle}" data-filter-id="${a}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${a}" value="${t.distance}" data-filter-id="${a}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div id="gradient-color-palette-${a}" class="gradient-color-palette">\n                    <div id="color-palette-${a}" class="color-palette">\n                        <canvas id="gradient-canvas-${a}"></canvas>\n                    </div>\n                    <div id="color-pointer-list-${a}" data-filter-id="${a}" class="color-pointer-list" data-detail="{{カラーポインターを追加}}"></div>\n                </div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Color</div>\n                <div><input type="color" id="gradientColor-${a}" value="#000000" data-detail="{{グラデーションカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="gradientAlpha-${a}" value="100" data-detail="{{グラデーションのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${a}" data-name="knockout" data-filter-id="${a}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${a}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Type</div>\n                <div>\n                    <select id="type-${a}" data-name="type" data-filter-id="${a}">\n                        <option value="inner">Inner</option>\n                        <option value="outer">Outer</option>\n                        <option value="full">Full</option>\n                    </select>\n                </div>\n    \n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${a}" data-name="quality" data-filter-id="${a}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",i);const s=document.getElementById(`gradient-canvas-${a}`);s.width=fe.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,s.height=fe.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,s.style.transform=`scale(${1/window.devicePixelRatio}, ${1/window.devicePixelRatio})`,s.style.backfaceVisibility="hidden",s.style.transformOrigin="0 0",t.context=s.getContext("2d"),this.setCommonEvent(a),t.knockout&&(document.getElementById(`knockout-${a}`).checked=!0);const n=[`blurX-${a}`,`blurY-${a}`,`strength-${a}`,`angle-${a}`,`gradientAlpha-${a}`,`distance-${a}`];for(let e=0;e<n.length;++e)this.setInputEvent(document.getElementById(n[e]));const o=[`knockout-${a}`];for(let e=0;e<o.length;++e)this.setClickEvent(document.getElementById(o[e]));const l=[`gradientColor-${a}`,`type-${a}`,`quality-${a}`];for(let e=0;e<l.length;++e)this.setChangeEvent(document.getElementById(l[e]));for(let e=0;e<t.ratios.length;++e){const r=t.ratios[e],i=`#${t.colors[e].toString(16).padStart(6,"0")}`,s=t.alphas[e];this.addFilterGradientColorPointer(a,e,r,i,s)}this.setCreateGradientColorPointerEvent(a),this.updateFilterGradientCanvas(t),r&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${a}`))}}d.$filterController=new fe;d.$gridController=new class extends ie{constructor(){super("nine-slice"),this._$state="hide",this._$elementIds=["grid-top-left","grid-top-right","grid-bottom-left","grid-bottom-right"],this._$gridMouseMove=null,this._$gridMouseUp=null}initialize(){super.initialize();const e=["nine-slice-setting-x","nine-slice-setting-y","nine-slice-setting-w","nine-slice-setting-h"];for(let t=0;t<e.length;++t)this.setInputEvent(document.getElementById(e[t]));for(let e=0;e<this._$elementIds.length;++e){const t=document.getElementById(this._$elementIds[e]);t&&(t.style.display="none",t.addEventListener("mousedown",(e=>{this.standbyPointer(e)})))}}standbyPointer(e){e.stopPropagation();const t=d.$tools.activeTool;t&&(e.grid=!0,t.dispatchEvent(Y.MOUSE_DOWN,e))}changeNineSliceSettingX(e){return this.updateShapeGrid(+e,+document.getElementById("nine-slice-setting-y").value,+document.getElementById("nine-slice-setting-w").value,+document.getElementById("nine-slice-setting-h").value),+e}changeNineSliceSettingY(e){return this.updateShapeGrid(+document.getElementById("nine-slice-setting-x").value,+e,+document.getElementById("nine-slice-setting-w").value,+document.getElementById("nine-slice-setting-h").value),+e}changeNineSliceSettingW(e){return this.updateShapeGrid(+document.getElementById("nine-slice-setting-x").value,+document.getElementById("nine-slice-setting-y").value,+e,+document.getElementById("nine-slice-setting-h").value),+e}changeNineSliceSettingH(e){return this.updateShapeGrid(+document.getElementById("nine-slice-setting-x").value,+document.getElementById("nine-slice-setting-y").value,+document.getElementById("nine-slice-setting-w").value,+e),+e}updateShapeGrid(e,t,r,a){const i=d.$tools.getDefaultTool("arrow").activeElements;if(!i.length)return;const s=d.$currentWorkSpace().getLibrary(0|i[0].dataset.libraryId);switch(0){case e:case t:s._$grid=null,this.hide();break;default:s._$grid={x:e,y:t,w:r,h:a},this.show().relocation()}s.cacheClear()}show(){if("show"!==this._$state){this._$state="show";for(let e=0;e<this._$elementIds.length;++e){const t=document.getElementById(this._$elementIds[e]);t&&(t.style.display="")}}return this}hide(){if("hide"!==this._$state){for(let e=0;e<this._$elementIds.length;++e){const t=document.getElementById(this._$elementIds[e]);t&&(t.style.display="none")}this._$state="hide"}}relocation(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return this.hide();const t=e[0],r=0|t.dataset.characterId,a=document.getElementById(`character-${r}`);if(!a)return this.hide();const i=d.$currentWorkSpace(),s=i.getLibrary(0|t.dataset.libraryId);if(!s||s.type!==b.SHAPE)return this.hide();const n=s._$grid;if(!n)return this.hide();const o=0|t.dataset.layerId,l=i.scene.getLayer(o).getCharacter(0|t.dataset.characterId);if(l.rotation)return void this.hide();const c=l.getBounds(),h=a.offsetLeft,u=a.offsetTop,m=l.width-Math.abs(c.xMax-c.xMin),g=l.height-Math.abs(c.yMax-c.yMin),p=document.getElementById("grid-top-left");p.style.left=h+n.x-4+"px",p.style.top=u+n.y-4+"px";const $=document.getElementById("grid-top-right");$.style.left=h+n.x+n.w+m-4+"px",$.style.top=u+n.y-4+"px";const f=document.getElementById("grid-bottom-left");f.style.left=h+n.x-4+"px",f.style.top=u+n.y+n.h+g-4+"px";const y=document.getElementById("grid-bottom-right");y.style.left=h+n.x+n.w+m-4+"px",y.style.top=u+n.y+n.h+g-4+"px"}};d.$instanceSelectController=new class extends ie{initialize(){super.initialize();const e=document.getElementById("instance-setting");e&&(e.style.display="none")}createInstanceSelect(e){const t=d.$currentWorkSpace(),r=document.getElementById("instance-type-name");for(;r.children.length;)r.children[0].remove();const a=document.createElement("i");a.setAttribute("class",`library-type-${e.type}`),r.appendChild(a);const i=document.createElement("select");i.classList.add("instance-select"),i.addEventListener("change",(e=>{const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(Y.CHANGE,e))}));for(const r of t._$libraries.values()){if(!r.id)continue;switch(r.type){case b.FOLDER:case b.SOUND:continue}const a=document.createElement("option");a.value=r.id;let s=r.name;if(r._$folderId){let e=r;for(;e._$folderId;)e=t.getLibrary(e._$folderId),s=`${e.name}/${s}`}a.innerHTML=s,r.id===e.id&&(a.defaultSelected=!0),i.appendChild(a)}r.appendChild(i)}};d.$javascriptController=new class{reload(){const e=document.getElementById("javascript-internal-list-box");if(!e)return;const t=e.children;for(;t.length;)t[0].remove();const r=d.$currentWorkSpace();if(r)for(const t of r._$libraries.values()){if(t._$type!==b.MOVIE_CLIP)continue;if(!t._$actions.size)continue;const r=t.id,a=`<div id="script-${r}" data-library-id="${r}" class="internal-parent"><i></i>${t._$name}</div>`;e.insertAdjacentHTML("beforeend",a);document.getElementById(`script-${r}`).addEventListener("dblclick",(e=>{d.$sceneChange.reload(0|e.currentTarget.dataset.libraryId)}));for(const a of t._$actions.keys()){const t=`<div id="script-${r}-${a}" data-library-id="${r}" data-frame="${a}" class="internal-child"><i></i>frame ${a}</div>`;e.insertAdjacentHTML("beforeend",t);document.getElementById(`script-${r}-${a}`).addEventListener("mousedown",(e=>{d.$javaScriptEditor.hide();const t=e.currentTarget,r=d.$currentWorkSpace().getLibrary(0|t.dataset.libraryId),a=0|t.dataset.frame;d.$javaScriptEditor.show(null,a,r)}))}}}};d.$libraryController=new class{constructor(){this._$saved=!1,this._$activeInstances=new Map,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}get activeInstances(){return this._$activeInstances}set activeInstance(e){switch(!0){case d.$ctrlKey&&this.activeInstances.size>0:{const t=0|e.dataset.libraryId;this.activeInstances.has(t)?(this.activeInstances.delete(t),e.classList.remove("active")):(this.activeInstances.set(t,e),e.classList.add("active"))}break;case d.$shiftKey&&this.activeInstances.size>0:{const t=Array.from(document.getElementById("library-list-box").children),r=t.indexOf(this.activeInstances.values().next().value),a=t.indexOf(e);if(-1===a)return;if(this.clearActive(),a===r){this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active");break}if(a>r){const e=a-r+1;for(let a=0;e>a;++a){const e=t[r+a];this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active")}}else{const e=r-a+1;for(let a=0;e>a;++a){const e=t[r-a];this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active")}}}break;default:this.clearActive(),e&&(this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active"))}}clearActive(){for(const e of this.activeInstances.values())e.classList.remove("active");this.activeInstances.clear(),d.$libraryPreview.dispose()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-list-box");e&&(e.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",(e=>{this.drop(e)})),e.addEventListener("dragstart",(()=>{this.dragstart()})),e.addEventListener("dragend",(()=>{this.dragend()})),e.addEventListener("mousedown",(e=>{e.stopPropagation(),e.button||this.clearActive()}))),d.$initializeEnd()}clearSoundSelect(){const e=document.getElementById("sound-select");if(e)for(;e.children.length;)e.children[0].remove()}clearLibrary(){const e=document.getElementById("library-list-box");if(e)for(;e.children.length;)e.children[0].remove();d.$currentWorkSpace()._$nameMap.clear(),d.$confirmModal.hide()}reload(e=null){const t=d.$currentWorkSpace();e||(e=Array.from(t._$libraries.values())),this.clearLibrary(),this.clearSoundSelect(),e.sort(((e,t)=>{const r=e.name.toLowerCase(),a=t.name.toLowerCase();switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}}));const r=new Map,a=new Map;for(let i=0;i<e.length;++i){const s=e[i];if(s.id){if(d.$libraryController.createInstance(s.type,s.name,s.id,s.symbol),t._$nameMap.set(s.path,s.id),"folder"===s.type&&s.mode===_.OPEN&&this.openFolder(s),s.folderId){const e=document.getElementById(`library-child-id-${s.id}`);e.remove(),a.has(s.folderId)||a.set(s.folderId,[]),a.get(s.folderId).push(e)}"folder"===s.type&&r.set(s.id,s)}}if(r.size){const e=document.getElementById("library-list-box"),t=new Map;for(;r.size!==t.size;){for(const[i,s]of r){if(!a.has(i)){t.set(i,!0);continue}if(t.has(i))continue;const r=document.getElementById(`library-child-id-${s.id}`);if(!r)continue;const n=a.get(i);for(let t=n.length-1;t>-1;--t){const a=n[t];e.insertBefore(a,r.nextElementSibling),s.mode===_.CLOSE&&(a.style.display="none")}t.set(i,!0)}for(const[e,t]of r)a.has(e)&&!t.folderId&&this.updateFolderStyle(t,t.mode)}t.clear(),r.clear(),a.clear()}}createInstance(e,t,r,a=""){const i=`\n<div draggable="true" class="library-list-box-child" id="library-child-id-${r}" data-library-id="${r}">\n    <div class="library-list-box-name">\n        <i class="library-type-${e===b.FOLDER?"arrow close":"space"}" id="arrow-${r}" data-library-id="${r}"></i>\n        <i class="library-type-${e} " id="${e}-${r}" data-library-id="${r}"></i>\n        <p>\n            <span id="library-name-${r}" class="view-text" data-type="name" data-library-id="${r}">${t}</span>\n            <input type="text" id="library-name-input-${r}" data-library-id="${r}" data-type="name" value="${t}" style="display: none;">\n        </p>\n    </div>\n    <div class="library-list-box-symbol">\n        <p>\n            <span id="library-symbol-name-${r}" class="view-symbol-text" data-type="symbol" data-library-id="${r}">${a}</span>\n            <input type="text" id="library-symbol-name-input-${r}" data-library-id="${r}" data-type="symbol" value="${a}" style="display: none;">\n        </p>\n    </div>\n</div>`;document.getElementById("library-list-box").insertAdjacentHTML("beforeend",i),e===b.MOVIE_CLIP&&document.getElementById(`${e}-${r}`).addEventListener("dblclick",(e=>{d.$sceneChange.reload(0|e.currentTarget.dataset.libraryId)}));const s=document.getElementById(`library-child-id-${r}`);if(this.activeInstances.has(r)&&(this.activeInstances.set(r,s),s.classList.add("active")),s.addEventListener("mousedown",(e=>{this.selectInstance(e)})),"folder"===e){s.addEventListener("dragover",(e=>{e.preventDefault()})),s.addEventListener("drop",(e=>{this.folderIn(e)}));document.getElementById(`arrow-${r}`).addEventListener("mousedown",(e=>{this.clickFolder(e)}));const t=document.getElementById(`${e}-${r}`);t.addEventListener("dblclick",(e=>{this.clickFolder(e)})),t.classList.remove("library-type-folder"),t.classList.add("library-type-folder-close")}if(e===b.SOUND){const e=document.createElement("option");e.value=`${r}`,e.innerHTML=t,document.getElementById("sound-select").appendChild(e)}const n=[`library-name-${r}`];"folder"!==e&&n.push(`library-symbol-name-${r}`);for(let e=0;e<n.length;++e)document.getElementById(n[e]).addEventListener("dblclick",(e=>{this.inputStart(e)}));const o=[`library-name-input-${r}`];"folder"!==e&&o.push(`library-symbol-name-input-${r}`);for(let e=0;e<o.length;++e){const t=document.getElementById(o[e]);t.addEventListener("focusout",(e=>{this.inputEnd(e)})),t.addEventListener("keypress",(e=>{this.inputEnd(e)}))}return{id:r,type:e,name:t,symbol:a}}selectInstance(e){if(e.button||d.$keyLock)return;d.$endMenu(),e.stopPropagation();const t=e.currentTarget;(d.$ctrlKey||d.$shiftKey||!t.classList.contains("active"))&&(this.activeInstance=t,d.$libraryPreview.loadImage(0|t.dataset.libraryId))}inputStart(e){d.$keyLock=!0,e.stopPropagation();const t=e.target,r=0|t.dataset.libraryId,a=document.getElementById(`library-child-id-${r}`);a.classList.remove("active"),a.draggable=!1;const i="name"===t.dataset.type?`library-name-input-${r}`:`library-symbol-name-input-${r}`,s=document.getElementById(i);s.value=t.textContent,s.style.display="",s.focus(),t.style.display="none"}inputEnd(e){if("Enter"!==e.key){if("focusout"===e.type){this.save();const t=e.target,r=0|t.dataset.libraryId,a=d.$currentWorkSpace(),i=a.getLibrary(r),s="name"===t.dataset.type?`library-name-${r}`:`library-symbol-name-${r}`,n=document.getElementById(s);let o=t.value;if(n.textContent!==o){if("name"===t.dataset.type){const e=i.name;if(i.name=o,a._$nameMap.has(i.path)){i.name=e,o=e;const r=document.getElementById("detail-modal");r.textContent=d.$currentLanguage.replace("{{同名のアイテムが存在します}}"),r.style.left=`${t.offsetLeft}px`,r.style.top=`${t.offsetTop}px`,r.setAttribute("class","fadeIn"),r.dataset.timerId=setTimeout((()=>{r.classList.contains("fadeOut")||r.setAttribute("class","fadeOut")}),1500)}}else i.symbol=o;n.textContent=o}n.style.display="";const l=document.getElementById(`library-child-id-${r}`);this.activeInstances.has(r)&&l.classList.add("active"),t.style.display="none",l.draggable=!0,d.$keyLock=!1,this._$saved=!1,"name"===t.dataset.type&&this.reload()}}else e.target.blur()}clickFolder(e){e.stopPropagation();const t=d.$currentWorkSpace().getLibrary(0|e.target.dataset.libraryId);t.mode===_.OPEN?this.closeFolder(t):this.openFolder(t),this.updateFolderStyle(t,t.mode)}updateFolderStyle(e,t){const r=d.$currentWorkSpace(),a=document.getElementById("library-list-box").children;let i=20,s=e.folderId;if(s)for(;;){const e=r.getLibrary(s);if(!e)break;if(i+=20,s=e.folderId,!s)break}for(let s=0;s<a.length;++s){const n=a[s],o=r.getLibrary(0|n.dataset.libraryId);o.folderId&&(o.folderId===e.id&&(n.style.paddingLeft=`${i}px`,n.style.display=t===_.OPEN?"":"none",o.type===b.FOLDER&&this.updateFolderStyle(o,t===_.OPEN?o.mode:t)))}}openFolder(e){e.mode=_.OPEN;const t=document.getElementById(`folder-${e.id}`);t.classList.remove("library-type-folder-close"),t.classList.add("library-type-folder-open");const r=document.getElementById(`arrow-${e.id}`);r.classList.add("open"),r.classList.remove("close")}closeFolder(e){e.mode=_.CLOSE;const t=document.getElementById(`folder-${e.id}`);t.classList.remove("library-type-folder-open"),t.classList.add("library-type-folder-close");const r=document.getElementById(`arrow-${e.id}`);r.classList.remove("open"),r.classList.add("close")}dragstart(){const e=document.getElementById("stage-area").children;for(let t=1;t<e.length;++t)e[t].style.pointerEvents="none"}dragend(){const e=document.getElementById("stage-area").children;for(let t=1;t<e.length;++t){const r=e[t];r.dataset.preview||(r.style.pointerEvents="")}}drop(e){e.preventDefault(),e.stopPropagation(),this.save();if(e.dataTransfer.items.length){this.clearActive();const t=e.dataTransfer.items;for(let e=0;e<t.length;++e)this.scanFiles(t[e].webkitGetAsEntry())}else this.folderOut(),this.reload();this._$saved=!1}scanFiles(e,t=0){switch(!0){case e.isDirectory:{const r=d.$currentWorkSpace().addLibrary({id:d.$currentWorkSpace().nextLibraryId,type:"folder",name:e.name,symbol:""});t&&(r.folderId=t),e.createReader().readEntries((e=>{for(let t=0;t<e.length;++t)this.scanFiles(e[t],r.id)})),this.updateFolderStyle(r,r.mode)}break;case e.isFile:e.file((e=>{this.loadFile(e,t)}))}}removeLibrary(e){const t=document.getElementById(`library-child-id-${e}`);t&&t.remove();const r=d.$currentWorkSpace(),a=r.getLibrary(e);if(a){if(a.type===b.MOVIE_CLIP){const e=new Map;for(const t of a._$layers.values())for(let a=0;a<t._$characters.length;++a){const i=t._$characters[a];e.has(i.libraryId)||e.set(i.libraryId,!0);const s=r.getLibrary(i.libraryId);s&&s.type===b.MOVIE_CLIP&&this.removeLibrary(i.libraryId)}if(e.size)for(const t of e.keys()){const e=r.getLibrary(t);if(!e)continue;const a=document.getElementById(`library-child-id-${t}`);a&&a.remove(),e.remove(),r.removeLibrary(t)}}r.removeLibrary(e)}}loadFile(e,t=0,r="",a=0){const i=d.$currentWorkSpace();let s=r||e.name;if(s.indexOf(".swf")>-1&&(s=s.replace(".swf","")),t){let e=i.getLibrary(t);for(s=`${e.name}/${s}`;e._$folderId;)e=i.getLibrary(e._$folderId),s=`${e.name}/${s}`}if(!a&&i._$nameMap.has(s))return d.$confirmModal.files.push({file:e,folderId:t,path:s}),void d.$confirmModal.show();switch(a&&this.removeLibrary(a),e.type){case"image/svg+xml":return e.text().then((n=>{const o=this.createInstance(b.MOVIE_CLIP,r||e.name,a||i.nextLibraryId),l=i.addLibrary(o);i._$nameMap.set(s,o.id);const c=document.getElementById(`library-child-id-${o.id}`);if(c&&(this.activeInstances.set(o.id,c),c.classList.add("active")),t){l.folderId=t;const e=i.getLibrary(t);this.updateFolderStyle(e,e.mode)}X.parse(n,l),d.$instanceSelectController.createInstanceSelect(l),d.$libraryController.reload(),d.$libraryPreview.loadImage(l.id),a&&this.reloadScreen(a)}));case"image/png":case"image/jpeg":case"image/gif":return e.arrayBuffer().then((n=>{const o=new Blob([n],{type:e.type}),l=new Image;return l.src=URL.createObjectURL(o),l.decode().then((()=>{const n=l.width,o=l.height,c=document.createElement("canvas");c.width=n,c.height=o;const h=c.getContext("2d");h.drawImage(l,0,0,n,o);const u=new Uint8Array(h.getImageData(0,0,n,o).data),m=this.createInstance(b.BITMAP,r||e.name,a||i.nextLibraryId);i._$nameMap.set(s,m.id);const g=document.getElementById(`library-child-id-${m.id}`);g&&(this.activeInstances.set(m.id,g),g.classList.add("active")),m.width=l.width,m.height=l.height,m.imageType=e.type,m.buffer=new Uint8Array(u);const p=i.addLibrary(m);if(t){p.folderId=t;const e=i.getLibrary(t);this.updateFolderStyle(e,e.mode)}d.$instanceSelectController.createInstanceSelect(p),d.$libraryController.reload(),d.$libraryPreview.loadImage(p.id),a&&this.reloadScreen(a)}))}));case"video/mp4":return e.arrayBuffer().then((n=>{const o=new Blob([n],{type:e.type}),l=document.createElement("video");l.onloadedmetadata=()=>{const o=this.createInstance(b.VIDEO,r||e.name,a||i.nextLibraryId);i._$nameMap.set(s,o.id);const c=document.getElementById(`library-child-id-${o.id}`);c&&(this.activeInstances.set(o.id,c),c.classList.add("active")),o.width=l.videoWidth,o.height=l.videoHeight,o.buffer=new Uint8Array(n);const h=i.addLibrary(o);if(t){h.folderId=t;const e=i.getLibrary(t);this.updateFolderStyle(e,e.mode)}d.$instanceSelectController.createInstanceSelect(h),d.$libraryController.reload(),d.$libraryPreview.loadImage(h.id),a&&this.reloadScreen(a)},l.src=URL.createObjectURL(o),l.load()}));case"audio/mpeg":return e.arrayBuffer().then((n=>{const o=this.createInstance(b.SOUND,r||e.name,a||i.nextLibraryId);i._$nameMap.set(s,o.id);const l=document.getElementById(`library-child-id-${o.id}`);l&&(this.activeInstances.set(o.id,l),l.classList.add("active")),o.buffer=new Uint8Array(n);const c=i.addLibrary(o);if(t){c.folderId=t;const e=i.getLibrary(t);this.updateFolderStyle(e,e.mode)}d.$libraryController.reload(),d.$libraryPreview.loadImage(c.id),a&&this.reloadScreen(a)}));case"application/x-shockwave-flash":return e.arrayBuffer().then((i=>{(new O).setData(new Uint8Array(i)).run(r||e.name,t,a)}))}}folderOut(){if(this.activeInstances.size)for(const e of this.activeInstances.values()){const t=d.$currentWorkSpace().getLibrary(0|e.dataset.libraryId);t&&(t.folderId&&(t.folderId=0,e.style.display="",e.style.paddingLeft=""))}}folderIn(e){if(!this.activeInstances.size)return;const t=d.$currentWorkSpace(),r=e.currentTarget,a=t.getLibrary(0|r.dataset.libraryId),i=[];for(const e of this.activeInstances.values()){const r=t.getLibrary(0|e.dataset.libraryId);if(a.id!==r.folderId)if(r.type===b.FOLDER){if(r.id!==a.id)if(a.folderId){let s=a.folderId;for(;s;){const a=t.getLibrary(s);if(!a)break;if(s===r.id)break;if(s=a.folderId,!s){i.push(e);break}}}else i.push(e)}else i.push(e)}if(!i.length)return;this.save(),e.stopPropagation(),e.preventDefault();let s=!1;for(let e=0;e<i.length;++e){const r=i[e],n=t.getLibrary(0|r.dataset.libraryId);const o=`${t.getLibrary(a.id).name}/${n.path}`;if(t._$nameMap.has(o)){if(s=!0,d.$confirmModal.files.push({file:n,folderId:a.id,path:o,type:"move"}),d.$confirmModal.show(),n.type===b.FOLDER){const e=Array.from(document.getElementById("library-list-box").children),r=document.getElementById(`library-child-id-${n.id}`);let i=e.indexOf(r)+1,s=`${t.getLibrary(a.id).path}`;const o=r.style.paddingLeft;for(;i<e.length;++i){const r=e[i];if(r.style.paddingLeft===o)break;const n=t.getLibrary(0|r.dataset.libraryId),l=`${s}/${n.path}`;t._$nameMap.has(l)&&d.$confirmModal.files.push({file:n,folderId:a.id,path:l,type:"move"})}}}else n.folderId=a.id}s||this.reload(),this._$saved=!1}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}reloadScreen(e){d.$changeLibraryId=e;const t=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(t),d.$changeLibraryId=0}};class ye extends ie{constructor(){super(),this._$lock=!1,this._$instance=null,this._$xScale=1,this._$yScale=1,this._$currentFrame=1,this._$startFrame=1,this._$endFrame=1,this._$width=0,this._$height=0}static get MAX_SIZE(){return 4095}static get MIN_SIZE(){return 1}initialize(){super.initialize();const e=["library-menu-export","library-export-hide-icon","library-export-size-lock","library-export-execution"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{if(e.button)return;e.stopPropagation();this[`execute${e.currentTarget.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}))}const t=["export-width","export-height","export-start-frame","export-end-frame","export-current-frame"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);r&&this.setInputEvent(r)}}executeLibraryExportExecution(){d.$endMenu();const e=document.getElementById("library-export-file-type").value,t=document.getElementById("export-name").value;switch(this._$instance.type){case b.MOVIE_CLIP:{const r=new JSZip;for(let a=this._$startFrame;this._$endFrame>=a;++a){const i=this.getBitmapData(a).getContext2D();r.file(`${t}_frame_${a}.${e}`,i.canvas.toDataURL(`image/${e}`,1).replace(/^.*,/,""),{base64:!0})}r.generateAsync({type:"blob"}).then((e=>{const r=URL.createObjectURL(e),a=document.createElement("a");a.download=`${t}.zip`,a.href=r,a.click(),URL.revokeObjectURL(r)}))}break;case b.VIDEO:{const e=t.split(".");"mp4"===e[e.length-1]&&e.pop();const r=document.createElement("a");r.download=`${e.join(".")}.mp4`,r.href=URL.createObjectURL(new Blob([new Uint8Array(this._$instance._$buffer)],{type:"video/mp4"})),r.click()}break;case b.SOUND:{const e=t.split(".");"mp3"===e[e.length-1]&&e.pop();const r=document.createElement("a");r.download=`${e.join(".")}.mp3`,r.href=URL.createObjectURL(new Blob([new Uint8Array(this._$instance._$buffer)],{type:"audio/mp3"})),r.click()}break;default:{const r=this.getBitmapData().getContext2D(),a=document.createElement("a");a.download=`${t}.${e}`,a.href=r.canvas.toDataURL(`image/${e}`,1),a.click()}}}executeLibraryExportSizeLock(e){this._$lock=!this._$lock,this._$currentValue=null,e.currentTarget.childNodes[1].setAttribute("class",this._$lock?"active":"disable")}changeExportWidth(e){return e=d.$clamp(+e,ye.MIN_SIZE,ye.MAX_SIZE),this._$xScale=e/this._$width,this._$lock&&(this._$yScale=this._$xScale,document.getElementById("export-height").value=`${Math.ceil(this._$height*this._$yScale)}`),this.appendImage(),e}changeExportHeight(e){return e=d.$clamp(+e,ye.MIN_SIZE,ye.MAX_SIZE),this._$yScale=e/this._$height,this._$lock&&(this._$xScale=this._$yScale,document.getElementById("export-width").value=`${Math.ceil(this._$width*this._$xScale)}`),this.appendImage(),e}changeExportStartFrame(e){e=d.$clamp(0|e,1,this._$instance.totalFrame),this._$startFrame=e;const t=document.getElementById("export-end-frame");return e>(0|t.value)&&(t.value=`${e}`,this._$endFrame=e),e>this._$currentFrame&&(document.getElementById("export-current-frame").value=`${e}`,this._$currentFrame=e),this.reloadMovieClip(),this.appendImage(),e}changeExportEndFrame(e){e=d.$clamp(0|e,1,this._$instance.totalFrame);const t=document.getElementById("export-start-frame");return(0|t.value)>e&&(t.value=`${e}`,this._$startFrame=e),this._$currentFrame>e&&(document.getElementById("export-current-frame").value=`${e}`,this._$currentFrame=e),this.reloadMovieClip(),this.appendImage(),e}changeExportCurrentFrame(e){return e=d.$clamp(0|e,this._$startFrame,this._$endFrame),this._$currentFrame=e,this.appendImage(),e}executeLibraryExportHideIcon(){d.$endMenu()}reloadMovieClip(){const e=this.getBounds();this._$width=Math.abs(e.xMax-e.xMin),this._$height=Math.abs(e.yMax-e.yMin),document.getElementById("export-start-frame").value=`${this._$startFrame}`,document.getElementById("export-end-frame").value=`${this._$endFrame}`,document.getElementById("export-width").value=`${Math.ceil(this._$width)}`,document.getElementById("export-height").value=`${Math.ceil(this._$height)}`}executeLibraryMenuExport(){const e=d.$libraryController.activeInstances;if(!e.size)return;const t=e.values().next().value;this._$instance=d.$currentWorkSpace().getLibrary(0|t.dataset.libraryId),this._$lock=!1,this._$xScale=1,this._$yScale=1,document.getElementById("library-export-size-lock").childNodes[1].setAttribute("class","disable");const r=document.getElementById("library-export-container-area"),a=document.getElementById("library-export-size-area"),i=document.getElementById("library-export-file-area");switch(this._$instance.type){case b.MOVIE_CLIP:this._$currentFrame=1,this._$startFrame=1,this._$endFrame=this._$instance.totalFrame,r.style.display="",a.style.display="",i.style.display="",this.reloadMovieClip();break;case b.VIDEO:case b.SOUND:r.style.display="none",a.style.display="none",i.style.display="none";break;default:{r.style.display="none",a.style.display="",i.style.display="";const e=this._$instance.getBounds();this._$width=Math.abs(e.xMax-e.xMin),this._$height=Math.abs(e.yMax-e.yMin),document.getElementById("export-width").value=`${Math.ceil(this._$width)}`,document.getElementById("export-height").value=`${Math.ceil(this._$height)}`}}document.getElementById("export-name").value=`${this._$instance.name}`,this.appendImage(),d.$endMenu("library-export-modal");const s=document.getElementById("library-export-modal");s.style.display="",s.setAttribute("class","fadeIn")}getBounds(){const e=[1,0,0,1,0,0],t={frame:1,matrix:e,colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],loop:d.$getDefaultLoopConfig()},r={startFrame:1,endFrame:this._$instance.totalFrame+1},a=d.$currentFrame;let i=Number.MAX_VALUE,s=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let a=this._$startFrame;this._$endFrame>=a;++a){t.frame=d.$currentFrame=a;const l=this._$instance.getBounds(e,t,r);i=Math.min(l.xMin,i),s=Math.max(l.xMax,s),n=Math.min(l.yMin,n),o=Math.max(l.yMax,o)}return d.$currentFrame=a,{xMin:i,xMax:s,yMin:n,yMax:o}}removeImage(){const e=document.getElementById("library-export-image");if(e)for(;e.firstChild;)e.firstChild.remove()}appendImage(){switch(this.removeImage(),this._$instance.type){case b.VIDEO:case b.SOUND:document.getElementById("library-export-image").appendChild(this._$instance.getPreview());break;default:{const e=this.getBitmapData(this._$currentFrame),t=window.devicePixelRatio,r=new Image;r.src=e.toDataURL(),r.width=e.width/t,r.height=e.height/t,e.dispose(),document.getElementById("library-export-image").appendChild(r)}}}createBitmapData(e,t,r,a,i=0,s=0){const{Matrix:n}=window.next2d.geom,o=this._$instance.createInstance(r,a),l=this._$instance.calcMatrix(o,e,t,r,i,s);o.transform.matrix=new n(r.matrix[0],r.matrix[1],r.matrix[2],r.matrix[3],0,0),o.transform.colorTransform=this._$instance.calcColorTransform(r);const c=this._$instance.calcFilter(e,t,r,l);o.filters=c.filters;const d=this._$instance.createContainer(o),h=this._$instance.createBitmapData(e,t);return h.draw(d,l),h}getBitmapData(e=1){const t=d.$currentFrame,r=d.$zoomScale;let a=1;this._$width*this._$xScale>450&&(a=450/(this._$width*this._$xScale));let i=1;this._$height*this._$yScale>450&&(i=450/(this._$height*this._$yScale));const s=Math.min(a,i);d.$currentFrame=e,d.$zoomScale=1;const n=this._$instance.type===b.MOVIE_CLIP?{startFrame:1,endFrame:this._$instance.totalFrame+1}:null,o={frame:e,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],loop:d.$getDefaultLoopConfig()},l=this.getBounds(),c=this._$instance.getBounds([1,0,0,1,0,0],o,n);o.matrix[0]=this._$xScale*s,o.matrix[3]=this._$yScale*s;const h=this.createBitmapData(Math.ceil(this._$width*this._$xScale*s),Math.ceil(this._$height*this._$yScale*s),o,n,-l.xMin+c.xMin,-l.yMin+c.yMin);return d.$zoomScale=r,d.$currentFrame=t,h}}d.$libraryExport=new ye;d.$libraryKeyboardCommand=new class extends R{constructor(){super("library")}initialize(){super.initialize();const e=document.getElementById("library-list-box");e&&(e.addEventListener("mouseleave",(()=>{this.active=!1})),e.addEventListener("mouseover",(()=>{this.active||(this.active=!0)}))),this.add("Backspace",this.executeInstanceDelete),this.add(d.$generateShortcutKey("Backspace",{ctrl:!0,shift:!0}),this.executeNoUseInstanceDelete),this.add(d.$generateShortcutKey("m",{ctrl:!0}),this.addMovieClip),this.add(d.$generateShortcutKey("f",{ctrl:!0}),this.addFolder),this.add(d.$generateShortcutKey("r",{ctrl:!0}),this.loadFile),this.add(d.$generateShortcutKey("s",{alt:!0}),this.cloneShape),this.add(d.$generateShortcutKey("s",{ctrl:!0,shift:!0}),this.showOutputModal),this.add("ArrowDown",this.moveItem),this.add("ArrowUp",this.moveItem),this.add(d.$generateShortcutKey("ArrowDown",{shift:!0}),this.moveItem),this.add(d.$generateShortcutKey("ArrowUp",{shift:!0}),this.moveItem)}moveItem(e){const t=document.getElementById("library-list-box");if(!t)return;const r=Array.from(t.children);let a=0;const i=d.$libraryController.activeInstances;if(i.size){let e=null;const t=i.values();for(let r=0;i.size>r;++r)e=t.next().value;a=r.indexOf(e)}switch(e){case"ArrowDown":case"ArrowDownShift":a++;break;case"ArrowUp":case"ArrowUpShift":a--}const s=r[a];s&&(d.$libraryController.activeInstance=s,d.$libraryPreview.loadImage(0|s.dataset.libraryId))}showOutputModal(){d.$libraryExport.executeLibraryMenuExport()}cloneShape(){d.$libraryMenu.executeLibraryMenuContentShapeClone()}loadFile(){d.$shiftKey=!1,d.$ctrlKey=!1,d.$altKey=!1,document.getElementById("library-menu-file-input").click()}addFolder(){d.$libraryMenu.executeLibraryMenuFolderAdd()}addMovieClip(){d.$libraryMenu.executeLibraryMenuContainerAdd()}executeInstanceDelete(){d.$libraryMenu.executeLibraryMenuDelete()}executeNoUseInstanceDelete(){d.$libraryMenu.executeLibraryMenuNoUseDelete()}};d.$libraryMenu=new class{constructor(){this._$saved=!1,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-list-box");e&&(e.addEventListener("contextmenu",(e=>{this.show(e)})),e.addEventListener("mousedown",(e=>{e.button||this.hide()})));const t=["library-menu-container-add","library-menu-folder-add","library-menu-content-shape-clone","library-menu-file","library-menu-delete","library-menu-no-use-delete"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);r&&r.addEventListener("mousedown",(e=>{if(e.button)return;d.$endMenu(),e.stopPropagation();this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}))}const r=document.getElementById("library-menu-file-input");r&&r.addEventListener("change",(e=>{this.save();const t=e.target.files;for(let e=0;e<t.length;++e)d.$libraryController.loadFile(t[e]);e.target.value="",this._$saved=!1})),d.$initializeEnd()}executeLibraryMenuContainerAdd(){this.save();const e=d.$currentWorkSpace(),t=e.nextLibraryId;e.addLibrary({id:t,type:b.MOVIE_CLIP,name:`MovieClip_${t}`,symbol:""}),this._$saved=!1,d.$libraryController.reload()}executeLibraryMenuFolderAdd(){this.save();const e=d.$currentWorkSpace(),t=e.nextLibraryId,r=e.addLibrary({id:t,type:"folder",name:`Folder_${t}`,symbol:""}),a=d.$libraryController.activeInstances;if(a.size){for(let r of a.keys()){e.getLibrary(r).folderId=t}r.mode=_.OPEN}d.$libraryController.reload(),this._$saved=!1}executeLibraryMenuContentShapeClone(){const e=d.$libraryController.activeInstances;if(!e.size)return;let t=!1;const r=d.$currentWorkSpace();for(const a of e.keys()){const e=r.getLibrary(a);if(e.type!==b.SHAPE)continue;t=!0,this.save();const i=r.nextLibraryId,s=r.addLibrary(d.$libraryController.createInstance(e.type,`${e.name}_Clone`,i));e.copyFrom(s)}t&&d.$libraryController.reload(),this._$saved=!1}executeLibraryMenuFile(e){e.preventDefault(),document.getElementById("library-menu-file-input").click()}executeLibraryMenuDelete(){const e=d.$libraryController.activeInstances;if(!e.size)return;this.save();const t=d.$currentWorkSpace();for(const r of e.values()){const e=0|r.dataset.libraryId,a=t.getLibrary(e);a&&(a.remove(),r.remove(),t.removeLibrary(e))}e.clear();d.$tools.getDefaultTool("arrow").clearActiveElement(),d.$transformController.hide(),d.$gridController.hide(),d.$tweenController.clearPointer(),d.$controller.default(),d.$javascriptController.reload(),d.$libraryController.reload(),d.$libraryPreview.dispose(),d.$timelineLayer.activeCharacter(),t.scene.changeFrame(d.$timelineFrame.currentFrame),this._$saved=!1}executeLibraryMenuNoUseDelete(){let e=!1;const t=d.$currentWorkSpace(),r=new Map;for(let e of t._$libraries.values())if(e.type===b.MOVIE_CLIP){for(let t of e._$layers.values()){const e=t._$characters;for(let t=0;t<e.length;++t){const a=e[t].libraryId;r.has(a)||r.set(a,!0)}}if(e._$sounds.size)for(const t of e._$sounds.values())for(let e=0;e<t.length;++e){const a=t[e];r.set(a.characterId,!0)}}for(let a of t._$libraries.values())r.has(a.id)||a.type===b.FOLDER||a.type===b.MOVIE_CLIP||(this.save(),e=!0,t.removeLibrary(a.id));e&&(d.$libraryController.clearActive(),d.$javascriptController.reload(),d.$libraryController.reload()),this._$saved=!1}show(e){const t=document.getElementById("library-menu");t.style.left=t.clientWidth+e.pageX+5>window.innerWidth?e.pageX-(t.clientWidth+e.pageX+10-window.innerWidth)+"px":`${e.pageX+5}px`,t.style.top=e.pageY-t.clientHeight/2+"px",t.setAttribute("class","fadeIn"),d.$endMenu("library-menu")}hide(){d.$endMenu()}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}};d.$libraryPreview=new class{constructor(){this._$currentId=-1,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-preview-area");e&&(e.addEventListener("mousedown",(e=>{this.mousedown(e)})),e.addEventListener("dragstart",(()=>{d.$libraryController.dragstart()})),e.addEventListener("dragend",(()=>{d.$libraryController.dragend()}))),d.$initializeEnd()}mouseout(e){-1!==this._$currentId&&(e.stopPropagation(),document.getElementById("library-preview-area").draggable=!1)}mousedown(e){if(-1===this._$currentId)return;e.stopPropagation();const t=document.getElementById(`library-child-id-${this._$currentId}`);if(t){const e=document.getElementById("library-preview-area"),r=Array.from(document.getElementById("library-preview-area").children);d.$libraryController.activeInstance=t;for(let t=0;t<r.length;++t)e.appendChild(r[t]);e.draggable=!0}}dispose(){this._$currentId=-1;const e=document.getElementById("library-preview-area");if(e){for(;e.firstChild;)e.firstChild.remove();e.draggable=!1}}loadImage(e){this.dispose();const t=d.$currentWorkSpace().getLibrary(e);"folder"!==t.type&&(this._$currentId=e,document.getElementById("library-preview-area").appendChild(t.getPreview()))}};d.$librarySearch=new class{constructor(){this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-search");e&&(e.addEventListener("focusin",(()=>{d.$keyLock=!0})),e.addEventListener("focusout",(()=>{d.$keyLock=!1})),e.addEventListener("input",(e=>{this.execute(e)}))),d.$initializeEnd()}execute(e){const t=e.target.value,r=document.getElementById("library-list-box").children,a=r.length;for(let e=0;e<a;++e){const a=r[e];!t||a.children[0].innerText.indexOf(t)>-1||a.children[1].innerText.indexOf(t)>-1?a.style.display="":a.style.display="none"}}};class _e extends ie{constructor(){super("loop"),this._$frameTarget="start"}initialize(){super.initialize();const e=["no-use-loop","loop-repeat","loop-no-repeat","fixed-one","loop-no-repeat-reversal","loop-repeat-reversal","frame-picker-button","target-start-button","target-end-button"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e.target.id,e)}))}const t=["loop-start-frame","loop-end-frame"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);r&&this.setInputEvent(r)}}static get DEFAULT(){return 5}static get REPEAT(){return 0}static get NO_REPEAT(){return 1}static get FIXED_ONE(){return 2}static get NO_REPEAT_REVERSAL(){return 3}static get REPEAT_REVERSAL(){return 4}changeLoopStartFrame(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return e;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return e;const i=d.$currentWorkSpace().getLibrary(a.libraryId);if(!i)return e;e=d.$clamp(0|e,1,i.totalFrame);const s=d.$timelineFrame.currentFrame,n=a.getRange(s);let o=a.getPlace(n.startFrame);return o.loop?(o.loop.start=e,a.dispose(),this.reloadScreen(),e):e}changeLoopEndFrame(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return e;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return e;const i=d.$currentWorkSpace().getLibrary(a.libraryId);if(!i)return e;e=d.$clamp(0|e,0,i.totalFrame);const s=d.$timelineFrame.currentFrame,n=a.getRange(s);let o=a.getPlace(n.startFrame);return o.loop?(o.loop.end=e,a.dispose(),this.reloadScreen(),e||"-"):e}changeFramePickerButton(){document.getElementById("loop-image-list").style.display="none",this.loadLoopFrameList()}changeTargetStartButton(){const e=document.getElementById("target-start-button");e.classList.contains("active")||e.classList.add("active"),document.getElementById("target-end-button").classList.remove("active"),this._$frameTarget="start"}changeTargetEndButton(){const e=document.getElementById("target-end-button");e.classList.contains("active")||e.classList.add("active"),document.getElementById("target-start-button").classList.remove("active"),this._$frameTarget="end"}changeLoopRepeat(){const e=document.getElementById("loop-repeat");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(0)}changeLoopNoRepeat(){const e=document.getElementById("loop-no-repeat");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(1)}changeFixedOne(){const e=document.getElementById("fixed-one");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(2)}changeLoopNoRepeatReversal(){const e=document.getElementById("loop-no-repeat-reversal");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(3)}changeLoopRepeatReversal(){const e=document.getElementById("loop-repeat-reversal");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(4)}changeNoUseLoop(){const e=document.getElementById("no-use-loop");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(5)}clearLoopButton(e){const t=e.parentNode.children;for(let e=0;e<t.length;++e)t[e].classList.remove("active")}reload(e){const t=document.getElementById("loop-setting-view-area").firstElementChild.children;for(let e=0;e<t.length;++e)t[e].classList.remove("active");const r=document.getElementById("loop-image-list");for(;r.children.length;)r.children[0].remove();document.getElementById(["loop-repeat","loop-no-repeat","fixed-one","loop-no-repeat-reversal","loop-repeat-reversal","no-use-loop"][e.type]).classList.add("active"),document.getElementById("loop-start-frame").value=`${e.start}`,document.getElementById("loop-end-frame").value=`${e.end?e.end:"-"}`}loadLoopFrameList(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=document.getElementById("loop-image-list"),r=t.children;for(;r.length;)r[0].remove();const a=d.$currentWorkSpace(),i=a.scene,s=e[0],n=0|s.dataset.layerId,o=i.getLayer(n),l=0|s.dataset.characterId,c=o.getCharacter(l),h={startFrame:c.startFrame,endFrame:c.endFrame},u=a.getLibrary(c.libraryId),m=d.$timelineFrame.currentFrame,g=[],p=u.totalFrame;for(let e=1;p>=e;++e)g.push(new Promise((t=>{window.requestAnimationFrame((()=>{const{Sprite:r,BitmapData:a}=window.next2d.display,{Matrix:i,ColorTransform:s}=window.next2d.geom;d.$currentFrame=e;const n=new r,o={frame:e,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],loop:d.$getDefaultLoopConfig()},l=n.addChild(u.createInstance(o,h));l.transform.matrix=new i,l.transform.colorTransform=new s;const c=u.getBounds([1,0,0,1,0,0],o,h),m=Math.ceil(Math.abs(c.xMax-c.xMin)),g=Math.ceil(Math.abs(c.yMax-c.yMin)),p=Math.min(95/m,95/g),$=window.devicePixelRatio,f=new a(m*p*$,g*p*$,!0,0),y=new i($,0,0,$,-c.xMin*$,-c.yMin*$);y.scale(p,p),f.draw(n,y);const _=new Image;_.onload=()=>t({index:e-1,image:_}),_.src=f.toDataURL(),_.width=f.width/$,_.height=f.height/$,f.dispose()}))})));Promise.all(g).then((e=>{d.$currentFrame=m;const r=[];for(let t=0;t<e.length;++t){const a=e[t];r[a.index]=a.image}for(let e=0;e<r.length;++e){const a=e+1,i=document.createElement("span");i.textContent=`[ ${a} ]`;const s=document.createElement("p");s.appendChild(r[e]);const n=document.createElement("div");n.dataset.frame=`${a}`,n.appendChild(s),n.appendChild(i),n.addEventListener("click",(e=>{this.clickImage(e)})),t.appendChild(n)}t.style.display=""}))}clickImage(e){e.stopPropagation();const t=document.getElementById(`loop-${this._$frameTarget}-frame`);this.save(),t.focus(),t.value=e.currentTarget.dataset.frame,t.blur(),this._$saved=!1}updateLoopType(e=0){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const i=d.$timelineFrame.currentFrame,s=a.getRange(i);let n=a.getPlace(s.startFrame);n.loop.type!==e&&(n.loop.type=e,a.dispose(),this.reloadScreen())}}d.$loopController=new _e;d.$objectController=new class extends ie{constructor(){super("object")}initialize(){super.initialize();const e=document.getElementById("object-name");e&&(e.addEventListener("focusout",(e=>{this.finishInput(e,!1)})),e.addEventListener("keypress",(e=>{this.finishInput(e,!1)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})));const t=document.getElementById("object-symbol");t&&(t.addEventListener("focusout",(e=>{this.finishInput(e,!1)})),t.addEventListener("keypress",(e=>{this.finishInput(e,!1)})),t.addEventListener("focusin",(e=>{this.focusIn(e)})))}changeObjectSymbol(e){const t=d.$tools.getDefaultTool("arrow");switch(t.activeElements.length){case 0:d.$currentWorkSpace().scene.symbol=e;break;case 1:{const r=t.activeElements[0];d.$currentWorkSpace().getLibrary(0|r.dataset.libraryId).symbol=e}}return e}changeObjectName(e){const t=d.$tools.getDefaultTool("arrow");switch(t.activeElements.length){case 0:d.$currentWorkSpace().scene.name=e;break;case 1:{const r=t.activeElements[0];d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId).name=e}}return e}};d.$pluginController=new class{constructor(){this._$saved=!1,this._$selectElement=null,this._$deleteCommand=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),this._$deleteCommand=this.deleteCommand.bind(this);const e=document.getElementById("plugin-list-box");e&&(e.addEventListener("mouseleave",(()=>{this.mouseleave()})),e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(e=>{this.dropElement(e)}))),d.$initializeEnd()}dropElement(e){this.save(),e.preventDefault();const t=d.$currentWorkSpace(),r=[],a=e.dataTransfer.files;for(let e=0;e<a.length;++e){const i=a[e];r.push(i.text().then((e=>{t._$plugins.set(i.name,{name:i.name,src:e})})))}Promise.all(r).then((()=>{this.reload(Array.from(d.$currentWorkSpace()._$plugins.values())),this._$saved=!1}))}mouseleave(){this._$selectElement&&this._$selectElement.classList.remove("active"),window.removeEventListener("keydown",this._$deleteCommand),this._$selectElement=null}reload(e){const t=["plugin-list-box","plugin-tools","plugin-menu"];for(let e=0;e<t.length;++e){const r=document.getElementById(t[e]);if(r)for(;r.children.length;)r.children[0].remove()}const r=document.getElementsByTagName("script");for(let e=0;e<r.length;++e){const t=r[e];t.dataset.plugin&&t.remove()}for(let t=0;t<e.length;++t){const r=e[t];document.getElementById(r.name)||(this.appendScript(r.name,r.src),this.appendNode(r.name))}}appendScript(e,t){const r=document.createElement("script");r.dataset.plugin="true",r.async=!0,r.id=e,r.type="text/javascript",r.src=URL.createObjectURL(new Blob([t],{type:"text/javascript"})),document.getElementsByTagName("head")[0].appendChild(r)}appendNode(e){const t=document.createElement("div");t.dataset.id=`${e}_node`,t.dataset.name=`${e}`,t.classList.add("plugin-list"),t.innerHTML=`<i></i>${e}`,t.addEventListener("mousedown",(e=>{this._$selectElement||window.addEventListener("keydown",this._$deleteCommand),this._$selectElement&&this._$selectElement.classList.remove("active"),this._$selectElement=e.currentTarget,this._$selectElement.classList.add("active")})),document.getElementById("plugin-list-box").appendChild(t)}deleteCommand(e){d.$keyLock||"Backspace"===e.key&&(this.save(),window.removeEventListener("keydown",this._$deleteCommand),this.dispose(this._$selectElement),this._$selectElement=null,this._$saved=!1)}dispose(e){const t=e.dataset.name,r=document.getElementById(t);r&&r.remove(),d.$currentWorkSpace()._$plugins.delete(t),e.remove()}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}};class be{constructor(){this._$screenX=0,this._$screenY=0,this._$moveModal=null,this._$endModal=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=["plugin-bar","plugin-hide-icon"];for(let t=0;t<e.length;++t){const r=document.getElementById(e[t]);r&&r.addEventListener("mousedown",(e=>{e.stopPropagation();this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}))}document.documentElement.style.setProperty("--plugin-panel-width",`${be.PLUGIN_DEFAULT_WIDTH}px`),document.documentElement.style.setProperty("--plugin-panel-height",`${be.PLUGIN_DEFAULT_HEIGHT}px`),d.$initializeEnd()}static get PLUGIN_DEFAULT_WIDTH(){return 200}static get PLUGIN_DEFAULT_HEIGHT(){return 200}executePluginBar(e){this._$screenX=e.screenX,this._$screenY=e.screenY,this._$moveModal||(this._$moveModal=this.moveModal.bind(this)),this._$endModal||(this._$endModal=this.endModal.bind(this)),window.addEventListener("mousemove",this._$moveModal),window.addEventListener("mouseup",this._$endModal)}moveModal(e){const t=document.getElementById("plugin-modal");t.style.left=`${t.offsetLeft+(e.screenX-this._$screenX)}px`,t.style.top=`${t.offsetTop+(e.screenY-this._$screenY)}px`,this._$screenX=e.screenX,this._$screenY=e.screenY}endModal(){d.$setCursor("auto"),window.removeEventListener("mousemove",this._$moveModal),window.removeEventListener("mouseup",this._$endModal)}executePluginHideIcon(){window.nt.hidePanel()}}d.$pluginPanel=new be;d.$referenceController=new class extends ie{constructor(){super("reference"),this._$pointer=null}initialize(){super.initialize(),this._$pointer={x:0,y:0};const e=["transform-reference-x","transform-reference-y"];for(let t=0;t<e.length;++t)this.setInputEvent(document.getElementById(e[t]));const t=document.getElementById("reference-point");t&&t.addEventListener("dblclick",(e=>{e.stopPropagation(),this.resetPointer()}));const r=document.getElementById("reference-setting-box");if(r){const e=r.getElementsByClassName("reference-setting-box-child");for(let t=0;t<e.length;++t){e[t].addEventListener("mousedown",(e=>{e.stopPropagation(),this.moveNineReferencePoint(e)}))}}}get pointer(){return this._$pointer}set pointer(e){this._$pointer=e}moveNineReferencePoint(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const r=d.$currentWorkSpace().scene;let a=Number.MAX_VALUE,i=-Number.MAX_VALUE,s=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let e=0;t.length>e;++e){const o=t[e],l=r.getLayer(0|o.dataset.layerId);if(!l||l.lock||l.disable)continue;const c=0|o.dataset.characterId;if(!document.getElementById(`character-${c}`))continue;const d=l.getCharacter(c).getBounds();a=Math.min(a,d.xMin),i=Math.max(i,d.xMin+Math.abs(d.xMax-d.xMin)),s=Math.min(s,d.yMin),n=Math.max(n,d.yMin+Math.abs(d.yMax-d.yMin))}const o=a,l=s,c=i-a,h=n-s;let u=o+c/2,m=l+h/2;switch(e.target.dataset.position){case"top-left":u=o,m=l;break;case"top-center":u=o+c/2,m=l;break;case"top-right":u=o+c,m=l;break;case"center-left":u=o,m=l+h/2;break;case"center-right":u=o+c,m=l+h/2;break;case"bottom-left":u=o,m=l+h;break;case"bottom-center":u=o+c/2,m=l+h;break;case"bottom-right":u=o+c,m=l+h}if(this.save(),t.length>1)this._$pointer.x=u,this._$pointer.y=m;else{const e=t[0],r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId).getCharacter(0|e.dataset.characterId);if(!r)return;const a=d.$timelineFrame.currentFrame,i=r.getPlace(a);i.point||(i.point={x:0,y:0}),i.point.x=u,i.point.y=m}this.setInputValue(u,m),d.$transformController.relocation(),this._$saved=!1}changeTransformReferenceX(e){e=d.$clamp(+e,-Number.MAX_VALUE,Number.MAX_VALUE);const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return e;if(1===t.length){const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return e;const i=d.$timelineFrame.currentFrame;a.getPlace(i).point.x=e}else this._$pointer.x=e;return e}changeTransformReferenceY(e){e=d.$clamp(+e,-Number.MAX_VALUE,Number.MAX_VALUE);const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return e;if(1===t.length){const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return e;const i=d.$timelineFrame.currentFrame;a.getPlace(i).point.y=e}else this._$pointer.y=e;return e}resetPointer(){this._$pointer=null;const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;const t=d.$currentWorkSpace().scene;let r=Number.MAX_VALUE,a=-Number.MAX_VALUE,i=Number.MAX_VALUE,s=-Number.MAX_VALUE;for(let n=0;e.length>n;++n){const o=e[n],l=t.getLayer(0|o.dataset.layerId);if(!l||l.lock||l.disable)continue;const c=0|o.dataset.characterId;if(!document.getElementById(`character-${c}`))continue;const d=l.getCharacter(c).getBounds();r=Math.min(r,d.xMin),a=Math.max(a,d.xMin+Math.abs(d.xMax-d.xMin)),i=Math.min(i,d.yMin),s=Math.max(s,d.yMin+Math.abs(d.yMax-d.yMin))}if(1===e.length){const t=e[0],n=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId),o=d.$timelineFrame.currentFrame;n.getPlace(o).point={x:r+Math.abs(a-r)/2,y:i+Math.abs(s-i)/2}}else this._$pointer={x:r+Math.abs(a-r)/2,y:i+Math.abs(s-i)/2};d.$transformController.relocation()}setInputValue(e=0,t=0){document.getElementById("transform-reference-x").value=`${e}`,document.getElementById("transform-reference-y").value=`${t}`}};class ve extends ie{constructor(){super("fill-color"),this._$currentPointer=null,this._$viewGradientContext=null,this._$drawGradientContext=null,this._$mouseMoveGradientColorPointer=null,this._$mouseUpGradientColorPointer=null}static get GRADIENT_CANVAS_WIDTH(){return 255}static get GRADIENT_CANVAS_HEIGHT(){return 30}static get MIN_COLOR(){return 0}static get MAX_COLOR(){return 100}static get MIN_ALPHA(){return 0}static get MAX_ALPHA(){return 100}static get MIN_STROKE(){return 1}static get MAX_STROKE(){return 255}static get MIN_GRADIENT_POINTER(){return 0}static get MAX_GRADIENT_POINTER(){return 255}initialize(){super.initialize();const e=document.getElementById("gradient-canvas");if(e){e.style.transform=`scale(${1/window.devicePixelRatio}, ${1/window.devicePixelRatio})`,e.style.backfaceVisibility="hidden",e.style.transformOrigin="0 0";const t=ve.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,r=ve.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio;e.width=t,e.height=r,this._$viewGradientContext=e.getContext("2d");const a=document.createElement("canvas");a.width=t,a.height=r,this._$drawGradientContext=a.getContext("2d")}const t=["fill-alpha-value","fill-stroke-width-value"];for(let e=0;e<t.length;++e)this.setInputEvent(document.getElementById(t[e]));const r=["fill-color-type-select","fill-color-value","fill-bitmap-select"];for(let e=0;e<r.length;++e)this.setChangeEvent(document.getElementById(r[e]));const a=document.getElementById("color-pointer-list");a&&a.addEventListener("mousedown",(e=>{this.setGradientColorPointerEvent(e)}))}removeGradientColorPointer(e){const t=document.getElementById("color-pointer-list");if(t.children.length>2&&d.$hitColor){const r=0|e.target.dataset.index;d.$hitColor.ratios.splice(r,1),e.target.remove();for(let e=r;e<t.children.length;++e){const r=t.children[e],a=(0|r.dataset.index)-1;r.dataset.index=`${a}`}this.updateGradientCanvas(),d.$hitColor.shape.cacheClear(),this.reloadScreen()}}setGradientColorPointerEvent(e){if(!this._$currentPointer||!d.$hitColor)return;const t=document.getElementById("fill-color-value").value,r=0|document.getElementById("fill-alpha-value").value,a=d.$intToRGB(0|`0x${t.slice(1)}`),i={R:a.R,G:a.G,B:a.B,A:r/100*255,ratio:e.offsetX/255};d.$hitColor.ratios.push(i),d.$hitColor.ratios.sort(((e,t)=>{switch(!0){case e.ratio>t.ratio:return 1;case e.ratio<t.ratio:return-1;default:return 0}})),this.initializeGradient(),d.$hitColor.shape.cacheClear(),this.reloadScreen(),this._$currentPointer=e.target.children[d.$hitColor.ratios.indexOf(i)]}changeFillAlphaValue(e){if(e=d.$clamp(0|e,ve.MIN_ALPHA,ve.MAX_ALPHA),d.$hitColor){const{GradientType:t}=window.next2d.display;switch(d.$hitColor.type){case t.LINEAR:case t.RADIAL:this._$currentPointer&&(this._$currentPointer.dataset.alpha=e,d.$hitColor.shape.changeColor(0|this._$currentPointer.dataset.index),this.updateGradientCanvas());break;default:d.$hitColor.shape.changeColor()}}return e}changeFillStrokeWidthValue(e){if(e=d.$clamp(0|e,ve.MIN_STROKE,ve.MAX_STROKE),this._$currentValue!==e&&d.$hitColor){d.$hitColor.shape.changeColor();const{GradientType:e}=window.next2d.display;switch(d.$hitColor.type){case e.LINEAR:case e.RADIAL:this.updateGradientCanvas()}}return e}changeFillColorTypeSelect(e=""){const t=document.getElementById("fill-color-gradient-container"),r=document.getElementById("fill-color-bitmap-container"),a=document.getElementById("fill-color-rgba-container"),i=document.getElementById("fill-stroke-color-rgba-container");switch(e&&(d.$hitColor.shape.bitmapId=0),document.getElementById("fill-color-type-select").value){case"rgba":t.style.display="none",r.style.display="none",a.style.display="",i.style.display=d.$hitColor.width?"":"none";break;case"bitmap":t.style.display="none",r.style.display="",a.style.display="none",i.style.display=d.$hitColor.width?"":"none",this.createBitmapList();break;default:t.style.display="",r.style.display="none",a.style.display="",i.style.display=d.$hitColor.width?"":"none",e||this.initializeGradient()}e&&d.$hitColor.shape.changeStyle(e)}changeFillColorValue(e){if(d.$hitColor)if(this._$currentPointer){const t=this._$currentPointer.getElementsByTagName("i")[0];this._$currentPointer.dataset.color=e,t.style.backgroundColor=e,d.$hitColor.shape.changeColor(0|this._$currentPointer.dataset.index),this.updateGradientCanvas()}else d.$hitColor.shape.changeColor()}changeFillBitmapSelect(e){if(!d.$hitColor)return;const t=d.$currentWorkSpace().getLibrary(0|e);d.$hitColor.shape.bitmapId=t.id,d.$hitColor.shape.cacheClear()}createBitmapList(){const e=document.getElementById("fill-bitmap-select"),t=e.children;for(;t.length;)t[0].remove();const r=document.createElement("option");r.innerHTML="Image Selection",r.defaultSelected=!0,r.disabled=!0,e.appendChild(r);const a=d.$hitColor.shape.bitmapId,i=d.$currentWorkSpace();for(const t of i._$libraries.values()){if(t.type!==b.BITMAP)continue;const r=document.createElement("option");r.value=t.id,r.innerHTML=t.name,a&&a===t.id&&(r.selected=!0),e.appendChild(r)}}initializeGradient(){if(!d.$hitColor)return;const e=document.getElementById("color-pointer-list").children;for(;e.length;)e[0].remove();const t=d.$hitColor.ratios.length;for(let e=0;e<t;++e){const r=d.$hitColor.ratios[e],a=r.R.toString(16).padStart(2,"0"),i=r.G.toString(16).padStart(2,"0"),s=r.B.toString(16).padStart(2,"0");this.addGradientColorPointer(e,255*r.ratio,`#${a}${i}${s}`,r.A/255*100),e+1===t&&(document.getElementById("fill-color-value").value=`#${a}${i}${s}`,document.getElementById("fill-alpha-value").value=r.A/255*100)}this.updateGradientCanvas()}addGradientColorPointer(e,t,r,a){const i=document.getElementById("color-pointer-list"),s=`\n<div class="color-pointer" style="left: ${t-4}px;" data-index="${e}" data-color="${r}" data-alpha="${a}">\n    <div class="color-pointer-triangle"></div>\n    <div class="color-pointer-rect">\n        <i class="pointer-color" style="background-color: ${r}"></i>\n    </div>\n</div>\n`;i.insertAdjacentHTML("beforeend",s);const n=i.lastElementChild;n.addEventListener("mousedown",(e=>{this.mouseDownGradientColorPointer(e)})),n.addEventListener("dblclick",(e=>{this.removeGradientColorPointer(e)})),this._$currentPointer=n}updateGradientCanvas(){const e=this._$drawGradientContext;e.clearRect(0,0,ve.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,ve.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.beginPath();const t=d.$hitColor.ratios,r=t.length,a=Math.ceil(255*t[r-1].ratio*window.devicePixelRatio),i=e.createLinearGradient(0,0,a,0);for(let e=0;e<r;++e){const r=t[e];i.addColorStop(r.ratio,`rgba(${r.R}, ${r.G}, ${r.B}, ${r.A/255})`)}e.fillStyle=i,e.rect(0,0,ve.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,ve.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.fill();const s=this._$viewGradientContext;s.clearRect(0,0,ve.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,ve.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),s.drawImage(e.canvas,0,0)}mouseDownGradientColorPointer(e){e.stopPropagation(),this._$saved=!1,this._$pointX=e.screenX,this._$currentPointer=e.target,document.getElementById("fill-color-value").value=e.target.dataset.color,document.getElementById("fill-alpha-value").value=e.target.dataset.alpha,this._$mouseMoveGradientColorPointer||(this._$mouseMoveGradientColorPointer=this.mouseMoveGradientColorPointer.bind(this)),this._$mouseUpGradientColorPointer||(this._$mouseUpGradientColorPointer=this.mouseUpGradientColorPointer.bind(this)),window.addEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.addEventListener("mouseup",this._$mouseUpGradientColorPointer)}mouseMoveGradientColorPointer(e){const t=this._$currentPointer;t&&window.requestAnimationFrame((()=>{if(!d.$hitColor)return;this.save(),e.preventDefault();const r=parseFloat(t.style.left),a=d.$clamp(r+(e.screenX-this._$pointX)+4,ve.MIN_GRADIENT_POINTER,ve.MAX_GRADIENT_POINTER);t.style.left=a-4+"px",d.$hitColor.ratios[t.dataset.index].ratio=a/255,this._$pointX&&(this._$pointX=e.screenX),this.updateGradientCanvas(),d.$hitColor.shape.cacheClear(),this.reloadScreen()}))}mouseUpGradientColorPointer(){window.removeEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.removeEventListener("mouseup",this._$mouseUpGradientColorPointer),d.$setCursor("auto"),super.focusOut()}}d.$shapeController=new ve;class Ie extends ie{constructor(){super("sound")}static get MIN_VOLUME(){return 0}static get MAX_VOLUME(){return 100}static get MIN_LOOP_COUNT(){return 0}static get MAX_LOOP_COUNT(){return 65535}initialize(){super.initialize();const e=document.getElementById("sound-add");e&&e.addEventListener("mousedown",(()=>{const e=document.getElementById("sound-select");e&&e.options.length&&(this.save(),this.addSound(),this._$saved=!1)}))}addSound(e=null,t=0){if(!e){const r=document.getElementById("sound-select"),a=r.options[r.selectedIndex],i=d.$timelineFrame.currentFrame,s=d.$currentWorkSpace().scene;s._$sounds.has(i)||s._$sounds.set(i,[]);const n=s._$sounds.get(i);t=n.length,e={characterId:0|r.value,name:a.textContent,volume:100,loopCount:0,autoPlay:!1},n.push(e),this.setIcon(i)}const r=`\n<div id="sound-id-${t}" class="sound-border">\n    <div class="sound-title">\n      <span id="sound-name-${t}" data-sound-id="${t}">${e.name}</span>\n      <i class="trash" id="sound-trash-${t}" data-sound-id="${t}" data-detail="{{サウンドを削除}}"></i>\n    </div>\n\n    <div class="sound-container">\n        <div class="sound-setting-container">\n            <div class="sound-text">Volume</div>\n            <div><input type="text" id="sound-volume-${t}" data-sound-id="${t}" data-name="volume" value="100" data-detail="{{音量設定}}"></div>\n        \n            <div class="sound-text">Loop<br>Count</div>\n            <div><input type="text" id="sound-loop-count-${t}" data-sound-id="${t}" data-name="loop-count" value="0" data-detail="{{ループ回数}}"></div>\n        </div>\n    </div>\n</div>\n`;document.getElementById("sound-list-area").insertAdjacentHTML("beforeend",r);const a=document.getElementById(`sound-volume-${t}`);a.value=`${e.volume}`,this.setInputEvent(a);const i=document.getElementById(`sound-loop-count-${t}`);i.value=`${e.loopCount}`,this.setInputEvent(i),document.getElementById(`sound-trash-${t}`).addEventListener("click",(e=>{this.save(),this.trash(0|e.target.dataset.soundId),this.createSoundElements(),this._$saved=!1})),d.$addModalEvent(document.getElementById(`sound-id-${t}`))}changeSoundVolume(e){return e=d.$clamp(0|e,Ie.MIN_VOLUME,Ie.MAX_VOLUME),this.updateSoundProperty("volume",e),e}changeSoundLoopCount(e){return e=d.$clamp(0|e,Ie.MIN_LOOP_COUNT,Ie.MAX_LOOP_COUNT),this.updateSoundProperty("loopCount",e),e}updateSoundProperty(e,t){if(!this._$currentTarget)return;const r=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene,i=0|this._$currentTarget.dataset.soundId;a._$sounds.get(r)[i][e]=t}setIcon(e){const t=d.$timelineHeader.leftFrame;if(t>e)return;const r=e-t,a=document.getElementById("timeline-header").children[r].children[ce.SOUND_INDEX];a.classList.contains("frame-border-box-sound")||a.setAttribute("class","frame-border-box-sound")}deleteIcon(e){const t=document.getElementById(`frame-label-sound-${e}`);t&&t.setAttribute("class","frame-border-box")}trash(e){const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene,a=r._$sounds.get(t);a.splice(e,1),a.length||(r._$sounds.delete(t),this.deleteIcon(t))}createSoundElements(){const e=document.getElementById("sound-list-area");if(e)for(;e.children.length;)e.children[0].remove();const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene;if(r.hasSound(t)){const e=r.getSound(t);for(let t=0;t<e.length;++t)this.addSound(e[t],t)}}}d.$soundController=new Ie;class Ee extends ie{constructor(){super("stage"),this._$stageLock=!1}static get MIN_FPS(){return 1}static get MAX_FPS(){return 60}static get MIN_STAGE_SIZE(){return 1}static get MAX_STAGE_SIZE(){return 3e3}static get MIN_STROKE_SIZE(){return 0}static get MAX_STROKE_SIZE(){return 200}initialize(){super.initialize();const e=document.getElementById("stage-lock");e&&e.addEventListener("mousedown",(e=>{this.stageLock(e)}));const t=["stage-width","stage-height","stage-fps"];for(let e=0;e<t.length;++e)this.setInputEvent(document.getElementById(t[e]));this.setChangeEvent(document.getElementById("stage-bgColor"))}stageLock(e){e.stopPropagation(),this._$stageLock=!this._$stageLock,this._$currentValue=null,e.currentTarget.childNodes[1].setAttribute("class",this._$stageLock?"active":"disable")}changeStageBgColor(e){document.getElementById("stage").style.backgroundColor=e,document.getElementById("library-preview-area").style.backgroundColor=e;d.$currentWorkSpace().stage.bgColor=e}changeStageWidth(e){e=d.$clamp(0|e,Ee.MIN_STAGE_SIZE,Ee.MAX_STAGE_SIZE);const t=document.getElementById("stage-area"),r=document.getElementById("stage"),a=d.$currentWorkSpace();return t.style.width=`${e+window.screen.width}px`,r.style.width=`${e}px`,a.stage.width=e,d.$offsetLeft=r.offsetLeft,d.$offsetTop=r.offsetTop,e}changeStageHeight(e){e=d.$clamp(0|e,Ee.MIN_STAGE_SIZE,Ee.MAX_STAGE_SIZE);const t=document.getElementById("stage-area"),r=document.getElementById("stage"),a=d.$currentWorkSpace();return t.style.height=`${e+window.screen.height}px`,r.style.height=`${e}px`,a.stage.height=e,d.$offsetLeft=r.offsetLeft,d.$offsetTop=r.offsetTop,e}changeStageFps(e){e=d.$clamp(0|e,Ee.MIN_FPS,Ee.MAX_FPS),d.$timelineHeader.rebuild();return d.$currentWorkSpace().stage.fps=e,e}}d.$stageController=new Ee;d.$tabController=new class{constructor(){this._$active=null,this._$handler=null,d.$readEnd++,"complete"!==document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("controller-tab-area");if(e){const t=e.children;for(let e=0;e<t.length;++e){const r=t[e];this._$active||(r.classList.add("active"),this._$active=r),r.addEventListener("click",(e=>{this.mouseDown(e)}))}}const t=document.getElementById("controller-area");if(t){const e=t.children;for(let t=0;t<e.length;++t){const r=e[t];t&&(r.style.display="none")}}d.$initializeEnd()}mouseDown(e){e.stopPropagation(),d.$endMenu(),this._$active.classList.remove("active"),this._$active.classList.add("disable"),e.target.classList.remove("disable"),e.target.classList.add("active"),this._$active=e.target;const t=document.getElementById("controller-area").children;for(let r=0;r<t.length;++r){const a=t[r];a.id===e.target.dataset.tabType?a.style.display="":a.style.display="none"}"controller-area-property"===e.target.dataset.tabType&&this.showController()}showController(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(1!==e.length)return;const t=d.$currentWorkSpace().scene,r=e[0];t.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId).showController()}};class Se extends ie{constructor(){super("text")}static get MIN_SIZE(){return 0}static get MAX_SIZE(){return 255}static get MIN_FONT_SIZE(){return 10}static get MAX_FONT_SIZE(){return 255}static get MIN_STROKE_SIZE(){return 0}static get MAX_STROKE_SIZE(){return 200}initialize(){super.initialize();const e=["font-select","font-style-select","font-align-select","font-wrap-select","font-input-select","font-scroll-select","font-border-select","font-auto-size-select","font-color","font-stroke-color"];for(let t=0;t<e.length;++t)this.setChangeEvent(document.getElementById(e[t]));const t=["font-size","font-stroke-size","font-leading","font-letterSpacing","font-leftMargin","font-rightMargin"];for(let e=0;e<t.length;++e)this.setInputEvent(document.getElementById(t[e]))}changeFontLeading(e){return e=d.$clamp(0|e,Se.MIN_SIZE,Se.MAX_SIZE),this.updateText({name:"leading",value:e}),e}changeFontLetterSpacing(e){return e=d.$clamp(0|e,-Se.MAX_SIZE,Se.MAX_SIZE),this.updateText({name:"letterSpacing",value:e}),e}changeFontLeftMargin(e){return e=d.$clamp(0|e,Se.MIN_SIZE,Se.MAX_SIZE),this.updateText({name:"leftMargin",value:e}),e}changeFontRightMargin(e){return e=d.$clamp(0|e,Se.MIN_SIZE,Se.MAX_SIZE),this.updateText({name:"rightMargin",value:e}),e}changeFontStrokeSize(e){return e=d.$clamp(0|e,Se.MIN_STROKE_SIZE,Se.MAX_STROKE_SIZE),this.updateText({name:"thickness",value:e}),e}changeFontSize(e){return e=d.$clamp(0|e,Se.MIN_FONT_SIZE,Se.MAX_FONT_SIZE),this.updateText({name:"size",value:e}),e}changeFontStrokeColor(e){this.updateText({name:"thicknessColor",value:0|`0x${e.slice(1)}`})}changeFontColor(e){this.updateText({name:"color",value:0|`0x${e.slice(1)}`})}changeFontSelect(e){this.updateText({name:"font",value:e})}changeFontStyleSelect(e){e|=0,this.updateText({name:"fontType",value:d.$clamp(e,0,3)})}changeFontAlignSelect(e){switch(e){case"left":case"center":case"right":this.updateText({name:"align",value:e})}}changeFontWrapSelect(e){switch(0|e){case 0:this.updateText({name:"wordWrap",value:!1}),this.updateText({name:"multiline",value:!1});break;case 1:this.updateText({name:"wordWrap",value:!1}),this.updateText({name:"multiline",value:!0});break;case 2:this.updateText({name:"wordWrap",value:!0}),this.updateText({name:"multiline",value:!0})}}changeFontInputSelect(e){e|=0,this.updateText({name:"inputType",value:e?"input":"static"})}changeFontScrollSelect(e){this.updateText({name:"scroll",value:!!(0|e)})}changeFontBorderSelect(e){this.updateText({name:"border",value:!!(0|e)})}changeFontAutoSizeSelect(e){e|=0,this.updateText({name:"autoSize",value:d.$clamp(e,0,2)})}updateText(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const r=d.$currentWorkSpace(),a=r.scene,i=t[0],s=a.getLayer(0|i.dataset.layerId).getCharacter(0|i.dataset.characterId);r.getLibrary(s.libraryId)[e.name]=e.value,s.dispose()}}d.$textController=new Se;class we extends ie{constructor(){super("transform"),this._$state="hide",this._$sizeLock=!1,this._$scaleLock=!1,this._$screenTargets=["target-rect","scale-top-left","scale-top-right","scale-bottom-left","scale-bottom-right","scale-center-left","scale-center-top","scale-center-right","scale-center-bottom","target-rotation","reference-point"]}static get MIN_SIZE(){return 1}static get MAX_SIZE(){return 3e3}static get MIN_SCALE(){return-32768}static get MAX_SCALE(){return 32767}static get MIN_ROTATE(){return-360}static get MAX_ROTATE(){return 360}initialize(){super.initialize();for(let e=0;e<this._$screenTargets.length;++e){const t=document.getElementById(this._$screenTargets[e]);t&&(t.style.display="none",t.addEventListener("mousedown",(e=>{this.standbyPointer(e)})))}const e=document.getElementById("transform-size-lock");e&&e.addEventListener("mousedown",(e=>{this.sizeLock(e)}));const t=document.getElementById("transform-scale-lock");t&&t.addEventListener("mousedown",(e=>{this.scaleLock(e)}));const r=["object-width","object-height","object-x","object-y","transform-scale-x","transform-scale-y","transform-rotate"];for(let e=0;e<r.length;++e)this.setInputEvent(document.getElementById(r[e]))}changeObjectWidth(e){return e=d.$clamp(+e,we.MIN_SIZE,we.MAX_SIZE),this.updateWidth(e),e}changeObjectHeight(e){return e=d.$clamp(+e,we.MIN_SIZE,we.MAX_SIZE),this.updateHeight(e),e}changeObjectX(e){return e=d.$clamp(+e,we.MIN_SCALE,we.MAX_SCALE),this.updateX(e-this._$currentValue),e}changeObjectY(e){return e=d.$clamp(+e,we.MIN_SCALE,we.MAX_SCALE),this.updateY(e-this._$currentValue),e}changeTransformScaleX(e){return e=d.$clamp(+e,we.MIN_SCALE,we.MAX_SCALE),this.updateScaleX(e/100),e}changeTransformScaleY(e){return e=d.$clamp(+e,we.MIN_SCALE,we.MAX_SCALE),this.updateScaleY(e/100),e}changeTransformRotate(e){return 0>(e=d.$clamp((0|e)%360,we.MIN_ROTATE,we.MAX_ROTATE))&&(e+=360),this.updateRotate(e),e}focusIn(e){super.focusIn(e),this.setLockElement(e)}mouseDown(e){super.mouseDown(e),this.setLockElement(e)}setLockElement(e){if(!this._$focus)switch(e.target.id){case"object-width":this._$sizeLock&&(this._$lockTarget=document.getElementById("object-height"));break;case"object-height":this._$sizeLock&&(this._$lockTarget=document.getElementById("object-width"));break;case"transform-scale-x":this._$scaleLock&&(this._$lockTarget=document.getElementById("transform-scale-y"));break;case"transform-scale-y":this._$scaleLock&&(this._$lockTarget=document.getElementById("transform-scale-x"))}}scaleLock(e){e.stopPropagation(),this._$scaleLock=!this._$scaleLock,this._$currentValue=null,this._$scaleLock||(this._$lockTarget=null),e.currentTarget.childNodes[1].setAttribute("class",this._$scaleLock?"active":"disable")}sizeLock(e){e.stopPropagation(),this._$sizeLock=!this._$sizeLock,this._$currentValue=null,this._$sizeLock||(this._$lockTarget=null),e.currentTarget.childNodes[1].setAttribute("class",this._$sizeLock?"active":"disable")}standbyPointer(e){e.stopPropagation();const t=d.$tools.activeTool;t&&(e.transform=!0,t.dispatchEvent(Y.MOUSE_DOWN,e))}show(){if("show"!==this._$state){this._$state="show";for(let e=0;e<this._$screenTargets.length;++e){const t=document.getElementById(this._$screenTargets[e]);t&&(t.style.display="")}}return this}hide(){if("hide"!==this._$state){for(let e=0;e<this._$screenTargets.length;++e){const t=document.getElementById(this._$screenTargets[e]);t&&t.setAttribute("style","display:none;")}this._$state="hide"}}relocation(){if("hide"===this._$state)return;const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return this.hide();const t=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame;let a=0,i=Number.MAX_VALUE,s=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let r=0;r<e.length;++r){const l=e[r],c=t.getLayer(0|l.dataset.layerId);if(!c||c.lock||c.disable){a++;continue}const h=0|l.dataset.characterId;if(!document.getElementById(`character-${h}`))continue;const u=c.getCharacter(h).getBounds(),m=d.$offsetLeft+u.xMin*d.$zoomScale,g=d.$offsetTop+u.yMin*d.$zoomScale;i=Math.min(i,m),s=Math.max(s,m+Math.ceil(Math.abs(u.xMax-u.xMin))*d.$zoomScale),n=Math.min(n,g),o=Math.max(o,g+Math.ceil(Math.abs(u.yMax-u.yMin))*d.$zoomScale)}if(e.length-a==0)return this.hide();const l=s-i,c=o-n;let h=null;if(1===e.length){const a=e[0],i=t.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId),s=i.getPlace(r);if(!s.point){const e=i.getBounds();s.point={x:e.xMin+i.width/2,y:e.yMin+i.height/2}}h=s.point,d.$referenceController.setInputValue(h.x,h.y);if(!document.getElementById(`character-${i.id}`))return this.hide()}else d.$referenceController.pointer||(d.$referenceController.pointer={x:i+l/2,y:n+c/2}),h=d.$referenceController.pointer;if(h){const e=d.$offsetLeft+h.x*d.$zoomScale,t=d.$offsetTop+h.y*d.$zoomScale;document.getElementById("reference-point").setAttribute("style",`left: ${e-8}px; top: ${t-8}px;`)}document.getElementById("target-rect").setAttribute("style",`width: ${l-2}px; height: ${c-2}px; left: ${i}px; top: ${n}px;`),document.getElementById("scale-top-left").setAttribute("style",`left: ${i-5}px; top: ${n-5}px;`),document.getElementById("scale-top-right").setAttribute("style",`left: ${s-5}px; top: ${n-5}px;`),document.getElementById("scale-bottom-left").setAttribute("style",`left: ${i-5}px; top: ${o-5}px;`),document.getElementById("scale-bottom-right").setAttribute("style",`left: ${s-5}px; top: ${o-5}px;`),document.getElementById("target-rotation").setAttribute("style",`left: ${s+5}px; top: ${o+5}px;`),document.getElementById("scale-center-left").setAttribute("style",`left: ${i-5}px; top: ${n+c/2-5}px;`),document.getElementById("scale-center-top").setAttribute("style",`left: ${i+l/2-5}px; top: ${n-5}px;`),document.getElementById("scale-center-right").setAttribute("style",`left: ${s-5}px; top: ${n+c/2-5}px;`),document.getElementById("scale-center-bottom").setAttribute("style",`left: ${i+l/2-5}px; top: ${o-5}px;`)}updateX(e){const t=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame,a=d.$tools.getDefaultTool("arrow").activeElements;for(let i=0;i<a.length;++i){const s=a[i],n=0|s.dataset.layerId,o=t.getLayer(n),l=0|s.dataset.characterId,c=o.getCharacter(l);c.x+=e;const d=c.getPlace(r);if(!d.point){const e=c.getBounds();d.point={x:d.matrix[4]+(e.xMax-e.xMin)/2,y:d.matrix[5]+(e.yMax-e.yMin)/2}}d.point.x+=e,c.relocationTween(r)}if(a.length>1){d.$referenceController.pointer.x+=e}this.relocation()}updateY(e){const t=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame,a=d.$tools.getDefaultTool("arrow").activeElements;for(let i=0;i<a.length;++i){const s=a[i],n=0|s.dataset.layerId,o=t.getLayer(n),l=0|s.dataset.characterId,c=o.getCharacter(l);c.y+=e;const d=c.getPlace(r);if(!d.point){const e=c.getBounds();d.point={x:d.matrix[4]+(e.xMax-e.xMin)/2,y:d.matrix[5]+(e.yMax-e.yMin)/2}}d.point.y+=e,c.relocationTween(r)}if(a.length>1){d.$referenceController.pointer.y+=e}this.relocation()}updateWidth(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;e=d.$clamp(e,we.MIN_SIZE,we.MAX_SIZE);const r=d.$currentWorkSpace(),a=r.scene;if(t.length>1){let r=Number.MAX_VALUE,i=-Number.MAX_VALUE,s=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let e=0;e<t.length;++e){const o=t[e],l=0|o.dataset.layerId,c=a.getLayer(l),d=0|o.dataset.characterId,h=c.getCharacter(d).getBounds();r=Math.min(r,h.xMin),i=Math.max(i,h.xMax),s=Math.min(s,h.yMin),n=Math.max(n,h.yMax)}this.updateScaleX(e/Math.abs(i-r))}else{const i=t[0],s=0|i.dataset.layerId,n=a.getLayer(s),o=0|i.dataset.characterId,l=n.getCharacter(o),c=r.getLibrary(l.libraryId).getBounds([1,0,0,1,0,0]);this.updateScaleX(e/Math.abs(c.xMax-c.xMin)),document.getElementById("transform-scale-x").value=""+100*l.scaleX}}updateScaleX(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;e=d.$toFixed4(d.$clamp(e,we.MIN_SCALE,we.MAX_SCALE));const r=d.$currentWorkSpace().scene,a=d.$timelineFrame.currentFrame;let i=Number.MAX_VALUE,s=Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,l=Number.MAX_VALUE,c=-Number.MAX_VALUE;if(t.length>1){const i=d.$referenceController.pointer,s=i.x,h=i.y,u=d.$multiplicationMatrix([e,0,0,1,0,0],[1,0,0,1,-s,-h]);for(let e=0;e<t.length;++e){const i=t[e],m=0|i.dataset.layerId,g=r.getLayer(m),p=0|i.dataset.characterId,$=g.getCharacter(p),f=$.getPlace(a),y=f.point,_=d.$multiplicationMatrix(u,[1,0,0,1,y.x,y.y]);y.x=_[4]+s,y.y=_[5]+h;const b=d.$multiplicationMatrix(u,f.matrix);f.matrix[0]=b[0],f.matrix[1]=b[1],f.matrix[2]=b[2],f.matrix[3]=b[3],f.matrix[4]=b[4]+s,f.matrix[5]=b[5]+h;const v=$.getBounds();n=Math.min(n,v.xMin),o=Math.max(o,v.xMax),l=Math.min(l,v.yMin),c=Math.max(c,v.yMax),$.dispose(),$.relocationTween(a)}document.getElementById("transform-scale-y").value="100",document.getElementById("transform-scale-x").value="100"}else for(let h=0;h<t.length;++h){const u=t[h],m=0|u.dataset.layerId,g=r.getLayer(m).getCharacter(0|u.dataset.characterId),p=g.getPlace(a),$=d.$inverseMatrix(p.matrix),f=p.point,y=f.x*$[0]+f.y*$[2]+$[4],_=f.x*$[1]+f.y*$[3]+$[5],b=[1,0,0,1,-y,-_],v=d.$multiplicationMatrix([p.matrix[0],p.matrix[1],p.matrix[2],p.matrix[3],y,_],b);g.x-=v[4],g.y-=v[5],g.scaleX=e;const I=d.$multiplicationMatrix([p.matrix[0],p.matrix[1],p.matrix[2],p.matrix[3],y,_],b);g.x+=I[4],g.y+=I[5],g.dispose(),i=Math.min(i,g.x),s=Math.min(s,g.y);const E=g.getBounds();n=Math.min(n,E.xMin),o=Math.max(o,E.xMax),l=Math.min(l,E.yMin),c=Math.max(c,E.yMax),document.getElementById("transform-scale-x").value=""+100*e,g.relocationTween(a)}document.getElementById("object-x").value=`${i}`,document.getElementById("object-y").value=`${s}`,document.getElementById("object-width").value=`${Math.abs(o-n)}`,document.getElementById("object-height").value=`${Math.abs(c-l)}`}updateHeight(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;e=d.$clamp(e,we.MIN_SIZE,we.MAX_SIZE);const r=d.$currentWorkSpace(),a=r.scene;if(t.length>1){let r=Number.MAX_VALUE,i=-Number.MAX_VALUE,s=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let e=0;e<t.length;++e){const o=t[e],l=0|o.dataset.layerId,c=a.getLayer(l),d=0|o.dataset.characterId,h=c.getCharacter(d).getBounds([1,0,0,1,0,0]);r=Math.min(r,h.xMin),i=Math.max(i,h.xMax),s=Math.min(s,h.yMin),n=Math.max(n,h.yMax)}this.updateScaleY(e/Math.abs(n-s))}else{const i=t[0],s=0|i.dataset.layerId,n=a.getLayer(s),o=0|i.dataset.characterId,l=n.getCharacter(o),c=r.getLibrary(l.libraryId).getBounds([1,0,0,1,0,0]);this.updateScaleY(e/Math.abs(c.yMax-c.yMin)),document.getElementById("transform-scale-y").value=""+100*l.scaleY}}updateScaleY(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;e=d.$toFixed4(d.$clamp(e,we.MIN_SCALE,we.MAX_SCALE));const r=d.$currentWorkSpace().scene,a=d.$timelineFrame.currentFrame;let i=Number.MAX_VALUE,s=Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,l=Number.MAX_VALUE,c=-Number.MAX_VALUE;if(t.length>1){const i=d.$referenceController.pointer,s=i.x,h=i.y,u=d.$multiplicationMatrix([1,0,0,e,0,0],[1,0,0,1,-s,-h]);for(let e=0;e<t.length;++e){const i=t[e],m=0|i.dataset.layerId,g=r.getLayer(m),p=0|i.dataset.characterId,$=g.getCharacter(p),f=$.getPlace(a),y=f.point,_=d.$multiplicationMatrix(u,[1,0,0,1,y.x,y.y]);y.x=_[4]+s,y.y=_[5]+h;const b=d.$multiplicationMatrix(u,f.matrix);f.matrix[0]=b[0],f.matrix[1]=b[1],f.matrix[2]=b[2],f.matrix[3]=b[3],f.matrix[4]=b[4]+s,f.matrix[5]=b[5]+h;const v=$.getBounds();n=Math.min(n,v.xMin),o=Math.max(o,v.xMax),l=Math.min(l,v.yMin),c=Math.max(c,v.yMax),$.dispose(),$.relocationTween(a)}document.getElementById("transform-scale-y").value="100",document.getElementById("transform-scale-x").value="100"}else for(let h=0;h<t.length;++h){const u=t[h],m=0|u.dataset.layerId,g=r.getLayer(m).getCharacter(0|u.dataset.characterId),p=g.getPlace(a),$=d.$inverseMatrix(p.matrix),f=p.point,y=f.x*$[0]+f.y*$[2]+$[4],_=f.x*$[1]+f.y*$[3]+$[5],b=[1,0,0,1,-y,-_],v=d.$multiplicationMatrix([p.matrix[0],p.matrix[1],p.matrix[2],p.matrix[3],y,_],b);g.x-=v[4],g.y-=v[5],g.scaleY=e;const I=d.$multiplicationMatrix([p.matrix[0],p.matrix[1],p.matrix[2],p.matrix[3],y,_],b);g.x+=I[4],g.y+=I[5],g.dispose(),i=Math.min(i,g.x),s=Math.min(s,g.y);const E=g.getBounds();n=Math.min(n,E.xMin),o=Math.max(o,E.xMax),l=Math.min(l,E.yMin),c=Math.max(c,E.yMax),document.getElementById("transform-scale-y").value=""+100*e,g.relocationTween(a)}document.getElementById("object-x").value=`${i}`,document.getElementById("object-y").value=`${s}`,document.getElementById("object-width").value=`${Math.abs(o-n)}`,document.getElementById("object-height").value=`${Math.abs(c-l)}`}updateRotate(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const{Matrix:r}=window.next2d.geom,a=d.$currentWorkSpace().scene,i=d.$timelineFrame.currentFrame;let s=Number.MAX_VALUE,n=-Number.MAX_VALUE,o=Number.MAX_VALUE,l=-Number.MAX_VALUE;if(t.length>1){const c=d.$referenceController.pointer,h=c.x,u=c.y,m=e*d.$Deg2Rad,g=d.$multiplicationMatrix([Math.cos(m),Math.sin(m),-Math.sin(m),Math.cos(m),0,0],[1,0,0,1,-h,-u]);for(let e=0;e<t.length;++e){const c=t[e],m=0|c.dataset.layerId,p=a.getLayer(m),$=0|c.dataset.characterId,f=p.getCharacter($),y=f.getPlace(i);new r(y.matrix[0],y.matrix[1],y.matrix[2],y.matrix[3],y.matrix[4],y.matrix[5]).invert();const _=y.point,b=d.$multiplicationMatrix(g,[1,0,0,1,_.x,_.y]);_.x=b[4]+h,_.y=b[5]+u;const v=d.$multiplicationMatrix(g,y.matrix);y.matrix[0]=v[0],y.matrix[1]=v[1],y.matrix[2]=v[2],y.matrix[3]=v[3],y.matrix[4]=v[4]+h,y.matrix[5]=v[5]+u;const I=f.getBounds();s=Math.min(s,I.xMin),n=Math.max(n,I.xMax),o=Math.min(o,I.yMin),l=Math.max(l,I.yMax),f.dispose(),f.relocationTween(i)}document.getElementById("transform-scale-y").value="100",document.getElementById("transform-scale-x").value="100"}else for(let c=0;c<t.length;++c){const h=t[c],u=0|h.dataset.layerId,m=a.getLayer(u).getCharacter(0|h.dataset.characterId);if(m.rotation===e)return;const g=m.getPlace(i),p=new r(g.matrix[0],g.matrix[1],g.matrix[2],g.matrix[3],g.matrix[4],g.matrix[5]);p.invert();const $=g.point,f=$.x*p.a+$.y*p.c+p.tx,y=$.x*p.b+$.y*p.d+p.ty,_=[1,0,0,1,-f,-y],b=d.$multiplicationMatrix([g.matrix[0],g.matrix[1],g.matrix[2],g.matrix[3],f,y],_);m.x-=b[4],m.y-=b[5],m.rotation=e;const v=d.$multiplicationMatrix([g.matrix[0],g.matrix[1],g.matrix[2],g.matrix[3],f,y],_);m.x+=v[4],m.y+=v[5],m.dispose();let I=m.scaleX;Math.atan2(g.matrix[1],g.matrix[0])>=Math.PI&&(I*=-1),document.getElementById("transform-rotate").value=`${e}`,document.getElementById("transform-scale-x").value=""+100*I,document.getElementById("transform-scale-y").value=""+100*m.scaleY;const E=m.getBounds();s=Math.min(s,E.xMin),n=Math.max(n,E.xMax),o=Math.min(o,E.yMin),l=Math.max(l,E.yMax),m.relocationTween(i)}document.getElementById("object-x").value=`${s}`,document.getElementById("object-y").value=`${o}`,document.getElementById("object-width").value=`${Math.abs(n-s)}`,document.getElementById("object-height").value=`${Math.abs(l-o)}`}}d.$transformController=new we;class xe extends ie{constructor(){super("ease"),this._$easeTarget=null,this._$viewContext=null,this._$drawContext=null,this._$moveCurvePointer=null,this._$endMoveCurvePointer=null,this._$moveEasingPointer=null,this._$endMoveEasingPointer=null,this._$deleteEasingPointer=null}static get EASE_CANVAS_WIDTH(){return 300}static get EASE_CANVAS_HEIGHT(){return 400}static get EASE_BASE_CANVAS_SIZE(){return 200}static get EASE_MIN_POINTER_X(){return 6}static get EASE_MIN_POINTER_Y(){return-5}static get EASE_MAX_POINTER_X(){return 306}static get EASE_MAX_POINTER_Y(){return 395}static get EASE_SCREEN_X(){return 57}static get EASE_SCREEN_Y(){return 94}static get EASE_MOVE_Y(){return 294}static get EASE_OFFSET_X(){return 50}static get EASE_OFFSET_Y(){return 100}static get EASE_RANGE(){return 100}initialize(){super.initialize();const e=window.devicePixelRatio,t=document.createElement("canvas");t.width=xe.EASE_CANVAS_WIDTH*e,t.height=xe.EASE_CANVAS_HEIGHT*e,this._$drawContext=t.getContext("2d");const r=document.getElementById("ease-custom-canvas");r&&(r.width=xe.EASE_CANVAS_WIDTH*e,r.height=xe.EASE_CANVAS_HEIGHT*e,r.style.transform=`scale(${1/e}, ${1/e})`,r.style.backfaceVisibility="hidden",this._$viewContext=r.getContext("2d"),r.addEventListener("dblclick",(e=>{this.addEasingPointer(e)})));const a=document.getElementById("ease-canvas-view-area");this._$deleteEasingPointer=this.deleteEasingPointer.bind(this),a&&(a.style.display="none",a.addEventListener("mouseleave",(()=>{window.removeEventListener("keydown",this._$deleteEasingPointer)})));const i=["ease-select","ease-custom-file-input"];for(let e=0;e<i.length;++e){const t=document.getElementById(i[e]);t&&t.addEventListener("change",(e=>{e.stopPropagation(),this.executeFunction(e.target.id,e)}))}const s=["ease-custom-data-export","ease-custom-data-load"];for(let e=0;e<s.length;++e){const t=document.getElementById(s[e]);t&&t.addEventListener("click",(e=>{e.stopPropagation(),this.executeFunction(e.target.id,e)}))}}changeEaseCustomDataLoad(e){e.preventDefault();document.getElementById("ease-custom-file-input").click()}changeEaseCustomDataExport(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=e[0],r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);if(!r)return;const a=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(a.startFrame))return;const i=d.$currentWorkSpace().getLibrary(r.libraryId);if(!i)return;const s=document.createElement("a");s.download=`${i.name}_${a.startFrame}.json`,s.href=URL.createObjectURL(new Blob([JSON.stringify(r.getTween(a.startFrame).custom)],{type:"application/json"})),s.click()}changeEaseCustomFileInput(e){e.target.files[0].text().then((e=>{const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const i=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(i.startFrame))return;a.getTween(i.startFrame).custom=JSON.parse(e),this._$easeTarget=null,this.clearEasingPointer(),this.createEasingPointer(),this.drawEasingGraph(),this.relocationPlace(a,i.startFrame),this.clearPointer().relocationPointer()})),e.target.value=""}addEasingPointer(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const i=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(i.startFrame))return;const s=document.getElementById("ease-cubic-pointer-area"),n=s.children,o=a.getTween(i.startFrame),l=["curve","pointer","curve"],c=[-20,0,20],h=xe.EASE_BASE_CANVAS_SIZE/xe.EASE_RANGE,u=(e.layerX-xe.EASE_BASE_CANVAS_SIZE)/h,m=(xe.EASE_BASE_CANVAS_SIZE-(e.layerY-300))/h;for(let e=0;e<l.length;++e){const t=l[e],r=u+c[e],a=m+c[e],i=this.createEasingPointerDiv(r,a,t);s.insertBefore(i,n[n.length-1]),o.custom.splice(-2,0,{type:t,x:r,y:a})}for(let e=0;e<n.length;++e){n[e].dataset.index=`${e+1}`}this._$easeTarget=null,this.drawEasingGraph(),this.relocationPlace(a,i.startFrame),this.clearPointer().relocationPointer()}changeEaseSelect(){const e=d.$timelineLayer.targetFrame;if(!e)return;const t=document.getElementById("ease-select");"custom"===t.value?this.showCustomArea():this.hideCustomArea();const r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),a=0|e.dataset.frame,i=r.getActiveCharacter(a);if(!i.length&&i.length>1)return;const s=i[0],n=s.getRange(a);s.hasTween(n.startFrame)&&(s.getTween(n.startFrame).method=t.value,s.relocationTween(n.startFrame))}relocationPlace(e,t,r="none"){const a=e.getRange(t);if("none"===r&&a.startFrame-1){const t=e.getRange(a.startFrame-1);e.hasTween(t.startFrame)&&this.relocationPlace(e,t.startFrame,"prev")}e.updateTweenPlace(a.startFrame,a.endFrame);const i=d.$currentWorkSpace().getLibrary(e.libraryId);if(!i)return;const s=i.createInstance(e.getPlace(t)),n=e.referencePoint,o=s.width/2,l=s.height/2,c=i.getBounds(),h=s.getBounds(),u=[1,0,0,1,-o-h.x-n.x,-l-h.y-n.y],m=e.getPlace(a.startFrame),g=m.matrix,p=Math.sqrt(g[0]*g[0]+g[1]*g[1]),$=Math.sqrt(g[2]*g[2]+g[3]*g[3]);let f=Math.atan2(g[1],g[0])*d.$Rad2Deg;0>f&&(f+=360);const y=d.$multiplicationMatrix([g[0],g[1],g[2],g[3],0,0],u),_=g[4]-(y[4]+o+h.x+n.x),b=g[5]-(y[5]+l+h.y+n.y),v=document.getElementById(`tween-marker-${e.id}-${a.startFrame}`);if(v){const e=d.$boundsMatrix(c,g),t=Math.abs(Math.ceil(e.xMax-e.xMin)/2*d.$zoomScale),r=Math.abs(Math.ceil(e.yMax-e.yMin)/2*d.$zoomScale);v.style.left=d.$offsetLeft+e.xMin*d.$zoomScale+t-2+"px",v.style.top=d.$offsetTop+e.yMin*d.$zoomScale+r-2+"px"}let I=a.endFrame-1,E=e.getPlace(I);e.hasTween(a.endFrame)&&(I=a.endFrame,E=e.getPlace(a.endFrame));const S=E.matrix,w=Math.sqrt(S[0]*S[0]+S[1]*S[1]),x=Math.sqrt(S[2]*S[2]+S[3]*S[3]);let L=Math.atan2(S[1],S[0])*d.$Rad2Deg;0>L&&(L+=360);const M=d.$multiplicationMatrix([S[0],S[1],S[2],S[3],0,0],u),C=S[4]-(M[4]+o+h.x+n.x),F=S[5]-(M[5]+l+h.y+n.y),k=document.getElementById(`tween-marker-${e.id}-${I}`);if(k){const e=d.$boundsMatrix(c,S),t=Math.abs(Math.ceil(e.xMax-e.xMin)/2*d.$zoomScale),r=Math.abs(Math.ceil(e.yMax-e.yMin)/2*d.$zoomScale);k.style.left=d.$offsetLeft+e.xMin*d.$zoomScale+t-2+"px",k.style.top=d.$offsetTop+e.yMin*d.$zoomScale+r-2+"px"}const A=e.getTween(a.startFrame),T=A.method,B=I-a.startFrame,P=C-_,U=F-b,O=w-p,X=x-$,D=L-f,Y=m.colorTransform,N=E.colorTransform,R=N[0]-Y[0],z=N[1]-Y[1],j=N[2]-Y[2],W=N[3]-Y[3],H=N[4]-Y[4],G=N[5]-Y[5],Z=N[6]-Y[6],V=N[7]-Y[7],{Easing:K}=window.next2d.ui;let q=1;for(let t=a.startFrame+1;t<I;++t){const r=e.getPlace(t),a=q/B;let i=0;if("custom"===T)for(let e=0;e<A.custom.length;e+=3){const t=A.custom[e+1];let r=A.custom[e+3];if(r.off)for(e+=3;r=A.custom[e+3],!r.fixed&&r.off;)e+=3;if(r.x/xe.EASE_RANGE>a){const r=A.custom[e+2];i=this.cubicBezier(t.x/xe.EASE_RANGE,t.y/xe.EASE_RANGE,r.x/xe.EASE_RANGE,r.y/xe.EASE_RANGE)(a);break}}const s=r.matrix,m=O?"custom"===T?O*i+p:K[T](q,p,O,B):p,g=X?"custom"===T?X*i+$:K[T](q,$,X,B):$,y=D?"custom"===T?D*i+f:K[T](q,f,D,B)%360:f;let v=Math.atan2(s[1],s[0]),I=Math.atan2(-s[2],s[3]);const E=y*d.$Deg2Rad;if(I=I+E-v,v=E,s[0]=m*Math.cos(v),s[1]=m*Math.sin(v),s[2]=-g*Math.sin(I),s[3]=g*Math.cos(I),s[4]=P?"custom"===T?i*P+_:K[T](q,_,P,B):_,s[5]=U?"custom"===T?i*U+b:K[T](q,b,U,B):b,A.curve.length){const e=Math.sqrt(Math.pow(P,2)+Math.pow(U,2)),t=Math.sqrt(Math.pow(s[4]-_,2)+Math.pow(s[5]-b,2));if(t&&e){const r=this.getCurvePoint(t/e,_,b,C,F,A.curve);r&&(s[4]=r.x,s[5]=r.y)}}const S=d.$multiplicationMatrix([s[0],s[1],s[2],s[3],0,0],u);s[4]+=S[4]+o+h.x+n.x,s[5]+=S[5]+l+h.y+n.y;const w=r.colorTransform;w[0]=R?d.$clamp("custom"===T?R*i+Y[0]:K[T](q,Y[0],R,B),pe.MIN_MULTIPLIER,pe.MAX_MULTIPLIER):Y[0],w[1]=z?d.$clamp("custom"===T?z*i+Y[1]:K[T](q,Y[1],z,B),pe.MIN_MULTIPLIER,pe.MAX_MULTIPLIER):Y[1],w[2]=j?d.$clamp("custom"===T?j*i+Y[2]:K[T](q,Y[2],j,B),pe.MIN_MULTIPLIER,pe.MAX_MULTIPLIER):Y[2],w[3]=W?d.$clamp("custom"===T?W*i+Y[3]:K[T](q,Y[3],W,B),pe.MIN_MULTIPLIER,pe.MAX_MULTIPLIER):Y[3],w[4]=H?d.$clamp("custom"===T?H*i+Y[4]:K[T](q,Y[4],H,B),pe.MIN_OFFSET,pe.MAX_OFFSET):Y[4],w[5]=G?d.$clamp("custom"===T?G*i+Y[5]:K[T](q,Y[5],G,B),pe.MIN_OFFSET,pe.MAX_OFFSET):Y[5],w[6]=Z?d.$clamp("custom"===T?Z*i+Y[6]:K[T](q,Y[6],Z,B),pe.MIN_OFFSET,pe.MAX_OFFSET):Y[6],w[7]=V?d.$clamp("custom"===T?V*i+Y[7]:K[T](q,Y[7],V,B),pe.MIN_OFFSET,pe.MAX_OFFSET):Y[7];const x=document.getElementById(`tween-marker-${e.id}-${t}`);if(x){const e=d.$boundsMatrix(c,s),t=Math.abs(Math.ceil(e.xMax-e.xMin)/2*d.$zoomScale),r=Math.abs(Math.ceil(e.yMax-e.yMin)/2*d.$zoomScale);x.style.left=d.$offsetLeft+e.xMin*d.$zoomScale+t-2+"px",x.style.top=d.$offsetTop+e.yMin*d.$zoomScale+r-2+"px"}q++}const J=m.filter,Q=E.filter;if(J.length&&Q.length){const t=["blurX","blurY","quality","color","alpha","distance","angle","highlightColor","highlightAlpha","shadowColor","shadowAlpha","strength"],r=J.length;for(let i=0;i<r;++i){const r=J[i],s=Q[i];if(r.name!==s.name)continue;let n=1;for(let o=a.startFrame+1;a.endFrame>o;++o){const a=e.getPlace(o).filter;a[i]||(a[i]=new d.$filterClasses[r.name]);const l=a[i];for(let e=0;e<t.length;++e){const a=t[e];if(a in l){const e=s[a]-r[a];if(!e)continue;l[a]="custom"===T?e*customValue+r[a]:K[T](n,r[a],e,B)}}n++}}}}relocationPointer(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene;for(let a=0;a<e.length;++a){const i=e[a],s=r.getLayer(0|i.dataset.layerId);if(!s)continue;const n=s.getCharacter(0|i.dataset.characterId);if(!n)continue;const o=n.getRange(t);if(!n.hasTween(o.startFrame))continue;let l=o.startFrame;for(;n.startFrame!==l&&l>1;){const e=n.getRange(l-1);if(!n.hasTween(e.startFrame))break;l=e.startFrame}let c=o.endFrame;for(;n.hasTween(c);)c=n.getTween(c).endFrame;const h=d.$currentWorkSpace().getLibrary(n.libraryId);if(!h)continue;const u=h.getBounds(),m=document.getElementById("stage-area");for(let e=l;e<c;++e){const t=document.createElement("div"),r=n.getPlace(e).matrix,a=d.$boundsMatrix(u,r),i=Math.abs(Math.ceil(a.xMax-a.xMin)/2*d.$zoomScale),s=Math.abs(Math.ceil(a.yMax-a.yMin)/2*d.$zoomScale);t.style.left=d.$offsetLeft+a.xMin*d.$zoomScale+i-2+"px",t.style.top=d.$offsetTop+a.yMin*d.$zoomScale+s-2+"px",t.id=`tween-marker-${n.id}-${e}`,t.classList.add("tween-marker"),t.dataset.child="tween",m.appendChild(t)}const g=n.getTween(o.startFrame);for(let e=0;e<g.curve.length;++e){const t=g.curve[e];m.appendChild(this.createTweenCurveElement(t,e,s.id))}}}clearPointer(){const e=document.getElementById("stage-area");if(!e)return this;let t=0;for(;e.children.length>t;){const r=e.children[t];"tween"===r.dataset.child?r.remove():t++}return this}startMoveCurvePointer(e){e.button||(d.$endMenu(),e.stopPropagation(),this._$currentTarget=e.target,this._$pointX=e.pageX,this._$pointY=e.pageY,this._$moveCurvePointer||(this._$moveCurvePointer=this.moveCurvePointer.bind(this)),this._$endMoveCurvePointer||(this._$endMoveCurvePointer=this.endMoveCurvePointer.bind(this)),this.save(),window.addEventListener("mousemove",this._$moveCurvePointer),window.addEventListener("mouseup",this._$endMoveCurvePointer))}deleteCurvePointer(){const e=this._$currentTarget;if(!e)return;const t=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),r=d.$timelineFrame.currentFrame,a=t.getActiveCharacter(r);if(!a.length||a.length>1)return;const i=a[0],s=i.getRange(r);i.getTween(s.startFrame).curve.splice(0|e.dataset.index,1),e.remove(),this.relocationPlace(i,s.startFrame),this.clearPointer().relocationPointer(),this.save(),this._$saved=!1,this._$currentTarget=null}moveCurvePointer(e){e.preventDefault(),window.requestAnimationFrame((()=>{const t=this._$currentTarget;if(!t)return;const r=(e.pageX-this._$pointX)/d.$zoomScale,a=(e.pageY-this._$pointY)/d.$zoomScale,i=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId),s=d.$timelineFrame.currentFrame,n=i.getActiveCharacter(s);if(!n.length&&n.length>1)return;const o=n[0],l=o.getRange(s);if(!o.hasTween(l.startFrame))return;const c=o.getTween(l.startFrame).curve[t.dataset.index];c.x+=r,c.y+=a,this.relocationPlace(o,l.startFrame),this.clearPointer().relocationPointer(),this.reloadScreen(),this._$pointX=e.pageX,this._$pointY=e.pageY}))}endMoveCurvePointer(){window.removeEventListener("mousemove",this._$moveCurvePointer),window.removeEventListener("mouseup",this._$endMoveCurvePointer),this._$saved=!1}switchingCurvePointer(e){const t=e.target,r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId),a=d.$timelineFrame.currentFrame,i=r.getActiveCharacter(a);if(!i.length&&i.length>1)return;const s=i[0],n=s.getRange(a);if(!s.hasTween(n.startFrame))return;const o=s.getTween(n.startFrame).curve[t.dataset.index];o.usePoint=!o.usePoint,o.usePoint?(t.classList.remove("tween-pointer-disabled"),t.classList.add("tween-pointer-active")):(t.classList.add("tween-pointer-disabled"),t.classList.remove("tween-pointer-active")),this.relocationPlace(s,n.startFrame),this.clearPointer().relocationPointer(),this.reloadScreen()}createTweenCurveElement(e,t,r){const a=document.createElement("div");a.classList.add("tween-pointer-marker","tween-pointer-disabled");const i=d.$timelineFrame.currentFrame;a.textContent=`${t+1}`,a.dataset.child="tween",a.dataset.curve="true",a.dataset.layerId=`${r}`,a.dataset.index=`${t}`,a.dataset.detail="{{カーブポインター(ダブルクリックでON/OFF)}}";const s=d.$currentWorkSpace().scene.getLayer(r).getActiveCharacter(i);if(!s.length||s.length>1)return null;const n=s[0],o=d.$currentWorkSpace().getLibrary(n.libraryId).getBounds(),l=Math.abs(Math.ceil(o.xMax-o.xMin)/2*d.$zoomScale),c=Math.abs(Math.ceil(o.yMax-o.yMin)/2*d.$zoomScale);return a.style.left=d.$offsetLeft+e.x*d.$zoomScale+l-7+"px",a.style.top=d.$offsetTop+e.y*d.$zoomScale+c-7+"px",e.usePoint?(a.classList.remove("tween-pointer-disabled"),a.classList.add("tween-pointer-active")):(a.classList.add("tween-pointer-disabled"),a.classList.remove("tween-pointer-active")),a.addEventListener("mousedown",(e=>{this.startMoveCurvePointer(e)})),a.addEventListener("dblclick",(e=>{this.switchingCurvePointer(e)})),a.addEventListener("mouseover",d.$fadeIn),a.addEventListener("mouseout",d.$fadeOut),a}createEasingObject(){return[{type:"pointer",fixed:!0,x:0,y:0},{type:"curve",x:0,y:0},{type:"curve",x:100,y:100},{type:"pointer",fixed:!0,x:100,y:100}]}createEasingPointer(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=e[0],r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);if(!r)return;const a=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(a.startFrame))return;const i=r.getTween(a.startFrame),s=document.getElementById("ease-cubic-pointer-area");for(let e=0;e<i.custom.length;++e){const t=i.custom[e];if(t.fixed)continue;const r=this.createEasingPointerDiv(t.x,t.y,t.type,e);t.off&&r.classList.add("ease-cubic-disable"),s.appendChild(r)}}startMoveEasingPointer(e){this._$easeTarget=e.currentTarget,this._$pointX=e.screenX,this._$pointY=e.screenY,this._$moveEasingPointer||(this._$moveEasingPointer=this.moveEasingPointer.bind(this)),this._$endMoveEasingPointer||(this._$endMoveEasingPointer=this.endMoveEasingPointer.bind(this)),this.save(),window.addEventListener("mousemove",this._$moveEasingPointer),window.addEventListener("mouseup",this._$endMoveEasingPointer),window.removeEventListener("keydown",this._$deleteEasingPointer)}deleteEasingPointer(e){if("Backspace"!==e.key||!this._$easeTarget)return;const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const i=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(i.startFrame))return;const s=a.getTween(i.startFrame),n=0|this._$easeTarget.dataset.index;s.custom.splice(n-1,3);const o=document.getElementById("ease-cubic-pointer-area").children;o[n].remove(),o[n-1].remove(),o[n-2].remove();for(let e=0;e<o.length;++e){o[e].dataset.index=`${e+1}`}this.drawEasingGraph(),this.relocationPlace(a,i.startFrame),this.clearPointer().relocationPointer()}moveEasingPointer(e){window.requestAnimationFrame((()=>{if(!this._$easeTarget)return;const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const i=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(i.startFrame))return;const s=this._$easeTarget;let n=s.offsetLeft+e.screenX-this._$pointX,o=s.offsetTop+e.screenY-this._$pointY;this._$pointX=e.screenX,this._$pointY=e.screenY,xe.EASE_MIN_POINTER_Y>o&&(o=xe.EASE_MIN_POINTER_Y),xe.EASE_MAX_POINTER_Y<o&&(o=xe.EASE_MAX_POINTER_Y),xe.EASE_MIN_POINTER_X>n&&(n=xe.EASE_MIN_POINTER_X),xe.EASE_MAX_POINTER_X<n&&(n=xe.EASE_MAX_POINTER_X),s.style.left=`${n}px`,s.style.top=`${o}px`;const l=a.getTween(i.startFrame).custom[s.dataset.index],c=xe.EASE_BASE_CANVAS_SIZE/xe.EASE_RANGE;l.x=(n-xe.EASE_SCREEN_X)/c,l.y=(xe.EASE_MOVE_Y-o)/c,document.getElementById("ease-cubic-current-text").textContent=`(${l.x/xe.EASE_RANGE*100|0})`,document.getElementById("ease-cubic-current-tween").textContent=`(${l.y/xe.EASE_RANGE*100|0})`,this.drawEasingGraph(),this.relocationPlace(a,i.startFrame),this.clearPointer().relocationPointer()}))}endMoveEasingPointer(){window.removeEventListener("mousemove",this._$moveEasingPointer),window.removeEventListener("mouseup",this._$endMoveEasingPointer),window.addEventListener("keydown",this._$deleteEasingPointer),this._$saved=!1}disabledEasingPointer(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const r=t[0],a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId);if(!a)return;const i=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(i.startFrame))return;const s=a.getTween(i.startFrame),n=0|e.target.dataset.index,o=s.custom[n];o.off=!o.off,s.custom[n-1].off=o.off,s.custom[n+1].off=o.off;const l=document.getElementById("ease-cubic-pointer-area").children;o.off?(l[n-2].classList.add("ease-cubic-disable"),l[n-1].classList.add("ease-cubic-disable"),l[n].classList.add("ease-cubic-disable")):(l[n-2].classList.remove("ease-cubic-disable"),l[n-1].classList.remove("ease-cubic-disable"),l[n].classList.remove("ease-cubic-disable")),this._$easeTarget=null,this.drawEasingGraph(),this.relocationPlace(a,i.startFrame),this.clearPointer().relocationPointer()}createEasingPointerDiv(e=0,t=0,r="pointer",a=0){const i=document.createElement("div");i.addEventListener("mousedown",(e=>{this.startMoveEasingPointer(e)})),"pointer"===r&&i.addEventListener("dblclick",(e=>{this.disabledEasingPointer(e)})),i.classList.add(`ease-cubic-${r}`),i.dataset.index=`${a}`,i.dataset.type=`${r}`;const s=xe.EASE_BASE_CANVAS_SIZE/xe.EASE_RANGE;return i.style.left=`${xe.EASE_SCREEN_X+e*s}px`,i.style.top=`${xe.EASE_SCREEN_Y+(xe.EASE_RANGE-t)*s}px`,i}drawEasingGraph(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=e[0],r=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);if(!r)return;const a=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(a.startFrame))return;const i=r.getTween(a.startFrame),s=window.devicePixelRatio,n=xe.EASE_OFFSET_X*s,o=xe.EASE_OFFSET_Y*s,l=this._$drawContext;l.fillStyle="rgb(240, 240, 240)";const c=xe.EASE_BASE_CANVAS_SIZE*s;l.setTransform(1,0,0,1,0,0),l.clearRect(0,0,l.canvas.width,l.canvas.height),l.fillRect(n,o,c,c),l.lineCap="round",l.translate(n,o),l.beginPath(),l.strokeStyle="rgba(200, 200, 200, 0.6)",l.lineWidth=10,l.moveTo(0,0),l.lineTo(c,c),l.stroke();const h=xe.EASE_BASE_CANVAS_SIZE/xe.EASE_RANGE*s;for(let e=0;e<i.custom.length;e+=3){const t=i.custom[e],r=i.custom[e+1];let a=i.custom[e+2],s=i.custom[e+3];if(s.off)for(e+=3;a=i.custom[e+2],s=i.custom[e+3],!s.fixed&&s.off;)e+=3;if(l.beginPath(),l.strokeStyle="rgb(160, 160, 160)",l.lineWidth=3,l.moveTo(t.x*h,t.y*h),l.lineTo(r.x*h,r.y*h),l.stroke(),l.beginPath(),l.strokeStyle="rgb(160, 160, 160)",l.lineWidth=3,l.moveTo(s.x*h,s.y*h),l.lineTo(a.x*h,a.y*h),l.stroke(),l.beginPath(),l.strokeStyle="rgb(80, 80, 80)",l.lineWidth=10,l.moveTo(t.x*h,t.y*h),l.bezierCurveTo(r.x*h,r.y*h,a.x*h,a.y*h,s.x*h,s.y*h),l.stroke(),s.fixed)break}const u=this._$viewContext;u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,l.canvas.width,l.canvas.height),u.scale(1,-1),u.translate(0,-l.canvas.height),u.drawImage(l.canvas,0,0)}getCurvePoint(e,t,r,a,i,s){const n=[];for(let e=0;e<s.length;++e){const t=s[e];t.usePoint&&n.push(t)}if(!n.length)return null;const o=1-e,l=n.length+1;for(let s=0;s<l;++s)t*=o,r*=o,a*=e,i*=e;let c=t+a,d=r+i;for(let t=0;t<n.length;++t){const r=n[t],a=t+1;let i=r.x*l,s=r.y*l;for(let t=0;t<a;++t)i*=e,s*=e;for(let e=0;e<l-a;++e)i*=o,s*=o;c+=i,d+=s}return{x:c,y:d}}cubicBezier(e,t,r,a){const i=3*e,s=3*(r-e)-i,n=1-i-s,o=3*t,l=3*(a-t)-o,c=1-o-l,d=e=>i+e*(2*s+3*n*e);return e=>{const t=(e=>{if(e<=0)return 0;if(e>=1)return 1;let t=0,r=0,a=e;for(;Math.abs(a-r)>1e-4&&(r=a,a-=((o=a)*(i+o*(s+o*n))-e)/d(a),t++,!(t>1e3)););var o;return a})(e);return t*(o+t*(l+t*c))}}clearEasingPointer(){const e=document.getElementById("ease-cubic-pointer-area");if(e)for(;e.children.length;)e.children[0].remove()}showCustomArea(){this.clearEasingPointer(),this._$easeTarget=null,document.getElementById("ease-canvas-view-area").style.display="",this.createEasingPointer(),this.drawEasingGraph()}hideCustomArea(){const e=document.getElementById("ease-canvas-view-area");e&&(e.style.display="none")}addCurvePinter(){const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),a=r.getActiveCharacter(t);if(!a.length||a.length>1)return;const i=a[0],s=i.getRange(t);if(!i.hasTween(s.startFrame))return;const n=i.getTween(s.startFrame),o=n.curve.length,l=i.getBounds(),c={usePoint:!0,x:l.xMin,y:l.yMin};n.curve.push(c);const h=this.createTweenCurveElement(c,o,r.id);h&&document.getElementById("stage-area").appendChild(h),this.relocationPlace(i,s.startFrame),this.clearPointer().relocationPointer()}}d.$tweenController=new xe;class Le extends ie{constructor(){super("video")}static get MIN_VOLUME(){return 0}static get MAX_VOLUME(){return 100}initialize(){super.initialize();const e=["video-loop-select","video-auto-select"];for(let t=0;t<e.length;++t)this.setChangeEvent(document.getElementById(e[t]));this.setInputEvent(document.getElementById("video-volume"))}changeVideoLoopSelect(e){this.updateVideoProperty("loop",1==(0|e))}changeVideoAutoSelect(e){this.updateVideoProperty("autoPlay",1==(0|e))}changeVideoVolume(e){return e=d.$clamp(0|e,Le.MIN_VOLUME,Le.MAX_VOLUME),this.updateVideoProperty("volume",e),e}updateVideoProperty(e,t){const r=d.$tools.getDefaultTool("arrow").activeElements;if(!r.length)return;const a=r[0];d.$currentWorkSpace().getLibrary(0|a.dataset.libraryId)[e]=t}}d.$videoController=new Le;class Me{constructor(){this._$begin=!1}beginDraw(){this._$begin=!0}}class Ce{constructor(){this._$timeline=new Be,this._$library=new Te}getTimeline(){return this._$timeline}get library(){return this._$library}}class Fe{constructor(e,t){this._$character=e,this._$parent=t}get x(){return this._$character.x}set x(e){this._$character.x=e;const t=d.$currentWorkSpace().getLibrary(this._$character.libraryId);let r=d.$timelineFrame.currentFrame;const a=this._$character.getPlace(r);let i=Object.keys(a);const s={};for(let e=0;e<i.length;++e){const t=i[e];s[t]=a[t]}s.loop=d.$getDefaultLoopConfig(),s.startFrame=this._$character.startFrame,s.endFrame=this._$character.endFrame;const n=d.$boundsMatrix(t.getBounds(s),s.matrix),o=d.$offsetLeft+n.xMin*d.$zoomScale;this._$character._$screenX=o,document.getElementById(`character-${this._$character.id}`).style.left=`${o}px`}get y(){return this._$character.y}set y(e){this._$character.y=e;const t=d.$currentWorkSpace().getLibrary(this._$character.libraryId);let r=d.$timelineFrame.currentFrame;const a=this._$character.getPlace(r);let i=Object.keys(a);const s={};for(let e=0;e<i.length;++e){const t=i[e];s[t]=a[t]}s.loop=d.$getDefaultLoopConfig(),s.startFrame=this._$character.startFrame,s.endFrame=this._$character.endFrame;const n=d.$boundsMatrix(t.getBounds(s),s.matrix),o=d.$offsetTop+n.yMin*d.$zoomScale;this._$character._$screenY=o,document.getElementById(`character-${this._$character.id}`).style.top=`${o}px`}get libraryItem(){return new Te(d.$currentWorkSpace().getLibrary(this._$character.libraryId))}get loop(){if(d.$currentWorkSpace().getLibrary(this._$character.libraryId).type!==b.MOVIE_CLIP)return"";const e=this._$character.getPlace(this._$character.startFrame);if(!e.loop)return"loop";switch(e.loop.type){case 1:case 3:return"play once";case 2:return"single frame";default:return"loop"}}set loop(e){if(d.$currentWorkSpace().getLibrary(this._$character.libraryId).type!==b.MOVIE_CLIP)return;const t=this._$character.getPlace(this._$character.startFrame);switch(e){case"loop":t.loop.type=_e.REPEAT;break;case"play once":t.loop.type=_e.NO_REPEAT;break;case"single frame":t.loop.type=_e.FIXED_ONE;break;default:t.loop.type=_e.DEFAULT}}get symbolType(){return d.$currentWorkSpace().getLibrary(this._$character.libraryId).type===b.MOVIE_CLIP?"movie clip":""}set symbolType(e){switch(e){case"button":case"movie clip":case"graphic":{const e=d.$currentWorkSpace();if(e.getLibrary(this._$character.libraryId).type===b.MOVIE_CLIP)return;const t=e.nextLibraryId,r=e.addLibrary(d.$controller.createContainer(b.MOVIE_CLIP,`MovieClip_${t}`,t)),a=this._$character.clone(),i=a._$endFrame-a._$startFrame+1,s=a._$startFrame-1,n=new Map;for(let[e,t]of a._$places)t.frame=e-s,n.set(t.frame,t);a._$places=n,a._$startFrame=1,a._$endFrame=i;const o=new v,l=this._$parent._$layer._$frame;for(let[e,t]of l._$classes)1>e-s||o._$frame._$classes.set(e-s,t);r.setLayer(r._$layerId++,o),o.addCharacter(a),this._$character._$currentFrame=0,this._$character._$currentPlace=null,this._$character.dispose(),this._$character._$libraryId=t;for(let e of this._$character._$places.values())e.loop=d.$getDefaultLoopConfig();e.scene.changeFrame(d.$timelineFrame.currentFrame)}}}}class ke{constructor(e,t){this._$frame=e,this._$parent=t}get elements(){const e=this._$parent._$layer.getActiveCharacter(this._$frame),t=[];for(let r=0;r<e.length;++r)t.push(new Fe(e[r],this._$parent));return t}}class Ae{constructor(e){this._$layer=e}get frames(){const e=[void 0],t=this._$layer.totalFrame;for(let r=1;t>=r;++r)e.push(new ke(r,this));return e}get locked(){return this._$layer.lock}set locked(e){this._$layer.lock=!!e;const t=document.getElementById(`layer-lock-icon-${this._$layer.id}`);t.classList.remove("icon-disable","icon-active"),t.classList.add(this._$layer.lock?"icon-active":"icon-disable")}get name(){return this._$layer.name}}class Te{constructor(e=null){this._$instance=e}get name(){return this._$instance?this._$instance.path:""}getItem(e){e=`${e}`;const t=d.$currentWorkSpace();for(let r of t._$libraries.values())if(r.path===e)return new Te(r);return null}toImage(e=1){if(!this._$instance)return new Image;const t=this._$instance.getBounds([1,0,0,1,0,0],null,null,e),r=Math.abs(t.xMax-t.xMin),a=Math.abs(t.yMax-t.yMin),i=d.$currentFrame;d.$currentFrame=e;const s=this._$instance.draw(d.$getCanvas(),Math.ceil(r),Math.ceil(a),{frame:e,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],loop:d.$getDefaultLoopConfig()},null,e);d.$currentFrame=i;const n=new Image;return n.width=Math.ceil(r),n.height=Math.ceil(a),n.src=s.canvas.toDataURL(),d.$poolCanvas(s),n}addItemToDocument(e,t){if(!e||!t)return!1;t=`${t}`;const r=d.$currentWorkSpace();for(let a of r._$libraries.values())if(a.path===t)return d.$libraryController.activeInstance=document.getElementById(`library-child-id-${a.id}`),d.$dragElement={dataset:{libraryId:a.id}},d.$screen.drop({offsetX:e.x+d.$offsetLeft,offsetY:e.y+d.$offsetTop}),d.$dragElement=null,!0;return!1}}class Be{get currentFrame(){return d.$timelineFrame.currentFrame}get currentLayer(){const e=d.$timelineLayer.targetLayer;if(!e)return 0;const t=0|e.dataset.layerId,r=d.$currentWorkSpace().scene;return 0|Array.from(r._$layers.keys()).indexOf(t)}set currentLayer(e){const t=d.$currentWorkSpace().scene,r=Array.from(t._$layers.keys())[e];d.$timelineLayer.targetLayer=document.getElementById(`layer-id-${r}`)}get layers(){const e=Array.from(document.getElementById("timeline-content").children),t=d.$currentWorkSpace().scene,r=[];for(const a of t._$layers.values()){r[e.indexOf(document.getElementById(`layer-id-${a.id}`))]=new Ae(a)}return r}getSelectedLayers(){const e=[],t=Array.from(document.getElementById("timeline-content").children),r=d.$timelineLayer.targetLayers;for(const a of r.values()){const r=0|a.dataset.layerId,i=t.indexOf(document.getElementById(`layer-id-${r}`));e.push(i)}return e.length>1&&e.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}})),e}addNewLayer(e="",t="normal",r=!0){const a=d.$currentWorkSpace().scene,i=new v;switch(e&&(i.name=e),t){case"mask":i.mode=I.MASK;break;case"masked":i.mode=I.MASK_IN}const s=this.currentLayer;let n=0;const o=new Map;for(const e of a._$layers.values())r&&n===s&&o.set(n++,i),o.set(n++,e),r||n!==s+1||o.set(n++,i);return a._$layers=o,a.initialize(),d.$timelineLayer.targetLayer=document.getElementById(`layer-id-${i.id}`),d.$timelineLayer.clearActiveFrames(),d.$timelineLayer.addTargetFrame(i,this.currentFrame),new Ae(i)}setSelectedFrames(e,t){const r=d.$timelineLayer.targetLayer;if(!r)return;d.$timelineLayer.clearActiveFrames(),t=Math.max(e,t);const a=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId);for(let r=e;t>=r;++r)d.$timelineLayer.addTargetFrame(a,r);d.$timelineFrame.currentFrame=e}clearKeyframes(e=-1,t=-1){const r=d.$timelineLayer.targetLayer;if(!r)return;const a=0|r.dataset.layerId;if(d.$timelineLayer.targetFrames.has(a)){const r=d.$timelineLayer.targetFrames.get(a).slice();r.length>1&&r.sort(((e,t)=>{const r=0|e,a=0|t;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}})),-1===e&&(e=r[0]),-1===t&&(t=r[r.length-1])}-1===t&&(t=e),-1!==e&&-1!==t&&this.setSelectedFrames(e,t)}convertToBlankKeyframes(e=-1,t=-1){const r=d.$timelineLayer.targetLayer;if(!r)return;const a=0|r.dataset.layerId;if(d.$timelineLayer.targetFrames.has(a)){const r=d.$timelineLayer.targetFrames.get(a).slice();r.length>1&&r.sort(((e,t)=>{const r=0|e,a=0|t;switch(!0){case r>a:return 1;case r<a:return-1;default:return 0}})),-1===e&&(e=r[0]),-1===t&&(t=r[r.length-1])}-1===t&&(t=e),-1!==e&&-1!==t&&(this.setSelectedFrames(e,t),d.$timelineTool.executeTimelineEmptyAdd())}}class Pe extends j{constructor(e){super(e)}}e.nt=e.fl=new class{constructor(){this._$dom=new Ce,this._$panel=new Map,this._$drawingLayer=new Me}get drawingLayer(){return this._$drawingLayer}addMenu(e,t=null){const r=document.getElementById("plugin-menu"),a=document.createElement("div");a.classList.add("screen-menu-bottom"),a.textContent=e,t&&a.addEventListener("mousedown",t),r.appendChild(a)}createPanel(e,t,r=200,a=200){this._$panel.set(e,{width:r,height:a,element:t})}showPanel(e){if(!this._$panel.has(e))return;document.getElementById("plugin-title").textContent=e;const t=this._$panel.get(e);document.getElementById("plugin-modal-element").appendChild(t.element),document.documentElement.style.setProperty("--plugin-modal-width",`${t.width}px`),document.documentElement.style.setProperty("--plugin-modal-height",`${t.height}px`);const r=document.getElementById("plugin-modal");r.style.top="100px",r.style.left="100px",r.setAttribute("class","fadeIn"),d.$endMenu("plugin-modal")}hidePanel(){d.$endMenu();const e=document.getElementById("plugin-modal-element").children;for(;e.length;)e[0].remove()}getDocumentDOM(){return this._$dom}addTool(e){return new Pe(e)}setShortcut(e,t,r){switch(e){case"global":d.$setShortcut(t,r);break;case"screen":d.$screenKeyboardCommand.add(t,r);break;case"timeline":d.Util.$timelineKeyboardCommand.add(t,r);break;case"library":d.Util.$libraryKeyboardCommand.add(t,r)}}deleteShortcut(e,t){switch(e){case"global":d.$deleteShortcut(t);break;case"screen":d.$screenKeyboardCommand.delete(t);break;case"timeline":d.Util.$timelineKeyboardCommand.delete(t);break;case"library":d.Util.$libraryKeyboardCommand.delete(t)}}}}(this);