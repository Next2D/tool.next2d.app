/*!
 * licenses: MIT Licenses.
 * version: 0.47.0
 * author: Toshiyuki Ienaga <ienaga@tvon.jp>
 * copyright: (c) 2021-2022 Toshiyuki Ienaga.
 */
"nt"in window||function(e){"use strict";class t{constructor(){this.mapping=this.createMapping(),requestAnimationFrame(this.initialize.bind(this))}initialize(){const e=document.getElementsByClassName("language");for(let t=0;t<e.length;++t){const a=e[t],r=a.dataset.text;if(!this.mapping.has(r))continue;let s=this.mapping.get(r),i=a.dataset.shortcutKey;if(i){const e=d.$shortcutSetting.viewMapping.get(a.dataset.area);s+=` (${e.has(i)?e.get(i).text:a.dataset.shortcutText})`}a.innerText=s}}replace(e){return this.mapping.has(e)?this.mapping.get(e):e}}class a extends t{createMapping(){return new Map([["{{左上}}","左上"],["{{中央上}}","中-上"],["{{右上}}","右上"],["{{中央左}}","中间偏左"],["{{中央}}","中央"],["{{中央右}}","中右翼"],["{{左下}}","左下角"],["{{中央下}}","中下级"],["{{右下}}","右下"],["{{中心点のX座標}}","中心点的X坐标"],["{{中心点のY座標}}","中心点的Y坐标"],["{{MovieClipに変換}}","转换为MovieClip"],["{{変換}}","蜕变"],["{{ループ回数}}","循环次数"],["{{カーブポインターの削除}}","删除曲线指针"],["{{ステージ基準}}","阶段性标准"],["{{閉じる}}","贴近"],["{{保存}}","储存"],["{{リセット}}","重置"],["{{スクリーン}}","筛选"],["{{ショートカット設定}}","捷径设置"],["{{レイヤーカラー}}","分层色"],["{{Next2Dを支援する}}","支持Next2D"],["{{サポート}}","支持"],["{{未使用のアイテムを削除}}","删除未使用的项目"],["{{レイヤーをペースト}}","粘贴层"],["{{レイヤーをコピー}}","复制层"],["{{フレームをペースト}}","粘贴框架"],["{{フレームをコピー}}","复制框架"],["{{キーフレームを削除}}","删除关键帧"],["{{キーフレームに空のキーフレームを追加できません}}","不能向关键帧添加空关键帧"],["{{ズームツール}}","缩放工具"],["{{タイムライン幅の拡大・縮小}}","时间线宽度 扩大/缩小"],["{{ガイドレイヤー}}","指导层"],["{{音量設定}}","音量设置"],["{{サウンドを削除}}","移除声音"],["{{カスタムループ}}","定制的循环"],["{{読込のみ}}","只读"],["{{書込を許可}}","职位许可"],["{{単一行}}","单线"],["{{複数行}}","多线"],["{{自動で折り返し}}","自动绕行"],["{{左寄せ}}","左对齐"],["{{中央揃え}}","定心"],["{{右寄せ}}","右对齐"],["{{放射状グラデーション}}","径向梯度"],["{{線形グラデーション}}","线性梯度"],["{{画像}}","图片"],["{{画像選択}}","图像选择"],["{{種別}}","分类"],["{{Shapeの色設定}}","形状颜色设置"],["{{変形}}","变形"],["{{カラー効果}}","颜色转换"],["{{フィルター}}","滤镜"],["{{Shapeを複製}}","复制的形状"],["{{読み込み}}","读在"],["{{新規フォルダー}}","新文件夹"],["{{新規MovieClip}}","新的电影剪辑"],["{{枠に合わせてテキストをリサイズ}}","调整文字大小以适应框架"],["{{テキストに合わせて枠をリサイズ}}","调整框架的大小以适应文本"],["{{リサイズしない}}","不调整大小"],["{{フォント}}","字体"],["{{テキスト}}","文本"],["{{ループ}}","循环"],["{{音量}}","音量"],["{{ビデオ}}","视频"],["{{イージング}}","缓和"],["{{サウンド}}","声音"],["{{シンボル}}","符号"],["{{名前}}","命名"],["{{オブジェクト}}","对象"],["{{ステージ設定}}","舞台设置"],["{{プレビュー}}","预览"],["{{削除}}","删除"],["{{ペースト}}","粘贴"],["{{コピー}}","拷贝"],["{{プラグインメニュー}}","插件菜单"],["{{トゥイーン}}","嫩枝"],["{{カーブポインターの追加}}","额外的曲线指示器"],["{{パスの結合}}","路径合并"],["{{シェイプ}}","形状"],["{{キーフレームに配分}}","分配给关键帧"],["{{レイヤーに配分}}","分配到各层"],["{{タイムライン}}","时间线"],["{{整列}}","对齐"],["{{最背面}}","最 后"],["{{ひとつ背面へ}}","一个背影"],["{{ひとつ前面へ}}","一个正面"],["{{最前面}}","最前线"],["{{重ね順}}","继承顺序"],["{{プラグイン}}","插件"],["{{ライブラリ}}","图书馆"],["{{プロパティ}}","财产"],["{{マスクレイヤー}}","掩膜层"],["{{通常レイヤー}}","普通层"],["{{モーショントゥイーンの削除}}","删去了运动推理的内容"],["{{モーショントゥイーンの追加}}","额外的议案推理"],["{{モーダル表示}}","模态指示"],["{{言語}}","语言"],["{{フォーマット}}","格式"],["{{含める}}","包括"],["{{含めない}}","不包括"],["{{使い方、リファレンス}}","用法，参考"],["{{非表示レイヤー}}","隐藏层"],["{{設定}}","设置"],["{{デフォルトのループを利用する}}","使用默认的循环"],["{{フレームピッカー}}","选框机"],["{{ステージ左揃え}}","舞台左侧对齐"],["{{ステージ中央揃え(水平方向)}}","对准舞台中心（水平）"],["{{ステージ右揃え}}","舞台右侧的对齐"],["{{ステージ上揃え}}","对齐舞台"],["{{ステージ中央揃え(垂直方向)}}","对准舞台中心（垂直）"],["{{ステージ下揃え}}","对准舞台底部"],["{{左揃え}}","左对齐"],["{{中央揃え(水平方向)}}","居中（水平方向）"],["{{右揃え}}","右对齐"],["{{上揃え}}","上对齐"],["{{中央揃え(垂直方向)}}","居中（垂直方向）"],["{{下揃え}}","下对齐"],["{{開始フレーム}}","起始框架"],["{{終了フレーム}}","终端框架"],["{{ループで再生}}","循环播放"],["{{1回再生}}","1次播放"],["{{指定したフレームで固定}}","固定在指定的框架内"],["{{1回逆再生}}","1 反向播放"],["{{逆ループで再生}}","反向循环播放"],["{{画面の拡大・縮小}}","画面的放大和缩小"],["{{カスタムイージングデータを保存}}","保存自定义缓和数据"],["{{カスタムイージングデータの読込}}","读取自定义宽松数据"],["{{プレビューのON/OFF}}","预览开/关"],["{{フォント枠サイズ}}","字体帧大小"],["{{フォント枠カラー}}","字体帧颜色"],["{{オニオンスキン}}","洋葱皮"],["{{バケツツール}}","整体填充工具"],["{{ペンツール}}","钢笔工具"],["{{ダブルクリックでカーブポイントが追加されます}}","双击来添加一个曲线点"],["{{選択ツール}}","选择工具"],["{{Shape変形ツール}}","形状变换工具"],["{{テキストツール}}","文本工具"],["{{矩形ツール}}","矩形工具"],["{{楕円ツール}}","椭圆工具"],["{{角丸矩形ツール}}","圆角矩形工具"],["{{塗りのカラー}}","填充颜色"],["{{線のカラー}}","画笔颜色"],["{{線の太さ}}","画笔宽度"],["{{プロジェクトデータの読込}}","载入工程文件"],["{{プロジェクトデータを保存}}","保存工程文件"],["{{書き出し}}","导出"],["{{Discordへ移動}}","前往discord"],["{{バグ報告}}","错误报告"],["{{設定}}","设置"],["{{タブを追加}}","添加标签页"],["{{タブの一覧を表示・移動}}","标签页列表"],["{{スクリプトを追加}}","添加一个脚本"],["{{キーフレームを追加}}","添加一个关键帧"],["{{空のキーフレームを追加}}","添加一个空的关键帧"],["{{フレームを追加}}","添加帧"],["{{フレームを削除}}","删除帧"],["{{再生}}","播放"],["{{停止}}","停止"],["{{ループ設定}}","循环设置"],["{{レイヤーを追加}}","添加图层"],["{{レイヤーを削除}}","删除图层"],["{{全てのレイヤーをハイライト}}","高亮所有图层"],["{{全てのレイヤーを非表示}}","隐藏所有图层"],["{{全てのレイヤーをロック}}","锁定所有图层"],["{{比率を固定}}","锁定比例"],["{{ステージの幅}}","画面宽度"],["{{背景色}}","背景颜色"],["{{ステージの高さ}}","画面高度"],["{{フレームレート}}","帧速率"],["{{シンボル名}}","符号名称"],["{{イージング設定}}","过渡设置"],["{{ビデオの音量設定}}","视频音量设置"],["{{自動再生}}","自动播放"],["{{テキストエリアのボーダー設定}}","文本框边框设置"],["{{テキスト入力設定}}","文本输入设置"],["{{フォント選択}}","字体选择"],["{{自動サイズ調整}}","自动调整尺寸"],["{{フォントスタイルタイプ}}","字体风格类型"],["{{行揃え}}","对齐"],["{{改行設定}}","换行设置"],["{{スクロール設定}}","滚动设置"],["{{フォントサイズ}}","字体大小"],["{{フォントカラー}}","字体颜色"],["{{行間}}","行间距"],["{{文字幅}}","字符宽度"],["{{左マージン}}","左边距"],["{{右マージン}}","右边距"],["{{カラー種別の選択}}","选择颜色类型"],["{{背景画像の選択}}","选择背景图片"],["{{カラーポインターを追加}}","添加颜色指针"],["{{カラー値}}","颜色"],["{{アルファ(0%-100%)}}","透明度（0%-100%）"],["{{アルファ値}}","透明度"],["{{選択対象の幅}}","选择对象的宽度"],["{{選択対象のX座標}}","选择对象的X轴坐标"],["{{選択対象の高さ}}","选择对象的高度"],["{{選択対象のY座標}}","选择对象的Y轴坐标"],["{{選択対象の幅の伸縮}}","选定对象的X轴缩放"],["{{選択対象を回転}}","旋转物体"],["{{選択対象の高さの伸縮}}","所选对象的比例Y"],["{{アルファオフセット(-255〜255)}}","透明度偏移（-255~255）"],["{{赤(0%-100%)}}","红色（0%-100%）"],["{{赤オフセット(-255〜255)}}","红色偏移（-255~255）"],["{{緑(0%-100%)}}","绿色（0%-100%）"],["{{緑オフセット(-255〜255)}}","绿色偏移（-255~255）"],["{{青(0%-100%)}}","蓝色（0%-100%）"],["{{青オフセット(-255〜255)}}","蓝色偏移（-255~255）"],["{{ブレンドモード}}","混合模式"],["{{フィルターを選択}}","选择滤镜"],["{{フィルターを追加}}","添加滤镜"],["{{サウンドを追加}}","添加声音"],["{{フィルターを表示・非表示する}}","显示和隐藏滤镜"],["{{フィルターを削除}}","删除滤镜"],["{{水平方向にぼかす}}","横向模糊"],["{{垂直方向にぼかす}}","纵向模糊"],["{{フィルター強度}}","滤镜强度"],["{{フィルター角度}}","滤镜角度"],["{{シャドウのアルファ}}","阴影透明度"],["{{シャドウのカラー}}","阴影颜色"],["{{フィルター距離}}","滤镜距离"],["{{ハイライトのカラー}}","高光色"],["{{ハイライトのアルファ}}","高光透明度"],["{{グラデーションカラー}}","渐变色"],["{{グラデーションのアルファ}}","渐变透明度"],["{{タブの移動・名前を変更}}","移动/重命名标签"],["{{プロジェクトを閉じる}}","关闭工程"],["{{上下に移動}}","上下移动"],["{{レイヤー変更(ダブルクリック)}}","改变图层（双击）"],["{{レイヤーをハイライト}}","高亮图层"],["{{レイヤーを非表示}}","隐藏图层"],["{{レイヤーをロック}}","锁定图层"],["{{カーブポインター(ダブルクリックでON/OFF)}}","曲线指针（双击打开/关闭）"],["{{インスタンス名}}","实例名称"],["{{ライブラリ内の検索}}","在库中搜索"],["{{フレームラベル}}","帧标签"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","如果工程没有保存，将无法恢复此标签页数据。 你想删除这个标签页吗？"]])}}class r extends t{createMapping(){return new Map([["{{左上}}","Top Left"],["{{中央上}}","Top Center"],["{{右上}}","Top Right"],["{{中央左}}","Center Left"],["{{中央}}","Center"],["{{中央右}}","Center Right"],["{{左下}}","Bottom Left"],["{{中央下}}","Bottom Center"],["{{右下}}","Bottom Right"],["{{中心点のX座標}}","X coordinate of the center point"],["{{中心点のY座標}}","Y coordinate of the center point"],["{{MovieClipに変換}}","Convert to MovieClip"],["{{変換}}","Conversion"],["{{ループ回数}}","Loop Count"],["{{カーブポインターの削除}}","Delete curve pointer"],["{{ステージ基準}}","Stage Criteria"],["{{閉じる}}","Close"],["{{保存}}","Save"],["{{リセット}}","Reset"],["{{スクリーン}}","Screen"],["{{ショートカット設定}}","Shortcut Settings"],["{{レイヤーカラー}}","Layer Color"],["{{Next2Dを支援する}}","Support Next2D"],["{{サポート}}","Support"],["{{未使用のアイテムを削除}}","Delete unused items"],["{{レイヤーをペースト}}","Paste Layer"],["{{レイヤーをコピー}}","Copy Layer"],["{{フレームをペースト}}","Paste Frame"],["{{フレームをコピー}}","Copy Frame"],["{{キーフレームを削除}}","Delete keyframe"],["{{キーフレームに空のキーフレームを追加できません}}","Cannot add an empty keyframe to a keyframe"],["{{ズームツール}}","Zoom Tool"],["{{タイムライン幅の拡大・縮小}}","Timeline Width Expand/Reduce"],["{{ガイドレイヤー}}","Guide Layer"],["{{音量設定}}","Volume Setting"],["{{サウンドを削除}}","Remove Sound"],["{{カスタムループ}}","Custom Loop"],["{{読込のみ}}","ReadOnly"],["{{書込を許可}}","Writeable"],["{{単一行}}","Single line"],["{{複数行}}","Multiline"],["{{自動で折り返し}}","Auto Wrap"],["{{左寄せ}}","Left"],["{{中央揃え}}","Center"],["{{右寄せ}}","Right"],["{{放射状グラデーション}}","Radial Gradient"],["{{線形グラデーション}}","Linear Gradient"],["{{画像}}","Image"],["{{画像選択}}","Image Selection"],["{{種別}}","Type"],["{{Shapeの色設定}}","Shape color settings"],["{{変形}}","Transform"],["{{カラー効果}}","Color Transform"],["{{フィルター}}","Filter"],["{{Shapeを複製}}","Duplicate Shape"],["{{読み込み}}","Read in"],["{{新規フォルダー}}","Added Folder"],["{{新規MovieClip}}","Added MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Resize text to fit the frame"],["{{テキストに合わせて枠をリサイズ}}","Resize the frame to fit the text"],["{{リサイズしない}}","No Resize"],["{{フォント}}","Font"],["{{テキスト}}","Text"],["{{ループ}}","Loop"],["{{音量}}","Volume"],["{{ビデオ}}","Video"],["{{イージング}}","Easing"],["{{サウンド}}","Sound"],["{{シンボル}}","Symbol"],["{{名前}}","Name"],["{{オブジェクト}}","Object"],["{{ステージ設定}}","Stage Setting"],["{{プレビュー}}","Preview"],["{{削除}}","Delete"],["{{ペースト}}","Paste"],["{{コピー}}","Copy"],["{{プラグインメニュー}}","Plugin Menu"],["{{トゥイーン}}","Tween"],["{{カーブポインターの追加}}","Added Curve Pointer"],["{{パスの結合}}","Integrating paths"],["{{シェイプ}}","Shape"],["{{キーフレームに配分}}","Distribute to Keyframes"],["{{レイヤーに配分}}","Distribute to Layers"],["{{タイムライン}}","Timeline"],["{{整列}}","Align"],["{{最背面}}","Send to Back"],["{{ひとつ背面へ}}","Send to Backward"],["{{ひとつ前面へ}}","Bring to Forward"],["{{最前面}}","Bring to Front"],["{{重ね順}}","Arrange"],["{{プラグイン}}","Plugin"],["{{ライブラリ}}","Library"],["{{プロパティ}}","Property"],["{{マスクレイヤー}}","Mask Layer"],["{{通常レイヤー}}","Normal Layer"],["{{モーショントゥイーンの削除}}","Deleted Motion Tweening"],["{{モーショントゥイーンの追加}}","Added Motion Tweening"],["{{モーダル表示}}","Modal Indication"],["{{言語}}","Language"],["{{フォーマット}}","Format"],["{{含める}}","Include"],["{{含めない}}","Not Including"],["{{使い方、リファレンス}}","Usage, Reference"],["{{非表示レイヤー}}","Hidden Layers"],["{{設定}}","Setting"],["{{デフォルトのループを利用する}}","Use the default loop"],["{{フレームピッカー}}","Frame Picker"],["{{ステージ左揃え}}","Align Stage Left"],["{{ステージ中央揃え(水平方向)}}","Align Stage Center (Horizontal)"],["{{ステージ右揃え}}","Align Stage Right"],["{{ステージ上揃え}}","Align Stage Top"],["{{ステージ中央揃え(垂直方向)}}","Center Stage (Vertical)"],["{{ステージ下揃え}}","Align Bottom of Stage"],["{{左揃え}}","Left"],["{{中央揃え(水平方向)}}","Center (Horizontal)"],["{{右揃え}}","Right"],["{{上揃え}}","Top"],["{{中央揃え(垂直方向)}}","Center (Vertical)"],["{{下揃え}}","Bottom"],["{{開始フレーム}}","Start Frame"],["{{終了フレーム}}","End Frame"],["{{ループで再生}}","Play in loop"],["{{1回再生}}","1 playback"],["{{指定したフレームで固定}}","Fixed at the specified frame"],["{{1回逆再生}}","1 reverse playback"],["{{逆ループで再生}}","Playback in reverse loop"],["{{画面の拡大・縮小}}","Zoom in/out of screen"],["{{カスタムイージングデータを保存}}","Save custom easing data"],["{{カスタムイージングデータの読込}}","Reading custom easing data"],["{{プレビューのON/OFF}}","Preview on/off"],["{{フォント枠サイズ}}","Font Frame Size"],["{{フォント枠カラー}}","Font Frame Color"],["{{オニオンスキン}}","Onion Skin"],["{{バケツツール}}","Bucket Tools"],["{{ペンツール}}","Pen Tool"],["{{ダブルクリックでカーブポイントが追加されます}}","Double-click to add a curve point"],["{{選択ツール}}","Selection Tool"],["{{Shape変形ツール}}","Shape Transform Tool"],["{{テキストツール}}","Text Tool"],["{{矩形ツール}}","Rectangle Tool"],["{{楕円ツール}}","Ellipse Tool"],["{{角丸矩形ツール}}","Rounded Rectangle Tool"],["{{塗りのカラー}}","Fill Color"],["{{線のカラー}}","Stroke Color"],["{{線の太さ}}","Stroke Width"],["{{プロジェクトデータの読込}}","Loading project data"],["{{プロジェクトデータを保存}}","Save project data"],["{{書き出し}}","Export"],["{{Discordへ移動}}","Go to discord"],["{{バグ報告}}","Bug reports"],["{{設定}}","Setting"],["{{タブを追加}}","Add a tab"],["{{タブの一覧を表示・移動}}","View and move through the list of tabs"],["{{スクリプトを追加}}","Add a script"],["{{キーフレームを追加}}","Add a keyframe"],["{{空のキーフレームを追加}}","Add an empty keyframe"],["{{フレームを追加}}","Add a frame"],["{{フレームを削除}}","Delete frame"],["{{再生}}","Play"],["{{停止}}","Stop"],["{{ループ設定}}","Loop Setting"],["{{レイヤーを追加}}","Add a layer"],["{{レイヤーを削除}}","Delete layer"],["{{全てのレイヤーをハイライト}}","Highlight all layers"],["{{全てのレイヤーを非表示}}","Hide all layers"],["{{全てのレイヤーをロック}}","Lock all layers"],["{{比率を固定}}","Fixed ratio"],["{{ステージの幅}}","Stage Width"],["{{背景色}}","Background Color"],["{{ステージの高さ}}","Stage Height"],["{{フレームレート}}","Frame Rate"],["{{シンボル名}}","Symbol Name"],["{{イージング設定}}","Easing Setting"],["{{ビデオの音量設定}}","Video Volume Setting"],["{{自動再生}}","Auto Play"],["{{テキストエリアのボーダー設定}}","Text Area Border Setting"],["{{テキスト入力設定}}","Text Input Setting"],["{{フォント選択}}","Font Select"],["{{自動サイズ調整}}","Automatic size adjustment"],["{{フォントスタイルタイプ}}","Font Style Type"],["{{行揃え}}","Align"],["{{改行設定}}","Newline Setting"],["{{スクロール設定}}","Scroll Setting"],["{{フォントサイズ}}","Font Size"],["{{フォントカラー}}","Font Color"],["{{行間}}","Line Space"],["{{文字幅}}","Character Width"],["{{左マージン}}","Left Margin"],["{{右マージン}}","Right Margin"],["{{カラー種別の選択}}","Select a color type"],["{{背景画像の選択}}","Selecting a background image"],["{{カラーポインターを追加}}","Add color pointers"],["{{カラー値}}","Color"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Width of the selection object"],["{{選択対象のX座標}}","X coordinate of the selection object"],["{{選択対象の高さ}}","Height  of the selection object"],["{{選択対象のY座標}}","Y coordinate of the selection object"],["{{選択対象の幅の伸縮}}","scaleX of the selected object"],["{{選択対象を回転}}","Rotate the object"],["{{選択対象の高さの伸縮}}","scaleY of the selected object"],["{{アルファオフセット(-255〜255)}}","Alpha Offset(-255〜255)"],["{{赤(0%-100%)}}","Red(0%-100%)"],["{{赤オフセット(-255〜255)}}","Red Offset(-255〜255)"],["{{緑(0%-100%)}}","Green(0%-100%)"],["{{緑オフセット(-255〜255)}}","Green Offset(-255〜255)"],["{{青(0%-100%)}}","Blue(0%-100%)"],["{{青オフセット(-255〜255)}}","Blue Offset(-255〜255)"],["{{ブレンドモード}}","Blend Mode"],["{{フィルターを選択}}","Select a filter"],["{{フィルターを追加}}","Add a filter"],["{{サウンドを追加}}","Add a sound"],["{{フィルターを表示・非表示する}}","Show and Hide filters"],["{{フィルターを削除}}","Delete Filter"],["{{水平方向にぼかす}}","Blur Horizontally"],["{{垂直方向にぼかす}}","Blur Vertically"],["{{フィルター強度}}","Filter Strength"],["{{フィルター角度}}","Filter Angle"],["{{シャドウのアルファ}}","Shadow Alpha"],["{{シャドウのカラー}}","Shadow Color"],["{{フィルター距離}}","Filter Distance"],["{{ハイライトのカラー}}","Highlight Color"],["{{ハイライトのアルファ}}","Highlight Alpha"],["{{グラデーションカラー}}","Gradient Color"],["{{グラデーションのアルファ}}","Gradient Alpha"],["{{タブの移動・名前を変更}}","Move/Rename tabs"],["{{プロジェクトを閉じる}}","Close the project"],["{{上下に移動}}","Move up and down"],["{{レイヤー変更(ダブルクリック)}}","Layer Change(double-click)"],["{{レイヤーをハイライト}}","Highlight Layer"],["{{レイヤーを非表示}}","Hide Layer"],["{{レイヤーをロック}}","Lock the Layer"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Curve Pointer (double click to turn on/off)"],["{{インスタンス名}}","Instance Name"],["{{ライブラリ内の検索}}","Search in the library"],["{{フレームラベル}}","Frame Label"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","If the project is not saved, the project data in this tab cannot be recovered. Do you want to delete the tab?"]])}}class s extends t{createMapping(){return new Map([["{{左上}}","En haut à gauche"],["{{中央上}}","Centre supérieur"],["{{右上}}","Haut Droite"],["{{中央左}}","Centre gauche"],["{{中央}}","Centre"],["{{中央右}}","Centre droit"],["{{左下}}","Bas gauche"],["{{中央下}}","Bas Centre"],["{{右下}}","Bas droit"],["{{中心点のX座標}}","Coordonnée X du point central"],["{{中心点のY座標}}","Coordonnée Y du point central"],["{{MovieClipに変換}}","Convertir en MovieClip"],["{{変換}}","transformation"],["{{ループ回数}}","Nombre de boucles"],["{{カーブポインターの削除}}","Supprimer le pointeur de courbe"],["{{ステージ基準}}","Critères d'étape"],["{{閉じる}}","Fermer"],["{{保存}}","Sauvez"],["{{リセット}}","réinitialiser"],["{{スクリーン}}","Écran"],["{{ショートカット設定}}","Paramètres des raccourcis"],["{{レイヤーカラー}}","couleur superposée"],["{{Next2Dを支援する}}","Soutenez Next2D"],["{{サポート}}","soutien"],["{{未使用のアイテムを削除}}","Retirer les articles non utilisés"],["{{レイヤーをペースト}}","Couche de pâte"],["{{レイヤーをコピー}}","Copie de la couche"],["{{フレームをペースト}}","Coller le cadre"],["{{フレームをコピー}}","Cadre de copie"],["{{キーフレームを削除}}","Supprimez les images clés"],["{{キーフレームに空のキーフレームを追加できません}}","Impossible d'ajouter des images clés vides à des images clés"],["{{ズームツール}}","Outil de zoom"],["{{タイムライン幅の拡大・縮小}}","Largeur de la ligne de temps Développer/réduire"],["{{ガイドレイヤー}}","couche de guidage"],["{{音量設定}}","Réglage du volume"],["{{サウンドを削除}}","Supprimer le son"],["{{カスタムループ}}","boucle personnalisée"],["{{読込のみ}}","Lecture seulement"],["{{書込を許可}}","autorisation de poste"],["{{単一行}}","Ligne unique"],["{{複数行}}","Multiline"],["{{自動で折り返し}}","Enveloppe automatique"],["{{左寄せ}}","Gauche"],["{{中央揃え}}","Centre"],["{{右寄せ}}","Droite"],["{{放射状グラデーション}}","gradation radiale"],["{{線形グラデーション}}","gradient linéaire"],["{{画像}}","Image"],["{{画像選択}}","Sélection d'images"],["{{種別}}","Type"],["{{Shapeの色設定}}","Paramètres de couleur de la forme"],["{{変形}}","déformation"],["{{カラー効果}}","Transformation des couleurs"],["{{フィルター}}","filtre"],["{{Shapeを複製}}","Dupliquer la forme"],["{{読み込み}}","lire dans"],["{{新規フォルダー}}","Nouveau dossier"],["{{新規MovieClip}}","Nouveau MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Redimensionnez le texte pour l'adapter au cadre"],["{{テキストに合わせて枠をリサイズ}}","Redimensionnez le cadre pour l'adapter au texte"],["{{リサイズしない}}","Pas de redimensionnement"],["{{フォント}}","police"],["{{テキスト}}","Texte"],["{{ループ}}","boucle"],["{{音量}}","volume"],["{{ビデオ}}","Vidéo"],["{{イージング}}","facilitant"],["{{サウンド}}","son"],["{{シンボル}}","Symbole"],["{{名前}}","Nom"],["{{オブジェクト}}","objet"],["{{ステージ設定}}","Mise en scène"],["{{プレビュー}}","Prévisualisation"],["{{削除}}","Supprimer"],["{{ペースト}}","Pâte"],["{{コピー}}","Copie"],["{{プラグインメニュー}}","Menu plug-in"],["{{トゥイーン}}","entre"],["{{カーブポインターの追加}}","Pointeur de courbe supplémentaire"],["{{パスの結合}}","Fusion de chemins"],["{{シェイプ}}","forme"],["{{キーフレームに配分}}","Attribution aux images clés"],["{{レイヤーに配分}}","Affectation aux couches"],["{{タイムライン}}","chronologie"],["{{整列}}","Aligner"],["{{最背面}}","La plupart des dos"],["{{ひとつ背面へ}}","Un à l'arrière"],["{{ひとつ前面へ}}","Un front"],["{{最前面}}","Frontmost"],["{{重ね順}}","Organiser"],["{{プラグイン}}","plug-in"],["{{ライブラリ}}","bibliothèque"],["{{プロパティ}}","propriété"],["{{マスクレイヤー}}","couche de masque"],["{{通常レイヤー}}","Couche normale"],["{{モーショントゥイーンの削除}}","Suppression des tweens de mouvement"],["{{モーショントゥイーンの追加}}","Des tweens de mouvement supplémentaires"],["{{モーダル表示}}","indication modale"],["{{言語}}","Langue"],["{{フォーマット}}","format"],["{{含める}}","inclure"],["{{含めない}}","à ne pas inclure"],["{{使い方、リファレンス}}","Utilisation, référence"],["{{非表示レイヤー}}","couche cachée"],["{{設定}}","configuration"],["{{デフォルトのループを利用する}}","Utilisez la boucle par défaut"],["{{フレームピッカー}}","ramasseur de cadres"],["{{ステージ左揃え}}","Aligner la scène à gauche"],["{{ステージ中央揃え(水平方向)}}","Aligner le centre de la scène (horizontal)"],["{{ステージ右揃え}}","Aligner la scène à droite"],["{{ステージ上揃え}}","Aligner la scène vers le haut"],["{{ステージ中央揃え(垂直方向)}}","Aligner le centre de la scène (vertical)"],["{{ステージ下揃え}}","Aligner le fond de la scène"],["{{左揃え}}","Gauche"],["{{中央揃え(水平方向)}}","Centre(sens horizontal)"],["{{右揃え}}","Droit"],["{{上揃え}}","Top"],["{{中央揃え(垂直方向)}}","Centre(Vertical)"],["{{下揃え}}","Fond"],["{{開始フレーム}}","cadre de départ"],["{{終了フレーム}}","cadre terminal"],["{{ループで再生}}","Lecture en boucle"],["{{1回再生}}","1 lecture"],["{{指定したフレームで固定}}","Fixé dans le cadre spécifié"],["{{1回逆再生}}","1 lecture en sens inverse"],["{{逆ループで再生}}","Lecture en boucle inversée"],["{{画面の拡大・縮小}}","Zoom avant et arrière sur l'écran"],["{{カスタムイージングデータを保存}}","Enregistrez les données d'assouplissement personnalisées"],["{{カスタムイージングデータの読込}}","Lecture des données de l'assouplissement personnalisé"],["{{プレビューのON/OFF}}","Activation/désactivation de la prévisualisation"],["{{フォント枠サイズ}}","Taille du cadre de la police"],["{{フォント枠カラー}}","Couleur du cadre de la police"],["{{オニオンスキン}}","Peau d'oignon"],["{{バケツツール}}","Outils à godets"],["{{ペンツール}}","Outil stylo"],["{{ダブルクリックでカーブポイントが追加されます}}","Double-cliquez pour ajouter un point de courbe"],["{{選択ツール}}","Outils de sélection"],["{{Shape変形ツール}}","Outil de transformation des formes"],["{{テキストツール}}","Outil texte"],["{{矩形ツール}}","Outil Rectangle"],["{{楕円ツール}}","Outil Ellipse"],["{{角丸矩形ツール}}","Outil Rectangle arrondi"],["{{塗りのカラー}}","Couleur de remplissage"],["{{線のカラー}}","Couleur du trait"],["{{線の太さ}}","Largeur de course"],["{{プロジェクトデータの読込}}","Chargement des données du projet"],["{{プロジェクトデータを保存}}","Sauvegarder les données du projet"],["{{書き出し}}","Exportation"],["{{Discordへ移動}}","Aller sur le discord"],["{{バグ報告}}","Rapports de bogue"],["{{設定}}","Réglage de"],["{{タブを追加}}","Ajouter un onglet"],["{{タブの一覧を表示・移動}}","Visualiser et se déplacer dans la liste des onglets"],["{{スクリプトを追加}}","Ajouter un script"],["{{キーフレームを追加}}","Ajouter une image clé"],["{{空のキーフレームを追加}}","Ajouter une image clé vide"],["{{フレームを追加}}","Ajouter un cadre"],["{{フレームを削除}}","Supprimer le cadre"],["{{再生}}","Jouer"],["{{停止}}","Stop"],["{{ループ設定}}","Réglage de la boucle"],["{{レイヤーを追加}}","Ajouter une couche"],["{{レイヤーを削除}}","Supprimer la couche"],["{{全てのレイヤーをハイライト}}","Mettez en évidence toutes les couches"],["{{全てのレイヤーを非表示}}","Cacher toutes les couches"],["{{全てのレイヤーをロック}}","Verrouiller toutes les couches"],["{{比率を固定}}","Ratio fixe"],["{{ステージの幅}}","Largeur de la scène"],["{{背景色}}","Couleur de fond"],["{{ステージの高さ}}","Hauteur de la scène"],["{{フレームレート}}","Fréquence d'images"],["{{シンボル名}}","Nom du symbole"],["{{イージング設定}}","Réglage de l'assouplissement"],["{{ビデオの音量設定}}","Réglage du volume vidéo"],["{{自動再生}}","Lecture automatique"],["{{テキストエリアのボーダー設定}}","Réglage de la bordure de la zone de texte"],["{{テキスト入力設定}}","Réglage de la saisie du texte"],["{{フォント選択}}","Sélection de la police"],["{{自動サイズ調整}}","Ajustement automatique de la taille"],["{{フォントスタイルタイプ}}","Type de police"],["{{行揃え}}","Aligner"],["{{改行設定}}","Réglage des nouvelles lignes"],["{{スクロール設定}}","Réglage du défilement"],["{{フォントサイズ}}","Taille de la police"],["{{フォントカラー}}","Couleur de la police"],["{{行間}}","Espace linéaire"],["{{文字幅}}","Largeur des caractères"],["{{左マージン}}","Marge gauche"],["{{右マージン}}","Marge droite"],["{{カラー種別の選択}}","Sélectionnez un type de couleur"],["{{背景画像の選択}}","Sélection d'une image de fond"],["{{カラーポインターを追加}}","Ajouter des pointeurs de couleur"],["{{カラー値}}","Couleur"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Largeur de l'objet de sélection"],["{{選択対象のX座標}}","Coordonnée X de l'objet de sélection"],["{{選択対象の高さ}}","Hauteur de l'objet de sélection"],["{{選択対象のY座標}}","Coordonnée Y de l'objet de sélection"],["{{選択対象の幅の伸縮}}","scaleX de l'objet sélectionné"],["{{選択対象を回転}}","Faire pivoter l'objet"],["{{選択対象の高さの伸縮}}","scaleY de l'objet sélectionné"],["{{アルファオフセット(-255〜255)}}","Décalage alpha(-255〜255)"],["{{赤(0%-100%)}}","Rouge(0%-100%)"],["{{赤オフセット(-255〜255)}}","Décalage rouge(-255〜255)"],["{{緑(0%-100%)}}","Vert(0%-100%)"],["{{緑オフセット(-255〜255)}}","Compensation verte(-255〜255)"],["{{青(0%-100%)}}","Bleu(0%-100%)"],["{{青オフセット(-255〜255)}}","Décalage bleu(-255〜255)"],["{{ブレンドモード}}","Mode de mélange"],["{{フィルターを選択}}","Sélectionnez un filtre"],["{{フィルターを追加}}","Ajouter un filtre"],["{{サウンドを追加}}","Ajouter un son"],["{{フィルターを表示・非表示する}}","Afficher et masquer les filtres"],["{{フィルターを削除}}","Supprimer le filtre"],["{{水平方向にぼかす}}","Flou horizontal"],["{{垂直方向にぼかす}}","Flou vertical"],["{{フィルター強度}}","Résistance du filtre"],["{{フィルター角度}}","Angle du filtre"],["{{シャドウのアルファ}}","Shadow Alpha"],["{{シャドウのカラー}}","Couleur de l'ombre"],["{{フィルター距離}}","Distance du filtre"],["{{ハイライトのカラー}}","Couleur de mise en évidence"],["{{ハイライトのアルファ}}","Highlight Alpha"],["{{グラデーションカラー}}","Couleur dégradée"],["{{グラデーションのアルファ}}","Gradient Alpha"],["{{タブの移動・名前を変更}}","Déplacer/Renommer les onglets"],["{{プロジェクトを閉じる}}","Fermer le projet"],["{{上下に移動}}","Déplacement vers le haut et le bas"],["{{レイヤー変更(ダブルクリック)}}","Changement de couche (double-clic)"],["{{レイヤーをハイライト}}","Couche de mise en évidence"],["{{レイヤーを非表示}}","Masquer la couche"],["{{レイヤーをロック}}","Verrouiller le calque"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Pointeur de courbe (double-cliquez pour l'activer ou le désactiver)"],["{{インスタンス名}}","Nom de l'instance"],["{{ライブラリ内の検索}}","Recherche dans la bibliothèque"],["{{フレームラベル}}","Étiquette du cadre"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Si le projet n'est pas sauvegardé, les données du projet dans cet onglet ne peuvent pas être récupérées. Voulez-vous supprimer l'onglet ?"]])}}class i extends t{createMapping(){return new Map([["{{左上}}","In alto a sinistra"],["{{中央上}}","In alto al centro"],["{{右上}}","In alto a destra"],["{{中央左}}","Centro Sinistra"],["{{中央}}","Centro"],["{{中央右}}","Centro Destra"],["{{左下}}","In basso a sinistra"],["{{中央下}}","In basso al centro"],["{{右下}}","In basso a destra"],["{{中心点のX座標}}","Coordinata X del punto centrale"],["{{中心点のY座標}}","Coordinata Y del punto centrale"],["{{MovieClipに変換}}","Convertire in MovieClip"],["{{変換}}","trasformazione"],["{{ループ回数}}","Conteggio dei cicli"],["{{カーブポインターの削除}}","Elimina il puntatore di curva"],["{{ステージ基準}}","Criteri di fase"],["{{閉じる}}","Chiudere"],["{{保存}}","Risparmiare"],["{{リセット}}","azzeramento"],["{{スクリーン}}","Schermo"],["{{ショートカット設定}}","Impostazioni delle scorciatoie"],["{{レイヤーカラー}}","colore stratificato"],["{{Next2Dを支援する}}","Supporto Next2D"],["{{サポート}}","supporto"],["{{未使用のアイテムを削除}}","Rimuovere gli articoli inutilizzati"],["{{レイヤーをペースト}}","Strato di pasta"],["{{レイヤーをコピー}}","Copiare il livello"],["{{フレームをペースト}}","Incolla la cornice"],["{{フレームをコピー}}","Cornice di copia"],["{{キーフレームを削除}}","Elimina i fotogrammi chiave"],["{{キーフレームに空のキーフレームを追加できません}}","Impossibile aggiungere keyframes vuoti ai keyframes"],["{{ズームツール}}","Strumento zoom"],["{{タイムライン幅の拡大・縮小}}","Larghezza della timeline Espandere/ridurre"],["{{ガイドレイヤー}}","strato guida"],["{{音量設定}}","Regolazione del volume"],["{{サウンドを削除}}","Rimuovere il suono"],["{{カスタムループ}}","anello personalizzato"],["{{読込のみ}}","Leggere solo"],["{{書込を許可}}","autorizzazione del post"],["{{単一行}}","Linea singola"],["{{複数行}}","Multiline"],["{{自動で折り返し}}","Avvolgimento automatico"],["{{左寄せ}}","Sinistra"],["{{中央揃え}}","Centro"],["{{右寄せ}}","Destra"],["{{放射状グラデーション}}","gradazione radiale"],["{{線形グラデーション}}","gradiente lineare"],["{{画像}}","Immagine"],["{{画像選択}}","Selezione dell'immagine"],["{{種別}}","Tipo"],["{{Shapeの色設定}}","Impostazioni del colore della forma"],["{{変形}}","deformazione"],["{{カラー効果}}","Trasformazione del colore"],["{{フィルター}}","filtro"],["{{Shapeを複製}}","Forma duplicata"],["{{読み込み}}","leggere in"],["{{新規フォルダー}}","Nuova cartella"],["{{新規MovieClip}}","Nuovo MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Ridimensiona il testo per adattarlo alla cornice"],["{{テキストに合わせて枠をリサイズ}}","Ridimensiona la cornice per adattarla al testo"],["{{リサイズしない}}","Nessun ridimensionamento"],["{{フォント}}","font"],["{{テキスト}}","Testo"],["{{ループ}}","loop"],["{{音量}}","volume"],["{{ビデオ}}","Video"],["{{イージング}}","facilitando"],["{{サウンド}}","suono"],["{{シンボル}}","Simbolo"],["{{名前}}","Nome"],["{{オブジェクト}}","oggetto"],["{{ステージ設定}}","Scenario"],["{{プレビュー}}","Anteprima"],["{{削除}}","Cancellare"],["{{ペースト}}","Incolla"],["{{コピー}}","Copia"],["{{プラグインメニュー}}","Menu del plug-in"],["{{トゥイーン}}","tween"],["{{カーブポインターの追加}}","Puntatore di curva supplementare"],["{{パスの結合}}","Fusione di percorsi"],["{{シェイプ}}","forma"],["{{キーフレームに配分}}","Assegnazione ai fotogrammi chiave"],["{{レイヤーに配分}}","Assegnazione ai livelli"],["{{タイムライン}}","Timeline"],["{{整列}}","Allineare"],["{{最背面}}","La maggior parte della schiena"],["{{ひとつ背面へ}}","Uno sul retro"],["{{ひとつ前面へ}}","Una parte anteriore"],["{{最前面}}","In prima linea"],["{{重ね順}}","Organizzare"],["{{プラグイン}}","plug-in"],["{{ライブラリ}}","biblioteca"],["{{プロパティ}}","proprietà"],["{{マスクレイヤー}}","strato di maschera"],["{{通常レイヤー}}","Strato normale"],["{{モーショントゥイーンの削除}}","Soppressione dei tweens di movimento"],["{{モーショントゥイーンの追加}}","Ulteriori tween di movimento"],["{{モーダル表示}}","indicazione modale"],["{{言語}}","Lingua"],["{{フォーマット}}","formato"],["{{含める}}","includere"],["{{含めない}}","non includere"],["{{使い方、リファレンス}}","Uso, riferimento"],["{{非表示レイヤー}}","strato nascosto"],["{{設定}}","setup"],["{{デフォルトのループを利用する}}","Utilizzare il ciclo predefinito"],["{{フレームピッカー}}","raccoglitore di cornici"],["{{ステージ左揃え}}","Allineare il palco a sinistra"],["{{ステージ中央揃え(水平方向)}}","Allineare il centro del palco (orizzontale)"],["{{ステージ右揃え}}","Allineare il palco a destra"],["{{ステージ上揃え}}","Allineare il palco in alto"],["{{ステージ中央揃え(垂直方向)}}","Allineare il centro del palco (verticale)"],["{{ステージ下揃え}}","Allineare il fondo del palco"],["{{左揃え}}","Sinistra"],["{{中央揃え(水平方向)}}","Centro (Orizzontalità)"],["{{右揃え}}","Destra"],["{{上揃え}}","Top"],["{{中央揃え(垂直方向)}}","Centro (Verticale)"],["{{下揃え}}","Fondo"],["{{開始フレーム}}","telaio di partenza"],["{{終了フレーム}}","telaio finale"],["{{ループで再生}}","Gioca in loop"],["{{1回再生}}","1 riproduzione"],["{{指定したフレームで固定}}","Fissato nella cornice specificata"],["{{1回逆再生}}","1 riproduzione inversa"],["{{逆ループで再生}}","Riproduzione in loop inverso"],["{{画面の拡大・縮小}}","Ingrandire e rimpicciolire lo schermo"],["{{カスタムイージングデータを保存}}","Salva i dati di easing personalizzati"],["{{カスタムイージングデータの読込}}","Lettura dei dati di easing personalizzati"],["{{プレビューのON/OFF}}","Anteprima on/off"],["{{フォント枠サイズ}}","Dimensione della cornice del carattere"],["{{フォント枠カラー}}","Colore della cornice del carattere"],["{{オニオンスキン}}","Pelle di cipolla"],["{{バケツツール}}","Strumenti a secchiello"],["{{ペンツール}}","Strumento penna"],["{{ダブルクリックでカーブポイントが追加されます}}","Doppio clic per aggiungere un punto di curva"],["{{選択ツール}}","Strumenti di selezione"],["{{Shape変形ツール}}","Strumento di trasformazione della forma"],["{{テキストツール}}","Text Tool"],["{{矩形ツール}}","Strumento di testo"],["{{楕円ツール}}","Strumento Ellisse"],["{{角丸矩形ツール}}","Strumento Rettangolo arrotondato"],["{{塗りのカラー}}","Colore di riempimento"],["{{線のカラー}}","Colore del tratto"],["{{線の太さ}}","Larghezza della corsa"],["{{プロジェクトデータの読込}}","Caricamento dei dati del progetto"],["{{プロジェクトデータを保存}}","Salvare i dati del progetto"],["{{書き出し}}","Esportazione"],["{{Discordへ移動}}","Vai su discordia"],["{{バグ報告}}","Segnalazioni di bug"],["{{設定}}","Impostazione"],["{{タブを追加}}","Aggiungere una scheda"],["{{タブの一覧を表示・移動}}","Visualizzare e spostarsi attraverso l'elenco delle schede"],["{{スクリプトを追加}}","Aggiungere uno script"],["{{キーフレームを追加}}","Aggiungere un keyframe"],["{{空のキーフレームを追加}}","Aggiungere un keyframe vuoto"],["{{フレームを追加}}","Aggiungere una cornice"],["{{フレームを削除}}","Cancellare la cornice"],["{{再生}}","Gioca"],["{{停止}}","Fermare"],["{{ループ設定}}","Impostazione del loop"],["{{レイヤーを追加}}","Aggiungere uno strato"],["{{レイヤーを削除}}","Cancellare il livello"],["{{全てのレイヤーをハイライト}}","Evidenzia tutti i livelli"],["{{全てのレイヤーを非表示}}","Nascondi tutti i livelli"],["{{全てのレイヤーをロック}}","Blocca tutti i livelli"],["{{比率を固定}}","Rapporto fisso"],["{{ステージの幅}}","Larghezza del palco"],["{{背景色}}","Colore di sfondo"],["{{ステージの高さ}}","Altezza del palco"],["{{フレームレート}}","Frame Rate"],["{{シンボル名}}","Nome del simbolo"],["{{イージング設定}}","Impostazione di rilassamento"],["{{ビデオの音量設定}}","Impostazione del volume video"],["{{自動再生}}","Riproduzione automatica"],["{{テキストエリアのボーダー設定}}","Impostazione del bordo dell'area di testo"],["{{テキスト入力設定}}","Impostazione dell'inserimento del testo"],["{{フォント選択}}","Seleziona il carattere"],["{{自動サイズ調整}}","Regolazione automatica delle dimensioni"],["{{フォントスタイルタイプ}}","Tipo di stile di carattere"],["{{行揃え}}","Allineare"],["{{改行設定}}","Impostazione Newline"],["{{スクロール設定}}","Impostazione dello scorrimento"],["{{フォントサイズ}}","Dimensione del carattere"],["{{フォントカラー}}","Colore del carattere"],["{{行間}}","Spazio di linea"],["{{文字幅}}","Larghezza del carattere"],["{{左マージン}}","Margine sinistro"],["{{右マージン}}","Margine destro"],["{{カラー種別の選択}}","Seleziona un tipo di colore"],["{{背景画像の選択}}","Selezionare un'immagine di sfondo"],["{{カラーポインターを追加}}","Aggiungere i puntatori di colore"],["{{カラー値}}","Colore"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Larghezza dell'oggetto di selezione"],["{{選択対象のX座標}}","Coordinata X dell'oggetto di selezione"],["{{選択対象の高さ}}","Altezza dell'oggetto di selezione"],["{{選択対象のY座標}}","Coordinata Y dell'oggetto di selezione"],["{{選択対象の幅の伸縮}}","scaleX dell'oggetto selezionato"],["{{選択対象を回転}}","Ruotare l'oggetto"],["{{選択対象の高さの伸縮}}","scalaY dell'oggetto selezionato"],["{{アルファオフセット(-255〜255)}}","Offset alfa(-255〜255)"],["{{赤(0%-100%)}}","Rosso(0%-100%)"],["{{赤オフセット(-255〜255)}}","Offset rosso(-255〜255)"],["{{緑(0%-100%)}}","Verde(0%-100%)"],["{{緑オフセット(-255〜255)}}","Offset Verde(-255〜255)"],["{{青(0%-100%)}}","Blu(0%-100%)"],["{{青オフセット(-255〜255)}}","Offset Blu(-255〜255)"],["{{ブレンドモード}}","Modalità di fusione"],["{{フィルターを選択}}","Seleziona un filtro"],["{{フィルターを追加}}","Aggiungere un filtro"],["{{サウンドを追加}}","Aggiungere un suono"],["{{フィルターを表示・非表示する}}","Mostrare e nascondere i filtri"],["{{フィルターを削除}}","Cancellare il filtro"],["{{水平方向にぼかす}}","Sfocatura orizzontale"],["{{垂直方向にぼかす}}","Sfocatura verticale"],["{{フィルター強度}}","Forza del filtro"],["{{フィルター角度}}","Angolo del filtro"],["{{シャドウのアルファ}}","Ombra alfa"],["{{シャドウのカラー}}","Colore dell'ombra"],["{{フィルター距離}}","Distanza del filtro"],["{{ハイライトのカラー}}","Colore in evidenza"],["{{ハイライトのアルファ}}","Evidenziare l'alfa"],["{{グラデーションカラー}}","Colore sfumato"],["{{グラデーションのアルファ}}","Gradiente alfa"],["{{タブの移動・名前を変更}}","Spostare/rinominare le schede"],["{{プロジェクトを閉じる}}","Chiudere il progetto"],["{{上下に移動}}","Sposta su e giù"],["{{レイヤー変更(ダブルクリック)}}","Cambio di livello (doppio clic)"],["{{レイヤーをハイライト}}","Strato di evidenziazione"],["{{レイヤーを非表示}}","Nascondere lo strato"],["{{レイヤーをロック}}","Bloccare il livello"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Curve Pointer (doppio clic per attivare/disattivare)"],["{{インスタンス名}}","Nome dell'istanza"],["{{ライブラリ内の検索}}","Cerca nella biblioteca"],["{{フレームラベル}}","Etichetta del telaio"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Se il progetto non viene salvato, i dati del progetto in questa scheda non possono essere recuperati. Vuoi cancellare la scheda?"]])}}class n extends t{createMapping(){return new Map([["{{左上}}","左上"],["{{中央上}}","中央上"],["{{右上}}","右上"],["{{中央左}}","中央左"],["{{中央}}","中央"],["{{中央右}}","中央右"],["{{左下}}","左下"],["{{中央下}}","中央下"],["{{右下}}","右下"],["{{中心点のX座標}}","中心点のX座標"],["{{中心点のY座標}}","中心点のY座標"],["{{MovieClipに変換}}","MovieClipに変換"],["{{変換}}","変換"],["{{ループ回数}}","ループ回数"],["{{カーブポインターの削除}}","カーブポインターの削除"],["{{ステージ基準}}","ステージ基準"],["{{閉じる}}","閉じる"],["{{保存}}","保存"],["{{リセット}}","リセット"],["{{スクリーン}}","スクリーン"],["{{ショートカット設定}}","ショートカット設定"],["{{レイヤーカラー}}","レイヤーカラー"],["{{Next2Dを支援する}}","Next2Dを支援する"],["{{サポート}}","サポート"],["{{未使用のアイテムを削除}}","未使用のアイテムを削除"],["{{レイヤーをペースト}}","レイヤーをペースト"],["{{レイヤーをコピー}}","レイヤーをコピー"],["{{フレームをペースト}}","フレームをペースト"],["{{フレームをコピー}}","フレームをコピー"],["{{キーフレームを削除}}","キーフレームを削除"],["{{キーフレームに空のキーフレームを追加できません}}","キーフレームに空のキーフレームを追加できません"],["{{ズームツール}}","ズームツール"],["{{タイムライン幅の拡大・縮小}}","タイムライン幅の拡大・縮小"],["{{ガイドレイヤー}}","ガイドレイヤー"],["{{音量設定}}","音量設定"],["{{サウンドを削除}}","サウンドを削除"],["{{カスタムループ}}","カスタムループ"],["{{読込のみ}}","読込のみ"],["{{書込を許可}}","書込を許可"],["{{単一行}}","単一行"],["{{複数行}}","複数行"],["{{自動で折り返し}}","自動で折り返し"],["{{左寄せ}}","左寄せ"],["{{中央揃え}}","中央揃え"],["{{右寄せ}}","右寄せ"],["{{放射状グラデーション}}","放射状グラデーション"],["{{線形グラデーション}}","線形グラデーション"],["{{画像}}","画像"],["{{画像選択}}","画像選択"],["{{種別}}","種別"],["{{Shapeの色設定}}","Shapeの色設定"],["{{変形}}","変形"],["{{カラー効果}}","カラー効果"],["{{フィルター}}","フィルター"],["{{Shapeを複製}}","Shapeを複製"],["{{読み込み}}","読み込み"],["{{新規フォルダー}}","新規フォルダー"],["{{新規MovieClip}}","新規MovieClip"],["{{枠に合わせてテキストをリサイズ}}","枠に合わせてテキストをリサイズ"],["{{テキストに合わせて枠をリサイズ}}","テキストに合わせて枠をリサイズ"],["{{リサイズしない}}","リサイズしない"],["{{フォント}}","フォント"],["{{テキスト}}","テキスト"],["{{ループ}}","ループ"],["{{音量}}","音量"],["{{ビデオ}}","ビデオ"],["{{イージング}}","イージング"],["{{サウンド}}","サウンド"],["{{シンボル}}","シンボル"],["{{名前}}","名前"],["{{オブジェクト}}","オブジェクト"],["{{ステージ設定}}","ステージ設定"],["{{プレビュー}}","プレビュー"],["{{削除}}","削除"],["{{ペースト}}","ペースト"],["{{コピー}}","コピー"],["{{プラグインメニュー}}","プラグインメニュー"],["{{トゥイーン}}","トゥイーン"],["{{カーブポインターの追加}}","カーブポインターの追加"],["{{パスの結合}}","パスの結合"],["{{シェイプ}}","シェイプ"],["{{キーフレームに配分}}","キーフレームに配分"],["{{レイヤーに配分}}","レイヤーに配分"],["{{タイムライン}}","タイムライン"],["{{整列}}","整列"],["{{最背面}}","最背面"],["{{ひとつ背面へ}}","ひとつ背面へ"],["{{ひとつ前面へ}}","ひとつ前面へ"],["{{最前面}}","最前面"],["{{重ね順}}","重ね順"],["{{プラグイン}}","プラグイン"],["{{ライブラリ}}","ライブラリ"],["{{プロパティ}}","プロパティ"],["{{マスクレイヤー}}","マスクレイヤー"],["{{通常レイヤー}}","通常レイヤー"],["{{モーショントゥイーンの削除}}","モーショントゥイーンの削除"],["{{モーショントゥイーンの追加}}","モーショントゥイーンの追加"],["{{モーダル表示}}","モーダル表示"],["{{言語}}","言語"],["{{フォーマット}}","フォーマット"],["{{含める}}","含める"],["{{含めない}}","含めない"],["{{使い方、リファレンス}}","使い方、リファレンス"],["{{非表示レイヤー}}","非表示レイヤー"],["{{設定}}","設定"],["{{デフォルトのループを利用する}}","デフォルトのループを利用する"],["{{フレームピッカー}}","フレームピッカー"],["{{ステージ左揃え}}","ステージ左揃え"],["{{ステージ中央揃え(水平方向)}}","ステージ中央揃え(水平方向)"],["{{ステージ右揃え}}","ステージ右揃え"],["{{ステージ上揃え}}","ステージ上揃え"],["{{ステージ中央揃え(垂直方向)}}","ステージ中央揃え(垂直方向)"],["{{ステージ下揃え}}","ステージ下揃え"],["{{左揃え}}","左揃え"],["{{中央揃え(水平方向)}}","中央揃え(水平方向)"],["{{右揃え}}","右揃え"],["{{上揃え}}","上揃え"],["{{中央揃え(垂直方向)}}","中央揃え(垂直方向)"],["{{下揃え}}","下揃え"],["{{開始フレーム}}","開始フレーム"],["{{終了フレーム}}","終了フレーム"],["{{ループで再生}}","ループで再生"],["{{1回再生}}","1回再生"],["{{指定したフレームで固定}}","指定したフレームで固定"],["{{1回逆再生}}","1回逆再生"],["{{逆ループで再生}}","逆ループで再生"],["{{画面の拡大・縮小}}","画面の拡大・縮小"],["{{カスタムイージングデータを保存}}","カスタムイージングデータを保存"],["{{カスタムイージングデータの読込}}","カスタムイージングデータの読込"],["{{プレビューのON/OFF}}","プレビューのON/OFF"],["{{フォント枠サイズ}}","フォント枠サイズ"],["{{フォント枠カラー}}","フォント枠カラー"],["{{オニオンスキン}}","オニオンスキン"],["{{バケツツール}}","バケツツール"],["{{ペンツール}}","ペンツール"],["{{ダブルクリックでカーブポイントが追加されます}}","ダブルクリックでカーブポイントが追加されます"],["{{選択ツール}}","選択ツール"],["{{Shape変形ツール}}","Shape変形ツール"],["{{テキストツール}}","テキストツール"],["{{矩形ツール}}","矩形ツール"],["{{楕円ツール}}","楕円ツール"],["{{角丸矩形ツール}}","角丸矩形ツール"],["{{塗りのカラー}}","塗りのカラー"],["{{線のカラー}}","線のカラー"],["{{線の太さ}}","線の太さ"],["{{プロジェクトデータの読込}}","プロジェクトデータの読込"],["{{プロジェクトデータを保存}}","プロジェクトデータを保存"],["{{書き出し}}","書き出し"],["{{Discordへ移動}}","Discordへ移動"],["{{バグ報告}}","バグ報告"],["{{設定}}","設定"],["{{タブを追加}}","タブを追加"],["{{タブの一覧を表示・移動}}","タブの一覧を表示・移動"],["{{スクリプトを追加}}","スクリプトを追加"],["{{キーフレームを追加}}","キーフレームを追加"],["{{空のキーフレームを追加}}","空のキーフレームを追加"],["{{フレームを追加}}","フレームを追加"],["{{フレームを削除}}","フレームを削除"],["{{再生}}","再生"],["{{停止}}","停止"],["{{ループ設定}}","ループ設定"],["{{レイヤーを追加}}","レイヤーを追加"],["{{レイヤーを削除}}","レイヤーを削除"],["{{全てのレイヤーをハイライト}}","全てのレイヤーをハイライト"],["{{全てのレイヤーを非表示}}","全てのレイヤーを非表示"],["{{全てのレイヤーをロック}}","全てのレイヤーをロック"],["{{比率を固定}}","比率を固定"],["{{ステージの幅}}","ステージの幅"],["{{背景色}}","背景色"],["{{ステージの高さ}}","ステージの高さ"],["{{フレームレート}}","フレームレート"],["{{シンボル名}}","シンボル名"],["{{イージング設定}}","イージング設定"],["{{ビデオの音量設定}}","ビデオの音量設定"],["{{自動再生}}","自動再生"],["{{テキストエリアのボーダー設定}}","テキストエリアのボーダー設定"],["{{テキスト入力設定}}","テキスト入力設定"],["{{フォント選択}}","フォント選択"],["{{自動サイズ調整}}","自動サイズ調整"],["{{フォントスタイルタイプ}}","フォントスタイルタイプ"],["{{行揃え}}","行揃え"],["{{改行設定}}","改行設定"],["{{スクロール設定}}","スクロール設定"],["{{フォントサイズ}}","フォントサイズ"],["{{フォントカラー}}","フォントカラー"],["{{行間}}","行間"],["{{文字幅}}","文字幅"],["{{左マージン}}","左マージン"],["{{右マージン}}","右マージン"],["{{カラー種別の選択}}","カラー種別の選択"],["{{背景画像の選択}}","背景画像の選択"],["{{カラーポインターを追加}}","カラーポインターを追加"],["{{カラー値}}","カラー値"],["{{アルファ(0%-100%)}}","アルファ(0%-100%)"],["{{アルファ値}}","アルファ値"],["{{選択対象の幅}}","選択対象の幅"],["{{選択対象のX座標}}","選択対象のX座標"],["{{選択対象の高さ}}","選択対象の高さ"],["{{選択対象のY座標}}","選択対象のY座標"],["{{選択対象の幅の伸縮}}","選択対象の幅の伸縮"],["{{選択対象を回転}}","選択対象を回転"],["{{選択対象の高さの伸縮}}","選択対象の高さの伸縮"],["{{アルファオフセット(-255〜255)}}","アルファオフセット(-255〜255)"],["{{赤(0%-100%)}}","赤(0%-100%)"],["{{赤オフセット(-255〜255)}}","赤オフセット(-255〜255)"],["{{緑(0%-100%)}}","緑(0%-100%)"],["{{緑オフセット(-255〜255)}}","緑オフセット(-255〜255)"],["{{青(0%-100%)}}","青(0%-100%)"],["{{青オフセット(-255〜255)}}","青オフセット(-255〜255)"],["{{ブレンドモード}}","ブレンドモード"],["{{フィルターを選択}}","フィルターを選択"],["{{フィルターを追加}}","フィルターを追加"],["{{サウンドを追加}}","サウンドを追加"],["{{フィルターを表示・非表示する}}","フィルターを表示・非表示する"],["{{フィルターを削除}}","フィルターを削除"],["{{水平方向にぼかす}}","水平方向にぼかす"],["{{垂直方向にぼかす}}","垂直方向にぼかす"],["{{フィルター強度}}","フィルター強度"],["{{フィルター角度}}","フィルター角度"],["{{シャドウのアルファ}}","シャドウのアルファ"],["{{シャドウのカラー}}","シャドウのカラー"],["{{フィルター距離}}","フィルター距離"],["{{ハイライトのカラー}}","ハイライトのカラー"],["{{ハイライトのアルファ}}","ハイライトのアルファ"],["{{グラデーションカラー}}","グラデーションカラー"],["{{グラデーションのアルファ}}","グラデーションのアルファ"],["{{タブの移動・名前を変更}}","タブの移動・名前を変更"],["{{プロジェクトを閉じる}}","プロジェクトを閉じる"],["{{上下に移動}}","上下に移動"],["{{レイヤー変更(ダブルクリック)}}","レイヤー変更(ダブルクリック)"],["{{レイヤーをハイライト}}","レイヤーをハイライト"],["{{レイヤーを非表示}}","レイヤーを非表示"],["{{レイヤーをロック}}","レイヤーをロック"],["{{カーブポインター(ダブルクリックでON/OFF)}}","カーブポインター(ダブルクリックでON/OFF)"],["{{インスタンス名}}","インスタンス名"],["{{ライブラリ内の検索}}","ライブラリ内の検索"],["{{フレームラベル}}","フレームラベル"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？"]])}}class o extends t{createMapping(){return new Map([["{{左上}}","왼쪽 상단"],["{{中央上}}","상단 중앙"],["{{右上}}","오른쪽 상단"],["{{中央左}}","중앙 왼쪽"],["{{中央}}","센터"],["{{中央右}}","중앙 오른쪽"],["{{左下}}","왼쪽 하단"],["{{中央下}}","하단 중앙"],["{{右下}}","오른쪽 하단"],["{{中心点のX座標}}","중심점의 X 좌표"],["{{中心点のY座標}}","중심점의 Y 좌표"],["{{MovieClipに変換}}","MovieClip로 변환"],["{{変換}}","변환"],["{{ループ回数}}","루프 횟수"],["{{カーブポインターの削除}}","곡선 테이블의"],["{{ステージ基準}}","스테이지 기준"],["{{閉じる}}","닫다"],["{{保存}}","저장"],["{{リセット}}","리셋"],["{{スクリーン}}","스크린"],["{{ショートカット設定}}","바로 가기 설정"],["{{レイヤーカラー}}","레이어 색상"],["{{Next2Dを支援する}}","Next2D 지원"],["{{サポート}}","지원"],["{{未使用のアイテムを削除}}","사용하지 않는 항목 삭제"],["{{レイヤーをペースト}}","레이어 붙여넣기"],["{{レイヤーをコピー}}","레이어 복사"],["{{フレームをペースト}}","프레임을 붙여넣기"],["{{フレームをコピー}}","프레임 복사"],["{{キーフレームを削除}}","키프레임 삭제"],["{{キーフレームに空のキーフレームを追加できません}}","키프레임에 빈 키프레임을 추가할 수 없음"],["{{ズームツール}}","줌 도구"],["{{タイムライン幅の拡大・縮小}}","타임라인 폭 확대·축소"],["{{ガイドレイヤー}}","가이드레이야"],["{{音量設定}}","볼륨 설정"],["{{サウンドを削除}}","사운드 삭제"],["{{カスタムループ}}","맞춤형 루프"],["{{読込のみ}}","로드 전용"],["{{書込を許可}}","쓰기 허용"],["{{単一行}}","단일 행"],["{{複数行}}","여러 줄"],["{{自動で折り返し}}","자동으로 되감기"],["{{左寄せ}}","왼쪽"],["{{中央揃え}}","센터"],["{{右寄せ}}","권리"],["{{放射状グラデーション}}","방사형 그라데이션"],["{{線形グラデーション}}","선형 그라데이션"],["{{画像}}","이미지"],["{{画像選択}}","이미지 선택"],["{{種別}}","종별"],["{{Shapeの色設定}}","Shape 색상 설정"],["{{変形}}","변형"],["{{カラー効果}}","색상 변환"],["{{フィルター}}","필터"],["{{Shapeを複製}}","Shape 복제"],["{{読み込み}}","로딩"],["{{新規フォルダー}}","새 폴더"],["{{新規MovieClip}}","새로운 MovieClip"],["{{枠に合わせてテキストをリサイズ}}","프레임에 맞게 텍스트를 크기 조정"],["{{テキストに合わせて枠をリサイズ}}","텍스트에 맞게 프레임을 크기 조정"],["{{リサイズしない}}","크기 조정하지 않음"],["{{フォント}}","글꼴"],["{{テキスト}}","텍스트"],["{{ループ}}","루프"],["{{音量}}","볼륨"],["{{ビデオ}}","동영상"],["{{イージング}}","부드럽게"],["{{サウンド}}","소리"],["{{シンボル}}","상징"],["{{名前}}","이름"],["{{オブジェクト}}","개체"],["{{ステージ設定}}","스테이지 설정"],["{{プレビュー}}","미리보기"],["{{削除}}","삭제"],["{{ペースト}}","붙여넣기"],["{{コピー}}","복사"],["{{プラグインメニュー}}","플러그인 메뉴"],["{{トゥイーン}}","트윈"],["{{カーブポインターの追加}}","커브 포인터 추가"],["{{パスの結合}}","경로 결합"],["{{シェイプ}}","모양"],["{{キーフレームに配分}}","키프레임에 할당"],["{{レイヤーに配分}}","레이어에 배포"],["{{タイムライン}}","타임라인"],["{{整列}}","맞추다"],["{{最背面}}","최후면"],["{{ひとつ背面へ}}","하나의 뒷면으로"],["{{ひとつ前面へ}}","하나 앞으로"],["{{最前面}}","최전면"],["{{重ね順}}","겹침 순서"],["{{プラグイン}}","플러그인"],["{{ライブラリ}}","도서관"],["{{プロパティ}}","속성"],["{{マスクレイヤー}}","마스크 레이어"],["{{通常レイヤー}}","일반 레이어"],["{{モーショントゥイーンの削除}}","모션 트윈 삭제"],["{{モーショントゥイーンの追加}}","모션 트윈 추가"],["{{モーダル表示}}","모달 표시"],["{{言語}}","언어"],["{{フォーマット}}","형식"],["{{含める}}","포함"],["{{含めない}}","포함하지 않음"],["{{使い方、リファレンス}}","사용법, 참조"],["{{非表示レイヤー}}","숨겨진 레이어"],["{{設定}}","설정"],["{{デフォルトのループを利用する}}","기본 루프 사용"],["{{フレームピッカー}}","프레임 선택기"],["{{ステージ左揃え}}","스테이지 왼쪽 정렬"],["{{ステージ中央揃え(水平方向)}}","스테이지 중앙 정렬(수평 방향)"],["{{ステージ右揃え}}","스테이지 오른쪽 정렬"],["{{ステージ上揃え}}","무대에서 정렬"],["{{ステージ中央揃え(垂直方向)}}","스테이지 중앙 정렬(수직 방향)"],["{{ステージ下揃え}}","무대 아래 정렬"],["{{左揃え}}","왼쪽 정렬"],["{{中央揃え(水平方向)}}","중앙 정렬(수평 방향)"],["{{右揃え}}","오른쪽 정렬"],["{{上揃え}}","상단 정렬"],["{{中央揃え(垂直方向)}}","중앙 정렬(수직 방향)"],["{{下揃え}}","아래 정렬"],["{{開始フレーム}}","시작 프레임"],["{{終了フレーム}}","종료 프레임"],["{{ループで再生}}","루프로 재생"],["{{1回再生}}","한 번 재생"],["{{指定したフレームで固定}}","지정된 프레임으로 고정"],["{{1回逆再生}}","1회 역재생"],["{{逆ループで再生}}","역 루프로 재생"],["{{画面の拡大・縮小}}","화면 확대/축소"],["{{カスタムイージングデータを保存}}","맞춤형 여유 데이터 저장"],["{{カスタムイージングデータの読込}}","사용자 정의 여유 데이터 읽기"],["{{プレビューのON/OFF}}","프레뷰의 ON/OFF"],["{{フォント枠サイズ}}","글꼴 프레임 크기"],["{{フォント枠カラー}}","글꼴 프레임 색상"],["{{オニオンスキン}}","양파 껍질"],["{{バケツツール}}","버킷 도구"],["{{ペンツール}}","펜 도구"],["{{ダブルクリックでカーブポイントが追加されます}}","곡선 점을 추가하려면 두 번 클릭"],["{{選択ツール}}","선택 도구"],["{{Shape変形ツール}}","모양 변형 도구"],["{{テキストツール}}","텍스트 도구"],["{{矩形ツール}}","너무 직사각형"],["{{楕円ツール}}","타원 도구"],["{{角丸矩形ツール}}","둥근 사각형 도구"],["{{塗りのカラー}}","채우기 색상"],["{{線のカラー}}","획 색상"],["{{線の太さ}}","획 폭"],["{{プロジェクトデータの読込}}","프로젝트 데이터 로드"],["{{プロジェクトデータを保存}}","프로젝트 데이터 저장"],["{{書き出し}}","내 보내다"],["{{Discordへ移動}}","불화로 이동"],["{{バグ報告}}","버그 보고서"],["{{設定}}","환경"],["{{タブを追加}}","탭 추가"],["{{タブの一覧を表示・移動}}","탭 목록 보기 및 이동"],["{{スクリプトを追加}}","스크립트 추가"],["{{キーフレームを追加}}","키프레임 추가"],["{{空のキーフレームを追加}}","빈 키프레임 추가"],["{{フレームを追加}}","프레임 추가"],["{{フレームを削除}}","프레임 삭제"],["{{再生}}","놀다"],["{{停止}}","중지"],["{{ループ設定}}","루프 설정"],["{{レイヤーを追加}}","레이어 추가"],["{{レイヤーを削除}}","레이어 삭제"],["{{全てのレイヤーをハイライト}}","모든 레이어 강조 표시"],["{{全てのレイヤーを非表示}}","모든 레이어 숨기기"],["{{全てのレイヤーをロック}}","모든 레이어 잠금"],["{{比率を固定}}","고정 비율"],["{{ステージの幅}}","무대 폭"],["{{背景色}}","배경색"],["{{ステージの高さ}}","무대 높이"],["{{フレームレート}}","프레임 속도"],["{{シンボル名}}","기호 이름"],["{{イージング設定}}","이징 설정"],["{{ビデオの音量設定}}","비디오 볼륨 설정"],["{{自動再生}}","자동 재생"],["{{テキストエリアのボーダー設定}}","텍스트 영역 테두리 설정"],["{{テキスト入力設定}}","텍스트 입력 설정"],["{{フォント選択}}","글꼴 선택"],["{{自動サイズ調整}}","자동 크기 조정"],["{{フォントスタイルタイプ}}","글꼴 스타일 유형"],["{{行揃え}}","맞추다"],["{{改行設定}}","개행 설정"],["{{スクロール設定}}","스크롤 설정"],["{{フォントサイズ}}","글꼴 크기"],["{{フォントカラー}}","글꼴 색상"],["{{行間}}","줄 간격"],["{{文字幅}}","문자 너비"],["{{左マージン}}","왼쪽 여백"],["{{右マージン}}","오른쪽 여백"],["{{カラー種別の選択}}","색상 유형 선택"],["{{背景画像の選択}}","배경 이미지 선택"],["{{カラーポインターを追加}}","색상 포인터 추가"],["{{カラー値}}","색상"],["{{アルファ(0%-100%)}}","알파(0%-100%)"],["{{アルファ値}}","알파"],["{{選択対象の幅}}","선택 개체의 너비"],["{{選択対象のX座標}}","선택 객체의 X 좌표"],["{{選択対象の高さ}}","선택 개체의 높이"],["{{選択対象のY座標}}","선택 객체의 Y 좌표"],["{{選択対象の幅の伸縮}}","선택한 객체의 scaleX"],["{{選択対象を回転}}","개체 회전"],["{{選択対象の高さの伸縮}}","선택한 객체의 scaleY"],["{{アルファオフセット(-255〜255)}}","알파 오프셋(-255〜255)"],["{{赤(0%-100%)}}","빨간색(0%-100%)"],["{{赤オフセット(-255〜255)}}","레드 오프셋(-255〜255)"],["{{緑(0%-100%)}}","녹색(0%-100%)"],["{{緑オフセット(-255〜255)}}","그린 오프셋(-255〜255)"],["{{青(0%-100%)}}","파란색(0%-100%)"],["{{青オフセット(-255〜255)}}","블루 오프셋(-255〜255)"],["{{ブレンドモード}}","혼합 모드"],["{{フィルターを選択}}","필터 선택"],["{{フィルターを追加}}","필터 추가"],["{{サウンドを追加}}","소리 추가"],["{{フィルターを表示・非表示する}}","필터 표시 및 숨기기"],["{{フィルターを削除}}","필터 삭제"],["{{水平方向にぼかす}}","수평으로 흐림"],["{{垂直方向にぼかす}}","수직으로 흐림"],["{{フィルター強度}}","필터 강도"],["{{フィルター角度}}","필터 각도"],["{{シャドウのアルファ}}","섀도우 알파"],["{{シャドウのカラー}}","그림자 색상"],["{{フィルター距離}}","필터 거리"],["{{ハイライトのカラー}}","하이라이트 색상"],["{{ハイライトのアルファ}}","하이라이트 알파"],["{{グラデーションカラー}}","그라데이션 색상"],["{{グラデーションのアルファ}}","그라디언트 알파"],["{{タブの移動・名前を変更}}","탭 이동/이름 바꾸기"],["{{プロジェクトを閉じる}}","프로젝트 닫기"],["{{上下に移動}}","위아래로 이동"],["{{レイヤー変更(ダブルクリック)}}","레이어 변경(더블 클릭)"],["{{レイヤーをハイライト}}","하이라이트 레이어"],["{{レイヤーを非表示}}","레이어 숨기기"],["{{レイヤーをロック}}","레이어 잠금"],["{{カーブポインター(ダブルクリックでON/OFF)}}","곡선 포인터(켜기/끄려면 두 번 클릭)"],["{{インスタンス名}}","인스턴스 이름"],["{{ライブラリ内の検索}}","도서관에서 검색"],["{{フレームラベル}}","프레임 라벨"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","프로젝트를 저장하지 않으면 이 탭의 프로젝트 데이터를 복구할 수 없습니다. 탭을 삭제하시겠습니까?"]])}}class l extends t{createMapping(){return new Map([["{{左上}}","Вверху слева"],["{{中央上}}","Вверху по центру"],["{{右上}}","Верхний правый"],["{{中央左}}","Центр Левый"],["{{中央}}","Центр"],["{{中央右}}","Центр Правый"],["{{左下}}","Низ Левый"],["{{中央下}}","Нижняя часть Центр"],["{{右下}}","Дно справа"],["{{中心点のX座標}}","X-координата центральной точки"],["{{中心点のY座標}}","Y-координата центральной точки"],["{{MovieClipに変換}}","Конвертировать в MovieClip"],["{{変換}}","трансформация"],["{{ループ回数}}","Количество циклов"],["{{カーブポインターの削除}}","Удалить указатель кривой"],["{{ステージ基準}}","Критерии этапа"],["{{閉じる}}","Закрыть"],["{{保存}}","Сохранить"],["{{リセット}}","сброс"],["{{スクリーン}}","Экран"],["{{ショートカット設定}}","Настройки ярлыков"],["{{レイヤーカラー}}","слоистый цвет"],["{{Next2Dを支援する}}","Поддержите Next2D"],["{{サポート}}","поддержка"],["{{未使用のアイテムを削除}}","Удалите неиспользуемые предметы"],["{{レイヤーをペースト}}","Слой пасты"],["{{レイヤーをコピー}}","Копирование слоя"],["{{フレームをペースト}}","Вставить рамку"],["{{フレームをコピー}}","Копировальная рама"],["{{キーフレームを削除}}","Удалить ключевые кадры"],["{{キーフレームに空のキーフレームを追加できません}}","Невозможно добавить пустые ключевые кадры в ключевые кадры"],["{{ズームツール}}","Инструмент масштабирования"],["{{タイムライン幅の拡大・縮小}}","Ширина временной шкалы Расширение/сокращение"],["{{ガイドレイヤー}}","направляющий слой"],["{{音量設定}}","Настройка громкости"],["{{サウンドを削除}}","Удалить звук"],["{{カスタムループ}}","индивидуальная петля"],["{{読込のみ}}","Только чтение"],["{{書込を許可}}","разрешение на публикацию"],["{{単一行}}","Одиночная линия"],["{{複数行}}","Многолинейный"],["{{自動で折り返し}}","Автоматический обхват"],["{{左寄せ}}","Слева"],["{{中央揃え}}","Центр"],["{{右寄せ}}","Правый"],["{{放射状グラデーション}}","радиальная градация"],["{{線形グラデーション}}","линейный градиент"],["{{画像}}","Изображение"],["{{画像選択}}","Выбор изображения"],["{{種別}}","Тип"],["{{Shapeの色設定}}","Настройки цвета формы"],["{{変形}}","деформация"],["{{カラー効果}}","Трансформация цвета"],["{{フィルター}}","фильтр"],["{{Shapeを複製}}","Дублировать форму"],["{{読み込み}}","читать в"],["{{新規フォルダー}}","Новая папка"],["{{新規MovieClip}}","Новый MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Измените размер текста, чтобы он поместился в рамку"],["{{テキストに合わせて枠をリサイズ}}","Измените размер рамки, чтобы вместить текст"],["{{リサイズしない}}","Отсутствие изменения размера"],["{{フォント}}","шрифт"],["{{テキスト}}","Текст"],["{{ループ}}","петля"],["{{音量}}","громкость"],["{{ビデオ}}","Видео"],["{{イージング}}","облегчение"],["{{サウンド}}","звук"],["{{シンボル}}","Символ"],["{{名前}}","Имя"],["{{オブジェクト}}","объект"],["{{ステージ設定}}","Постановка сцены"],["{{プレビュー}}","Предварительный просмотр"],["{{削除}}","Удалить"],["{{ペースト}}","Паста"],["{{コピー}}","Копировать"],["{{プラグインメニュー}}","Меню подключаемых модулей"],["{{トゥイーン}}","между"],["{{カーブポインターの追加}}","Дополнительный указатель кривой"],["{{パスの結合}}","Объединение путей"],["{{シェイプ}}","форма"],["{{キーフレームに配分}}","Распределение по ключевым кадрам"],["{{レイヤーに配分}}","Распределение по слоям"],["{{タイムライン}}","временная шкала"],["{{整列}}","Выровнять"],["{{最背面}}","Большая часть спины"],["{{ひとつ背面へ}}","Один в задней части"],["{{ひとつ前面へ}}","Один фронт"],["{{最前面}}","На переднем крае"],["{{重ね順}}","Организуйте"],["{{プラグイン}}","плагин"],["{{ライブラリ}}","библиотека"],["{{プロパティ}}","собственность"],["{{マスクレイヤー}}","слой маски"],["{{通常レイヤー}}","Нормальный слой"],["{{モーショントゥイーンの削除}}","Удаление твинов движения"],["{{モーショントゥイーンの追加}}","Дополнительные твины движения"],["{{モーダル表示}}","модальная индикация"],["{{言語}}","Язык"],["{{フォーマット}}","формат"],["{{含める}}","включать"],["{{含めない}}","не включать"],["{{使い方、リファレンス}}","Использование, ссылка"],["{{非表示レイヤー}}","скрытый слой"],["{{設定}}","настройка"],["{{デフォルトのループを利用する}}","Используйте цикл по умолчанию"],["{{フレームピッカー}}","подборщик рам"],["{{ステージ左揃え}}","Выровнять сцену слева"],["{{ステージ中央揃え(水平方向)}}","Выровняйте центр сцены (горизонтально)"],["{{ステージ右揃え}}","Выровнять сцену вправо"],["{{ステージ上揃え}}","Выровнять сцену вверх"],["{{ステージ中央揃え(垂直方向)}}","Выровняйте центр сцены (вертикально)"],["{{ステージ下揃え}}","Выровнять дно сцены"],["{{左揃え}}","Слева"],["{{中央揃え(水平方向)}}","Центр (горизонтальность)"],["{{右揃え}}","Справа"],["{{上揃え}}","Топ"],["{{中央揃え(垂直方向)}}","Центр (вертикальный)"],["{{下揃え}}","Дно"],["{{開始フレーム}}","начальная рамка"],["{{終了フレーム}}","торцевая рама"],["{{ループで再生}}","Воспроизведение по кругу"],["{{1回再生}}","1 воспроизведение"],["{{指定したフレームで固定}}","Фиксируется в указанном кадре"],["{{1回逆再生}}","1 воспроизведение в обратном направлении"],["{{逆ループで再生}}","Воспроизведение в обратном цикле"],["{{画面の拡大・縮小}}","Увеличение и уменьшение масштаба экрана"],["{{カスタムイージングデータを保存}}","Сохраните данные пользовательского смягчения"],["{{カスタムイージングデータの読込}}","Чтение пользовательских данных о смягчении"],["{{プレビューのON/OFF}}","Включение/выключение предварительного просмотра"],["{{フォント枠サイズ}}","Размер рамки шрифта"],["{{フォント枠カラー}}","Цвет шрифтовой рамки"],["{{オニオンスキン}}","Луковая шкурка"],["{{バケツツール}}","Ведерные инструменты"],["{{ペンツール}}",'Инструмент "Перо'],["{{ダブルクリックでカーブポイントが追加されます}}","Дважды щелкните, чтобы добавить точку кривой"],["{{選択ツール}}","Инструменты выбора"],["{{Shape変形ツール}}","Инструмент преобразования формы"],["{{テキストツール}}","Текстовый инструмент"],["{{矩形ツール}}",'Инструмент "Прямоугольник'],["{{楕円ツール}}",'Инструмент "Эллипс'],["{{角丸矩形ツール}}",'Инструмент "Скругленный прямоугольник'],["{{塗りのカラー}}","Цвет заливки"],["{{線のカラー}}","Цвет штриха"],["{{線の太さ}}","Ширина штриха"],["{{プロジェクトデータの読込}}","Загрузка данных проекта"],["{{プロジェクトデータを保存}}","Сохранить данные проекта"],["{{書き出し}}","Экспорт"],["{{Discordへ移動}}","Зайдите в дискорд"],["{{バグ報告}}","Сообщения об ошибках"],["{{設定}}","Настройка"],["{{タブを追加}}","Добавить вкладку"],["{{タブの一覧を表示・移動}}","Просмотр и перемещение по списку вкладок"],["{{スクリプトを追加}}","Добавить сценарий"],["{{キーフレームを追加}}","Добавить ключевой кадр"],["{{空のキーフレームを追加}}","Добавьте пустой ключевой кадр"],["{{フレームを追加}}","Добавить рамку"],["{{フレームを削除}}","Удалить рамку"],["{{再生}}","Играть"],["{{停止}}","Остановить"],["{{ループ設定}}","Настройка контура"],["{{レイヤーを追加}}","Добавить слой"],["{{レイヤーを削除}}","Удалить слой"],["{{全てのレイヤーをハイライト}}","Выделите все слои"],["{{全てのレイヤーを非表示}}","Скрыть все слои"],["{{全てのレイヤーをロック}}","Заблокируйте все слои"],["{{比率を固定}}","Фиксированный коэффициент"],["{{ステージの幅}}","Ширина сцены"],["{{背景色}}","Цвет фона"],["{{ステージの高さ}}","Высота сцены"],["{{フレームレート}}","Частота кадров"],["{{シンボル名}}","Название символа"],["{{イージング設定}}","Установка облегчения"],["{{ビデオの音量設定}}","Настройка громкости видео"],["{{自動再生}}","Автоматическое воспроизведение"],["{{テキストエリアのボーダー設定}}","Настройка границ текстовой области"],["{{テキスト入力設定}}","Настройка ввода текста"],["{{フォント選択}}","Выбор шрифта"],["{{自動サイズ調整}}","Автоматическая регулировка размера"],["{{フォントスタイルタイプ}}","Тип стиля шрифта"],["{{行揃え}}","Выровнять"],["{{改行設定}}","Установка новой строки"],["{{スクロール設定}}","Настройка прокрутки"],["{{フォントサイズ}}","Размер шрифта"],["{{フォントカラー}}","Цвет шрифта"],["{{行間}}","Пространство линии"],["{{文字幅}}","Ширина символа"],["{{左マージン}}","Левое поле"],["{{右マージン}}","Правая граница"],["{{カラー種別の選択}}","Выберите тип цвета"],["{{背景画像の選択}}","Выбор фонового изображения"],["{{カラーポインターを追加}}","Добавьте указатели цвета"],["{{カラー値}}","Цвет"],["{{アルファ(0%-100%)}}","Альфа(0%-100%)"],["{{アルファ値}}","Альфа"],["{{選択対象の幅}}","Ширина объекта выделения"],["{{選択対象のX座標}}","X координата объекта выделения"],["{{選択対象の高さ}}","Высота объекта выделения"],["{{選択対象のY座標}}","Y координата объекта выделения"],["{{選択対象の幅の伸縮}}","масштабX выбранного объекта"],["{{選択対象を回転}}","Повернуть объект"],["{{選択対象の高さの伸縮}}","scaleY выбранного объекта"],["{{アルファオフセット(-255〜255)}}","Альфа-смещение(-255〜255)"],["{{赤(0%-100%)}}","Красный(0%-100%)"],["{{赤オフセット(-255〜255)}}","Красное смещение(-255〜255)"],["{{緑(0%-100%)}}","Зеленый(0%-100%)"],["{{緑オフセット(-255〜255)}}","Зеленый зачет(-255〜255)"],["{{青(0%-100%)}}","Голубой(0%-100%)"],["{{青オフセット(-255〜255)}}","Синее смещение(-255〜255)"],["{{ブレンドモード}}","Режим наложения"],["{{フィルターを選択}}","Выберите фильтр"],["{{フィルターを追加}}","Добавить фильтр"],["{{サウンドを追加}}","Добавить звук"],["{{フィルターを表示・非表示する}}","Показать и скрыть фильтры"],["{{フィルターを削除}}","Удалить фильтр"],["{{水平方向にぼかす}}","Размытие по горизонтали"],["{{垂直方向にぼかす}}","Размытие по вертикали"],["{{フィルター強度}}","Прочность фильтра"],["{{フィルター角度}}","Угол фильтрации"],["{{シャドウのアルファ}}","Тень Альфа"],["{{シャドウのカラー}}","Цвет теней"],["{{フィルター距離}}","Расстояние между фильтрами"],["{{ハイライトのカラー}}","Цвет подсветки"],["{{ハイライトのアルファ}}","Выделение Альфа"],["{{グラデーションカラー}}","Цвет градиента"],["{{グラデーションのアルファ}}","Градиент Альфа"],["{{タブの移動・名前を変更}}","Переместить/именовать вкладки"],["{{プロジェクトを閉じる}}","Закрыть проект"],["{{上下に移動}}","Двигайтесь вверх и вниз"],["{{レイヤー変更(ダブルクリック)}}","Смена слоя (двойной щелчок)"],["{{レイヤーをハイライト}}","Выделительный слой"],["{{レイヤーを非表示}}","Скрыть слой"],["{{レイヤーをロック}}","Заблокировать слой"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Указатель кривой (двойной щелчок для включения/выключения)"],["{{インスタンス名}}","Имя экземпляра"],["{{ライブラリ内の検索}}","Поиск в библиотеке"],["{{フレームラベル}}","Рамочная этикетка"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Если проект не сохранен, данные проекта на этой вкладке не могут быть восстановлены. Вы хотите удалить вкладку?"]])}}class c extends t{createMapping(){return new Map([["{{左上}}","Arriba a la izquierda"],["{{中央上}}","Centro superior"],["{{右上}}","Arriba Derecha"],["{{中央左}}","Centro Izquierda"],["{{中央}}","Centro"],["{{中央右}}","Centro derecha"],["{{左下}}","Abajo a la izquierda"],["{{中央下}}","Abajo Centro"],["{{右下}}","Abajo a la derecha"],["{{中心点のX座標}}","Coordenada X del punto central"],["{{中心点のY座標}}","Coordenada Y del punto central"],["{{MovieClipに変換}}","Convertir a MovieClip"],["{{変換}}","transformación"],["{{ループ回数}}","Recuento de bucles"],["{{カーブポインターの削除}}","Borrar el puntero de la curva"],["{{ステージ基準}}","Criterios de la etapa"],["{{閉じる}}","Cerrar"],["{{保存}}","Guardar"],["{{リセット}}","restablecer"],["{{スクリーン}}","Pantalla"],["{{ショートカット設定}}","Configuración de los accesos directos"],["{{レイヤーカラー}}","color en capas"],["{{Next2Dを支援する}}","Apoya a Next2D"],["{{サポート}}","soporte"],["{{未使用のアイテムを削除}}","Eliminar los elementos no utilizados"],["{{レイヤーをペースト}}","Capa de pasta"],["{{レイヤーをコピー}}","Copiar capa"],["{{フレームをペースト}}","Pegar el marco"],["{{フレームをコピー}}","Copiar marco"],["{{キーフレームを削除}}","Eliminar fotogramas clave"],["{{キーフレームに空のキーフレームを追加できません}}","No se pueden añadir fotogramas clave vacíos a los fotogramas clave"],["{{ズームツール}}","Herramienta de zoom"],["{{タイムライン幅の拡大・縮小}}","Anchura de la línea de tiempo Ampliar/reducir"],["{{ガイドレイヤー}}","capa de guía"],["{{音量設定}}","Ajuste del volumen"],["{{サウンドを削除}}","Eliminar el sonido"],["{{カスタムループ}}","bucle personalizado"],["{{読込のみ}}","Sólo para leer"],["{{書込を許可}}","permiso de correos"],["{{単一行}}","Línea única"],["{{複数行}}","Multilínea"],["{{自動で折り返し}}","Envoltura automática"],["{{左寄せ}}","Izquierda"],["{{中央揃え}}","Centro"],["{{右寄せ}}","Derecha"],["{{放射状グラデーション}}","gradación radial"],["{{線形グラデーション}}","gradiente lineal"],["{{画像}}","Imagen"],["{{画像選択}}","Selección de imágenes"],["{{種別}}","Tipo"],["{{Shapeの色設定}}","Configuración del color de la forma"],["{{変形}}","deformación"],["{{カラー効果}}","Transformación del color"],["{{フィルター}}","filtro"],["{{Shapeを複製}}","Duplicar la forma"],["{{読み込み}}","leer en"],["{{新規フォルダー}}","Carpeta nueva"],["{{新規MovieClip}}","Nuevo MovieClip"],["{{枠に合わせてテキストをリサイズ}}","Cambia el tamaño del texto para que se ajuste al marco"],["{{テキストに合わせて枠をリサイズ}}","Cambia el tamaño del marco para que se ajuste al texto"],["{{リサイズしない}}","No hay cambio de tamaño"],["{{フォント}}","fuente"],["{{テキスト}}","Texto"],["{{ループ}}","bucle"],["{{音量}}","volumen"],["{{ビデオ}}","Vídeo"],["{{イージング}}","facilitando"],["{{サウンド}}","sonido"],["{{シンボル}}","Símbolo"],["{{名前}}","Nombre"],["{{オブジェクト}}","objeto"],["{{ステージ設定}}","Puesta en escena"],["{{プレビュー}}","Previsualización"],["{{削除}}","Borrar"],["{{ペースト}}","Pegar"],["{{コピー}}","Copiar"],["{{プラグインメニュー}}","Menú de complementos"],["{{トゥイーン}}","tween"],["{{カーブポインターの追加}}","Puntero de curva adicional"],["{{パスの結合}}","Fusión de caminos"],["{{シェイプ}}","forma"],["{{キーフレームに配分}}","Asignación a los fotogramas clave"],["{{レイヤーに配分}}","Asignación a las capas"],["{{タイムライン}}","línea de tiempo"],["{{整列}}","Alinear"],["{{最背面}}","La mayor parte de la espalda"],["{{ひとつ背面へ}}","Uno en la parte trasera"],["{{ひとつ前面へ}}","Un frente"],["{{最前面}}","Frontmost"],["{{重ね順}}","Organice"],["{{プラグイン}}","plug-in"],["{{ライブラリ}}","biblioteca"],["{{プロパティ}}","propiedad"],["{{マスクレイヤー}}","capa de máscara"],["{{通常レイヤー}}","Capa normal"],["{{モーショントゥイーンの削除}}","Supresión de los tweens de movimiento"],["{{モーショントゥイーンの追加}}","Tweens de movimiento adicionales"],["{{モーダル表示}}","indicación modal"],["{{言語}}","El idioma"],["{{フォーマット}}","formato"],["{{含める}}","incluir"],["{{含めない}}","no incluir"],["{{使い方、リファレンス}}","Uso, referencia"],["{{非表示レイヤー}}","capa oculta"],["{{設定}}","configuración"],["{{デフォルトのループを利用する}}","Utiliza el bucle por defecto"],["{{フレームピッカー}}","Recogedor de marcos"],["{{ステージ左揃え}}","Alinear el escenario a la izquierda"],["{{ステージ中央揃え(水平方向)}}","Alinear el centro del escenario (horizontal)"],["{{ステージ右揃え}}","Alinear el escenario a la derecha"],["{{ステージ上揃え}}","Alinear el escenario hacia arriba"],["{{ステージ中央揃え(垂直方向)}}","Alinear el centro del escenario (vertical)"],["{{ステージ下揃え}}","Alinear el fondo del escenario"],["{{左揃え}}","Izquierda"],["{{中央揃え(水平方向)}}","Centro (Horizontal)"],["{{右揃え}}","Derecho"],["{{上揃え}}","Arriba"],["{{中央揃え(垂直方向)}}","Centro (Vertical)"],["{{下揃え}}","Fondo"],["{{開始フレーム}}","marco de inicio"],["{{終了フレーム}}","marco final"],["{{ループで再生}}","Reproducir en bucle"],["{{1回再生}}","1 reproducción"],["{{指定したフレームで固定}}","Fijado en el marco especificado"],["{{1回逆再生}}","1 reproducción inversa"],["{{逆ループで再生}}","Reproducción en bucle invertido"],["{{画面の拡大・縮小}}","Acercar y alejar la pantalla"],["{{カスタムイージングデータを保存}}","Guarda los datos de la flexión personalizada"],["{{カスタムイージングデータの読込}}","Lectura de datos de flexibilización personalizados"],["{{プレビューのON/OFF}}","Activación/desactivación de la vista previa"],["{{フォント枠サイズ}}","Tamaño del marco de la fuente"],["{{フォント枠カラー}}","Color del marco de la fuente"],["{{オニオンスキン}}","Piel de cebolla"],["{{バケツツール}}","Herramientas para cubos"],["{{ペンツール}}","Herramienta de la pluma"],["{{ダブルクリックでカーブポイントが追加されます}}","Haga doble clic para añadir un punto de curva"],["{{選択ツール}}","Herramientas de selección"],["{{Shape変形ツール}}","Herramienta de transformación de formas"],["{{テキストツール}}","Herramienta de texto"],["{{矩形ツール}}","Herramienta Rectángulo"],["{{楕円ツール}}","Herramienta Elipse"],["{{角丸矩形ツール}}","Herramienta Rectángulo Redondeado"],["{{塗りのカラー}}","Color de relleno"],["{{線のカラー}}","Color del trazo"],["{{線の太さ}}","Anchura de la carrera"],["{{プロジェクトデータの読込}}","Carga de los datos del proyecto"],["{{プロジェクトデータを保存}}","Guardar los datos del proyecto"],["{{書き出し}}","Exportar"],["{{Discordへ移動}}","Ir a la discordia"],["{{バグ報告}}","Informes de errores"],["{{設定}}","Configuración"],["{{タブを追加}}","Añadir una pestaña"],["{{タブの一覧を表示・移動}}","Ver y desplazarse por la lista de pestañas"],["{{スクリプトを追加}}","Añadir una secuencia de comandos"],["{{キーフレームを追加}}","Añadir un fotograma clave"],["{{空のキーフレームを追加}}","Añadir un fotograma clave vacío"],["{{フレームを追加}}","Añadir un marco"],["{{フレームを削除}}","Borrar el marco"],["{{再生}}","Juega a"],["{{停止}}","Detener"],["{{ループ設定}}","Ajuste del bucle"],["{{レイヤーを追加}}","Añadir una capa"],["{{レイヤーを削除}}","Eliminar la capa"],["{{全てのレイヤーをハイライト}}","Resaltar todas las capas"],["{{全てのレイヤーを非表示}}","Ocultar todas las capas"],["{{全てのレイヤーをロック}}","Bloquear todas las capas"],["{{比率を固定}}","Relación fija"],["{{ステージの幅}}","Anchura del escenario"],["{{背景色}}","Color de fondo"],["{{ステージの高さ}}","Altura del escenario"],["{{フレームレート}}","Velocidad de fotogramas"],["{{シンボル名}}","Nombre del símbolo"],["{{イージング設定}}","Ajuste de la flexibilización"],["{{ビデオの音量設定}}","Ajuste del volumen de vídeo"],["{{自動再生}}","Reproducción automática"],["{{テキストエリアのボーダー設定}}","Configuración del borde del área de texto"],["{{テキスト入力設定}}","Ajuste de la entrada de texto"],["{{フォント選択}}","Selección de fuentes"],["{{自動サイズ調整}}","Ajuste automático del tamaño"],["{{フォントスタイルタイプ}}","Tipo de letra"],["{{行揃え}}","Alinear"],["{{改行設定}}","Ajuste de la nueva línea"],["{{スクロール設定}}","Ajuste de desplazamiento"],["{{フォントサイズ}}","Tamaño de la fuente"],["{{フォントカラー}}","Color de la fuente"],["{{行間}}","Espacio de la línea"],["{{文字幅}}","Anchura de los caracteres"],["{{左マージン}}","Margen izquierdo"],["{{右マージン}}","Margen derecho"],["{{カラー種別の選択}}","Seleccione un tipo de color"],["{{背景画像の選択}}","Seleccionar una imagen de fondo"],["{{カラーポインターを追加}}","Añadir punteros de color"],["{{カラー値}}","Color"],["{{アルファ(0%-100%)}}","Alpha(0%-100%)"],["{{アルファ値}}","Alpha"],["{{選択対象の幅}}","Anchura del objeto de selección"],["{{選択対象のX座標}}","Coordenada X del objeto de selección"],["{{選択対象の高さ}}","Altura del objeto de selección"],["{{選択対象のY座標}}","Coordenada Y del objeto de selección"],["{{選択対象の幅の伸縮}}","scaleX del objeto seleccionado"],["{{選択対象を回転}}","Girar el objeto"],["{{選択対象の高さの伸縮}}","escalaY del objeto seleccionado"],["{{アルファオフセット(-255〜255)}}","Desplazamiento alfa(-255〜255)"],["{{赤(0%-100%)}}","Rojo(0%-100%)"],["{{赤オフセット(-255〜255)}}","Compensación roja(-255〜255)"],["{{緑(0%-100%)}}","Verde(0%-100%)"],["{{緑オフセット(-255〜255)}}","Compensación verde(-255〜255)"],["{{青(0%-100%)}}","Azul(0%-100%)"],["{{青オフセット(-255〜255)}}","Offset azul(-255〜255)"],["{{ブレンドモード}}","Modo de fusión"],["{{フィルターを選択}}","Seleccione un filtro"],["{{フィルターを追加}}","Añadir un filtro"],["{{サウンドを追加}}","Añadir un sonido"],["{{フィルターを表示・非表示する}}","Mostrar y ocultar filtros"],["{{フィルターを削除}}","Eliminar el filtro"],["{{水平方向にぼかす}}","Desenfoque horizontal"],["{{垂直方向にぼかす}}","Desenfoque vertical"],["{{フィルター強度}}","Fuerza del filtro"],["{{フィルター角度}}","Ángulo del filtro"],["{{シャドウのアルファ}}","Sombra Alfa"],["{{シャドウのカラー}}","Color de la sombra"],["{{フィルター距離}}","Distancia del filtro"],["{{ハイライトのカラー}}","Color de realce"],["{{ハイライトのアルファ}}","Resaltar Alpha"],["{{グラデーションカラー}}","Color degradado"],["{{グラデーションのアルファ}}","Gradiente Alfa"],["{{タブの移動・名前を変更}}","Mover/Renombrar pestañas"],["{{プロジェクトを閉じる}}","Cerrar el proyecto"],["{{上下に移動}}","Subir y bajar"],["{{レイヤー変更(ダブルクリック)}}","Cambio de capa (doble clic)"],["{{レイヤーをハイライト}}","Capa de resaltado"],["{{レイヤーを非表示}}","Ocultar capa"],["{{レイヤーをロック}}","Bloquear la capa"],["{{カーブポインター(ダブルクリックでON/OFF)}}","Puntero de curva (doble clic para activar/desactivar)"],["{{インスタンス名}}","Nombre de la instancia"],["{{ライブラリ内の検索}}","Buscar en la biblioteca"],["{{フレームラベル}}","Etiqueta del marco"],["{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}","Si el proyecto no se guarda, los datos del proyecto en esta pestaña no se pueden recuperar. ¿Desea eliminar la pestaña?"]])}}const d={VERSION:1,PREFIX:"__next2d-tools__",DATABASE_NAME:"save-data",STORE_KEY:"local",LAYER_MODE_NORMAL:0,LAYER_MODE_MASK:1,LAYER_MODE_MASK_IN:2,LAYER_MODE_GUIDE:3,LAYER_MODE_GUIDE_IN:4,REVISION_LIMIT:100,FOLDER_OPEN:"open",FOLDER_CLOSE:"close",DEFAULT_LOOP:5,$activeWorkSpaceId:0,$workSpaces:[],$readStatus:0,$readEnd:1,$shiftKey:!1,$ctrlKey:!1,$altKey:!1,$zoomScale:1,$currentFrame:1,$root:null};d.$Rad2Deg=180/Math.PI,d.$Deg2Rad=Math.PI/180,d.$keyLock=!1,d.$activeScript=!1,d.$previewMode=!1,d.$offsetLeft=0,d.$offsetTop=0,d.$currentCursor="auto",d.$useIds=new Map,d.$symbols=new Map,d.$copyWorkSpaceId=-1,d.$copyLibrary=null,d.$copyLayer=null,d.$copyCharacter=null,d.$canCopyLayer=!1,d.$canCopyCharacter=!1,d.$hitColor=null,d.$updated=!1,d.$languages=new Map,d.$currentLanguage=null,d.$shapePointerColor="#009900",d.$shapeLinkedPointerColor="#ffa500",d.$shortcut=new Map,d.$useShortcutSetting=!1;const h=window.navigator.userAgentData;h?h.getHighEntropyValues(["platform"]).then((e=>{d.$isMac=e.platform.indexOf("mac")>-1})):d.$isMac=window.navigator.userAgent.indexOf("Mac")>-1;const u=document.createElement("canvas");u.width=1,u.height=1,d.$hitContext=u.getContext("2d"),d.$transformTargets=["scale-top-left","scale-top-right","scale-bottom-left","scale-bottom-right","scale-center-left","scale-center-top","scale-center-right","scale-center-bottom","target-rect","target-rotation","reference-point"],d.$gridTargets=["grid-top-left","grid-top-right","grid-bottom-left","grid-bottom-right"],d.$emptyImage=new Image,d.$emptyImage.draggable=!1,d.$clamp=(e,t,a)=>{const r=+e;return Math.min(Math.max(t,isNaN(r)?0:r),a)},d.$generateShortcutKey=(e,t=null)=>{let a=1===e.length?e.toLowerCase():e;return t&&(t.shift&&(a+="Shift"),t.alt&&(a+="Alt"),t.ctrl&&(a+="Ctrl")),a},d.$isArray=e=>Array.isArray(e),d.$setCursor=(e="auto")=>{d.$currentCursor!==e&&(d.$currentCursor=e,document.documentElement.style.setProperty("--tool-cursor",e))},d.$addModalEvent=e=>{const t=e.querySelectorAll("[data-detail]");for(let e=0;e<t.length;++e){const a=t[e];a.addEventListener("mouseover",d.$fadeIn),a.addEventListener("mouseout",d.$fadeOut)}},d.$fadeIn=e=>{const t=d.$userSetting.getPublishSetting();if("modal"in t&&!t.modal)return;const a=e.currentTarget;let r=d.$currentLanguage.replace(a.dataset.detail),s=a.dataset.shortcutKey;if(s){const e=d.$shortcutSetting.viewMapping.get(a.dataset.area);r+=` (${e.has(s)?e.get(s).text:a.dataset.shortcutText})`}const i=document.getElementById("detail-modal");switch(i.textContent=r,!0){case i.clientWidth+e.pageX-20>window.innerWidth:i.style.left=e.pageX-(i.clientWidth+e.pageX+10-window.innerWidth)+"px";break;case 0>e.pageX-20:i.style.left="10px";break;default:i.style.left=e.pageX-20+"px"}if(!0==i.clientHeight+e.pageY+20>window.innerHeight)i.style.top=e.pageY-i.clientHeight-20+"px";else i.style.top=`${e.pageY+20}px`;i.setAttribute("class","fadeIn"),i.dataset.timerId=setTimeout((()=>{i.classList.contains("fadeOut")||i.setAttribute("class","fadeOut")}),1500)},d.$fadeOut=()=>{const e=d.$userSetting.getPublishSetting();if("modal"in e&&!e.modal)return;const t=document.getElementById("detail-modal");clearTimeout(0|t.dataset.timerId),t.setAttribute("class","fadeOut")},d.$endMenu=e=>{const t=["timeline-menu","library-menu","tab-name-menu","timeline-layer-menu","scene-name-menu","user-setting","screen-menu","editor-modal","plugin-modal","shortcut-setting-menu"];for(let a=0;a<t.length;++a){const r=t[a];if(r===e)continue;"editor-modal"===r&&d.$javaScriptEditor.active&&d.$javaScriptEditor.hide();const s=document.getElementById(r);s.classList.contains("fadeIn")&&s.setAttribute("class","fadeOut")}},d.$loadSaveData=()=>{const e=localStorage.getItem(`${d.PREFIX}@${d.DATABASE_NAME}`);if(e){localStorage.removeItem(`${d.PREFIX}@${d.DATABASE_NAME}`);const t=e.length,a=new Uint8Array(t);for(let r=0;r<t;++r)a[r]=255&e.charCodeAt(r);d.$unZlibWorker.postMessage({buffer:a,type:"local"},[a.buffer])}else{d.$launchDB().onsuccess=e=>{const t=e.target.result;t.transaction(`${d.DATABASE_NAME}`,"readonly").objectStore(`${d.DATABASE_NAME}`).get(d.STORE_KEY).onsuccess=e=>{const a=e.target.result;if(a){const e=a.length,t=new Uint8Array(e);for(let r=0;r<e;++r)t[r]=255&a.charCodeAt(r);d.$unZlibWorker.postMessage({buffer:t,type:"local"},[t.buffer])}else d.$workSpaces.push(new U),d.$screenTab.run(),d.$initializeEnd();t.close()}}}},d.$multiplicationMatrix=(e,t)=>new Float32Array([e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]),d.$setShortcut=(e,t)=>{d.$shortcut.set(e,t)},d.$deleteShortcut=e=>{d.$shortcut.has(e)&&d.$shortcut.delete(e)},d.$executeKeyCommand=e=>{if(d.$shiftKey=e.shiftKey,d.$ctrlKey=e.ctrlKey||e.metaKey,d.$altKey=e.altKey,d.$ctrlKey)switch(e.key){case"-":case"+":case";":e.stopPropagation(),e.preventDefault()}if(d.$keyLock)return;if(d.$useShortcutSetting)return e.stopPropagation(),void e.preventDefault();const t=d.$generateShortcutKey(e.key,{alt:d.$altKey,shift:d.$shiftKey,ctrl:d.$ctrlKey});d.$shortcut.has(t)&&(e.stopPropagation(),e.preventDefault(),d.$shortcut.get(t)(e))},d.$initialize=()=>{window.removeEventListener("DOMContentLoaded",d.$initialize),d.$filterClasses={BevelFilter:L,BlurFilter:M,DropShadowFilter:C,GlowFilter:F,GradientBevelFilter:k,GradientGlowFilter:A},d.$languages.set("Japanese",n),d.$languages.set("English",r),d.$languages.set("Chinese",a),d.$languages.set("Korean",o),d.$languages.set("French",s),d.$languages.set("Russia",l),d.$languages.set("Italiano",i),d.$languages.set("Spanish",c);let e=localStorage.getItem(`${d.PREFIX}@language-setting`);if(!e)switch(navigator.language){case"ja":e="Japanese";break;case"ko":e="Korean";break;case"zh":e="Chinese";break;case"fr":e="French";break;case"ru":e="Russia";break;case"it":e="Italiano";break;case"es":e="Spanish";break;default:e="English"}const t=d.$languages.get(e);d.$currentLanguage=new t,d.$loadSaveData(),window.addEventListener("keydown",d.$executeKeyCommand),window.addEventListener("keyup",(()=>{d.$shiftKey=!1,d.$ctrlKey=!1,d.$altKey=!1})),window.addEventListener("beforeunload",(e=>{d.$updated&&(e.preventDefault(),e.returnValue="データ保存中...",d.$autoSave())})),document.documentElement.style.setProperty("--timeline-frame-width","12px"),document.documentElement.style.setProperty("--screen-height",window.innerHeight-50+"px");const h=I.STAGE_DEFAULT_WIDTH,u=I.STAGE_DEFAULT_HEIGHT,m=I.STAGE_DEFAULT_FPS,g=document.getElementById("preview-display");g&&(g.style.width=`${h}px`,g.style.height=`${u}px`),"next2d"in window&&(d.$root=window.next2d.createRootMovieClip(h,u,m,{tagId:"preview-display"}),d.$root.stage._$player.stop());const p=document.getElementById("preview-stop");p&&p.addEventListener("click",d.$hidePreview),document.documentElement.style.setProperty("--ad","260px"),d.$initialize=null},window.addEventListener("DOMContentLoaded",d.$initialize),d.$showPreview=()=>{d.$timelinePlayer.executeTimelineStop(),d.$javaScriptEditor.save(),d.$previewMode=!0,d.$keyLock=!0;const e=document.getElementById("player-preview");e.style.display="",e.style.zIndex="9999";const t=d.$currentWorkSpace(),a=document.getElementById("preview-display");a.style.width=`${t.stage.width}px`,a.style.height=`${t.stage.height}px`;const r=document.getElementById("preview-stop");r.style.top=a.offsetTop-20+"px",r.style.left=`${a.offsetLeft+t.stage.width}px`,r.addEventListener("click",d.$hidePreview);const s=d.$root.stage;s.frameRate=0|document.getElementById("stage-fps").value;const i=s._$player;i.width=t.stage.width,i.height=t.stage.height,i._$resize(),s.clearGlobalVariable(),s._$events=new Map,i._$broadcastEvents=new Map;const n=X.toJSON();d.$useIds.clear();const{Loader:o}=window.next2d.display,{URLRequest:l}=window.next2d.net,{Event:c}=window.next2d.events,h=new o;h.contentLoaderInfo.addEventListener(c.COMPLETE,(e=>{const t=e.currentTarget,a=d.$root.stage,r=a._$player,s=t._$data;r.width=s.stage.width,r.height=s.stage.height,r.stage.frameRate=s.stage.fps;const i=d.$intToRGB(0|`0x${s.stage.bgColor.slice(1)}`);for(r._$context._$setColor(i.R/255,i.G/255,i.B/255,1),r._$backgroundColor=[i.R/255,i.G/255,i.B/255,1],d.$root=null,d.$root=t.content;a.numChildren;)a.removeChildAt(0);a.addChild(d.$root),r._$cacheStore.reset();const{BlendMode:n}=window.next2d.display,o=r._$context;o._$globalAlpha=1,o._$globalCompositeOperation=n.NORMAL,o._$imageSmoothingEnabled=!1,o.frameBuffer.unbind(),o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,o.canvas.width,o.canvas.height),o._$bind(r._$buffer),r.play()})),h.load(new l(URL.createObjectURL(new Blob([n],{type:"application/json"})))),i._$broadcastEvents.clear(),window.next2d.media.SoundMixer.volume=1,i._$loadStatus=1,i._$updateLoadStatus()},d.$hidePreview=()=>{document.getElementById("preview-stop").removeEventListener("click",d.$hidePreview);const e=document.getElementById("player-preview");for(e.style.display="none",e.style.zIndex="0",d.$previewMode=!1,d.$activeScript||(d.$keyLock=!1);d.$root.numChildren;)d.$root.removeChild(d.$root.getChildAt(0));d.$root.stage._$player.stop()},d.$toJSON=()=>{const e=d.$activeWorkSpaceId,t=document.getElementById("view-tab-area").children,a=[];for(let e=0;e<t.length;++e){const r=t[e],s=d.$workSpaces[0|r.dataset.tabId];s&&(d.$activeWorkSpaceId=0|r.dataset.tabId,a.push(s.toJSON()))}return d.$activeWorkSpaceId=e,JSON.stringify(a)},d.$autoSave=()=>{d.$javaScriptEditor.save();const e={object:d.$toJSON(),type:"local"};d.$zlibWorkerActive?d.$zlibQueues.push(e):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(e))},d.$currentWorkSpace=()=>d.$workSpaces[d.$activeWorkSpaceId],d.$initializeEnd=()=>{d.$readStatus++,d.$readStatus===d.$readEnd&&(d.$addModalEvent(document),d.$currentWorkSpace().run())},d.$changeWorkSpace=e=>{d.$useIds.clear(),d.$symbols.clear(),d.$currentWorkSpace().stop(),d.$activeWorkSpaceId=0|e,d.$currentWorkSpace().run()},d.$unZlibWorker=new Worker(URL.createObjectURL(new Blob(['/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";let t,i=this;function r(r,e){let s=r.split("."),h=i;!(s[0]in h)&&h.execScript&&h.execScript("var "+s[0]);for(var n;s.length&&(n=s.shift());)s.length||e===t?h=h[n]?h[n]:h[n]={}:h[n]=e}let e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function s(t){let i,r,s,h,n,a,f,o,l,u,c=t.length,b=0,y=Number.POSITIVE_INFINITY;for(o=0;o<c;++o)t[o]>b&&(b=t[o]),t[o]<y&&(y=t[o]);for(i=1<<b,r=new(e?Uint32Array:Array)(i),s=1,h=0,n=2;s<=b;){for(o=0;o<c;++o)if(t[o]===s){for(a=0,f=h,l=0;l<s;++l)a=a<<1|1&f,f>>=1;for(u=s<<16|o,l=a;l<i;l+=n)r[l]=u;++h}++s,h<<=1,n<<=1}return[r,b,y]}function h(t,i){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=e?new Uint8Array(t):t,this.m=!1,this.i=a,this.r=!1,!i&&(i={})||(i.index&&(this.a=i.index),i.bufferSize&&(this.h=i.bufferSize),i.bufferType&&(this.i=i.bufferType),i.resize&&(this.r=i.resize)),this.i){case n:this.b=32768,this.c=new(e?Uint8Array:Array)(32768+this.h+258);break;case a:this.b=0,this.c=new(e?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var n=0,a=1,f={t:n,s:a};h.prototype.k=function(){for(;!this.m;){let N=T(this,3);switch(1&N&&(this.m=!0),N>>>=1,N){case 0:var i=this.input,r=this.a,h=this.c,f=this.b,o=i.length,l=t,u=h.length,b=t;if(this.d=this.f=0,r+1>=o)throw Error("invalid uncompressed block header: LEN");if(l=i[r++]|i[r++]<<8,r+1>=o)throw Error("invalid uncompressed block header: NLEN");if(l===~(i[r++]|i[r++]<<8))throw Error("invalid uncompressed block header: length verify");if(r+l>i.length)throw Error("input buffer is broken");switch(this.i){case n:for(;f+l>h.length;){if(l-=b=u-f,e)h.set(i.subarray(r,r+b),f),f+=b,r+=b;else for(;b--;)h[f++]=i[r++];this.b=f,h=this.e(),f=this.b}break;case a:for(;f+l>h.length;)h=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(e)h.set(i.subarray(r,r+l),f),f+=l,r+=l;else for(;l--;)h[f++]=i[r++];this.a=r,this.b=f,this.c=h;break;case 1:this.j(E,I);break;case 2:var y,p,d,g,w=T(this,5)+257,A=T(this,5)+1,v=T(this,4)+4,k=new(e?Uint8Array:Array)(c.length),U=t,m=t,z=t,j=t,x=t;for(x=0;x<v;++x)k[c[x]]=T(this,3);if(!e)for(x=v,v=k.length;x<v;++x)k[c[x]]=0;for(y=s(k),U=new(e?Uint8Array:Array)(w+A),x=0,g=w+A;x<g;)switch(m=S(this,y)){case 16:for(j=3+T(this,2);j--;)U[x++]=z;break;case 17:for(j=3+T(this,3);j--;)U[x++]=0;z=0;break;case 18:for(j=11+T(this,7);j--;)U[x++]=0;z=0;break;default:z=U[x++]=m}p=s(e?U.subarray(0,w):U.slice(0,w)),d=s(e?U.subarray(w):U.slice(w)),this.j(p,d);break;default:throw Error("unknown BTYPE: "+N)}}return this.n()};var o,l,u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=e?new Uint16Array(u):u,b=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],y=e?new Uint16Array(b):b,p=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],d=e?new Uint8Array(p):p,g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],w=e?new Uint16Array(g):g,A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],v=e?new Uint8Array(A):A,k=new(e?Uint8Array:Array)(288);for(o=0,l=k.length;o<l;++o)k[o]=143>=o?8:255>=o?9:279>=o?7:8;var U,m,E=s(k),z=new(e?Uint8Array:Array)(30);for(U=0,m=z.length;U<m;++U)z[U]=5;var I=s(z);function T(t,i){for(var r,e=t.f,s=t.d,h=t.input,n=t.a,a=h.length;s<i;){if(n>=a)throw Error("input buffer is broken");e|=h[n++]<<s,s+=8}return r=e&(1<<i)-1,t.f=e>>>i,t.d=s-i,t.a=n,r}function S(t,i){for(var r,e,s=t.f,h=t.d,n=t.input,a=t.a,f=n.length,o=i[0],l=i[1];h<l&&!(a>=f);)s|=n[a++]<<h,h+=8;if((e=(r=o[s&(1<<l)-1])>>>16)>h)throw Error("invalid code length: "+e);return t.f=s>>e,t.d=h-e,t.a=a,65535&r}function j(t,i){let r,e;if(this.input=t,this.a=0,!i&&(i={})||(i.index&&(this.a=i.index),i.verify&&(this.A=i.verify)),r=t[this.a++],e=t[this.a++],(15&r)!==x)throw Error("unsupported compression method");if(this.method=x,0!=((r<<8)+e)%31)throw Error("invalid fcheck flag:"+((r<<8)+e)%31);if(32&e)throw Error("fdict flag is not supported");this.q=new h(t,{index:this.a,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}h.prototype.j=function(t,i){let r=this.c,e=this.b;this.o=t;for(var s,h,n,a,f=r.length-258;256!==(s=S(this,t));)if(256>s)e>=f&&(this.b=e,r=this.e(),e=this.b),r[e++]=s;else for(a=y[h=s-257],0<d[h]&&(a+=T(this,d[h])),s=S(this,i),n=w[s],0<v[s]&&(n+=T(this,v[s])),e>=f&&(this.b=e,r=this.e(),e=this.b);a--;)r[e]=r[e++-n];for(;8<=this.d;)this.d-=8,this.a--;this.b=e},h.prototype.w=function(t,i){let r=this.c,e=this.b;this.o=t;for(var s,h,n,a,f=r.length;256!==(s=S(this,t));)if(256>s)e>=f&&(r=this.e(),f=r.length),r[e++]=s;else for(a=y[h=s-257],0<d[h]&&(a+=T(this,d[h])),s=S(this,i),n=w[s],0<v[s]&&(n+=T(this,v[s])),e+a>f&&(r=this.e(),f=r.length);a--;)r[e]=r[e++-n];for(;8<=this.d;)this.d-=8,this.a--;this.b=e},h.prototype.e=function(){let t,i,r=new(e?Uint8Array:Array)(this.b-32768),s=this.b-32768,h=this.c;if(e)r.set(h.subarray(32768,r.length));else for(t=0,i=r.length;t<i;++t)r[t]=h[t+32768];if(this.g.push(r),this.l+=r.length,e)h.set(h.subarray(s,s+32768));else for(t=0;32768>t;++t)h[t]=h[s+t];return this.b=32768,h},h.prototype.z=function(t){let i,r,s,h,n=this.input.length/this.a+1|0,a=this.input,f=this.c;return t&&("number"==typeof t.p&&(n=t.p),"number"==typeof t.u&&(n+=t.u)),2>n?(r=(a.length-this.a)/this.o[2],h=r/2*258|0,s=h<f.length?f.length+h:f.length<<1):s=f.length*n,e?(i=new Uint8Array(s),i.set(f)):i=f,this.c=i},h.prototype.n=function(){let t,i,r,s,h,n=0,a=this.c,f=this.g,o=new(e?Uint8Array:Array)(this.l+(this.b-32768));if(0===f.length)return e?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(i=0,r=f.length;i<r;++i)for(t=f[i],s=0,h=t.length;s<h;++s)o[n++]=t[s];for(i=32768,r=this.b;i<r;++i)o[n++]=a[i];return this.g=[],this.buffer=o},h.prototype.v=function(){let t,i=this.b;return e?this.r?(t=new Uint8Array(i),t.set(this.c.subarray(0,i))):t=this.c.subarray(0,i):(this.c.length>i&&(this.c.length=i),t=this.c),this.buffer=t},j.prototype.k=function(){let t,i,r=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){i=(r[this.a++]<<24|r[this.a++]<<16|r[this.a++]<<8|r[this.a++])>>>0;let f=t;if("string"==typeof f){let t,i,r=f.split("");for(t=0,i=r.length;t<i;t++)r[t]=(255&r[t].charCodeAt(0))>>>0;f=r}for(var e,s=1,h=0,n=f.length,a=0;0<n;){n-=e=1024<n?1024:n;do{h+=s+=f[a++]}while(--e);s%=65521,h%=65521}if(i!==(h<<16|s)>>>0)throw Error("invalid adler-32 checksum")}return t};var x=8;r("Zlib.Inflate",j),r("Zlib.Inflate.prototype.decompress",j.prototype.k);let N,C,L,O,Z={ADAPTIVE:f.s,BLOCK:f.t};if(Object.keys)N=Object.keys(Z);else for(C in N=[],L=0,Z)N[L++]=C;for(L=0,O=N.length;L<O;++L)C=N[L],r("Zlib.Inflate.BufferType."+C,Z[C])}).call(this),this.addEventListener("message",(function(t){const i=new Zlib.Inflate(t.data.buffer).decompress();let r="";for(let t=0;t<i.length;t+=4096)r+=String.fromCharCode.apply(null,i.slice(t,t+4096));this.postMessage({json:r,type:t.data.type})}));'],{type:"text/javascript"}))),d.$unZlibWorker.onmessage=e=>{if("n2d"===e.data.type){const t=new U(decodeURIComponent(e.data.json));d.$workSpaces.push(t),d.$screenTab.createElement(t,d.$workSpaces.length-1)}else{const t=JSON.parse(decodeURIComponent(e.data.json));for(let e=0;e<t.length;++e)d.$workSpaces.push(new U(t[e]));d.$workSpaces.length||d.$workSpaces.push(new U),d.$screenTab.run(),d.$initializeEnd()}},d.$zlibWorker=new Worker(URL.createObjectURL(new Blob(['/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";let e,r=!0,t=this;function n(r,n){let a=r.split("."),i=t;!(a[0]in i)&&i.execScript&&i.execScript("var "+a[0]);for(var s;a.length&&(s=a.shift());)a.length||n===e?i=i[s]?i[s]:i[s]={}:i[s]=n}let a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function i(e,r){if(this.index="number"==typeof r?r:0,this.e=0,this.buffer=e instanceof(a?Uint8Array:Array)?e:new(a?Uint8Array:Array)(32768),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&s(this)}function s(e){let r,t=e.buffer,n=t.length,i=new(a?Uint8Array:Array)(n<<1);if(a)i.set(t);else for(r=0;r<n;++r)i[r]=t[r];return e.buffer=i}i.prototype.b=function(e,r,t){let n,a=this.buffer,i=this.index,f=this.e,h=a[i];if(t&&1<r&&(e=8<r?(l[255&e]<<24|l[e>>>8&255]<<16|l[e>>>16&255]<<8|l[e>>>24&255])>>32-r:l[e]>>8-r),8>r+f)h=h<<r|e,f+=r;else for(n=0;n<r;++n)h=h<<1|e>>r-n-1&1,8==++f&&(f=0,a[i++]=l[h],h=0,i===a.length&&(a=s(this)));a[i]=h,this.buffer=a,this.e=f,this.index=i},i.prototype.finish=function(){let e,r=this.buffer,t=this.index;return 0<this.e&&(r[t]<<=8-this.e,r[t]=l[r[t]],t++),a?e=r.subarray(0,t):(r.length=t,e=r),e};let f,h=new(a?Uint8Array:Array)(256);for(f=0;256>f;++f){for(var o=c=f,u=7,c=c>>>1;c;c>>>=1)o<<=1,o|=1&c,--u;h[f]=(o<<u&255)>>>0}var l=h;function b(e){this.buffer=new(a?Uint16Array:Array)(2*e),this.length=0}function y(e,r){this.d=g,this.i=0,this.input=a&&e instanceof Array?new Uint8Array(e):e,this.c=0,r&&(r.lazy&&(this.i=r.lazy),"number"==typeof r.compressionType&&(this.d=r.compressionType),r.outputBuffer&&(this.a=a&&r.outputBuffer instanceof Array?new Uint8Array(r.outputBuffer):r.outputBuffer),"number"==typeof r.outputIndex&&(this.c=r.outputIndex)),this.a||(this.a=new(a?Uint8Array:Array)(32768))}b.prototype.getParent=function(e){return 2*((e-2)/4|0)},b.prototype.push=function(e,r){let t,n,a,i=this.buffer;for(t=this.length,i[this.length++]=r,i[this.length++]=e;0<t&&(n=this.getParent(t),i[t]>i[n]);)a=i[t],i[t]=i[n],i[n]=a,a=i[t+1],i[t+1]=i[n+1],i[n+1]=a,t=n;return this.length},b.prototype.pop=function(){let e,r,t,n,a,i=this.buffer;for(r=i[0],e=i[1],this.length-=2,i[0]=i[this.length],i[1]=i[this.length+1],a=0;(n=2*a+2,!(n>=this.length))&&(n+2<this.length&&i[n+2]>i[n]&&(n+=2),i[n]>i[a]);)t=i[a],i[a]=i[n],i[n]=t,t=i[a+1],i[a+1]=i[n+1],i[n+1]=t,a=n;return{index:e,value:r,length:this.length}};var p,g=2,A={NONE:0,h:1,g:g,n:3},k=[];for(p=0;288>p;p++)switch(r){case 143>=p:k.push([p+48,8]);break;case 255>=p:k.push([p-144+400,9]);break;case 279>=p:k.push([p-256+0,7]);break;case 287>=p:k.push([p-280+192,8]);break;default:throw"invalid literal: "+p}function w(e,r){this.length=e,this.k=r}y.prototype.f=function(){let t,n,s,f,h=this.input;switch(this.d){case 0:for(s=0,f=h.length;s<f;){n=a?h.subarray(s,s+65535):h.slice(s,s+65535),s+=n.length;let r=n,t=s===f,i=e,o=e,u=e,c=e,l=e,b=this.a,y=this.c;if(a){for(b=new Uint8Array(this.a.buffer);b.length<=y+r.length+5;)b=new Uint8Array(b.length<<1);b.set(this.a)}if(i=t?1:0,b[y++]=0|i,o=r.length,u=65536+~o&65535,b[y++]=255&o,b[y++]=o>>>8&255,b[y++]=255&u,b[y++]=u>>>8&255,a)b.set(r,y),y+=r.length,b=b.subarray(0,y);else{for(c=0,l=r.length;c<l;++c)b[y++]=r[c];b.length=y}this.c=y,this.a=b}break;case 1:var o=new i(a?new Uint8Array(this.a.buffer):this.a,this.c);o.b(1,1,r),o.b(1,2,r);var u,c,l,b=v(this,h);for(u=0,c=b.length;u<c;u++)if(l=b[u],i.prototype.b.apply(o,k[l]),256<l)o.b(b[++u],b[++u],r),o.b(b[++u],5),o.b(b[++u],b[++u],r);else if(256===l)break;this.a=o.finish(),this.c=this.a.length;break;case g:var y,p,A,w,d,U,m,D,E,j,O,Z,B,C,I,M=new i(a?new Uint8Array(this.a.buffer):this.a,this.c),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=Array(19);for(y=g,M.b(1,1,r),M.b(y,2,r),p=v(this,h),m=N(U=x(this.m,15)),E=N(D=x(this.l,7)),A=286;257<A&&0===U[A-1];A--);for(w=30;1<w&&0===D[w-1];w--);var S,L,P,F,G,J,R=A,V=w,X=new(a?Uint32Array:Array)(R+V),Y=new(a?Uint32Array:Array)(316),q=new(a?Uint8Array:Array)(19);for(S=L=0;S<R;S++)X[L++]=U[S];for(S=0;S<V;S++)X[L++]=D[S];if(!a)for(S=0,F=q.length;S<F;++S)q[S]=0;for(S=G=0,F=X.length;S<F;S+=L){for(L=1;S+L<F&&X[S+L]===X[S];++L);if(P=L,0===X[S])if(3>P)for(;0<P--;)Y[G++]=0,q[0]++;else for(;0<P;)(J=138>P?P:138)>P-3&&J<P&&(J=P-3),10>=J?(Y[G++]=17,Y[G++]=J-3,q[17]++):(Y[G++]=18,Y[G++]=J-11,q[18]++),P-=J;else if(Y[G++]=X[S],q[X[S]]++,3>--P)for(;0<P--;)Y[G++]=X[S],q[X[S]]++;else for(;0<P;)(J=6>P?P:6)>P-3&&J<P&&(J=P-3),Y[G++]=16,Y[G++]=J-3,q[16]++,P-=J}for(t=a?Y.subarray(0,G):Y.slice(0,G),j=x(q,7),C=0;19>C;C++)z[C]=j[T[C]];for(d=19;4<d&&0===z[d-1];d--);for(O=N(j),M.b(A-257,5,r),M.b(w-1,5,r),M.b(d-4,4,r),C=0;C<d;C++)M.b(z[C],3,r);for(C=0,I=t.length;C<I;C++)if(Z=t[C],M.b(O[Z],j[Z],r),16<=Z){switch(C++,Z){case 16:B=2;break;case 17:B=3;break;case 18:B=7;break;default:throw"invalid code: "+Z}M.b(t[C],B,r)}var H,K,Q,W,$,_,ee,re,te=[m,U],ne=[E,D];for($=te[0],_=te[1],ee=ne[0],re=ne[1],H=0,K=p.length;H<K;++H)if(Q=p[H],M.b($[Q],_[Q],r),256<Q)M.b(p[++H],p[++H],r),W=p[++H],M.b(ee[W],re[W],r),M.b(p[++H],p[++H],r);else if(256===Q)break;this.a=M.finish(),this.c=this.a.length;break;default:throw"invalid compression type"}return this.a};let d=function(){function e(e){switch(r){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:throw"invalid length: "+e}}let t,n,a=[];for(t=3;258>=t;t++)n=e(t),a[t]=n[2]<<24|n[1]<<16|n[0];return a}(),U=a?new Uint32Array(d):d;function v(t,n){function i(e,t){let n,a,i,s,f=e.k,h=[],o=0;switch(n=U[e.length],h[o++]=65535&n,h[o++]=n>>16&255,h[o++]=n>>24,r){case 1===f:a=[0,f-1,0];break;case 2===f:a=[1,f-2,0];break;case 3===f:a=[2,f-3,0];break;case 4===f:a=[3,f-4,0];break;case 6>=f:a=[4,f-5,1];break;case 8>=f:a=[5,f-7,1];break;case 12>=f:a=[6,f-9,2];break;case 16>=f:a=[7,f-13,2];break;case 24>=f:a=[8,f-17,3];break;case 32>=f:a=[9,f-25,3];break;case 48>=f:a=[10,f-33,4];break;case 64>=f:a=[11,f-49,4];break;case 96>=f:a=[12,f-65,5];break;case 128>=f:a=[13,f-97,5];break;case 192>=f:a=[14,f-129,6];break;case 256>=f:a=[15,f-193,6];break;case 384>=f:a=[16,f-257,7];break;case 512>=f:a=[17,f-385,7];break;case 768>=f:a=[18,f-513,8];break;case 1024>=f:a=[19,f-769,8];break;case 1536>=f:a=[20,f-1025,9];break;case 2048>=f:a=[21,f-1537,9];break;case 3072>=f:a=[22,f-2049,10];break;case 4096>=f:a=[23,f-3073,10];break;case 6144>=f:a=[24,f-4097,11];break;case 8192>=f:a=[25,f-6145,11];break;case 12288>=f:a=[26,f-8193,12];break;case 16384>=f:a=[27,f-12289,12];break;case 24576>=f:a=[28,f-16385,13];break;case 32768>=f:a=[29,f-24577,13];break;default:throw"invalid distance"}for(n=a,h[o++]=n[0],h[o++]=n[1],h[o++]=n[2],i=0,s=h.length;i<s;++i)g[A++]=h[i];w[h[0]]++,d[h[3]]++,k=e.length+t-1,b=null}var s,f,h,o,u,c,l,b,y,p={},g=a?new Uint16Array(2*n.length):[],A=0,k=0,w=new(a?Uint32Array:Array)(286),d=new(a?Uint32Array:Array)(30),v=t.i;if(!a){for(h=0;285>=h;)w[h++]=0;for(h=0;29>=h;)d[h++]=0}for(w[256]=1,s=0,f=n.length;s<f;++s){for(h=u=0,o=3;h<o&&s+h!==f;++h)u=u<<8|n[s+h];if(p[u]===e&&(p[u]=[]),c=p[u],!(0<k--)){for(;0<c.length&&32768<s-c[0];)c.shift();if(s+3>=f){for(b&&i(b,-1),h=0,o=f-s;h<o;++h)y=n[s+h],g[A++]=y,++w[y];break}0<c.length?(l=m(n,s,c),b?b.length<l.length?(y=n[s-1],g[A++]=y,++w[y],i(l,0)):i(b,-1):l.length<v?b=l:i(l,0)):b?i(b,-1):(y=n[s],g[A++]=y,++w[y])}c.push(s)}return g[A++]=256,w[256]++,t.m=w,t.l=d,a?g.subarray(0,A):g}function m(e,r,t){let n,a,i,s,f,h,o=0,u=e.length;s=0,h=t.length;e:for(;s<h;s++){if(n=t[h-s-1],i=3,3<o){for(f=o;3<f;f--)if(e[n+f-1]!==e[r+f-1])continue e;i=o}for(;258>i&&r+i<u&&e[n+i]===e[r+i];)++i;if(i>o&&(a=n,o=i),258===i)break}return new w(o,r-a)}function x(e,r){let t,n,i,s,f,h=e.length,o=new b(572),u=new(a?Uint8Array:Array)(h);if(!a)for(s=0;s<h;s++)u[s]=0;for(s=0;s<h;++s)0<e[s]&&o.push(s,e[s]);if(t=Array(o.length/2),n=new(a?Uint32Array:Array)(o.length/2),1===t.length)return u[o.pop().index]=1,u;for(s=0,f=o.length/2;s<f;++s)t[s]=o.pop(),n[s]=t[s].value;for(i=function(e,r,t){function n(e){let t=y[e][p[e]];t===r?(n(e+1),n(e+1)):--l[t],++p[e]}var i,s,f,h,o,u=new(a?Uint16Array:Array)(t),c=new(a?Uint8Array:Array)(t),l=new(a?Uint8Array:Array)(r),b=Array(t),y=Array(t),p=Array(t),g=(1<<t)-r,A=1<<t-1;for(u[t-1]=r,s=0;s<t;++s)g<A?c[s]=0:(c[s]=1,g-=A),g<<=1,u[t-2-s]=(u[t-1-s]/2|0)+r;for(u[0]=c[0],b[0]=Array(u[0]),y[0]=Array(u[0]),s=1;s<t;++s)u[s]>2*u[s-1]+c[s]&&(u[s]=2*u[s-1]+c[s]),b[s]=Array(u[s]),y[s]=Array(u[s]);for(i=0;i<r;++i)l[i]=t;for(f=0;f<u[t-1];++f)b[t-1][f]=e[f],y[t-1][f]=f;for(i=0;i<t;++i)p[i]=0;for(1===c[t-1]&&(--l[0],++p[t-1]),s=t-2;0<=s;--s){for(h=i=0,o=p[s+1],f=0;f<u[s];f++)(h=b[s+1][o]+b[s+1][o+1])>e[i]?(b[s][f]=h,y[s][f]=r,o+=2):(b[s][f]=e[i],y[s][f]=i,++i);p[s]=0,1===c[s]&&n(s)}return l}(n,n.length,r),s=0,f=t.length;s<f;++s)u[t[s].index]=i[s];return u}function N(e){let r,t,n,i,s=new(a?Uint16Array:Array)(e.length),f=[],h=[],o=0;for(r=0,t=e.length;r<t;r++)f[e[r]]=1+(0|f[e[r]]);for(r=1,t=16;r<=t;r++)h[r]=o,o+=0|f[r],o<<=1;for(r=0,t=e.length;r<t;r++)for(o=h[e[r]],h[e[r]]+=1,n=s[r]=0,i=e[r];n<i;n++)s[r]=s[r]<<1|1&o,o>>>=1;return s}function D(e,r){this.input=e,this.a=new(a?Uint8Array:Array)(32768),this.d=E.g;let t,n={};for(t in!r&&(r={})||"number"!=typeof r.compressionType||(this.d=r.compressionType),r)n[t]=r[t];n.outputBuffer=this.a,this.j=new y(this.input,n)}var E=A;D.prototype.f=function(){let e,r,t,n,i,s,f=0;switch(s=this.a,e=Math.LOG2E*Math.log(32768)-8,r=e<<4|8,s[f++]=r,this.d){case E.NONE:n=0;break;case E.h:n=1;break;case E.g:n=2;break;default:throw Error("unsupported compression type")}t=n<<6|0,s[f++]=t|31-(256*r+t)%31;let h=this.input;if("string"==typeof h){let e,r,t=h.split("");for(e=0,r=t.length;e<r;e++)t[e]=(255&t[e].charCodeAt(0))>>>0;h=t}for(var o,u=1,c=0,l=h.length,b=0;0<l;){l-=o=1024<l?1024:l;do{c+=u+=h[b++]}while(--o);u%=65521,c%=65521}return i=(c<<16|u)>>>0,this.j.c=f,s=this.j.f(),f=s.length,a&&(s=new Uint8Array(s.buffer),s.length<=f+4&&(this.a=new Uint8Array(s.length+4),this.a.set(s),s=this.a),s=s.subarray(0,f+4)),s[f++]=i>>24&255,s[f++]=i>>16&255,s[f++]=i>>8&255,s[f++]=255&i,s},n("Zlib.Deflate",D),n("Zlib.Deflate.compress",(function(e,r){return new D(e,r).f()})),n("Zlib.Deflate.prototype.compress",D.prototype.f);let j,O,Z,B,C={NONE:E.NONE,FIXED:E.h,DYNAMIC:E.g};if(Object.keys)j=Object.keys(C);else for(O in j=[],Z=0,C)j[Z++]=O;for(Z=0,B=j.length;Z<B;++Z)O=j[Z],n("Zlib.Deflate.CompressionType."+O,C[O])}).call(this),this.addEventListener("message",(function(e){const r=Uint8Array.from(encodeURIComponent(e.data.object).split(""),(e=>e.charCodeAt(0))),t=e.data.type;if("json"===t)this.postMessage({json:JSON.stringify({buffer:Array.from(new Zlib.Deflate(r).compress()),type:"zlib"}),type:t});else{const e=new Zlib.Deflate(r).compress();this.postMessage({buffer:e,type:t},[e.buffer])}}));'],{type:"text/javascript"}))),d.$zlibWorker.onmessage=e=>{const t=e.data.type;switch(t){case"json":case"n2d":{const a=document.getElementById("save-anchor");a.href&&URL.revokeObjectURL(a.href),a.download=`${d.$currentWorkSpace().name}.${t}`,a.href="json"===t?URL.createObjectURL(new Blob([e.data.json],{type:"application/json"})):URL.createObjectURL(new Blob([e.data.buffer],{type:"text/plain"})),a.click()}break;case"local":{const t=e.data.buffer;let a="";for(let e=0;e<t.length;e+=4096)a+=String.fromCharCode.apply(null,t.slice(e,e+4096));d.$launchDB().onsuccess=e=>{const t=e.target.result.transaction(`${d.DATABASE_NAME}`,"readwrite");t.objectStore(`${d.DATABASE_NAME}`).put(a,d.STORE_KEY),t.oncomplete=e=>{e.target.db.close(),d.$updated=!1},t.commit()}}}d.$zlibQueues.length?d.$zlibWorker.postMessage(d.$zlibQueues.pop()):d.$zlibWorkerActive=!1},d.$zlibQueues=[],d.$zlibWorkerActive=!1,d.$unzipURL=URL.createObjectURL(new Blob(['const Util={};Util.$Uint8Array=Uint8Array,Util.$Uint16Array=Uint16Array,Util.$Int16Array=Int16Array,Util.$ArrayBuffer=ArrayBuffer,Util.$max=Math.max,Util.$min=Math.min,Util.$potArrayBuffers=new Map,Util.$codeTables=[],Util.$getCodeTable=function(t,e){const i=Util.$codeTables.pop()||{key:null,value:null};return i.key=t,i.value=e,i},Util.$poolCodeTable=function(t){Util.$codeTables.push(t)},Util.$poolTypedArrayBuffer=function(t){const e=t.buffer,i=e.byteLength;if(!i||i!==Util.$upperPowerOfTwo(i))return;let r=Util.$potArrayBuffers.get(i);r||(r=[],Util.$potArrayBuffers.set(i,r)),r.push(e)},Util.$upperPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},Util.$getUint8Array=function(t){let e;const i=Util.$upperPowerOfTwo(t),r=Util.$potArrayBuffers.get(i),l=r&&r.pop();return l?(e=new Util.$Uint8Array(l,0,t),e.fill(0)):e=new Util.$Uint8Array(new Util.$ArrayBuffer(i),0,t),e},Util.$getUint16Array=function(t){let e;const i=Util.$upperPowerOfTwo(2*t),r=Util.$potArrayBuffers.get(i),l=r&&r.pop();return l?(e=new Util.$Uint16Array(l,0,t),e.fill(0)):e=new Util.$Uint16Array(new Util.$ArrayBuffer(i),0,t),e},Util.$fixedDistTable={key:new Util.$Uint16Array([5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5]),value:new Util.$Uint16Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31])},Util.$fixedLitTable={key:new Util.$Uint16Array([7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9]),value:new Util.$Uint16Array([256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,280,281,282,283,284,285,286,287,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255])},Util.$ORDER=new Util.$Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Util.$LEXT=new Util.$Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99]),Util.$LENS=new Util.$Int16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Util.$DEXT=new Util.$Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Util.$DISTS=new Util.$Int16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]);class ByteStream{constructor(){this.initialization()}initialization(){this.data=null,this.bit_offset=0,this.byte_offset=0,this.bit_buffer=null}byteAlign(){this.bit_offset&&(this.byte_offset=this.byte_offset+(this.bit_offset+7)/8|0,this.bit_offset=0)}getData(t){this.byteAlign();const e=this.byte_offset+t,i=this.data.slice(this.byte_offset,e);return this.byte_offset=e,i}setOffset(t,e){this.byte_offset=t,this.bit_offset=e}unzip(t,e=0){let i=e;const r=Util.$getUint8Array(19);let l=null,a=null;for(;;){const e=this.readUB(1),s=this.readUB(2);if(l&&(Util.$poolCodeTable(l),Util.$poolCodeTable(a)),l=null,a=null,s){if(1===s)l=Util.$fixedDistTable,a=Util.$fixedLitTable;else{const t=this.readUB(5)+257,e=this.readUB(5)+1,i=this.readUB(4)+4;for(let t=0;t<i;++t)r[Util.$ORDER[t]]=this.readUB(3);const s=this.buildHuffTable(r);r.fill(0);const f=t+e|0,o=Util.$getUint8Array(f);let n=0;for(let t=0;t<f;){const e=this.decodeSymbol(s.key,s.value);switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:o[t++]=e,n=e;break;case 16:{let e=this.readUB(2)+3|0;for(;e;)--e,o[t++]=n}break;case 17:{let e=this.readUB(3)+3|0;for(;e;)--e,o[t++]=0}break;case 18:{let e=this.readUB(7)+11|0;for(;e;)--e,o[t++]=0}}}Util.$poolCodeTable(s),l=this.buildHuffTable(o.subarray(t)),a=this.buildHuffTable(o.subarray(0,t)),Util.$poolTypedArrayBuffer(o),Util.$poolTypedArrayBuffer(s.key),Util.$poolTypedArrayBuffer(s.value)}for(;;){const e=0|this.decodeSymbol(a.key,a.value);if(256===e)break;if(e<256)t[i++]=e;else{const r=e-257|0;let a=Util.$LENS[r]+this.readUB(Util.$LEXT[r])|0;const s=this.decodeSymbol(l.key,l.value);let f=i-(Util.$DISTS[s]+this.readUB(Util.$DEXT[s])|0)|0;for(;a;)--a,t[i++]=t[f++]}}}else{this.bit_offset=8,this.bit_buffer=null;const e=0|this.readNumber(2);this.byte_offset+=2;for(let r=0;r<e;++r)t[i++]=this.readNumber(1)}if(e)break}Util.$poolTypedArrayBuffer(r)}buildHuffTable(t){const e=t.length,i=Util.$max.apply(null,t),r=Util.$getUint8Array(i),l=Util.$getUint16Array(i+1);let a=0,s=0,f=e;for(;f;)s=t[--f],s&&++r[s];let o=0;for(let t=0;t<i;)a=a+r[t++]<<1,l[t]=a,o=Util.$max(o,a);const n=o+e,U=Util.$getUint16Array(n),u=Util.$getUint16Array(n);for(let i=0;i<e;++i)if(s=t[i],s){const t=l[s];U[t]=s,u[t]=i,l[s]=t+1|0}return Util.$poolTypedArrayBuffer(r),Util.$poolTypedArrayBuffer(l),Util.$getCodeTable(U,u)}decodeSymbol(t,e){let i=0,r=0;for(;;)if(i=i<<1|this.readUB(1),++r,t[i]===r)return e[i]}readUB(t){let e=0;for(let i=0;i<t;++i)8===this.bit_offset&&(this.bit_buffer=this.readNumber(1),this.bit_offset=0),e|=(this.bit_buffer&1<<this.bit_offset++?1:0)<<i;return e}readNumber(t){let e=0;const i=this.byte_offset;let r=i+t|0;for(;r>i;)e=e<<8|this.data[--r];return this.byte_offset+=t,e}}Util.$byteStream=new ByteStream,Util.$lossless=function(t,e,i,r,l,a){const s=new Util.$Uint8Array(e*i*4);if(3===r){const r=(e+3&-4)-e;let f=0;if(a){let a=4*l;for(let l=0;l<i;++l){for(let i=0;i<e;++i){const e=4*t[a++],i=t[e+3];if(0===i){s[f++]=0,s[f++]=0,s[f++]=0,s[f++]=0;continue}const r=t[e],l=t[e+1],o=t[e+2];255!==i?(s[f++]=255&Util.$min(r/i*255,255),s[f++]=255&Util.$min(l/i*255,255),s[f++]=255&Util.$min(o/i*255,255),s[f++]=i):(s[f++]=r,s[f++]=l,s[f++]=o,s[f++]=i)}a+=r}return s}let o=3*l;for(let l=0;l<i;++l){for(let i=0;i<e;++i){const e=3*t[o++];s[f++]=t[e],s[f++]=t[e+1],s[f++]=t[e+2],s[f++]=255}o+=r}return s}const f=e*i;if(a){for(let e=0;e<f;++e){const i=4*e,r=i,l=i+1,a=i+2,f=i+3,o=t[r];0!==o?255!==o?(s[r]=255&Util.$min(t[l]/o*255,255),s[l]=255&Util.$min(t[a]/o*255,255),s[a]=255&Util.$min(t[f]/o*255,255),s[f]=o):(s[r]=t[l],s[l]=t[a],s[a]=t[f],s[f]=o):(s[r]=0,s[l]=0,s[a]=0,s[f]=0)}return s}for(let e=0;e<f;++e){const i=4*e,r=i+1,l=i+2,a=i+3;s[i]=t[r],s[r]=t[l],s[l]=t[a],s[a]=255}return s},this.addEventListener("message",(function(t){const e=Util.$byteStream;switch(t.data.mode){case"swf":{e.data=t.data.buffer;const i=t.data.fileSize,r=new Util.$Uint8Array(i),l=e.getData(8);e.setOffset(10,8),r.set(l,0),e.unzip(r,8),this.postMessage({buffer:r,mode:t.data.mode},[r.buffer])}break;case"lossless":{const i=t.data,r=new Util.$Uint8Array(i.fileSize);e.data=t.data.buffer,e.setOffset(2,8),e.unzip(r,0);const l=Util.$lossless(r,i.width,i.height,i.format,i.tableSize,i.isAlpha);this.postMessage({buffer:l,mode:t.data.mode},[l.buffer])}break;case"jpegAlpha":{const i=t.data.width*t.data.height,r=new Util.$Uint8Array(i);e.data=t.data.alphaData,e.setOffset(2,8),e.unzip(r,0),t.data.alphaData=r,this.postMessage(t.data,[t.data.buffer.buffer,t.data.alphaData.buffer])}}Util.$byteStream.initialization()}));'],{type:"text/javascript"})),d.$unzipWorker=null,d.$unzipQueues=[],d.$unzipWorkerActive=!1,d.$launchDB=()=>{const e=indexedDB.open(`${d.PREFIX}@${d.DATABASE_NAME}`);return e.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(`${d.DATABASE_NAME}`)||t.createObjectStore(`${d.DATABASE_NAME}`)},e},d.$unzipHandler=function(e){const t=e.target;switch(t.onmessage=null,e.data.mode){case"swf":this._$byteStream._$buffer=e.data.buffer,this.parseAndBuild();break;case"lossless":{const t=d.$currentWorkSpace().getLibrary(this.libraryId);t._$buffer=e.data.buffer,t._$command=null}break;case"jpegAlpha":{const t=e.data.buffer,a=e.data.alphaData;let r=0;for(let e=0;e<t.length;e+=4)t[e+3]=a[r++];const s=d.$currentWorkSpace().getLibrary(this.libraryId);s._$buffer=t,s._$command=null}}if(d.$unzipQueues.length){const e=d.$unzipQueues.shift();switch(t.onmessage=d.$unzipHandler.bind(e),e.mode){case"swf":{const a=e._$byteStream._$buffer;t.postMessage({fileSize:e.fileSize,mode:e.mode,buffer:a},[a.buffer])}break;case"lossless":t.postMessage(e,[e.buffer.buffer]);break;case"jpegAlpha":t.postMessage(e,[e.buffer.buffer,e.alphaData.buffer])}}else d.$unzipWorkerActive=!1},d.$unlzmaWorkerURL=URL.createObjectURL(new Blob(['const LZMA={init:function(e){const t=[];t.push(e[12],e[13],e[14],e[15],e[16],e[4],e[5],e[6],e[7]);let s=8;for(let e=5;e<9;++e){if(t[e]>=s){t[e]=t[e]-s|0;break}t[e]=256+t[e]-s|0,s=1}return t.push(0,0,0,0),e.set(t,4),e.subarray(4)},reverseDecode2:function(e,t,s,i){let r=1,o=0,d=0;for(;d<i;++d){const i=s.decodeBit(e,t+r);r=r<<1|i,o|=i<<d}return o},decompress:function(e,t){const s=new Decoder,i=s.decodeHeader(e),r=i.uncompressedSize;if(s.setProperties(i),!s.decodeBody(e,t,r))throw new Error("Error in lzma data stream");return t}};class OutWindow{constructor(){this._buffer=null,this._stream=null,this._pos=0,this._streamPos=0,this._windowSize=0}create(e){this._buffer&&this._windowSize===e||(this._buffer=new Uint8Array(e)),this._windowSize=e}flush(){const e=this._pos-this._streamPos;e&&(this._stream.writeBytes(this._buffer,e),this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos)}releaseStream(){this.flush(),this._stream=null}setStream(e){this._stream=e}init(e=!1){e||(this._streamPos=0,this._pos=0)}copyBlock(e,t){let s=this._pos-e-1;for(s<0&&(s+=this._windowSize);t--;)s>=this._windowSize&&(s=0),this._buffer[this._pos++]=this._buffer[s++],this._pos>=this._windowSize&&this.flush()}putByte(e){this._buffer[this._pos++]=e,this._pos>=this._windowSize&&this.flush()}getByte(e){let t=this._pos-e-1;return t<0&&(t+=this._windowSize),this._buffer[t]}}class RangeDecoder{constructor(){this._stream=null,this._code=0,this._range=-1}setStream(e){this._stream=e}releaseStream(){this._stream=null}init(){let e=5;for(this._code=0,this._range=-1;e--;)this._code=this._code<<8|this._stream.readByte()}decodeDirectBits(e){let t=0,s=e;for(;s--;){this._range>>>=1;const e=this._code-this._range>>>31;this._code-=this._range&e-1,t=t<<1|1-e,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8)}return t}decodeBit(e,t){const s=e[t],i=(this._range>>>11)*s;return(2147483648^this._code)<(2147483648^i)?(this._range=i,e[t]+=2048-s>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=i,this._code-=i,e[t]-=s>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)}}class BitTreeDecoder{constructor(e){this._models=Array(1<<e).fill(1024),this._numBitLevels=e}decode(e){let t=1,s=this._numBitLevels;for(;s--;)t=t<<1|e.decodeBit(this._models,t);return t-(1<<this._numBitLevels)}reverseDecode(e){let t=1,s=0,i=0;for(;i<this._numBitLevels;++i){const r=e.decodeBit(this._models,t);t=t<<1|r,s|=r<<i}return s}}class LenDecoder{constructor(){this._choice=[1024,1024],this._lowCoder=[],this._midCoder=[],this._highCoder=new BitTreeDecoder(8),this._numPosStates=0}create(e){for(;this._numPosStates<e;++this._numPosStates)this._lowCoder[this._numPosStates]=new BitTreeDecoder(3),this._midCoder[this._numPosStates]=new BitTreeDecoder(3)}decode(e,t){return 0===e.decodeBit(this._choice,0)?this._lowCoder[t].decode(e):0===e.decodeBit(this._choice,1)?8+this._midCoder[t].decode(e):16+this._highCoder.decode(e)}}class Decoder2{constructor(){this._decoders=Array(768).fill(1024)}decodeNormal(e){let t=1;do{t=t<<1|e.decodeBit(this._decoders,t)}while(t<256);return 255&t}decodeWithMatchByte(e,t){let s=1;do{const i=t>>7&1;t<<=1;const r=e.decodeBit(this._decoders,(1+i<<8)+s);if(s=s<<1|r,i!==r){for(;s<256;)s=s<<1|e.decodeBit(this._decoders,s);break}}while(s<256);return 255&s}}class LiteralDecoder{create(e,t){if(this._coders&&this._numPrevBits===t&&this._numPosBits===e)return;this._numPosBits=e,this._posMask=(1<<e)-1,this._numPrevBits=t,this._coders=[];let s=1<<this._numPrevBits+this._numPosBits;for(;s--;)this._coders[s]=new Decoder2}getDecoder(e,t){return this._coders[((e&this._posMask)<<this._numPrevBits)+((255&t)>>>8-this._numPrevBits)]}}class Decoder{constructor(){this._outWindow=new OutWindow,this._rangeDecoder=new RangeDecoder,this._isMatchDecoders=Array(192).fill(1024),this._isRepDecoders=Array(12).fill(1024),this._isRepG0Decoders=Array(12).fill(1024),this._isRepG1Decoders=Array(12).fill(1024),this._isRepG2Decoders=Array(12).fill(1024),this._isRep0LongDecoders=Array(192).fill(1024),this._posDecoders=Array(114).fill(1024),this._posAlignDecoder=new BitTreeDecoder(4),this._lenDecoder=new LenDecoder,this._repLenDecoder=new LenDecoder,this._literalDecoder=new LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder=[new BitTreeDecoder(6),new BitTreeDecoder(6),new BitTreeDecoder(6),new BitTreeDecoder(6)]}setDictionarySize(e){return!(e<0)&&(this._dictionarySize!==e&&(this._dictionarySize=e,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)}setLcLpPb(e,t,s){if(e>8||t>4||s>4)return!1;const i=1<<s;return this._literalDecoder.create(t,e),this._lenDecoder.create(i),this._repLenDecoder.create(i),this._posStateMask=i-1,!0}setProperties(e){if(!this.setLcLpPb(e.lc,e.lp,e.pb))throw Error("Incorrect stream properties");if(!this.setDictionarySize(e.dictionarySize))throw Error("Invalid dictionary size")}decodeHeader(e){if(e._$size<13)return!1;let t=e.readByte();const s=t%9;t=~~(t/9);const i=t%5,r=~~(t/5);let o=e.readByte();o|=e.readByte()<<8,o|=e.readByte()<<16,o+=16777216*e.readByte();let d=e.readByte();return d|=e.readByte()<<8,d|=e.readByte()<<16,d+=16777216*e.readByte(),e.readByte(),e.readByte(),e.readByte(),e.readByte(),{lc:s,lp:i,pb:r,dictionarySize:o,uncompressedSize:d}}decodeBody(e,t,s){let i,r,o=0,d=0,h=0,c=0,n=0,_=0,a=0;for(this._rangeDecoder.setStream(e),this._rangeDecoder.init(),this._outWindow.setStream(t),this._outWindow.init(!1);_<s;){const e=_&this._posStateMask;if(0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(o<<4)+e)){const e=this._literalDecoder.getDecoder(_++,a);a=o>=7?e.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(d)):e.decodeNormal(this._rangeDecoder),this._outWindow.putByte(a),o=o<4?0:o-(o<10?3:6)}else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,o))i=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,o)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(o<<4)+e)&&(o=o<7?9:11,i=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,o)?r=h:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,o)?r=c:(r=n,n=c),c=h),h=d,d=r),0===i&&(i=2+this._repLenDecoder.decode(this._rangeDecoder,e),o=o<7?8:11);else{n=c,c=h,h=d,i=2+this._lenDecoder.decode(this._rangeDecoder,e),o=o<7?7:10;const t=this._posSlotDecoder[i<=5?i-2:3].decode(this._rangeDecoder);if(t>=4){const e=(t>>1)-1;if(d=(2|1&t)<<e,t<14)d+=LZMA.reverseDecode2(this._posDecoders,d-t-1,this._rangeDecoder,e);else if(d+=this._rangeDecoder.decodeDirectBits(e-4)<<4,d+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),d<0){if(-1===d)break;return!1}}else d=t}if(d>=_||d>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(d,i),_+=i,a=this._outWindow.getByte(0)}}return this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0}}class InStream{constructor(e){this._$data=e,this._$size=e.length,this._$offset=0}readByte(){return this._$data[this._$offset++]}}class OutStream{constructor(e){this.size=8,this.buffers=e}writeBytes(e,t){e.length===t?this.buffers.set(e,this.size):this.buffers.set(e.subarray(0,t),this.size),this.size+=t}}this.addEventListener("message",(function(e){const t=e.data.fileSize,s=e.data.buffer,i=new Uint8Array(t+8);i.set(s.slice(0,8),0),LZMA.decompress(new InStream(LZMA.init(s)),new OutStream(i)),this.postMessage(i,[i.buffer]),this.close()}));'],{type:"text/javascript"})),d.$unlzmaQueues=[],d.$unlzmaWorkerActive=!1,d.$parserURL=URL.createObjectURL(new Blob(['const Util={$tagObjects:[]};Util.$installed=new Map,Util.$swfParser=null,Util.$Rad2Deg=180/Math.PI,Util.$JCT11280=Function(\'var a="zKV33~jZ4zN=~ji36XazM93y!{~k2y!o~k0ZlW6zN?3Wz3W?{EKzK[33[`y|;-~j^YOTz$!~kNy|L1$353~jV3zKk3~k-4P4zK_2+~jY4y!xYHR~jlz$_~jk4z$e3X5He<0y!wy|X3[:~l|VU[F3VZ056Hy!nz/m1XD61+1XY1E1=1y|bzKiz!H034zKj~mEz#c5ZA3-3X$1~mBz$$3~lyz#,4YN5~mEz#{ZKZ3V%7Y}!J3X-YEX_J(3~mAz =V;kE0/y|F3y!}~m>z/U~mI~j_2+~mA~jp2;~m@~k32;~m>V}2u~mEX#2x~mBy+x2242(~mBy,;2242(~may->2&XkG2;~mIy-_2&NXd2;~mGz,{4<6:.:B*B:XC4>6:.>B*BBXSA+A:X]E&E<~r#z+625z s2+zN=`HXI@YMXIAXZYUM8X4K/:Q!Z&33 3YWX[~mB`{zKt4z (zV/z 3zRw2%Wd39]S11z$PAXH5Xb;ZQWU1ZgWP%3~o@{Dgl#gd}T){Uo{y5_d{e@}C(} WU9|cB{w}bzvV|)[} H|zT}d||0~{]Q|(l{|x{iv{dw}(5}[Z|kuZ }cq{{y|ij}.I{idbof%cu^d}Rj^y|-M{ESYGYfYsZslS`?ZdYO__gLYRZ&fvb4oKfhSf^d<Yeasc1f&a=hnYG{QY{D`Bsa|u,}Dl|_Q{C%xK|Aq}C>|c#ryW=}eY{L+`)][YF_Ub^h4}[X|?r|u_ex}TL@YR]j{SrXgo*|Gv|rK}B#mu{R1}hs|dP{C7|^Qt3|@P{YVV |8&}#D}ef{e/{Rl|>Hni}R1{Z#{D[}CQlQ||E}[s{SG_+i8eplY[=[|ec[$YXn#`hcm}YR|{Ci(_[ql|?8p3]-}^t{wy}4la&pc|3e{Rp{LqiJ],] `kc(]@chYnrM`O^,ZLYhZB]ywyfGY~aex!_Qww{a!|)*lHrM{N+n&YYj~Z b c#e_[hZSon|rOt`}hBXa^i{lh|<0||r{KJ{kni)|x,|0auY{D!^Sce{w;|@S|cA}Xn{C1h${E]Z-XgZ*XPbp]^_qbH^e[`YM|a||+=]!Lc}]vdBc=j-YSZD]YmyYLYKZ9Z>Xcczc2{Yh}9Fc#Z.l{}(D{G{{mRhC|L3b#|xK[Bepj#ut`H[,{E9Yr}1b{[e]{ZFk7[ZYbZ0XL]}Ye[(`d}c!|*y`Dg=b;gR]Hm=hJho}R-[n}9;{N![7k_{UbmN]rf#pTe[x8}!Qcs_rs[m`|>N}^V})7{^r|/E}),}HH{OYe2{Skx)e<_.cj.cjoMhc^d}0uYZd!^J_@g,[[[?{i@][|3S}Yl3|!1|eZ|5IYw|1D}e7|Cv{OHbnx-`wvb[6[4} =g+k:{C:}ed{S]|2M]-}WZ|/q{LF|dYu^}Gs^c{Z=}h>|/i|{W]:|ip{N:|zt|S<{DH[p_tvD{N<[8Axo{X4a.^o^X>Yfa59`#ZBYgY~_t^9`jZHZn`>G[oajZ;X,i)Z.^~YJe ZiZF^{][[#Zt^|]Fjx]&_5dddW]P0C[-]}]d|y {C_jUql] |OpaA[Z{lp|rz}:Mu#]_Yf6{Ep?f5`$[6^D][^u[$[6^.Z8]]ePc2U/=]K^_+^M{q*|9tYuZ,s(dS{i=|bNbB{uG}0jZOa:[-]dYtu3]:]<{DJ_SZIqr_`l=Yt`gkTnXb3d@kiq0a`Z{|!B|}e}Ww{Sp,^Z|0>_Z}36|]A|-t}lt{R6pi|v8hPu#{C>YOZHYmg/Z4nicK[}hF_Bg|YRZ7c|crkzYZY}_iXcZ.|)U|L5{R~qi^Uga@Y[xb}&qdbd6h5|Btw[}c<{Ds53[Y7]?Z<|e0{L[ZK]mXKZ#Z2^tavf0`PE[OSOaP`4gi`qjdYMgys/?[nc,}EEb,eL]g[n{E_b/vcvgb.{kcwi`~v%|0:|iK{Jh_vf5lb}KL|(oi=LrzhhY_^@`zgf[~g)[J_0fk_V{T)}I_{D&_/d9W/|MU[)f$xW}?$xr4<{Lb{y4}&u{XJ|cm{Iu{jQ}CMkD{CX|7A}G~{kt)nB|d5|<-}WJ}@||d@|Iy}Ts|iL|/^|no|0;}L6{Pm]7}$zf:|r2}?C_k{R(}-w|`G{Gy[g]bVje=_0|PT{^Y^yjtT[[[l!Ye_`ZN]@[n_)j3nEgMa]YtYpZy].d-Y_cjb~Y~[nc~sCi3|zg}B0}do{O^{|$`_|D{}U&|0+{J3|8*]iayx{a{xJ_9|,c{Ee]QXlYb]$[%YMc*]w[aafe]aVYi[fZEii[xq2YQZHg]Y~h#|Y:thre^@^|_F^CbTbG_1^qf7{L-`VFx Zr|@EZ;gkZ@slgko`[e}T:{Cu^pddZ_`yav^Ea+[#ZBbSbO`elQfLui}.F|txYcbQ`XehcGe~fc^RlV{D_0ZAej[l&jShxG[ipB_=u:eU}3e8[=j|{D(}dO{Do[BYUZ0/]AYE]ALYhZcYlYP/^-^{Yt_1_-;YT`P4BZG=IOZ&]H[e]YYd[9^F[1YdZxZ?Z{Z<]Ba2[5Yb[0Z4l?]d_;_)a?YGEYiYv`_XmZs4ZjY^Zb]6gqGaX^9Y}dXZr[g|]Y}K aFZp^k^F]M`^{O1Ys]ZCgCv4|E>}8eb7}l`{L5[Z_faQ|c2}Fj}hw^#|Ng|B||w2|Sh{v+[G}aB|MY}A{|8o}X~{E8paZ:]i^Njq]new)`-Z>haounWhN}c#{DfZ|fK]KqGZ=:u|fqoqcv}2ssm}.r{]{nIfV{JW)[K|,Z{Uxc|]l_KdCb%]cfobya3`p}G^|LZiSC]U|(X|kBlVg[kNo({O:g:|-N|qT}9?{MBiL}Sq{`P|3a|u.{Uaq:{_o|^S}jX{Fob0`;|#y_@[V[K|cw[<_ }KU|0F}d3|et{Q7{LuZttsmf^kYZ`Af`}$x}U`|Ww}d]| >}K,r&|XI|*e{C/a-bmr1fId4[;b>tQ_:]hk{b-pMge]gfpo.|(w[jgV{EC1Z,YhaY^q,_G[c_g[J0YX]`[h^hYK^_Yib,` {i6vf@YM^hdOKZZn(jgZ>bzSDc^Z%[[o9[2=/YHZ(_/Gu_`*|8z{DUZxYt^vuvZjhi^lc&gUd4|<UiA`z]$b/Z?l}YI^jaHxe|;F}l${sQ}5g}hA|e4}?o{ih}Uz{C)jPe4]H^J[Eg[|AMZMlc}:,{iz}#*|gc{Iq|/:|zK{l&}#u|myd{{M&v~nV};L|(g|I]ogddb0xsd7^V})$uQ{HzazsgxtsO^l}F>ZB]r|{7{j@cU^{{CbiYoHlng]f+nQ[bkTn/}<-d9q {KXadZYo+n|l[|lc}V2{[a{S4Zam~Za^`{HH{xx_SvF|ak=c^[v^7_rYT`ld@]:_ub%[$[m](Shu}G2{E.ZU_L_R{tz`vj(f?^}hswz}GdZ}{S:h`aD|?W|`dgG|if{a8|J1{N,}-Ao3{H#{mfsP|[ bzn+}_Q{MT{u4kHcj_q`eZj[8o0jy{p7}C|[}l){MuYY{|Ff!Ykn3{rT|m,^R|,R}$~Ykgx{P!]>iXh6[l[/}Jgcg{JYZ.^qYfYIZl[gZ#Xj[Pc7YyZD^+Yt;4;`e8YyZVbQ7YzZxXja.7SYl[s]2^/Ha$[6ZGYrb%XiYdf2]H]kZkZ*ZQ[ZYS^HZXcCc%Z|[(bVZ]]:OJQ_DZCg<[,]%Zaa [g{C00HY[c%[ChyZ,Z_`PbXa+eh`^&jPi0a[ggvhlekL]w{Yp^v}[e{~;k%a&k^|nR_z_Qng}[E}*Wq:{k^{FJZpXRhmh3^p>de^=_7`|ZbaAZtdhZ?n4ZL]u`9ZNc3g%[6b=e.ZVfC[ZZ^^^hD{E(9c(kyZ=bb|Sq{k`|vmr>izlH[u|e`}49}Y%}FT{[z{Rk}Bz{TCc/lMiAqkf(m$hDc;qooi[}^o:c^|Qm}a_{mrZ(pA`,}<2sY| adf_%|}`}Y5U;}/4|D>|$X{jw{C<|F.hK|*A{MRZ8Zsm?imZm_?brYWZrYx`yVZc3a@f?aK^ojEd {bN}/3ZH]/$YZhm^&j 9|(S|b]mF}UI{q&aM]LcrZ5^.|[j`T_V_Gak}9J[ ZCZD|^h{N9{~&[6Zd{}B}2O|cv]K}3s}Uy|l,fihW{EG`j_QOp~Z$F^zexS`dcISfhZBXP|.vn|_HYQ|)9|cr]<`&Z6]m_(ZhPcSg>`Z]5`~1`0Xcb4k1{O!bz|CN_T{LR|a/gFcD|j<{Z._[f)mPc:1`WtIaT1cgYkZOaVZOYFrEe[}T$}Ch}mk{K-^@]fH{Hdi`c*Z&|Kt{if[C{Q;{xYB`dYIX:ZB[}]*[{{p9|4GYRh2ao{DS|V+[zd$`F[ZXKadb*A] Ys]Maif~a/Z2bmclb8{Jro_rz|x9cHojbZ{GzZx_)]:{wAayeDlx}<=`g{H1{l#}9i|)=|lP{Qq}.({La|!Y{i2EZfp=c*}Cc{EDvVB|;g}2t{W4av^Bn=]ri,|y?|3+}T*ckZ*{Ffr5e%|sB{lx^0]eZb]9[SgAjS_D|uHZx]dive[c.YPkcq/}db{EQh&hQ|eg}G!ljil|BO]X{Qr_GkGl~YiYWu=c3eb}29v3|D|}4i||.{Mv})V{SP1{FX}CZW6{cm|vO{pS|e#}A~|1i}81|Mw}es|5[}3w{C`h9aL]o{}p[G`>i%a1Z@`Ln2bD[$_h`}ZOjhdTrH{[j_:k~kv[Sdu]CtL}41{I |[[{]Zp$]XjxjHt_eThoa#h>sSt8|gK|TVi[Y{t=}Bs|b7Zpr%{gt|Yo{CS[/{iteva|cf^hgn}($_c^wmb^Wm+|55jrbF|{9^ q6{C&c+ZKdJkq_xOYqZYSYXYl`8]-cxZAq/b%b*_Vsa[/Ybjac/OaGZ4fza|a)gY{P?| I|Y |,pi1n7}9bm9ad|=d{aV|2@[(}B`d&|Uz}B}{`q|/H|!JkM{FU|CB|.{}Az}#P|lk}K{|2rk7{^8^?`/|k>|Ka{Sq}Gz}io{DxZh[yK_#}9<{TRdgc]`~Z>JYmYJ]|`!ZKZ]gUcx|^E[rZCd`f9oQ[NcD_$ZlZ;Zr}mX|=!|$6ZPZYtIo%fj}CpcN|B,{VDw~gb}@hZg`Q{LcmA[(bo`<|@$|o1|Ss}9Z_}tC|G`{F/|9nd}i=}V-{L8aaeST]daRbujh^xlpq8|}zs4bj[S`J|]?G{P#{rD{]I`OlH{Hm]VYuSYUbRc*6[j`8]pZ[bt_/^Jc*[<Z?YE|Xb|?_Z^Vcas]h{t9|Uwd)_(=0^6Zb{Nc} E[qZAeX[a]P^|_J>e8`W^j_Y}R{{Jp__]Ee#e:iWb9q_wKbujrbR}CY`,{mJ}gz{Q^{t~N|? gSga`V_||:#mi}3t|/I`X{N*|ct|2g{km}gi|{={jC}F;|E}{ZZjYf*frmu}8Tdroi{T[|+~}HG{cJ}DM{Lp{Ctd&}$hi3|FZ| m}Kr|38}^c|m_|Tr{Qv|36}?Up>|;S{DV{k_as}BK{P}}9p|t`jR{sAm4{D=b4pWa[}Xi{EjwEkI}3S|E?u=X0{jf} S|NM|JC{qo^3cm]-|JUx/{Cj{s>{Crt[UXuv|D~|j|d{YXZR}Aq}0r}(_{pJfi_z}0b|-vi)Z mFe,{f4|q`b{}^Z{HM{rbeHZ|^x_o|XM|L%|uFXm}@C_{{Hhp%a7|0p[Xp+^K}9U{bP}: tT}B|}+$|b2|[^|~h{FAby[`{}xgygrt~h1[li`c4vz|,7p~b(|mviN}^pg[{N/|g3|^0c,gE|f%|7N{q[|tc|TKA{LU}I@|AZp(}G-sz{F |qZ{}F|f-}RGn6{Z]_5})B}UJ{FFb2]4ZI@v=k,]t_Dg5Bj]Z-]L]vrpdvdGlk|gF}G]|IW}Y0[G| /bo|Te^,_B}#n^^{QHYI[?hxg{[`]D^IYRYTb&kJ[cri[g_9]Ud~^_]<p@_e_XdNm-^/|5)|h_{J;{kacVopf!q;asqd}n)|.m|bf{QW|U)}b+{tL|w``N|to{t ZO|T]jF}CB|0Q{e5Zw|k |We}5:{HO{tPwf_uajjBfX}-V_C_{{r~gg|Ude;s+}KNXH}! `K}eW{Upwbk%ogaW}9EYN}YY|&v|SL{C3[5s.]Y]I]u{M6{pYZ`^,`ZbCYR[1mNg>rsk0Ym[jrE]RYiZTr*YJ{Ge|%-lf|y(`=[t}E6{k!|3)}Zk} ][G{E~cF{u3U.rJ|a9p#o#ZE|?|{sYc#vv{E=|LC}cu{N8`/`3`9rt[4|He{cq|iSYxY`}V |(Q|t4{C?]k_Vlvk)BZ^r<{CL}#h}R+[<|i=}X|{KAo]|W<`K{NW|Zx}#;|fe{IMr<|K~tJ_x}AyLZ?{GvbLnRgN}X&{H7|x~}Jm{]-| GpNu0}.ok>|c4{PYisrDZ|fwh9|hfo@{H~XSbO]Odv]%`N]b1Y]]|eIZ}_-ZA]aj,>eFn+j[aQ_+]h[J_m_g]%_wf.`%k1e#Z?{CvYu_B^|gk`Xfh^M3`afGZ-Z|[m{L}|k3cp[it ^>YUi~d>{T*}YJ{Q5{Jxa$hg|%4`}|LAgvb }G}{P=|<;Ux{_skR{cV|-*|s-{Mp|XP|$G|_J}c6cM{_=_D|*9^$ec{V;|4S{qO|w_|.7}d0|/D}e}|0G{Dq]Kdp{}dfDi>}B%{Gd|nl}lf{C-{y}|ANZr}#={T~|-(}c&{pI|ft{lsVP}){|@u}!W|bcmB{d?|iW|:dxj{PSkO|Hl]Li:}VYk@|2={fnWt{M3`cZ6|)}|Xj}BYa?vo{e4|L7|B7{L7|1W|lvYO}W8nJ|$Vih|{T{d*_1|:-n2dblk``fT{Ky|-%}m!|Xy|-a{Pz}[l{kFjz|iH}9N{WE{x,|jz}R {P|{D)c=nX|Kq|si}Ge{sh|[X{RF{t`|jsr*fYf,rK|/9}$}}Nf{y!1|<Std}4Wez{W${Fd_/^O[ooqaw_z[L`Nbv[;l7V[ii3_PeM}.h^viqYjZ*j1}+3{bt{DR[;UG}3Og,rS{JO{qw{d<_zbAh<R[1_r`iZTbv^^a}c{iEgQZ<exZFg.^Rb+`Uj{a+{z<[~r!]`[[|rZYR|?F|qppp]L|-d|}K}YZUM|=Y|ktm*}F]{D;g{uI|7kg^}%?Z%ca{N[_<q4xC]i|PqZC]n}.bDrnh0Wq{tr|OMn6tM|!6|T`{O`|>!]ji+]_bTeU}Tq|ds}n|{Gm{z,f)}&s{DPYJ`%{CGd5v4tvb*hUh~bf]z`jajiFqAii]bfy^U{Or|m+{I)cS|.9k:e3`^|xN}@Dnlis`B|Qo{`W|>||kA}Y}{ERYuYx`%[exd`]|OyiHtb}HofUYbFo![5|+]gD{NIZR|Go}.T{rh^4]S|C9_}xO^i`vfQ}C)bK{TL}cQ|79iu}9a];sj{P.o!f[Y]pM``Jda^Wc9ZarteBZClxtM{LW}l9|a.mU}KX}4@{I+f1}37|8u}9c|v${xGlz}jP{Dd1}e:}31}%3X$|22i<v+r@~mf{sN{C67G97855F4YL5}8f{DT|xy{sO{DXB334@55J1)4.G9A#JDYtXTYM4, YQD9;XbXm9SX]IB^4UN=Xn<5(;(F3YW@XkH-X_VM[DYM:5XP!T&Y`6|,^{IS-*D.H>:LXjYQ0I3XhAF:9:(==.F*3F1189K/7163D,:@|e2{LS36D4hq{Lw/84443@4.933:0307::6D7}&l{Mx657;89;,K5678H&93D(H<&<>0B90X^I;}Ag1{P%3A+>><975}[S{PZE453?4|T2{Q+5187;>447:81{C=hL6{Me^:=7ii{R=.=F<81;48?|h8}Uh{SE|,VxL{ST,7?9Y_5Xk3A#:$%YSYdXeKXOD8+TXh7(@>(YdXYHXl9J6X_5IXaL0N?3YK7Xh!1?XgYz9YEXhXaYPXhC3X`-YLY_XfVf[EGXZ5L8BXL9YHX]SYTXjLXdJ: YcXbQXg1PX]Yx4|Jr{Ys4.8YU+XIY`0N,<H%-H;:0@,74/:8546I=9177154870UC]d<C3HXl7ALYzXFXWP<<?E!88E5@03YYXJ?YJ@6YxX-YdXhYG|9o{`iXjY_>YVXe>AYFX[/(I@0841?):-B=14337:8=|14{c&93788|di{cW-0>0<097/A;N{FqYpugAFT%X/Yo3Yn,#=XlCYHYNX[Xk3YN:YRT4?)-YH%A5XlYF3C1=NWyY}>:74-C673<69545v {iT85YED=64=.F4..9878/D4378?48B3:7:7/1VX[f4{D,{l<5E75{dAbRB-8-@+;DBF/$ZfW8S<4YhXA.(5@*11YV8./S95C/0R-A4AXQYI7?68167B95HA1*<M3?1/@;/=54XbYP36}lc{qzSS38:19?,/39193574/66878Yw1X-87E6=;964X`T734:>86>1/=0;(I-1::7ALYGXhF+Xk[@W%TYbX7)KXdYEXi,H-XhYMRXfYK?XgXj.9HX_SX]YL1XmYJ>Y}WwIXiI-3-GXcYyXUYJ$X`Vs[7;XnYEZ;XF! 3;%8;PXX(N3Y[)Xi1YE&/ :;74YQ6X`33C;-(>Xm0(TYF/!YGXg8 9L5P01YPXO-5%C|qd{{/K/E6,=0144:361:955;6443@?B7*7:F89&F35YaX-CYf,XiFYRXE_e{}sF 0*7XRYPYfXa5YXXY8Xf8Y~XmA[9VjYj*#YMXIYOXk,HHX40YxYMXU8OXe;YFXLYuPXP?EB[QV0CXfY{:9XV[FWE0D6X^YVP*$4%OXiYQ(|xp|%c3{}V`1>Y`XH00:8/M6XhQ1:;3414|TE|&o@1*=81G8<3}6<|(f6>>>5-5:8;093B^3U*+*^*UT30XgYU&7*O1953)5@E78--F7YF*B&0:%P68W9Zn5974J9::3}Vk|-,C)=)1AJ4+<3YGXfY[XQXmT1M-XcYTYZXCYZXEYXXMYN,17>XIG*SaS|/eYJXbI?XdNZ+WRYP<F:R PXf;0Xg`$|1GX9YdXjLYxWX!ZIXGYaXNYm6X9YMX?9EXmZ&XZ#XQ>YeXRXfAY[4 ;0X!Zz0XdN$XhYL XIY^XGNXUYS/1YFXhYk.TXn4DXjB{jg|4DEX]:XcZMW=A.+QYL<LKXc[vV$+&PX*Z3XMYIXUQ:ZvW< YSXFZ,XBYeXMM)?Xa XiZ4/EXcP3%}&-|6~:1(-+YT$@XIYRBC<}&,|7aJ6}bp|8)K1|Xg|8C}[T|8Q.89;-964I38361<=/;883651467<7:>?1:.}le|:Z=39;1Y^)?:J=?XfLXbXi=Q0YVYOXaXiLXmJXO5?.SFXiCYW}-;|=u&D-X`N0X^,YzYRXO(QX_YW9`I|>hZ:N&X)DQXP@YH#XmNXi$YWX^=!G6YbYdX>XjY|XlX^XdYkX>YnXUXPYF)FXT[EVTMYmYJXmYSXmNXi#GXmT3X8HOX[ZiXN]IU2>8YdX1YbX<YfWuZ8XSXcZU%0;1XnXkZ_WTG,XZYX5YSX Yp 05G?XcYW(IXg6K/XlYP4XnI @XnO1W4Zp-9C@%QDYX+OYeX9>--YSXkD.YR%Q/Yo YUX].Xi<HYEZ2WdCE6YMXa7F)=,D>-@9/8@5=?7164;35387?N<618=6>7D+C50<6B03J0{Hj|N9$D,9I-,.KB3}m |NzE0::/81YqXjMXl7YG; [.W=Z0X4XQY]:MXiR,XgM?9$9>:?E;YE77VS[Y564760391?14941:0=:8B:;/1DXjFA-564=0B3XlH1+D85:0Q!B#:-6&N/:9<-R3/7Xn<*3J4.H:+334B.=>30H.;3833/76464665755:/83H6633:=;.>5645}&E|Y)?1/YG-,93&N3AE@5 <L1-G/8A0D858/30>8<549=@B8] V0[uVQYlXeD(P#ID&7T&7;Xi0;7T-$YE)E=1:E1GR):--0YI7=E<}n9|aT6783A>D7&4YG7=391W;Zx<5+>F#J39}o/|cc;6=A050EQXg8A1-}D-|d^5548083563695D?-.YOXd37I$@LYLWeYlX<Yd+YR A$;3-4YQ-9XmA0!9/XLY_YT(=5XdDI>YJ5XP1ZAW{9>X_6R(XhYO65&J%DA)C-!B:97#A9;@?F;&;(9=11/=657/H,<8}bz|j^5446>.L+&Y^8Xb6?(CYOXb*YF(8X`FYR(XPYVXmPQ%&DD(XmZXW??YOXZXfCYJ79,O)XnYF7K0!QXmXi4IYFRXS,6<%-:YO(+:-3Q!1E1:W,Zo}Am|n~;3580534*?3Zc4=9334361693:30C<6/717:<1/;>59&:4}6!|rS36=1?75<8}[B|s809983579I.A.>84758=108564741H*9E{L{|u%YQ<%6XfH.YUXe4YL@,>N}Tv|ve*G0X)Z;/)3@A74(4P&A1X:YVH97;,754*A66:1 D739E3553545558E4?-?K17/770843XAYf838A7K%N!YW4.$T19Z`WJ*0XdYJXTYOXNZ 1XaN1A+I&Xi.Xk3Z3GB&5%WhZ1+5#Y[X<4YMXhQYoQXVXbYQ8XSYUX4YXBXWDMG0WxZA[8V+Z8X;D],Va$%YeX?FXfX[XeYf<X:Z[WsYz8X_Y]%XmQ(!7BXIZFX]&YE3F$(1XgYgYE& +[+W!<YMYFXc;+PXCYI9YrWxGXY9DY[!GXiI7::)OC;*$.>N*HA@{C|}&k=:<TB83X`3YL+G4XiK]i}(fYK<=5$.FYE%4*5*H*6XkCYL=*6Xi6!Yi1KXR4YHXbC8Xj,B9ZbWx/XbYON#5B}Ue}+QKXnF1&YV5XmYQ0!*3IXBYb71?1B75XmF;0B976;H/RXU:YZX;BG-NXj;XjI>A#D3B636N;,*%<D:0;YRXY973H5)-4FXOYf0:0;/7759774;7;:/855:543L43<?6=E,.A4:C=L)%4YV!1(YE/4YF+ F3%;S;&JC:%/?YEXJ4GXf/YS-EXEYW,9;E}X$}547EXiK=51-?71C%?57;5>463553Zg90;6447?<>4:9.7538XgN{|!}9K/E&3-:D+YE1)YE/3;37/:05}n<}:UX8Yj4Yt864@JYK..G=.(A Q3%6K>3(P3#AYE$-6H/456*C=.XHY[#S.<780191;057C)=6HXj?955B:K1 E>-B/9,;5.!L?:0>/.@//:;7833YZ56<4:YE=/:7Z_WGC%3I6>XkC*&NA16X=Yz2$X:Y^&J48<99k8}CyB-61<18K946YO4{|N}E)YIB9K0L>4=46<1K0+R;6-=1883:478;4,S+3YJX`GJXh.Yp+Xm6MXcYpX(>7Yo,/:X=Z;Xi0YTYHXjYmXiXj;*;I-8S6N#XgY}.3XfYGO3C/$XjL$*NYX,1 6;YH&<XkK9C#I74.>}Hd`A748X[T450[n75<4439:18A107>|ET}Rf<1;14876/Yb983E<5.YNXd4149>,S=/4E/<306443G/06}0&}UkYSXFYF=44=-5095=88;63844,9E6644{PL}WA8:>)7+>763>>0/B3A545CCnT}Xm|dv}Xq1L/YNXk/H8;;.R63351YY747@15YE4J8;46;.38.>4A369.=-83,;Ye3?:3@YE.4-+N353;/;@(X[YYD>@/05-I*@.:551741Yf5>6A443<3535;.58/86=D4753442$635D1>0359NQ @73:3:>><Xn?;43C14 ?Y|X611YG1&<+,4<*,YLXl<1/AIXjF*N89A4Z576K1XbJ5YF.ZOWN.YGXO/YQ01:4G38Xl1;KI0YFXB=R<7;D/,/4>;$I,YGXm94@O35Yz66695385.>:6A#5}W7n^4336:4157597434433<3|XA}m`>=D>:4A.337370?-6Q96{`E|4A}C`|Qs{Mk|J+~r>|o,wHv>Vw}!c{H!|Gb|*Ca5}J||,U{t+{CN[!M65YXOY_*B,Y[Z9XaX[QYJYLXPYuZ%XcZ8LY[SYPYKZM<LMYG9OYqSQYM~[e{UJXmQYyZM_)>YjN1~[f3{aXFY|Yk:48YdH^NZ0|T){jVFYTZNFY^YTYN~[h{nPYMYn3I]`EYUYsYIZEYJ7Yw)YnXPQYH+Z.ZAZY]^Z1Y`YSZFZyGYHXLYG 8Yd#4~[i|+)YH9D?Y^F~Y7|-eYxZ^WHYdYfZQ~[j|3>~[k|3oYmYqY^XYYO=Z*4[]Z/OYLXhZ1YLZIXgYIHYEYK,<Y`YEXIGZI[3YOYcB4SZ!YHZ*&Y{Xi3~[l|JSY`Zz?Z,~[m|O=Yi>??XnYWXmYS617YVYIHZ(Z4[~L4/=~[n|Yu{P)|];YOHHZ}~[o33|a>~[r|aE]DH~[s|e$Zz~[t|kZFY~XhYXZB[`Y}~[u|{SZ&OYkYQYuZ2Zf8D~[v}% ~[w3},Q[X]+YGYeYPIS~[y}4aZ!YN^!6PZ*~[z}?E~[{3}CnZ=~[}}EdDZz/9A3(3S<,YR8.D=*XgYPYcXN3Z5 4)~[~}JW=$Yu.XX~] }KDX`PXdZ4XfYpTJLY[F5]X~[2Yp}U+DZJ::<446[m@~]#3}]1~]%}^LZwZQ5Z`/OT<Yh^ -~]&}jx[ ~m<z!%2+~ly4VY-~o>}p62yz!%2+Xf2+~ly4VY-zQ`z (=] 2z~o2",C={" ":0,"!":1},c=34,i=2,p,s="",u=String.fromCharCode,t=u(12539);for(;++c<127;)C[u(c)]=c^39&&c^92?i++:0;i=0;for(;0<=(c=C[a.charAt(i++)]);)if(16===c)if((c=C[a.charAt(i++)])<87){if(86===c)c=1879;for(;c--;)s+=u(++p)}else s+=s.substr(8272,360);else if(c<86)s+=u(p+=c<51?c-16:(c-55)*92+C[a.charAt(i++)]);else if((c=((c-86)*92+C[a.charAt(i++)])*92+C[a.charAt(i++)])<49152)s+=u(p=c<40960?c:c|57344);else{c&=511;for(;c--;)s+=t;p=12539}return s\')(),Util.$decodeToShiftJis=function(t){return t.replace(/%(8[1-9A-F]|[9E][0-9A-F]|F[0-9A-C])(%[4-689A-F][0-9A-F]|%7[0-9A-E]|[@-~])|%([0-7][0-9A-F]|A[1-9A-F]|[B-D][0-9A-F])/gi,(function(t){let e=parseInt(t.substring(1,3),16);const s=t.length;return 3===s?String.fromCharCode(e<160?e:e+65216):Util.$JCT11280.charAt(188*(e<160?e-129:e-193)+(4===s?t.charCodeAt(3)-64:(e=parseInt(t.substring(4),16))<127?e-64:e-65))}))},Util.$getTagObject=function(){return Util.$tagObjects.pop()||{placeObjects:[],sounds:[],removeObjects:[],frameLabel:[]}},Util.$poolTagObject=function(t){t.placeObjects.length=0,t.sounds.length=0,t.removeObjects.length=0,t.frameLabel.length=0,Util.$tagObjects.push(t)},Util.$createMovieClip=function(){const t={_$characterId:0,_$name:"MovieClip",_$controller:[],_$placeObjects:[],_$placeMap:[],_$labels:[],_$dictionary:[],_$sounds:[]};return t},Util.$getControllerAt=function(t,e,s){return s in t._$controller[e]?t._$controller[e][s]:null},Util.$addDictionary=function(t,e){const s=t._$dictionary.length,a={CharacterId:e.CharacterId,Depth:e.Depth,Name:null,ClipDepth:0,PlaceFlagHasImage:0|e.PlaceFlagHasImage,StartFrame:0|e.StartFrame,EndFrame:0|e.EndFrame};return e.PlaceFlagHasName&&(a.Name=e.Name),e.PlaceFlagHasClipDepth&&(a.ClipDepth=e.ClipDepth),t._$dictionary[s]=a,s},Util.$getBlendName=function(t){switch(t){case 1:case"normal":default:return"normal";case 2:case"layer":return"layer";case 3:case"multiply":return"multiply";case 4:case"screen":return"screen";case 5:case"lighten":return"lighten";case 6:case"darken":return"darken";case 7:case"difference":return"difference";case 8:case"add":return"add";case 9:case"subtract":return"subtract";case 10:case"invert":return"invert";case 11:case"alpha":return"alpha";case 12:case"erase":return"erase";case 13:case"overlay":return"overlay";case 14:case"hardlight":return"hardlight"}};class ByteStream{constructor(){this.clear()}clear(){this.data=null,this.bit_offset=0,this.byte_offset=0,this.bit_buffer=null}setData(t){this.data=t}getData(t){this.byteAlign();const e=this.byte_offset+t,s=this.data.subarray(this.byte_offset,e);return this.byte_offset=e,s}byteAlign(){this.bit_offset&&(this.byte_offset=this.byte_offset+(this.bit_offset+7)/8|0,this.bit_offset=0)}getDataUntil(t=0){this.byteAlign();let e="";for(;;){const t=this.data[this.byte_offset++];if(!t)break;if(10===t||13===t){e+="\\n";continue}let s=t.toString(16);1===s.length&&(s="0"+s),e+="%"+s}if(!e.length)return"";if(e.length>5&&"\\n"===e.substr(-5)&&(e=e.slice(0,-5)),t)return Util.$decodeToShiftJis(e);try{return decodeURIComponent(e)}catch(t){return Util.$decodeToShiftJis(e)}}byteCarry(){if(this.bit_offset>7)this.byte_offset=this.byte_offset+(0|(this.bit_offset+7)/8),this.bit_offset&=7;else for(;this.bit_offset<0;)--this.byte_offset,this.bit_offset+=8}getUIBits(t){let e=0;for(;t;)e<<=1,e|=this.getUIBit(),--t;return e}getUIBit(){return this.byteCarry(),this.data[this.byte_offset]>>7-this.bit_offset++&1}getSIBits(t){const e=this.getUIBits(t),s=e&1<<t-1;return s?-(e^2*s-1)-1:e}getUI8(){return this.byteAlign(),this.data[this.byte_offset++]}getUI16(){return this.byteAlign(),this.getUI8()|this.getUI8()<<8}getUI32(){return this.byteAlign(),this.getUI8()|(this.getUI8()|(this.getUI8()|this.getUI8()<<8)<<8)<<8}getFloat16(){const t=this.data[this.byte_offset++];let e=0;return e|=this.data[this.byte_offset++]<<8,e|=t<<0,e}getFloat32(){const t=this.data[this.byte_offset++],e=this.data[this.byte_offset++],s=this.data[this.byte_offset++];let a=0;a|=this.data[this.byte_offset++]<<24,a|=s<<16,a|=e<<8,a|=t<<0;const i=a>>23&255;return a&&2147483648!==a?(2147483648&a?-1:1)*(8388608|8388607&a)*Math.pow(2,i-127-23):0}incrementOffset(t,e){this.byte_offset+=t,this.bit_offset+=e,this.byteCarry()}setOffset(t,e){this.byte_offset=t,this.bit_offset=e}}class SwfParser{constructor(){this.byteStream=new ByteStream,this.currentPosition={x:0,y:0},this.jpegTables=null,this.characters=[],this.frameInfo=[],this.fonts=new Map,this.textSettings=new Map,this.grids=new Map,this.version=0}clear(){this.byteStream.clear(),this.currentPosition.x=0,this.currentPosition.y=0,this.jpegTables=null,this.characters.length=0,this.frameInfo.length=0,this.version=0}getCharacter(t){return this.characters[t]}setCharacter(t,e,s){this.characters[t]=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:e},s)}getFont(t){return this.fonts.get(t)}setFont(t,e){this.fonts.set(t,e)}setTextSetting(t,e){this.textSettings.set(t,e)}setGrid(t,e){this.grids.set(t,e)}showFrame(t,e,s,a){let i,r;const h=s-1|0,o=e.frameLabel;i=o.length;for(let e=0;e<i;++e){const a=o[e];a.name in this.frameInfo&&(a.frame=this.frameInfo["@"+a.name]),t._$labels.push({label:a.name,frame:a.frame||s})}const n=e.sounds;i=0|n.length,i&&t._$sounds.push({frame:s,data:n.slice(0)});const l=e.removeObjects;i=l.length;for(let e=0;e<i;++e){const a=l[e],i=Util.$getControllerAt(t,h,a.Depth);t._$dictionary[i].EndFrame=s,Util.$installed.set(a.Depth,1)}s in a||(a[s]=[]),s in t._$controller||(t._$controller[s]=[]),s in t._$placeMap||(t._$placeMap[s]=[]);const c=e.placeObjects,b=h?a[h]:null;i=c.length;for(let e=0;e<i;++e){let i=null;const r=c[e];let o=null;h&&r.Depth in b&&(o=b[r.Depth]),0===r.PlaceFlagHasCharacter&&o&&(r.CharacterId=o.CharacterId);let n=!1;if((0===r.PlaceFlagMove||1===r.PlaceFlagMove&&1===r.PlaceFlagHasCharacter)&&(n=!0),h&&!n&&(i=Util.$getControllerAt(t,h,r.Depth),null===i&&(n=!0)),1===r.PlaceFlagMove&&o&&(1!==o.PlaceFlagHasMatrix||r.PlaceFlagHasMatrix||(r.PlaceFlagHasMatrix=1,r.Matrix=o.Matrix),1!==o.PlaceFlagHasColorTransform||r.PlaceFlagHasColorTransform||(r.PlaceFlagHasColorTransform=1,r.ColorTransform=o.ColorTransform),1!==o.PlaceFlagHasClipDepth||r.PlaceFlagHasClipDepth||(r.PlaceFlagHasClipDepth=1,r.ClipDepth=o.ClipDepth),1!==o.PlaceFlagHasRatio||r.PlaceFlagHasRatio||(r.PlaceFlagHasRatio=1,r.Ratio=o.Ratio),1!==o.PlaceFlagHasFilterList||r.PlaceFlagHasFilterList||(r.PlaceFlagHasFilterList=1,r.SurfaceFilterList=o.SurfaceFilterList),1!==o.PlaceFlagHasBlendMode||r.PlaceFlagHasBlendMode||(r.PlaceFlagHasBlendMode=1,r.BlendMode=o.BlendMode)),h&&!Util.$installed.has(r.Depth)){const e=Util.$getControllerAt(t,h,r.Depth);if(null!==e){const a=t._$dictionary[e];!a||0!==r.PlaceFlagMove&&1!==r.PlaceFlagHasCharacter||(a.EndFrame=0|s,t._$dictionary[e]=a,n=!0)}}if(n){if(r.StartFrame=0|s,r.EndFrame=0,1===r.PlaceFlagHasCharacter&&1===r.PlaceFlagMove){const e=Util.$getControllerAt(t,h,r.Depth),a=t._$dictionary[e];a.EndFrame=0|s,t._$dictionary[e]=a}i=Util.$addDictionary(t,r)}t._$controller[s][r.Depth]=i;const l=t._$placeObjects.length;t._$placeObjects[l]=this.buildPlaceObject(r),t._$placeMap[s][r.Depth]=l,Util.$installed.set(r.Depth,1),a[s][r.Depth]=r}if(h){let e;const o=t._$controller[h];r=Object.keys(o),i=r.length;for(let n=0;n<i;++n)e=0|r[n],Util.$installed.has(e)||(a[s][e]=a[h][e],t._$controller[s][e]=o[e]);const n=t._$placeMap[h];r=Object.keys(n),i=r.length;for(let a=0;a<i;++a)e=r[a],e in t._$placeMap[s]||(t._$placeMap[s][e]=n[e])}Util.$installed.clear()}buildPlaceObject(t){const e={matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],filters:null,blendMode:"normal"};return t.PlaceFlagHasMatrix&&(e.matrix=t.Matrix),t.PlaceFlagHasColorTransform&&(e.colorTransform=t.ColorTransform),t.PlaceFlagHasFilterList&&(e.surfaceFilterList=t.SurfaceFilterList),t.PlaceFlagHasBlendMode&&(e.blendMode=Util.$getBlendName(t.BlendMode)),t.PlaceFlagHasRatio&&(e.ratio=t.Ratio||0),e}postData(t){if(this.textSettings.size){for(let[t,e]of this.textSettings){const s=this.characters[t];s&&(s._$textSetting=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:s}))}this.textSettings.clear()}if(this.grids.size){for(let[t,e]of this.grids){const s=this.characters[t];s&&(s._$grid=e,globalThis.postMessage({infoKey:"character",characterId:t,piece:s}))}this.grids.clear()}if(this.fonts.size){for(let[t,e]of this.fonts){if(!e._$hasLayout){globalThis.postMessage({infoKey:"font",index:t,piece:e});continue}const s=e._$glyphShapeTable,a=e._$zoneTable;e._$glyphShapeTable=[],e._$zoneTable=a?[]:null,globalThis.postMessage({infoKey:"font",index:t,piece:e},[e._$advanceTable.buffer,e._$codeTable.buffer]);const i=s.length;if(i){const e=[],a=[];for(let r=0;r<i;++r){const i=s[r];e.push(i),a.push(i.records.buffer),e.length>256&&(globalThis.postMessage({infoKey:"font_shape",index:t,pieces:e},a),a.length=0,e.length=0)}e.length&&globalThis.postMessage({infoKey:"font_shape",index:t,pieces:e},a)}if(a)for(;a.length;){const e=Math.min(256,a.length);globalThis.postMessage({infoKey:"font_zone",index:t,pieces:a.splice(0,e)})}}this.fonts.clear()}for(let e=1;e<t._$controller.length;++e){const s=t._$controller[e];t._$controller[e]=s.filter((()=>!0))}this.setCharacter(0,t)}parseTags(t,e){const s=Util.$getTagObject();let a=1;const i=[],r=this.byteStream;for(;r.byte_offset<t;){const h=r.byte_offset;if(h+2>t)break;const o=r.getUI16(),n=o>>6;let l=63&o;if(63===l){if(h+6>t){r.byte_offset=h,r.bit_offset=0;break}l=r.getUI32()}const c=r.byte_offset;this.parseTag(n,l,e,a,s,i),1===n&&(++a,s.placeObjects.length=0,s.sounds.length=0,s.removeObjects.length=0,s.frameLabel.length=0);const b=r.byte_offset-c|0;b!==l&&b<l&&(r.byte_offset=r.byte_offset+(l-b)),r.bit_offset=0}Util.$poolTagObject(s)}parseTag(t,e,s,a,i,r){switch(t){case 28:i.removeObjects.push({Frame:a,Depth:this.byteStream.getUI16()});break;case 4:case 26:case 70:i.placeObjects.push(this.parsePlaceObject(t,e));break;case 39:{const t=this.byteStream.byte_offset+e,s=this.byteStream.getUI16();this.byteStream.getUI16();const a=Util.$createMovieClip();a._$characterId=s,this.parseTags(t,a);for(let t=1;t<a._$controller.length;++t){const e=a._$controller[t];a._$controller[t]=e.filter((()=>!0))}this.setCharacter(s,a)}break;case 1:this.showFrame(s,i,a,r);break;case 2:case 22:case 32:case 83:e<10?this.byteStream.byte_offset+=e:this.parseDefineShape(t);break;case 20:case 36:this.parseDefineBitsLossLess(t,e);break;case 6:case 21:case 35:case 90:this.parseDefineBits(t,e,this.jpegTables);break;case 15:case 89:i.sounds.push(this.parseStartSound(t));break;case 10:case 48:case 75:this.parseDefineFont(t,e);break;case 14:this.parseDefineSound(e);break;case 13:case 62:this.parseDefineFontInfo(t,e);break;case 43:i.frameLabel.push(this.parseFrameLabel());break;case 11:case 33:this.parseDefineText(t);break;case 37:this.parseDefineEditText(t);break;case 7:case 34:this.parseDefineButton(t,e);break;case 88:this.parseDefineFontName();break;case 8:e&&(this.jpegTables=this.parseJPEGTables(e));break;case 46:case 84:this.parseDefineMorphShape(t);break;case 18:case 45:this.parseSoundStreamHead(t);break;case 17:this.parseDefineButtonSound();break;case 73:this.parseDefineFontAlignZones();break;case 74:this.parseCSMTextSettings(t);break;case 19:this.parseSoundStreamBlock(t,e);break;case 78:this.parseDefineScalingGrid();break;case 5:console.log("TODO RemoveObject type 5."),i.removeObjects.push({CharacterId:this.byteStream.getUI16(),Depth:this.byteStream.getUI16()});break;case 76:this.parseSymbolClass();break;case 0:case 27:case 30:case 67:case 68:case 79:case 80:case 81:case 85:case 92:default:break;case 86:case 56:case 9:case 40:case 24:case 63:case 64:case 69:case 65:case 77:case 60:case 61:case 41:case 87:case 59:case 12:case 72:case 82:this.byteStream.byte_offset+=e;break;case 3:case 16:case 23:case 25:case 29:case 31:case 38:case 42:case 44:case 47:case 49:case 52:case 53:case 54:case 55:case 57:case 58:case 66:case 71:case 91:case 93:console.log("[TODO] tagType -> "+t)}}parseSymbolClass(){const t=this.byteStream.getUI16();if(t){const e=[];for(let s=0;s<t;++s){const t=this.byteStream.getUI16(),s=this.byteStream.getDataUntil();e[e.length]={tagId:t,ns:s},128===e.length&&(globalThis.postMessage({infoKey:"_$symbols",pieces:e}),e.length=0)}e.length&&globalThis.postMessage({infoKey:"_$symbols",pieces:e})}}parseDefineShape(t){const e=0|this.byteStream.getUI16(),s=this.rect();if(83===t){const t={};this.rect(),this.byteStream.getUIBits(5),t.UsesFillWindingRule=this.byteStream.getUIBits(1),t.UsesNonScalingStrokes=this.byteStream.getUIBits(1),t.UsesScalingStrokes=this.byteStream.getUIBits(1)}const a=this.shapeWithStyle(t);this.setCharacter(e,{_$records:a,_$name:"Shape",_$bounds:s,_$characterId:e},[a.ShapeData.records.buffer])}rect(){this.byteStream.byteAlign();const t=this.byteStream.getUIBits(5);return{xMin:this.byteStream.getSIBits(t)/20,xMax:this.byteStream.getSIBits(t)/20,yMin:this.byteStream.getSIBits(t)/20,yMax:this.byteStream.getSIBits(t)/20}}shapeWithStyle(t){const e={};switch(t){case 46:case 84:break;default:e.fillStyles=this.fillStyleArray(t),e.lineStyles=this.lineStyleArray(t)}const s=this.byteStream.getUI8(),a=s>>4,i=15&s;return e.ShapeData=this.shapeRecords(t,{FillBits:a,LineBits:i}),e}fillStyleArray(t){let e=0|this.byteStream.getUI8();t>2&&255===e&&(e=this.byteStream.getUI16());const s=[];for(let a=0;a<e;++a)s[s.length]=this.fillStyle(t);return s}fillStyle(t){const e=this.byteStream.getUI8(),s={};switch(s.fillStyleType=e,e){case 0:switch(t){case 32:case 83:s.Color=this.rgba();break;case 46:case 84:s.StartColor=this.rgba(),s.EndColor=this.rgba();break;default:s.Color=this.rgb()}break;case 16:case 18:switch(t){case 46:case 84:s.startGradientMatrix=this.matrix(),s.endGradientMatrix=this.matrix(),s.gradient=this.gradient(t);break;default:s.gradientMatrix=this.matrix(),s.gradient=this.gradient(t)}break;case 19:s.gradientMatrix=this.matrix(),s.gradient=this.focalGradient(t);break;case 64:case 65:case 66:case 67:switch(s.bitmapId=this.byteStream.getUI16(),t){case 46:case 84:s.startBitmapMatrix=this.matrix(),s.endBitmapMatrix=this.matrix();break;default:s.bitmapMatrix=this.matrix()}}return s}rgb(){return{R:0|this.byteStream.getUI8(),G:0|this.byteStream.getUI8(),B:0|this.byteStream.getUI8(),A:1}}rgba(){return{R:this.byteStream.getUI8(),G:this.byteStream.getUI8(),B:this.byteStream.getUI8(),A:this.byteStream.getUI8()/255}}matrix(){this.byteStream.byteAlign();const t=[1,0,0,1,0,0];if(this.byteStream.getUIBit()){const e=this.byteStream.getUIBits(5);t[0]=this.byteStream.getSIBits(e)/65536,t[3]=this.byteStream.getSIBits(e)/65536}if(this.byteStream.getUIBit()){const e=this.byteStream.getUIBits(5);t[1]=this.byteStream.getSIBits(e)/65536,t[2]=this.byteStream.getSIBits(e)/65536}const e=this.byteStream.getUIBits(5);return t[4]=this.byteStream.getSIBits(e)/20,t[5]=this.byteStream.getSIBits(e)/20,t}gradient(t){let e,s=0,a=0;switch(this.byteStream.byteAlign(),t){case 46:case 84:e=this.byteStream.getUI8();break;default:s=this.byteStream.getUIBits(2),a=this.byteStream.getUIBits(2),e=this.byteStream.getUIBits(4)}const i=[];for(let s=0;s<e;++s)i[i.length]=this.gradientRecord(t);return{SpreadMode:s,InterpolationMode:a,GradientRecords:i,FocalPoint:0}}gradientRecord(t){switch(t){case 46:case 84:return{StartRatio:this.byteStream.getUI8()/255,StartColor:this.rgba(),EndRatio:this.byteStream.getUI8()/255,EndColor:this.rgba()};default:return{Ratio:this.byteStream.getUI8()/255,Color:t<32?this.rgb():this.rgba()}}}focalGradient(t){this.byteStream.byteAlign();const e=this.byteStream.getUIBits(2),s=this.byteStream.getUIBits(2),a=this.byteStream.getUIBits(4),i=[];for(let e=0;e<a;++e)i[i.length]=this.gradientRecord(t);return{SpreadMode:e,InterpolationMode:s,GradientRecords:i,FocalPoint:this.byteStream.getFloat16()}}lineStyleArray(t){let e=this.byteStream.getUI8();t>2&&255===e&&(e=this.byteStream.getUI16());const s=[];for(let a=0;a<e;++a)s[s.length]=this.lineStyles(t);return s}lineStyles(t){const e={fillStyleType:0};switch(t){case 46:e.StartWidth=this.byteStream.getUI16()/20,e.EndWidth=this.byteStream.getUI16()/20,e.StartColor=this.rgba(),e.EndColor=this.rgba();break;case 84:e.StartWidth=this.byteStream.getUI16()/20,e.EndWidth=this.byteStream.getUI16()/20,e.StartCapStyle=this.byteStream.getUIBits(2),e.JoinStyle=this.byteStream.getUIBits(2),e.HasFillFlag=this.byteStream.getUIBit(),e.NoHScaleFlag=this.byteStream.getUIBit(),e.NoVScaleFlag=this.byteStream.getUIBit(),e.PixelHintingFlag=this.byteStream.getUIBit(),this.byteStream.getUIBits(5),e.NoClose=this.byteStream.getUIBit(),e.EndCapStyle=this.byteStream.getUIBits(2),2===e.JoinStyle&&(e.MiterLimitFactor=this.byteStream.getUI16()/20),e.HasFillFlag?e.FillType=this.fillStyle(t):(e.StartColor=this.rgba(),e.EndColor=this.rgba());break;case 83:e.Width=this.byteStream.getUI16()/20,e.StartCapStyle=this.byteStream.getUIBits(2),e.JoinStyle=this.byteStream.getUIBits(2),e.HasFillFlag=this.byteStream.getUIBit(),e.NoHScaleFlag=this.byteStream.getUIBit(),e.NoVScaleFlag=this.byteStream.getUIBit(),e.PixelHintingFlag=this.byteStream.getUIBit(),this.byteStream.getUIBits(5),e.NoClose=this.byteStream.getUIBit(),e.EndCapStyle=this.byteStream.getUIBits(2),2===e.JoinStyle&&(e.MiterLimitFactor=this.byteStream.getUI16()),e.HasFillFlag?e.FillType=this.fillStyle(t):e.Color=this.rgba();break;case 32:e.Width=this.byteStream.getUI16()/20,e.Color=this.rgba(),e.JoinStyle=0,e.StartCapStyle=0,e.EndCapStyle=0;break;default:e.Width=this.byteStream.getUI16()/20,e.Color=this.rgb(),e.JoinStyle=0,e.StartCapStyle=0,e.EndCapStyle=0}return e}shapeRecords(t,e){this.currentPosition.x=0,this.currentPosition.y=0;const s=[],a=[];for(;;){const i=this.byteStream.getUIBits(6);if(32&i){const e=15&i;if(16&i){this.straightEdgeRecord(t,e,s);continue}this.curvedEdgeRecord(t,e,s)}else{if(!i){s.push(-1),this.byteStream.byteAlign();break}this.styleChangeRecord(t,i,e,s,a)}}const i={records:new Int32Array(s)};return a.length&&(i.styles=a),i}straightEdgeRecord(t,e,s){let a=0,i=0;this.byteStream.getUIBit()?(a=this.byteStream.getSIBits(e+2),i=this.byteStream.getSIBits(e+2)):this.byteStream.getUIBit()?i=this.byteStream.getSIBits(e+2):a=this.byteStream.getSIBits(e+2);let r=a,h=i;switch(t){case 46:case 84:break;default:r=this.currentPosition.x+a,h=this.currentPosition.y+i,this.currentPosition.x=r,this.currentPosition.y=h}s.push(0,0,r,h)}curvedEdgeRecord(t,e,s){const a=this.byteStream.getSIBits(e+2),i=this.byteStream.getSIBits(e+2),r=this.byteStream.getSIBits(e+2),h=this.byteStream.getSIBits(e+2);let o=a,n=i,l=r,c=h;switch(t){case 46:case 84:break;default:o=this.currentPosition.x+a,n=this.currentPosition.y+i,l=o+r,c=n+h,this.currentPosition.x=l,this.currentPosition.y=c}s.push(0,1,o,n,l,c)}styleChangeRecord(t,e,s,a,i){const r=e>>4&1,h=e>>3&1,o=e>>2&1,n=e>>1&1,l=1&e;let c=0,b=0;if(l){const t=this.byteStream.getUIBits(5);c=this.byteStream.getSIBits(t),b=this.byteStream.getSIBits(t),this.currentPosition.x=c,this.currentPosition.y=b}const g=n?this.byteStream.getUIBits(s.FillBits):0,y=o?this.byteStream.getUIBits(s.FillBits):0,S=h?this.byteStream.getUIBits(s.LineBits):0;let m=null,f=null,d=0,Y=0;if(r){m=this.fillStyleArray(t),f=this.lineStyleArray(t);const e=this.byteStream.getUI8();s.FillBits=d=e>>4,s.LineBits=Y=15&e}a.push(1,r),r&&(a.push(d,Y),i.push({FillStyles:m,LineStyles:f})),a.push(l),l&&a.push(c,b),a.push(n),n&&a.push(g),a.push(o),o&&a.push(y),a.push(h),h&&a.push(S)}parseDefineBitsLossLess(t,e){const s=this.byteStream.byte_offset,a=this.byteStream.getUI16(),i=this.byteStream.getUI8(),r=this.byteStream.getUI16(),h=this.byteStream.getUI16(),o=36===t,n=3===i?this.byteStream.getUI8()+1:0;let l=r*h*4;if(3===i){l=(r+((r+3&-4)-r|0))*h+n*(o?4:3)}const c=e-(this.byteStream.byte_offset-s),b=this.byteStream.byte_offset;this.byteStream.byte_offset+=c;const g=this.byteStream.data.slice(b,this.byteStream.byte_offset),y={width:r,height:h,format:i,fileSize:l,tableSize:n,isAlpha:o,color:o?4278190080:0,_$name:"lossless",_$characterId:a,buffer:g};this.setCharacter(a,y,[g.buffer])}parseJPEGTables(t){const e=this.byteStream.byte_offset;return this.byteStream.byte_offset+=t,{offset:e,length:this.byteStream.byte_offset}}parseDefineBits(t,e,s=null){const a=this.byteStream.byte_offset,i=this.byteStream.getUI16(),r=this.byteStream.byte_offset-a,h=35===t||90===t?this.byteStream.getUI32():e-r;if(90===t){const t=this.byteStream.getUI16();console.log("TODO DeblockParam",t)}const o=this.byteStream.byte_offset;this.byteStream.byte_offset+=h;let n=this.byteStream.data.slice(o,this.byteStream.byte_offset);if(s){const t=this.byteStream.data.subarray(s.offset,s.length);if(t.length>4&&255===n[0]&&216===n[1]){const e=t.length-2,s=n.length,a=new Uint8Array(e+s);a.set(t.subarray(0,e),0),a.set(n.subarray(2,s),e),n=a}}const l={infoKey:"character",_$name:"imageData",_$characterId:i,jpegData:n,alphaData:null},c=[];c.push(n.buffer);let b=!1;const g=a+e-this.byteStream.byte_offset;if(g){b=!0;const t=this.byteStream.byte_offset;this.byteStream.byte_offset+=g;const e=this.byteStream.data.slice(t,this.byteStream.byte_offset);l.alphaData=e,c.push(e.buffer)}l.isAlpha=b,l.color=b?4278190080:0,this.setCharacter(i,l,c)}parseDefineFont(t,e){const s=this.byteStream.byte_offset+e|0,a=this.byteStream.getUI16(),i=this.getFont(a)||{};let r=0,h=0,o=0;if(48===t||75===t){const t=this.byteStream.getUI8();i._$hasLayout=t>>>7&1,i._$shiftJIS=t>>>6&1,i._$smallText=t>>>5&1,i._$ANSI=t>>>4&1,h=t>>>3&1,o=t>>>2&1,i._$italic=t>>>1&1,i._$bold=1&t,this.byteStream.byteAlign(),i._$languageCode=this.byteStream.getUI8();const e=this.byteStream.getUI8();if(e){const t=0|this.byteStream.byte_offset;i._$fontName=this.getFontName(this.byteStream.getDataUntil()),this.byteStream.byte_offset=t+e|0}r=this.byteStream.getUI16(),i._$numGlyphs=r}const n=0|this.byteStream.byte_offset;if(10===t&&(r=this.byteStream.getUI16()),r){const e=[];10===t&&(e[0]=r,r/=2,r-=1);let s=0;if(1===h){for(let t=0;t<r;++t)e[e.length]=this.byteStream.getUI32();10!==t&&(s=this.byteStream.getUI32())}else{for(let t=0;t<r;++t)e[e.length]=this.byteStream.getUI16();10!==t&&(s=this.byteStream.getUI16())}const a=[];10===t&&(r+=1);for(let s=0;s<r;++s){this.byteStream.setOffset(e[s]+n,0);const i=this.byteStream.getUI8(),r={FillBits:i>>4,LineBits:15&i};a[a.length]=this.shapeRecords(t,r)}switch(i._$glyphShapeTable=a,t){case 48:case 75:if(this.byteStream.setOffset(s+n,0),1===o){const t=new Uint16Array(r);for(let e=0;e<r;++e)t[e]=this.byteStream.getUI16();i._$codeTable=t}else{const t=new Uint8Array(r);for(let e=0;e<r;++e)t[e]=this.byteStream.getUI8();i._$codeTable=t}if(i._$hasLayout){i._$ascent=this.byteStream.getUI16(),i._$descent=this.byteStream.getUI16(),i._$leading=this.byteStream.getUI16();const e=new Uint16Array(r);for(let t=0;t<r;++t)e[t]=this.byteStream.getUI16();i._$advanceTable=e;const s=[];for(let t=0;t<r;++t)s[s.length]=this.rect();if(75===t){const t=this.byteStream.getUI16(),e=[];for(let s=0;s<t;++s){const t=o?this.byteStream.getUI16():this.byteStream.getUI8(),s=o?this.byteStream.getUI16():this.byteStream.getUI8(),a=this.byteStream.getSIBits(16);e[e.length]={FontKerningCode1:t,FontKerningCode2:s,FontKerningAdjustment:a}}i._$kerningRecords=e}}}}this.byteStream.byte_offset=0|s,this.setFont(a,i)}parseDefineFontInfo(t,e){const s=this.byteStream.byte_offset+e|0,a=this.byteStream.getUI16();let i=this.getFont(a);i||(i={});const r=this.byteStream.getUI8(),h=this.byteStream.getData(r);let o="";for(let t=0;t<r;++t)h[t]>127||(o+=String.fromCharCode(h[t]));this.byteStream.getUIBits(2),i._$smallText=this.byteStream.getUIBits(1),i._$shiftJIS=this.byteStream.getUIBits(1),i._$ANSI=this.byteStream.getUIBits(1),i._$italic=this.byteStream.getUIBits(1),i._$bold=this.byteStream.getUIBits(1);const n=this.byteStream.getUIBits(1);62===t&&(i._$languageCode=this.byteStream.getUI8());const l=i._$shiftJIS||2===i._$languageCode?Util.$decodeToShiftJis(o):decodeURIComponent(o);i._$fontName=this.getFontName(l),this.byteStream.byteAlign();const c=[];let b=null;if(!0==(1===n||62===t)){for(;this.byteStream.byte_offset<s;)c[c.length]=this.byteStream.getUI16();b=new Uint16Array(c)}else{for(;this.byteStream.byte_offset<s;)c[c.length]=this.byteStream.getUI8();b=new Uint8Array(c)}i._$codeTable=b,this.setFont(a,i)}getFontName(t){const e=0|t.length;switch(0===t.substr(e-1).charCodeAt(0)&&(t=t.slice(0,-1)),t){case"_sans":return"_sans";case"_serif":return"_serif";case"_typewriter":return"_typewriter";case"_等幅":return"Osaka";default:return"_"===t.substr(0,1)?"sans-serif":t}}parseDefineFontName(){this.byteStream.getUI16(),this.byteStream.getDataUntil(),this.byteStream.getDataUntil()}parseDefineText(t){const e={_$name:"StaticText"};e._$characterId=0|this.byteStream.getUI16(),e._$bounds=this.rect(),e._$baseMatrix=this.matrix(),e._$shapeRecords=null;const s=this.byteStream.getUI8(),a=this.byteStream.getUI8();e._$textRecords=this.getTextRecords(t,s,a),this.setCharacter(e._$characterId,e)}getTextRecords(t,e,s){const a=[];for(;0!==this.byteStream.getUI8();){this.byteStream.incrementOffset(-1,0);const i={};i.TextRecordType=this.byteStream.getUIBits(1),i.StyleFlagsReserved=this.byteStream.getUIBits(3),i.StyleFlagsHasFont=this.byteStream.getUIBits(1),i.StyleFlagsHasColor=this.byteStream.getUIBits(1),i.StyleFlagsHasYOffset=this.byteStream.getUIBits(1),i.StyleFlagsHasXOffset=this.byteStream.getUIBits(1),i.StyleFlagsHasFont&&(i.FontId=this.byteStream.getUI16()),i.StyleFlagsHasColor&&(i.TextColor=11===t?this.rgb():this.rgba()),i.StyleFlagsHasXOffset&&(i.XOffset=this.byteStream.getUI16()/20),i.StyleFlagsHasYOffset&&(i.YOffset=this.byteStream.getUI16()/20),i.StyleFlagsHasFont&&(i.TextHeight=this.byteStream.getUI16()),i.GlyphCount=this.byteStream.getUI8(),i.GlyphEntries=this.getGlyphEntries(i.GlyphCount,e,s),a[a.length]=i}return a}getGlyphEntries(t,e,s){const a=[];for(let i=0;i<t;++i)a[a.length]={GlyphIndex:this.byteStream.getUIBits(e),GlyphAdvance:this.byteStream.getSIBits(s)/20};return a}parseDefineEditText(){const t={_$ns:["flash","text"],_$name:"TextField"},e={},s=this.byteStream.getUI16();t._$characterId=s,t._$bounds=this.rect();const a=this.byteStream.getUI8(),i=a>>>7&1;t._$wordWrap=a>>>6&1,t._$multiline=a>>>5&1,t._$displayAsPassword=a>>>4&1;const r=a>>>3&1;t._$type="dynamic",r||(t._$type="input");const h=a>>>2&1,o=a>>>1&1,n=1&a,l=this.byteStream.getUI8(),c=l>>>7&1,b=l>>>5&1;t._$selectable=l>>>4&1,t._$border=l>>>3&1;const g=l>>>1&1,y=1&l;t._$border&&(t._$background=!0);let S=0;if(n){const s=this.byteStream.getUI16(),a=this.getFont(s);if(a){if(S=a._$shiftJIS,c){const t=this.byteStream.getDataUntil();console.log("TODO HasFontClass: ",t)}e._$font=a._$fontName,e._$size=this.byteStream.getUI16()/20,t._$fontId=0|s,t._$embedFonts=!(!y&&"embedded"!==a.fontType||t.displayAsPassword)}}if(h){const e=this.rgba();t._$textColor=(e.R<<16)+(e.G<<8)+e.B+255*e.A*16777216}if(o&&(t._$maxChars=this.byteStream.getUI16()),b){switch(this.byteStream.getUI8()){case 0:e._$align="left";break;case 1:e._$align="right";break;case 2:e._$align="center";break;case 3:e._$align="justify"}e._$leftMargin=this.byteStream.getUI16()/20,e._$rightMargin=this.byteStream.getUI16()/20,e._$indent=this.byteStream.getUI16(),e._$indent>=32768&&(e._$indent-=65536),e._$leading=this.byteStream.getUI16(),e._$leading>=32768&&(e._$leading-=65536),e._$indent/=20,e._$leading/=20}const m=this.byteStream.getDataUntil(S)+"";if(t._$text="",i){const e=this.byteStream.getDataUntil(S);if(!0==(1===g))t._$htmlText=e,t._$initText=!0;else t._$text=e}""!==m&&console.log("VariableName: ",m),t._$defaultTextFormat=[null,e._$font,e._$size,e._$color,e._$bold,e._$italic,e._$underline,e._$url,e._$target,e._$align,e._$leftMargin,e._$rightMargin,0,e._$leading,e._$indent],this.setCharacter(s,t)}parseDefineMorphShape(t){const e={};e.CharacterId=this.byteStream.getUI16(),e.StartBounds=this.rect(),e.EndBounds=this.rect(),84===t&&(e.StartEdgeBounds=this.rect(),e.EndEdgeBounds=this.rect(),this.byteStream.getUIBits(6),e.UsesNonScalingStrokes=this.byteStream.getUIBits(1),e.UsesScalingStrokes=this.byteStream.getUIBits(1));const s=this.byteStream.getUI32(),a=this.byteStream.byte_offset+s;e.MorphFillStyles=this.fillStyleArray(t),e.MorphLineStyles=this.lineStyleArray(t),e.StartEdges=this.shapeWithStyle(t),this.byteStream.byte_offset!==a&&(this.byteStream.byte_offset=a),e.EndEdges=this.shapeWithStyle(t);const i={x:0,y:0},r={x:0,y:0},h=e.StartEdges.ShapeData.records,o=e.EndEdges.ShapeData.records,n=h.length,l=o.length;let c=Math.max(n,l);const b=[],g=[];let y=0,S=0;for(;c>y||c>S;){const t=h[y++],e=o[S++];if(-1===t&&-1===e)break;switch(!0){case-1===t:case void 0===t:if(e){const t=o[S++];if(g.push(1,t),b.push(1,t),t){const t=o[S++],e=o[S++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=o[S++];if(g.push(e),b.push(e),e){const t=o[S++],e=o[S++];r.x=t,r.y=e,g.push(t,e),b.push(t,e)}const s=o[S++];if(g.push(s),b.push(s),s){const t=o[S++];g.push(t),b.push(t)}const a=o[S++];if(g.push(a),b.push(a),a){const t=o[S++];g.push(t),b.push(t)}const i=o[S++];if(g.push(i),b.push(i),i){const t=o[S++];g.push(t),b.push(t)}break}if(o[S++]){const t=o[S++],e=o[S++],s=o[S++],a=o[S++];r.x+=t+s,r.y+=e+a,g.push(0,1,t,e,s,a),b.push(0,1,t,e,s,a)}else{const t=o[S++],e=o[S++];r.x+=t,r.y+=e,g.push(0,0,t,e),b.push(0,0,t,e)}break;case-1===e:case void 0===e:if(t){const t=h[y++];if(g.push(1,t),b.push(1,t),t){const t=h[y++],e=h[y++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=h[y++];if(g.push(e),b.push(e),e){const t=h[y++],e=h[y++];i.x=t,i.y=e,g.push(t,e),b.push(t,e)}const s=h[y++];if(g.push(s),b.push(s),s){const t=h[y++];g.push(t),b.push(t)}const a=h[y++];if(g.push(a),b.push(a),a){const t=h[y++];g.push(t),b.push(t)}const r=h[y++];if(g.push(r),b.push(r),r){const t=h[y++];g.push(t),b.push(t)}break}if(h[y++]){const t=h[y++],e=h[y++],s=h[y++],a=h[y++];i.x+=t+s,i.y+=e+a,g.push(0,1,t,e,s,a),b.push(0,1,t,e,s,a)}else{const t=h[S++],e=h[S++];i.x+=t,i.y+=e,g.push(0,0,t,e),b.push(0,0,t,e)}break;case 1===t&&1===e:const s=h[y++];if(b.push(1,s),s){const t=h[y++],e=h[y++];b.push(t,e),console.log("TODO Parse Morph NewStyles")}const a=h[y++];if(b.push(a),a){const t=h[y++],e=h[y++];i.x=t,i.y=e,b.push(t,e)}const n=h[y++];if(b.push(n),n){const t=h[y++];b.push(t)}const l=h[y++];if(b.push(l),l){const t=h[y++];b.push(t)}const c=h[y++];if(b.push(c),c){const t=h[y++];b.push(t)}const m=o[S++];if(g.push(1,m),m){const t=o[S++],e=o[S++];g.push(t,e),console.log("TODO Parse Morph NewStyles")}const f=o[S++];if(g.push(f),f){const t=o[S++],e=o[S++];i.x=t,i.y=e,g.push(t,e)}const d=o[S++];if(g.push(d),d){const t=o[S++];g.push(t)}const Y=o[S++];if(g.push(Y),Y){const t=o[S++];g.push(t)}const I=o[S++];if(g.push(I),I){const t=o[S++];g.push(t)}break;case 0===t&&0===e:if(h[y++]){const t=h[y++],e=h[y++],s=h[y++],a=h[y++];i.x=s,i.y=a,b.push(0,1,t,e,s,a)}else{const t=h[y++],e=h[y++];i.x=t,i.y=e,b.push(0,0,t,e)}if(o[S++]){const t=o[S++],e=o[S++],s=o[S++],a=o[S++];r.x=s,r.y=a,g.push(0,1,t,e,s,a)}else{const t=o[S++],e=o[S++];r.x=t,r.y=e,g.push(0,0,t,e)}break;case 1===t&&0===e:{const t=h[y++];if(g.push(1,t),b.push(1,t),t){const t=h[y++],e=h[y++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=h[y++];if(g.push(e),b.push(e),e){const t=h[y++],e=h[y++];i.x=t,i.y=e,g.push(t,e),b.push(t,e)}const s=h[y++];if(g.push(s),b.push(s),s){const t=h[y++];g.push(t),b.push(t)}const a=h[y++];if(g.push(a),b.push(a),a){const t=h[y++];g.push(t),b.push(t)}const r=h[y++];if(g.push(r),b.push(r),r){const t=h[y++];g.push(t),b.push(t)}--S}break;case 0===t&&1===e:{const t=o[S++];if(g.push(1,t),b.push(1,t),t){const t=o[S++],e=o[S++];g.push(t,e),b.push(t,e),console.log("TODO Parse Morph NewStyles")}const e=o[S++];if(g.push(e),b.push(e),e){const t=o[S++],e=o[S++];r.x=t,r.y=e,g.push(t,e),b.push(t,e)}const s=o[S++];if(g.push(s),b.push(s),s){const t=o[S++];g.push(t),b.push(t)}const a=o[S++];if(g.push(a),b.push(a),a){const t=o[S++];g.push(t),b.push(t)}const i=o[S++];if(g.push(i),b.push(i),i){const t=o[S++];g.push(t),b.push(t)}--y}}}b.push(-1),g.push(-1),e.StartEdges.ShapeData.records=new Int32Array(b),e.EndEdges.ShapeData.records=new Int32Array(g),this.setCharacter(e.CharacterId,{_$ns:["flash","display"],_$name:"MorphShape",_$characterId:e.CharacterId,_$endBounds:e.EndBounds,_$endEdges:e.EndEdges,_$fillStyles:e.MorphFillStyles,_$lineStyles:e.MorphLineStyles,_$startBounds:e.StartBounds,_$startEdges:e.StartEdges,_$shapes:null,_$frameData:[],_$frameCreated:!1},[e.StartEdges.ShapeData.records.buffer,e.EndEdges.ShapeData.records.buffer])}parseFrameLabel(){return{name:this.byteStream.getDataUntil(),frame:0}}parseDefineButton(t,e){const s=this.byteStream.byte_offset+e|0,a={_$ns:["flash","display"],_$name:"SimpleButton"};a._$characterId=0|this.byteStream.getUI16();let i=0;7!==t&&(this.byteStream.getUIBits(7),a._$trackAsMenu=!!this.byteStream.getUIBits(1),i=0|this.byteStream.getUI16()),a._$characters=this.buttonCharacters(s),7===t?(i=s-this.byteStream.byte_offset|0,this.byteStream.byte_offset+=i):i>0&&(a._$actions=this.buttonActions(s)),this.setCharacter(a._$characterId,a),this.byteStream.byte_offset!==s&&(this.byteStream.byte_offset=0|s)}buttonCharacters(t){const e=[];for(;0!==this.byteStream.getUI8();){this.byteStream.incrementOffset(-1,0);const s=0|this.byteStream.byte_offset,a=this.buttonRecord();if(this.byteStream.byte_offset>t){this.byteStream.byte_offset=0|s;break}e[e.length]=a}return e}buttonRecord(){this.byteStream.getUIBits(2);const t={};return t.PlaceFlagHasBlendMode=this.byteStream.getUIBits(1),t.PlaceFlagHasFilterList=this.byteStream.getUIBits(1),t.ButtonStateHitTest=this.byteStream.getUIBits(1),t.ButtonStateDown=this.byteStream.getUIBits(1),t.ButtonStateOver=this.byteStream.getUIBits(1),t.ButtonStateUp=this.byteStream.getUIBits(1),t.CharacterId=this.byteStream.getUI16(),t.Depth=this.byteStream.getUI16(),t.PlaceFlagHasMatrix=1,t.Matrix=this.matrix(),t.ColorTransform=this.colorTransform(),t.PlaceFlagHasColorTransform=void 0===t.ColorTransform?0:1,t.PlaceFlagHasBlendMode&&(t.BlendMode=this.byteStream.getUI8()),t.PlaceFlagHasFilterList&&(t.SurfaceFilterList=this.getFilterList()),t.PlaceFlagHasRatio=0,t.PlaceFlagHasClipDepth=0,t.Sound=null,t}buttonActions(t){for(;;){const e={},s=0|this.byteStream.byte_offset,a=this.byteStream.getUI16();e.CondIdleToOverDown=this.byteStream.getUIBits(1),e.CondOutDownToIdle=this.byteStream.getUIBits(1),e.CondOutDownToOverDown=this.byteStream.getUIBits(1),e.CondOverDownToOutDown=this.byteStream.getUIBits(1),e.CondOverDownToOverUp=this.byteStream.getUIBits(1),e.CondOverUpToOverDown=this.byteStream.getUIBits(1),e.CondOverUpToIdle=this.byteStream.getUIBits(1),e.CondIdleToOverUp=this.byteStream.getUIBits(1),e.CondKeyPress=this.byteStream.getUIBits(7),e.CondOverDownToIdle=this.byteStream.getUIBits(1);const i=t-this.byteStream.byte_offset+1|0;if(this.byteStream.byte_offset+=i,!a)break;this.byteStream.byte_offset=s+a|0}return[]}parsePlaceObject(t,e){const s=this.byteStream.byte_offset,a={};if(a.tagType=t,4===t)return a.CharacterId=this.byteStream.getUI16(),a.Depth=this.byteStream.getUI16(),a.Matrix=this.matrix(),a.PlaceFlagHasMatrix=1,this.byteStream.byteAlign(),this.byteStream.byte_offset-s<e&&(a.ColorTransform=this.colorTransform(),a.PlaceFlagHasColorTransform=1),this.byteStream.byteAlign(),this.byteStream.byte_offset=s+e,a;const i=this.swfVersion;if(a.PlaceFlagHasClipActions=this.byteStream.getUIBits(1),a.PlaceFlagHasClipDepth=this.byteStream.getUIBits(1),a.PlaceFlagHasName=this.byteStream.getUIBits(1),a.PlaceFlagHasRatio=this.byteStream.getUIBits(1),a.PlaceFlagHasColorTransform=this.byteStream.getUIBits(1),a.PlaceFlagHasMatrix=this.byteStream.getUIBits(1),a.PlaceFlagHasCharacter=this.byteStream.getUIBits(1),a.PlaceFlagMove=this.byteStream.getUIBits(1),70===t&&(this.byteStream.getUIBits(1),a.PlaceFlagOpaqueBackground=this.byteStream.getUIBits(1),a.PlaceFlagHasVisible=this.byteStream.getUIBits(1),a.PlaceFlagHasImage=this.byteStream.getUIBits(1),a.PlaceFlagHasClassName=this.byteStream.getUIBits(1),a.PlaceFlagHasCacheAsBitmap=this.byteStream.getUIBits(1),a.PlaceFlagHasBlendMode=this.byteStream.getUIBits(1),a.PlaceFlagHasFilterList=this.byteStream.getUIBits(1)),a.Depth=this.byteStream.getUI16(),a.PlaceFlagHasClassName&&(a.ClassName=this.byteStream.getDataUntil(),console.log("TODO ",a.ClassName)),a.PlaceFlagHasCharacter&&(a.CharacterId=this.byteStream.getUI16()),a.PlaceFlagHasMatrix&&(a.Matrix=this.matrix()),a.PlaceFlagHasColorTransform&&(a.ColorTransform=this.colorTransform()),a.PlaceFlagHasRatio&&(a.Ratio=this.byteStream.getUI16()),a.PlaceFlagHasName&&(a.Name=this.byteStream.getDataUntil()),a.PlaceFlagHasClipDepth&&(a.ClipDepth=this.byteStream.getUI16()),70===t&&(a.PlaceFlagHasFilterList&&(a.SurfaceFilterList=this.getFilterList()),a.PlaceFlagHasBlendMode&&(a.BlendMode=this.byteStream.getUI8()),a.PlaceFlagHasCacheAsBitmap&&(a.BitmapCache=this.byteStream.getUI8()),a.PlaceFlagHasVisible&&(a.Visible=this.byteStream.getUI8()),a.PlaceFlagOpaqueBackground&&(a.BackgroundColor=this.rgba())),a.PlaceFlagHasClipActions){this.byteStream.getUI16(),a.AllEventFlags=this.parseClipEventFlags();const t=s+e;for(;this.byteStream.byte_offset<t;){const e=this.parseClipActionRecord(t);if(t<=this.byteStream.byte_offset)break;if(!(i<=5?this.byteStream.getUI16():this.byteStream.getUI32()))break;this.byteStream.byte_offset-=i<=5?2:4,e.KeyCode&&(this.byteStream.byte_offset-=1)}}return this.byteStream.byteAlign(),this.byteStream.byte_offset=s+e,a}parseClipActionRecord(t){const e={},s=this.parseClipEventFlags();if(t>this.byteStream.byte_offset){const t=this.byteStream.getUI32();s.keyPress&&(e.KeyCode=this.byteStream.getUI8()),this.byteStream.byte_offset+=t}return e}parseClipEventFlags(){const t=this.swfVersion,e={};return e.keyUp=this.byteStream.getUIBits(1),e.keyDown=this.byteStream.getUIBits(1),e.mouseUp=this.byteStream.getUIBits(1),e.mouseDown=this.byteStream.getUIBits(1),e.mouseMove=this.byteStream.getUIBits(1),e.unload=this.byteStream.getUIBits(1),e.enterFrame=this.byteStream.getUIBits(1),e.load=this.byteStream.getUIBits(1),t>=6&&(e.dragOver=this.byteStream.getUIBits(1),e.rollOut=this.byteStream.getUIBits(1),e.rollOver=this.byteStream.getUIBits(1),e.releaseOutside=this.byteStream.getUIBits(1),e.release=this.byteStream.getUIBits(1),e.press=this.byteStream.getUIBits(1),e.initialize=this.byteStream.getUIBits(1)),e.data=this.byteStream.getUIBits(1),t>=6&&(this.byteStream.getUIBits(5),e.construct=this.byteStream.getUIBits(1),e.keyPress=this.byteStream.getUIBits(1),e.dragOut=this.byteStream.getUIBits(1),this.byteStream.getUIBits(8)),this.byteStream.byteAlign(),e}getFilterList(){const t=0|this.byteStream.getUI8(),e=[];for(let s=0;s<t;++s){const t=this.getFilter();t&&(e[e.length]=t)}return e.length?e:null}getFilter(){switch(0|this.byteStream.getUI8()){case 0:return this.dropShadowFilter();case 1:return this.blurFilter();case 2:return this.glowFilter();case 3:return this.bevelFilter();case 4:return this.gradientGlowFilter();case 5:return this.convolutionFilter();case 6:return this.colorMatrixFilter();case 7:return this.gradientBevelFilter()}}dropShadowFilter(){const t={},e=this.rgba(),s=e.A,a=e.R<<16|e.G<<8|e.B,i=this.byteStream.getUI32()/65536,r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536*Util.$Rad2Deg,o=this.byteStream.getUI32()/65536,n=this.byteStream.getFloat16()/256,l=!!this.byteStream.getUIBits(1),c=!!this.byteStream.getUIBits(1),b=!this.byteStream.getUIBits(1),g=this.byteStream.getUIBits(5);return t._$ns=["flash","filters"],t._$name="DropShadowFilter",t.params=[null,o,h,a,s,i,r,n,g,l,c,b],t}blurFilter(){const t={},e=this.byteStream.getUI32()/65536,s=this.byteStream.getUI32()/65536,a=this.byteStream.getUIBits(5);return this.byteStream.getUIBits(3),t._$ns=["flash","filters"],t._$name="BlurFilter",t.params=[null,e,s,a],t}glowFilter(){const t={},e=this.rgba(),s=e.A,a=e.R<<16|e.G<<8|e.B,i=this.byteStream.getUI32()/65536,r=this.byteStream.getUI32()/65536,h=this.byteStream.getFloat16()/256,o=!!this.byteStream.getUIBits(1),n=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const l=this.byteStream.getUIBits(5);return t._$ns=["flash","filters"],t._$name="GlowFilter",t.params=[null,a,s,i,r,h,l,o,n],t}bevelFilter(){const t={};let e=this.rgba();const s=e.A,a=e.R<<16|e.G<<8|e.B;e=this.rgba();const i=e.A,r=e.R<<16|e.G<<8|e.B,h=this.byteStream.getUI32()/65536,o=this.byteStream.getUI32()/65536,n=this.byteStream.getUI32()/65536*Util.$Rad2Deg,l=this.byteStream.getUI32()/65536,c=this.byteStream.getFloat16()/256,b=!!this.byteStream.getUIBits(1),g=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const y=this.byteStream.getUIBits(1),S=this.byteStream.getUIBits(4);let m="inner";return b||(m=y?"full":"outer"),t._$ns=["flash","filters"],t._$name="BevelFilter",t.params=[null,l,n,a,s,r,i,h,o,c,S,m,g],t}gradientGlowFilter(){const t={},e=0|this.byteStream.getUI8(),s=[],a=[];for(let t=0;t<e;++t){const t=this.rgba();a[a.length]=t.A,s[s.length]=t.R<<16|t.G<<8|t.B|0}const i=[];for(let t=0;t<e;++t)i[i.length]=+this.byteStream.getUI8()/255;const r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536,o=this.byteStream.getUI32()/65536*Util.$Rad2Deg,n=this.byteStream.getUI32()/65536,l=this.byteStream.getFloat16()/256,c=!!this.byteStream.getUIBits(1),b=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const g=this.byteStream.getUIBits(1),y=this.byteStream.getUIBits(4);let S="inner";return c||(S=g?"full":"outer"),t._$ns=["flash","filters"],t._$name="GradientGlowFilter",t.params=[null,n,o,s,a,i,r,h,l,y,S,b],t}convolutionFilter(){const t={},e=this.byteStream.getUI8(),s=this.byteStream.getUI8(),a=this.byteStream.getFloat32,i=this.byteStream.getFloat32,r=e*s,h=[];for(let t=0;t<r;++t)h[h.length]=this.byteStream.getFloat32();const o=this.rgba();this.byteStream.getUIBits(6);const n=!!this.byteStream.getUIBits(1),l=!!this.byteStream.getUIBits(1);return t._$ns=["flash","filters"],t._$name="ConvolutionFilter",t.params=[null,e,s,h,a,i,l,n,o],t}gradientBevelFilter(){const t={},e=0|this.byteStream.getUI8(),s=[],a=[];for(let t=0;t<e;++t){const t=this.rgba();a[a.length]=t.A,s[s.length]=t.R<<16|t.G<<8|t.B|0}const i=[];for(let t=0;t<e;++t)i[i.length]=+this.byteStream.getUI8()/255;const r=this.byteStream.getUI32()/65536,h=this.byteStream.getUI32()/65536,o=this.byteStream.getUI32()/65536*Util.$Rad2Deg,n=this.byteStream.getUI32()/65536,l=this.byteStream.getFloat16()/256,c=!!this.byteStream.getUIBits(1),b=!!this.byteStream.getUIBits(1);this.byteStream.getUIBits(1);const g=this.byteStream.getUIBits(1),y=this.byteStream.getUIBits(4);let S="inner";return c||(S=g?"full":"outer"),t._$ns=["flash","filters"],t._$name="GradientBevelFilter",t.params=[null,n,o,s,a,i,r,h,l,y,S,b],t}colorMatrixFilter(){const t={},e=[];for(let t=0;t<20;t++)e[e.length]=this.byteStream.getFloat32();return t._$ns=["flash","filters"],t._$name="ColorMatrixFilter",t.params=[null,e],t}colorTransform(){this.byteStream.byteAlign();const t=[1,1,1,1,0,0,0,0],e=this.byteStream.getUIBits(6),s=e>>5,a=15&e;return e>>4&1&&(t[0]=this.byteStream.getSIBits(a)/256,t[1]=this.byteStream.getSIBits(a)/256,t[2]=this.byteStream.getSIBits(a)/256,t[3]=this.byteStream.getSIBits(a)/256),s&&(t[4]=this.byteStream.getSIBits(a),t[5]=this.byteStream.getSIBits(a),t[6]=this.byteStream.getSIBits(a),t[7]=this.byteStream.getSIBits(a)),t}parseSoundStreamHead(t){const e={};e.tagType=t,this.byteStream.getUIBits(4),e.PlaybackSoundRate=this.byteStream.getUIBits(2),e.PlaybackSoundSize=this.byteStream.getUIBits(1),e.PlaybackSoundType=this.byteStream.getUIBits(1),e.StreamSoundCompression=this.byteStream.getUIBits(4),e.StreamSoundRate=this.byteStream.getUIBits(2),e.StreamSoundSize=this.byteStream.getUIBits(1),e.StreamSoundType=this.byteStream.getUIBits(1),e.StreamSoundSampleCount=this.byteStream.getUI16(),2===e.StreamSoundCompression&&(e.LatencySeek=this.byteStream.getSIBits(2))}parseDefineSound(t){const e=this.byteStream.byte_offset,s=this.byteStream.getUI16();this.byteStream.getUIBits(4),this.byteStream.getUIBits(2),this.byteStream.getUIBit(),this.byteStream.getUIBit(),this.byteStream.getUI32();const a=t-(this.byteStream.byte_offset-e),i={_$characterId:s,_$data:null,_$buffer:null};i._$length=this.byteStream.byte_offset+a,i._$offset=this.byteStream.byte_offset,this.byteStream.byte_offset=e+t,this.setCharacter(s,i)}parseStartSound(t){const e={};return e.SoundId=this.byteStream.getUI16(),89===t&&(e.SoundClassName=this.byteStream.getDataUntil()),e.SoundInfo=this.parseSoundInfo(),e}parseDefineButtonSound(){const t=this.byteStream.getUI16(),e=this.getCharacter(t);for(let t=0;t<4;t++){const s=this.byteStream.getUI16();if(s){const a=this.parseSoundInfo();switch(t){case 0:e.ButtonStateUpSoundInfo=a,e.ButtonStateUpSoundId=s;break;case 1:e.ButtonStateOverSoundInfo=a,e.ButtonStateOverSoundId=s;break;case 2:e.ButtonStateDownSoundInfo=a,e.ButtonStateDownSoundId=s;break;case 3:e.ButtonStateHitTestSoundInfo=a,e.ButtonStateHitTestSoundId=s}}}this.setCharacter(t,e)}parseSoundInfo(){this.byteStream.getUIBits(2);const t={};if(t.SyncStop=this.byteStream.getUIBit(),t.SyncNoMultiple=this.byteStream.getUIBit(),t.HasEnvelope=this.byteStream.getUIBit(),t.HasLoops=this.byteStream.getUIBit(),t.HasOutPoint=this.byteStream.getUIBit(),t.HasInPoint=this.byteStream.getUIBit(),t.HasInPoint&&(t.InPoint=this.byteStream.getUI32()),t.HasOutPoint&&(t.OutPoint=this.byteStream.getUI32()),t.HasLoops&&(t.LoopCount=this.byteStream.getUI16()),t.HasEnvelope){const e=this.byteStream.getUI8(),s=[];for(let t=0;t<e;++t)s[t]={Pos44:this.byteStream.getUI32(),LeftLevel:this.byteStream.getUI16(),RightLevel:this.byteStream.getUI16()};t.EnvPoints=e,t.EnvelopeRecords=s}return t}parseDefineFontAlignZones(){const t=this.byteStream.getUI16(),e=this.getFont(t)||{};e._$CSMTableHint=this.byteStream.getUIBits(2),this.byteStream.getUIBits(6);const s=0|e._$numGlyphs,a=[];for(let t=0;t<s;++t){const e=this.byteStream.getUI8(),s=[];for(let t=0;t<e;++t)s.push(this.byteStream.getFloat16()),s.push(this.byteStream.getFloat16());this.byteStream.getUIBits(6),this.byteStream.getUIBits(1),this.byteStream.getUIBits(1),a[t]=s}this.byteStream.byteAlign(),e._$zoneTable=a,this.setFont(t,e)}parseCSMTextSettings(t){const e=this.byteStream.getUI16(),s={};s.tagType=t,s.UseFlashType=this.byteStream.getUIBits(2),s.GridFit=this.byteStream.getUIBits(3),this.byteStream.getUIBits(3),s.Thickness=this.byteStream.getUI32(),s.Sharpness=this.byteStream.getUI32(),this.byteStream.getUI8(),this.setTextSetting(e,s)}parseSoundStreamBlock(t,e){const s={};s.tagType=t,s.compressed=this.byteStream.getData(e)}parseDefineScalingGrid(){const t=this.byteStream.getUI16(),e=this.rect();this.setGrid(t,e)}postCharacter(t,e){globalThis.postMessage({infoKey:"_$characters",characters:t},e),t.length=0,e&&(e.length=0)}}Util.$swfParser=new SwfParser,this.addEventListener("message",(function(t){const e=Util.$swfParser;e.version=t.data.version,e.byteStream.setData(t.data.buffer),e.byteStream.byte_offset=t.data.offset;const s=Util.$createMovieClip();e.parseTags(t.data.buffer.length,s),e.postData(s),e.clear()}));'],{type:"text/javascript"})),d.$parserWorker=null,d.$parserQueues=[],d.$parserWorkerWait=!1,d.$unlzmaHandler=function(e){if(e.target.onmessage=null,d.$unlzmaQueues.length){const e=d.$unlzmaQueues.shift(),t=new Worker(d.$unlzmaWorkerURL);t.onmessage=d.$unlzmaHandler.bind(e);const a=e._$byteStream._$buffer;t.postMessage({fileSize:e.fileSize,mode:e.mode,buffer:a},[a.buffer])}else d.$unlzmaWorkerActive=!1;this._$byteStream._$buffer=e.data,this.parseAndBuild()},d.$getImageType=e=>{switch(!0){case 255===e[0]&&216===e[1]:return"jpeg";case 71===e[0]&&73===e[1]&&70===e[2]:return"gif";case 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]:return"png";case 66===e[0]&&77===e[1]:return"bmp";default:return null}},d.$jpegDecodeHandler=()=>{const e=this.image,t=e.width,a=e.height,r=document.createElement("canvas");r.width=t,r.height=a;const s=r.getContext("2d");s.drawImage(e,0,0,t,a);const i=new Uint8Array(s.getImageData(0,0,t,a).data);this.jpegData=null,this.image=null;const n=d.$currentWorkSpace().getLibrary(this.libraryId);if(n.width=t,n.height=a,this.isAlpha){if(this.buffer=i,this.width=t,this.height=a,d.$unzipWorkerActive)return void d.$unzipQueues.push(this);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const e=d.$unzipWorker;e.onmessage=d.$unzipHandler.bind(this),e.postMessage(this,[this.buffer.buffer,this.alphaData.buffer])}else n._$buffer=i},d.$characters=new Map,d.$symbols=new Map,d.$fonts=new Map,d.$texts=new Map,d.$parserHandler=function(e){const t=e.target;switch(e.data.infoKey){case"character":{const t=e.data.piece,a=d.$currentWorkSpace(),r=a.nextLibraryId;switch(t.libraryId=r,t._$name){case"Shape":{const e=d.$libraryController.createInstance("shape",`Shape_${r}`,r);e.recodes=d.$vtc.convert(t._$records),e.inBitmap=e.recodes.pop(),e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax};const s=a.addLibrary(e);this._$folderId&&(s.folderId=this._$folderId),d.$characters.set(t._$characterId,r)}break;case"MovieClip":{for(let e=0;e<t._$dictionary.length;++e){const a=t._$dictionary[e];a.LibraryId=d.$characters.get(a.CharacterId)}const e=t._$characterId?`MovieClip_${r}`:this._$fileName,s=d.$libraryController.createInstance("container",e,r),i=a.addLibrary(s);this._$folderId&&(i.folderId=this._$folderId);let n=new Map,o=[];for(let e=0;e<t._$dictionary.length;++e){const a=t._$dictionary[e];-1===o.indexOf(a.Depth)&&(o.push(a.Depth),a.ClipDepth&&n.set(a.Depth,e))}if(o.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}})),n.size)for(const[e,a]of n){const r=[],s=t._$dictionary[a];for(let a=0;t._$dictionary.length>a;++a){const i=t._$dictionary[a];if(i.Depth>s.ClipDepth)break;i.Depth>e&&r.push(i)}for(let e=0;e<r.length;++e){const t=r[e],a=o.indexOf(t.Depth),i=o.splice(a,1)[0],n=o.indexOf(s.Depth);o.splice(n,0,i)}}let l=-1,c=-1;const h=o.length-1,u=new Map,m=[];for(let e=h;e>-1;--e){const t=new _;t.name="Layer_"+(h-e);const a=o[e];n.size&&(c>-1&&(a>c?(t.mode=d.LAYER_MODE_MASK_IN,t.maskId=l):(l=-1,c=-1)),n.has(a)&&(c=a,l=h-e,t.mode=d.LAYER_MODE_MASK)),m.push(t),u.set(a,t)}for(let e=0;e<o.length;++e)i.setLayer(e,m[e]);const g=[],p=t._$controller.length-1;for(let e=0;e<t._$dictionary.length;++e){const a=t._$dictionary[e],r=new f;r.libraryId=a.LibraryId,r.startFrame=a.StartFrame,r.endFrame=a.EndFrame||p+1,r.name=a.Name||"",g.push(r)}const y=new Map;for(let e=1;e<t._$controller.length;++e){const a=t._$controller[e];for(let r=0;r<a.length;++r){const s=a[r],i=t._$dictionary[s],n=u.get(i.Depth),o=g[s];y.has(s)||(y.set(s,-1),n.addCharacter(o));const l=t._$placeMap[e][i.Depth];if(y.get(s)!==l){const a=t._$placeObjects[l];o.setPlace(e,{frame:e,depth:0,matrix:a.matrix,colorTransform:a.colorTransform,blendMode:a.blendMode,filter:a.filters?a.filters:[],loop:d.$getDefaultLoopConfig()}),y.set(s,l)}}}for(let e=0;e<m.length;++e){const t={startFrame:-1},a=m[e];for(let e=1;e<=p;++e){a.getActiveCharacter(e).length?t.startFrame>0&&(a.addEmptyCharacter(new $({startFrame:t.startFrame,endFrame:e})),t.startFrame=-1):-1===t.startFrame&&(t.startFrame=e)}}d.$characters.set(t._$characterId,r)}break;case"lossless":{const e=d.$libraryController.createInstance("bitmap",`Bitmap_${r}`,r);t.mode="lossless",e.imageType="image/png",e.buffer=null,e.width=t.width,e.height=t.height;const s=a.addLibrary(e);if(this._$folderId&&(s.folderId=this._$folderId),d.$characters.set(t._$characterId,r),d.$unzipWorkerActive)return void d.$unzipQueues.push(t);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const i=d.$unzipWorker;i.onmessage=d.$unzipHandler.bind(t),i.postMessage(t,[t.buffer.buffer])}break;case"imageData":{const e=d.$libraryController.createInstance("bitmap",`Bitmap_${r}`,r),s=`image/${d.$getImageType(t.jpegData)}`;t.mode="jpegAlpha",t.imageType=s,e.imageType=s,e.buffer=null,e.width=0,e.height=0;const i=a.addLibrary(e);this._$folderId&&(i.folderId=this._$folderId),d.$characters.set(t._$characterId,r),t.image=new Image,t.image.decoding="async",t.image.src=URL.createObjectURL(new Blob([t.jpegData],{type:t.imageType})),t.image.decode().then(d.$jpegDecodeHandler.bind(t))}break;case"StaticText":{const e=d.$libraryController.createInstance("shape",`ShapeText_${r}`,r);e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax};const s=a.addLibrary(e);this._$folderId&&(s.folderId=this._$folderId),d.$characters.set(t._$characterId,r),d.$texts.set(d.$texts.size,t)}break;case"SimpleButton":console.log("TODO SimpleButton: ",t);d.$libraryController.createInstance("button",`Button_${r}`,r).bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax},d.$characters.set(t._$characterId,r);break;case"TextField":{const e=d.$libraryController.createInstance("text",`Text_${r}`,r);e.bounds={xMin:t._$bounds.xMin,xMax:t._$bounds.xMax,yMin:t._$bounds.yMin,yMax:t._$bounds.yMax},e.text=t._$text,e.inputType=t._$type,e.color=t._$textColor,e.font=t._$defaultTextFormat[1],e.size=t._$defaultTextFormat[2],e.align=t._$defaultTextFormat[7],e.leftMargin=t._$defaultTextFormat[8],e.rightMargin=t._$defaultTextFormat[9],e.leading=t._$defaultTextFormat[10],e.multiline=1===t._$multiline,e.wordWrap=1===t._$wordWrap,e.border=1===t._$border,t._$defaultTextFormat[4]&&t._$defaultTextFormat[5]?e.fontType=3:t._$defaultTextFormat[4]?e.fontType=2:t._$defaultTextFormat[5]&&(e.fontType=1),e.htmlText=t._$htmlText;const s=a.addLibrary(e);this._$folderId&&(s.folderId=this._$folderId),d.$characters.set(t._$characterId,r)}break;default:console.log("TODO: ",t)}if(t._$characterId)return}break;case"_$symbols":for(let t=0;t<e.data.pieces.length;++t){const a=e.data.pieces[t];d.$symbols.set(a.tagId,a.ns)}return;case"font":return void d.$fonts.set(e.data.index,e.data.piece);case"font_shape":{const t=d.$fonts.get(e.data.index);t._$glyphShapeTable.push.apply(t._$glyphShapeTable,e.data.pieces),d.$fonts.set(e.data.index,t)}return;case"font_zone":{const t=d.$fonts.get(e.data.index);t._$zoneTable.push.apply(t._$zoneTable,e.data.pieces),d.$fonts.set(e.data.index,t)}return}const a=d.$currentWorkSpace();for(const[e,t]of d.$symbols){a.getLibrary(e)._$symbol=`${t}`}if(d.$characters.clear(),d.$symbols.clear(),d.$fonts.clear(),d.$texts.clear(),d.$libraryController.reload(Array.from(a._$libraries.values())),t.onmessage=null,d.$parserQueues.length){const e=d.$parserQueues.shift();t.onmessage=d.$parserHandler.bind(e);const a=e._$byteStream._$buffer;t.postMessage({version:e._$swfVersion,offset:e._$offset,buffer:a},[a.buffer])}else d.$parserWorkerWait=!1},d.$boundsMatrix=(e,t)=>{const a=e.xMax*t[0]+e.yMax*t[2]+t[4],r=e.xMax*t[0]+e.yMin*t[2]+t[4],s=e.xMin*t[0]+e.yMax*t[2]+t[4],i=e.xMin*t[0]+e.yMin*t[2]+t[4],n=e.xMax*t[1]+e.yMax*t[3]+t[5],o=e.xMax*t[1]+e.yMin*t[3]+t[5],l=e.xMin*t[1]+e.yMax*t[3]+t[5],c=e.xMin*t[1]+e.yMin*t[3]+t[5];return{xMin:Math.min(Number.MAX_VALUE,a,r,s,i),xMax:Math.max(-Number.MAX_VALUE,a,r,s,i),yMin:Math.min(Number.MAX_VALUE,n,o,l,c),yMax:Math.max(-Number.MAX_VALUE,n,o,l,c)}},d.$intToRGB=e=>({R:(16711680&e)>>16,G:(65280&e)>>8,B:255&e}),d.$copyContainer=(e,t)=>{const a=d.$currentWorkSpace(),r=d.$workSpaces[d.$copyWorkSpaceId];t.has(e.id)||t.set(e.id,a.nextLibraryId),e.id=t.get(e.id),a.addLibrary(e);for(let s=0;s<e.layers.length;++s){const i=e.layers[s];for(let e=0;e<i.characters.length;++e){const s=i.characters[e];if(!t.has(s.libraryId)){t.set(s.libraryId,a.nextLibraryId);const e=r.getLibrary(s.libraryId).toObject();"container"===e.type?d.$copyContainer(e,t):(e.id=t.get(s.libraryId),a.addLibrary(e))}s.libraryId=t.get(s.libraryId)}}a.addLibrary(e)},d.$clearShapePointer=()=>{const e=document.getElementById("stage-area").children;for(let t=0;e.length>t;++t){const a=e[t];a.dataset.shapePointer&&(a.remove(),--t)}},d.$getDefaultLoopConfig=()=>({type:d.DEFAULT_LOOP,start:1,end:0}),d.$getFrame=(e,t,a,r)=>{const s=a-t.startFrame;let i=1;switch(e.loop.type){case 0:{const t=e.loop.end?e.loop.end:r;i=e.loop.start;for(let a=0;a<s;++a)++i,i>t&&(i=e.loop.start)}break;case 1:{const t=e.loop.end?e.loop.end:r;i=e.loop.start;for(let e=0;e<s;++e)if(++i,i>t){i=t;break}}break;case 2:i=e.loop.start;break;case 3:i=e.loop.end?e.loop.end:r;for(let t=0;t<s;++t)if(--i,e.loop.start>i){i=e.loop.start;break}break;case 4:{const t=e.loop.end?e.loop.end:r;i=t;for(let a=0;a<s;++a)--i,e.loop.start>i&&(i=t)}break;case 5:i=1;for(let e=0;e<s;++e)++i,i>r&&(i=1)}return i};d.$globalKeyboardCommand=new class{constructor(){this._$activeTool=null,this._$executeMulti=null,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),d.$setShortcut(d.$generateShortcutKey("z",{ctrl:!0}),this.undo),d.$setShortcut(d.$generateShortcutKey("z",{ctrl:!0,shift:!0}),this.redo),d.$setShortcut(d.$generateShortcutKey("s",{ctrl:!0}),d.$autoSave),d.$setShortcut("Enter",(()=>{d.$timelinePlayer.executeTimelinePlay()})),d.$setShortcut(d.$generateShortcutKey("Enter",{ctrl:!0}),d.$showPreview),d.$setShortcut(d.$generateShortcutKey("Enter",{ctrl:!0,shift:!0}),d.$project.publish),d.$setShortcut("Escape",d.$hidePreview),d.$setShortcut(d.$generateShortcutKey("p",{ctrl:!0}),this.changeRepeatMode),d.$setShortcut(d.$generateShortcutKey("ArrowRight",{ctrl:!0}),this.changeProject),d.$setShortcut(d.$generateShortcutKey("ArrowLeft",{ctrl:!0}),this.changeProject),d.$initializeEnd()}redo(){const e=d.$currentWorkSpace();e&&e.redo()}undo(){const e=d.$currentWorkSpace();e&&e.undo()}changeRepeatMode(){d.$timelinePlayer.repeat?d.$timelinePlayer.executeTimelineRepeat():d.$timelinePlayer.executeTimelineNoRepeat()}changeProject(e){const t=Array.from(document.getElementById("view-tab-area").children);let a=0;for(let e=0;e<t.length;++e){if((0|t[e].dataset.tabId)===d.$activeWorkSpaceId){a=e;break}}let r=null;if("ArrowLeft"===e.key?(r=t[a-1],r||(r=t[t.length-1])):(r=t[a+1],r||(r=t[0])),r){const e=0|r.dataset.tabId;d.$activeWorkSpaceId!==e&&d.$screenTab.activeTab({currentTarget:{dataset:{tabId:e}}})}}};class m{constructor(e,t=0,a=0,r=60,s=!0){this._$pngs=e,this._$width=t,this._$height=a,this._$fps=r,this._$loop=s?0:1,this._$crcTable=new Uint32Array(256);for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;this._$crcTable[e]=t}}_$crcUpdate(e,t,a,r){for(let s=0;s<r;s++)e=this._$crcTable[255&(e^t[a+s])]^e>>>8;return e}_$crc(e,t,a){return 4294967295^this._$crcUpdate(4294967295,e,t,a)}_$writeString(e,t,a){for(let r=0;r<a.length;r++)e[t+r]=a.charCodeAt(r)}encode(){return new Promise((e=>{let t=0,a=0;const r=[],s=new FileReader,i=new Uint8Array([137,80,78,71,13,10,26,10]);r.push(i.buffer);const n=new Uint8Array(25),o=new DataView(n.buffer);o.setUint32(0,13),this._$writeString(n,4,"IHDR"),o.setUint32(8,this._$width),o.setUint32(12,this._$height),o.setUint8(16,8),o.setUint8(17,6),o.setUint8(18,0),o.setUint8(19,0),o.setUint8(20,0),o.setUint32(21,this._$crc(n,4,17)),r.push(n.buffer);const l=new Uint8Array(20),c=new DataView(l.buffer);c.setUint32(0,8),this._$writeString(l,4,"acTL"),c.setUint32(8,this._$pngs.length),c.setUint32(12,this._$loop),c.setUint32(16,this._$crc(l,4,12)),r.push(l.buffer),s.onload=()=>{const i=new DataView(s.result);let n=8;const o=new Uint8Array(38),l=new DataView(o.buffer);l.setUint32(0,26),this._$writeString(o,4,"fcTL"),l.setUint32(8,t++),l.setUint32(12,this._$width),l.setUint32(16,this._$height),l.setUint32(20,0),l.setUint32(24,0),l.setUint16(28,1e3/this._$fps),l.setUint16(30,1e3),l.setUint8(32,0),l.setUint8(33,0),l.setUint32(34,this._$crc(o,4,30)),r.push(o.buffer);const c=s.result.byteLength;for(;;){const e=i.getUint32(n);if(1229209940===i.getUint32(n+4))if(a){let a=new Uint8Array(4),i=new DataView(a.buffer);i.setUint32(0,e+4),r.push(a.buffer),a=new Uint8Array(s.result.slice(n,n+e+8+4)),i=new DataView(a.buffer),this._$writeString(a,0,"fdAT"),i.setUint32(4,t++),i.setUint32(e+8,this._$crc(a,0,e+8)),r.push(a.buffer)}else r.push(s.result.slice(n,n+e+8+4));if(n+=e+12,n>=c)break}a++,this._$pngs.length>a?s.readAsArrayBuffer(this._$pngs[a]):(r.push(new Uint8Array([0,0,0,0,73,69,78,68,174,66,96,130]).buffer),e(new Blob(r,{type:"image/apng"})))},s.readAsArrayBuffer(this._$pngs[0])}))}}class g{constructor(e){this._$id=e.id,this._$name=e.name,this._$type=e.type,this._$symbol=e.symbol,this._$folderId=0|e.folderId}initialize(){}showController(e,t=""){d.$controller.hideObjectSetting(["sound-setting","ease-setting"]),d.$controller.showObjectSetting(["object-setting","reference-setting","transform-setting","color-setting","blend-setting","filter-setting","instance-setting"]),d.$instanceSelectController.createInstanceSelect(this),document.getElementById("object-name").value=t,document.getElementById("object-symbol").value=this.symbol;const a=e.matrix,r=Math.sqrt(a[0]*a[0]+a[1]*a[1]),s=Math.sqrt(a[2]*a[2]+a[3]*a[3]),i=Math.atan2(a[1],a[0])*d.$Rad2Deg,n=Math.atan2(-a[2],a[3])*d.$Rad2Deg;document.getElementById("transform-scale-x").value=Math.abs(Math.ceil(i-n))>=180?-100*r:100*r,document.getElementById("transform-scale-y").value=100*s,document.getElementById("transform-rotate").value=i;const o=e.colorTransform;document.getElementById("color-red-multiplier").value=100*o[0],document.getElementById("color-green-multiplier").value=100*o[1],document.getElementById("color-blue-multiplier").value=100*o[2],document.getElementById("color-alpha-multiplier").value=100*o[3],document.getElementById("color-red-offset").value=o[4],document.getElementById("color-green-offset").value=o[5],document.getElementById("color-blue-offset").value=o[6],document.getElementById("color-alpha-offset").value=o[7];const l=document.getElementById("blend-select").children;for(let t=0;t<l.length;++t){const a=l[t];if(a.value===e.blendMode){a.selected=!0;break}}d.$filterController.clearFilters();const c=document.getElementById("filter-setting-list"),h=e.filter.length;h&&(document.querySelectorAll(".filter-none")[0].style.display="none");for(let t=0;t<h;++t){const a=e.filter[t];d.$filterController[`add${a.name}`](c,a,!1)}}toObject(){}toImage(e,t,a,r){if(!e||!t)return d.$emptyImage;const{Sprite:s,BitmapData:i}=window.next2d.display,{Matrix:n,ColorTransform:o,Rectangle:l}=window.next2d.geom,c=this.createInstance(a,r),h=c.getBounds(),u=window.devicePixelRatio*d.$zoomScale,m=d.$multiplicationMatrix(d.$multiplicationMatrix([u,0,0,u,0,0],[a.matrix[0],a.matrix[1],a.matrix[2],a.matrix[3],0,0]),[1,0,0,1,-h.width/2-h.x,-h.height/2-h.y]),g=new n(u,0,0,u);g.translate(m[4]+e*u/2,m[5]+t*u/2);let p=Math.sqrt(a.matrix[0]*a.matrix[0]+a.matrix[1]*a.matrix[1]),f=Math.sqrt(a.matrix[2]*a.matrix[2]+a.matrix[3]*a.matrix[3]),$=0,y=0;if(a.filter.length){let r=new l(0,0,e,t);const s=[];for(let e=0;e<a.filter.length;++e){const t=a.filter[e];if(!t.state)continue;const i=t.createInstance();r=i._$generateFilterRect(r,p,f),s.push(i)}c.filters=s,e=Math.ceil(r.width),t=Math.ceil(r.height),$=r.x,y=r.y}const _=new s;_.addChild(new s).addChild(c),c.transform.matrix=new n(a.matrix[0],a.matrix[1],a.matrix[2],a.matrix[3],0,0),c.transform.colorTransform=new o(a.colorTransform[0],a.colorTransform[1],a.colorTransform[2],a.colorTransform[3],a.colorTransform[4],a.colorTransform[5],a.colorTransform[6],a.colorTransform[7]),0>$&&g.translate(-$*u,0),0>y&&g.translate(0,-y*u);const b=new i(Math.ceil(e*u),Math.ceil(t*u),!0,0);b.draw(_,g);const v=b.toImage();b.dispose(),v.width=e,v.height=t,v._$width=e,v._$height=t,v.draggable=!1;const E=this.getBounds(a.matrix,a,r);return v._$tx=E.xMin,v._$ty=E.yMin,v._$offsetX=0>$?$:0,v._$offsetY=0>y?y:0,v}toPublish(){}get defaultSymbol(){}createInstance(){}getBounds(){}remove(){const e=d.$currentWorkSpace(),t=e.scene;for(let a of e._$libraries.values())if("container"===a.type){for(let e of a._$layers.values()){let r=!1;const s=e._$characters;for(let t=0;t<s.length;++t){const a=s[t];if(this.id===a.libraryId){for(const t of a._$places.keys()){if(e.getActiveEmptyCharacter(t))continue;const r=a.getRange(t);e.addEmptyCharacter(new $({startFrame:r.startFrame,endFrame:r.endFrame}))}e.deleteCharacter(a.id),r=!0}}r&&t.id===a.id&&e.reloadStyle()}if(a._$sounds.size)for(const[e,t]of a._$sounds){const r=[];for(let e=0;e<t.length;++e){const a=t[e];this.id!==a.characterId&&r.push(a)}a._$sounds.set(e,r)}}}get preview(){const e=this.getBounds([1,0,0,1,0,0]);let t=Math.abs(e.xMax-e.xMin),a=Math.abs(e.yMax-e.yMin);if(!t||!a)return d.$emptyImage;let r=1;const s=150/a;t=t*s|0,a=a*s|0;const i=(0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0])-10;t>i&&(r=i/t,t=t*r|0,a=a*r|0);const n=this.toImage(Math.ceil(t),Math.ceil(a),{frame:1,matrix:[s*r,0,0,s*r,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[]});if(n.height!==a){const e=Math.min(150,n.height);n.width*=e/n.height,n.height=e}return n}get id(){return this._$id}set id(e){this._$id=0|e}get folderId(){return this._$folderId}set folderId(e){this._$folderId=0|e}get path(){const e=d.$currentWorkSpace();let t=this.name;if(this._$folderId){let a=this;for(;a._$folderId;)a=e.getLibrary(a._$folderId),t=`${a.name}/${t}`}return t}get name(){return this._$name}set name(e){if(this._$name=`${e}`,this.id){document.getElementById(`library-name-${this.id}`).textContent=this._$name}d.$currentWorkSpace().scene.id===this.id&&(document.getElementById("object-name").value=this._$name,document.getElementById("scene-name").textContent=this._$name)}get type(){return this._$type}set type(e){this._$type=`${e}`}get symbol(){return this._$symbol}set symbol(e){this._$symbol=`${e}`,this.id&&(document.getElementById(`library-symbol-name-${this.id}`).textContent=`${e}`)}}class p extends g{constructor(e){super(e),this.imageType=e.imageType,this.width=e.width,this.height=e.height,this._$buffer=null,e.buffer&&(this.buffer=e.buffer),this._$command=null,this._$binary=""}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["text-setting","loop-setting","video-setting","fill-color-setting","nine-slice-setting"])}getBounds(e=null){const t={xMin:0,xMax:this.width,yMin:0,yMax:this.height};return e?d.$boundsMatrix(t,e):t}get defaultSymbol(){return window.next2d.display.Shape.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let a=0;a<t;++a)this._$buffer[a]=255&e.charCodeAt(a);this._$binary=e}}}get imageType(){return this._$imageType}set imageType(e){this._$imageType=e}get width(){return this._$width}set width(e){this._$width=e}get height(){return this._$height}set height(e){this._$height=e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,width:this.width,height:this.height,imageType:this.imageType,buffer:this.buffer}}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,buffer:Array.from(this._$buffer),bounds:this.getBounds()}}createInstance(){const{Shape:e,BitmapData:t}=window.next2d.display,{width:a,height:r}=this,s=new e,i=new t(a,r,!0,0);return i._$buffer=this._$buffer,s.graphics.beginBitmapFill(i,null,!1).drawRect(0,0,a,r).endFill(),s.graphics._$maxAlpha=1,s.graphics._$canDraw=!0,s.graphics._$xMin=0,s.graphics._$xMax=this.width,s.graphics._$yMin=0,s.graphics._$yMax=this.height,s.graphics._$command=this._$command,s}}class f{constructor(e=null){this._$libraryId=-1,this._$layerId=-1,this._$places=new Map,this._$image=null,this._$currentFrame=0,this._$currentPlace=null,this._$screenX=0,this._$screenY=0,this._$offsetX=0,this._$offsetY=0,this._$name="",this._$tween=new Map,this._$referencePoint={x:0,y:0},e?(this._$id=e.id,this._$libraryId=e.libraryId,this.places=e.places,this._$name=e.name||"",this._$startFrame=e.startFrame,this._$endFrame=e.endFrame,this.tween=e.tween,this.referencePoint=e.referencePoint):(this._$id=d.$currentWorkSpace()._$characterId++,this._$startFrame=1,this._$endFrame=2)}showController(){const e=d.$currentWorkSpace().getLibrary(this.libraryId),t=d.$timelineFrame.currentFrame;e.showController(this.getPlace(t),this.name);const a=this.getRange(t);if(this.hasTween(a.startFrame)){d.$controller.showObjectSetting(["ease-setting"]);const e=this.getTween(a.startFrame),t=document.getElementById("ease-select").children;for(let a=0;a<t.length;++a){const r=t[a];if(r.value===e.method){r.selected=!0;break}}"custom"===e.method?d.$tweenController.showCustomArea():d.$tweenController.hideCustomArea()}}showShapeColor(e){d.$controller.hideObjectSetting(["fill-color-setting"]);const t=d.$currentWorkSpace().getLibrary(this.libraryId);if("shape"!==t.type)return;const a=d.$timelineFrame.currentFrame;t.showShapeColor(this.getPlace(a),e)}clone(){const e=new f(this.toObject());return e._$layerId=-1,e._$id=d.$currentWorkSpace()._$characterId++,e}remove(e){if(1===this._$places.size)e.deleteCharacter(this.id);else{const t=this.getRange(d.$timelineFrame.currentFrame);switch(!0){case t.startFrame===this.startFrame:this._$places.delete(this.startFrame),this.startFrame=t.endFrame;break;case t.endFrame===this.endFrame:this._$places.delete(t.startFrame),this.endFrame=t.startFrame;break;default:this.split(e,t.startFrame,t.endFrame)._$tween.size&&d.$tweenController.clearPointer()}if(this._$tween.has(t.startFrame)){this._$tween.delete(t.startFrame);for(let e=t.startFrame;e<t.endFrame;++e)this._$places.has(e)&&this._$places.delete(e);d.$tweenController.clearPointer()}}}relocationTween(e){if(!this._$tween.size)return;const t=this.getRange(e);this.hasTween(t.startFrame)&&(this.endFrame-1>e&&!this.hasTween(e)&&d.$timelineTool.executeTimelineKeyAdd(),d.$tweenController.relocationPlace(this,t.startFrame),d.$tweenController.clearPointer().relocationPointer())}getRange(e){if(1===this._$places.size)return{startFrame:this.startFrame,endFrame:this.endFrame};const t=Array.from(this._$places.keys());t.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));let a=0;for(;t.length;){const r=0|t.pop();if(e>=r){const e=this.getPlace(r);if(e.tweenFrame){const t=this.getTween(e.tweenFrame);return{startFrame:t.startFrame,endFrame:t.endFrame}}return{startFrame:r,endFrame:a||this.endFrame}}a=r}return{startFrame:this.startFrame,endFrame:this.endFrame}}getCloneTween(e){return JSON.parse(JSON.stringify(this.getTween(e)))}getTween(e){return this.hasTween(e)?this._$tween.get(e):null}setTween(e,t){this._$tween.set(e,t)}hasTween(e){return this._$tween.has(e)}deleteTween(e){return this._$tween.delete(e)}getBounds(){const e=d.$currentWorkSpace().getLibrary(this.libraryId),t=d.$timelineFrame.currentFrame,a=this.getPlace(t),r=a.loop&&5===a.loop.type?{startFrame:this.startFrame,endFrame:this.endFrame}:this.getRange(t),s=d.$currentFrame;d.$currentFrame=t;const i=e.getBounds(a.matrix,a,r);return d.$currentFrame=s,i}get rotation(){const e=d.$timelineFrame.currentFrame,t=this.getPlace(e).matrix;return Math.atan2(t[1],t[0])*d.$Rad2Deg}set rotation(e){const t=d.$timelineFrame.currentFrame,a=this.getPlace(t).matrix;let r=Math.atan2(a[1],a[0]),s=Math.atan2(-a[2],a[3]);const i=Math.sqrt(a[0]*a[0]+a[1]*a[1]),n=Math.sqrt(a[2]*a[2]+a[3]*a[3]),o=e*d.$Deg2Rad;s=s+o-r,r=o,a[0]=i*Math.cos(r),a[1]=i*Math.sin(r),a[2]=-n*Math.sin(s),a[3]=n*Math.cos(s)}get width(){const e=this.getBounds(),t=+Math.abs(e.xMax-e.xMin);return t!==1/0?t:0}set width(e){const t=this.getBounds(),a=Math.abs(t.xMax-t.xMin);this.scaleX=e/a}get scaleX(){const e=d.$timelineFrame.currentFrame,t=this.getPlace(e).matrix;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}set scaleX(e){const t=d.$timelineFrame.currentFrame,a=this.getPlace(t).matrix;if(a[1]){const t=Math.atan2(a[1],a[0]);a[1]=e*Math.sin(t),1===a[1]||-1===a[1]?a[0]=0:a[0]=e*Math.cos(t)}else a[0]=e}get height(){const e=this.getBounds(),t=+Math.abs(e.yMax-e.yMin);return t!==1/0?t:0}set height(e){const t=this.getBounds(),a=Math.abs(t.yMax-t.yMin);this.scaleY=e/a}get scaleY(){const e=d.$timelineFrame.currentFrame,t=this.getPlace(e).matrix;return Math.sqrt(t[2]*t[2]+t[3]*t[3])}set scaleY(e){const t=d.$timelineFrame.currentFrame,a=this.getPlace(t).matrix;if(a[2]){const t=Math.atan2(-a[2],a[3]);a[2]=-e*Math.sin(t),1===a[2]||-1===a[2]?a[3]=0:a[3]=e*Math.cos(t)}else a[3]=e}get x(){const e=d.$timelineFrame.currentFrame;return this.getPlace(e).matrix[4]}set x(e){const t=d.$timelineFrame.currentFrame;this.getPlace(t).matrix[4]=e;const a=this.getBounds();this.screenX=a.xMin;const r=document.getElementById(`character-${this.id}`);r&&(r.style.left=`${d.$offsetLeft+a.xMin*d.$zoomScale}px`)}get y(){const e=d.$timelineFrame.currentFrame;return this.getPlace(e).matrix[5]}set y(e){const t=d.$timelineFrame.currentFrame;this.getPlace(t).matrix[5]=e;const a=this.getBounds();this.screenY=a.yMin;const r=document.getElementById(`character-${this.id}`);r&&(r.style.top=`${d.$offsetTop+a.yMin*d.$zoomScale}px`)}get image(){if(!this._$image){const e=d.$currentWorkSpace().getLibrary(this.libraryId),t=d.$timelineFrame.currentFrame,a=this.getPlace(t),r=a.loop&&5===a.loop.type?{startFrame:this.startFrame,endFrame:this.endFrame}:this.getRange(t);d.$currentFrame=t;const s=e.getBounds(a.matrix,a,r),i=+Math.ceil(Math.abs(s.xMax-s.xMin)),n=+Math.ceil(Math.abs(s.yMax-s.yMin));switch(a.blendMode){case"alpha":case"erase":return d.$emptyImage;case"invert":this._$image=e.toImage(i,n,{frame:a.frame,matrix:a.matrix,colorTransform:[0,0,0,a.colorTransform[3],0,0,0,a.colorTransform[7]],blendMode:a.blendMode,filter:a.filter,tweenFrame:a.tweenFrame,loop:a.loop},r);break;default:this._$image=e.toImage(i,n,a,r)}switch(a.blendMode){case"add":this._$image.style.mixBlendMode="color-dodge";break;case"subtract":this._$image.style.filter="invert(100%)",this._$image.style.mixBlendMode="multiply";break;case"invert":this._$image.style.filter="invert(100%)",this._$image.style.mixBlendMode="difference";break;case"hardlight":this._$image.style.mixBlendMode="hard-light";break;case"alpha":case"erase":case"layer":break;default:this._$image.style.mixBlendMode=a.blendMode}this._$screenX=this._$image._$tx,this._$screenY=this._$image._$ty,this._$offsetX=this._$image._$offsetX,this._$offsetY=this._$image._$offsetY,this._$image.style.position="relative"}return this._$image}get offsetX(){return this._$offsetX}get offsetY(){return this._$offsetY}get screenX(){return this._$screenX}set screenX(e){this._$screenX=e}get screenY(){return this._$screenY}set screenY(e){this._$screenY=e}get id(){return this._$id}get libraryId(){return this._$libraryId}set libraryId(e){this._$libraryId=0|e}get name(){return this._$name}set name(e){(e+="").replace(" ",""),this._$name=e.trim()}get referencePoint(){return{x:this._$referencePoint.x,y:this._$referencePoint.y}}set referencePoint(e){e&&(this._$referencePoint.x=e.x,this._$referencePoint.y=e.y)}get tween(){const e=[];for(let[t,a]of this._$tween)e.push({frame:t,value:a});return e}set tween(e){for(let t=0;t<e.length;++t){const a=e[t];a.value.custom||(a.value.custom=d.$tweenController.createEasingObject()),this._$tween.set(0|a.frame,a.value)}}get places(){const e=d.$currentWorkSpace().getLibrary(this.libraryId),t=[];for(let[a,r]of this._$places){r.frame=a;const s=[];for(let e=0;e<r.filter.length;++e)s.push(r.filter[e].toObject());const i={frame:a,depth:r.depth,blendMode:r.blendMode,filter:s,matrix:r.matrix.slice(0),colorTransform:r.colorTransform.slice(0)};r.tweenFrame&&(i.tweenFrame=r.tweenFrame),"container"===e.type&&(r.loop?i.loop={type:r.loop.type,start:r.loop.start,end:r.loop.end}:i.loop=d.$getDefaultLoopConfig()),t.push(i)}return t}set places(e){for(let t=0;t<e.length;++t){const a=e[t],r=[];for(let e=0;a.filter.length>e;++e){const t=a.filter[e];r.push(new d.$filterClasses[t.name](t))}a.filter=null,a.filter=r,a.loop||(a.loop=d.$getDefaultLoopConfig()),this._$places.set(0|a.frame,a)}}getClonePlace(e){return JSON.parse(JSON.stringify(this.getPlace(e)))}getPlace(e){return this._$places.get(this.getNearPlaceFrame(0|e))}getNearPlaceFrame(e){if(this.hasPlace(e))return e;const t=Array.from(this._$places.keys());if(1===this._$places.size)return t[0];for(t.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));t.length;){const a=0|t.pop();if(e>a)return a}return 1}setPlace(e,t){t.frame=0|e,this._$places.set(0|e,t)}hasPlace(e){return this._$places.has(0|e)}deletePlace(e){this._$places.delete(0|e)}get startFrame(){return this._$startFrame}set startFrame(e){this._$startFrame=0|e}get endFrame(){return this._$endFrame}set endFrame(e){this._$endFrame=0|e}updateTweenPlace(e,t){for(let a=e;a<t;++a){const r=this.hasPlace(a)?this.getPlace(a):this.getClonePlace(t);r.tweenFrame=e,this.setPlace(a,r)}}updateTweenBlend(e){if(!this._$tween.size)return;const t=this.getRange(e),a=this.getPlace(t.startFrame);for(let e=t.startFrame;e<t.endFrame;++e)if(this.hasPlace(e))this.getPlace(e).blendMode=a.blendMode;else{const r=this.getClonePlace(t.startFrame);r.blendMode=a.blendMode,this.setPlace(e,r)}}updateTweenFilter(e){if(!this._$tween.size)return;const t=this.getRange(e),a=this.getPlace(t.startFrame);for(let e=t.startFrame;e<t.endFrame;++e){const r=[],s=a.filter.length;for(let e=0;e<s;++e)r.push(a.filter[e].clone());if(this.hasPlace(e))this.getPlace(e).filter=r;else{const a=this.getClonePlace(t.startFrame);a.filter=r,this.setPlace(e,a)}}}move(e){const t=new Map;for(const[a,r]of this._$places)r.frame=a+e,r.tweenFrame&&(r.tweenFrame+=e),t.set(r.frame,r);if(this._$places=t,this._$tween.size){const t=new Map;for(const[a,r]of this._$tween)r.startFrame+=e,r.endFrame+=e,t.set(a+e,r);this._$tween=t}this.startFrame+=e,this.endFrame+=e}split(e,t,a){if(t===this.startFrame&&a===this.endFrame)return console.log("delete"),e.deleteCharacter(this.id),this;if(t>this.startFrame){const a=new f;a._$libraryId=this._$libraryId,a._$startFrame=this.startFrame,a._$endFrame=t;const r=new Map;for(const[e,s]of this._$places)t>e?a.setPlace(e,s):r.set(e,s);const s=new Map;for(const[e,r]of this._$tween)t>e?a.setTween(e,r):s.set(e,r);e.addCharacter(a),this._$tween=s,this._$places=r,this._$startFrame=t}const r=new f;r._$libraryId=this._$libraryId,r._$startFrame=t,r._$endFrame=a;const s=[];for(const[e,i]of this._$places)t>e||e>=a||(s.push(e),r._$places.set(e,i));for(let e=0;e<s.length;++e)this._$places.delete(s[e]);s.length=0;for(const[e,i]of this._$tween)t>e||e>=a||(s.push(e),r._$tween.set(e,i));for(let e=0;e<s.length;++e)this._$tween.delete(s[e]);if(this._$places.size){const e=Array.from(this._$places.keys());this._$places.size>1&&e.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}})),this._$startFrame=0|e[0]}else e.deleteCharacter(this.id);return r}toObject(){return{id:this.id,name:this.name,libraryId:this.libraryId,places:this.places,startFrame:this.startFrame,endFrame:this.endFrame,tween:this.tween,referencePoint:this.referencePoint}}}class ${constructor(e=null){e?(this._$startFrame=e.startFrame,this._$endFrame=e.endFrame):(this._$startFrame=1,this._$endFrame=2)}get startFrame(){return this._$startFrame}set startFrame(e){this._$startFrame=0|e}get endFrame(){return this._$endFrame}set endFrame(e){this._$endFrame=0|e}toObject(){return{startFrame:this.startFrame,endFrame:this.endFrame}}move(e){this._$startFrame+=e,this._$endFrame+=e}split(e,t,a){e.deleteEmptyCharacter(this),t>this.startFrame&&e.addEmptyCharacter(new $({startFrame:this.startFrame,endFrame:t})),this.endFrame>a&&e.addEmptyCharacter(new $({startFrame:a,endFrame:this.endFrame}))}}class y extends g{constructor(e){super(e),this._$mode="clone",e.mode&&(this._$mode=e.mode)}get mode(){return this._$mode}set mode(e){this._$mode=e}remove(){const e=d.$currentWorkSpace();for(let t of e._$libraries.values())t.folderId&&t.folderId===this.id&&(t.remove(),e.removeLibrary(t.id))}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,mode:this.mode}}getInstanceIds(e){const t=d.$currentWorkSpace();for(const a of t._$libraries.values())a.folderId&&a.folderId===this.id&&("folder"!==a.type?e.push(a.id):a.getInstanceIds(e))}}class _{constructor(e=null){this._$id=0,this._$characters=[],this._$emptys=[],this._$instances=new Map,this._$maskId=null,this._$guideId=null,this._$name=null,this._$light=!1,this._$disable=!1,this._$lock=!1,this._$mode=d.LAYER_MODE_NORMAL,this._$color=fe.color,e&&(this._$name=e.name,this._$light=e.light,this._$disable=e.disable,this._$lock=e.lock,this._$mode=e.mode,this._$maskId=e.maskId,this._$guideId=e.guideId,this._$color=e.color||this._$color,this.characters=e.characters,this.emptyCharacters=e.emptyCharacters||[])}initialize(){d.$timelineLayer.create();const e=document.getElementById("timeline-content").lastElementChild;this.id=0|e.dataset.layerId;const t=document.getElementById(`layer-name-${this.id}`);this.name?(t.textContent=this.name,document.getElementById(`layer-name-input-${this.id}`).value=this.name):this.name=t.textContent;const a=document.getElementById(`layer-light-icon-${this.id}`);if(a.style.backgroundImage=`url('${this.getHighlightURL()}')`,this.light&&(a.classList.remove("icon-disable"),a.classList.add("light-icon-active"),e.style.borderBottom=`1px solid ${this.color}`),this.disable){const e=document.getElementById(`layer-disable-icon-${this.id}`);e.classList.remove("icon-disable"),e.classList.add("icon-active")}if(this.lock){const e=document.getElementById(`layer-lock-icon-${this.id}`);e.classList.remove("icon-disable"),e.classList.add("icon-active")}this.showIcon(),this.reloadStyle()}getHighlightURL(){const e=d.$intToRGB(0|`0x${this.color.slice(1)}`);return`data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"><path fill="rgb(${e.R},${e.G},${e.B})" d="M14 19h-4c-.276 0-.5.224-.5.5s.224.5.5.5h4c.276 0 .5-.224.5-.5s-.224-.5-.5-.5zm0 2h-4c-.276 0-.5.224-.5.5s.224.5.5.5h4c.276 0 .5-.224.5-.5s-.224-.5-.5-.5zm.25 2h-4.5l1.188.782c.154.138.38.218.615.218h.895c.234 0 .461-.08.615-.218l1.187-.782zm3.75-13.799c0 3.569-3.214 5.983-3.214 8.799h-1.989c-.003-1.858.87-3.389 1.721-4.867.761-1.325 1.482-2.577 1.482-3.932 0-2.592-2.075-3.772-4.003-3.772-1.925 0-3.997 1.18-3.997 3.772 0 1.355.721 2.607 1.482 3.932.851 1.478 1.725 3.009 1.72 4.867h-1.988c0-2.816-3.214-5.23-3.214-8.799 0-3.723 2.998-5.772 5.997-5.772 3.001 0 6.003 2.051 6.003 5.772zm4-.691v1.372h-2.538c.02-.223.038-.448.038-.681 0-.237-.017-.464-.035-.69h2.535zm-10.648-6.553v-1.957h1.371v1.964c-.242-.022-.484-.035-.726-.035-.215 0-.43.01-.645.028zm-3.743 1.294l-1.04-1.94 1.208-.648 1.037 1.933c-.418.181-.822.401-1.205.655zm10.586 1.735l1.942-1.394.799 1.115-2.054 1.473c-.191-.43-.423-.827-.687-1.194zm-3.01-2.389l1.038-1.934 1.208.648-1.041 1.941c-.382-.254-.786-.473-1.205-.655zm-10.068 3.583l-2.054-1.472.799-1.115 1.942 1.393c-.264.366-.495.763-.687 1.194zm13.707 6.223l2.354.954-.514 1.271-2.425-.982c.21-.397.408-.812.585-1.243zm-13.108 1.155l-2.356 1.06-.562-1.251 2.34-1.052c.173.433.371.845.578 1.243zm-1.178-3.676h-2.538v-1.372h2.535c-.018.226-.035.454-.035.691 0 .233.018.458.038.681z"/></svg>`}clone(){return new _(this.toObject())}appendCharacter(e=1){if(this.disable)return;if(document.getElementById("timeline-onion-skin").classList.contains("onion-skin-active")&&d.$timelinePlayer.stopFlag){const e=d.$timelineFrame.currentFrame,t=new Map;for(let e=0;e<this._$characters.length;++e){const a=this._$characters[e];for(let e of a._$places.keys())t.set(e,!0)}const a=this.getActiveCharacter(e);if(a.length){const r=a[0].getRange(e);t.delete(r.startFrame)}for(const e of t.keys()){d.$timelineFrame.currentFrame=e;const t=this.getActiveCharacter(e);if(t.length){t.length>1&&this.sort(t,e);for(let e=0;e<t.length;++e){const a=t[e];a._$image=null,d.$screen.appendOnionCharacter(a,this.id)}}}d.$timelineFrame.currentFrame=e;const r=this.getActiveCharacter(e);if(r.length){r.length>1&&this.sort(r,e);const t=this.lock?"none":"auto";for(let a=0;a<r.length;++a){const s=r[a];s._$image=null,d.$screen.appendCharacter(s,e,this.id,t)}}}else{const t=this.getActiveCharacter(e);if(t.length){t.length>1&&this.sort(t,e);const a=this.lock?"none":"auto";for(let r=0;r<t.length;++r)d.$screen.appendCharacter(t[r],e,this.id,a)}}}sort(e,t){e.sort(((e,a)=>{const r=e.getPlace(t).depth,s=a.getPlace(t).depth;switch(!0){case r>s:return 1;case r<s:return-1;default:return 0}}))}getActiveCharacter(e=1){const t=[];for(let a=0;a<this._$characters.length;++a){const r=this._$characters[a];r.startFrame>e||(e>=r.endFrame||t.push(r))}return t}getActiveEmptyCharacter(e=1){for(let t=0;t<this._$emptys.length;++t){const a=this._$emptys[t];if(!(a.startFrame>e)&&!(e>=a.endFrame))return a}return null}clearActiveCharacter(){for(let e=0;e<this._$characters.length;++e){const t=this._$characters[e],a=document.getElementById(`character-${t.id}`);a&&(a.style.border="")}}showIcon(){const e=document.getElementById(`layer-name-${this.id}`);e.classList.remove("in-view-text"),e.classList.add("view-text");switch(document.getElementById(`layer-name-input-${this.id}`).classList.remove("in-view-text-input"),this._$mode){case d.LAYER_MODE_NORMAL:document.getElementById(`layer-icon-${this.id}`).style.display="",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-in-icon-${this.id}`).style.display="none";break;case d.LAYER_MODE_MASK:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-in-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-icon-${this.id}`);e.style.display="",e.style.opacity="0"}break;case d.LAYER_MODE_MASK_IN:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-in-icon-${this.id}`);e.style.display="",e.style.opacity="0";const t=document.getElementById(`layer-name-${this.id}`);t.classList.remove("view-text"),t.classList.add("in-view-text");document.getElementById(`layer-name-input-${this.id}`).classList.add("in-view-text-input")}break;case d.LAYER_MODE_GUIDE:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="none",document.getElementById(`timeline-exit-in-icon-${this.id}`).style.display="none";const e=document.getElementById(`timeline-exit-icon-${this.id}`);e.style.display="",e.style.opacity="0"}break;case d.LAYER_MODE_GUIDE_IN:{document.getElementById(`layer-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-icon-${this.id}`).style.display="none",document.getElementById(`layer-mask-in-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-icon-${this.id}`).style.display="none",document.getElementById(`layer-guide-in-icon-${this.id}`).style.display="";const e=document.getElementById(`timeline-exit-in-icon-${this.id}`);e.style.display="",e.style.opacity="0";const t=document.getElementById(`layer-name-${this.id}`);t.classList.remove("view-text"),t.classList.add("in-view-text");document.getElementById(`layer-name-input-${this.id}`).classList.add("in-view-text-input")}}}reloadStyle(){this.resetStyle(),this.setEmptyStyle(),this.setCharacterStyle()}setCharacterStyle(){const e=this.id;for(let t=0;t<this._$characters.length;++t){const a=new Map,r=this._$characters[t],s=Array.from(r._$places.keys());s.sort(((e,t)=>{switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let t=0;t<s.length;++t){const i=s[t];if(a.has(i))continue;a.set(i,!0);const n=s[t+1]||r.endFrame;if(i===n-1){const t=document.getElementById(`${e}-${i}`);if(t.dataset.frameState="key-frame",r.hasTween(i)){t.classList.add("tween-key-frame");const e=r.getTween(i);(e.endFrame-e.startFrame>1||r.hasTween(e.endFrame))&&t.classList.add("tween-key-frame-join")}else{const e=r.getPlace(i);if(e.tweenFrame){const a=r.getTween(e.tweenFrame);a.endFrame-1===i?r.hasTween(a.endFrame)?t.classList.add("tween-space-frame"):t.classList.add("tween-frame-end"):t.classList.add("tween-space-frame")}else t.classList.add("key-frame")}continue}let o=i;const l=document.getElementById(`${e}-${o++}`);l.dataset.frameState="key-frame",r.hasTween(i)?l.classList.add("tween-key-frame","tween-key-frame-join"):l.classList.add("key-frame","key-frame-join");const c=n-1;for(;o<c;){const t=document.getElementById(`${e}-${o++}`);t.dataset.frameState="key-space-frame",r.hasTween(i)?t.classList.add("tween-space-frame"):t.classList.add("key-space-frame")}const d=document.getElementById(`${e}-${o++}`);d.dataset.frameState="key-space-frame-end",r.hasTween(i)?d.classList.add("tween-frame-end"):d.classList.add("key-space-frame-end")}}}setEmptyStyle(){const e=this.id;for(let t=0;t<this._$emptys.length;++t){const a=this._$emptys[t];if(a.startFrame===a.endFrame-1){const t=document.getElementById(`${e}-${a.startFrame}`);t.dataset.frameState="empty-key-frame",t.classList.add("empty-key-frame");continue}let r=a.startFrame;const s=document.getElementById(`${e}-${r++}`);s.dataset.frameState="empty-key-frame",s.classList.add("empty-key-frame","empty-key-frame-join");const i=a.endFrame-1;for(;r<i;){const t=document.getElementById(`${e}-${r++}`);t.dataset.frameState="empty-space-frame",t.classList.add("empty-space-frame")}const n=document.getElementById(`${e}-${r++}`);n.dataset.frameState="empty-space-frame-end",n.classList.add("empty-space-frame-end")}}resetStyle(){const e=this.id;let t=1;for(;;){const a=document.getElementById(`${e}-${t++}`);if(!a||"empty"===a.dataset.frameState)return;a.dataset.frameState="empty",a.setAttribute("class","frame"),"frame-pointer"===a.dataset.type&&a.classList.add("frame-pointer")}}get id(){return this._$id}set id(e){this._$id=0|e}get name(){return this._$name}set name(e){this._$name=e}get light(){return this._$light}set light(e){this._$light=e}get disable(){return this._$disable}set disable(e){this._$disable=e}get lock(){return this._$lock}set lock(e){this._$lock=e}get emptyCharacters(){const e=[];for(let t=0;t<this._$emptys.length;++t)e.push(this._$emptys[t].toObject());return e}set emptyCharacters(e){for(let t=0;t<e.length;++t){const a=new $(e[t]);this._$emptys.push(a)}}get characters(){const e=[];for(let t=0;t<this._$characters.length;++t)e.push(this._$characters[t].toObject());return e}set characters(e){for(let t=0;t<e.length;++t){const a=new f(e[t]);a._$layerId=this.id,this._$instances.set(a.id,a),this._$characters.push(a)}}getCharacter(e){return this._$instances.get(0|e)}addCharacter(e){e._$layerId=this.id,this._$characters.push(e),this._$instances.set(e.id,e)}deleteCharacter(e){if(this._$instances.has(0|e)){const t=this._$instances.get(0|e);t._$layerId=-1,this._$characters.splice(this._$characters.indexOf(t),1),this._$instances.delete(0|e)}}addEmptyCharacter(e){this._$emptys.push(e)}deleteEmptyCharacter(e){const t=this._$emptys.indexOf(e);t>-1&&this._$emptys.splice(t,1)}adjustmentLocation(e){const t=this.getActiveEmptyCharacter(e);if(t)return this.deleteEmptyCharacter(t),{startFrame:t.startFrame,endFrame:t.endFrame};const a=this.getActiveCharacter(e);if(a.length){let t=1,r=Number.MAX_VALUE;for(let s=0;s<a.length;++s){const i=a[s];t=Math.max(t,i.startFrame),r=Math.min(r,i.endFrame);for(const a of i._$places.keys())a>e&&(r=Math.min(r,a)),e>=a&&(t=Math.max(t,a))}return{startFrame:t,endFrame:r}}if(e>1){const t=this.id;let a=1;for(;e-a>1;++a){if("empty"!==document.getElementById(`${t}-${e-a}`).dataset.frameState)break}if(e-a!==e){let t=!1;const r=this.getActiveEmptyCharacter(e-a);if(r&&(r.endFrame=e,t=!0),!t){const r=this.getActiveCharacter(e-a);if(r.length){for(let t=0;t<r.length;++t)r[t].endFrame=e;t=!0}}t||this.addEmptyCharacter(new $({startFrame:e-a,endFrame:e}))}}return{startFrame:e,endFrame:e+1}}get totalFrame(){let e=0;for(let t=0;t<this._$characters.length;++t){const a=this._$characters[t];e=Math.max(e,a.endFrame)}for(let t=0;t<this._$emptys.length;++t){const a=this._$emptys[t];e=Math.max(e,a.endFrame)}return e}get mode(){return this._$mode}set mode(e){this._$mode=e}get maskId(){return this._$maskId}set maskId(e){this._$maskId=null===e?null:0|e}get guideId(){return this._$guideId}set guideId(e){this._$guideId=null===e?null:0|e}get color(){return this._$color}set color(e){this._$color=e}toObject(){return{name:this.name,light:this.light,disable:this.disable,lock:this.lock,mode:this.mode,maskId:this.maskId,guideId:this.guideId,color:this.color,characters:this.characters,emptyCharacters:this.emptyCharacters}}}class b extends g{constructor(e){super(e),this._$currentFrame=1,this._$layerId=0,this._$parent=null,this._$labels=new Map,this._$layers=new Map,this._$actions=new Map,this._$sounds=new Map,e.layers&&(this.layers=e.layers),e.labels&&(this.labels=e.labels),e.placeMap&&(this.placeMap=e.placeMap),e.sounds&&(this.sounds=e.sounds),e.actions&&(this.actions=e.actions),e.currentFrame&&(this._$currentFrame=Math.max(1,0|e.currentFrame))}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["text-setting","video-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["loop-setting"]),d.$loopController.reload(e.loop),document.getElementById("loop-image-list").style.display="none"}initialize(e=!1){if(d.$tools.getDefaultTool("arrow").clear(),d.$tools.reset(),this.clearStageArea(),d.$clearShapePointer(),document.getElementById("scene-name").textContent=this.name,document.getElementById("object-name").value=this.name,document.getElementById("object-symbol").value=this.symbol,0===this.id){const e=document.getElementById("scene-name-menu-list");for(;e.children.length;)e.children[0].remove()}d.$timelineFrame.currentFrame=this.currentFrame,d.$timelineHeader.create(e);for(const e of this._$labels.keys()){document.getElementById(`frame-label-marker-${e}`).setAttribute("class","frame-border-box-marker")}for(const e of this._$actions.keys()){document.getElementById(`frame-label-action-${e}`).setAttribute("class","frame-border-box-action")}for(const e of this._$sounds.keys()){document.getElementById(`frame-label-sound-${e}`).setAttribute("class","frame-border-box-sound")}const t=document.getElementById("label-name");t.value="",this._$labels.has(1)&&(t.value=this._$labels.get(1)),d.$timelineLayer.removeAll(),this._$layerId=0;for(const e of this._$layers.values())e.initialize();this._$layers.size||this.addLayer(),d.$controller.default(),this.id&&(document.getElementById(`library-child-id-${this.id}`).draggable=!1),d.$soundController.createSoundElements(),this.changeFrame(d.$timelineFrame.currentFrame)}get currentFrame(){return this._$currentFrame}get totalFrame(){let e=1;for(const t of this._$layers.values())e=Math.max(e,t.totalFrame-1);return e}clearStageArea(){const e=document.getElementById("stage-area");let t=0;for(;e.children.length>t;){const a=e.children[t];a.dataset.child&&"tween"!==a.dataset.child?a.remove():t++}}changeFrame(e=1){this.clearStageArea();const t=document.getElementById("stage-area"),a=[],r=t.children;for(let e=0;r.length>e;++e){const t=r[e];t.dataset.shapePointer&&(t.remove(),a.push(t),--e)}const s=Array.from(this._$layers.values());for(;s.length;){const t=s.pop();t.mode===d.LAYER_MODE_MASK&&t.lock||t.appendCharacter(e)}this._$currentFrame=e,d.$transformController.relocation(),d.$gridController.relocation();for(let e=0;a.length>e;++e)t.appendChild(a[e]);d.$tweenController.clearPointer().relocationPointer()}clearActiveCharacter(){for(const e of this._$layers.values())e.clearActiveCharacter()}addSceneName(){const e=d.$currentWorkSpace().getLibrary(0|this.id),t=`\n<div id="scene-instance-id-${e.id}" data-library-id="${e.id}">${e.name}</div>\n`;document.getElementById("scene-name-menu-list").insertAdjacentHTML("beforeend",t);const a=document.getElementById(`scene-instance-id-${e.id}`);a.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault()})),a.addEventListener("click",(e=>{d.$endMenu();const t=e.currentTarget;d.$sceneChange.execute(0|t.dataset.libraryId),t.remove()}))}stop(){const e=[];for(const t of this._$layers.values()){e.push(t);const a=t._$characters;for(let e=0;e<a.length;++e)a[e]._$image=null}this._$layers.clear();for(let t=0;t<e.length;++t)this._$layers.set(t,e[t]);if(this.id){document.getElementById(`library-child-id-${this.id}`).draggable=!0}}get labels(){const e=[];for(let[t,a]of this._$labels)e.push({frame:t,name:a});return e}set labels(e){for(let t=0;t<e.length;++t){const a=e[t];this._$labels.set(0|a.frame,a.name)}}setLabel(e,t){this._$labels.set(0|e,t)}gerLabel(e){return this._$labels.has(e)?this._$labels.get(0|e):null}deleteLabel(e){this._$labels.delete(0|e)}get parent(){return this._$parent}get layers(){let e=0,t=null;const a=[];for(const r of this._$layers.values()){const s=r.toObject();switch(s.mode){case d.LAYER_MODE_MASK:case d.LAYER_MODE_GUIDE:t=e;break;case d.LAYER_MODE_MASK_IN:s.maskId=t;break;case d.LAYER_MODE_GUIDE_IN:s.guideId=t;break;default:t=null}a.push(s),e++}return a}set layers(e){for(let t=0;t<e.length;++t)this._$layers.set(t,new _(e[t]))}addLayer(e=null){e||(e=new _),this._$layers.set(this._$layerId,e),e.initialize()}getLayer(e){return this._$layers.get(0|e)}setLayer(e,t){this._$layers.set(0|e,t)}deleteLayer(e){this._$layers.delete(0|e)}clearLayer(){this._$layers.clear()}get sounds(){const e=[];for(let[t,a]of this._$sounds)e.push({frame:t,sound:a});return e}set sounds(e){for(let t=0;t<e.length;++t){const a=e[t];this._$sounds.set(0|a.frame,a.sound)}}get actions(){const e=[];for(let[t,a]of this._$actions)e.push({frame:t,action:a});return e}set actions(e){for(let t=0;t<e.length;++t){const a=e[t];this._$actions.set(0|a.frame,a.action)}}getSound(e){return this._$sounds.get(e)}setSound(e,t){return this._$sounds.set(e,t)}hasSound(e){return this._$sounds.has(e)}deleteSound(e){this._$sounds.delete(e)}getAction(e){return this._$actions.get(e)}setAction(e,t){this._$actions.set(e,t),d.$javascriptController.reload()}hasAction(e){return this._$actions.has(e)}deleteAction(e){this._$actions.delete(e),d.$javascriptController.reload()}getBounds(e=[1,0,0,1,0,0],t=null,a=null){if(!this._$layers.size)return{xMin:0,xMax:0,yMin:0,yMax:0};let r=Number.MAX_VALUE,s=-Number.MAX_VALUE,i=Number.MAX_VALUE,n=-Number.MAX_VALUE;const o=d.$currentFrame;let l=1;t&&a&&(l=d.$getFrame(t,a,o,this.totalFrame));const c=e;d.$currentFrame=l;const h=d.$currentWorkSpace();for(const e of this._$layers.values()){if(e.disable)continue;const t=e.getActiveCharacter(l),a=t.length;for(let e=0;e<a;++e){const a=t[e],o=a.getPlace(l),u=o.loop&&5===o.loop.type?{startFrame:a.startFrame,endFrame:a.endFrame}:a.getRange(l),m=h.getLibrary(0|a.libraryId),g=d.$multiplicationMatrix(c,o.matrix),p=m.getBounds(g,o,u),f=p.xMax-p.xMin,$=p.yMax-p.yMin;f&&$||(p.xMin=g[4],p.xMax=g[4],p.yMin=g[5],p.yMax=g[5]),r=Math.min(p.xMin,r),s=Math.max(p.xMax,s),i=Math.min(p.yMin,i),n=Math.max(p.yMax,n)}}return d.$currentFrame=o,{xMin:r,xMax:s,yMin:i,yMax:n}}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,currentFrame:this.currentFrame,parent:this.parent,layers:this.layers,labels:this.labels,sounds:this.sounds,actions:this.actions}}toPublish(){const e=[],t=[],a=[],r=[],s=d.$currentWorkSpace(),i=new Map;let n=0;for(const e of s._$libraries.keys())i.set(e,n++);let o=0,l=!1,c=0;const h=d.$userSetting.getPublishSetting(),u=Array.from(this._$layers),m=[];let g=0,p=0;for(let i=u.length-1;i>-1;--i){if(c&&!m.length){c=0,g=0;continue}const n=!l&&m.length?m.shift():u[i][1];if(!h.layer&&n.disable)continue;if(n.mode===d.LAYER_MODE_GUIDE)continue;if(n.mode!==d.LAYER_MODE_MASK_IN||l||c||(l=!0,c=i),l&&n.mode===d.LAYER_MODE_MASK_IN){g+=n._$characters.length,m.push(n);continue}const f=n._$characters,$=n.mode===d.LAYER_MODE_MASK?Math.min(1,f.length):f.length;let y=n.mode===d.LAYER_MODE_MASK?$-1:0;for(;;){const i=e.length,l=f[y];if(!l)break;const c=l.startFrame,h=l.endFrame,u=s._$libraries.get(l.libraryId);d.$useIds.has(u.id)||d.$useIds.set(u.id,!0),e.push({name:l.name,characterId:u.id,endFrame:h,startFrame:c,clipDepth:n.mode===d.LAYER_MODE_MASK?y+g+o:0});let m=0;for(let e=c;e<h;++e){e in t||(t[e]=[]),e in a||(a[e]=[]);const s=l.getPlace(e);if(l.hasPlace(e)){m=r.length;const e=[];for(let t=0;t<s.filter.length;++t){const a=s.filter[t];a.state&&e.push({class:a.name,params:a.toParamArray()})}const t={matrix:s.matrix,colorTransform:s.colorTransform,blendMode:s.blendMode,surfaceFilterList:e};if("container"===u.type&&d.DEFAULT_LOOP>s.loop.type){if(s.loop.referenceFrame){const e=l.getPlace(s.loop.referenceFrame);t.loop={type:e.loop.type,frame:e.frame,start:e.loop.start,end:e.loop.end}}else t.loop={type:s.loop.type,frame:s.frame,start:s.loop.start,end:s.loop.end};s.loop.tweenFrame&&(t.loop.tweenFrame=s.loop.tweenFrame)}r.push(t)}t[e][p+s.depth]=i,a[e][p+s.depth]=m}if(n.mode===d.LAYER_MODE_MASK){if(--y,-1===y)break}else if(++y,y===$)break}o+=$,p+=$,l&&m.length&&(i=c+1,l=!1)}for(let e=1;t.length>e;++e){if(!(e in t))continue;const r=t[e],s=a[e];t[e]=r.filter((e=>"number"==typeof e)),a[e]=s.filter((e=>"number"==typeof e))}const f=[];for(let[e,t]of this._$sounds){const a={frame:e,sound:[]};for(let e=0;e<t.length;++e){const r=t[e],s=0|r.characterId;a.sound.push({characterId:s,volume:r.volume/100,autoPlay:r.autoPlay,loopCount:r.loopCount}),d.$useIds.has(s)||d.$useIds.set(s,!0)}f.push(a)}const $=[];for(let[e,t]of this._$actions){const a=t.replace(/("[^"]*\/\/.*?")|\/\/(?:.|\r?\n)*?(?:\r?\n|.*)?/g,"$1").replace(/(["'][^"']*\/\*.*?\*\/[^"']*["'])|\/\*(?:.|\r?\n)*?\*\//g,"$1").replace(/^\s+|\s+$/g,"").replace(/ +/g," ").split(/\r?\n/);let r=[];for(let e=0;e<a.length;++e){const t=a[e].trim();t.length&&r.push(t)}$.push({frame:e,action:r.join("\n")})}return{actions:$,symbol:this.symbol,extends:this.defaultSymbol,totalFrame:this.totalFrame,controller:t,dictionary:e,labels:this.labels,placeMap:a,placeObjects:r,sounds:f}}get defaultSymbol(){return window.next2d.display.MovieClip.namespace}createInstance(e,t){const{MovieClip:a}=window.next2d.display,{Matrix:r,ColorTransform:s}=window.next2d.geom,i=d.$currentWorkSpace(),n=new a,o=d.$currentFrame;d.$useIds.clear();const l=this.toPublish();let c=1;e&&t&&(c=d.$getFrame(e,t,o,this.totalFrame)),d.$currentFrame=c,n._$currentFrame=c;const h=l.controller[c];if(!h)return n;const u=l.placeMap[c];for(let e=0;h.length>e;++e){const o=l.dictionary[h[e]],m=i.getLibrary(o.characterId),g=l.placeObjects[u[e]];g.loop||(g.loop=d.$getDefaultLoopConfig());let p=null;switch(m.type){case"container":if(p=new a,m._$layers.size){const a=Array.from(m._$layers.values()).reverse();let r=null,s=-1;for(let t=0;t<a.length;++t){if(s++,s!==e)continue;const i=a[t].getActiveCharacter(c);i.length>1&&i.sort(((e,t)=>{const a=e.getPlace(c).depth,r=t.getPlace(c).depth;switch(!0){case a>r:return 1;case a<r:return-1;default:return 0}})),i.length&&(r=i[0].getRange(c))}g&&(g.frame=c,5===g.loop.type&&(r=t)),p=m.createInstance(g,r)}break;case"shape":p=m.createInstance(),p._$bitmapId=m._$bitmapId;break;default:p=m.createInstance()}p.transform.matrix=new r(g.matrix[0],g.matrix[1],g.matrix[2],g.matrix[3],g.matrix[4],g.matrix[5]),p.transform.colorTransform=new s(g.colorTransform[0],g.colorTransform[1],g.colorTransform[2],g.colorTransform[3],g.colorTransform[4],g.colorTransform[5],g.colorTransform[6],g.colorTransform[7]),p.blendMode=g.blendMode;const f=[];for(let e=0;e<g.surfaceFilterList.length;++e){const t=g.surfaceFilterList[e],a=window.next2d.filters[t.class];f.push(new(a.bind.apply(a,t.params)))}p.filters=f,p._$placeId=e,p._$clipDepth=o.clipDepth,p._$loaderInfo={_$id:0},p._$characterId=o.characterId,n.addChild(p)}return d.$currentFrame=o,n}}class v extends g{constructor(e=null){super(e),this._$bitmapId=0,this._$bounds=null,this._$grid=null,this._$inBitmap=!1,this._$recodes=[],e.inBitmap&&(this.inBitmap=e.inBitmap),e.recodes&&(this.recodes=e.recodes),e.bounds&&(this.bounds=e.bounds),e.bitmapId&&(this.bitmapId=e.bitmapId),e.grid&&(this.grid=e.grid)}showController(e,t=""){super.showController(e,t),document.getElementById("nine-slice-setting-x").value="0",document.getElementById("nine-slice-setting-y").value="0",document.getElementById("nine-slice-setting-w").value="0",document.getElementById("nine-slice-setting-h").value="0",d.$controller.showObjectSetting(["nine-slice-setting"]),d.$controller.hideObjectSetting(["text-setting","loop-setting","video-setting","fill-color-setting"])}showShapeColor(e,t){this.setHitColor(t.offsetX,t.offsetY,e.matrix);const a=this._$grid;a&&a.x&&a.y&&(document.getElementById("nine-slice-setting-x").value=`${a.x}`,document.getElementById("nine-slice-setting-y").value=`${a.y}`,document.getElementById("nine-slice-setting-w").value=`${a.w}`,document.getElementById("nine-slice-setting-h").value=`${a.h}`,d.$gridController.show().relocation()),d.$hitColor&&d.$controller.showObjectSetting(["fill-color-setting","nine-slice-setting"])}getBounds(e=null){return e?d.$boundsMatrix(this._$bounds,e):this._$bounds}get inBitmap(){return this._$inBitmap}set inBitmap(e){this._$inBitmap=!!e}get width(){return Math.abs(this._$bounds.xMax-this._$bounds.xMin)}get height(){return Math.abs(this._$bounds.yMax-this._$bounds.yMin)}get defaultSymbol(){return window.next2d.display.Shape.namespace}get recodes(){if(!this._$inBitmap)return this._$recodes;const e=[],{BitmapData:t}=window.next2d.display;for(let a=0;this._$recodes.length>a;++a){const r=this._$recodes[a];e[a]=r,"object"==typeof r&&(r.namespace===t.namespace&&(e[a]={buffer:Array.from(r._$buffer),width:r.width,height:r.height}))}return e}set recodes(e){if(this._$recodes=e,this._$inBitmap){const{BitmapData:e}=window.next2d.display;for(let t=0;this._$recodes.length>t;++t){const a=this._$recodes[t];if("object"!=typeof a)continue;if(a.namespace===e.namespace)continue;if(!a.buffer)continue;const r=new e(a.width,a.height,!0,0);r._$buffer=new Uint8Array(a.buffer),this._$recodes[t]=r}}}get bounds(){return this._$bounds}set bounds(e){this._$bounds=e}get offset(){return this._$offset}set offset(e){this._$offset=e}get bitmapId(){return this._$bitmapId}set bitmapId(e){this._$bitmapId=0|e}get grid(){return this._$grid}set grid(e){this._$grid=e}createPointer(e,t,a){d.$clearShapePointer();const r=document.getElementById("stage-area");let s=2;const{Graphics:i}=window.next2d.display;for(let r=0;r<this._$recodes.length;)switch(this._$recodes[r++]){case i.MOVE_TO:s=r,r+=2;break;case i.LINE_TO:this.addPointer(t,a,r,this._$recodes[r++],this._$recodes[r++],e,i.LINE_TO),this.adjustmentPointer(r,e,t,a,s);break;case i.CUBIC:for(let s=0;2>s;++s)this.addPointer(t,a,r,this._$recodes[r++],this._$recodes[r++],e,i.CUBIC,!0);this.addPointer(t,a,r,this._$recodes[r++],this._$recodes[r++],e,i.CUBIC,!1),this.adjustmentPointer(r,e,t,a,s);break;case i.CURVE_TO:this.addPointer(t,a,r,this._$recodes[r++],this._$recodes[r++],e,i.CURVE_TO,!0),this.addPointer(t,a,r,this._$recodes[r++],this._$recodes[r++],e,i.CURVE_TO),this.adjustmentPointer(r,e,t,a,s);break;case i.FILL_STYLE:r+=4;break;case i.STROKE_STYLE:r+=8;break;case i.GRADIENT_FILL:r+=6;break;case i.GRADIENT_STROKE:r+=10;case i.BEGIN_PATH:case i.END_FILL:case i.END_STROKE:}d.$addModalEvent(r)}adjustmentPointer(e,t,a,r,s){const{Graphics:i}=window.next2d.display;switch(this._$recodes[e]){case i.MOVE_TO:case i.FILL_STYLE:case i.GRADIENT_FILL:{const e=document.getElementById("stage-area").children;e[e.length-1].dataset.syncId=`${s}`}break;case i.STROKE_STYLE:case i.GRADIENT_STROKE:this.addPointer(a,r,5,this._$recodes[5],this._$recodes[6],t,i.MOVE_TO)}}addPointer(e,t,a,r,s,i,n,o=!1){const l=document.getElementById("stage-area"),c=document.createElement("div");c.classList.add("transform"),c.dataset.shapePointer="true",c.dataset.layerId=`${e}`,c.dataset.characterId=`${t}`,c.dataset.index=`${a}`,c.dataset.libraryId=`${this.id}`,c.dataset.curve=`${o}`,c.dataset.type=`${n}`,c.dataset.position=`${l.children.length}`;const h=r*i[0]+s*i[2]+i[4],u=r*i[1]+s*i[3]+i[5];c.style.left=h*d.$zoomScale+d.$offsetLeft-3+"px",c.style.top=u*d.$zoomScale+d.$offsetTop-3+"px",o?c.style.borderRadius="5px":c.dataset.detail="{{ダブルクリックでカーブポイントが追加されます}}",c.addEventListener("mousedown",(e=>{if(e.button)return;e.stopPropagation();const t=d.$tools.activeTool;t&&(e.shapePointer=!0,t.dispatchEvent(D.MOUSE_DOWN,e))})),c.addEventListener("dblclick",(e=>{e.stopPropagation();const t=d.$tools.activeTool;t&&(e.shapePointer=!0,e.matrix=i,t.dispatchEvent(D.DBL_CLICK,e))})),l.appendChild(c)}reloadBounds(e=0){const{Graphics:t,Shape:a}=window.next2d.display,r=new a;e?r.graphics.lineStyle(e):r.graphics.beginFill();for(let e=0;e<this._$recodes.length;)switch(this._$recodes[e++]){case t.MOVE_TO:r.graphics.moveTo(this._$recodes[e++],this._$recodes[e++]);break;case t.LINE_TO:r.graphics.lineTo(this._$recodes[e++],this._$recodes[e++]);break;case t.CUBIC:r.graphics.cubicCurveTo(this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++]);break;case t.CURVE_TO:r.graphics.curveTo(this._$recodes[e++],this._$recodes[e++],this._$recodes[e++],this._$recodes[e++]);break;case t.FILL_STYLE:e+=4;break;case t.STROKE_STYLE:e+=8;break;case t.GRADIENT_FILL:{const{Matrix:t}=window.next2d.geom,a=new t,s=this.width/2/819.2,i=this.height/2/819.2;a.scale(s,i),a.translate(this.width/2+r.graphics._$xMin,this.height/2+r.graphics._$yMin),this._$recodes[e+2]=Array.from(a._$matrix),e+=6}break;case t.GRADIENT_STROKE:{const{Matrix:t}=window.next2d.geom,a=new t,s=this.width/2/819.2,i=this.height/2/819.2;a.scale(s,i),a.translate(this.width/2+r.graphics._$xMin,this.height/2+r.graphics._$yMin),this._$recodes[e+6]=Array.from(a._$matrix),e+=10}case t.BEGIN_PATH:case t.END_FILL:case t.END_STROKE:}return{xMin:r.graphics._$xMin,xMax:r.graphics._$xMax,yMin:r.graphics._$yMin,yMax:r.graphics._$yMax}}copyFrom(e){return e._$recodes=this._$recodes.slice(),e._$bounds={xMin:this._$bounds.xMin,xMax:this._$bounds.xMax,yMin:this._$bounds.yMin,yMax:this._$bounds.yMax},e._$bitmapId=this._$bitmapId,e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,bitmapId:this.bitmapId,grid:this.grid,inBitmap:this.inBitmap,recodes:this.recodes,bounds:this.bounds}}toPublish(){return this._$bitmapId&&d.$useIds.set(this._$bitmapId,!0),{symbol:this.symbol,extends:this.defaultSymbol,bitmapId:this.bitmapId,grid:this.grid,inBitmap:this.inBitmap,recodes:this.recodes,bounds:{xMin:this._$bounds.xMin,xMax:this._$bounds.xMax,yMin:this._$bounds.yMin,yMax:this._$bounds.yMax}}}changeStyle(e){const{Graphics:t,GradientType:a}=window.next2d.display,r=d.$hitColor.index;switch(d.$hitColor.style){case t.BITMAP_FILL:case t.FILL_STYLE:switch(document.getElementById("fill-color-type-select").value){case a.LINEAR:case a.RADIAL:{const a=document.getElementById("fill-color-value").value,s=d.$intToRGB(0|`0x${a.slice(1)}`),i=(0|document.getElementById("fill-alpha-value").value)/100*255;this.changeGradient(r,e,t.GRADIENT_FILL,6,s,i)}}break;case t.GRADIENT_FILL:{const a=document.getElementById("fill-color-type-select"),s=this._$recodes[r+1].pop();switch(a.value){case"bitmap":case"rgba":this._$recodes.splice(r-1,12,t.FILL_STYLE,s.R,s.G,s.B,s.A,t.END_FILL),d.$hitColor={index:r,style:t.FILL_STYLE,shape:this};break;default:this.changeGradient(r,e,t.GRADIENT_FILL,12,s,s.A)}}break;case t.STROKE_STYLE:switch(document.getElementById("fill-color-type-select").value){case a.LINEAR:case a.RADIAL:{const a=document.getElementById("fill-color-value").value,s=d.$intToRGB(0|`0x${a.slice(1)}`),i=(0|document.getElementById("fill-alpha-value").value)/100*255;this.changeGradient(r,e,t.GRADIENT_STROKE,5,s,i)}}break;case t.GRADIENT_STROKE:{const a=document.getElementById("fill-color-type-select"),s=this._$recodes[r+5].pop(),i=this._$recodes[r],n=this._$recodes[r+1],o=this._$recodes[r+2],l=this._$recodes[r+3];switch(a.value){case"bitmap":case"rgba":this._$recodes.splice(r-1,11,t.STROKE_STYLE,i,n,o,l,s.R,s.G,s.B,s.A,t.END_STROKE),d.$hitColor={index:r,width:i,style:t.STROKE_STYLE,shape:this};break;default:this.changeGradient(r,e,t.GRADIENT_STROKE,6,s,s.A)}}}this.cacheClear();const s=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(s)}changeGradient(e,t,a,r,s,i){const{Graphics:n,SpreadMethod:o,InterpolationMethod:l}=window.next2d.display,{Matrix:c}=window.next2d.geom,h=new c,u=this.width/2/819.2,m=this.height/2/819.2;h.scale(u,m),h.translate(this.width/2+this._$bounds.xMin,this.height/2+this._$bounds.yMin);const g=[{ratio:0,R:255,G:255,B:255,A:255},{ratio:1,R:s.R,G:s.G,B:s.B,A:i}];d.$hitColor={index:e,style:a,type:t,ratios:g,shape:this},n.GRADIENT_STROKE===a?(this._$recodes[e-1]=n.GRADIENT_STROKE,this._$recodes.splice(e+4,r,t,g,Array.from(h._$matrix),o.PAD,l.RGB,0),d.$hitColor.width=this._$recodes[e]):this._$recodes.splice(e-1,r,a,t,g,Array.from(h._$matrix),o.PAD,l.RGB,0),d.$shapeController.initializeGradient()}changeColor(e=-1){const{Graphics:t}=window.next2d.display,a=d.$hitColor.index;switch(d.$hitColor.style){case t.BITMAP_FILL:break;case t.BITMAP_STROKE:{const e=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[a]!==e){d.$hitColor.width=e,this._$recodes[a]=e;const t=this.reloadBounds(e);this._$bounds.xMin=t.xMin,this._$bounds.xMax=t.xMax,this._$bounds.yMin=t.yMin,this._$bounds.yMax=t.yMax,this.cacheClear()}}break;case t.FILL_STYLE:{const e=document.getElementById("fill-color-value").value,t=d.$intToRGB(0|`0x${e.slice(1)}`);this._$recodes[a]=t.R,this._$recodes[a+1]=t.G,this._$recodes[a+2]=t.B,this._$recodes[a+3]=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255)}break;case t.GRADIENT_FILL:{const t=this._$recodes[a+1],r=t[e>-1?e:t.length-1],s=document.getElementById("fill-color-value").value,i=d.$intToRGB(0|`0x${s.slice(1)}`);r.R=i.R,r.G=i.G,r.B=i.B,r.A=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255)}break;case t.STROKE_STYLE:{const e=document.getElementById("fill-color-value").value,t=d.$intToRGB(0|`0x${e.slice(1)}`);this._$recodes[a+4]=t.R,this._$recodes[a+5]=t.G,this._$recodes[a+6]=t.B,this._$recodes[a+7]=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255);const r=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[a]!==r){d.$hitColor.width=r,this._$recodes[a]=r;const e=this.reloadBounds(r);this._$bounds.xMin=e.xMin,this._$bounds.xMax=e.xMax,this._$bounds.yMin=e.yMin,this._$bounds.yMax=e.yMax,this.cacheClear()}}break;case t.GRADIENT_STROKE:{const t=this._$recodes[a+5],r=t[e>-1?e:t.length-1],s=document.getElementById("fill-color-value").value,i=d.$intToRGB(0|`0x${s.slice(1)}`);r.R=i.R,r.G=i.G,r.B=i.B,r.A=d.$clamp((0|document.getElementById("fill-alpha-value").value)/100*255,0,255);const n=d.$clamp(0|document.getElementById("fill-stroke-width-value").value,1,255);if(this._$recodes[a]!==n){d.$hitColor.width=n,this._$recodes[a]=n;const e=this.reloadBounds(n);this._$bounds.xMin=e.xMin,this._$bounds.xMax=e.xMax,this._$bounds.yMin=e.yMin,this._$bounds.yMax=e.yMax,this.cacheClear()}}}this.cacheClear()}cacheClear(){const e=d.$currentWorkSpace().scene;for(const t of e._$layers.values()){const e=t._$characters.length;for(let a=0;a<e;++a){const e=t._$characters[a];e.libraryId===this.id&&(e._$image=null)}}}setHitColor(e,t,a){const{Graphics:r,GradientType:s}=window.next2d.display,{Point:i,Matrix:n}=window.next2d.geom,o=new n,l=Math.sqrt(a[0]*a[0]+a[1]*a[1])*d.$zoomScale,c=Math.sqrt(a[2]*a[2]+a[3]*a[3])*d.$zoomScale;o.scale(l,c);const h=Math.atan2(a[1],a[0]);h&&(o.translate(-this.width/2,-this.height/2),o.rotate(h),o.translate(this.width/2,this.height/2));const u=o.transformPoint(new i(0,0)),m=o.transformPoint(new i(this.width,0)),g=o.transformPoint(new i(0,this.height)),p=o.transformPoint(new i(this.width,this.height)),f=Math.min(u.x,m.x,g.x,p.x),$=Math.min(u.y,m.y,g.y,p.y);o.translate(-f,-$),d.$hitColor=null,d.$hitContext.lineWidth=0,d.$hitContext.beginPath(),d.$hitContext.setTransform(o._$matrix[0],o._$matrix[1],o._$matrix[2],o._$matrix[3],-this._$bounds.xMin*l+o._$matrix[4],-this._$bounds.yMin*c+o._$matrix[5]);const y=this._$recodes,_=y.length;for(let a=0;a<_;)switch(y[a++]){case r.BEGIN_PATH:d.$hitContext.beginPath();break;case r.MOVE_TO:d.$hitContext.moveTo(y[a++],y[a++]);break;case r.LINE_TO:d.$hitContext.lineTo(y[a++],y[a++]);break;case r.CURVE_TO:d.$hitContext.quadraticCurveTo(y[a++],y[a++],y[a++],y[a++]);break;case r.CUBIC:d.$hitContext.bezierCurveTo(y[a++],y[a++],y[a++],y[a++],y[a++],y[a++]);break;case r.FILL_STYLE:if(d.$hitContext.isPointInPath(e,t)){if(this._$bitmapId)d.$hitColor={index:a,style:r.BITMAP_FILL,shape:this},document.getElementById("fill-color-type-select")[1].selected=!0;else{d.$hitColor={index:a,style:r.FILL_STYLE,shape:this};const e=y[a].toString(16).padStart(2,"0"),t=y[a+1].toString(16).padStart(2,"0"),s=y[a+2].toString(16).padStart(2,"0");document.getElementById("fill-color-type-select")[0].selected=!0,document.getElementById("fill-color-value").value=`#${e}${t}${s}`,document.getElementById("fill-alpha-value").value=""+y[a+3]/255*100}d.$shapeController.changeFillColorTypeSelect()}a+=4;break;case r.GRADIENT_FILL:d.$hitContext.isPointInPath(e,t)&&(document.getElementById("fill-color-type-select")[y[a]===s.LINEAR?2:3].selected=!0,d.$hitColor={index:a,style:r.GRADIENT_FILL,type:y[a],ratios:y[a+1],shape:this},d.$shapeController.changeFillColorTypeSelect()),a+=6;break;case r.STROKE_STYLE:if(d.$hitContext.lineWidth=0|y[a],d.$hitContext.isPointInStroke(e,t)){if(this._$bitmapId)d.$hitColor={index:a,width:d.$hitContext.lineWidth,style:r.BITMAP_STROKE,shape:this},document.getElementById("fill-color-type-select")[1].selected=!0;else{d.$hitColor={index:a,width:d.$hitContext.lineWidth,style:r.STROKE_STYLE,shape:this};const e=y[a+4].toString(16).padStart(2,"0"),t=y[a+5].toString(16).padStart(2,"0"),s=y[a+6].toString(16).padStart(2,"0");document.getElementById("fill-color-type-select")[0].selected=!0,document.getElementById("fill-color-value").value=`#${e}${t}${s}`,document.getElementById("fill-alpha-value").value=""+y[a+7]/255*100}document.getElementById("fill-stroke-width-value").value=`${d.$hitContext.lineWidth}`,d.$shapeController.changeFillColorTypeSelect()}a+=8;break;case r.GRADIENT_STROKE:d.$hitContext.lineWidth=y[a],d.$hitContext.isPointInStroke(e,t)&&(document.getElementById("fill-color-type-select")[y[a+4]===s.LINEAR?2:3].selected=!0,d.$hitColor={index:a,width:y[a],style:r.GRADIENT_STROKE,type:y[a+4],ratios:y[a+5],shape:this},d.$shapeController.changeFillColorTypeSelect()),a+=10;case r.CLOSE_PATH:case r.END_STROKE:case r.END_FILL:}}createInstance(){const{Shape:e,Graphics:t}=window.next2d.display,a=new e;if(this._$grid){const{Rectangle:e}=window.next2d.geom;a.scale9Grid=new e(this._$grid.x,this._$grid.y,this._$grid.w,this._$grid.h)}const r=a.graphics;if(r._$maxAlpha=1,r._$canDraw=!0,r._$xMin=this._$bounds.xMin,r._$xMax=this._$bounds.xMax,r._$yMin=this._$bounds.yMin,r._$yMax=this._$bounds.yMax,this._$bitmapId){const{BitmapData:e}=window.next2d.display,s=d.$currentWorkSpace().getLibrary(this._$bitmapId);if(s){a._$bitmapId=this._$bitmapId,r._$recode=[];const i=new e(s.width,s.height,!0,0);i._$buffer=s._$buffer;const n=this._$recodes;if(n[n.length-1]===t.END_FILL){const e=n.length-6;for(let t=0;t<e;++t)r._$recode.push(n[t]);r._$recode.push(t.BITMAP_FILL,i,null,"repeat",!1)}else{const e=this._$recodes[n.length-9],a=this._$recodes[n.length-8],s=this._$recodes[n.length-7],o=this._$recodes[n.length-6],l=n.length-10;for(let e=0;e<l;++e)r._$recode.push(n[e]);r._$recode.push(t.BITMAP_STROKE,e,a,s,o,i,[1,0,0,1,r._$xMin,r._$yMin],"repeat",!1)}}else r._$recode=this._$recodes.slice(0)}else r._$recode=this._$recodes.slice(0);return a}}class E extends g{constructor(e){super(e),this.buffer=e.buffer,this._$binary="",this._$volume=100,this._$loopCount=0,"volume"in e&&(this.volume=e.volume),"loopCount"in e&&(this.loopCount=e.loopCount),this._$audio=document.createElement("audio"),this._$audio.preload="auto",this._$audio.autoplay=!1,this._$audio.loop=!1,this._$audio.controls=!0,this._$audio.src=URL.createObjectURL(new Blob([new Uint8Array(this._$buffer)],{type:"audio/mp3"})),this._$audio.load()}get preview(){return this._$audio}get defaultSymbol(){return window.next2d.media.Sound.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let a=0;a<t;++a)this._$buffer[a]=255&e.charCodeAt(a);this._$binary=e}}}get volume(){return this._$volume}set volume(e){this._$volume=e}get loopCount(){return this._$loopCount}set loopCount(e){this._$loopCount=e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,buffer:this.buffer,volume:this.volume,loopCount:this.loopCount}}toPublish(){return{buffer:Array.from(this._$buffer),audioBuffer:null,init:!1}}}class I{constructor(e=null){e?(this._$width=e.width,this._$height=e.height,this._$fps=e.fps,this._$bgColor=e.bgColor,this._$lock=e.lock):(this._$width=I.STAGE_DEFAULT_WIDTH,this._$height=I.STAGE_DEFAULT_HEIGHT,this._$fps=I.STAGE_DEFAULT_FPS,this._$bgColor="#ffffff",this._$lock=!1)}static get STAGE_DEFAULT_WIDTH(){return 550}static get STAGE_DEFAULT_HEIGHT(){return 400}static get STAGE_DEFAULT_FPS(){return 24}initialize(){d.$zoomScale=1,document.getElementById("screen-scale").value="100";const e=document.getElementById("stage");e.style.width=`${this.width}px`,e.style.height=`${this.height}px`,e.style.backgroundColor=this.bgColor,document.getElementById("library-preview-area").style.backgroundColor=this.bgColor;const t=document.getElementById("stage-area");t.style.transformOrigin="50% 50%",t.style.width=`${this.width+window.screen.width}px`,t.style.height=`${this.height+window.screen.height}px`,document.getElementById("label-name").value="",document.getElementById("stage-width").value=this.width,document.getElementById("stage-height").value=this.height,document.getElementById("stage-fps").value=this.fps,document.getElementById("stage-bgColor").value=this.bgColor;document.getElementById("stage-lock").childNodes[1].setAttribute("class",this.lock?"active":"disable"),d.$controller._$stageLock=this.lock;const a=document.getElementById("screen");a.scrollLeft=window.screen.width/2-(a.clientWidth-this.width)/2,a.scrollTop=window.screen.height/2-(a.clientHeight-this.height)/2,d.$offsetLeft=e.offsetLeft,d.$offsetTop=e.offsetTop}toObject(){return{width:this.width,height:this.height,fps:this.fps,bgColor:this.bgColor,lock:this.lock}}get width(){return this._$width}set width(e){this._$width=e}get height(){return this._$height}set height(e){this._$height=e}get fps(){return this._$fps}set fps(e){this._$fps=e}get bgColor(){return this._$bgColor}set bgColor(e){this._$bgColor=e}get lock(){return this._$lock}set lock(e){this._$lock=e}}class S extends g{constructor(e=null){super(e),this._$text="",this._$font="sans-serif",this._$size=12,this._$align="left",this._$color=0,this._$fontType=0,this._$inputType="static",this._$leading=0,this._$letterSpacing=0,this._$leftMargin=0,this._$rightMargin=0,this._$autoSize=0,this._$multiline=!0,this._$wordWrap=!0,this._$border=!1,this._$scroll=!0,this._$cache=null,this._$htmlText=null,this._$thickness=0,this._$thicknessColor=0,this._$bounds={xMin:0,xMax:S.FONT_DEFAULT_SIZE,yMin:0,yMax:S.FONT_DEFAULT_SIZE},this._$originBounds={xMin:0,xMax:S.FONT_DEFAULT_SIZE,yMin:0,yMax:S.FONT_DEFAULT_SIZE},e.text&&(this.text=e.text),e.font&&(this.font=e.font),e.fontType&&(this.fontType=e.fontType),e.inputType&&(this.inputType=e.inputType),e.size&&(this.size=e.size),e.align&&(this.align=e.align),e.color&&(this.color=e.color),e.leading&&(this.leading=e.leading),e.letterSpacing&&(this.letterSpacing=e.letterSpacing),e.leftMargin&&(this.leftMargin=e.leftMargin),e.rightMargin&&(this.rightMargin=e.rightMargin),"multiline"in e&&(this.multiline=e.multiline),"wordWrap"in e&&(this.wordWrap=e.wordWrap),e.autoFontSize&&(this.autoFontSize=e.autoFontSize),"scroll"in e&&(this.scroll=e.scroll),e.border&&(this.border=e.border),e.bounds&&(this.bounds=e.bounds),e.originBounds&&(this.originBounds=e.originBounds),e.autoSize&&(this.autoSize=e.autoSize),e.thickness&&(this.thickness=e.thickness),e.thicknessColor&&(this.thicknessColor=e.thicknessColor)}static get FONT_DEFAULT_SIZE(){return 200}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["video-setting","loop-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["text-setting"]);const a=document.getElementById("font-select");a.children[0].selected=!0;for(let e=0;e<a.children.length;++e){const t=a.children[e];if(t.value===this._$font){t.selected=!0;break}}const r=document.getElementById("font-style-select");for(let e=0;e<r.children.length;++e){const t=r.children[e];if((0|t.value)===this._$fontType){t.selected=!0;break}}const s=document.getElementById("font-align-select");for(let e=0;e<s.children.length;++e){const t=s.children[e];if(t.value===this._$align){t.selected=!0;break}}const i=document.getElementById("font-wrap-select");switch(!0){case!this._$wordWrap&&!this._$multiline:i.children[0].selected=!0;break;case!this._$wordWrap&&this._$multiline:i.children[1].selected=!0;break;case this._$wordWrap&&this._$multiline:i.children[2].selected=!0}document.getElementById("font-input-select").children["static"===this._$inputType?0:1].selected=!0,document.getElementById("font-size").value=`${this._$size}`,document.getElementById("font-color").value=`#${this._$color.toString(16).padStart(6,"0")}`,document.getElementById("font-stroke-size").value=`${this._$thickness}`,document.getElementById("font-stroke-color").value=`#${this._$thicknessColor.toString(16).padStart(6,"0")}`;const n=["font-leading","font-letterSpacing","font-leftMargin","font-rightMargin"];for(let e=0;e<n.length;++e){const t=n[e];document.getElementById(t).value=`${this[t.split("-")[1]]}`}document.getElementById("font-auto-size-select").children[this._$autoSize].selected=!0,this._$border&&(document.getElementById("font-border-select").children[1].selected=!0),this._$scroll&&(document.getElementById("font-scroll-select").children[0].selected=!0)}getBounds(e=null){const t={xMin:-this._$thickness,xMax:this._$bounds.xMax+this._$thickness,yMin:-this._$thickness,yMax:this._$bounds.yMax+4+this._$thickness};return e?d.$boundsMatrix(t,e):t}get text(){return this._$text}set text(e){this._$text=e,this.resize()}get size(){return this._$size}set size(e){this._$size=0|e,this.resize()}get font(){return this._$font}set font(e){this._$font=e,this.resize()}get fontType(){return this._$fontType}set fontType(e){this._$fontType=0|e,this.resize()}get inputType(){return this._$inputType}set inputType(e){this._$inputType=e}get align(){return this._$align}set align(e){this._$align=e}get color(){return this._$color}set color(e){this._$color=0|e}get leading(){return this._$leading}set leading(e){this._$leading=0|e,this.resize()}get letterSpacing(){return this._$letterSpacing}set letterSpacing(e){this._$letterSpacing=0|e,this.resize()}get leftMargin(){return this._$leftMargin}set leftMargin(e){this._$leftMargin=0|e,this.resize()}get rightMargin(){return this._$rightMargin}set rightMargin(e){this._$rightMargin=0|e,this.resize()}get multiline(){return this._$multiline}set multiline(e){this._$multiline=!!e,this.resize()}get border(){return this._$border}set border(e){this._$border=!!e}get scroll(){return this._$scroll}set scroll(e){this._$scroll=!!e}get wordWrap(){return this._$wordWrap}set wordWrap(e){this._$wordWrap=!!e,this.resize()}get bounds(){return this._$bounds}set bounds(e){this._$bounds=e}get originBounds(){return this._$originBounds}set originBounds(e){this._$originBounds=e}get autoSize(){return this._$autoSize}set autoSize(e){this._$autoSize=0|e,1!==this._$autoSize&&(this._$bounds.xMax=this._$originBounds.xMax,this._$bounds.yMax=this._$originBounds.yMax),this.resize()}get thickness(){return this._$thickness}set thickness(e){this._$thickness=0|e,this.resize()}get thicknessColor(){return this._$thicknessColor}set thicknessColor(e){this._$thicknessColor=0|e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,text:this.text,font:this.font,fontType:this.fontType,inputType:this.inputType,size:this.size,align:this.align,color:this.color,leading:this.leading,letterSpacing:this.letterSpacing,leftMargin:this.leftMargin,rightMargin:this.rightMargin,multiline:this.multiline,wordWrap:this.wordWrap,border:this.border,autoSize:this.autoSize,scroll:this.scroll,originBounds:this.originBounds,bounds:this.bounds,thickness:this.thickness,thicknessColor:this.thicknessColor}}get defaultSymbol(){return window.next2d.text.TextField.namespace}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,text:this.text,font:this.font,fontType:this.fontType,inputType:this.inputType,size:this.size,align:this.align,color:this.color,leading:this.leading,letterSpacing:this.letterSpacing,leftMargin:this.leftMargin,rightMargin:this.rightMargin,multiline:this.multiline,wordWrap:this.wordWrap,border:this.border,autoSize:this.autoSize,scroll:this.scroll,originBounds:this.originBounds,bounds:this.bounds,thickness:this.thickness,thicknessColor:this.thicknessColor}}resize(){const e=this.createInstance();this._$bounds={xMin:e._$bounds.xMin,xMax:e._$bounds.xMax,yMin:e._$bounds.yMin,yMax:e._$bounds.yMax}}createInstance(){const{TextField:e}=window.next2d.text,t=new e;t._$bounds={xMin:this._$originBounds.xMin,xMax:this._$originBounds.xMax,yMin:this._$originBounds.yMin,yMax:this._$originBounds.yMax},t._$originBounds={xMin:this._$originBounds.xMin,xMax:this._$originBounds.xMax,yMin:this._$originBounds.yMin,yMax:this._$originBounds.yMax};const a=t.defaultTextFormat;switch(a.font=this._$font,a.size=this._$size,a.align=this._$align,a.color=this._$color,a.leading=this._$leading,a.letterSpacing=this._$letterSpacing,a.leftMargin=this._$leftMargin,a.rightMargin=this._$rightMargin,this._$fontType){case 1:a.bold=!0;break;case 2:a.italic=!0;break;case 3:a.bold=!0,a.italic=!0}switch(this._$autoSize){case 1:t.autoSize=this._$align;break;case 2:t.autoFontSize=!0}return t.multiline=this._$multiline,t.wordWrap=this._$wordWrap,t.border=this._$border,t.scroll=this._$scroll,t.thickness=this._$thickness,t.thicknessColor=this._$thicknessColor,t.text=this._$text,t}toImage(e,t,a){const r=super.toImage(e,t,a);r._$tx-=this._$thickness,r._$ty-=this._$thickness;let s=0;switch(this._$autoSize){case 0:"right"===this._$align&&(s=-4);break;case 1:switch(this._$align){case"center":s=(this._$bounds.xMax-this._$originBounds.xMax)/2,s&&(s-=2);break;case"right":s=this._$originBounds.xMax-this._$bounds.xMax,s&&(s+=2,s*=-1)}}return 1===this._$autoSize&&(r._$tx-=s),r}}class w extends g{constructor(e){super(e),this._$volume=100,this._$loop=!1,this._$autoPlay=!0,this._$binary="",this._$queue=[],this._$loaded=!1,this.buffer=e.buffer,this.width=e.width,this.height=e.height,"volume"in e&&(this.volume=e.volume),"loop"in e&&(this.loop=e.loop),"autoPlay"in e&&(this.autoPlay=e.autoPlay),this._$video=document.createElement("video"),this._$video.crossOrigin="anonymous",this._$video.type="video/mp4",this._$video.muted=!0,this._$video.autoplay=!1;const t=e=>{e.target.removeEventListener("canplaythrough",t),e.target.play(),e.target.currentTime=1,e.target.pause(),this._$loaded=!0,setTimeout((()=>{this.delayImage()}),150)};this._$video.addEventListener("canplaythrough",t),this._$video.src=URL.createObjectURL(new Blob([new Uint8Array(this._$buffer)],{type:"video/mp4"})),this._$video.load()}showController(e,t=""){super.showController(e,t),d.$controller.hideObjectSetting(["text-setting","loop-setting","fill-color-setting","nine-slice-setting"]),d.$controller.showObjectSetting(["video-setting"]),document.getElementById("video-volume").value=this.volume,document.getElementById("video-loop-select").children[this.loop?1:0].selected=!0,document.getElementById("video-auto-select").children[this.autoPlay?1:0].selected=!0}get preview(){const e=this.getBounds();let t=Math.abs(e.xMax-e.xMin),a=Math.abs(e.yMax-e.yMin),r=1;const s=150/a;t=t*s|0,a=a*s|0;const i=(0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0])-10;return t>i&&(r=i/t,t=t*r|0,a=a*r|0),this._$video.style.width=`${t}px`,this._$video.style.height=`${a}px`,this._$video.controls=!0,this._$video}getBounds(e=null){const t={xMin:0,xMax:this.width,yMin:0,yMax:this.height};return e?d.$boundsMatrix(t,e):t}get defaultSymbol(){return window.next2d.media.Video.namespace}get buffer(){if(!this._$binary){const e=this._$buffer.length;for(let t=0;t<e;++t)this._$binary+=String.fromCharCode(this._$buffer[t])}return this._$binary}set buffer(e){switch(typeof e){case"object":e.constructor===Uint8Array&&(this._$buffer=e);break;case"string":if(!this._$binary){let t=e.length;this._$buffer=new Uint8Array(t);for(let a=0;a<t;++a)this._$buffer[a]=255&e.charCodeAt(a);this._$binary=e}}}get volume(){return this._$volume}set volume(e){this._$volume=e}get loop(){return this._$loop}set loop(e){this._$loop=e}get autoPlay(){return this._$autoPlay}set autoPlay(e){this._$autoPlay=e}get width(){return this._$width}set width(e){this._$width=e}get height(){return this._$height}set height(e){this._$height=e}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,width:this.width,height:this.height,buffer:this.buffer,volume:this.volume,loop:this.loop,autoPlay:this.autoPlay}}toPublish(){return{symbol:this.symbol,extends:this.defaultSymbol,buffer:Array.from(this._$buffer),bounds:this.getBounds(),volume:this.volume/100,loop:this.loop,autoPlay:this.autoPlay}}createInstance(e,t=!1){e||console.log(e);const{Video:a}=window.next2d.media,r=this._$loaded?new a(this._$video.videoWidth,this._$video.videoHeight):new a(this.width,this.height);if(r._$characterId=this.id,r._$video=this._$video,this._$loaded){const e=d.$root.stage._$player._$context;if(t)r._$video.currentTime=1;else{const e=d.$timelineFrame.currentFrame;r._$video.currentTime=e/60}r._$texture=e.frameBuffer.createTextureFromVideo(r._$video,r._$smoothing)}return r}delayImage(){for(let e=0;e<this._$queue.length;++e){const t=this._$queue[e];t.image.src=this.toImage(t.width,t.height,t.place,t.preview).src}this._$queue.length=0}toImage(e,t,a,r=!1){const s=super.toImage(e,t,a,r);return this._$loaded||this._$queue.push({image:s,width:e,height:t,preview:r,place:a}),s}}class x{constructor(e=null){this._$blurX=4,this._$blurY=4,this._$quality=1,this._$state=!0,this._$name="",e&&(this.blurX=e.blurX,this.blurY=e.blurY,this.quality=0|e.quality,this.state=e.state)}clone(){return new this.constructor(this.toObject())}isSame(e){return this._$quality===e._$quality&&(this._$blurX===e._$blurX&&this._$blurY===e._$blurY)}get blurX(){return this._$blurX}set blurX(e){this._$blurX=d.$clamp(+e,se.MIN_BLUR,se.MAX_BLUR)}get blurY(){return this._$blurY}set blurY(e){this._$blurY=d.$clamp(+e,se.MIN_BLUR,se.MAX_BLUR)}get quality(){return this._$quality}set quality(e){this._$quality=d.$clamp(0|e,1,3)}get state(){return this._$state}set state(e){this._$state=e}get name(){return this._$name}set name(e){this._$name=e}}class L extends x{constructor(e=null){super(e),this.name="BevelFilter",this._$distance=4,this._$angle=45,this._$highlightColor=16777215,this._$highlightAlpha=100,this._$shadowColor=0,this._$shadowAlpha=100,this._$strength=1,this._$type="inner",this._$knockout=!1,e&&(this.distance=e.distance,this.angle=e.angle,this.highlightColor=0|e.highlightColor,this.highlightAlpha=100*e.highlightAlpha,this.shadowColor=0|e.shadowColor,this.shadowAlpha=100*e.shadowAlpha,this.strength=e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,se.MIN_DISTANCE,se.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get highlightColor(){return this._$highlightColor}set highlightColor(e){this._$highlightColor=d.$clamp(0|e,0,16777215)}get highlightAlpha(){return this._$highlightAlpha}set highlightAlpha(e){this._$highlightAlpha=d.$clamp(+e,0,100)}get shadowColor(){return this._$shadowColor}set shadowColor(e){this._$shadowColor=d.$clamp(0|e,0,16777215)}get shadowAlpha(){return this._$shadowAlpha}set shadowAlpha(e){this._$shadowAlpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,se.MIN_STRENGTH,se.MAX_STRENGTH)}get type(){return this._$type}set type(e){this._$type=e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=e}isSame(e){return this._$distance===e._$distance&&(this._$angle===e._$angle&&(this._$highlightColor===e._$highlightColor&&(this._$highlightAlpha===e._$highlightAlpha&&(this._$shadowColor===e._$shadowColor&&(this._$shadowAlpha===e._$shadowAlpha&&(this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))))))))}createInstance(){return new window.next2d.filters.BevelFilter(this.distance,this.angle,this.highlightColor,this.highlightAlpha/100,this.shadowColor,this.shadowAlpha/100,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){return[null,this.distance,this.angle,this.highlightColor,this.highlightAlpha/100,this.shadowColor,this.shadowAlpha/100,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,highlightColor:this.highlightColor,highlightAlpha:this.highlightAlpha/100,shadowColor:this.shadowColor,shadowAlpha:this.shadowAlpha/100,strength:this.strength,type:this.type,knockout:this.knockout}}}class M extends x{constructor(e=null){super(e),this.name="BlurFilter"}createInstance(){return new window.next2d.filters.BlurFilter(this.blurX,this.blurY,this.quality)}toParamArray(){return[null,this.blurX,this.blurY,this.quality]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state}}}class C extends x{constructor(e=null){super(e),this.name="DropShadowFilter",this._$distance=4,this._$angle=45,this._$color=0,this._$alpha=100,this._$strength=1,this._$inner=!1,this._$knockout=!1,this._$hideObject=!1,e&&(this.distance=e.distance,this.angle=e.angle,this.color=e.color,this.alpha=100*e.alpha,this.strength=e.strength,this.inner=e.inner,this.knockout=e.knockout,this.hideObject=e.hideObject)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,se.MIN_DISTANCE,se.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get color(){return this._$color}set color(e){this._$color=d.$clamp(0|e,0,16777215)}get alpha(){return this._$alpha}set alpha(e){this._$alpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,se.MIN_STRENGTH,se.MAX_STRENGTH)}get inner(){return this._$inner}set inner(e){this._$inner=e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=e}get hideObject(){return this._$hideObject}set hideObject(e){this._$hideObject=e}isSame(e){return this._$distance===e._$distance&&(this._$angle===e._$angle&&(this._$color===e._$color&&(this._$alpha===e._$alpha&&(this._$strength===e._$strength&&(this._$inner===e._$inner&&(this._$knockout===e._$knockout&&(this._$hideObject===e._$hideObject&&super.isSame(e))))))))}createInstance(){return new window.next2d.filters.DropShadowFilter(this.distance,this.angle,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout,this.hideObject)}toParamArray(){return[null,this.distance,this.angle,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout,this.hideObject]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,color:this.color,alpha:this.alpha/100,strength:this.strength,inner:this.inner,knockout:this.knockout,hideObject:this.hideObject}}}class F extends x{constructor(e=null){super(e),this.name="GlowFilter",this._$color=0,this._$alpha=100,this._$strength=1,this._$inner=!1,this._$knockout=!1,e&&(this.color=e.color,this.alpha=100*e.alpha,this.strength=e.strength,this.inner=e.inner,this.knockout=e.knockout)}get color(){return this._$color}set color(e){this._$color=+e}get alpha(){return this._$alpha}set alpha(e){this._$alpha=d.$clamp(+e,0,100)}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,se.MIN_STRENGTH,se.MAX_STRENGTH)}get inner(){return this._$inner}set inner(e){this._$inner=e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=e}isSame(e){return this._$color===e._$color&&(this._$alpha===e._$alpha&&(this._$strength===e._$strength&&(this._$inner===e._$inner&&(this._$knockout===e._$knockout&&super.isSame(e)))))}createInstance(){return new window.next2d.filters.GlowFilter(this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout)}toParamArray(){return[null,this.color,this.alpha/100,this.blurX,this.blurY,this.strength,this.quality,this.inner,this.knockout]}toObject(){return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,color:this.color,alpha:this.alpha/100,strength:this.strength,inner:this.inner,knockout:this.knockout}}}class k extends x{constructor(e=null){super(e),this.name="GradientBevelFilter",this._$distance=4,this._$angle=45,this._$colors=[16777215,16711680,0],this._$alphas=[100,0,100],this._$ratios=[0,128,255],this._$strength=1,this._$type="inner",this._$knockout=!1,e&&(this.distance=+e.distance,this.angle=+e.angle,this.colors=e.colors,this.alphas=e.alphas,this.ratios=e.ratios,this.strength=+e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,se.MIN_DISTANCE,se.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get colors(){return this._$colors}set colors(e){this._$colors.length=0,this._$colors=e}get alphas(){return this._$alphas}set alphas(e){this._$alphas.length=0;for(let t=0;t<e.length;++t)this._$alphas.push(100*e[t])}get ratios(){return this._$ratios}set ratios(e){this._$ratios.length=0;for(let t=0;t<e.length;++t)this._$ratios.push(255*e[t])}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,se.MIN_STRENGTH,se.MAX_STRENGTH)}get type(){return this._$type}set type(e){this._$type=e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=e}adjustment(){const e=[],t=[],a=[],r=new Map;for(let t=0;t<this._$ratios.length;++t){const a=this._$ratios[t]/255;e.push(a),r.set(a,t)}e.sort((function(e,t){switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let s=0;s<e.length;++s){const i=r.get(e[s]);t.push(this._$colors[i]),a.push(this._$alphas[i]/100)}return{ratios:e,colors:t,alphas:a}}isSame(e){if(this._$distance!==e._$distance)return!1;if(this._$angle!==e._$angle)return!1;for(let t=0;t<this._$colors.length;++t)if(this._$colors[t]!==e._$colors[t])return!1;for(let t=0;t<this._$alphas.length;++t)if(this._$alphas[t]!==e._$alphas[t])return!1;for(let t=0;t<this._$ratios.length;++t)if(this._$ratios[t]!==e._$ratios[t])return!1;return this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))}createInstance(){const e=this.adjustment();return new window.next2d.filters.GradientBevelFilter(this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){const e=this.adjustment();return[null,this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){const e=this.adjustment();return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,colors:e.colors,alphas:e.alphas,ratios:e.ratios,strength:this.strength,type:this.type,knockout:this.knockout}}}class A extends x{constructor(e=null){super(e),this.name="GradientGlowFilter",this._$distance=4,this._$angle=45,this._$colors=[16777215,0],this._$alphas=[0,100],this._$ratios=[0,255],this._$strength=1,this._$type="outer",this._$knockout=!1,e&&(this.distance=+e.distance,this.angle=+e.angle,this.colors=e.colors,this.alphas=e.alphas,this.ratios=e.ratios,this.strength=+e.strength,this.type=e.type,this.knockout=e.knockout)}get distance(){return this._$distance}set distance(e){this._$distance=d.$clamp(+e,se.MIN_DISTANCE,se.MAX_DISTANCE)}get angle(){return this._$angle}set angle(e){this._$angle=+e%360}get colors(){return this._$colors}set colors(e){this._$colors.length=0,this._$colors=e}get alphas(){return this._$alphas}set alphas(e){this._$alphas.length=0;for(let t=0;t<e.length;++t)this._$alphas.push(100*e[t])}get ratios(){return this._$ratios}set ratios(e){this._$ratios.length=0;for(let t=0;t<e.length;++t)this._$ratios.push(255*e[t])}get strength(){return this._$strength}set strength(e){this._$strength=d.$clamp(+e,se.MIN_STRENGTH,se.MAX_STRENGTH)}get type(){return this._$type}set type(e){this._$type=e}get knockout(){return this._$knockout}set knockout(e){this._$knockout=e}adjustment(){const e=[],t=[],a=[],r=new Map;for(let t=0;t<this._$ratios.length;++t){const a=this._$ratios[t]/255;e.push(a),r.set(a,t)}e.sort((function(e,t){switch(!0){case e>t:return 1;case e<t:return-1;default:return 0}}));for(let s=0;s<e.length;++s){const i=r.get(e[s]);t.push(this._$colors[i]),a.push(this._$alphas[i]/100)}return{ratios:e,colors:t,alphas:a}}isSame(e){if(this._$distance!==e._$distance)return!1;if(this._$angle!==e._$angle)return!1;for(let t=0;t<this._$colors.length;++t)if(this._$colors[t]!==e._$colors[t])return!1;for(let t=0;t<this._$alphas.length;++t)if(this._$alphas[t]!==e._$alphas[t])return!1;for(let t=0;t<this._$ratios.length;++t)if(this._$ratios[t]!==e._$ratios[t])return!1;return this._$strength===e._$strength&&(this._$type===e._$type&&(this._$knockout===e._$knockout&&super.isSame(e)))}createInstance(){const e=this.adjustment();return new window.next2d.filters.GradientGlowFilter(this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout)}toParamArray(){const e=this.adjustment();return[null,this.distance,this.angle,e.colors,e.alphas,e.ratios,this.blurX,this.blurY,this.strength,this.quality,this.type,this.knockout]}toObject(){const e=this.adjustment();return{name:this.name,blurX:this.blurX,blurY:this.blurY,quality:this.quality,state:this.state,distance:this.distance,angle:this.angle,colors:e.colors,alphas:e.alphas,ratios:e.ratios,strength:this.strength,type:this.type,knockout:this.knockout}}}class T{constructor(){this._$buffer=null,this._$bitOffset=0,this._$byteOffset=0}setData(e){this._$buffer=e}getData(e){this.byteAlign();const t=this._$byteOffset+e,a=this._$buffer.slice(this._$byteOffset,t);return this._$byteOffset=t,a}getHeaderSignature(){let e="",t=3;for(;t;){const a=this.getUI8();switch(a){case 32:case 96:case 127:continue}e+=String.fromCharCode(a),--t}return e}getVersion(){return this.getUI8()}byteAlign(){this._$bitOffset&&(this._$byteOffset=this._$byteOffset+(this._$bitOffset+7)/8|0,this._$bitOffset=0)}byteCarry(){if(this._$bitOffset>7)this._$byteOffset=this._$byteOffset+(0|(this._$bitOffset+7)/8),this._$bitOffset&=7;else for(;this._$bitOffset<0;)--this._$byteOffset,this._$bitOffset+=8}getUIBits(e){let t=0;for(;e;)t<<=1,t|=this.getUIBit(),--e;return t}getUIBit(){return this.byteCarry(),this._$buffer[this._$byteOffset]>>7-this._$bitOffset++&1}getSIBits(e){const t=this.getUIBits(e),a=t&1<<e-1;return a?-(t^2*a-1)-1:t}getUI8(){return this.byteAlign(),this._$buffer[this._$byteOffset++]}getUI16(){return this.byteAlign(),this.getUI8()|this.getUI8()<<8}getUI32(){return this.byteAlign(),this.getUI8()|(this.getUI8()|(this.getUI8()|this.getUI8()<<8)<<8)<<8}}class B{constructor(){this._$folderId=0,this._$fileName="",this._$byteStream=new T,this._$bounds={xMin:0,xMax:0,yMin:0,yMax:0},this._$swfVersion=0,this._$info=null,this._$buildData=null,this._$fileSize=0,this._$mode="swf",this._$offset=0}get mode(){return this._$mode}get fileSize(){return this._$fileSize}setData(e){return this._$byteStream.setData(e),this}run(e,t=0){this._$fileName=e.split(".")[0],this._$folderId=t;const a=this._$byteStream.getHeaderSignature();switch(this._$byteStream.getVersion(),this._$fileSize=this._$byteStream.getUI32(),this._$mode="swf",a){case"FWS":return this.parseAndBuild();case"CWS":{if(d.$unzipWorkerActive)return void d.$unzipQueues.push(this);d.$unzipWorkerActive=!0,d.$unzipWorker||(d.$unzipWorker=new Worker(d.$unzipURL));const e=d.$unzipWorker;e.onmessage=d.$unzipHandler.bind(this);const t=this._$byteStream._$buffer;e.postMessage({fileSize:this._$fileSize,mode:this._$mode,buffer:t},[t.buffer])}break;case"ZWS":{if(d.$unlzmaWorkerActive)return void d.$unlzmaQueues.push(this);d.$unlzmaWorkerActive=!0;const e=new Worker(d.$unlzmaWorkerURL);e.onmessage=d.$unlzmaHandler.bind(this);const t=this._$byteStream._$buffer;e.postMessage({fileSize:this._$fileSize,mode:this._$mode,buffer:t},[t.buffer])}break;default:throw new Error("this data is not swf.")}}parseAndBuild(){this._$byteStream.byteAlign();const e=this._$byteStream.getUIBits(5);if(this._$bounds.xMin=this._$byteStream.getSIBits(e),this._$bounds.xMax=this._$byteStream.getSIBits(e),this._$bounds.yMin=this._$byteStream.getSIBits(e),this._$bounds.yMax=this._$byteStream.getSIBits(e),this._$byteStream.getUI16(),this._$byteStream.getUI16(),this._$offset=this._$byteStream._$byteOffset,d.$parserWorkerWait)return void d.$parserQueues.push(this);d.$parserWorkerWait=!0,d.$parserWorker||(d.$parserWorker=new Worker(d.$parserURL)),d.$parserWorker.onmessage=d.$parserHandler.bind(this);const t=this._$byteStream._$buffer;d.$parserWorker.postMessage({version:this._$swfVersion,offset:this._$offset,buffer:t},[t.buffer])}build(){const e=this.buildData.info,t=this.buildData.parent;this.loaderInfo._$bytes._$byteArray=this.buildData.buffer,this.loaderInfo._$actionScriptVersion=e._$asv;let a=!1,r=this.loaderInfo._$symbols.length;if(r){const e=this.loaderInfo._$applicationDomain,t=d.$getArray();for(let s=0;s<r;++s){const r=this.loaderInfo._$symbols[s],i=r.tagId;switch(0===i&&(a=!0),!0){case i in this.loaderInfo._$characters:case this.loaderInfo._$fonts.has(i):{const t=d.$getPackage(e,r.path);if(t._$loaderInfoId===this.loaderInfo._$id||!("__$$characterId"in t.prototype)){t.prototype.__$$characterId=i,t.prototype.__$$loaderInfoId=this.loaderInfo._$id;const e=t.__$$slots,a=d.$Object.keys(e),r=a.length;for(let t=0;t<r;++t){const r=e[a[t]];r.__$$classInit&&r.__$$classInit()}d.$poolArray(a)}}}t[i]=r.path}this.loaderInfo._$symbols=t}if(a){const e=d.$buildAVM2(this.loaderInfo._$applicationDomain,this.loaderInfo._$symbols[0]);e._$root=e,e._$symbolBuild(0,this.loaderInfo._$id,t),this.loaderInfo._$content=e}else b._$targetBuild(this.loaderInfo._$content,t),this.loaderInfo._$content._$characterBuild();if(r=e._$sceneInfo.length,r){const t=d.$getArray();for(let a=0;a<r;++a){const r=e._$sceneInfo[a],s=new Scene(r.name,d.$getArray(),1);s._$offset=r.offset;const i=a+1|0;let n=this.loaderInfo._$content._$totalFrames;i in e._$sceneInfo&&(n=0|e._$sceneInfo[i].offset),s._$numFrames=n-s._$offset|0;const o=this.loaderInfo._$content.currentLabels;if(o){const e=o.length,t=d.$getArray();for(let a=0;a<e;++a){const e=o[a];e.frame>r.offset&&e.frame<=n&&(t[t.length]=e)}s._$labels=t}t[t.length]=s}this.loaderInfo._$content._$scenes=t}}}class P{static parse(e,t){const a=/<defs>(.*)<\/defs>/gis.exec(e),r=P.parseXML(`${e.replace(/<defs>(.*)<\/defs>/gis,"")}`);if(r){P.parsePath(r,t,a?a[1]:null);const e=[];for(const a of t._$layers.values())e.unshift(a);t.clearLayer();for(let a=0;a<e.length;++a)t.setLayer(a,e[a])}}static parseXML(e){const t=/<((path|rect|circle|polygon).+?)\/>/gi,a=[];for(let r="1";r;)r=t.exec(e),r&&a.push(r[1]);return a}static parsePath(e,t,a=null){const{Shape:r,Graphics:s}=window.next2d.display,i=d.$currentWorkSpace();for(let a=0;a<e.length;++a){const n=(new r).graphics,o=e[a];let l=/stroke-width=\"(.+?)\"/gi.exec(o);if(l||(l=/stroke-width:(.+?)["|;]/gi.exec(o)),l&&(l=+l[1],l)){let e=/stroke=\"(.+?)\"/gi.exec(o);e||(e=/stroke:(.+?)["|;]/gi.exec(o)),n.lineStyle(l,e?e[1]:0)}let c=/fill=\"(.+?)\"/gi.exec(o);c||(c=/fill:(.+?)["|;]/gi.exec(o));let h=1,u=/style=\"(.+?)\"/gi.exec(o);u&&u[1].indexOf("opacity")>-1&&(h=u[1].split(":")[1]),c?n.beginFill(c[1],+h):l||n.beginFill(0,+h);const m=i.nextLibraryId,g=i.addLibrary(d.$libraryController.createInstance("shape",`Shape_${m}`,m)),p=new _;p.name=`Layer_${t._$layers.size}`,t.setLayer(t._$layers.size,p);const $=new f;$.libraryId=g.id;const y=p.adjustmentLocation(1);if($.startFrame=y.startFrame,$.endFrame=y.endFrame,$.setPlace(y.startFrame,{frame:y.startFrame,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:p._$characters.length}),p.addCharacter($),o.indexOf("rect")>-1){const e=o.replace("rect",""),t=+/x=\"(.+?)\"/gi.exec(e)[1],a=+/y=\"(.+?)\"/gi.exec(e)[1],r=+/width=\"(.+?)\"/gi.exec(e)[1],s=+/height=\"(.+?)\"/gi.exec(e)[1],i=+/rx=\"(.+?)\"/gi.exec(e)[1];n.drawRoundRect(t,a,r,s,2*i).endFill(),g._$recodes=n._$recode.slice(),g._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax};continue}if(o.indexOf("circle")>-1){const e=o.replace("rect",""),t=+/cx=\"(.+?)\"/gi.exec(e)[1],a=+/cy=\"(.+?)\"/gi.exec(e)[1],r=+/r=\"(.+?)\"/gi.exec(e)[1];n.drawCircle(t,a,r).endFill(),g._$recodes=n._$recode.slice(),g._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax};continue}if(o.indexOf("polygon")>-1){const e=o.replace("polygon","");let t=/points=\"(.+?)\"/gi.exec(e)[1];t=t.replace(/,/g," "),t=t.replace(/-/g," -"),t=t.trim().split(" "),t=P._$adjParam(t),n.moveTo(+t[0],+t[1]);for(let e=2;e<t.length;e+=2)n.lineTo(+t[e],+t[e+1]);n.endFill(),g._$recodes=n._$recode.slice(),g._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax};continue}let b=!1,v=0,E=0;const I=[0,0],S=[0,0],w=/([a-z])([^a-z]*)/gi,x=/ d=\"(.+?)\"/gi.exec(o)[1];for(let e="1";e;)if(e=w.exec(x),e){const t=`${e[1]}`;let a=e[2];switch(t){case"m":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a),I[0]+=+a[0],I[1]+=+a[1],b||(b=!0,v=I[0],E=I[1]),n.moveTo(I[0],I[1]);for(let e=2;e<a.length;e+=2)I[0]+=+a[e],I[1]+=+a[e+1],S[0]=I[0],S[1]=I[1],n.lineTo(I[0],I[1]);break;case"M":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a),I[0]=+a[0],I[1]=+a[1],b||(b=!0,v=I[0],E=I[1]),n.moveTo(I[0],I[1]);for(let e=2;e<a.length;e+=2)I[0]=+a[e],I[1]=+a[e+1],S[0]=I[0],S[1]=I[1],n.lineTo(I[0],I[1]);break;case"l":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a);for(let e=0;e<a.length;e+=2)I[0]+=+a[e],I[1]+=+a[e+1],S[0]=I[0],S[1]=I[1],n.lineTo(I[0],I[1]);break;case"L":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a);for(let e=0;e<a.length;e+=2)I[0]=+a[e],I[1]=+a[e+1],S[0]=I[0],S[1]=I[1],n.lineTo(I[0],I[1]);break;case"h":I[0]+=+a,S[0]=I[0],n.lineTo(I[0],I[1]);break;case"H":I[0]=+a,S[0]=I[0],n.lineTo(I[0],I[1]);break;case"v":I[1]+=+a,S[1]=I[1],n.lineTo(I[0],I[1]);break;case"V":I[1]=+a,S[1]=I[1],n.lineTo(I[0],I[1]);break;case"q":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a);for(let e=0;e<a.length;e+=4)a[e]=+a[e]+I[0],a[e+1]=+a[e+1]+I[1],a[e+2]=+a[e+2]+I[0],a[e+3]=+a[e+3]+I[1],n.curveTo(a[e],a[e+1],a[e+2],a[e+3]),I[0]=a[e+2],I[1]=a[e+3],S[0]=I[0],S[1]=I[1];break;case"Q":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a);for(let e=0;e<a.length;e+=4)a[e]=+a[e],a[e+1]=+a[e+1],a[e+2]=+a[e+2],a[e+3]=+a[e+3],n.curveTo(a[e],a[e+1],a[e+2],a[e+3]),I[0]=a[e+2],I[1]=a[e+3],S[0]=I[0],S[1]=I[1];break;case"c":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a);for(let e=0;e<a.length;e+=6)a[e]=+a[e]+I[0],a[e+1]=+a[e+1]+I[1],a[e+2]=+a[e+2]+I[0],a[e+3]=+a[e+3]+I[1],a[e+4]=+a[e+4]+I[0],a[e+5]=+a[e+5]+I[1],n.cubicCurveTo(a[e],a[e+1],a[e+2],a[e+3],a[e+4],a[e+5]),I[0]=a[e+4],I[1]=a[e+5],S[0]=2*a[e+4]-a[e+2],S[1]=2*a[e+5]-a[e+3];break;case"C":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a);for(let e=0;e<a.length;e+=6)a[e]=+a[e],a[e+1]=+a[e+1],a[e+2]=+a[e+2],a[e+3]=+a[e+3],a[e+4]=+a[e+4],a[e+5]=+a[e+5],n.cubicCurveTo(a[e],a[e+1],a[e+2],a[e+3],a[e+4],a[e+5]),I[0]=a[e+4],I[1]=a[e+5],S[0]=2*a[e+4]-a[e+2],S[1]=2*a[e+5]-a[e+3];break;case"s":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a);for(let e=0;e<a.length;e+=4)a[e]=+a[e]+I[0],a[e+1]=+a[e+1]+I[1],a[e+2]=+a[e+2]+I[0],a[e+3]=+a[e+3]+I[1],n.cubicCurveTo(S[0],S[1],a[e],a[e+1],a[e+2],a[e+3]),I[0]=a[e+2],I[1]=a[e+3],S[0]=2*a[e+2]-a[e],S[1]=2*a[e+3]-a[e+1];break;case"S":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a);for(let e=0;e<a.length;e+=4)a[e]=+a[e],a[e+1]=+a[e+1],a[e+2]=+a[e+2],a[e+3]=+a[e+3],n.cubicCurveTo(S[0],S[1],a[e],a[e+1],a[e+2],a[e+3]),I[0]=a[e+2],I[1]=a[e+3],S[0]=2*a[e+2]-a[e],S[1]=2*a[e+3]-a[e+1];break;case"a":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a);for(let e=0;e<a.length;e+=7){a[e]=+a[e],a[e+1]=+a[e+1],a[e+2]=+a[e+2],a[e+3]=+a[e+3],a[e+4]=+a[e+4],a[e+5]=+a[e+5]+I[0],a[e+6]=+a[e+6]+I[1];const t=P._$arcToCurve(I[0],I[1],a[e+5],a[e+6],a[e+3],a[e+4],a[e],a[e+1],a[e+2]);for(let e=0;e<t.length;++e){const a=t[e];n.cubicCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])}I[0]=a[e+5],I[1]=a[e+6],S[0]=I[0],S[1]=I[1]}break;case"A":a=a.replace(/,/g," "),a=a.replace(/-/g," -"),a=a.trim().split(" "),a=P._$adjParam(a);for(let e=0;e<a.length;e+=7){a[e]=+a[e],a[e+1]=+a[e+1],a[e+2]=+a[e+2],a[e+3]=+a[e+3],a[e+4]=+a[e+4],a[e+5]=+a[e+5],a[e+6]=+a[e+6];const t=P._$arcToCurve(I[0],I[1],a[e+5],a[e+6],a[e+3],a[e+4],a[e],a[e+1],a[e+2]);for(let e=0;e<t.length;++e){const a=t[e];n.cubicCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])}I[0]=a[e+5],I[1]=a[e+6],S[0]=I[0],S[1]=I[1]}break;case"z":case"Z":n._$fills&&n._$fills.push(s.CLOSE_PATH),n._$lines&&n._$lines.push(s.CLOSE_PATH),I[0]=v,I[1]=E,S[0]=I[0],S[1]=I[1],b=!1;break;default:console.log("TODO: ",t,a)}}n.endLine(),n.endFill(),n._$recode&&(g._$recodes=n._$recode.slice()),g._$bounds={xMin:n._$xMin,xMax:n._$xMax,yMin:n._$yMin,yMax:n._$yMax}}}static _$adjParam(e){for(;;){let t=0;for(let a=0;a<e.length;++a){const r=e[a];if(!isNaN(r)){t++;continue}const s=r.split(".");e.splice(a+1,0,`0.${s.pop()}`),e[a]=s.join(".")}if(e.length===t)break}return e}static _$arc(e,t,a,r,s,i){let n=Math.min(Math.ceil(2*r+1),1024);if(n<1)return;s=void 0===s?0:s;const o=((i=void 0===i?2*Math.PI:i)-s)/n;for(let i=0;i<=n;i++){const n=s+i*o;e.lineTo(t+Math.cos(n)*r,a+Math.sin(n)*r)}}static _$arcToCurve(e,t,a,r,s,i,n,o,l){const c=2*Math.PI,d=Math.sin(l*c/360),h=Math.cos(l*c/360),u=h*(e-a)/2+d*(t-r)/2,m=-d*(e-a)/2+h*(t-r)/2;if(0===u&&0===m||0===n||0===o)return[];n=Math.abs(n),o=Math.abs(o);const g=u*u/(n*n)+m*m/(o*o);g>1&&(n*=Math.sqrt(g),o*=Math.sqrt(g));const p=P._$getArcCenter(e,t,a,r,s,i,n,o,d,h),f=[];let $=p[2],y=p[3];const _=Math.max(Math.ceil(Math.abs(y)/(c/4)),1);y/=_;for(let e=0;e<_;e++)f.push(P._$approximateUnitArc($,y)),$+=y;return f.map((e=>{for(let t=0;t<e.length;t+=2){let a=e[t],r=e[t+1];a*=n,r*=o;const s=h*a-d*r,i=d*a+h*r;e[t]=s+p[0],e[t+1]=i+p[1]}return e.shift(),e.shift(),e}))}static _$approximateUnitArc(e,t){const a=4/3*Math.tan(t/4),r=Math.cos(e),s=Math.sin(e),i=Math.cos(e+t),n=Math.sin(e+t);return[r,s,r-s*a,s+r*a,i+n*a,n-i*a,i,n]}static _$getArcCenter(e,t,a,r,s,i,n,o,l,c){const d=2*Math.PI,h=c*(e-a)/2+l*(t-r)/2,u=-l*(e-a)/2+c*(t-r)/2,m=n*n,g=o*o,p=h*h,f=u*u;let $=m*g-m*f-g*p;$<0&&($=0),$/=m*f+g*p,$=Math.sqrt($)*(s===i?-1:1);const y=$*n/o*u,_=$*-o/n*h,b=c*y-l*_+(e+a)/2,v=l*y+c*_+(t+r)/2,E=(h-y)/n,I=(u-_)/o,S=(-h-y)/n,w=(-u-_)/o,x=P._$unitVectorAngle(1,0,E,I);let L=P._$unitVectorAngle(E,I,S,w);return 0===i&&L>0&&(L-=d),1===i&&L<0&&(L+=d),[b,v,x,L]}static _$unitVectorAngle(e,t,a,r){let s=e*a+t*r;return s>1&&(s=1),s<-1&&(s=-1),(e*r-t*a<0?-1:1)*Math.acos(s)}}d.$vtc=new class{clone(e){const t=function(e,a){const r=Object.keys(e),s=0|r.length;for(let i=0;i<s;++i){const s=r[i],n=e[s];switch(!0){case d.$isArray(n):a[s]=[],t(n,a[s]);break;case"object"==typeof n:a[s]={},t(n,a[s]);break;default:a[s]=n}}},a={};return t(e,a),a}convert(e,t=!1){let a=e.lineStyles,r=e.fillStyles,s=0,i={},n=[],o=0,l=0,c=0,d=0,h=0,u=0,m=0,g=0,p=0,f=[],$=[],y=[],_=[],b=0;const v=e.ShapeData,E=v.records,I=v.styles;let S=0,w=0;for(;;){const e=E[S++];if(-1===e){_=this.setStack(_,this.fillMerge(f,$,t)),_=this.setStack(_,y);break}if(e){if(++b,E[S++]){_=this.setStack(_,this.fillMerge(f,$,t)),_=this.setStack(_,y),o=0,l=0,f=[],$=[],y=[];const e=I[w++];E[S++]&&(r=e.FillStyles),E[S++]&&(a=e.LineStyles)}c=o,d=l,E[S++]&&(c=o=E[S++]/20,d=o=E[S++]/20),h=c,u=d,E[S++]&&(m=E[S++]),E[S++]&&(g=E[S++]),E[S++]&&(p=E[S++]);continue}const v=E[S++],x=v?E[S++]/20:0,L=v?E[S++]/20:0;o=E[S++]/20,l=E[S++]/20;const M={isCurved:v,ControlX:x,ControlY:L,AnchorX:o,AnchorY:l};if(m&&(s=m-1|0,s in f||(f[s]=[]),b in f[s]||(f[s][b]={obj:r?r[s]:null,startX:c,startY:d,endX:0,endY:0,cache:[]}),i=f[s][b],n=i.cache,n[n.length]=this.clone(M),i.endX=o,i.endY=l),g&&(s=g-1|0,s in $||($[s]=[]),b in $[s]||($[s][b]={obj:r?r[s]:null,startX:c,startY:d,endX:0,endY:0,cache:[]}),i=$[s][b],n=i.cache,n[n.length]=this.clone(M),i.endX=o,i.endY=l),p){s=p-1|0,s in y||(y[s]={obj:a?a[s]:null,cache:[]}),i=y[s],n=i.cache,n[n.length]=[0,h,u];let e=[2,o,l];v&&(e=[1,x,L,o,l]),n[n.length]=e}h=o,u=l}return this.toGraphicPath(_)}toGraphicPath(e){const{Graphics:t,GradientType:a,InterpolationMethod:r,SpreadMethod:s,CapsStyle:i,JointStyle:n}=window.next2d.display;let o=!1;const l=[];for(let c=0;c<e.length;++c){const h=e[c];l.push(t.BEGIN_PATH);for(let e=0;e<h.recode.length;++e)l.push.apply(l,h.recode[e]);const u="Width"in h.object;let m=0,g=i.NONE,p=0,f=n.ROUND;if(u){switch(m=h.object.Width,h.object.StartCapStyle){case 0:g=i.ROUND;break;case 1:g=i.NONE;break;case 2:g=i.SQUARE}switch(h.object.JoinStyle){case 0:f=n.ROUND;break;case 1:f=n.BEVEL;break;case 2:f=n.MITER,p=h.object.MiterLimitFactor}}const $=h.object.HasFillFlag?h.object.FillType:h.object;switch($.fillStyleType){case 0:u?l.push(t.STROKE_STYLE,m,g,f,p,$.Color.R,$.Color.G,$.Color.B,255*$.Color.A,t.END_STROKE):l.push(t.FILL_STYLE,$.Color.R,$.Color.G,$.Color.B,255*$.Color.A,t.END_FILL);break;case 16:case 18:case 19:{const e=$.gradient,i=[],n=e.GradientRecords;for(let e=0;e<n.length;++e){const t=n[e];i.push({ratio:t.Ratio,R:t.Color.R,G:t.Color.G,B:t.Color.B,A:255*t.Color.A})}const o=0===e.InterpolationMode?r.RGB:r.LINEAR_RGB;let c=s.PAD;switch(e.SpreadMode){case 0:c=s.PAD;break;case 1:c=s.REFLECT;break;case 2:c=s.REPEAT}u?l.push(t.GRADIENT_STROKE,m,g,f,p,16===$.fillStyleType?a.LINEAR:a.RADIAL,i,$.gradientMatrix,c,o,e.FocalPoint):l.push(t.GRADIENT_FILL,16===$.fillStyleType?a.LINEAR:a.RADIAL,i,$.gradientMatrix,c,o,e.FocalPoint)}break;case 64:case 65:case 66:case 67:{o=!0;const e=d.$currentWorkSpace().getLibrary(d.$characters.get($.bitmapId)),a=function(e,r){if(!this._$buffer)return requestAnimationFrame(a);const s=64===r.fillStyleType||65===r.fillStyleType,i=64===r.fillStyleType||66===r.fillStyleType,n=d.$multiplicationMatrix(r.bitmapMatrix,[.05,0,0,.05,0,0]),{BitmapData:o}=window.next2d.display,l=new o(this.width,this.height,!0,0);l._$buffer=this._$buffer,e.push(t.BITMAP_FILL,l,Array.from(n),i?"repeat":"no-repeat",s)}.bind(e,l,$);a()}}}return l.push(o),l}fillMerge(e,t,a){if((e=this.fillReverse(e)).length){const a=Object.keys(e),r=0|a.length;for(let s=0;s<r;++s){const r=a[s],i=e[r];if(r in t){const e=t[r],a=Object.keys(i),s=0|a.length;for(let t=0;t<s;++t)e[e.length]=i[a[t]]}else t[r]=i}}return this.coordinateAdjustment(t,a)}fillReverse(e){if(!e.length)return e;const t=Object.keys(e),a=0|t.length;for(let r=0;r<a;++r){const a=e[t[r]],s=Object.keys(a),i=0|s.length;for(let e=0;e<i;++e){let t=0,r=0;const i=a[s[e]];let n=i.startX,o=i.startY;const l=i.cache;let c=0|l.length;if(c){const e=Object.keys(l),a=0|e.length;for(let s=0;s<a;++s){const a=l[e[s]];t=a.AnchorX,r=a.AnchorY,a.AnchorX=n,a.AnchorY=o,n=t,o=r}const s=[];if(c>0)for(;c;)--c,s[s.length]=l[c];i.cache=s}n=i.startX,o=i.startY,i.startX=i.endX,i.startY=i.endY,i.endX=n,i.endY=o}}return e}coordinateAdjustment(e,t){const a=Object.keys(e),r=0|a.length;for(let s=0;s<r;++s){const r=a[s],i=[],n=e[r],o=Object.keys(n),l=0|o.length;for(let e=0;e<l;++e)i[i.length]=n[o[e]];let c=[];if(!0==(i.length>1&&!t))for(;i.length;){const e=i.shift();if(e.startX===e.endX&&e.startY===e.endY){c[c.length]=e;continue}let t=0,a=0|i.length;for(;a;){--a;const r=i[a];if(r.startX===e.endX&&r.startY===e.endY){e.endX=r.endX,e.endY=r.endY;const s=e.cache,n=r.cache,o=0|n.length;for(let e=0;e<o;++e)s[s.length]=n[e];i.splice(a,1),i.unshift(e),t=1;break}}t||i.unshift(e)}else c=i;const d=0|c.length,h=[];let u={};for(let e=0;e<d;++e){const t=c[e];u=t.obj;const a=t.cache,r=0|a.length;h[h.length]=[0,t.startX,t.startY];for(let e=0;e<r;++e){const t=a[e];h[h.length]=t.isCurved?[1,t.ControlX,t.ControlY,t.AnchorX,t.AnchorY]:[2,t.AnchorX,t.AnchorY]}}e[r]={cache:h,obj:u}}return e}setStack(e,t){if(t.length){const a=Object.keys(t),r=0|a.length;for(let s=0;s<r;++s){const r=t[a[s]];e.push({object:r.obj,recode:r.cache})}}return e}};class U{constructor(e=""){if(this._$name="",this._$stage=null,this._$libraries=new Map,this._$plugins=new Map,this._$position=0,this._$characterId=0,this._$revision=[],this._$currentData=null,this._$timelineHeight=pe.TIMELINE_DEFAULT_SIZE,this._$controllerWidth=re.CONTROLLER_DEFAULT_SIZE,e&&this.load(e),!this._$libraries.has(0)){const e=new b({id:0,type:"container",name:"main",symbol:""});this._$libraries.set(0,e)}this._$stage||(this._$stage=new I)}get root(){return this._$libraries.get(0)}get stage(){return this._$stage}get name(){return this._$name}set name(e){this._$name=`${e}`}get scene(){return this._$scene}set scene(e){const t=!this._$scene;this._$scene&&this._$scene.stop(),this._$scene=e,e.initialize(t)}get nextLibraryId(){const e=Array.from(this._$libraries.keys());e.sort((function(e,t){return e>t?1:e<t?-1:0}));return(0|this._$libraries.get(0|e.pop()).id)+1}initialize(e){this.scene=e,d.$libraryController.reload(Array.from(this._$libraries.values())),d.$javascriptController.reload(),d.$pluginController.reload(Array.from(this._$plugins.values()))}run(){this.stage.initialize(),this.initialize(this.root),document.documentElement.style.setProperty("--timeline-height",`${this._$timelineHeight}px`),document.documentElement.style.setProperty("--controller-width",`${this._$controllerWidth}px`)}stop(){this._$scene&&(this._$scene.stop(),this._$scene=null)}load(e){const t=JSON.parse(e);if(this._$characterId=0|t.characterId,this._$name=t.name,this._$stage=new I(t.stage),this._$plugins.size&&this._$plugins.clear(),t.plugins)for(let e=0;e<t.plugins.length;++e){const a=t.plugins[e];this._$plugins.set(a.name,a)}this._$libraries.size&&this._$libraries.clear();const a=t.libraries;for(let e=0;e<a.length;++e)this.addLibrary(a[e]);t.setting&&(this._$timelineHeight=t.setting.timelineHeight,this._$controllerWidth=t.setting.controllerWidth)}toJSON(){const e=[];for(const t of this._$libraries.values())e.push(t.toObject());return JSON.stringify({version:d.VERSION,name:this.name,characterId:this._$characterId,stage:this.stage.toObject(),libraries:e,plugins:Array.from(this._$plugins.values()),setting:{timelineHeight:this._$timelineHeight,controllerWidth:this._$controllerWidth}})}temporarilySaved(){d.$updated=!0,this._$currentData&&(this._$currentData=null),this._$position!==this._$revision.length&&(this._$revision.length=this._$position),this._$revision.push(this.toJSON()),this._$position++,this._$revision.length>d.REVISION_LIMIT&&(this._$revision.shift(),this._$position=this._$revision.length)}undo(){this._$position&&(this._$currentData||(this._$currentData=this.toJSON()),this.reloadData(this._$revision[--this._$position]))}redo(){if(!this._$revision.length||this._$position===this._$revision.length)return;let e=null;if(this._$position+1===this._$revision.length){if(!this._$currentData)return;e=this._$currentData,this._$position++,this._$currentData=null}else e=this._$revision[++this._$position];e&&this.reloadData(e)}reloadData(e){const t=[],a=d.$timelineLayer.targetLayers;for(const e of a.keys())t.push(e);d.$tools.getDefaultTool("arrow").clear(),d.$tools.reset();const r=this._$scene.currentFrame,s=this._$scene.id;this._$scene.stop(),this._$scene=null,this.load(e);const i=this.getLibrary(s);if(i._$currentFrame=r,this.initialize(i),t.length){const e=d.$ctrlKey;d.$ctrlKey=!0;for(let e=0;e<t.length;++e){const a=document.getElementById(`${t[e]}`);a&&d.$timelineLayer.activeLayer(a)}d.$ctrlKey=e}}addLibrary(e){let t;switch(e.type){case"container":t=new b(e);break;case"bitmap":t=new p(e);break;case"text":t=new S(e);break;case"sound":t=new E(e);break;case"video":t=new w(e);break;case"shape":t=new v(e);break;case"folder":t=new y(e)}return this._$libraries.set(t.id,t),t}getLibrary(e){return this._$libraries.get(0|e)}removeLibrary(e){this._$libraries.delete(0|e)}}class D{static get MOUSE_DOWN(){return"mousedown"}static get MOUSE_UP(){return"mouseup"}static get MOUSE_MOVE(){return"mousemove"}static get START(){return"start"}static get END(){return"end"}static get DBL_CLICK(){return"dblclick"}static get CHANGE(){return"change"}static get MOUSE_OVER(){return"mouseover"}static get MOUSE_OUT(){return"mouseout"}static get KEY_DOWN(){return"keydown"}static get MOUSE_LEAVE(){return"mouseleave"}}class O{constructor(e){this._$areaName=e,this._$active=!1,this._$mapping=new Map,this._$execute=null,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}get areaName(){return this._$areaName}get active(){return this._$active}set active(e){this._$active=!!e,this._$active?window.addEventListener("keydown",this._$execute):window.removeEventListener("keydown",this._$execute)}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),this._$execute=this.execute.bind(this),d.$initializeEnd()}add(e,t){this._$mapping.set(e,t)}delete(e){this._$mapping.delete(e)}execute(e){if(d.$keyLock||!this._$active)return;let t=d.$generateShortcutKey(e.key,{alt:d.$altKey,shift:d.$shiftKey,ctrl:d.$ctrlKey});const a=d.$shortcutSetting.commandMapping.get(this.areaName);if(a.has(t))t=a.get(t);else{if(d.$shortcutSetting.viewMapping.get(this.areaName).has(t))return}this._$mapping.has(t)&&(d.$endMenu(),e.stopPropagation(),e.preventDefault(),this._$mapping.get(t)(t))}}d.$keyboardCommand=new O;d.$project=new class{initialize(){const e=document.getElementById("tools-load");e&&e.addEventListener("click",(e=>{e.preventDefault(),this.open()}));const t=document.getElementById("tools-load-file-input");t&&t.addEventListener("change",(e=>{const t=e.target.files;for(let e=0;e<t.length;++e)this.load(t[e]);e.target.value=""}));const a=document.getElementById("tools-save");a&&a.addEventListener("click",(e=>{e.preventDefault(),this.save()}));const r=document.getElementById("tools-export");r&&r.addEventListener("click",(e=>{e.preventDefault(),this.publish()}));const s=document.getElementById("language-setting");if(s){const e=localStorage.getItem(`${d.PREFIX}@language-setting`);if(e){const t=s.children;for(let a=0;a<t.length;++a){const r=t[a];if(r.value===e){r.selected=!0;break}}}s.addEventListener("change",(e=>{const t=e.target.value,a=d.$languages.get(t);d.$currentLanguage=new a,localStorage.setItem(`${d.PREFIX}@language-setting`,t),d.$addModalEvent(document)}))}}publish(){const e=document.getElementById("save-anchor");e.href&&URL.revokeObjectURL(e.href);switch(document.getElementById("publish-type-setting").value){case"json":e.download=`${d.$currentWorkSpace().name}.json`,e.href=URL.createObjectURL(new Blob([X.toJSON()],{type:"application/json"})),e.click();break;case"zlib":X.toZlib();break;case"webm":X.toWebM();break;case"gif-loop":X.toGIF();break;case"gif":X.toGIF(-1);break;case"png":X.toPng();break;case"apng-loop":X.toApng(!0);break;case"apng":X.toApng(!1);break;case"custom":"CustomPublish"in window&&window.CustomPublish.execute(X.toObject())}}load(e){e.arrayBuffer().then((e=>{const t=new Uint8Array(e);d.$unZlibWorker.postMessage({buffer:t,type:"n2d"},[t.buffer])}))}open(){document.getElementById("tools-load-file-input").click()}save(){const e={object:d.$currentWorkSpace().toJSON(),type:"n2d"};d.$zlibWorkerActive?d.$zlibQueues.push(e):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(e))}};class X{static toObject(){const e=d.$currentWorkSpace(),t=e.stage,a=e._$libraries,r=[];for(let[e,t]of a)switch(!0){case 0===e:case"folder"!==t.type:case""!==t.symbol:case d.$useIds.has(e):{const a=t.toPublish();a.symbol&&d.$symbols.set(a.symbol,r.length),r[e]=a}break;default:r[e]=null}let s=d.$useIds.size;for(;;){for(let[e,t]of a){if(r[e])continue;if(!d.$useIds.has(e))continue;const a=t.toPublish();a.symbol&&d.$symbols.set(a.symbol,r.length),r[e]=a}if(s===d.$useIds.size)break;s=d.$useIds.size}return{stage:{width:t.width,height:t.height,fps:t.fps,bgColor:t.bgColor},characters:r}}static toJSON(){d.$symbols.size&&d.$symbols.clear();const e=X.toObject();return e.symbols=Array.from(d.$symbols),e.type="json",JSON.stringify(e)}static toZlib(){d.$symbols.size&&d.$symbols.clear();const e=X.toObject();e.symbols=Array.from(d.$symbols);const t={object:JSON.stringify(e),type:"json"};d.$zlibWorkerActive?d.$zlibQueues.push(t):(d.$zlibWorkerActive=!0,d.$zlibWorker.postMessage(t))}static toWebM(){const e=document.getElementById("__next2d__").children[0].captureStream(0|document.getElementById("stage-fps").value),t=[],a="video/webm;codecs=h264",r=new MediaRecorder(e,{mimeType:a});r.addEventListener("dataavailable",(e=>{t.push(e.data)})),r.addEventListener("stop",(()=>{d.$hidePreview();const e=document.getElementById("save-anchor");e.download=`${d.$currentWorkSpace().name}.webm`,e.href=URL.createObjectURL(new Blob(t,{type:a})),e.click()}));const s=function(){if(d.$root.numChildren)return d.$root.currentFrame>=d.$root.totalFrames?r.stop():void requestAnimationFrame(s);requestAnimationFrame(s)};s(),d.$showPreview(),r.start(0)}static toGIF(e=0){const t=new GIF({repeat:e,workerScript:"./assets/js/gif.worker.js"});t.on("finished",(e=>{const t=document.getElementById("save-anchor");t.download=`${d.$currentWorkSpace().name}.gif`,t.href=URL.createObjectURL(e),t.click()}));const a=function(){if(!d.$root.numChildren)return void requestAnimationFrame(a);const e=document.getElementById("__next2d__").children[0],r=document.createElement("canvas");r.width=e.width,r.height=e.height;const s=r.getContext("2d");if(s.drawImage(e,0,0,e.width,e.height),t.addFrame(s.canvas,{delay:20}),d.$root.currentFrame>=d.$root.totalFrames)return d.$hidePreview(),void t.render();requestAnimationFrame(a)};a(),d.$showPreview()}static toPng(){const e=()=>{if(!d.$root.numChildren)return void requestAnimationFrame(e);const t=d.$root.stage;if(!t)return void requestAnimationFrame(e);if(t._$player._$stopFlag)return void requestAnimationFrame(e);const a=document.getElementById("__next2d__").children[0],r=document.getElementById("save-anchor");r.download=`${d.$currentWorkSpace().name}.png`,r.href=a.toDataURL(),r.click(),d.$hidePreview()};e(),d.$showPreview()}static toApng(e=!0){const t=[];let a=0;const r=()=>{if(d.$root.stage._$player._$stopFlag||!d.$root.numChildren||a===d.$root.currentFrame)return void requestAnimationFrame(r);a=d.$root.currentFrame;const s=document.getElementById("__next2d__").children[0],i=document.createElement("canvas");i.width=s.width,i.height=s.height;if(i.getContext("2d").drawImage(s,0,0,s.width,s.height),s.toBlob((e=>{t.push(e)})),t.length+1===d.$root.totalFrames)return d.$hidePreview(),new m(t,s.width,s.height,0|document.getElementById("stage-fps").value,e).encode().then((e=>{const t=document.getElementById("save-anchor");t.download=`${d.$currentWorkSpace().name}.apng`,t.href=URL.createObjectURL(e),t.click()}));requestAnimationFrame(r)};r(),d.$showPreview()}}d.$shortcutSetting=new class{constructor(){this._$names=["screen","timeline","library"],this._$default={screen:[{key:"v",text:"V",css:"tools-arrow",description:"{{選択ツール}}"},{key:"a",text:"A",css:"tools-transform",description:"{{Shape変形ツール}}"},{key:"p",text:"P",css:"tools-pen",description:"{{ペンツール}}"},{key:"k",text:"K",css:"tools-bucket",description:"{{バケツツール}}"},{key:"r",text:"R",css:"tools-rectangle",description:"{{矩形ツール}}"},{key:"o",text:"O",css:"tools-circle",description:"{{楕円ツール}}"},{key:"rShift",text:"Shift + R",css:"tools-round-rect",description:"{{角丸矩形ツール}}"},{key:"t",text:"T",css:"tools-text",description:"{{テキストツール}}"},{key:"z",text:"Z",css:"tools-zoom",description:"{{ズームツール}}"},{key:"rCtrl",text:"Ctrl + R",css:"tools-load",description:"{{プロジェクトデータの読込}}"},{key:"sShiftCtrl",text:"Ctrl + Shift + S",css:"tools-save",description:"{{プロジェクトデータを保存}}"},{key:"EnterShiftCtrl",text:"Ctrl + Shift + Enter",css:"tools-export",description:"{{書き出し}}"},{key:"s",text:"S",css:"tools-setting",description:"{{設定}}"},{key:"ArrowUpShiftCtrl",text:"Ctrl + Shift + ArrowUp",css:"screen-front",description:"{{最前面}}"},{key:"ArrowUpCtrl",text:"Ctrl + ArrowUp",css:"screen-front-one",description:"{{ひとつ前面へ}}"},{key:"ArrowDownCtrl",text:"Ctrl + ArrowDown",css:"screen-menu-bottom",description:"{{ひとつ背面へ}}"},{key:"ArrowDownShiftCtrl",text:"Ctrl + Shift + ArrowDown",css:"screen-back",description:"{{最背面}}"},{key:"1",text:"1",css:"screen-position-left",description:"{{左揃え}}"},{key:"2",text:"2",css:"screen-position-center",description:"{{中央揃え(水平方向)}}"},{key:"3",text:"3",css:"screen-position-right",description:"{{右揃え}}"},{key:"4",text:"4",css:"screen-position-top",description:"{{上揃え}}"},{key:"5",text:"5",css:"screen-position-middle",description:"{{中央揃え(垂直方向)}}"},{key:"6",text:"6",css:"screen-position-bottom",description:"{{下揃え}}"},{key:"!Shift",text:"Shift + 1",css:"stage-position-left",description:"{{ステージ左揃え}}"},{key:'"Shift',text:"Shift + 2",css:"stage-position-center",description:"{{ステージ中央揃え(水平方向)}}"},{key:"#Shift",text:"Shift + 3",css:"stage-position-right",description:"{{ステージ右揃え}}"},{key:"$Shift",text:"Shift + 4",css:"stage-position-top",description:"{{ステージ上揃え}}"},{key:"%Shift",text:"Shift + 5",css:"stage-position-middle",description:"{{ステージ中央揃え(垂直方向)}}"},{key:"&Shift",text:"Shift + 6",css:"stage-position-bottom",description:"{{ステージ下揃え}}"},{key:"dCtrl",text:"Ctrl + D",css:"screen-distribute-to-layers",description:"{{レイヤーに配分}}"},{key:"kCtrl",text:"Ctrl + K",css:"screen-distribute-to-keyframes",description:"{{キーフレームに配分}}"},{key:"iCtrl",text:"Ctrl + I",css:"screen-integrating-paths",description:"{{パスの結合}}"},{key:"pCtrl",text:"Ctrl + P",css:"screen-add-tween-curve-pointer",description:"{{カーブポインターの追加}}"},{key:"pShiftCtrl",text:"Ctrl + Shift + P",css:"screen-delete-tween-curve-pointer",description:"{{カーブポインターの削除}}"},{key:"mShift",text:"Shift + M",css:"screen-change-movie-clip",description:"{{MovieClipに変換}}"}],timeline:[{key:"nShift",text:"Shift + N",css:"timeline-layer-normal",description:"{{通常レイヤー}}"},{key:"mShift",text:"Shift + M",css:"timeline-layer-mask",description:"{{マスクレイヤー}}"},{key:"gShift",text:"Shift + G",css:"timeline-layer-guide",description:"{{ガイドレイヤー}}"},{key:";Ctrl",text:"Ctrl + +",css:"timeline-layer-add",description:"{{レイヤーを追加}}"},{key:"BackspaceCtrl",text:"Ctrl + Delete",css:"timeline-layer-trash",description:"{{レイヤーを削除}}"},{key:"hShift",text:"Shift + H",css:"timeline-layer-light-all",description:"{{全てのレイヤーをハイライト}}"},{key:"dShift",text:"Shift + D",css:"timeline-layer-disable-all",description:"{{全てのレイヤーを非表示}}"},{key:"lShift",text:"Shift + L",css:"timeline-layer-lock-all",description:"{{全てのレイヤーをロック}}"},{key:"m",text:"M",css:"context-menu-tween-add",description:"{{モーショントゥイーンの追加}}"},{key:"mCtrl",text:"Ctrl + M",css:"context-menu-tween-delete",description:"{{モーショントゥイーンの削除}}"},{key:"s",text:"S",css:"timeline-script-add",description:"{{スクリプトを追加}}"},{key:"k",text:"K",css:"timeline-key-add",description:"{{キーフレームを追加}}"},{key:"kCtrl",text:"Ctrl + K",css:"timeline-key-delete",description:"{{キーフレームを削除}}"},{key:"e",text:"E",css:"timeline-empty-add",description:"{{空のキーフレームを追加}}"},{key:"f",text:"F",css:"timeline-frame-add",description:"{{フレームを追加}}"},{key:"fCtrl",text:"Ctrl + F",css:"timeline-frame-delete",description:"{{フレームを削除}}"},{key:"oCtrl",text:"Ctrl + O",css:"timeline-onion-skin",description:"{{オニオンスキン}}"},{key:"p",text:"P",css:"timeline-preview",description:"{{プレビューのON/OFF}}"},{key:"pCtrl",text:"Ctrl + P",css:"timeline-repeat",description:"{{ループ設定}}"},{key:"l",text:"L",css:"label-name",description:"{{フレームラベル}}"},{key:"z",text:"Z",css:"timeline-scale",description:"{{タイムライン幅の拡大・縮小}}"}],library:[{key:"mCtrl",text:"Ctrl + M",css:"library-menu-container-add",description:"{{新規MovieClip}}"},{key:"fCtrl",text:"Ctrl + F",css:"library-menu-folder-add",description:"{{新規フォルダー}}"},{key:"sAlt",text:"Alt + S",css:"library-menu-content-shape-clone",description:"{{Shapeを複製}}"},{key:"rCtrl",text:"Ctrl + R",css:"library-menu-file",description:"{{読み込み}}"},{key:"rCtrl",text:"Ctrl + R",css:"library-menu-export",description:"{{書き出し}}"},{key:"Backspace",text:"Delete",css:"library-menu-delete",description:"{{削除}}"},{key:"BackspaceShiftCtrl",text:"Shift + Ctrl + Delete",css:"library-menu-no-use-delete",description:"{{未使用のアイテムを削除}}"}]},this._$commandMapping=new Map([["screen",new Map],["timeline",new Map],["library",new Map],["global",new Map]]),this._$viewMapping=new Map([["screen",new Map],["timeline",new Map],["library",new Map],["global",new Map]]),this._$active=!1,this._$selectNode=null,this._$selectArea="",this._$keydownEvent=null,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}get commandMapping(){return this._$commandMapping}get viewMapping(){return this._$viewMapping}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=["shortcut-setting-screen","shortcut-setting-timeline","shortcut-setting-library","shortcut-setting-reset","shortcut-setting-save","shortcut-setting-close"];for(let t=0;t<e.length;++t){const a=document.getElementById(e[t]);a&&a.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.executeFunction(e)}))}this.createShortcutMap();for(let e=0;e<this._$names.length;++e){const t=this._$names[e],a=document.getElementById(`shortcut-list-${t}`);if(!a)continue;const r=this.viewMapping.get(t),s=this._$default[t];for(let e=0;e<s.length;++e){const t=s[e],i=`\n<div class="shortcut-item">\n    <i class="${t.css}"></i>\n    <div class="description">\n        <span class="language" data-text="${t.description}">${d.$currentLanguage.replace(t.description)}</span>\n    </div>\n    <div class="command" data-key="${t.key}" data-default-text="${t.text}">${t.text}</div>\n</div>`;a.insertAdjacentHTML("beforeend",i);const n=a.lastElementChild;n.addEventListener("mousedown",(e=>{this.selectNode(e)}));const o=n.lastElementChild;if(!r.has(o.dataset.key))continue;const l=r.get(o.dataset.key);o.dataset.map=l.map,o.textContent=l.text}}this._$keydownEvent=this.keydownEvent.bind(this),d.$initializeEnd()}createShortcutMap(){const e=localStorage.getItem(`${d.PREFIX}@shortcut`);if(!e)return;const t=JSON.parse(e),a=Object.keys(t);for(let e=0;e<a.length;++e){const r=a[e];this.viewMapping.get(r).clear(),this.commandMapping.get(r).clear();const s=t[r];for(let e=0;e<s.length;++e){const t=s[e];this.viewMapping.get(r).set(t.key,{map:t.map,text:t.text}),this.commandMapping.get(r).set(t.map,t.key)}}}keydownEvent(e){if(document.getElementById("shortcut-setting-menu").classList.contains("fadeOut"))return d.$useShortcutSetting=!1,this._$active=!1,void window.removeEventListener("keydown",this._$keydownEvent);if(!this._$selectNode||!this._$selectArea)return;const t=[];switch(d.$shiftKey&&t.push("Shift"),d.$altKey&&t.push("Alt"),d.$ctrlKey&&t.push("Ctrl"),!0){case"ArrowRight"===e.key:case"ArrowLeft"===e.key:case"ArrowUp"===e.key:case"ArrowDown"===e.key:t.push(e.key);break;case" "===e.key:t.push(e.code);break;case 1===e.key.length:t.push(e.key.toUpperCase());break;default:return}const a=this._$selectNode.lastElementChild;a.textContent=`${t.join(" + ")}`;const r=d.$generateShortcutKey(e.key,{alt:d.$altKey,shift:d.$shiftKey,ctrl:d.$ctrlKey});r!==a.dataset.key?(a.dataset.map=r,a.dataset.text=a.textContent):(delete a.dataset.map,delete a.dataset.text)}selectNode(e){this._$selectNode&&this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=e.target,this._$selectNode.classList.add("shortcut-active")}executeFunction(e){this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}executeShortcutSettingScreen(){document.getElementById("shortcut-setting-screen").classList.add("shortcut-active"),document.getElementById("shortcut-setting-timeline").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-library").classList.remove("shortcut-active"),document.getElementById("shortcut-list-screen").style.display="",document.getElementById("shortcut-list-timeline").style.display="none",document.getElementById("shortcut-list-library").style.display="none",this._$selectArea="screen",this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null)}executeShortcutSettingTimeline(){document.getElementById("shortcut-setting-screen").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-timeline").classList.add("shortcut-active"),document.getElementById("shortcut-setting-library").classList.remove("shortcut-active"),document.getElementById("shortcut-list-screen").style.display="none",document.getElementById("shortcut-list-timeline").style.display="",document.getElementById("shortcut-list-library").style.display="none",this._$selectArea="timeline",this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null)}executeShortcutSettingLibrary(){document.getElementById("shortcut-setting-screen").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-timeline").classList.remove("shortcut-active"),document.getElementById("shortcut-setting-library").classList.add("shortcut-active"),document.getElementById("shortcut-list-screen").style.display="none",document.getElementById("shortcut-list-timeline").style.display="none",document.getElementById("shortcut-list-library").style.display="",this._$selectArea="library",this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null)}executeShortcutSettingReset(){localStorage.removeItem(`${d.PREFIX}@shortcut`);for(let e=0;e<this._$names.length;++e){const t=this._$names[e],a=document.getElementById(`shortcut-list-${t}`).children;for(let e=0;e<a.length;++e){const t=a[e].lastElementChild;t.textContent=t.dataset.defaultText,t.dataset.map&&(delete t.dataset.map,delete t.dataset.text)}this.viewMapping.get(t).clear(),this.commandMapping.get(t).clear()}this.createShortcutMap()}executeShortcutSettingSave(){localStorage.removeItem(`${d.PREFIX}@shortcut`);const e={};for(let t=0;t<this._$names.length;++t){const a=this._$names[t],r=document.getElementById(`shortcut-list-${a}`).children;for(let t=0;t<r.length;++t){const s=r[t].lastElementChild;s.dataset.map&&(e[a]||(e[a]=[]),e[a].push({key:s.dataset.key,map:s.dataset.map,text:s.textContent}))}}localStorage.setItem(`${d.PREFIX}@shortcut`,JSON.stringify(e)),this.createShortcutMap()}executeShortcutSettingClose(){d.$userSetting.show(),this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null,this._$selectArea="")}show(){const e=document.getElementById("shortcut-setting-menu");this._$selectNode&&(this._$selectNode.classList.remove("shortcut-active"),this._$selectNode=null,this._$selectArea=""),this.executeShortcutSettingScreen(),this._$active||(d.$useShortcutSetting=!0,this._$active=!0,window.addEventListener("keydown",this._$keydownEvent)),d.$endMenu("shortcut-setting-menu");const t=document.getElementById("user-setting");e.style.display="",e.style.left=`${t.offsetLeft}px`,e.style.top=`${t.offsetTop}px`,e.setAttribute("class","fadeIn")}};class Y extends class extends class{addEventListener(e,t){this._$events.has(e)||this._$events.set(e,[]),this._$events.get(e).push(t)}dispatchEvent(e,t=null){if(!this._$events.has(e))return;const a=this._$events.get(e);for(let e=0;e<a.length;++e){(0,a[e])(t)}}}{constructor(){super(),this._$events=new Map([[D.MOUSE_DOWN,[e=>{this.active=!0,this.target=e.currentTarget}]],[D.MOUSE_UP,[()=>{this.active=!1,this.target=null}]],[D.START,[()=>{d.$setCursor("auto");const e=document.getElementById(`tools-${this._$name}`);e&&e.classList.add("active")}]],[D.END,[()=>{const e=document.getElementById(`tools-${this._$name}`);e&&e.classList.remove("active")}]]])}}{constructor(e){if(super(),this._$name=e,this._$cursor="auto",this._$pageX=0,this._$pageY=0,this._$offsetX=0,this._$offsetY=0,this._$active=!1,this._$target=null,e){d.$tools.setTool(e,this);let t=document.getElementById(`tools-${e}`);if(!t){const a=document.getElementById("plugin-tools");if(a){const r=document.createElement("div");r.id=`tools-${e}`,r.classList.add("item"),r.dataset.mode="tool",r.dataset.name=e,a.appendChild(r),t=r}}t&&t.addEventListener(D.MOUSE_DOWN,(()=>{d.$tools.activeTool&&d.$tools.activeTool.dispatchEvent(D.END),this.dispatchEvent(D.START),d.$tools.activeTool=this}))}}get name(){return this._$name}get pageX(){return this._$pageX}set pageX(e){this._$pageX=e}get pageY(){return this._$pageY}set pageY(e){this._$pageY=e}get offsetX(){return this._$offsetX}set offsetX(e){this._$offsetX=e}get offsetY(){return this._$offsetY}set offsetY(e){this._$offsetY=e}get active(){return this._$active}set active(e){this._$active=!!e}get target(){return this._$target}set target(e){this._$target=e}setIcon(e){const t=document.getElementById(`tools-${this._$name}`),a=t.children;for(;a.length;)a[0].remove();t.appendChild(e)}setToolTip(e){const t=document.getElementById(`tools-${this._$name}`);t&&(t.dataset.detail=`${e}`)}setCursor(e="auto"){this._$cursor=`${e}`}}class R{constructor(){this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize(),this._$activeTool=null,this._$tools=new Map,this._$externalTools=new Map}static get FILL_DEFAULT_COLOR(){return"#000000"}static get STROKE_DEFAULT_COLOR(){return"#000000"}static get STROKE_DEFAULT_SIZE(){return 0}get activeTool(){return this._$activeTool}set activeTool(e){this._$activeTool=e}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=[j,J,K,G,V,Z,W,q,Q,H];for(let t=0;t<e.length;++t){const a=new(0,e[t]);this._$tools.set(a.name,a)}const t=document.getElementById("fill-color");t&&(t.value=localStorage.getItem(`${d.PREFIX}@${t.id}`)||R.FILL_DEFAULT_COLOR,t.addEventListener("change",(e=>{const t=e.target;localStorage.setItem(`${d.PREFIX}@${t.id}`,e.target.value)})));const a=document.getElementById("stroke-color");a&&(a.value=localStorage.getItem(`${d.PREFIX}@${a.id}`)||R.STROKE_DEFAULT_COLOR,a.addEventListener("change",(e=>{const t=e.target;localStorage.setItem(`${d.PREFIX}@${t.id}`,t.value)})));const r=document.getElementById("stroke-size");r&&(r.value=localStorage.getItem(`${d.PREFIX}@${r.id}`)||R.STROKE_DEFAULT_SIZE,r.addEventListener("focusout",(e=>{const t=e.target;localStorage.setItem(`${d.PREFIX}@${t.id}`,t.value)})));const s=document.getElementById("tools");s&&(s.addEventListener("mousemove",(e=>{e.stopPropagation();const t=this.activeTool;t&&(e.tools=!0,t.dispatchEvent(D.MOUSE_MOVE,e))})),s.addEventListener("mouseout",(e=>{d.$setCursor("auto"),e.stopPropagation()}))),d.$project.initialize(),d.$userSetting.initialize(),d.$initializeEnd()}setTool(e,t){this._$externalTools.set(e,t)}getTool(e){return this._$externalTools.has(e)?this._$externalTools.get(e):null}getDefaultTool(e){return this._$tools.get(e)}reset(){const e=this.activeTool;e&&e.dispatchEvent(D.END);const t=this.getDefaultTool("arrow");t.dispatchEvent(D.START),this.activeTool=t}}d.$tools=new R;d.$userSetting=new class{initialize(){const e=document.getElementById("tools-setting");e&&e.addEventListener("click",(e=>{this.show(e)}));const t=this.getPublishSetting(),a=document.getElementById("publish-layer-setting");a&&(a.children[t.layer?1:0].selected=!0,a.addEventListener("change",(e=>{const t=this.getPublishSetting();t.layer="1"===e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))})));const r=document.getElementById("publish-type-setting");if(r){for(let e=0;e<r.children.length;++e){const a=r.children[e];if(t.type===a.value){a.selected=!0;break}}r.addEventListener("change",(e=>{const t=this.getPublishSetting();t.type=e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))}))}const s=document.getElementById("modal-setting");s&&("modal"in t&&(s.children[t.modal?0:1].selected=!0),s.addEventListener("change",(e=>{const t=this.getPublishSetting();t.modal="1"===e.target.value,localStorage.setItem(`${d.PREFIX}@user-publish-setting`,JSON.stringify(t))})));const i=document.getElementById("shortcut-setting");i&&i.addEventListener("click",(()=>{d.$shortcutSetting.show()}))}getPublishSetting(){const e=localStorage.getItem(`${d.PREFIX}@user-publish-setting`);return e?JSON.parse(e):{layer:!1,type:"zlib"}}show(){const e=document.getElementById("user-setting");d.$endMenu("user-setting");const t=document.getElementById("tools-setting");e.style.display="",e.style.left=`${t.offsetLeft+30}px`,e.style.top=t.offsetTop-e.clientHeight+80+"px",e.setAttribute("class","fadeIn")}};class N extends Y{constructor(e){super(e),this.initialize()}initialize(){}changeNodeEvent(e=!0){d.$hitColor=null;const t=document.getElementById("stage-area");if(t){const a=t.children;for(let t=0;t<a.length;++t){const r=a[t];r.dataset.shapePointer?(r.remove(),--t):r.dataset.child&&(r.style.pointerEvents=e?"auto":"none")}}}createShape(e,t=0,a=0){const r=d.$currentWorkSpace().scene,s=0|d.$timelineLayer.targetLayer.dataset.layerId,i=r.getLayer(0|s);if(i.lock)return;const n=d.$currentWorkSpace().addLibrary(e),o=d.$timelineFrame.currentFrame,l=i.adjustmentLocation(o),c=new f;c.libraryId=n.id,c.startFrame=l.startFrame,c.endFrame=l.endFrame,c.setPlace(l.startFrame,{frame:l.startFrame,matrix:[1,0,0,1,t,a],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:i._$characters.length}),i.addCharacter(c),i.reloadStyle(),d.$libraryController.reload()}createTextField(e,t=0,a=0){const r=d.$currentWorkSpace().scene,s=0|d.$timelineLayer.targetLayer.dataset.layerId,i=r.getLayer(0|s);if(i.lock)return;const n=d.$currentWorkSpace().addLibrary(e),o=d.$timelineFrame.currentFrame,l=i.adjustmentLocation(o),c=new f;c.libraryId=n.id,c.startFrame=l.startFrame,c.endFrame=l.endFrame,c.setPlace(l.startFrame,{frame:l.startFrame,matrix:[1,0,0,1,t,a],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:i._$characters.length}),i.addCharacter(c),i.reloadStyle(),d.$libraryController.reload()}reloadScreen(){const e=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(e)}}class z extends N{constructor(e){super(e)}initialize(){this.setCursor("crosshair"),this.addEventListener(D.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(!1)})),this.addEventListener(D.MOUSE_DOWN,(e=>{d.$setCursor(this._$cursor),this.active=!!e.screen,e.screen&&this.mouseDown(e)})),this.addEventListener(D.MOUSE_MOVE,(e=>{d.$setCursor(this._$cursor),e.screen&&this.active&&(e.stopPropagation(),this.mouseMove(e))})),this.addEventListener(D.MOUSE_UP,(e=>{d.$setCursor(this._$cursor),e.stopPropagation(),e.screen&&(d.$timelineLayer.attachLayer(),this.createCharacter(),document.getElementById("draw-rect").style.display="none",d.$tools.reset())}))}createCharacter(e){const t=document.getElementById("draw-rect"),{Graphics:a}=window.next2d.display,r=0|document.getElementById("stroke-size").value,s=(parseFloat(t.style.width)+r)/d.$zoomScale,i=(parseFloat(t.style.height)+r)/d.$zoomScale;if(s&&i){const t=d.$currentWorkSpace();t.temporarilySaved();const n=new a;switch(n.beginFill(document.getElementById("fill-color").value,1),e){case"rectangle":n.drawRect(0,0,s,i);break;case"circle":n.drawEllipse(0,0,s,i);break;case"round-rect":n.drawRoundRect(0,0,s,i,Math.min(s,i)/4)}n.endFill();const o=(this.offsetX-d.$offsetLeft)/d.$zoomScale,l=(this.offsetY-d.$offsetTop)/d.$zoomScale,c=t.nextLibraryId;if(this.createShape({id:c,type:"shape",name:`Shape_${c}`,symbol:"",recodes:n._$recode?n._$recode.slice(0):[],bounds:{xMin:0,xMax:s,yMin:0,yMax:i}},o+r/2,l+r/2),r){const n=new a;switch(n.lineStyle(r,document.getElementById("stroke-color").value),e){case"rectangle":n.drawRect(0,0,s,i);break;case"circle":n.drawEllipse(0,0,s,i);break;case"round-rect":n.drawRoundRect(0,0,s,i,Math.min(s,i)/4)}n.endLine();const o=Math.abs(n._$xMax-n._$xMin)-s,l=Math.abs(n._$yMax-n._$yMin)-i,c=this.offsetX-d.$offsetLeft,h=this.offsetY-d.$offsetTop,u=t.nextLibraryId;this.createShape({id:u,type:"shape",name:`Shape_${u}`,symbol:"",recodes:n._$recode?n._$recode.slice(0):[],bounds:{xMin:-o/2,xMax:s+o/2,yMin:-l/2,yMax:i+l/2}},c+o/2,h+l/2)}this.reloadScreen()}}mouseDown(e){this.pageX=e.pageX,this.pageY=e.pageY,this.offsetX=e.offsetX,this.offsetY=e.offsetY,"stage-area"!==e.target.id&&(this.offsetX+=e.target.offsetLeft,this.offsetY+=e.target.offsetTop);const t=document.getElementById("draw-rect");t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,t.style.width="0px",t.style.height="0px",t.style.display="",t.style.background=document.getElementById("fill-color").value,t.style.borderRadius="",t.style.border="";const a=0|document.getElementById("stroke-size").value;a&&(t.style.borderRadius=`${a}px`,t.style.border=`${a}px solid ${document.getElementById("stroke-color").value}`)}mouseMove(e){e.preventDefault();const t=e.pageX,a=e.pageY,r=document.getElementById("draw-rect");if("circle"===this.name&&(r.style.borderRadius="50%"),d.$shiftKey){const s=Math.max(Math.abs(t-this.pageX),Math.abs(a-this.pageY));this.pageX<t&&(r.style.left=`${this.pageX}px`),this.pageY<a&&(r.style.top=`${this.pageY}px`),this.pageX>t&&(this.offsetX=e.offsetX,r.style.left=this.pageX-s+"px"),this.pageY>a&&(this.offsetY=e.offsetY,r.style.top=this.pageY-s+"px"),r.style.width=`${s}px`,r.style.height=`${s}px`}else this.pageX>t&&(this.offsetX=e.offsetX,r.style.left=`${t}px`),this.pageY>a&&(this.offsetY=e.offsetY,r.style.top=`${a}px`),r.style.width=`${Math.abs(t-this.pageX)}px`,r.style.height=`${Math.abs(a-this.pageY)}px`;if("round-rect"===this.name){const e=Math.min(parseFloat(r.style.width),parseFloat(r.style.height));r.style.borderRadius=(e/8|0)+"px"}}}class j extends N{constructor(){super("arrow"),this._$saved=!1,this._$activeElement="",this._$activeElements=[]}initialize(){this.addEventListener(D.MOUSE_OVER,(e=>{const t=0|e.currentTarget.dataset.layerId,a=document.getElementById(`layer-lock-icon-${t}`);a&&!a.classList.contains("icon-active")&&d.$setCursor("move")})),this.addEventListener(D.MOUSE_OUT,(()=>{d.$setCursor("auto")})),this.addEventListener(D.CHANGE,(e=>{this.changeCharacter(e)})),this.addEventListener(D.MOUSE_LEAVE,(()=>{this.active=!1})),this.addEventListener(D.MOUSE_DOWN,(e=>{switch(this.active=!1,!0){case e.displayObject:this.active=!0,this._$activeElement=j.DISPLAY_OBJECT,d.$endMenu(),this.activateElement(e);break;case e.screen:this.active=!0,this._$activeElement=j.SCREEN,d.$endMenu(),this.clear(),this.startRect(e);break;case e.transform:this.active=!0,this._$activeElement=j.TRANSFORM,d.$endMenu(),this.startPosition(e);break;case e.grid:this.active=!0,this._$activeElement=j.GRID,d.$endMenu(),this.startPosition(e);break;default:this._$activeElement=""}})),this.addEventListener(D.MOUSE_MOVE,(e=>{if(this.active)switch(e.stopPropagation(),e.preventDefault(),this._$activeElement){case j.DISPLAY_OBJECT:this.moveDisplayObject(e);break;case j.SCREEN:this.moveRect(e);break;case j.TRANSFORM:this.moveTransform(e);break;case j.GRID:this.moveGrid(e)}})),this.addEventListener(D.MOUSE_UP,(e=>{if(this._$activeElement){if(this._$activeElement===j.SCREEN)e.stopPropagation(),this.endRect();this._$activeElement="",this._$saved=!1}})),this.addEventListener(D.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent()})),this.addEventListener(D.END,(()=>{this.clearActiveElement(),d.$transformController.hide(),d.$gridController.hide(),d.$tweenController.clearPointer(),d.$controller.default()})),this.addEventListener(D.DBL_CLICK,(e=>{e.screen&&!this._$activeElements.length&&this.moveScene()})),this.dispatchEvent(D.START),d.$tools.activeTool=this}get activeElements(){return this._$activeElements}static get SCREEN(){return"screen"}static get TRANSFORM(){return"transform"}static get DISPLAY_OBJECT(){return"displayObject"}static get GRID(){return"grid"}clear(){this.clearActiveElement(),d.$clearShapePointer(),d.$transformController.hide(),d.$gridController.hide(),d.$tweenController.clearPointer(),d.$controller.default(),d.$timelineLayer.clear(),d.$referenceController.resetPointer()}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}clearActiveElement(){this._$activeElements.length=0}deleteDisplayObject(){const e=this.activeElements;if(!e.length)return;this.save();const t=d.$timelineFrame.currentFrame,a=new Map,r=d.$currentWorkSpace().scene;for(let s=0;s<e.length;++s){const i=e[s],n=r.getLayer(0|i.dataset.layerId);if(!n)continue;const o=n.getCharacter(0|i.dataset.characterId);o&&(a.has(n.id)||a.set(n.id,{layer:n,range:o.getRange(t)}),o.remove(n))}this.clearActiveElement();for(const e of a.values()){const a=e.layer,r=e.range,s=a.getActiveCharacter(r.startFrame);if(s.length){a.sort(s,t);for(let e=0;e<s.length;++e)s[e].getPlace(t).depth=e}else a.addEmptyCharacter(new $({startFrame:r.startFrame,endFrame:r.endFrame}));a.reloadStyle()}this.reloadScreen(),this._$saved=!1}addElement(e,t=!1){for(let t=0;t<this._$activeElements.length;++t){if(this._$activeElements[t].dataset.characterId===e.dataset.characterId)return d.$shiftKey?(d.$tweenController.clearPointer(),this._$activeElements.splice(t,1)):this._$activeElements.splice(t,1,e),!1}t||d.$shiftKey||this.clearActiveElement(),this._$activeElements.push(e);const a=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId).getCharacter(0|e.dataset.characterId),r=a.getRange(d.$timelineFrame.currentFrame);return a.hasTween(r.startFrame)&&d.$tweenController.clearPointer().relocationPointer(),!0}activateElement(e){let t=this.target;const a=0|t.dataset.layerId,r=d.$currentWorkSpace().scene.getLayer(a);if(r.lock)return;this.pageX=e.pageX,this.pageY=e.pageY,d.$timelineLayer.clear();const s=r.getCharacter(0|t.dataset.characterId);if(d.$altKey){const e=s.clone();for(const[t,a]of e._$places){let e=0;const s=r.getActiveCharacter(t);for(let a=0;a<s.length;++a)e=Math.max(s[a].getPlace(t).depth,e);a.depth=e+1}r.addCharacter(e);const a=d.$timelineFrame.currentFrame;d.$screen.appendCharacter(e,a,r.id),t=document.getElementById(`character-${e.id}`)}this.addElement(t),this.updateControllerProperty(),1===this._$activeElements.length&&s.showShapeColor(e),d.$transformController.show().relocation(),d.$gridController.show().relocation(),this.activeTimeline()}activeTimeline(){d.$timelineLayer.clear();const e=d.$timelineFrame.currentFrame,t=d.$ctrlKey;d.$ctrlKey=this._$activeElements.length>1;for(let t=0;t<this._$activeElements.length;++t){const a=0|this._$activeElements[t].dataset.layerId,r=document.getElementById(`layer-id-${a}`);d.$timelineLayer.targetLayers.has(r.id)||(d.$timelineLayer.targetLayer=r),d.$timelineLayer.addTargetFrame(a,document.getElementById(`${a}-${e}`))}d.$ctrlKey=t}changeCharacter(e){if(1!==this._$activeElements.length)return;const t=d.$currentWorkSpace(),a=t.scene,r=this._$activeElements[0],s=0|r.dataset.layerId,i=a.getLayer(s),n=0|r.dataset.characterId,o=i.getCharacter(n);o._$libraryId=0|e.target.value,o._$image=null;const l=t.getLibrary(o._$libraryId);if("container"===l.type)for(const e of o._$places.values())e.loop=d.$getDefaultLoopConfig();const c=o.getRange(d.$timelineFrame.currentFrame);o.hasTween(c.startFrame)&&d.$tweenController.clearPointer().relocationPointer();document.getElementById("instance-type-name").getElementsByTagName("i")[0].setAttribute("class",`library-type-${l.type}`),this.reloadScreen(),d.$transformController.show().relocation()}startRect(e){this.pageX=e.pageX,this.pageY=e.pageY;const t=document.getElementById("stage-rect");t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,t.style.width="0px",t.style.height="0px",t.style.display=""}moveRect(e){const t=e.pageX,a=e.pageY,r=document.getElementById("stage-rect");this.pageX>t&&(r.style.left=`${t}px`),this.pageY>a&&(r.style.top=`${a}px`),r.style.width=`${Math.abs(t-this.pageX)}px`,r.style.height=`${Math.abs(a-this.pageY)}px`}endRect(){const e=document.getElementById("stage-rect");e.style.display="none";const t=parseFloat(e.style.width),a=parseFloat(e.style.height);if(!t||!a)return;const r=parseFloat(e.style.left),s=parseFloat(e.style.top),i=r+t,n=s+a,o=document.getElementById("stage-area").children;for(let e=0;e<o.length;++e){const t=o[e];switch(!0){case!t.dataset.child:case"tween"===t.dataset.child:case"true"===t.dataset.preview:continue}const a=t.getBoundingClientRect();switch(!0){case a.bottom<s:case a.top>n:case a.right<r:case a.left>i:continue}const l=0|t.dataset.layerId;document.getElementById(`layer-lock-icon-${l}`).classList.contains("icon-active")||this.addElement(t,!0)}this._$activeElements.length&&(this.updateControllerProperty(),d.$transformController.show().relocation(),this.activeTimeline())}startPosition(e){this.pageX=e.pageX,this.pageY=e.pageY}moveGrid(e){d.$setCursor("move"),e.preventDefault();const t=(e.pageX-this.pageX)/d.$zoomScale,a=(e.pageY-this.pageY)/d.$zoomScale;let r=+document.getElementById("nine-slice-setting-x").value,s=+document.getElementById("nine-slice-setting-y").value,i=+document.getElementById("nine-slice-setting-w").value,n=+document.getElementById("nine-slice-setting-h").value;switch(this.target.id){case"grid-top-left":r+=t,i-=t,s+=a,n-=a;break;case"grid-top-right":i+=t,s+=a;break;case"grid-bottom-left":r+=t,i-=t,n+=a;break;case"grid-bottom-right":i+=t,n+=a}document.getElementById("nine-slice-setting-x").value=`${r}`,document.getElementById("nine-slice-setting-y").value=`${s}`,document.getElementById("nine-slice-setting-w").value=`${i}`,document.getElementById("nine-slice-setting-h").value=`${n}`,this.startPosition(e),d.$gridController.updateShapeGrid(r,s,i,n),this.reloadScreen()}moveTransform(e){d.$setCursor("move"),e.preventDefault(),this.save();let t=!1;switch(this.target.id){case"scale-top-left":{const a=this.updateLeftScaleX(e),r=this.updateTopScaleY(e);(a||r)&&(t=!0,d.$shiftKey&&this.adjustmentScale(a,r))}break;case"scale-center-left":this.updateLeftScaleX(e)&&(t=!0);break;case"scale-bottom-left":{const a=this.updateLeftScaleX(e),r=this.updateBottomScaleY(e);(a||r)&&(t=!0,d.$shiftKey&&this.adjustmentScale(a,r))}break;case"scale-center-bottom":this.updateBottomScaleY(e)&&(t=!0);break;case"scale-bottom-right":{const a=this.updateRightScaleX(e),r=this.updateBottomScaleY(e);(a||r)&&(t=!0,d.$shiftKey&&this.adjustmentScale(a,r))}break;case"scale-center-right":this.updateRightScaleX(e)&&(t=!0);break;case"scale-top-right":{const a=this.updateRightScaleX(e),r=this.updateTopScaleY(e);(a||r)&&(t=!0,d.$shiftKey&&this.adjustmentScale(a,r))}break;case"scale-center-top":this.updateTopScaleY(e)&&(t=!0);break;case"target-rotation":this.updateRotate(e)&&(t=!0);break;case"reference-point":this.updateReferencePoint(e);break;default:return}this.startPosition(e),t&&this.reloadScreen()}adjustmentScale(e=0,t=0){if(e!==t){if(e){const t=+document.getElementById("transform-scale-y").value;d.$transformController.updateScaleY((t+e)/100)}if(t){const e=+document.getElementById("transform-scale-x").value;d.$transformController.updateScaleX((e+t)/100)}}}updateTopScaleY(e){const t=this.pageY-e.pageY;if(!t)return 0;const a=+document.getElementById("transform-scale-y").value;return d.$transformController.updateScaleY((a+t)/100),t}updateRotate(e){const t=e.pageX-this.pageX;if(!t)return 0;let a=+document.getElementById("transform-rotate").value+t;return a=d.$clamp((0|a)%360,de.MIN_ROTATE,de.MAX_ROTATE),0>a&&(a+=360),d.$transformController.updateRotate(a),1}updateReferencePoint(e){const t=(e.pageX-this.pageX)/d.$zoomScale,a=(e.pageY-this.pageY)/d.$zoomScale,r=d.$tools.getDefaultTool("arrow").activeElements,s=document.getElementById("reference-point");if(r.length>1){const e=d.$referenceController.pointer;e.x+=t,e.y+=a,d.$referenceController.setInputValue(e.x,e.y),s.style.left=`${s.offsetLeft+t}px`,s.style.top=`${s.offsetTop+a}px`}else{const e=r[0],i=0|e.dataset.layerId,n=d.$currentWorkSpace().scene.getLayer(i).getCharacter(0|e.dataset.characterId);n._$referencePoint.x+=t,n._$referencePoint.y+=a;const o=n.referencePoint;d.$referenceController.setInputValue(o.x,o.y);const l=o.x*d.$zoomScale,c=o.y*d.$zoomScale,h=document.getElementById(`character-${n.id}`),u=h.offsetLeft,m=h.offsetTop,g=h.offsetWidth,p=h.offsetHeight;s.style.left=l+u+g/2-8+"px",s.style.top=c+m+p/2-8+"px"}}updateLeftScaleX(e){const t=this.pageX-e.pageX;if(!t)return 0;const a=+document.getElementById("transform-scale-x").value;return d.$transformController.updateScaleX((a+t)/100),t}updateBottomScaleY(e){const t=e.pageY-this.pageY;if(!t)return 0;const a=+document.getElementById("transform-scale-y").value;return d.$transformController.updateScaleY((a+t)/100),t}updateRightScaleX(e){const t=e.pageX-this.pageX;if(!t)return 0;const a=+document.getElementById("transform-scale-x").value;return d.$transformController.updateScaleX((a+t)/100),t}moveDisplayObject(e=null){this.save();const t=d.$currentWorkSpace().scene,a=d.$timelineFrame.currentFrame,r=e?e.pageX-this.pageX:this.pageX,s=e?e.pageY-this.pageY:this.pageY;let i=Number.MAX_VALUE,n=Number.MAX_VALUE;for(let e=0;e<this._$activeElements.length;++e){const o=this._$activeElements[e],l=document.getElementById(o.id);if(!l)continue;const c=0|l.dataset.layerId,h=t.getLayer(c),u=h.getCharacter(0|l.dataset.characterId);this.initPlace(u,c,a);const m=u.getPlace(a).matrix;if(m[4]+=r/d.$zoomScale,m[5]+=s/d.$zoomScale,u.screenX+=r/d.$zoomScale,u.screenY+=s/d.$zoomScale,null!==h.maskId){const e=t.getLayer(h.maskId);if(e.lock&&e._$characters.length){const t=e._$characters[0],a=t.screenX-u.screenX,r=t.screenY-u.screenY;l.style.webkitMaskPosition=l.style.maskPosition=`${a}px ${r}px`}}l.style.left=`${l.offsetLeft+r}px`,l.style.top=`${l.offsetTop+s}px`,i=Math.min(i,u.x),n=Math.min(n,u.y),u.relocationTween(a)}e&&(this.pageX=e.pageX,this.pageY=e.pageY),document.getElementById("object-x").value=i,document.getElementById("object-y").value=n,d.$transformController.show().relocation(),d.$gridController.show().relocation()}initPlace(e,t,a){let r=a;for(;r>0;){if("key-frame"===document.getElementById(`${t}-${r}`).dataset.frameState){e._$places.has(r)||e.setPlace(r,e.getClonePlace(r));break}r--}}updateControllerProperty(){const e=d.$currentWorkSpace().scene;let t=null,a=Number.MAX_VALUE,r=Number.MAX_VALUE,s=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let l=0;l<this._$activeElements.length;++l){const c=this._$activeElements[l],d=0|c.dataset.layerId;t=e.getLayer(d).getCharacter(0|c.dataset.characterId),a=Math.min(a,t.x),r=Math.min(r,t.y);const h=t.getBounds();s=Math.min(s,h.xMin),i=Math.max(i,h.xMax),n=Math.min(n,h.yMin),o=Math.max(o,h.yMax)}document.getElementById("object-width").value=Math.abs(i-s),document.getElementById("object-height").value=Math.abs(o-n),document.getElementById("object-x").value=a,document.getElementById("object-y").value=r,d.$controller.showObjectSetting(["object-area"]),d.$controller.hideObjectSetting(["stage-setting","fill-color-setting"]),this._$activeElements.length>1?(d.$controller.hideObjectSetting(["object-setting","color-setting","blend-setting","loop-setting","filter-setting","video-setting","instance-setting","text-setting","nine-slice-setting","sound-setting","ease-setting"]),document.getElementById("transform-scale-x").value=100,document.getElementById("transform-scale-y").value=100,document.getElementById("transform-rotate").value=0):t.showController()}moveScene(){const e=document.getElementById("scene-name-menu-list").lastElementChild;e&&(d.$sceneChange.execute(0|e.dataset.libraryId),e.remove())}}class W extends N{constructor(){super("bucket")}initialize(){this.addEventListener(D.START,(()=>{this.setCursor(),this.changeNodeEvent()})),this.addEventListener(D.MOUSE_DOWN,(e=>{this.setCursor(),e.stopPropagation(),e.displayObject&&this.mouseDown(e)})),this.addEventListener(D.MOUSE_MOVE,(e=>{this.setCursor(),e.stopPropagation()})),this.addEventListener(D.MOUSE_UP,(e=>{this.setCursor(),e.stopPropagation(),d.$tools.reset()}))}setCursor(){const e=d.$intToRGB(0|`0x${document.getElementById("fill-color").value.slice(1)}`);d.$setCursor(`url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="rgb(${e.R},${e.G},${e.B})" d="M24 19.007c0-3.167-1.409-6.771-2.835-9.301l-.006-.01-.014-.026c-.732-1.392-1.914-3.052-3.619-4.757-2.976-2.976-5.476-3.912-6.785-3.913-.413 0-.708.094-.859.245l-.654.654c-1.898-.236-3.42.105-4.294.982-.876.875-1.164 2.159-.792 3.524.242.893.807 1.891 1.752 2.836.867.867 2.062 1.684 3.615 2.327.488-.839 1.654-1.019 2.359-.315.586.586.584 1.533-.002 2.119s-1.533.589-2.121 0c-.229-.229-.366-.515-.416-.812-1.646-.657-3.066-1.534-4.144-2.612-.728-.728-1.289-1.528-1.664-2.349l-2.835 2.832c-.445.447-.685 1.064-.686 1.82.001 1.635 1.122 3.915 3.714 6.506 2.764 2.764 5.58 4.243 7.431 4.243.649 0 1.181-.195 1.548-.562l8.086-8.079c.911.875-.777 3.541-.777 4.65 0 1.104.896 1.999 2 1.998 1.104 0 1.998-.895 1.998-2zm-18.912-12.974c-.236-.978-.05-1.845.554-2.444.526-.53 1.471-.791 2.656-.761l-3.21 3.205zm9.138 2.341l-.03-.029c-1.29-1.291-3.802-4.354-3.095-5.062.715-.715 3.488 1.521 5.062 3.095.862.863 2.088 2.248 2.938 3.459-1.718-1.073-3.493-1.469-4.875-1.463zm-3.875 12.348c-.547-.082-1.5-.547-1.9-.928l7.086-7.086c.351.37 1.264.931 1.753 1.075l-6.939 6.939z"/></svg>'),auto`)}mouseDown(e){const t=e.target;if("shape"===t.dataset.instanceType){const{Graphics:e}=window.next2d.display,a=d.$currentWorkSpace();a.temporarilySaved();const r=a.getLibrary(0|t.dataset.libraryId),s=d.$intToRGB(0|`0x${document.getElementById("fill-color").value.slice(1)}`);switch(r._$recodes[r._$recodes.length-1]){case e.END_FILL:r._$recodes.splice(r._$recodes.length-6,6,e.FILL_STYLE,s.R,s.G,s.B,255,e.END_FILL);break;case e.END_STROKE:r._$recodes.push(e.FILL_STYLE,s.R,s.G,s.B,255,e.END_FILL)}r.cacheClear(),this.reloadScreen()}}}class G extends z{constructor(){super("circle")}createCharacter(){super.createCharacter("circle")}}class H extends N{constructor(){super("hand")}initialize(){this.setCursor("grab"),this.addEventListener(D.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(!1)})),this.addEventListener(D.MOUSE_MOVE,(e=>{if(d.$setCursor(this._$cursor),!this.active)return;const t=document.getElementById("screen");t.scrollLeft+=this.pageX-e.pageX,t.scrollTop+=this.pageY-e.pageY,this.pageX=e.pageX,this.pageY=e.pageY})),this.addEventListener(D.MOUSE_UP,(()=>{this.active=!1,this.setCursor("grab"),d.$setCursor(this._$cursor)})),this.addEventListener(D.MOUSE_DOWN,(e=>{this.active=!0,this.setCursor("grabbing"),d.$setCursor(this._$cursor),this.pageX=e.pageX,this.pageY=e.pageY}))}}class Z extends N{constructor(){super("pen")}initialize(){this.addEventListener(D.START,(()=>{this.setCursor(),this.changeNodeEvent(!1)})),this.addEventListener(D.MOUSE_DOWN,(e=>{this.setCursor(),e.stopPropagation(),this.clearPenPointer();let t=e.offsetX,a=e.offsetY;"stage-area"!==e.target.id&&(t+=e.target.offsetLeft,a+=e.target.offsetTop),this.offsetX=t,this.offsetY=a})),this.addEventListener(D.MOUSE_MOVE,(e=>{this.setCursor(),e.stopPropagation(),e.screen&&this.active&&this.mouseMove(e)})),this.addEventListener(D.MOUSE_UP,(e=>{this.setCursor(),e.stopPropagation(),this.mouseUp()}))}clearPenPointer(){const e=document.getElementById("stage-area");for(let t=0;e.children.length>t;++t){const a=e.children[t];a.dataset.penPointer&&(a.remove(),--t)}}setCursor(){const e=d.$intToRGB(0|`0x${document.getElementById("stroke-color").value.slice(1)}`);d.$setCursor(`url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24"><path fill="rgb(${e.R},${e.G},${e.B})" d="M1.438 16.875l5.688 5.689-7.126 1.436 1.438-7.125zm22.562-11.186l-15.46 15.46-5.688-5.689 15.459-15.46 5.689 5.689zm-4.839-2.017l-.849-.849-12.614 12.599.85.849 12.613-12.599z"/></svg>') 0 12, auto`)}mouseMove(e){const t=0|document.getElementById("stroke-size").value;if(t){e.preventDefault();let a=e.offsetX,r=e.offsetY;"stage-area"!==e.target.id&&(a+=e.target.offsetLeft,r+=e.target.offsetTop);const s=document.getElementById("stage-area"),i=document.createElement("div");i.dataset.penPointer="true",i.classList.add("pen-pointer"),i.style.width=`${t}px`,i.style.height=`${t}px`,i.style.left=`${a}px`,i.style.top=`${r}px`,i.style.backgroundColor=document.getElementById("stroke-color").value,i.style.borderRadius=t/2+"px",s.appendChild(i)}}mouseUp(){d.$timelineLayer.attachLayer();const{Shape:e}=window.next2d.display,t=0|document.getElementById("stroke-size").value,a=new e;a.graphics.lineStyle(t,document.getElementById("stroke-color").value);const r=this.offsetX-d.$offsetLeft,s=this.offsetY-d.$offsetTop;a.graphics.moveTo(0,0);const i=document.getElementById("stage-area").children;for(let e=0;i.length>e;++e){const t=i[e];t.dataset.penPointer&&(a.graphics.lineTo((t.offsetLeft-d.$offsetLeft-r)/d.$zoomScale,(t.offsetTop-d.$offsetTop-s)/d.$zoomScale),t.remove(),--e)}a.graphics.endLine();const n=d.$currentWorkSpace().nextLibraryId,o=(r+t)/2/d.$zoomScale,l=(s+t)/2/d.$zoomScale;this.createShape({id:n,type:"shape",name:`Shape_${n}`,symbol:"",recodes:a.graphics._$recode.slice(0),bounds:{xMin:a.graphics._$xMin,xMax:a.graphics._$xMax,yMin:a.graphics._$yMin,yMax:a.graphics._$yMax}},o,l),this.reloadScreen(),d.$tools.reset()}}class K extends z{constructor(){super("rectangle")}createCharacter(){super.createCharacter("rectangle")}}class V extends z{constructor(){super("round-rect")}createCharacter(){super.createCharacter("round-rect")}}class q extends N{constructor(){super("text")}initialize(){this.addEventListener(D.START,(()=>{d.$setCursor("text"),this.changeNodeEvent(!1)})),this.addEventListener(D.MOUSE_DOWN,(e=>{d.$setCursor("text"),e.stopPropagation(),e.screen&&this.mouseDown(e)})),this.addEventListener(D.MOUSE_MOVE,(e=>{d.$setCursor("text"),e.stopPropagation(),e.screen&&this.mouseMove(e)})),this.addEventListener(D.MOUSE_UP,(e=>{d.$setCursor("text"),e.screen&&(e.stopPropagation(),this.mouseUp(),d.$tools.reset())}))}mouseDown(e){let t=e.offsetX,a=e.offsetY;"stage-area"!==e.target.id&&(t+=e.target.offsetLeft,a+=e.target.offsetTop),this.pageX=e.pageX,this.pageY=e.pageY,this.offsetX=t,this.offsetY=a;const r=document.getElementById("draw-text");r.style.left=`${e.pageX}px`,r.style.top=`${e.pageY}px`,r.style.width="0px",r.style.height="0px",r.style.display="",r.style.border="1px dashed gray"}mouseMove(e){e.preventDefault();const t=e.pageX,a=e.pageY,r=document.getElementById("draw-text");this.pageX>t&&(this.offsetX=e.offsetX,r.style.left=`${t}px`),this.pageY>a&&(this.offsetY=e.offsetY,r.style.top=`${a}px`),r.style.width=`${Math.abs(t-this.pageX)}px`,r.style.height=`${Math.abs(a-this.pageY)}px`}mouseUp(){d.$timelineLayer.attachLayer();const e=document.getElementById("draw-text"),t=d.$currentWorkSpace();t.temporarilySaved();const a=(this.offsetX-d.$offsetLeft)/d.$zoomScale,r=(this.offsetY-d.$offsetTop)/d.$zoomScale,s=parseFloat(e.style.width)/d.$zoomScale,i=parseFloat(e.style.height)/d.$zoomScale,n=t.nextLibraryId;this.createTextField({id:n,type:"text",name:`Text_${n}`,symbol:"",bounds:{xMin:0,xMax:s,yMin:0,yMax:i},originBounds:{xMin:0,xMax:s,yMin:0,yMax:i}},a,r),this.reloadScreen(),e.style.display="none"}}class J extends N{constructor(){super("transform"),this._$element=null,this._$deletePointer=null}initialize(){this.setCursor('url(\'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 48 48"><path fill="white" d="M27.8,39.7c-0.1,0-0.2,0-0.4-0.1c-0.2-0.1-0.4-0.3-0.6-0.5l-3.7-8.6l-4.5,4.2C18.5,34.9,18.3,35,18,35c-0.1,0-0.3,0-0.4-0.1C17.3,34.8,17,34.4,17,34l0-22c0-0.4,0.2-0.8,0.6-0.9C17.7,11,17.9,11,18,11c0.2,0,0.5,0.1,0.7,0.3l16,15c0.3,0.3,0.4,0.7,0.3,1.1c-0.1,0.4-0.5,0.6-0.9,0.7l-6.3,0.6l3.9,8.5c0.1,0.2,0.1,0.5,0,0.8c-0.1,0.2-0.3,0.5-0.5,0.6l-2.9,1.3C28.1,39.7,27.9,39.7,27.8,39.7z"/><path fill="black" d="M18,12l16,15l-7.7,0.7l4.5,9.8l-2.9,1.3l-4.3-9.9L18,34L18,12 M18,10c-0.3,0-0.5,0.1-0.8,0.2c-0.7,0.3-1.2,1-1.2,1.8l0,22c0,0.8,0.5,1.5,1.2,1.8C17.5,36,17.8,36,18,36c0.5,0,1-0.2,1.4-0.5l3.4-3.2l3.1,7.3c0.2,0.5,0.6,0.9,1.1,1.1c0.2,0.1,0.5,0.1,0.7,0.1c0.3,0,0.5-0.1,0.8-0.2l2.9-1.3c0.5-0.2,0.9-0.6,1.1-1.1c0.2-0.5,0.2-1.1,0-1.5l-3.3-7.2l4.9-0.4c0.8-0.1,1.5-0.6,1.7-1.3c0.3-0.7,0.1-1.6-0.5-2.1l-16-15C19,10.2,18.5,10,18,10L18,10z"/></svg>\') 6 6,auto'),this.addEventListener(D.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(),this._$deletePointer=this.deletePointer.bind(this),window.addEventListener("keydown",this._$deletePointer)})),this.addEventListener(D.END,(()=>{window.removeEventListener("keydown",this._$deletePointer)})),this.addEventListener(D.MOUSE_DOWN,(e=>{switch(d.$setCursor(this._$cursor),!0){case e.displayObject:this._$element=null,this.mouseDownForDisplayObject(e);break;case e.shapePointer:this.mouseDownForPointer(e);break;default:this._$element=null}})),this.addEventListener(D.DBL_CLICK,(e=>{switch(d.$setCursor(this._$cursor),e.stopPropagation(),!0){case e.shapePointer:this.addCurvePointer(e);break;case e.screen:this.addPointer(e)}})),this.addEventListener(D.MOUSE_UP,(e=>{d.$setCursor(this._$cursor),e.stopPropagation()})),this.addEventListener(D.MOUSE_MOVE,(e=>{d.$setCursor(this._$cursor),this.active&&(e.stopPropagation(),this.movePointer(e))}))}addPointer(e){this.clearActivePointer();const t=d.$timelineFrame.currentFrame;let a=null,r=Number.MAX_VALUE;const s=document.getElementById("stage-area").children,i=d.$currentWorkSpace(),n=i.scene;let o=e.offsetX,l=e.offsetY;if("stage-area"!==e.target.id){const t=0|e.target.dataset.layerId,a=0|e.target.dataset.characterId,r=n.getLayer(t).getCharacter(a);o=r.screenX+d.$offsetLeft+e.offsetX,l=r.screenY+d.$offsetTop+e.offsetY}for(let e=0;e<s.length;++e){const t=s[e];if(!t.dataset.shapePointer)continue;if("true"===t.dataset.curve)continue;const i=Math.sqrt(Math.pow(t.offsetLeft-o,2)+Math.pow(t.offsetTop-l,2));r>i&&(a=t),r=Math.min(r,i)}if(!a)return;const c=i.getLibrary(0|a.dataset.libraryId);if(!c)return;const h=[],u=0|a.dataset.position;for(let e=u+1;e<s.length;++e){const t=s[e];if("true"!==t.dataset.curve){h.push(t);break}}if(!h.length)for(let e=0;e<s.length;++e){const t=s[e];if(t.dataset.shapePointer&&"true"!==t.dataset.curve){h.push(t);break}}for(let e=u-1;;--e){const t=s[e];if(!t.dataset.shapePointer)break;if("true"!==t.dataset.curve){h.push(t);break}}if(1===h.length)for(let e=s.length-1;;--e){const t=s[e];if(!t.dataset.shapePointer)break;if("true"!==t.dataset.curve){h.push(t);break}}let m=null;r=Number.MAX_VALUE;for(let e=0;e<h.length;++e){const t=h[e],a=Math.sqrt(Math.pow(t.offsetLeft-o,2)+Math.pow(t.offsetTop-l,2));r>a&&(m=t),r=Math.min(r,a)}const{Graphics:g}=window.next2d.display,p=0|a.dataset.layerId,f=0|a.dataset.characterId,$=n.getLayer(p).getCharacter(f),y=$.getPlace(t).matrix,_=Math.sqrt(y[0]*y[0]+y[1]*y[1]),b=Math.sqrt(y[2]*y[2]+y[3]*y[3]),v=0|a.dataset.index,E=0|m.dataset.index;E>v?c._$recodes.splice(v+2,0,g.LINE_TO,(o-d.$offsetLeft-$.screenX+c._$bounds.xMin)/_,(l-d.$offsetTop-$.screenY+c._$bounds.yMin)/b):c._$recodes.splice(E+2,0,g.LINE_TO,(o-d.$offsetLeft-$.screenX+c._$bounds.xMin)/_,(l-d.$offsetTop-$.screenY+c._$bounds.yMin)/b);for(let e=0;e<s.length;++e){const t=s[e];t.dataset.shapePointer&&("true"!==t.dataset.curve&&(t.remove(),--e))}const I=c.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);if(c._$bounds.xMin=I.xMin,c._$bounds.xMax=I.xMax,c._$bounds.yMin=I.yMin,c._$bounds.yMax=I.yMax,c.cacheClear(),n.changeFrame(t),$){const e=$.getPlace(t).matrix;c.createPointer(e,p,f)}}addCurvePointer(e){this.clearActivePointer();const{Graphics:t}=window.next2d.display,a=d.$currentWorkSpace(),r=e.target;if(!("true"===r.dataset.curve)){const s=0|r.dataset.type,i=0|r.dataset.index,n=0|r.dataset.layerId,o=0|r.dataset.characterId,l=a.getLibrary(0|r.dataset.libraryId);switch(s){case t.LINE_TO:{a.temporarilySaved(),l._$recodes[i-1]=t.CURVE_TO;const r=l._$recodes[i],s=l._$recodes[i+1];l._$recodes.splice(i+2,0,r,s),l._$recodes[i]+=20,l._$recodes[i+1]+=20,l.cacheClear();const c=d.$timelineFrame.currentFrame;a.scene.changeFrame(c),l.createPointer(e.matrix,n,o)}break;case t.CURVE_TO:{a.temporarilySaved(),l._$recodes[i-3]=t.CUBIC;const r=l._$recodes[i],s=l._$recodes[i+1];l._$recodes.splice(i+2,0,r,s),l._$recodes[i]+=20,l._$recodes[i+1]+=20,l.cacheClear();const c=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(c),l.createPointer(e.matrix,n,o)}}}}clearActivePointer(){const{Graphics:e}=window.next2d.display,t=document.getElementById("stage-area"),a=this._$element;if(a){a.style.backgroundColor="";const r=0|a.dataset.position,s=0|a.dataset.type,i="true"===a.dataset.curve;switch(s){case e.CURVE_TO:i?t.children[r+1].style.backgroundColor="":t.children[r-1].style.backgroundColor="";break;case e.CUBIC:if(i)for(let e=1;e<3;++e){const a=t.children[r+e];if(a.style.backgroundColor="","true"!==a.dataset.curve){1===e&&(t.children[r-1].style.backgroundColor="");break}}else t.children[r-1].style.backgroundColor="",t.children[r-2].style.backgroundColor=""}}}mouseDownForPointer(e){d.$currentWorkSpace().temporarilySaved();const{Graphics:t}=window.next2d.display,a=document.getElementById("stage-area");this.clearActivePointer();const r=this.target;this._$element=r,this.pageX=e.pageX-r.offsetLeft,this.pageY=e.pageY-r.offsetTop;const s=this.target;s.style.backgroundColor=d.$shapePointerColor;const i=0|s.dataset.position,n=0|s.dataset.type,o="true"===s.dataset.curve;switch(n){case t.CURVE_TO:o?a.children[i+1].style.backgroundColor=d.$shapeLinkedPointerColor:a.children[i-1].style.backgroundColor=d.$shapeLinkedPointerColor;break;case t.CUBIC:if(o)for(let e=1;e<3;++e){const t=a.children[i+e];if(t.style.backgroundColor=d.$shapeLinkedPointerColor,"true"!==t.dataset.curve){1===e&&(a.children[i-1].style.backgroundColor=d.$shapeLinkedPointerColor);break}}else a.children[i-1].style.backgroundColor=d.$shapeLinkedPointerColor,a.children[i-2].style.backgroundColor=d.$shapeLinkedPointerColor}}mouseDownForDisplayObject(e){const t=this.target;if("shape"!==t.dataset.instanceType)return;d.$tools.getDefaultTool("arrow").clear();const a=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace(),s=0|t.dataset.layerId,i=0|t.dataset.characterId,n=r.scene.getLayer(s).getCharacter(i),o=r.getLibrary(0|t.dataset.libraryId),l=n.getPlace(a).matrix,c=d.$hitColor;o.setHitColor(e.offsetX,e.offsetY,l),d.$hitColor?o.createPointer(l,s,i):d.$hitColor=c}movePointer(e){const t=this.target;if("true"!==t.dataset.shapePointer)return;const a=d.$currentWorkSpace(),r=a.getLibrary(0|t.dataset.libraryId);if(!r)return void d.$clearShapePointer();e.preventDefault();const s=d.$timelineFrame.currentFrame,i=0|t.dataset.layerId,n=0|t.dataset.characterId,o=a.scene,l=o.getLayer(i).getCharacter(n).getPlace(s).matrix,c=e.pageX-this.pageX,h=e.pageY-this.pageY,u=Math.atan2(l[1],l[0])*d.$Rad2Deg,m=Math.sqrt(l[0]*l[0]+l[1]*l[1]),g=Math.sqrt(l[2]*l[2]+l[3]*l[3]);let p=(c-t.offsetLeft)/m,f=(h-t.offsetTop)/g;if(u){const e=(360-u)*(Math.PI/180);p*=Math.cos(e),f*=Math.sin(e)}const $=0|t.dataset.index;r._$recodes[$]+=p/d.$zoomScale,r._$recodes[$+1]+=f/d.$zoomScale;const y=0|t.dataset.syncId;y&&(r._$recodes[y]+=p/d.$zoomScale,r._$recodes[y+1]+=f/d.$zoomScale),t.style.left=`${c}px`,t.style.top=`${h}px`;const _=r.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);r._$bounds.xMin=_.xMin,r._$bounds.xMax=_.xMax,r._$bounds.yMin=_.yMin,r._$bounds.yMax=_.yMax,r.cacheClear(),o.changeFrame(s)}deletePointer(e){if(d.$setCursor(this._$cursor),d.$keyLock||"Backspace"!==e.key)return;e.stopPropagation();let t=0;const a=document.getElementById("stage-area").children;for(let e=0;a.length>e;++e){const r=a[e];r.dataset.shapePointer&&("false"===r.dataset.curve&&t++)}const r=this._$element;if(!r)return;const s="true"===r.dataset.curve;if(!r.dataset.syncId&&(t>2||s)){const e=d.$currentWorkSpace();e.temporarilySaved();const{Graphics:t}=window.next2d.display,a=e.getLibrary(0|r.dataset.libraryId),i=0|r.dataset.index;switch(0|r.dataset.type){case t.MOVE_TO:break;case t.LINE_TO:a._$recodes.splice(i-1,3);break;case t.CUBIC:{let e=i;for(;a._$recodes[--e]!==t.CUBIC;);s?(a._$recodes[e]=t.CURVE_TO,a._$recodes.splice(i,2)):a._$recodes.splice(e,7)}break;case t.CURVE_TO:{let e=i;for(;a._$recodes[--e]!==t.CURVE_TO;);s?(a._$recodes[e]=t.LINE_TO,a._$recodes.splice(i,2)):a._$recodes.splice(e,5)}}const n=a.reloadBounds(d.$hitColor?0|d.$hitColor.width:0);a._$bounds.xMin=n.xMin,a._$bounds.xMax=n.xMax,a._$bounds.yMin=n.yMin,a._$bounds.yMax=n.yMax,a.cacheClear();const o=d.$timelineFrame.currentFrame,l=e.scene;l.changeFrame(o);const c=0|r.dataset.layerId,h=0|r.dataset.characterId,u=l.getLayer(c).getCharacter(h);if(u){const e=u.getPlace(o).matrix;a.createPointer(e,c,h)}}}}class Q extends N{constructor(){super("zoom")}initialize(){this.setCursor('url(\'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><path d="M13 10h-3v3h-2v-3h-3v-2h3v-3h2v3h3v2zm8.172 14l-7.387-7.387c-1.388.874-3.024 1.387-4.785 1.387-4.971 0-9-4.029-9-9s4.029-9 9-9 9 4.029 9 9c0 1.761-.514 3.398-1.387 4.785l7.387 7.387-2.828 2.828zm-12.172-8c3.859 0 7-3.14 7-7s-3.141-7-7-7-7 3.14-7 7 3.141 7 7 7z"/></svg>\') 6 6,auto'),this.addEventListener(D.START,(()=>{d.$setCursor(this._$cursor),this.changeNodeEvent(!1)})),this.addEventListener(D.MOUSE_DOWN,(e=>{this.startRect(e)})),this.addEventListener(D.MOUSE_MOVE,(e=>{this.moveRect(e)})),this.addEventListener(D.MOUSE_UP,(e=>{this.execute(e)}))}startRect(e){this.active=!0,d.$setCursor(this._$cursor),this.pageX=e.pageX,this.pageY=e.pageY;const t=document.getElementById("stage-rect");t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,t.style.width="0px",t.style.height="0px",t.style.display=""}moveRect(e){if(d.$setCursor(this._$cursor),!this.active)return;const t=e.pageX,a=e.pageY,r=document.getElementById("stage-rect");this.pageX>t&&(r.style.left=`${t}px`),this.pageY>a&&(r.style.top=`${a}px`),r.style.width=`${Math.abs(t-this.pageX)}px`,r.style.height=`${Math.abs(a-this.pageY)}px`}execute(){this.active=!1,d.$setCursor(this._$cursor);const e=document.getElementById("stage-rect");e.style.display="none";const t=parseFloat(e.style.width),a=parseFloat(e.style.height);if(!t||!a)return;const r=d.$currentWorkSpace(),s=Math.max(r.stage.width/t,r.stage.height/a,d.$zoomScale);d.$zoomScale=0,d.$screenZoom.execute(s),d.$tools.activeTool&&d.$tools.activeTool.dispatchEvent(D.END);const i=d.$tools.getDefaultTool("zoom");i.dispatchEvent(D.START),d.$tools.activeTool=i}}class ee{constructor(e=""){this._$name=e,this._$saved=!1,this._$pointX=0,this._$pointY=0,this._$focus=!1,this._$currentValue=null,this._$currentTarget=null,this._$lockTarget=null,this._$mouseMove=null,this._$mouseUp=null,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){if(this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),this.name){const e=document.getElementById(`${this.name}-setting-title`);e&&e.addEventListener("mousedown",(()=>{this.clickTitle()}))}d.$initializeEnd()}focusIn(e){this._$focus=!0,this._$currentValue=+e.target.value,d.$keyLock=!0}focusOut(){this._$focus=!1,this._$currentValue=null,this._$currentTarget=null,this._$lockTarget=null,d.$keyLock=!1}mouseOut(e){e.stopPropagation(),!this._$focus&&this._$currentTarget||(d.$setCursor("auto"),e.target.style.cursor="")}mouseDown(e){this._$focus||(e.preventDefault(),this._$saved=!1,this._$pointX=e.screenX,this._$currentTarget=e.target,this._$currentValue=+e.target.value,d.$setCursor("ew-resize"),this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto"),this._$currentTarget&&(this._$currentTarget.style.cursor="",this._$currentTarget.focus())}mouseMove(e){!this._$focus&&this._$currentTarget&&window.requestAnimationFrame((()=>{if(this._$focus||!this._$currentTarget)return;e.preventDefault(),d.$setCursor("ew-resize");const t=e.screenX-this._$pointX;let a=+this._$currentTarget.value;isNaN(a)&&(a=0),this._$currentTarget.value=this.executeFunction(this._$currentTarget.id,a+t),this._$currentValue=+this._$currentTarget.value,this._$lockTarget&&(this._$lockTarget.value=this.executeFunction(this._$lockTarget.id,+this._$lockTarget.value+t)),this._$pointX=e.screenX,this.reloadScreen()}))}reloadScreen(){const e=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(e)}mouseOver(e){switch(e.stopPropagation(),!0){case this._$focus:case null!==this._$currentTarget:case null!==this._$currentValue:return;default:d.$setCursor("ew-resize"),e.target.style.cursor="ew-resize"}}clickTitle(){const e=document.getElementById(`${this.name}-setting-view-area`),t=document.getElementById(`${this.name}-setting-title`).getElementsByTagName("i")[0];"none"===e.style.display?(e.style.display="",t.setAttribute("class","active")):(e.style.display="none",t.setAttribute("class","disable"))}executeFunction(e,t){this.save();const a=e.split("-");let r=a.map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("");return`change${r}`in this||(a.pop(),r=a.map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")),this[`change${r}`](t)}finishInput(e,t=!0){if("Enter"!==e.key){if("focusout"===e.type){this._$currentTarget=e.target;const a=this.executeFunction(e.target.id,e.target.value);this._$lockTarget&&(this._$lockTarget.value=this.executeFunction(this._$lockTarget.id,+this._$lockTarget.value+a-this._$currentValue)),e.target.value=a,this._$currentValue=a,this.focusOut(),t&&this.reloadScreen()}}else e.currentTarget.blur()}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}setChangeEvent(e){e&&e.addEventListener("change",(e=>{this._$currentTarget=e.target,this.executeFunction(e.target.id,e.target.value),this._$currentTarget=null,this.reloadScreen()}))}setInputEvent(e){e&&(e.addEventListener("mouseover",(e=>{this.mouseOver(e)})),e.addEventListener("mouseout",(e=>{this.mouseOut(e)})),e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})),e.addEventListener("focusout",(e=>{this.finishInput(e)})),e.addEventListener("keypress",(e=>{this.finishInput(e)})))}setClickEvent(e){e&&e.addEventListener("click",(e=>{this._$currentTarget=e.target,this.executeFunction(e.target.id,e.target.value),this._$currentTarget=null,this.reloadScreen()}))}get name(){return this._$name}}class te extends ee{constructor(e){super(e),this._$currentPointer=null,this._$drawGradientContext=null,this._$mouseMoveGradientColorPointer=null,this._$mouseUpGradientColorPointer=null}static get GRADIENT_CANVAS_WIDTH(){return 255}static get GRADIENT_CANVAS_HEIGHT(){return 30}static get MIN_GRADIENT_POINTER(){return 0}static get MAX_GRADIENT_POINTER(){return 255}initialize(){super.initialize();const e=document.createElement("canvas");e.width=te.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,e.height=te.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,this._$drawGradientContext=e.getContext("2d")}changeGradientColor(e){const t=0|this._$currentTarget.dataset.filterId;if(this._$filters.has(t)){if(this._$currentPointer){const a=this._$filters.get(t).filter,r=0|this._$currentPointer.dataset.index;a._$colors[r]=0|`0x${e.slice(1)}`,this._$currentPointer.dataset.color=e,this._$currentPointer.getElementsByTagName("i")[0].style.backgroundColor=e,this.updateFilterGradientCanvas(a),this.disposeCharacterImage(),this.reloadScreen()}return e}}changeGradientAlpha(e){const t=0|this._$currentTarget.dataset.filterId;if(this._$filters.has(t)){if(e=d.$clamp(+e,se.MIN_ALPHA,se.MAX_ALPHA),this._$currentPointer){const a=this._$filters.get(t).filter,r=0|this._$currentPointer.dataset.index;a._$alphas[r]=e,this._$currentPointer.dataset.alpha=e,this.updateFilterGradientCanvas(a),this.disposeCharacterImage(),this.reloadScreen()}return e}}addGradientBevelFilter(e,t=null,a=!0){const r=this.createFilter(k,t);t||(t=this._$filters.get(r).filter);const s=this.getFilterHeaderHTML(r,"GradientBevel")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${r}" value="${t.blurX}" data-name="blurX" data-filter-id="${r}" data-detail="水平方向にぼかす"></div>\n                                \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${r}" value="${t.strength}" data-filter-id="${r}" data-name="strength" data-detail="フィルター強度"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${r}" value="${t.blurY}" data-name="blurY" data-filter-id="${r}" data-detail="{{垂直方向にぼかす}}"></div>\n                \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${r}" value="${t.angle}" data-filter-id="${r}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${r}" value="${t.distance}" data-filter-id="${r}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div id="gradient-color-palette-${r}" class="gradient-color-palette">\n                    <div id="color-palette-${r}" class="color-palette">\n                        <canvas id="gradient-canvas-${r}"></canvas>\n                    </div>\n                    <div id="color-pointer-list-${r}" data-filter-id="${r}" class="color-pointer-list" data-detail="{{カラーポインターを追加}}"></div>\n                </div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Color</div>\n                <div><input type="color" id="gradientColor-${r}" value="#000000" data-detail="{{グラデーションカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="gradientAlpha-${r}" value="100" data-name="gradientAlpha" data-detail="{{グラデーションのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${r}" data-name="knockout" data-filter-id="${r}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${r}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Type</div>\n                <div>\n                    <select id="type-${r}" data-name="type" data-filter-id="${r}">\n                        <option value="inner">Inner</option>\n                        <option value="outer">Outer</option>\n                        <option value="full">Full</option>\n                    </select>\n                </div>\n    \n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${r}" data-name="quality" data-filter-id="${r}">\n                        <option value="1">Low</option>\n                        <option value="2">Middel</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",s);const i=document.getElementById(`gradient-canvas-${r}`);i.width=te.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,i.height=te.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,i.style.transform=`scale(${1/window.devicePixelRatio}, ${1/window.devicePixelRatio})`,i.style.backfaceVisibility="hidden",i.style.transformOrigin="0 0",t.context=i.getContext("2d"),this.setCommonEvent(r),t.knockout&&(document.getElementById(`knockout-${r}`).checked=!0);const n=[`blurX-${r}`,`blurY-${r}`,`strength-${r}`,`angle-${r}`,`gradientAlpha-${r}`,`distance-${r}`];for(let e=0;e<n.length;++e)this.setInputEvent(document.getElementById(n[e]));const o=[`knockout-${r}`];for(let e=0;e<o.length;++e)this.setClickEvent(document.getElementById(o[e]));const l=[`gradientColor-${r}`,`type-${r}`,`quality-${r}`];for(let e=0;e<l.length;++e)this.setChangeEvent(document.getElementById(l[e]));for(let e=0;e<t.ratios.length;++e){const a=t.ratios[e],s=`#${t.colors[e].toString(16).padStart(6,"0")}`,i=t.alphas[e];this.addFilterGradientColorPointer(r,e,a,s,i)}this.setCreateGradientColorPointerEvent(r),this.updateFilterGradientCanvas(t),a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${r}`))}addGradientColorPointer(e){const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;const a=this._$filters.get(t).filter,r=a.ratios.length,s=e.offsetX,i=document.getElementById(`gradientColor-${t}`).value,n=0|document.getElementById(`gradientAlpha-${t}`).value;a.ratios.push(s),a.colors.push(0|`0x${i.slice(1)}`),a.alphas.push(n),this.addFilterGradientColorPointer(t,r,s,i,n),this.updateFilterGradientCanvas(a),this.disposeCharacterImage(),this.reloadScreen()}setCreateGradientColorPointerEvent(e){const t=document.getElementById(`color-pointer-list-${e}`);t&&t.addEventListener("mousedown",(e=>{this.addGradientColorPointer(e)}))}updateFilterGradientCanvas(e){const t=this._$drawGradientContext;t.clearRect(0,0,te.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,te.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio);const a=e.adjustment();t.beginPath();const r=a.ratios.length,s=Math.ceil(255*a.ratios[r-1]*window.devicePixelRatio),i=t.createLinearGradient(0,0,s,0);for(let e=0;e<r;++e){const t=d.$intToRGB(a.colors[e]);i.addColorStop(a.ratios[e],`rgba(${t.R}, ${t.G}, ${t.B}, ${a.alphas[e]})`)}t.fillStyle=i,t.rect(0,0,te.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,te.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),t.fill(),e.context.clearRect(0,0,te.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,te.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.context.drawImage(t.canvas,0,0)}addFilterGradientColorPointer(e,t,a,r,s){const i=document.getElementById(`color-pointer-list-${e}`),n=`\n<div class="color-pointer" style="left: ${a-4}px;" data-filter-id="${e}" data-index="${t}" data-color="${r}" data-alpha="${s}">\n    <div class="color-pointer-triangle"></div>\n    <div class="color-pointer-rect">\n        <i class="pointer-color" style="background-color: ${r}"></i>\n    </div>\n</div>\n`;i.insertAdjacentHTML("beforeend",n);const o=i.lastElementChild;o.addEventListener("mousedown",(e=>{this.mouseDownGradientColorPointer(e)})),t&&o.addEventListener("dblclick",(e=>{this.removeGradientColorPointer(e)})),this._$currentPointer=o}removeGradientColorPointer(e){const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;const a=document.getElementById(`color-pointer-list-${t}`);if(2>=a.children.length)return;const r=0|e.target.dataset.index,s=this._$filters.get(t).filter;s.ratios.splice(r,1),s.colors.splice(r,1),s.alphas.splice(r,1),e.target.remove();for(let e=r;e<a.children.length;++e){const t=a.children[e],r=(0|t.dataset.index)-1;t.dataset.index=`${r}`}super.focusOut(),this.updateFilterGradientCanvas(s),this.disposeCharacterImage(),this.reloadScreen()}mouseDownGradientColorPointer(e){e.stopPropagation(),this._$saved=!1,this._$pointX=e.screenX,this._$currentTarget=e.target,this._$currentPointer=e.target;const t=e.target.dataset.filterId;document.getElementById(`gradientColor-${t}`).value=e.target.dataset.color,document.getElementById(`gradientAlpha-${t}`).value=e.target.dataset.alpha,this._$mouseMoveGradientColorPointer||(this._$mouseMoveGradientColorPointer=this.mouseMoveGradientColorPointer.bind(this)),this._$mouseUpGradientColorPointer||(this._$mouseUpGradientColorPointer=this.mouseUpGradientColorPointer.bind(this)),window.addEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.addEventListener("mouseup",this._$mouseUpGradientColorPointer)}mouseMoveGradientColorPointer(e){const t=this._$currentTarget;if(!t)return;const a=0|t.dataset.index;a&&window.requestAnimationFrame((()=>{e.preventDefault();const r=0|t.dataset.filterId;if(!this._$filters.has(r))return;const s=parseFloat(t.style.left),i=d.$clamp(s+(e.screenX-this._$pointX)+4,te.MIN_GRADIENT_POINTER,te.MAX_GRADIENT_POINTER);t.style.left=i-4+"px";const n=this._$filters.get(r).filter;n._$ratios[a]=i,this._$pointX&&(this._$pointX=e.screenX),this.updateFilterGradientCanvas(n),this.disposeCharacterImage(),this.reloadScreen()}))}mouseUpGradientColorPointer(){window.removeEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.removeEventListener("mouseup",this._$mouseUpGradientColorPointer),d.$setCursor("auto"),super.focusOut()}}d.$view=new class{constructor(){this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("view");e&&e.addEventListener("mousedown",(e=>{e.button||d.$endMenu()})),d.$initializeEnd()}};d.$blendController=new class extends ee{constructor(){super("blend")}initialize(){super.initialize(),this.setChangeEvent(document.getElementById("blend-select"))}changeBlendSelect(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const a=d.$currentWorkSpace().scene,r=t[0],s=a.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId),i=d.$timelineFrame.currentFrame;let n=s.getPlace(i);n.tweenFrame&&(s.endFrame-1>i&&!s.hasTween(i)&&(d.$timelineTool.executeTimelineKeyAdd(),n=s.getPlace(i)),n=s.getPlace(n.tweenFrame)),n.blendMode=`${e}`,s.updateTweenBlend(i),s._$image=null}};class ae extends ee{constructor(){super("color")}static get MIN_OFFSET(){return-255}static get MAX_OFFSET(){return 255}static get MIN_MULTIPLIER(){return 0}static get MAX_MULTIPLIER(){return 100}initialize(){super.initialize();const e=["color-alpha-offset","color-red-offset","color-green-offset","color-blue-offset","color-alpha-multiplier","color-red-multiplier","color-green-multiplier","color-blue-multiplier"];for(let t=0;t<e.length;++t){const a=document.getElementById(e[t]);a&&this.setInputEvent(a)}}offsetClamp(e){return d.$clamp(0|e,ae.MIN_OFFSET,ae.MAX_OFFSET)}multiplierClamp(e){return d.$clamp(+e,ae.MIN_MULTIPLIER,ae.MAX_MULTIPLIER)}changeColorRedMultiplier(e){return e=this.multiplierClamp(e),this.updateColor(0,e/100),e}changeColorGreenMultiplier(e){return e=this.multiplierClamp(e),this.updateColor(1,e/100),e}changeColorBlueMultiplier(e){return e=this.multiplierClamp(e),this.updateColor(2,e/100),e}changeColorAlphaMultiplier(e){return e=this.multiplierClamp(e),this.updateColor(3,e/100),e}changeColorRedOffset(e){return e=this.offsetClamp(e),this.updateColor(4,e),e}changeColorGreenOffset(e){return e=this.offsetClamp(e),this.updateColor(5,e),e}changeColorBlueOffset(e){return e=this.offsetClamp(e),this.updateColor(6,e),e}changeColorAlphaOffset(e){return e=this.offsetClamp(e),this.updateColor(7,e),e}updateColor(e,t){const a=d.$tools.getDefaultTool("arrow").activeElements;if(!a.length)return;const r=d.$currentWorkSpace().scene,s=a[0],i=r.getLayer(0|s.dataset.layerId).getCharacter(0|s.dataset.characterId),n=d.$timelineFrame.currentFrame;i.getPlace(n).colorTransform[e]=t,i.relocationTween(n),i._$image=null}}d.$colorTransformController=new ae;d.$controller=new class extends ee{initialize(){super.initialize();const e=document.getElementById("controller");e&&e.addEventListener("mouseover",(()=>{d.$setCursor("auto")}))}showObjectSetting(e){for(let t=0;t<e.length;++t)document.getElementById(e[t]).style.display=""}hideObjectSetting(e){for(let t=0;t<e.length;++t)document.getElementById(e[t]).style.display="none"}default(){d.$filterController.clearFilters(),this.hideObjectSetting(["object-area","instance-setting","fill-color-setting"]),this.showObjectSetting(["stage-setting","sound-setting","object-setting","color-setting","blend-setting","filter-setting"]);const e=d.$currentWorkSpace().scene;document.getElementById("object-name").value=e.name,document.getElementById("object-symbol").value=e.symbol}};class re{constructor(){this._$pointX=0,this._$mouseMove=null,this._$mouseUp=null,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}static get CONTROLLER_DEFAULT_SIZE(){return 360}initialize(){document.documentElement.style.setProperty("--controller-width",`${re.CONTROLLER_DEFAULT_SIZE}px`);const e=document.getElementById("controller-adjustment");e&&e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),d.$initializeEnd()}mouseDown(e){e.preventDefault(),this._$pointX=e.screenX,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){d.$setCursor("col-resize"),window.requestAnimationFrame((()=>{const t=this._$pointX-e.screenX,a=0|document.documentElement.style.getPropertyValue("--controller-width").split("px")[0],r=Math.max(re.CONTROLLER_DEFAULT_SIZE,a+t);document.documentElement.style.setProperty("--controller-width",`${r}px`),d.$currentWorkSpace()._$controllerWidth=r,this._$pointX=e.screenX}))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto")}}d.$controllerAdjustment=new re;class se extends te{constructor(){super("filter"),this._$filterId=0,this._$filters=new Map}static get MIN_BLUR(){return 0}static get MAX_BLUR(){return 255}static get MIN_ALPHA(){return 0}static get MAX_ALPHA(){return 100}static get MIN_STRENGTH(){return 0}static get MAX_STRENGTH(){return 255}static get MIN_ROTATE(){return-360}static get MAX_ROTATE(){return 360}static get MIN_DISTANCE(){return-255}static get MAX_DISTANCE(){return 255}static get MIN_COLOR(){return 0}static get MAX_COLOR(){return 16777215}static get MIN_QUALITY(){return 0}static get MAX_QUALITY(){return 16}initialize(){super.initialize();const e=document.getElementById("filter-add");e&&e.addEventListener("mousedown",(()=>{this.addFilter(),this.disposeCharacterImage(),this.reloadScreen()}))}lock(e){e.stopPropagation();const t=0|e.currentTarget.dataset.filterId;if(!this._$filters.has(t))return;const a=this._$filters.get(t);a.lock=!a.lock,this._$currentValue=null,e.currentTarget.childNodes[1].setAttribute("class",a.lock?"active":"disable")}clickNodeTitle(e){const t=0|e.target.dataset.filterId,a=document.getElementById(`filter-view-area-${t}`);"none"===a.style.display?(a.style.display="",document.getElementById(`filter-title-arrow-${t}`).setAttribute("class","arrow active")):(a.style.display="none",document.getElementById(`filter-title-arrow-${t}`).setAttribute("class","arrow disable"))}changeState(e){const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;const a=this._$filters.get(t);a.filter.state=!a.filter.state,document.getElementById(`filter-state-${t}`).setAttribute("class",a.filter.state?"filter-active":"filter-disable"),this.disposeCharacterImage()}removeFilter(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const a=0|e.target.dataset.filterId,r=t[0],s=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId),i=d.$timelineFrame.currentFrame;let n=s.getPlace(i);n.tweenFrame&&(s.endFrame-1>i&&!s.hasTween(i)&&(d.$timelineTool.executeTimelineKeyAdd(),n=s.getPlace(i)),n=s.getPlace(n.tweenFrame));const o=this._$filters.get(a),l=n.filter.indexOf(o.filter);n.filter.splice(l,1),s.updateTweenFilter(i),this._$filters.delete(a),this._$filters.size||(document.querySelectorAll(".filter-none")[0].style.display=""),document.getElementById(`filter-id-${a}`).remove(),super.focusOut(),s._$image=null}focusIn(e){super.focusIn(e),this.setLockElement(e)}mouseDown(e){super.mouseDown(e),this.setLockElement(e)}setLockElement(e){if(this._$focus)return;const t=0|e.target.dataset.filterId;if(!this._$filters.has(t))return;if(this._$filters.get(t).lock)switch(this._$currentTarget.dataset.name){case"blurX":this._$lockTarget=document.getElementById(`blurY-${t}`);break;case"blurY":this._$lockTarget=document.getElementById(`blurX-${t}`)}}changeBlurX(e){return e=d.$clamp(+e,se.MIN_BLUR,se.MAX_BLUR),this.updateProperty("blurX",e),e}changeBlurY(e){return e=d.$clamp(+e,se.MIN_BLUR,se.MAX_BLUR),this.updateProperty("blurY",e),e}changeStrength(e){return e=d.$clamp(+e,se.MIN_STRENGTH,se.MAX_STRENGTH),this.updateProperty("strength",e),e}changeAlpha(e){return e=d.$clamp(+e,se.MIN_ALPHA,se.MAX_ALPHA),this.updateProperty("alpha",e),e}changeShadowAlpha(e){return e=d.$clamp(+e,se.MIN_ALPHA,se.MAX_ALPHA),this.updateProperty("shadowAlpha",e),e}changeHighlightAlpha(e){return e=d.$clamp(+e,se.MIN_ALPHA,se.MAX_ALPHA),this.updateProperty("highlightAlpha",e),e}changeAngle(e){return 0>(e=d.$clamp((0|e)%360,se.MIN_ROTATE,se.MAX_ROTATE))&&(e+=360),this.updateProperty("angle",e),e}changeDistance(e){return e=d.$clamp(+e,se.MIN_DISTANCE,se.MAX_DISTANCE),this.updateProperty("distance",e),e}changeColor(e){return this.updateProperty("color",d.$clamp(0|`0x${e.slice(1)}`,se.MIN_COLOR,se.MAX_COLOR)),e}changeShadowColor(e){return this.updateProperty("shadowColor",d.$clamp(0|`0x${e.slice(1)}`,se.MIN_COLOR,se.MAX_COLOR)),e}changeHighlightColor(e){return this.updateProperty("highlightColor",d.$clamp(0|`0x${e.slice(1)}`,se.MIN_COLOR,se.MAX_COLOR)),e}changeQuality(e){e=d.$clamp(0|e,se.MIN_QUALITY,se.MAX_QUALITY),this.updateProperty("quality",e)}changeType(e){switch(e){case"inner":case"outer":case"full":this.updateProperty("type",e)}}changeKnockout(){this.updateProperty("knockout",this._$currentTarget.checked)}changeInner(){this.updateProperty("inner",this._$currentTarget.checked)}changeHideObject(){this.updateProperty("hideObject",this._$currentTarget.checked)}updateProperty(e,t){const a=0|this._$currentTarget.dataset.filterId;if(!this._$filters.has(a))return;const r=this._$filters.get(a);r.filter[e]!==t&&(r.filter[e]=t,this.disposeCharacterImage())}disposeCharacterImage(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;const t=e[0],a=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);a.relocationTween(d.$timelineFrame.currentFrame),a._$image=null}setCommonEvent(e){this.setLockEvent(document.getElementById(`filter-${e}-lock`)),this.setTitleEvent(document.getElementById(`filter-name-${e}`)),this.setStateEvent(document.getElementById(`filter-state-${e}`)),this.setTrashEvent(document.getElementById(`trash-${e}`))}setLockEvent(e){e&&e.addEventListener("mousedown",(e=>{this.lock(e)}))}setTitleEvent(e){e&&e.addEventListener("mousedown",(e=>{this.clickNodeTitle(e)}))}setStateEvent(e){if(!e)return;const t=0|e.dataset.filterId;if(this._$filters.has(t)){const a=this._$filters.get(t);e.setAttribute("class",a.filter.state?"filter-active":"filter-disable")}e.addEventListener("mousedown",(e=>{this.save(),this.changeState(e),this.reloadScreen(),this._$saved=!1}))}setTrashEvent(e){e&&e.addEventListener("click",(e=>{this.removeFilter(e),this.reloadScreen()}))}addFilter(){document.querySelectorAll(".filter-none")[0].style.display="none";this[`add${document.getElementById("filter-select").value}`](document.getElementById("filter-setting-list"))}clearFilters(){this._$filterId=0,this._$filters.clear();const e=document.getElementById("filter-setting-list"),t=document.querySelectorAll(".filter-none")[0];for(;e.children.length;)e.children[0].remove();t.style.display="",e.appendChild(t)}createFilter(e,t=null){const a=this._$filterId++;if(!t){t=new e;const a=d.$tools.getDefaultTool("arrow").activeElements;if(!a.length)return;const r=a[0],s=d.$currentWorkSpace().scene.getLayer(0|r.dataset.layerId).getCharacter(0|r.dataset.characterId),i=d.$timelineFrame.currentFrame;let n=s.getPlace(i);n.tweenFrame&&(s.endFrame-1>i&&!s.hasTween(i)&&(d.$timelineTool.executeTimelineKeyAdd(),n=s.getPlace(i)),n=s.getPlace(n.tweenFrame)),n.filter.push(t),s.updateTweenFilter(i)}return this._$filters.set(a,{id:a,lock:!1,filter:t,context:null}),a}getFilterHeaderHTML(e,t){return`\n<div id="filter-id-${e}" class="filter-border">\n\n    <div class="filter-title">\n        <i id="filter-title-arrow-${e}" class="arrow active"></i>\n        <span id="filter-name-${e}" data-filter-id="${e}">${t}</span>\n        <i class="filter-active" id="filter-state-${e}" data-filter-id="${e}" data-detail="{{フィルターを表示・非表示する}}"></i>\n        <i class="trash" id="trash-${e}" data-filter-id="${e}" data-detail="{{フィルターを削除}}"></i>\n    </div>\n    \n    <div id="filter-view-area-${e}" class="filter-view-area">\n    \n        <div class="filter-view-area-left">\n        \n            <div id="filter-${e}-lock" data-filter-id="${e}" class="filter-lock">\n                ┌\n                <div class="disable" data-detail="{{比率を固定}}"></div>\n                └\n            </div>\n        \n        </div>\n`}addDropShadowFilter(e,t=null,a=!0){const r=this.createFilter(C,t);t||(t=this._$filters.get(r).filter);const s=this.getFilterHeaderHTML(r,"DropShadow")+`\n\n        <div class="filter-view-area-right">\n        \n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${r}" value="${t.blurX}" data-name="blurX" data-filter-id="${r}" data-detail="{{水平方向にぼかす}}"></div>\n                \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${r}" value="${t.strength}" data-filter-id="${r}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n    \n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${r}" value="${t.blurY}" data-name="blurY" data-filter-id="${r}" data-detail="{{垂直方向にぼかす}}"></div>\n                \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${r}" value="${t.angle}" data-filter-id="${r}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${r}" value="${t.distance}" data-filter-id="${r}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n    \n            <div class="filter-container">\n                <div class="filter-text">Shadow</div>\n                <div><input type="color" id="color-${r}" value="#${t.color.toString(16).padStart(6,"0")}" data-filter-id="${r}" data-name="color" data-detail="{{シャドウのカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="alpha-${r}" value="${t.alpha}" data-filter-id="${r}" data-name="alpha" data-detail="{{シャドウのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${r}" data-name="knockout" data-filter-id="${r}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${r}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div><input type="checkbox" id="inner-${r}" data-name="inner" data-filter-id="${r}"></div>\n                <div class="filter-text-long">\n                    <label for="inner-${r}">Inner Shadow</label>\n                </div>\n            </div>\n    \n            <div class="filter-container">\n                <div><input type="checkbox" id="hideObject-${r}" data-name="hideObject" data-filter-id="${r}"></div>\n                <div class="filter-text-long">\n                    <label for="hideObject-${r}">Hide Object</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${r}" data-name="quality" data-filter-id="${r}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div> \n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",s),this.setCommonEvent(r),t.knockout&&(document.getElementById(`knockout-${r}`).checked=!0),t.inner&&(document.getElementById(`inner-${r}`).checked=!0),t.hideObject&&(document.getElementById(`hideObject-${r}`).checked=!0);const i=[`blurX-${r}`,`blurY-${r}`,`strength-${r}`,`angle-${r}`,`alpha-${r}`,`distance-${r}`];for(let e=0;e<i.length;++e)this.setInputEvent(document.getElementById(i[e]));const n=[`knockout-${r}`,`inner-${r}`,`hideObject-${r}`];for(let e=0;e<n.length;++e)this.setClickEvent(document.getElementById(n[e]));const o=[`color-${r}`,`quality-${r}`];for(let e=0;e<o.length;++e)this.setChangeEvent(document.getElementById(o[e]));a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${r}`))}addBlurFilter(e,t=null,a=!0){const r=this.createFilter(M,t);t||(t=this._$filters.get(r).filter);const s=this.getFilterHeaderHTML(r,"Blur")+`\n    \n        <div class="filter-view-area-right">\n        \n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${r}" value="${t.blurX}" data-name="blurX" data-filter-id="${r}" data-detail="{{水平方向にぼかす}}"></div>\n            </div>\n        \n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${r}" value="${t.blurY}" data-name="blurY" data-filter-id="${r}" data-detail="{{垂直方向にぼかす}}"></div>\n            </div>\n        \n            <div class="filter-container">\n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${r}" data-name="quality" data-filter-id="${r}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div> \n        \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",s),this.setCommonEvent(r);const i=[`blurX-${r}`,`blurY-${r}`];for(let e=0;e<i.length;++e)this.setInputEvent(document.getElementById(i[e]));const n=[`quality-${r}`];for(let e=0;e<n.length;++e)this.setChangeEvent(document.getElementById(n[e]));a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${r}`))}addGlowFilter(e,t=null,a=!0){const r=this.createFilter(F,t);t||(t=this._$filters.get(r).filter);const s=this.getFilterHeaderHTML(r,"Glow")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${r}" value="${t.blurX}" data-name="blurX" data-filter-id="${r}" data-detail="{{水平方向にぼかす}}"></div>\n                \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${r}" value="${t.strength}" data-filter-id="${r}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${r}" value="${t.blurY}" data-name="blurY" data-filter-id="${r}" data-detail="{{垂直方向にぼかす}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Color</div>\n                <div><input type="color" id="color-${r}" value="#${t.color.toString(16).padStart(6,"0")}" data-filter-id="${r}" data-name="color" data-detail="{{シャドウのカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="alpha-${r}" value="${t.alpha}" data-filter-id="${r}" data-name="alpha" data-detail="{{シャドウのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="inner-${r}" data-name="inner" data-filter-id="${r}"></div>\n                <div class="filter-text-long">\n                    <label for="inner-${r}">Inner Glow</label>\n                </div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${r}" data-name="knockout" data-filter-id="${r}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${r}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${r}" data-name="quality" data-filter-id="${r}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div> \n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",s),this.setCommonEvent(r),t.knockout&&(document.getElementById(`knockout-${r}`).checked=!0),t.inner&&(document.getElementById(`inner-${r}`).checked=!0);const i=[`blurX-${r}`,`blurY-${r}`,`strength-${r}`,`alpha-${r}`,`distance-${r}`];for(let e=0;e<i.length;++e)this.setInputEvent(document.getElementById(i[e]));const n=[`knockout-${r}`,`inner-${r}`];for(let e=0;e<n.length;++e)this.setClickEvent(document.getElementById(n[e]));const o=[`color-${r}`,`quality-${r}`];for(let e=0;e<o.length;++e)this.setChangeEvent(document.getElementById(o[e]));a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${r}`))}addBevelFilter(e,t=null,a=!0){const r=this.createFilter(L,t);t||(t=this._$filters.get(r).filter);const s=this.getFilterHeaderHTML(r,"Bevel")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${r}" value="${t.blurX}" data-name="blurX" data-filter-id="${r}" data-detail="{{水平方向にぼかす}}"></div>\n                 \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${r}" value="${t.strength}" data-filter-id="${r}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${r}" value="${t.blurY}" data-name="blurY" data-filter-id="${r}" data-detail="{{垂直方向にぼかす}}"></div>\n                               \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${r}" value="${t.angle}" data-filter-id="${r}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${r}" value="${t.distance}" data-filter-id="${r}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Shadow<br>Color</div>\n                <div><input type="color" id="shadowColor-${r}" value="#${t.shadowColor.toString(16).padStart(6,"0")}" data-filter-id="${r}" data-name="shadowColor" data-detail="{{シャドウのカラー}}"></div>\n                \n                <div class="filter-text">Shadow<br>Alpha</div>\n                <div><input type="text" id="shadowAlpha-${r}" value="${t.shadowAlpha}" data-filter-id="${r}" data-name="shadowAlpha" data-detail="{{シャドウのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Highlight<br>Color</div>\n                <div><input type="color" id="highlightColor-${r}" value="#${t.highlightColor.toString(16).padStart(6,"0")}" data-filter-id="${r}" data-name="highlightColor" data-detail="{{ハイライトのカラー}}"></div>\n                \n                <div class="filter-text">Highlight<br>Alpha</div>\n                <div><input type="text" id="highlightAlpha-${r}" value="${t.highlightAlpha}" data-filter-id="${r}" data-name="highlightAlpha" data-detail="{{ハイライトのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${r}" data-name="knockout" data-filter-id="${r}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${r}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Type</div>\n                <div>\n                    <select id="type-${r}" data-name="type" data-filter-id="${r}">\n                        <option value="inner">Inner</option>\n                        <option value="outer">Outer</option>\n                        <option value="full">Full</option>\n                    </select>\n                </div>\n    \n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${r}" data-name="quality" data-filter-id="${r}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",s),this.setCommonEvent(r),t.knockout&&(document.getElementById(`knockout-${r}`).checked=!0);const i=[`blurX-${r}`,`blurY-${r}`,`strength-${r}`,`angle-${r}`,`shadowAlpha-${r}`,`highlightAlpha-${r}`,`distance-${r}`];for(let e=0;e<i.length;++e)this.setInputEvent(document.getElementById(i[e]));const n=[`knockout-${r}`];for(let e=0;e<n.length;++e)this.setClickEvent(document.getElementById(n[e]));const o=[`shadowColor-${r}`,`highlightColor-${r}`,`type-${r}`,`quality-${r}`];for(let e=0;e<o.length;++e)this.setChangeEvent(document.getElementById(o[e]));a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${r}`))}addGradientGlowFilter(e,t=null,a=!0){const r=this.createFilter(A,t);t||(t=this._$filters.get(r).filter);const s=this.getFilterHeaderHTML(r,"GradientGlow")+`\n\n        <div class="filter-view-area-right">\n\n            <div class="filter-container">\n                <div class="filter-text">BlurX</div>\n                <div><input type="text" id="blurX-${r}" value="${t.blurX}" data-name="blurX" data-filter-id="${r}" data-detail="{{水平方向にぼかす}}"></div>\n                          \n                <div class="filter-text">Strength</div>\n                <div><input type="text" id="strength-${r}" value="${t.strength}" data-filter-id="${r}" data-name="strength" data-detail="{{フィルター強度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">BlurY</div>\n                <div><input type="text" id="blurY-${r}" value="${t.blurY}" data-name="blurY" data-filter-id="${r}" data-detail="{{垂直方向にぼかす}}"></div>\n            \n                <div class="filter-text">Angle</div>\n                <div><input type="text" id="angle-${r}" value="${t.angle}" data-filter-id="${r}" data-name="angle" data-detail="{{フィルター角度}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text">Distance</div>\n                <div><input type="text" id="distance-${r}" value="${t.distance}" data-filter-id="${r}" data-name="distance" data-detail="{{フィルター距離}}"></div>\n            </div>\n\n            <div class="filter-container">\n                <div id="gradient-color-palette-${r}" class="gradient-color-palette">\n                    <div id="color-palette-${r}" class="color-palette">\n                        <canvas id="gradient-canvas-${r}"></canvas>\n                    </div>\n                    <div id="color-pointer-list-${r}" data-filter-id="${r}" class="color-pointer-list" data-detail="{{カラーポインターを追加}}"></div>\n                </div>\n            </div>\n            \n            <div class="filter-container">\n                <div class="filter-text">Color</div>\n                <div><input type="color" id="gradientColor-${r}" value="#000000" data-detail="{{グラデーションカラー}}"></div>\n                \n                <div class="filter-text">Alpha</div>\n                <div><input type="text" id="gradientAlpha-${r}" value="100" data-detail="{{グラデーションのアルファ}}"></div>\n            </div>\n            \n            <div class="filter-container">\n                <div><input type="checkbox" id="knockout-${r}" data-name="knockout" data-filter-id="${r}"></div>\n                <div class="filter-text-long">\n                    <label for="knockout-${r}">Knockout</label>\n                </div>\n            </div>\n\n            <div class="filter-container">\n                <div class="filter-text-long">Type</div>\n                <div>\n                    <select id="type-${r}" data-name="type" data-filter-id="${r}">\n                        <option value="inner">Inner</option>\n                        <option value="outer">Outer</option>\n                        <option value="full">Full</option>\n                    </select>\n                </div>\n    \n                <div class="filter-text-long">Quality</div>\n                <div>\n                    <select id="quality-${r}" data-name="quality" data-filter-id="${r}">\n                        <option value="1">Low</option>\n                        <option value="2">Middle</option>\n                        <option value="3">High</option>\n                    </select>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n</div>\n`;e.insertAdjacentHTML("beforeend",s);const i=document.getElementById(`gradient-canvas-${r}`);i.width=se.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,i.height=se.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio,i.style.transform=`scale(${1/window.devicePixelRatio}, ${1/window.devicePixelRatio})`,i.style.backfaceVisibility="hidden",i.style.transformOrigin="0 0",t.context=i.getContext("2d"),this.setCommonEvent(r),t.knockout&&(document.getElementById(`knockout-${r}`).checked=!0);const n=[`blurX-${r}`,`blurY-${r}`,`strength-${r}`,`angle-${r}`,`gradientAlpha-${r}`,`distance-${r}`];for(let e=0;e<n.length;++e)this.setInputEvent(document.getElementById(n[e]));const o=[`knockout-${r}`];for(let e=0;e<o.length;++e)this.setClickEvent(document.getElementById(o[e]));const l=[`gradientColor-${r}`,`type-${r}`,`quality-${r}`];for(let e=0;e<l.length;++e)this.setChangeEvent(document.getElementById(l[e]));for(let e=0;e<t.ratios.length;++e){const a=t.ratios[e],s=`#${t.colors[e].toString(16).padStart(6,"0")}`,i=t.alphas[e];this.addFilterGradientColorPointer(r,e,a,s,i)}this.setCreateGradientColorPointerEvent(r),this.updateFilterGradientCanvas(t),a&&this.disposeCharacterImage(),d.$addModalEvent(document.getElementById(`filter-id-${r}`))}}d.$filterController=new se;d.$gridController=new class extends ee{constructor(){super("nine-slice"),this._$state="hide",this._$elementIds=["grid-top-left","grid-top-right","grid-bottom-left","grid-bottom-right"],this._$gridMouseMove=null,this._$gridMouseUp=null}initialize(){super.initialize();const e=["nine-slice-setting-x","nine-slice-setting-y","nine-slice-setting-w","nine-slice-setting-h"];for(let t=0;t<e.length;++t)this.setInputEvent(document.getElementById(e[t]));for(let e=0;e<this._$elementIds.length;++e){const t=document.getElementById(this._$elementIds[e]);t&&(t.style.display="none",t.addEventListener("mousedown",(e=>{this.standbyPointer(e)})))}}standbyPointer(e){e.stopPropagation();const t=d.$tools.activeTool;t&&(e.grid=!0,t.dispatchEvent(D.MOUSE_DOWN,e))}changeNineSliceSettingX(e){return this.updateShapeGrid(+e,+document.getElementById("nine-slice-setting-y").value,+document.getElementById("nine-slice-setting-w").value,+document.getElementById("nine-slice-setting-h").value),+e}changeNineSliceSettingY(e){return this.updateShapeGrid(+document.getElementById("nine-slice-setting-x").value,+e,+document.getElementById("nine-slice-setting-w").value,+document.getElementById("nine-slice-setting-h").value),+e}changeNineSliceSettingW(e){return this.updateShapeGrid(+document.getElementById("nine-slice-setting-x").value,+document.getElementById("nine-slice-setting-y").value,+e,+document.getElementById("nine-slice-setting-h").value),+e}changeNineSliceSettingH(e){return this.updateShapeGrid(+document.getElementById("nine-slice-setting-x").value,+document.getElementById("nine-slice-setting-y").value,+document.getElementById("nine-slice-setting-w").value,+e),+e}updateShapeGrid(e,t,a,r){const s=d.$tools.getDefaultTool("arrow").activeElements;if(!s.length)return;const i=d.$currentWorkSpace().getLibrary(0|s[0].dataset.libraryId);switch(0){case e:case t:i._$grid=null,this.hide();break;default:i._$grid={x:e,y:t,w:a,h:r},this.show().relocation()}i.cacheClear()}show(){if("show"!==this._$state){this._$state="show";for(let e=0;e<this._$elementIds.length;++e){const t=document.getElementById(this._$elementIds[e]);t&&(t.style.display="")}}return this}hide(){if("hide"!==this._$state){for(let e=0;e<this._$elementIds.length;++e){const t=document.getElementById(this._$elementIds[e]);t&&(t.style.display="none")}this._$state="hide"}}relocation(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return this.hide();const t=e[0],a=0|t.dataset.characterId,r=document.getElementById(`character-${a}`);if(!r)return this.hide();const s=d.$currentWorkSpace(),i=s.getLibrary(0|t.dataset.libraryId);if(!i||"shape"!==i.type)return this.hide();const n=i._$grid;if(!n)return this.hide();const o=0|t.dataset.layerId,l=s.scene.getLayer(o).getCharacter(0|t.dataset.characterId);if(l.rotation)return void this.hide();const c=l.getBounds(),h=r.offsetLeft,u=r.offsetTop,m=l.width-Math.abs(c.xMax-c.xMin),g=l.height-Math.abs(c.yMax-c.yMin),p=document.getElementById("grid-top-left");p.style.left=h+n.x-4+"px",p.style.top=u+n.y-4+"px";const f=document.getElementById("grid-top-right");f.style.left=h+n.x+n.w+m-4+"px",f.style.top=u+n.y-4+"px";const $=document.getElementById("grid-bottom-left");$.style.left=h+n.x-4+"px",$.style.top=u+n.y+n.h+g-4+"px";const y=document.getElementById("grid-bottom-right");y.style.left=h+n.x+n.w+m-4+"px",y.style.top=u+n.y+n.h+g-4+"px"}};d.$instanceSelectController=new class extends ee{initialize(){super.initialize();const e=document.getElementById("instance-setting");e&&(e.style.display="none")}createInstanceSelect(e){const t=d.$currentWorkSpace(),a=document.getElementById("instance-type-name");for(;a.children.length;)a.children[0].remove();const r=document.createElement("i");r.setAttribute("class",`library-type-${e.type}`),a.appendChild(r);const s=document.createElement("select");s.classList.add("instance-select"),s.addEventListener("change",(e=>{const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(D.CHANGE,e))}));for(const a of t._$libraries.values()){if(!a.id)continue;switch(a.type){case"folder":case"sound":continue}const r=document.createElement("option");r.value=a.id;let i=a.name;if(a._$folderId){let e=a;for(;e._$folderId;)e=t.getLibrary(e._$folderId),i=`${e.name}/${i}`}r.innerHTML=i,a.id===e.id&&(r.defaultSelected=!0),s.appendChild(r)}a.appendChild(s)}};d.$javascriptController=new class{reload(){const e=document.getElementById("javascript-internal-list-box");if(!e)return;const t=e.children;for(;t.length;)t[0].remove();const a=d.$currentWorkSpace();for(const t of a._$libraries.values()){if("container"!==t._$type)continue;if(!t._$actions.size)continue;const a=t.id,r=`<div id="script-${a}" data-library-id="${a}" class="internal-parent"><i></i>${t._$name}</div>`;e.insertAdjacentHTML("beforeend",r);document.getElementById(`script-${a}`).addEventListener("dblclick",(e=>{d.$sceneChange.reload(0|e.currentTarget.dataset.libraryId)}));for(const r of t._$actions.keys()){const t=`<div id="script-${a}-${r}" data-library-id="${a}" data-frame="${r}" class="internal-child"><i></i>frame ${r}</div>`;e.insertAdjacentHTML("beforeend",t);document.getElementById(`script-${a}-${r}`).addEventListener("mousedown",(e=>{d.$javaScriptEditor.hide();const t=e.currentTarget,a=d.$currentWorkSpace().getLibrary(0|t.dataset.libraryId),r=0|t.dataset.frame;d.$javaScriptEditor.show(null,r,a)}))}}}};d.$libraryController=new class{constructor(){this._$saved=!1,this._$activeInstances=new Map,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}get activeInstances(){return this._$activeInstances}set activeInstance(e){switch(!0){case d.$ctrlKey&&this.activeInstances.size>0:{const t=0|e.dataset.libraryId;this.activeInstances.has(t)?(this.activeInstances.delete(t),e.classList.remove("active")):(this.activeInstances.set(t,e),e.classList.add("active"))}break;case d.$shiftKey&&this.activeInstances.size>0:{const t=Array.from(document.getElementById("library-list-box").children),a=t.indexOf(this.activeInstances.values().next().value),r=t.indexOf(e);if(-1===r||r===a)break;if(this.clearActive(),r>a){const e=r-a+1;for(let r=0;e>r;++r){const e=t[a+r];this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active")}}else{const e=a-r+1;for(let r=0;e>r;++r){const e=t[a-r];this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active")}}}break;default:this.clearActive(),e&&(this.activeInstances.set(0|e.dataset.libraryId,e),e.classList.add("active"))}}clearActive(){for(const e of this.activeInstances.values())e.classList.remove("active");this.activeInstances.clear(),d.$libraryPreview.dispose()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-list-box");e&&(e.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",(e=>{this.drop(e)})),e.addEventListener("dragstart",(()=>{this.dragstart()})),e.addEventListener("dragend",(()=>{this.dragend()})),e.addEventListener("mousedown",(e=>{e.stopPropagation(),e.button||this.clearActive()}))),d.$initializeEnd()}clearSoundSelect(){const e=document.getElementById("sound-select");for(;e.children.length;)e.children[0].remove()}clearLibrary(){const e=document.getElementById("library-list-box");for(;e.children.length;)e.children[0].remove()}reload(e=null){e||(e=Array.from(d.$currentWorkSpace()._$libraries.values())),this.clearLibrary(),this.clearSoundSelect(),e.sort(((e,t)=>{const a=e.name.toLowerCase(),r=t.name.toLowerCase();switch(!0){case a>r:return 1;case a<r:return-1;default:return 0}}));const t=new Map,a=new Map;for(let r=0;r<e.length;++r){const s=e[r];if(s.id){if(d.$libraryController.createInstance(s.type,s.name,s.id,s.symbol),"folder"===s.type&&s.mode===d.FOLDER_OPEN&&this.openFolder(s),s.folderId){const e=document.getElementById(`library-child-id-${s.id}`);e.remove(),a.has(s.folderId)||a.set(s.folderId,[]),a.get(s.folderId).push(e)}"folder"===s.type&&t.set(s.id,s)}}if(t.size){const e=document.getElementById("library-list-box"),r=new Map;for(;t.size!==r.size;){for(const[s,i]of t){if(!a.has(s)){r.set(s,!0);continue}if(r.has(s))continue;const t=document.getElementById(`library-child-id-${i.id}`);if(!t)continue;const n=a.get(s);for(let a=0;a<n.length;++a){const r=n[a];e.insertBefore(r,t.nextElementSibling),i.mode===d.FOLDER_CLOSE&&(r.style.display="none")}r.set(s,!0)}for(const[e,r]of t)a.has(e)&&!r.folderId&&this.updateFolderStyle(r,r.mode)}r.clear(),t.clear(),a.clear()}}createInstance(e,t,a,r=""){const s=`\n<div draggable="true" class="library-list-box-child" id="library-child-id-${a}" data-library-id="${a}">\n    <div class="library-list-box-name">\n        <i class="library-type-${"folder"===e?"arrow close":"space"}" id="arrow-${a}" data-library-id="${a}"></i>\n        <i class="library-type-${e} " id="${e}-${a}" data-library-id="${a}"></i>\n        <p>\n            <span id="library-name-${a}" class="view-text" data-type="name" data-library-id="${a}">${t}</span>\n            <input type="text" id="library-name-input-${a}" data-library-id="${a}" data-type="name" value="${t}" style="display: none;">\n        </p>\n    </div>\n    <div class="library-list-box-symbol">\n        <p>\n            <span id="library-symbol-name-${a}" class="view-symbol-text" data-type="symbol" data-library-id="${a}">${r}</span>\n            <input type="text" id="library-symbol-name-input-${a}" data-library-id="${a}" data-type="symbol" value="${r}" style="display: none;">\n        </p>\n    </div>\n</div>`;document.getElementById("library-list-box").insertAdjacentHTML("beforeend",s),"container"===e&&document.getElementById(`${e}-${a}`).addEventListener("dblclick",(e=>{d.$sceneChange.reload(0|e.currentTarget.dataset.libraryId)}));const i=document.getElementById(`library-child-id-${a}`);if(this.activeInstances.has(a)&&(this.activeInstances.set(a,i),i.classList.add("active")),i.addEventListener("mousedown",(e=>{this.selectInstance(e)})),"folder"===e){i.addEventListener("dragover",(e=>{e.preventDefault()})),i.addEventListener("drop",(e=>{this.folderIn(e)}));document.getElementById(`arrow-${a}`).addEventListener("mousedown",(e=>{this.clickFolder(e)}));const t=document.getElementById(`${e}-${a}`);t.addEventListener("dblclick",(e=>{this.clickFolder(e)})),t.classList.remove("library-type-folder"),t.classList.add("library-type-folder-close")}if("sound"===e){const e=document.createElement("option");e.value=`${a}`,e.innerHTML=t,document.getElementById("sound-select").appendChild(e)}const n=[`library-name-${a}`];"folder"!==e&&n.push(`library-symbol-name-${a}`);for(let e=0;e<n.length;++e)document.getElementById(n[e]).addEventListener("dblclick",(e=>{this.inputStart(e)}));const o=[`library-name-input-${a}`];"folder"!==e&&o.push(`library-symbol-name-input-${a}`);for(let e=0;e<o.length;++e){const t=document.getElementById(o[e]);t.addEventListener("focusout",(e=>{this.inputEnd(e)})),t.addEventListener("keypress",(e=>{this.inputEnd(e)}))}return{id:a,type:e,name:t,symbol:r}}selectInstance(e){if(e.button)return;if(d.$endMenu(),e.stopPropagation(),d.$keyLock)return;const t=e.currentTarget;(d.$ctrlKey||d.$shiftKey||!t.classList.contains("active"))&&(this.activeInstance=t,d.$libraryPreview.loadImage(0|t.dataset.libraryId))}inputStart(e){d.$keyLock=!0,e.stopPropagation();const t=e.target,a=0|t.dataset.libraryId,r=document.getElementById(`library-child-id-${a}`);r.classList.remove("active"),r.draggable=!1;const s="name"===t.dataset.type?`library-name-input-${a}`:`library-symbol-name-input-${a}`,i=document.getElementById(s);i.value=t.textContent,i.style.display="",i.focus(),t.style.display="none"}inputEnd(e){if("Enter"!==e.key){if("focusout"===e.type){this.save();const t=e.target,a=0|t.dataset.libraryId,r=d.$currentWorkSpace().getLibrary(a),s="name"===t.dataset.type?`library-name-${a}`:`library-symbol-name-${a}`,i=document.getElementById(s);r[t.dataset.type]=t.value,i.textContent=t.value,i.style.display="";const n=document.getElementById(`library-child-id-${a}`);this.activeInstances.has(a)&&n.classList.add("active"),t.style.display="none",n.draggable=!0,d.$keyLock=!1,this._$saved=!1,"name"===t.dataset.type&&this.reload()}}else e.target.blur()}clickFolder(e){e.stopPropagation();const t=d.$currentWorkSpace().getLibrary(0|e.target.dataset.libraryId);t.mode===d.FOLDER_OPEN?this.closeFolder(t):this.openFolder(t),this.updateFolderStyle(t,t.mode)}updateFolderStyle(e,t){const a=d.$currentWorkSpace(),r=document.getElementById("library-list-box").children;let s=20,i=e.folderId;if(i)for(;;){const e=a.getLibrary(i);if(!e)break;if(s+=20,i=e.folderId,!i)break}for(let i=0;i<r.length;++i){const n=r[i],o=a.getLibrary(0|n.dataset.libraryId);o.folderId&&(o.folderId===e.id&&(n.style.paddingLeft=`${s}px`,n.style.display=t===d.FOLDER_OPEN?"":"none","folder"===o.type&&this.updateFolderStyle(o,t===d.FOLDER_OPEN?o.mode:t)))}}openFolder(e){e.mode=d.FOLDER_OPEN;const t=document.getElementById(`folder-${e.id}`);t.classList.remove("library-type-folder-close"),t.classList.add("library-type-folder-open");const a=document.getElementById(`arrow-${e.id}`);a.classList.add("open"),a.classList.remove("close")}closeFolder(e){e.mode=d.FOLDER_CLOSE;const t=document.getElementById(`folder-${e.id}`);t.classList.remove("library-type-folder-open"),t.classList.add("library-type-folder-close");const a=document.getElementById(`arrow-${e.id}`);a.classList.remove("open"),a.classList.add("close")}dragstart(){const e=document.getElementById("stage-area").children;for(let t=1;t<e.length;++t)e[t].style.pointerEvents="none"}dragend(){const e=document.getElementById("stage-area").children;for(let t=1;t<e.length;++t){const a=e[t];a.dataset.preview||(a.style.pointerEvents="")}}drop(e){e.preventDefault(),e.stopPropagation(),this.save();if(e.dataTransfer.items.length){const t=e.dataTransfer.items;for(let e=0;e<t.length;++e)this.scanFiles(t[e].webkitGetAsEntry())}else this.folderOut(),this.reload();this._$saved=!1}scanFiles(e,t=0){switch(!0){case e.isDirectory:{const a=d.$currentWorkSpace().addLibrary({id:d.$currentWorkSpace().nextLibraryId,type:"folder",name:e.name,symbol:""});t&&(a.folderId=t),e.createReader().readEntries((e=>{for(let t=0;t<e.length;++t)this.scanFiles(e[t],a.id)})),this.updateFolderStyle(a,a.mode)}break;case e.isFile:e.file((e=>{this.loadFile(e,t)}))}}loadFile(e,t=0){switch(e.type){case"image/svg+xml":e.text().then((a=>{const r=this.createInstance("container",e.name,d.$currentWorkSpace().nextLibraryId),s=d.$currentWorkSpace().addLibrary(r),i=document.getElementById(`library-child-id-${r.id}`);if(i&&(this.activeInstances.set(r.id,i),i.classList.add("active")),t){s.folderId=t;const e=d.$currentWorkSpace().getLibrary(t);this.updateFolderStyle(e,e.mode)}P.parse(a,s),d.$instanceSelectController.createInstanceSelect(s),d.$libraryController.reload()}));break;case"image/png":case"image/jpeg":case"image/gif":e.arrayBuffer().then((a=>{const r=new Blob([a],{type:e.type}),s=new Image;s.src=URL.createObjectURL(r),s.decode().then((()=>{const a=s.width,r=s.height,i=document.createElement("canvas");i.width=a,i.height=r;const n=i.getContext("2d");n.drawImage(s,0,0,a,r);const o=new Uint8Array(n.getImageData(0,0,a,r).data),l=this.createInstance("bitmap",e.name,d.$currentWorkSpace().nextLibraryId),c=document.getElementById(`library-child-id-${l.id}`);c&&(this.activeInstances.set(l.id,c),c.classList.add("active")),l.width=s.width,l.height=s.height,l.imageType=e.type,l.buffer=new Uint8Array(o);const h=d.$currentWorkSpace().addLibrary(l);if(t){h.folderId=t;const e=d.$currentWorkSpace().getLibrary(t);this.updateFolderStyle(e,e.mode)}d.$instanceSelectController.createInstanceSelect(h),d.$libraryController.reload()}))}));break;case"video/mp4":e.arrayBuffer().then((a=>{const r=new Blob([a],{type:e.type}),s=document.createElement("video");s.onloadedmetadata=()=>{const r=this.createInstance("video",e.name,d.$currentWorkSpace().nextLibraryId),i=document.getElementById(`library-child-id-${r.id}`);i&&(this.activeInstances.set(r.id,i),i.classList.add("active")),r.width=s.videoWidth,r.height=s.videoHeight,r.buffer=new Uint8Array(a);const n=d.$currentWorkSpace().addLibrary(r);if(t){n.folderId=t;const e=d.$currentWorkSpace().getLibrary(t);this.updateFolderStyle(e,e.mode)}d.$instanceSelectController.createInstanceSelect(n),d.$libraryController.reload()},s.src=URL.createObjectURL(r),s.load()}));break;case"audio/mpeg":e.arrayBuffer().then((a=>{const r=this.createInstance("sound",e.name,d.$currentWorkSpace().nextLibraryId),s=document.getElementById(`library-child-id-${r.id}`);s&&(this.activeInstances.set(r.id,s),s.classList.add("active")),r.buffer=new Uint8Array(a);const i=d.$currentWorkSpace().addLibrary(r);if(t){i.folderId=t;const e=d.$currentWorkSpace().getLibrary(t);this.updateFolderStyle(e,e.mode)}d.$libraryController.reload()}));break;case"application/x-shockwave-flash":e.arrayBuffer().then((a=>{(new B).setData(new Uint8Array(a)).run(e.name,t)}))}}folderOut(){if(this.activeInstances.size)for(const e of this.activeInstances.values()){const t=d.$currentWorkSpace().getLibrary(0|e.dataset.libraryId);t&&(t.folderId&&(t.folderId=0,e.style.display="",e.style.paddingLeft=""))}}folderIn(e){if(!this.activeInstances.size)return;this.save(),e.stopPropagation(),e.preventDefault();const t=d.$currentWorkSpace(),a=e.currentTarget,r=t.getLibrary(0|a.dataset.libraryId);for(const e of this.activeInstances.values()){t.getLibrary(0|e.dataset.libraryId).folderId=r.id}this.reload(),this._$saved=!1}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}};d.$libraryKeyboardCommand=new class extends O{constructor(){super("library")}initialize(){super.initialize();const e=document.getElementById("library-list-box");e&&(e.addEventListener("mouseleave",(()=>{this.active=!1})),e.addEventListener("mouseover",(()=>{this.active||(this.active=!0)}))),this.add("Backspace",this.executeInstanceDelete),this.add(d.$generateShortcutKey("Backspace",{ctrl:!0,shift:!0}),this.executeNoUseInstanceDelete),this.add(d.$generateShortcutKey("m",{ctrl:!0}),this.addMovieClip),this.add(d.$generateShortcutKey("f",{ctrl:!0}),this.addFolder),this.add(d.$generateShortcutKey("r",{ctrl:!0}),this.loadFile),this.add(d.$generateShortcutKey("s",{alt:!0}),this.cloneShape),this.add(d.$generateShortcutKey("s",{ctrl:!0,shift:!0}),this.showOutputModal)}showOutputModal(){console.log("TODO")}cloneShape(){d.$libraryMenu.executeLibraryMenuContentShapeClone()}loadFile(){d.$shiftKey=!1,d.$ctrlKey=!1,d.$altKey=!1,document.getElementById("library-menu-file-input").click()}addFolder(){d.$libraryMenu.executeLibraryMenuFolderAdd()}addMovieClip(){d.$libraryMenu.executeLibraryMenuContainerAdd()}executeInstanceDelete(){d.$libraryMenu.executeLibraryMenuDelete()}executeNoUseInstanceDelete(){d.$libraryMenu.executeLibraryMenuNoUseDelete()}};d.$libraryMenu=new class{constructor(){this._$saved=!1,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-list-box");e&&(e.addEventListener("contextmenu",(e=>{this.show(e)})),e.addEventListener("mousedown",(e=>{e.button||this.hide()})));const t=["library-menu-container-add","library-menu-folder-add","library-menu-content-shape-clone","library-menu-file","library-menu-delete","library-menu-no-use-delete"];for(let e=0;e<t.length;++e){const a=document.getElementById(t[e]);a&&a.addEventListener("mousedown",(e=>{if(e.button)return;e.stopPropagation();this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e),d.$endMenu()}))}const a=document.getElementById("library-menu-file-input");a&&a.addEventListener("change",(e=>{this.save();const t=e.target.files;for(let e=0;e<t.length;++e)d.$libraryController.loadFile(t[e]);e.target.value="",this._$saved=!1})),d.$initializeEnd()}executeLibraryMenuContainerAdd(){this.save();const e=d.$currentWorkSpace(),t=e.nextLibraryId;e.addLibrary({id:t,type:"container",name:`MovieClip_${t}`,symbol:""}),this._$saved=!1,d.$libraryController.reload()}executeLibraryMenuFolderAdd(){this.save();const e=d.$currentWorkSpace(),t=e.nextLibraryId,a=e.addLibrary({id:t,type:"folder",name:`Folder_${t}`,symbol:""}),r=d.$libraryController.activeInstances;if(r.size){for(let a of r.keys()){e.getLibrary(a).folderId=t}a.mode=d.FOLDER_OPEN}d.$libraryController.reload(),this._$saved=!1}executeLibraryMenuContentShapeClone(){const e=d.$libraryController.activeInstances;if(!e.size)return;let t=!1;const a=d.$currentWorkSpace();for(const r of e.keys()){const e=a.getLibrary(r);if("shape"!==e.type)continue;t=!0,this.save();const s=a.nextLibraryId,i=a.addLibrary(d.$libraryController.createInstance(e.type,`${e.name}_Clone`,s));e.copyFrom(i)}t&&d.$libraryController.reload(),this._$saved=!1}executeLibraryMenuFile(e){e.preventDefault(),document.getElementById("library-menu-file-input").click()}executeLibraryMenuDelete(){const e=d.$libraryController.activeInstances;if(!e.size)return;this.save();const t=d.$currentWorkSpace();for(const a of e.values()){const e=0|a.dataset.libraryId,r=t.getLibrary(e);r&&(r.remove(),a.remove(),t.removeLibrary(e))}e.clear();d.$tools.getDefaultTool("arrow").clearActiveElement(),d.$transformController.hide(),d.$gridController.hide(),d.$tweenController.clearPointer(),d.$controller.default(),d.$javascriptController.reload(),d.$libraryController.reload(),d.$libraryPreview.dispose(),d.$timelineLayer.activeCharacter(),t.scene.changeFrame(d.$timelineFrame.currentFrame),this._$saved=!1}executeLibraryMenuNoUseDelete(){let e=!1;const t=d.$currentWorkSpace(),a=new Map;for(let e of t._$libraries.values())if("container"===e.type){for(let t of e._$layers.values()){const e=t._$characters;for(let t=0;t<e.length;++t){const r=e[t].libraryId;a.has(r)||a.set(r,!0)}}if(e._$sounds.size)for(const t of e._$sounds.values())for(let e=0;e<t.length;++e){const r=t[e];a.set(r.characterId,!0)}}for(let r of t._$libraries.values())a.has(r.id)||"folder"===r.type||"container"===r.type||(this.save(),e=!0,t.removeLibrary(r.id));e&&(d.$libraryController.clearActive(),d.$javascriptController.reload(),d.$libraryController.reload()),this._$saved=!1}show(e){const t=document.getElementById("library-menu");t.style.left=t.clientWidth+e.pageX+5>window.innerWidth?e.pageX-(t.clientWidth+e.pageX+10-window.innerWidth)+"px":`${e.pageX+5}px`,t.style.top=e.pageY-t.clientHeight/2+"px",t.setAttribute("class","fadeIn"),d.$endMenu("library-menu")}hide(){d.$endMenu()}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}};d.$libraryPreview=new class{constructor(){this._$currentId=-1,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-preview-area");e&&(e.addEventListener("mousedown",(e=>{this.mousedown(e)})),e.addEventListener("dragstart",(()=>{d.$libraryController.dragstart()})),e.addEventListener("dragend",(()=>{d.$libraryController.dragend()}))),d.$initializeEnd()}mouseout(e){-1!==this._$currentId&&(e.stopPropagation(),document.getElementById("library-preview-area").draggable=!1)}mousedown(e){if(-1===this._$currentId)return;e.stopPropagation();const t=document.getElementById(`library-child-id-${this._$currentId}`);if(t){const e=document.getElementById("library-preview-area"),a=Array.from(document.getElementById("library-preview-area").children);d.$libraryController.activeInstance=t;for(let t=0;t<a.length;++t)e.appendChild(a[t]);e.draggable=!0}}dispose(){this._$currentId=-1;const e=document.getElementById("library-preview-area");for(;e.firstChild;)e.firstChild.remove();e.draggable=!1}loadImage(e){this.dispose();const t=d.$currentWorkSpace().getLibrary(e);"folder"!==t.type&&(this._$currentId=e,document.getElementById("library-preview-area").appendChild(t.preview))}};d.$librarySearch=new class{constructor(){this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("library-search");e&&(e.addEventListener("focusin",(()=>{d.$keyLock=!0})),e.addEventListener("focusout",(()=>{d.$keyLock=!1})),e.addEventListener("input",(e=>{this.execute(e)}))),d.$initializeEnd()}execute(e){const t=e.target.value,a=document.getElementById("library-list-box").children,r=a.length;for(let e=0;e<r;++e){const r=a[e];!t||r.children[0].innerText.indexOf(t)>-1||r.children[1].innerText.indexOf(t)>-1?r.style.display="":r.style.display="none"}}};d.$loopController=new class extends ee{constructor(){super("loop"),this._$frameTarget="start"}initialize(){super.initialize();const e=["no-use-loop","loop-repeat","loop-no-repeat","fixed-one","loop-no-repeat-reversal","loop-repeat-reversal","frame-picker-button","target-start-button","target-end-button"];for(let t=0;t<e.length;++t){const a=document.getElementById(e[t]);a&&a.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e.target.id,e)}))}const t=["loop-start-frame","loop-end-frame"];for(let e=0;e<t.length;++e){const a=document.getElementById(t[e]);a&&this.setInputEvent(a)}}changeLoopStartFrame(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return e;const a=t[0],r=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);if(!r)return e;e=d.$clamp(0|e,1,r.endFrame-1);const s=d.$timelineFrame.currentFrame,i=r.getRange(s);let n=r.getPlace(i.startFrame);return n.loop?(n.loop.start=e,r._$image=null,this.reloadScreen(),e):e}changeLoopEndFrame(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return e;const a=t[0],r=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);if(!r)return e;e=d.$clamp(0|e,0,r.endFrame-1);const s=d.$timelineFrame.currentFrame,i=r.getRange(s);let n=r.getPlace(i.startFrame);return n.loop?(n.loop.end=e,r._$image=null,this.reloadScreen(),e||"-"):e}changeFramePickerButton(){document.getElementById("loop-image-list").style.display="none",this.loadLoopFrameList()}changeTargetStartButton(){const e=document.getElementById("target-start-button");e.classList.contains("active")||e.classList.add("active"),document.getElementById("target-end-button").classList.remove("active"),this._$frameTarget="start"}changeTargetEndButton(){const e=document.getElementById("target-end-button");e.classList.contains("active")||e.classList.add("active"),document.getElementById("target-start-button").classList.remove("active"),this._$frameTarget="end"}changeLoopRepeat(){const e=document.getElementById("loop-repeat");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(0)}changeLoopNoRepeat(){const e=document.getElementById("loop-no-repeat");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(1)}changeFixedOne(){const e=document.getElementById("fixed-one");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(2)}changeLoopNoRepeatReversal(){const e=document.getElementById("loop-no-repeat-reversal");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(3)}changeLoopRepeatReversal(){const e=document.getElementById("loop-repeat-reversal");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(4)}changeNoUseLoop(){const e=document.getElementById("no-use-loop");this.clearLoopButton(e),e.classList.add("active"),this.updateLoopType(5)}clearLoopButton(e){const t=e.parentNode.children;for(let e=0;e<t.length;++e)t[e].classList.remove("active")}reload(e){const t=document.getElementById("loop-setting-view-area").firstElementChild.children;for(let e=0;e<t.length;++e)t[e].classList.remove("active");const a=document.getElementById("loop-image-list");for(;a.children.length;)a.children[0].remove();document.getElementById(["loop-repeat","loop-no-repeat","fixed-one","loop-no-repeat-reversal","loop-repeat-reversal","no-use-loop"][e.type]).classList.add("active"),document.getElementById("loop-start-frame").value=`${e.start}`,document.getElementById("loop-end-frame").value=`${e.end?e.end:"-"}`}loadLoopFrameList(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=document.getElementById("loop-image-list"),a=t.children;for(;a.length;)a[0].remove();const r=d.$currentWorkSpace(),s=r.scene,i=e[0],n=0|i.dataset.layerId,o=s.getLayer(n),l=0|i.dataset.characterId,c=o.getCharacter(l),h={startFrame:c.startFrame,endFrame:c.endFrame},u=r.getLibrary(c.libraryId),m=d.$timelineFrame.currentFrame,g=[],p=u.totalFrame;for(let e=1;p>=e;++e)g.push(new Promise((t=>{window.requestAnimationFrame((()=>{const{Sprite:a,BitmapData:r}=window.next2d.display,{Matrix:s,ColorTransform:i}=window.next2d.geom;d.$currentFrame=e;const n=new a,o={frame:e,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],loop:d.$getDefaultLoopConfig()},l=n.addChild(u.createInstance(o,h));l.transform.matrix=new s,l.transform.colorTransform=new i;const c=d.$boundsMatrix(u.getBounds(o,h),o.matrix),m=Math.ceil(Math.abs(c.xMax-c.xMin)),g=Math.ceil(Math.abs(c.yMax-c.yMin)),p=Math.min(95/m,95/g),f=window.devicePixelRatio,$=new r(m*p*f,g*p*f,!0,0),y=new s(f,0,0,f,-c.xMin*f,-c.yMin*f);y.scale(p,p),$.draw(n,y);const _=$.toImage();return $.dispose(),_.width=_.width/f,_.height=_.height/f,t({index:e-1,image:_})}))})));Promise.all(g).then((e=>{d.$currentFrame=m;const a=[];for(let t=0;t<e.length;++t){const r=e[t];a[r.index]=r.image}for(let e=0;e<a.length;++e){const r=e+1,s=document.createElement("span");s.textContent=`[ ${r} ]`;const i=document.createElement("p");i.appendChild(a[e]);const n=document.createElement("div");n.dataset.frame=`${r}`,n.appendChild(i),n.appendChild(s),n.addEventListener("click",(e=>{this.clickImage(e)})),t.appendChild(n)}t.style.display=""}))}clickImage(e){e.stopPropagation();const t=document.getElementById(`loop-${this._$frameTarget}-frame`);this.save(),t.focus(),t.value=e.currentTarget.dataset.frame,t.blur(),this._$saved=!1}updateLoopType(e=0){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const a=t[0],r=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);if(!r)return;const s=d.$timelineFrame.currentFrame,i=r.getRange(s);let n=r.getPlace(i.startFrame);n.loop.type!==e&&(n.loop.type=e,r._$image=null,this.reloadScreen())}};d.$objectController=new class extends ee{constructor(){super("object")}initialize(){super.initialize();const e=document.getElementById("object-name");e&&(e.addEventListener("focusout",(e=>{this.finishInput(e,!1)})),e.addEventListener("keypress",(e=>{this.finishInput(e,!1)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})));const t=document.getElementById("object-symbol");t&&(t.addEventListener("focusout",(e=>{this.finishInput(e,!1)})),t.addEventListener("keypress",(e=>{this.finishInput(e,!1)})),t.addEventListener("focusin",(e=>{this.focusIn(e)})))}changeObjectSymbol(e){const t=d.$tools.getDefaultTool("arrow");switch(t.activeElements.length){case 0:d.$currentWorkSpace().scene.symbol=e;break;case 1:{const a=t.activeElements[0];d.$currentWorkSpace().getLibrary(0|a.dataset.libraryId).symbol=e}}return e}changeObjectName(e){const t=d.$tools.getDefaultTool("arrow");switch(t.activeElements.length){case 0:d.$currentWorkSpace().scene.name=e;break;case 1:{const a=t.activeElements[0];d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId).name=e}}return e}};d.$pluginController=new class{constructor(){this._$saved=!1,this._$selectElement=null,this._$deleteCommand=null,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),this._$deleteCommand=this.deleteCommand.bind(this);const e=document.getElementById("plugin-list-box");e&&(e.addEventListener("mouseleave",(()=>{this.mouseleave()})),e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(e=>{this.dropElement(e)}))),d.$initializeEnd()}dropElement(e){this.save(),e.preventDefault();const t=d.$currentWorkSpace(),a=[],r=e.dataTransfer.files;for(let e=0;e<r.length;++e){const s=r[e];a.push(s.text().then((e=>{t._$plugins.set(s.name,{name:s.name,src:e})})))}Promise.all(a).then((()=>{this.reload(Array.from(d.$currentWorkSpace()._$plugins.values())),this._$saved=!1}))}mouseleave(){this._$selectElement&&this._$selectElement.classList.remove("active"),window.removeEventListener("keydown",this._$deleteCommand),this._$selectElement=null}reload(e){const t=["plugin-list-box","plugin-tools","plugin-menu"];for(let e=0;e<t.length;++e){const a=document.getElementById(t[e]);if(a)for(;a.children.length;)a.children[0].remove()}const a=document.getElementsByTagName("script");for(let e=0;e<a.length;++e){const t=a[e];t.dataset.plugin&&t.remove()}for(let t=0;t<e.length;++t){const a=e[t];document.getElementById(a.name)||(this.appendScript(a.name,a.src),this.appendNode(a.name))}}appendScript(e,t){const a=document.createElement("script");a.dataset.plugin="true",a.async=!0,a.id=e,a.type="text/javascript",a.src=URL.createObjectURL(new Blob([t],{type:"text/javascript"})),document.getElementsByTagName("head")[0].appendChild(a)}appendNode(e){const t=document.createElement("div");t.dataset.id=`${e}_node`,t.dataset.name=`${e}`,t.classList.add("plugin-list"),t.innerHTML=`<i></i>${e}`,t.addEventListener("mousedown",(e=>{this._$selectElement||window.addEventListener("keydown",this._$deleteCommand),this._$selectElement&&this._$selectElement.classList.remove("active"),this._$selectElement=e.currentTarget,this._$selectElement.classList.add("active")})),document.getElementById("plugin-list-box").appendChild(t)}deleteCommand(e){d.$keyLock||"Backspace"===e.key&&(this.save(),window.removeEventListener("keydown",this._$deleteCommand),this.dispose(this._$selectElement),this._$selectElement=null,this._$saved=!1)}dispose(e){const t=e.dataset.name,a=document.getElementById(t);a&&a.remove(),d.$currentWorkSpace()._$plugins.delete(t),e.remove()}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}};class ie{constructor(){this._$screenX=0,this._$screenY=0,this._$moveModal=null,this._$endModal=null,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=["plugin-bar","plugin-hide-icon"];for(let t=0;t<e.length;++t){const a=document.getElementById(e[t]);a&&a.addEventListener("mousedown",(e=>{e.stopPropagation();this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e),d.$endMenu()}))}document.documentElement.style.setProperty("--plugin-panel-width",`${ie.PLUGIN_DEFAULT_WIDTH}px`),document.documentElement.style.setProperty("--plugin-panel-height",`${ie.PLUGIN_DEFAULT_HEIGHT}px`),d.$initializeEnd()}static get PLUGIN_DEFAULT_WIDTH(){return 200}static get PLUGIN_DEFAULT_HEIGHT(){return 200}executePluginBar(e){this._$screenX=e.screenX,this._$screenY=e.screenY,this._$moveModal||(this._$moveModal=this.moveModal.bind(this)),this._$endModal||(this._$endModal=this.endModal.bind(this)),window.addEventListener("mousemove",this._$moveModal),window.addEventListener("mouseup",this._$endModal)}moveModal(e){const t=document.getElementById("plugin-modal");t.style.left=`${t.offsetLeft+(e.screenX-this._$screenX)}px`,t.style.top=`${t.offsetTop+(e.screenY-this._$screenY)}px`,this._$screenX=e.screenX,this._$screenY=e.screenY}endModal(){d.$setCursor("auto"),window.removeEventListener("mousemove",this._$moveModal),window.removeEventListener("mouseup",this._$endModal)}executePluginHideIcon(){window.nt.hidePanel()}}d.$pluginPanel=new ie;d.$referenceController=new class extends ee{constructor(){super("reference"),this._$pointer=null}initialize(){super.initialize(),this._$pointer={x:0,y:0};const e=["transform-reference-x","transform-reference-y"];for(let t=0;t<e.length;++t)this.setInputEvent(document.getElementById(e[t]));const t=document.getElementById("reference-point");t&&t.addEventListener("dblclick",(e=>{e.stopPropagation(),this.resetPointer()}));const a=document.getElementById("reference-setting-box");if(a){const e=a.getElementsByClassName("reference-setting-box-child");for(let t=0;t<e.length;++t){e[t].addEventListener("mousedown",(e=>{e.stopPropagation(),this.moveNineReferencePoint(e)}))}}}get pointer(){return this._$pointer}moveNineReferencePoint(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const a=+document.getElementById("object-width").value,r=+document.getElementById("object-height").value;let s=0,i=0;switch(e.target.dataset.position){case"top-left":s=-a/2,i=-r/2;break;case"top-center":i=-r/2;break;case"top-right":s=a/2,i=-r/2;break;case"center-left":s=-a/2;break;case"center-right":s=a/2;break;case"bottom-left":s=-a/2,i=r/2;break;case"bottom-center":i=r/2;break;case"bottom-right":s=a/2,i=r/2}if(t.length>1)this._$pointer.x=s,this._$pointer.y=i;else{const e=t[0],a=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId).getCharacter(0|e.dataset.characterId);if(!a)return;a._$referencePoint.x=s,a._$referencePoint.y=i}this.setInputValue(s,i),d.$transformController.relocation()}changeTransformReferenceX(e){e=d.$clamp(+e,-Number.MAX_VALUE,Number.MAX_VALUE);const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return e;if(1===t.length){const a=t[0],r=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);if(!r)return e;r._$referencePoint.x=e}else this._$pointer.x=e;return e}changeTransformReferenceY(e){e=d.$clamp(+e,-Number.MAX_VALUE,Number.MAX_VALUE);const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return e;if(1===t.length){const a=t[0],r=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);if(!r)return e;r._$referencePoint.y=e}else this._$pointer.y=e;return e}resetPointer(){this._$pointer.x=0,this._$pointer.y=0;const e=d.$tools.getDefaultTool("arrow").activeElements;if(e.length){if(1===e.length){const t=e[0],a=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);if(!a)return;a._$referencePoint.x=0,a._$referencePoint.y=0}d.$transformController.relocation()}}setInputValue(e=0,t=0){document.getElementById("transform-reference-x").value=`${e}`,document.getElementById("transform-reference-y").value=`${t}`}};class ne extends ee{constructor(){super("fill-color"),this._$currentPointer=null,this._$viewGradientContext=null,this._$drawGradientContext=null,this._$mouseMoveGradientColorPointer=null,this._$mouseUpGradientColorPointer=null}static get GRADIENT_CANVAS_WIDTH(){return 255}static get GRADIENT_CANVAS_HEIGHT(){return 30}static get MIN_COLOR(){return 0}static get MAX_COLOR(){return 100}static get MIN_ALPHA(){return 0}static get MAX_ALPHA(){return 100}static get MIN_STROKE(){return 1}static get MAX_STROKE(){return 255}static get MIN_GRADIENT_POINTER(){return 0}static get MAX_GRADIENT_POINTER(){return 255}initialize(){super.initialize();const e=document.getElementById("gradient-canvas");if(e){e.style.transform=`scale(${1/window.devicePixelRatio}, ${1/window.devicePixelRatio})`,e.style.backfaceVisibility="hidden",e.style.transformOrigin="0 0";const t=ne.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,a=ne.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio;e.width=t,e.height=a,this._$viewGradientContext=e.getContext("2d");const r=document.createElement("canvas");r.width=t,r.height=a,this._$drawGradientContext=r.getContext("2d")}const t=["fill-alpha-value","fill-stroke-width-value"];for(let e=0;e<t.length;++e)this.setInputEvent(document.getElementById(t[e]));const a=["fill-color-type-select","fill-color-value","fill-bitmap-select"];for(let e=0;e<a.length;++e)this.setChangeEvent(document.getElementById(a[e]));const r=document.getElementById("color-pointer-list");r&&r.addEventListener("mousedown",(e=>{this.setGradientColorPointerEvent(e)}))}removeGradientColorPointer(e){const t=document.getElementById("color-pointer-list");if(t.children.length>2&&d.$hitColor){const a=0|e.target.dataset.index;d.$hitColor.ratios.splice(a,1),e.target.remove();for(let e=a;e<t.children.length;++e){const a=t.children[e],r=(0|a.dataset.index)-1;a.dataset.index=`${r}`}this.updateGradientCanvas(),d.$hitColor.shape.cacheClear(),this.reloadScreen()}}setGradientColorPointerEvent(e){if(!this._$currentPointer||!d.$hitColor)return;const t=document.getElementById("fill-color-value").value,a=0|document.getElementById("fill-alpha-value").value,r=d.$intToRGB(0|`0x${t.slice(1)}`),s={R:r.R,G:r.G,B:r.B,A:a/100*255,ratio:e.offsetX/255};d.$hitColor.ratios.push(s),d.$hitColor.ratios.sort(((e,t)=>{switch(!0){case e.ratio>t.ratio:return 1;case e.ratio<t.ratio:return-1;default:return 0}})),this.initializeGradient(),d.$hitColor.shape.cacheClear(),this.reloadScreen(),this._$currentPointer=e.target.children[d.$hitColor.ratios.indexOf(s)]}changeFillAlphaValue(e){if(e=d.$clamp(0|e,ne.MIN_ALPHA,ne.MAX_ALPHA),d.$hitColor){const{GradientType:t}=window.next2d.display;switch(d.$hitColor.type){case t.LINEAR:case t.RADIAL:this._$currentPointer&&(this._$currentPointer.dataset.alpha=e,d.$hitColor.shape.changeColor(0|this._$currentPointer.dataset.index),this.updateGradientCanvas());break;default:d.$hitColor.shape.changeColor()}}return e}changeFillStrokeWidthValue(e){if(e=d.$clamp(0|e,ne.MIN_STROKE,ne.MAX_STROKE),this._$currentValue!==e&&d.$hitColor){d.$hitColor.shape.changeColor();const{GradientType:e}=window.next2d.display;switch(d.$hitColor.type){case e.LINEAR:case e.RADIAL:this.updateGradientCanvas()}}return e}changeFillColorTypeSelect(e=""){const t=document.getElementById("fill-color-gradient-container"),a=document.getElementById("fill-color-bitmap-container"),r=document.getElementById("fill-color-rgba-container"),s=document.getElementById("fill-stroke-color-rgba-container");switch(e&&(d.$hitColor.shape.bitmapId=0),document.getElementById("fill-color-type-select").value){case"rgba":t.style.display="none",a.style.display="none",r.style.display="",s.style.display=d.$hitColor.width?"":"none";break;case"bitmap":t.style.display="none",a.style.display="",r.style.display="none",s.style.display=d.$hitColor.width?"":"none",this.createBitmapList();break;default:t.style.display="",a.style.display="none",r.style.display="",s.style.display=d.$hitColor.width?"":"none",e||this.initializeGradient()}e&&d.$hitColor.shape.changeStyle(e)}changeFillColorValue(e){if(d.$hitColor)if(this._$currentPointer){const t=this._$currentPointer.getElementsByTagName("i")[0];this._$currentPointer.dataset.color=e,t.style.backgroundColor=e,d.$hitColor.shape.changeColor(0|this._$currentPointer.dataset.index),this.updateGradientCanvas()}else d.$hitColor.shape.changeColor()}changeFillBitmapSelect(e){if(!d.$hitColor)return;const t=d.$currentWorkSpace().getLibrary(0|e);d.$hitColor.shape.bitmapId=t.id,d.$hitColor.shape.cacheClear()}createBitmapList(){const e=document.getElementById("fill-bitmap-select"),t=e.children;for(;t.length;)t[0].remove();const a=document.createElement("option");a.innerHTML="Image Selection",a.defaultSelected=!0,a.disabled=!0,e.appendChild(a);const r=d.$hitColor.shape.bitmapId,s=d.$currentWorkSpace();for(const t of s._$libraries.values()){if("bitmap"!==t.type)continue;const a=document.createElement("option");a.value=t.id,a.innerHTML=t.name,r&&r===t.id&&(a.selected=!0),e.appendChild(a)}}initializeGradient(){if(!d.$hitColor)return;const e=document.getElementById("color-pointer-list").children;for(;e.length;)e[0].remove();const t=d.$hitColor.ratios.length;for(let e=0;e<t;++e){const a=d.$hitColor.ratios[e],r=a.R.toString(16).padStart(2,"0"),s=a.G.toString(16).padStart(2,"0"),i=a.B.toString(16).padStart(2,"0");this.addGradientColorPointer(e,255*a.ratio,`#${r}${s}${i}`,a.A/255*100),e+1===t&&(document.getElementById("fill-color-value").value=`#${r}${s}${i}`,document.getElementById("fill-alpha-value").value=a.A/255*100)}this.updateGradientCanvas()}addGradientColorPointer(e,t,a,r){const s=document.getElementById("color-pointer-list"),i=`\n<div class="color-pointer" style="left: ${t-4}px;" data-index="${e}" data-color="${a}" data-alpha="${r}">\n    <div class="color-pointer-triangle"></div>\n    <div class="color-pointer-rect">\n        <i class="pointer-color" style="background-color: ${a}"></i>\n    </div>\n</div>\n`;s.insertAdjacentHTML("beforeend",i);const n=s.lastElementChild;n.addEventListener("mousedown",(e=>{this.mouseDownGradientColorPointer(e)})),n.addEventListener("dblclick",(e=>{this.removeGradientColorPointer(e)})),this._$currentPointer=n}updateGradientCanvas(){const e=this._$drawGradientContext;e.clearRect(0,0,ne.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,ne.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.beginPath();const t=d.$hitColor.ratios,a=t.length,r=Math.ceil(255*t[a-1].ratio*window.devicePixelRatio),s=e.createLinearGradient(0,0,r,0);for(let e=0;e<a;++e){const a=t[e];s.addColorStop(a.ratio,`rgba(${a.R}, ${a.G}, ${a.B}, ${a.A/255})`)}e.fillStyle=s,e.rect(0,0,ne.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,ne.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),e.fill();const i=this._$viewGradientContext;i.clearRect(0,0,ne.GRADIENT_CANVAS_WIDTH*window.devicePixelRatio,ne.GRADIENT_CANVAS_HEIGHT*window.devicePixelRatio),i.drawImage(e.canvas,0,0)}mouseDownGradientColorPointer(e){e.stopPropagation(),this._$saved=!1,this._$pointX=e.screenX,this._$currentPointer=e.target,document.getElementById("fill-color-value").value=e.target.dataset.color,document.getElementById("fill-alpha-value").value=e.target.dataset.alpha,this._$mouseMoveGradientColorPointer||(this._$mouseMoveGradientColorPointer=this.mouseMoveGradientColorPointer.bind(this)),this._$mouseUpGradientColorPointer||(this._$mouseUpGradientColorPointer=this.mouseUpGradientColorPointer.bind(this)),window.addEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.addEventListener("mouseup",this._$mouseUpGradientColorPointer)}mouseMoveGradientColorPointer(e){const t=this._$currentPointer;t&&window.requestAnimationFrame((()=>{if(!d.$hitColor)return;this.save(),e.preventDefault();const a=parseFloat(t.style.left),r=d.$clamp(a+(e.screenX-this._$pointX)+4,ne.MIN_GRADIENT_POINTER,ne.MAX_GRADIENT_POINTER);t.style.left=r-4+"px",d.$hitColor.ratios[t.dataset.index].ratio=r/255,this._$pointX&&(this._$pointX=e.screenX),this.updateGradientCanvas(),d.$hitColor.shape.cacheClear(),this.reloadScreen()}))}mouseUpGradientColorPointer(){window.removeEventListener("mousemove",this._$mouseMoveGradientColorPointer),window.removeEventListener("mouseup",this._$mouseUpGradientColorPointer),d.$setCursor("auto"),super.focusOut()}}d.$shapeController=new ne;class oe extends ee{constructor(){super("sound")}static get MIN_VOLUME(){return 0}static get MAX_VOLUME(){return 100}static get MIN_LOOP_COUNT(){return 0}static get MAX_LOOP_COUNT(){return 65535}initialize(){super.initialize();const e=document.getElementById("sound-add");e&&e.addEventListener("mousedown",(()=>{const e=document.getElementById("sound-select");e&&e.options.length&&(this.save(),this.addSound(),this._$saved=!1)}))}addSound(e=null,t=0){if(!e){const a=document.getElementById("sound-select"),r=a.options[a.selectedIndex],s=d.$timelineFrame.currentFrame,i=d.$currentWorkSpace().scene;i._$sounds.has(s)||i._$sounds.set(s,[]);const n=i._$sounds.get(s);t=n.length,e={characterId:0|a.value,name:r.textContent,volume:100,loopCount:0,autoPlay:!1},n.push(e),this.setIcon(s)}const a=`\n<div id="sound-id-${t}" class="sound-border">\n    <div class="sound-title">\n      <span id="sound-name-${t}" data-sound-id="${t}">${e.name}</span>\n      <i class="trash" id="sound-trash-${t}" data-sound-id="${t}" data-detail="{{サウンドを削除}}"></i>\n    </div>\n\n    <div class="sound-container">\n        <div class="sound-setting-container">\n            <div class="sound-text">Volume</div>\n            <div><input type="text" id="sound-volume-${t}" data-sound-id="${t}" data-name="volume" value="100" data-detail="{{音量設定}}"></div>\n        \n            <div class="sound-text">Loop<br>Count</div>\n            <div><input type="text" id="sound-loop-count-${t}" data-sound-id="${t}" data-name="loop-count" value="0" data-detail="{{ループ回数}}"></div>\n        </div>\n    </div>\n</div>\n`;document.getElementById("sound-list-area").insertAdjacentHTML("beforeend",a);const r=document.getElementById(`sound-volume-${t}`);r.value=`${e.volume}`,this.setInputEvent(r);const s=document.getElementById(`sound-loop-count-${t}`);s.value=`${e.loopCount}`,this.setInputEvent(s),document.getElementById(`sound-trash-${t}`).addEventListener("click",(e=>{this.save(),this.trash(0|e.target.dataset.soundId),this.createSoundElements(),this._$saved=!1})),d.$addModalEvent(document.getElementById(`sound-id-${t}`))}changeSoundVolume(e){return e=d.$clamp(0|e,oe.MIN_VOLUME,oe.MAX_VOLUME),this.updateSoundProperty("volume",e),e}changeSoundLoopCount(e){return e=d.$clamp(0|e,oe.MIN_LOOP_COUNT,oe.MAX_LOOP_COUNT),this.updateSoundProperty("loopCount",e),e}updateSoundProperty(e,t){if(!this._$currentTarget)return;const a=d.$timelineFrame.currentFrame,r=d.$currentWorkSpace().scene,s=0|this._$currentTarget.dataset.soundId;r._$sounds.get(a)[s][e]=t}setIcon(e){const t=document.getElementById(`frame-label-sound-${e}`);t.classList.contains("frame-border-box-sound")||t.setAttribute("class","frame-border-box-sound")}deleteIcon(e){const t=document.getElementById(`frame-label-sound-${e}`);t&&t.setAttribute("class","frame-border-box")}trash(e){const t=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene,r=a._$sounds.get(t);r.splice(e,1),r.length||(a._$sounds.delete(t),this.deleteIcon(t))}createSoundElements(){const e=document.getElementById("sound-list-area");if(e)for(;e.children.length;)e.children[0].remove();const t=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene;if(a.hasSound(t)){const e=a.getSound(t);for(let t=0;t<e.length;++t)this.addSound(e[t],t)}}}d.$soundController=new oe;class le extends ee{constructor(){super("stage"),this._$stageLock=!1}static get MIN_FPS(){return 1}static get MAX_FPS(){return 60}static get MIN_STAGE_SIZE(){return 1}static get MAX_STAGE_SIZE(){return 3e3}static get MIN_STROKE_SIZE(){return 0}static get MAX_STROKE_SIZE(){return 200}initialize(){super.initialize();const e=document.getElementById("stage-lock");e&&e.addEventListener("mousedown",(e=>{this.stageLock(e)}));const t=["stage-width","stage-height","stage-fps"];for(let e=0;e<t.length;++e)this.setInputEvent(document.getElementById(t[e]));this.setChangeEvent(document.getElementById("stage-bgColor"))}stageLock(e){e.stopPropagation(),this._$stageLock=!this._$stageLock,this._$currentValue=null,e.currentTarget.childNodes[1].setAttribute("class",this._$stageLock?"active":"disable")}changeStageBgColor(e){document.getElementById("stage").style.backgroundColor=e,document.getElementById("library-preview-area").style.backgroundColor=e;d.$currentWorkSpace().stage.bgColor=e}changeStageWidth(e){e=d.$clamp(0|e,le.MIN_STAGE_SIZE,le.MAX_STAGE_SIZE);const t=document.getElementById("stage-area"),a=document.getElementById("stage"),r=d.$currentWorkSpace();return t.style.width=`${e+window.screen.width}px`,a.style.width=`${e}px`,r.stage.width=e,d.$offsetLeft=a.offsetLeft,d.$offsetTop=a.offsetTop,e}changeStageHeight(e){e=d.$clamp(0|e,le.MIN_STAGE_SIZE,le.MAX_STAGE_SIZE);const t=document.getElementById("stage-area"),a=document.getElementById("stage"),r=d.$currentWorkSpace();return t.style.height=`${e+window.screen.height}px`,a.style.height=`${e}px`,r.stage.height=e,d.$offsetLeft=a.offsetLeft,d.$offsetTop=a.offsetTop,e}changeStageFps(e){e=d.$clamp(0|e,le.MIN_FPS,le.MAX_FPS),d.$timelineHeader.create(!0);return d.$currentWorkSpace().stage.fps=e,e}}d.$stageController=new le;d.$tabController=new class{constructor(){this._$active=null,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null);const e=document.getElementById("controller-tab-area");if(e){const t=e.children;for(let e=0;e<t.length;++e){const a=t[e];this._$active||(a.classList.add("active"),this._$active=a),a.addEventListener("click",(e=>{this.mouseDown(e)}))}}const t=document.getElementById("controller-area");if(t){const e=t.children;for(let t=0;t<e.length;++t){const a=e[t];t&&(a.style.display="none")}}d.$initializeEnd()}mouseDown(e){e.stopPropagation(),d.$endMenu(),this._$active.classList.remove("active"),this._$active.classList.add("disable"),e.target.classList.remove("disable"),e.target.classList.add("active"),this._$active=e.target;const t=document.getElementById("controller-area").children;for(let a=0;a<t.length;++a){const r=t[a];r.id===e.target.dataset.tabType?r.style.display="":r.style.display="none"}"controller-area-property"===e.target.dataset.tabType&&this.showController()}showController(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(1!==e.length)return;const t=d.$currentWorkSpace().scene,a=e[0];t.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId).showController()}};class ce extends ee{constructor(){super("text")}static get MIN_SIZE(){return 0}static get MAX_SIZE(){return 255}static get MIN_FONT_SIZE(){return 10}static get MAX_FONT_SIZE(){return 255}static get MIN_STROKE_SIZE(){return 0}static get MAX_STROKE_SIZE(){return 200}initialize(){super.initialize();const e=["font-select","font-style-select","font-align-select","font-wrap-select","font-input-select","font-scroll-select","font-border-select","font-auto-size-select","font-color","font-stroke-color"];for(let t=0;t<e.length;++t)this.setChangeEvent(document.getElementById(e[t]));const t=["font-size","font-stroke-size","font-leading","font-letterSpacing","font-leftMargin","font-rightMargin"];for(let e=0;e<t.length;++e)this.setInputEvent(document.getElementById(t[e]))}changeFontLeading(e){return e=d.$clamp(0|e,ce.MIN_SIZE,ce.MAX_SIZE),this.updateText({name:"leading",value:e}),e}changeFontLetterSpacing(e){return e=d.$clamp(0|e,-ce.MAX_SIZE,ce.MAX_SIZE),this.updateText({name:"letterSpacing",value:e}),e}changeFontLeftMargin(e){return e=d.$clamp(0|e,ce.MIN_SIZE,ce.MAX_SIZE),this.updateText({name:"leftMargin",value:e}),e}changeFontRightMargin(e){return e=d.$clamp(0|e,ce.MIN_SIZE,ce.MAX_SIZE),this.updateText({name:"rightMargin",value:e}),e}changeFontStrokeSize(e){return e=d.$clamp(0|e,ce.MIN_STROKE_SIZE,ce.MAX_STROKE_SIZE),this.updateText({name:"thickness",value:e}),e}changeFontSize(e){return e=d.$clamp(0|e,ce.MIN_FONT_SIZE,ce.MAX_FONT_SIZE),this.updateText({name:"size",value:e}),e}changeFontStrokeColor(e){this.updateText({name:"thicknessColor",value:0|`0x${e.slice(1)}`})}changeFontColor(e){this.updateText({name:"color",value:0|`0x${e.slice(1)}`})}changeFontSelect(e){this.updateText({name:"font",value:e})}changeFontStyleSelect(e){e|=0,this.updateText({name:"fontType",value:d.$clamp(e,0,3)})}changeFontAlignSelect(e){switch(e){case"left":case"center":case"right":this.updateText({name:"align",value:e})}}changeFontWrapSelect(e){switch(0|e){case 0:this.updateText({name:"wordWrap",value:!1}),this.updateText({name:"multiline",value:!1});break;case 1:this.updateText({name:"wordWrap",value:!1}),this.updateText({name:"multiline",value:!0});break;case 2:this.updateText({name:"wordWrap",value:!0}),this.updateText({name:"multiline",value:!0})}}changeFontInputSelect(e){e|=0,this.updateText({name:"inputType",value:e?"input":"static"})}changeFontScrollSelect(e){this.updateText({name:"scroll",value:!!(0|e)})}changeFontBorderSelect(e){this.updateText({name:"border",value:!!(0|e)})}changeFontAutoSizeSelect(e){e|=0,this.updateText({name:"autoSize",value:d.$clamp(e,0,2)})}updateText(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const a=d.$currentWorkSpace(),r=a.scene,s=t[0],i=r.getLayer(0|s.dataset.layerId).getCharacter(0|s.dataset.characterId);a.getLibrary(i.libraryId)[e.name]=e.value,i._$image=null}}d.$textController=new ce;class de extends ee{constructor(){super("transform"),this._$state="hide",this._$sizeLock=!1,this._$scaleLock=!1,this._$screenTargets=["target-rect","scale-top-left","scale-top-right","scale-bottom-left","scale-bottom-right","scale-center-left","scale-center-top","scale-center-right","scale-center-bottom","target-rotation","reference-point"]}static get MIN_SIZE(){return 1}static get MAX_SIZE(){return 3e3}static get MIN_SCALE(){return-32768}static get MAX_SCALE(){return 32767}static get MIN_ROTATE(){return-360}static get MAX_ROTATE(){return 360}initialize(){super.initialize();for(let e=0;e<this._$screenTargets.length;++e){const t=document.getElementById(this._$screenTargets[e]);t&&(t.style.display="none",t.addEventListener("mousedown",(e=>{this.standbyPointer(e)})))}const e=document.getElementById("transform-size-lock");e&&e.addEventListener("mousedown",(e=>{this.sizeLock(e)}));const t=document.getElementById("transform-scale-lock");t&&t.addEventListener("mousedown",(e=>{this.scaleLock(e)}));const a=["object-width","object-height","object-x","object-y","transform-scale-x","transform-scale-y","transform-rotate"];for(let e=0;e<a.length;++e)this.setInputEvent(document.getElementById(a[e]))}changeObjectWidth(e){return e=d.$clamp(+e,de.MIN_SIZE,de.MAX_SIZE),this.updateWidth(e),e}changeObjectHeight(e){return e=d.$clamp(+e,de.MIN_SIZE,de.MAX_SIZE),this.updateHeight(e),e}changeObjectX(e){return e=d.$clamp(+e,de.MIN_SCALE,de.MAX_SCALE),this.updateX(e),e}changeObjectY(e){return e=d.$clamp(+e,de.MIN_SCALE,de.MAX_SCALE),this.updateY(e),e}changeTransformScaleX(e){return e=d.$clamp(+e,de.MIN_SCALE,de.MAX_SCALE),this.updateScaleX(e/100),e}changeTransformScaleY(e){return e=d.$clamp(+e,de.MIN_SCALE,de.MAX_SCALE),this.updateScaleY(e/100),e}changeTransformRotate(e){return 0>(e=d.$clamp((0|e)%360,de.MIN_ROTATE,de.MAX_ROTATE))&&(e+=360),this.updateRotate(e),e}focusIn(e){super.focusIn(e),this.setLockElement(e)}mouseDown(e){super.mouseDown(e),this.setLockElement(e)}setLockElement(e){if(!this._$focus)switch(e.target.id){case"object-width":this._$sizeLock&&(this._$lockTarget=document.getElementById("object-height"));break;case"object-height":this._$sizeLock&&(this._$lockTarget=document.getElementById("object-width"));break;case"transform-scale-x":this._$scaleLock&&(this._$lockTarget=document.getElementById("transform-scale-y"));break;case"transform-scale-y":this._$scaleLock&&(this._$lockTarget=document.getElementById("transform-scale-x"))}}scaleLock(e){e.stopPropagation(),this._$scaleLock=!this._$scaleLock,this._$currentValue=null,e.currentTarget.childNodes[1].setAttribute("class",this._$scaleLock?"active":"disable")}sizeLock(e){e.stopPropagation(),this._$sizeLock=!this._$sizeLock,this._$currentValue=null,e.currentTarget.childNodes[1].setAttribute("class",this._$sizeLock?"active":"disable")}standbyPointer(e){e.stopPropagation();const t=d.$tools.activeTool;t&&(e.transform=!0,t.dispatchEvent(D.MOUSE_DOWN,e))}show(){if("show"!==this._$state){this._$state="show";for(let e=0;e<this._$screenTargets.length;++e){const t=document.getElementById(this._$screenTargets[e]);t&&(t.style.display="")}}return this}hide(){if("hide"!==this._$state){for(let e=0;e<this._$screenTargets.length;++e){const t=document.getElementById(this._$screenTargets[e]);t&&(t.style.display="none")}this._$state="hide"}}relocation(){if("hide"===this._$state)return;const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return this.hide();const t=d.$currentWorkSpace().scene;let a=0,r=Number.MAX_VALUE,s=-Number.MAX_VALUE,i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let o=0;o<e.length;++o){const l=e[o],c=t.getLayer(0|l.dataset.layerId);if(!c||c.lock||c.disable){a++;continue}const d=0|l.dataset.characterId,h=document.getElementById(`character-${d}`);if(!h)continue;const u=h.offsetLeft,m=h.offsetTop;r=Math.min(r,u),s=Math.max(s,u+h.offsetWidth),i=Math.min(i,m),n=Math.max(n,m+h.offsetHeight)}if(e.length-a==0)return this.hide();const o=s-r,l=n-i,c=document.getElementById("reference-point");if(1===e.length){const a=e[0],r=t.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId),s=r.referencePoint;d.$referenceController.setInputValue(s.x,s.y);const i=s.x*d.$zoomScale,n=s.y*d.$zoomScale,o=document.getElementById(`character-${r.id}`);if(!o)return this.hide();const l=o.offsetLeft,h=o.offsetTop,u=o.offsetWidth,m=o.offsetHeight;c.style.left=i+l+u/2-8+"px",c.style.top=n+h+m/2-8+"px"}else{const e=d.$referenceController.pointer,t=e.x*d.$zoomScale,a=e.y*d.$zoomScale;c.style.left=t+r+o/2-8+"px",c.style.top=a+i+l/2-8+"px"}const h=document.getElementById("target-rect");h.style.width=o-2+"px",h.style.height=l-2+"px",h.style.left=`${r}px`,h.style.top=`${i}px`;const u=document.getElementById("scale-top-left");u.style.left=r-5+"px",u.style.top=i-5+"px";const m=document.getElementById("scale-top-right");m.style.left=s-5+"px",m.style.top=i-5+"px";const g=document.getElementById("scale-bottom-left");g.style.left=r-5+"px",g.style.top=n-5+"px";const p=document.getElementById("scale-bottom-right");p.style.left=s-5+"px",p.style.top=n-5+"px";const f=document.getElementById("target-rotation");f.style.left=`${s+5}px`,f.style.top=`${n+5}px`;const $=document.getElementById("scale-center-left");$.style.left=r-5+"px",$.style.top=i+l/2-5+"px";const y=document.getElementById("scale-center-top");y.style.left=r+o/2-5+"px",y.style.top=i-5+"px";const _=document.getElementById("scale-center-right");_.style.left=s-5+"px",_.style.top=i+l/2-5+"px";const b=document.getElementById("scale-center-bottom");b.style.left=r+o/2-5+"px",b.style.top=n-5+"px"}updateX(e){const t=d.$currentWorkSpace().scene,a=d.$timelineFrame.currentFrame,r=d.$tools.getDefaultTool("arrow").activeElements;for(let s=0;s<r.length;++s){const i=r[s],n=0|i.dataset.layerId,o=t.getLayer(n),l=0|i.dataset.characterId,c=o.getCharacter(l);c.x=e,c.relocationTween(a)}this.relocation()}updateY(e){const t=d.$currentWorkSpace().scene,a=d.$timelineFrame.currentFrame,r=d.$tools.getDefaultTool("arrow").activeElements;for(let s=0;s<r.length;++s){const i=r[s],n=0|i.dataset.layerId,o=t.getLayer(n),l=0|i.dataset.characterId,c=o.getCharacter(l);c.y=e,c.relocationTween(a)}this.relocation()}updateWidth(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;e=d.$clamp(e,de.MIN_SIZE,de.MAX_SIZE);const a=d.$currentWorkSpace(),r=a.scene;if(t.length>1){let s=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let e=0;e<t.length;++e){const l=t[e],c=0|l.dataset.layerId,d=r.getLayer(c),h=0|l.dataset.characterId,u=d.getCharacter(h),m=a.getLibrary(u.libraryId).getBounds([1,0,0,1,0,0]);s=Math.min(s,m.xMin),i=Math.max(i,m.xMax),n=Math.min(n,m.yMin),o=Math.max(o,m.yMax)}this.updateScaleX(e/Math.abs(i-s))}else{const s=t[0],i=0|s.dataset.layerId,n=r.getLayer(i),o=0|s.dataset.characterId,l=n.getCharacter(o),c=a.getLibrary(l.libraryId).getBounds([1,0,0,1,0,0]);this.updateScaleX(e/Math.abs(c.xMax-c.xMin)),document.getElementById("transform-scale-x").value=""+100*l.scaleX}}updateScaleX(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;e=d.$clamp(e,de.MIN_SCALE,de.MAX_SCALE);const a=d.$currentWorkSpace(),r=a.scene,s=d.$timelineFrame.currentFrame;let i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MAX_VALUE,l=-Number.MAX_VALUE,c=Number.MAX_VALUE,h=-Number.MAX_VALUE;if(t.length>1){let a=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let e=0;e<t.length;++e){const s=t[e],o=0|s.dataset.layerId,l=r.getLayer(o),c=0|s.dataset.characterId,d=l.getCharacter(c).getBounds();a=Math.min(a,d.xMin),i=Math.max(i,d.xMax),n=Math.min(n,d.yMin),u=Math.max(u,d.yMax)}const m=Math.abs(i-a),g=Math.abs(u-n),p=m/2,f=g/2,$=d.$referenceController.pointer,y=(p+$.x)/m,_=(f+$.y)/g,b=d.$multiplicationMatrix([e,0,0,1,0,0],[1,0,0,1,-p-a-$.x,-f-n-$.y]);for(let e=0;e<t.length;++e){const i=t[e],u=0|i.dataset.layerId,m=r.getLayer(u),g=0|i.dataset.characterId,y=m.getCharacter(g),_=y.getPlace(s),v=d.$multiplicationMatrix(b,_.matrix);_.matrix[0]=v[0],_.matrix[1]=v[1],_.matrix[2]=v[2],_.matrix[3]=v[3],_.matrix[4]=v[4]+p+a+$.x,_.matrix[5]=v[5]+f+n+$.y;const E=y.getBounds();o=Math.min(o,E.xMin),l=Math.max(l,E.xMax),c=Math.min(c,E.yMin),h=Math.max(h,E.yMax),y._$image=null,y.relocationTween(s)}document.getElementById("transform-scale-y").value="100",document.getElementById("transform-scale-x").value="100";const v=Math.abs(l-o),E=Math.abs(h-c);$.x=v*y-v/2,$.y=E*_-E/2}else for(let u=0;u<t.length;++u){const m=t[u],g=0|m.dataset.layerId,p=r.getLayer(g),f=0|m.dataset.characterId,$=p.getCharacter(f),y=$.referencePoint,_=$.getRange(s),b=$.getPlace(s),v=a.getLibrary($.libraryId).createInstance(b,_),E=$.getBounds(),I=Math.abs(E.xMax-E.xMin),S=Math.abs(E.yMax-E.yMin),w=(I/2+y.x)/I,x=(S/2+y.y)/S,L=v.getBounds(),M=L.x+L.width*w,C=L.y+L.height*x,F=[1,0,0,1,-M,-C],k=d.$multiplicationMatrix([b.matrix[0],b.matrix[1],b.matrix[2],b.matrix[3],M,C],F);$.x-=k[4],$.y-=k[5],$.scaleX=e;const A=d.$multiplicationMatrix([b.matrix[0],b.matrix[1],b.matrix[2],b.matrix[3],M,C],F);$.x+=A[4],$.y+=A[5],$._$image=null,i=Math.min(i,$.x),n=Math.min(n,$.y);const T=$.getBounds();o=Math.min(o,T.xMin),l=Math.max(l,T.xMax),c=Math.min(c,T.yMin),h=Math.max(h,T.yMax);const B=Math.abs(l-o),P=Math.abs(h-c);$.referencePoint={x:B*w-B/2,y:P*x-P/2},document.getElementById("transform-scale-x").value=""+100*e,$.relocationTween(s)}document.getElementById("object-x").value=`${i}`,document.getElementById("object-y").value=`${n}`,document.getElementById("object-width").value=`${Math.abs(l-o)}`,document.getElementById("object-height").value=`${Math.abs(h-c)}`}updateHeight(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;e=d.$clamp(e,de.MIN_SIZE,de.MAX_SIZE);const a=d.$currentWorkSpace(),r=a.scene;if(t.length>1){let s=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let e=0;e<t.length;++e){const l=t[e],c=0|l.dataset.layerId,d=r.getLayer(c),h=0|l.dataset.characterId,u=d.getCharacter(h),m=a.getLibrary(u.libraryId).getBounds([1,0,0,1,0,0]);s=Math.min(s,m.xMin),i=Math.max(i,m.xMax),n=Math.min(n,m.yMin),o=Math.max(o,m.yMax)}this.updateScaleY(e/Math.abs(o-n))}else{const s=t[0],i=0|s.dataset.layerId,n=r.getLayer(i),o=0|s.dataset.characterId,l=n.getCharacter(o),c=a.getLibrary(l.libraryId).getBounds([1,0,0,1,0,0]);this.updateScaleY(e/Math.abs(c.yMax-c.yMin)),document.getElementById("transform-scale-y").value=""+100*l.scaleY}}updateScaleY(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;e=d.$clamp(e,de.MIN_SCALE,de.MAX_SCALE);const a=d.$currentWorkSpace(),r=a.scene,s=d.$timelineFrame.currentFrame;let i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MAX_VALUE,l=-Number.MAX_VALUE,c=Number.MAX_VALUE,h=-Number.MAX_VALUE;if(t.length>1){let a=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let e=0;e<t.length;++e){const s=t[e],o=0|s.dataset.layerId,l=r.getLayer(o),c=0|s.dataset.characterId,d=l.getCharacter(c).getBounds();a=Math.min(a,d.xMin),i=Math.max(i,d.xMax),n=Math.min(n,d.yMin),u=Math.max(u,d.yMax)}const m=Math.abs(i-a),g=Math.abs(u-n),p=m/2,f=g/2,$=d.$referenceController.pointer,y=(p+$.x)/m,_=(f+$.y)/g,b=d.$multiplicationMatrix([1,0,0,e,0,0],[1,0,0,1,-p-a-$.x,-f-n-$.y]);for(let e=0;e<t.length;++e){const i=t[e],u=0|i.dataset.layerId,m=r.getLayer(u),g=0|i.dataset.characterId,y=m.getCharacter(g),_=y.getPlace(s),v=d.$multiplicationMatrix(b,_.matrix);_.matrix[0]=v[0],_.matrix[1]=v[1],_.matrix[2]=v[2],_.matrix[3]=v[3],_.matrix[4]=v[4]+p+a+$.x,_.matrix[5]=v[5]+f+n+$.y;const E=y.getBounds();o=Math.min(o,E.xMin),l=Math.max(l,E.xMax),c=Math.min(c,E.yMin),h=Math.max(h,E.yMax),y._$image=null,y.relocationTween(s)}document.getElementById("transform-scale-y").value="100",document.getElementById("transform-scale-x").value="100";const v=Math.abs(l-o),E=Math.abs(h-c);$.x=v*y-v/2,$.y=E*_-E/2}else for(let u=0;u<t.length;++u){const m=t[u],g=0|m.dataset.layerId,p=r.getLayer(g),f=0|m.dataset.characterId,$=p.getCharacter(f),y=$.referencePoint,_=$.getRange(s),b=$.getPlace(s),v=a.getLibrary($.libraryId).createInstance(b,_),E=$.getBounds(),I=Math.abs(E.xMax-E.xMin),S=Math.abs(E.yMax-E.yMin),w=(I/2+y.x)/I,x=(S/2+y.y)/S,L=v.getBounds(),M=L.width*w,C=L.height*x,F=[1,0,0,1,-M,-C],k=d.$multiplicationMatrix([b.matrix[0],b.matrix[1],b.matrix[2],b.matrix[3],M,C],F);$.x-=k[4],$.y-=k[5],$.scaleY=e;const A=d.$multiplicationMatrix([b.matrix[0],b.matrix[1],b.matrix[2],b.matrix[3],M,C],F);$.x+=A[4],$.y+=A[5],$._$image=null,i=Math.min(i,$.x),n=Math.min(n,$.y);const T=$.getBounds();o=Math.min(o,T.xMin),l=Math.max(l,T.xMax),c=Math.min(c,T.yMin),h=Math.max(h,T.yMax);const B=Math.abs(l-o),P=Math.abs(h-c);$.referencePoint={x:B*w-B/2,y:P*x-P/2},document.getElementById("transform-scale-y").value=""+100*e,$.relocationTween(s)}document.getElementById("object-x").value=`${i}`,document.getElementById("object-y").value=`${n}`,document.getElementById("object-width").value=`${Math.abs(l-o)}`,document.getElementById("object-height").value=`${Math.abs(h-c)}`}updateRotate(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;const a=d.$currentWorkSpace(),r=a.scene,s=d.$timelineFrame.currentFrame;let i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MAX_VALUE,l=-Number.MAX_VALUE,c=Number.MAX_VALUE,h=-Number.MAX_VALUE;if(t.length>1){let a=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let e=0;e<t.length;++e){const s=t[e],o=0|s.dataset.layerId,l=r.getLayer(o),c=0|s.dataset.characterId,d=l.getCharacter(c).getBounds();a=Math.min(a,d.xMin),i=Math.max(i,d.xMax),n=Math.min(n,d.yMin),u=Math.max(u,d.yMax)}const m=Math.abs(i-a),g=Math.abs(u-n),p=m/2,f=g/2,$=d.$referenceController.pointer,y=(p+$.x)/m,_=(f+$.y)/g,b=e*d.$Deg2Rad,v=d.$multiplicationMatrix([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0],[1,0,0,1,-p-a-$.x,-f-n-$.y]);for(let e=0;e<t.length;++e){const i=t[e],u=0|i.dataset.layerId,m=r.getLayer(u),g=0|i.dataset.characterId,y=m.getCharacter(g),_=y.getPlace(s),b=d.$multiplicationMatrix(v,_.matrix);_.matrix[0]=b[0],_.matrix[1]=b[1],_.matrix[2]=b[2],_.matrix[3]=b[3],_.matrix[4]=b[4]+p+a+$.x,_.matrix[5]=b[5]+f+n+$.y;const E=y.getBounds();o=Math.min(o,E.xMin),l=Math.max(l,E.xMax),c=Math.min(c,E.yMin),h=Math.max(h,E.yMax),y._$image=null,y.relocationTween(s)}document.getElementById("transform-scale-y").value="100",document.getElementById("transform-scale-x").value="100";const E=Math.abs(l-o),I=Math.abs(h-c);$.x=E*y-E/2,$.y=I*_-I/2}else for(let u=0;u<t.length;++u){const m=t[u],g=0|m.dataset.layerId,p=r.getLayer(g),f=0|m.dataset.characterId,$=p.getCharacter(f);if($.rotation===e)return;const y=$.getRange(s),_=$.getPlace(s),b=a.getLibrary($.libraryId).createInstance(_,y),v=$.referencePoint,E=$.getBounds(),I=Math.abs(E.xMax-E.xMin),S=Math.abs(E.yMax-E.yMin),w=(I/2+v.x)/I,x=(S/2+v.y)/S,L=b.getBounds(),M=L.x+L.width*w,C=L.y+L.height*x,F=[1,0,0,1,-M,-C],k=d.$multiplicationMatrix([_.matrix[0],_.matrix[1],_.matrix[2],_.matrix[3],M,C],F);$.x-=k[4],$.y-=k[5],$.rotation=e;const A=d.$multiplicationMatrix([_.matrix[0],_.matrix[1],_.matrix[2],_.matrix[3],M,C],F);$.x+=A[4],$.y+=A[5],$._$image=null;let T=$.scaleX;Math.atan2(_.matrix[1],_.matrix[0])>=Math.PI&&(T*=-1),document.getElementById("transform-rotate").value=`${e}`,document.getElementById("transform-scale-x").value=""+100*T,document.getElementById("transform-scale-y").value=""+100*$.scaleY,i=Math.min(i,$.x),n=Math.min(n,$.y);const B=$.getBounds();o=Math.min(o,B.xMin),l=Math.max(l,B.xMax),c=Math.min(c,B.yMin),h=Math.max(h,B.yMax);const P=Math.abs(l-o),U=Math.abs(h-c);$.referencePoint={x:P*w-P/2,y:U*x-U/2},$.relocationTween(s)}document.getElementById("object-x").value=`${i}`,document.getElementById("object-y").value=`${n}`,document.getElementById("object-width").value=`${Math.abs(l-o)}`,document.getElementById("object-height").value=`${Math.abs(h-c)}`}}d.$transformController=new de;class he extends ee{constructor(){super("ease"),this._$easeTarget=null,this._$viewContext=null,this._$drawContext=null,this._$moveCurvePointer=null,this._$endMoveCurvePointer=null,this._$moveEasingPointer=null,this._$endMoveEasingPointer=null,this._$deleteEasingPointer=null}static get EASE_CANVAS_WIDTH(){return 300}static get EASE_CANVAS_HEIGHT(){return 400}static get EASE_BASE_CANVAS_SIZE(){return 200}static get EASE_MIN_POINTER_X(){return 6}static get EASE_MIN_POINTER_Y(){return-5}static get EASE_MAX_POINTER_X(){return 306}static get EASE_MAX_POINTER_Y(){return 395}static get EASE_SCREEN_X(){return 57}static get EASE_SCREEN_Y(){return 94}static get EASE_MOVE_Y(){return 294}static get EASE_OFFSET_X(){return 50}static get EASE_OFFSET_Y(){return 100}static get EASE_RANGE(){return 100}initialize(){super.initialize();const e=window.devicePixelRatio,t=document.createElement("canvas");t.width=he.EASE_CANVAS_WIDTH*e,t.height=he.EASE_CANVAS_HEIGHT*e,this._$drawContext=t.getContext("2d");const a=document.getElementById("ease-custom-canvas");a&&(a.width=he.EASE_CANVAS_WIDTH*e,a.height=he.EASE_CANVAS_HEIGHT*e,a.style.transform=`scale(${1/e}, ${1/e})`,a.style.backfaceVisibility="hidden",this._$viewContext=a.getContext("2d"),a.addEventListener("dblclick",(e=>{this.addEasingPointer(e)})));const r=document.getElementById("ease-canvas-view-area");this._$deleteEasingPointer=this.deleteEasingPointer.bind(this),r&&(r.style.display="none",r.addEventListener("mouseleave",(()=>{window.removeEventListener("keydown",this._$deleteEasingPointer)})));const s=["ease-select","ease-custom-file-input"];for(let e=0;e<s.length;++e){const t=document.getElementById(s[e]);t&&t.addEventListener("change",(e=>{e.stopPropagation(),this.executeFunction(e.target.id,e)}))}const i=["ease-custom-data-export","ease-custom-data-load"];for(let e=0;e<i.length;++e){const t=document.getElementById(i[e]);t&&t.addEventListener("click",(e=>{e.stopPropagation(),this.executeFunction(e.target.id,e)}))}}changeEaseCustomDataLoad(e){e.preventDefault();document.getElementById("ease-custom-file-input").click()}changeEaseCustomDataExport(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=e[0],a=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);if(!a)return;const r=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(r.startFrame))return;const s=d.$currentWorkSpace().getLibrary(a.libraryId);if(!s)return;const i=document.createElement("a");i.download=`${s.name}_${r.startFrame}.json`,i.href=URL.createObjectURL(new Blob([JSON.stringify(a.getTween(r.startFrame).custom)],{type:"application/json"})),i.click()}changeEaseCustomFileInput(e){e.target.files[0].text().then((e=>{const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const a=t[0],r=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);if(!r)return;const s=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(s.startFrame))return;r.getTween(s.startFrame).custom=JSON.parse(e),this._$easeTarget=null,this.clearEasingPointer(),this.createEasingPointer(),this.drawEasingGraph(),this.relocationPlace(r,s.startFrame),this.clearPointer().relocationPointer()})),e.target.value=""}addEasingPointer(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const a=t[0],r=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);if(!r)return;const s=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(s.startFrame))return;const i=document.getElementById("ease-cubic-pointer-area"),n=i.children,o=r.getTween(s.startFrame),l=["curve","pointer","curve"],c=[-20,0,20],h=he.EASE_BASE_CANVAS_SIZE/he.EASE_RANGE,u=(e.layerX-he.EASE_BASE_CANVAS_SIZE)/h,m=(he.EASE_BASE_CANVAS_SIZE-(e.layerY-300))/h;for(let e=0;e<l.length;++e){const t=l[e],a=u+c[e],r=m+c[e],s=this.createEasingPointerDiv(a,r,t);i.insertBefore(s,n[n.length-1]),o.custom.splice(-2,0,{type:t,x:a,y:r})}for(let e=0;e<n.length;++e){n[e].dataset.index=`${e+1}`}this._$easeTarget=null,this.drawEasingGraph(),this.relocationPlace(r,s.startFrame),this.clearPointer().relocationPointer()}changeEaseSelect(){const e=d.$timelineLayer.targetFrame;if(!e)return;const t=document.getElementById("ease-select");"custom"===t.value?this.showCustomArea():this.hideCustomArea();const a=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),r=0|e.dataset.frame,s=a.getActiveCharacter(r);if(!s.length&&s.length>1)return;const i=s[0],n=i.getRange(r);i.hasTween(n.startFrame)&&(i.getTween(n.startFrame).method=t.value,i.relocationTween(n.startFrame))}relocationPlace(e,t,a="none"){const r=e.getRange(t);if("none"===a&&r.startFrame-1){const t=e.getRange(r.startFrame-1);e.hasTween(t.startFrame)&&this.relocationPlace(e,t.startFrame,"prev")}e.updateTweenPlace(r.startFrame,r.endFrame);const s=d.$currentWorkSpace().getLibrary(e.libraryId),i=s.createInstance(e.getPlace(t)),n=e.referencePoint,o=i.width/2,l=i.height/2,c=s.getBounds(),h=i.getBounds(),u=[1,0,0,1,-o-h.x-n.x,-l-h.y-n.y],m=e.getPlace(r.startFrame),g=m.matrix,p=Math.sqrt(g[0]*g[0]+g[1]*g[1]),f=Math.sqrt(g[2]*g[2]+g[3]*g[3]);let $=Math.atan2(g[1],g[0])*d.$Rad2Deg;0>$&&($+=360);const y=d.$multiplicationMatrix([g[0],g[1],g[2],g[3],0,0],u),_=g[4]-(y[4]+o+h.x+n.x),b=g[5]-(y[5]+l+h.y+n.y),v=document.getElementById(`tween-marker-${e.id}-${r.startFrame}`);if(v){const e=d.$boundsMatrix(c,g),t=Math.abs(Math.ceil(e.xMax-e.xMin)/2*d.$zoomScale),a=Math.abs(Math.ceil(e.yMax-e.yMin)/2*d.$zoomScale);v.style.left=d.$offsetLeft+e.xMin*d.$zoomScale+t-2+"px",v.style.top=d.$offsetTop+e.yMin*d.$zoomScale+a-2+"px"}let E=r.endFrame-1,I=e.getPlace(E);e.hasTween(r.endFrame)&&(E=r.endFrame,I=e.getPlace(r.endFrame));const S=I.matrix,w=Math.sqrt(S[0]*S[0]+S[1]*S[1]),x=Math.sqrt(S[2]*S[2]+S[3]*S[3]);let L=Math.atan2(S[1],S[0])*d.$Rad2Deg;0>L&&(L+=360);const M=d.$multiplicationMatrix([S[0],S[1],S[2],S[3],0,0],u),C=S[4]-(M[4]+o+h.x+n.x),F=S[5]-(M[5]+l+h.y+n.y),k=document.getElementById(`tween-marker-${e.id}-${E}`);if(k){const e=d.$boundsMatrix(c,S),t=Math.abs(Math.ceil(e.xMax-e.xMin)/2*d.$zoomScale),a=Math.abs(Math.ceil(e.yMax-e.yMin)/2*d.$zoomScale);k.style.left=d.$offsetLeft+e.xMin*d.$zoomScale+t-2+"px",k.style.top=d.$offsetTop+e.yMin*d.$zoomScale+a-2+"px"}const A=e.getTween(r.startFrame),T=A.method,B=E-r.startFrame,P=C-_,U=F-b,D=w-p,O=x-f,X=L-$,Y=m.colorTransform,R=I.colorTransform,N=R[0]-Y[0],z=R[1]-Y[1],j=R[2]-Y[2],W=R[3]-Y[3],G=R[4]-Y[4],H=R[5]-Y[5],Z=R[6]-Y[6],K=R[7]-Y[7],{Easing:V}=window.next2d.ui;let q=1;for(let t=r.startFrame+1;t<E;++t){const a=e.getPlace(t),r=q/B;let s=0;if("custom"===T)for(let e=0;e<A.custom.length;e+=3){const t=A.custom[e+1];let a=A.custom[e+3];if(a.off)for(e+=3;a=A.custom[e+3],!a.fixed&&a.off;)e+=3;if(a.x/he.EASE_RANGE>r){const a=A.custom[e+2];s=this.cubicBezier(t.x/he.EASE_RANGE,t.y/he.EASE_RANGE,a.x/he.EASE_RANGE,a.y/he.EASE_RANGE)(r);break}}const i=a.matrix,m=D?"custom"===T?D*s+p:V[T](q,p,D,B):p,g=O?"custom"===T?O*s+f:V[T](q,f,O,B):f,y=X?"custom"===T?X*s+$:V[T](q,$,X,B)%360:$;let v=Math.atan2(i[1],i[0]),E=Math.atan2(-i[2],i[3]);const I=y*d.$Deg2Rad;if(E=E+I-v,v=I,i[0]=m*Math.cos(v),i[1]=m*Math.sin(v),i[2]=-g*Math.sin(E),i[3]=g*Math.cos(E),i[4]=P?"custom"===T?s*P+_:V[T](q,_,P,B):_,i[5]=U?"custom"===T?s*U+b:V[T](q,b,U,B):b,A.curve.length){const e=Math.sqrt(Math.pow(P,2)+Math.pow(U,2)),t=Math.sqrt(Math.pow(i[4]-_,2)+Math.pow(i[5]-b,2));if(t&&e){const a=this.getCurvePoint(t/e,_,b,C,F,A.curve);a&&(i[4]=a.x,i[5]=a.y)}}const S=d.$multiplicationMatrix([i[0],i[1],i[2],i[3],0,0],u);i[4]+=S[4]+o+h.x+n.x,i[5]+=S[5]+l+h.y+n.y;const w=a.colorTransform;w[0]=N?d.$clamp("custom"===T?N*s+Y[0]:V[T](q,Y[0],N,B),ae.MIN_MULTIPLIER,ae.MAX_MULTIPLIER):Y[0],w[1]=z?d.$clamp("custom"===T?z*s+Y[1]:V[T](q,Y[1],z,B),ae.MIN_MULTIPLIER,ae.MAX_MULTIPLIER):Y[1],w[2]=j?d.$clamp("custom"===T?j*s+Y[2]:V[T](q,Y[2],j,B),ae.MIN_MULTIPLIER,ae.MAX_MULTIPLIER):Y[2],w[3]=W?d.$clamp("custom"===T?W*s+Y[3]:V[T](q,Y[3],W,B),ae.MIN_MULTIPLIER,ae.MAX_MULTIPLIER):Y[3],w[4]=G?d.$clamp("custom"===T?G*s+Y[4]:V[T](q,Y[4],G,B),ae.MIN_OFFSET,ae.MAX_OFFSET):Y[4],w[5]=H?d.$clamp("custom"===T?H*s+Y[5]:V[T](q,Y[5],H,B),ae.MIN_OFFSET,ae.MAX_OFFSET):Y[5],w[6]=Z?d.$clamp("custom"===T?Z*s+Y[6]:V[T](q,Y[6],Z,B),ae.MIN_OFFSET,ae.MAX_OFFSET):Y[6],w[7]=K?d.$clamp("custom"===T?K*s+Y[7]:V[T](q,Y[7],K,B),ae.MIN_OFFSET,ae.MAX_OFFSET):Y[7];const x=document.getElementById(`tween-marker-${e.id}-${t}`);if(x){const e=d.$boundsMatrix(c,i),t=Math.abs(Math.ceil(e.xMax-e.xMin)/2*d.$zoomScale),a=Math.abs(Math.ceil(e.yMax-e.yMin)/2*d.$zoomScale);x.style.left=d.$offsetLeft+e.xMin*d.$zoomScale+t-2+"px",x.style.top=d.$offsetTop+e.yMin*d.$zoomScale+a-2+"px"}q++}const J=m.filter,Q=I.filter;if(J.length&&Q.length){const t=["blurX","blurY","quality","color","alpha","distance","angle","highlightColor","highlightAlpha","shadowColor","shadowAlpha","strength"],a=J.length;for(let s=0;s<a;++s){const a=J[s],i=Q[s];if(a.name!==i.name)continue;let n=1;for(let o=r.startFrame+1;r.endFrame>o;++o){const r=e.getPlace(o).filter;r[s]||(r[s]=new d.$filterClasses[a.name]);const l=r[s];for(let e=0;e<t.length;++e){const r=t[e];if(r in l){const e=i[r]-a[r];if(!e)continue;l[r]="custom"===T?e*customValue+a[r]:V[T](n,a[r],e,B)}}n++}}}e._$image=null}relocationPointer(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;const t=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene;for(let r=0;r<e.length;++r){const s=e[r],i=a.getLayer(0|s.dataset.layerId),n=i.getCharacter(0|s.dataset.characterId);if(!n)continue;const o=n.getRange(t);if(!n.hasTween(o.startFrame))continue;let l=o.startFrame;for(;n.startFrame!==l&&l>1;){const e=n.getRange(l-1);if(!n.hasTween(e.startFrame))break;l=e.startFrame}let c=o.endFrame;for(;n.hasTween(c);)c=n.getTween(c).endFrame;const h=d.$currentWorkSpace().getLibrary(n.libraryId).getBounds(),u=document.getElementById("stage-area");for(let e=l;e<c;++e){const t=document.createElement("div"),a=n.getPlace(e).matrix,r=d.$boundsMatrix(h,a),s=Math.abs(Math.ceil(r.xMax-r.xMin)/2*d.$zoomScale),i=Math.abs(Math.ceil(r.yMax-r.yMin)/2*d.$zoomScale);t.style.left=d.$offsetLeft+r.xMin*d.$zoomScale+s-2+"px",t.style.top=d.$offsetTop+r.yMin*d.$zoomScale+i-2+"px",t.id=`tween-marker-${n.id}-${e}`,t.classList.add("tween-marker"),t.dataset.child="tween",u.appendChild(t)}const m=n.getTween(o.startFrame);for(let e=0;e<m.curve.length;++e){const t=m.curve[e];u.appendChild(this.createTweenCurveElement(t,e,i.id))}}}clearPointer(){const e=document.getElementById("stage-area");let t=0;for(;e.children.length>t;){const a=e.children[t];"tween"===a.dataset.child?a.remove():t++}return this}startMoveCurvePointer(e){e.button||(d.$endMenu(),e.stopPropagation(),this._$currentTarget=e.target,this._$pointX=e.pageX,this._$pointY=e.pageY,this._$moveCurvePointer||(this._$moveCurvePointer=this.moveCurvePointer.bind(this)),this._$endMoveCurvePointer||(this._$endMoveCurvePointer=this.endMoveCurvePointer.bind(this)),this.save(),window.addEventListener("mousemove",this._$moveCurvePointer),window.addEventListener("mouseup",this._$endMoveCurvePointer))}deleteCurvePointer(){const e=this._$currentTarget;if(!e)return;const t=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),a=d.$timelineFrame.currentFrame,r=t.getActiveCharacter(a);if(!r.length||r.length>1)return;const s=r[0],i=s.getRange(a);s.getTween(i.startFrame).curve.splice(0|e.dataset.index,1),e.remove(),this.relocationPlace(s,i.startFrame),this.clearPointer().relocationPointer(),this.save(),this._$saved=!1,this._$currentTarget=null}moveCurvePointer(e){e.preventDefault(),window.requestAnimationFrame((()=>{const t=this._$currentTarget;if(!t)return;const a=(e.pageX-this._$pointX)/d.$zoomScale,r=(e.pageY-this._$pointY)/d.$zoomScale,s=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId),i=d.$timelineFrame.currentFrame,n=s.getActiveCharacter(i);if(!n.length&&n.length>1)return;const o=n[0],l=o.getRange(i);if(!o.hasTween(l.startFrame))return;const c=o.getTween(l.startFrame).curve[t.dataset.index];c.x+=a,c.y+=r,this.relocationPlace(o,l.startFrame),this.clearPointer().relocationPointer(),this.reloadScreen(),this._$pointX=e.pageX,this._$pointY=e.pageY}))}endMoveCurvePointer(){window.removeEventListener("mousemove",this._$moveCurvePointer),window.removeEventListener("mouseup",this._$endMoveCurvePointer),this._$saved=!1}switchingCurvePointer(e){const t=e.target,a=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId),r=d.$timelineFrame.currentFrame,s=a.getActiveCharacter(r);if(!s.length&&s.length>1)return;const i=s[0],n=i.getRange(r);if(!i.hasTween(n.startFrame))return;const o=i.getTween(n.startFrame).curve[t.dataset.index];o.usePoint=!o.usePoint,o.usePoint?(t.classList.remove("tween-pointer-disabled"),t.classList.add("tween-pointer-active")):(t.classList.add("tween-pointer-disabled"),t.classList.remove("tween-pointer-active")),this.relocationPlace(i,n.startFrame),this.clearPointer().relocationPointer(),this.reloadScreen()}createTweenCurveElement(e,t,a){const r=document.createElement("div");r.classList.add("tween-pointer-marker","tween-pointer-disabled");const s=d.$timelineFrame.currentFrame;r.textContent=`${t+1}`,r.dataset.child="tween",r.dataset.curve="true",r.dataset.layerId=`${a}`,r.dataset.index=`${t}`,r.dataset.detail="{{カーブポインター(ダブルクリックでON/OFF)}}";const i=d.$currentWorkSpace().scene.getLayer(a).getActiveCharacter(s);if(!i.length||i.length>1)return null;const n=i[0],o=d.$currentWorkSpace().getLibrary(n.libraryId).getBounds(),l=Math.abs(Math.ceil(o.xMax-o.xMin)/2*d.$zoomScale),c=Math.abs(Math.ceil(o.yMax-o.yMin)/2*d.$zoomScale);return r.style.left=d.$offsetLeft+e.x*d.$zoomScale+l-7+"px",r.style.top=d.$offsetTop+e.y*d.$zoomScale+c-7+"px",e.usePoint?(r.classList.remove("tween-pointer-disabled"),r.classList.add("tween-pointer-active")):(r.classList.add("tween-pointer-disabled"),r.classList.remove("tween-pointer-active")),r.addEventListener("mousedown",(e=>{this.startMoveCurvePointer(e)})),r.addEventListener("dblclick",(e=>{this.switchingCurvePointer(e)})),r.addEventListener("mouseover",d.$fadeIn),r.addEventListener("mouseout",d.$fadeOut),r}createEasingObject(){return[{type:"pointer",fixed:!0,x:0,y:0},{type:"curve",x:0,y:0},{type:"curve",x:100,y:100},{type:"pointer",fixed:!0,x:100,y:100}]}createEasingPointer(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=e[0],a=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);if(!a)return;const r=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(r.startFrame))return;const s=a.getTween(r.startFrame),i=document.getElementById("ease-cubic-pointer-area");for(let e=0;e<s.custom.length;++e){const t=s.custom[e];if(t.fixed)continue;const a=this.createEasingPointerDiv(t.x,t.y,t.type,e);t.off&&a.classList.add("ease-cubic-disable"),i.appendChild(a)}}startMoveEasingPointer(e){this._$easeTarget=e.currentTarget,this._$pointX=e.screenX,this._$pointY=e.screenY,this._$moveEasingPointer||(this._$moveEasingPointer=this.moveEasingPointer.bind(this)),this._$endMoveEasingPointer||(this._$endMoveEasingPointer=this.endMoveEasingPointer.bind(this)),this.save(),window.addEventListener("mousemove",this._$moveEasingPointer),window.addEventListener("mouseup",this._$endMoveEasingPointer),window.removeEventListener("keydown",this._$deleteEasingPointer)}deleteEasingPointer(e){if("Backspace"!==e.key||!this._$easeTarget)return;const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const a=t[0],r=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);if(!r)return;const s=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(s.startFrame))return;const i=r.getTween(s.startFrame),n=0|this._$easeTarget.dataset.index;i.custom.splice(n-1,3);const o=document.getElementById("ease-cubic-pointer-area").children;o[n].remove(),o[n-1].remove(),o[n-2].remove();for(let e=0;e<o.length;++e){o[e].dataset.index=`${e+1}`}this.drawEasingGraph(),this.relocationPlace(r,s.startFrame),this.clearPointer().relocationPointer()}moveEasingPointer(e){window.requestAnimationFrame((()=>{if(!this._$easeTarget)return;const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const a=t[0],r=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);if(!r)return;const s=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(s.startFrame))return;const i=this._$easeTarget;let n=i.offsetLeft+e.screenX-this._$pointX,o=i.offsetTop+e.screenY-this._$pointY;this._$pointX=e.screenX,this._$pointY=e.screenY,he.EASE_MIN_POINTER_Y>o&&(o=he.EASE_MIN_POINTER_Y),he.EASE_MAX_POINTER_Y<o&&(o=he.EASE_MAX_POINTER_Y),he.EASE_MIN_POINTER_X>n&&(n=he.EASE_MIN_POINTER_X),he.EASE_MAX_POINTER_X<n&&(n=he.EASE_MAX_POINTER_X),i.style.left=`${n}px`,i.style.top=`${o}px`;const l=r.getTween(s.startFrame).custom[i.dataset.index],c=he.EASE_BASE_CANVAS_SIZE/he.EASE_RANGE;l.x=(n-he.EASE_SCREEN_X)/c,l.y=(he.EASE_MOVE_Y-o)/c,document.getElementById("ease-cubic-current-text").textContent=`(${l.x/he.EASE_RANGE*100|0})`,document.getElementById("ease-cubic-current-tween").textContent=`(${l.y/he.EASE_RANGE*100|0})`,this.drawEasingGraph(),this.relocationPlace(r,s.startFrame),this.clearPointer().relocationPointer()}))}endMoveEasingPointer(){window.removeEventListener("mousemove",this._$moveEasingPointer),window.removeEventListener("mouseup",this._$endMoveEasingPointer),window.addEventListener("keydown",this._$deleteEasingPointer),this._$saved=!1}disabledEasingPointer(e){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length||t.length>1)return;const a=t[0],r=d.$currentWorkSpace().scene.getLayer(0|a.dataset.layerId).getCharacter(0|a.dataset.characterId);if(!r)return;const s=r.getRange(d.$timelineFrame.currentFrame);if(!r.hasTween(s.startFrame))return;const i=r.getTween(s.startFrame),n=0|e.target.dataset.index,o=i.custom[n];o.off=!o.off,i.custom[n-1].off=o.off,i.custom[n+1].off=o.off;const l=document.getElementById("ease-cubic-pointer-area").children;o.off?(l[n-2].classList.add("ease-cubic-disable"),l[n-1].classList.add("ease-cubic-disable"),l[n].classList.add("ease-cubic-disable")):(l[n-2].classList.remove("ease-cubic-disable"),l[n-1].classList.remove("ease-cubic-disable"),l[n].classList.remove("ease-cubic-disable")),this._$easeTarget=null,this.drawEasingGraph(),this.relocationPlace(r,s.startFrame),this.clearPointer().relocationPointer()}createEasingPointerDiv(e=0,t=0,a="pointer",r=0){const s=document.createElement("div");s.addEventListener("mousedown",(e=>{this.startMoveEasingPointer(e)})),"pointer"===a&&s.addEventListener("dblclick",(e=>{this.disabledEasingPointer(e)})),s.classList.add(`ease-cubic-${a}`),s.dataset.index=`${r}`,s.dataset.type=`${a}`;const i=he.EASE_BASE_CANVAS_SIZE/he.EASE_RANGE;return s.style.left=`${he.EASE_SCREEN_X+e*i}px`,s.style.top=`${he.EASE_SCREEN_Y+(he.EASE_RANGE-t)*i}px`,s}drawEasingGraph(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length||e.length>1)return;const t=e[0],a=d.$currentWorkSpace().scene.getLayer(0|t.dataset.layerId).getCharacter(0|t.dataset.characterId);if(!a)return;const r=a.getRange(d.$timelineFrame.currentFrame);if(!a.hasTween(r.startFrame))return;const s=a.getTween(r.startFrame),i=window.devicePixelRatio,n=he.EASE_OFFSET_X*i,o=he.EASE_OFFSET_Y*i,l=this._$drawContext;l.fillStyle="rgb(240, 240, 240)";const c=he.EASE_BASE_CANVAS_SIZE*i;l.setTransform(1,0,0,1,0,0),l.clearRect(0,0,l.canvas.width,l.canvas.height),l.fillRect(n,o,c,c),l.lineCap="round",l.translate(n,o),l.beginPath(),l.strokeStyle="rgba(200, 200, 200, 0.6)",l.lineWidth=10,l.moveTo(0,0),l.lineTo(c,c),l.stroke();const h=he.EASE_BASE_CANVAS_SIZE/he.EASE_RANGE*i;for(let e=0;e<s.custom.length;e+=3){const t=s.custom[e],a=s.custom[e+1];let r=s.custom[e+2],i=s.custom[e+3];if(i.off)for(e+=3;r=s.custom[e+2],i=s.custom[e+3],!i.fixed&&i.off;)e+=3;if(l.beginPath(),l.strokeStyle="rgb(160, 160, 160)",l.lineWidth=3,l.moveTo(t.x*h,t.y*h),l.lineTo(a.x*h,a.y*h),l.stroke(),l.beginPath(),l.strokeStyle="rgb(160, 160, 160)",l.lineWidth=3,l.moveTo(i.x*h,i.y*h),l.lineTo(r.x*h,r.y*h),l.stroke(),l.beginPath(),l.strokeStyle="rgb(80, 80, 80)",l.lineWidth=10,l.moveTo(t.x*h,t.y*h),l.bezierCurveTo(a.x*h,a.y*h,r.x*h,r.y*h,i.x*h,i.y*h),l.stroke(),i.fixed)break}const u=this._$viewContext;u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,l.canvas.width,l.canvas.height),u.scale(1,-1),u.translate(0,-l.canvas.height),u.drawImage(l.canvas,0,0)}getCurvePoint(e,t,a,r,s,i){const n=[];for(let e=0;e<i.length;++e){const t=i[e];t.usePoint&&n.push(t)}if(!n.length)return null;const o=1-e,l=n.length+1;for(let i=0;i<l;++i)t*=o,a*=o,r*=e,s*=e;let c=t+r,d=a+s;for(let t=0;t<n.length;++t){const a=n[t],r=t+1;let s=a.x*l,i=a.y*l;for(let t=0;t<r;++t)s*=e,i*=e;for(let e=0;e<l-r;++e)s*=o,i*=o;c+=s,d+=i}return{x:c,y:d}}cubicBezier(e,t,a,r){const s=3*e,i=3*(a-e)-s,n=1-s-i,o=3*t,l=3*(r-t)-o,c=1-o-l,d=e=>s+e*(2*i+3*n*e);return e=>{const t=(e=>{if(e<=0)return 0;if(e>=1)return 1;let t=0,a=0,r=e;for(;Math.abs(r-a)>1e-4&&(a=r,r-=((o=r)*(s+o*(i+o*n))-e)/d(r),t++,!(t>1e3)););var o;return r})(e);return t*(o+t*(l+t*c))}}clearEasingPointer(){const e=document.getElementById("ease-cubic-pointer-area");if(e)for(;e.children.length;)e.children[0].remove()}showCustomArea(){this.clearEasingPointer(),this._$easeTarget=null,document.getElementById("ease-canvas-view-area").style.display="",this.createEasingPointer(),this.drawEasingGraph()}hideCustomArea(){const e=document.getElementById("ease-canvas-view-area");e&&(e.style.display="none")}addCurvePinter(){const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),r=a.getActiveCharacter(t);if(!r.length||r.length>1)return;const s=r[0],i=s.getRange(t);if(!s.hasTween(i.startFrame))return;const n=s.getTween(i.startFrame),o=n.curve.length,l=s.getBounds(),c={usePoint:!0,x:l.xMin,y:l.yMin};n.curve.push(c);const h=this.createTweenCurveElement(c,o,a.id);h&&document.getElementById("stage-area").appendChild(h),this.relocationPlace(s,i.startFrame),this.clearPointer().relocationPointer()}}d.$tweenController=new he;class ue extends ee{constructor(){super("video")}static get MIN_VOLUME(){return 0}static get MAX_VOLUME(){return 100}initialize(){super.initialize();const e=["video-loop-select","video-auto-select"];for(let t=0;t<e.length;++t)this.setChangeEvent(document.getElementById(e[t]));this.setInputEvent(document.getElementById("video-volume"))}changeVideoLoopSelect(e){this.updateVideoProperty("loop",1==(0|e))}changeVideoAutoSelect(e){this.updateVideoProperty("autoPlay",1==(0|e))}changeVideoVolume(e){return e=d.$clamp(0|e,ue.MIN_VOLUME,ue.MAX_VOLUME),this.updateVideoProperty("volume",e),e}updateVideoProperty(e,t){const a=d.$tools.getDefaultTool("arrow").activeElements;if(!a.length)return;const r=a[0];d.$currentWorkSpace().getLibrary(0|r.dataset.libraryId)[e]=t}}d.$videoController=new ue;class me{constructor(){this._$saved=!1,this._$focus=!1,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),d.$initializeEnd()}reloadScreen(){const e=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(e)}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}executeFunction(e){this[`execute${e.target.id.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`](e)}focusIn(){this._$focus=!0,d.$keyLock=!0}focusOut(){this._$focus=!1,this._$saved=!1,d.$keyLock=!1}}class ge extends me{constructor(){super(),this._$editor=null,this._$active=!1,this._$frame=-1,this._$scene=null,this._$screenX=0,this._$screenY=0,this._$mouseMove=null,this._$mouseUp=null}static get SCRIPT_MODAL_WIDTH(){return 620}static get SCRIPT_MODAL_HEIGHT(){return 450}static get SCRIPT_MODAL_BAR_HEIGHT(){return 25}get active(){return this._$active}initialize(){super.initialize(),this.createEditor();const e=["editor-hide-icon","editor-bar"];for(let t=0;t<e.length;++t){const a=document.getElementById(e[t]);a&&a.addEventListener("mousedown",(e=>{e.stopPropagation(),d.$endMenu("editor-modal"),this.executeFunction(e)}))}document.documentElement.style.setProperty("--script-modal-width",`${ge.SCRIPT_MODAL_WIDTH}px`),document.documentElement.style.setProperty("--script-modal-height",`${ge.SCRIPT_MODAL_HEIGHT}px`),document.documentElement.style.setProperty("--script-modal-bar-height",`${ge.SCRIPT_MODAL_BAR_HEIGHT}px`)}createEditor(){if(!("ace"in window))return;this._$editor=ace.edit("editor"),this._$editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this._$editor.setTheme("ace/theme/monokai"),this._$editor.session.setMode("ace/mode/javascript");const e=[{word:"next2d",meta:"window.next2d"},{word:"toString",value:"toString()",meta:"common method"},{word:"namespace",meta:"common property"}],t=Object.keys(window.next2d);for(let a=1;a<t.length;++a){const r=t[a];e.push({word:`next2d.${r}`,meta:`next2d.${r}`});const s=Object.keys(window.next2d[r]);for(let t=0;t<s.length;++t){const a=s[t];e.push({word:a,meta:`next2d.${r}.${a}`});const i=window.next2d[r][a],n=Object.getOwnPropertyDescriptors(i),o=Object.getOwnPropertyNames(i);for(let t=0;t<o.length;++t){const r=o[t];switch(r){case"length":case"prototype":case"toString":case"namespace":case"name":continue}const s=n[r];if("value"in s){const t=s.value.toString().replace(/ |\n/g,"").split("{")[0].split("(")[1];e.push({word:r,value:`${r}()`,meta:`${a}.${r}(${t}`})}else e.push({word:r,meta:`${a}.${r}`})}const l=Object.getOwnPropertyDescriptors(i.prototype),c=Object.getOwnPropertyNames(i.prototype);for(let t=0;t<c.length;++t){const r=c[t];switch(r){case"constructor":case"toString":case"namespace":case"name":continue}if(r.indexOf("_$")>-1)continue;const s=l[r];if("value"in s){const t=s.value.toString().replace(/ |\n/g,"").split("{")[0].split("(")[1];e.push({word:r,value:`${r}()`,meta:`${a}.${r}(${t}`})}else e.push({word:r,meta:`${a}.${r}`})}}}ace.require("ace/ext/language_tools").addCompleter({getCompletions:(t,a,r,s,i)=>{i(null,e.map((e=>({caption:e.word,value:e.value||e.word,meta:e.meta,score:0}))))}});const a=new ResizeObserver((e=>{e.forEach((e=>{const t=e.target,a=parseFloat(document.documentElement.style.getPropertyValue("--script-modal-width")),r=parseFloat(document.documentElement.style.getPropertyValue("--script-modal-height"));a!==t.clientWidth&&document.documentElement.style.setProperty("--script-modal-width",`${t.clientWidth}px`),r!==t.clientHeight&&document.documentElement.style.setProperty("--script-modal-height",`${t.clientHeight+ge.SCRIPT_MODAL_BAR_HEIGHT}px`)})),this._$editor.resize()})),r=document.getElementById("editor-modal");r&&a.observe(r)}executeTimelineScriptAdd(e){this.show(e)}executeContextMenuScriptAdd(e){this.show(e)}executeEditorHideIcon(){this.hide()}executeEditorBar(e){this._$screenX=e.screenX,this._$screenY=e.screenY,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){window.requestAnimationFrame((()=>{const t=document.getElementById("editor-modal");t.style.left=`${parseFloat(t.style.left)+(e.screenX-this._$screenX)}px`,t.style.top=`${parseFloat(t.style.top)+(e.screenY-this._$screenY)}px`,this._$screenX=e.screenX,this._$screenY=e.screenY}))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto")}show(e=null,t=0,a=null){d.$keyLock=!0,this._$active=!0,this._$frame=t||d.$timelineFrame.currentFrame,this._$editor.setValue("",-1),(a=a||d.$currentWorkSpace().scene).hasAction(this._$frame)&&this._$editor.setValue(a.getAction(this._$frame),-1),document.getElementById("editor-title").textContent=`${a.name} / frame[${this._$frame}]`;const r=document.getElementById("editor-modal");e&&(r.style.display="",r.style.left=`${e.pageX+5}px`,r.style.top=e.pageY-r.clientHeight/2+"px"),isNaN(parseFloat(r.style.left))&&(r.style.left="200px",r.style.top=300-r.clientHeight/2+"px"),r.setAttribute("class","fadeIn"),d.$endMenu("editor-modal"),this._$editor.focus()}hide(){this.save(),this._$editor.setValue("",0),this._$frame=-1,this._$scene=null,this._$active=!1,d.$keyLock=!1,d.$endMenu()}save(){if(-1===this._$frame)return;const e=this._$editor.getValue(0),t=document.getElementById(`frame-label-action-${this._$frame}`),a=this._$scene||d.$currentWorkSpace().scene;e?(a.setAction(this._$frame,e.trim()),this._$scene||t.classList.contains("frame-border-box-action")||t.setAttribute("class","frame-border-box-action")):(a.deleteAction(this._$frame),this._$scene||t.setAttribute("class","frame-border-box"))}}d.$javaScriptEditor=new ge;class pe extends me{constructor(){super(),this._$pointY=0,this._$mouseMove=null,this._$mouseUp=null}static get TIMELINE_DEFAULT_SIZE(){return 280}static get TIMELINE_MIN_SIZE(){return 150}initialize(){super.initialize(),document.documentElement.style.setProperty("--timeline-height",`${pe.TIMELINE_DEFAULT_SIZE}px`);const e=document.getElementById("timeline-adjustment");e&&e.addEventListener("mousedown",(e=>{this.mouseDown(e)}))}mouseDown(e){e.preventDefault(),this._$pointY=e.screenY,this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp)}mouseMove(e){d.$setCursor("row-resize"),window.requestAnimationFrame((()=>{const t=this._$pointY-e.screenY,a=0|document.documentElement.style.getPropertyValue("--timeline-height").split("px")[0],r=Math.max(pe.TIMELINE_MIN_SIZE,a+t);document.documentElement.style.setProperty("--timeline-height",`${r}px`),d.$currentWorkSpace()._$timelineHeight=r,this._$pointY=e.screenY}))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto")}}d.$timelineAdjustment=new pe;d.$timelineFrame=new class extends me{constructor(){super(),this._$pointX=0,this._$currentValue=null,this._$currentTarget=null,this._$mouseMove=null,this._$mouseUp=null}get currentFrame(){return 0|document.getElementById("current-frame").value}set currentFrame(e){document.getElementById("current-frame").value=""+(0|e)}initialize(){super.initialize();const e=document.getElementById("current-frame");e&&(e.addEventListener("mouseover",(e=>{this.mouseOver(e)})),e.addEventListener("mouseout",(e=>{this.mouseOut(e)})),e.addEventListener("mousedown",(e=>{this.mouseDown(e)})),e.addEventListener("focusin",(e=>{this.focusIn(e)})),e.addEventListener("focusout",(e=>{this.finishInput(e)})),e.addEventListener("keypress",(e=>{this.finishInput(e)})))}focusIn(e){super.focusIn(),this._$currentValue=+e.target.value,this._$currentTarget=e.target}focusOut(){super.focusOut(),this._$currentValue=null,this._$currentTarget=null}mouseOver(e){switch(e.stopPropagation(),!0){case this._$focus:case null!==this._$currentTarget:case null!==this._$currentValue:return;default:d.$setCursor("ew-resize"),e.target.style.cursor="ew-resize"}}mouseOut(e){e.stopPropagation(),!this._$focus&&this._$currentTarget||(d.$setCursor("auto"),e.target.style.cursor="")}mouseDown(e){this._$focus||(e.preventDefault(),this._$pointX=e.screenX,this._$currentTarget=e.target,this._$currentValue=+e.target.value,d.$setCursor("ew-resize"),this._$mouseMove||(this._$mouseMove=this.mouseMove.bind(this)),this._$mouseUp||(this._$mouseUp=this.mouseUp.bind(this)),d.$timelineLayer.clear(),window.addEventListener("mousemove",this._$mouseMove),window.addEventListener("mouseup",this._$mouseUp))}mouseUp(){window.removeEventListener("mousemove",this._$mouseMove),window.removeEventListener("mouseup",this._$mouseUp),d.$setCursor("auto"),this._$currentTarget&&(this._$currentTarget.style.cursor="",this._$currentTarget.focus())}mouseMove(e){!this._$focus&&this._$currentTarget&&window.requestAnimationFrame((()=>{if(this._$focus||!this._$currentTarget)return;e.preventDefault(),d.$setCursor("ew-resize");const t=e.screenX-this._$pointX;let a=+this._$currentTarget.value;isNaN(a)&&(a=1);const r=d.$clamp(a+t,1,d.$timelineHeader.lastFrame);this._$currentTarget.value=`${r}`,this._$currentValue=r,this._$pointX=e.screenX,this.moveTimeline(),this.reloadScreen()}))}finishInput(e){if("Enter"!==e.key){if("focusout"===e.type){const t=d.$clamp(0|e.target.value,1,d.$timelineHeader.lastFrame);e.target.value=`${t}`,this.moveTimeline(),this.focusOut(),this.reloadScreen()}}else e.currentTarget.blur()}moveTimeline(){d.$timelineMarker.move();const e=d.$timelineFrame.currentFrame*(d.$timelineTool.timelineWidth+1),t=document.getElementById("timeline-controller-base");switch(!0){case e>t.scrollLeft+t.offsetWidth:d.$timelineLayer.moveTimeLine(e-(d.$timelineTool.timelineWidth+1));break;case t.scrollLeft>=e:{const a=t.offsetWidth/(d.$timelineTool.timelineWidth+1)|0;d.$timelineLayer.moveTimeLine(e-a*(d.$timelineTool.timelineWidth+1))}}}};d.$timelineHeader=new class extends me{constructor(){super(),this._$lastFrame=0,this._$scrollX=0,this._$targetElement=null,this._$deleteIcon=null}get scrollX(){return this._$scrollX}set scrollX(e){this._$scrollX=0|e}get lastFrame(){return this._$lastFrame}set lastFrame(e){this._$lastFrame=0|e}initialize(){super.initialize(),this._$deleteIcon||(this._$deleteIcon=this.deleteIcon.bind(this));const e=document.getElementById("timeline-controller-base");e&&(e.addEventListener("wheel",(e=>{if(e.stopPropagation(),e.preventDefault(),d.$ctrlKey){const t=0|e.deltaY;if(!t)return!1;d.$timelineTool.timelineWidth=d.$clamp(d.$timelineTool.timelineWidth+t,5,240)}else{const t=0|(e.deltaX||e.deltaY);if(!t)return!1;const a=e.currentTarget.scrollWidth-e.currentTarget.offsetWidth;this._$scrollX=d.$clamp(this._$scrollX+t,0,a),d.$timelineLayer.moveTimeLine(this._$scrollX)}}),{passive:!1}),e.addEventListener("mouseleave",(()=>{this.clearParams(),window.removeEventListener("keydown",this._$deleteIcon)})),e.addEventListener("mouseover",(()=>{window.addEventListener("keydown",this._$deleteIcon)})))}clearParams(){this._$targetElement=null}create(e=!1){const t=document.getElementById("timeline-header");if(!t)return;if(e)for(this.lastFrame=0,this._$scrollX=0,this.clearParams(),d.$timelineMarker.move(),d.$timelineLayer.moveTimeLine(0);t.children.length;)t.children[0].remove();const a=document.getElementById("timeline-header"),r=e?0:a.scrollWidth,s=0|document.getElementById("stage-fps").value;let i=this.lastFrame+1,n=Math.max(1,1+(i/24|0)),o=Math.ceil(2.5*window.parent.screen.width+d.$currentWorkSpace().scene.totalFrame*($e.DEFAULT_TIMELINE_WIDTH+1))-r;for(;;){const e=`\n<div class="frame-header-parent" data-frame="${i}">\n    <div class="frame-sec ${i%5==0?"frame-border-end":"frame-border"}" data-frame="${i}">${i%s==0&&s>4?n+++"s":""}</div>\n    <div id="frame-label-marker-${i}" class="frame-border-box" data-type="marker" data-frame="${i}"></div>\n    <div id="frame-label-action-${i}" class="frame-border-box" data-type="action" data-frame="${i}"></div>\n    <div id="frame-label-sound-${i}" class="frame-border-box" data-type="sound" data-frame="${i}"></div>\n    <div class="frame-number" data-frame="${i}">${i%5==0?i:""}</div>\n</div>\n`;t.insertAdjacentHTML("beforeend",e),t.lastElementChild.addEventListener("mousedown",(e=>{this.moveMarker(e)}));const a=["marker","action","sound"];for(let e=0;e<a.length;++e){const t=document.getElementById(`frame-label-${a[e]}-${i}`);t&&(t.addEventListener("mousedown",(e=>{this.dragIcon(e)})),t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(e=>{this.dropIcon(e)})))}if(o-=$e.DEFAULT_TIMELINE_WIDTH+1,0>=o)break;o>0&&i++}this.lastFrame=i}dragIcon(e){const t=e.target;t.classList.contains("frame-border-box")||(e.stopPropagation(),t.draggable=!0,this._$targetElement=t)}deleteIcon(e){if(d.$keyLock)return;if("Backspace"!==e.key)return;if(!this._$targetElement)return;this.save();const t=0|this._$targetElement.dataset.frame,a=d.$currentWorkSpace().scene;switch(this._$targetElement.dataset.type){case"marker":a.deleteLabel(t);break;case"action":a.deleteAction(t);break;case"sound":a.deleteSound(t)}this._$targetElement.setAttribute("class","frame-border-box"),this._$targetElement=null,super.focusOut()}dropIcon(e){if(!this._$targetElement)return;e.preventDefault(),this._$targetElement.draggable=!1;const t=e.target,a=0|this._$targetElement.dataset.frame,r=0|t.dataset.frame;if(a!==r){this.save();const e=d.$currentWorkSpace().scene,t=this._$targetElement.dataset.type,s=document.getElementById(`frame-label-${t}-${r}`);switch(s.setAttribute("class",`frame-border-box-${t}`),t){case"marker":e.setLabel(r,e.gerLabel(a));break;case"action":e.setAction(r,e.getAction(a));break;case"sound":e.setSound(r,e.getSound(a))}d.$altKey||this.deleteIcon({key:"Backspace"}),this._$targetElement=s}super.focusOut()}moveMarker(e){e.stopPropagation(),this.clearParams(),d.$timelineFrame.currentFrame=0|e.target.dataset.frame,d.$timelineMarker.move(),d.$soundController.createSoundElements(),d.$timelineMarker.startMarker()}};class fe{static get color(){const e=["#ef857d","#ffedab","#a3d6cc","#8d93c8","#e3acae","#ea5550","#00947a","#4d4398","#915da3","#ed6d35","#bd6856","#72640c","#98605e","#6c3524","#f8f4e6","#6a1917","#7f1184","#00afcc","#e3e548","#af0082","#0073a8","#e4007f"];return e[Math.random()*e.length|0]}}d.$timelineKeyboardCommand=new class extends O{constructor(){super("timeline")}initialize(){super.initialize();const e=document.getElementById("timeline");e&&(e.addEventListener("mouseleave",(()=>{this.active=!1})),e.addEventListener("mouseover",(()=>{this.active||(this.active=!0)}))),this.add(d.$generateShortcutKey("+",{ctrl:!0}),this.addLayer),this.add(d.$generateShortcutKey(";",{ctrl:!0}),this.addLayer),this.add(d.$generateShortcutKey("Backspace",{ctrl:!0}),this.deleteLayer),this.add("Backspace",this.removeFrameCharacter),this.add("ArrowDown",this.selectLayer),this.add("ArrowUp",this.selectLayer),this.add("ArrowLeft",this.moveFrame),this.add("ArrowRight",this.moveFrame),this.add("f",this.addFrame),this.add(d.$generateShortcutKey("f",{ctrl:!0}),this.deleteFrame),this.add("k",this.addKeyFrame),this.add(d.$generateShortcutKey("k",{ctrl:!0}),this.deleteKeyFrame),this.add("l",this.focusLabel),this.add("e",this.addEmptyKey),this.add("s",this.openScriptModal),this.add("v",this.activePropertyTab),this.add("z",this.focusZoom),this.add("p",d.$timelineTool.executeTimelinePreview),this.add("o",(()=>{d.$timelineTool.executeTimelineOnionSkin()})),this.add("m",(()=>{d.$timelineMenu.executeContextMenuTweenAdd()})),this.add(d.$generateShortcutKey("m",{ctrl:!0}),(()=>{d.$timelineMenu.executeContextMenuTweenDelete()})),this.add(d.$generateShortcutKey("h",{shift:!0}),(()=>{d.$timelineTool.executeTimelineLayerLightAll()})),this.add(d.$generateShortcutKey("l",{shift:!0}),(()=>{d.$timelineTool.executeTimelineLayerLockAll()})),this.add(d.$generateShortcutKey("d",{shift:!0}),(()=>{d.$timelineTool.executeTimelineLayerDisableAll()})),this.add(d.$generateShortcutKey("n",{shift:!0}),(()=>{d.$timelineLayerMenu.executeTimelineLayerNormal()})),this.add(d.$generateShortcutKey("m",{shift:!0}),(()=>{d.$timelineLayerMenu.executeTimelineLayerMask()})),this.add(d.$generateShortcutKey("g",{shift:!0}),(()=>{d.$timelineLayerMenu.executeTimelineLayerGuide()}))}activePropertyTab(){document.getElementById("controller-tab-area").children[0].click()}openScriptModal(){d.$javaScriptEditor.show()}focusZoom(){document.getElementById("timeline-scale").focus()}focusLabel(){document.getElementById("label-name").focus()}deleteFrame(){d.$timelineTool.executeTimelineFrameDelete()}addFrame(){d.$timelineTool.executeTimelineFrameAdd()}moveFrame(e){const t=d.$timelineLayer.targetLayer;if(!t)return;const a=e?"ArrowRight"===e?1:-1:0,r=Math.max(1,Math.min(d.$timelineFrame.currentFrame+a,d.$timelineHeader.lastFrame));d.$tools.getDefaultTool("arrow").clear(),d.$timelineLayer.changeLabel(r),d.$timelineLayer.moveFrame(r),d.$timelineLayer.activeLayer(t),d.$timelineMarker.moveVisibleLocation()}selectLayer(e){let t=null;const a=document.getElementById("timeline-content"),r=d.$timelineLayer.targetLayer;if(r)if("ArrowDown"===e){if(t=r.nextElementSibling,!t)return;t.offsetTop+t.offsetHeight>window.innerHeight&&(a.scrollTop+=t.offsetHeight)}else{if(t=r.previousElementSibling,!t)return;a.offsetTop+a.scrollTop>=t.offsetTop&&(a.scrollTop-=t.offsetHeight)}else"ArrowDown"===e?(t=a.firstElementChild,a.scrollTop=0):(t=a.lastElementChild,a.scrollTop=a.scrollHeight);d.$timelineLayer.activeLayer(t)}deleteLayer(){d.$timelineTool.executeTimelineLayerTrash()}removeFrameCharacter(){d.$timelineLayer.removeFrame()}addLayer(){d.$timelineTool.executeTimelineLayerAdd()}addEmptyKey(){d.$timelineTool.executeTimelineEmptyAdd()}addKeyFrame(){d.$timelineTool.executeTimelineKeyAdd()}deleteKeyFrame(){d.$timelineTool.executeTimelineKeyDelete()}};d.$timelineLayer=new class extends me{constructor(){super(),this._$targetFrames=new Map,this._$activeKeyEvent=!1,this._$targetLayers=new Map,this._$scrollX=0,this._$clientX=0,this._$clientY=0,this._$moveLayerId=-1,this._$selectLayerId=-1,this._$destLayer=null,this._$timerId=-1,this._$exitLayer=null,this._$executeMoveLayer=null,this._$moveLayer=null,this._$endInput=null,this._$moveTargetGroup=null,this._$endTargetGroup=null,this._$multiSelect=null,this._$endMultiSelect=null}get targetFrames(){return this._$targetFrames}get targetFrame(){return this.targetFrames.size?this.targetFrames.values().next().value[0]:null}get targetLayers(){return this._$targetLayers}get targetLayer(){return this.targetLayers.size?this.targetLayers.values().next().value:null}set targetLayer(e){switch(!0){case d.$ctrlKey:e&&(this.targetLayers.has(e.id)?(e.classList.remove("active"),this.targetLayers.delete(e.id)):(e.classList.add("active"),this.targetLayers.set(e.id,e)));break;case d.$shiftKey:if(e){const t=this.targetLayer;if(!t||t.id===e.id)return;this.clearActiveLayers(),this.clearActiveFrames();const a=Array.from(document.getElementById("timeline-content").children),r=a.indexOf(t),s=a.indexOf(e),i=Math.min(r,s),n=Math.max(r,s);this.targetLayers.set(t.id,t);for(let e=i;e<=n;++e){const t=a[e];t.classList.add("active"),this.targetLayers.has(t.id)||this.targetLayers.set(t.id,t)}}break;default:this.clearActiveLayers(),this.clearActiveFrames(),e&&(e.classList.add("active"),this.targetLayers.set(e.id,e))}}addTargetFrame(e,t){e|=0,this.targetFrames.has(e)||this.targetFrames.set(e,[]);const a=this.targetFrames.get(e);a.indexOf(t)>-1||(a.push(t),t.classList.add("frame-active"))}initialize(){super.initialize();const e=document.getElementById("timeline");e&&e.addEventListener("mouseover",(()=>{d.$setCursor("auto")}));const t=document.getElementById("timeline-content");t&&t.addEventListener("wheel",(e=>{if(!d.$altKey)return;const t=0|e.deltaY;if(!t)return!1;e.preventDefault(),d.$timelineTool.timelineWidth=d.$clamp(d.$timelineTool.timelineWidth+t,5,240)})),this.hideTargetGroup()}activeCharacter(){if(!this.targetLayers.size)return;const e=d.$tools.getDefaultTool("arrow");e.clearActiveElement(),d.$transformController.hide(),d.$gridController.hide();const t=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene,r=d.$shiftKey;d.$shiftKey=!0;for(const r of this.targetFrames.keys()){const s=a.getLayer(r).getActiveCharacter(t);for(let t=0;t<s.length;++t){const a=s[t],r=document.getElementById(`character-${a.id}`);r&&e.addElement(r,!0)}}d.$shiftKey=r,d.$controller.default(),e.activeElements.length?(e.updateControllerProperty(),d.$transformController.show().relocation(),d.$gridController.show().relocation()):d.$tweenController.clearPointer()}clear(){this.clearActiveLayers(),this.clearActiveFrames()}removeAll(){const e=document.getElementById("timeline-content");for(;e.firstChild;)e.firstChild.remove()}create(e=0,t=-1){let a=e+1;const r=d.$currentWorkSpace().scene,s=-1===t?r._$layerId:t,i=document.getElementById("timeline-content"),n=d.$timelineHeader.lastFrame;let o=document.getElementById(`frame-scroll-id-${s}`);if(!o){i.insertAdjacentHTML("beforeend",`\n<div class="timeline-content-child" id="layer-id-${s}" data-layer-id="${s}">\n\n    <div class="timeline-layer-controller">\n        <i class="timeline-exit-icon" id="timeline-exit-icon-${s}" data-layer-id="${s}"></i>\n        <i class="timeline-exit-in-icon" id="timeline-exit-in-icon-${s}" data-layer-id="${s}"></i>\n        <i class="timeline-layer-icon" id="layer-icon-${s}" data-layer-id="${s}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-mask-icon" id="layer-mask-icon-${s}" data-layer-id="${s}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-mask-in-icon" id="layer-mask-in-icon-${s}" data-layer-id="${s}"></i>\n        <i class="timeline-guide-icon" id="layer-guide-icon-${s}" data-layer-id="${s}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <i class="timeline-guide-in-icon" id="layer-guide-in-icon-${s}" data-layer-id="${s}" data-detail="{{レイヤー変更(ダブルクリック)}}"></i>\n        <div class="view-text" id="layer-name-${s}" data-layer-id="${s}">layer_${s}</div>\n        <input type="text" class="view-text-input" id="layer-name-input-${s}" data-layer-id="${s}" value="layer_${s}" style="display: none;">\n        <i class="timeline-layer-light-one icon-disable" id="layer-light-icon-${s}" data-click-type="light" data-layer-id="${s}" data-detail="{{レイヤーをハイライト}}"></i>\n        <i class="timeline-layer-disable-one icon-disable" id="layer-disable-icon-${s}" data-click-type="disable" data-layer-id="${s}" data-detail="{{レイヤーを非表示}}"></i>\n        <i class="timeline-layer-lock-one icon-disable" id="layer-lock-icon-${s}" data-click-type="lock" data-layer-id="${s}" data-detail="{{レイヤーをロック}}"></i>\n    </div>\n\n    <div class="timeline-frame-controller" id="frame-scroll-id-${s}">\n        <div class="timeline-frame">\n        </div>\n    </div>\n</div>\n`),o=document.getElementById(`frame-scroll-id-${s}`),document.getElementById(`layer-name-${s}`).addEventListener("dblclick",(e=>{this.showInput(e)})),document.getElementById(`layer-icon-${s}`).addEventListener("dblclick",(e=>{this.showLayerMenu(e)}));const e=document.getElementById(`layer-guide-icon-${s}`);e.addEventListener("dblclick",(e=>{this.showLayerMenu(e)})),e.addEventListener("mouseover",(e=>{this.exitLayer(e)})),e.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const t=document.getElementById(`layer-mask-icon-${s}`);t.addEventListener("dblclick",(e=>{this.showLayerMenu(e)})),t.addEventListener("mouseover",(e=>{this.exitLayer(e)})),t.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const a=document.getElementById(`timeline-exit-icon-${s}`);a.addEventListener("mouseover",(e=>{this.exitLayer(e)})),a.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const n=document.getElementById(`timeline-exit-in-icon-${s}`);n.addEventListener("mouseover",(e=>{this.exitLayer(e)})),n.addEventListener("mouseout",(e=>{this.endExitLayer(e)}));const l=document.getElementById(`layer-id-${s}`);d.$addModalEvent(l),l.addEventListener("mousedown",(e=>{this.selectLayer(e)}));const c=l.getElementsByClassName("timeline-layer-controller")[0];c.addEventListener("mouseover",(e=>{this.activeMoveLayer(e)})),c.addEventListener("mouseout",(e=>{this.inactiveMoveLayer(e)})),c.addEventListener("contextmenu",(e=>{this.showLayerMenu(e)}));const h=l.getElementsByClassName("timeline-frame-controller")[0];h.addEventListener("wheel",(e=>{const t=0|e.deltaX;if(!t)return!1;e.preventDefault();const a=e.currentTarget.scrollWidth-e.currentTarget.offsetWidth;this._$scrollX=d.$clamp(this._$scrollX+t,0,a),this.moveTimeLine(this._$scrollX)}),{passive:!1}),h.addEventListener("mouseover",(e=>{this.showLayerPreview(e)})),h.addEventListener("mouseout",(()=>{this.hideLayerPreview()})),h.addEventListener("mousedown",(e=>{this.selectFrame(e)})),document.getElementById(`layer-light-icon-${s}`).addEventListener("mousedown",(e=>{this.clickLight(e)})),document.getElementById(`layer-disable-icon-${s}`).addEventListener("mousedown",(e=>{this.clickDisable(e)})),document.getElementById(`layer-lock-icon-${s}`).addEventListener("mousedown",(e=>{this.clickLock(e)}));const u=document.getElementById(`frame-scroll-id-${s}`);u.addEventListener("contextmenu",(e=>{d.$timelineMenu.show(e)})),u.scrollLeft=this._$scrollX,r._$layerId++}let l="";for(;n>=a;)l+=`<div class="${a%5!=0?"frame":"frame frame-pointer"}" data-type="${a%5!=0?"frame":"frame-pointer"}" data-frame-state="empty" data-layer-id="${s}" id="${s}-${a}" data-frame="${a++}"></div>`;l&&o.firstElementChild.insertAdjacentHTML("beforeend",l)}removeFrame(){if(!this.targetLayer)return;this.save();let e=!1;const t=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene,r=this.targetFrames;for(const s of r.keys()){const r=a.getLayer(s),i=r.getActiveCharacter(t);if(!i.length)continue;e=!0;let n=null;for(let e=0;e<i.length;++e){const a=i[e];n||(n=a.getRange(t)),a.remove(r)}r.addEmptyCharacter(new $({startFrame:n.startFrame,endFrame:n.endFrame})),r.reloadStyle()}this.clearActiveFrames(),this.activeCharacter(),e&&this.reloadScreen(),super.focusOut()}attachLayer(){if(!this.targetLayer){let e=document.getElementById("timeline-content").children[0];e||(d.$currentWorkSpace().scene.addLayer(),e=document.getElementById("timeline-content").children[0]);const t=d.$shiftKey,a=d.$ctrlKey;d.$shiftKey=!1,d.$ctrlKey=!1,this.targetLayer=e,d.$shiftKey=t,d.$ctrlKey=a}}exitLayer(e){if(-1===this._$moveLayerId)return;const t=0|e.target.dataset.layerId;let a=document.getElementById(`layer-id-${t}`);const r=Array.from(document.getElementById("timeline-content").children),s=d.$currentWorkSpace().scene,i=r.indexOf(a),n=r[i+1];if(n){switch(s.getLayer(0|n.dataset.layerId).mode){case d.LAYER_MODE_MASK_IN:case d.LAYER_MODE_GUIDE_IN:return}}this._$exitLayer=a,document.getElementById(`timeline-exit-icon-${t}`).style.opacity="1",document.getElementById(`timeline-exit-in-icon-${t}`).style.opacity="1"}endExitLayer(e){if(-1===this._$moveLayerId)return;this._$exitLayer=null;const t=0|e.target.dataset.layerId;document.getElementById(`timeline-exit-icon-${t}`).style.opacity="0",document.getElementById(`timeline-exit-in-icon-${t}`).style.opacity="0"}clickLight(e){e.button||(e.stopPropagation(),this.changeType(e.target,"light"))}clickLock(e){e.button||(e.stopPropagation(),this.changeType(e.target,"lock"),d.$transformController.show().relocation())}clickDisable(e){e.button||(e.stopPropagation(),this.changeType(e.target,"disable"),d.$transformController.show(),d.$clearShapePointer(),this.reloadScreen())}changeType(e,t){const a=0|e.dataset.layerId,r=document.getElementById(`layer-id-${a}`),s=d.$currentWorkSpace().scene.getLayer(a);s[t]=!s[t],s[t]?(e.classList.remove("icon-disable"),"light"===t?(e.classList.add("light-icon-active"),r.style.borderBottom=`1px solid ${s.color}`):(e.classList.add("icon-active"),r.classList.add(`${t}-active`))):(e.classList.add("icon-disable"),"light"===t?(e.classList.remove("light-icon-active"),r.style.borderBottom=""):(e.classList.remove("icon-active"),r.classList.remove(`${t}-active`))),"lock"===t&&this.reloadScreen()}showLayerMenu(e){e.preventDefault(),e.stopPropagation();const t=0|e.target.dataset.layerId;this.targetLayer=document.getElementById(`layer-id-${t}`),d.$timelineLayerMenu.show(e)}showInput(e){e.stopPropagation(),d.$keyLock=!0;const t=0|e.target.dataset.layerId,a=document.getElementById(`layer-name-input-${t}`);a.value=e.target.textContent,a.style.display="",a.focus(),e.target.style.display="none",this._$endInput||(this._$endInput=this.endInput.bind(this)),a.addEventListener("focusout",this._$endInput),a.addEventListener("keypress",this._$endInput)}endInput(e){if("Enter"===e.key)return void e.target.blur();if("focusout"!==e.type)return;this.save(),e.stopPropagation();const t=e.target,a=0|t.dataset.layerId;d.$currentWorkSpace().scene.getLayer(a).name=t.value;const r=document.getElementById(`layer-name-${a}`);r.textContent=t.value,r.style.display="",t.style.display="none",t.removeEventListener("focusout",this._$endInput),t.removeEventListener("keypress",this._$endInput),super.focusOut()}moveLayer(e){d.$setCursor("grabbing"),window.requestAnimationFrame((()=>{const t=document.getElementById("timeline-content");e.pageY+20>window.innerHeight&&(t.scrollTop+=e.pageY+20-window.innerHeight),t.scrollTop>0&&t.offsetTop>e.pageY-8&&(t.scrollTop+=e.pageY-t.offsetTop-8)}))}executeMoveLayer(){window.removeEventListener("mousemove",this._$moveLayer),window.removeEventListener("mouseup",this._$executeMoveLayer);let e=null;const t=d.$currentWorkSpace().scene;if(this._$exitLayer){switch(e=t.getLayer(0|this._$exitLayer.dataset.layerId),e.mode){case d.LAYER_MODE_MASK_IN:for(const t of this.targetLayers.values())if(t.id===e.maskId)return this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,void d.$setCursor("auto");break;case d.LAYER_MODE_GUIDE_IN:for(const t of this.targetLayers.values())if(t.id===e.guideId)return this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,void d.$setCursor("auto")}document.getElementById(`timeline-exit-icon-${e.id}`).style.opacity="0",document.getElementById(`timeline-exit-in-icon-${e.id}`).style.opacity="0",this._$destLayer=this._$exitLayer}if(this._$destLayer){this._$destLayer.classList.remove("move-target");const a=t.getLayer(0|this._$destLayer.dataset.layerId);if(null===e)switch(a.mode){case d.LAYER_MODE_MASK:case d.LAYER_MODE_MASK_IN:case d.LAYER_MODE_GUIDE:case d.LAYER_MODE_GUIDE_IN:for(const e of this.targetLayers.values()){switch(t.getLayer(0|e.dataset.layerId).mode){case d.LAYER_MODE_MASK:case d.LAYER_MODE_GUIDE:return this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,void d.$setCursor("auto")}}}this.save();const r=document.getElementById("timeline-content"),s=Array.from(this.targetLayers.values());if(s.length>1){for(let e=0;e<s.length;++e){const a=s[e],r=t.getLayer(0|a.dataset.layerId);switch(r.mode){case d.LAYER_MODE_MASK_IN:{const t=document.getElementById(`layer-id-${r.maskId}`);s.indexOf(t)>-1&&(s.splice(e,1),--e)}break;case d.LAYER_MODE_GUIDE_IN:{const t=document.getElementById(`layer-id-${r.guideId}`);s.indexOf(t)>-1&&(s.splice(e,1),--e)}}}const e=Array.from(r.children);s.sort(((t,a)=>{const r=e.indexOf(t),s=e.indexOf(a);switch(!0){case r>s:return-1;case r<s:return 1;default:return 0}}))}const i=[];for(let n=0;n<s.length;++n){const o=s[n],l=t.getLayer(0|o.dataset.layerId);switch(a.mode){case d.LAYER_MODE_MASK:case d.LAYER_MODE_MASK_IN:e?null!==e.maskId&&e.maskId===l.maskId&&(l.maskId=null,l.mode=d.LAYER_MODE_NORMAL,l.showIcon()):(l.maskId=null===a.maskId?a.id:a.maskId,l.mode=d.LAYER_MODE_MASK_IN,l.showIcon());break;case d.LAYER_MODE_GUIDE:case d.LAYER_MODE_GUIDE_IN:e?null!==e.guideId&&e.guideId===l.guideId&&(l.guideId=null,l.mode=d.LAYER_MODE_NORMAL,l.showIcon()):(l.guideId=null===a.guideId?a.id:a.guideId,l.mode=d.LAYER_MODE_GUIDE_IN,l.showIcon());break;default:switch(l.mode){case d.LAYER_MODE_MASK_IN:l.maskId=null,l.mode=d.LAYER_MODE_NORMAL,l.showIcon();break;case d.LAYER_MODE_GUIDE_IN:l.guideId=null,l.mode=d.LAYER_MODE_NORMAL,l.showIcon()}}switch(i.length&&(i.length=0),l.mode){case d.LAYER_MODE_MASK:{const e=Array.from(r.children);let a=e.indexOf(o);for(;;){const r=e[++a];if(!r)break;if(t.getLayer(0|r.dataset.layerId).mode!==d.LAYER_MODE_MASK_IN)break;i.unshift(r)}}break;case d.LAYER_MODE_GUIDE:{const e=Array.from(r.children);let a=e.indexOf(o);for(;;){const r=e[++a];if(!r)break;if(t.getLayer(0|r.dataset.layerId).mode!==d.LAYER_MODE_GUIDE_IN)break;i.unshift(r)}}}if(r.insertBefore(o,this._$destLayer.nextElementSibling),i.length)for(let e=0;e<i.length;++e)r.insertBefore(i[e],o.nextElementSibling);o.lastElementChild.scrollLeft=this._$destLayer.lastElementChild.scrollLeft}const n=[],o=r.children;for(let e=0;e<o.length;++e)n.push(t.getLayer(0|o[e].dataset.layerId));t.clearLayer();for(let e=0;e<n.length;++e){const a=n[e];t.setLayer(a.id,a)}this.reloadScreen()}else if(this._$moveLayerId!==this._$selectLayerId){const e=document.getElementById(`layer-id-${this._$moveLayerId}`);this.activeLayer(e)}super.focusOut(),this._$selectLayerId=-1,this._$moveLayerId=-1,this._$destLayer=null,this._$exitLayer=null,d.$setCursor("auto")}activeMoveLayer(e){if(this._$destLayer=null,-1===this._$moveLayerId)return;e.stopPropagation();const t=e.currentTarget.parentNode;this.targetLayers.has(t.id)||(this._$destLayer=t,t.classList.add("move-target"))}inactiveMoveLayer(e){-1!==this._$moveLayerId&&this._$destLayer&&(e.stopPropagation(),this._$destLayer.classList.remove("move-target"),this._$destLayer=null)}moveTimeLine(e=0){0>e&&(e=0);const t=document.getElementById("timeline-controller-base"),a=t.scrollWidth-t.offsetWidth;e>a&&(e=a);const r=document.getElementById("timeline-content").children,s=r.length;for(let t=0;t<s;++t)document.getElementById(`frame-scroll-id-${r[t].dataset.layerId}`).scrollLeft=e;t.scrollLeft=e,this._$scrollX=d.$timelineHeader.scrollX=e}showLayerPreview(e){if(!document.getElementById("timeline-preview").classList.contains("timeline-preview-active"))return;const t=0|e.target.dataset.layerId,a=e.target;window.requestAnimationFrame((()=>{const r=d.$currentWorkSpace(),s=0|a.dataset.frame,i=r.scene.getLayer(t),n=d.$currentFrame;d.$currentFrame=s;const o=i.getActiveCharacter(s);if(o.length){clearTimeout(this._$timerId),i.sort(o,s);const t=document.getElementById("timeline-preview-modal"),{Sprite:a,BitmapData:n}=window.next2d.display,{Matrix:l,ColorTransform:c}=window.next2d.geom,d=new a;let h=Number.MAX_VALUE,u=-Number.MAX_VALUE,m=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let e=0;e<o.length;++e){const t=o[e],a=t.getRange(s),i=t.getPlace(s),n=t.getBounds();h=Math.min(h,n.xMin),u=Math.max(u,n.xMax),m=Math.min(m,n.yMin),g=Math.max(g,n.yMax);const p=r.getLibrary(t.libraryId).createInstance(i,a);p.transform.matrix=new l(i.matrix[0],i.matrix[1],i.matrix[2],i.matrix[3],i.matrix[4],i.matrix[5]),p.transform.colorTransform=new c(i.colorTransform[0],i.colorTransform[1],i.colorTransform[2],i.colorTransform[3],i.colorTransform[4],i.colorTransform[5],i.colorTransform[6],i.colorTransform[7]),d.addChild(p)}const p=Math.ceil(Math.abs(u-h)),f=Math.ceil(Math.abs(g-m)),$=Math.min(120/p,120/f),y=window.devicePixelRatio,_=new n(p*$*y,f*$*y,!0,0),b=new l(y,0,0,y,-h*y,-m*y);for(b.scale($,$),_.draw(d,b);t.children.length;)t.children[0].remove();const v=_.toImage();_.dispose(),v.width=v.width/y,v.height=v.height/y,t.appendChild(v),t.style.display="",t.style.left=`${e.pageX+10}px`,t.style.top=e.pageY-t.offsetHeight-10+"px",t.style.backgroundColor=document.getElementById("stage-bgColor").value,t.classList.contains("fadeIn")||t.setAttribute("class","fadeIn")}d.$currentFrame=n}))}hideLayerPreview(){if(!document.getElementById("timeline-preview").classList.contains("timeline-preview-active"))return;const e=document.getElementById("timeline-preview-modal");e.classList.contains("fadeOut")||(this._$timerId=setTimeout((()=>{e.classList.contains("fadeOut")||e.setAttribute("class","fadeOut")}),1e3))}selectLayer(e){if(e.button)return;e.stopPropagation(),d.$endMenu();const t=e.currentTarget;t.classList.contains("active")||this.activeLayer(t),this._$moveLayer||(this._$moveLayer=this.moveLayer.bind(this)),this._$executeMoveLayer||(this._$executeMoveLayer=this.executeMoveLayer.bind(this)),this._$moveLayerId=0|t.dataset.layerId,window.addEventListener("mousemove",this._$moveLayer),window.addEventListener("mouseup",this._$executeMoveLayer)}activeLayer(e){this.clearActiveFrames(),this.targetLayer=e,this._$selectLayerId=0|e.dataset.layerId;const t=d.$timelineFrame.currentFrame;for(const e of this.targetLayers.values()){const a=0|e.dataset.layerId,r=document.getElementById(`${a}-${t}`);this.targetFrames.delete(a),this.addTargetFrame(a,r)}d.$timelineMarker.move(),this.activeCharacter()}selectFrame(e){if(e.button)return;e.stopPropagation(),d.$endMenu();const t=document.getElementById("timeline-preview-modal");t.classList.contains("fadeOut")||t.setAttribute("class","fadeOut");const a=e.target,r=0|a.dataset.frame;this.changeLabel(r);const s=d.$tools.getDefaultTool("arrow");if(a.classList.contains("frame-active")){const t=this.targetFrames.values().next().value;if(!t[0])return;const a=Array.from(document.getElementById("timeline-content").children);let r=a.indexOf(this.targetLayer);if(this.targetFrames.size>1){r=Number.MAX_VALUE;for(const e of this.targetFrames.values())r=Math.min(r,a.indexOf(document.getElementById(`layer-id-${e[0].dataset.layerId}`)))}let s=Number.MAX_VALUE;for(let e=0;e<t.length;++e)s=Math.min(s,0|t[e].dataset.frame);const i=0|a[r].dataset.layerId,n=document.getElementById(`${i}-${s}`),o=document.getElementById("timeline-content"),l=t.length*(d.$timelineTool.timelineWidth+1)-5;this._$clientX=n.offsetLeft-this._$scrollX,this._$clientY=n.offsetTop-o.scrollTop;const c=document.getElementById("target-group");c.style.display="",c.style.width=`${l}px`,c.style.height=31*this.targetFrames.size-5+"px",c.style.left=`${this._$clientX}px`,c.style.top=`${this._$clientY}px`,c.dataset.frame=`${s}`,c.dataset.index=`${r}`;const h=d.$timelineTool.timelineWidth+1;for(;!(this._$clientX+h>e.clientX);)this._$clientX+=h;for(;!(this._$clientY+30>e.clientY);)this._$clientY+=30;this._$endTargetGroup||(this._$endTargetGroup=this.endTargetGroup.bind(this)),this._$moveTargetGroup||(this._$moveTargetGroup=this.moveTargetGroup.bind(this)),window.addEventListener("mousemove",this._$moveTargetGroup),window.addEventListener("mouseup",this._$endTargetGroup)}else{d.$ctrlKey||s.clear();const e=0|a.dataset.layerId;this.targetLayer=document.getElementById(`layer-id-${e}`),this.addTargetFrame(e,a),this._$multiSelect||(this._$multiSelect=this.multiSelect.bind(this)),this._$endMultiSelect||(this._$endMultiSelect=this.endMultiSelect.bind(this)),window.addEventListener("mousemove",this._$multiSelect),window.addEventListener("mouseup",this._$endMultiSelect),a.classList.add("frame-active"),this.moveFrame(r)}}changeLabel(e){const t=document.getElementById("label-name");t.blur(),t.value="";const a=d.$currentWorkSpace().scene.gerLabel(e);a&&(t.value=a)}moveFrame(e){d.$timelineFrame.currentFrame!==e&&(d.$timelineFrame.currentFrame=e,d.$timelineMarker.move(),d.$soundController.createSoundElements(),this.reloadScreen()),this.activeCharacter()}moveTargetGroup(e){window.requestAnimationFrame((()=>{const t=document.getElementById("target-group"),a=this.targetLayer,r=document.getElementById(`frame-scroll-id-${a.dataset.layerId}`),s=d.$timelineTool.timelineWidth+1,i=0|t.dataset.frame,n=0|t.dataset.index;if(e.clientX-this._$clientX>s){if(t.offsetLeft+t.offsetWidth+s>r.offsetLeft+r.offsetWidth){const t=document.getElementById("timeline-controller-base");return void(e.pageX>t.offsetLeft+t.offsetWidth&&t.scrollWidth-t.offsetWidth>t.scrollLeft&&this.moveTimeLine(t.scrollLeft+(d.$timelineTool.timelineWidth+1)))}return t.style.left=`${t.offsetLeft+s}px`,t.dataset.frame=`${i+1}`,void(this._$clientX+=s)}if(this._$clientX-e.clientX>s){if(r.offsetLeft>t.offsetLeft-s){const t=document.getElementById("timeline-controller-base");return void(t.scrollLeft>0&&t.offsetLeft>e.pageX&&this.moveTimeLine(t.scrollLeft-(d.$timelineTool.timelineWidth+1)))}return t.style.left=t.offsetLeft-s+"px",t.dataset.frame=""+(i-1),void(this._$clientX-=s)}if(e.clientY-this._$clientY>30){const e=document.getElementById("timeline-content"),a=Math.min(31*e.children.length,e.offsetHeight);if(t.offsetTop+t.offsetHeight+31>e.offsetTop+a){const a=e.scrollHeight-e.offsetHeight;if(e.scrollTop+31>a){const r=a-e.scrollTop;if(1>r)return;t.style.top=t.offsetTop+r-5+"px",e.scrollTop=a}else e.scrollTop+=31;return}return t.style.top=`${t.offsetTop+31}px`,t.dataset.index=`${n+1}`,void(this._$clientY+=30)}if(this._$clientY-e.clientY>0){const e=document.getElementById("timeline-content");if(e.offsetTop>t.offsetTop-31){if(0>e.scrollTop-31){if(!e.scrollTop)return;t.style.top=t.offsetTop-e.scrollTop+4+"px",e.scrollTop=0}else e.scrollTop-=31;return}t.style.top=t.offsetTop-31+"px",t.dataset.index=""+(n-1),this._$clientY-=30}}))}endTargetGroup(){window.removeEventListener("mousemove",this._$moveTargetGroup),window.removeEventListener("mouseup",this._$endTargetGroup);const e=document.getElementById("target-group"),t=0|e.dataset.frame;let a=0|e.dataset.index;const r=Array.from(document.getElementById("timeline-content").children);this.hideTargetGroup();const s=0|r[a].dataset.layerId,i=0|this.targetLayer.dataset.layerId,n=d.$timelineTool.getFirstFrame();if(s===i&&n===t)return;this.save();const o=d.$currentWorkSpace().scene;for(const[e,s]of this.targetFrames){const i=t+s.length,l=s.slice();l.length>1&&l.sort(((e,t)=>{const a=0|e.dataset.frame,r=0|t.dataset.frame;switch(!0){case a>r:return 1;case a<r:return-1;default:return 0}}));const c=o.getLayer(e),h=0|r[a++].dataset.layerId,u=o.getLayer(h),m=new Map,g=[];let p=null,y=1;for(let e=0;e<l.length;++e){const t=l[e],a=0|t.dataset.frame;if("empty"===t.dataset.frameState){if(p){p.endFrame=a+1;continue}if(m.size){for(const e of m.values()){if(e.endFrame!==y)continue;const t=e.endFrame-1;if(e.hasPlace(t)){const r=e.getPlace(t);r.tweenFrame&&(e.setPlace(a,e.getClonePlace(t)),e.getTween(r.tweenFrame).endFrame=a+1,d.$tweenController.relocationPlace(e,t))}e.endFrame=a+1,y=a+1}continue}p=new $,p.startFrame=a,p.endFrame=a+1}else{const e=c.getActiveCharacter(a);if(e.length){p&&(p.endFrame=a,g.push(p),p=null);for(let t=0;t<e.length;++t){const r=e[t];if(!m.has(r.id)){const e=new f;e.libraryId=r.libraryId,e.startFrame=a,e.endFrame=a+1,e.screenX=r.screenX,e.screenY=r.screenY;const t=r.getClonePlace(a);if(e.setPlace(a,t),t.tweenFrame){const s=r.getCloneTween(t.tweenFrame);s.startFrame=a,s.endFrame=a+1,t.tweenFrame=a,e.setTween(a,s)}m.set(r.id,e),y=Math.max(e.endFrame,y);continue}const s=m.get(r.id);if(r.hasPlace(a)){const e=r.getClonePlace(a);s.setPlace(a,e),e.tweenFrame&&(e.tweenFrame=s.startFrame,s.getTween(e.tweenFrame).endFrame=a+1)}s.endFrame=a+1,y=Math.max(s.endFrame,y)}continue}if(!p){p=new $,p.startFrame=a,p.endFrame=a+1,y=Math.max(p.endFrame,y);continue}p.endFrame=a+1,y=Math.max(p.endFrame,y)}}if(p&&g.push(p),!d.$altKey){const e=n+s.length;for(const t of m.keys()){const a=c.getCharacter(t);for(let r=n;e>r;++r){if(!a.hasPlace(r))continue;const e=a.getRange(r);if(a.hasTween(r)){const e=a.getTween(r);for(let t=e.startFrame;e.endFrame>t;++t)a.deletePlace(t);a.deleteTween(r);const t=r-1;if(t>1&&t>=a.startFrame){const r=a.getPlace(t);if(r.tweenFrame){for(let r=t+1;e.endFrame>r;++r)a.setPlace(r,a.getClonePlace(t));a.getTween(r.tweenFrame).endFrame=e.endFrame,d.$tweenController.relocationPlace(a,t)}}}else{if(a.getPlace(r).tweenFrame)continue}if(a.deletePlace(r),!a._$places.size){if(c.deleteCharacter(t),!c.getActiveEmptyCharacter(r)){const t=c.getActiveEmptyCharacter(r-1);t?t.endFrame=e.endFrame:c.addEmptyCharacter(new $({startFrame:e.startFrame,endFrame:e.endFrame}))}break}if(a.startFrame===r){a.startFrame=e.endFrame;const t=r-1;if(t){const a=c.getActiveCharacter(t);if(a.length)for(let t=0;a.length>t;++t){const r=a[t],s=r.endFrame-1;if(r.hasPlace(s)){const t=r.getPlace(s);if(t.tweenFrame){const a=r.getTween(t.tweenFrame);for(let t=s+1;e.endFrame>t;++t)r.setPlace(t,r.getClonePlace(s));a.endFrame=e.endFrame,d.$tweenController.relocationPlace(r,s)}}r.endFrame=e.endFrame}else{const a=c.getActiveEmptyCharacter(t);a?a.endFrame=e.endFrame:c.addEmptyCharacter(new $({startFrame:e.startFrame,endFrame:e.endFrame}))}}}}}for(let t=0;t<c._$emptys.length;++t){const a=c._$emptys[t];if(!(a.startFrame>e)&&!(n>=a.endFrame))for(let t=n;e>t;++t){if(a.startFrame!==t)continue;const e=a.startFrame-1;if(e){c.deleteEmptyCharacter(a);const t=c.getActiveCharacter(e);if(t.length){for(let e=0;e<t.length;++e){const r=t[e],s=r.endFrame-1;if(r.hasPlace(s)){const e=r.getPlace(s);if(e.tweenFrame){for(let e=s+1;a.endFrame>e;++e)r.setPlace(e,r.getClonePlace(s));r.getTween(e.tweenFrame).endFrame=a.endFrame,d.$tweenController.relocationPlace(r,s)}}r.endFrame=a.endFrame}break}const r=c.getActiveEmptyCharacter(e);r?r.endFrame=a.endFrame:c.addEmptyCharacter(new $({startFrame:1,endFrame:a.endFrame}))}break}}}let _=i;const b=u._$characters.slice();for(let e=0;e<b.length;++e){const a=b[e];if(!(t>a.endFrame)&&!(a.startFrame>=i))if(a.startFrame>=t&&i>=a.endFrame)u.deleteCharacter(a.id);else{const e=a.getRange(i);_=Math.max(e.endFrame,_);for(let e=t;i>e;++e){if(!a.hasPlace(e))continue;const r=a.getPlace(e);if(r.tweenFrame){const s=a.getRange(e);if(a.hasTween(e)){for(let e=s.startFrame;s.endFrame>e;++e)a.deletePlace(e);a.deleteTween(e)}else{for(let e=t;s.endFrame>e;++e)a.deletePlace(e);a.getTween(r.tweenFrame).endFrame=t,d.$tweenController.relocationPlace(a,r.tweenFrame)}}a.deletePlace(e)}if(a._$places.size){if(a.hasPlace(e.endFrame)){const t=a.clone();t.startFrame=e.endFrame,u.addCharacter(t);const r=new Map;for(const[s,i]of t._$places)e.endFrame>s||(a.deletePlace(s),r.set(s,i));const s=new Map;for(const[r,i]of t._$tween)e.endFrame>r||(a.deleteTween(r),s.set(r,i));t._$places=r,t._$tween=s}a.endFrame=t,a.hasTween(e.startFrame)&&(a.getTween(e.startFrame).endFrame=t)}else u.deleteCharacter(a.id)}}const v=u._$emptys.slice();for(let e=0;e<v.length;++e){const a=v[e];t>a.endFrame||(a.startFrame>=i||(_=Math.max(a.endFrame,_),t>a.startFrame?a.endFrame=t:u.deleteEmptyCharacter(a)))}for(const e of m.values()){if(t!==n&&e.move(t-n),e.endFrame===i&&_>i){const t=e.endFrame-1;if(e.hasPlace(t)){const a=e.getPlace(t);if(a.tweenFrame){for(let a=t+1;_>a;++a)e.setPlace(a,e.getClonePlace(t));e.getTween(a.tweenFrame).endFrame=_,d.$tweenController.relocationPlace(e,t)}}e.endFrame=_}u.addCharacter(e)}for(let e=0;e<g.length;++e){const a=g[e];t!==n&&a.move(t-n),a.endFrame===i&&_>i&&(a.endFrame=_),u.addEmptyCharacter(a)}if(t>1){const e=u.getActiveCharacter(t-1),a=u.getActiveEmptyCharacter(t-1);if(!e.length&&!a){let e=null,a=null,r=1;for(;(e=u.getActiveCharacter(t-r),!e.length)&&(a=u.getActiveEmptyCharacter(t-r),!a)&&!(0>=t-r);++r);switch(e.length||(e=null),!0){case null!==e:for(let a=0;a<e.length;++a){const r=e[a],s=r.endFrame-1;if(r.hasPlace(s)){const e=r.getPlace(s);if(e.tweenFrame){for(let e=s+1;t>e;++e)r.setPlace(e,r.getClonePlace(s));r.getTween(e.tweenFrame).endFrame=t}}r.endFrame=t}break;case null!==a:a.endFrame=t;break;default:u.addEmptyCharacter(new $({startFrame:t-r+1,endFrame:t}))}}}for(const e of m.values()){let t=e;const a=e.startFrame-1,r=u.getActiveCharacter(a);for(let a=0;a<r.length;++a){const s=r[a];if(s.libraryId===e.libraryId&&s.endFrame===e.startFrame){t=s;for(const[a,r]of e._$places)t.setPlace(a,r);for(const[a,r]of e._$tween)t.setTween(a,r);t.endFrame=e.endFrame,u.deleteCharacter(e.id);break}}const s=e.endFrame,i=u.getActiveCharacter(s);for(let e=0;e<i.length;++e){const a=i[e];if(a.libraryId===t.libraryId&&a.startFrame===t.endFrame){for(const[e,r]of a._$places)t.setPlace(e,r);for(const[e,r]of a._$tween)t.setTween(e,r);t.endFrame=a.endFrame,u.deleteCharacter(a.id);break}}}h===e?c.reloadStyle():(c.reloadStyle(),u.reloadStyle())}d.$tools.getDefaultTool("arrow").clear(),this.reloadScreen(),this._$saved=!1}clearActiveLayers(){for(const e of this.targetLayers.values())e.classList.remove("active");this.targetLayers.clear()}clearActiveFrames(){for(const e of this._$targetFrames.values())for(let t=0;t<e.length;++t)e[t].classList.remove("frame-active");this.targetFrames.clear(),this.hideTargetGroup()}hideTargetGroup(){const e=document.getElementById("target-group");e&&(e.style.display="none")}multiSelect(e,t=null){const a=e?e.target:t,r=0|a.dataset.frame;if(!r)return;if(!("layerId"in a.dataset))return;const s=this.targetLayer;if(!s)return;e&&(e.stopPropagation(),e.preventDefault());const i=this.targetFrame,n=0|i.dataset.frame,o=0|i.dataset.layerId,l=Math.min(r,n),c=Math.max(r,n)+1,d=[o],h=0|a.dataset.layerId;if(o!==h){const e=Array.from(document.getElementById("timeline-content").children),t=e.indexOf(s),a=e.indexOf(document.getElementById(`layer-id-${h}`));if(a>t){const r=a-t+1;for(let a=1;a<r;++a)d.push(0|e[t+a].dataset.layerId)}else{const r=t-a+1;for(let a=1;a<r;++a)d.push(0|e[t-a].dataset.layerId)}}this.clearActiveFrames();for(let e=0;e<d.length;++e){const t=d[e];for(let e=l;e<c;++e){const a=document.getElementById(`${t}-${e}`);a&&this.addTargetFrame(t,a)}}const u=this.targetFrames.get(o);u.splice(u.indexOf(i),1),u.unshift(i),this.activeCharacter()}endMultiSelect(){d.$setCursor("auto"),window.removeEventListener("mousemove",this._$multiSelect),window.removeEventListener("mouseup",this._$endMultiSelect)}};d.$timelineLayerMenu=new class extends me{initialize(){super.initialize();const e=["timeline-layer-normal","timeline-layer-mask","timeline-layer-guide"];for(let t=0;t<e.length;++t){const a=document.getElementById(e[t]);a&&a.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e)}))}const t=document.getElementById("timeline-layer-color");t&&t.addEventListener("change",(e=>{e.stopPropagation(),this.changeLayerHighlightColor(e)}))}executeTimelineLayerNormal(){d.$endMenu();const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$currentWorkSpace().scene,a=0|e.dataset.layerId,r=t.getLayer(a);if(r.mode===d.LAYER_MODE_NORMAL)return;this.save();const s=this.resetLayer(e);r.mode=d.LAYER_MODE_NORMAL,r.showIcon(),s&&this.reloadScreen(),super.focusOut()}executeTimelineLayerMask(){d.$endMenu();const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId);if(t.mode===d.LAYER_MODE_MASK)return;this.save();const a=this.resetLayer(e);t.mode=d.LAYER_MODE_MASK,t.showIcon(),(a||t.lock)&&this.reloadScreen(),super.focusOut()}executeTimelineLayerGuide(){d.$endMenu();const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId);if(t.mode===d.LAYER_MODE_GUIDE)return;this.save();const a=this.resetLayer(e);t.mode=d.LAYER_MODE_GUIDE,t.showIcon(),a&&this.reloadScreen(),super.focusOut()}changeLayerHighlightColor(e){this.save();const t=0|e.target.dataset.layerId,a=d.$currentWorkSpace().scene.getLayer(t);a.color=e.target.value;document.getElementById(`layer-light-icon-${t}`).style.backgroundImage=`url('${a.getHighlightURL()}')`,a.light&&(document.getElementById(`layer-id-${t}`).style.borderBottom=`1px solid ${a.color}`),super.focusOut(),d.$endMenu()}resetLayer(e){const t=d.$currentWorkSpace().scene,a=t.getLayer(0|e.dataset.layerId),r=Array.from(document.getElementById("timeline-content").children);let s=!1,i=r.indexOf(e);switch(a.mode){case d.LAYER_MODE_MASK:for(;;){const e=r[++i];if(!e)break;const a=t.getLayer(0|e.dataset.layerId);if(a.mode!==d.LAYER_MODE_MASK_IN)break;a.maskId=null,a.mode=d.LAYER_MODE_NORMAL,a.showIcon(),s=!0}break;case d.LAYER_MODE_GUIDE:for(;;){const e=r[++i];if(!e)break;const a=t.getLayer(0|e.dataset.layerId);if(a.mode!==d.LAYER_MODE_GUIDE_IN)break;a.guideId=null,a.mode=d.LAYER_MODE_NORMAL,a.showIcon()}}return s}show(e){e.stopPropagation(),d.$endMenu("timeline-layer-menu");const t=0|e.target.dataset.layerId,a=d.$currentWorkSpace().scene.getLayer(t),r=document.getElementById("timeline-layer-color");r.dataset.layerId=`${t}`,r.value=a.color;const s=document.getElementById("timeline-layer-menu");s.style.left=`${e.pageX+5}px`,s.style.top=e.pageY-s.clientHeight+"px",15>s.offsetTop&&(s.style.top="10px"),e.pageY+15>window.innerHeight&&(s.style.top=e.pageY-s.clientHeight-15+"px"),s.setAttribute("class","fadeIn")}};d.$timelineMarker=new class extends me{constructor(){super(),this._$moveMarker=null,this._$endMarker=null}initialize(){super.initialize();const e=document.getElementById("timeline-marker");e&&e.addEventListener("mousedown",(e=>{this.startMarker(e)}))}startMarker(){d.$tools.getDefaultTool("arrow").clear(),document.getElementById("timeline-marker").style.pointerEvents="none",this._$moveMarker||(this._$moveMarker=this.moveMarker.bind(this)),this._$endMarker||(this._$endMarker=this.endMarker.bind(this)),window.addEventListener("mousemove",this._$moveMarker),window.addEventListener("mouseup",this._$endMarker),document.getElementById("label-name").blur()}moveMarker(e){d.$setCursor("ew-resize"),window.requestAnimationFrame((()=>{const t=document.getElementById("timeline-controller-base");if(e.pageX>t.offsetLeft+t.offsetWidth&&t.scrollWidth-t.offsetWidth>t.scrollLeft){const a=(e.pageX-(t.offsetLeft+t.offsetWidth))/d.$timelineTool.timelineWidth|0;return d.$timelineFrame.currentFrame=d.$clamp(d.$timelineFrame.currentFrame+a,1,d.$timelineHeader.lastFrame-1),this.move(),d.$timelineLayer.moveTimeLine(t.scrollLeft+a*(d.$timelineTool.timelineWidth+1)),void this.reloadScreen()}if(t.scrollLeft>0&&t.offsetLeft>e.pageX){const a=(t.offsetLeft-e.pageX)/d.$timelineTool.timelineWidth|0;return d.$timelineFrame.currentFrame=d.$clamp(d.$timelineFrame.currentFrame-a,1,d.$timelineHeader.lastFrame-1),this.move(),d.$timelineLayer.moveTimeLine(t.scrollLeft-a*(d.$timelineTool.timelineWidth+1)),void this.reloadScreen()}let a=0|e.target.dataset.frame;if(!a)return;d.$timelineFrame.currentFrame!==a&&(d.$timelineFrame.currentFrame=a,this.move(),this.moveVisibleLocation(),this.reloadScreen())}))}moveVisibleLocation(){const e=document.getElementById("timeline-controller-base"),t=document.getElementById("timeline-marker"),a=2*d.$timelineTool.timelineWidth;e.scrollWidth-e.offsetWidth>e.scrollLeft&&t.offsetLeft+a>e.scrollLeft+e.offsetWidth&&d.$timelineLayer.moveTimeLine(e.scrollLeft+d.$timelineTool.timelineWidth+1),e.scrollLeft>0&&e.scrollLeft>t.offsetLeft-a&&d.$timelineLayer.moveTimeLine(e.scrollLeft-(d.$timelineTool.timelineWidth+1))}endMarker(){d.$setCursor("auto"),window.removeEventListener("mousemove",this._$moveMarker),window.removeEventListener("mouseup",this._$endMarker),document.getElementById("timeline-marker").style.pointerEvents="";const e=d.$currentWorkSpace().scene.gerLabel(d.$timelineFrame.currentFrame);document.getElementById("label-name").value=e||""}move(){const e=d.$timelineTool.timelineWidth+1;document.getElementById("timeline-marker").style.left=(d.$timelineFrame.currentFrame-1)*e+"px"}};d.$timelineMenu=new class extends me{initialize(){super.initialize();const e=["context-menu-script-add","context-menu-frame-add","context-menu-key-frame-add","context-menu-empty-key-frame-add","context-menu-frame-delete","context-menu-key-frame-delete","context-menu-tween-add","context-menu-tween-delete","context-menu-frame-copy","context-menu-frame-paste"];for(let t=0;t<e.length;++t){const a=document.getElementById(e[t]);a&&a.addEventListener("mousedown",(e=>{e.stopPropagation(),d.$endMenu(),this.executeFunction(e)}))}}executeContextMenuScriptAdd(){d.$javaScriptEditor.show()}executeContextMenuFrameAdd(){d.$timelineTool.executeTimelineFrameAdd()}executeContextMenuKeyFrameAdd(){d.$timelineTool.executeTimelineKeyAdd()}executeContextMenuKeyFrameDelete(){d.$timelineTool.executeTimelineKeyDelete()}executeContextMenuEmptyKeyFrameAdd(){d.$timelineTool.executeTimelineEmptyAdd()}executeContextMenuFrameDelete(){d.$timelineTool.executeTimelineFrameDelete()}executeContextMenuTweenAdd(){const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),r=a.getActiveCharacter(t);if(!r.length)return;if(r.length>1)return void alert("If you want to add motion tweening to multiple objects, please do so in a single MovieClip.");const s=r[0],i=s.getRange(t);s.hasTween(i.startFrame)||(this.save(),s.setTween(i.startFrame,{method:"linear",curve:[],custom:d.$tweenController.createEasingObject(),startFrame:i.startFrame,endFrame:i.endFrame}),s.updateTweenPlace(i.startFrame,i.endFrame),s.relocationTween(i.startFrame),a.reloadStyle(),s._$image=null,this.reloadScreen(),this._$saved=!1)}executeContextMenuTweenDelete(){const e=d.$timelineLayer.targetLayer;if(!e)return;const t=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene.getLayer(0|e.dataset.layerId),r=a.getActiveCharacter(t);if(!r.length||r.length>1)return;const s=r[0],i=s.getRange(t);if(!s.hasTween(i.startFrame))return;this.save();for(let e=i.startFrame+1;i.endFrame>e;++e)s.hasPlace(e)&&s.deletePlace(e);s.deleteTween(i.startFrame);delete s.getPlace(i.startFrame).tweenFrame,d.$tweenController.clearPointer(),a.reloadStyle(),s._$image=null,this.reloadScreen(),this._$saved=!1}show(e){d.$endMenu("timeline-menu");const t=document.getElementById("timeline-menu");t.style.left=`${e.pageX+5}px`,t.style.top=e.pageY-t.clientHeight+"px",15>t.offsetTop&&(t.style.top="10px"),e.pageY+15>window.innerHeight&&(t.style.top=e.pageY-t.clientHeight-15+"px"),t.setAttribute("class","fadeIn")}};d.$timelinePlayer=new class extends me{constructor(){super(),this._$stopFlag=!0,this._$repeat=!1,this._$totalFrame=0,this._$startTime=0,this._$fps=0,this._$timerId=-1,this._$run=null}get repeat(){return this._$repeat}get stopFlag(){return this._$stopFlag}initialize(){super.initialize();const e=["timeline-play","timeline-stop","timeline-repeat","timeline-no-repeat"];for(let t=0;t<e.length;++t){const a=e[t],r=document.getElementById(a);if(r){switch(a){case"timeline-stop":case"timeline-repeat":r.style.display="none"}r.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e),d.$endMenu()}))}}this._$run=this.run.bind(this)}executeTimelinePlay(){if(this._$stopFlag){if(this._$totalFrame=d.$currentWorkSpace().scene.totalFrame,this._$totalFrame>1){this._$stopFlag=!1,this._$timerId>-1&&window.cancelAnimationFrame(this._$timerId),d.$timelineFrame.currentFrame>=this._$totalFrame&&(d.$timelineFrame.currentFrame=1,d.$timelineMarker.move(),document.getElementById("timeline-controller-base").scrollLeft&&d.$timelineLayer.moveTimeLine(0),this.reloadScreen());d.$tools.getDefaultTool("arrow").clear(),document.getElementById("timeline-play").style.display="none",document.getElementById("timeline-stop").style.display="",this._$startTime=window.performance.now(),this._$fps=1e3/(0|document.getElementById("stage-fps").value),this._$timerId=window.requestAnimationFrame(this._$run)}}else this.executeTimelineStop()}executeTimelineStop(){window.cancelAnimationFrame(this._$timerId),this._$stopFlag=!0,this._$timerId=-1,document.getElementById("timeline-play").style.display="",document.getElementById("timeline-stop").style.display="none",this.reloadScreen()}executeTimelineRepeat(){document.getElementById("timeline-repeat").style.display="none",document.getElementById("timeline-no-repeat").style.display="",this._$repeat=!1}executeTimelineNoRepeat(){document.getElementById("timeline-repeat").style.display="",document.getElementById("timeline-no-repeat").style.display="none",this._$repeat=!0}run(e=0){if(this._$stopFlag)return;let t=e-this._$startTime;if(t>this._$fps){const a=document.getElementById("timeline-controller-base");let r=d.$timelineFrame.currentFrame+1;if(r>this._$totalFrame){if(!this._$repeat)return this.executeTimelineStop();r=1,a.scrollLeft&&d.$timelineLayer.moveTimeLine(0)}d.$timelineFrame.currentFrame=r,d.$timelineMarker.move(),this._$startTime=e-t%this._$fps;const s=(r-1)*(d.$timelineTool.timelineWidth+1);s>a.offsetWidth/2&&d.$timelineLayer.moveTimeLine(s-a.offsetWidth/2),this.reloadScreen()}this._$timerId=window.requestAnimationFrame(this._$run)}};class $e extends me{constructor(){super(),this._$labelFrame=0,this._$timelineWidth=$e.DEFAULT_TIMELINE_WIDTH,this._$lightAll=!1,this._$lockAll=!1,this._$disableAll=!1}initialize(){super.initialize();const e=["timeline-layer-add","timeline-layer-trash","timeline-layer-light-all","timeline-layer-disable-all","timeline-layer-lock-all","timeline-script-add","timeline-frame-add","timeline-key-add","timeline-empty-add","timeline-frame-delete","timeline-onion-skin","timeline-preview","scene-list"];for(let t=0;t<e.length;++t){const a=document.getElementById(e[t]);a&&a.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e)}))}const t=["label-name","timeline-scale"];for(let e=0;e<t.length;++e){const a=document.getElementById(t[e]);a&&(a.addEventListener("focusin",(e=>{this.focusIn(e)})),a.addEventListener("keypress",(e=>{"Enter"===e.key&&e.target.blur()})),a.addEventListener("focusout",(e=>{this.executeFunction(e)})))}}static get DEFAULT_TIMELINE_WIDTH(){return 12}get timelineWidth(){return this._$timelineWidth}set timelineWidth(e){this._$timelineWidth=0|e,document.documentElement.style.setProperty("--timeline-frame-width",`${e}px`),document.documentElement.style.setProperty("--marker-width",`${d.$clamp(e,4,$e.DEFAULT_TIMELINE_WIDTH)}px`),document.getElementById("timeline-scale").value=""+(e/$e.DEFAULT_TIMELINE_WIDTH*100|0),d.$timelineMarker.move()}focusIn(){super.focusIn(),this._$labelFrame=d.$timelineFrame.currentFrame}executeLabelName(e){if(!this._$labelFrame)return;const t=document.getElementById(`frame-label-marker-${this._$labelFrame}`),a=e.target.value,r=d.$currentWorkSpace().scene;if(a)this.save(),r.setLabel(this._$labelFrame,a),t.setAttribute("class","frame-border-box-marker");else{r.gerLabel(this._$labelFrame)&&(this.save(),r.deleteLabel(this._$labelFrame),t.setAttribute("class","frame-border-box"))}super.focusOut(),this._$labelFrame=0}executeTimelineScale(e){this.timelineWidth=$e.DEFAULT_TIMELINE_WIDTH*d.$clamp(0|e.target.value,41,2e3)/100,super.focusOut()}executeTimelineLayerLockAll(){this._$lockAll=!this._$lockAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene;let a=!1;const r=e.children.length;for(let s=0;s<r;++s){const r=0|e.children[s].dataset.layerId,i=document.getElementById(`layer-lock-icon-${r}`),n=t.getLayer(r);n.mode===d.LAYER_MODE_MASK&&(a=!0),this._$lockAll?(i.classList.remove("icon-disable"),i.classList.add("icon-active"),n.lock=!0):(i.classList.remove("icon-active"),i.classList.add("icon-disable"),n.lock=!1),a&&this.reloadScreen()}d.$tools.getDefaultTool("arrow").clear()}executeTimelineLayerDisableAll(){this._$disableAll=!this._$disableAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene,a=e.children.length;for(let r=0;r<a;++r){const a=0|e.children[r].dataset.layerId,s=document.getElementById(`layer-disable-icon-${a}`),i=t.getLayer(a);this._$disableAll?(s.classList.remove("icon-disable"),s.classList.add("icon-active"),i.disable=!0):(s.classList.remove("icon-active"),s.classList.add("icon-disable"),i.disable=!1);d.$tools.getDefaultTool("arrow").clear(),this.reloadScreen()}}executeTimelineLayerLightAll(){this._$lightAll=!this._$lightAll;const e=document.getElementById("timeline-content"),t=d.$currentWorkSpace().scene,a=e.children.length;for(let r=0;r<a;++r){const a=0|e.children[r].dataset.layerId,s=document.getElementById(`layer-light-icon-${a}`),i=document.getElementById(`layer-id-${a}`),n=t.getLayer(a);this._$lightAll?(s.classList.remove("icon-disable"),s.classList.add("light-icon-active"),i.style.borderBottom=`1px solid ${n.color}`,n.light=!0):(s.classList.remove("light-icon-active"),s.classList.add("icon-disable"),i.style.borderBottom="",n.light=!1)}}executeTimelineLayerTrash(){const e=d.$timelineLayer.targetLayers;if(e.size){this.save();const t=d.$currentWorkSpace().scene,a=document.getElementById("timeline-content");let r=Array.from(a.children).indexOf(d.$timelineLayer.targetLayer),s=!1;const i=d.$timelineFrame.currentFrame;for(const r of e.values()){const e=Array.from(a.children).indexOf(r),n=0|r.dataset.layerId,o=t.getLayer(n),l=a.children;switch(o.mode){case d.LAYER_MODE_MASK:for(let a=e+1;a<l.length;++a){const e=l[a],r=t.getLayer(0|e.dataset.layerId);if(r.mode!==d.LAYER_MODE_MASK_IN)break;r.mode=d.LAYER_MODE_NORMAL,r.showIcon()}break;case d.LAYER_MODE_GUIDE:for(let a=e+1;a<l.length;++a){const e=l[a],r=t.getLayer(0|e.dataset.layerId);if(r.mode!==d.LAYER_MODE_GUIDE_IN)break;r.mode=d.LAYER_MODE_NORMAL,r.showIcon()}}o.getActiveCharacter(i).length&&(s=!0),r.remove(),t.deleteLayer(n)}if(d.$tools.getDefaultTool("arrow").clear(),a.children.length){let e=null;for(;;)if(e=a.children[r--],e){d.$timelineLayer.activeLayer(e);break}}s&&this.reloadScreen()}}executeTimelineLayerAdd(e,t=null){this.save();const a=d.$timelineLayer.targetLayer||document.getElementById("timeline-content").children[0],r=d.$currentWorkSpace().scene;if(r.addLayer(t),a){const e=document.getElementById("timeline-content"),t=r.getLayer(0|a.dataset.layerId),s=e.lastElementChild;switch(t.mode){case d.LAYER_MODE_MASK_IN:{const e=r.getLayer(0|s.dataset.layerId);e.maskId=null===t.maskId?t.id:t.maskId,e.mode=d.LAYER_MODE_MASK_IN,e.showIcon()}break;case d.LAYER_MODE_GUIDE_IN:{const e=r.getLayer(0|s.dataset.layerId);e.guideId=null===t.guideId?t.id:t.guideId,e.mode=d.LAYER_MODE_GUIDE_IN,e.showIcon()}}e.insertBefore(s,a),s.lastElementChild.scrollLeft=a.lastElementChild.scrollLeft;const i=[];for(let t=0;t<e.children.length;++t)i.push(r.getLayer(0|e.children[t].dataset.layerId));r.clearLayer();for(let e=0;e<i.length;++e){const t=i[e];r.setLayer(t.id,t)}}super.focusOut(e)}executeTimelineScriptAdd(e){d.$javaScriptEditor.show(e)}executeTimelineFrameAdd(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=this.getFirstFrame(),a=d.$currentWorkSpace().scene;for(const[r,s]of e){const e=t+s.length,i=document.getElementById(`${r}-${t}`),n=a.getLayer(r);if("empty"===i.dataset.frameState){let a=!1,s=0;for(;t-s>1;++s){if("empty"!==document.getElementById(`${r}-${t-s}`).dataset.frameState)break}const i=t-s,o=n.getActiveCharacter(i);if(o.length){for(let t=0;t<o.length;++t){const a=o[t],r=a.getRange(i);if(a.hasTween(r.startFrame)){a.getTween(r.startFrame).endFrame=e,a.updateTweenPlace(r.startFrame,e),a.relocationTween(r.startFrame)}a.endFrame=e}a=!0}const l=n.getActiveEmptyCharacter(i);!a&&l&&(l.endFrame=e,a=!0),a||n.addEmptyCharacter(new $({startFrame:i,endFrame:e}))}else{for(let e=0;e<n._$characters.length;++e){const a=n._$characters[e];t>=a.startFrame||a.move(s.length)}for(let e=0;e<n._$emptys.length;++e){const a=n._$emptys[e];t>=a.startFrame||a.move(s.length)}const e=n.getActiveCharacter(t);if(e.length)for(let a=0;a<e.length;++a){const r=e[a],i=r.getRange(t),n=new Map;for(const[e,t]of r._$places)i.startFrame>e||e>=i.startFrame&&i.endFrame>e?n.set(e,t):(t.frame=e+s.length,t.tweenFrame&&(t.tweenFrame+=s.length),n.set(t.frame,t));if(r._$places=n,r._$tween.size){const e=new Map;for(const[t,a]of r._$tween)i.startFrame>=t?e.set(t,a):(a.startFrame+=s.length,a.endFrame+=s.length,e.set(a.startFrame,a));if(r._$tween=e,r.hasTween(i.startFrame)){r.getTween(i.startFrame).endFrame+=s.length,r.updateTweenPlace(i.startFrame,i.endFrame+s.length),r.relocationTween(i.startFrame)}}r.endFrame+=s.length}else{const e=n.getActiveEmptyCharacter(t);e&&(e.endFrame+=s.length)}}n.reloadStyle()}this.setActiveFrame(),this.adjustmentTimeline(),this.reloadScreen(),super.focusOut()}executeTimelineKeyAdd(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene;for(const r of e.keys()){const e=a.getLayer(r),s=e.getActiveCharacter(t);if(s.length)for(let e=0;e<s.length;++e){const a=s[e];if(a.hasPlace(t)){const e=a.getPlace(t);if(e.tweenFrame){const r=a.getRange(t),s=a.getTween(e.tweenFrame);s.endFrame=t,a.setTween(t,{method:s.method,curve:[],custom:d.$tweenController.createEasingObject(),startFrame:t,endFrame:r.endFrame}),a.updateTweenPlace(t,r.endFrame),d.$tweenController.relocationPlace(a,t),d.$tweenController.clearPointer().relocationPointer()}}else a.setPlace(t,a.getClonePlace(t))}else this.addEmptyCharacter(e);e.reloadStyle()}this.setActiveFrame(),this.adjustmentTimeline(),this.reloadScreen(),super.focusOut()}executeTimelineKeyDelete(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=d.$currentWorkSpace().scene,a=this.getFirstFrame();for(const r of e.keys()){const e=t.getLayer(r);if(!e._$characters.length&&!e._$emptys.length)continue;const s=e.totalFrame,i=e.getActiveCharacter(a);if(i.length){for(let t=0;t<i.length;++t){const r=i[t];if(!r.hasPlace(a))continue;const s=r.getPlace(a);if(!s.tweenFrame||s.tweenFrame===a){if(r.hasTween(a)){const e=r.getTween(a);switch(!0){case r.startFrame===e.startFrame&&r.endFrame===e.endFrame:r._$places.clear();break;case r.startFrame===e.startFrame:for(let t=e.startFrame;t<e.endFrame;++t)r.deletePlace(t);break;default:{const t=r.getRange(e.startFrame-1);if(r.hasTween(t.startFrame)){for(let a=e.startFrame;a<e.endFrame;++a){r.getPlace(a).tweenFrame=t.startFrame}r.getTween(t.startFrame).endFrame=e.endFrame,r.updateTweenFilter(t.startFrame),r.updateTweenBlend(t.startFrame),r.relocationTween(t.startFrame)}else for(let t=e.startFrame;t<e.endFrame;++t)r.deletePlace(t)}}r.deleteTween(a)}else r.deletePlace(a);if(r._$places.size){if(a===r.startFrame){let e=r.endFrame;for(const t of r._$places.keys())e=Math.min(e,t);r.startFrame=e}}else e.deleteCharacter(r.id)}}e.getActiveCharacter(a).length||this.adjustmentKeyFrame(e,a,s),e.reloadStyle();continue}const n=e.getActiveEmptyCharacter(a);n&&n.startFrame===a&&(e.deleteEmptyCharacter(n),this.adjustmentKeyFrame(e,a,s),e.reloadStyle())}this.setActiveFrame(),this.adjustmentTimeline(),d.$timelineLayer.activeCharacter(),this.reloadScreen(),super.focusOut()}executeTimelineEmptyAdd(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;d.$tools.getDefaultTool("arrow").clearActiveElement(),this.save();const t=d.$timelineFrame.currentFrame,a=d.$currentWorkSpace().scene;for(const r of e.keys()){const e=a.getLayer(r),s=e.getActiveCharacter(t);if(s.length){const a=document.getElementById(`${r}-${t}`);if("key-frame"===a.dataset.frameState){d.$fadeIn({currentTarget:{dataset:{detail:"{{キーフレームに空のキーフレームを追加できません}}"}},pageX:a.offsetLeft,pageY:a.offsetTop});continue}let i=Number.MAX_VALUE;for(let e=0;e<s.length;++e){const a=s[e];i=Math.min(i,a.endFrame);for(let e of a._$places.keys())t>e||(i=Math.min(i,e))}for(let a=0;a<s.length;++a){const r=s[a];r.split(e,t,i),r.endFrame>i&&e.addCharacter(r.split(e,i,r.endFrame))}const n=new $;n.startFrame=t,n.endFrame=i,e.addEmptyCharacter(n)}else this.addEmptyCharacter(e);e.reloadStyle()}this.setActiveFrame(),this.adjustmentTimeline(),this.reloadScreen(),super.focusOut()}addEmptyCharacter(e){const t=d.$timelineFrame.currentFrame,a=e.getActiveEmptyCharacter(t);if(a){if("empty-key-frame"===document.getElementById(`${e.id}-${t}`).dataset.frameState)return;a.startFrame!==t&&(e.addEmptyCharacter(new $({startFrame:t,endFrame:a.endFrame})),a.endFrame=t)}else{if(t>1){let a=1;for(;t-a>1;++a){if("empty"!==document.getElementById(`${e.id}-${t-a}`).dataset.frameState)break}const r=e.getActiveCharacter(t-a);if(r.length)for(let e=0;e<r.length;++e){r[e].endFrame=t}else{const r=e.getActiveEmptyCharacter(t-a);r?r.endFrame=t:e.addEmptyCharacter(new $({startFrame:t-a,endFrame:t}))}}const a=new $;a.startFrame=t,a.endFrame=t+1,e.addEmptyCharacter(a)}}executeTimelineFrameDelete(){const e=d.$timelineLayer.targetFrames;if(!e.size)return;this.save();const t=this.getFirstFrame(),a=d.$currentWorkSpace().scene;for(const[r,s]of e){if("empty"===document.getElementById(`${r}-${t}`).dataset.frameState)continue;const e=a.getLayer(r),i=e.getActiveCharacter(t);let n=0;if(i.length)for(let a=0;a<i.length;++a){const r=i[a],o=r.getRange(t);if(r.hasPlace(t)&&s.length>=o.endFrame-o.startFrame){if(r.hasTween(t)){for(let e=o.startFrame;e<o.endFrame;++e)r.deletePlace(e);r.deleteTween(t),d.$tweenController.clearPointer()}r.deletePlace(t)}if(n=Math.min(o.endFrame,t+s.length)-t,r._$places.size){const e=new Map;for(const[t,a]of r._$places)o.startFrame>t?e.set(t,a):t>=o.startFrame&&o.endFrame>t?(o.endFrame-n>t&&e.set(t,a),o.endFrame-1===t&&e.set(o.endFrame-n-1,a)):(a.frame=t-n,a.tweenFrame&&(a.tweenFrame-=n),e.set(a.frame,a));if(r._$places=e,r._$tween.size){const e=new Map;for(const[t,a]of r._$tween)o.startFrame>=t?(o.startFrame===t&&(a.endFrame-=n),e.set(t,a)):(a.startFrame-=n,a.endFrame-=n,e.set(a.startFrame,a));r._$tween=e,r.relocationTween(o.startFrame)}r.endFrame-=n}else e.deleteCharacter(r.id)}else{const a=e.getActiveEmptyCharacter(t);if(a){const r=a.endFrame-a.startFrame;n=Math.min(a.endFrame,t+s.length)-t,n>=r?e.deleteEmptyCharacter(a):a.endFrame-=n}}for(let a=0;a<e._$characters.length;++a){const r=e._$characters[a];t>=r.startFrame||r.move(-n)}for(let a=0;a<e._$emptys.length;++a){const r=e._$emptys[a];t>=r.startFrame||r.move(-n)}e.reloadStyle()}this.setActiveFrame(),d.$timelineLayer.activeCharacter(),this.adjustmentTimeline(),this.reloadScreen(),super.focusOut()}executeTimelineOnionSkin(){const e=document.getElementById("timeline-onion-skin");if(e.classList.contains("onion-skin-active")){e.classList.remove("onion-skin-active");const t=d.$currentWorkSpace().scene._$layers;for(const e of t.values())for(let t=0;t<e._$characters.length;++t)e._$characters[t]._$image=null}else e.classList.add("onion-skin-active");this.reloadScreen()}executeTimelinePreview(){const e=document.getElementById("timeline-preview");e.classList.contains("timeline-preview-active")?e.classList.remove("timeline-preview-active"):e.classList.add("timeline-preview-active")}executeSceneList(e){if(!document.getElementById("scene-name-menu-list").children.length)return;const t=document.getElementById("scene-name-menu");if(t.classList.contains("fadeIn"))t.setAttribute("class","fadeOut");else{const a=e.currentTarget;t.style.left=`${a.offsetLeft+a.offsetWidth}px`,t.style.top=`${a.offsetTop+10}px`,t.setAttribute("class","fadeIn"),d.$endMenu("scene-name-menu")}}setActiveFrame(){for(const e of d.$timelineLayer.targetFrames.values())for(let t=0;t<e.length;++t)e[t].classList.add("frame-active")}adjustmentTimeline(){const e=d.$timelineHeader.lastFrame;d.$timelineHeader.create();const t=document.getElementById("timeline-content").children;for(let a=0;a<t.length;++a)d.$timelineLayer.create(e,0|t[a].dataset.layerId)}adjustmentKeyFrame(e,t,a){if(t>1){let r=a;for(let s=1;a>t+s;++s){const a=t+s;if(e.getActiveCharacter(a).length){r=a;break}if(e.getActiveEmptyCharacter(a)){r=a;break}}for(let a=1;t-a>0;++a){const s=t-a,i=e.getActiveCharacter(s);if(i.length){for(let e=0;e<i.length;++e){const t=i[e],a=t.endFrame-1;if(t.hasPlace(a)){const e=t.getPlace(a);if(e.tweenFrame){t.getTween(e.tweenFrame).endFrame=r;for(let e=a+1;r>e;++e)t.setPlace(e,t.getClonePlace(a));d.$tweenController.relocationPlace(t,a)}}i[e].endFrame=r}break}const n=e.getActiveEmptyCharacter(s);if(n){n.endFrame=r;break}}}else if(e._$characters.length||e._$emptys.length)for(let t=1;;++t){const a=1+t,r=e.getActiveCharacter(a);if(r.length){for(let e=0;e<r.length;++e){const t=r[e];let a=t.endFrame;for(let e of t._$places.keys())a=Math.min(a,e);const s=t.getPlace(a);t.deletePlace(a),t.setPlace(1,s),t.startFrame=1}break}const s=e.getActiveEmptyCharacter(a);if(s){s.startFrame=1;break}}else e.addEmptyCharacter(new $({startFrame:t,endFrame:a}))}getFirstFrame(){if(!d.$timelineLayer.targetFrame)return 1;const e=d.$timelineLayer.targetFrames.values().next().value;let t=Number.MAX_VALUE;for(let a=0;a<e.length;++a)t=Math.min(t,0|e[a].dataset.frame);return t}}d.$timelineTool=new $e;class ye{constructor(){this._$saved=!1,this._$handler=null,d.$readEnd++,"loading"===document.readyState?(this._$handler=this.initialize.bind(this),window.addEventListener("DOMContentLoaded",this._$handler)):this.initialize()}initialize(){this._$handler&&(window.removeEventListener("DOMContentLoaded",this._$handler),this._$handler=null),d.$initializeEnd()}reloadScreen(){const e=d.$timelineFrame.currentFrame;d.$currentWorkSpace().scene.changeFrame(e)}save(){d.$currentWorkSpace().temporarilySaved()}executeFunction(e){d.$endMenu();this[`execute${e.split("-").map((e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`)).join("")}`]()}}d.$sceneChange=new class extends ye{initialize(){super.initialize()}reload(e){const t=document.getElementById("scene-name-menu-list");for(;t.children.length;)t.children[0].remove();d.$currentWorkSpace().root.addSceneName(),d.$sceneChange.execute(e)}execute(e){const t=d.$currentWorkSpace(),a=t.getLibrary(e),r=a.currentFrame;d.$timelineFrame.currentFrame=r,d.$timelineMarker.move();const s=document.getElementById("timeline-controller-base"),i=(r-1)*(d.$timelineTool.timelineWidth+1);i>s.offsetWidth/2&&d.$timelineLayer.moveTimeLine(i-s.offsetWidth/2),t.scene=a}};d.$screen=new class extends ye{initialize(){super.initialize();const e=document.getElementById("screen");e&&(e.addEventListener("contextmenu",(e=>{d.$screenMenu.show(e)})),e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(e=>{e.preventDefault(),this.drop(e)})),e.addEventListener("mousedown",(e=>{if(e.button)return;d.$canCopyLayer=!1,d.$endMenu();const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(D.MOUSE_DOWN,e))})),e.addEventListener("dblclick",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(D.DBL_CLICK,e))})),e.addEventListener("mouseleave",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(D.MOUSE_LEAVE,e)),document.getElementById("stage-rect").style.display="none",document.getElementById("draw-rect").style.display="none",d.$setCursor("auto")})),e.addEventListener("mousewheel",(e=>{if(e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey){const t=e.deltaX||e.deltaY;return t&&(e.preventDefault(),window.requestAnimationFrame((()=>{d.$screenZoom.execute(t/100*-1)}))),!1}}),{passive:!1}),e.addEventListener("mousemove",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,window.requestAnimationFrame((()=>{t.dispatchEvent(D.MOUSE_MOVE,e)})))})),e.addEventListener("mouseup",(e=>{const t=d.$tools.activeTool;t&&(e.screen=!0,t.dispatchEvent(D.MOUSE_UP,e))})))}drop(e){const t=d.$libraryController.activeInstances;if(!t.size)return;const a=d.$currentWorkSpace(),r=a.scene;d.$timelineLayer.attachLayer();const s=0|d.$timelineLayer.targetLayer.dataset.layerId,i=r.getLayer(s);if(i.lock)return;const n=d.$timelineFrame.currentFrame;this.save();const o=[],l=[];for(const e of t.keys()){const t=a.getLibrary(e);if(t&&t.id!==r.id)switch(t.type){case"sound":o.push(e);break;case"folder":t.getInstanceIds(l);break;default:l.push(e)}}if(o.length){r.hasSound(n)||r.setSound(n,[]);const e=r.getSound(n);for(let t=0;t<o.length;++t){const r=a.getLibrary(o[t]);e.push({characterId:r.id,name:r.name,volume:100,autoPlay:!1,loopCount:0})}d.$soundController.setIcon(n),d.$soundController.createSoundElements()}const c=i.getActiveCharacter(n);if(c.length){const e=c[0],t=e.getRange(n);if(e.hasTween(t.startFrame))return}const h=e.offsetX-d.$offsetLeft,u=e.offsetY-d.$offsetTop,m=i.adjustmentLocation(n),g=m.endFrame,p=m.startFrame;for(let e=0;e<l.length;++e){const t=l[e],r={start:null,end:null},s=i._$characters;for(let e=0;e<s.length;++e){const a=s[e];if(a.libraryId===t)switch(!0){case p>1&&a.endFrame===p:r.start=a;break;case a.startFrame===g:r.end=a}}const n=a.getLibrary(t),o={frame:m.startFrame,matrix:[1,0,0,1,h/d.$zoomScale,u/d.$zoomScale],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:i._$characters.length};"container"===n.type&&(o.loop=d.$getDefaultLoopConfig());let c=null;if(r.start&&(c=r.start,c.endFrame=g),r.end)if(c){c.endFrame=r.end.endFrame;for(let[e,t]of r.end._$places)c.setPlace(e,t);for(let[e,t]of r.end._$tween)c.setTween(e,t);i.deleteCharacter(r.end.id)}else c=r.end,c.startFrame=p;c?c.setPlace(p,o):(c=new f,c.libraryId=t,c.startFrame=p,c.endFrame=g,c.setPlace(p,o),i.addCharacter(c));let $=0,y=0;if("container"===n.type){const e=n.getBounds([1,0,0,1,0,0]);$=e.xMin,y=e.yMin}let _=c.width;_||(_=10);let b=c.height;b||(b=10),$+=_/2,y+=b/2,o.matrix[4]-=$,o.matrix[5]-=y}i.reloadStyle(),l.length&&this.reloadScreen(),this._$saved=!1}appendOnionCharacter(e,t){const a=d.$currentWorkSpace().scene,r=e.image.cloneNode(!0);r.width=e.image._$width*d.$zoomScale,r.height=e.image._$height*d.$zoomScale,r.style.left=`${e.offsetX}px`,r.style.top=`${e.offsetY}px`;const s=document.createElement("div");s.dataset.child="true",s.dataset.preview="true",s.appendChild(r);const i=a.getLayer(t);if(null!==i.maskId){const t=a.getLayer(i.maskId);if(t||(i.maskId=null),t&&t.lock&&t._$characters.length){const a=t._$characters[0],i=a.image,n=a.screenX-e.screenX,o=a.screenY-e.screenY;s.style.mask=`url(${i.src}), none`,s.style.maskSize=`${i.width}px ${i.height}px`,s.style.maskRepeat="no-repeat",s.style.maskPosition=`${n}px ${o}px`,s.style.mixBlendMode=r.style.mixBlendMode,s.style.filter=r.style.filter}else s.style.mask="",s.style.maskSize="",s.style.maskRepeat="",s.style.maskPosition="",s.style.mixBlendMode="",s.style.filter=""}s.style.position="absolute",s.style.left=`${d.$offsetLeft+e.screenX*d.$zoomScale}px`,s.style.top=`${d.$offsetTop+e.screenY*d.$zoomScale}px`,s.style.pointerEvents="none",s.style.opacity="0.25",document.getElementById("stage-area").appendChild(s)}appendCharacter(e,t,a,r="auto"){const s=d.$currentWorkSpace(),i=s.scene,n=e.getPlace(t),o=s.getLibrary(e.libraryId);let l=!e._$currentPlace;switch(o.type){case"container":o.totalFrame>1&&e._$currentFrame!==t&&(l=!0,e._$currentFrame=t);break;case"video":e._$currentFrame!==t&&(l=!0,e._$currentFrame=t)}if(n!==e._$currentPlace){if(e._$currentPlace){const t=n.matrix,a=e._$currentPlace.matrix;switch(!0){case t[0]!==a[0]:case t[1]!==a[1]:case t[2]!==a[2]:case t[3]!==a[3]:l=!0;break;default:e._$screenX+=-a[4]+t[4],e._$screenY+=-a[5]+t[5]}if(!l){const t=n.colorTransform,a=e._$currentPlace.colorTransform;switch(!0){case t[0]!==a[0]:case t[1]!==a[1]:case t[2]!==a[2]:case t[3]!==a[3]:case t[4]!==a[4]:case t[5]!==a[5]:case t[6]!==a[6]:case t[7]!==a[7]:l=!0}}if(l||n.blendMode===e._$currentPlace.blendMode||(l=!0),!l&&(e._$currentPlace.filter.length!==n.filter.length&&(l=!0),!l))for(let t=0;t<n.filter.length;++t){const a=n.filter[t],r=e._$currentPlace[t];if(!a||!r){l=!0;break}if(r.constructor!==a.constructor){l=!0;break}if(!r.isSame(a)){l=!0;break}}}e._$currentPlace=n}l&&(e._$image=null);const c=e.image;c.width=c._$width*d.$zoomScale,c.height=c._$height*d.$zoomScale,c.style.left=e.offsetX*d.$zoomScale+"px",c.style.top=e.offsetY*d.$zoomScale+"px";const h=document.createElement("div");h.classList.add("display-object"),h.appendChild(c);const u=i.getLayer(a);if(null!==u.maskId){const t=i.getLayer(u.maskId);if(t||(u.maskId=null),t&&t.lock&&t._$characters.length){const a=t._$characters[0],r=a.image,s=a.screenX-e.screenX,i=a.screenY-e.screenY;h.style.webkitMask=h.style.mask=`url(${r.src}), none`,h.style.webkitMaskSize=h.style.maskSize=`${r.width}px ${r.height}px`,h.style.webkitMaskRepeat=h.style.maskRepeat="no-repeat",h.style.webkitMaskPosition=h.style.maskPosition=`${s}px ${i}px`,h.style.mixBlendMode=c.style.mixBlendMode,h.style.filter=c.style.filter}else h.style.webkitMask=h.style.mask="",h.style.webkitMaskSize=h.style.maskSize="",h.style.webkitMaskRepeat=h.style.maskRepeat="",h.style.webkitMaskPosition=h.style.maskPosition="",h.style.mixBlendMode="",h.style.filter=""}h.id=`character-${e.id}`,h.dataset.characterId=`${e.id}`,h.dataset.layerId=`${a}`,h.dataset.instanceType=o.type,h.dataset.libraryId=`${e.libraryId}`,h.dataset.child="true";let m=d.$offsetLeft+e.screenX*d.$zoomScale,g=d.$offsetTop+e.screenY*d.$zoomScale;h.style.position="absolute",h.style.left=`${m}px`,h.style.top=`${g}px`;let p=e.width*d.$zoomScale;p||(p=10);let f=e.height*d.$zoomScale;switch(f||(f=10),h.style.width=`${Math.ceil(p)}px`,h.style.height=`${Math.ceil(f)}px`,h.style.pointerEvents=r,h.addEventListener("mouseover",(e=>{e.stopPropagation();const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(D.MOUSE_OVER,e))})),h.addEventListener("mouseout",(e=>{e.stopPropagation();const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(D.MOUSE_OUT,e))})),h.addEventListener("mousedown",(e=>{if(e.button)return;e.stopPropagation();const t=d.$tools.activeTool;t&&(e.displayObject=!0,t.dispatchEvent(D.MOUSE_DOWN,e))})),o._$type){case"container":h.addEventListener("dblclick",(e=>{e.stopPropagation(),d.$currentWorkSpace().scene.addSceneName(),d.$sceneChange.execute(0|e.currentTarget.dataset.libraryId)}));break;case"text":{const e=document.createElement("div");e.style.width=p-2+"px",e.style.height=f-2+"px",e.style.pointerEvents="none",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.border=o._$border?"1px solid gray":"1px dashed gray",h.appendChild(e),h.addEventListener("dblclick",(e=>{e.stopPropagation(),d.$tools.reset();const t=document.getElementById("stage-area").children;for(let e=0;e<t.length;++e){t[e].style.pointerEvents="none"}const r=e.currentTarget;r.style.pointerEvents="";const i=r.firstChild;i.remove();const n=window.document.createElement("textarea");r.style.display="none",r.parentNode.appendChild(n);const o=d.$currentWorkSpace().scene,l=0|r.dataset.layerId,c=o.getLayer(l),h=0|r.dataset.characterId,u=c.getCharacter(h),m=s.getLibrary(u.libraryId);n.value=m._$text,n.style.border=m._$border?"1px solid gray":"1px dashed gray",n.style.fontSize=`${m._$size}px`,n.style.fontFamily=m._$font,n.style.width=i.width-4+"px",n.style.height=`${i.height}px`,n.style.position="absolute",n.style.left=r.style.left,n.style.top=r.style.top,n.style.pointerEvents="auto",m._$border||(n.style.backgroundColor="transparent"),n.dataset.characterId=`${u.id}`,n.dataset.layerId=`${a}`,n.dataset.libraryId=`${u.libraryId}`,n.dataset.child="true",m._$multiline||n.addEventListener("keydown",(e=>{if("Enter"===e.key)return e.preventDefault(),!1})),n.addEventListener("focusin",(()=>{d.$keyLock=!0})),n.addEventListener("focusout",(e=>{const t=e.target,a=d.$currentWorkSpace().scene,r=0|t.dataset.layerId,i=a.getLayer(r),n=0|t.dataset.characterId,o=i.getCharacter(n);s.getLibrary(o.libraryId)._$text=t.value,o._$image=null,d.$keyLock=!1;const l=document.getElementById("stage-area").children;for(let e=0;e<l.length;++e){l[e].style.pointerEvents=""}const c=d.$timelineFrame.currentFrame;a.changeFrame(c)})),n.focus()}))}}document.getElementById("stage-area").appendChild(h)}};d.$screenKeyboardCommand=new class extends O{constructor(){super("screen"),this._$state="close",this._$prevTool=null,this._$activeTool=null,this._$endHandTool=null}initialize(){super.initialize();const e=document.getElementById("screen");e&&(e.addEventListener("mouseleave",(()=>{this.active=!1})),e.addEventListener("mouseover",(()=>{this.active||(this.active=!0)}))),this._$endHandTool=this.endHandTool.bind(this),this.add(" ",this.startHandTool.bind(this));const t=["v","a","p","t","k","o","r","z"];this._$activeTool=this.activeTool.bind(this);for(let e=0;e<t.length;++e)this.add(t[e],this._$activeTool);this.add(d.$generateShortcutKey("r",{shift:!0}),this._$activeTool),this.add("s",this.userSetting.bind(this));const a=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"];for(let e=0;e<a.length;++e){const t=a[e];this.add(t,this.executeMoveDisplayObject),this.add(d.$generateShortcutKey(t,{shift:!0}),this.executeMoveDisplayObject)}this.add(d.$generateShortcutKey("r",{ctrl:!0}),(()=>{d.$shiftKey=!1,d.$ctrlKey=!1,d.$altKey=!1,d.$project.open()})),this.add(d.$generateShortcutKey("s",{ctrl:!0,shift:!0}),d.$project.save),this.add("Backspace",this.deleteDisplayObject),this.add(d.$generateShortcutKey("p",{ctrl:!0,shift:!0}),this.deleteTweenCurvePointer),this.add(d.$generateShortcutKey("ArrowUp",{ctrl:!0,shift:!0}),this.screenFront),this.add(d.$generateShortcutKey("ArrowUp",{ctrl:!0}),this.screenFrontOne),this.add(d.$generateShortcutKey("ArrowDown",{ctrl:!0,shift:!0}),this.screenBack),this.add(d.$generateShortcutKey("ArrowDown",{ctrl:!0}),this.screenBackOne),this.add("1",this.screenPositionLeft),this.add(d.$generateShortcutKey("!",{shift:!0}),this.stagePositionLeft),this.add("2",this.screenPositionCenter),this.add(d.$generateShortcutKey('"',{shift:!0}),this.stagePositionCenter),this.add("3",this.screenPositionRight),this.add(d.$generateShortcutKey("#",{shift:!0}),this.stagePositionRight),this.add("4",this.screenPositionTop),this.add(d.$generateShortcutKey("$",{shift:!0}),this.stagePositionTop),this.add("5",this.screenPositionMiddle),this.add(d.$generateShortcutKey("%",{shift:!0}),this.stagePositionMiddle),this.add("6",this.screenPositionBottom),this.add(d.$generateShortcutKey("&",{shift:!0}),this.stagePositionBottom),this.add(d.$generateShortcutKey("d",{ctrl:!0}),this.distributeToLayers),this.add(d.$generateShortcutKey("k",{ctrl:!0}),this.distributeToKeyframes),this.add(d.$generateShortcutKey("i",{ctrl:!0}),this.integratingPaths),this.add(d.$generateShortcutKey("p",{ctrl:!0}),(()=>{d.$tweenController.addCurvePinter()})),this.add(d.$generateShortcutKey("m",{shift:!0}),(()=>{d.$screenMenu.executeScreenChangeMovieClip()}))}integratingPaths(){d.$screenMenu.executeScreenIntegratingPaths()}distributeToKeyframes(){d.$screenMenu.executeScreenDistributeToKeyframes()}distributeToLayers(){d.$screenMenu.executeScreenDistributeToLayers()}screenPositionBottom(){d.$screenMenu.alignment("bottom")}stagePositionBottom(){d.$screenMenu.alignment("bottom","stage")}screenPositionMiddle(){d.$screenMenu.alignment("middle")}stagePositionMiddle(){d.$screenMenu.alignment("middle","stage")}screenPositionTop(){d.$screenMenu.alignment("top")}stagePositionTop(){d.$screenMenu.alignment("top","stage")}screenPositionCenter(){d.$screenMenu.alignment("center")}stagePositionCenter(){d.$screenMenu.alignment("center","stage")}stagePositionRight(){d.$screenMenu.alignment("right","stage")}screenPositionRight(){d.$screenMenu.alignment("right")}stagePositionLeft(){d.$screenMenu.alignment("left","stage")}screenPositionLeft(){d.$screenMenu.alignment("left")}screenBack(){d.$screenMenu.changeDepth("down")}screenBackOne(){d.$screenMenu.changeDepthOne("down")}screenFront(){d.$screenMenu.changeDepth("up")}screenFrontOne(){d.$screenMenu.changeDepthOne("up")}deleteTweenCurvePointer(){d.$tweenController.deleteCurvePointer()}deleteDisplayObject(){d.$tools.getDefaultTool("arrow").deleteDisplayObject()}userSetting(){const e=document.getElementById("user-setting");"show"===this._$state||e.classList.contains("fadeIn")?(this._$state="close",d.$endMenu()):(this._$state="show",d.$userSetting.show())}activeTool(e){let t="";switch(e){case"v":t="arrow";break;case"a":t="transform";break;case"p":t="pen";break;case"t":t="text";break;case"z":t="zoom";break;case"k":t="bucket";break;case"r":t="rectangle";break;case"o":t="circle";break;case"rShift":t="round-rect"}if(t){const e=d.$tools.activeTool;e&&e.dispatchEvent(D.END);const a=d.$tools.getDefaultTool(t);a.dispatchEvent(D.START),d.$tools.activeTool=a}}startHandTool(){if("hand"===d.$tools.activeTool.name)return;this._$prevTool=d.$tools.activeTool,this._$prevTool&&this._$prevTool.dispatchEvent(D.END);const e=d.$tools.getDefaultTool("hand");e.dispatchEvent(D.START),d.$tools.activeTool=e,d.$tools.getDefaultTool("arrow").endRect(),window.addEventListener("keyup",this._$endHandTool)}endHandTool(e){if(" "!==e.key)return;window.removeEventListener("keyup",this._$endHandTool);d.$tools.getDefaultTool("hand").dispatchEvent(D.END),this._$prevTool?(this._$prevTool.dispatchEvent(D.START),d.$tools.activeTool=this._$prevTool,this._$prevTool=null):d.$tools.reset()}executeMoveDisplayObject(e){const t=d.$tools.getDefaultTool("arrow");if(t.activeElements.length){switch(e){case"ArrowRight":case"ArrowRightShift":t.pageX=d.$shiftKey?10:1,t.pageY=0;break;case"ArrowLeft":case"ArrowLeftShift":t.pageX=d.$shiftKey?-10:-1,t.pageY=0;break;case"ArrowUp":case"ArrowUpShift":t.pageX=0,t.pageY=d.$shiftKey?-10:-1;break;case"ArrowDown":case"ArrowDownShift":t.pageX=0,t.pageY=d.$shiftKey?10:1;break;default:return}t.moveDisplayObject(),t._$saved=!1}}};d.$screenMenu=new class extends ye{constructor(){super(),this._$state="hide"}initialize(){super.initialize();const e=["screen-front","screen-front-one","screen-back-one","screen-back","screen-position-left","screen-position-right","screen-position-center","screen-position-top","screen-position-middle","screen-position-bottom","stage-position-left","stage-position-right","stage-position-center","stage-position-top","stage-position-middle","stage-position-bottom","screen-distribute-to-layers","screen-distribute-to-keyframes","screen-integrating-paths","screen-add-tween-curve-pointer","screen-delete-tween-curve-pointer","screen-change-movie-clip","screen-preview"];for(let t=0;t<e.length;++t){const a=document.getElementById(e[t]);a&&a.addEventListener("mousedown",(e=>{e.stopPropagation(),this.executeFunction(e.target.id)}))}}executeScreenPreview(){d.$showPreview()}executeScreenDistributeToLayers(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;this.save();const t=[],a=d.$timelineFrame.currentFrame,r=new Map,s=d.$currentWorkSpace().scene;for(let i=0;i<e.length;++i){const n=e[i],o=s.getLayer(0|n.dataset.layerId);if(!o)continue;const l=o.getCharacter(0|n.dataset.characterId);if(!l)continue;const c=l.getRange(a);r.has(o.id)||r.set(o.id,{layer:o,range:c});const d=l.getPlace(c.startFrame);d.depth=0,t.push({libraryId:l.libraryId,place:d,startFrame:c.startFrame,endFrame:c.endFrame}),l.remove(o)}for(const e of r.values()){const t=e.layer,r=e.range,s=t.getActiveCharacter(r.startFrame);if(s.length){t.sort(s,a);for(let e=0;e<s.length;++e)s[e].getPlace(a).depth=e}else t.addEmptyCharacter(new $({startFrame:r.startFrame,endFrame:r.endFrame}));t.reloadStyle()}d.$timelineLayer.clear();const i=d.$ctrlKey;d.$ctrlKey=!0;for(let e=0;e<t.length;++e){const a=t[e],r=new f;r.libraryId=a.libraryId,r.startFrame=a.startFrame,r.endFrame=a.endFrame,r.setPlace(a.startFrame,a.place);const i=new _;i.addCharacter(r),a.startFrame>1&&i.addEmptyCharacter(new $({startFrame:1,endFrame:a.startFrame})),s.addLayer(i),d.$timelineLayer.activeLayer(document.getElementById(`layer-id-${i.id}`))}this.reloadScreen(),d.$timelineLayer.activeCharacter(),d.$ctrlKey=i,this._$saved=!1}executeScreenDistributeToKeyframes(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;this.save();const t=d.$currentWorkSpace().scene;let a=d.$timelineFrame.currentFrame;const r=new Map;for(const s of e.values()){const e=t.getLayer(0|s.dataset.layerId),i=e.getCharacter(0|s.dataset.characterId);r.has(e.id)||r.set(e.id,{range:i.getRange(a),characters:[]}),r.get(e.id).characters.push(i)}for(const[e,s]of r){let r=s.characters;if(1===r.length)continue;const i=t.getLayer(e),n=s.range,o=i.getActiveCharacter(a),l=n.endFrame-n.startFrame;switch(!0){case r.length!==o.length:{const e=new Map,t=[];for(let a=0;a<o.length;++a){const s=o[a],l=r.indexOf(s),c=s.split(i,n.startFrame,n.endFrame);l>-1&&e.set(c.id,l),t.push(c)}for(let e=0;e<i._$characters.length;++e){const t=i._$characters[e];if(!(n.endFrame>t.endFrame))if(t.startFrame>n.startFrame)t.move(r.length);else{const e=new Map;for(const[a,s]of t._$places)a>n.startFrame&&(s.frame=a+r.length),e.set(s.frame,s);t._$places=e,t.endFrame+=r.length}}for(let e=0;i._$emptys.length>e;++e){const t=i._$emptys[e];n.startFrame>t.startFrame||t.move(r.length)}a=n.endFrame,n.startFrame=n.endFrame,n.endFrame+=r.length;const s=[];for(let a=0;a<t.length;++a){const r=t[a];if(e.has(r.id))r.setPlace(n.startFrame,r.getPlace(r.startFrame)),r.deletePlace(r.startFrame),r.startFrame=n.startFrame,r.endFrame=n.endFrame,i.addCharacter(r),s.push(r);else for(let e=0;e<i._$characters.length;++e){const t=i._$characters[e];if(t.libraryId===r.libraryId&&t.endFrame===r.startFrame){for(const[e,a]of r._$places)t.setPlace(e,a);t.endFrame=r.endFrame;break}}}r=s}break;case r.length>l:{const e=r.length-l;for(let t=0;i._$characters.length>t;++t){const a=i._$characters[t];if(!(n.endFrame>=a.endFrame))if(a.startFrame>n.endFrame)a.move(e);else{const t=new Map;for(const[r,s]of a._$places)r>=n.endFrame&&(s.frame=r+e),t.set(s.frame,s);a._$places=t,a.endFrame+=e}}for(let t=0;i._$emptys.length>t;++t){const a=i._$emptys[t];n.endFrame>=a.endFrame||a.move(e)}n.endFrame+=e}break;case l>r.length:{const e=l-r.length;for(let t=0;i._$characters.length>t;++t){const a=i._$characters[t];if(!(n.endFrame>a.endFrame))if(a.startFrame>n.endFrame)a.move(-e);else{const t=new Map;for(const[r,s]of a._$places)r>=n.endFrame&&(s.frame=r-e),t.set(s.frame,s);a._$places=t,a.endFrame-=e}}for(let t=0;i._$emptys.length>t;++t){const a=i._$emptys[t];n.startFrame>a.startFrame||a.move(-e)}n.endFrame-=e}}r.sort(((e,t)=>{const r=e.getPlace(a).depth,s=t.getPlace(a).depth;switch(!0){case r>s:return 1;case r<s:return-1;default:return 0}}));let c=n.startFrame;for(let e=0;e<r.length;++e){let t=r[e];1!==t._$places.size&&(t=t.split(i,n.startFrame,n.endFrame),i.addCharacter(t));const s=t.getPlace(a);let o=!1;for(let e=0;e<i._$characters.length;++e){const a=i._$characters[e];if(a.id!==t.id&&(a.libraryId===t.libraryId&&a.endFrame===c)){i.deleteCharacter(t.id),a.endFrame=c+1,a.setPlace(c,s),o=!0;break}}if(o)c++;else{for(let e=0;e<i._$characters.length;++e){const a=i._$characters[e];if(a.id!==t.id&&(a.libraryId===t.libraryId&&a.startFrame===c+1)){i.deleteCharacter(t.id),a.startFrame=c,a.setPlace(c,s),o=!0;break}}o||(t.startFrame=c,t.endFrame=c+1,t.deletePlace(s.frame),t.setPlace(c,s)),c++}}i.reloadStyle(),console.log(i)}this.reloadScreen(),this._$saved=!1}executeScreenIntegratingPaths(){const e=d.$tools.getDefaultTool("arrow").activeElements;if(!e.length)return;this.save();const t=d.$currentWorkSpace(),a=t.scene,r=d.$timelineFrame.currentFrame;let s=null,i=null,n=0;for(let o=0;o<e.length;++o){const l=e[o];if("shape"!==l.dataset.instanceType)continue;const c=t.getLibrary(0|l.dataset.libraryId),d=a.getLayer(0|l.dataset.layerId).getCharacter(0|l.dataset.characterId),{Graphics:h}=window.next2d.display;if(!s){i=d,s=c;for(let e=0;s._$recodes.length>e;){switch(s._$recodes[e++]){case h.BEGIN_PATH:break;case h.MOVE_TO:case h.LINE_TO:e+=2;break;case h.CURVE_TO:e+=4;break;case h.CUBIC:e+=6;break;case h.FILL_STYLE:case h.GRADIENT_FILL:case h.STROKE_STYLE:case h.GRADIENT_STROKE:n=e-1;case h.CLOSE_PATH:case h.END_STROKE:case h.END_FILL:}if(n)break}continue}const u=i.screenX-s._$bounds.xMin-d.screenX,m=i.screenY-s._$bounds.yMin-d.screenY,g=d.getPlace(r).matrix,p=[];let f=!1;for(let e=0;c._$recodes.length>e;){switch(c._$recodes[e++]){case h.BEGIN_PATH:break;case h.MOVE_TO:{const t=c._$recodes[e++],a=c._$recodes[e++];p.push(h.MOVE_TO,t*g[0]+a*g[2]-u,t*g[1]+a*g[3]-m)}break;case h.LINE_TO:{const t=c._$recodes[e++],a=c._$recodes[e++];p.push(h.LINE_TO,t*g[0]+a*g[2]-u,t*g[1]+a*g[3]-m)}break;case h.CURVE_TO:{const t=c._$recodes[e++],a=c._$recodes[e++],r=c._$recodes[e++],s=c._$recodes[e++];p.push(h.CURVE_TO,t*g[0]+a*g[2]-u,t*g[1]+a*g[3]-m,r*g[0]+s*g[2]-u,r*g[1]+s*g[3]-m)}break;case h.CUBIC:{const t=c._$recodes[e++],a=c._$recodes[e++],r=c._$recodes[e++],s=c._$recodes[e++],i=c._$recodes[e++],n=c._$recodes[e++];p.push(h.CUBIC,t*g[0]+a*g[2]-u,t*g[1]+a*g[3]-m,r*g[0]+s*g[2]-u,r*g[1]+s*g[3]-m,i*g[0]+n*g[2]-u,i*g[1]+n*g[3]-m)}break;case h.FILL_STYLE:case h.GRADIENT_FILL:case h.STROKE_STYLE:case h.GRADIENT_STROKE:f=!0,Array.prototype.splice.apply(s._$recodes,[n,0].concat(p)),n+=p.length;case h.CLOSE_PATH:case h.END_STROKE:case h.END_FILL:}if(f)break}}if(s){const e=s.reloadBounds();s._$bounds.xMin=e.xMin,s._$bounds.xMax=e.xMax,s._$bounds.yMin=e.yMin,s._$bounds.yMax=e.yMax,s.cacheClear(),this.reloadScreen()}this._$saved=!1}executeScreenChangeMovieClip(){const e=d.$tools.getDefaultTool("arrow"),t=e.activeElements;if(!t.length)return;if(!d.$timelineLayer.targetLayer)return;this.save();const a=d.$currentWorkSpace(),r=a.scene,s=d.$timelineFrame.currentFrame,i=a.nextLibraryId,n=a.addLibrary(d.$libraryController.createInstance("container",`MovieClip_${i}`,i)),o=new _;n.setLayer(0,o);const l=+document.getElementById("object-x").value,c=+document.getElementById("object-y").value,h=l+ +document.getElementById("object-width").value/2,u=c+ +document.getElementById("object-height").value/2,m=new Map;for(let e=0;e<t.length;++e){const a=t[e],i=r.getLayer(0|a.dataset.layerId),n=i.getCharacter(0|a.dataset.characterId),l=n.getRange(s);m.has(i.id)||m.set(i.id,{layer:i,range:l});const c=new f;c.libraryId=n.libraryId;const g=n.getPlace(l.startFrame),p={frame:1,matrix:g.matrix.slice(),colorTransform:g.colorTransform.slice(),blendMode:g.blendMode,filter:g.filter.slice(),loop:d.$getDefaultLoopConfig(),depth:o._$characters.length};g.loop&&(p.loop=g.loop),c.setPlace(1,p),c.x-=h,c.y-=u,o.addCharacter(c),n.remove(i)}for(const e of m.values()){const t=e.layer,a=e.range,r=t.getActiveCharacter(a.startFrame);if(r.length){t.sort(r,s);for(let e=0;e<r.length;++e)r[e].getPlace(s).depth=e}else t.addEmptyCharacter(new $({startFrame:a.startFrame,endFrame:a.endFrame}));t.reloadStyle()}e.clearActiveElement();const g=new f;g.libraryId=n.id,g.endFrame=s+1,g.setPlace(s,{frame:s,matrix:[1,0,0,1,h/d.$zoomScale,u/d.$zoomScale],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],depth:0,loop:d.$getDefaultLoopConfig()});const p=new _;p.addCharacter(g),r.addLayer(p),s>1&&p.addEmptyCharacter(new $({startFrame:1,endFrame:s})),p.reloadStyle(),this.reloadScreen(),this._$saved=!1}executeScreenAddTweenCurvePointer(){d.$tweenController.addCurvePinter()}executeScreenDeleteTweenCurvePointer(){d.$tweenController.deleteCurvePointer()}executeScreenFront(){this.changeDepth("up")}executeScreenBack(){this.changeDepth("down")}executeScreenFrontOne(){this.changeDepthOne("up")}executeScreenBackOne(){this.changeDepthOne("down")}executeStagePositionLeft(){this.alignment("left","stage")}executeScreenPositionLeft(){this.alignment("left")}executeStagePositionCenter(){this.alignment("center","stage")}executeScreenPositionCenter(){this.alignment("center")}executeStagePositionRight(){this.alignment("right","stage")}executeScreenPositionRight(){this.alignment("right")}executeStagePositionTop(){this.alignment("top","stage")}executeScreenPositionTop(){this.alignment("top")}executeStagePositionMiddle(){this.alignment("middle","stage")}executeScreenPositionMiddle(){this.alignment("middle")}executeStagePositionBottom(){this.alignment("bottom","stage")}executeScreenPositionBottom(){this.alignment("bottom")}alignment(e,t="rect"){const a=d.$tools.getDefaultTool("arrow").activeElements;if(!a.length||"rect"===t&&2>a.length)return;this.save();const r=d.$currentWorkSpace(),s=r.stage;let i=0,n=0,o=0,l=0;if("rect"===t){const e=document.getElementById("target-rect");i=e.offsetLeft-d.$offsetLeft,n=e.offsetTop-d.$offsetTop,o=e.offsetWidth,l=e.offsetHeight}else o=s.width,l=s.height;const c=r.scene;for(let t=0;t<a.length;++t){const r=a[t],s=c.getLayer(0|r.dataset.layerId);if(!s||s.lock||s.disable)continue;const d=s.getCharacter(0|r.dataset.characterId);switch(e){case"left":d.x===d.screenX?d.x=i:d.x=i-d.screenX+d.x;break;case"right":d.x===d.screenX?d.x=i+o-d.width:d.x=i+o-d.width-d.screenX+d.x;break;case"center":d.x===d.screenX?d.x=i+o/2-d.width/2:d.x=i+o/2-d.width/2-d.screenX+d.x;break;case"top":d.y===d.screenY?d.y=n:d.y=n-d.screenY+d.y;break;case"bottom":d.y===d.screenY?d.y=n+l-d.height:d.y=n+l-d.height-d.screenY+d.y;break;case"middle":d.y===d.screenY?d.y=n+l/2-d.height/2:d.y=n+l/2-d.height/2-d.screenY+d.y}}d.$transformController.relocation(),this._$saved=!1}changeDepthOne(e="up"){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;this.save();const a=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame,s=new Map;for(let e=0;e<t.length;++e){const r=t[e],i=a.getLayer(0|r.dataset.layerId);s.has(i.id)||s.set(i.id,[]),s.get(i.id).push(i.getCharacter(0|r.dataset.characterId))}for(const[t,i]of s){const s=a.getLayer(t).getActiveCharacter(r);if(1>=s.length)continue;s.sort(((e,t)=>{const a=e.getPlace(r).depth,s=t.getPlace(r).depth;switch(!0){case a>s:return-1;case a<s:return 1;default:return 0}})),i.length>1&&("up"===e?i.sort(((e,t)=>{const a=e.getPlace(r).depth,s=t.getPlace(r).depth;switch(!0){case a>s:return-1;case a<s:return 1;default:return 0}})):i.sort(((e,t)=>{const a=e.getPlace(r).depth,s=t.getPlace(r).depth;switch(!0){case a>s:return 1;case a<s:return-1;default:return 0}})));let n=0,o=s.length-1;for(let t=0;t<i.length;++t){const a=i[t],l=a.getPlace(r);if("up"===e){if(l.depth>=o){--o;continue}l.depth++;const e=s.indexOf(a);s[e-1].getPlace(r).depth--}else{if(n>=l.depth){++n;continue}l.depth--;const e=s.indexOf(a);s[e+1].getPlace(r).depth++}s.sort(((e,t)=>{const a=e.getPlace(r).depth,s=t.getPlace(r).depth;switch(!0){case a>s:return-1;case a<s:return 1;default:return 0}}))}}this.reloadScreen(),this._$saved=!1}changeDepth(e="up"){const t=d.$tools.getDefaultTool("arrow").activeElements;if(!t.length)return;this.save();const a=d.$currentWorkSpace().scene,r=d.$timelineFrame.currentFrame,s=new Map;for(let e=0;e<t.length;++e){const r=t[e],i=a.getLayer(0|r.dataset.layerId);s.has(i.id)||s.set(i.id,[]),s.get(i.id).push(i.getCharacter(0|r.dataset.characterId))}for(const[t,i]of s){const s=a.getLayer(t).getActiveCharacter(r);if(1>=s.length)continue;s.sort(((e,t)=>{const a=e.getPlace(r).depth,s=t.getPlace(r).depth;switch(!0){case a>s:return-1;case a<s:return 1;default:return 0}})),i.length>1&&("up"===e?i.sort(((e,t)=>{const a=e.getPlace(r).depth,s=t.getPlace(r).depth;switch(!0){case a>s:return-1;case a<s:return 1;default:return 0}})):i.sort(((e,t)=>{const a=e.getPlace(r).depth,s=t.getPlace(r).depth;switch(!0){case a>s:return 1;case a<s:return-1;default:return 0}})));const n=new Map;let o=0,l=s.length-1;for(let t=0;t<i.length;++t){const a=i[t],c=a.getPlace(r);if("up"===e){if(c.depth>=l){--l;continue}c.depth=l--,n.set(a.id,!0);let e=l;for(let t=0;s.length>t;++t){const a=s[t];if(!n.has(a.id)&&(a.getPlace(r).depth=e--,-1===e))break}}else{if(o>=c.depth){++o;continue}c.depth=o++,n.set(a.id,!0);let e=o;for(let t=s.length-1;t>-1;--t){const a=s[t];if(!n.has(a.id)&&(a.getPlace(r).depth=e++,e===s.length))break}}}}this.reloadScreen(),this._$saved=!1}show(e){d.$endMenu("screen-menu");const t=document.getElementById("screen-menu"),a=t.clientHeight/2+15;if(t.style.left=`${e.pageX+5}px`,t.style.top=e.pageY-a+"px",15>t.offsetTop&&(t.style.top="10px"),e.pageY+a>window.innerHeight){const r=window.innerHeight-(e.pageY+a-15);t.style.top=`${t.offsetTop+r}px`}t.setAttribute("class","fadeIn")}};d.$screenTab=new class{constructor(){this._$dropTab=null,this._$saved=!1}run(){for(let e=0;e<d.$workSpaces.length;++e)this.createElement(d.$workSpaces[e],e);const e=document.getElementById("view-tab-add");e&&e.addEventListener("click",(e=>{this.addTab(e)}));const t=document.getElementById("view-tab-list");t&&t.addEventListener("mousedown",(e=>{this.showTabList(e)}))}showTabList(e){e.stopPropagation();const t=document.getElementById("tab-name-menu");if(t.classList.contains("fadeIn"))return d.$endMenu();d.$endMenu("tab-name-menu");const a=e.currentTarget;t.style.left=`${a.offsetLeft+a.offsetWidth}px`,t.style.top=`${a.offsetTop+25}px`,t.setAttribute("class","fadeIn")}createElement(e,t){e.name||(e.name=`Untitled-${t+1}`),document.getElementById("view-tab-area").insertAdjacentHTML("beforeend",`\n<div draggable="true" id="tab-id-${t}" data-tab-id="${t}" class="tab">\n    <p id="tab-text-id-${t}" data-tab-id="${t}" data-detail="{{タブの移動・名前を変更}}" data-shortcut-key="ArrowLeftCtrl" data-shortcut-text="Ctrl + ◀︎ or ▶" data-area="global">${e.name}</p>\n    <input type="text" id="tab-input-id-${t}" data-tab-id="${t}" value="${e.name}">\n    <i id="tab-delete-id-${t}" data-tab-id="${t}" data-detail="{{プロジェクトを閉じる}}"></i>\n</div>`);const a=document.getElementById(`tab-id-${t}`);d.$addModalEvent(a),a.classList.add(d.$activeWorkSpaceId===t?"active":"disable"),a.addEventListener("mousedown",(e=>{this.activeTab(e)})),a.addEventListener("dragstart",(e=>{this.dragStart(e)})),a.addEventListener("dragover",(e=>{this.dragOver(e)})),a.addEventListener("dragleave",(e=>{this.dragLeave(e)})),a.addEventListener("drop",(e=>{this.drop(e)})),document.getElementById(`tab-delete-id-${t}`).addEventListener("click",(e=>{this.deleteTab(e)})),document.getElementById(`tab-text-id-${t}`).addEventListener("dblclick",(e=>{this.editStart(e)}));const r=document.getElementById(`tab-input-id-${t}`);r&&(r.style.display="none",r.addEventListener("focusout",(e=>{this.editEnd(e)})),r.addEventListener("keypress",(e=>{this.editEnd(e)}))),document.getElementById("tab-name-menu-list").insertAdjacentHTML("beforeend",`\n<div id="tab-menu-id-${t}" data-tab-id="${t}">${e.name}</div>`);const s=document.getElementById(`tab-menu-id-${t}`);s&&s.addEventListener("mousedown",(e=>{this.activeTab(e,!0)}))}drop(e){e.preventDefault(),this.save(),e.currentTarget.classList.remove("drop-target");const t=e.currentTarget.nextElementSibling;document.getElementById("view-tab-area").insertBefore(this._$dropTab,this._$dropTab===t?e.currentTarget:t),this._$dropTab=null,this._$saved=!1}dragLeave(e){e.preventDefault(),e.currentTarget.classList.remove("drop-target")}dragOver(e){e.preventDefault(),e.currentTarget.classList.add("drop-target")}dragStart(e){d.$endMenu(),this._$dropTab=e.currentTarget}activeTab(e,t=!1){d.$endMenu();const a=document.getElementById(`tab-id-${d.$activeWorkSpaceId}`);a&&(a.classList.remove("active"),a.classList.add("disable"));const r=0|e.currentTarget.dataset.tabId,s=document.getElementById(`tab-id-${r}`);if(s&&(s.classList.remove("disable"),s.classList.add("active"),t)){const e=document.getElementById("view-tab-area");s.remove(),e.prepend(s)}d.$activeWorkSpaceId!==r&&d.$changeWorkSpace(r)}deleteTab(e){e.preventDefault();const t=d.$currentLanguage.replace("{{プロジェクトが保存されていない場合、このタブのプロジェクトデータを復旧する事はできません。タブを削除しますか？}}");if(!window.confirm(t))return;const a=0|e.currentTarget.dataset.tabId;d.$workSpaces[a]=null,document.getElementById(`tab-id-${a}`).remove(),document.getElementById(`tab-menu-id-${a}`).remove();const r=document.getElementById("library-preview-area");for(;r.children.length;)r.children[0].remove();const s=document.getElementById("view-tab-area");if(s.children.length){if(d.$activeWorkSpaceId===a){const e=s.children[0];e.setAttribute("class","tab active"),d.$activeWorkSpaceId=0|e.dataset.tabId,d.$currentWorkSpace().run()}}else{d.$workSpaces.length=0,d.$activeWorkSpaceId=0;const e=new U;d.$workSpaces.push(e),this.createElement(e,0),e.run();s.children[0].setAttribute("class","tab active")}}editStart(e){d.$keyLock=!0;const t=e.currentTarget,a=0|t.dataset.tabId,r=document.getElementById(`tab-input-id-${a}`);if("none"===r.style.display){r.style.width=`${t.offsetWidth}px`,r.style.display="",t.style.display="none",r.focus();document.getElementById(`tab-id-${a}`).draggable=!1}}editEnd(e){if("Enter"!==e.key){if("focusout"===e.type){this.save();const t=e.currentTarget;t.style.display="none";const a=0|t.dataset.tabId,r=document.getElementById(`tab-text-id-${a}`),s=document.getElementById(`tab-menu-id-${a}`);d.$workSpaces[a].name=t.value,s.textContent=t.value,r.textContent=t.value,r.style.display="";document.getElementById(`tab-id-${a}`).draggable=!0,this._$saved=!1}}else e.target.blur()}addTab(e){d.$endMenu(),e.stopPropagation(),this.save();const t=d.$workSpaces.length,a=new U;d.$workSpaces.push(a),this.createElement(a,t),this._$saved=!1}save(){this._$saved||(this._$saved=!0,d.$currentWorkSpace().temporarilySaved())}};class _e extends ye{constructor(){super(),this._$currentValue=0}static get MIN_LEVEL(){return.25}static get MAX_LEVEL(){return 5}initialize(){super.initialize();const e=document.getElementById("screen-scale");e&&(e.addEventListener("focusin",(e=>{this.focusIn(e)})),e.addEventListener("keypress",(e=>{this.keypress(e)})),e.addEventListener("focusout",(e=>{this.focusOut(e)})))}keypress(e){"Enter"===e.key&&e.currentTarget.blur()}focusIn(e){d.$keyLock=!0,this._$currentValue=0|e.target.value}focusOut(e){this.execute((this._$currentValue-(0|e.target.value))/100*-1),d.$keyLock=!1,this._$currentValue=0|e.target.value}execute(e){d.$zoomScale+=e,d.$zoomScale=Math.min(_e.MAX_LEVEL,Math.max(_e.MIN_LEVEL,d.$zoomScale)),document.getElementById("screen-scale").value=""+(100*d.$zoomScale|0);const t=d.$currentWorkSpace(),a=t.stage.width*d.$zoomScale,r=t.stage.height*d.$zoomScale,s=document.getElementById("screen"),i=document.getElementById("stage-area"),n=document.getElementById("stage"),o=s.clientWidth/(i.clientWidth/s.clientWidth),l=s.clientHeight/(i.clientHeight/s.clientHeight),c=s.scrollLeft/s.scrollWidth,h=s.scrollTop/s.scrollHeight;n.style.width=`${a}px`,n.style.height=`${r}px`,i.style.width=`${a+window.screen.width}px`,i.style.height=`${r+window.screen.height}px`;const u=s.clientWidth/(i.clientWidth/s.clientWidth),m=s.clientHeight/(i.clientHeight/s.clientHeight);s.scrollLeft=s.scrollWidth*c+(o-u),s.scrollTop=s.scrollHeight*h+(l-m);const g=d.$timelineFrame.currentFrame,p=t.scene;for(const e of p._$layers.values()){const t=e.getActiveCharacter(g);for(let e=0;e<t.length;++e)t[e]._$image=null}p.changeFrame(g)}}d.$screenZoom=new _e;class be{constructor(){this._$begin=!1}beginDraw(){this._$begin=!0}}class ve{constructor(){this._$timeline=new xe,this._$library=new we}getTimeline(){return this._$timeline}get library(){return this._$library}}class Ee{constructor(e,t){this._$character=e,this._$parent=t}get x(){return this._$character.x}set x(e){this._$character.x=e;const t=d.$currentWorkSpace().getLibrary(this._$character.libraryId);let a=d.$timelineFrame.currentFrame;const r=this._$character.getPlace(a);let s=Object.keys(r);const i={};for(let e=0;e<s.length;++e){const t=s[e];i[t]=r[t]}i.loop=d.$getDefaultLoopConfig(),i.startFrame=this._$character.startFrame,i.endFrame=this._$character.endFrame;const n=d.$boundsMatrix(t.getBounds(i),i.matrix),o=d.$offsetLeft+n.xMin*d.$zoomScale;this._$character._$screenX=o,document.getElementById(`character-${this._$character.id}`).style.left=`${o}px`}get y(){return this._$character.y}set y(e){this._$character.y=e;const t=d.$currentWorkSpace().getLibrary(this._$character.libraryId);let a=d.$timelineFrame.currentFrame;const r=this._$character.getPlace(a);let s=Object.keys(r);const i={};for(let e=0;e<s.length;++e){const t=s[e];i[t]=r[t]}i.loop=d.$getDefaultLoopConfig(),i.startFrame=this._$character.startFrame,i.endFrame=this._$character.endFrame;const n=d.$boundsMatrix(t.getBounds(i),i.matrix),o=d.$offsetTop+n.yMin*d.$zoomScale;this._$character._$screenY=o,document.getElementById(`character-${this._$character.id}`).style.top=`${o}px`}get libraryItem(){return new we(d.$currentWorkSpace().getLibrary(this._$character.libraryId))}get loop(){if("container"!==d.$currentWorkSpace().getLibrary(this._$character.libraryId).type)return"";const e=this._$character.getPlace(this._$character.startFrame);if(!e.loop)return"loop";switch(e.loop.type){case 1:case 3:return"play once";case 2:return"single frame";default:return"loop"}}set loop(e){if("container"!==d.$currentWorkSpace().getLibrary(this._$character.libraryId).type)return;const t=this._$character.getPlace(this._$character.startFrame);switch(e){case"loop":t.loop.type=0;break;case"play once":t.loop.type=1;break;case"single frame":t.loop.type=2;break;default:t.loop.type=d.DEFAULT_LOOP}}get symbolType(){return"container"===d.$currentWorkSpace().getLibrary(this._$character.libraryId).type?"movie clip":""}set symbolType(e){switch(e){case"button":case"movie clip":case"graphic":{const e=d.$currentWorkSpace();if("container"===e.getLibrary(this._$character.libraryId).type)return;const t=e.nextLibraryId,a=e.addLibrary(d.$controller.createContainer("container",`MovieClip_${t}`,t)),r=this._$character.clone(),s=r._$endFrame-r._$startFrame+1,i=r._$startFrame-1,n=new Map;for(let[e,t]of r._$places)t.frame=e-i,n.set(t.frame,t);r._$places=n,r._$startFrame=1,r._$endFrame=s;const o=new _,l=this._$parent._$layer._$frame;for(let[e,t]of l._$classes)1>e-i||o._$frame._$classes.set(e-i,t);a.setLayer(a._$layerId++,o),o.addCharacter(r),this._$character._$currentFrame=0,this._$character._$currentPlace=null,this._$character._$image=null,this._$character._$libraryId=t;for(let e of this._$character._$places.values())e.loop=d.$getDefaultLoopConfig();e.scene.changeFrame(d.$timelineFrame.currentFrame)}}}}class Ie{constructor(e,t){this._$frame=e,this._$parent=t}get elements(){const e=this._$parent._$layer.getActiveCharacter(this._$frame),t=[];for(let a=0;a<e.length;++a)t.push(new Ee(e[a],this._$parent));return t}}class Se{constructor(e){this._$layer=e}get frames(){const e=[void 0],t=this._$layer.totalFrame;for(let a=1;t>=a;++a)e.push(new Ie(a,this));return e}get locked(){return this._$layer.lock}set locked(e){this._$layer.lock=!!e;const t=document.getElementById(`layer-lock-icon-${this._$layer.id}`);t.classList.remove("icon-disable","icon-active"),t.classList.add(this._$layer.lock?"icon-active":"icon-disable")}get name(){return this._$layer.name}}class we{constructor(e=null){this._$instance=e}get name(){if(!this._$instance)return"";const e=d.$currentWorkSpace();let t=this._$instance.name;if(this._$instance._$folderId){let a=this._$instance;for(;a._$folderId;)a=e.getLibrary(a._$folderId),t=`${a.name}/${t}`}return t}getItem(e){const t=(e=`${e}`).split("/"),a=t.pop(),r=d.$currentWorkSpace();for(let e of r._$libraries.values())if(e.name===a){if(t.length){if(!e._$folderId)continue;let a=!0,s=t.length-1,i=e;for(;i._$folderId;)if(i=r.getLibrary(i._$folderId),i.name!==t[s--]){a=!1;break}if(!a)continue}return new we(e)}return null}toImage(e=0,t=0,a=1){if(!this._$instance)return new Image(e,t);const r=this._$instance.getBounds(null,!0);e||(e=Math.abs(r.xMax-r.xMin)),t||(t=Math.abs(r.yMax-r.yMin));const s=d.$currentFrame;d.$currentFrame=a;const i=this._$instance.toImage(Math.ceil(e),Math.ceil(t),{frame:1,matrix:[1,0,0,1,0,0],colorTransform:[1,1,1,1,0,0,0,0],blendMode:"normal",filter:[],loop:d.$getDefaultLoopConfig()});return d.$currentFrame=s,i}addItemToDocument(e,t){if(!e||!t)return!1;const a=(t=`${t}`).split("/"),r=a.pop(),s=d.$currentWorkSpace();for(let t of s._$libraries.values())if(t.name===r){if(a.length){if(!t._$folderId)continue;let e=!0,r=a.length-1,i=t;for(;i._$folderId;)if(i=s.getLibrary(i._$folderId),i.name!==a[r--]){e=!1;break}if(!e)continue}return d.$dragElement={dataset:{libraryId:t.id}},d.$screen.dropObject({offsetX:e.x+d.$offsetLeft,offsetY:e.y+d.$offsetTop}),d.$dragElement=null,!0}return!1}}class xe{get currentFrame(){return d.$timelineFrame.currentFrame}get currentLayer(){const e=d.$timelineLayer.targetLayer;if(!e)return 0;const t=0|e.dataset.layerId,a=d.$currentWorkSpace().scene;return 0|Array.from(a._$layers.keys()).indexOf(t)}set currentLayer(e){const t=d.$currentWorkSpace().scene,a=Array.from(t._$layers.keys())[e];d.$timeline._$targetLayer.classList.remove("active"),d.$screen.clearActiveCharacter();const r=document.getElementById(`layer-id-${a}`);r.classList.add("active"),d.$timeline._$targetLayer=r}get layers(){const e=d.$currentWorkSpace().scene,t=[];for(const a of e._$layers.values())t.push(new Se(a));return t}getSelectedLayers(){return d.$timeline._$targetLayer?[this.currentLayer]:[]}addNewLayer(e="",t="normal",a=!0){const r=d.$currentWorkSpace().scene,s=new _;switch(e&&(s.name=e),t){case"mask":s.mode=d.LAYER_MODE_MASK;break;case"masked":s.mode=d.LAYER_MODE_MASK_IN}const i=this.currentLayer;d.$timeline._$targetLayer.classList.remove("active"),d.$screen.clearActiveCharacter();let n=0;const o=new Map;for(const e of r._$layers.values())a&&n===i&&o.set(n++,s),o.set(n++,e),a||n!==i+1||o.set(n++,s);r._$layers=o,r.initialize();const l=document.getElementById(`layer-id-${s.id}`);l.classList.add("active"),d.$timeline._$targetLayer=l,d.$timeline.resetFrames();const c=document.getElementById(`${s.id}-${this.currentFrame}`);return c.classList.add("frame-active"),d.$timeline._$targetFrame=c,d.$timeline._$targetFrames=[c],new Se(s)}setSelectedFrames(e,t){const a=d.$timeline._$targetLayer;if(!a)return;d.$timeline.resetFrames(),t=Math.max(e,t);const r=[],s=0|a.dataset.layerId;for(let a=e;t>=a;++a){const e=document.getElementById(`${s}-${a}`);e.classList.add("frame-active"),r.push(e)}d.$timeline._$targetFrame=r[0],d.$timeline._$targetFrames=r}clearKeyframes(e=-1,t=-1){const a=d.$timeline._$targetFrames;a.length&&(-1===e&&(e=0|a[0].dataset.frame),-1===t&&(t=0|a[a.length-1].dataset.frame)),-1===t&&(t=e),-1!==e&&-1!==t&&(this.setSelectedFrames(e,t),d.$timeline.deleteFrame(),d.$timeline.resetFrames())}convertToBlankKeyframes(e=-1,t=-1){const a=d.$timeline._$targetFrames;if(a.length&&(-1===e&&(e=0|a[0].dataset.frame),-1===t&&(t=0|a[a.length-1].dataset.frame)),-1===t&&(t=e),-1===e||-1===t)return;this.setSelectedFrames(e,t),d.$timeline.addEmptyFrame();const r=d.$timeline._$targetFrames.pop();d.$timeline._$targetFrames.length&&d.$timeline.addSpaceFrame(),d.$timeline._$targetFrames.push(r)}}class Le extends Y{constructor(e){super(e)}}e.nt=e.fl=new class{constructor(){this._$dom=new ve,this._$panel=new Map,this._$drawingLayer=new be}get drawingLayer(){return this._$drawingLayer}addMenu(e,t=null){const a=document.getElementById("plugin-menu"),r=document.createElement("div");r.classList.add("screen-menu-bottom"),r.textContent=e,t&&r.addEventListener("mousedown",t),a.appendChild(r)}createPanel(e,t,a=200,r=200){this._$panel.set(e,{width:a,height:r,element:t})}showPanel(e){if(!this._$panel.has(e))return;document.getElementById("plugin-title").textContent=e;const t=this._$panel.get(e);document.getElementById("plugin-modal-element").appendChild(t.element),document.documentElement.style.setProperty("--plugin-modal-width",`${t.width}px`),document.documentElement.style.setProperty("--plugin-modal-height",`${t.height}px`);const a=document.getElementById("plugin-modal");a.style.top="100px",a.style.left="100px",a.setAttribute("class","fadeIn"),d.$endMenu("plugin-modal")}hidePanel(){d.$endMenu();const e=document.getElementById("plugin-modal-element").children;for(;e.length;)e[0].remove()}getDocumentDOM(){return this._$dom}addTool(e){return new Le(e)}setShortcut(e,t,a){switch(e){case"global":d.$setShortcut(t,a);break;case"screen":d.$screenKeyboardCommand.add(t,a);break;case"timeline":d.Util.$timelineKeyboardCommand.add(t,a);break;case"library":d.Util.$libraryKeyboardCommand.add(t,a)}}deleteShortcut(e,t){switch(e){case"global":d.$deleteShortcut(t);break;case"screen":d.$screenKeyboardCommand.delete(t);break;case"timeline":d.Util.$timelineKeyboardCommand.delete(t);break;case"library":d.Util.$libraryKeyboardCommand.delete(t)}}}}(this);