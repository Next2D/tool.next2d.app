let P_=0;const Zu=()=>P_++;let k_=0;const N_=()=>k_++,ri=(s=null)=>{};let Ju="";const Qu=()=>Ju,Oe=s=>{Ju=s};let tl=null;const oi=()=>tl,Te=(s=null)=>{tl=s};let el=1;const Rc=()=>el,D_=s=>{el=s},Ut=window,Dt=Ut.document;class Ao{constructor(t="",e=""){this._$name=`${t}`,this._$value=`${e}`}static toString(){return"[class URLRequestHeader]"}static get namespace(){return"next2d.net.URLRequestHeader"}toString(){return"[object URLRequestHeader]"}get namespace(){return"next2d.net.URLRequestHeader"}get name(){return this._$name}get value(){return this._$value}}let at=1;const U_=s=>{at=s};let Y_=0;const X_=()=>Y_++;let sl=!1;const W_=()=>sl,pt=(s=!0)=>{sl=s},bt=1/0,d=Math,le=Array,V_=Map,ft=Number,ne=Float32Array,Ja=Int32Array,G_=Int16Array,il=OffscreenCanvas,Ie=isNaN,Ze=requestAnimationFrame,us=cancelAnimationFrame,$r=performance,_r=setTimeout,qt=clearTimeout,Jt=new ne([1,0,0,1,0,0]),vr=new ne([1,1,1,1,0,0,0,0]),Qt=-32768,te=32767,Qe=d.PI/180,z_=180/d.PI,rl=[],nl=[],al=[],ol=[],cl=[],ul=[],ll=[],hl=[],dl=[],Gr=new il(1,1).getContext("2d"),et=(s=0,t=0,e=0,i=0)=>{const r=dl.pop()||{xMin:0,xMax:0,yMin:0,yMax:0};return r.xMin=s,r.xMax=t,r.yMin=e,r.yMax=i,r},W=s=>{dl.push(s)},He=(s=0,t=0,e=0,i=0)=>{const r=al.pop()||new ne(4);return r[0]=s,r[1]=t,r[2]=e,r[3]=i,r},Fc=s=>{al.push(s)},Pc=(s=0,t=0,e=0,i=0)=>{const r=nl.pop()||new Ja(4);return r[0]=s,r[1]=t,r[2]=e,r[3]=i,r},H_=s=>{nl.push(s)},Pt=(s=0,t=0,e=0,i=0,r=0,n=0)=>{const a=ol.pop()||new ne(6);return a[0]=s,a[1]=t,a[2]=e,a[3]=i,a[4]=r,a[5]=n,a},tt=s=>{ol.push(s)},Hn=(s=1,t=1,e=1,i=1,r=0,n=0,a=0,o=0)=>{const c=cl.pop()||new ne(8);return c[0]=s,c[1]=t,c[2]=e,c[3]=i,c[4]=r,c[5]=n,c[6]=a,c[7]=o,c},$s=s=>{cl.push(s)},bn=(s=0,t=0,e=0,i=0,r=0,n=0,a=0,o=0,c=0)=>{const u=ul.pop()||new ne(9);return u[0]=s,u[1]=t,u[2]=e,u[3]=i,u[4]=r,u[5]=n,u[6]=a,u[7]=o,u[8]=c,u},j_=s=>{ul.push(s)},A=(...s)=>{const t=ll.pop()||[];return s.length&&t.push(...s),t},V=(s=null)=>{s&&(s.length&&(s.length=0),ll.push(s))},Pe=s=>{s.size&&s.clear(),hl.push(s)},yt=()=>hl.pop()||new V_,rr=s=>(s--,s|=s>>1,s|=s>>2,s|=s>>4,s|=s>>8,s|=s>>16,s++,s),kc=s=>{const t=-819.2*s[0]-819.2*s[2]+s[4],e=819.2*s[0]-819.2*s[2]+s[4],i=-819.2*s[0]+819.2*s[2]+s[4],r=-819.2*s[1]-819.2*s[3]+s[5],n=819.2*s[1]-819.2*s[3]+s[5],a=-819.2*s[1]+819.2*s[3]+s[5];let o=i-t,c=a-r;const u=d.sqrt(o*o+c*c);u?(o=o/u,c=c/u):(o=0,c=0);const l=(e-t)*o+(n-r)*c;return He(t+l*o,r+l*c,e,n)},Be=s=>{const t=1/(s[0]*s[4]-s[3]*s[1]),e=s[3]*s[7]-s[4]*s[6],i=s[1]*s[6]-s[0]*s[7];return bn(s[4]*t,0-s[1]*t,0,0-s[3]*t,s[0]*t,0,e*t,i*t,1)},O=(s,t,e,i=null)=>{const r=+s;return Ie(r)&&i!==null?i:d.min(d.max(t,Ie(r)?0:r),e)},ct=(s,t)=>Pt(s[0]*t[0]+s[2]*t[1],s[1]*t[0]+s[3]*t[1],s[0]*t[2]+s[2]*t[3],s[1]*t[2]+s[3]*t[3],s[0]*t[4]+s[2]*t[5]+s[4],s[1]*t[4]+s[3]*t[5]+s[5]),yi=(s,t)=>Hn(s[0]*t[0],s[1]*t[1],s[2]*t[2],s[3]*t[3],s[0]*t[4]+s[4],s[1]*t[5]+s[5],s[2]*t[6]+s[6],s[3]*t[7]+s[7]),wt=(s,t)=>{const e=s.xMax*t[0]+s.yMax*t[2]+t[4],i=s.xMax*t[0]+s.yMin*t[2]+t[4],r=s.xMin*t[0]+s.yMax*t[2]+t[4],n=s.xMin*t[0]+s.yMin*t[2]+t[4],a=s.xMax*t[1]+s.yMax*t[3]+t[5],o=s.xMax*t[1]+s.yMin*t[3]+t[5],c=s.xMin*t[1]+s.yMax*t[3]+t[5],u=s.xMin*t[1]+s.yMin*t[3]+t[5],l=d.min(ft.MAX_VALUE,e,i,r,n),h=d.max(0-ft.MAX_VALUE,e,i,r,n),$=d.min(ft.MAX_VALUE,a,o,c,u),_=d.max(0-ft.MAX_VALUE,a,o,c,u);return et(l,h,$,_)},$l=s=>{if(!Gr)return 0;Gr.fillStyle=s;const t=+`0x${Gr.fillStyle.slice(1)}`;return Gr.fillStyle="rgba(0, 0, 0, 1)",t},It=s=>Ie(+s)?$l(`${s}`):+s,_l=s=>({A:s>>>24,R:(s&16711680)>>16,G:(s&65280)>>8,B:s&255}),ci=(s,t,e)=>(s>>16)*(e?t:1)/255,ui=(s,t,e)=>(s>>8&255)*(e?t:1)/255,li=(s,t,e)=>(s&255)*(e?t:1)/255,ve=(s,t=1)=>({R:(s&16711680)>>16,G:(s&65280)>>8,B:s&255,A:t*255}),K_=(s,t,e=!1,i=!1)=>{let r="";return e&&(r="italic "),i&&(r+="bold "),`${r}${t}px '${s}','sans-serif'`},q_=()=>rl.pop()||{isLayer:!1,isUpdated:null,canApply:null,matrix:null,color:null,blendMode:"normal",filters:null,sw:0,sh:0},qi=s=>{s.color&&$s(s.color),s.isLayer=!1,s.isUpdated=null,s.canApply=null,s.matrix=null,s.color=null,s.filters=null,s.blendMode="normal",s.sw=0,s.sh=0,rl.push(s)};class Z_{constructor(){this._$pool=[],this._$store=new Map,this._$timerMap=new Map,this._$context=null}set context(t){this._$context=t}reset(){for(const t of this._$store.values()){for(const e of t.values())this.destroy(e);Pe(t)}this._$store.clear(),this._$context&&this._$context.frameBuffer.clearCache()}destroy(t=null){if(!(!t||typeof t!="object")){if(t instanceof WebGLTexture){Ze(()=>{this._$context&&this._$context.frameBuffer.releaseTexture(t)});return}if("canvas"in t&&t instanceof CanvasRenderingContext2D){const e=t.canvas,i=e.width,r=e.height;t.clearRect(0,0,i+1,r+1),e.width=e.height=1,this._$pool.push(e)}this._$context&&"index"in t&&this._$context.frameBuffer.textureManager.releasePosition(t)}}getCanvas(){return this._$pool.pop()||document.createElement("canvas")}remove(t,e){if(!this._$store.has(t))return;const i=this._$store.get(t);i.has(e)&&(i.delete(e),i.size||(Pe(i),this._$store.delete(t)))}stopTimer(t){t=`${t}`,this._$timerMap.has(t)&&(qt(this._$timerMap.get(t)),this._$timerMap.delete(t))}removeCache(t){if(t=`${t}`,this._$store.has(t)){const e=this._$store.get(t);for(const i of e.values())this.destroy(i);e.clear(),Pe(e),this._$store.delete(t)}this._$timerMap.delete(t)}setRemoveTimer(t){if(t=`${t}`,this.stopTimer(t),this._$store.has(t)){const e=_r(()=>{this.removeCache(t)},5e3);this._$timerMap.set(t,e)}}get(t){const e=`${t[0]}`,i=`${t[1]}`;if(this._$store.has(e)){this.stopTimer(e);const r=this._$store.get(e);if(r.has(i))return r.get(i)}return null}set(t,e=null){const i=`${t[0]}`,r=`${t[1]}`;this._$store.has(i)||this._$store.set(i,yt());const n=this._$store.get(i);if(e===null){if(!n.has(r))return;this.destroy(n.get(r)),n.delete(r),n.size||(Pe(n),this._$store.delete(i));return}n.set(r,e)}has(t){const e=`${t[0]}`;return this._$store.has(e)?this._$store.get(e).has(`${t[1]}`):!1}generateKeys(t,e=null,i=null){let r="";e&&e.length&&(r+=`${e[0]}_${e[1]}`),i&&i.length&&(r+=i[7]===0?"":`_${i[7]}`);const n=A();if(r){let a=0;const o=r.length;for(let c=0;c<o;c++){const u=r.charCodeAt(c);a=(a<<5)-a+u,a|=0}n[1]=`_${a}`}else n[1]="_0";return n[0]=`${t}`,n}}const J=new Z_;class Lo{constructor(t=""){this._$url=`${t}`,this._$contentType="application/json",this._$data="",this._$method="GET",this._$requestHeaders=A(),this._$responseDataFormat="json",this._$withCredentials=!1}static toString(){return"[class URLRequest]"}static get namespace(){return"next2d.net.URLRequest"}toString(){return"[object URLRequest]"}get namespace(){return"next2d.net.URLRequest"}get contentType(){return this._$contentType}set contentType(t){this._$contentType=`${t}`}get data(){return this._$data}set data(t){this._$data=t}get method(){return this._$method}set method(t){this._$method=`${t}`}get requestHeaders(){return this._$requestHeaders}set requestHeaders(t){this._$requestHeaders.length=0,this._$requestHeaders.push(...t)}get url(){if(this._$url&&this._$url.indexOf("//")===-1){const t=this._$url.split("/");(t[0]===""||t[0]===".")&&t.shift();const e=nt();if(e)return`${e.base}${t.join("/")}`}return this._$url}set url(t){this._$url=`${t}`}get responseDataFormat(){return this._$responseDataFormat}set responseDataFormat(t){this._$responseDataFormat=`${t}`}get withCredentials(){return this._$withCredentials}set withCredentials(t){this._$withCredentials=t}get headers(){const t=A();return t.push(new Ao("Content-Type",`${this._$contentType}`)),this._$requestHeaders.length&&t.push(...this._$requestHeaders),t}}class ws{static toString(){return"[class EventPhase]"}static get namespace(){return"next2d.events.EventPhase"}toString(){return"[object EventPhase]"}get namespace(){return"next2d.events.EventPhase"}static get AT_TARGET(){return 2}static get BUBBLING_PHASE(){return 3}static get CAPTURING_PHASE(){return 1}}let S=class{constructor(t,e=!1,i=!1){this._$type=`${t}`,this._$bubbles=e,this._$cancelable=i,this._$target=null,this._$currentTarget=null,this._$eventPhase=ws.AT_TARGET,this._$listener=null,this._$stopImmediatePropagation=!1,this._$stopPropagation=!1}static toString(){return"[class Event]"}static get namespace(){return"next2d.events.Event"}toString(){return this.formatToString("Event","type","bubbles","cancelable","eventPhase")}get namespace(){return"next2d.events.Event"}static get ACTIVATE(){return"activate"}static get ADDED(){return"added"}static get ADDED_TO_STAGE(){return"addedToStage"}static get CHANGE(){return"change"}static get COMPLETE(){return"complete"}static get DEACTIVATE(){return"deactivate"}static get ENTER_FRAME(){return"enterFrame"}static get EXIT_FRAME(){return"exitFrame"}static get FRAME_CONSTRUCTED(){return"frameConstructed"}static get FRAME_LABEL(){return"frameLabel"}static get INIT(){return"init"}static get LOAD(){return"load"}static get MOUSE_LEAVE(){return"mouseLeave"}static get REMOVED(){return"removed"}static get REMOVED_FROM_STAGE(){return"removedFromStage"}static get RENDER(){return"render"}static get RESIZE(){return"resize"}static get SCROLL(){return"scroll"}static get OPEN(){return"open"}static get STOP(){return"stop"}static get SOUND_COMPLETE(){return"soundComplete"}static get UPDATE(){return"update"}get bubbles(){return this._$bubbles}get cancelable(){return this._$cancelable}get currentTarget(){return this._$currentTarget}set currentTarget(t){this._$currentTarget=t}get eventPhase(){return this._$eventPhase}set eventPhase(t){this._$eventPhase=t}get listener(){return this._$listener}set listener(t){this._$listener=t}get target(){return this._$target?this._$target:this._$currentTarget}set target(t){this._$target=t}get type(){return this._$type}formatToString(...t){let e=`[${t[0]}`;for(let i=1;i<t.length;++i){const r=t[i];e+=` ${r}=`;const n=this[r];typeof n=="string"?e+=`"${n}"`:e+=`${n}`}return`${e}]`}stopImmediatePropagation(){this._$stopImmediatePropagation=!0}stopPropagation(){this._$stopPropagation=!0}},Ei=class{constructor(){this._$events=null}static toString(){return"[class EventDispatcher]"}static get namespace(){return"next2d.events.EventDispatcher"}toString(){return"[object EventDispatcher]"}get namespace(){return"next2d.events.EventDispatcher"}addEventListener(t,e,i=!1,r=0){const n=nt();let a,o=!1;switch(t=`${t}`,t){case S.ENTER_FRAME:case S.EXIT_FRAME:case S.FRAME_CONSTRUCTED:case S.RENDER:case S.ACTIVATE:case S.DEACTIVATE:case"keyDown":case"keyUp":(!n.broadcastEvents.size||!n.broadcastEvents.has(t))&&n.broadcastEvents.set(t,A()),a=n.broadcastEvents.get(t)||A(),o=!0;break;default:this._$events||(this._$events=yt()),(!this._$events.size||!this._$events.has(t))&&this._$events.set(t,A()),a=this._$events.get(t)||A();break}let c=a.length;for(let u=0;u<c;++u){const l=a[u];i===l.useCapture&&l.target===this&&l.listener===e&&(c=u)}a[c]={listener:e,priority:r,useCapture:i,target:this},a.length>1&&a.sort(function(u,l){switch(!0){case u.priority>l.priority:return-1;case u.priority<l.priority:return 1;default:return 0}}),o?n.broadcastEvents.set(t,a):(this._$events||(this._$events=yt()),this._$events.set(t,a))}dispatchEvent(t){switch(t.type){case S.ENTER_FRAME:case S.EXIT_FRAME:case S.FRAME_CONSTRUCTED:case S.RENDER:case S.ACTIVATE:case S.DEACTIVATE:case"keyDown":case"keyUp":{const e=nt();if(e&&e.broadcastEvents.size&&e.broadcastEvents.has(t.type)){const i=e.broadcastEvents.get(t.type);for(let r=0;r<i.length;++r){const n=i[r];if(n.target===this){t.eventPhase=ws.AT_TARGET,t.currentTarget=n.target;try{t.listener=n.listener,n.listener.call(null,t)}catch(a){return console.error(a),!1}}}return!0}}break;default:{let e=null;this._$events&&this._$events.size&&this._$events.has(t.type)&&(e=this._$events.get(t.type),e&&(e=e.slice(0))),e||(e=A());const i=A();if("parent"in this){let r=this.parent;for(;r;){if(r.hasEventListener(t.type)){const n=r._$events?r._$events.get(t.type):void 0;n&&i.push(n)}r=r.parent}}if(t.target=this,e.length||i.length){if(t.eventPhase=ws.CAPTURING_PHASE,i.length)switch(!0){case t._$stopImmediatePropagation:case t._$stopPropagation:break;default:i.reverse();for(let r=0;r<i.length;++r){const n=i[r];for(let a=0;a<n.length;++a){const o=n[a];if(o.useCapture){t.currentTarget=o.target,ri(o.target.loaderInfo);try{t.listener=o.listener,o.listener.call(null,t)}catch(c){return console.error(c),!1}if(t._$stopImmediatePropagation)break}}if(t._$stopImmediatePropagation)break}i.reverse();break}if(t.eventPhase=ws.AT_TARGET,!t._$stopImmediatePropagation&&!t._$stopPropagation){const r=e.length;for(let n=0;n<r;++n){const a=e[n];if(!a.useCapture){t.currentTarget=a.target,ri(a.target.loaderInfo);try{t.listener=a.listener,a.listener.call(null,t)}catch(o){return console.error(o),!1}if(t._$stopImmediatePropagation)break}}}switch(t.eventPhase=ws.BUBBLING_PHASE,!0){case t._$stopImmediatePropagation:case t._$stopPropagation:case!t.bubbles:break;default:for(let r=0;r<i.length;++r){const n=i[r];for(let a=0;a<n.length;++a){const o=n[a];if(!o.useCapture){t.currentTarget=o.target,ri(o.target.loaderInfo);try{t.listener=o.listener,o.listener.call(null,t)}catch(c){return console.error(c),!1}if(t._$stopImmediatePropagation)break}}if(t._$stopImmediatePropagation)break}break}return V(e),V(i),!0}V(e),V(i)}break}return!1}hasEventListener(t){switch(t=`${t}`,t){case S.ENTER_FRAME:case S.EXIT_FRAME:case S.FRAME_CONSTRUCTED:case S.RENDER:case S.ACTIVATE:case S.DEACTIVATE:case"keyDown":case"keyUp":{const e=nt();if(e&&e.broadcastEvents.size&&e.broadcastEvents.has(t)){const i=e.broadcastEvents.get(t)||A();for(let r=0;r<i.length;r++)if(i[r].target===this)return!0}return!1}default:return!!(this._$events&&this._$events.size&&this._$events.has(t))}}removeEventListener(t,e,i=!1){if(!e||(t=`${t}`,!this.hasEventListener(t)))return;const r=nt();let n=null,a=!1;switch(t){case S.ENTER_FRAME:case S.EXIT_FRAME:case S.FRAME_CONSTRUCTED:case S.RENDER:case S.ACTIVATE:case S.DEACTIVATE:case"keyDown":case"keyUp":a=!0,r&&(n=r.broadcastEvents.get(t)||A());break;default:this._$events&&this._$events.size&&this._$events.has(t)&&(n=this._$events.get(t)||A());break}if(n){for(let o=0;o<n.length;++o){const c=n[o];if(i===c.useCapture&&c.listener===e){n.splice(o,1);break}}if(!n.length){if(a)r.broadcastEvents.delete(t);else{if(!this._$events)return;this._$events.delete(t),this._$events.size||(Pe(this._$events),this._$events=null)}return}n.length>1&&n.sort(function(o,c){switch(!0){case o.priority>c.priority:return-1;case o.priority<c.priority:return 1;default:return 0}}),a?r.broadcastEvents.set(t,n):(this._$events||(this._$events=yt()),this._$events.set(t,n))}}removeAllEventListener(t,e=!1){if(t=`${t}`,!this.hasEventListener(t))return;const i=nt();let r=null,n=!1;switch(t){case S.ENTER_FRAME:case S.EXIT_FRAME:case S.FRAME_CONSTRUCTED:case S.RENDER:case S.ACTIVATE:case S.DEACTIVATE:case"keyDown":case"keyUp":n=!0,i&&(r=i.broadcastEvents.get(t)||A());break;default:this._$events&&this._$events.size&&this._$events.has(t)&&(r=this._$events.get(t)||A());break}if(!r)return;const a=A();for(let o=0;o<r.length;++o){const c=r[o];e!==c.useCapture&&a.push(c)}if(!a.length){if(n)i.broadcastEvents.delete(t);else{if(!this._$events)return;this._$events.delete(t),this._$events.size||(Pe(this._$events),this._$events=null)}return}a.length>1&&a.sort(function(o,c){switch(!0){case o.priority>c.priority:return-1;case o.priority<c.priority:return 1;default:return 0}}),n?i.broadcastEvents.set(t,a):(this._$events||(this._$events=yt()),this._$events.set(t,a))}willTrigger(t){if(this.hasEventListener(t))return!0;if("parent"in this){let e=this.parent;for(;e;){if(e.hasEventListener(t))return!0;e=e.parent}}return!1}};class xn extends S{constructor(t,e=!0,i=!1){super(t,e,i)}static toString(){return"[class FocusEvent]"}static get namespace(){return"next2d.events.FocusEvent"}toString(){return this.formatToString("FocusEvent","type","bubbles","cancelable","eventPhase")}get namespace(){return"next2d.events.FocusEvent"}static get FOCUS_IN(){return"focusIn"}static get FOCUS_OUT(){return"focusOut"}}class yn extends S{constructor(t,e=!1,i=!1,r=0,n="",a=[]){super(t,e,i),this._$status=r|0,this._$responseHeaders=a,this._$responseURL=n}static toString(){return"[class HTTPStatusEvent]"}static get namespace(){return"next2d.events.HTTPStatusEvent"}toString(){return this.formatToString("HTTPStatusEvent","type","bubbles","cancelable","eventPhase","status","responseURL")}get namespace(){return"next2d.events.HTTPStatusEvent"}static get HTTP_STATUS(){return"httpStatus"}get responseHeaders(){return this._$responseHeaders}get responseURL(){return this._$responseURL}get status(){return this._$status}}class fe extends S{constructor(t,e=!1,i=!1,r=""){super(t,e,i),this._$text=`${r}`}static toString(){return"[class IOErrorEvent]"}static get namespace(){return"next2d.events.IOErrorEvent"}toString(){return this.formatToString("IOErrorEvent","type","bubbles","cancelable","eventPhase","text")}get namespace(){return"next2d.events.IOErrorEvent"}static get IO_ERROR(){return"ioError"}get text(){return this._$text}}class P extends S{constructor(t,e=!0,i=!1){return super(t,e,i),new Proxy(this,{get:(r,n)=>{if(n in r)return r[n];const a=oi();if(a&&n in a)return a[n]}})}static toString(){return"[class MouseEvent]"}static get namespace(){return"next2d.events.MouseEvent"}toString(){return this.formatToString("MouseEvent","type","bubbles","cancelable","eventPhase","localX","localY","stageX","stageY","ctrlKey","altKey","shiftKey","buttonDown","delta","commandKey","controlKey","clickCount")}get namespace(){return"next2d.events.MouseEvent"}static get CLICK(){return"click"}static get DOUBLE_CLICK(){return"dblclick"}static get MOUSE_DOWN(){return"mouseDown"}static get MOUSE_MOVE(){return"mouseMove"}static get MOUSE_OUT(){return"mouseOut"}static get MOUSE_OVER(){return"mouseOver"}static get MOUSE_UP(){return"mouseUp"}static get MOUSE_WHEEL(){return"mouseWheel"}static get ROLL_OUT(){return"rollOut"}static get ROLL_OVER(){return"rollOver"}}class Lt extends S{constructor(t,e=!1,i=!1,r=0,n=0){super(t,e,i),this._$bytesLoaded=r|0,this._$bytesTotal=n|0}static toString(){return"[class ProgressEvent]"}static get namespace(){return"next2d.events.ProgressEvent"}toString(){return this.formatToString("ProgressEvent","type","bubbles","cancelable","eventPhase","bytesLoaded","bytesTotal")}get namespace(){return"next2d.events.ProgressEvent"}static get PROGRESS(){return"progress"}get bytesLoaded(){return this._$bytesLoaded}get bytesTotal(){return this._$bytesTotal}}class At extends S{constructor(t,e=!1,i=!1,r=0,n=0){super(t,e,i),this._$bytesLoaded=r|0,this._$bytesTotal=n|0}static toString(){return"[class VideoEvent]"}static get namespace(){return"next2d.events.VideoEvent"}toString(){return this.formatToString("VideoEvent","type","bubbles","cancelable","eventPhase","bytesLoaded","bytesTotal")}get namespace(){return"next2d.events.VideoEvent"}static get PROGRESS(){return"progress"}static get PLAY(){return"play"}static get PLAY_START(){return"playStart"}static get PLAY_END(){return"playEnd"}static get PAUSE(){return"pause"}static get SEEK(){return"seek"}get bytesLoaded(){return this._$bytesLoaded}get bytesTotal(){return this._$bytesTotal}}class fl{constructor(t=1,e=1,i=1,r=1,n=0,a=0,o=0,c=0){this._$colorTransform=Hn(),this.redMultiplier=t,this.greenMultiplier=e,this.blueMultiplier=i,this.alphaMultiplier=r,this.redOffset=n,this.greenOffset=a,this.blueOffset=o,this.alphaOffset=c}static toString(){return"[class ColorTransform]"}static get namespace(){return"next2d.geom.ColorTransform"}toString(){return"(redMultiplier="+this._$colorTransform[0]+", greenMultiplier="+this._$colorTransform[1]+", blueMultiplier="+this._$colorTransform[2]+", alphaMultiplier="+this._$colorTransform[3]+", redOffset="+this._$colorTransform[4]+", greenOffset="+this._$colorTransform[5]+", blueOffset="+this._$colorTransform[6]+", alphaOffset="+this._$colorTransform[7]+")"}get namespace(){return"next2d.geom.ColorTransform"}get alphaMultiplier(){return this._$colorTransform[3]}set alphaMultiplier(t){this._$colorTransform[3]=O(+t,0,1,0)}get alphaOffset(){return this._$colorTransform[7]}set alphaOffset(t){this._$colorTransform[7]=O(t|0,-255,255,0)}get blueMultiplier(){return this._$colorTransform[2]}set blueMultiplier(t){this._$colorTransform[2]=O(+t,0,1,0)}get blueOffset(){return this._$colorTransform[6]}set blueOffset(t){this._$colorTransform[6]=O(t|0,-255,255,0)}get greenMultiplier(){return this._$colorTransform[1]}set greenMultiplier(t){this._$colorTransform[1]=O(+t,0,1,0)}get greenOffset(){return this._$colorTransform[5]}set greenOffset(t){this._$colorTransform[5]=O(t|0,-255,255,0)}get redMultiplier(){return this._$colorTransform[0]}set redMultiplier(t){this._$colorTransform[0]=O(+t,0,1,0)}get redOffset(){return this._$colorTransform[4]}set redOffset(t){this._$colorTransform[4]=O(t|0,-255,255,0)}concat(t){const e=yi(this._$colorTransform,t._$colorTransform);this.redMultiplier=e[0],this.greenMultiplier=e[1],this.blueMultiplier=e[2],this.alphaMultiplier=e[3],this.redOffset=e[4],this.greenOffset=e[5],this.blueOffset=e[6],this.alphaOffset=e[7],$s(e)}_$clone(){return sr(this._$colorTransform[0],this._$colorTransform[1],this._$colorTransform[2],this._$colorTransform[3],this._$colorTransform[4],this._$colorTransform[5],this._$colorTransform[6],this._$colorTransform[7])}}class Mt{constructor(t=0,e=0){this._$x=0,this._$y=0,this.x=t,this.y=e}static toString(){return"[class Point]"}static get namespace(){return"next2d.geom.Point"}toString(){return`(x=${this.x}, y=${this.y})`}get namespace(){return"next2d.geom.Point"}get length(){return d.sqrt(d.pow(this.x,2)+d.pow(this.y,2))}get x(){return this._$x}set x(t){this._$x=O(+t,Qt,te,0)}get y(){return this._$y}set y(t){this._$y=O(+t,Qt,te,0)}add(t){return new Mt(this.x+t.x,this.y+t.y)}clone(){return new Mt(this.x,this.y)}copyFrom(t){this._$x=t._$x,this._$y=t._$y}static distance(t,e){return d.sqrt(d.pow(t._$x-e._$x,2)+d.pow(t._$y-e._$y,2))}equals(t){return this._$x===t._$x&&this._$y===t._$y}static interpolate(t,e,i){return new Mt(t.x+(e.x-t.x)*(1-i),t.y+(e.y-t.y)*(1-i))}normalize(t){const e=this.length;this.x=this.x*t/e,this.y=this.y*t/e}offset(t,e){this.x+=t,this.y+=e}static polar(t,e){return new Mt(t*d.cos(e),t*d.sin(e))}setTo(t,e){this.x=t,this.y=e}subtract(t){return new Mt(this.x-t.x,this.y-t.y)}}class gl{constructor(t=1,e=0,i=0,r=1,n=0,a=0){this._$matrix=Pt(1,0,0,1,0,0),this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a}static toString(){return"[class Matrix]"}static get namespace(){return"next2d.geom.Matrix"}toString(){return`(a=${this.a}, b=${this.b}, c=${this.c}, d=${this.d}, tx=${this.tx}, ty=${this.ty})`}get namespace(){return"next2d.geom.Matrix"}get a(){return this._$matrix[0]}set a(t){this._$matrix[0]=O(+t,Qt,te,0)}get b(){return this._$matrix[1]}set b(t){this._$matrix[1]=O(+t,Qt,te,0)}get c(){return this._$matrix[2]}set c(t){this._$matrix[2]=O(+t,Qt,te,0)}get d(){return this._$matrix[3]}set d(t){this._$matrix[3]=O(+t,Qt,te,0)}get tx(){return this._$matrix[4]}set tx(t){this._$matrix[4]=O(+t,Qt,te,0)}get ty(){return this._$matrix[5]}set ty(t){this._$matrix[5]=O(+t,Qt,te,0)}_$clone(){return this.clone()}clone(){return er(this._$matrix[0],this._$matrix[1],this._$matrix[2],this._$matrix[3],this._$matrix[4],this._$matrix[5])}concat(t){const e=this._$matrix,i=t._$matrix;let r=e[0]*i[0],n=0,a=0,o=e[3]*i[3],c=e[4]*i[0]+i[4],u=e[5]*i[3]+i[5];(e[1]||e[2]||i[1]||i[2])&&(r+=e[1]*i[2],o+=e[2]*i[1],n+=e[0]*i[1]+e[1]*i[3],a+=e[2]*i[0]+e[3]*i[2],c+=e[5]*i[2],u+=e[4]*i[1]),this.a=r,this.b=n,this.c=a,this.d=o,this.tx=c,this.ty=u}copyFrom(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty}createBox(t,e,i=0,r=0,n=0){this.identity(),this.rotate(i),this.scale(t,e),this.translate(r,n)}createGradientBox(t,e,i=0,r=0,n=0){if(this.a=t/1638.4,this.d=e/1638.4,i){const a=d.cos(i),o=d.sin(i);this.b=o*this.d,this.c=-o*this.a,this.a*=a,this.d*=a}else this.b=0,this.c=0;this.tx=r+t/2,this.ty=n+e/2}deltaTransformPoint(t){return new Mt(t.x*this._$matrix[0]+t.y*this._$matrix[2],t.x*this._$matrix[1]+t.y*this._$matrix[3])}identity(){this._$matrix[0]=1,this._$matrix[1]=0,this._$matrix[2]=0,this._$matrix[3]=1,this._$matrix[4]=0,this._$matrix[5]=0}invert(){const t=this._$matrix[0],e=this._$matrix[1],i=this._$matrix[2],r=this._$matrix[3],n=this._$matrix[4],a=this._$matrix[5];if(e===0&&i===0)this.a=1/t,this.b=0,this.c=0,this.d=1/r,this.tx=-this.a*n,this.ty=-this.d*a;else{const o=t*r-e*i;if(o){const c=1/o;this.a=r*c,this.b=-e*c,this.c=-i*c,this.d=t*c,this.tx=-(this.a*n+this.c*a),this.ty=-(this.b*n+this.d*a)}}}rotate(t){const e=this._$matrix[0],i=this._$matrix[1],r=this._$matrix[2],n=this._$matrix[3],a=this._$matrix[4],o=this._$matrix[5];this.a=e*d.cos(t)-i*d.sin(t),this.b=e*d.sin(t)+i*d.cos(t),this.c=r*d.cos(t)-n*d.sin(t),this.d=r*d.sin(t)+n*d.cos(t),this.tx=a*d.cos(t)-o*d.sin(t),this.ty=a*d.sin(t)+o*d.cos(t)}scale(t,e){this.a*=t,this.c*=t,this.tx*=t,this.b*=e,this.d*=e,this.ty*=e}setTo(t,e,i,r,n,a){this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a}transformPoint(t){return new Mt(t.x*this._$matrix[0]+t.y*this._$matrix[2]+this._$matrix[4],t.x*this._$matrix[1]+t.y*this._$matrix[3]+this._$matrix[5])}translate(t,e){this.tx+=t,this.ty+=e}}class ue{constructor(t=0,e=0,i=0,r=0){this._$x=0,this._$y=0,this._$width=0,this._$height=0,this.setTo(t,e,i,r)}static toString(){return"[class Rectangle]"}static get namespace(){return"next2d.geom.Rectangle"}toString(){return`(x=${this.x}, y=${this.y}, w=${this.width}, h=${this.height})`}get namespace(){return"next2d.geom.Rectangle"}get bottom(){return this.y+this.height}set bottom(t){this.height=+t-this.y}get bottomRight(){return new Mt(this.right,this.bottom)}set bottomRight(t){this.right=t.x,this.bottom=t.y}get height(){return this._$height}set height(t){this._$height=O(+t,Qt,te,0)}get left(){return this.x}set left(t){this.width=this.right-+t,this.x=t}get right(){return this.x+this.width}set right(t){this.width=+t-this.x}get size(){return new Mt(this.width,this.height)}set size(t){this.width=t.x,this.height=t.y}get top(){return this.y}set top(t){this.height=+(this.bottom-+t),this.y=t}get topLeft(){return new Mt(this.x,this.y)}set topLeft(t){this.left=t.x,this.top=t.y}get width(){return this._$width}set width(t){this._$width=O(+t,Qt,te,0)}get x(){return this._$x}set x(t){this._$x=O(+t,Qt,te,0)}get y(){return this._$y}set y(t){this._$y=O(+t,Qt,te,0)}clone(){return new ue(this.x,this.y,this.width,this.height)}contains(t,e){return this.x<=t&&this.y<=e&&this.right>t&&this.bottom>e}containsPoint(t){return this.x<=t.x&&this.y<=t.y&&this.right>t.x&&this.bottom>t.y}containsRect(t){return this.x<=t.x&&this.y<=t.y&&this.right>=t.right&&this.bottom>=t.bottom}copyFrom(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}inflate(t,e){this.x=this.x-+t,this.width=this.width+2*+t,this.y=this.y-+e,this.height=this.height+2*+e}inflatePoint(t){this.x=this.x-t.x,this.width=this.width+2*t.x,this.y=this.y-t.y,this.height=this.height+2*t.y}intersection(t){const e=d.max(this.x,t.x),i=d.max(this.y,t.y),r=d.min(this.right,t.right),n=d.min(this.bottom,t.bottom),a=r-e,o=n-i;return a>0&&o>0?new ue(e,i,a,o):new ue(0,0,0,0)}intersects(t){const e=d.max(this.x,t.x),i=d.max(this.y,t.y),r=d.min(this.right,t.right),n=d.min(this.bottom,t.bottom);return r-e>0&&n-i>0}isEmpty(){return this.width<=0||this.height<=0}offset(t,e){this.x+=t,this.y+=e}offsetPoint(t){this.x+=t.x,this.y+=t.y}setEmpty(){this._$x=0,this._$y=0,this._$width=0,this._$height=0}setTo(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r}union(t){return this.isEmpty()?t.clone():t.isEmpty()?this.clone():new ue(d.min(this.x,t.x),d.min(this.y,t.y),d.max(this.right-t.left,t.right-this.left),d.max(this.bottom-t.top,t.bottom-this.top))}}class ts{constructor(){this._$updated=!0}static toString(){return"[class BitmapFilter]"}static get namespace(){return"next2d.filters.BitmapFilter"}toString(){return"[object BitmapFilter]"}get namespace(){return"next2d.filters.BitmapFilter"}_$isUpdated(){return this._$updated}_$doChanged(){this._$updated=!0,pt()}}class Ne extends ts{constructor(t=4,e=4,i=1){super(),this._$blurX=4,this._$blurY=4,this._$quality=1,this.blurX=t,this.blurY=e,this.quality=i}static toString(){return"[class BlurFilter]"}static get namespace(){return"next2d.filters.BlurFilter"}toString(){return"[object BlurFilter]"}get namespace(){return"next2d.filters.BlurFilter"}static get STEP(){return[.5,1.05,1.4,1.55,1.75,1.9,2,2.15,2.2,2.3,2.5,3,3,3.5,3.5]}get blurX(){return this._$blurX}set blurX(t){t=O(+t,0,255,0),t!==this._$blurX&&(this._$blurX=t,this._$doChanged())}get blurY(){return this._$blurY}set blurY(t){t=O(+t,0,255,0),t!==this._$blurY&&(this._$blurY=t,this._$doChanged())}get quality(){return this._$quality}set quality(t){t=O(t|0,0,15,1),t!==this._$quality&&(this._$quality=t,this._$doChanged())}clone(){return new Ne(this._$blurX,this._$blurY,this._$quality)}_$toArray(){return A(1,this._$blurX,this._$blurY,this._$quality)}_$generateFilterRect(t,e=0,i=0){const r=et(t.xMin,t.xMax,t.yMin,t.yMax);if(!this._$quality)return r;const n=Ne.STEP[this._$quality-1];let a=0>=this._$blurX?1:this._$blurX*n,o=0>=this._$blurY?1:this._$blurY*n;return e?a*=e:a=d.round(a),i?o*=i:o=d.round(o),r.xMin-=a,r.xMax+=a*2,r.yMin-=o,r.yMax+=o*2,r}_$canApply(){return this._$blurX!==0&&this._$blurY!==0}_$applyFilter(t,e,i=!0){this._$updated=!1;const r=t.frameBuffer,n=r.currentAttachment,a=r.getTextureFromCurrentAttachment();if(!this._$canApply())return i?a:r.createTextureFromCurrentAttachment();let o=d.sqrt(e[0]*e[0]+e[1]*e[1]),c=d.sqrt(e[2]*e[2]+e[3]*e[3]);o/=at,c/=at,o*=2,c*=2;const u=et(0,a.width,0,a.height),l=this._$generateFilterRect(u,o,c);W(u);const h=d.ceil(l.xMax)|0,$=d.ceil(l.yMax)|0,_=d.ceil(d.abs(l.xMin)+d.abs(h-l.xMax)*.5),g=d.ceil(d.abs(l.yMin)+d.abs($-l.yMax)*.5);t._$offsetX=_+t._$offsetX,t._$offsetY=g+t._$offsetY;const f=this._$blurX*o,m=this._$blurY*c;let p=1,x=1;f>128?p=.0625:f>64?p=.125:f>32?p=.25:f>16&&(p=.5),m>128?x=.0625:m>64?x=.125:m>32?x=.25:m>16&&(x=.5);const b=f*p,T=m*x,y=d.ceil(h*p),v=d.ceil($*x),L=r.createTextureAttachment(y,v),B=r.createTextureAttachment(y,v),F=[L,B];let R=0;t._$bind(L),t.reset(),t.setTransform(p,0,0,x,0,0),t.drawImage(a,_,g,a.width,a.height),t.blend.toOneZero();let w=r.getTextureFromCurrentAttachment();for(let I=0;I<this._$quality;++I){if(this._$blurX>0){R=(R+1)%2;const D=F[R];t._$bind(D),t._$applyBlurFilter(w,!0,b),w=r.getTextureFromCurrentAttachment()}if(this._$blurY>0){R=(R+1)%2;const D=F[R];t._$bind(D),t._$applyBlurFilter(w,!1,T),w=r.getTextureFromCurrentAttachment()}}if(t.blend.reset(),p!==1||x!==1){const I=r.createTextureAttachment(h,$);t._$bind(I),t.reset(),t.imageSmoothingEnabled=!0,t.setTransform(1/p,0,0,1/x,0,0),t.drawImage(w,0,0,y,v),w=r.getTextureFromCurrentAttachment(),t.reset(),t.setTransform(1,0,0,1,0,0),r.releaseAttachment(F[0],!0),r.releaseAttachment(F[1],!0),i?r.releaseAttachment(n,!0):r.releaseAttachment(I,!1)}else r.releaseAttachment(F[(R+1)%2],!0),i?r.releaseAttachment(n,!0):r.releaseAttachment(F[R],!1);return w}}class jn extends ts{constructor(t=4,e=45,i=16777215,r=1,n=0,a=1,o=4,c=4,u=1,l=1,h="inner",$=!1){super(),this._$blurFilter=new Ne(o,c,l),this._$distance=4,this._$angle=45,this._$highlightColor=16777215,this._$highlightAlpha=1,this._$shadowColor=0,this._$shadowAlpha=1,this._$strength=1,this._$type="inner",this._$knockout=!1,this.distance=t,this.angle=e,this.highlightColor=i,this.highlightAlpha=r,this.shadowColor=n,this.shadowAlpha=a,this.strength=u,this.type=h,this.knockout=$}static toString(){return"[class BevelFilter]"}static get namespace(){return"next2d.filters.BevelFilter"}toString(){return"[object BevelFilter]"}get namespace(){return"next2d.filters.BevelFilter"}get angle(){return this._$angle}set angle(t){t%=360,t!==this._$angle&&(this._$angle=O(t,-360,360,45),this._$doChanged())}get blurX(){return this._$blurFilter.blurX}set blurX(t){this._$blurFilter.blurX=t}get blurY(){return this._$blurFilter.blurY}set blurY(t){this._$blurFilter.blurY=t}get distance(){return this._$distance}set distance(t){t=O(+t,-255,255,4),t!==this._$distance&&(this._$distance=t,this._$doChanged())}get highlightAlpha(){return this._$highlightAlpha}set highlightAlpha(t){t=O(+t,0,1,0),t!==this._$highlightAlpha&&(this._$highlightAlpha=t,this._$doChanged())}get highlightColor(){return this._$highlightColor}set highlightColor(t){t=O(It(t),0,16777215,16777215),t!==this._$highlightColor&&(this._$highlightColor=t,this._$doChanged())}get knockout(){return this._$knockout}set knockout(t){t!==this._$knockout&&(this._$knockout=!!t,this._$doChanged())}get quality(){return this._$blurFilter.quality}set quality(t){this._$blurFilter.quality=t}get shadowAlpha(){return this._$shadowAlpha}set shadowAlpha(t){t=O(+t,0,1,0),t!==this._$shadowAlpha&&(this._$shadowAlpha=t,this._$doChanged())}get shadowColor(){return this._$shadowColor}set shadowColor(t){t=O(It(t),0,16777215,0),t!==this._$shadowColor&&(this._$shadowColor=t,this._$doChanged())}get strength(){return this._$strength}set strength(t){t=O(t|0,0,255,0),t!==this._$strength&&(this._$strength=t,this._$doChanged())}get type(){return this._$type}set type(t){t=`${t}`,t!==this._$type&&(this._$type=t,this._$doChanged())}clone(){return new jn(this._$distance,this._$angle,this._$highlightColor,this._$highlightAlpha,this._$shadowColor,this._$shadowAlpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$toArray(){return A(0,this._$distance,this._$angle,this._$highlightColor,this._$highlightAlpha,this._$shadowColor,this._$shadowAlpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$isUpdated(){return this._$updated||this._$blurFilter._$isUpdated()}_$generateFilterRect(t,e=0,i=0){let r=et(t.xMin,t.xMax,t.yMin,t.yMax);if(!this._$canApply())return r;r=this._$blurFilter._$generateFilterRect(r,e,i);const n=this._$angle*Qe;let a=d.abs(d.cos(n)*this._$distance),o=d.abs(d.sin(n)*this._$distance);return e&&(a*=e),i&&(o*=i),r.xMin=d.min(r.xMin,a),a>0&&(r.xMax+=a),r.yMin=d.min(r.yMin,o),o>0&&(r.yMax+=o),r}_$canApply(){return this._$strength>0&&this._$distance!==0&&this._$blurFilter._$canApply()}_$applyFilter(t,e){this._$updated=!1;const i=t.frameBuffer,r=i.currentAttachment;if(!r)throw new Error("the current attachment is null.");t.setTransform(1,0,0,1,0,0);const n=i.getTextureFromCurrentAttachment();if(!this._$canApply())return n;const a=r.width,o=r.height,c=t._$offsetX,u=t._$offsetY;let l=d.sqrt(e[0]*e[0]+e[1]*e[1]),h=d.sqrt(e[2]*e[2]+e[3]*e[3]);l/=at,h/=at,l*=2,h*=2;const $=this._$angle*Qe,_=d.cos($)*this._$distance*l,g=d.sin($)*this._$distance*h,f=i.createTextureAttachment(a,o);t._$bind(f),t.reset(),t.drawImage(n,0,0,a,o),t.globalCompositeOperation="erase",t.drawImage(n,_*2,g*2,a,o);const m=this._$blurFilter._$applyFilter(t,e,!1),p=m.width,x=m.height,b=d.ceil(p+d.abs(_)*2),T=d.ceil(x+d.abs(g)*2),y=this._$type==="inner",v=y?a:b,L=y?o:T,B=d.abs(_),F=d.abs(g),R=(p-a)/2,w=(x-o)/2,I=y?0:B+R,D=y?0:F+w,N=y?-R-_:B-_,Y=y?-w-g:F-g;return t._$bind(r),i.releaseAttachment(f,!0),t._$applyBitmapFilter(m,v,L,a,o,I,D,p,x,N,Y,!1,this._$type,this._$knockout,this._$strength,null,null,null,ci(this._$highlightColor,this._$highlightAlpha,!0),ui(this._$highlightColor,this._$highlightAlpha,!0),li(this._$highlightColor,this._$highlightAlpha,!0),this._$highlightAlpha,ci(this._$shadowColor,this._$shadowAlpha,!0),ui(this._$shadowColor,this._$shadowAlpha,!0),li(this._$shadowColor,this._$shadowAlpha,!0),this._$shadowAlpha),t._$offsetX=c+I,t._$offsetY=u+D,i.releaseTexture(m),i.getTextureFromCurrentAttachment()}}class Kn extends ts{constructor(t=null){super(),this._$matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix=t}static toString(){return"[class ColorMatrixFilter]"}static get namespace(){return"next2d.filters.ColorMatrixFilter"}toString(){return"[object ColorMatrixFilter]"}get namespace(){return"next2d.filters.ColorMatrixFilter"}get matrix(){return this._$matrix}set matrix(t){if(!(!t||!le.isArray(t)||t.length!==20)){for(let e=0;e<20;++e)if(t[e]!==this._$matrix[e]){this._$doChanged();break}this._$matrix=t}}clone(){return new Kn(this._$matrix)}_$toArray(){return A(2,this._$matrix)}_$generateFilterRect(t){return t}_$canApply(){return!0}_$applyFilter(t){this._$updated=!1;const e=t.frameBuffer,i=e.currentAttachment;t.setTransform(1,0,0,1,0,0);const r=e.getTextureFromCurrentAttachment(),n=r.width,a=r.height,o=e.createTextureAttachment(n,a);return t._$bind(o),t.reset(),t._$applyColorMatrixFilter(r,this._$matrix),e.releaseAttachment(i,!0),e.getTextureFromCurrentAttachment()}}class qn extends ts{constructor(t=0,e=0,i=null,r=1,n=0,a=!0,o=!0,c=0,u=0){super(),this._$matrixX=0,this._$matrixY=0,this._$matrix=null,this._$divisor=1,this._$bias=0,this._$preserveAlpha=!0,this._$clamp=!0,this._$color=0,this._$alpha=0,this.matrixX=t,this.matrixY=e,this.matrix=i,this.divisor=r,this.bias=n,this.preserveAlpha=a,this.clamp=o,this.color=c,this.alpha=u}static toString(){return"[class ConvolutionFilter]"}static get namespace(){return"next2d.filters.ConvolutionFilter"}toString(){return"[object ConvolutionFilter]"}get namespace(){return"next2d.filters.ConvolutionFilter"}get alpha(){return this._$alpha}set alpha(t){t=O(+t,0,1,0),t!==this._$alpha&&(this._$alpha=t,this._$doChanged())}get bias(){return this._$bias}set bias(t){t!==this._$bias&&(this._$bias=t|0,this._$doChanged())}get clamp(){return this._$clamp}set clamp(t){t!==this._$clamp&&(this._$clamp=!!t,this._$doChanged())}get color(){return this._$color}set color(t){t=O(It(t),0,16777215,0),t!==this._$color&&(this._$color=t,this._$doChanged())}get divisor(){return this._$divisor}set divisor(t){t!==this._$divisor&&(this._$divisor=t|0,this._$doChanged())}get matrix(){return this._$matrix}set matrix(t){le.isArray(this._$matrix)&&V(this._$matrix),this._$matrix=le.isArray(t)?t:null,this._$doChanged()}get matrixX(){return this._$matrixX}set matrixX(t){t=O(t|0,0,15,0)|0,t!==this._$matrixX&&(this._$matrixX=t,this._$doChanged())}get matrixY(){return this._$matrixY}set matrixY(t){t=O(t|0,0,15,0)|0,t!==this._$matrixY&&(this._$matrixY=t,this._$doChanged())}get preserveAlpha(){return this._$preserveAlpha}set preserveAlpha(t){t!==this._$preserveAlpha&&(this._$preserveAlpha=!!t,this._$doChanged())}clone(){return new qn(this._$matrixX,this._$matrixY,this._$matrix?this._$matrix.slice():null,this._$divisor,this._$bias,this._$preserveAlpha,this._$clamp,this._$color,this._$alpha)}_$toArray(){return A(3,this._$matrixX,this._$matrixY,this._$matrix,this._$divisor,this._$bias,this._$preserveAlpha,this._$clamp,this._$color,this._$alpha)}_$generateFilterRect(t){return t}_$canApply(){return this._$matrix!==null&&this._$matrixX*this._$matrixY===this._$matrix.length}_$applyFilter(t){this._$updated=!1;const e=t.frameBuffer,i=e.currentAttachment;t.setTransform(1,0,0,1,0,0);const r=e.getTextureFromCurrentAttachment();return!this._$canApply()||!this._$matrix?r:(t._$applyConvolutionFilter(r,this._$matrixX,this._$matrixY,this._$matrix,this._$divisor,this._$bias,this._$preserveAlpha,this._$clamp,ci(this._$color,this._$alpha,!1),ui(this._$color,this._$alpha,!1),li(this._$color,this._$alpha,!1),this._$alpha),e.releaseAttachment(i,!0),e.getTextureFromCurrentAttachment())}}class Zn extends ts{constructor(t=null,e=null,i=0,r=0,n=0,a=0,o="wrap",c=0,u=0){super(),this._$mapBitmap=null,this._$mapPoint=null,this._$componentX=0,this._$componentY=0,this._$scaleX=0,this._$scaleY=0,this._$mode="wrap",this._$color=0,this._$alpha=0,this.mapBitmap=t,this.mapPoint=e,this.componentX=i,this.componentY=r,this.scaleX=n,this.scaleY=a,this.mode=o,this.color=c,this.alpha=u}static toString(){return"[class DisplacementMapFilter]"}static get namespace(){return"next2d.filters.DisplacementMapFilter"}toString(){return"[object DisplacementMapFilter]"}get namespace(){return"next2d.filters.DisplacementMapFilter"}get alpha(){return this._$alpha}set alpha(t){t=O(+t,0,1,0),t!==this._$alpha&&(this._$alpha=t,this._$doChanged())}get color(){return this._$color}set color(t){t=O(It(t),0,16777215,0),t!==this._$color&&(this._$color=t,this._$doChanged())}get componentX(){return this._$componentX}set componentX(t){t!==this._$componentX&&(this._$componentX=t,this._$doChanged())}get componentY(){return this._$componentY}set componentY(t){t!==this._$componentY&&(this._$componentY=t,this._$doChanged())}get mapBitmap(){return this._$mapBitmap}set mapBitmap(t){t!==this._$mapBitmap&&(this._$mapBitmap=t,this._$doChanged())}get mapPoint(){return this._$mapPoint}set mapPoint(t){t!==this._$mapPoint&&(this._$mapPoint=t,this._$doChanged())}get mode(){return this._$mode}set mode(t){t!==this._$mode&&(this._$mode=t,this._$doChanged())}get scaleX(){return this._$scaleX}set scaleX(t){t=O(+t,-65535,65535,0),t!==this._$scaleX&&(this._$scaleX=t,this._$doChanged())}get scaleY(){return this._$scaleY}set scaleY(t){t=O(+t,-65535,65535,0),t!==this._$scaleY&&(this._$scaleY=t,this._$doChanged())}clone(){return new Zn(this._$mapBitmap,this._$mapPoint,this._$componentX,this._$componentY,this._$scaleX,this._$scaleY,this._$mode,this._$color,this._$alpha)}_$toArray(){return A(4,this._$mapBitmap,this._$mapPoint,this._$componentX,this._$componentY,this._$scaleX,this._$scaleY,this._$mode,this._$color,this._$alpha)}_$generateFilterRect(t){return t}_$canApply(){return this._$mapBitmap!==null&&this._$componentX>0&&this._$componentY>0&&this._$scaleX!==0&&this._$scaleY!==0}_$applyFilter(t,e){this._$updated=!1;const i=t.frameBuffer,r=i.currentAttachment;t.setTransform(1,0,0,1,0,0);const n=i.getTextureFromCurrentAttachment();if(!this._$canApply()||!r||!this._$mapBitmap)return n;const a=d.sqrt(e[0]*e[0]+e[1]*e[1]),o=d.sqrt(e[2]*e[2]+e[3]*e[3]);return t._$applyDisplacementMapFilter(n,this._$mapBitmap,n.width/a,n.height/o,this._$mapPoint,this._$componentX,this._$componentY,this._$scaleX,this._$scaleY,this._$mode,ci(this._$color,this._$alpha,!0),ui(this._$color,this._$alpha,!0),li(this._$color,this._$alpha,!0),this._$alpha),i.releaseAttachment(r,!0),i.getTextureFromCurrentAttachment()}}class Jn extends ts{constructor(t=4,e=45,i=0,r=1,n=4,a=4,o=1,c=1,u=!1,l=!1,h=!1){super(),this._$blurFilter=new Ne(n,a,c),this._$distance=4,this._$angle=45,this._$color=0,this._$alpha=1,this._$strength=1,this._$inner=!1,this._$knockout=!1,this._$hideObject=!1,this.distance=t,this.angle=e,this.color=i,this.alpha=r,this.strength=o,this.inner=u,this.knockout=l,this.hideObject=h}static toString(){return"[class DropShadowFilter]"}static get namespace(){return"next2d.filters.DropShadowFilter"}toString(){return"[object DropShadowFilter]"}get namespace(){return"next2d.filters.DropShadowFilter"}get alpha(){return this._$alpha}set alpha(t){t=O(+t,0,1,0),t!==this._$alpha&&(this._$alpha=t,this._$doChanged())}get angle(){return this._$angle}set angle(t){t%=360,t!==this._$angle&&(this._$angle=O(t,-360,360,45),this._$doChanged())}get blurX(){return this._$blurFilter.blurX}set blurX(t){this._$blurFilter.blurX=t}get blurY(){return this._$blurFilter.blurY}set blurY(t){this._$blurFilter.blurY=t}get color(){return this._$color}set color(t){t=O(It(t),0,16777215,0),t!==this._$color&&(this._$color=t,this._$doChanged())}get distance(){return this._$distance}set distance(t){t=O(+t,-255,255,4),t!==this._$distance&&(this._$distance=t,this._$doChanged())}get hideObject(){return this._$hideObject}set hideObject(t){t!==this._$hideObject&&(this._$hideObject=!!t,this._$doChanged())}get inner(){return this._$inner}set inner(t){t!==this._$inner&&(this._$inner=!!t,this._$doChanged())}get knockout(){return this._$knockout}set knockout(t){t!==this._$knockout&&(this._$knockout=!!t,this._$doChanged())}get quality(){return this._$blurFilter.quality}set quality(t){this._$blurFilter.quality=t}get strength(){return this._$strength}set strength(t){t=O(t|0,0,255,0),t!==this._$strength&&(this._$strength=t,this._$doChanged())}clone(){return new Jn(this._$distance,this._$angle,this._$color,this._$alpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$inner,this._$knockout,this._$hideObject)}_$toArray(){return A(5,this._$distance,this._$angle,this._$color,this._$alpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$inner,this._$knockout,this._$hideObject)}_$isUpdated(){return this._$updated||this._$blurFilter._$isUpdated()}_$generateFilterRect(t,e=0,i=0){let r=et(t.xMin,t.xMax,t.yMin,t.yMax);if(!this._$canApply())return r;r=this._$blurFilter._$generateFilterRect(r,e,i);const n=this._$angle*Qe;let a=d.cos(n)*this._$distance,o=d.sin(n)*this._$distance;return e&&(a*=e),i&&(o*=i),r.xMin=d.min(r.xMin,a),a>0&&(r.xMax+=a),r.yMin=d.min(r.yMin,o),o>0&&(r.yMax+=o),r}_$canApply(){return this._$alpha>0&&this._$strength>0&&this._$blurFilter._$canApply()}_$applyFilter(t,e){const i=t.frameBuffer,r=i.currentAttachment;if(!r)throw new Error("the current attachment is null.");if(t.setTransform(1,0,0,1,0,0),!this._$canApply())return i.getTextureFromCurrentAttachment();const n=r.width,a=r.height,o=t._$offsetX,c=t._$offsetY,u=this._$blurFilter._$applyFilter(t,e,!1),l=u.width,h=u.height,$=t._$offsetX,_=t._$offsetY,g=$-o,f=_-c;let m=d.sqrt(e[0]*e[0]+e[1]*e[1]),p=d.sqrt(e[2]*e[2]+e[3]*e[3]);m/=at,p/=at,m*=2,p*=2;const x=this._$angle*Qe,b=d.cos(x)*this._$distance*m,T=d.sin(x)*this._$distance*p,y=this._$inner?n:l+d.max(0,d.abs(b)-g),v=this._$inner?a:h+d.max(0,d.abs(T)-f),L=d.ceil(y),B=d.ceil(v),F=(L-y)/2,R=(B-v)/2,w=this._$inner?0:d.max(0,g-b)+F,I=this._$inner?0:d.max(0,f-T)+R,D=this._$inner?b-$:(b>0?d.max(0,b-g):0)+F,N=this._$inner?T-_:(T>0?d.max(0,T-f):0)+R;let Y,q;return this._$inner?(Y="inner",q=this._$knockout||this._$hideObject):!this._$knockout&&this._$hideObject?(Y="full",q=!0):(Y="outer",q=this._$knockout),t._$bind(r),t._$applyBitmapFilter(u,L,B,n,a,w,I,l,h,D,N,!0,Y,q,this._$strength,null,null,null,ci(this._$color,this._$alpha,!0),ui(this._$color,this._$alpha,!0),li(this._$color,this._$alpha,!0),this._$alpha,0,0,0,0),t._$offsetX=o+w,t._$offsetY=c+I,i.releaseTexture(u),i.getTextureFromCurrentAttachment()}}class Qn extends ts{constructor(t=0,e=1,i=4,r=4,n=1,a=1,o=!1,c=!1){super(),this._$blurFilter=new Ne(i,r,a),this._$color=0,this._$alpha=1,this._$strength=1,this._$inner=!1,this._$knockout=!1,this.color=t,this.alpha=e,this.strength=n,this.inner=o,this.knockout=c}static toString(){return"[class GlowFilter]"}static get namespace(){return"next2d.filters.GlowFilter"}toString(){return"[object GlowFilter]"}get namespace(){return"next2d.filters.GlowFilter"}get alpha(){return this._$alpha}set alpha(t){t=O(+t,0,1,0),t!==this._$alpha&&(this._$alpha=t,this._$doChanged())}get blurX(){return this._$blurFilter.blurX}set blurX(t){this._$blurFilter.blurX=t}get blurY(){return this._$blurFilter.blurY}set blurY(t){this._$blurFilter.blurY=t}get color(){return this._$color}set color(t){t=O(It(t),0,16777215,4),t!==this._$color&&(this._$color=t,this._$doChanged())}get inner(){return this._$inner}set inner(t){t!==this._$inner&&(this._$inner=!!t,this._$doChanged())}get knockout(){return this._$knockout}set knockout(t){t!==this._$knockout&&(this._$knockout=!!t,this._$doChanged())}get quality(){return this._$blurFilter.quality}set quality(t){this._$blurFilter.quality=t}get strength(){return this._$strength}set strength(t){t=O(t|0,0,255,0),t!==this._$strength&&(this._$strength=t,this._$doChanged())}clone(){return new Qn(this._$color,this._$alpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$inner,this._$knockout)}_$toArray(){return A(6,this._$color,this._$alpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$inner,this._$knockout)}_$isUpdated(){return this._$updated||this._$blurFilter._$isUpdated()}_$generateFilterRect(t,e=0,i=0){const r=et(t.xMin,t.xMax,t.yMin,t.yMax);return this._$canApply()?this._$blurFilter._$generateFilterRect(r,e,i):r}_$canApply(){return this._$alpha>0&&this._$strength>0&&this._$blurFilter._$canApply()}_$applyFilter(t,e){const i=t.frameBuffer,r=i.currentAttachment;if(!r)throw new Error("the current attachment is null.");if(this._$updated=!1,t.setTransform(1,0,0,1,0,0),!this._$canApply())return i.getTextureFromCurrentAttachment();const n=r.width,a=r.height,o=t._$offsetX,c=t._$offsetY,u=this._$blurFilter._$applyFilter(t,e,!1),l=u.width,h=u.height,$=t._$offsetX,_=t._$offsetY,g=this._$inner?n:l,f=this._$inner?a:h,m=this._$inner?0:$-o,p=this._$inner?0:_-c,x=this._$inner?-$:0,b=this._$inner?-_:0,T=this._$inner?"inner":"outer";return t._$bind(r),t._$applyBitmapFilter(u,g,f,n,a,m,p,l,h,x,b,!0,T,this._$knockout,this._$strength,null,null,null,ci(this._$color,this._$alpha,!0),ui(this._$color,this._$alpha,!0),li(this._$color,this._$alpha,!0),this._$alpha,0,0,0,0),t._$offsetX=o+m,t._$offsetY=c+p,i.releaseTexture(u),i.getTextureFromCurrentAttachment()}}class ta extends ts{constructor(t=4,e=45,i=null,r=null,n=null,a=4,o=4,c=1,u=1,l="inner",h=!1){super(),this._$blurFilter=new Ne(a,o,u),this._$distance=4,this._$angle=45,this._$colors=null,this._$alphas=null,this._$ratios=null,this._$strength=1,this._$type="inner",this._$knockout=!1,this.distance=t,this.angle=e,this.colors=i,this.alphas=r,this.ratios=n,this.strength=c,this.type=l,this.knockout=h}static toString(){return"[class GradientBevelFilter]"}static get namespace(){return"next2d.filters.GradientBevelFilter"}toString(){return"[object GradientBevelFilter]"}get namespace(){return"next2d.filters.GradientBevelFilter"}get alphas(){return this._$alphas}set alphas(t){if(t!==this._$alphas){if(this._$alphas=t,le.isArray(t)){for(let e=0;e<t.length;++e){const i=t[e];t[e]=O(+i,0,1,0)}this._$alphas=t}this._$doChanged()}}get angle(){return this._$angle}set angle(t){t=O(t%360,-360,360,45),t!==this._$angle&&(this._$angle=t,this._$doChanged())}get blurX(){return this._$blurFilter.blurX}set blurX(t){this._$blurFilter.blurX=t}get blurY(){return this._$blurFilter.blurY}set blurY(t){this._$blurFilter.blurY=t}get colors(){return this._$colors}set colors(t){if(this._$colors!==t){if(this._$colors=t,le.isArray(t)){for(let e=0;e<t.length;++e)t[e]=O(It(t[e]),0,16777215,0);this._$colors=t}this._$doChanged()}}get distance(){return this._$distance}set distance(t){t=O(+t,-255,255,4),t!==this._$distance&&(this._$distance=t,this._$doChanged())}get knockout(){return this._$knockout}set knockout(t){t!==this._$knockout&&(this._$knockout=!!t,this._$doChanged())}get quality(){return this._$blurFilter.quality}set quality(t){this._$blurFilter.quality=t}get ratios(){return this._$ratios}set ratios(t){if(this._$ratios!==t){if(this._$ratios=t,le.isArray(t)){for(let e=0;e<t.length;++e)t[e]=O(+t[e],0,255,0);this._$ratios=t}this._$doChanged()}}get strength(){return this._$strength}set strength(t){t=O(t|0,0,255,0),t!==this._$strength&&(this._$strength=t,this._$doChanged())}get type(){return this._$type}set type(t){t!==this._$type&&(this._$type=t,this._$doChanged())}clone(){return new ta(this._$distance,this._$angle,this._$colors?this._$colors.slice():null,this._$alphas?this._$alphas.slice():null,this._$ratios?this._$ratios.slice():null,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$toArray(){return A(7,this._$distance,this._$angle,this._$colors,this._$alphas,this._$ratios,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$isUpdated(){return this._$updated||this._$blurFilter._$isUpdated()}_$generateFilterRect(t,e=0,i=0){let r=et(t.xMin,t.xMax,t.yMin,t.yMax);if(!this._$canApply())return r;r=this._$blurFilter._$generateFilterRect(r,e,i);const n=this._$angle*Qe;let a=d.abs(d.cos(n)*this._$distance),o=d.abs(d.sin(n)*this._$distance);return e&&(a*=e),i&&(o*=i),r.xMin=d.min(r.xMin,a),a>0&&(r.xMax+=a),r.yMin=d.min(r.yMin,o),o>0&&(r.yMax+=o),r}_$canApply(){return this._$strength>0&&this._$distance>0&&this._$alphas!==null&&this._$ratios!==null&&this._$colors!==null&&this._$blurFilter._$canApply()}_$applyFilter(t,e){this._$updated=!1;const i=t.frameBuffer,r=i.currentAttachment;t.setTransform(1,0,0,1,0,0);const n=i.getTextureFromCurrentAttachment();if(!this._$canApply()||!r)return n;const a=r.width,o=r.height,c=t._$offsetX,u=t._$offsetY;let l=d.sqrt(e[0]*e[0]+e[1]*e[1]),h=d.sqrt(e[2]*e[2]+e[3]*e[3]);l/=at,h/=at,l*=2,h*=2;const $=+(this._$angle*Qe),_=+(d.cos($)*this._$distance*l),g=+(d.sin($)*this._$distance*h),f=i.createTextureAttachment(a,o);t._$bind(f),t.reset(),t.drawImage(n,0,0,a,o),t.globalCompositeOperation="erase",t.drawImage(n,_*2,g*2,a,o);const m=this._$blurFilter._$applyFilter(t,e,!1),p=m.width,x=m.height,b=d.ceil(p+d.abs(_)*2),T=d.ceil(x+d.abs(g)*2),y=this._$type==="inner",v=y?a:b,L=y?o:T,B=d.abs(_),F=d.abs(g),R=(p-a)/2,w=(x-o)/2,I=y?0:B+R,D=y?0:F+w,N=y?-R-_:B-_,Y=y?-w-g:F-g;return t._$bind(r),t._$applyBitmapFilter(m,v,L,a,o,I,D,p,x,N,Y,!1,this._$type,this._$knockout,this._$strength,this._$ratios,this._$colors,this._$alphas,0,0,0,0,0,0,0,0),t._$offsetX=c+I,t._$offsetY=u+D,i.releaseAttachment(f,!0),i.getTextureFromCurrentAttachment()}}class ea extends ts{constructor(t=4,e=45,i=null,r=null,n=null,a=4,o=4,c=1,u=1,l="inner",h=!1){super(),this._$blurFilter=new Ne(a,o,u),this._$distance=4,this._$angle=45,this._$colors=null,this._$alphas=null,this._$ratios=null,this._$strength=1,this._$type="inner",this._$knockout=!1,this.distance=t,this.angle=e,this.colors=i,this.alphas=r,this.ratios=n,this.strength=c,this.type=l,this.knockout=h}static toString(){return"[class GradientGlowFilter]"}static get namespace(){return"next2d.filters.GradientGlowFilter"}toString(){return"[object GradientGlowFilter]"}get namespace(){return"next2d.filters.GradientGlowFilter"}get alphas(){return this._$alphas}set alphas(t){if(t!==this._$alphas){if(this._$alphas=t,le.isArray(t)){for(let e=0;e<t.length;++e)t[e]=O(+t[e],0,1,0);this._$alphas=t}this._$doChanged()}}get angle(){return this._$angle}set angle(t){t=O(t%360,-360,360,45),t!==this._$angle&&(this._$angle=t,this._$doChanged())}get blurX(){return this._$blurFilter.blurX}set blurX(t){this._$blurFilter.blurX=t}get blurY(){return this._$blurFilter.blurY}set blurY(t){this._$blurFilter.blurY=t}get colors(){return this._$colors}set colors(t){if(this._$colors!==t){if(this._$colors=t,le.isArray(t)){for(let e=0;e<t.length;++e)t[e]=O(It(t[e]),0,16777215,0);this._$colors=t}this._$doChanged()}}get distance(){return this._$distance}set distance(t){t=O(+t,-255,255,4),t!==this._$distance&&(this._$distance=t,this._$doChanged())}get knockout(){return this._$knockout}set knockout(t){t!==this._$knockout&&(this._$knockout=!!t,this._$doChanged())}get quality(){return this._$blurFilter.quality}set quality(t){this._$blurFilter.quality=t}get ratios(){return this._$ratios}set ratios(t){if(this._$ratios!==t){if(this._$ratios=t,le.isArray(t)){for(let e=0;e<t.length;++e)t[e]=O(+t[e],0,255,0);this._$ratios=t}this._$doChanged()}}get strength(){return this._$strength}set strength(t){t=O(t|0,0,255,0),t!==this._$strength&&(this._$strength=t,this._$doChanged())}get type(){return this._$type}set type(t){t!==this._$type&&(this._$type=t,this._$doChanged())}clone(){return new ea(this._$distance,this._$angle,this._$colors,this._$alphas,this._$ratios,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$toArray(){return A(8,this._$distance,this._$angle,this._$colors,this._$alphas,this._$ratios,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$isUpdated(){return this._$updated||this._$blurFilter._$isUpdated()}_$generateFilterRect(t,e=0,i=0){let r=et(t.xMin,t.xMax,t.yMin,t.yMax);if(!this._$canApply())return r;r=this._$blurFilter._$generateFilterRect(r,e,i);const n=this._$angle*Qe;let a=d.abs(d.cos(n)*this._$distance),o=d.abs(d.sin(n)*this._$distance);return e&&(a*=e),i&&(o*=i),r.xMin=d.min(r.xMin,a),a>0&&(r.xMax+=a),r.yMin=d.min(r.yMin,o),o>0&&(r.yMax+=o),r}_$canApply(){return this._$strength>0&&this._$distance>0&&this._$alphas!==null&&this._$ratios!==null&&this._$colors!==null&&this._$blurFilter._$canApply()}_$applyFilter(t,e){this._$updated=!1;const i=t.frameBuffer,r=i.currentAttachment;if(t.setTransform(1,0,0,1,0,0),!this._$canApply()||!r)return i.getTextureFromCurrentAttachment();const n=r.width,a=r.height,o=t._$offsetX,c=t._$offsetY,u=this._$blurFilter._$applyFilter(t,e,!1),l=u.width,h=u.height,$=t._$offsetX,_=t._$offsetY,g=$-o,f=_-c;let m=d.sqrt(e[0]*e[0]+e[1]*e[1]),p=d.sqrt(e[2]*e[2]+e[3]*e[3]);m/=at,p/=at,m*=2,p*=2;const x=+(this._$angle*Qe),b=+(d.cos(x)*this._$distance*m),T=+(d.sin(x)*this._$distance*p),y=this.type==="inner",v=y?n:l+d.max(0,d.abs(b)-g),L=y?a:h+d.max(0,d.abs(T)-f),B=d.ceil(v),F=d.ceil(L),R=(B-v)/2,w=(F-L)/2,I=y?0:d.max(0,g-b)+R,D=y?0:d.max(0,f-T)+w,N=y?b-$:(b>0?d.max(0,b-g):0)+R,Y=y?T-_:(T>0?d.max(0,T-f):0)+w;return t._$bind(r),t._$applyBitmapFilter(u,B,F,n,a,I,D,l,h,N,Y,!0,this._$type,this._$knockout,this._$strength,this._$ratios,this._$colors,this._$alphas,0,0,0,0,0,0,0,0),t._$offsetX=o+I,t._$offsetY=c+D,i.releaseTexture(u),i.getTextureFromCurrentAttachment()}}class ml{constructor(t){this._$displayObject=t,this._$matrix=null,this._$colorTransform=null,this._$blendMode=null,this._$filters=null}static toString(){return"[class Transform]"}static get namespace(){return"next2d.geom.Transform"}toString(){return"[object Transform]"}get namespace(){return"next2d.geom.Transform"}get colorTransform(){if(this._$colorTransform)return this._$colorTransform._$clone();const t=this._$displayObject,e=t._$placeObject||t._$getPlaceObject();if(e&&e.colorTransform){const i=e.colorTransform;return sr(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7])}return this._$transform(),this._$colorTransform||(this._$colorTransform=sr()),this._$colorTransform._$clone()}set colorTransform(t){this._$transform(null,t._$colorTransform)}get concatenatedColorTransform(){let t=this._$rawColorTransform(),e=this._$displayObject._$parent;for(;e;)t=yi(e._$transform._$rawColorTransform(),t),e=e._$parent;return sr(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7])}get matrix(){if(this._$matrix)return this._$matrix._$clone();const t=this._$displayObject,e=t._$placeObject||t._$getPlaceObject();if(e&&e.matrix){const i=e.matrix;return er(i[0],i[1],i[2],i[3],i[4],i[5])}return this._$transform(),this._$matrix||(this._$matrix=er()),this._$matrix._$clone()}set matrix(t){this._$transform(t._$matrix,null)}get concatenatedMatrix(){let t=this._$rawMatrix(),e=this._$displayObject._$parent;for(;e;)t=ct(e._$transform._$rawMatrix(),t),e=e._$parent;return er(t[0],t[1],t[2],t[3],t[4],t[5])}pixelBounds(){if(!this._$displayObject)return new ue(0,0,0,0);const t=this._$displayObject._$getBounds(null),e=new ue(t.xMin,t.yMin,+d.abs(t.xMax-t.xMin),+d.abs(t.yMax-t.yMin));return W(t),e}_$rawMatrix(){if(this._$matrix!==null)return this._$matrix._$matrix;const t=this._$displayObject,e=t._$placeObject||t._$getPlaceObject();if(e&&e.matrix){if(le.isArray(e.matrix)){const i=e.matrix;e.matrix=Pt(i[0],i[1],i[2],i[3],i[4],i[5]),V(i)}return e.matrix}return Jt}_$rawColorTransform(){if(this._$colorTransform!==null)return this._$colorTransform._$colorTransform;const t=this._$displayObject,e=t._$placeObject||t._$getPlaceObject();if(e&&e.colorTransform){if(le.isArray(e.colorTransform)){const i=e.colorTransform;e.colorTransform=Hn(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]),V(i)}return e.colorTransform}return vr}_$transform(t=null,e=null,i=null,r=""){const n=this._$displayObject,a=n._$placeObject||n._$getPlaceObject();this._$setMatrix(t,a),this._$setColorTransform(e,a),this._$setFilters(i,a),this._$setBlendMode(r,a)}_$setMatrix(t=null,e=null){if((t||e)&&(this._$displayObject._$doChanged(),pt()),this._$matrix||(this._$matrix=er(1,0,0,1,0,0),!t&&e&&e.matrix&&(t=e.matrix)),t){const i=this._$matrix._$matrix;i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5]}}_$setColorTransform(t=null,e=null){if((t||e)&&(this._$displayObject._$doChanged(),pt()),this._$colorTransform||(this._$colorTransform=sr(1,1,1,1,0,0,0,0),!t&&e&&e.colorTransform&&(t=e.colorTransform)),t){const i=this._$colorTransform._$colorTransform;i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7]}}_$setFilters(t=null,e=null){if(le.isArray(t)){this._$filters&&V(this._$filters),this._$filters=t.slice(0),this._$displayObject._$doChanged(),pt();return}if(!this._$filters){if(!e){this._$filters=A();return}if(e.filters){this._$filters=e.filters.slice(0);for(let i=0;i<this._$filters.length;++i)this._$filters[i]=this._$filters[i].clone();return}if(e.surfaceFilterList){e.filters=this._$buildFilter(e.surfaceFilterList),this._$filters=e.filters.slice(0);for(let i=0;i<this._$filters.length;++i)this._$filters[i]=this._$filters[i].clone()}}}_$buildFilter(t){const e=A(),i=t.length;for(let r=0;r<i;++r){const n=t[r];switch(n.params[0]===null&&n.params.shift(),n.class){case"BevelFilter":e.push(new jn(...n.params));break;case"BlurFilter":e.push(new Ne(...n.params));break;case"ColorMatrixFilter":e.push(new Kn(...n.params));break;case"ConvolutionFilter":e.push(new qn(...n.params));break;case"DisplacementMapFilter":e.push(new Zn(...n.params));break;case"DropShadowFilter":e.push(new Jn(...n.params));break;case"GlowFilter":e.push(new Qn(...n.params));break;case"GradientBevelFilter":e.push(new ta(...n.params));break;case"GradientGlowFilter":e.push(new ea(...n.params));break}}return e}_$setBlendMode(t="",e=null){if(t){this._$blendMode=t,this._$displayObject._$doChanged(),pt();return}if(!this._$blendMode){if(e&&e.blendMode){this._$blendMode=e.blendMode;return}this._$blendMode="normal"}}}class sa extends Ei{constructor(){super(),this._$id=-1,this._$instanceId=Zu(),this._$characterId=0,this._$active=!1,this._$isMask=!1,this._$updated=!0,this._$added=!1,this._$addedStage=!1,this._$filters=null,this._$blendMode=null,this._$hitObject=null,this._$isNext=!0,this._$created=!1,this._$posted=!1,this._$postArray=null,this._$clipDepth=0,this._$name="",this._$visible=!0,this._$mask=null,this._$scale9Grid=null,this._$parent=null,this._$stage=null,this._$root=null,this._$loaderInfo=null,this._$placeId=-1,this._$startFrame=1,this._$endFrame=0,this._$transform=new ml(this),this._$variables=null,this._$placeObject=null,this._$currentPlaceId=-1,this._$changePlace=!1,this._$scaleX=null,this._$scaleY=null,this._$rotation=null}get alpha(){const t=this._$transform._$rawColorTransform();return t[3]+t[7]/255}set alpha(t){t=O(t,0,1,0);const e=this._$transform;if(e._$colorTransform){const i=e._$colorTransform;i._$colorTransform[3]=t,i._$colorTransform[7]=0,this._$doChanged(),pt()}else{const i=e.colorTransform;i._$colorTransform[3]=t,i._$colorTransform[7]=0,e.colorTransform=i,Xl(i)}}get blendMode(){if(this._$blendMode)return this._$blendMode;const t=this._$transform;if(t._$blendMode)return this._$blendMode=t._$blendMode,t._$blendMode;const e=this._$placeObject||this._$getPlaceObject();return e&&e.blendMode?(this._$blendMode=e.blendMode,e.blendMode):(this._$blendMode="normal","normal")}set blendMode(t){const e=this._$transform;e._$blendMode?(e._$blendMode=t,this._$doChanged(),pt()):e._$transform(null,null,null,t),this._$blendMode=t}get filters(){if(this._$filters){const r=A();for(let n=0;n<this._$filters.length;++n)r[n]=this._$filters[n].clone();return r}const t=this._$transform;if(t._$filters){const r=A(),n=A();for(let a=0;a<t._$filters.length;++a){const o=t._$filters[a];r[a]=o.clone(),n[a]=o.clone()}return this._$filters=r,n}const e=this._$placeObject||this._$getPlaceObject();if(e&&e.surfaceFilterList){e.filters||(e.filters=t._$buildFilter(e.surfaceFilterList));const r=A(),n=A();for(let a=0;a<e.filters.length;++a){const o=e.filters[a];r[a]=o.clone(),n[a]=o.clone()}return this._$filters=r,n}const i=A();return this._$filters=i,i}set filters(t){t||(t=A()),this._$transform._$transform(null,null,t),this._$filters=t}get height(){const t="_$getBounds"in this&&typeof this._$getBounds=="function"?this._$getBounds():et(),e=wt(t,this._$transform._$rawMatrix());W(t);const i=d.abs(e.yMax-e.yMin);switch(W(e),i){case 0:case bt:case-bt:return 0;default:return+i.toFixed(2)}}set height(t){if(t=+t,!Ie(t)&&t>-1){const e="_$getBounds"in this&&typeof this._$getBounds=="function"?this._$getBounds():et(),i=this.rotation,r=i?wt(e,this._$transform._$rawMatrix()):e;i&&W(e);const n=d.abs(r.yMax-r.yMin);switch(W(r),n){case 0:case bt:case-bt:this.scaleY=0;break;default:this.scaleY=t/n;break}}}get loaderInfo(){return this._$loaderInfo}get mask(){return this._$mask}set mask(t){t!==this._$mask&&(this._$mask&&(X&&this._$mask.stage&&this._$mask._$removeWorkerInstance(),this._$mask._$isMask=!1,this._$mask=null),t&&(X&&"_$createWorkerInstance"in t&&typeof t._$createWorkerInstance=="function"&&t._$createWorkerInstance(),t._$isMask=!0,this._$mask=t),this._$doChanged())}get mouseX(){return oi()?this.globalToLocal(Rn()).x:0}get mouseY(){return oi()?this.globalToLocal(Rn()).y:0}get name(){return this._$name?this._$name:`instance${this._$instanceId}`}set name(t){this._$name=`${t}`;const e=this._$parent;if(e&&e._$names){e._$names.clear();const i=e._$getChildren();for(let r=0;r<i.length;++r){const n=i[r];n._$name&&e._$names.set(n.name,n)}}}get parent(){return this._$parent}get root(){return this._$root}get rotation(){if(this._$rotation!==null)return this._$rotation;const t=this._$transform._$rawMatrix();return d.atan2(t[1],t[0])*z_}set rotation(t){if(t=O(t%360,-360,360,0),this._$rotation===t)return;const e=this._$transform,i=e._$matrix!==null,r=i?e._$matrix:e.matrix,n=d.sqrt(r.a*r.a+r.b*r.b),a=d.sqrt(r.c*r.c+r.d*r.d);if(t===0)r.a=n,r.b=0,r.c=0,r.d=a;else{let o=d.atan2(r.b,r.a),c=d.atan2(0-r.c,r.d);const u=t*Qe;c=c+u-o,o=u,r.b=n*d.sin(o),r.b===1||r.b===-1?r.a=0:r.a=n*d.cos(o),r.c=-a*d.sin(c),r.c===1||r.c===-1?r.d=0:r.d=a*d.cos(c)}i?(this._$doChanged(),pt()):(e.matrix=r,Zt(r)),this._$rotation=t}get scale9Grid(){return this._$scale9Grid}set scale9Grid(t){this._$scale9Grid!==t&&(this._$scale9Grid=t,this._$doChanged(),pt())}get scaleX(){if(this._$scaleX!==null)return this._$scaleX;const t=this._$transform._$rawMatrix();let e=d.sqrt(t[0]*t[0]+t[1]*t[1]);if(!ft.isInteger(e)){const i=e.toString(),r=i.indexOf("e");r!==-1&&(e=+i.slice(0,r)),e=+e.toFixed(4)}return 0>t[0]?e*-1:e}set scaleX(t){if(t=O(+t,Qt,te),!ft.isInteger(t)){const n=t.toString(),a=n.indexOf("e");a!==-1&&(t=+n.slice(0,a)),t=+t.toFixed(4)}if(this._$scaleX===t)return;const e=this._$transform,i=e._$matrix!==null,r=i?e._$matrix:e.matrix;if(r.b===0||Ie(r.b))r.a=t;else{let n=d.atan2(r.b,r.a);n===-d.PI&&(n=0),r.b=t*d.sin(n),r.a=t*d.cos(n)}i?(this._$doChanged(),pt()):(e.matrix=r,Zt(r)),this._$scaleX=t}get scaleY(){if(this._$scaleY!==null)return this._$scaleY;const t=this._$transform._$rawMatrix();let e=d.sqrt(t[2]*t[2]+t[3]*t[3]);if(!ft.isInteger(e)){const i=e.toString(),r=i.indexOf("e");r!==-1&&(e=+i.slice(0,r)),e=+e.toFixed(4)}return 0>t[3]?e*-1:e}set scaleY(t){if(t=O(+t,Qt,te),!ft.isInteger(t)){const n=t.toString(),a=n.indexOf("e");a!==-1&&(t=+n.slice(0,a)),t=+t.toFixed(4)}if(this._$scaleY===t)return;const e=this._$transform,i=e._$matrix!==null,r=i?e._$matrix:e.matrix;if(r.c===0||Ie(r.c))r.d=t;else{let n=d.atan2(-r.c,r.d);n===-d.PI&&(n=0),r.c=-t*d.sin(n),r.d=t*d.cos(n)}i?(this._$doChanged(),pt()):(e.matrix=r,Zt(r)),this._$scaleY=t}get stage(){if(this._$stage)return this._$stage;const t=this._$parent;return t?t._$stage:null}get transform(){return this._$transform}set transform(t){this._$transform=t}get visible(){return this._$visible}set visible(t){this._$visible!==t&&(this._$visible=!!t,this._$doChanged(),pt())}get width(){const t="_$getBounds"in this&&typeof this._$getBounds=="function"?this._$getBounds():et(),e=wt(t,this._$transform._$rawMatrix());W(t);const i=d.abs(e.xMax-e.xMin);switch(W(e),!0){case i===0:case i===bt:case i===0-bt:return 0;default:return+i.toFixed(2)}}set width(t){if(t=+t,!Ie(t)&&t>-1){const e="_$getBounds"in this&&typeof this._$getBounds=="function"?this._$getBounds():et(),i=this.rotation,r=i?wt(e,this._$transform._$rawMatrix()):e;i&&W(e);const n=d.abs(r.xMax-r.xMin);switch(W(r),!0){case n===0:case n===bt:case n===-bt:this.scaleX=0;break;default:this.scaleX=t/n;break}}}get x(){return this._$transform._$rawMatrix()[4]}set x(t){const e=this._$transform;if(e._$matrix)e._$matrix.tx=t,this._$doChanged(),pt();else{const i=e.matrix;i.tx=t,e.matrix=i,Zt(i)}}get y(){return this._$transform._$rawMatrix()[5]}set y(t){const e=this._$transform;if(e._$matrix)e._$matrix.ty=t,this._$doChanged(),pt();else{const i=e.matrix;i.ty=t,e.matrix=i,Zt(i)}}getBounds(t=null){const e="_$getBounds"in this&&typeof this._$getBounds=="function"?this._$getBounds():et(),i=this._$transform.concatenatedMatrix,r=wt(e,i._$matrix);Zt(i),W(e);const n=et(r.xMin,r.xMax,r.yMin,r.yMax);W(r),t||(t=this);const a=t._$transform.concatenatedMatrix;a.invert();const o=wt(n,a._$matrix);W(n),Zt(a);const c=o.xMin,u=o.yMin,l=o.xMax,h=o.yMax;return W(o),new ue(c,u,d.abs(l-c),d.abs(h-u))}globalToLocal(t){const e=this._$transform.concatenatedMatrix;e.invert();const i=new Mt(t.x*e.a+t.y*e.c+e.tx,t.x*e.b+t.y*e.d+e.ty);return Zt(e),i}hitTestObject(t){const e="_$getBounds"in this&&typeof this._$getBounds=="function"?this._$getBounds():et(),i=this._$transform.concatenatedMatrix,r=wt(e,i._$matrix);Zt(i),W(e);const n=t._$getBounds(null),a=t._$transform.concatenatedMatrix,o=wt(n,a._$matrix);Zt(a),W(n);const c=d.max(r.xMin,o.xMin),u=d.max(r.yMin,o.yMin),l=d.min(r.xMax,o.xMax),h=d.min(r.yMax,o.yMax);return W(r),W(o),l-c>=0&&h-u>=0}hitTestPoint(t,e,i=!1){if(i){let c=Jt,u=this._$parent;for(;u;)c=ct(u._$transform._$rawMatrix(),c),u=u._$parent;ge.setTransform(1,0,0,1,0,0),ge.beginPath();let l=!1;return"_$hit"in this&&typeof this._$hit=="function"&&(l=this._$hit(ge,c,{x:t,y:e},!0)),c!==Jt&&tt(c),l}const r="_$getBounds"in this&&typeof this._$getBounds=="function"?this._$getBounds():et(),n=wt(r,this._$transform._$rawMatrix());W(r);const a=new ue(n.xMin,n.yMin,n.xMax-n.xMin,n.yMax-n.yMin);W(n);const o=this._$parent?this._$parent.globalToLocal(new Mt(t,e)):new Mt(t,e);return a.containsPoint(o)}localToGlobal(t){const e=this._$transform.concatenatedMatrix,i=new Mt(t.x*e.a+t.y*e.c+e.tx,t.x*e.b+t.y*e.d+e.ty);return Zt(e),i}getLocalVariable(t){if(!this._$variables)return null;if(this._$variables.has(t))return this._$variables.get(t)}setLocalVariable(t,e){this._$variables||(this._$variables=yt()),this._$variables.set(t,e)}hasLocalVariable(t){return this._$variables?this._$variables.has(t):!1}deleteLocalVariable(t){this._$variables&&this._$variables.has(t)&&(this._$variables.delete(t),this._$variables.size||(Pe(this._$variables),this._$variables=null))}getGlobalVariable(t){return Ss.has(t)?Ss.get(t):null}setGlobalVariable(t,e){Ss.set(t,e)}hasGlobalVariable(t){return Ss.has(t)}deleteGlobalVariable(t){Ss.has(t)&&Ss.delete(t)}clearGlobalVariable(){return Ss.clear()}_$getPlaceObject(){if(!this._$placeObject){const t=this._$placeId;if(t===-1)return null;const e=this._$parent;if(!e||!e._$placeObjects)return null;const i=e._$placeMap;if(!i||!i.length)return null;const r="currentFrame"in e?e.currentFrame:1,n=i[r];if(!n)return null;const a=n[t]|0,o=e._$placeObjects[a];return o?(this._$changePlace=a!==this._$currentPlaceId,this._$currentPlaceId=a,this._$placeObject=o,o):null}return this._$placeObject}_$baseBuild(t,e){const i=e._$loaderInfo;if(!i||!i._$data)throw new Error("the loaderInfo or data is nul.");return this._$parent=e,this._$root=e._$root,this._$stage=e._$stage,this._$loaderInfo=i,this._$characterId=t.characterId|0,this._$clipDepth=t.clipDepth|0,this._$startFrame=t.startFrame|0,this._$endFrame=t.endFrame|0,this._$name=t.name||"",i._$data.characters[t.characterId]}_$isUpdated(){return this._$updated}_$updateState(){this._$isNext=!0;const t=this._$parent;t&&t._$updateState()}_$doChanged(){this._$posted=!1,this._$isNext=!0,this._$updated=!0;const t=this._$parent;t&&(t._$updated||t._$doChanged())}_$drawFilter(t,e,i,r,n,a=null){const o=A(this._$instanceId,"f");let c=J.get(o);const u=this._$isFilterUpdated(e,i,!0);if(c&&!u)return t.cachePosition=c,c;c&&J.set(o,null);const l=t.frameBuffer,h=a||t.getTextureFromRect(t.cachePosition),$=this._$applyFilter(t,i,h,e,r,n);l.textureManager.release(h);const _=this._$getLayerBounds(e);return c=l.createCachePosition(d.ceil(d.abs(_.xMax-_.xMin)),d.ceil(d.abs(_.yMax-_.yMin))),W(_),c.filterState=!0,c.matrix=`${e[0]}_${e[1]}_${e[2]}_${e[3]}_0_0`,c.offsetX=$.offsetX,c.offsetY=$.offsetY,t.drawTextureFromRect($,c),J.set(o,c),V(o),c}_$getLayerBounds(t){const e="_$getBounds"in this&&typeof this._$getBounds=="function"?this._$getBounds():et(),i=wt(e,t);W(e);const r=this._$filters||this.filters;if(!r.length)return i;let n=et(0,d.abs(i.xMax-i.xMin),0,d.abs(i.yMax-i.yMin));W(i);let a=+d.sqrt(t[0]*t[0]+t[1]*t[1]),o=+d.sqrt(t[2]*t[2]+t[3]*t[3]);a/=at,o/=at,a*=2,o*=2;for(let c=0;c<r.length;++c)n=r[c]._$generateFilterRect(n,a,o);return n}_$executeAddedEvent(){this._$parent&&(this._$added||(this.willTrigger(S.ADDED)&&this.dispatchEvent(new S(S.ADDED,!0)),this._$added=!0),!this._$addedStage&&this._$stage!==null&&(this.willTrigger(S.ADDED_TO_STAGE)&&this.dispatchEvent(new S(S.ADDED_TO_STAGE)),this._$addedStage=!0))}_$prepareActions(){this._$nextFrame()}_$nextFrame(){return this._$executeAddedEvent(),this._$isNext=!1,!this._$posted&&X&&this._$postProperty(),!1}_$canApply(t=null){if(t){for(let e=0;e<t.length;++e)if(t[e]._$canApply())return!0}return!1}_$isFilterUpdated(t,e=null,i=!1){if(this._$isUpdated())return!0;if(i&&e){for(let n=0;n<e.length;++n)if(e[n]._$isUpdated())return!0}const r=J.get([this._$instanceId,"f"]);return!r||r.filterState!==i||r.matrix!==`${t[0]}_${t[1]}_${t[2]}_${t[3]}`}_$applyFilter(t,e,i,r,n,a){const o=+d.sqrt(r[0]*r[0]+r[1]*r[1]),c=+d.sqrt(r[2]*r[2]+r[3]*r[3]),u=d.atan2(r[1],r[0]),l=d.atan2(-r[2],r[3]),h=Pt(d.cos(u),d.sin(u),-d.sin(l),d.cos(l),n/2,a/2),$=Pt(1,0,0,1,-i.width/2,-i.height/2),_=ct(h,$);tt(h),tt($);const g=t.frameBuffer,f=g.currentAttachment,m=g.createCacheAttachment(n,a);t._$bind(m),t.reset(),t.setTransform(_[0],_[1],_[2],_[3],_[4],_[5]),tt(_),t.drawImage(i,0,0,i.width,i.height),t._$offsetX=0,t._$offsetY=0;const p=Pt(o,0,0,c,0,0);let x=null;for(let y=0;y<e.length;++y)x=e[y]._$applyFilter(t,p);if(tt(p),!x)return i;const b=t._$offsetX,T=t._$offsetY;return t._$offsetX=0,t._$offsetY=0,x.offsetX=b,x.offsetY=T,t._$bind(f),g.releaseAttachment(m,!1),x}_$shouldClip(t){const e="_$getBounds"in this&&typeof this._$getBounds=="function"?this._$getBounds(t):et(),i=d.abs(e.xMax-e.xMin),r=d.abs(e.yMax-e.yMin);return W(e),!(!i||!r)}_$startClip(t,e){t.drawInstacedArray();const i="_$getBounds"in this&&typeof this._$getBounds=="function"?this._$getBounds(e):et(),r=t._$startClip(i);if(W(i),!r)return!1;t._$enterClip(),t._$beginClipDef();let n=!1;return"_$children"in this&&(n=!0,t._$updateContainerClipFlag(!0)),this._$clip(t,e),this._$updated=!1,n&&(t._$updateContainerClipFlag(!1),t._$drawContainerClip()),t._$endClipDef(),!0}_$removeWorkerInstance(){X&&X.postMessage({command:"remove",instanceId:this._$instanceId})}_$registerProperty(t,e=0){t[e++]=+this._$visible,t[e++]=this._$placeId,t[e++]=this._$clipDepth,t[e++]=+this._$isMask;const i=this._$mask;if(t[e++]=+(i!==null),i){t[e++]=i._$instanceId;let a=Jt,o=i._$parent;for(;o;)a=ct(o._$transform._$rawMatrix(),a),o=o._$parent;t[e++]=a[0],t[e++]=a[1],t[e++]=a[2],t[e++]=a[3],t[e++]=a[4],t[e++]=a[5]}else e+=7;if(this._$visible){const a=this._$transform,o=a._$rawMatrix();t[e++]=o[0],t[e++]=o[1],t[e++]=o[2],t[e++]=o[3],t[e++]=o[4],t[e++]=o[5];const c=a._$rawColorTransform();t[e++]=c[0],t[e++]=c[1],t[e++]=c[2],t[e++]=c[3],t[e++]=c[4],t[e++]=c[5],t[e++]=c[6],t[e++]=c[7]}else e+=6,e+=8;const r=this._$blendMode||this.blendMode;t[e++]=a0(r);const n=this._$scale9Grid;t[e++]=+(n!==null),n?(t[e++]=n.x,t[e++]=n.y,t[e++]=n.width,t[e++]=n.height):e+=4}_$createMessage(){const t={command:"setProperty",buffer:new Float32Array,instanceId:this._$instanceId,parentId:this._$parent?this._$parent._$instanceId:-1,visible:this._$visible};this._$placeId>-1&&(t.depth=this._$placeId),this._$clipDepth&&(t.clipDepth=this._$clipDepth),this._$isMask&&(t.isMask=this._$isMask);const e=this._$mask;if(e){t.maskId=e._$instanceId;let i=Jt,r=e._$parent;for(;r;)i=ct(r._$transform._$rawMatrix(),i),r=r._$parent;t.maskMatrix=i}if(this._$visible){const i=this._$transform,r=i._$rawMatrix();r[0]!==1&&(t.a=r[0]),r[1]!==0&&(t.b=r[1]),r[2]!==0&&(t.c=r[2]),r[3]!==1&&(t.d=r[3]),r[4]!==0&&(t.tx=r[4]),r[5]!==0&&(t.ty=r[5]);const n=i._$rawColorTransform();n[0]!==1&&(t.f0=n[0]),n[1]!==1&&(t.f1=n[1]),n[2]!==1&&(t.f2=n[2]),n[3]!==1&&(t.f3=n[3]),n[4]!==0&&(t.f4=n[4]),n[5]!==0&&(t.f5=n[5]),n[6]!==0&&(t.f6=n[6]),n[7]!==0&&(t.f7=n[7]);const a=this._$filters||this.filters;if(a&&a.length){const u=A();for(let l=0;l<a.length;++l)u.push(a[l]._$toArray());t.filters=u}const o=this._$blendMode||this.blendMode;o!=="normal"&&(t.blendMode=o);const c=this._$scale9Grid;if(c&&this._$isUpdated()){const u=this._$parent._$transform.concatenatedMatrix;t.matrixBase=u._$matrix.slice(),Zt(u),t.grid={x:c.x,y:c.y,w:c.width,h:c.height}}}return t}}class nr extends sa{constructor(){super(),this._$mouseEnabled=!0}get mouseEnabled(){return this._$mouseEnabled}set mouseEnabled(t){this._$mouseEnabled=!!t}}class Yt extends nr{constructor(){return super(),this._$placeMap=null,this._$placeObjects=null,this._$controller=null,this._$dictionary=null,this._$children=A(),this._$needsChildren=!0,this._$mouseChildren=!0,this._$wait=!0,this._$names=yt(),new Proxy(this,{get:(t,e)=>t._$names.size&&t._$names.has(e)?t._$names.get(e):t[e]})}get mouseChildren(){return this._$mouseChildren}set mouseChildren(t){this._$mouseChildren=!!t}get numChildren(){return this._$needsChildren?this._$getChildren().length:this._$children.length}addChild(t){return t._$parent&&t._$parent._$remove(t,t._$parent._$instanceId!==this._$instanceId),this._$getChildren().push(t),t._$name&&this._$names.set(t._$name,t),this._$addChild(t)}addChildAt(t,e){t._$parent&&t._$parent._$remove(t,t._$parent._$instanceId!==this._$instanceId);const i=this._$getChildren(),r=i.length;if(0>e||e>r)throw new RangeError(`RangeError: addChildAt: index error: ${e}`);if(r&&r>e){i.splice(e,0,t);for(let n=0;n<e;++n){const a=i[n];a._$name&&this._$names.set(a._$name,a)}}else i.push(t),t._$name&&this._$names.set(t._$name,t);return this._$addChild(t)}contains(t){if(this._$instanceId===t._$instanceId)return!0;const e=this._$getChildren();for(let i=0;i<e.length;++i){const r=e[i];if(r._$instanceId===t._$instanceId||r instanceof Yt&&r.contains(t))return!0}return!1}getChildAt(t){const e=this._$getChildren();if(0>t||t>e.length)throw new RangeError(`RangeError: getChildAt: index error: ${t}`);return t in e?e[t]:null}getChildByName(t){if(!t)return null;const e=this._$getChildren();for(let i=0;i<e.length;++i){const r=e[i];if(r.name===t)return r}return null}getChildIndex(t){if(t._$parent!==this)throw new Error("ArgumentError: getChildIndex: not child");const e=this._$getChildren().indexOf(t);if(e===-1)throw new Error("ArgumentError: getChildIndex: not found.");return e}removeChild(t){if(t._$parent!==this)throw new Error("ArgumentError: removeChild: not child");return this._$remove(t)}removeChildAt(t){return this._$remove(this.getChildAt(t))}removeChildren(t=0,e=2147483647){const i=this._$getChildren();if(i.length){t=O(t,0,2147483646,0)-1,e=O(e,1,134217727,134217727);for(let r=d.min(e,i.length-1);r>t;--r)this._$remove(i[r])}}setChildIndex(t,e){const i=this.getChildIndex(t);if(i===e)return;const r=this._$getChildren();r.splice(i,1),r.splice(e,0,t),X&&this._$postChildrenIds(),this._$doChanged()}swapChildren(t,e){const i=this._$getChildren(),r=this.getChildIndex(t),n=this.getChildIndex(e);i[r]=e,i[n]=t,X&&this._$postChildrenIds(),this._$doChanged()}swapChildrenAt(t,e){this.swapChildren(this.getChildAt(t),this.getChildAt(e))}_$getBounds(t=null){let e=Jt;if(t){e=t;const u=this._$transform._$rawMatrix();(u[0]!==1||u[1]!==0||u[2]!==0||u[3]!==1||u[4]!==0||u[5]!==0)&&(e=ct(t,u))}const i=this._$needsChildren?this._$getChildren():this._$children;if(!i.length){const u=et(e[4],-e[4],e[5],-e[5]);return t&&e!==t&&tt(e),u}const r=ft.MAX_VALUE;let n=r,a=-r,o=r,c=-r;for(let u=0;u<i.length;++u){const l=i[u]._$getBounds(e);n=d.min(n,l.xMin),a=d.max(a,l.xMax),o=d.min(o,l.yMin),c=d.max(c,l.yMax),W(l)}return t&&e!==t&&tt(e),et(n,a,o,c)}_$getLayerBounds(t){const e=this._$needsChildren?this._$getChildren():this._$children;if(!e.length)return et(0,0,0,0);const i=ft.MAX_VALUE;let r=i,n=-i,a=i,o=-i;for(let $=0;$<e.length;++$){const _=e[$];let g=t;const f=_._$transform._$rawMatrix();(f[0]!==1||f[1]!==0||f[2]!==0||f[3]!==1||f[4]!==0||f[5]!==0)&&(g=ct(t,f));const m=_._$getLayerBounds(g);r=d.min(r,m.xMin),n=d.max(n,m.xMax),a=d.min(a,m.yMin),o=d.max(o,m.yMax),W(m),g!==t&&tt(g)}const c=this._$filters||this.filters;if(!c.length)return et(r,n,a,o);let u=et(0,n-r,0,o-a),l=+d.sqrt(t[0]*t[0]+t[1]*t[1]),h=+d.sqrt(t[2]*t[2]+t[3]*t[3]);l/=at,h/=at,l*=2,h*=2;for(let $=0;$<c.length;++$)u=c[$]._$generateFilterRect(u,l,h);return n+=u.xMax-(n-r),o+=u.yMax-(o-a),r+=u.xMin,a+=u.yMin,W(u),et(r,n,a,o)}_$getChildren(){if(this._$needsChildren){this._$needsChildren=!1;const t=this._$children;if(!this._$controller)return t;const e="_$currentFrame"in this?this._$currentFrame:1,i=this._$controller[e];if(!t.length){if(i)for(let u=0;u<i.length;++u){const l=this._$createInstance(i[u]);l._$placeId=u;const h=l.loopConfig;h&&(l._$currentFrame=l._$getLoopFrame(h)),t.push(l),l._$name&&this._$names.set(l._$name,l)}return t}const r=!!X&&!!this._$stage,n=yt(),a=yt();let o=0;const c=A();for(let u=0;u<t.length;++u){const l=t[u],h=l._$parent;if(!h||h._$instanceId!==this._$instanceId)continue;const $=l._$instanceId,_=l._$startFrame,g=l._$endFrame;if(_===1&&g===0||_<=e&&g>e){if(l._$isNext=!0,l._$placeObject=null,l._$filters=null,l._$blendMode=null,l._$id===-1){c.push(l),l._$name&&this._$names.set(l._$name,l);continue}const f=i[o];if(l._$id===f){l._$placeId=o,c.push(l),l._$name&&this._$names.set(l._$name,l),a.has(f)&&a.delete(f),n.set(f,!0),o++,r&&l._$postProperty();continue}a.set(l._$id,l);continue}r&&l._$removeWorkerInstance(),J.setRemoveTimer($),l._$loaderInfo&&l._$characterId&&J.setRemoveTimer(`${l._$loaderInfo._$id}@${l._$characterId}`),l._$graphics&&J.setRemoveTimer(l._$graphics._$uniqueKey),l.willTrigger(S.REMOVED)&&l.dispatchEvent(new S(S.REMOVED,!0)),l.willTrigger(S.REMOVED_FROM_STAGE)&&l.dispatchEvent(new S(S.REMOVED_FROM_STAGE,!0)),l._$added=!1,l._$addedStage=!1,l._$active=!1,l._$updated=!0,l._$filters=null,l._$blendMode=null,l._$isNext=!0,l._$placeObject=null,l._$created=!1,l._$posted=!1,l instanceof Yt&&(l._$executeRemovedFromStage(),l._$removeParentAndStage())}if(i)for(let u=0;u<i.length;++u){const l=i[u];if(n.has(l))continue;const h=a.has(l)?a.get(l):this._$createInstance(l);h._$placeId=u;const $=h.loopConfig;$&&(h._$currentFrame=h._$getLoopFrame($)),c.push(h),h._$name&&this._$names.set(h._$name,h)}Pe(n),Pe(a),t.length=0,t.push(...c),V(c)}return this._$children}_$clearChildren(){this._$doChanged(),pt(),this._$names.clear(),this._$needsChildren=!0}_$addChild(t){return t._$parent=this,(!t._$stage||!t._$root)&&(t._$stage=this._$stage,t._$root=this._$root),t instanceof Yt&&(t._$setParentAndStage(),t._$wait=!0),t._$added||(t.willTrigger(S.ADDED)&&t.dispatchEvent(new S(S.ADDED,!0)),t._$added=!0),this._$stage!==null&&!t._$addedStage&&(t.willTrigger(S.ADDED_TO_STAGE)&&t.dispatchEvent(new S(S.ADDED_TO_STAGE)),t._$addedStage=!0,t instanceof Yt&&t._$executeAddedToStage(),X&&(t._$createWorkerInstance(),this._$postChildrenIds())),this._$doChanged(),t._$active=!0,t._$updated=!0,t._$isNext=!0,t}_$setParentAndStage(){const t=this._$needsChildren?this._$getChildren():this._$children;for(let e=0;e<t.length;++e){const i=t[e];i._$root=this._$root,i._$stage=this._$stage,i instanceof Yt&&(i._$setParentAndStage(),i._$wait=!0)}}_$executeAddedToStage(){const t=this._$needsChildren?this._$getChildren():this._$children,e=A();for(let i=0;i<t.length;++i){const r=t[i];r&&(e.push(r._$instanceId),r._$addedStage||(X&&r._$createWorkerInstance(),r.willTrigger(S.ADDED_TO_STAGE)&&r.dispatchEvent(new S(S.ADDED_TO_STAGE)),r._$addedStage=!0),r instanceof Yt&&r._$executeAddedToStage())}X&&this._$postChildrenIds(e),V(e)}_$remove(t,e=!0){t._$transform._$transform(),t.hasEventListener(S.ENTER_FRAME)&&t.removeAllEventListener(S.ENTER_FRAME),t.hasEventListener(S.EXIT_FRAME)&&t.removeAllEventListener(S.EXIT_FRAME),t.hasEventListener(S.FRAME_CONSTRUCTED)&&t.removeAllEventListener(S.FRAME_CONSTRUCTED),t.hasEventListener(S.RENDER)&&t.removeAllEventListener(S.RENDER),t.hasEventListener(S.ACTIVATE)&&t.removeAllEventListener(S.ACTIVATE),t.hasEventListener(S.DEACTIVATE)&&t.removeAllEventListener(S.DEACTIVATE),t.hasEventListener("keyDown")&&t.removeAllEventListener("keyDown"),t.hasEventListener("keyUp")&&t.removeAllEventListener("keyUp");const i=this._$needsChildren?this._$getChildren():this._$children,r=this.getChildIndex(t);return i.splice(r,1),this._$names.delete(t.name),e&&(t.willTrigger(S.REMOVED)&&t.dispatchEvent(new S(S.REMOVED,!0)),this._$stage!==null&&(X&&(t._$removeWorkerInstance(),this._$postChildrenIds()),t.willTrigger(S.REMOVED_FROM_STAGE)&&t.dispatchEvent(new S(S.REMOVED_FROM_STAGE)),t instanceof Yt&&t._$executeRemovedFromStage()),J.setRemoveTimer(t._$instanceId),t._$loaderInfo&&t._$characterId&&J.setRemoveTimer(`${t._$loaderInfo._$id}@${t._$characterId}`),t._$graphics&&J.setRemoveTimer(t._$graphics._$uniqueKey),t instanceof Yt&&t._$removeParentAndStage(),t._$stage=null,t._$parent=null,t._$root=null,t._$active=!1,t._$wait=!0,t._$updated=!0,t._$added=!1,t._$addedStage=!1,t._$created=!1,t._$posted=!1,this._$doChanged()),t}_$executeRemovedFromStage(){const t=this._$getChildren().slice(0);for(let e=0;e<t.length;++e){const i=t[e];i&&(i._$addedStage&&(X&&i._$removeWorkerInstance(),i.willTrigger(S.REMOVED_FROM_STAGE)&&i.dispatchEvent(new S(S.REMOVED_FROM_STAGE)),i._$created=!1,i._$posted=!1,i._$addedStage=!1),i instanceof Yt&&i._$executeRemovedFromStage())}}_$removeParentAndStage(){const t=this._$needsChildren?this._$getChildren():this._$children;for(let e=0;e<t.length;++e){const i=t[e];J.setRemoveTimer(i._$instanceId),i._$loaderInfo&&i._$characterId&&J.setRemoveTimer(`${i._$loaderInfo._$id}@${i._$characterId}`),i._$graphics&&J.setRemoveTimer(i._$graphics._$uniqueKey),i instanceof Yt&&i._$removeParentAndStage(),i._$stage=null,i._$root=null,i._$addedStage=!1}if("_$sounds"in this){const e=this._$sounds;if(e.size)for(const i of e.values())for(let r=0;r<i.length;++r)i[r].stop()}this._$needsChildren=!0}_$prepareActions(){const t=this._$needsChildren?this._$getChildren():this._$children;for(let e=t.length-1;e>-1;--e)t[e]._$prepareActions();this._$executeAddedEvent()}_$nextFrame(){let t=!1;const e=this._$getChildren();for(let i=e.length-1;i>-1;--i){const r=e[i];r._$isNext&&(t?r._$nextFrame():t=r._$nextFrame())}return this._$executeAddedEvent(),this._$isNext=t,!this._$posted&&X&&this._$postProperty(),this._$isNext}_$clip(t,e){let i=e;const r=this._$transform._$rawMatrix();(r[0]!==1||r[1]!==0||r[2]!==0||r[3]!==1||r[4]!==0||r[5]!==0)&&(i=ct(e,r));const n=this._$getChildren();for(let a=0;a<n.length;++a){const o=n[a];o._$isMask||(o._$clip(t,i),o._$updated=!1)}i!==e&&tt(i)}_$preDraw(t,e){let i=e;const r=this._$transform._$rawMatrix();if((r!==$e&&r[0]!==1||r[1]!==0||r[2]!==0||r[3]!==1||r[4]!==0||r[5]!==0)&&(i=ct(e,r)),!i[0]&&!i[1]||!i[2]&&!i[3])return i!==e&&tt(i),null;const n=q_();n.matrix=i;const a=this._$filters||this.filters,o=this._$blendMode||this.blendMode;if(a.length>0||o!=="normal"){const c=this._$getBounds(null),u=wt(c,i);W(c);const l=+u.xMax,h=+u.xMin,$=+u.yMax,_=+u.yMin;W(u);const g=d.ceil(d.abs(l-h)),f=d.ceil(d.abs($-_));if(0>=g||0>=f)return qi(n),i!==e&&tt(i),null;let m=+d.sqrt(i[0]*i[0]+i[1]*i[1]);if(!ft.isInteger(m)){const I=m.toString(),D=I.indexOf("e");D!==-1&&(m=+I.slice(0,D)),m=+m.toFixed(4)}let p=+d.sqrt(i[2]*i[2]+i[3]*i[3]);if(!ft.isInteger(p)){const I=p.toString(),D=I.indexOf("e");D!==-1&&(p=+I.slice(0,D)),p=+p.toFixed(4)}n.canApply=this._$canApply(a);let x=et(0,g,0,f);if(n.canApply&&a)for(let I=0;I<a.length;++I)x=a[I]._$generateFilterRect(x,m,p);const b=t.frameBuffer.currentAttachment;if(!b||!b.texture||h-x.xMin>b.width||_-x.yMin>b.height||0>h+x.xMax||0>_+x.yMax)return W(x),qi(n),i!==e&&tt(i),null;let T=i[4]-h,y=i[5]-_;t._$startLayer(et(h,l,_,$));const v=this._$isFilterUpdated(i,a,n.canApply),L=this._$getLayerBounds(i),B=d.ceil(d.abs(L.xMax-L.xMin)),F=d.ceil(d.abs(L.yMax-L.yMin));W(L);const R=B-x.xMax+x.xMin,w=F-x.yMax+x.yMin;T+=R,y+=w,n.sw=R,n.sh=w,v&&t._$saveAttachment(d.ceil(g+R),d.ceil(f+w),!0),n.isLayer=!0,n.isUpdated=v,n.filters=a,n.blendMode=o,n.color=Hn(),n.matrix=Pt(i[0],i[1],i[2],i[3],T,y),i!==e&&tt(i),W(x)}return n}_$postDraw(t,e,i,r){t.drawInstacedArray();const n=A(this._$instanceId,"f"),a=t.frameBuffer,o=r.matrix;let c=0,u=0,l=J.get(n);if(!l||r.isUpdated){l&&J.set(n,null),l=a.getTextureFromCurrentAttachment();const $=r.filters;let _=!1;if($&&$.length){for(let g=0;g<$.length;++g)l=$[g]._$applyFilter(t,e);_=!0,c=t._$offsetX,u=t._$offsetY,t._$offsetX=0,t._$offsetY=0}l.filterState=_,l.matrix=`${o[0]}_${o[1]}_${o[2]}_${o[3]}`,l.offsetX=c,l.offsetY=u,J.set(n,l),t._$restoreAttachment()}l.offsetX&&(c=l.offsetX),l.offsetY&&(u=l.offsetY),t.reset(),t.globalAlpha=O(i[3]+i[7]/255,0,1),t.globalCompositeOperation=r.blendMode;const h=t.getCurrentPosition();t.setTransform(1,0,0,1,h.xMin-c-r.sw,h.yMin-u-r.sh),t.drawImage(l,0,0,l.width,l.height,i),t._$endLayer(),tt(r.matrix),qi(r),t.cachePosition=null}_$draw(t,e,i){if(!this._$visible)return;const r=this._$transform;let n=i;const a=r._$rawColorTransform();if((a!==vr&&a[0]!==1||a[1]!==1||a[2]!==1||a[3]!==1||a[4]!==0||a[5]!==0||a[6]!==0||a[7]!==0)&&(n=yi(i,a)),!O(n[3]+n[7]/255,0,1,0))return;const c=this._$getChildren(),u=c.length;if(!u)return;const l=this._$preDraw(t,e);if(!l)return;if(l.isLayer&&!l.isUpdated){this._$postDraw(t,e,n,l);return}const h=l.matrix,$=l.isLayer&&l.color?l.color:n;let _=!0,g=0;const f=nt(),m=t.isLayer,p=this._$isUpdated();for(let x=0;x<u;++x){const b=c[x];if(p&&(b._$placeObject=null),b._$isMask)continue;const T=b._$blendMode||b.blendMode;if((T==="alpha"||T==="erase")&&!m||(g&&(b._$placeId>g||b._$clipDepth>0)&&(t.restore(),_&&t._$leaveClip(),g=0,_=!0),!_))continue;if(b._$clipDepth>0){g=b._$clipDepth,_=b._$shouldClip(h),_&&(t.save(),_=b._$startClip(t,h));continue}const y=b._$mask;if(y){y._$updated=!1;let v;if(this===y._$parent)v=h;else{v=Jt;let B=y._$parent;for(;B;)v=ct(B._$transform._$rawMatrix(),v),B=B._$parent;const F=f.scaleX,R=Pt(F,0,0,F,0,0);if(v=ct(R,v),tt(R),t.isLayer){const w=t.getCurrentPosition();v[4]-=w.xMin,v[5]-=w.yMin}}if(!y._$shouldClip(v))continue;const L=y._$startClip(t,v);if(t.save(),!L){t.restore();continue}}b._$draw(t,h,$),b._$updated=!1,y&&(t.restore(),t._$leaveClip())}if(g&&(t.restore(),_&&t._$leaveClip()),l.isLayer)return this._$postDraw(t,e,n,l);l.matrix!==e&&tt(l.matrix),n!==i&&$s(n),qi(l)}_$mouseHit(t,e,i,r=!0){let n=e;const a=this._$transform._$rawMatrix();a!==Jt&&(n=ct(e,a));const o=this._$getChildren(),c=A(),u=A(),l=yt();let h=0,$=0;for(let m=0;m<o.length;++m){const p=o[m];if(!(!p._$visible&&!p._$hitObject)){if(p._$clipDepth){$=c.length,h=p._$clipDepth,c.push(p);continue}h&&p._$placeId>h&&($=0,h=0),$&&l.set(p._$instanceId,$),u.push(p)}}const _=this._$mouseChildren&&r;let g=!1;const f=this._$root===this;for(;u.length;){const m=u.pop();if(m._$isMask||f&&!(m instanceof nr))continue;if(l.has(m._$instanceId)){const x=l.get(m._$instanceId);if(!x||!c[x]._$hit(t,n,i,!0))continue}const p=m._$mask;if(p)if(this===p._$parent){if(!p._$hit(t,n,i,!0))continue}else{let x=Jt,b=p._$parent;for(;b;)x=ct(b._$transform._$rawMatrix(),x),b=b._$parent;if(!p._$hit(t,x,i,!0))continue}if(m._$mouseHit(t,n,i,_)||m._$hitArea&&m._$hitArea._$mouseHit(t,n,i,_)){if(m._$root===m||!_)return!0;if(g=!0,m instanceof nr){if(!m.mouseEnabled&&!m._$hitObject)continue;return!Ke&&!i.pointer&&("_$text"in m&&"type"in m&&m.type==="input"&&(i.pointer="text"),"buttonMode"in m&&"useHandCursor"in m&&m.buttonMode&&m.useHandCursor&&(i.pointer="pointer")),i.hit||(i.hit=!m.mouseEnabled&&m._$hitObject?m._$hitObject:m),!0}}}return V(c),V(u),Pe(l),n!==e&&tt(n),g}_$hit(t,e,i,r=!1){let n=e;const a=this._$transform._$rawMatrix();a!==Jt&&(n=ct(e,a));const o=this._$getChildren();for(let c=o.length;c>-1;--c){const u=o[c];if(!u._$isMask&&u._$hit(t,n,i,r))return!0}return n!==e&&tt(n),!1}_$createInstance(t){if(!this._$dictionary)throw new Error("the dictionary is null.");const e=this._$dictionary[t],i=this._$loaderInfo;if(!i||!i._$data)throw new Error("the loaderInfo or data is null.");const r=i._$data.characters[e.characterId],n=o0(r.extends);return n._$build(e,this),n._$id=t,n}_$outCheck(t,e){let i=Jt,r=this._$parent;for(;r;)i=ct(r._$transform._$rawMatrix(),i),r=r._$parent;ge.setTransform(1,0,0,1,0,0),ge.beginPath();const n={x:t,y:e,pointer:"",hit:null};return this._$mouseHit(ge,i,n)}_$createWorkerInstance(){if(this._$created||!X)return;this._$created=!0,this._$posted=!0,this._$updated=!1;let t=0;const e=ur();e[t++]=this._$instanceId,e[t++]=this._$parent?this._$parent._$instanceId:-1,this._$registerProperty(e,t);const i=di();i.command="createDisplayObjectContainer",i.buffer=e;const r=A(e.buffer);X.postMessage(i,r),$i(i),V(r),this._$postChildrenIds()}_$postProperty(){if(!X)return;this._$postChildrenIds();const t=A(),e=this._$createMessage();X.postMessage(e,t),V(t),this._$posted=!0,this._$updated=!1}_$postChildrenIds(t=null){if(!X||!this._$created)return;let e=!1;if(!t){const a=this._$getChildren();t=A();for(let o=0;o<a.length;++o)t.push(a[o]._$instanceId);e=!0}const i=new Int32Array(t.length+1);i[0]=this._$instanceId,i.set(t,1);const r=di();r.command="setChildren",r.buffer=i;const n=A(i.buffer);X.postMessage(r,n),$i(r),V(n),e&&V(t)}}class Ms{constructor(t=0,e=0){this._$instanceId=Zu(),this._$width=t|0,this._$height=e|0,this._$buffer=null,this._$image=null,this._$canvas=null,this._$texture=null}static toString(){return"[class BitmapData]"}static get namespace(){return"next2d.display.BitmapData"}toString(){return"[object BitmapData]"}get namespace(){return"next2d.display.BitmapData"}get instanceId(){return this._$instanceId}get height(){return this._$height}get buffer(){return this._$buffer}set buffer(t){if(this._$canvas=null,this._$image=null,this._$buffer=t,this._$texture){const i=nt().context;i&&i.frameBuffer.releaseTexture(this._$texture),this._$texture=null}}get image(){return this._$image}set image(t){if(this._$canvas=null,this._$buffer=null,this._$image=t,this._$texture){const i=nt().context;i&&i.frameBuffer.releaseTexture(this._$texture),this._$texture=null}t&&(this._$width=t.width,this._$height=t.height)}get canvas(){return this._$canvas}set canvas(t){if(this._$image=null,this._$buffer=null,this._$canvas=t,this._$texture){const i=nt().context;i&&i.frameBuffer.releaseTexture(this._$texture),this._$texture=null}t&&(this._$width=t.width,this._$height=t.height)}get width(){return this._$width}clone(){const t=new Ms(this.width,this.height);if(this._$image!==null||this._$canvas!==null){const e=J.getCanvas();e.width=this.width,e.height=this.height;const i=e.getContext("2d");if(!i)throw new Error("the context is null.");this._$image&&i.drawImage(this._$image,0,0),this._$canvas&&i.drawImage(this._$canvas,0,0),t.canvas=e}else this._$buffer!==null&&(t._$buffer=this._$buffer.slice());return t}getTexture(){const{width:t,height:e}=this;if(!t||!e)return null;const r=nt().context;if(!r)throw new Error("the context is null.");return this._$texture!==null?this._$texture:(this._$image!==null&&(this._$texture=r.frameBuffer.createTextureFromImage(this._$image)),this._$canvas!==null&&(this._$texture=r.frameBuffer.createTextureFromCanvas(this._$canvas)),this._$buffer!==null&&(this._$texture=r.frameBuffer.createTextureFromPixels(t,e,this._$buffer,!0)),this._$texture)}draw(t,e=null,i=null,r=null,n=null){const{width:a,height:o}=this;if(!a||!o)return;const c=nt(),u=c._$width,l=c._$height;(a>u||o>l)&&(c._$width=a,c._$height=o,c._$resizeCanvas(a,o,c.scaleX));const $=i?i._$colorTransform:vr;let _=e?e._$matrix:Jt;if(e){const g=t._$transform.matrix;g.invert(),_=ct(_,g._$matrix),Zt(g)}if(r||(r=J.getCanvas()),X){t._$stage||(t instanceof Yt?Fn&&Fn(t):(t._$createWorkerInstance(),t._$postProperty())),r.width=a,r.height=o;const g=r.getContext("2d");if(!g)throw new Error("the context is null.");g.setTransform(1,0,0,1,0,0),g.clearRect(0,0,a,o);const f=t._$instanceId;s0.set(f,{source:t,context:g,callback:n});const m=A(),p={command:"bitmapDraw",sourceId:f,width:a,height:o};(_[0]!==1||_[1]!==0||_[2]!==0||_[3]!==1||_[4]!==0||_[5]!==0)&&(p.matrix=_.slice(),m.push(p.matrix.buffer)),($[0]!==1||$[1]!==1||$[2]!==1||$[3]!==1||$[4]!==0||$[5]!==0||$[6]!==0||$[7]!==0)&&(p.colorTransform=$.slice(),m.push(p.colorTransform.buffer)),X.postMessage(p,m),V(m)}else{const g=c.context;if(!g)throw new Error("the context is null.");g.reset(),g.setTransform(1,0,0,1,0,0),g.clearRect(0,0,c._$width,c._$height),g.beginPath(),t._$draw(g,_,$),g.drawInstacedArray(),g.frameBuffer.transferToMainTexture(),r.width=a,r.height=o;const f=r.getContext("2d");if(!f)return;f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,a,o),f.drawImage(c.canvas,0,0),n&&n(r)}e&&Zt(e),i&&Xl(i)}}class J_{static toString(){return"[class BlendMode]"}static get namespace(){return"next2d.display.BlendMode"}toString(){return"[object BlendMode]"}get namespace(){return"next2d.display.BlendMode"}static get ADD(){return"add"}static get ALPHA(){return"alpha"}static get DARKEN(){return"darken"}static get DIFFERENCE(){return"difference"}static get ERASE(){return"erase"}static get HARDLIGHT(){return"hardlight"}static get INVERT(){return"invert"}static get LAYER(){return"layer"}static get LIGHTEN(){return"lighten"}static get MULTIPLY(){return"multiply"}static get NORMAL(){return"normal"}static get OVERLAY(){return"overlay"}static get SCREEN(){return"screen"}static get SUBTRACT(){return"subtract"}}class pl extends Ei{constructor(t,e){super(),this._$name=`${t}`,this._$frame=e|0}static toString(){return"[class FrameLabel]"}static get namespace(){return"next2d.display.FrameLabel"}toString(){return"[object FrameLabel]"}get namespace(){return"next2d.display.FrameLabel"}get frame(){return this._$frame}get name(){return this._$name}}class In{constructor(t,e=null,i=!0,r=!1){this._$bitmapData=t,this._$matrix=e,this._$repeat=i,this._$smooth=r}clone(){return new In(this._$bitmapData.clone(),this._$matrix?this._$matrix.clone():null,this._$repeat,this._$smooth)}toArray(){return A(this._$bitmapData,this._$matrix,this._$repeat,this._$smooth)}}class An{constructor(t,e,i,r,n=null,a="pad",o="rgb",c=0){this._$type=t,this._$colors=e,this._$alphas=i,this._$ratios=r,this._$matrix=n,this._$spreadMethod=a,this._$interpolationMethod=o,this._$focalPointRatio=c,this._$colorStops=A()}get colorStops(){if(!this._$colorStops.length){const t=d.min(d.min(this._$alphas.length,this._$colors.length),this._$ratios.length);for(let e=0;e<t;++e){const i=this._$colors[e],r=typeof i=="string"?$l(i):i,n=ve(r,this._$alphas[e]);this._$colorStops[e]={ratio:this._$ratios[e]/255,R:n.R,G:n.G,B:n.B,A:n.A}}}return this._$colorStops}toArray(){return A(this._$type,this.colorStops,this._$matrix?this._$matrix._$matrix:Jt,this._$spreadMethod,this._$interpolationMethod,this._$focalPointRatio)}clone(){return new An(this._$type,this._$colors.slice(),this._$alphas.slice(),this._$ratios.slice(),this._$matrix?this._$matrix.clone():null,this._$spreadMethod,this._$interpolationMethod,this._$focalPointRatio)}}class U{constructor(t=null){this._$displayObject=t,this._$maxAlpha=0,this._$pointerX=0,this._$pointerY=0,this._$canDraw=!1,this._$fillType=0,this._$fillGradient=null,this._$fillBitmap=null,this._$fillStyleR=0,this._$fillStyleG=0,this._$fillStyleB=0,this._$fillStyleA=0,this._$doFill=!1,this._$lineType=0,this._$lineGradient=null,this._$caps="none",this._$joints="round",this._$miterLimit=0,this._$lineWidth=1,this._$lineStyleR=0,this._$lineStyleG=0,this._$lineStyleB=0,this._$lineStyleA=0,this._$doLine=!1,this._$xMin=ft.MAX_VALUE,this._$xMax=-ft.MAX_VALUE,this._$yMin=ft.MAX_VALUE,this._$yMax=-ft.MAX_VALUE,this._$buffer=null,this._$recode=null,this._$fills=null,this._$lines=null,this._$uniqueKey="",this._$cacheKeys=A(),this._$cacheParams=A(0,0,0),this._$bitmapId=0,this._$mode="shape",this._$posted=!1}static toString(){return"[class Graphics]"}static get namespace(){return"next2d.display.Graphics"}toString(){return"[object Graphics]"}get namespace(){return"next2d.display.Graphics"}static get MOVE_TO(){return 0}static get CURVE_TO(){return 1}static get LINE_TO(){return 2}static get CUBIC(){return 3}static get ARC(){return 4}static get FILL_STYLE(){return 5}static get STROKE_STYLE(){return 6}static get END_FILL(){return 7}static get END_STROKE(){return 8}static get BEGIN_PATH(){return 9}static get GRADIENT_FILL(){return 10}static get GRADIENT_STROKE(){return 11}static get CLOSE_PATH(){return 12}static get BITMAP_FILL(){return 13}static get BITMAP_STROKE(){return 14}beginBitmapFill(t,e=null,i=!0,r=!1){return this._$doFill&&this.endFill(),this._$fills||(this._$fills=A()),this._$maxAlpha=1,this._$doFill=!0,this._$canDraw=!0,this._$fills.push(U.BEGIN_PATH),this._$fillType=U.BITMAP_FILL,this._$fillBitmap=new In(t,e,i,r),this}beginFill(t=0,e=1){this._$doFill&&this.endFill(),this._$fills||(this._$fills=A()),t=O(It(t),0,16777215,0),e=O(e,0,1,1),this._$maxAlpha=d.max(this._$maxAlpha,e),this._$doFill=!0,this._$canDraw=!0,this._$fills.push(U.BEGIN_PATH);const i=ve(t,e);return this._$fillType=U.FILL_STYLE,this._$fillStyleR=i.R,this._$fillStyleG=i.G,this._$fillStyleB=i.B,this._$fillStyleA=i.A,this}beginGradientFill(t,e,i,r,n=null,a="pad",o="rgb",c=0){this._$doFill&&this.endFill(),this._$fills||(this._$fills=A());for(let u=0;u<i.length;++u)this._$maxAlpha=d.max(this._$maxAlpha,i[u]);return this._$doFill=!0,this._$canDraw=!0,this._$fills.push(U.BEGIN_PATH),this._$fillType=U.GRADIENT_FILL,this._$fillGradient=new An(t,e,i,r,n,a,o,c),this}clear(){return this._$maxAlpha=0,this._$pointerX=0,this._$pointerY=0,this._$canDraw=!1,this._$bitmapId=0,this._$mode="shape",this._$posted=!1,this._$fillType=0,this._$fillGradient=null,this._$fillBitmap=null,this._$fillStyleR=0,this._$fillStyleG=0,this._$fillStyleB=0,this._$fillStyleA=0,this._$doFill=!1,this._$lineType=0,this._$lineGradient=null,this._$caps="none",this._$joints="round",this._$miterLimit=0,this._$lineWidth=1,this._$lineStyleR=0,this._$lineStyleG=0,this._$lineStyleB=0,this._$lineStyleA=0,this._$doLine=!1,this._$xMin=ft.MAX_VALUE,this._$xMax=-ft.MAX_VALUE,this._$yMin=ft.MAX_VALUE,this._$yMax=-ft.MAX_VALUE,this._$recode&&V(this._$recode),this._$fills&&V(this._$fills),this._$lines&&V(this._$lines),this._$buffer=null,this._$recode=null,this._$fills=null,this._$lines=null,this._$cacheKeys.length=0,this._$uniqueKey="",this._$cacheParams.fill(0),this._$restart(),this}clone(){const t=new U;return t.copyFrom(this),t}copyFrom(t){t._$fillGradient&&(this._$fillGradient=t._$fillGradient.clone()),t._$fillBitmap&&(this._$fillBitmap=t._$fillBitmap.clone()),this._$doFill=t._$doFill,this._$fillType=t._$fillType,this._$fillStyleR=t._$fillStyleR,this._$fillStyleG=t._$fillStyleG,this._$fillStyleB=t._$fillStyleB,this._$fillStyleA=t._$fillStyleA,t._$lineGradient&&(this._$lineGradient=t._$lineGradient.clone()),this._$doLine=t._$doLine,this._$lineType=t._$lineType,this._$caps=t._$caps,this._$joints=t._$joints,this._$miterLimit=t._$miterLimit,this._$lineWidth=t._$lineWidth,this._$lineStyleR=t._$lineStyleR,this._$lineStyleG=t._$lineStyleG,this._$lineStyleB=t._$lineStyleB,this._$lineStyleA=t._$lineStyleA,this._$xMin=t._$xMin,this._$xMax=t._$xMax,this._$yMin=t._$yMin,this._$yMax=t._$yMax,this._$maxAlpha=t._$maxAlpha,this._$pointerX=t._$pointerX,this._$pointerY=t._$pointerY,this._$canDraw=t._$canDraw,t._$fills&&(this._$fills=t._$fills.slice(0)),t._$lines&&(this._$lines=t._$lines.slice(0)),t._$recode&&(this._$recode=t._$recode.slice(0))}cubicCurveTo(t,e,i,r,n,a){return n=+n||0,a=+a||0,this._$pointerX===n&&this._$pointerY===a?this:(t=+t||0,e=+e||0,i=+i||0,r=+r||0,this._$setBounds(t,e),this._$setBounds(i,r),this._$setBounds(n,a),this._$margePath(A(U.CUBIC,t,e,i,r,n,a)),this._$pointerX=n,this._$pointerY=a,this._$restart(),this)}curveTo(t,e,i,r){return i=+i||0,r=+r||0,this._$pointerX===i&&this._$pointerY===r?this:(t=+t||0,e=+e||0,this._$setBounds(t,e),this._$setBounds(i,r),this._$margePath(A(U.CURVE_TO,t,e,i,r)),this._$pointerX=i,this._$pointerY=r,this._$restart(),this)}drawCircle(t,e,i){return t=+t||0,e=+e||0,i=+i||0,i=d.round(i),this._$setBounds(t-i,e-i),this._$setBounds(t+i,e+i),this._$margePath(A(U.MOVE_TO,t+i,e,U.ARC,t,e,i)),this._$pointerX=t,this._$pointerY=e,this._$restart(),this}drawEllipse(t,e,i,r){t=+t||0,e=+e||0,i=+i||0,r=+r||0,i=d.round(i),r=d.round(r);const n=i/2,a=r/2,o=t+n,c=e+a,u=t+i,l=e+r,h=4/3*(d.SQRT2-1),$=h*n,_=h*a;return this.moveTo(o,e).cubicCurveTo(o+$,e,u,c-_,u,c).cubicCurveTo(u,c+_,o+$,l,o,l).cubicCurveTo(o-$,l,t,c+_,t,c).cubicCurveTo(t,c-_,o-$,e,o,e)}drawRect(t,e,i,r){t=+t||0,e=+e||0,i=+i||0,r=+r||0;const n=d.round(t+i),a=d.round(e+r);return this.moveTo(t,e).lineTo(t,a).lineTo(n,a).lineTo(n,e).lineTo(t,e)}drawRoundRect(t,e,i,r,n,a=NaN){t=+t||0,e=+e||0,i=+i||0,r=+r||0,n=+n||0,a=+a||n,i=d.round(i),r=d.round(r),n=d.round(n),a=d.round(a);const o=n/2,c=a/2,u=4/3*(d.SQRT2-1),l=u*o,h=u*c,$=t+o,_=t+i,g=_-o,f=e+c,m=e+r,p=m-c;return this.moveTo($,e).lineTo(g,e).cubicCurveTo(g+l,e,_,f-h,_,f).lineTo(_,p).cubicCurveTo(_,p+h,g+l,m,g,m).lineTo($,m).cubicCurveTo($-l,m,t,p+h,t,p).lineTo(t,f).cubicCurveTo(t,f-h,$-l,e,$,e)}endFill(){if(this._$doFill&&this._$fills&&this._$fills.length>7)switch(this._$recode||(this._$recode=A()),(this._$fills[2]!==this._$fills[this._$fills.length-2]||this._$fills[3]!==this._$fills[this._$fills.length-1])&&this._$fills.push(U.LINE_TO,this._$fills[2],this._$fills[3]),this._$recode.push(...this._$fills),this._$fillType){case U.FILL_STYLE:this._$recode.push(this._$fillType,this._$fillStyleR,this._$fillStyleG,this._$fillStyleB,this._$fillStyleA,U.END_FILL);break;case U.GRADIENT_FILL:this._$fillGradient&&this._$recode.push(this._$fillType,...this._$fillGradient.toArray());break;case U.BITMAP_FILL:this._$fillBitmap&&this._$recode.push(this._$fillType,...this._$fillBitmap.toArray());break}return this._$fills&&(V(this._$fills),this._$fills=null),this._$fillType=0,this._$fillGradient=null,this._$fillBitmap=null,this._$fillStyleR=0,this._$fillStyleG=0,this._$fillStyleB=0,this._$fillStyleA=0,this._$doFill=!1,this._$restart(),this}endLine(){if(this._$doLine&&this._$lines)switch(this._$recode||(this._$recode=A()),this._$recode.push(...this._$lines),V(this._$lines),this._$lines=null,this._$lineType){case U.STROKE_STYLE:this._$recode.push(this._$lineType,this._$lineWidth,this._$caps,this._$joints,this._$miterLimit,this._$lineStyleR,this._$lineStyleG,this._$lineStyleB,this._$lineStyleA,U.END_STROKE);break;case U.GRADIENT_STROKE:this._$lineGradient&&this._$recode.push(this._$lineType,this._$lineWidth,this._$caps,this._$joints,this._$miterLimit,...this._$lineGradient.toArray());break;case U.BITMAP_STROKE:this._$fillBitmap&&this._$recode.push(this._$lineType,this._$lineWidth,this._$caps,this._$joints,this._$miterLimit,...this._$fillBitmap.toArray());break}return this._$lineType=0,this._$lineWidth=0,this._$lineGradient=null,this._$lineStyleR=0,this._$lineStyleG=0,this._$lineStyleB=0,this._$lineStyleA=0,this._$caps="none",this._$joints="round",this._$miterLimit=0,this._$doLine=!1,this._$restart(),this}lineBitmapStyle(t,e=null,i=!0,r=!1){return this._$doLine&&this.endLine(),this._$lines||(this._$lines=A()),this._$maxAlpha=1,this._$doLine=!0,this._$canDraw=!0,this._$lines.push(U.BEGIN_PATH),this._$lineType=U.BITMAP_STROKE,this._$fillBitmap=new In(t,e,i,r),this}lineGradientStyle(t,e,i,r,n=null,a="pad",o="rgb",c=0){if(!this._$doLine)return this;this._$lines||(this._$lines=A());for(let u=0;u<i.length;++u)this._$maxAlpha=d.max(this._$maxAlpha,i[u]);return this._$lines.push(U.BEGIN_PATH),this._$lineType=U.GRADIENT_STROKE,this._$lineGradient=new An(t,e,i,r,n,a,o,c),this}lineStyle(t=1,e=0,i=1,r="round",n="round",a=3){this._$doLine&&this.endLine(),this._$lines||(this._$lines=A()),e=O(It(e),0,16777215,0),i=O(+i,0,1,1),this._$maxAlpha=d.max(this._$maxAlpha,i),this._$doLine=!0,this._$canDraw=!0,this._$pointerX||this._$pointerY?this._$lines.push(U.BEGIN_PATH,U.MOVE_TO,this._$pointerX,this._$pointerY):this._$lines.push(U.BEGIN_PATH);const o=ve(e,i);return this._$lineType=U.STROKE_STYLE,this._$lineStyleR=o.R,this._$lineStyleG=o.G,this._$lineStyleB=o.B,this._$lineStyleA=o.A,this._$lineWidth=t,this._$caps=`${r}`,this._$joints=`${n}`,this._$joints==="miter"&&(this._$miterLimit=a),this}lineTo(t,e){return t=+t||0,e=+e||0,this._$pointerX===t&&this._$pointerY===e?this:(this._$setBounds(t,e),this._$margePath(A(U.LINE_TO,t,e)),this._$pointerX=t,this._$pointerY=e,this._$restart(),this)}moveTo(t,e){t=+t||0,e=+e||0,this._$pointerX=t,this._$pointerY=e,this._$setBounds(t,e);let i=!1;return this._$doFill&&this._$fills&&this._$fills[this._$fills.length-3]===U.MOVE_TO&&(i=!0,this._$fills[this._$fills.length-2]=t,this._$fills[this._$fills.length-1]=e),this._$doLine&&this._$lines&&this._$lines[this._$lines.length-3]===U.MOVE_TO&&(i=!0,this._$lines[this._$lines.length-2]=t,this._$lines[this._$lines.length-1]=e),i||this._$margePath(A(U.MOVE_TO,t,e)),this._$restart(),this}_$clip(t,e){const i=this._$getBounds(),r=wt(i,e);W(i);const n=d.ceil(d.abs(r.xMax-r.xMin)),a=d.ceil(d.abs(r.yMax-r.yMin));switch(W(r),!0){case n===0:case a===0:case n===-bt:case a===-bt:case n===bt:case a===bt:return}t.reset(),t.setTransform(e[0],e[1],e[2],e[3],e[4],e[5]),this._$doDraw(t,null,!0),t.clip()}_$draw(t,e,i,r="normal",n=null){if(!this._$maxAlpha)return;const a=O(i[3]+i[7]/255,0,1),o=this._$displayObject;let c=o._$scale9Grid!==null;const u=o._$transform._$rawMatrix();c&&(c=c&&d.abs(u[1])<.001&&d.abs(u[2])<1e-4);const l=this._$getBounds(),h=wt(l,e),$=h.xMax,_=h.xMin,g=h.yMax,f=h.yMin;W(h);const m=d.ceil(d.abs($-_)),p=d.ceil(d.abs(g-f));switch(!0){case m===0:case p===0:case m===-bt:case p===-bt:case m===bt:case p===bt:return}let x=+d.sqrt(e[0]*e[0]+e[1]*e[1]);if(!ft.isInteger(x)){const w=x.toString(),I=w.indexOf("e");I!==-1&&(x=+w.slice(0,I)),x=+x.toFixed(4)}let b=+d.sqrt(e[2]*e[2]+e[3]*e[3]);if(!ft.isInteger(b)){const w=b.toString(),I=w.indexOf("e");I!==-1&&(b=+w.slice(0,I)),b=+b.toFixed(4)}const T=n!==null&&n.length>0&&o._$canApply(n);let y=et(0,m,0,p);if(T&&n)for(let w=0;w<n.length;++w)y=n[w]._$generateFilterRect(y,x,b);const v=t.frameBuffer,L=v.currentAttachment;if(!L||_-y.xMin>L.width||f-y.yMin>L.height){W(y);return}if(0>_+y.xMax||0>f+y.yMax){W(y);return}W(y),this._$uniqueKey===""&&(!c&&o._$loaderInfo&&o._$characterId?this._$uniqueKey=`${o._$loaderInfo._$id}@${this._$bitmapId||o._$characterId}`:this._$uniqueKey=this._$createCacheKey());const B=nt();if(this._$mode==="bitmap")this._$cacheKeys.length||(this._$cacheKeys=J.generateKeys(this._$uniqueKey));else if(!this._$cacheKeys.length||this._$cacheParams[0]!==x||this._$cacheParams[1]!==b||this._$cacheParams[2]!==i[7]){const w=A();w[0]=x,w[1]=b,this._$cacheKeys=J.generateKeys(this._$uniqueKey,w,i),V(w),this._$cacheParams[0]=x,this._$cacheParams[1]=b,this._$cacheParams[2]=i[7]}if(t.cachePosition=J.get(this._$cacheKeys),!t.cachePosition){const w=v.currentAttachment;w&&w.mask&&t.stopStencil();let I=0,D=0;if(this._$mode==="shape"){I=d.ceil(d.abs(l.xMax-l.xMin)*x),D=d.ceil(d.abs(l.yMax-l.yMin)*b);const N=t._$getTextureScale(I,D);N<1&&(I*=N,D*=N)}else I=d.ceil(d.abs(l.xMax-l.xMin)),D=d.ceil(d.abs(l.yMax-l.yMin));if(t.cachePosition=v.createCachePosition(I,D),t.bindRenderBuffer(t.cachePosition),t.reset(),this._$mode==="shape"?t.setTransform(x,0,0,b,-l.xMin*x,-l.yMin*b):t.setTransform(1,0,0,1,-l.xMin,-l.yMin),c){const N=B.scaleX,Y=Pt(N,0,0,N,0,0),q=ct(Y,u);tt(Y);const ot=o._$parent._$transform.concatenatedMatrix._$matrix,G=Pt(ot[0],ot[1],ot[2],ot[3],ot[4]*N-_,ot[5]*N-f);tt(ot);const Vt=ct(G,q),Ce=Vt[4]-(e[4]-_),Ee=Vt[5]-(e[5]-f);tt(Vt);const ce=wt(l,q),Bt=+ce.xMax,Ge=+ce.xMin,qs=+ce.yMax,Ki=+ce.yMin,Ba=d.ceil(d.abs(Bt-Ge)),Wr=d.ceil(d.abs(qs-Ki));W(ce);const Zs=o._$scale9Grid,Vr={x:Zs.x,y:Zs.y,w:Zs.width,h:Zs.height};t.grid.enable(Ge,Ki,Ba,Wr,l,Vr,N,q[0],q[1],q[2],q[3],q[4],q[5],G[0],G[1],G[2],G[3],G[4]-Ce,G[5]-Ee),tt(q),tt(G)}this._$doDraw(t,i,!1),c&&t.grid.disable(),v.transferTexture(t.cachePosition),J.set(this._$cacheKeys,t.cachePosition),t._$bind(w)}let F=0,R=0;if(T){const w=this._$createBitmapTexture(t,t.cachePosition,x,b,m,p),I=o._$drawFilter(t,e,n,m,p,w);I.offsetX&&(F=I.offsetX),I.offsetY&&(R=I.offsetY),t.cachePosition=I}if(!T&&this._$mode==="bitmap")t.setTransform(e[0],e[1],e[2],e[3],l.xMin*e[0]+l.yMin*e[2]+e[4],l.xMin*e[1]+l.yMin*e[3]+e[5]);else{const w=d.atan2(e[1],e[0]),I=d.atan2(-e[2],e[3]);if(!T&&(w||I)){const D=l.xMin*x,N=l.yMin*b,Y=d.cos(w),q=d.sin(w),ot=d.cos(I),G=d.sin(I);t.setTransform(Y,q,-G,ot,D*Y-N*G+e[4],D*q+N*ot+e[5])}else t.setTransform(1,0,0,1,_-F,f-R)}t.cachePosition&&(t.globalAlpha=a,t.imageSmoothingEnabled=this._$mode==="shape",t.globalCompositeOperation=r,t.drawInstance(_-F,f-R,$,g,i),t.cachePosition=null),W(l)}_$createBitmapTexture(t,e,i,r,n,a){if(this._$mode!=="bitmap")return null;t.drawInstacedArray();const o=t.frameBuffer,c=o.currentAttachment,u=o.createCacheAttachment(n,a);t._$bind(u),t.reset();const l=Pt(i,0,0,r,n/2,a/2),h=t.getTextureFromRect(e),$=Pt(1,0,0,1,-h.width/2,-h.height/2),_=ct(l,$);tt(l),tt($),t.setTransform(_[0],_[1],_[2],_[3],_[4],_[5]),t.drawImage(h,0,0,h.width,h.height);const g=o.getTextureFromCurrentAttachment();return t._$bind(c),o.releaseAttachment(u),o.textureManager.release(h),g}_$doDraw(t,e=null,i=!1){t.reset(),t.beginPath(),this._$runCommand(t,e,i)}_$hit(t,e,i,r=!1){return t.beginPath(),t.setTransform(e[0],e[1],e[2],e[3],e[4],e[5]),this._$runCommand(t,null,r,i)}_$getBounds(){const t=this._$displayObject;return t&&t._$bounds?et(t._$bounds.xMin,t._$bounds.xMax,t._$bounds.yMin,t._$bounds.yMax):et(this._$xMin,this._$xMax,this._$yMin,this._$yMax)}_$restart(){this._$displayObject&&(this._$displayObject._$posted=!1,this._$displayObject._$isUpdated()||(this._$displayObject._$doChanged(),pt(),J.removeCache(this._$displayObject._$instanceId),this._$displayObject._$characterId&&J.removeCache(this._$displayObject._$characterId)))}_$setBounds(t=0,e=0){this._$setFillBounds(t,e),this._$doLine&&this._$setLineBounds(t,e)}_$setFillBounds(t=0,e=0){this._$xMin=d.min(this._$xMin,t),this._$xMax=d.max(this._$xMax,t),this._$yMin=d.min(this._$yMin,e),this._$yMax=d.max(this._$yMax,e)}_$setLineBounds(t=0,e=0){this._$xMin=d.min(this._$xMin,d.min(t,this._$pointerX)),this._$xMax=d.max(this._$xMax,d.max(t,this._$pointerX)),this._$yMin=d.min(this._$yMin,d.min(e,this._$pointerY)),this._$yMax=d.max(this._$yMax,d.max(e,this._$pointerY));const i=this._$lineWidth/2,r=.5*d.PI,n=d.atan2(e-this._$pointerY,t-this._$pointerX),a=d.atan2(this._$pointerY-e,this._$pointerX-t),o=n+r,c=n-r,u=a+r,l=a-r;let h=t+i,$=-i+t,_=this._$pointerX+i,g=-i+this._$pointerX,f=e+i,m=-i+e,p=this._$pointerY+i,x=-i+this._$pointerY;switch(this._$xMin=d.min(this._$xMin,d.min(h,d.min($,d.min(_,g)))),this._$xMax=d.max(this._$xMax,d.max(h,d.max($,d.max(_,g)))),this._$yMin=d.min(this._$yMin,d.min(f,d.min(m,d.min(p,x)))),this._$yMax=d.max(this._$yMax,d.max(f,d.max(m,d.max(p,x)))),d.abs(o)%r!==0&&(h=t+d.cos(o)*i),d.abs(c)%r!==0&&($=t+d.cos(c)*i),d.abs(u)%r!==0&&(_=this._$pointerX+d.cos(u)*i),d.abs(l)%r!==0&&(g=this._$pointerX+d.cos(l)*i),o&&d.abs(o)%d.PI!==0&&(f=e+d.sin(o)*i),c&&d.abs(c)%d.PI!==0&&(m=e+d.sin(c)*i),u&&d.abs(u)%d.PI!==0&&(p=this._$pointerY+d.sin(u)*i),l&&d.abs(l)%d.PI!==0&&(x=this._$pointerY+d.sin(l)*i),this._$xMin=d.min(this._$xMin,d.min(h,d.min($,d.min(_,g)))),this._$xMax=d.max(this._$xMax,d.max(h,d.max($,d.max(_,g)))),this._$yMin=d.min(this._$yMin,d.min(f,d.min(m,d.min(p,x)))),this._$yMax=d.max(this._$yMax,d.max(f,d.max(m,d.max(p,x)))),this._$caps){case"round":if(d.abs(n)%r!==0){const b=t+d.cos(n)*i;this._$xMin=d.min(this._$xMin,b),this._$xMax=d.max(this._$xMax,b)}if(n&&d.abs(n)%d.PI!==0){const b=e+d.sin(n)*i;this._$yMin=d.min(this._$yMin,b),this._$yMax=d.max(this._$yMax,b)}if(d.abs(a)%r!==0){const b=this._$pointerX+d.cos(a)*i;this._$xMin=d.min(this._$xMin,b),this._$xMax=d.max(this._$xMax,b)}if(a&&d.abs(a)%d.PI!==0){const b=this._$pointerY+d.sin(a)*i;this._$yMin=d.min(this._$yMin,b),this._$yMax=d.max(this._$yMax,b)}break;case"square":if(d.abs(n)%r!==0){const b=d.cos(n)*i,T=h+b,y=$+b;this._$xMin=d.min(this._$xMin,d.min(T,y)),this._$xMax=d.max(this._$xMax,d.max(T,y))}if(d.abs(a)%r!==0){const b=d.cos(a)*i,T=_+b,y=g+b;this._$xMin=d.min(this._$xMin,d.min(T,y)),this._$xMax=d.max(this._$xMax,d.max(T,y))}if(n&&d.abs(n)%d.PI!==0){const b=d.sin(n)*i,T=f+b,y=m+b;this._$yMin=d.min(this._$yMin,d.min(T,y)),this._$yMax=d.max(this._$yMax,d.max(T,y))}if(a&&d.abs(a)%d.PI!==0){const b=d.sin(a)*i,T=p+b,y=x+b;this._$yMin=d.min(this._$yMin,d.min(T,y)),this._$yMax=d.max(this._$yMax,d.max(T,y))}break}}_$margePath(t){this._$doFill&&this._$fills&&this._$fills.push(...t),this._$doLine&&this._$lines&&this._$lines.push(...t),V(t)}_$createCacheKey(){if(this._$doLine&&this.endLine(),this._$doFill&&this.endFill(),!this._$recode)return"";const t=this._$getRecodes();let e=0;for(let i=0;i<t.length;i++){const r=t[i];e=(e<<5)-e+r,e|=0}return`${e}`}_$getRecodes(){if(this._$doLine&&this.endLine(),this._$doFill&&this.endFill(),this._$recode||(this._$recode=A()),!this._$buffer){const t=A(),e=this._$recode;for(let i=0;i<e.length;){const r=e[i++];switch(t.push(r),r){case U.BEGIN_PATH:case U.END_FILL:case U.END_STROKE:case U.CLOSE_PATH:break;case U.MOVE_TO:case U.LINE_TO:t.push(e[i++],e[i++]);break;case U.CURVE_TO:case U.FILL_STYLE:t.push(e[i++],e[i++],e[i++],e[i++]);break;case U.CUBIC:t.push(e[i++],e[i++],e[i++],e[i++],e[i++],e[i++]);break;case U.STROKE_STYLE:{switch(t.push(e[i++]),e[i++]){case"none":t.push(0);break;case"round":t.push(1);break;case"square":t.push(2);break}switch(e[i++]){case"bevel":t.push(0);break;case"miter":t.push(1);break;case"round":t.push(2);break}t.push(e[i++],e[i++],e[i++],e[i++],e[i++])}break;case U.ARC:t.push(e[i++],e[i++],e[i++]);break;case U.GRADIENT_FILL:{const n=e[i++],a=e[i++],o=e[i++],c=e[i++],u=e[i++],l=e[i++];t.push(n==="linear"?0:1),t.push(a.length);for(let h=0;h<a.length;++h){const $=a[h];t.push($.ratio,$.R,$.G,$.B,$.A)}switch(t.push(o[0],o[1],o[2],o[3],o[4],o[5]),c){case"reflect":t.push(0);break;case"repeat":t.push(1);break;default:t.push(2);break}t.push(u==="linearRGB"?0:1),t.push(l)}break;case U.GRADIENT_STROKE:{switch(t.push(e[i++]),e[i++]){case"none":t.push(0);break;case"round":t.push(1);break;case"square":t.push(2);break}switch(e[i++]){case"bevel":t.push(0);break;case"miter":t.push(1);break;case"round":t.push(2);break}t.push(e[i++]);const o=e[i++],c=e[i++],u=e[i++],l=e[i++],h=e[i++],$=e[i++];t.push(o==="linear"?0:1),t.push(c.length);for(let _=0;_<c.length;++_){const g=c[_];t.push(g.ratio,g.R,g.G,g.B,g.A)}switch(t.push(u[0],u[1],u[2],u[3],u[4],u[5]),l){case"reflect":t.push(0);break;case"repeat":t.push(1);break;default:t.push(2);break}t.push(h==="linearRGB"?0:1),t.push($)}break;case U.BITMAP_FILL:{const n=e[i++];let a;if(n.image!==null||n.canvas!==null){const l=J.getCanvas(),h=n.width,$=n.height;l.width=h,l.height=$;const _=l.getContext("2d");if(!_)throw new Error("the context is null.");_.drawImage(n.image||n.canvas,0,0),a=new Uint8Array(_.getImageData(0,0,h,$).data),J.destroy(_)}else if(n._$buffer!==null)a=n._$buffer;else break;t.push(n.width,n.height,this._$xMax-this._$xMin,this._$yMax-this._$yMin,a.length);for(let l=0;l<a.length;++l)t.push(a[l]);const o=e[i++];o?t.push(o[0],o[1],o[2],o[3],o[4],o[5]):t.push(1,0,0,1,0,0);const c=e[i++];t.push(c?1:0);const u=e[i++];t.push(u?1:0)}break;case U.BITMAP_STROKE:{switch(t.push(e[i++]),e[i++]){case"none":t.push(0);break;case"round":t.push(1);break;case"square":t.push(2);break}switch(e[i++]){case"bevel":t.push(0);break;case"miter":t.push(1);break;case"round":t.push(2);break}t.push(e[i++]);const o=e[i++];let c;if(o.image!==null||o.canvas!==null){const $=J.getCanvas(),_=o.width,g=o.height;$.width=_,$.height=g;const f=$.getContext("2d");if(!f)throw new Error("the context is null.");f.drawImage(o.image||o.canvas,0,0),c=new Uint8Array(f.getImageData(0,0,_,g).data),J.destroy(f)}else if(o._$buffer!==null)c=o._$buffer;else break;t.push(o.width,o.height,this._$xMax-this._$xMin,this._$yMax-this._$yMin,c.length);for(let $=0;$<c.length;++$)t.push(c[$]);const u=e[i++];u?t.push(u[0],u[1],u[2],u[3],u[4],u[5]):t.push(1,0,0,1,0,0);const l=e[i++];t.push(l?1:0);const h=e[i++];t.push(h?1:0)}break}}this._$buffer=new ne(t)}return this._$buffer.slice()}_$runCommand(t,e=null,i=!1,r=null){if(this._$doLine&&this.endLine(),this._$doFill&&this.endFill(),!this._$recode)return!1;const n=this._$recode,a=n.length;for(let o=0;o<a;)switch(n[o++]){case U.BEGIN_PATH:t.beginPath();break;case U.MOVE_TO:t.moveTo(n[o++],n[o++]);break;case U.LINE_TO:t.lineTo(n[o++],n[o++]);break;case U.CURVE_TO:t.quadraticCurveTo(n[o++],n[o++],n[o++],n[o++]);break;case U.FILL_STYLE:{if(i||r){o+=4;continue}const c=He();c[0]=n[o++]/255,c[1]=n[o++]/255,c[2]=n[o++]/255,c[3]=n[o++]/255,e!==null&&e[7]!==0&&(c[3]=d.max(0,d.min(c[3]*e[7],255))/255),t.fillStyle=c}break;case U.END_FILL:if(r&&"isPointInPath"in t&&t.isPointInPath(r.x,r.y))return!0;!i&&!r&&t.fill();break;case U.STROKE_STYLE:{if(i||r){o+=8;continue}t.lineWidth=n[o++],t.lineCap=n[o++],t.lineJoin=n[o++],t.miterLimit=n[o++];const c=He();c[0]=n[o++]/255,c[1]=n[o++]/255,c[2]=n[o++]/255,c[3]=n[o++]/255,e!==null&&e[7]!==0&&(c[3]=d.max(0,d.min(c[3]+e[7],255))/255),t.strokeStyle=c}break;case U.END_STROKE:if(r&&"isPointInStroke"in t&&t.isPointInStroke(r.x,r.y))return!0;!i&&!r&&t.stroke();break;case U.CLOSE_PATH:t.closePath();break;case U.CUBIC:t.bezierCurveTo(n[o++],n[o++],n[o++],n[o++],n[o++],n[o++]);break;case U.ARC:t.arc(n[o++],n[o++],n[o++],0,2*d.PI);break;case U.GRADIENT_FILL:{if(r&&"isPointInPath"in t&&t.isPointInPath(r.x,r.y))return!0;if(i||r||t instanceof CanvasRenderingContext2D){o+=6;continue}const c=n[o++],u=n[o++],l=n[o++],h=n[o++],$=n[o++],_=n[o++];let g;if(c==="linear"){const f=kc(l);g=t.createLinearGradient(f[0],f[1],f[2],f[3],$,h)}else t.save(),t.transform(l[0],l[1],l[2],l[3],l[4],l[5]),g=t.createRadialGradient(0,0,0,0,0,819.2,$,h,_);for(let f=0;f<u.length;++f){const m=u[f];let p=m.A;e&&e[7]!==0&&(p=d.max(0,d.min(m.A+e[7],255))|0),g.addColorStop(m.ratio,Pc(m.R,m.G,m.B,p))}t.fillStyle=g,t.fill(),c==="radial"&&t.restore()}break;case U.GRADIENT_STROKE:{if(r&&"isPointInStroke"in t&&t.isPointInStroke(r.x,r.y))return!0;if(i||r||t instanceof CanvasRenderingContext2D){o+=12;continue}t.lineWidth=n[o++],t.lineCap=n[o++],t.lineJoin=n[o++],t.miterLimit=n[o++];const c=n[o++],u=n[o++],l=n[o++],h=n[o++],$=n[o++],_=n[o++];let g;if(c==="linear"){const f=kc(l);g=t.createLinearGradient(f[0],f[1],f[2],f[3],$,h)}else t.save(),t.transform(l[0],l[1],l[2],l[3],l[4],l[5]),g=t.createRadialGradient(0,0,0,0,0,819.2,$,h,_);for(let f=0;f<u.length;++f){const m=u[f];let p=m.A;e&&e[7]!==0&&(p=d.max(0,d.min(m.A+e[7],255))|0),g.addColorStop(m.ratio,Pc(m.R,m.G,m.B,p))}t.strokeStyle=g,t.stroke(),c==="radial"&&t.restore()}break;case U.BITMAP_FILL:{if(r&&"isPointInPath"in t&&t.isPointInPath(r.x,r.y))return!0;if(i||r||t instanceof CanvasRenderingContext2D){o+=6;continue}t.save();const c=n[o++],u=n[o++],l=n[o++],h=n[o++];u&&t.transform(u[0],u[1],u[2],u[3],u[4],u[5]);const $=c.getTexture();if(!$||!e)break;t.imageSmoothingEnabled=h,this._$bitmapId||c.width===this._$xMax-this._$xMin&&c.height===this._$yMax-this._$yMin?t.drawBitmap($):(t.fillStyle=t.createPattern($,l,e),t.fill()),t.restore(),t.imageSmoothingEnabled=!1}break;case U.BITMAP_STROKE:{if(r&&"isPointInStroke"in t&&t.isPointInStroke(r.x,r.y))return!0;if(i||r||t instanceof CanvasRenderingContext2D){o+=9;continue}t.save(),t.lineWidth=n[o++],t.lineCap=n[o++],t.lineJoin=n[o++],t.miterLimit=n[o++];const c=n[o++],u=n[o++],l=n[o++],h=n[o++];u&&t.transform(u[0],u[1],u[2],u[3],u[4],u[5]);const $=c.getTexture();if(!$||!e)break;t.strokeStyle=t.createPattern($,l,e),t.imageSmoothingEnabled=h,t.stroke(),t.restore(),t.imageSmoothingEnabled=!1}break}return!1}}class bl extends Ei{constructor(){super(),this._$id=N_(),this._$bytesLoaded=0,this._$bytesTotal=0,this._$url="",this._$content=null,this._$data=null,this._$format="json"}static toString(){return"[class LoaderInfo]"}static get namespace(){return"next2d.display.LoaderInfo"}toString(){return"[object LoaderInfo]"}get namespace(){return"next2d.display.LoaderInfo"}get bytesLoaded(){return this._$bytesLoaded}set bytesLoaded(t){this._$bytesLoaded=t|0}get bytesTotal(){return this._$bytesTotal}set bytesTotal(t){this._$bytesTotal=t|0}get content(){return this._$content}set content(t){this._$content=t}get url(){return this._$url}set url(t){this._$url=t}get format(){return this._$format}set format(t){this._$format=t}}class ls{static toString(){return"[class SoundMixer]"}static get namespace(){return"next2d.media.SoundMixer"}toString(){return"[object SoundMixer]"}get namespace(){return"next2d.media.SoundMixer"}static get volume(){return Rc()}static set volume(t){D_(O(t,0,1,1));const e=Rc(),i=nt(),r=i._$sources;for(let a=0;a<r.length;++a){const o=r[a];for(let c=0;c<o._$sources.length;++c){const u=o._$sources[c];u._$gainNode&&(u._$gainNode.gain.value=d.min(e,u._$volume))}}const n=i._$videos;for(let a=0;a<n.length;++a){const o=n[a];o._$video&&(o._$video.volume=d.min(e,o.volume))}}static stopAll(){const t=nt(),e=t._$sources;for(let r=0;r<e.length;++r)e[r].stop();const i=t._$videos;for(let r=0;r<i.length;++r)i[r].pause();t._$sources.length=0,t._$videos.length=0}}let xl=class yl extends Ei{constructor(){super(),this._$bytesLoaded=0,this._$bytesTotal=0,this._$arrayBuffer=null,this._$audioBuffer=null,this._$character=null,this._$sources=A(),this._$volume=1,this._$currentCount=0,this._$loopCount=0,this._$stopFlag=!0,this._$src=""}static toString(){return"[class Sound]"}static get namespace(){return"next2d.media.Sound"}toString(){return"[object Sound]"}get namespace(){return"next2d.media.Sound"}get bytesLoaded(){return this._$bytesLoaded}get bytesTotal(){return this._$bytesTotal}get loopCount(){return this._$loopCount}set loopCount(t){this._$loopCount=t}get src(){return this._$src}set src(t){this.load(new Lo(t))}get volume(){return this._$volume}set volume(t){this._$volume=d.min(ls.volume,O(t,0,1,1));const e=this._$sources.length;if(e&&vt)for(let i=0;i<e;++i){const r=this._$sources[i];r._$gainNode&&(r._$gainNode.gain.value=this._$volume,r._$volume=this._$volume)}}clone(){const t=new yl;return t.volume=this.volume,t._$loopCount=this._$loopCount,this._$character?t._$character=this._$character:t._$audioBuffer=this._$audioBuffer,t}load(t){this._$src=t.url,Vl({format:"arraybuffer",url:t.url,method:t.method,data:t.data,headers:t.headers,withCredentials:t.withCredentials,event:{loadstart:e=>{this._$loadStart(e)},progress:e=>{this._$progress(e)},loadend:e=>{this._$loadEnd(e)}}})}_$loadStart(t){this._$bytesLoaded=t.loaded,this._$bytesTotal=t.total,this.willTrigger(S.OPEN)&&this.dispatchEvent(new S(S.OPEN)),this.willTrigger(Lt.PROGRESS)&&this.dispatchEvent(new Lt(Lt.PROGRESS,!1,!1,t.loaded,t.total))}_$progress(t){this._$bytesLoaded=t.loaded,this._$bytesTotal=t.total,this.willTrigger(Lt.PROGRESS)&&this.dispatchEvent(new Lt(Lt.PROGRESS,!1,!1,t.loaded,t.total))}_$loadEnd(t){this._$bytesLoaded=t.loaded,this._$bytesTotal=t.total,this.willTrigger(Lt.PROGRESS)&&this.dispatchEvent(new Lt(Lt.PROGRESS,!1,!1,t.loaded,t.total));const e=t.target;if(!e)throw new Error("the Sound target is null.");199<e.status&&400>e.status?(this._$arrayBuffer=e.response,vt?po(this).then(i=>{(i.hasEventListener(S.INIT)||i.hasEventListener(S.COMPLETE))&&nt()._$loaders.push(i)}):cr.push(this)):this.willTrigger(fe.IO_ERROR)&&this.dispatchEvent(new fe(fe.IO_ERROR,!1,!1,e.statusText))}play(t=0){const e=this._$character?this._$character.audioBuffer:this._$audioBuffer;if(!vt||!e){const i=$r.now(),r=()=>{if((this._$character?this._$character.audioBuffer:this._$audioBuffer)!==null&&vt!==null){const a=($r.now()-i)/1e3;this._$createBufferSource(t,a);return}Ze(r)};Ze(r)}else this._$createBufferSource(t)}stop(){this._$stopFlag=!0;const t=this._$sources.length;if(t){const e=nt();if(vt)for(let i=0;i<t;++i){const r=this._$sources[i];r._$gainNode&&(r._$gainNode.gain.value=0,r._$gainNode.disconnect(),r._$gainNode=null),r.onended=null,r.disconnect()}e._$sources.splice(e._$sources.indexOf(this),1),this._$currentCount=0,this._$sources.length=0}}_$build(t,e){const i=e.loaderInfo;if(!i||!i._$data)throw new Error("the loaderInfo or data is null.");if(this._$character=i._$data.characters[t.characterId],!this._$character)throw new Error("character is null.");this._$character.audioBuffer||(vt?po(this).then(r=>{(r.hasEventListener(S.INIT)||r.hasEventListener(S.COMPLETE))&&nt()._$loaders.push(r)}):cr.push(this)),this._$loopCount=t.loopCount|0,this._$volume=d.min(ls.volume,t.volume)}_$createBufferSource(t=0,e=0){if(!vt)throw new Error("the Audio Context is null.");const i=vt.createBufferSource();i.onended=a=>this._$endEventHandler(a),i.buffer=this._$character?this._$character.audioBuffer:this._$audioBuffer,i._$gainNode=vt.createGain(),i._$gainNode.connect(vt.destination);const r=d.min(ls.volume,this._$volume);i._$gainNode.gain.value=r,i._$volume=r,i.connect(i._$gainNode),i.start(t|0,e);const n=nt();n._$sources.indexOf(this)===-1&&n._$sources.push(this),this._$sources.push(i),this._$stopFlag=!1}_$endEventHandler(t){const e=t.target;if(this._$sources.splice(this._$sources.indexOf(e),1),!this._$stopFlag&&this._$loopCount>this._$currentCount)this._$createBufferSource(),this._$currentCount++;else{if(this._$currentCount=0,vt&&(e._$gainNode&&(e._$gainNode.gain.value=0,e._$gainNode.disconnect(),e._$gainNode=null),e.onended=null,e.disconnect()),!this._$sources.length){const i=nt();i._$sources.splice(i._$sources.indexOf(this),1)}this.willTrigger(S.SOUND_COMPLETE)&&this.dispatchEvent(new S(S.SOUND_COMPLETE))}}};class El{constructor(t=1,e=!1){this._$volume=1,this._$loop=!1,this.volume=t,this.loop=e}static toString(){return"[class SoundTransform]"}static get namespace(){return"next2d.media.SoundTransform"}toString(){return"[object SoundTransform]"}get namespace(){return"next2d.media.SoundTransform"}get loop(){return this._$loop}set loop(t){this._$loop=t}get volume(){return this._$volume}set volume(t){this._$volume=O(+t,0,1,0)}}let Qa=class extends sa{constructor(t=0,e=0){super(),this._$smoothing=!0,this._$loop=!1,this._$autoPlay=!0,this._$bounds=et(0,t,0,e),this._$bytesLoaded=0,this._$bytesTotal=0,this._$timerId=-1,this._$video=null,this._$stop=!0,this._$ready=!1,this._$volume=1,this._$context=null,this._$cacheKeys=A(),this._$cacheParams=A(0,0,0)}static toString(){return"[class Video]"}static get namespace(){return"next2d.media.Video"}toString(){return"[object Video]"}get namespace(){return"next2d.media.Video"}get bytesLoaded(){return this._$bytesLoaded}get bytesTotal(){return this._$bytesTotal}get currentTime(){return this._$video?this._$video.currentTime:0}get duration(){return this._$video?this._$video.duration:0}get loop(){return this._$loop}set loop(t){this._$loop=!!t}get autoPlay(){return this._$autoPlay}set autoPlay(t){this._$autoPlay=!!t}get smoothing(){return this._$smoothing}set smoothing(t){this._$smoothing=!!t}get src(){return this._$video?this._$video.src:""}set src(t){this._$video||(this._$video=this._$initializeVideo()),this._$video.src=t,this._$video.load()}get videoHeight(){return this._$video?this._$video.videoHeight:this._$bounds.yMax}get videoWidth(){return this._$video?this._$video.videoWidth:this._$bounds.xMax}get volume(){return this._$volume}set volume(t){this._$volume=O(d.min(ls.volume,t),0,1,1),this._$video&&(this._$video.volume=this._$volume)}clear(){this._$video&&this._$video.pause(),this._$video=null,this._$bounds.xMax=0,this._$bounds.yMax=0,this._$doChanged()}pause(){if(this._$video&&!this._$stop){this._$stop=!0,this._$video.pause(),us(this._$timerId),this._$timerId=-1,this.hasEventListener(At.PAUSE)&&this.dispatchEvent(new At(At.PAUSE,!1,!1,this._$bytesLoaded,this._$bytesTotal));const t=nt();t._$videos.splice(t._$videos.indexOf(this),1)}}play(){this._$video&&this._$stop&&(this._$stop=!1,this._$video.volume=d.min(this._$volume,ls.volume),this._$video.play().then(()=>{this._$timerId=Ze(()=>{this._$update()}),this.hasEventListener(At.PLAY)&&this.dispatchEvent(new At(At.PLAY,!1,!1,this._$bytesLoaded,this._$bytesTotal));const t=nt();t._$videos.indexOf(this)===-1&&t._$videos.push(this),this._$ready=!0}))}seek(t){this._$video&&(this._$video.currentTime=t,this.hasEventListener(At.SEEK)&&this.dispatchEvent(new At(At.SEEK,!1,!1,this._$bytesLoaded,this._$bytesTotal)))}_$update(){const t=nt();if(!this.stage||!this._$video){this._$video&&this._$video.pause(),us(this._$timerId),this._$timerId=-1,t._$videos.splice(t._$videos.indexOf(this),1);return}X&&this._$postProperty(),this._$bytesLoaded=this._$video.currentTime,this._$video.currentTime&&(this.hasEventListener(At.PROGRESS)&&this.dispatchEvent(new At(At.PROGRESS,!1,!1,this._$bytesLoaded,this._$bytesTotal)),this._$doChanged()),this._$timerId=Ze(()=>{this._$update()})}_$start(){if(!this._$video)return;this._$bounds.xMax=this._$video.videoWidth,this._$bounds.yMax=this._$video.videoHeight,this._$bytesTotal=this._$video.duration;const t=nt();this._$autoPlay&&(this._$stop=!1,this._$video.play().then(()=>{t._$videos.indexOf(this)===-1&&t._$videos.push(this),this.hasEventListener(At.PLAY_START)&&this.dispatchEvent(new At(At.PLAY_START,!1,!1,this._$bytesLoaded,this._$bytesTotal)),this._$timerId=Ze(()=>{this._$update()}),this._$ready=!0,this._$doChanged()})),this._$createContext()}_$initializeVideo(){this._$cacheKeys.length=0;const t=Dt.createElement("video");return t.autoplay=!1,t.crossOrigin="anonymous",vt||(t.muted=!0),Ke&&t.setAttribute("playsinline",""),t.addEventListener("canplaythrough",()=>{this._$start()}),t.addEventListener("ended",()=>{if(this._$loop){t.currentTime=0;return}this.hasEventListener(At.PLAY_END)&&this.dispatchEvent(new At(At.PLAY_END,!1,!1,this._$bytesLoaded,this._$bytesTotal)),us(this._$timerId),this._$timerId=-1}),t}_$createContext(){if(X){const t=new il(this._$bounds.xMax,this._$bounds.yMax);this._$context=t.getContext("2d")}}_$buildCharacter(t){t.buffer&&!t._$buffer&&(t._$buffer=new Uint8Array(t.buffer),t.buffer=null),this._$loop=t.loop,this._$autoPlay=t.autoPlay,this._$bounds.xMin=t.bounds.xMin,this._$bounds.yMin=t.bounds.yMin,this._$bounds.xMax=t.bounds.xMax,this._$bounds.yMax=t.bounds.yMax,this._$video||(this._$video=this._$initializeVideo()),this._$video.src=URL.createObjectURL(new Blob([t._$buffer],{type:"video/mp4"})),this._$video.volume=d.min(t.volume,ls.volume),this._$video.load(),X&&this._$stage&&this._$createWorkerInstance()}_$sync(t){this._$buildCharacter(t)}_$build(t,e){const i=this._$baseBuild(t,e);return this._$buildCharacter(i),i}_$clip(t,e){const i=this._$bounds.xMax,r=this._$bounds.yMax;if(!i||!r)return;let n=e;const a=this._$transform._$rawMatrix();(a[0]!==1||a[1]!==0||a[2]!==0||a[3]!==1||a[4]!==0||a[5]!==0)&&(n=ct(e,a)),t.reset(),t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]),t.beginPath(),t.moveTo(0,0),t.lineTo(i,0),t.lineTo(i,r),t.lineTo(0,r),t.lineTo(0,0),t.clip(),n!==e&&tt(n)}_$draw(t,e,i){if(!this._$visible||!this._$video||!this._$ready)return;let r=i;const n=this._$transform._$rawColorTransform();(n[0]!==1||n[1]!==1||n[2]!==1||n[3]!==1||n[4]!==0||n[5]!==0||n[6]!==0||n[7]!==0)&&(r=yi(i,n));const a=O(r[3]+r[7]/255,0,1,0);if(!a){r!==i&&$s(r);return}let o=e;const c=this._$transform._$rawMatrix();(c[0]!==1||c[1]!==0||c[2]!==0||c[3]!==1||c[4]!==0||c[5]!==0)&&(o=ct(e,c));const u=wt(this._$bounds,o),l=+u.xMax,h=+u.xMin,$=+u.yMax,_=+u.yMin;W(u);const g=d.ceil(d.abs(l-h)),f=d.ceil(d.abs($-_));switch(!0){case g===0:case f===0:case g===-bt:case f===-bt:case g===bt:case f===bt:return}let m=+d.sqrt(o[0]*o[0]+o[1]*o[1]);if(!ft.isInteger(m)){const w=m.toString(),I=w.indexOf("e");I!==-1&&(m=+w.slice(0,I)),m=+m.toFixed(4)}let p=+d.sqrt(o[2]*o[2]+o[3]*o[3]);if(!ft.isInteger(p)){const w=p.toString(),I=w.indexOf("e");I!==-1&&(p=+w.slice(0,I)),p=+p.toFixed(4)}const x=this._$filters||this.filters,b=x&&x.length>0&&this._$canApply(x);let T=et(0,g,0,f);if(b)for(let w=0;w<x.length;++w)T=x[w]._$generateFilterRect(T,m,p);const y=t.frameBuffer,v=y.currentAttachment;if(!v||h-T.xMin>v.width||_-T.yMin>v.height){W(T);return}if(0>h+T.xMax||0>_+T.yMax){W(T);return}if(W(T),!this._$cacheKeys.length||this._$cacheParams[0]!==m||this._$cacheParams[1]!==p||this._$cacheParams[2]!==i[7]){const w=A();w[0]=m,w[1]=p,this._$cacheKeys=J.generateKeys(this._$instanceId,w,i),V(w),this._$cacheParams[0]=m,this._$cacheParams[1]=p,this._$cacheParams[2]=i[7]}const L=this._$blendMode||this.blendMode;if(t.cachePosition=J.get(this._$cacheKeys),!t.cachePosition){const w=d.ceil(d.abs(this._$bounds.xMax-this._$bounds.xMin)),I=d.ceil(d.abs(this._$bounds.yMax-this._$bounds.yMin)),D=y.createCachePosition(w,I);t.cachePosition=D,J.set(this._$cacheKeys,D)}const B=y.createTextureFromVideo(this._$video,this._$smoothing);let F=0,R=0;if(b){const w=y.currentAttachment,I=y.createCacheAttachment(g,f);t._$bind(I),t.reset();const D=Pt(m,0,0,p,g/2,f/2),N=Pt(1,0,0,1,-B.width/2,-B.height/2),Y=ct(D,N);tt(D),tt(N),t.setTransform(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]),t.drawImage(B,0,0,B.width,B.height);const q=y.getTextureFromCurrentAttachment();t._$bind(w),y.releaseAttachment(I),t.drawTextureFromRect(B,t.cachePosition);const ot=this._$drawFilter(t,o,x,g,f,q);ot.offsetX&&(F=ot.offsetX),ot.offsetY&&(R=ot.offsetY),t.cachePosition=ot,t.setTransform(1,0,0,1,h-F,_-R)}else t.drawTextureFromRect(B,t.cachePosition),t.setTransform(o[0],o[1],o[2],o[3],o[4],o[5]);t.cachePosition&&(t.globalAlpha=a,t.imageSmoothingEnabled=!0,t.globalCompositeOperation=L,t.drawInstance(h-F,_-R,l,$,i),t.cachePosition=null),o!==e&&tt(o),r!==i&&$s(r)}_$mouseHit(t,e,i){return this._$visible?this._$hit(t,e,i):!1}_$hit(t,e,i){let r=e;const n=this._$transform._$rawMatrix();n!==Jt&&(r=ct(e,n));const a=this._$getBounds(null),o=wt(a,r),c=+o.xMax,u=+o.xMin,l=+o.yMax,h=+o.yMin;W(o),W(a);const $=d.ceil(d.abs(c-u)),_=d.ceil(d.abs(l-h));return t.setTransform(1,0,0,1,u,h),t.beginPath(),t.moveTo(0,0),t.lineTo($,0),t.lineTo($,_),t.lineTo(0,_),t.lineTo(0,0),r!==e&&tt(r),t.isPointInPath(i.x,i.y)}_$getBounds(t=null){if(t){let e=t;const i=this._$transform._$rawMatrix();(i[0]!==1||i[1]!==0||i[2]!==0||i[3]!==1||i[4]!==0||i[5]!==0)&&(e=ct(t,i));const r=wt(this._$bounds,e);return e!==t&&tt(e),r}return et(this._$bounds.xMin,this._$bounds.xMax,this._$bounds.yMin,this._$bounds.yMax)}_$createWorkerInstance(){if(!X||this._$created)return;this._$created=!0;const t={command:"createVideo",buffer:new Float32Array,instanceId:this._$instanceId,parentId:this._$parent?this._$parent._$instanceId:-1,smoothing:this._$smoothing,xMin:this._$bounds.xMin,yMin:this._$bounds.yMin,xMax:this._$bounds.xMax,yMax:this._$bounds.yMax};this._$characterId>-1&&(t.characterId=this._$characterId),this._$loaderInfo&&(t.loaderInfoId=this._$loaderInfo._$id),this._$scale9Grid&&(t.grid={x:this._$scale9Grid.x,y:this._$scale9Grid.y,w:this._$scale9Grid.width,h:this._$scale9Grid.height}),X.postMessage(t)}_$postProperty(){if(!X)return;const t=this._$createMessage();t.smoothing=this._$smoothing;const e=A(),i=this._$context;if(i&&this._$video){t.xMin=this._$bounds.xMin,t.yMin=this._$bounds.yMin,t.xMax=this._$bounds.xMax,t.yMax=this._$bounds.yMax,i.drawImage(this._$video,0,0);const r=i.canvas.transferToImageBitmap();t.imageBitmap=r,e.push(r)}X.postMessage(t,e),V(e),this._$posted=!0,this._$updated=!1}};class fr extends Yt{constructor(){super(),this._$buttonMode=!1,this._$hitArea=null,this._$soundTransform=null,this._$useHandCursor=!0}static toString(){return"[class Sprite]"}static get namespace(){return"next2d.display.Sprite"}toString(){return"[object Sprite]"}get namespace(){return"next2d.display.Sprite"}get buttonMode(){return this._$buttonMode}set buttonMode(t){this._$buttonMode=!!t}get dropTarget(){return ti}get hitArea(){return this._$hitArea}set hitArea(t){this._$hitArea&&(this._$hitArea._$hitObject=null),this._$hitArea=t,t&&(t._$hitObject=this)}get soundTransform(){return this._$soundTransform||(this._$soundTransform=new El),this._$soundTransform}set soundTransform(t){this._$soundTransform=t}get useHandCursor(){return this._$useHandCursor}set useHandCursor(t){this._$useHandCursor=t}startDrag(t=!1,e=null){let i=0,r=0;if(!t){const n=this._$dragMousePoint();i=this.x-n.x,r=this.y-n.y}zc(this),_e.lock=t,_e.position.x=i,_e.position.y=r,_e.bounds=e}stopDrag(){zc(null),_e.lock=!1,_e.position.x=0,_e.position.y=0,_e.bounds=null}_$sync(t){X&&this._$stage&&this._$createWorkerInstance(),this._$controller=t.controller,this._$dictionary=t.dictionary,this._$placeMap=t.placeMap,this._$placeObjects=t.placeObjects}_$build(t,e){const i=this._$baseBuild(t,e);return X&&this._$stage&&this._$createWorkerInstance(),this._$controller=i.controller,this._$dictionary=i.dictionary,this._$placeMap=i.placeMap,this._$placeObjects=i.placeObjects,i}_$dragMousePoint(){return this._$parent?this._$parent.globalToLocal(Rn()):this.globalToLocal(Rn())}}let Ln=class extends fr{constructor(){super(),this._$stopFlag=!1,this._$canAction=!0,this._$canSound=!0,this._$actionProcess=!1,this._$actions=yt(),this._$frameCache=yt(),this._$labels=null,this._$sounds=yt(),this._$actionOffset=0,this._$actionLimit=0,this._$currentFrame=1,this._$totalFrames=1,this._$isPlaying=!1,this._$loopConfig=null,this._$tweenFrame=0}static toString(){return"[class MovieClip]"}static get namespace(){return"next2d.display.MovieClip"}toString(){return"[object MovieClip]"}get namespace(){return"next2d.display.MovieClip"}get currentFrame(){return this._$currentFrame}get currentFrameLabel(){if(!this._$labels)return null;const t=this._$currentFrame;return this._$labels.has(t)&&this._$labels.get(t)||null}get currentLabels(){return!this._$labels||!this._$labels.size?null:le.from(this._$labels.values())}get isPlaying(){return this._$isPlaying}get totalFrames(){return this._$totalFrames}get loopConfig(){if(this._$loopConfig)return this._$loopConfig;const t=this._$placeObject||this._$getPlaceObject();return!t||!t.loop?null:(this._$tweenFrame&&(this._$changePlace=this._$tweenFrame!==this._$parent._$currentFrame,this._$tweenFrame=0),t.loop.tweenFrame&&(this._$tweenFrame=t.loop.tweenFrame),t.loop)}set loopConfig(t){this._$loopConfig=t,t&&(t.frame=this._$startFrame,this._$loopConfig=t,this._$currentFrame=this._$getLoopFrame(t))}gotoAndPlay(t){this.play(),this._$goToFrame(t)}gotoAndStop(t){this.stop(),this._$goToFrame(t)}nextFrame(){this.stop(),this._$totalFrames>this._$currentFrame&&this._$goToFrame(this._$currentFrame+1)}play(){this._$stopFlag=!1,this._$isPlaying=!0,this._$updateState()}prevFrame(){const t=this._$currentFrame-1;t&&(this.stop(),this._$goToFrame(t))}stop(){this._$stopFlag=!0,this._$isPlaying=!1}addFrameLabel(t){this._$labels||(this._$labels=yt()),this._$labels.set(t.frame,t)}addFrameScript(...t){for(let e=0;e<t.length;e+=2){const i=t[e];let r=+i;Ie(r)&&(r=this._$getFrameForLabel(`${i}`));const n=t[e+1];if(n&&r&&this._$totalFrames>=r&&this._$addAction(r,n),r===this._$currentFrame){const a=nt();if(a._$actionOffset=a._$actions.length,this._$canAction=!0,this._$setAction(),a._$actionOffset!==a._$actions.length){const o=a._$actions.splice(0,a._$actionOffset);a._$actions.push(...a._$actions,...o),a._$actionOffset=0}}}}_$getFrameForLabel(t){if(!this._$labels)return 0;for(const[e,i]of this._$labels)if(i.name===t)return e;return 0}_$addAction(t,e){if(t){this._$actions.has(t)||this._$actions.set(t,A());const i=this._$actions.get(t);i&&i.push(e)}}_$setAction(){if(this._$executeAddedEvent(),this._$canAction){const t=this._$currentFrame;if(this._$labels&&this._$labels.has(t)){const e=this._$labels.get(t);e&&e.willTrigger(S.FRAME_LABEL)&&e.dispatchEvent(new S(S.FRAME_LABEL))}if(this._$actions.size&&this._$actions.has(t)){const e=nt();e._$actions.indexOf(this)===-1&&e._$actions.push(this)}}}_$goToFrame(t){let e=+t;if(Ie(e)&&(e=this._$getFrameForLabel(`${t}`)),e<1&&(e=1),e>this._$totalFrames){this._$currentFrame=this._$totalFrames,this._$clearChildren(),this._$canAction=!1,this._$wait=!1;return}const i=nt();switch(!0){case e!==this._$currentFrame:{this._$wait=!1;const r=this._$currentFrame;this._$actionProcess&&(this._$frameCache.set("nextFrame",e),this._$frameCache.set("stopFlag",this._$stopFlag),this._$frameCache.set("isPlaying",this._$isPlaying)),this._$currentFrame=e,this._$clearChildren(),i._$actionOffset=i._$actions.length;const n=i._$actionOffset?i._$actions.indexOf(this):-1;if(this._$canAction=!0,this._$prepareActions(),i._$actionOffset&&i._$actionOffset!==i._$actions.length){const a=i._$actions.splice(0,i._$actionOffset);i._$actions.push(...i._$actions,...a),i._$actionOffset=0}if(!this._$actionProcess&&(n>-1||!i._$actionOffset))for(;i._$actions.length&&i._$actions.length!==n;){const a=i._$actions.pop();if(!a)continue;a._$canAction=!1,a._$actionOffset=0,a._$actionLimit=0,a._$actionProcess&&a._$frameCache.size&&(a._$currentFrame=a._$frameCache.get("nextFrame"),a._$clearChildren(),a._$stopFlag=a._$frameCache.get("stopFlag"),a._$isPlaying=a._$frameCache.get("isPlaying"),a._$frameCache.clear());const o=a._$currentFrame;if(!a._$actions.has(o))continue;const c=a._$actions.get(o);if(c)for(let u=0;u<c.length;++u)try{ri(a._$loaderInfo),c[u].apply(a)}catch{a.stop()}}this._$actionProcess&&(this._$currentFrame=r,this._$clearChildren())}break;case(!this._$actionProcess&&i._$actions.indexOf(this)>-1):{if(!this._$actionLimit)break;this._$wait=!1;const r=i._$actions.splice(this._$actionOffset,this._$actionLimit);for(;r.length;){const n=r.pop();if(!n)continue;n._$canAction=!1,n._$actionOffset=0,n._$actionLimit=0;const a=n._$currentFrame;if(!n._$actions.has(a))continue;const o=n._$actions.get(a);if(o)for(let c=0;c<o.length;++c)try{ri(n._$loaderInfo),o[c].apply(n)}catch{n.stop()}}}break}this._$canSound&&this._$sounds.size&&this._$sounds.has(this._$currentFrame)&&!i._$sounds.has(this._$instanceId)&&i._$sounds.set(this._$instanceId,this)}_$prepareActions(){this._$wait=!1;const t=this._$needsChildren?this._$getChildren():this._$children;for(let e=t.length-1;e>-1;--e)t[e]._$prepareActions();this._$setAction()}_$nextFrame(){let t=this._$needsChildren;switch(!0){case this._$wait:t=!0,this._$wait=!1;break;case this._$stopFlag:case this._$totalFrames===1:break;default:{t=!0,this._$canAction=!0,this._$canSound=!0;const i=this.loopConfig;if(!i)++this._$currentFrame,this._$currentFrame>this._$totalFrames&&(this._$currentFrame=1);else{const r=i.end?i.end:this._$totalFrames;switch(i.type){case 0:this._$changePlace?this._$currentFrame=i.start:(++this._$currentFrame,this._$currentFrame>r&&(this._$currentFrame=i.start));break;case 1:this._$changePlace?this._$currentFrame=i.start:(++this._$currentFrame,this._$currentFrame>r&&(this._$currentFrame=r,t=!1,this._$canAction=!1,this._$canSound=!1));break;case 2:this._$changePlace?this._$currentFrame=i.start:(t=!1,this._$canAction=!1,this._$canSound=!1);break;case 3:this._$changePlace?this._$currentFrame=r:(--this._$currentFrame,i.start>this._$currentFrame&&(this._$currentFrame=i.start,t=!1,this._$canAction=!1,this._$canSound=!1));break;case 4:this._$changePlace?this._$currentFrame=r:(--this._$currentFrame,i.start>this._$currentFrame&&(this._$currentFrame=r));break}}if(t&&this._$clearChildren(),this._$canSound&&this._$sounds.size&&this._$sounds.has(this._$currentFrame)){const r=nt();r._$sounds.has(this._$instanceId)||r._$sounds.set(this._$instanceId,this)}}break}const e=this._$needsChildren?this._$getChildren():this._$children;for(let i=e.length-1;i>-1;--i){const r=e[i];r._$isNext&&(t?r._$nextFrame():t=r._$nextFrame())}return this._$setAction(),this._$isNext=t,!this._$posted&&X&&this._$postProperty(),this._$isNext}_$getLoopFrame(t){const i=this._$parent._$currentFrame-t.frame;let r=1;switch(t.type){case 0:{const n=t.end?t.end:this._$totalFrames;r=t.start;for(let a=0;a<i;++a)++r,r>n&&(r=t.start)}break;case 1:{const n=t.end?t.end:this._$totalFrames;r=d.min(n,t.start+i)}break;case 2:r=t.start;break;case 3:r=t.end?t.end:this._$totalFrames,r=d.max(t.start,r-i);break;case 4:{const n=t.end?t.end:this._$totalFrames;r=n;for(let a=0;a<i;++a)--r,t.start>r&&(r=n)}break}return r}_$buildCharacter(t){if(t.sounds)for(let e=0;e<t.sounds.length;++e){const i=t.sounds[e],r=A();for(let n=0;n<i.sound.length;++n){const a=new xl;a._$build(i.sound[n],this),r.push(a)}this._$sounds.set(i.frame,r)}if(t.actions)for(let e=0;e<t.actions.length;++e){const i=t.actions[e];i.script||(i.script=Function(i.action)),this._$addAction(i.frame,i.script)}if(t.labels)for(let e=0;e<t.labels.length;++e){const i=t.labels[e];this.addFrameLabel(new pl(i.name,i.frame))}this._$totalFrames=t.totalFrame||1}_$sync(t){super._$sync(t),this._$buildCharacter(t)}_$build(t,e){const i=super._$build(t,e);return this._$buildCharacter(i),i}_$soundPlay(){if(!this._$sounds.has(this._$currentFrame))return;const t=this._$sounds.get(this._$currentFrame);if(t.length){let e=this._$soundTransform,i=this._$parent;for(;i;)i._$soundTransform&&(e=i._$soundTransform),i=i._$parent;for(let r=0;r<t.length;++r){const n=t[r];e&&(n.loopCount=e.loop?16777215:0,n.volume=e.volume),n.play()}}this._$canSound=!1}};class Tl extends Yt{constructor(){super(),this._$loaderInfo=new bl}static toString(){return"[class Loader]"}static get namespace(){return"next2d.display.Loader"}toString(){return"[object Loader]"}get namespace(){return"next2d.display.Loader"}get content(){return this._$loaderInfo?this._$loaderInfo.content:null}get contentLoaderInfo(){return this._$loaderInfo}load(t){const e=this._$loaderInfo;e&&(e.url=t.url,e.format=t.responseDataFormat,Vl({format:t.responseDataFormat,url:t.url,method:t.method,data:t.data,headers:t.headers,withCredentials:t.withCredentials,event:{loadstart:i=>{this._$loadstart(i)},progress:i=>{this._$progress(i)},loadend:i=>{this._$loadend(i)}}}))}loadJSON(t){if(t.type==="zlib"){if(u0()){Da.push(t);return}Qc(!0);const e=Jc(),i=new Uint8Array(t.buffer);e.onmessage=r=>{this._$unzipHandler(r)},e.postMessage(i,[i.buffer])}else this._$build(t)}_$loadend(t){const e=this._$loaderInfo;if(!e)return;e.bytesLoaded=t.loaded,e.bytesTotal=t.total,e.willTrigger(Lt.PROGRESS)&&e.dispatchEvent(new Lt(Lt.PROGRESS,!1,!1,t.loaded,t.total));const i=t.target;if(e.willTrigger(yn.HTTP_STATUS)){const r=n0(i.getAllResponseHeaders());e.dispatchEvent(new yn(yn.HTTP_STATUS,!1,!1,i.status,i.responseURL,r))}199<i.status&&400>i.status?e.format==="json"?this.loadJSON(i.response):e.willTrigger(fe.IO_ERROR)&&e.dispatchEvent(new fe(fe.IO_ERROR,!1,!1,"LoaderInfo format is `json`")):e.willTrigger(fe.IO_ERROR)&&e.dispatchEvent(new fe(fe.IO_ERROR,!1,!1,i.statusText))}_$unzipHandler(t){if(this._$build(t.data),Da.length){const e=Da.pop();if(!e)return;const i=new Uint8Array(e.buffer),r=Jc();r.onmessage=n=>{this._$unzipHandler(n)},r.postMessage(i,[i.buffer])}else Qc(!1)}_$loadstart(t){const e=this._$loaderInfo;e&&(e.bytesLoaded=t.loaded,e.bytesTotal=t.total,e.willTrigger(S.OPEN)&&e.dispatchEvent(new S(S.OPEN)),e.willTrigger(Lt.PROGRESS)&&e.dispatchEvent(new Lt(Lt.PROGRESS,!1,!1,t.loaded,t.total)))}_$progress(t){const e=this._$loaderInfo;e&&(e.bytesLoaded=t.loaded,e.bytesTotal=t.total,e.willTrigger(Lt.PROGRESS)&&e.dispatchEvent(new Lt(Lt.PROGRESS,!1,!1,t.loaded,t.total)))}_$build(t){const e=this._$loaderInfo;if(!e)return;const i=yt();if(t.symbols.length)for(let a=0;a<t.symbols.length;++a){const o=t.symbols[a];i.set(o[0],o[1])}e._$data={stage:t.stage,characters:t.characters,symbols:i},e._$content=new Ln;const r=t.characters[0];e._$content._$build({characterId:0,clipDepth:0,depth:0,endFrame:r.controller.length,startFrame:1},this),e._$content._$parent=null,this.addChild(e._$content),e._$content._$added=!1,e._$content._$addedStage=!1;const n=nt();n._$loaders.push(e),n._$loadStatus===1&&(n._$loadStatus=2)}}class gr extends sa{constructor(){super(),this._$graphics=null,this._$src=""}static toString(){return"[class Shape]"}static get namespace(){return"next2d.display.Shape"}toString(){return"[object Shape]"}get namespace(){return"next2d.display.Shape"}get graphics(){return this._$graphics||(this._$graphics=new U(this)),this._$graphics}get src(){return this._$src}set src(t){if(!t)return;const e=new Image;e.addEventListener("load",()=>{const i=e.width,r=e.height,n=new Ms(i,r);n.image=e,this.graphics.beginBitmapFill(n).drawRect(0,0,i,r),this.hasEventListener(S.LOAD)&&this.dispatchEvent(new S(S.LOAD))}),this._$src=e.src=t,this.graphics._$mode="bitmap"}_$buildCharacter(t,e){const i=this.graphics;if(!e._$data)throw new Error("the loaderInfo data is null.");if(t.recodes)switch(!0){case t.bitmapId>0:{const r=e._$data.characters[t.bitmapId];if(!r.buffer)throw new Error("the bitmap buffer is null.");const n=d.abs(r.bounds.xMax-r.bounds.xMin),a=d.abs(r.bounds.yMax-r.bounds.yMin),o=new Ms(n,a);r._$buffer||(r._$buffer=new Uint8Array(r.buffer),V(r.buffer),r.buffer=null),o.buffer=r._$buffer.slice(),i._$recode=A(),n===t.bounds.xMax-t.bounds.xMin&&a===t.bounds.yMax-t.bounds.yMin&&(i._$bitmapId=t.bitmapId,i._$mode="bitmap");const c=t.recodes;if(c[c.length-1]===U.END_FILL){const u=c.length-6;for(let l=0;l<u;++l)i._$recode.push(c[l]);i._$recode.push(U.BITMAP_FILL,o,null,"repeat",!1)}else{const u=c[c.length-9],l=c[c.length-8],h=c[c.length-7],$=c[c.length-6],_=c.length-10;for(let g=0;g<_;++g)i._$recode.push(c[g]);i._$recode.push(U.BITMAP_STROKE,u,l,h,$,o,Pt(1,0,0,1,t.bounds.xMin,t.bounds.yMin),"repeat",!1)}}break;case t.inBitmap:{i._$recode=A();const r=t.recodes;for(let n=0;n<r.length;++n){const a=r[n];if(i._$recode[n]=a,typeof a!="object"||!a.buffer)continue;const o=new Ms(a.width,a.height);o.buffer=new Uint8Array(a.buffer),i._$recode[n++]=o;const c=r[n];i._$recode[n]=Pt(c[0],c[1],c[2],c[3],c[4],c[5]),a.width===t.bounds.xMax-t.bounds.xMin&&a.height===t.bounds.yMax-t.bounds.yMin&&(i._$bitmapId=t.bitmapId,i._$mode="bitmap")}}break;default:i._$recode=t.recodes.slice(0);break}else{i._$mode="bitmap";const r=d.abs(t.bounds.xMax-t.bounds.xMin),n=d.abs(t.bounds.yMax-t.bounds.yMin),a=new Ms(r,n);if(!t._$buffer){if(!t.buffer)throw new Error("the bitmap buffer is null.");t._$buffer=new Uint8Array(t.buffer),V(t.buffer),t.buffer=null}a.buffer=t._$buffer.slice(0),i.beginBitmapFill(a,null,!1).drawRect(0,0,r,n)}i._$maxAlpha=1,i._$canDraw=!0,i._$xMin=t.bounds.xMin,i._$xMax=t.bounds.xMax,i._$yMin=t.bounds.yMin,i._$yMax=t.bounds.yMax,t.grid&&(this._$scale9Grid=new ue(t.grid.x,t.grid.y,t.grid.w,t.grid.h)),X&&this._$stage&&this._$createWorkerInstance()}_$sync(t){this._$loaderInfo&&this._$buildCharacter(t,this._$loaderInfo)}_$build(t,e){const i=this._$baseBuild(t,e);return this._$buildCharacter(i,e._$loaderInfo),i}_$getBounds(t=null){if(!this._$graphics)return et(0,0,0,0);const e=this._$graphics._$getBounds();if(!t)return e;let i=t;const r=this._$transform._$rawMatrix();(r[0]!==1||r[1]!==0||r[2]!==0||r[3]!==1||r[4]!==0||r[5]!==0)&&(i=ct(t,r));const n=wt(e,i);return W(e),i!==t&&tt(i),n}_$draw(t,e,i){if(!this._$visible||!this._$graphics||!this._$graphics._$canDraw)return;let r=i;const n=this._$transform._$rawColorTransform();if((n!==vr&&n[0]!==1||n[1]!==1||n[2]!==1||n[3]!==1||n[4]!==0||n[5]!==0||n[6]!==0||n[7]!==0)&&(r=yi(i,n)),!O(r[3]+r[7]/255,0,1,0)){r!==i&&$s(r);return}const o=this._$filters||this.filters,c=this._$blendMode||this.blendMode;let u=e;const l=this._$transform._$rawMatrix();(l!==$e&&l[0]!==1||l[1]!==0||l[2]!==0||l[3]!==1||l[4]!==0||l[5]!==0)&&(u=ct(e,l)),this._$graphics._$draw(t,u,r,c,o),u!==e&&tt(u),r!==i&&$s(r)}_$clip(t,e){if(!this._$graphics)return;let i=e;const r=this._$transform._$rawMatrix();(r[0]!==1||r[1]!==0||r[2]!==0||r[3]!==1||r[4]!==0||r[5]!==0)&&(i=ct(e,r)),this._$graphics._$clip(t,i),i!==e&&tt(i)}_$mouseHit(t,e,i){return this._$visible?this._$hit(t,e,i):!1}_$hit(t,e,i,r=!1){let n=!1;const a=this._$graphics;if(a&&a._$canDraw&&a._$getBounds()){let o=e;const c=this._$transform._$rawMatrix();(c[0]!==1||c[1]!==0||c[2]!==0||c[3]!==1||c[4]!==0||c[5]!==0)&&(o=ct(e,c)),n=a._$hit(t,o,i,r),o!==e&&tt(o)}return n}_$createWorkerInstance(){if(this._$created||!X)return;this._$created=!0,this._$posted=!0,this._$updated=!1;const t=ur();let e=0;t[e++]=this._$instanceId,t[e++]=this._$parent?this._$parent._$instanceId:-1,t[e++]=0,t[e++]=0;const i=this._$graphics;if(i&&!i._$posted&&i._$maxAlpha>0&&i._$canDraw){i._$posted=!0;const o=di(),c=i._$getRecodes();o.command=`shapeRecodes@${this._$instanceId}`,o.buffer=c;const u=A(c.buffer);X.postMessage(o,u),$i(o),V(u),t[2]=i._$maxAlpha,t[3]=+i._$canDraw}const r=this._$getBounds();t[e++]=r.xMin,t[e++]=r.yMin,t[e++]=r.xMax,t[e++]=r.yMax,t[e++]=this._$characterId>-1?this._$characterId:-1,t[e++]=this._$loaderInfo?this._$loaderInfo._$id:-1,this._$registerProperty(t,e);const n=di();n.command="createShape",n.buffer=t;const a=A(t.buffer);X.postMessage(n,a),$i(n),V(a)}_$postProperty(){if(!this._$created||!X)return;const t=this._$createMessage(),e=this._$graphics;if(e&&!e._$posted){t.maxAlpha=e._$maxAlpha,t.canDraw=e._$canDraw;const i=e._$getRecodes();t.recodes=i;const r=A(i.buffer),n=this._$getBounds();t.xMin=n.xMin,t.yMin=n.yMin,t.xMax=n.xMax,t.yMax=n.yMax,X.postMessage(t,r),V(r)}else X.postMessage(t);this._$posted=!0,this._$updated=!1}}let vl=class extends Yt{constructor(){super(),this._$player=null,this._$root=this,this._$stage=this,this._$invalidate=!0,this._$color=4294967295,this._$frameRate=60}static toString(){return"[class Stage]"}static get namespace(){return"next2d.display.Stage"}toString(){return"[object Stage]"}get namespace(){return"next2d.display.Stage"}get color(){return this._$color}set color(t){this._$color=O(It(t),0,16777215,16777215);const e=this._$player;if(e&&e.context){const i=_l(this._$color);e.context._$setColor(i.R/255,i.G/255,i.B/255,i.A/255)}}get frameRate(){return this._$frameRate}set frameRate(t){this._$frameRate=O(+t,1,60,60),this._$player&&!this._$player._$stopFlag&&(this._$player.stop(),this._$player.play())}get player(){return this._$player}get canvasHeight(){return this._$player?this._$player._$height/at:0}get canvasWidth(){return this._$player?this._$player._$width/at:0}get currentStageHeight(){return this._$player?this._$player.height*this._$player._$scale:0}get currentStageWidth(){return this._$player?this._$player.width*this._$player._$scale:0}get stageHeight(){return this._$player?this._$player.height:0}get stageWidth(){return this._$player?this._$player.width:0}invalidate(){this._$invalidate=!0}_$addChild(t){return t._$stage=this,t._$root=t,this._$created=!0,super._$addChild(t)}};class hs{static toString(){return"[class Easing]"}static get namespace(){return"next2d.ui.Easing"}toString(){return"[object Easing]"}get namespace(){return"next2d.ui.Easing"}static linear(t,e,i,r){return t/r*i+e}static inQuad(t,e,i,r){return(t/=r)*t*i+e}static outQuad(t,e,i,r){return-(t/=r)*(t-2)*i+e}static inOutQuad(t,e,i,r){return(t/=r/2)<1?t*t*i/2+e:-((t-=1)*(t-2)-1)*i/2+e}static inCubic(t,e,i,r){return(t/=r)*t*t*i+e}static outCubic(t,e,i,r){return t/=r,(--t*t*t+1)*i+e}static inOutCubic(t,e,i,r){return(t/=r/2)<1?t*t*t*i/2+e:((t-=2)*t*t+2)*i/2+e}static inQuart(t,e,i,r){return(t/=r)*t*t*t*i+e}static outQuart(t,e,i,r){return t/=r,(--t*t*t*t-1)*-i+e}static inOutQuart(t,e,i,r){return(t/=r/2)<1?t*t*t*t*i/2+e:((t-=2)*t*t*t-2)*-i/2+e}static inQuint(t,e,i,r){return(t/=r)*t*t*t*t*i+e}static outQuint(t,e,i,r){return t/=r,(--t*t*t*t*t+1)*i+e}static inOutQuint(t,e,i,r){return(t/=r/2)<1?t*t*t*t*t*i/2+e:((t-=2)*t*t*t*t+2)*i/2+e}static inSine(t,e,i,r){return-i*d.cos(t/r*(d.PI/2))+i+e}static outSine(t,e,i,r){return i*d.sin(t/r*(d.PI/2))+e}static inOutSine(t,e,i,r){return-i/2*(d.cos(d.PI*t/r)-1)+e}static inExpo(t,e,i,r){return i*d.pow(2,10*(t/r-1))+e}static outExpo(t,e,i,r){return i*(-d.pow(2,-10*t/r)+1)+e}static inOutExpo(t,e,i,r){return(t/=r/2)<1?i/2*d.pow(2,10*(t-1))+e:i/2*(-d.pow(2,-10*(t-1))+2)+e}static inCirc(t,e,i,r){return(1-d.sqrt(1-(t/=r)*t))*i+e}static outCirc(t,e,i,r){return t/=r,d.sqrt(1- --t*t)*i+e}static inOutCirc(t,e,i,r){return(t/=r*2)<1?(d.sqrt(1-t*t)-1)/-2*i+e:(d.sqrt(1-(t-=2)*t)+1)/2*i+e}static inBack(t,e,i,r){return(2.70158*(t/=r)*t*t-1.70158*t*t)*i+e}static outBack(t,e,i,r){return(1+2.70158*d.pow((t/=r)-1,3)+1.70158*d.pow(t-1,2))*i+e}static inOutBack(t,e,i,r){let n=1.70158;return(t/=r/2)<1?t*t*(((n*=1.525)+1)*t-n)*i/2+e:((t-=2)*t*(((n*=1.525)+1)*t+n)+2)*i/2+e}static inElastic(t,e,i,r){return(t/=r)===0?e:t===1?i+e:-d.pow(2,(t*=10)-10)*d.sin((t-10.75)*(2*d.PI/3))*i+e}static outElastic(t,e,i,r){return(t/=r)===0?e:t===1?i+e:(d.pow(2,-10*t)*d.sin((t*10-.75)*(2*d.PI/3))+1)*i+e}static inOutElastic(t,e,i,r){return(t/=r)===0?e:t===1?i+e:t<.5?-(d.pow(2,20*t-10)*d.sin((20*t-11.125)*(2*d.PI/4.5)))/2*i+e:(d.pow(2,-20*t+10)*d.sin((20*t-11.125)*(2*d.PI/4.5))/2+1)*i+e}static outBounce(t,e,i,r){return(t/=r)<1/2.75?7.5625*t*t*i+e:t<2/2.75?(7.5625*(t-=1.5/2.75)*t+.75)*i+e:t<2.5/2.75?(7.5625*(t-=2.25/2.75)*t+.9375)*i+e:(7.5625*(t-=2.625/2.75)*t+.984375)*i+e}static inBounce(t,e,i,r){return i-hs.outBounce(r-t,0,i,r)+e}static inOutBounce(t,e,i,r){return t<r/2?hs.inBounce(t*2,e,i/2,r):hs.outBounce(t*2-r,e+i/2,i/2,r)}}class Sl extends Ei{constructor(t,e=null,i=null,r=0,n=1,a=null){super(),this._$target=t,this._$delay=r,this._$duration=n,this._$ease=a||hs.linear,this._$from=e,this._$names=null,this._$startTime=0,this._$stopFlag=!1,this._$forceStop=!1,this._$to=i,this._$currentTime=0,this._$timerId=0,this._$nextJob=null}static toString(){return"[class Job]"}static get namespace(){return"next2d.ui.Job"}toString(){return"[object Job]"}get namespace(){return"next2d.ui.Job"}get ease(){return this._$ease}set ease(t){typeof t=="function"&&(this._$ease=t)}get delay(){return this._$delay}set delay(t){this._$delay=t}get duration(){return this._$duration}set duration(t){this._$duration=t}get from(){return this._$from}set from(t){this._$from=t}get to(){return this._$to}set to(t){this._$to=t}get target(){return this._$target}chain(t){return this._$nextJob=t,t}initialize(){this._$forceStop||(this._$stopFlag=!1,this._$startTime=$r.now(),this._$names=this._$entries(this._$from),this._$update())}_$entries(t){const e=Object.entries(t);for(let i=0;i<e.length;++i){const r=e[i],n=r[1];n&&typeof n=="object"&&(r[1]=this._$entries(n))}return e}start(){if(this._$timerId&&us(this._$timerId),this._$forceStop=!1,this._$delay){_r(()=>{this.initialize()},this._$delay*1e3);return}this.initialize()}stop(){this._$timerId&&us(this._$timerId),this.hasEventListener(S.STOP)&&(this.dispatchEvent(new S(S.STOP)),this.removeAllEventListener(S.STOP)),this._$names=null,this._$forceStop=!0,this._$stopFlag=!0}_$update(){if(!this._$stopFlag){if(!this._$names)return this.stop();this._$currentTime=($r.now()-this._$startTime)*.001,this._$updateProperty(this._$target,this._$from,this._$to,this._$names),this.hasEventListener(S.UPDATE)&&this.dispatchEvent(new S(S.UPDATE)),this._$currentTime>=this._$duration?(this.hasEventListener(S.COMPLETE)&&this.dispatchEvent(new S(S.COMPLETE)),this._$nextJob&&this._$nextJob.start()):this._$timerId=requestAnimationFrame(()=>{this._$update()})}}_$updateProperty(t,e,i,r){for(let n=0;n<r.length;++n){const a=r[n],o=a[0];if(o==="__proto__"||o==="constructor"||o==="prototype")continue;const c=a[1];if(c&&typeof c=="object"){this._$updateProperty(t[o],e[o],i[o],c);continue}if(!(o in t))continue;const u=e[o];this._$duration>this._$currentTime?t[o]=this._$ease(this._$currentTime,u,i[o]-u,this._$duration):t[o]=i[o]}}}class to{static toString(){return"[class Tween]"}static get namespace(){return"next2d.ui.Tween"}toString(){return"[object Tween]"}get namespace(){return"next2d.ui.Tween"}static add(t,e,i,r=0,n=1,a=null){return new Sl(t,e,i,r,n,a)}}class ia{constructor(t=null,e=null,i=null,r=null,n=null,a=null,o=null,c=null,u=null,l=null){this._$font=t,this._$size=e,this._$color=i===null?null:O(It(i),0,16777215,0),this._$bold=r,this._$italic=n,this._$underline=a,this._$align=o,this._$leftMargin=c,this._$rightMargin=u,this._$leading=l,this._$letterSpacing=0}static toString(){return"[class TextFormat]"}static get namespace(){return"next2d.text.TextFormat"}toString(){return"[object TextFormat]"}get namespace(){return"next2d.text.TextFormat"}get align(){return this._$align}set align(t){this._$align=t}get bold(){return this._$bold}set bold(t){this._$bold=t!==null?!!t:null}get color(){return this._$color}set color(t){this._$color=t,t&&(this._$color=O(It(t),0,16777215,0))}get font(){return this._$font}set font(t){this._$font=t!==null?`${t}`:null}get italic(){return this._$italic}set italic(t){this._$italic=t!==null?!!t:null}get leading(){return this._$leading}set leading(t){this._$leading=t}get leftMargin(){return this._$leftMargin}set leftMargin(t){this._$leftMargin=t}get letterSpacing(){return this._$letterSpacing}set letterSpacing(t){this._$letterSpacing=t}get rightMargin(){return this._$rightMargin}set rightMargin(t){this._$rightMargin=t}get size(){return this._$size}set size(t){this._$size=t?t|0:null}get underline(){return this._$underline}set underline(t){this._$underline=t!==null?!!t:null}_$toStyleString(){let t="";if(this._$font&&(t+=`font-family: ${this._$font};`),this._$size&&(t+=`font-size: ${this._$size}px;`),this._$color){const e=ve(It(this._$color)),i=e.R.toString(16).padStart(2,"0"),r=e.G.toString(16).padStart(2,"0"),n=e.B.toString(16).padStart(2,"0");t+=`color: #${i}${r}${n};`}return this._$bold&&(t+="font-weight: bold;"),this._$italic&&(t+="font-style: italic;"),this._$underline&&(t+="text-decoration: underline;"),this._$align&&(t+=`text-align: ${this._$align};`),this._$leftMargin&&(t+=`margin-left: ${this._$leftMargin}px;`),this._$rightMargin&&(t+=`margin-right: ${this._$rightMargin}px;`),this._$leading&&(t+=`margin-bottom: ${this._$leading}px;`),this._$letterSpacing&&(t+=`letter-spacing: ${this._$letterSpacing}px;`),t}_$isSame(t){return!(this._$font!==t.font||this._$size!==t.size||this._$color!==t.color||this._$bold!==t.bold||this._$italic!==t.italic||this._$underline!==t.underline||this._$align!==t.align||this._$leftMargin!==t.leftMargin||this._$rightMargin!==t.rightMargin||this._$leading!==t.leading||this._$letterSpacing!==t.letterSpacing)}_$clone(){const t=new ia(this._$font,this._$size,this._$color,this._$bold,this._$italic,this._$underline,this._$align,this._$leftMargin,this._$rightMargin,this._$leading);return t._$letterSpacing=this._$letterSpacing,t}_$setDefault(){this._$align="left",this._$bold=!1,this._$color=0,this._$font="Times New Roman",this._$italic=!1,this._$leading=0,this._$leftMargin=0,this._$letterSpacing=0,this._$rightMargin=0,this._$size=12,this._$underline=!1}_$merge(t){this._$align===null&&(this._$align=t._$align),this._$bold===null&&(this._$bold=t._$bold),this._$color===null&&(this._$color=t._$color),this._$font===null&&(this._$font=t._$font),this._$italic===null&&(this._$italic=t._$italic),this._$leading===null&&(this._$leading=t._$leading),this._$leftMargin===null&&(this._$leftMargin=t._$leftMargin),this._$letterSpacing===null&&(this._$letterSpacing=t._$letterSpacing),this._$rightMargin===null&&(this._$rightMargin=t._$rightMargin),this._$size===null&&(this._$size=t._$size),this._$underline===null&&(this._$underline=t._$underline)}_$widthMargin(){let t=0;return this._$leftMargin&&(t+=this._$leftMargin),this._$rightMargin&&(t+=this._$rightMargin),t}_$generateFontStyle(){let t="";return this._$italic&&(t="italic "),this._$bold&&(t+="bold "),`${t}${this._$size}px '${this._$font}',sans-serif`}}const wl=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(s=>s.charCodeAt(0))),Ml=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(s=>s.charCodeAt(0)));var Fa;const Q_=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),eo=(Fa=String.fromCodePoint)!==null&&Fa!==void 0?Fa:function(s){let t="";return s>65535&&(s-=65536,t+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),t+=String.fromCharCode(s),t};function tf(s){var t;return s>=55296&&s<=57343||s>1114111?65533:(t=Q_.get(s))!==null&&t!==void 0?t:s}var Ft;(function(s){s[s.NUM=35]="NUM",s[s.SEMI=59]="SEMI",s[s.EQUALS=61]="EQUALS",s[s.ZERO=48]="ZERO",s[s.NINE=57]="NINE",s[s.LOWER_A=97]="LOWER_A",s[s.LOWER_F=102]="LOWER_F",s[s.LOWER_X=120]="LOWER_X",s[s.LOWER_Z=122]="LOWER_Z",s[s.UPPER_A=65]="UPPER_A",s[s.UPPER_F=70]="UPPER_F",s[s.UPPER_Z=90]="UPPER_Z"})(Ft||(Ft={}));const ef=32;var os;(function(s){s[s.VALUE_LENGTH=49152]="VALUE_LENGTH",s[s.BRANCH_LENGTH=16256]="BRANCH_LENGTH",s[s.JUMP_TABLE=127]="JUMP_TABLE"})(os||(os={}));function so(s){return s>=Ft.ZERO&&s<=Ft.NINE}function sf(s){return s>=Ft.UPPER_A&&s<=Ft.UPPER_F||s>=Ft.LOWER_A&&s<=Ft.LOWER_F}function rf(s){return s>=Ft.UPPER_A&&s<=Ft.UPPER_Z||s>=Ft.LOWER_A&&s<=Ft.LOWER_Z||so(s)}function nf(s){return s===Ft.EQUALS||rf(s)}var Rt;(function(s){s[s.EntityStart=0]="EntityStart",s[s.NumericStart=1]="NumericStart",s[s.NumericDecimal=2]="NumericDecimal",s[s.NumericHex=3]="NumericHex",s[s.NamedEntity=4]="NamedEntity"})(Rt||(Rt={}));var Re;(function(s){s[s.Legacy=0]="Legacy",s[s.Strict=1]="Strict",s[s.Attribute=2]="Attribute"})(Re||(Re={}));class Il{constructor(t,e,i){this.decodeTree=t,this.emitCodePoint=e,this.errors=i,this.state=Rt.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=Re.Strict}startEntity(t){this.decodeMode=t,this.state=Rt.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(t,e){switch(this.state){case Rt.EntityStart:return t.charCodeAt(e)===Ft.NUM?(this.state=Rt.NumericStart,this.consumed+=1,this.stateNumericStart(t,e+1)):(this.state=Rt.NamedEntity,this.stateNamedEntity(t,e));case Rt.NumericStart:return this.stateNumericStart(t,e);case Rt.NumericDecimal:return this.stateNumericDecimal(t,e);case Rt.NumericHex:return this.stateNumericHex(t,e);case Rt.NamedEntity:return this.stateNamedEntity(t,e)}}stateNumericStart(t,e){return e>=t.length?-1:(t.charCodeAt(e)|ef)===Ft.LOWER_X?(this.state=Rt.NumericHex,this.consumed+=1,this.stateNumericHex(t,e+1)):(this.state=Rt.NumericDecimal,this.stateNumericDecimal(t,e))}addToNumericResult(t,e,i,r){if(e!==i){const n=i-e;this.result=this.result*Math.pow(r,n)+parseInt(t.substr(e,n),r),this.consumed+=n}}stateNumericHex(t,e){const i=e;for(;e<t.length;){const r=t.charCodeAt(e);if(so(r)||sf(r))e+=1;else return this.addToNumericResult(t,i,e,16),this.emitNumericEntity(r,3)}return this.addToNumericResult(t,i,e,16),-1}stateNumericDecimal(t,e){const i=e;for(;e<t.length;){const r=t.charCodeAt(e);if(so(r))e+=1;else return this.addToNumericResult(t,i,e,10),this.emitNumericEntity(r,2)}return this.addToNumericResult(t,i,e,10),-1}emitNumericEntity(t,e){var i;if(this.consumed<=e)return(i=this.errors)===null||i===void 0||i.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(t===Ft.SEMI)this.consumed+=1;else if(this.decodeMode===Re.Strict)return 0;return this.emitCodePoint(tf(this.result),this.consumed),this.errors&&(t!==Ft.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(t,e){const{decodeTree:i}=this;let r=i[this.treeIndex],n=(r&os.VALUE_LENGTH)>>14;for(;e<t.length;e++,this.excess++){const a=t.charCodeAt(e);if(this.treeIndex=af(i,r,this.treeIndex+Math.max(1,n),a),this.treeIndex<0)return this.result===0||this.decodeMode===Re.Attribute&&(n===0||nf(a))?0:this.emitNotTerminatedNamedEntity();if(r=i[this.treeIndex],n=(r&os.VALUE_LENGTH)>>14,n!==0){if(a===Ft.SEMI)return this.emitNamedEntityData(this.treeIndex,n,this.consumed+this.excess);this.decodeMode!==Re.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var t;const{result:e,decodeTree:i}=this,r=(i[e]&os.VALUE_LENGTH)>>14;return this.emitNamedEntityData(e,r,this.consumed),(t=this.errors)===null||t===void 0||t.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(t,e,i){const{decodeTree:r}=this;return this.emitCodePoint(e===1?r[t]&~os.VALUE_LENGTH:r[t+1],i),e===3&&this.emitCodePoint(r[t+2],i),i}end(){var t;switch(this.state){case Rt.NamedEntity:return this.result!==0&&(this.decodeMode!==Re.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case Rt.NumericDecimal:return this.emitNumericEntity(0,2);case Rt.NumericHex:return this.emitNumericEntity(0,3);case Rt.NumericStart:return(t=this.errors)===null||t===void 0||t.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case Rt.EntityStart:return 0}}}function Al(s){let t="";const e=new Il(s,i=>t+=eo(i));return function(r,n){let a=0,o=0;for(;(o=r.indexOf("&",o))>=0;){t+=r.slice(a,o),e.startEntity(n);const u=e.write(r,o+1);if(u<0){a=o+e.end();break}a=o+u,o=u===0?a+1:a}const c=t+r.slice(a);return t="",c}}function af(s,t,e,i){const r=(t&os.BRANCH_LENGTH)>>7,n=t&os.JUMP_TABLE;if(r===0)return n!==0&&i===n?e:-1;if(n){const c=i-n;return c<0||c>=r?-1:s[e+c]-1}let a=e,o=a+r-1;for(;a<=o;){const c=a+o>>>1,u=s[c];if(u<i)a=c+1;else if(u>i)o=c-1;else return s[c+r]}return-1}Al(wl);Al(Ml);var H;(function(s){s[s.Tab=9]="Tab",s[s.NewLine=10]="NewLine",s[s.FormFeed=12]="FormFeed",s[s.CarriageReturn=13]="CarriageReturn",s[s.Space=32]="Space",s[s.ExclamationMark=33]="ExclamationMark",s[s.Number=35]="Number",s[s.Amp=38]="Amp",s[s.SingleQuote=39]="SingleQuote",s[s.DoubleQuote=34]="DoubleQuote",s[s.Dash=45]="Dash",s[s.Slash=47]="Slash",s[s.Zero=48]="Zero",s[s.Nine=57]="Nine",s[s.Semi=59]="Semi",s[s.Lt=60]="Lt",s[s.Eq=61]="Eq",s[s.Gt=62]="Gt",s[s.Questionmark=63]="Questionmark",s[s.UpperA=65]="UpperA",s[s.LowerA=97]="LowerA",s[s.UpperF=70]="UpperF",s[s.LowerF=102]="LowerF",s[s.UpperZ=90]="UpperZ",s[s.LowerZ=122]="LowerZ",s[s.LowerX=120]="LowerX",s[s.OpeningSquareBracket=91]="OpeningSquareBracket"})(H||(H={}));var C;(function(s){s[s.Text=1]="Text",s[s.BeforeTagName=2]="BeforeTagName",s[s.InTagName=3]="InTagName",s[s.InSelfClosingTag=4]="InSelfClosingTag",s[s.BeforeClosingTagName=5]="BeforeClosingTagName",s[s.InClosingTagName=6]="InClosingTagName",s[s.AfterClosingTagName=7]="AfterClosingTagName",s[s.BeforeAttributeName=8]="BeforeAttributeName",s[s.InAttributeName=9]="InAttributeName",s[s.AfterAttributeName=10]="AfterAttributeName",s[s.BeforeAttributeValue=11]="BeforeAttributeValue",s[s.InAttributeValueDq=12]="InAttributeValueDq",s[s.InAttributeValueSq=13]="InAttributeValueSq",s[s.InAttributeValueNq=14]="InAttributeValueNq",s[s.BeforeDeclaration=15]="BeforeDeclaration",s[s.InDeclaration=16]="InDeclaration",s[s.InProcessingInstruction=17]="InProcessingInstruction",s[s.BeforeComment=18]="BeforeComment",s[s.CDATASequence=19]="CDATASequence",s[s.InSpecialComment=20]="InSpecialComment",s[s.InCommentLike=21]="InCommentLike",s[s.BeforeSpecialS=22]="BeforeSpecialS",s[s.BeforeSpecialT=23]="BeforeSpecialT",s[s.SpecialStartSequence=24]="SpecialStartSequence",s[s.InSpecialTag=25]="InSpecialTag",s[s.InEntity=26]="InEntity"})(C||(C={}));function ze(s){return s===H.Space||s===H.NewLine||s===H.Tab||s===H.FormFeed||s===H.CarriageReturn}function zr(s){return s===H.Slash||s===H.Gt||ze(s)}function of(s){return s>=H.LowerA&&s<=H.LowerZ||s>=H.UpperA&&s<=H.UpperZ}var Fe;(function(s){s[s.NoValue=0]="NoValue",s[s.Unquoted=1]="Unquoted",s[s.Single=2]="Single",s[s.Double=3]="Double"})(Fe||(Fe={}));const Nt={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};class cf{constructor({xmlMode:t=!1,decodeEntities:e=!0},i){this.cbs=i,this.state=C.Text,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=C.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.xmlMode=t,this.decodeEntities=e,this.entityDecoder=new Il(t?Ml:wl,(r,n)=>this.emitCodePoint(r,n))}reset(){this.state=C.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=C.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(t){this.offset+=this.buffer.length,this.buffer=t,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}stateText(t){t===H.Lt||!this.decodeEntities&&this.fastForwardTo(H.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=C.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&t===H.Amp&&this.startEntity()}stateSpecialStartSequence(t){const e=this.sequenceIndex===this.currentSequence.length;if(!(e?zr(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!e){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=C.InTagName,this.stateInTagName(t)}stateInSpecialTag(t){if(this.sequenceIndex===this.currentSequence.length){if(t===H.Gt||ze(t)){const e=this.index-this.currentSequence.length;if(this.sectionStart<e){const i=this.index;this.index=e,this.cbs.ontext(this.sectionStart,e),this.index=i}this.isSpecial=!1,this.sectionStart=e+2,this.stateInClosingTagName(t);return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Nt.TitleEnd?this.decodeEntities&&t===H.Amp&&this.startEntity():this.fastForwardTo(H.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(t===H.Lt)}stateCDATASequence(t){t===Nt.Cdata[this.sequenceIndex]?++this.sequenceIndex===Nt.Cdata.length&&(this.state=C.InCommentLike,this.currentSequence=Nt.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=C.InDeclaration,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===t)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Nt.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=C.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(t){return this.xmlMode?!zr(t):of(t)}startSpecial(t,e){this.isSpecial=!0,this.currentSequence=t,this.sequenceIndex=e,this.state=C.SpecialStartSequence}stateBeforeTagName(t){if(t===H.ExclamationMark)this.state=C.BeforeDeclaration,this.sectionStart=this.index+1;else if(t===H.Questionmark)this.state=C.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(t)){const e=t|32;this.sectionStart=this.index,this.xmlMode?this.state=C.InTagName:e===Nt.ScriptEnd[2]?this.state=C.BeforeSpecialS:e===Nt.TitleEnd[2]?this.state=C.BeforeSpecialT:this.state=C.InTagName}else t===H.Slash?this.state=C.BeforeClosingTagName:(this.state=C.Text,this.stateText(t))}stateInTagName(t){zr(t)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=C.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateBeforeClosingTagName(t){ze(t)||(t===H.Gt?this.state=C.Text:(this.state=this.isTagStartChar(t)?C.InClosingTagName:C.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(t){(t===H.Gt||ze(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=C.AfterClosingTagName,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){(t===H.Gt||this.fastForwardTo(H.Gt))&&(this.state=C.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(t){t===H.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=C.InSpecialTag,this.sequenceIndex=0):this.state=C.Text,this.sectionStart=this.index+1):t===H.Slash?this.state=C.InSelfClosingTag:ze(t)||(this.state=C.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===H.Gt?(this.cbs.onselfclosingtag(this.index),this.state=C.Text,this.sectionStart=this.index+1,this.isSpecial=!1):ze(t)||(this.state=C.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateInAttributeName(t){(t===H.Eq||zr(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=this.index,this.state=C.AfterAttributeName,this.stateAfterAttributeName(t))}stateAfterAttributeName(t){t===H.Eq?this.state=C.BeforeAttributeValue:t===H.Slash||t===H.Gt?(this.cbs.onattribend(Fe.NoValue,this.sectionStart),this.sectionStart=-1,this.state=C.BeforeAttributeName,this.stateBeforeAttributeName(t)):ze(t)||(this.cbs.onattribend(Fe.NoValue,this.sectionStart),this.state=C.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(t){t===H.DoubleQuote?(this.state=C.InAttributeValueDq,this.sectionStart=this.index+1):t===H.SingleQuote?(this.state=C.InAttributeValueSq,this.sectionStart=this.index+1):ze(t)||(this.sectionStart=this.index,this.state=C.InAttributeValueNq,this.stateInAttributeValueNoQuotes(t))}handleInAttributeValue(t,e){t===e||!this.decodeEntities&&this.fastForwardTo(e)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(e===H.DoubleQuote?Fe.Double:Fe.Single,this.index+1),this.state=C.BeforeAttributeName):this.decodeEntities&&t===H.Amp&&this.startEntity()}stateInAttributeValueDoubleQuotes(t){this.handleInAttributeValue(t,H.DoubleQuote)}stateInAttributeValueSingleQuotes(t){this.handleInAttributeValue(t,H.SingleQuote)}stateInAttributeValueNoQuotes(t){ze(t)||t===H.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(Fe.Unquoted,this.index),this.state=C.BeforeAttributeName,this.stateBeforeAttributeName(t)):this.decodeEntities&&t===H.Amp&&this.startEntity()}stateBeforeDeclaration(t){t===H.OpeningSquareBracket?(this.state=C.CDATASequence,this.sequenceIndex=0):this.state=t===H.Dash?C.BeforeComment:C.InDeclaration}stateInDeclaration(t){(t===H.Gt||this.fastForwardTo(H.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=C.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===H.Gt||this.fastForwardTo(H.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=C.Text,this.sectionStart=this.index+1)}stateBeforeComment(t){t===H.Dash?(this.state=C.InCommentLike,this.currentSequence=Nt.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=C.InDeclaration}stateInSpecialComment(t){(t===H.Gt||this.fastForwardTo(H.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=C.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){const e=t|32;e===Nt.ScriptEnd[3]?this.startSpecial(Nt.ScriptEnd,4):e===Nt.StyleEnd[3]?this.startSpecial(Nt.StyleEnd,4):(this.state=C.InTagName,this.stateInTagName(t))}stateBeforeSpecialT(t){const e=t|32;e===Nt.TitleEnd[3]?this.startSpecial(Nt.TitleEnd,4):e===Nt.TextareaEnd[3]?this.startSpecial(Nt.TextareaEnd,4):(this.state=C.InTagName,this.stateInTagName(t))}startEntity(){this.baseState=this.state,this.state=C.InEntity,this.entityStart=this.index,this.entityDecoder.startEntity(this.xmlMode?Re.Strict:this.baseState===C.Text||this.baseState===C.InSpecialTag?Re.Legacy:Re.Attribute)}stateInEntity(){const t=this.entityDecoder.write(this.buffer,this.index-this.offset);t>=0?(this.state=this.baseState,t===0&&(this.index=this.entityStart)):this.index=this.offset+this.buffer.length-1}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===C.Text||this.state===C.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===C.InAttributeValueDq||this.state===C.InAttributeValueSq||this.state===C.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const t=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case C.Text:{this.stateText(t);break}case C.SpecialStartSequence:{this.stateSpecialStartSequence(t);break}case C.InSpecialTag:{this.stateInSpecialTag(t);break}case C.CDATASequence:{this.stateCDATASequence(t);break}case C.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(t);break}case C.InAttributeName:{this.stateInAttributeName(t);break}case C.InCommentLike:{this.stateInCommentLike(t);break}case C.InSpecialComment:{this.stateInSpecialComment(t);break}case C.BeforeAttributeName:{this.stateBeforeAttributeName(t);break}case C.InTagName:{this.stateInTagName(t);break}case C.InClosingTagName:{this.stateInClosingTagName(t);break}case C.BeforeTagName:{this.stateBeforeTagName(t);break}case C.AfterAttributeName:{this.stateAfterAttributeName(t);break}case C.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(t);break}case C.BeforeAttributeValue:{this.stateBeforeAttributeValue(t);break}case C.BeforeClosingTagName:{this.stateBeforeClosingTagName(t);break}case C.AfterClosingTagName:{this.stateAfterClosingTagName(t);break}case C.BeforeSpecialS:{this.stateBeforeSpecialS(t);break}case C.BeforeSpecialT:{this.stateBeforeSpecialT(t);break}case C.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(t);break}case C.InSelfClosingTag:{this.stateInSelfClosingTag(t);break}case C.InDeclaration:{this.stateInDeclaration(t);break}case C.BeforeDeclaration:{this.stateBeforeDeclaration(t);break}case C.BeforeComment:{this.stateBeforeComment(t);break}case C.InProcessingInstruction:{this.stateInProcessingInstruction(t);break}case C.InEntity:{this.stateInEntity();break}}this.index++}this.cleanup()}finish(){this.state===C.InEntity&&(this.entityDecoder.end(),this.state=this.baseState),this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length+this.offset;this.sectionStart>=t||(this.state===C.InCommentLike?this.currentSequence===Nt.CdataEnd?this.cbs.oncdata(this.sectionStart,t,0):this.cbs.oncomment(this.sectionStart,t,0):this.state===C.InTagName||this.state===C.BeforeAttributeName||this.state===C.BeforeAttributeValue||this.state===C.AfterAttributeName||this.state===C.InAttributeName||this.state===C.InAttributeValueSq||this.state===C.InAttributeValueDq||this.state===C.InAttributeValueNq||this.state===C.InClosingTagName||this.cbs.ontext(this.sectionStart,t))}emitCodePoint(t,e){this.baseState!==C.Text&&this.baseState!==C.InSpecialTag?(this.sectionStart<this.entityStart&&this.cbs.onattribdata(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+e,this.index=this.sectionStart-1,this.cbs.onattribentity(t)):(this.sectionStart<this.entityStart&&this.cbs.ontext(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+e,this.index=this.sectionStart-1,this.cbs.ontextentity(t,this.sectionStart))}}const Js=new Set(["input","option","optgroup","select","button","datalist","textarea"]),_t=new Set(["p"]),Nc=new Set(["thead","tbody"]),Dc=new Set(["dd","dt"]),Uc=new Set(["rt","rp"]),uf=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",_t],["h1",_t],["h2",_t],["h3",_t],["h4",_t],["h5",_t],["h6",_t],["select",Js],["input",Js],["output",Js],["button",Js],["datalist",Js],["textarea",Js],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",Dc],["dt",Dc],["address",_t],["article",_t],["aside",_t],["blockquote",_t],["details",_t],["div",_t],["dl",_t],["fieldset",_t],["figcaption",_t],["figure",_t],["footer",_t],["form",_t],["header",_t],["hr",_t],["main",_t],["nav",_t],["ol",_t],["pre",_t],["section",_t],["table",_t],["ul",_t],["rt",Uc],["rp",Uc],["tbody",Nc],["tfoot",Nc]]),lf=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),Yc=new Set(["math","svg"]),Xc=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),hf=/\s|\//;class df{constructor(t,e={}){var i,r,n,a,o,c;this.options=e,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=t??{},this.htmlMode=!this.options.xmlMode,this.lowerCaseTagNames=(i=e.lowerCaseTags)!==null&&i!==void 0?i:this.htmlMode,this.lowerCaseAttributeNames=(r=e.lowerCaseAttributeNames)!==null&&r!==void 0?r:this.htmlMode,this.recognizeSelfClosing=(n=e.recognizeSelfClosing)!==null&&n!==void 0?n:!this.htmlMode,this.tokenizer=new((a=e.Tokenizer)!==null&&a!==void 0?a:cf)(this.options,this),this.foreignContext=[!this.htmlMode],(c=(o=this.cbs).onparserinit)===null||c===void 0||c.call(o,this)}ontext(t,e){var i,r;const n=this.getSlice(t,e);this.endIndex=e-1,(r=(i=this.cbs).ontext)===null||r===void 0||r.call(i,n),this.startIndex=e}ontextentity(t,e){var i,r;this.endIndex=e-1,(r=(i=this.cbs).ontext)===null||r===void 0||r.call(i,eo(t)),this.startIndex=e}isVoidElement(t){return this.htmlMode&&lf.has(t)}onopentagname(t,e){this.endIndex=e;let i=this.getSlice(t,e);this.lowerCaseTagNames&&(i=i.toLowerCase()),this.emitOpenTag(i)}emitOpenTag(t){var e,i,r,n;this.openTagStart=this.startIndex,this.tagname=t;const a=this.htmlMode&&uf.get(t);if(a)for(;this.stack.length>0&&a.has(this.stack[0]);){const o=this.stack.shift();(i=(e=this.cbs).onclosetag)===null||i===void 0||i.call(e,o,!0)}this.isVoidElement(t)||(this.stack.unshift(t),this.htmlMode&&(Yc.has(t)?this.foreignContext.unshift(!0):Xc.has(t)&&this.foreignContext.unshift(!1))),(n=(r=this.cbs).onopentagname)===null||n===void 0||n.call(r,t),this.cbs.onopentag&&(this.attribs={})}endOpenTag(t){var e,i;this.startIndex=this.openTagStart,this.attribs&&((i=(e=this.cbs).onopentag)===null||i===void 0||i.call(e,this.tagname,this.attribs,t),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(t){this.endIndex=t,this.endOpenTag(!1),this.startIndex=t+1}onclosetag(t,e){var i,r,n,a,o,c,u,l;this.endIndex=e;let h=this.getSlice(t,e);if(this.lowerCaseTagNames&&(h=h.toLowerCase()),this.htmlMode&&(Yc.has(h)||Xc.has(h))&&this.foreignContext.shift(),this.isVoidElement(h))this.htmlMode&&h==="br"&&((a=(n=this.cbs).onopentagname)===null||a===void 0||a.call(n,"br"),(c=(o=this.cbs).onopentag)===null||c===void 0||c.call(o,"br",{},!0),(l=(u=this.cbs).onclosetag)===null||l===void 0||l.call(u,"br",!1));else{const $=this.stack.indexOf(h);if($!==-1)for(let _=0;_<=$;_++){const g=this.stack.shift();(r=(i=this.cbs).onclosetag)===null||r===void 0||r.call(i,g,_!==$)}else this.htmlMode&&h==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=e+1}onselfclosingtag(t){this.endIndex=t,this.recognizeSelfClosing||this.foreignContext[0]?(this.closeCurrentTag(!1),this.startIndex=t+1):this.onopentagend(t)}closeCurrentTag(t){var e,i;const r=this.tagname;this.endOpenTag(t),this.stack[0]===r&&((i=(e=this.cbs).onclosetag)===null||i===void 0||i.call(e,r,!t),this.stack.shift())}onattribname(t,e){this.startIndex=t;const i=this.getSlice(t,e);this.attribname=this.lowerCaseAttributeNames?i.toLowerCase():i}onattribdata(t,e){this.attribvalue+=this.getSlice(t,e)}onattribentity(t){this.attribvalue+=eo(t)}onattribend(t,e){var i,r;this.endIndex=e,(r=(i=this.cbs).onattribute)===null||r===void 0||r.call(i,this.attribname,this.attribvalue,t===Fe.Double?'"':t===Fe.Single?"'":t===Fe.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(t){const e=t.search(hf);let i=e<0?t:t.substr(0,e);return this.lowerCaseTagNames&&(i=i.toLowerCase()),i}ondeclaration(t,e){this.endIndex=e;const i=this.getSlice(t,e);if(this.cbs.onprocessinginstruction){const r=this.getInstructionName(i);this.cbs.onprocessinginstruction(`!${r}`,`!${i}`)}this.startIndex=e+1}onprocessinginstruction(t,e){this.endIndex=e;const i=this.getSlice(t,e);if(this.cbs.onprocessinginstruction){const r=this.getInstructionName(i);this.cbs.onprocessinginstruction(`?${r}`,`?${i}`)}this.startIndex=e+1}oncomment(t,e,i){var r,n,a,o;this.endIndex=e,(n=(r=this.cbs).oncomment)===null||n===void 0||n.call(r,this.getSlice(t,e-i)),(o=(a=this.cbs).oncommentend)===null||o===void 0||o.call(a),this.startIndex=e+1}oncdata(t,e,i){var r,n,a,o,c,u,l,h,$,_;this.endIndex=e;const g=this.getSlice(t,e-i);!this.htmlMode||this.options.recognizeCDATA?((n=(r=this.cbs).oncdatastart)===null||n===void 0||n.call(r),(o=(a=this.cbs).ontext)===null||o===void 0||o.call(a,g),(u=(c=this.cbs).oncdataend)===null||u===void 0||u.call(c)):((h=(l=this.cbs).oncomment)===null||h===void 0||h.call(l,`[CDATA[${g}]]`),(_=($=this.cbs).oncommentend)===null||_===void 0||_.call($)),this.startIndex=e+1}onend(){var t,e;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let i=0;i<this.stack.length;i++)this.cbs.onclosetag(this.stack[i],!0)}(e=(t=this.cbs).onend)===null||e===void 0||e.call(t)}reset(){var t,e,i,r;(e=(t=this.cbs).onreset)===null||e===void 0||e.call(t),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(r=(i=this.cbs).onparserinit)===null||r===void 0||r.call(i,this),this.buffers.length=0,this.foreignContext.length=0,this.foreignContext.unshift(!this.htmlMode),this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(t){this.reset(),this.end(t)}getSlice(t,e){for(;t-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let i=this.buffers[0].slice(t-this.bufferOffset,e-this.bufferOffset);for(;e-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),i+=this.buffers[0].slice(0,e-this.bufferOffset);return i}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(t){var e,i;if(this.ended){(i=(e=this.cbs).onerror)===null||i===void 0||i.call(e,new Error(".write() after done!"));return}this.buffers.push(t),this.tokenizer.running&&(this.tokenizer.write(t),this.writeIndex++)}end(t){var e,i;if(this.ended){(i=(e=this.cbs).onerror)===null||i===void 0||i.call(e,new Error(".end() after done!"));return}t&&this.write(t),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(t){this.write(t)}done(t){this.end(t)}}var ht;(function(s){s.Root="root",s.Text="text",s.Directive="directive",s.Comment="comment",s.Script="script",s.Style="style",s.Tag="tag",s.CDATA="cdata",s.Doctype="doctype"})(ht||(ht={}));function $f(s){return s.type===ht.Tag||s.type===ht.Script||s.type===ht.Style}ht.Root;ht.Text;ht.Directive;ht.Comment;ht.Script;ht.Style;ht.Tag;ht.CDATA;ht.Doctype;class Ll{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(t){this.parent=t}get previousSibling(){return this.prev}set previousSibling(t){this.prev=t}get nextSibling(){return this.next}set nextSibling(t){this.next=t}cloneNode(t=!1){return Fl(this,t)}}class Co extends Ll{constructor(t){super(),this.data=t}get nodeValue(){return this.data}set nodeValue(t){this.data=t}}class io extends Co{constructor(){super(...arguments),this.type=ht.Text}get nodeType(){return 3}}class Cl extends Co{constructor(){super(...arguments),this.type=ht.Comment}get nodeType(){return 8}}class Ol extends Co{constructor(t,e){super(e),this.name=t,this.type=ht.Directive}get nodeType(){return 1}}class Oo extends Ll{constructor(t){super(),this.children=t}get firstChild(){var t;return(t=this.children[0])!==null&&t!==void 0?t:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(t){this.children=t}}class Bl extends Oo{constructor(){super(...arguments),this.type=ht.CDATA}get nodeType(){return 4}}class ro extends Oo{constructor(){super(...arguments),this.type=ht.Root}get nodeType(){return 9}}class Rl extends Oo{constructor(t,e,i=[],r=t==="script"?ht.Script:t==="style"?ht.Style:ht.Tag){super(i),this.name=t,this.attribs=e,this.type=r}get nodeType(){return 1}get tagName(){return this.name}set tagName(t){this.name=t}get attributes(){return Object.keys(this.attribs).map(t=>{var e,i;return{name:t,value:this.attribs[t],namespace:(e=this["x-attribsNamespace"])===null||e===void 0?void 0:e[t],prefix:(i=this["x-attribsPrefix"])===null||i===void 0?void 0:i[t]}})}}function _f(s){return $f(s)}function ff(s){return s.type===ht.CDATA}function gf(s){return s.type===ht.Text}function mf(s){return s.type===ht.Comment}function pf(s){return s.type===ht.Directive}function bf(s){return s.type===ht.Root}function Fl(s,t=!1){let e;if(gf(s))e=new io(s.data);else if(mf(s))e=new Cl(s.data);else if(_f(s)){const i=t?Pa(s.children):[],r=new Rl(s.name,{...s.attribs},i);i.forEach(n=>n.parent=r),s.namespace!=null&&(r.namespace=s.namespace),s["x-attribsNamespace"]&&(r["x-attribsNamespace"]={...s["x-attribsNamespace"]}),s["x-attribsPrefix"]&&(r["x-attribsPrefix"]={...s["x-attribsPrefix"]}),e=r}else if(ff(s)){const i=t?Pa(s.children):[],r=new Bl(i);i.forEach(n=>n.parent=r),e=r}else if(bf(s)){const i=t?Pa(s.children):[],r=new ro(i);i.forEach(n=>n.parent=r),s["x-mode"]&&(r["x-mode"]=s["x-mode"]),e=r}else if(pf(s)){const i=new Ol(s.name,s.data);s["x-name"]!=null&&(i["x-name"]=s["x-name"],i["x-publicId"]=s["x-publicId"],i["x-systemId"]=s["x-systemId"]),e=i}else throw new Error(`Not implemented yet: ${s.type}`);return e.startIndex=s.startIndex,e.endIndex=s.endIndex,s.sourceCodeLocation!=null&&(e.sourceCodeLocation=s.sourceCodeLocation),e}function Pa(s){const t=s.map(e=>Fl(e,!0));for(let e=1;e<t.length;e++)t[e].prev=t[e-1],t[e-1].next=t[e];return t}const Wc={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class xf{constructor(t,e,i){this.dom=[],this.root=new ro(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof e=="function"&&(i=e,e=Wc),typeof t=="object"&&(e=t,t=void 0),this.callback=t??null,this.options=e??Wc,this.elementCB=i??null}onparserinit(t){this.parser=t}onreset(){this.dom=[],this.root=new ro(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(t){this.handleCallback(t)}onclosetag(){this.lastNode=null;const t=this.tagStack.pop();this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(t)}onopentag(t,e){const i=this.options.xmlMode?ht.Tag:void 0,r=new Rl(t,e,void 0,i);this.addNode(r),this.tagStack.push(r)}ontext(t){const{lastNode:e}=this;if(e&&e.type===ht.Text)e.data+=t,this.options.withEndIndices&&(e.endIndex=this.parser.endIndex);else{const i=new io(t);this.addNode(i),this.lastNode=i}}oncomment(t){if(this.lastNode&&this.lastNode.type===ht.Comment){this.lastNode.data+=t;return}const e=new Cl(t);this.addNode(e),this.lastNode=e}oncommentend(){this.lastNode=null}oncdatastart(){const t=new io(""),e=new Bl([t]);this.addNode(e),t.parent=e,this.lastNode=t}oncdataend(){this.lastNode=null}onprocessinginstruction(t,e){const i=new Ol(t,e);this.addNode(i)}handleCallback(t){if(typeof this.callback=="function")this.callback(t,this.dom);else if(t)throw t}addNode(t){const e=this.tagStack[this.tagStack.length-1],i=e.children[e.children.length-1];this.options.withStartIndices&&(t.startIndex=this.parser.startIndex),this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),e.children.push(t),i&&(t.prev=i,i.next=t),t.parent=e,this.lastNode=null}}function yf(s,t){const e=new xf(void 0,t);return new df(e,t).end(s),e.root}class Pl{constructor(){this._$textWidth=-1,this._$textHeight=-1,this._$widthTable=[],this._$heightTable=[],this._$ascentTable=[],this._$textTable=[],this._$lineTable=[]}get textWidth(){if(this._$textWidth===-1){this._$textWidth=0;for(let t=0;t<this._$widthTable.length;++t)this._$textWidth=Math.max(this._$textWidth,this._$widthTable[t])}return this._$textWidth}get textHeight(){if(this._$textHeight===-1){this._$textHeight=0;for(let t=0;t<this._$heightTable.length;++t)this._$textHeight+=this._$heightTable[t]}return this._$textHeight}getLineWidth(t){return t in this._$widthTable?this._$widthTable[t]:0}getLineHeight(t){return t in this._$heightTable?this._$heightTable[t]:0}get widthTable(){return this._$widthTable}get heightTable(){return this._$heightTable}get ascentTable(){return this._$ascentTable}get textTable(){return this._$textTable}get lineTable(){return this._$lineTable}}const Cn=new OffscreenCanvas(1,1).getContext("2d");let as=0;const kl=(s,t,e,i)=>{let r=e.lineTable.length-1;const n=i.width-t._$widthMargin()-4;for(let a=0;a<s.length;++a){const o=i.textFormats===null?t:i.textFormats.shift(),c=s[a],u={mode:"text",text:c,x:0,y:0,w:0,h:0,line:r,textFormat:o._$clone()};Cn.font=o._$generateFontStyle();const l=Cn.measureText(c||"");let h=l.width;o.letterSpacing&&(h+=o.letterSpacing);let $=l.fontBoundingBoxAscent+l.fontBoundingBoxDescent;if(o.leading&&($+=o.leading),u.x=0,u.y=l.fontBoundingBoxAscent,u.w=h,u.h=$,as+=h,i.wordWrap&&as>n){as=h,r++,u.line=r;const _={mode:"wrap",text:"",x:0,y:0,w:0,h:0,line:r,textFormat:o._$clone()};let g=1,f=!0;const m=/[0-9a-zA-Z?!;:.,]/g;for(;;){const p=e.textTable.length-g;if(0>=p){f=!1,g=0;break}const x=e.textTable[p];if(!x){f=!1,g=0;break}if(x.mode!=="text"){f=!1;break}if(x.text===" "){g--;break}if(!x.text.match(m)){g--;break}g++}if(e.widthTable[r]=0,e.heightTable[r]=0,e.ascentTable[r]=0,g>0&&f){const p=e.textTable.length-g;e.textTable.splice(p,0,_),e.lineTable.push(_);const x=r-1;e.widthTable[x]=0,e.heightTable[x]=0,e.ascentTable[x]=0;for(let b=0;b<p;++b){const T=e.textTable[b];T.line===x&&T.mode==="text"&&(e.widthTable[x]+=T.w,e.heightTable[x]=Math.max(e.heightTable[x],T.h),e.ascentTable[x]=Math.max(e.ascentTable[x],T.y))}as=0;for(let b=p+1;b<e.textTable.length;++b){const T=e.textTable[b];T.line=r,as+=T.w}}else e.textTable.push(_),e.lineTable.push(_)}e.widthTable[r]=as,e.heightTable[r]=Math.max(e.heightTable[r],$),e.ascentTable[r]=Math.max(e.ascentTable[r],u.y),e.textTable.push(u)}},Ef=(s,t,e)=>{const i=s.trim().split(";"),r=[];for(let n=0;n<i.length;++n){const a=i[n];if(!a)continue;const o=a.split(":"),c=o[0].trim(),u=o[1].trim();switch(c){case"font-size":r.push({name:"size",value:parseFloat(u)});break;case"font-family":r.push({name:"face",value:u.replace(/'|"/g,"")});break;case"letter-spacing":r.push({name:"letterSpacing",value:u});break;case"margin-bottom":r.push({name:"leading",value:parseFloat(u)});break;case"margin-left":r.push({name:"leftMargin",value:parseFloat(u)});break;case"margin-right":r.push({name:"rightMargin",value:parseFloat(u)});break;case"color":case"align":r.push({name:c,value:u});break;case"text-decoration":case"font-weight":case"font-style":r.push({name:u,value:!0});break}}no(r,t,e)},no=(s,t,e)=>{for(let i=0;i<s.length;++i){const r=s[i];switch(r.name){case"style":Ef(r.value,t,e);break;case"align":t.align=r.value;break;case"face":t.font=r.value;break;case"size":t.size=+r.value,e.subFontSize&&(t.size-=e.subFontSize,1>t.size&&(t.size=1));break;case"color":t.color=It(r.value);break;case"letterSpacing":t.letterSpacing=+r.value;break;case"leading":t.leading=+r.value;break;case"leftMargin":t.leftMargin=+r.value;break;case"rightMargin":t.rightMargin=+r.value;break;case"underline":t.underline=!0;break;case"bold":t.bold=!0;break;case"italic":t.italic=!0;break}}},ar=(s,t)=>{as=0;const e=s.lineTable.length;Cn.font=t._$generateFontStyle();const i=Cn.measureText(""),r={mode:"break",text:"",x:0,y:0,w:0,h:i.fontBoundingBoxAscent+i.fontBoundingBoxDescent,line:e,textFormat:t._$clone()};s.heightTable[e]=0,s.ascentTable[e]=0,s.widthTable[e]=0,s.lineTable.push(r),s.textTable.push(r)},ao=(s,t,e,i)=>{for(let r=0;r<s.children.length;++r){const n=s.children[r];if(n.nodeType===3){kl(n.nodeValue||"",t,e,i);continue}const a=t._$clone();switch(n.name.toUpperCase()){case"DIV":case"P":no(n.attributes,a,i),i.multiline&&ar(e,a),ao(n,a,e,i),i.multiline&&ar(e,a);continue;case"U":a.underline=!0;break;case"B":a.bold=!0;break;case"I":a.italic=!0;break;case"FONT":case"SPAN":no(n.attributes,a,i);break;case"BR":if(!i.multiline)continue;ar(e,a);break}ao(n,a,e,i)}},Nl=s=>{const t=s.heightTable.length-1;for(let e=1;e<t;++e){if(s.heightTable[e]>0)continue;const r=s.lineTable[e];s.heightTable[e]=r.h=s.heightTable[e-1]}},Tf=(s,t,e)=>{const i=new Pl;if(!s)return i;const r=e.multiline?s.split(`
`):[s.replace(`
`,"")];for(let n=0;n<r.length;++n){let a=t._$clone();e.textFormats&&(a=n===0?e.textFormats[0]:e.textFormats.shift()),e.subFontSize&&e.subFontSize>0&&a.size&&(a.size-=e.subFontSize,1>a.size&&(a.size=1)),(n===0||e.wordWrap||e.multiline)&&ar(i,a);const o=r[n];o&&(as=0,kl(o,a,i,e))}return Nl(i),i},vf=(s,t,e)=>{const i=new Pl;if(!s)return i;const r=s.trim().replace(/\r?\n/g,"").replace(/\t/g,""),n=t._$clone();e.subFontSize&&e.subFontSize>0&&n.size&&(n.size-=e.subFontSize,1>n.size&&(n.size=1));const a=yf(r);return ar(i,n),ao(a,n,i,e),Nl(i),i};class oo extends nr{constructor(){super(),this._$background=!1,this._$backgroundColor=16777215,this._$border=!1,this._$borderColor=0,this._$htmlText="",this._$multiline=!1,this._$text="",this._$wordWrap=!1,this._$scrollX=0,this._$scrollY=0,this._$maxChars=0,this._$stopIndex=-1,this._$compositionStartIndex=-1,this._$compositionEndIndex=-1;const t=new ia;t._$setDefault(),this._$defaultTextFormat=t,this._$rawHtmlText="",this._$bounds={xMin:0,xMax:100,yMin:0,yMax:100},this._$originBounds={xMin:0,xMax:100,yMin:0,yMax:100},this._$restrict="",this._$isHTML=!1,this._$textData=null,this._$autoSize="none",this._$autoFontSize=!1,this._$focusVisible=!1,this._$timerId=-1,this._$focusIndex=-1,this._$selectIndex=-1,this._$scrollEnabled=!0,this._$xScrollShape=null,this._$yScrollShape=null,this._$type="static",this._$focus=!1,this._$copyText="",this._$thickness=0,this._$thicknessColor=0,this._$textFormats=null,this._$cacheKeys=A(),this._$cacheParams=A(0,0,0)}static toString(){return"[class TextField]"}static get namespace(){return"next2d.display.TextField"}toString(){return"[object TextField]"}get namespace(){return"next2d.display.TextField"}get autoFontSize(){return this._$autoFontSize}set autoFontSize(t){t!==this._$autoFontSize&&(this._$autoFontSize=t,this._$reload())}get autoSize(){return this._$autoSize}set autoSize(t){t!==this._$autoSize&&(this._$autoSize=t,this._$reload())}get background(){return this._$background}set background(t){t!==this._$background&&(this._$background=!!t,this._$reset())}get backgroundColor(){return this._$backgroundColor}set backgroundColor(t){t=O(It(t),0,16777215,16777215),t!==this._$backgroundColor&&(this._$backgroundColor=t,this._$reset())}get border(){return this._$border}set border(t){t!==this._$border&&(this._$border=!!t,this._$reset())}get borderColor(){return this._$borderColor}set borderColor(t){t=O(It(t),0,16777215,0),t!==this._$borderColor&&(this._$borderColor=t,this._$reset())}get stopIndex(){return this._$stopIndex}set stopIndex(t){if(t|=0,this._$stopIndex===t)return;this._$stopIndex=t;const e=this.getTextData();if(!e.textTable.length)return;let i=2,r=0;for(let $=0;$<e.textTable.length;++$){const _=e.textTable[$];let g=!1;if(_.mode==="text"&&(g=!0,i+=_.w),r>=t){r=$;break}_.mode==="break"&&(g=!0,this._$scrollX=0,i=2),g&&r++}const a=e.textTable[r].line;let o=0;for(let $=0;$<=a;++$)o+=e.heightTable[$];const c=this.height;let u=0;for(let $=a;$>-1;--$){const _=e.heightTable[$];if(c<u+_)break;u+=_}if(o>c){const $=(this.textHeight-c)/c;this._$scrollY=d.min((o-u)/$,c)}const l=this.width;let h=0;for(let $=r;$>0;--$){const _=e.textTable[$];if(_.mode==="text"){if(l<h+_.w)break;h+=_.w}}if(i>l){const $=(this.textWidth-l)/l;this._$scrollX=d.min((i-h)/$,l+.5)}this._$doChanged()}get defaultTextFormat(){return this._$defaultTextFormat._$clone()}set defaultTextFormat(t){t._$merge(this._$defaultTextFormat),this._$defaultTextFormat=t,this._$reset()}get focus(){return this._$focus}set focus(t){if(this._$focus===t||this._$type!=="input")return;this._$focus=!!t;const e=this._$focus?xn.FOCUS_IN:xn.FOCUS_OUT;this.willTrigger(e)&&this.dispatchEvent(new xn(e)),Ct.value="",this._$focus?Ct.focus():(this._$focusIndex=-1,this._$selectIndex=-1,this._$focusVisible=!1,qt(this._$timerId),Ct.blur()),this._$doChanged(),pt()}get htmlText(){if(this._$htmlText)return this._$htmlText;const t=this.getTextData();let e=t.textTable[0].textFormat,i="<span";const r=e._$toStyleString();r&&(i+=` style="${r}"`),i+=">";for(let n=1;n<t.textTable.length;++n){const a=t.textTable[n];if(a.mode==="wrap")continue;if(a.mode==="break"){i+="<br>";continue}const o=a.textFormat;if(!e._$isSame(o)){i+="</span><span";const c=o._$toStyleString();c&&(i+=` style="${c}"`),i+=">",e=o}a.mode==="text"&&(i+=a.text)}return i+="</span>",this._$htmlText=i,i}set htmlText(t){this._$htmlText!==t&&(this._$htmlText=`${t}`,this._$rawHtmlText="",this._$text="",this._$isHTML=!0,this._$reload())}get length(){return this.text.length}get maxChars(){return this._$maxChars}set maxChars(t){this._$maxChars=t|0}get multiline(){return this._$multiline}set multiline(t){t!==this._$multiline&&(this._$multiline=!!t,this._$reset())}get numLines(){return this.getTextData().lineTable.length}get restrict(){return this._$restrict}set restrict(t){this._$restrict=`${t}`}get scrollEnabled(){return this._$scrollEnabled}set scrollEnabled(t){this._$scrollEnabled=t}get selectIndex(){return this._$selectIndex}get scrollX(){return this._$scrollX}set scrollX(t){if(!(!this._$scrollEnabled||this._$autoSize!=="none")&&!(this._$yScrollShape&&this._$yScrollShape.hasLocalVariable("job"))&&(t=O(t,0,this.width+.5,0),this._$scrollX!==t)){const e=this.width;if(this._$xScrollShape&&this.textWidth>e){this._$doChanged(),this._$scrollX=t,this._$xScrollShape.width=e*e/this.textWidth;const i=this._$parent;if(i){this._$xScrollShape.hasLocalVariable("job")&&this._$xScrollShape.getLocalVariable("job").stop(),this._$xScrollShape.alpha=.9,this._$xScrollShape.x=this.x+1+(e-1-this._$xScrollShape.width)/(e-1)*(this._$scrollX-1),this._$xScrollShape.y=this.y+this.height-this._$xScrollShape.height-.5,i.addChildAt(this._$xScrollShape,i.getChildIndex(this)+1);const r=to.add(this._$xScrollShape,{alpha:.9},{alpha:0},.5,.2,hs.outQuad);r.addEventListener(S.COMPLETE,n=>{const a=n.target.target;a.deleteLocalVariable("job"),a.parent&&a.parent.removeChild(a)}),r.start(),this._$xScrollShape.setLocalVariable("job",r)}}this.willTrigger(S.SCROLL)&&this.dispatchEvent(new S(S.SCROLL,!0))}}get scrollY(){return this._$scrollY}set scrollY(t){if(!(!this._$scrollEnabled||this._$autoSize!=="none"||!this._$multiline&&!this._$wordWrap)&&!(this._$xScrollShape&&this._$xScrollShape.hasLocalVariable("job"))&&(t=O(t,0,this.height,0),this._$scrollY!==t)){const e=this.height;if(this._$yScrollShape&&this.textHeight>e){this._$doChanged(),this._$scrollY=t,this._$yScrollShape.height=e*e/this.textHeight;const i=this._$parent;if(i){this._$yScrollShape.hasLocalVariable("job")&&this._$yScrollShape.getLocalVariable("job").stop(),this._$yScrollShape.alpha=.9,this._$yScrollShape.x=this.x+this.width-this._$yScrollShape.width-.5,this._$yScrollShape.y=this.y+.5+(e-1-this._$yScrollShape.height)/(e-1)*(this._$scrollY-1),i.addChildAt(this._$yScrollShape,i.getChildIndex(this)+1);const r=to.add(this._$yScrollShape,{alpha:.9},{alpha:0},.5,.2,hs.outQuad);r.addEventListener(S.COMPLETE,n=>{const a=n.target.target;a.deleteLocalVariable("job"),a.parent&&a.parent.removeChild(a)}),r.start(),this._$yScrollShape.setLocalVariable("job",r)}}this.willTrigger(S.SCROLL)&&this.dispatchEvent(new S(S.SCROLL,!0))}}get text(){if(!this._$isHTML)return this._$text;if(this._$rawHtmlText)return this._$rawHtmlText;let t="";const e=this.getTextData();for(let i=1;i<e.textTable.length;++i){const r=e.textTable[i];switch(r.mode){case"text":t+=r.text;break;case"break":t+="\r";break;default:continue}}return this._$rawHtmlText=t,t}set text(t){if(t===null){this._$text="",this._$htmlText="",this._$rawHtmlText="",this._$isHTML=!1,this._$reload();return}t=`${t}`,t!==this._$text&&(this._$text=t,this._$htmlText="",this._$rawHtmlText="",this._$isHTML=!1,this._$reload())}get textColor(){return this._$defaultTextFormat.color||0}set textColor(t){this._$defaultTextFormat.color=t,this._$reload()}get textHeight(){return this.getTextData().textHeight}get textWidth(){return this.getTextData().textWidth}get thickness(){return this._$thickness}set thickness(t){t|=0,t!==this._$thickness&&(this._$thickness=t,this._$reset())}get thicknessColor(){return this._$thicknessColor}set thicknessColor(t){t=O(It(t),0,16777215,0),t!==this._$thicknessColor&&(this._$thicknessColor=t,this._$reset())}get type(){return this._$type}set type(t){this._$type=t}get wordWrap(){return this._$wordWrap}set wordWrap(t){this._$wordWrap!==t&&(this._$wordWrap=!!t,this._$reset())}get width(){return super.width}set width(t){if(t=+t,!Ie(t)&&t>-1){const e=this._$getBounds(null),i=d.abs(e.xMin);this._$originBounds.xMax=t+i,this._$originBounds.xMin=i,this._$bounds.xMax=this._$originBounds.xMax,this._$bounds.xMin=this._$originBounds.xMin,super.width=t,this._$reload()}}get height(){return super.height}set height(t){if(t=+t,!Ie(t)&&t>-1){const e=this._$getBounds(null),i=d.abs(e.yMin);this._$originBounds.yMax=t+i,this._$bounds.yMax=this._$originBounds.yMax,this._$bounds.yMin=this._$originBounds.yMin,super.height=t,this._$reload()}}get x(){const t=this._$transform.matrix,e=this._$getBounds(null);return t._$matrix[4]+e.xMin}set x(t){const e=this._$getBounds(null);super.x=t-e.xMin}get y(){const t=this._$transform.matrix,e=this._$getBounds(null);return t._$matrix[5]+e.yMin}set y(t){const e=this._$getBounds(null);super.y=t-e.yMin}appendText(t){const e=this.text;this.text=e+`${t}`}getLineText(t){if(!this._$text&&!this._$htmlText)return"";t|=0;let e="";const i=this.getTextData();for(let r=0;r<i.textTable.length;r++){const n=i.textTable[r];if(n.line>t)break;n.line===t&&n.mode==="text"&&(e+=n.text)}return e}replaceText(t,e,i){if(t|=0,e|=0,t>-1&&e>-1&&e>=t){const r=this.text;t>=r.length?e>=r.length&&e>=t&&(this.text=r+`${i}`):this.text=r.slice(0,t)+`${i}`+r.slice(e,r.length)}}getTextData(t=0){return this._$textData!==null?this._$textData:(this._$isHTML?this._$textData=vf(this._$htmlText,this._$defaultTextFormat,{width:this.width,multiline:this._$multiline,wordWrap:this._$wordWrap,subFontSize:t,textFormats:this._$textFormats}):this._$textData=Tf(this._$text,this._$defaultTextFormat,{width:this.width,multiline:this._$multiline,wordWrap:this._$wordWrap,subFontSize:t,textFormats:this._$textFormats}),this._$textData)}selectAll(){const t=this.getTextData();t.textTable.length&&(this._$selectIndex=1,this._$focusIndex=t.textTable.length)}copy(){if(this._$focusIndex===-1||this._$selectIndex===-1)return;let t="";const e=d.min(this._$focusIndex,this._$selectIndex),i=d.max(this._$focusIndex,this._$selectIndex)+1,r=this.getTextData();for(let n=e;n<i;++n){const a=r.textTable[n];if(!(!a||a.mode==="wrap"))switch(a.mode){case"text":t+=a.text;break;case"break":t+=`
`;break}}this._$copyText=t}paste(){!this._$copyText||this._$focusIndex===-1||this.insertText(this._$copyText)}arrowUp(){if(this._$focusIndex===-1)return;const t=this.getTextData();if(!t.textTable.length)return;const e=t.textTable.length===this._$focusIndex?this._$focusIndex-1:this._$focusIndex,i=t.textTable[e];if(!i.line)return;const r=i.mode==="text"?i.line:i.line-1;let n=2;for(let c=1;c<t.textTable.length;++c){const u=t.textTable[c];if(this._$focusIndex===c){u.mode==="text"&&(n+=u.w/2);break}if(u.line>r)break;u.line!==r||u.mode!=="text"||(n+=u.w)}let a=2;const o=r-1;for(let c=1;c<t.textTable.length;++c){const u=t.textTable[c];if(u.line>o){this._$focusIndex=u.mode==="text"?c-1:c,this._$selectIndex=-1,qt(this._$timerId),this._$blinking();return}if(!(u.line!==o||u.mode!=="text")&&(a+=u.w,a>n)){this._$focusIndex=c,this._$selectIndex=-1,qt(this._$timerId),this._$blinking();return}}}arrowDown(){if(this._$focusIndex===-1)return;const t=this.getTextData();if(!t.textTable.length)return;const e=t.textTable[this._$focusIndex],i=e.mode==="text"?e.line:e.line-1;if(i===t.lineTable.length-1)return;let r=2;for(let o=1;o<t.textTable.length;++o){const c=t.textTable[o];if(this._$focusIndex===o){c.mode==="text"&&(r+=c.w/2);break}if(c.line>i)break;c.line!==i||c.mode!=="text"||(r+=c.w)}let n=2;const a=i+1;for(let o=1;o<t.textTable.length;++o){const c=t.textTable[o];if(c.line>a){this._$focusIndex=c.mode==="text"?o-1:o,this._$selectIndex=-1,qt(this._$timerId),this._$blinking();return}if(!(c.line!==a||c.mode!=="text")&&(n+=c.w,n>r)){this._$focusIndex=o,this._$selectIndex=-1,qt(this._$timerId),this._$blinking();return}}this._$focusIndex=t.textTable.length,this._$selectIndex=-1,qt(this._$timerId),this._$blinking()}arrowLeft(){if(!this._$focusIndex)return;if(this.getTextData().textTable.length&&this._$focusIndex<2){this._$focusIndex=1;return}this._$focusIndex--,this._$selectIndex=-1,qt(this._$timerId),this._$blinking()}arrowRight(){this.getTextData().textTable.length!==this._$focusIndex&&(this._$focusIndex++,this._$selectIndex=-1,qt(this._$timerId),this._$blinking())}deleteText(){if(this._$compositionStartIndex>-1)return;let t=0,e=0;if(this._$selectIndex>-1)t=d.min(this._$focusIndex,this._$selectIndex),e=d.max(this._$focusIndex,this._$selectIndex)+1,this._$focusIndex=t;else{if(2>this._$focusIndex)return;this._$focusIndex--}const i=this.getTextData(),r=i.textTable[this._$focusIndex];r&&r.mode==="wrap"&&this._$focusIndex--;const n=A();let a="";for(let o=1;o<i.textTable.length;++o){const c=i.textTable[o];if(!(this._$focusIndex===o||t<=o&&e>o))switch(c.mode){case"break":n.push(c.textFormat),a+=`
`;break;case"text":n.push(c.textFormat),a+=c.text;break;default:continue}}if(i.textTable.length===this._$focusIndex&&(n.pop(),a=a.slice(0,-1)),this._$selectIndex=-1,!a)this.text=null,this._$scrollX=0,this._$scrollY=0,this._$focusIndex=0;else{const o=this.textWidth,c=this.textHeight;if(this._$textFormats=n,this.text=a,this._$scrollX>0){const u=this.textWidth,l=this.width;switch(!0){case l>u:this._$scrollY=0;break;case o!==u:this._$scrollY-=(o-u)/(u/l);break}}if(this._$scrollY>0){const u=this.textHeight,l=this.height;switch(!0){case l>u:this._$scrollY=0;break;case c!==u:this._$scrollY-=(c-u)/(u/l);break}}this._$textFormats=null,V(n)}}compositionStart(){this._$compositionStartIndex=this._$focusIndex}compositionUpdate(t){if(this._$compositionEndIndex>-1){const l=this._$compositionStartIndex;this._$focusIndex=this._$compositionStartIndex,this._$selectIndex=this._$compositionEndIndex-1,this._$compositionStartIndex=-1,this.deleteText(),this._$compositionStartIndex=l,this._$selectIndex=-1}let e=this.getTextData();const i=A(),r=t.length;let n="";if(!e.textTable.length)n=t,this._$focusIndex=1,this._$compositionStartIndex=1;else{for(let l=1;l<e.textTable.length;++l){const h=e.textTable[l];if(this._$compositionStartIndex===l)for(let $=0;$<r;++$)i.push(h.textFormat._$clone()),n+=t[$];switch(h.mode){case"break":i.push(h.textFormat),n+=`
`;break;case"text":i.push(h.textFormat),n+=h.text;break;default:continue}}if(this._$compositionStartIndex===e.textTable.length){const l=e.textTable[this._$compositionStartIndex-1];for(let h=0;h<r;++h)i.push(l.textFormat._$clone()),n+=t[h]}}i.length&&(this._$textFormats=i),this.text=n,this._$textFormats=null,V(i),e=this.getTextData();let a=this._$compositionStartIndex+r;for(let l=this._$compositionStartIndex;l<a;++l){const h=e.textTable[l];if(!h)break;if(h.textFormat.underline=!0,h.mode==="wrap"){if(l===this._$compositionStartIndex){let $=1;for(;;){const _=e.textTable[l-$];if(!_)break;if(_.mode==="text"){_.textFormat.underline=!0;break}$++}}l>this._$compositionStartIndex&&a++}}this._$compositionEndIndex=this._$focusIndex=a;const o=nt(),c=d.min(e.textTable.length-1,this._$compositionEndIndex),u=e.textTable[c];if(u){const l=u.line;let h=0;for(let y=0;y<l;++y)h+=e.heightTable[y];const $=e.ascentTable[l];let _=0,g=this._$compositionEndIndex;for(;;){const y=e.textTable[g--];if(!y||y.line!==l)break;_+=y.w}const f=e.lineTable[l],m=this._$getAlignOffset(f,this.width),p=this.localToGlobal(new Mt(_+m+o.tx,h+$+o.ty)),x=Dt.getElementById(o.contentElementId);let b=p.x*o._$scale,T=p.y*o._$scale;if(x){const y=x.getBoundingClientRect();b+=y.left,T+=y.top}Ct.style.left=`${b}px`,Ct.style.top=`${T}px`}}compositionEnd(){if(this._$compositionEndIndex>-1){const t=this.getTextData();for(let e=this._$compositionStartIndex;e<this._$compositionEndIndex;++e){const i=t.textTable[e];i.textFormat.underline=!1}this._$focusIndex=this._$compositionEndIndex}Ct.blur(),Ct.value="",this._$focus&&Ct.focus(),this._$selectIndex=-1,this._$compositionStartIndex=-1,this._$compositionEndIndex=-1}insertText(t){if(this._$focusIndex===-1||this._$compositionStartIndex>-1)return;this._$selectIndex>-1&&this.deleteText();const e=this.getTextData(),i=A();let r="";for(let n=1;n<e.textTable.length;++n){const a=e.textTable[n];if(this._$focusIndex===n)for(let o=0;o<t.length;++o)i.push(a.textFormat),r+=t[o];switch(a.mode){case"break":i.push(a.textFormat),r+=`
`;break;case"text":i.push(a.textFormat),r+=a.text;break;default:continue}}if(e.textTable.length===this._$focusIndex){let n;e.textTable.length?n=e.textTable[e.textTable.length-1].textFormat._$clone():(n=this.defaultTextFormat,this._$focusIndex++);for(let a=0;a<t.length;++a)i.push(n._$clone()),r+=t[a]}this._$textFormats=i,this.text=r,this._$textFormats=null,V(i),this._$focusIndex+=t.length,this._$selectIndex=-1,Ct.value=""}_$reset(){this._$textData=null,this._$doChanged(),pt(),J.removeCache(this._$instanceId)}_$reload(){if(this._$reset(),this.getTextData(),this._$autoSize==="none"&&this._$autoFontSize){let t=0;const e=this.getTextData();for(let r=0;r<e.textTable.length;++r){const n=e.textTable[r];t=d.max(t,n.textFormat.size||0)}let i=1;if(this.width&&this.textWidth)for(;t>i&&this.textWidth+4>this.width;)this._$reset(),this.getTextData(i++);if(this.height&&this.textHeight)for(;t>i&&this.textHeight+4>this.height;)this._$reset(),this.getTextData(i++)}this._$resize()}_$blinking(){this._$focusVisible=!this._$focusVisible,this._$doChanged(),pt(),this._$timerId=+_r(()=>{this._$blinking()},500),this._$timerId|=0}_$setIndex(t,e){if(this._$type!=="input")return;const i=this.getTextData();if(!i.textTable.length){this._$focusIndex=0,this._$selectIndex=-1,this.setBlinkingTimer();return}const r=this.width,n=this.height;let a=0;this._$scrollX>0&&(a+=this._$scrollX*(this.textWidth-r)/r);let o=0;this._$scrollY&&(o+=this._$scrollY*(this.textHeight-n)/n);const c=Qu(),u=this.globalToLocal(new Mt(t,e)),l=u.x+a,h=u.y+o;let $=2,_=2,g=_+i.heightTable[0];for(let f=1;f<i.textTable.length;++f){const m=i.textTable[f];switch(m.mode){case"break":case"wrap":if(l>$&&h>_&&g>h&&r>l){const p=f;switch(c){case Se:case je:this._$selectIndex!==p&&this._$focusIndex===p&&(this._$selectIndex=p,this._$focusIndex!==p&&(this._$focusVisible=!1,qt(this._$timerId),this._$doChanged(),pt()));break;default:(this._$focusIndex!==p||this._$selectIndex>-1)&&(this._$focusIndex=p,this._$selectIndex=-1,this.setBlinkingTimer());break}return}$=2,_+=i.heightTable[m.line-1],g=_+i.heightTable[m.line];break;case"text":if(f===i.textTable.length-1&&l>$&&h>_&&g>h&&r>l){const p=i.textTable.length;switch(c){case Se:case je:this._$selectIndex!==p&&(this._$selectIndex=p,this._$focusIndex!==p&&(this._$focusVisible=!1,qt(this._$timerId),this._$doChanged(),pt()));break;default:(this._$focusIndex!==p||this._$selectIndex>-1)&&(this._$focusIndex=p,this._$selectIndex=-1,this.setBlinkingTimer());break}return}if(l>$&&h>_&&g>h&&$+m.w>l){let p=f;switch(c){case Se:case je:this._$focusIndex>p?this._$focusIndex===p+1?$+m.w/2<l&&(p=-1):$+m.w/2<l&&(p+=1):this._$focusIndex===p?$+m.w/2>l&&(p=-1):$+m.w/2>l&&(p-=1),this._$selectIndex!==p&&(this._$selectIndex=p,this._$selectIndex>-1&&(this._$focusVisible=!1,qt(this._$timerId)),this._$doChanged(),pt());break;default:if($+m.w/2<l){const x=i.textTable[p+1];(!x||x.mode==="text")&&(p+=1)}(this._$focusIndex!==p||this._$selectIndex>-1)&&(this._$focusIndex=p,this._$selectIndex=-1,this.setBlinkingTimer());break}return}$+=m.w;break}}switch(c){case Se:case je:this._$focusIndex=-1,this._$selectIndex=-1;break;default:this._$focusIndex=i.textTable.length,this._$selectIndex=-1,this.setBlinkingTimer();break}}setBlinkingTimer(){this._$focusVisible=!1,this._$doChanged(),pt(),qt(this._$timerId),this._$timerId=+_r(()=>{this._$blinking()},500),this._$timerId|=0}_$resize(){if(this._$autoSize!=="none"){const t=this._$defaultTextFormat,e=this.textWidth+4+t._$widthMargin();if(this._$wordWrap)this._$bounds.xMax=this._$originBounds.xMax,this._$bounds.xMin=this._$originBounds.xMin;else switch(this._$autoSize){case"left":this._$bounds.xMax=e+this._$bounds.xMin;break;case"center":this._$bounds.xMax=e+this._$bounds.xMin;break;case"right":this._$bounds.xMax=this._$originBounds.xMax-(this._$originBounds.xMax-this._$originBounds.xMin-(e-this._$originBounds.xMin));break}this._$bounds.yMax=this.textHeight+this._$originBounds.yMin+4}else this._$scrollEnabled&&(this._$xScrollShape||(this._$xScrollShape=new gr,this._$xScrollShape.graphics.beginFill("#000",.3).drawRoundRect(0,0,3,3,3),this._$xScrollShape.scale9Grid=new ue(1.5,1.5,.1,.1)),this._$yScrollShape||(this._$yScrollShape=new gr,this._$yScrollShape.graphics.beginFill("#000",.3).drawRoundRect(0,0,3,3,3),this._$yScrollShape.scale9Grid=new ue(1.5,1.5,.1,.1)))}_$getAlignOffset(t,e){const i=this.getTextData().getLineWidth(t.line),r=t.textFormat,n=r.leftMargin||0;if(!this._$wordWrap&&i>e)return d.max(0,n);const a=r.rightMargin||0;return r.align==="center"||this._$autoSize==="center"?d.max(0,e/2-n-a-i/2-2):r.align==="right"||this._$autoSize==="right"?d.max(0,e-n-i-a-4):d.max(0,n)}_$getBounds(t=null){if(t){let e=t;const i=this._$transform._$rawMatrix();return(i[0]!==1||i[1]!==0||i[2]!==0||i[3]!==1||i[4]!==0||i[5]!==0)&&(e=ct(t,i)),wt(this._$bounds,e)}return et(this._$bounds.xMin,this._$bounds.xMax,this._$bounds.yMin,this._$bounds.yMax)}_$buildCharacter(t){const e=this._$defaultTextFormat;switch(e.font=t.font,e.size=t.size|0,e.align=t.align,e.color=t.color|0,e.leading=t.leading,e.letterSpacing=t.letterSpacing,e.leftMargin=t.leftMargin,e.rightMargin=t.rightMargin,t.fontType){case 1:e.bold=!0;break;case 2:e.italic=!0;break;case 3:e.bold=!0,e.italic=!0;break}switch(this._$type=t.inputType,this._$multiline=!!t.multiline,this._$wordWrap=!!t.wordWrap,this._$border=!!t.border,this._$scrollEnabled=!!t.scroll,this._$thickness=t.thickness|0,this._$thicknessColor=t.thicknessColor|0,this._$bounds.xMin=t.originBounds.xMin,this._$bounds.xMax=t.originBounds.xMax,this._$bounds.yMin=t.originBounds.yMin,this._$bounds.yMax=t.originBounds.yMax,this._$originBounds.xMin=t.originBounds.xMin,this._$originBounds.xMax=t.originBounds.xMax,this._$originBounds.yMin=t.originBounds.yMin,this._$originBounds.yMax=t.originBounds.yMax,t.autoSize){case 1:this.autoSize=t.align;break;case 2:this.autoFontSize=!0;break}this.text=t.text,X&&this._$stage&&this._$createWorkerInstance()}_$sync(t){this._$buildCharacter(t)}_$build(t,e){const i=this._$baseBuild(t,e);return this._$buildCharacter(i),i}_$clip(t,e){const i=this._$getBounds(),r=i.xMax,n=i.xMin,a=i.yMax,o=i.yMin;W(i);const c=d.ceil(d.abs(r-n)),u=d.ceil(d.abs(a-o));if(!c||!u)return;let l=e;const h=this._$transform._$rawMatrix();(h[0]!==1||h[1]!==0||h[2]!==0||h[3]!==1||h[4]!==0||h[5]!==0)&&(l=ct(e,h)),t.reset(),t.setTransform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),t.moveTo(0,0),t.lineTo(c,0),t.lineTo(c,u),t.lineTo(0,u),t.lineTo(0,0),t.clip(),l!==e&&tt(l)}_$draw(t,e,i){if(!this._$visible||this._$focusIndex===-1&&!this._$background&&!this._$border&&!this.text)return;let r=i;const n=this._$transform._$rawColorTransform();(n[0]!==1||n[1]!==1||n[2]!==1||n[3]!==1||n[4]!==0||n[5]!==0||n[6]!==0||n[7]!==0)&&(r=yi(i,n));const a=O(r[3]+r[7]/255,0,1);if(!a)return;let o=e;const c=this._$transform._$rawMatrix();(c[0]!==1||c[1]!==0||c[2]!==0||c[3]!==1||c[4]!==0||c[5]!==0)&&(o=ct(e,c));const u=this._$getBounds(null);u.xMin-=this._$thickness,u.xMax+=this._$thickness,u.yMin-=this._$thickness,u.yMax+=this._$thickness;const l=wt(u,o),h=+l.xMax,$=+l.xMin,_=+l.yMax,g=+l.yMin;W(l);const f=d.ceil(d.abs(h-$)),m=d.ceil(d.abs(_-g));switch(!0){case f===0:case m===0:case f===-bt:case m===-bt:case f===bt:case m===bt:return}let p=+d.sqrt(o[0]*o[0]+o[1]*o[1]);if(!ft.isInteger(p)){const N=p.toString(),Y=N.indexOf("e");Y!==-1&&(p=+N.slice(0,Y)),p=+p.toFixed(4)}let x=+d.sqrt(o[2]*o[2]+o[3]*o[3]);if(!ft.isInteger(x)){const N=x.toString(),Y=N.indexOf("e");Y!==-1&&(x=+N.slice(0,Y)),x=+x.toFixed(4)}const b=this._$filters||this.filters,T=b!==null&&b.length>0&&this._$canApply(b);let y=et(0,f,0,m);if(T&&b)for(let N=0;N<b.length;++N)y=b[N]._$generateFilterRect(y,p,x);const v=t.frameBuffer,L=v.currentAttachment;if(!L||$-y.xMin>L.width||g-y.yMin>L.height){W(y);return}if(0>$+y.xMax||0>g+y.yMax){W(y);return}if(W(y),this._$isUpdated()&&(J.removeCache(this._$instanceId),t.cachePosition=null,this._$cacheKeys.length=0),!this._$cacheKeys.length||this._$cacheParams[0]!==p||this._$cacheParams[1]!==x||this._$cacheParams[2]!==i[7]){const N=A(p,x);this._$cacheKeys=J.generateKeys(this._$instanceId,N),V(N),this._$cacheParams[0]=p,this._$cacheParams[1]=x,this._$cacheParams[2]=i[7]}const B=this._$blendMode||this.blendMode;if(t.cachePosition=J.get(this._$cacheKeys),!t.cachePosition){const N=d.min(1,d.max(p,x)),Y=d.ceil(d.abs(u.xMax-u.xMin)*p),q=d.ceil(d.abs(u.yMax-u.yMin)*x),ot=J.getCanvas();ot.width=Y+N*2,ot.height=q+N*2;const G=ot.getContext("2d");if(!G)throw new Error("the context is null.");if(this._$background||this._$border){if(G.beginPath(),G.moveTo(0,0),G.lineTo(Y,0),G.lineTo(Y,q),G.lineTo(0,q),G.lineTo(0,0),this._$background){const Bt=ve(this._$backgroundColor),Ge=d.max(0,d.min(Bt.A*255+r[7],255))/255;G.fillStyle=`rgba(${Bt.R},${Bt.G},${Bt.B},${Ge})`,G.fill()}if(this._$border){const Bt=ve(this._$borderColor),Ge=d.max(0,d.min(Bt.A*255+r[7],255))/255;G.lineWidth=N,G.strokeStyle=`rgba(${Bt.R},${Bt.G},${Bt.B},${Ge})`,G.stroke()}}G.save(),G.beginPath(),G.moveTo(2,2),G.lineTo(Y-2,2),G.lineTo(Y-2,q-2),G.lineTo(2,q-2),G.lineTo(2,2),G.clip();let Vt=2;if(this._$scrollX>0){const Bt=(this.textWidth-this.width)/this.width;Vt+=-this._$scrollX*Bt}let Ce=2;if(this._$scrollY>0){const Bt=(this.textHeight-this.height)/this.height;Ce+=-this._$scrollY*Bt}G.setTransform(p,0,0,x,Vt*p,Ce*x),G.beginPath(),this._$doDraw(G,r,Y/p,N),G.restore();const Ee=v.createCachePosition(Y,q),ce=v.createTextureFromCanvas(G.canvas);t.drawTextureFromRect(ce,Ee),t.cachePosition=Ee,J.set(this._$cacheKeys,Ee),J.destroy(G)}let F=!1,R=0,w=0;if(b&&b.length&&this._$canApply(b)){F=!0;const N=this._$drawFilter(t,o,b,f,m);N.offsetX&&(R=N.offsetX),N.offsetY&&(w=N.offsetY),t.cachePosition=N}const I=d.atan2(o[1],o[0]),D=d.atan2(-o[2],o[3]);if(!F&&(I||D)){const N=u.xMin*p,Y=u.yMin*x,q=d.cos(I),ot=d.sin(I),G=d.cos(D),Vt=d.sin(D);t.setTransform(q,ot,-Vt,G,N*q-Y*Vt+o[4],N*ot+Y*G+o[5])}else t.setTransform(1,0,0,1,$-R,g-w);t.cachePosition&&(t.globalAlpha=a,t.imageSmoothingEnabled=!0,t.globalCompositeOperation=B,t.drawInstance($-R,g-w,h,_,i),t.cachePosition=null),W(u),o!==e&&tt(o),r!==i&&$s(r)}_$doDraw(t,e,i,r){const n=this.getTextData();if(!n.textTable.length&&this._$focusIndex>-1&&this._$focusVisible){const x=this._$defaultTextFormat,b=ve(x.color||0),T=d.max(0,d.min(b.A*255+e[7],255))/255;t.strokeStyle=`rgba(${b.R},${b.G},${b.B},${T})`,t.beginPath(),t.moveTo(0,0),t.lineTo(0,0+(x.size||12)),t.stroke();return}if(this._$selectIndex>-1&&this._$focusIndex>-1){const x=n.textTable.length-1;let b=0,T=0;this._$focusIndex<=this._$selectIndex?(b=d.min(this._$focusIndex,x),T=d.min(this._$selectIndex,x)):(b=d.min(this._$selectIndex,x),T=d.min(this._$focusIndex-1,x));const y=n.textTable[b],v=n.lineTable[y.line],L=this._$getAlignOffset(v,i);let B=0;if(b&&y.mode==="text"){let R=b;for(;R;){const w=n.textTable[--R];if(w.mode!=="text")break;B+=w.w}}t.fillStyle="#b4d7ff";let F=0;for(let R=b;R<=T;++R){const w=n.textTable[R];if(w.mode==="text"&&(F+=w.w,R!==T))continue;let I=0;const D=w.mode==="text"?w.line:w.line-1;for(let N=0;N<D;++N)I+=n.heightTable[N];t.beginPath(),t.rect(B,I,F+L,n.heightTable[D]),t.fill(),B=0,F=0}}const a=this.width;let o=0;if(this._$scrollX>0){const x=(this.textWidth-a)/a;o=this._$scrollX*x}const c=a+o,u=this.height;let l=0;if(this._$scrollY>0){const x=(this.textHeight-u)/u;l=this._$scrollY*x}const h=u+l;let $=0,_=0,g=0,f=0,m=!1,p=-1;for(let x=0;x<n.textTable.length;++x){const b=n.textTable[x];if((b.mode==="text"||b.mode==="break")&&(p++,this._$stopIndex>-1&&p>this._$stopIndex))break;if(m&&b.mode==="text")continue;const T=b.textFormat;if(this._$autoSize==="none"){if(_>h)break;if(b.mode==="text"&&(o>$+b.w||$>c)){$+=b.w;continue}}const y=ve(T.color||0),v=d.max(0,d.min(y.A*255+e[7],255))/255;if(t.fillStyle=`rgba(${y.R},${y.G},${y.B},${v})`,this._$focusVisible&&this._$focusIndex===x){const B=$+g+.1;let F=b.line,R=b.y,w=n.ascentTable[F];b.mode!=="text"&&(R=b.mode==="break"?b.h:n.ascentTable[F-1],F>0&&!n.ascentTable[F-1]?(F=b.line,w=n.ascentTable[F-1]):(F=b.line-1,w=n.ascentTable[F]));for(let I=0;I<F;++I)w+=n.heightTable[I];t.strokeStyle=`rgba(${y.R},${y.G},${y.B},${v})`,t.beginPath(),t.moveTo(B,w),t.lineTo(B,w-R),t.stroke()}if(this._$thickness){const B=ve(this._$thicknessColor),F=d.max(0,d.min(B.A*255+e[7],255))/255;t.lineWidth=this._$thickness,t.strokeStyle=`rgba(${B.R},${B.G},${B.B},${F})`}const L=b.line|0;switch(b.mode){case"break":case"wrap":if($=0,L&&(_+=n.heightTable[L-1]),l>_+n.heightTable[L]){m=!0;continue}f=n.ascentTable[L],g=this._$getAlignOffset(b,i),m=!1;break;case"text":{t.beginPath(),t.font=K_(T.font||"",T.size||0,!!T.italic,!!T.bold);const B=$+g,F=_+f;if(T.underline){const R=ve(T.color||0),w=d.max(0,d.min(R.A*255+e[7],255))/255;t.lineWidth=r,t.strokeStyle=`rgba(${R.R},${R.G},${R.B},${w})`,t.beginPath(),t.moveTo(B,F+2),t.lineTo(B+b.w,F+2),t.stroke()}this._$thickness&&t.strokeText(b.text,B,F),t.fillText(b.text,B,F),$+=b.w}break}}if(this._$focusVisible&&this._$focusIndex>=n.textTable.length){const x=n.textTable[this._$focusIndex-1];if(x){const b=ve(x.textFormat.color||0),T=d.max(0,d.min(b.A*255+e[7],255))/255;t.strokeStyle=`rgba(${b.R},${b.G},${b.B},${T})`;const y=$+g+.1,v=_+f;t.beginPath(),x.mode==="text"?(t.moveTo(y,v-x.y),t.lineTo(y,v)):(t.moveTo(y,v+x.h),t.lineTo(y,v)),t.stroke()}}}_$mouseHit(t,e,i){return this._$visible?this._$hit(t,e,i):!1}_$hit(t,e,i){let r=e;const n=this._$transform._$rawMatrix();(n[0]!==1||n[1]!==0||n[2]!==0||n[3]!==1||n[4]!==0||n[5]!==0)&&(r=ct(e,n));const a=this._$getBounds(null),o=wt(a,r),c=+o.xMax,u=+o.xMin,l=+o.yMax,h=+o.yMin;W(o),W(a);const $=d.ceil(d.abs(c-u)),_=d.ceil(d.abs(l-h));return t.setTransform(1,0,0,1,u,h),t.beginPath(),t.moveTo(0,0),t.lineTo($,0),t.lineTo($,_),t.lineTo(0,_),t.lineTo(0,0),r!==e&&tt(r),t.isPointInPath(i.x,i.y)}_$createWorkerInstance(){if(this._$created||!X)return;this._$created=!0;const t=this._$getBounds(),e={command:"createTextField",buffer:new Float32Array,instanceId:this._$instanceId,parentId:this._$parent?this._$parent._$instanceId:-1,xMin:t.xMin,yMin:t.yMin,xMax:t.xMax,yMax:t.yMax,limitWidth:this.width,limitHeight:this.height,textHeight:this.textHeight,autoSize:this._$autoSize,wordWrap:this._$wordWrap,border:this._$border,background:this._$background,thickness:this._$thickness};this._$border&&(e.borderColor=this._$borderColor),this._$background&&(e.backgroundColor=this._$backgroundColor),this._$thickness&&(e.thicknessColor=this._$backgroundColor),this._$characterId>-1&&(e.characterId=this._$characterId),this._$loaderInfo&&(e.loaderInfoId=this._$loaderInfo._$id),this._$scale9Grid&&(e.grid={x:this._$scale9Grid.x,y:this._$scale9Grid.y,w:this._$scale9Grid.width,h:this._$scale9Grid.height}),X.postMessage(e)}_$postProperty(){if(!X)return;const t=this._$createMessage(),e=this._$getBounds(null);t.xMin=e.xMin,t.yMin=e.yMin,t.xMax=e.xMax,t.yMax=e.yMax,W(e),this._$isUpdated()&&(t.limitWidth=this.width,t.limitHeight=this.height,t.textHeight=this.textHeight,t.autoSize=this._$autoSize,t.wordWrap=this._$wordWrap,t.border=this._$border,this._$border&&(t.borderColor=this._$borderColor),t.background=this._$background,this._$background&&(t.backgroundColor=this._$backgroundColor),t.thickness=this._$thickness,this._$thickness&&(t.thicknessColor=this._$backgroundColor)),X.postMessage(t),this._$posted=!0,this._$updated=!1}}class Qs{constructor(){this._$rgb="rgb",this._$mode="pad",this._$type="linear",this._$focalPointRatio=0,this._$points=Pt(),this._$stops=A()}dispose(){const t=this._$stops;for(let e=0;e<t.length;++e)H_(t[e][1]);tt(this._$points)}get mode(){return this._$mode}get type(){return this._$type}get rgb(){return this._$rgb}get points(){return this._$points}get focalPointRatio(){return this._$focalPointRatio}get stops(){return this._$stops.sort((t,e)=>{switch(!0){case t[0]>e[0]:return 1;case e[0]>t[0]:return-1;default:return 0}}),this._$stops}linear(t,e,i,r,n="rgb",a="pad"){return this._$type="linear",this._$points[0]=t,this._$points[1]=e,this._$points[2]=i,this._$points[3]=r,this._$rgb=n,this._$mode=a,this._$stops.length&&(this._$stops.length=0),this}radial(t,e,i,r,n,a,o="rgb",c="pad",u=0){return this._$type="radial",this._$points[0]=t,this._$points[1]=e,this._$points[2]=i,this._$points[3]=r,this._$points[4]=n,this._$points[5]=a,this._$rgb=o,this._$mode=c,this._$focalPointRatio=O(u,-.975,.975,0),this._$stops.length&&(this._$stops.length=0),this}addColorStop(t,e){this._$stops.push(A(t,e))}}class or{constructor(t,e,i){this._$texture=t,this._$repeat=e,this._$colorTransform=i}get texture(){return this._$texture}get repeat(){return this._$repeat}get colorTransform(){return this._$colorTransform}}class Sf{constructor(){this._$fillStyle=He(1,1,1,1),this._$strokeStyle=He(1,1,1,1),this._$lineWidth=1,this._$lineCap="round",this._$lineJoin="round",this._$miterLimit=5}get miterLimit(){return this._$miterLimit}set miterLimit(t){this._$miterLimit=t}get lineWidth(){return this._$lineWidth}set lineWidth(t){this._$lineWidth=t}get lineCap(){return this._$lineCap}set lineCap(t){this._$lineCap=t}get lineJoin(){return this._$lineJoin}set lineJoin(t){this._$lineJoin=t}get fillStyle(){return this._$fillStyle}set fillStyle(t){this._$fillStyle instanceof ne&&Fc(this._$fillStyle),this._$fillStyle=t}get strokeStyle(){return this._$strokeStyle}set strokeStyle(t){this._$strokeStyle instanceof ne&&Fc(this._$strokeStyle),this._$strokeStyle=t}clear(){this._$lineWidth=1,this._$lineCap="round",this._$lineJoin="round",this._$miterLimit=5,this._$clearFill(),this._$clearStroke()}_$clearFill(){if(this._$fillStyle instanceof Qs){this._$fillStyle.dispose(),this._$fillStyle=He(1,1,1,1);return}if(this._$fillStyle instanceof or){this._$fillStyle=He(1,1,1,1);return}this._$fillStyle.fill(1)}_$clearStroke(){if(this._$strokeStyle instanceof Qs){this._$strokeStyle.dispose(),this._$strokeStyle=He(1,1,1,1);return}if(this._$strokeStyle instanceof or){this._$strokeStyle=He(1,1,1,1);return}this._$strokeStyle.fill(1)}}let rt=2048;const wf=s=>{rt=Math.min(4096,s/2)};class Mf{constructor(t){t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),this._$gl=t,this._$objectPool=[],this._$objectPoolArea=0,this._$activeTexture=-1,this._$boundTextures=[null,null,null],this._$maxWidth=0,this._$maxHeight=0,this._$atlasTextures=[],this._$atlasCacheMap=new Map,this._$positionObjectArray=[],this._$nodeObjectArray=[],this._$atlasNodes=new Map}createTextureAtlas(){const t=this._$gl.createTexture();t.width=rt,t.height=rt,this._$gl.activeTexture(this._$gl.TEXTURE3),this._$gl.bindTexture(this._$gl.TEXTURE_2D,t),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_WRAP_S,this._$gl.CLAMP_TO_EDGE),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_WRAP_T,this._$gl.CLAMP_TO_EDGE),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_MIN_FILTER,this._$gl.NEAREST),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_MAG_FILTER,this._$gl.NEAREST),this._$gl.texStorage2D(this._$gl.TEXTURE_2D,1,this._$gl.RGBA8,rt,rt),this._$gl.bindTexture(this._$gl.TEXTURE_2D,null),this._$activeTexture>-1&&this._$gl.activeTexture(this._$activeTexture);const e=this._$atlasTextures.length;this._$atlasNodes.set(e,[]),this._$atlasCacheMap.set(e,[]),this._$atlasTextures.push(t)}getAtlasTexture(t){return this._$atlasTextures[t]}getNode(t,e,i,r){const n=this._$nodeObjectArray.length?this._$nodeObjectArray.pop():{x:0,y:0,w:0,h:0};return n.x=t,n.y=e,n.w=i,n.h=r,n}createCachePosition(t,e){const i=this._$positionObjectArray.length?this._$positionObjectArray.pop():{index:0,x:0,y:0,w:0,h:0};i.x=i.y=0,i.w=t,i.h=e;for(const[o,c]of this._$atlasNodes){if(!c.length)return t>e?(rt-t-1>0&&c.push(this.getNode(t+1,0,rt-t-1,e)),rt-e-1>0&&c.push(this.getNode(0,e+1,rt,rt-e-1))):(rt-e-1>0&&c.push(this.getNode(0,e+1,t,rt-e-1)),rt-t-1>0&&c.push(this.getNode(t+1,0,rt-t-1,rt))),i.index=o,this._$atlasCacheMap.get(i.index).push(i),i;const u=c.length;for(let l=0;l<u;++l){const h=c[l];if(t>h.w||e>h.h)continue;return i.index=o,i.x=h.x,i.y=h.y,this._$atlasCacheMap.get(i.index).push(i),h.w!==t||h.h!==e?t>e?(h.h-e-1>0&&c.push(this.getNode(h.x,h.y+e+1,h.w,h.h-e-1)),h.w-t-1>0?(h.x=h.x+t+1,h.w=h.w-t-1,h.h=e):(c.splice(l,1),this._$nodeObjectArray.push(h))):(h.w-t-1>0&&c.push(this.getNode(h.x+t+1,h.y,h.w-t-1,h.h)),h.h-e-1>0?(h.y=h.y+e+1,h.w=t,h.h=h.h-e-1):(c.splice(l,1),this._$nodeObjectArray.push(h))):(c.splice(l,1),this._$nodeObjectArray.push(h)),i}}const r=this._$atlasTextures.length;this.createTextureAtlas();const n=this._$atlasNodes.get(r);return t>e?(rt-t-1>0&&n.push(this.getNode(t+1,0,rt-t-1,e)),rt-e-1>0&&n.push(this.getNode(0,e+1,rt,rt-e-1))):(rt-e-1>0&&n.push(this.getNode(0,e+1,t,rt-e-1)),rt-t-1>0&&n.push(this.getNode(t+1,0,rt-t-1,rt))),i.index=r,this._$atlasCacheMap.get(i.index).push(i),i}releasePosition(t){var e;this._$atlasNodes.has(t.index)&&((e=this._$atlasNodes.get(t.index))===null||e===void 0||e.unshift(this.getNode(t.x,t.y,t.w,t.h)),this._$positionObjectArray.push(t))}clearCache(){for(const t of this._$atlasCacheMap.values())t.length=0;for(const t of this._$atlasNodes.values())t.length=0}_$createTexture(t,e){const i=this._$gl.createTexture();return i.width=0,i.height=0,i.area=0,i.dirty=!0,i.smoothing=!0,this.bind0(i,!1),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_WRAP_S,this._$gl.CLAMP_TO_EDGE),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_WRAP_T,this._$gl.CLAMP_TO_EDGE),i.width=t,i.height=e,i.area=t*e,i.dirty=!1,this._$gl.texStorage2D(this._$gl.TEXTURE_2D,1,this._$gl.RGBA8,t,e),i}_$getTexture(t,e){for(let i=0;i<this._$objectPool.length;i++){const r=this._$objectPool[i];if(r.width===t&&r.height===e)return this._$objectPool.splice(i,1),this._$objectPoolArea-=r.area,this.bind0(r,!1),r}return this._$createTexture(t,e)}create(t,e,i=null,r=!1,n=!0){const a=this._$getTexture(t,e);return r&&this._$gl.pixelStorei(this._$gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),n||this._$gl.pixelStorei(this._$gl.UNPACK_FLIP_Y_WEBGL,!1),a.width!==t||a.height!==e?(a.width=t,a.height=e,a.area=t*e,a.dirty=!1,this._$gl.texImage2D(this._$gl.TEXTURE_2D,0,this._$gl.RGBA,t,e,0,this._$gl.RGBA,this._$gl.UNSIGNED_BYTE,i)):i&&(a.dirty=!1,this._$gl.texSubImage2D(this._$gl.TEXTURE_2D,0,0,0,t,e,this._$gl.RGBA,this._$gl.UNSIGNED_BYTE,i)),r&&this._$gl.pixelStorei(this._$gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n||this._$gl.pixelStorei(this._$gl.UNPACK_FLIP_Y_WEBGL,!0),a}createFromImage(t,e=!1){return this._$createFromElement(t.width,t.height,t,e)}createFromCanvas(t){return this._$createFromElement(t.width,t.height,t,!1)}createFromVideo(t,e=!1){return this._$createFromElement(t.videoWidth,t.videoHeight,t,e)}_$createFromElement(t,e,i,r=!1){const n=this._$getTexture(t,e);return n.dirty=!1,this.bind0(n,r),this._$gl.pixelStorei(this._$gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),n.width!==t||n.height!==e?(n.width=t,n.height=e,n.area=t*e,this._$gl.texImage2D(this._$gl.TEXTURE_2D,0,this._$gl.RGBA,this._$gl.RGBA,this._$gl.UNSIGNED_BYTE,i)):this._$gl.texSubImage2D(this._$gl.TEXTURE_2D,0,0,0,this._$gl.RGBA,this._$gl.UNSIGNED_BYTE,i),this._$gl.pixelStorei(this._$gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n}release(t){if(t.area>this._$maxWidth*this._$maxHeight*2){this._$gl.deleteTexture(t);return}if(t.dirty=!0,this._$objectPool.push(t),this._$objectPoolArea+=t.area,this._$objectPool.length&&this._$objectPoolArea>this._$maxWidth*this._$maxHeight*10){const e=this._$objectPool.shift();this._$objectPoolArea-=e.area,this._$gl.deleteTexture(e)}}bind0(t,e=null){this._$bindTexture(2,this._$gl.TEXTURE2,null,null),this._$bindTexture(1,this._$gl.TEXTURE1,null,null),this._$bindTexture(0,this._$gl.TEXTURE0,t,e)}bind01(t,e,i=null){this._$bindTexture(2,this._$gl.TEXTURE2,null,null),this._$bindTexture(1,this._$gl.TEXTURE1,e,i),this._$bindTexture(0,this._$gl.TEXTURE0,t,i)}bind012(t,e,i,r=null){this._$bindTexture(2,this._$gl.TEXTURE2,i,r),this._$bindTexture(1,this._$gl.TEXTURE1,e,null),this._$bindTexture(0,this._$gl.TEXTURE0,t,null)}bind02(t,e,i=null){this._$bindTexture(2,this._$gl.TEXTURE2,e,i),this._$bindTexture(1,this._$gl.TEXTURE1,null,null),this._$bindTexture(0,this._$gl.TEXTURE0,t,null)}_$bindTexture(t,e,i=null,r=null){const n=i!==this._$boundTextures[t],a=r!==null&&i!==null&&r!==i.smoothing;if((n||a||e===this._$gl.TEXTURE0)&&e!==this._$activeTexture&&(this._$activeTexture=e,this._$gl.activeTexture(e)),n&&(this._$boundTextures[t]=i,this._$gl.bindTexture(this._$gl.TEXTURE_2D,i)),a){i&&(i.smoothing=!!r);const c=r?this._$gl.LINEAR:this._$gl.NEAREST;this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_MIN_FILTER,c),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_MAG_FILTER,c)}}}class If{constructor(t){this._$gl=t,this._$objectPool=A(),this._$objectPoolArea=0,this._$maxWidth=0,this._$maxHeight=0}set maxWidth(t){this._$maxWidth=t}set maxHeight(t){this._$maxHeight=t}_$createStencilBuffer(){const t=this._$gl.createRenderbuffer();if(!t)throw new Error("the stencil buffer is null.");return t.width=0,t.height=0,t.area=0,t.dirty=!0,t}_$getStencilBuffer(t,e){const i=this._$objectPool.length;for(let r=0;r<i;++r){const n=this._$objectPool[r];if(n.width===t&&n.height===e)return this._$objectPool.splice(r,1),this._$objectPoolArea-=n.area,n}if(i>100){const r=this._$objectPool.shift();if(r)return this._$objectPoolArea-=r.area,r}return this._$createStencilBuffer()}create(t,e){const i=this._$getStencilBuffer(t,e);return(i.width!==t||i.height!==e)&&(i.width=t,i.height=e,i.area=t*e,i.dirty=!1,this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,i),this._$gl.renderbufferStorage(this._$gl.RENDERBUFFER,this._$gl.STENCIL_INDEX8,t,e)),i}release(t){if(t.area>this._$maxWidth*this._$maxHeight*2){this._$gl.deleteRenderbuffer(t);return}if(t.dirty=!0,this._$objectPool.push(t),this._$objectPoolArea+=t.area,this._$objectPoolArea>this._$maxWidth*this._$maxHeight*10){const e=this._$objectPool.shift();e&&(this._$objectPoolArea-=e.area,this._$gl.deleteRenderbuffer(e))}}}class Af{constructor(t,e){this._$gl=t,this._$samples=e,this._$objectPool=A()}set samples(t){this._$samples=t}_$createColorBuffer(){const t=this._$gl.createRenderbuffer();if(!t)throw new Error("the color buffer is null.");const e=this._$gl.createRenderbuffer();if(!e)throw new Error("the stencil buffer is null.");return t.stencil=e,t.samples=0,t.width=0,t.height=0,t.area=0,t.dirty=!0,t}_$getColorBuffer(t){if(!this._$objectPool.length)return this._$createColorBuffer();const e=this._$bsearch(t);if(e<this._$objectPool.length){const r=this._$objectPool[e];return this._$objectPool.splice(e,1),r}const i=this._$objectPool.shift();if(!i)throw new Error("the color buffer is void.");return i}create(t,e,i=0){t=d.max(256,rr(t)),e=d.max(256,rr(e));const r=this._$getColorBuffer(t*e);return i||(i=this._$samples),(r.width<t||r.height<e||r.samples!==i)&&(t=d.max(t,r.width),e=d.max(e,r.height),r.samples=i,r.width=t,r.height=e,r.area=t*e,r.dirty=!1,this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,r),this._$gl.renderbufferStorageMultisample(this._$gl.RENDERBUFFER,i,this._$gl.RGBA8,t,e),this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,r.stencil),this._$gl.renderbufferStorageMultisample(this._$gl.RENDERBUFFER,i,this._$gl.STENCIL_INDEX8,t,e)),r}release(t){t.dirty=!0;const e=this._$bsearch(t.area);this._$objectPool.splice(e,0,t)}_$bsearch(t){let e=-1,i=this._$objectPool.length;for(;d.abs(i-e)>1;){const r=d.floor((i+e)/2);t<=this._$objectPool[r].area?i=r:e=r}return i}}class Lf{constructor(t,e){this._$gl=t,this._$objectPool=[],this._$frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.READ_FRAMEBUFFER,this._$frameBuffer),this._$frameBufferTexture=t.createFramebuffer(),this._$currentAttachment=null,this._$isBinding=!1,this._$textureManager=new Mf(t),this._$stencilBufferPool=new If(t),this._$colorBufferPool=new Af(t,e),this._$isRenderBinding=!1,this._$colorBuffer=this._$gl.createRenderbuffer(),this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,this._$colorBuffer),this._$gl.renderbufferStorageMultisample(this._$gl.RENDERBUFFER,e,this._$gl.RGBA8,rt,rt),this._$stencilBuffer=this._$gl.createRenderbuffer(),this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,this._$stencilBuffer),this._$gl.renderbufferStorageMultisample(this._$gl.RENDERBUFFER,e,this._$gl.STENCIL_INDEX8,rt,rt)}bindRenderBuffer(){this._$isBinding||(this._$isBinding=!0,this._$gl.bindFramebuffer(this._$gl.FRAMEBUFFER,this._$frameBuffer)),this._$isRenderBinding||(this._$isRenderBinding=!0,this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,this._$colorBuffer),this._$gl.framebufferRenderbuffer(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.RENDERBUFFER,this._$colorBuffer),this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,this._$stencilBuffer),this._$gl.framebufferRenderbuffer(this._$gl.FRAMEBUFFER,this._$gl.STENCIL_ATTACHMENT,this._$gl.RENDERBUFFER,this._$stencilBuffer))}get currentAttachment(){return this._$currentAttachment}get textureManager(){return this._$textureManager}createCacheAttachment(t,e,i=!1,r=0){const n=this._$objectPool.pop()||{width:0,height:0,color:null,texture:null,msaa:!1,stencil:null,mask:!1,clipLevel:0,isActive:!1},a=this._$textureManager.create(t,e);return n.width=t,n.height=e,i?(n.color=this._$colorBufferPool.create(t,e,r),n.texture=a,n.msaa=!0,n.stencil=n.color.stencil):(n.color=a,n.texture=a,n.msaa=!1,n.stencil=this._$stencilBufferPool.create(t,e)),n.mask=!1,n.clipLevel=0,n.isActive=!0,n}clearCache(){this._$textureManager.clearCache()}setMaxSize(t,e){this._$stencilBufferPool._$maxWidth=t,this._$stencilBufferPool._$maxHeight=e,this._$textureManager._$maxWidth=t,this._$textureManager._$maxHeight=e}createTextureAttachment(t,e){const i=this._$objectPool.pop()||{width:0,height:0,color:null,texture:null,msaa:!1,stencil:null,mask:!1,clipLevel:0,isActive:!1},r=this._$textureManager.create(t,e);return i.width=t,i.height=e,i.color=r,i.texture=r,i.msaa=!1,i.stencil=null,i.mask=!1,i.clipLevel=0,i.isActive=!0,i}createTextureAttachmentFrom(t){const e=this._$objectPool.pop()||{width:0,height:0,color:null,texture:null,msaa:!1,stencil:null,mask:!1,clipLevel:0,isActive:!0};return e.width=t.width,e.height=t.height,e.color=t,e.texture=t,e.msaa=!1,e.stencil=null,e.mask=!1,e.clipLevel=0,e.isActive=!0,e}releaseAttachment(t=null,e=!1){!t||!t.isActive||(t.msaa?t.color instanceof WebGLRenderbuffer&&this._$colorBufferPool.release(t.color):t.stencil&&this._$stencilBufferPool.release(t.stencil),e&&t.texture&&this._$textureManager.release(t.texture),t.color=null,t.texture=null,t.stencil=null,t.isActive=!1,this._$objectPool.push(t))}bind(t){this._$currentAttachment=t,this._$isBinding||(this._$isBinding=!0,this._$gl.bindFramebuffer(this._$gl.FRAMEBUFFER,this._$frameBuffer)),t.msaa?t.color instanceof WebGLRenderbuffer&&(this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,t.color),this._$gl.framebufferRenderbuffer(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.RENDERBUFFER,t.color)):t.color instanceof WebGLTexture&&(t.color&&this._$textureManager.bind0(t.color),this._$gl.framebufferTexture2D(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.TEXTURE_2D,t.color,0)),this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,t.stencil),this._$gl.framebufferRenderbuffer(this._$gl.FRAMEBUFFER,this._$gl.STENCIL_ATTACHMENT,this._$gl.RENDERBUFFER,t.stencil),this._$isRenderBinding=!1}unbind(){this._$currentAttachment=null,this._$isBinding&&(this._$isBinding=!1,this._$gl.bindFramebuffer(this._$gl.FRAMEBUFFER,null))}transferToMainTexture(){if(!this._$currentAttachment)throw new Error("the current attachment is null.");const t=this._$currentAttachment.width,e=this._$currentAttachment.height,i=this._$currentAttachment.texture;if(!i)throw new Error("the texture is null.");this._$gl.bindFramebuffer(this._$gl.DRAW_FRAMEBUFFER,this._$frameBufferTexture),this._$textureManager.bind0(i),this._$gl.framebufferTexture2D(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.TEXTURE_2D,i,0),this._$gl.bindFramebuffer(this._$gl.DRAW_FRAMEBUFFER,null),this._$gl.blitFramebuffer(0,0,t,e,0,0,t,e,this._$gl.COLOR_BUFFER_BIT,this._$gl.NEAREST),this._$gl.bindFramebuffer(this._$gl.DRAW_FRAMEBUFFER,this._$frameBuffer)}createCachePosition(t,e){return this._$textureManager.createCachePosition(t,e)}transferTexture(t){this._$gl.disable(this._$gl.SCISSOR_TEST),this._$gl.bindFramebuffer(this._$gl.DRAW_FRAMEBUFFER,this._$frameBufferTexture);const e=this._$textureManager.getAtlasTexture(t.index);this._$textureManager.bind0(e),this._$gl.framebufferTexture2D(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.TEXTURE_2D,e,0);const i=d.max(0,t.x-1),r=d.max(0,t.y-1),n=d.min(rt,t.x+t.w+1),a=d.min(rt,t.y+t.h+1);this._$gl.blitFramebuffer(i,r,n,a,i,r,n,a,this._$gl.COLOR_BUFFER_BIT,this._$gl.NEAREST),this._$gl.bindFramebuffer(this._$gl.FRAMEBUFFER,this._$frameBuffer)}getTextureFromCurrentAttachment(){if(!this._$currentAttachment)throw new Error("the current attachment is null.");if(!this._$currentAttachment.msaa&&this._$currentAttachment.texture)return this._$currentAttachment.texture;const t=this._$currentAttachment.width,e=this._$currentAttachment.height,i=this._$currentAttachment.texture;if(!i)throw new Error("the texture is null.");return i.dirty=!1,this._$gl.bindFramebuffer(this._$gl.DRAW_FRAMEBUFFER,this._$frameBufferTexture),this._$textureManager.bind0(i),this._$gl.framebufferTexture2D(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.TEXTURE_2D,i,0),this._$gl.blitFramebuffer(0,0,t,e,0,0,t,e,this._$gl.COLOR_BUFFER_BIT,this._$gl.NEAREST),this._$gl.bindFramebuffer(this._$gl.FRAMEBUFFER,this._$frameBuffer),i}createTextureFromPixels(t,e,i=null,r=!1,n=!0){return this._$textureManager.create(t,e,i,r,n)}createTextureFromCanvas(t){return this._$textureManager.createFromCanvas(t)}createTextureFromImage(t,e=!1){return this._$textureManager.createFromImage(t,e)}createTextureFromVideo(t,e=!1){return this._$textureManager.createFromVideo(t,e)}createTextureFromCurrentAttachment(){if(!this._$currentAttachment)throw new Error("the current attachment is null.");const t=this._$currentAttachment.width,e=this._$currentAttachment.height,i=this._$textureManager.create(t,e);return this._$textureManager.bind0(i),this._$gl.copyTexSubImage2D(this._$gl.TEXTURE_2D,0,0,0,0,0,t,e),i}releaseTexture(t){this._$textureManager.release(t)}}class Cf{constructor(){this._$bezierConverterBuffer=new ne(32)}cubicToQuad(t,e,i,r,n,a,o,c){this._$split2Cubic(t,e,i,r,n,a,o,c,0,16),this._$split2Cubic(this._$bezierConverterBuffer[0],this._$bezierConverterBuffer[1],this._$bezierConverterBuffer[2],this._$bezierConverterBuffer[3],this._$bezierConverterBuffer[4],this._$bezierConverterBuffer[5],this._$bezierConverterBuffer[6],this._$bezierConverterBuffer[7],0,8),this._$split2Cubic(this._$bezierConverterBuffer[16],this._$bezierConverterBuffer[17],this._$bezierConverterBuffer[18],this._$bezierConverterBuffer[19],this._$bezierConverterBuffer[20],this._$bezierConverterBuffer[21],this._$bezierConverterBuffer[22],this._$bezierConverterBuffer[23],16,24),this._$split2Quad(this._$bezierConverterBuffer[0],this._$bezierConverterBuffer[1],this._$bezierConverterBuffer[2],this._$bezierConverterBuffer[3],this._$bezierConverterBuffer[4],this._$bezierConverterBuffer[5],this._$bezierConverterBuffer[6],this._$bezierConverterBuffer[7],0),this._$split2Quad(this._$bezierConverterBuffer[8],this._$bezierConverterBuffer[9],this._$bezierConverterBuffer[10],this._$bezierConverterBuffer[11],this._$bezierConverterBuffer[12],this._$bezierConverterBuffer[13],this._$bezierConverterBuffer[14],this._$bezierConverterBuffer[15],8),this._$split2Quad(this._$bezierConverterBuffer[16],this._$bezierConverterBuffer[17],this._$bezierConverterBuffer[18],this._$bezierConverterBuffer[19],this._$bezierConverterBuffer[20],this._$bezierConverterBuffer[21],this._$bezierConverterBuffer[22],this._$bezierConverterBuffer[23],16),this._$split2Quad(this._$bezierConverterBuffer[24],this._$bezierConverterBuffer[25],this._$bezierConverterBuffer[26],this._$bezierConverterBuffer[27],this._$bezierConverterBuffer[28],this._$bezierConverterBuffer[29],this._$bezierConverterBuffer[30],this._$bezierConverterBuffer[31],24)}_$split2Cubic(t,e,i,r,n,a,o,c,u,l){const h=(t+3*(i+n)+o)*.125,$=(e+3*(r+a)+c)*.125,_=(o+n-i-t)*.125,g=(c+a-r-e)*.125;this._$bezierConverterBuffer[u]=t,this._$bezierConverterBuffer[u+1]=e,this._$bezierConverterBuffer[u+2]=(t+i)*.5,this._$bezierConverterBuffer[u+3]=(e+r)*.5,this._$bezierConverterBuffer[u+4]=h-_,this._$bezierConverterBuffer[u+5]=$-g,this._$bezierConverterBuffer[u+6]=h,this._$bezierConverterBuffer[u+7]=$,this._$bezierConverterBuffer[l]=h,this._$bezierConverterBuffer[l+1]=$,this._$bezierConverterBuffer[l+2]=h+_,this._$bezierConverterBuffer[l+3]=$+g,this._$bezierConverterBuffer[l+4]=(n+o)*.5,this._$bezierConverterBuffer[l+5]=(a+c)*.5,this._$bezierConverterBuffer[l+6]=o,this._$bezierConverterBuffer[l+7]=c}_$split2Quad(t,e,i,r,n,a,o,c,u){const l=(t+3*(i+n)+o)*.125,h=(e+3*(r+a)+c)*.125;this._$bezierConverterBuffer[u]=t*.25+i*.75,this._$bezierConverterBuffer[u+1]=e*.25+r*.75,this._$bezierConverterBuffer[u+2]=l,this._$bezierConverterBuffer[u+3]=h,this._$bezierConverterBuffer[u+4]=n*.75+o*.25,this._$bezierConverterBuffer[u+5]=a*.75+c*.25,this._$bezierConverterBuffer[u+6]=o,this._$bezierConverterBuffer[u+7]=c}}class Of{constructor(){this._$currentPath=A(),this._$vertices=A(),this._$bezierConverter=new Cf}get vertices(){return this._$pushCurrentPathToVertices(),this._$vertices}begin(){for(this._$currentPath.length=0;this._$vertices.length;)V(this._$vertices.pop())}moveTo(t,e){if(!this._$currentPath.length){this._$pushPointToCurrentPath(t,e,!1);return}this._$equalsToLastPoint(t,e)||(this._$pushCurrentPathToVertices(),this._$pushPointToCurrentPath(t,e,!1))}lineTo(t,e){this._$currentPath.length||this.moveTo(0,0),!this._$equalsToLastPoint(t,e)&&this._$pushPointToCurrentPath(t,e,!1)}quadTo(t,e,i,r){this._$currentPath.length||this.moveTo(0,0),!this._$equalsToLastPoint(i,r)&&(this._$pushPointToCurrentPath(t,e,!0),this._$pushPointToCurrentPath(i,r,!1))}cubicTo(t,e,i,r,n,a){if(this._$currentPath.length||this.moveTo(0,0),this._$equalsToLastPoint(n,a))return;const o=+this._$currentPath[this._$currentPath.length-3],c=+this._$currentPath[this._$currentPath.length-2];this._$bezierConverter.cubicToQuad(o,c,t,e,i,r,n,a);const u=this._$bezierConverter._$bezierConverterBuffer;for(let l=0;l<32;)this.quadTo(u[l++],u[l++],u[l++],u[l++])}drawCircle(t,e,i){const r=i,n=i*.5522847498307936;this.cubicTo(t+r,e+n,t+n,e+r,t,e+r),this.cubicTo(t-n,e+r,t-r,e+n,t-r,e),this.cubicTo(t-r,e-n,t-n,e-r,t,e-r),this.cubicTo(t+n,e-r,t+r,e-n,t+r,e)}close(){if(this._$currentPath.length<=6)return;const t=+this._$currentPath[0],e=+this._$currentPath[1];this._$equalsToLastPoint(t,e)||this._$pushPointToCurrentPath(t,e,!1)}_$equalsToLastPoint(t,e){const i=+this._$currentPath[this._$currentPath.length-3],r=+this._$currentPath[this._$currentPath.length-2];return t===i&&e===r}_$pushPointToCurrentPath(t,e,i){this._$currentPath.push(t,e,i)}_$pushCurrentPathToVertices(){if(this._$currentPath.length<4){this._$currentPath.length=0;return}this._$vertices.push(this._$currentPath),this._$currentPath=A()}createRectVertices(t,e,i,r){return A(A(t,e,!1,t+i,e,!1,t+i,e+r,!1,t,e+r,!1))}}class Bf{constructor(){this.enabled=!1,this.parentMatrixA=1,this.parentMatrixB=0,this.parentMatrixC=0,this.parentMatrixD=0,this.parentMatrixE=1,this.parentMatrixF=0,this.parentMatrixG=0,this.parentMatrixH=0,this.parentMatrixI=1,this.ancestorMatrixA=1,this.ancestorMatrixB=0,this.ancestorMatrixC=0,this.ancestorMatrixD=0,this.ancestorMatrixE=1,this.ancestorMatrixF=0,this.ancestorMatrixG=0,this.ancestorMatrixH=0,this.ancestorMatrixI=1,this.parentViewportX=0,this.parentViewportY=0,this.parentViewportW=0,this.parentViewportH=0,this.minXST=1e-5,this.minYST=1e-5,this.minXPQ=1e-5,this.minYPQ=1e-5,this.maxXST=.99999,this.maxYST=.99999,this.maxXPQ=.99999,this.maxYPQ=.99999}enable(t,e,i,r,n,a,o,c,u,l,h,$,_,g,f,m,p,x,b){const T=n.xMax-n.xMin,y=n.yMax-n.yMin,v=a.w,L=a.h,B=d.abs(d.ceil(T*o)),F=d.abs(d.ceil(y*o)),R=v>0?(a.x-n.xMin)/T:1e-5,w=L>0?(a.y-n.yMin)/y:1e-5,I=v>0?(a.x+a.w-n.xMin)/T:.99999,D=L>0?(a.y+a.h-n.yMin)/y:.99999;let N=B*R/i,Y=F*w/r,q=(i-B*(1-I))/i,ot=(r-F*(1-D))/r;if(N>=q){const G=R/(R+(1-I));N=d.max(G-1e-5,0),q=d.min(G+1e-5,1)}if(Y>=ot){const G=w/(w+(1-D));Y=d.max(G-1e-5,0),ot=d.min(G+1e-5,1)}this.enabled=!0,this.parentMatrixA=c,this.parentMatrixB=u,this.parentMatrixD=l,this.parentMatrixE=h,this.parentMatrixG=$,this.parentMatrixH=_,this.ancestorMatrixA=g,this.ancestorMatrixB=f,this.ancestorMatrixD=m,this.ancestorMatrixE=p,this.ancestorMatrixG=x,this.ancestorMatrixH=b,this.parentViewportX=t,this.parentViewportY=e,this.parentViewportW=i,this.parentViewportH=r,this.minXST=R,this.minYST=w,this.minXPQ=N,this.minYPQ=Y,this.maxXST=I,this.maxYST=D,this.maxXPQ=q,this.maxYPQ=ot}disable(){this.enabled=!1}}class Rf{constructor(t,e){this._$gl=t,this._$array=[],this._$map=yt();const i=this._$gl.getProgramParameter(e,this._$gl.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){const n=this._$gl.getActiveUniform(e,r),a=n.name.endsWith("[0]")?n.name.slice(0,-3):n.name,o=this._$gl.getUniformLocation(e,a);if(n.type===this._$gl.SAMPLER_2D&&n.size===1)continue;const c={};switch(n.type){case this._$gl.FLOAT_VEC4:c.method=this._$gl.uniform4fv.bind(this._$gl,o),c.array=new ne(4*n.size),c.assign=-1;break;case this._$gl.INT_VEC4:c.method=this._$gl.uniform4iv.bind(this._$gl,o),c.array=new Ja(4*n.size),c.assign=-1;break;case this._$gl.SAMPLER_2D:c.method=this._$gl.uniform1iv.bind(this._$gl,o),c.array=new Ja(n.size),c.assign=1;break;case this._$gl.FLOAT:case this._$gl.FLOAT_VEC2:case this._$gl.FLOAT_VEC3:case this._$gl.FLOAT_MAT2:case this._$gl.FLOAT_MAT3:case this._$gl.FLOAT_MAT4:case this._$gl.INT:case this._$gl.INT_VEC2:case this._$gl.INT_VEC3:default:throw new Error("Use gl.FLOAT_VEC4 or gl.INT_VEC4 instead")}this._$array.push(c),this._$map.set(a,c)}}getArray(t){const e=this._$map.get(t);if(!e||!e.array)throw new Error("the UniformData is null.");return e.array}get textures(){const t=this._$map.get("u_textures");if(!t||!t.array)throw new Error("the UniformData is null.");return t.array}get highp(){const t=this._$map.get("u_highp");if(!t||!t.array)throw new Error("the UniformData is null.");return t.array}get mediump(){const t=this._$map.get("u_mediump");if(!t||!t.array)throw new Error("the UniformData is null.");return t.array}get integer(){const t=this._$map.get("u_integer");if(!t||!t.array)throw new Error("the UniformData is null.");return t.array}bindUniforms(){const t=this._$array.length;for(let e=0;e<t;e++){const i=this._$array[e];i.method===void 0||i.assign===void 0||(i.assign<0?i.method(i.array):i.assign>0&&(i.assign--,i.method(i.array)))}}}class Ff{constructor(){this._$attributes=[],this._$count=0}get attributes(){return this._$attributes}get count(){return this._$count}set count(t){this._$count=t}clear(){this._$attributes.length=0,this._$count=0}}class Gt{constructor(t,e,i,r){this._$gl=t,this._$context=e,this._$program=this._$createProgram(i,r),this._$uniform=new Rf(t,this._$program),this._$instance=null}get instance(){return this._$instance||(this._$instance=new Ff),this._$instance}get uniform(){return this._$uniform}_$createProgram(t,e){const i=this._$gl.createProgram();i.id=X_();const r=this._$gl.createShader(this._$gl.VERTEX_SHADER);this._$gl.shaderSource(r,t),this._$gl.compileShader(r);const n=this._$gl.createShader(this._$gl.FRAGMENT_SHADER);return this._$gl.shaderSource(n,e),this._$gl.compileShader(n),this._$gl.attachShader(i,r),this._$gl.attachShader(i,n),this._$gl.linkProgram(i),this._$gl.detachShader(i,r),this._$gl.detachShader(i,n),this._$gl.deleteShader(r),this._$gl.deleteShader(n),i}_$attachProgram(){const t=this._$context.shaderList;t.currentProgramId!==this._$program.id&&(t.currentProgramId=this._$program.id,this._$gl.useProgram(this._$program))}drawArraysInstanced(t){this._$attachProgram(),this._$context.vao.bindInstnceArray(t),this._$gl.drawArraysInstanced(this._$gl.TRIANGLE_STRIP,0,4,t.count)}_$drawImage(){this._$attachProgram(),this._$uniform.bindUniforms(),this._$context.vao.bindCommonVertexArray(),this._$gl.drawArrays(this._$gl.TRIANGLE_STRIP,0,4)}_$drawGradient(t,e){this._$attachProgram(),this._$uniform.bindUniforms(),this._$context.vao.bindGradientVertexArray(t,e),this._$gl.drawArrays(this._$gl.TRIANGLE_STRIP,0,4)}_$stroke(t){this._$attachProgram(),this._$context.blend.reset(),this._$uniform.bindUniforms(),this._$context.vao.bind(t),this._$gl.drawElements(this._$gl.TRIANGLES,t.indexCount,this._$gl.UNSIGNED_SHORT,0)}_$fill(t){this._$attachProgram(),this._$context.blend.reset(),this._$uniform.bindUniforms(),this._$context.vao.bind(t);const e=t.indexRanges,i=e[e.length-1];this._$gl.drawArrays(this._$gl.TRIANGLES,0,i.first+i.count)}_$containerClip(t,e,i){this._$attachProgram(),this._$context.blend.reset(),this._$uniform.bindUniforms(),this._$context.vao.bind(t),this._$gl.drawArrays(this._$gl.TRIANGLES,e,i)}_$drawPoints(t,e,i){this._$attachProgram(),this._$uniform.bindUniforms(),this._$context.vao.bind(t),this._$gl.drawArrays(this._$gl.POINTS,e,i)}}class On{static FUNCTION_GRID_OFF(){return`

vec2 applyMatrix(in vec2 vertex) {
    mat3 matrix = mat3(
        u_highp[0].xyz,
        u_highp[1].xyz,
        u_highp[2].xyz
    );

    vec2 position = (matrix * vec3(vertex, 1.0)).xy;

    return position;
}

`}static FUNCTION_GRID_ON(t){return`

vec2 applyMatrix(in vec2 vertex) {
    mat3 parent_matrix = mat3(
        u_highp[${t}].xyz,
        u_highp[${t+1}].xyz,
        u_highp[${t+2}].xyz
    );
    mat3 ancestor_matrix = mat3(
        u_highp[${t+3}].xyz,
        u_highp[${t+4}].xyz,
        u_highp[${t+5}].xyz
    );
    vec2 parent_offset = vec2(u_highp[${t+2}].w, u_highp[${t+3}].w);
    vec2 parent_size   = vec2(u_highp[${t+4}].w, u_highp[${t+5}].w);
    vec4 grid_min = u_highp[${t+6}];
    vec4 grid_max = u_highp[${t+7}];

    vec2 position = (parent_matrix * vec3(vertex, 1.0)).xy;
    position = (position - parent_offset) / parent_size;

    vec4 ga = grid_min;
    vec4 gb = grid_max  - grid_min;
    vec4 gc = vec4(1.0) - grid_max;

    vec2 pa = position;
    vec2 pb = position - grid_min.st;
    vec2 pc = position - grid_max.st;

    position = (ga.pq / ga.st) * min(pa, ga.st)
             + (gb.pq / gb.st) * clamp(pb, vec2(0.0), gb.st)
             + (gc.pq / gc.st) * max(vec2(0.0), pc);

    position = position * parent_size + parent_offset;
    position = (ancestor_matrix * vec3(position, 1.0)).xy;

    return position;
}

`}}class En{static TEMPLATE(t,e,i,r){const n=e-1,a=i?this.VARYING_UV_ON():"",o=i?this.STATEMENT_UV_ON():"",c=r?On.FUNCTION_GRID_ON(i?5:0):On.FUNCTION_GRID_OFF();return`#version 300 es

layout (location = 0) in vec2 a_vertex;
layout (location = 1) in vec2 a_option1;
layout (location = 2) in vec2 a_option2;
layout (location = 3) in float a_type;

uniform vec4 u_highp[${t}];

${a}

${c}

float crossVec2(in vec2 v1, in vec2 v2) {
    return v1.x * v2.y - v2.x * v1.y;
}

vec2 perpendicularVec2(in vec2 v1) {
    float face = u_highp[${n}][1];

    return face * vec2(v1.y, -v1.x);
}

vec2 calculateNormal(in vec2 direction) {
    vec2 normalized = normalize(direction);
    return perpendicularVec2(normalized);
}

vec2 calculateIntersection(in vec2 v1, in vec2 v2, in vec2 o1, in vec2 o2) {
    float t = crossVec2(o2 - o1, v2) / crossVec2(v1, v2);
    return (o1 + t * v1);
}

vec2 calculateAnchor(in vec2 position, in float convex, out vec2 v1, out vec2 v2, out vec2 o1, out vec2 o2) {
    float miter_limit = u_highp[${n}][2];

    vec2 a = applyMatrix(a_option1);
    vec2 b = applyMatrix(a_option2);

    v1 = convex * (position - a);
    v2 = convex * (b - position);
    o1 = calculateNormal(v1) + a;
    o2 = calculateNormal(v2) + position;

    vec2 anchor = calculateIntersection(v1, v2, o1, o2) - position;
    return normalize(anchor) * min(length(anchor), miter_limit);
}

void main() {
    vec2 viewport = vec2(u_highp[0].w, u_highp[1].w);
    float half_width = u_highp[${n}][0];

    vec2 position = applyMatrix(a_vertex);
    vec2 offset = vec2(0.0);
    vec2 v1, v2, o1, o2;

    if (a_type == 1.0 || a_type == 2.0) { // 
        offset = calculateNormal(a_option2 * (applyMatrix(a_option1) - position));
    } else if (a_type == 10.0) { // 
        offset = normalize(position - applyMatrix(a_option1));
        offset += a_option2 * perpendicularVec2(offset);
    } else if (a_type == 21.0) { // B
        offset = calculateAnchor(position, 1.0, v1, v2, o1, o2);
        offset = calculateIntersection(v2, perpendicularVec2(offset), o2, position + offset) - position;
    } else if (a_type == 22.0) { // A
        offset = calculateAnchor(position, 1.0, v1, v2, o1, o2);
        offset = calculateIntersection(v1, perpendicularVec2(offset), o1, position + offset) - position;
    } else if (a_type == 23.0) { // A
        offset = calculateAnchor(position, -1.0, v1, v2, o1, o2);
        offset = calculateIntersection(v1, perpendicularVec2(offset), o1, position + offset) - position;
    } else if (a_type == 24.0) { // B
        offset = calculateAnchor(position, -1.0, v1, v2, o1, o2);
        offset = calculateIntersection(v2, perpendicularVec2(offset), o2, position + offset) - position;
    } else if (a_type >= 30.0) { // 
        float face = u_highp[${n}][1];
        float rad = face * (a_type - 30.0) * 0.3488888889; /* 0.3488888889 = PI / 9.0 */
        offset = mat2(cos(rad), sin(rad), -sin(rad), cos(rad)) * vec2(1.0, 0.0);
    }
    
    offset *= half_width;
    position += offset;
    ${o}

    position /= viewport;
    position = position * 2.0 - 1.0;
    gl_Position = vec4(position.x, -position.y, 0.0, 1.0);
}

`}static VARYING_UV_ON(){return`
out vec2 v_uv;
`}static STATEMENT_UV_ON(){return`
    mat3 uv_matrix = mat3(
        u_highp[0].xyz,
        u_highp[1].xyz,
        u_highp[2].xyz
    );
    mat3 inverse_matrix = mat3(
        u_highp[3].xyz,
        u_highp[4].xyz,
        vec3(u_highp[2].w, u_highp[3].w, u_highp[4].w)
    );

    v_uv = (uv_matrix * vec3(a_vertex, 1.0)).xy;
    v_uv += offset;
    v_uv = (inverse_matrix * vec3(v_uv, 1.0)).xy;
`}}class Tn{static TEMPLATE(t,e,i,r){const n=i?this.ATTRIBUTE_BEZIER_ON():"",a=i?this.VARYING_BEZIER_ON():e?this.VARYING_UV_ON():"",o=i?this.STATEMENT_BEZIER_ON():e?this.STATEMENT_UV_ON():"",c=r?On.FUNCTION_GRID_ON(e?5:0):On.FUNCTION_GRID_OFF();return`#version 300 es

layout (location = 0) in vec2 a_vertex;
${n}

uniform vec4 u_highp[${t}];

${a}

${c}

void main() {
    vec2 viewport = vec2(u_highp[0].w, u_highp[1].w);

    ${o}

    vec2 pos = applyMatrix(a_vertex) / viewport;
    pos = pos * 2.0 - 1.0;
    gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);
}

`}static ATTRIBUTE_BEZIER_ON(){return`
layout (location = 1) in vec2 a_bezier;
`}static VARYING_UV_ON(){return`
out vec2 v_uv;
`}static VARYING_BEZIER_ON(){return`
out vec2 v_bezier;
`}static STATEMENT_UV_ON(){return`
    mat3 uv_matrix = mat3(
        u_highp[0].xyz,
        u_highp[1].xyz,
        u_highp[2].xyz
    );
    mat3 inverse_matrix = mat3(
        u_highp[3].xyz,
        u_highp[4].xyz,
        vec3(u_highp[2].w, u_highp[3].w, u_highp[4].w)
    );

    v_uv = (inverse_matrix * uv_matrix * vec3(a_vertex, 1.0)).xy;
`}static STATEMENT_BEZIER_ON(){return`
    v_bezier = a_bezier;
`}}class De{static FUNCTION_IS_INSIDE(){return`

float isInside(in vec2 uv) {
    return step(4.0, dot(step(vec4(0.0, uv.x, 0.0, uv.y), vec4(uv.x, 1.0, uv.y, 1.0)), vec4(1.0)));
}

`}static STATEMENT_INSTANCED_COLOR_TRANSFORM_ON(){return`
    src.rgb /= max(0.0001, src.a);
    src = clamp(src * mul + add, 0.0, 1.0);
    src.rgb *= src.a;
`}static STATEMENT_COLOR_TRANSFORM_ON(t){return`
    vec4 mul = u_mediump[${t}];
    vec4 add = u_mediump[${t+1}];
${De.STATEMENT_INSTANCED_COLOR_TRANSFORM_ON()}
`}}class Hr{static SOLID_COLOR(){return`#version 300 es
precision mediump float;

uniform vec4 u_mediump;

out vec4 o_color;

void main() {
    o_color = vec4(u_mediump.rgb * u_mediump.a, u_mediump.a);
}

`}static BITMAP_CLIPPED(){return`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_mediump[3];

in vec2 v_uv;
out vec4 o_color;

void main() {
    vec2 uv = vec2(v_uv.x, u_mediump[0].y - v_uv.y) / u_mediump[0].xy;

    vec4 src = texture(u_texture, uv);
    ${De.STATEMENT_COLOR_TRANSFORM_ON(1)}
    o_color = src;
}`}static BITMAP_PATTERN(){return`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_mediump[3];

in vec2 v_uv;
out vec4 o_color;

void main() {
    vec2 uv = fract(vec2(v_uv.x, -v_uv.y) / u_mediump[0].xy);
    
    vec4 src = texture(u_texture, uv);
    ${De.STATEMENT_COLOR_TRANSFORM_ON(1)}
    o_color = src;
}`}static MASK(){return`#version 300 es
precision mediump float;

in vec2 v_bezier;
out vec4 o_color;

void main() {
    vec2 px = dFdx(v_bezier);
    vec2 py = dFdy(v_bezier);

    vec2 f = (2.0 * v_bezier.x) * vec2(px.x, py.x) - vec2(px.y, py.y);
    float alpha = 0.5 - (v_bezier.x * v_bezier.x - v_bezier.y) / length(f);

    if (alpha > 0.0) {
        o_color = vec4(min(alpha, 1.0));
    } else {
        discard;
    }    
}

`}}class Pf{constructor(t,e){this._$context=t,this._$gl=e,this._$collection=yt()}getSolidColorShapeShader(t,e){const i=`s${t?"y":"n"}${e?"y":"n"}`;if(this._$collection.has(i)){const c=this._$collection.get(i);if(c)return c}const r=(e?8:3)+(t?1:0),n=r;let a;t?a=En.TEMPLATE(r,n,!1,e):a=Tn.TEMPLATE(r,!1,!1,e);const o=new Gt(this._$gl,this._$context,a,Hr.SOLID_COLOR());return this._$collection.set(i,o),o}getBitmapShapeShader(t,e,i){const r=`b${t?"y":"n"}${e?"y":"n"}${i?"y":"n"}`;if(this._$collection.has(r)){const l=this._$collection.get(r);if(l)return l}const n=(i?13:5)+(t?1:0),a=n;let o;t?o=En.TEMPLATE(n,a,!0,i):o=Tn.TEMPLATE(n,!0,!1,i);const c=e?Hr.BITMAP_PATTERN():Hr.BITMAP_CLIPPED(),u=new Gt(this._$gl,this._$context,o,c);return this._$collection.set(r,u),u}getMaskShapeShader(t,e){const i=`m${t?"y":"n"}${e?"y":"n"}`;if(this._$collection.has(i)){const c=this._$collection.get(i);if(c)return c}const r=(e?8:3)+(t?1:0),n=r;let a;t?a=En.TEMPLATE(r,n,!1,e):a=Tn.TEMPLATE(r,!1,!0,e);const o=new Gt(this._$gl,this._$context,a,Hr.MASK());return this._$collection.set(i,o),o}setSolidColorShapeUniform(t,e,i,r,n,a,o,c,u,l,h,$){const _=t.highp;let g;a?(_[0]=l.parentMatrixA,_[1]=l.parentMatrixB,_[2]=l.parentMatrixC,_[4]=l.parentMatrixD,_[5]=l.parentMatrixE,_[6]=l.parentMatrixF,_[8]=l.parentMatrixG,_[9]=l.parentMatrixH,_[10]=l.parentMatrixI,_[12]=l.ancestorMatrixA,_[13]=l.ancestorMatrixB,_[14]=l.ancestorMatrixC,_[16]=l.ancestorMatrixD,_[17]=l.ancestorMatrixE,_[18]=l.ancestorMatrixF,_[20]=l.ancestorMatrixG,_[21]=l.ancestorMatrixH,_[22]=l.ancestorMatrixI,_[3]=c,_[7]=u,_[11]=l.parentViewportX,_[15]=l.parentViewportY,_[19]=l.parentViewportW,_[23]=l.parentViewportH,_[24]=l.minXST,_[25]=l.minYST,_[26]=l.minXPQ,_[27]=l.minYPQ,_[28]=l.maxXST,_[29]=l.maxYST,_[30]=l.maxXPQ,_[31]=l.maxYPQ,g=32):(_[0]=o[0],_[1]=o[1],_[2]=o[2],_[4]=o[3],_[5]=o[4],_[6]=o[5],_[8]=o[6],_[9]=o[7],_[10]=o[8],_[3]=c,_[7]=u,g=12),e&&(_[g]=i,_[g+1]=r,_[g+2]=n);const f=t.mediump;f[0]=h[0],f[1]=h[1],f[2]=h[2],f[3]=h[3]*$}setBitmapShapeUniform(t,e,i,r,n,a,o,c,u,l,h,$,_,g,f,m,p,x,b,T,y){const v=t.highp;let L;v[0]=o[0],v[1]=o[1],v[2]=o[2],v[4]=o[3],v[5]=o[4],v[6]=o[5],v[8]=o[6],v[9]=o[7],v[10]=o[8],v[12]=c[0],v[13]=c[1],v[14]=c[2],v[16]=c[3],v[17]=c[4],v[18]=c[5],v[11]=c[6],v[15]=c[7],v[19]=c[8],v[3]=u,v[7]=l,L=20,a&&(v[L]=h.parentMatrixA,v[L+1]=h.parentMatrixB,v[L+2]=h.parentMatrixC,v[L+4]=h.parentMatrixD,v[L+5]=h.parentMatrixE,v[L+6]=h.parentMatrixF,v[L+8]=h.parentMatrixG,v[L+9]=h.parentMatrixH,v[L+10]=h.parentMatrixI,v[L+12]=h.ancestorMatrixA,v[L+13]=h.ancestorMatrixB,v[L+14]=h.ancestorMatrixC,v[L+16]=h.ancestorMatrixD,v[L+17]=h.ancestorMatrixE,v[L+18]=h.ancestorMatrixF,v[L+20]=h.ancestorMatrixG,v[L+21]=h.ancestorMatrixH,v[L+22]=h.ancestorMatrixI,v[L+11]=h.parentViewportX,v[L+15]=h.parentViewportY,v[L+19]=h.parentViewportW,v[L+23]=h.parentViewportH,v[L+24]=h.minXST,v[L+25]=h.minYST,v[L+26]=h.minXPQ,v[L+27]=h.minYPQ,v[L+28]=h.maxXST,v[L+29]=h.maxYST,v[L+30]=h.maxXPQ,v[L+31]=h.maxYPQ,L=52),e&&(v[L]=i,v[L+1]=r,v[L+2]=n);const B=t.mediump;B[0]=$,B[1]=_,B[4]=g,B[5]=f,B[6]=m,B[7]=p,B[8]=x,B[9]=b,B[10]=T,B[11]=y}setMaskShapeUniform(t,e,i,r,n,a,o,c,u,l,h,$,_,g=null){const f=t.highp;e&&g?(f[0]=g.parentMatrixA,f[1]=g.parentMatrixB,f[2]=g.parentMatrixC,f[4]=g.parentMatrixD,f[5]=g.parentMatrixE,f[6]=g.parentMatrixF,f[8]=g.parentMatrixG,f[9]=g.parentMatrixH,f[10]=g.parentMatrixI,f[12]=g.ancestorMatrixA,f[13]=g.ancestorMatrixB,f[14]=g.ancestorMatrixC,f[16]=g.ancestorMatrixD,f[17]=g.ancestorMatrixE,f[18]=g.ancestorMatrixF,f[20]=g.ancestorMatrixG,f[21]=g.ancestorMatrixH,f[22]=g.ancestorMatrixI,f[3]=$,f[7]=_,f[11]=g.parentViewportX,f[15]=g.parentViewportY,f[19]=g.parentViewportW,f[23]=g.parentViewportH,f[24]=g.minXST,f[25]=g.minYST,f[26]=g.minXPQ,f[27]=g.minYPQ,f[28]=g.maxXST,f[29]=g.maxYST,f[30]=g.maxXPQ,f[31]=g.maxYPQ):(f[0]=i,f[1]=r,f[2]=n,f[4]=a,f[5]=o,f[6]=c,f[8]=u,f[9]=l,f[10]=h,f[3]=$,f[7]=_)}setMaskShapeUniformIdentity(t,e,i){const r=t.highp;r[0]=1,r[1]=0,r[2]=0,r[4]=0,r[5]=1,r[6]=0,r[8]=0,r[9]=0,r[10]=1,r[3]=e,r[7]=i}}class kf{static TEMPLATE(t,e,i,r,n){const a=i?this.STATEMENT_GRADIENT_TYPE_RADIAL(e,r):this.STATEMENT_GRADIENT_TYPE_LINEAR(e);let o;switch(n){case"reflect":o="1.0 - abs(fract(t * 0.5) * 2.0 - 1.0)";break;case"repeat":o="fract(t)";break;default:o="clamp(t, 0.0, 1.0)";break}return`#version 300 es
precision highp float;

uniform sampler2D u_texture;
uniform vec4 u_highp[${t}];

in vec2 v_uv;
out vec4 o_color;

void main() {
    vec2 p = v_uv;
    ${a}
    t = ${o};
    o_color = texture(u_texture, vec2(t, 0.5));
}

`}static STATEMENT_GRADIENT_TYPE_LINEAR(t){return`
    vec2 a = u_highp[${t}].xy;
    vec2 b = u_highp[${t}].zw;

    vec2 ab = b - a;
    vec2 ap = p - a;

    float t = dot(ab, ap) / dot(ab, ab);
`}static STATEMENT_GRADIENT_TYPE_RADIAL(t,e){const i=e?this.STATEMENT_FOCAL_POINT_ON(t):this.STATEMENT_FOCAL_POINT_OFF();return`
    float radius = u_highp[${t}][0];

    vec2 coord = p / radius;
    ${i}
`}static STATEMENT_FOCAL_POINT_OFF(){return`
    float t = length(coord);
`}static STATEMENT_FOCAL_POINT_ON(t){return`
    vec2 focal = vec2(u_highp[${t}][1], 0.0);

    vec2 dir = normalize(coord - focal);

    float a = dot(dir, dir);
    float b = 2.0 * dot(dir, focal);
    float c = dot(focal, focal) - 1.0;
    float x = (-b + sqrt(b * b - 4.0 * a * c)) / (2.0 * a);

    float t = distance(focal, coord) / distance(focal, focal + dir * x);
`}}class Nf{constructor(t,e){this._$context=t,this._$gl=e,this._$collection=yt()}getGradientShapeShader(t,e,i,r,n){const a=this.createCollectionKey(t,e,i,r,n);if(this._$collection.has(a)){const h=this._$collection.get(a);if(h)return h}const o=(e?13:5)+(t?1:0)+1,c=o-1;let u;t?u=En.TEMPLATE(o,c,!0,e):u=Tn.TEMPLATE(o,!0,!1,e);const l=new Gt(this._$gl,this._$context,u,kf.TEMPLATE(o,c,i,r,n));return this._$collection.set(a,l),l}createCollectionKey(t,e,i,r,n){const a=t?"y":"n",o=e?"y":"n",c=i?"y":"n",u=i&&r?"y":"n";let l=0;switch(n){case"reflect":l=1;break;case"repeat":l=2;break}return`${a}${o}${c}${u}${l}`}setGradientShapeUniform(t,e,i,r,n,a,o,c,u,l,h,$,_,g){const f=t.highp;f[0]=o[0],f[1]=o[1],f[2]=o[2],f[4]=o[3],f[5]=o[4],f[6]=o[5],f[8]=o[6],f[9]=o[7],f[10]=o[8],f[12]=c[0],f[13]=c[1],f[14]=c[2],f[16]=c[3],f[17]=c[4],f[18]=c[5],f[11]=c[6],f[15]=c[7],f[19]=c[8],f[3]=u,f[7]=l;let m=20;a&&(f[m]=h.parentMatrixA,f[m+1]=h.parentMatrixB,f[m+2]=h.parentMatrixC,f[m+4]=h.parentMatrixD,f[m+5]=h.parentMatrixE,f[m+6]=h.parentMatrixF,f[m+8]=h.parentMatrixG,f[m+9]=h.parentMatrixH,f[m+10]=h.parentMatrixI,f[m+12]=h.ancestorMatrixA,f[m+13]=h.ancestorMatrixB,f[m+14]=h.ancestorMatrixC,f[m+16]=h.ancestorMatrixD,f[m+17]=h.ancestorMatrixE,f[m+18]=h.ancestorMatrixF,f[m+20]=h.ancestorMatrixG,f[m+21]=h.ancestorMatrixH,f[m+22]=h.ancestorMatrixI,f[m+11]=h.parentViewportX,f[m+15]=h.parentViewportY,f[m+19]=h.parentViewportW,f[m+23]=h.parentViewportH,f[m+24]=h.minXST,f[m+25]=h.minYST,f[m+26]=h.minXPQ,f[m+27]=h.minYPQ,f[m+28]=h.maxXST,f[m+29]=h.maxYST,f[m+30]=h.maxXPQ,f[m+31]=h.maxYPQ,m=52),e&&(f[m]=i,f[m+1]=r,f[m+2]=n,m+=4),$?(f[m]=_[5],f[m+1]=g):(f[m]=_[0],f[m+1]=_[1],f[m+2]=_[2],f[m+3]=_[3])}}class Me{static TEXTURE(){return`#version 300 es

layout (location = 0) in vec2 a_vertex;

out vec2 v_coord;

void main() {
    v_coord = a_vertex;

    vec2 position = a_vertex * 2.0 - 1.0;
    gl_Position = vec4(position, 0.0, 1.0);
}

`}static BLEND(){return`#version 300 es

layout (location = 0) in vec2 a_vertex;

uniform vec4 u_highp[4];

out vec2 v_coord;

void main() {
    v_coord = a_vertex;

    vec2 offset   = u_highp[0].xy;
    vec2 size     = u_highp[0].zw;
    mat3 matrix   = mat3(u_highp[1].xyz, u_highp[2].xyz, u_highp[3].xyz);
    vec2 viewport = vec2(u_highp[1].w, u_highp[2].w);

    vec2 position = vec2(a_vertex.x, 1.0 - a_vertex.y);
    position = position * size + offset;
    position = (matrix * vec3(position, 1.0)).xy;
    position /= viewport;

    position = position * 2.0 - 1.0;
    gl_Position = vec4(position.x, -position.y, 0.0, 1.0);
}

`}static INSTANCE_BLEND(){return`#version 300 es

layout (location = 0) in vec2 a_vertex;

uniform vec4 u_highp[5];

out vec2 v_src_coord;
out vec2 v_dst_coord;

void main() {
    vec4 rect     = vec4(u_highp[0].x, u_highp[0].y, u_highp[0].z, u_highp[0].w);
    vec2 size     = vec2(u_highp[4].x, u_highp[4].y);
    mat3 matrix   = mat3(u_highp[1].xyz, u_highp[2].xyz, u_highp[3].xyz);
    vec2 viewport = vec2(u_highp[1].w, u_highp[2].w);

    v_src_coord = a_vertex * rect.zw + rect.xy;
    v_dst_coord = a_vertex;

    vec2 position = vec2(a_vertex.x, 1.0 - a_vertex.y);
    position = position * size;
    position = (matrix * vec3(position, 1.0)).xy;
    position /= viewport;

    position = position * 2.0 - 1.0;
    gl_Position = vec4(position.x, -position.y, 0.0, 1.0);
}

`}static INSTANCE(){return`#version 300 es

layout (location = 0) in vec2 a_vertex;
layout (location = 1) in vec4 a_rect;
layout (location = 2) in vec4 a_size;
layout (location = 3) in vec2 a_offset;
layout (location = 4) in vec4 a_matrix;
layout (location = 5) in vec4 a_mul;
layout (location = 6) in vec4 a_add;

out vec2 v_coord;
out vec4 mul;
out vec4 add;

void main() {
    v_coord = a_vertex * a_rect.zw + a_rect.xy;
    mul = a_mul;
    add = a_add;

    vec2 position = vec2(a_vertex.x, 1.0 - a_vertex.y);
    position = position * a_size.xy;
    mat3 matrix = mat3(a_matrix.x, a_matrix.y, 0.0, a_matrix.z, a_matrix.w, 0.0, a_offset.x, a_offset.y, 1.0);
    position = (matrix * vec3(position, 1.0)).xy;
    position /= a_size.zw;

    position = position * 2.0 - 1.0;
    gl_Position = vec4(position.x, -position.y, 0.0, 1.0);
}

`}static BLEND_CLIP(){return`#version 300 es

layout (location = 0) in vec2 a_vertex;

uniform vec4 u_highp[4];

out vec2 v_coord;

void main() {
    v_coord = a_vertex;

    vec2 offset     = u_highp[0].xy;
    vec2 size       = u_highp[0].zw;
    mat3 inv_matrix = mat3(u_highp[1].xyz, u_highp[2].xyz, u_highp[3].xyz);
    vec2 viewport   = vec2(u_highp[1].w, u_highp[2].w);

    vec2 position = vec2(a_vertex.x, 1.0 - a_vertex.y);
    position *= viewport;
    position = (inv_matrix * vec3(position, 1.0)).xy;
    position = (position - offset) / size;

    position = position * 2.0 - 1.0;
    gl_Position = vec4(position.x, -position.y, 0.0, 1.0);
}

`}}class Df{static TEMPLATE(t,e,i){let r="";for(let a=1;a<e;a++){const o=a-1,c=a,u=`u_mediump[${e+d.floor(o/4)}][${o%4}]`,l=`u_mediump[${e+d.floor(c/4)}][${c%4}]`,h=`u_mediump[${o}]`,$=`u_mediump[${c}]`;r+=`
    if (t <= ${l}) {
        return mix(${h}, ${$}, (t - ${u}) / (${l} - ${u}));
    }
`}const n=i?"color = pow(color, vec4(0.45454545));":"";return`#version 300 es
precision mediump float;

uniform vec4 u_mediump[${t}];

in vec2 v_coord;
out vec4 o_color;

vec4 getGradientColor(in float t) {
    if (t <= u_mediump[${e}][0]) {
        return u_mediump[0];
    }
    ${r}
    return u_mediump[${e-1}];
}

void main() {
    vec4 color = getGradientColor(v_coord.x);
    ${n}
    color.rgb *= color.a;

    o_color = color;
}

`}}class Uf{constructor(t,e){this._$context=t,this._$gl=e,this._$collection=yt()}getGradientLUTShader(t,e){const n=`l${("00"+t).slice(-3)}${e?"y":"n"}`;if(this._$collection.has(n)){const c=this._$collection.get(n);if(c)return c}const a=d.ceil(t*5/4),o=new Gt(this._$gl,this._$context,Me.TEXTURE(),Df.TEMPLATE(a,t,e));return this._$collection.set(n,o),o}setGradientLUTUniformForShape(t,e,i,r,n){let a=0;const o=t.mediump;for(let c=i;c<r;c++){const u=e[c][1];o[a++]=n[u[0]],o[a++]=n[u[1]],o[a++]=n[u[2]],o[a++]=n[u[3]]}for(let c=i;c<r;c++)o[a++]=e[c][0]}setGradientLUTUniformForFilter(t,e,i,r,n,a){let o=0;const c=t.mediump;for(let u=n;u<a;u++){const l=i[u];c[o++]=(l>>16)/255,c[o++]=(l>>8&255)/255,c[o++]=(l&255)/255,c[o++]=r[u]}for(let u=n;u<a;u++)c[o++]=e[u]}}class Yf{static TEMPLATE(t,e,i,r,n,a,o,c,u){let l=0;const h=i?this.STATEMENT_BASE_TEXTURE_TRANSFORM(l++):"",$=r?this.STATEMENT_BLUR_TEXTURE_TRANSFORM(l++):this.STATEMENT_BLUR_TEXTURE(),_=a==="inner",g=l;let f=l*4,m;u?m=n?this.STATEMENT_GLOW(!1,i,c,u,g,f):this.STATEMENT_BEVEL(i,r,c,u,g,f):n?(f+=4,m=this.STATEMENT_GLOW(_,i,c,u,g,f)):(f+=8,m=this.STATEMENT_BEVEL(i,r,c,u,g,f));let p;switch(a){case"outer":p=o?"blur - blur * base.a":"base + blur - blur * base.a";break;case"full":p=o?"blur":"base - base * blur.a + blur";break;case"inner":default:p="blur";break}return`#version 300 es
precision mediump float;

uniform sampler2D u_textures[${t}];
uniform vec4 u_mediump[${e}];

in vec2 v_coord;
out vec4 o_color;

${De.FUNCTION_IS_INSIDE()}

void main() {
    ${h}
    ${$}
    ${m}
    o_color = ${p};
}

`}static STATEMENT_BASE_TEXTURE_TRANSFORM(t){return`
    vec2 base_scale  = u_mediump[${t}].xy;
    vec2 base_offset = u_mediump[${t}].zw;

    vec2 uv = v_coord * base_scale - base_offset;
    vec4 base = mix(vec4(0.0), texture(u_textures[1], uv), isInside(uv));
`}static STATEMENT_BLUR_TEXTURE(){return`
    vec4 blur = texture(u_textures[0], v_coord);
`}static STATEMENT_BLUR_TEXTURE_TRANSFORM(t){return`
    vec2 blur_scale  = u_mediump[${t}].xy;
    vec2 blur_offset = u_mediump[${t}].zw;

    vec2 st = v_coord * blur_scale - blur_offset;
    vec4 blur = mix(vec4(0.0), texture(u_textures[0], st), isInside(st));
`}static STATEMENT_GLOW(t,e,i,r,n,a){const o=t?"blur.a = 1.0 - blur.a;":"",c=i?this.STATEMENT_GLOW_STRENGTH(a):"",u=r?this.STATEMENT_GLOW_GRADIENT_COLOR(e):this.STATEMENT_GLOW_SOLID_COLOR(n);return`
    ${o}
    ${c}
    ${u}
`}static STATEMENT_GLOW_STRENGTH(t){const e=d.floor(t/4),i=t%4;return`
    float strength = u_mediump[${e}][${i}];
    blur.a = clamp(blur.a * strength, 0.0, 1.0);
`}static STATEMENT_GLOW_SOLID_COLOR(t){return`
    vec4 color = u_mediump[${t}];
    blur = color * blur.a;
`}static STATEMENT_GLOW_GRADIENT_COLOR(t){return`
    blur = texture(u_textures[${t?2:1}], vec2(blur.a, 0.5));
`}static STATEMENT_BEVEL(t,e,i,r,n,a){const o=e?this.STATEMENT_BLUR_TEXTURE_TRANSFORM_2():this.STATEMENT_BLUR_TEXTURE_2(),c=i?this.STATEMENT_BEVEL_STRENGTH(a):"",u=r?this.STATEMENT_BEVEL_GRADIENT_COLOR(t):this.STATEMENT_BEVEL_SOLID_COLOR(n);return`
    ${o}
    float highlight_alpha = blur.a - blur2.a;
    float shadow_alpha    = blur2.a - blur.a;
    ${c}
    highlight_alpha = clamp(highlight_alpha, 0.0, 1.0);
    shadow_alpha    = clamp(shadow_alpha, 0.0, 1.0);
    ${u}
`}static STATEMENT_BLUR_TEXTURE_2(){return`
    vec4 blur2 = texture(u_textures[0], 1.0 - v_coord);
`}static STATEMENT_BLUR_TEXTURE_TRANSFORM_2(){return`
    vec2 pq = (1.0 - v_coord) * blur_scale - blur_offset;
    vec4 blur2 = mix(vec4(0.0), texture(u_textures[0], pq), isInside(pq));
`}static STATEMENT_BEVEL_STRENGTH(t){const e=d.floor(t/4),i=t%4;return`
    float strength = u_mediump[${e}][${i}];
    highlight_alpha *= strength;
    shadow_alpha    *= strength;
`}static STATEMENT_BEVEL_SOLID_COLOR(t){return`
    vec4 highlight_color = u_mediump[${t}];
    vec4 shadow_color    = u_mediump[${t+1}];
    blur = highlight_color * highlight_alpha + shadow_color * shadow_alpha;
`}static STATEMENT_BEVEL_GRADIENT_COLOR(t){return`
    blur = texture(u_textures[${t?2:1}], vec2(
        0.5019607843137255 - 0.5019607843137255 * shadow_alpha + 0.4980392156862745 * highlight_alpha,
        0.5
    ));
`}}class Xf{static TEMPLATE(t){const e=t.toFixed(1);return`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_mediump;

in vec2 v_coord;
out vec4 o_color;

void main() {
    vec2  offset   = u_mediump.xy;
    float fraction = u_mediump.z;
    float samples  = u_mediump.w;
    
    vec4 color = texture(u_texture, v_coord);

    for (float i = 1.0; i < ${e}; i += 1.0) {
        color += texture(u_texture, v_coord + offset * i);
        color += texture(u_texture, v_coord - offset * i);
    }
    color += texture(u_texture, v_coord + offset * ${e}) * fraction;
    color += texture(u_texture, v_coord - offset * ${e}) * fraction;
    color /= samples;

    o_color = color;
}

`}}class Wf{static TEMPLATE(){return`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_mediump[5];

in vec2 v_coord;
out vec4 o_color;

void main() {
    mat4 mul = mat4(u_mediump[0], u_mediump[1], u_mediump[2], u_mediump[3]);
    vec4 add = u_mediump[4];
    
    vec4 color = texture(u_texture, v_coord);

    color.rgb /= max(0.0001, color.a);
    color = clamp(color * mul + add, 0.0, 1.0);
    color.rgb *= color.a;

    o_color = color;
}

`}}class Vf{static TEMPLATE(t,e,i,r,n){const a=d.floor(e*.5),o=d.floor(i*.5),c=e*i;let u="";const l=n?1:2;for(let _=0;_<c;++_){const g=l+d.floor(_/4),f=_%4;u+=`
    result += getWeightedColor(${_}, u_mediump[${g}][${f}]);
`}const h=r?"result.a = texture(u_texture, v_coord).a;":"",$=n?"":`
    vec4 substitute_color = u_mediump[1];
    color = mix(substitute_color, color, isInside(uv));
`;return`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_mediump[${t}];

in vec2 v_coord;
out vec4 o_color;

${De.FUNCTION_IS_INSIDE()}

vec4 getWeightedColor (in int i, in float weight) {
    vec2 rcp_size = u_mediump[0].xy;

    int i_div_x = i / ${e};
    int i_mod_x = i - ${e} * i_div_x;
    vec2 offset = vec2(i_mod_x - ${a}, ${o} - i_div_x);
    vec2 uv = v_coord + offset * rcp_size;

    vec4 color = texture(u_texture, uv);
    color.rgb /= max(0.0001, color.a);
    ${$}

    return color * weight;
}

void main() {
    float rcp_divisor = u_mediump[0].z;
    float bias        = u_mediump[0].w;

    vec4 result = vec4(0.0);
    ${u}
    result = clamp(result * rcp_divisor + bias, 0.0, 1.0);
    ${h}

    result.rgb *= result.a;
    o_color = result;
}

`}}class Gf{static TEMPLATE(t,e,i,r){let n,a,o;switch(e){case 1:n="map_color.r";break;case 2:n="map_color.g";break;case 4:n="map_color.b";break;case 8:n="map_color.a";break;default:n="0.5";break}switch(i){case 1:a="map_color.r";break;case 2:a="map_color.g";break;case 4:a="map_color.b";break;case 8:a="map_color.a";break;default:a="0.5";break}switch(r){case"clamp":o=`
    vec4 source_color = texture(u_textures[0], uv);
`;break;case"ignore":o=`
    vec4 source_color =texture(u_textures[0], mix(v_coord, uv, step(abs(uv - vec2(0.5)), vec2(0.5))));
`;break;case"color":o=`
    vec4 substitute_color = u_mediump[2];
    vec4 source_color = mix(substitute_color, texture(u_textures[0], uv), isInside(uv));
`;break;case"wrap":default:o=`
    vec4 source_color = texture(u_textures[0], fract(uv));
`;break}return`#version 300 es
precision mediump float;

uniform sampler2D u_textures[2];
uniform vec4 u_mediump[${t}];

in vec2 v_coord;
out vec4 o_color;

${De.FUNCTION_IS_INSIDE()}

void main() {
    vec2 uv_to_st_scale  = u_mediump[0].xy;
    vec2 uv_to_st_offset = u_mediump[0].zw;
    vec2 scale           = u_mediump[1].xy;

    vec2 st = v_coord * uv_to_st_scale - uv_to_st_offset;
    vec4 map_color = texture(u_textures[1], st);

    vec2 offset = vec2(${n}, ${a}) - 0.5;
    vec2 uv = v_coord + offset * scale;
    ${o}

    o_color = mix(texture(u_textures[0], v_coord), source_color, isInside(st));
}

`}}class zf{constructor(t,e){this._$context=t,this._$gl=e,this._$collection=yt()}getBlurFilterShader(t){const e=`b${t}`;if(this._$collection.has(e)){const r=this._$collection.get(e);if(r)return r}const i=new Gt(this._$gl,this._$context,Me.TEXTURE(),Xf.TEMPLATE(t));return this._$collection.set(e,i),i}getBitmapFilterShader(t,e,i,r,n,a,o){const _=`f${t?"y":"n"}${e?"y":"n"}${i?"y":"n"}${r}${n?"y":"n"}${a?"y":"n"}`;if(this._$collection.has(_)){const p=this._$collection.get(_);if(p)return p}let g=1;t&&g++,o&&g++;let f=(t?4:0)+(e?4:0)+(a?1:0);o||(f+=i?4:8),f=d.ceil(f/4);const m=new Gt(this._$gl,this._$context,Me.TEXTURE(),Yf.TEMPLATE(g,f,t,e,i,r,n,a,o));return this._$collection.set(_,m),m}getColorMatrixFilterShader(){const t="m";if(this._$collection.has(t)){const i=this._$collection.get(t);if(i)return i}const e=new Gt(this._$gl,this._$context,Me.TEXTURE(),Wf.TEMPLATE());return this._$collection.set(t,e),e}getConvolutionFilterShader(t,e,i,r){const n=("0"+t).slice(-2),a=("0"+e).slice(-2),u=`c${n}${a}${i?"y":"n"}${r?"y":"n"}`;if(this._$collection.has(u)){const $=this._$collection.get(u);if($)return $}const l=(r?1:2)+d.ceil(t*e/4),h=new Gt(this._$gl,this._$context,Me.TEXTURE(),Vf.TEMPLATE(l,t,e,i,r));return this._$collection.set(u,h),h}getDisplacementMapFilterShader(t,e,i){const r=`d${t}${e}${i}`;if(this._$collection.has(r)){const o=this._$collection.get(r);if(o)return o}const n=i==="color"?3:2,a=new Gt(this._$gl,this._$context,Me.TEXTURE(),Gf.TEMPLATE(n,t,e,i));return this._$collection.set(r,a),a}setBlurFilterUniform(t,e,i,r,n,a){const o=t.mediump;r?(o[0]=1/e,o[1]=0):(o[0]=0,o[1]=1/i),o[2]=n,o[3]=a}setBitmapFilterUniform(t,e,i,r,n,a,o,c,u,l,h,$,_,g,f,m,p,x,b,T,y,v,L,B,F){let R;v?(R=t.textures,R[0]=0,R[1]=1,F&&(R[2]=2)):F&&(R=t.textures,R[0]=0,R[1]=2);const w=t.mediump;let I=0;v&&(w[I]=e/r,w[I+1]=i/n,w[I+2]=a/r,w[I+3]=(i-n-o)/n,I+=4),L&&(w[I]=e/c,w[I+1]=i/u,w[I+2]=l/c,w[I+3]=(i-u-h)/u,I+=4),F||($?(w[I]=g,w[I+1]=f,w[I+2]=m,w[I+3]=p,I+=4):(w[I]=g,w[I+1]=f,w[I+2]=m,w[I+3]=p,w[I+4]=x,w[I+5]=b,w[I+6]=T,w[I+7]=y,I+=8)),B&&(w[I]=_)}setColorMatrixFilterUniform(t,e){const i=t.mediump;i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[5],i[5]=e[6],i[6]=e[7],i[7]=e[8],i[8]=e[10],i[9]=e[11],i[10]=e[12],i[11]=e[13],i[12]=e[15],i[13]=e[16],i[14]=e[17],i[15]=e[18],i[16]=e[4]/255,i[17]=e[9]/255,i[18]=e[14]/255,i[19]=e[19]/255}setConvolutionFilterUniform(t,e,i,r,n,a,o,c,u,l,h){const $=t.mediump;$[0]=1/e,$[1]=1/i,$[2]=1/n,$[3]=a/255;let _=4;o||($[_]=c,$[_+1]=u,$[_+2]=l,$[_+3]=h,_+=4);const g=r.length;for(let f=0;f<g;f++)$[_++]=r[f]}setDisplacementMapFilterUniform(t,e,i,r,n,a,o,c,u,l,h,$,_,g){const f=t.textures;f[0]=0,f[1]=1;const m=t.mediump;m[0]=r/e,m[1]=n/i,m[2]=a/e,m[3]=(n-i-o)/i,m[4]=c/r,m[5]=-u/n,l==="color"&&(m[8]=h,m[9]=$,m[10]=_,m[11]=g)}}class ka{static TEMPLATE(t){const e=t?"uniform vec4 u_mediump[2];":"",i=t?De.STATEMENT_COLOR_TRANSFORM_ON(0):"";return`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
${e}

in vec2 v_coord;
out vec4 o_color;

void main() {
    vec4 src = texture(u_texture, v_coord);
    ${i}
    o_color = src;
}

`}static INSTANCE_TEMPLATE(){return`#version 300 es
precision mediump float;

uniform sampler2D u_texture;

in vec4 mul;
in vec4 add;
in vec2 v_coord;
out vec4 o_color;

void main() {
    vec4 src = texture(u_texture, v_coord);

    if (mul.x != 1.0 || mul.y != 1.0 || mul.z != 1.0 || mul.w != 1.0
        || add.x != 0.0 || add.y != 0.0 || add.z != 0.0 || add.w != 0.0
    ) {
        src.rgb /= max(0.0001, src.a);
        src = clamp(src * mul + add, 0.0, 1.0);
        src.rgb *= src.a;
    }
    
    o_color = src;
}

`}}class Vc{static TEMPLATE(t,e){let i;switch(t){case"subtract":i=this.FUNCTION_SUBTRACT();break;case"multiply":i=this.FUNCTION_MULTIPLY();break;case"lighten":i=this.FUNCTION_LIGHTEN();break;case"darken":i=this.FUNCTION_DARKEN();break;case"overlay":i=this.FUNCTION_OVERLAY();break;case"hardlight":i=this.FUNCTION_HARDLIGHT();break;case"difference":i=this.FUNCTION_DIFFERENCE();break;case"invert":i=this.FUNCTION_INVERT();break;default:i=this.FUNCTION_NORMAL();break}const r=e?"uniform vec4 u_mediump[2];":"",n=e?De.STATEMENT_COLOR_TRANSFORM_ON(0):"";return`#version 300 es
precision mediump float;

uniform sampler2D u_textures[2];
${r}

in vec2 v_coord;
out vec4 o_color;

${i}

void main() {
    vec4 dst = texture(u_textures[0], v_coord);
    vec4 src = texture(u_textures[1], v_coord);
    ${n}
    o_color = blend(src, dst);
}

`}static INSTANCE_TEMPLATE(t,e){let i;switch(t){case"subtract":i=this.FUNCTION_SUBTRACT();break;case"multiply":i=this.FUNCTION_MULTIPLY();break;case"lighten":i=this.FUNCTION_LIGHTEN();break;case"darken":i=this.FUNCTION_DARKEN();break;case"overlay":i=this.FUNCTION_OVERLAY();break;case"hardlight":i=this.FUNCTION_HARDLIGHT();break;case"difference":i=this.FUNCTION_DIFFERENCE();break;case"invert":i=this.FUNCTION_INVERT();break;default:i=this.FUNCTION_NORMAL();break}const r=e?"uniform vec4 u_mediump[2];":"",n=e?De.STATEMENT_COLOR_TRANSFORM_ON(0):"";return`#version 300 es
precision mediump float;

uniform sampler2D u_textures[2];
${r}

in vec2 v_src_coord;
in vec2 v_dst_coord;
out vec4 o_color;

${i}

void main() {
    vec4 dst = texture(u_textures[0], v_dst_coord);
    vec4 src = texture(u_textures[1], v_src_coord);
    ${n}
    o_color = blend(src, dst);
}

`}static FUNCTION_NORMAL(){return`

vec4 blend (in vec4 src, in vec4 dst) {
    return src + dst - dst * src.a;
}

`}static FUNCTION_SUBTRACT(){return`

vec4 blend (in vec4 src, in vec4 dst) {
    if (src.a == 0.0) { return dst; }
    if (dst.a == 0.0) { return src; }

    vec4 a = src - src * dst.a;
    vec4 b = dst - dst * src.a;

    src.rgb /= src.a;
    dst.rgb /= dst.a;

    vec4 c = vec4(dst.rgb - src.rgb, src.a * dst.a);
    c.rgb *= c.a;

    return a + b + c;
}

`}static FUNCTION_MULTIPLY(){return`

vec4 blend (in vec4 src, in vec4 dst) {
    vec4 a = src - src * dst.a;
    vec4 b = dst - dst * src.a;
    vec4 c = src * dst;

    return a + b + c;
}

`}static FUNCTION_LIGHTEN(){return`

vec4 blend (in vec4 src, in vec4 dst) {
    if (src.a == 0.0) { return dst; }
    if (dst.a == 0.0) { return src; }

    vec4 a = src - src * dst.a;
    vec4 b = dst - dst * src.a;

    src.rgb /= src.a;
    dst.rgb /= dst.a;

    vec4 c = vec4(mix(src.rgb, dst.rgb, step(src.rgb, dst.rgb)), src.a * dst.a);
    c.rgb *= c.a;

    return a + b + c;
}

`}static FUNCTION_DARKEN(){return`

vec4 blend (in vec4 src, in vec4 dst) {
    if (src.a == 0.0) { return dst; }
    if (dst.a == 0.0) { return src; }

    vec4 a = src - src * dst.a;
    vec4 b = dst - dst * src.a;

    src.rgb /= src.a;
    dst.rgb /= dst.a;

    vec4 c = vec4(mix(src.rgb, dst.rgb, step(dst.rgb, src.rgb)), src.a * dst.a);
    c.rgb *= c.a;

    return a + b + c;
}

`}static FUNCTION_OVERLAY(){return`

vec4 blend (in vec4 src, in vec4 dst) {
    if (src.a == 0.0) { return dst; }
    if (dst.a == 0.0) { return src; }

    vec4 a = src - src * dst.a;
    vec4 b = dst - dst * src.a;

    src.rgb /= src.a;
    dst.rgb /= dst.a;

    vec4 mul = src * dst;
    vec3 c1 = 2.0 * mul.rgb;
    vec3 c2 = 2.0 * (src.rgb + dst.rgb - mul.rgb) - 1.0;
    vec4 c = vec4(mix(c1, c2, step(vec3(0.5), dst.rgb)), mul.a);
    c.rgb *= c.a;

    return a + b + c;
}

`}static FUNCTION_HARDLIGHT(){return`

vec4 blend (in vec4 src, in vec4 dst) {
    if (src.a == 0.0) { return dst; }
    if (dst.a == 0.0) { return src; }

    vec4 a = src - src * dst.a;
    vec4 b = dst - dst * src.a;

    src.rgb /= src.a;
    dst.rgb /= dst.a;

    vec4 mul = src * dst;
    vec3 c1 = 2.0 * mul.rgb;
    vec3 c2 = 2.0 * (src.rgb + dst.rgb - mul.rgb) - 1.0;
    vec4 c = vec4(mix(c1, c2, step(vec3(0.5), src.rgb)), mul.a);
    c.rgb *= c.a;

    return a + b + c;
}

`}static FUNCTION_DIFFERENCE(){return`

vec4 blend (in vec4 src, in vec4 dst) {
    if (src.a == 0.0) { return dst; }
    if (dst.a == 0.0) { return src; }

    vec4 a = src - src * dst.a;
    vec4 b = dst - dst * src.a;

    src.rgb /= src.a;
    dst.rgb /= dst.a;

    vec4 c = vec4(abs(src.rgb - dst.rgb), src.a * dst.a);
    c.rgb *= c.a;

    return a + b + c;
}

`}static FUNCTION_INVERT(){return`

vec4 blend (in vec4 src, in vec4 dst) {
    if (src.a == 0.0) { return dst; }
    if (dst.a == 0.0) { return src; }

    vec4 b = dst - dst * src.a;
    vec4 c = vec4(src.a - dst.rgb * src.a, src.a);

    return b + c;
}

`}}class Hf{constructor(t,e){this._$context=t,this._$gl=e,this._$collection=yt()}getInstanceShader(){const t="i";if(this._$collection.has(t)){const i=this._$collection.get(t);if(i)return i}const e=new Gt(this._$gl,this._$context,Me.INSTANCE(),ka.INSTANCE_TEMPLATE());return this._$collection.set(t,e),e}getNormalBlendShader(t){const e=`n${t?"y":"n"}`;if(this._$collection.has(e)){const r=this._$collection.get(e);if(r)return r}const i=new Gt(this._$gl,this._$context,Me.BLEND(),ka.TEMPLATE(t));return this._$collection.set(e,i),i}getClipShader(){const t="c";if(this._$collection.has(t)){const i=this._$collection.get(t);if(i)return i}const e=new Gt(this._$gl,this._$context,Me.BLEND_CLIP(),ka.TEMPLATE(!1));return this._$collection.set(t,e),e}getBlendShader(t,e){const i=`${t}${e?"y":"n"}`;if(this._$collection.has(i)){const n=this._$collection.get(i);if(n)return n}const r=new Gt(this._$gl,this._$context,Me.BLEND(),Vc.TEMPLATE(t,e));return this._$collection.set(i,r),r}getInstanceBlendShader(t,e){const i=`i${t}${e?"y":"n"}`;if(this._$collection.has(i)){const n=this._$collection.get(i);if(n)return n}const r=new Gt(this._$gl,this._$context,Me.INSTANCE_BLEND(),Vc.INSTANCE_TEMPLATE(t,e));return this._$collection.set(i,r),r}setNormalBlendUniform(t,e,i,r,n,a,o,c,u,l,h,$,_,g,f,m,p){const x=t.highp;if(x[0]=e,x[1]=i,x[2]=r,x[3]=n,x[4]=a[0],x[5]=a[1],x[6]=a[2],x[8]=a[3],x[9]=a[4],x[10]=a[5],x[12]=a[6],x[13]=a[7],x[14]=a[8],x[7]=o,x[11]=c,u){const b=t.mediump;b[0]=l,b[1]=h,b[2]=$,b[3]=_,b[4]=g,b[5]=f,b[6]=m,b[7]=p}}pushNormalBlend(t,e,i,r,n,a,o,c,u=1,l=1,h=1,$=1,_=0,g=0,f=0,m=0){t.attributes.push(e/rt,i/rt,r/rt,n/rt,r,n,o,c,a[6],a[7],a[0],a[1],a[3],a[4],u,l,h,$,_,g,f,m),t.count++}setClipUniform(t,e,i,r,n,a,o,c){const u=t.highp;u[0]=e,u[1]=i,u[2]=r,u[3]=n,u[4]=a[0],u[5]=a[1],u[6]=a[2],u[8]=a[3],u[9]=a[4],u[10]=a[5],u[12]=a[6],u[13]=a[7],u[14]=a[8],u[7]=o,u[11]=c}setInstanceBlendUniform(t,e,i,r,n,a,o,c,u,l,h,$,_,g,f,m,p,x,b){const T=t.textures;T[0]=0,T[1]=1;const y=t.highp;if(y[0]=e,y[1]=i,y[2]=r,y[3]=n,y[4]=c[0],y[5]=c[1],y[6]=c[2],y[8]=c[3],y[9]=c[4],y[10]=c[5],y[12]=c[6],y[13]=c[7],y[14]=c[8],y[7]=u,y[11]=l,y[16]=a,y[17]=o,h){const v=t.mediump;v[0]=$,v[1]=_,v[2]=g,v[3]=f,v[4]=m,v[5]=p,v[6]=x,v[7]=b}}setBlendUniform(t,e,i,r,n,a,o,c,u,l,h,$,_,g,f,m,p){const x=t.textures;x[0]=0,x[1]=1;const b=t.highp;if(b[0]=e,b[1]=i,b[2]=r,b[3]=n,b[4]=a[0],b[5]=a[1],b[6]=a[2],b[8]=a[3],b[9]=a[4],b[10]=a[5],b[12]=a[6],b[13]=a[7],b[14]=a[8],b[7]=o,b[11]=c,u){const T=t.mediump;T[0]=l,T[1]=h,T[2]=$,T[3]=_,T[4]=g,T[5]=f,T[6]=m,T[7]=p}}}class jf{constructor(t,e){this._$currentProgramId=-1,this._$shapeShaderVariants=new Pf(t,e),this._$gradientShapeShaderVariants=new Nf(t,e),this._$gradientLUTShaderVariants=new Uf(t,e),this._$filterShaderVariants=new zf(t,e),this._$blendShaderVariants=new Hf(t,e)}get currentProgramId(){return this._$currentProgramId}set currentProgramId(t){this._$currentProgramId=t}get shapeShaderVariants(){return this._$shapeShaderVariants}get gradientShapeShaderVariants(){return this._$gradientShapeShaderVariants}get gradientLUTShaderVariants(){return this._$gradientLUTShaderVariants}get filterShaderVariants(){return this._$filterShaderVariants}get blendShaderVariants(){return this._$blendShaderVariants}}class Kf{constructor(t,e){this._$context=t,this._$gl=e,this._$attachment=t.frameBuffer.createTextureAttachment(512,1),this._$maxLength=d.floor(e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS)*.75),this._$rgbToLinearTable=new Float32Array(256),this._$rgbIdentityTable=new Float32Array(256);for(let i=0;i<256;i++){const r=i/255;this._$rgbToLinearTable[i]=d.pow(r,2.23333333),this._$rgbIdentityTable[i]=r}}generateForShape(t,e){const i=this._$context.frameBuffer.currentAttachment,r=this._$context.cachePosition;r&&this._$gl.disable(this._$gl.SCISSOR_TEST),this._$context._$bind(this._$attachment);const n=t.length,a=this._$context.shaderList.gradientLUTShaderVariants,o=e?this._$rgbToLinearTable:this._$rgbIdentityTable;this._$context.blend.toOneZero();for(let c=0;c<n;c+=this._$maxLength-1){const u=d.min(c+this._$maxLength,n),l=a.getGradientLUTShader(u-c,e),h=l.uniform;a.setGradientLUTUniformForShape(h,t,c,u,o),l._$drawGradient(c===0?0:t[c][0],u===n?1:t[u-1][0])}if(this._$context._$bind(i),!this._$attachment.texture)throw new Error("the texture is null.");return r&&this._$context.bindRenderBuffer(r),this._$attachment.texture}generateForFilter(t,e,i){const r=this._$context.frameBuffer.currentAttachment;this._$context._$bind(this._$attachment);const n=t.length,a=this._$context.shaderList.gradientLUTShaderVariants;this._$context.blend.toOneZero();for(let o=0;o<n;o+=this._$maxLength-1){const c=d.min(o+this._$maxLength,n),u=a.getGradientLUTShader(c-o,!1),l=u.uniform;a.setGradientLUTUniformForFilter(l,t,e,i,o,c),u._$drawGradient(o===0?0:t[o],c===n?1:t[c-1])}if(this._$context._$bind(r),!this._$attachment.texture)throw new Error("the texture is null.");return this._$attachment.texture}}class ni{static get indexRangePool(){return this._$indexRangePool}static generate(t){let e=0;for(let i=0;i<t.length;++i)e+=(t[i].length/3-2)*12;this._$vertexBufferData=new ne(e),this._$indexRanges=A(),this._$currentIndex=0;for(let i=0;i<t.length;++i){const r=this._$currentIndex;this._$generateMesh(t[i]);const n=this._$currentIndex-r,a=this._$indexRangePool.pop()||{first:0,count:0};a.first=r,a.count=n,this._$indexRanges.push(a)}return{vertexBufferData:this._$vertexBufferData,indexRanges:this._$indexRanges}}static _$generateMesh(t){const e=this._$vertexBufferData;let i=this._$currentIndex;const r=t.length-5;for(let n=3;n<r;n+=3){let a=i*4;t[n+2]?(e[a++]=t[n-3],e[a++]=t[n-2],e[a++]=0,e[a++]=0,e[a++]=t[n],e[a++]=t[n+1],e[a++]=.5,e[a++]=0,e[a++]=t[n+3],e[a++]=t[n+4],e[a++]=1,e[a++]=1):t[n+5]?(e[a++]=t[0],e[a++]=t[1],e[a++]=.5,e[a++]=.5,e[a++]=t[n],e[a++]=t[n+1],e[a++]=.5,e[a++]=.5,e[a++]=t[n+6],e[a++]=t[n+7],e[a++]=.5,e[a++]=.5):(e[a++]=t[0],e[a++]=t[1],e[a++]=.5,e[a++]=.5,e[a++]=t[n],e[a++]=t[n+1],e[a++]=.5,e[a++]=.5,e[a++]=t[n+3],e[a++]=t[n+4],e[a++]=.5,e[a++]=.5),i+=3}this._$currentIndex=i}}ni._$indexRangePool=A();class Dl{static generate(t,e,i){this._$vertexBufferData=this._$vertexBufferData||new ne(1024),this._$vertexBufferPos=0,this._$indexBufferData=this._$indexBufferData||new Int16Array(256),this._$indexBufferPos=0,this._$lineCap=e,this._$lineJoin=i;for(let r=0;r<t.length;r++){const n=this._$vertexBufferPos;this._$generateLineSegment(t[r]);const a=this._$vertexBufferPos;this._$generateLineJoin(n,a),this._$generateLineCap(n,a)}return{vertexBufferData:this._$vertexBufferData.slice(0,this._$vertexBufferPos),indexBufferData:this._$indexBufferData.slice(0,this._$indexBufferPos)}}static _$expandVertexBufferIfNeeded(t){if(this._$vertexBufferPos+t>this._$vertexBufferData.length){const e=new ne(this._$vertexBufferData.length*2);e.set(this._$vertexBufferData),this._$vertexBufferData=e}}static _$expandIndexBufferIfNeeded(t){if(this._$indexBufferPos+t>this._$indexBufferData.length){const e=new G_(this._$indexBufferData.length*2);e.set(this._$indexBufferData),this._$indexBufferData=e}}static _$generateLineSegment(t){const e=t.length-5;for(let i=0;i<e;i+=3)t[i+2]||(t[i+5]?this._$addQuadSegmentMesh(t[i],t[i+1],t[i+3],t[i+4],t[i+6],t[i+7]):this._$addLineSegmentMesh(t[i],t[i+1],t[i+3],t[i+4]))}static _$addQuadSegmentMesh(t,e,i,r,n,a){let c=t,u=e;for(let l=1;l<11;l++){const h=l/11,$=1-h,_=(t*$+i*h)*$+(i*$+n*h)*h,g=(e*$+r*h)*$+(r*$+a*h)*h;this._$addLineSegmentMesh(c,u,_,g,2),c=_,u=g}this._$addLineSegmentMesh(c,u,n,a)}static _$addLineSegmentMesh(t,e,i,r,n=1){const a=this._$vertexBufferPos/7,o=a+1,c=a+2,u=a+3;this._$expandIndexBufferIfNeeded(6);const l=this._$indexBufferData;let h=this._$indexBufferPos;l[h++]=a,l[h++]=o,l[h++]=u,l[h++]=u,l[h++]=c,l[h++]=a,this._$indexBufferPos=h,this._$expandVertexBufferIfNeeded(28);const $=this._$vertexBufferData;let _=this._$vertexBufferPos;$[_++]=t,$[_++]=e,$[_++]=i,$[_++]=r,$[_++]=1,$[_++]=1,$[_++]=1,$[_++]=t,$[_++]=e,$[_++]=i,$[_++]=r,$[_++]=-1,$[_++]=-1,$[_++]=1,$[_++]=i,$[_++]=r,$[_++]=t,$[_++]=e,$[_++]=-1,$[_++]=-1,$[_++]=n,$[_++]=i,$[_++]=r,$[_++]=t,$[_++]=e,$[_++]=1,$[_++]=1,$[_++]=n,this._$vertexBufferPos=_}static _$generateLineJoin(t,e){const i=this._$vertexBufferData,r=e-55;for(let n=t;n<r;n+=28){const a=n/7;this._$addLineJoinMesh(i[n],i[n+1],i[n+21],i[n+22],i[n+27],i[n+49],i[n+50],a+2,a+3,a+4,a+5)}}static _$addLineJoinMesh(t,e,i,r,n,a,o,c,u,l=0,h=0){const $=i-t,_=r-e,g=a-i,f=o-r,m=this._$cross($,_,g,f);if(!(d.abs(m)<1e-4)){if(n===2){this._$addBevelJoinMesh(i,r,l,c,u,h);return}switch(this._$lineJoin){case"round":this._$addRoundJoinMesh(i,r);break;case"miter":this._$addMiterJoinMesh(i,r,t,e,a,o,l,c,u,h);break;default:this._$addBevelJoinMesh(i,r,l,c,u,h);break}}}static _$addRoundJoinMesh(t,e){const i=this._$vertexBufferPos/7;this._$expandIndexBufferIfNeeded(57);const r=this._$indexBufferData;let n=this._$indexBufferPos;for(let c=1;c<18;c++){const u=i+c;r[n++]=i,r[n++]=u,r[n++]=u+1}r[n++]=i,r[n++]=i+18,r[n++]=i+1,this._$indexBufferPos=n,this._$expandVertexBufferIfNeeded(133);const a=this._$vertexBufferData;let o=this._$vertexBufferPos;a[o++]=t,a[o++]=e,a[o++]=0,a[o++]=0,a[o++]=0,a[o++]=0,a[o++]=0;for(let c=0;c<18;c++)a[o++]=t,a[o++]=e,a[o++]=0,a[o++]=0,a[o++]=0,a[o++]=0,a[o++]=30+c;this._$vertexBufferPos=o}static _$addMiterJoinMesh(t,e,i,r,n,a,o,c,u,l){const h=this._$vertexBufferPos/7,$=h+1,_=h+2,g=h+3,f=h+4;this._$expandIndexBufferIfNeeded(18);const m=this._$indexBufferData;let p=this._$indexBufferPos;m[p++]=h,m[p++]=o,m[p++]=$,m[p++]=h,m[p++]=$,m[p++]=_,m[p++]=h,m[p++]=_,m[p++]=c,m[p++]=h,m[p++]=u,m[p++]=g,m[p++]=h,m[p++]=g,m[p++]=f,m[p++]=h,m[p++]=f,m[p++]=l,this._$indexBufferPos=p,this._$expandVertexBufferIfNeeded(35);const x=this._$vertexBufferData;let b=this._$vertexBufferPos;x[b++]=t,x[b++]=e,x[b++]=i,x[b++]=r,x[b++]=n,x[b++]=a,x[b++]=0,x[b++]=t,x[b++]=e,x[b++]=i,x[b++]=r,x[b++]=n,x[b++]=a,x[b++]=21,x[b++]=t,x[b++]=e,x[b++]=i,x[b++]=r,x[b++]=n,x[b++]=a,x[b++]=22,x[b++]=t,x[b++]=e,x[b++]=i,x[b++]=r,x[b++]=n,x[b++]=a,x[b++]=23,x[b++]=t,x[b++]=e,x[b++]=i,x[b++]=r,x[b++]=n,x[b++]=a,x[b++]=24,this._$vertexBufferPos=b}static _$addBevelJoinMesh(t,e,i,r,n,a){const o=this._$vertexBufferPos/7;this._$expandIndexBufferIfNeeded(6);const c=this._$indexBufferData;let u=this._$indexBufferPos;c[u++]=o,c[u++]=i,c[u++]=r,c[u++]=o,c[u++]=n,c[u++]=a,this._$indexBufferPos=u,this._$expandVertexBufferIfNeeded(7);const l=this._$vertexBufferData;let h=this._$vertexBufferPos;l[h++]=t,l[h++]=e,l[h++]=0,l[h++]=0,l[h++]=0,l[h++]=0,l[h++]=0,this._$vertexBufferPos=h}static _$generateLineCap(t,e){const i=this._$vertexBufferData,r=i[t],n=i[t+1],a=i[t+2],o=i[t+3],c=i[e-7],u=i[e-6],l=i[e-5],h=i[e-4],$=t/7,_=e/7;if(r===c&&n===u){this._$addLineJoinMesh(l,h,r,n,a,o,_-2,_-1,$,$+1);return}this._$addLineCapMesh(r,n,a,o,$,$+1),this._$addLineCapMesh(c,u,l,h,_-1,_-2)}static _$addLineCapMesh(t,e,i,r,n,a){switch(this._$lineCap){case"round":this._$addRoundJoinMesh(t,e);break;case"square":this._$addSquareCapMesh(t,e,i,r,n,a);break}}static _$addSquareCapMesh(t,e,i,r,n,a){const o=this._$vertexBufferPos/7,c=o+1;this._$expandIndexBufferIfNeeded(6);const u=this._$indexBufferData;let l=this._$indexBufferPos;u[l++]=n,u[l++]=o,u[l++]=c,u[l++]=c,u[l++]=a,u[l++]=n,this._$indexBufferPos=l,this._$expandVertexBufferIfNeeded(14);const h=this._$vertexBufferData;let $=this._$vertexBufferPos;h[$++]=t,h[$++]=e,h[$++]=i,h[$++]=r,h[$++]=-1,h[$++]=-1,h[$++]=10,h[$++]=t,h[$++]=e,h[$++]=i,h[$++]=r,h[$++]=1,h[$++]=1,h[$++]=10,this._$vertexBufferPos=$}}Dl._$cross=(s,t,e,i)=>s*i-e*t;class qf{constructor(t){this._$gl=t,this._$fillVertexArrayPool=[],this._$strokeVertexArrayPool=[],this._$boundVertexArray=null,this._$fillAttrib_vertex=0,this._$fillAttrib_bezier=1,this._$strokeAttrib_vertex=0,this._$strokeAttrib_option1=1,this._$strokeAttrib_option2=2,this._$strokeAttrib_type=3,this._$vertexBufferData=new Float32Array([0,0,0,1,1,0,1,1]),this._$attributeVertexBuffer=t.createBuffer(),this._$attributeBuffer=new Float32Array(22),this._$instanceVertexArray=this._$getCommonVertexArray(),this._$commonVertexArray=this._$getVertexArray(0,1)}_$getCommonVertexArray(){const t=this._$gl.createVertexArray();this.bind(t);const e=this._$gl.createBuffer();return this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,e),this._$gl.bufferData(this._$gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),this._$gl.STATIC_DRAW),this._$gl.enableVertexAttribArray(0),this._$gl.vertexAttribPointer(0,2,this._$gl.FLOAT,!1,0,0),this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,this._$attributeVertexBuffer),this._$gl.bufferData(this._$gl.ARRAY_BUFFER,this._$attributeBuffer.byteLength,this._$gl.DYNAMIC_DRAW),this._$gl.enableVertexAttribArray(1),this._$gl.vertexAttribPointer(1,4,this._$gl.FLOAT,!1,88,0),this._$gl.vertexAttribDivisor(1,1),this._$gl.enableVertexAttribArray(2),this._$gl.vertexAttribPointer(2,4,this._$gl.FLOAT,!1,88,16),this._$gl.vertexAttribDivisor(2,1),this._$gl.enableVertexAttribArray(3),this._$gl.vertexAttribPointer(3,2,this._$gl.FLOAT,!1,88,32),this._$gl.vertexAttribDivisor(3,1),this._$gl.enableVertexAttribArray(4),this._$gl.vertexAttribPointer(4,4,this._$gl.FLOAT,!1,88,40),this._$gl.vertexAttribDivisor(4,1),this._$gl.enableVertexAttribArray(5),this._$gl.vertexAttribPointer(5,4,this._$gl.FLOAT,!1,88,56),this._$gl.vertexAttribDivisor(5,1),this._$gl.enableVertexAttribArray(6),this._$gl.vertexAttribPointer(6,4,this._$gl.FLOAT,!1,88,72),this._$gl.vertexAttribDivisor(6,1),t}_$getVertexArray(t,e){const i=this._$gl.createVertexArray();this.bind(i);const r=this._$gl.createBuffer();return this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,r),this._$vertexBufferData[0]=t,this._$vertexBufferData[2]=t,this._$vertexBufferData[4]=e,this._$vertexBufferData[6]=e,this._$gl.bufferData(this._$gl.ARRAY_BUFFER,this._$vertexBufferData,this._$gl.STATIC_DRAW),this._$gl.enableVertexAttribArray(0),this._$gl.vertexAttribPointer(0,2,this._$gl.FLOAT,!1,0,0),i}_$getFillVertexArray(){if(this._$fillVertexArrayPool.length){const i=this._$fillVertexArrayPool.pop();if(i)return i}const t=this._$gl.createVertexArray();this.bind(t);const e=this._$gl.createBuffer();return t.vertexBuffer=e,t.vertexLength=0,this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,e),this._$gl.enableVertexAttribArray(0),this._$gl.enableVertexAttribArray(1),this._$gl.vertexAttribPointer(this._$fillAttrib_vertex,2,this._$gl.FLOAT,!1,16,0),this._$gl.vertexAttribPointer(this._$fillAttrib_bezier,2,this._$gl.FLOAT,!1,16,8),t}_$getStrokeVertexArray(){if(this._$strokeVertexArrayPool.length){const r=this._$strokeVertexArrayPool.pop();if(r)return r}const t=this._$gl.createVertexArray();this.bind(t);const e=this._$gl.createBuffer();t.vertexBuffer=e,t.vertexLength=0,this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,e);const i=this._$gl.createBuffer();return t.indexBuffer=i,t.indexLength=0,this._$gl.bindBuffer(this._$gl.ELEMENT_ARRAY_BUFFER,i),this._$gl.enableVertexAttribArray(0),this._$gl.enableVertexAttribArray(1),this._$gl.enableVertexAttribArray(2),this._$gl.enableVertexAttribArray(3),this._$gl.vertexAttribPointer(this._$strokeAttrib_vertex,2,this._$gl.FLOAT,!1,28,0),this._$gl.vertexAttribPointer(this._$strokeAttrib_option1,2,this._$gl.FLOAT,!1,28,8),this._$gl.vertexAttribPointer(this._$strokeAttrib_option2,2,this._$gl.FLOAT,!1,28,16),this._$gl.vertexAttribPointer(this._$strokeAttrib_type,1,this._$gl.FLOAT,!1,28,24),t}createFill(t){const e=ni.generate(t),i=e.vertexBufferData,r=this._$getFillVertexArray();return r.indexRanges=e.indexRanges,this.bind(r),this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,r.vertexBuffer),r.vertexLength<i.length&&(r.vertexLength=rr(i.length),this._$gl.bufferData(this._$gl.ARRAY_BUFFER,r.vertexLength*4,this._$gl.DYNAMIC_DRAW)),this._$gl.bufferSubData(this._$gl.ARRAY_BUFFER,0,i),r}createStroke(t,e,i){const r=Dl.generate(t,e,i),n=r.vertexBufferData,a=r.indexBufferData,o=this._$getStrokeVertexArray();return o.indexCount=a.length,this.bind(o),this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,o.vertexBuffer),this._$gl.bindBuffer(this._$gl.ELEMENT_ARRAY_BUFFER,o.indexBuffer),o.vertexLength<n.length&&(o.vertexLength=rr(n.length),this._$gl.bufferData(this._$gl.ARRAY_BUFFER,o.vertexLength*4,this._$gl.DYNAMIC_DRAW)),o.indexLength<a.length&&(o.indexLength=rr(a.length),this._$gl.bufferData(this._$gl.ELEMENT_ARRAY_BUFFER,o.indexLength*2,this._$gl.DYNAMIC_DRAW)),this._$gl.bufferSubData(this._$gl.ARRAY_BUFFER,0,n),this._$gl.bufferSubData(this._$gl.ELEMENT_ARRAY_BUFFER,0,a),o}releaseFill(t){this._$fillVertexArrayPool.push(t)}releaseStroke(t){this._$strokeVertexArrayPool.push(t)}bind(t=null){t!==this._$boundVertexArray&&(this._$boundVertexArray=t,this._$gl.bindVertexArray(t))}bindInstnceArray(t){this.bind(this._$instanceVertexArray),this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,this._$attributeVertexBuffer),t.attributes.length>this._$attributeBuffer.length&&(this._$attributeBuffer=new Float32Array(t.attributes.length),this._$gl.bufferData(this._$gl.ARRAY_BUFFER,this._$attributeBuffer.byteLength,this._$gl.DYNAMIC_DRAW)),this._$attributeBuffer.set(t.attributes),this._$gl.bufferSubData(this._$gl.ARRAY_BUFFER,0,this._$attributeBuffer.subarray(0,t.attributes.length))}bindCommonVertexArray(){this.bind(this._$commonVertexArray)}bindGradientVertexArray(t,e){const i=this._$getVertexArray(t,e);this.bind(i)}}class Zf{constructor(t,e){this._$context=t,this._$gl=e,this._$clips=[],this._$poolClip=[],this._$clipStatus=!1,this._$containerClip=!1,this._$currentClip=!1}get containerClip(){return this._$containerClip}set containerClip(t){this._$containerClip=t}_$onClear(t){t&&(this._$gl.enable(this._$gl.STENCIL_TEST),this._$currentClip=!0)}_$onBind(t){!t&&this._$currentClip?(this._$gl.disable(this._$gl.STENCIL_TEST),this._$currentClip=!1):t&&!this._$currentClip&&(this._$gl.enable(this._$gl.STENCIL_TEST),this._$currentClip=!0,this._$endClipDef())}_$onClearRect(){this._$gl.disable(this._$gl.STENCIL_TEST),this._$currentClip=!1}_$enterClip(){this._$currentClip||(this._$gl.enable(this._$gl.STENCIL_TEST),this._$currentClip=!0);const t=this._$context.frameBuffer.currentAttachment;if(!t)throw new Error("mask currentAttachment is null.");t.mask=!0,++t.clipLevel}_$beginClipDef(){const t=this._$context.frameBuffer.currentAttachment;if(!t)throw new Error("mask currentAttachment is null.");this._$gl.enable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.ALWAYS,0,255),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.INVERT,this._$gl.INVERT),this._$gl.stencilMask(1<<t.clipLevel-1),this._$gl.colorMask(!1,!1,!1,!1)}_$endClipDef(){const t=this._$context.frameBuffer.currentAttachment;if(!t)throw new Error("mask currentAttachment is null.");const e=t.clipLevel;let i=0;for(let r=0;r<e;++r)i|=(1<<e-r)-1;this._$gl.disable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.EQUAL,i&255,i),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.KEEP,this._$gl.KEEP),this._$gl.stencilMask(255),this._$gl.colorMask(!0,!0,!0,!0)}_$leaveClip(){const t=this._$context.frameBuffer.currentAttachment;if(!t)throw new Error("mask currentAttachment is null.");if(--t.clipLevel,t.mask=!!t.clipLevel,!t.clipLevel){this._$context._$clearRectStencil();return}const e=t.width,i=t.height,r=this._$context.path.createRectVertices(0,0,e,i),n=this._$context.vao.createFill(r);V(r.pop()),V(r);const a=this._$context.shaderList.shapeShaderVariants,o=a.getMaskShapeShader(!1,!1),c=o.uniform;a.setMaskShapeUniformIdentity(c,e,i);const u=n.indexRanges[0];this._$currentClip||(this._$currentClip=!0,this._$gl.enable(this._$gl.STENCIL_TEST)),this._$gl.enable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.ALWAYS,0,255),this._$gl.stencilOp(this._$gl.REPLACE,this._$gl.REPLACE,this._$gl.REPLACE),this._$gl.stencilMask(1<<t.clipLevel),this._$gl.colorMask(!1,!1,!1,!1),o._$containerClip(n,u.first,u.count);const l=n.indexRanges;for(let h=0;h<l.length;++h)ni.indexRangePool.push(l[h]);V(n.indexRanges),this._$context.vao.releaseFill(n),this._$endClipDef()}_$drawContainerClip(){const t=this._$context.frameBuffer.currentAttachment;if(!t)throw new Error("mask currentAttachment is null.");const e=t.clipLevel,i=this._$context.shaderList.shapeShaderVariants,r=i.getMaskShapeShader(!1,!1),n=r.uniform;let a=e;const o=t.width,c=t.height;this._$gl.enable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.ALWAYS,0,255),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.INVERT,this._$gl.INVERT),this._$gl.colorMask(!1,!1,!1,!1);const u=this._$poolClip.length;for(let l=0;l<u;++l){const h=this._$poolClip.shift();if(!h)continue;i.setMaskShapeUniform(n,!1,h.matrixA,h.matrixB,h.matrixC,h.matrixD,h.matrixE,h.matrixF,h.matrixG,h.matrixH,h.matrixI,h.viewportWidth,h.viewportHeight,null);const $=h.vertexArrayObject.indexRanges;for(let _=0;_<$.length;++_){const g=$[_];this._$gl.stencilMask(1<<a-1),r._$containerClip(h.vertexArrayObject,g.first,g.count),ni.indexRangePool.push(g)}V($),this._$context.vao.releaseFill(h.vertexArrayObject),++a,a>7&&(this._$unionStencilMask(e,o,c),a=e)}a>e+1&&this._$unionStencilMask(e,o,c)}_$unionStencilMask(t,e,i){const r=this._$context.path.createRectVertices(0,0,e,i),n=this._$context.vao.createFill(r);V(r.pop()),V(r);const a=this._$context.shaderList.shapeShaderVariants,o=a.getMaskShapeShader(!1,!1),c=o.uniform;a.setMaskShapeUniformIdentity(c,e,i);const u=n.indexRanges[0];this._$gl.stencilFunc(this._$gl.LEQUAL,1<<t-1,255),this._$gl.stencilOp(this._$gl.ZERO,this._$gl.REPLACE,this._$gl.REPLACE),this._$gl.stencilMask(~((1<<t-1)-1)),o._$containerClip(n,u.first,u.count),this._$poolClip.length&&(this._$gl.stencilFunc(this._$gl.ALWAYS,0,255),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.INVERT,this._$gl.INVERT));const l=n.indexRanges;for(let h=0;h<l.length;++h)ni.indexRangePool.push(l[h]);V(n.indexRanges),this._$context.vao.releaseFill(n)}_$onClip(t,e,i,r){return this._$clipStatus=!0,this._$containerClip?(this._$poolClip.push({vertexArrayObject:t,matrixA:e[0],matrixB:e[1],matrixC:e[2],matrixD:e[3],matrixE:e[4],matrixF:e[5],matrixG:e[6],matrixH:e[7],matrixI:e[8],viewportWidth:i,viewportHeight:r}),!0):!1}_$onSave(){this._$clips.push(this._$clipStatus)}_$onRestore(){this._$clips.length&&(this._$clipStatus=!!this._$clips.pop())}}class Jf{constructor(t,e){this._$context=t,this._$gl=e,this._$enabled=!1,this._$funcCode=600,this._$currentOperation="normal",this._$currentIndex=-1,this._$currentSmoothing=null,this._$variants=t.shaderList.blendShaderVariants,this._$instanceShader=this._$variants.getInstanceShader(),this.enable()}enable(){this._$enabled||(this._$enabled=!0,this._$gl.enable(this._$gl.BLEND)),this.reset()}disable(){this._$enabled&&(this._$enabled=!1,this._$gl.disable(this._$gl.BLEND))}reset(){this._$funcCode!==613&&(this._$funcCode=613,this._$gl.blendFunc(this._$gl.ONE,this._$gl.ONE_MINUS_SRC_ALPHA))}toOneZero(){this._$funcCode!==610&&(this._$funcCode=610,this._$gl.blendFunc(this._$gl.ONE,this._$gl.ZERO))}toZeroOne(){this._$funcCode!==601&&(this._$funcCode=601,this._$gl.blendFuncSeparate(this._$gl.ZERO,this._$gl.ONE,this._$gl.ONE,this._$gl.ZERO))}toAdd(){this._$funcCode!==611&&(this._$funcCode=611,this._$gl.blendFunc(this._$gl.ONE,this._$gl.ONE))}toScreen(){this._$funcCode!==641&&(this._$funcCode=641,this._$gl.blendFunc(this._$gl.ONE_MINUS_DST_COLOR,this._$gl.ONE))}toAlpha(){this._$funcCode!==606&&(this._$funcCode=606,this._$gl.blendFunc(this._$gl.ZERO,this._$gl.SRC_ALPHA))}toErase(){this._$funcCode!==603&&(this._$funcCode=603,this._$gl.blendFunc(this._$gl.ZERO,this._$gl.ONE_MINUS_SRC_ALPHA))}toSourceAtop(){this._$funcCode!==673&&(this._$funcCode=673,this._$gl.blendFunc(this._$gl.DST_ALPHA,this._$gl.ONE_MINUS_SRC_ALPHA))}toSourceIn(){this._$funcCode!==670&&(this._$funcCode=670,this._$gl.blendFunc(this._$gl.DST_ALPHA,this._$gl.ZERO))}toOperation(t){switch(t){case"add":this.toAdd();break;case"screen":this.toScreen();break;case"alpha":this.toAlpha();break;case"erase":this.toErase();break;case"copy":this.toOneZero();break;default:this.reset();break}}clearInstacedArray(){const t=this._$instanceShader.instance;t.count&&t.clear()}drawInstacedArray(){const t=this._$instanceShader.instance;if(!t.count)return;const e=this._$context.frameBuffer,i=e.textureManager.getAtlasTexture(this._$currentIndex);e.textureManager.bind0(i,this._$currentSmoothing),this.toOperation(this._$currentOperation),this._$instanceShader.drawArraysInstanced(t),t.clear()}drawInstance(t,e,i,r,n,a,o,c,u,l,h,$,_,g){this._$currentOperation||(this._$currentOperation=l),this._$currentIndex===-1&&(this._$currentIndex=t.index),this._$currentSmoothing===null&&(this._$currentSmoothing=g),(this._$currentOperation!==l||this._$currentIndex!==t.index||this._$currentSmoothing!==g)&&(this.drawInstacedArray(),this._$currentOperation=l,this._$currentIndex=t.index,this._$currentSmoothing=g),this._$variants.pushNormalBlend(this._$instanceShader.instance,t.x,t.y,t.w,t.h,_,h,$,e,i,r,n,a,o,c,u)}drawInstanceBlend(t,e,i,r,n,a,o,c,u,l,h,$,_,g,f,m,p,x,b){this.drawInstacedArray();const T=this._$context.frameBuffer,y=T.currentAttachment,v=a!==1||o!==1||c!==1||u!==1||l!==0||h!==0||$!==0||_!==0,L=T.getTextureFromCurrentAttachment(),B=this._$context.frameBuffer.createTextureAttachment(g.w,g.h);this._$context._$bind(B),T.textureManager.bind0(L);const F=this._$variants.getClipShader(),R=F.uniform;this._$variants.setClipUniform(R,0,0,g.w,g.h,Be(x),m,p),this.reset(),F._$drawImage();const w=T.getTextureFromCurrentAttachment();this._$context._$bind(y),T.textureManager.bind01(w,t,b);const I=this._$variants.getInstanceBlendShader(f,v);this._$variants.setInstanceBlendUniform(I.uniform,g.x/t.width,g.y/t.height,g.w/t.width,g.h/t.height,g.w,g.h,x,m,p,v,a,o,c,u,l,h,$,_);const D=d.abs(r-e),N=d.abs(n-i);this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(e,p-(i+N),D,N),this.toOneZero(),I._$drawImage(),this._$gl.disable(this._$gl.SCISSOR_TEST),T.releaseAttachment(B,!0)}drawImage(t,e,i,r,n,a,o,c,u,l,h,$,_,g,f,m,p,x){const b=this._$context.frameBuffer,T=b.currentAttachment,y=a!==1||o!==1||c!==1||u!==1||l!==0||h!==0||$!==0||_!==0;switch(g){case"normal":case"layer":case"add":case"screen":case"alpha":case"erase":case"copy":{b.textureManager.bind0(t,x);const v=this._$variants.getNormalBlendShader(y);this._$variants.setNormalBlendUniform(v.uniform,e,i,r,n,p,f,m,y,a,o,c,u,l,h,$,_);const L=p[0],B=p[1],F=p[3],R=p[4],w=p[6],I=p[7];if(L!==1||B!==0||F!==0||R!==1){const D=e,N=e+r,Y=i,q=i+n,ot=+(N*L+q*F+w),G=+(N*L+Y*F+w),Vt=+(D*L+q*F+w),Ce=+(D*L+Y*F+w),Ee=+(N*B+q*R+I),ce=+(N*B+Y*R+I),Bt=+(D*B+q*R+I),Ge=+(D*B+Y*R+I),qs=ft.MAX_VALUE,Ki=+d.min(d.min(d.min(d.min(qs,ot),G),Vt),Ce),Ba=+d.max(d.max(d.max(d.max(-qs,ot),G),Vt),Ce),Wr=+d.min(d.min(d.min(d.min(qs,Ee),ce),Bt),Ge),Zs=+d.max(d.max(d.max(d.max(-qs,Ee),ce),Bt),Ge),Vr=d.max(0,Ki),Oc=d.max(0,Wr),Bc=d.min(d.max(0,f-Vr),d.ceil(d.abs(Ba-Ki))),Ra=d.min(d.max(0,m-Oc),d.ceil(d.abs(Zs-Wr)));if(!Bc||!Ra)return;this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(Vr,d.max(0,m-(Oc+Ra)),Bc+1,Ra+1)}else{const D=d.max(0,e+w),N=d.max(0,i+I),Y=d.min(d.max(0,f-D),r),q=d.min(d.max(0,m-N),n);if(!Y||!q)return;this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(D,d.max(0,m-(N+q)),Y+1,q+1)}this.toOperation(g),v._$drawImage(),this._$gl.disable(this._$gl.SCISSOR_TEST)}break;default:{const v=d.max(0,e+p[6]),L=d.max(0,i+p[7]),B=d.min(d.max(0,f-v),r),F=d.min(d.max(0,m-L),n);if(!B||!F)return;const R=b.getTextureFromCurrentAttachment(),w=this._$context.frameBuffer.createTextureAttachment(r,n);this._$context._$bind(w),b.textureManager.bind0(R);const I=this._$variants.getClipShader(),D=I.uniform;this._$variants.setClipUniform(D,e,i,r,n,Be(p),f,m),this.reset(),I._$drawImage();const N=b.getTextureFromCurrentAttachment();this._$context._$bind(T),b.textureManager.bind01(N,t,x);const Y=this._$variants.getBlendShader(g,y);this._$variants.setBlendUniform(Y.uniform,e,i,r,n,p,f,m,y,a,o,c,u,l,h,$,_),this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(v,d.max(0,m-(L+F)),B,F),this.toOneZero(),Y._$drawImage(),this._$gl.disable(this._$gl.SCISSOR_TEST),b.releaseAttachment(w,!0)}break}}}class Qf{constructor(t,e){wf(t.getParameter(t.MAX_TEXTURE_SIZE)),this._$gl=t;const i=d.min(e,t.getParameter(t.MAX_SAMPLES));this._$maxTextureSize=d.min(8192,t.getParameter(t.MAX_TEXTURE_SIZE))-2,this._$contextStyle=new Sf,this._$cacheBounds=et(),this._$matrix=bn(1,0,0,0,1,0,0,0,1),this._$cacheAttachment=null,this._$stack=[],this._$globalAlpha=1,this._$imageSmoothingEnabled=!1,this._$globalCompositeOperation="normal",this._$clearColorR=1,this._$clearColorG=1,this._$clearColorB=1,this._$clearColorA=1,this._$viewportWidth=0,this._$viewportHeight=0,this._$frameBufferManager=new Lf(t,i),this._$path=new Of,this._$grid=new Bf,this._$offsetX=0,this._$offsetY=0,this._$blends=A(),this._$positions=A(),this._$isLayer=!1,this._$shaderList=new jf(this,t),this._$gradientLUT=new Kf(this,t),this._$vao=new qf(t),this._$mask=new Zf(this,t),this._$blend=new Jf(this,t),this._$attachmentArray=[],this._$maskBounds=et(0,0,0,0),this._$cachePosition=null}get cachePosition(){return this._$cachePosition}set cachePosition(t){this._$cachePosition=t}reset(){this._$globalAlpha=1,this._$globalCompositeOperation="normal",this._$imageSmoothingEnabled=!1,this._$contextStyle.clear()}get isLayer(){return this._$isLayer}get canvas(){return this._$gl.canvas}get cacheAttachment(){return this._$cacheAttachment}set cacheAttachment(t){this._$cacheAttachment=t}get cacheBounds(){return this._$cacheBounds}get fillStyle(){return this._$contextStyle.fillStyle}set fillStyle(t){this._$contextStyle.fillStyle=t}get strokeStyle(){return this._$contextStyle.strokeStyle}set strokeStyle(t){this._$contextStyle.strokeStyle=t}get lineWidth(){return this._$contextStyle.lineWidth}set lineWidth(t){this._$contextStyle.lineWidth=t}get lineCap(){return this._$contextStyle.lineCap}set lineCap(t){this._$contextStyle.lineCap=t}get lineJoin(){return this._$contextStyle.lineJoin}set lineJoin(t){this._$contextStyle.lineJoin=t}get miterLimit(){return this._$contextStyle.miterLimit}set miterLimit(t){this._$contextStyle.miterLimit=t}get globalAlpha(){return this._$globalAlpha}set globalAlpha(t){this._$globalAlpha=O(t,0,1,1)}get imageSmoothingEnabled(){return this._$imageSmoothingEnabled}set imageSmoothingEnabled(t){this._$imageSmoothingEnabled=t}get globalCompositeOperation(){return this._$globalCompositeOperation}set globalCompositeOperation(t){this._$globalCompositeOperation=t}get frameBuffer(){return this._$frameBufferManager}get shaderList(){return this._$shaderList}get path(){return this._$path}get grid(){return this._$grid}get vao(){return this._$vao}get blend(){return this._$blend}_$getCurrentPosition(){return this._$positions[this._$positions.length-1]}_$getTextureScale(t,e){const i=d.max(t,e);return i>this._$maxTextureSize?this._$maxTextureSize/i:1}drawInstacedArray(){this.blend.drawInstacedArray()}clearInstacedArray(){this.blend.clearInstacedArray()}bindRenderBuffer(t){this._$frameBufferManager.bindRenderBuffer(),this._$gl.clearColor(0,0,0,0),this._$gl.clear(this._$gl.COLOR_BUFFER_BIT|this._$gl.STENCIL_BUFFER_BIT),this._$viewportWidth=t.w,this._$viewportHeight=t.h,this._$gl.viewport(t.x,t.y,t.w,t.h),this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(t.x,t.y,t.w,t.h)}getTextureFromRect(t){const e=this._$frameBufferManager,i=e.textureManager.getAtlasTexture(t.index),r=e.currentAttachment,n=e.createTextureAttachment(t.w,t.h);this._$bind(n),this.save(),this.setTransform(1,0,0,1,0,0),this.reset(),this.drawImage(i,-t.x,-i.height+t.h+t.y,i.width,i.height),this.restore();const a=n.texture;return e.releaseAttachment(n),this._$bind(r),a}drawBitmap(t){const e=this._$shaderList.blendShaderVariants,i=e.getNormalBlendShader(!1);e.setNormalBlendUniform(i.uniform,0,0,t.width,t.height,this._$matrix,this._$viewportWidth,this._$viewportHeight,!1,1,1,1,1,0,0,0,0),this._$frameBufferManager.textureManager.bind0(t,this._$imageSmoothingEnabled),this.blend.toOperation("normal"),i._$drawImage()}drawTextureFromRect(t,e){const i=this._$frameBufferManager,r=i.currentAttachment;this.bindRenderBuffer(e),i.transferTexture(e);const n=i.textureManager.getAtlasTexture(e.index),a=i.createTextureAttachmentFrom(n);this._$bind(a),this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(e.x,e.y,e.w,e.h),this._$gl.clearColor(0,0,0,0),this._$gl.disable(this._$gl.SCISSOR_TEST),this.save(),this.setTransform(1,0,0,1,0,0),this.reset(),this.drawImage(t,e.x,n.height-e.h-e.y,t.width,t.height),this.restore(),i.releaseAttachment(a),this._$bind(r),i.textureManager.release(t)}stopStencil(){this._$mask._$onClearRect()}_$bind(t=null){if(!t)return;this._$frameBufferManager.bind(t);const e=t.color,i=t.stencil,r=t.width,n=t.height;(this._$viewportWidth!==r||this._$viewportHeight!==n)&&(this._$viewportWidth=r,this._$viewportHeight=n,this._$gl.viewport(0,0,r,n)),(e&&e.dirty||i&&i.dirty)&&(e&&(e.dirty=!1),i&&(i.dirty=!1),this._$gl.clearColor(0,0,0,0),this.clearRect(0,0,this._$viewportWidth,this._$viewportHeight),this._$gl.clearColor(this._$clearColorR,this._$clearColorG,this._$clearColorB,this._$clearColorA),this._$mask._$onClear(t.mask)),this._$mask._$onBind(t.mask)}setTransform(t,e,i,r,n,a){this._$matrix[0]=t,this._$matrix[1]=e,this._$matrix[3]=i,this._$matrix[4]=r,this._$matrix[6]=n,this._$matrix[7]=a}setMaxSize(t,e){this._$frameBufferManager.setMaxSize(t,e)}transform(t,e,i,r,n,a){const o=this._$matrix[0],c=this._$matrix[1],u=this._$matrix[3],l=this._$matrix[4],h=this._$matrix[6],$=this._$matrix[7];this._$matrix[0]=t*o+e*u,this._$matrix[1]=t*c+e*l,this._$matrix[3]=i*o+r*u,this._$matrix[4]=i*c+r*l,this._$matrix[6]=n*o+a*u+h,this._$matrix[7]=n*c+a*l+$}debug(t=0){const e=this._$frameBufferManager,i=e.textureManager.getAtlasTexture(t),r=e.currentAttachment,n=e.createTextureAttachmentFrom(i);this._$bind(n);const a=new Uint8Array(i.width*i.height*4);this._$gl.readPixels(0,0,i.width,i.height,this._$gl.RGBA,this._$gl.UNSIGNED_BYTE,a);const o=document.createElement("canvas");o.width=i.width,o.height=i.height;const c=o.getContext("2d"),u=new ImageData(i.width,i.height);for(let l=0;l<a.length;++l)u.data[l]=a[l];c?.putImageData(u,0,0),console.log(o.toDataURL()),this._$bind(r),e.releaseAttachment(n)}drawInstance(t,e,i,r,n){let a=1,o=1,c=1,u=0,l=0,h=0;const $=this._$globalAlpha,_=0;n&&(a=n[0],o=n[1],c=n[2],u=n[4]/255,l=n[5]/255,h=n[6]/255);const g=this._$cachePosition;if(g)switch(this._$globalCompositeOperation){case"normal":case"layer":case"add":case"screen":case"alpha":case"erase":case"copy":this.blend.drawInstance(g,a,o,c,$,u,l,h,_,this._$globalCompositeOperation,this._$viewportWidth,this._$viewportHeight,this._$matrix,this._$imageSmoothingEnabled);break;default:{const f=this._$frameBufferManager.textureManager.getAtlasTexture(g.index);this.blend.drawInstanceBlend(f,t,e,i,r,a,o,c,$,u,l,h,_,g,this._$globalCompositeOperation,this._$viewportWidth,this._$viewportHeight,this._$matrix,this._$imageSmoothingEnabled)}break}}drawImage(t,e,i,r,n,a=null){let o=1,c=1,u=1,l=0,h=0,$=0;const _=this._$globalAlpha,g=0;a&&(o=a[0],c=a[1],u=a[2],l=a[4]/255,h=a[5]/255,$=a[6]/255),this.blend.drawImage(t,e,i,r,n,o,c,u,_,l,h,$,g,this._$globalCompositeOperation,this._$viewportWidth,this._$viewportHeight,this._$matrix,this._$imageSmoothingEnabled)}_$setColor(t=0,e=0,i=0,r=0){this._$clearColorR=t,this._$clearColorG=e,this._$clearColorB=i,this._$clearColorA=r,this._$gl.clearColor(t,e,i,r)}clearRect(t,e,i,r){this._$mask._$onClearRect(),this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(t,e,i,r),this._$gl.clear(this._$gl.COLOR_BUFFER_BIT|this._$gl.STENCIL_BUFFER_BIT),this._$gl.disable(this._$gl.SCISSOR_TEST)}_$clearRectStencil(){this._$mask._$onClearRect(),this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(this._$maskBounds.xMin,this._$maskBounds.yMin,this._$maskBounds.xMax,this._$maskBounds.yMax),this._$gl.clear(this._$gl.STENCIL_BUFFER_BIT),this._$gl.disable(this._$gl.SCISSOR_TEST)}moveTo(t,e){this._$path.moveTo(t,e)}lineTo(t,e){this._$path.lineTo(t,e)}beginPath(){this._$path.begin()}quadraticCurveTo(t,e,i,r){this._$path.quadTo(t,e,i,r)}bezierCurveTo(t,e,i,r,n,a){this._$path.cubicTo(t,e,i,r,n,a)}fill(){const t=this._$path.vertices;if(!t.length)return;const e=A();for(let $=0;$<t.length;++$){const _=t[$];10>_.length||e.push(_)}if(!e.length){V(e);return}const i=this._$vao.createFill(e),r=this.fillStyle;let n=this._$matrix,a,o,c;const u=this._$grid.enabled;if(r instanceof Qs){const $=r.stops,_=r.rgb==="linearRGB";if(a=this._$gradientLUT.generateForShape($,_),this._$frameBufferManager.textureManager.bind0(a,!0),this._$frameBufferManager.bindRenderBuffer(),o=this._$shaderList.gradientShapeShaderVariants,r.type==="linear")c=o.getGradientShapeShader(!1,u,!1,!1,r.mode),o.setGradientShapeUniform(c.uniform,!1,0,0,0,u,n,Be(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,!1,r.points,0);else{n=this._$stack[this._$stack.length-1];const g=r.focalPointRatio!==0;c=o.getGradientShapeShader(!1,u,!0,g,r.mode),o.setGradientShapeUniform(c.uniform,!1,0,0,0,u,n,Be(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,!0,r.points,r.focalPointRatio)}}else if(r instanceof or){n=this._$stack[this._$stack.length-1];const $=r.colorTransform;a=r.texture,this._$frameBufferManager.textureManager.bind0(a,this._$imageSmoothingEnabled),o=this._$shaderList.shapeShaderVariants,c=o.getBitmapShapeShader(!1,r.repeat,u),$?o.setBitmapShapeUniform(c.uniform,!1,0,0,0,u,n,Be(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,a.width,a.height,$[0],$[1],$[2],this._$globalAlpha,$[4]/255,$[5]/255,$[6]/255,0):o.setBitmapShapeUniform(c.uniform,!1,0,0,0,u,n,Be(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,a.width,a.height,1,1,1,this._$globalAlpha,0,0,0,0)}else o=this._$shaderList.shapeShaderVariants,c=o.getSolidColorShapeShader(!1,this._$grid.enabled),o.setSolidColorShapeUniform(c.uniform,!1,0,0,0,u,n,this._$viewportWidth,this._$viewportHeight,this._$grid,r,this._$globalAlpha);const l=this._$shaderList.shapeShaderVariants,h=l.getMaskShapeShader(!1,u);l.setMaskShapeUniform(h.uniform,u,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],this._$viewportWidth,this._$viewportHeight,this._$grid),this._$gl.enable(this._$gl.STENCIL_TEST),this._$gl.stencilMask(255),this._$gl.enable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.ALWAYS,0,255),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.INVERT,this._$gl.INVERT),this._$gl.colorMask(!1,!1,!1,!1),h._$fill(i),this._$gl.disable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.NOTEQUAL,0,255),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.ZERO,this._$gl.ZERO),this._$gl.colorMask(!0,!0,!0,!0),c._$fill(i),this._$gl.disable(this._$gl.STENCIL_TEST),this.releaseFillVertexArray(i)}releaseFillVertexArray(t){this._$vao.releaseFill(t);const e=t.indexRanges;for(let i=0;i<e.length;++i)ni.indexRangePool.push(e[i]);V(e)}_$enterClip(){this._$mask._$enterClip()}_$beginClipDef(){this._$mask._$beginClipDef()}_$updateContainerClipFlag(t){this._$mask.containerClip=t}_$startClip(t){const e=t.xMin,i=t.yMin,r=Math.abs(t.xMax-t.xMin),n=Math.abs(t.yMax-t.yMin),o=this._$frameBufferManager.currentAttachment;if(!o)throw new Error("the current Attachment is null.");return e>o.width||i>o.height||0>e&&0>=r+e||0>i&&0>=n+i?!1:(this._$maskBounds.xMin=d.max(0,d.min(this._$maskBounds.xMin,e)),this._$maskBounds.yMin=d.max(0,d.min(this._$maskBounds.yMin,i)),this._$maskBounds.xMax=d.min(o.width,d.min(this._$maskBounds.xMax,r)),this._$maskBounds.yMax=d.min(o.height,d.min(this._$maskBounds.yMax,n)),!0)}_$endClipDef(){this._$mask._$endClipDef()}_$leaveClip(){this.drawInstacedArray(),this._$mask._$leaveClip()}_$drawContainerClip(){this._$mask._$drawContainerClip()}closePath(){this._$path.close()}stroke(){const t=this._$path.vertices;if(!t.length)return;const e=A();for(let m=0;m<t.length;++m){const p=t[m];6>p.length||e.push(p)}if(!e.length){V(e);return}const i=this._$vao.createStroke(t,this.lineCap,this.lineJoin);let r=this._$matrix;const n=this.strokeStyle;let a=d.sign(r[0]*r[4]);a>0&&r[1]!==0&&r[3]!==0&&(a=-d.sign(r[1]*r[3]));let o=this.lineWidth*.5,c,u;this._$grid.enabled?(c=d.abs(this._$grid.ancestorMatrixA+this._$grid.ancestorMatrixD),u=d.abs(this._$grid.ancestorMatrixB+this._$grid.ancestorMatrixE)):(c=d.abs(r[0]+r[3]),u=d.abs(r[1]+r[4]));const l=d.min(c,u),h=d.max(c,u);o*=h*(1-.3*d.cos(d.PI*.5*(l/h))),o=d.max(1,o);const $=this._$grid.enabled;let _,g,f;if(n instanceof Qs){n.type==="radial"&&(r=this._$stack[this._$stack.length-1]);const m=n.stops,p=n.rgb==="linearRGB";if(_=this._$gradientLUT.generateForShape(m,p),this._$frameBufferManager.textureManager.bind0(_,!0),g=this._$shaderList.gradientShapeShaderVariants,n.type==="linear")f=g.getGradientShapeShader(!0,$,!1,!1,n.mode),g.setGradientShapeUniform(f.uniform,!0,o,a,this.miterLimit,$,r,Be(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,!1,n.points,0);else{r=this._$stack[this._$stack.length-1];const x=n.focalPointRatio!==0;f=g.getGradientShapeShader(!0,$,!0,x,n.mode),g.setGradientShapeUniform(f.uniform,!0,o,a,this.miterLimit,$,r,Be(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,!0,n.points,n.focalPointRatio)}}else if(n instanceof or){r=this._$stack[this._$stack.length-1];const m=n.colorTransform;_=n.texture,this._$frameBufferManager.textureManager.bind0(_),g=this._$shaderList.shapeShaderVariants,f=g.getBitmapShapeShader(!0,n.repeat,this._$grid.enabled),m?g.setBitmapShapeUniform(f.uniform,!0,o,a,this.miterLimit,$,r,Be(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,_.width,_.height,m[0],m[1],m[2],this._$globalAlpha,m[4]/255,m[5]/255,m[6]/255,0):g.setBitmapShapeUniform(f.uniform,!0,o,a,this.miterLimit,$,r,Be(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,_.width,_.height,1,1,1,this._$globalAlpha,0,0,0,0)}else g=this._$shaderList.shapeShaderVariants,f=g.getSolidColorShapeShader(!0,this._$grid.enabled),g.setSolidColorShapeUniform(f.uniform,!0,o,a,this.miterLimit,$,r,this._$viewportWidth,this._$viewportHeight,this._$grid,n,this._$globalAlpha);f._$stroke(i),this._$vao.releaseStroke(i)}arc(t,e,i){this._$path.drawCircle(t,e,i)}clip(){const t=this._$path.vertices;if(!t.length)return;const e=A();for(let o=0;o<t.length;++o){const c=t[o];10>c.length||e.push(c)}if(!e.length){V(e);return}const i=this._$vao.createFill(e),r=this._$shaderList.shapeShaderVariants,n=r.getMaskShapeShader(!1,!1),a=n.uniform;r.setMaskShapeUniform(a,!1,this._$matrix[0],this._$matrix[1],this._$matrix[2],this._$matrix[3],this._$matrix[4],this._$matrix[5],this._$matrix[6],this._$matrix[7],this._$matrix[8],this._$viewportWidth,this._$viewportHeight,null),!this._$mask._$onClip(i,this._$matrix,this._$viewportWidth,this._$viewportHeight)&&(n._$fill(i),this.beginPath())}save(){const t=this._$matrix;this._$stack.push(bn(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])),this._$mask._$onSave()}restore(){this._$stack.length&&(j_(this._$matrix),this._$matrix=this._$stack.pop()||bn()),this._$mask._$onRestore()}createPattern(t,e,i){return new or(t,e,i)}createLinearGradient(t,e,i,r,n="rgb",a="pad"){return new Qs().linear(t,e,i,r,n,a)}createRadialGradient(t,e,i,r,n,a,o="rgb",c="pad",u=0){return new Qs().radial(t,e,i,r,n,a,o,c,u)}_$applyBlurFilter(t,e,i){const r=this._$frameBufferManager,n=r.currentAttachment;if(!n)throw new Error("the current attachment is null.");const a=n.width,o=n.height;r.textureManager.bind0(t,!0);const c=d.ceil(i*.5),u=1-(c-i*.5),l=1+i,h=this._$shaderList.filterShaderVariants,$=h.getBlurFilterShader(c);h.setBlurFilterUniform($.uniform,a,o,e,u,l),$._$drawImage()}_$applyBitmapFilter(t,e,i,r,n,a,o,c,u,l,h,$,_,g,f,m=null,p=null,x=null,b=0,T=0,y=0,v=0,L=0,B=0,F=0,R=0){const w=this._$frameBufferManager,I=_==="inner",D=w.currentAttachment,N=w.getTextureFromCurrentAttachment();let Y=null;const q=m!==null&&p!==null&&x!==null;m!==null&&p!==null&&x!==null&&(Y=this._$gradientLUT.generateForFilter(m,p,x));let ot;I?q&&Y?w.textureManager.bind02(t,Y,!0):w.textureManager.bind0(t):(ot=this._$frameBufferManager.createTextureAttachment(e,i),this._$bind(ot),q&&Y?w.textureManager.bind012(t,N,Y,!0):w.textureManager.bind01(t,N));const G=!(I||_==="full"&&g),Vt=!(e===c&&i===u&&l===0&&h===0),Ce=f!==1,Ee=this._$shaderList.filterShaderVariants,ce=Ee.getBitmapFilterShader(G,Vt,$,_,g,Ce,q);Ee.setBitmapFilterUniform(ce.uniform,e,i,r,n,a,o,c,u,l,h,$,f,b,T,y,v,L,B,F,R,G,Vt,Ce,q),I?g?this.blend.toSourceIn():this.blend.toSourceAtop():this.blend.toOneZero(),ce._$drawImage(),I||w.releaseAttachment(D,!0)}_$applyColorMatrixFilter(t,e){this._$frameBufferManager.textureManager.bind0(t,!0);const i=this._$shaderList.filterShaderVariants,r=i.getColorMatrixFilterShader();i.setColorMatrixFilterUniform(r.uniform,e),this.blend.reset(),r._$drawImage()}_$applyConvolutionFilter(t,e,i,r,n,a,o,c,u,l,h,$){const _=t.width,g=t.height,f=this._$frameBufferManager.createTextureAttachment(_,g);this._$bind(f),this._$frameBufferManager.textureManager.bind0(t,!0);const m=this._$shaderList.filterShaderVariants,p=m.getConvolutionFilterShader(e,i,o,c);m.setConvolutionFilterUniform(p.uniform,_,g,r,n,a,c,u,l,h,$),this.blend.reset(),p._$drawImage()}_$applyDisplacementMapFilter(t,e,i,r,n,a,o,c,u,l,h,$,_,g){const f=t.width,m=t.height,p=this._$frameBufferManager.createTextureAttachment(f,m);this._$bind(p),n||(n={x:0,y:0});const x=this._$frameBufferManager.createTextureFromImage(e);this._$frameBufferManager.textureManager.bind01(t,x);const b=this._$shaderList.filterShaderVariants,T=b.getDisplacementMapFilterShader(a,o,l);b.setDisplacementMapFilterUniform(T.uniform,e.width,e.height,i,r,n.x,n.y,c,u,l,h,$,_,g),this.blend.reset(),T._$drawImage(),this._$frameBufferManager.releaseTexture(x)}_$startLayer(t){this._$positions.push(t),this._$blends.push(this._$isLayer),this._$isLayer=!0}_$endLayer(){const t=this._$positions.pop();t&&W(t),this._$isLayer=!!this._$blends.pop()}_$saveAttachment(t,e,i=!1){this.drawInstacedArray();const r=this._$frameBufferManager;this._$attachmentArray.push(r.currentAttachment),this._$bind(r.createCacheAttachment(t,e,i))}_$restoreAttachment(t=!1){const e=this._$frameBufferManager;e.releaseAttachment(e.currentAttachment,t),this._$bind(this._$attachmentArray.pop())}getCurrentPosition(){return this._$positions[this._$positions.length-1]}textureScale(t,e){const i=d.max(t,e);return i>this._$maxTextureSize?this._$maxTextureSize/i:1}}class hi{constructor(){U_(window.devicePixelRatio),this._$stage=new vl,this._$stage._$player=this,this._$mode="loader",this._$actionOffset=0,this._$actions=A(),this._$loaders=A(),this._$sounds=yt(),this._$hitObject={x:0,y:0,pointer:"",hit:null},this._$rollOverObject=null,this._$mouseOverTarget=null,this._$ratio=at,this._$stopFlag=!0,this._$startTime=0,this._$fps=16,this._$loadStatus=0,this._$width=0,this._$height=0,this._$baseWidth=0,this._$baseHeight=0,this._$scale=1,this._$matrix=Pt(1,0,0,1,0,0),this._$tx=0,this._$ty=0,this._$state="up",this._$hitTestStart=!1,this._$stageX=-1,this._$stageY=-1,this._$deltaX=0,this._$deltaY=0,this._$broadcastEvents=yt(),this._$optionWidth=0,this._$optionHeight=0,this._$tagId="",this._$bgColor="transparent",this._$base="",this._$fullScreen=!1,this._$quality="high",this._$sources=A(),this._$videos=A(),this._$textField=null,this._$timerId=-1,this._$loadId=-1,this._$context=null,this._$attachment=null,this._$clickTarget=null,this._$actionProcess=!1,this._$canvas=Dt.createElement("canvas")}static get LOAD_START(){return 1}static get LOAD_END(){return 2}get cacheStore(){return J}get canvas(){return this._$canvas}get broadcastEvents(){return this._$broadcastEvents}get context(){return this._$context}set context(t){this._$context=t}get base(){return this._$base}set base(t){if(t.indexOf("//")===-1){const e=t.split("/");(e[0]===""||e[0]===".")&&e.shift(),e.pop(),this._$base=`${location.origin}/`,e.length&&(this._$base+=`${e.join("/")}/`)}else if(t.indexOf("?")===-1)this._$base=t.slice(-1)==="/"?t:`${t}/`;else{const e=t.split("?")[0];this._$base=e.slice(-1)==="/"?e:`${e}/`}}get stage(){return this._$stage}get x(){return this._$tx}get y(){return this._$ty}get scaleX(){return this._$matrix[0]}get scaleY(){return this._$matrix[3]}get tx(){return this._$matrix[4]/this._$scale/at}get ty(){return this._$matrix[5]/this._$scale/at}get mode(){return this._$mode}set mode(t){this._$mode=t}get contentElementId(){return Gc}get width(){return this._$baseWidth}set width(t){this._$baseWidth=t|0}get height(){return this._$baseHeight}set height(t){this._$baseHeight=t|0}get bgColor(){return this._$bgColor}set bgColor(t){this._$bgColor=`${t}`}play(){if(this._$stopFlag){this._$stopFlag=!1,this._$timerId>-1&&us(this._$timerId),this._$startTime=$r.now();const t=this._$stage._$frameRate;this._$fps=1e3/t|0,this._$timerId=Ze(e=>{this._$run(e)})}}stop(){this._$timerId>-1&&us(this._$timerId),this._$stopFlag=!0,this._$timerId=-1,ls.stopAll(),J.reset(),X&&X.postMessage({command:"stop"})}removeCache(t){J.removeCache(t),X&&X.postMessage({command:"removeCache",id:t})}setOptions(t=null){t&&(this._$optionWidth=t.width||this._$optionWidth,this._$optionHeight=t.height||this._$optionHeight,this._$tagId=t.tagId||this._$tagId,this.base=t.base||this._$base,this._$bgColor=t.bgColor||this._$bgColor,this._$fullScreen=!!t.fullScreen)}_$loadWebAudio(t=null){t&&this._$canvas.removeEventListener(ns,this._$loadWebAudio),vt||Kc()}_$updateLoadStatus(){if(this._$loadStatus===hi.LOAD_END){this._$loadId>-1&&us(this._$loadId),this._$loadId=-1,this._$loaded();return}this._$loadId=Ze(()=>{this._$updateLoadStatus()})}_$loaded(){const t=Dt.getElementById(this.contentElementId);if(t){this._$setBackgroundColor(this._$bgColor),this._$deleteNode(),t.appendChild(this._$canvas),t.appendChild(Ct),this._$stage._$prepareActions(),this._$broadcastEvents.has(S.FRAME_CONSTRUCTED)&&this._$dispatchEvent(new S(S.FRAME_CONSTRUCTED)),this._$doAction(),this._$broadcastEvents.has(S.EXIT_FRAME)&&this._$dispatchEvent(new S(S.EXIT_FRAME));const e=this._$loaders.length;for(let i=0;i<e;++i){const r=this._$loaders.shift();r.hasEventListener(S.INIT)&&r.dispatchEvent(new S(S.INIT)),r.hasEventListener(S.COMPLETE)&&r.dispatchEvent(new S(S.COMPLETE))}this._$broadcastEvents.has(S.ACTIVATE)&&this._$dispatchEvent(new S(S.ACTIVATE)),this._$doAction(),this._$draw(),this.play()}}_$initialize(){const t=this.contentElementId;if(!this._$tagId)Dt.body.insertAdjacentHTML("beforeend",`<div id="${t}" tabindex="-1"></div>`);else{const r=Dt.getElementById(this._$tagId);if(!r){alert("Not Found Tag ID:"+this._$tagId);return}if(Dt.getElementById(t))this._$deleteNode();else{const a=Dt.createElement("div");a.id=t,a.tabIndex=-1,r.appendChild(a)}}const e=Dt.getElementById(t);if(!e)throw new Error("the content element is null.");const i=e.parentElement;if(i){this._$initStyle(e),this._$buildWait();const r=this._$optionWidth?this._$optionWidth:i.tagName==="BODY"?Ut.innerWidth:i.offsetWidth,n=this._$optionHeight?this._$optionHeight:i.tagName==="BODY"?Ut.innerHeight:i.offsetHeight;this._$mode==="loader"&&r&&n&&(this._$baseWidth=r,this._$baseHeight=n,this._$resize())}this._$mode==="loader"?(this._$loadStatus=hi.LOAD_START,this._$updateLoadStatus()):(this._$resize(),this._$loaded())}_$initStyle(t){const e=t.style;e.position="relative",e.top="0",e.left="0",e.backgroundColor="transparent",e.overflow="hidden",e.padding="0",e.margin="0",e.userSelect="none",e.outline="none";const i=this._$optionWidth,r=this._$optionHeight,n=t.parentElement;if(!n)throw new Error("the parentElement is null.");if(n.tagName==="BODY"){e.width=i?`${i}px`:`${window.innerWidth}px`,e.height=r?`${r}px`:`${window.innerHeight}px`;return}e.width=i?`${i}px`:`${n.offsetWidth}px`,e.height=r?`${r}px`:`${n.offsetHeight}px`}_$buildWait(){const t=Dt.getElementById(this.contentElementId);if(t){const e=`${this.contentElementId}_loading`;t.innerHTML=`<style>
#${e} {
    position: absolute;
    top: 50%;
    left: 50%;
    margin: -24px 0 0 -24px;
    width: 50px;
    height: 50px;
    border-radius: 50px;
    border: 8px solid #dcdcdc;
    border-right-color: transparent;
    box-sizing: border-box;
    animation: ${e} 0.8s infinite linear;
}
@keyframes ${e} {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}
</style>`;const i=Dt.createElement("div");i.id=e,t.appendChild(i)}}_$deleteNode(){const t=Dt.getElementById(this.contentElementId);if(t)for(;t.childNodes.length;)t.removeChild(t.childNodes[0])}_$initializeCanvas(){if(this._$canvas.width=1,this._$canvas.height=1,X){const i=this._$canvas.transferControlToOffscreen(),r=ur();let n=0;r[n++]=this._$stage._$instanceId,r[n++]=+Yl,r[n++]=at,r[n++]=this._$getSamples();const a=A(i,r.buffer);X.postMessage({command:"initialize",canvas:i,buffer:r},a),V(a)}else{const i=this._$canvas.getContext("webgl2",{stencil:!0,premultipliedAlpha:!0,antialias:!1,depth:!1,preserveDrawingBuffer:!0});i?(this._$context=new Qf(i,this._$getSamples()),J.context=this._$context):alert("WebGL setting is off. Please turn the setting on.")}const t=()=>{if(this._$canvas.removeEventListener(ns,t),this._$canvas.removeEventListener(vs,t),!vt){Kc();for(let i=0;i<this._$videos.length;++i){const r=this._$videos[i];r._$video&&(r._$video.muted=!1)}}};this._$canvas.addEventListener(vs,t),this._$canvas.addEventListener(ns,t),this._$canvas.addEventListener(Zi,i=>{Te(i),Oe(Zi),this._$hitTest()}),this._$canvas.addEventListener(Se,i=>{Te(i),Oe(Se),this._$hitTest()}),this._$canvas.addEventListener(vs,i=>{Te(i),Oe(vs),this._$hitTest()}),this._$canvas.addEventListener(Se,i=>{Te(i),Oe(Se),this._$hitTest()},{passive:!1}),this._$canvas.addEventListener(Ji,i=>{Te(i),Oe(Ji),i.button||this._$hitTest()}),this._$canvas.addEventListener(Qi,i=>{Te(i),Oe(Qi),i.button||this._$hitTest()}),this._$canvas.addEventListener(Na,i=>{Te(i),Oe(Na),this._$hitTest(),Te(null),this._$stageX=-1,this._$stageY=-1}),this._$canvas.addEventListener(ns,i=>{Te(i),Oe(ns),i.button||this._$hitTest()}),this._$canvas.addEventListener(je,i=>{Te(i),Oe(je),this._$hitTest()}),this._$canvas.addEventListener(jr,i=>{i.defaultPrevented||(Te(i),Oe(jr),this._$hitTest())},{passive:!1});let e="";e+="position: absolute;",e+="top: 0;",e+="left: 0;",e+="-webkit-tap-highlight-color: rgba(0,0,0,0);",e+="backface-visibility: hidden;",e+="transform-origin: 0 0;",at!==1&&(e+=`transform: scale(${1/at});`),this._$canvas.setAttribute("style",e)}_$resize(){const t=Dt.getElementById(this.contentElementId);if(t){const e=t.parentElement;if(!e)throw new Error("the parentElement is null.");const i=this._$optionWidth?this._$optionWidth:e.tagName==="BODY"?Ut.innerWidth:e.offsetWidth?e.offsetWidth:parseFloat(e.style.width),r=this._$optionHeight?this._$optionHeight:e.tagName==="BODY"?Ut.innerHeight:e.offsetHeight?e.offsetHeight:parseFloat(e.style.height),n=e.tagName==="BODY"?Ut.innerWidth:e.offsetWidth,a=d.min(i/this._$baseWidth,r/this._$baseHeight);let o=this._$fullScreen?i:this._$baseWidth*a|0,c=this._$fullScreen?r:this._$baseHeight*a|0;const u=t.style;if(u.width=`${o}px`,u.height=`${c}px`,u.top="0",u.left=this._$fullScreen?"0":`${n/2-o/2}px`,o*=at,c*=at,this._$width===o&&this._$height===c)return;this._$stage._$doChanged(),J.reset(),this._$scale=a,this._$width=o,this._$height=c;const l=this._$scale*this._$ratio;this._$matrix[0]=l,this._$matrix[3]=l,this._$fullScreen&&(this._$tx=(o-this._$baseWidth*a*at)/2,this._$ty=(c-this._$baseHeight*a*at)/2,this._$matrix[4]=this._$tx,this._$matrix[5]=this._$ty),this._$resizeCanvas(o,c,l,this._$tx,this._$ty),this._$ratio>1&&at>1&&(this._$canvas.style.transform=`scale(${1/this._$ratio})`),t.children.length>1&&t.children[1].dispatchEvent(new Event(`${Gc}_blur`))}}_$setBackgroundColor(t="transparent"){if(X){const e=ur();e[0]=t==="transparent"?-1:It(t);const i=di();i.command="setBackgroundColor",i.buffer=e;const r=A(e.buffer);X.postMessage(i,r),$i(i),V(r)}else{const e=this._$context;if(!e)return;if(t==="transparent")e._$setColor(0,0,0,0);else{const i=_l(It(t));e._$setColor(i.R/255,i.G/255,i.B/255,1)}}}_$resizeCanvas(t,e,i,r=0,n=0){if(X){const a=ur();let o=0;a[o++]=t,a[o++]=e,a[o++]=i,a[o++]=r,a[o++]=n;const c=di(),u=A(a.buffer);c.command="resize",c.buffer=a,X.postMessage(c,u),$i(c),V(u)}else{const a=this._$context;if(!a)return;a.clearInstacedArray(),this._$canvas.width=t,this._$canvas.height=e,a._$gl.viewport(0,0,t,e);const o=a.frameBuffer;this._$attachment&&(o.unbind(),o.releaseAttachment(this._$attachment,!0)),this._$attachment=o.createCacheAttachment(t,e,!0),a.setMaxSize(t,e),a._$bind(this._$attachment)}}_$getSamples(){switch(this._$quality){case"high":return 4;case"medium":return 2;default:return 0}}_$dispatchEvent(t){if(this._$broadcastEvents.size&&this._$broadcastEvents.has(t.type)){const e=this._$broadcastEvents.get(t.type).slice(0);t.eventPhase=ws.AT_TARGET;for(let i=0;i<e.length;++i){const r=e[i];if(t.currentTarget=r.target,t.listener=r.listener,r.listener.call(null,t),t._$stopImmediatePropagation)break}return V(e),!0}return!1}_$run(t=0){if(this._$stopFlag)return;this._$doAction();const e=t-this._$startTime;if(e>this._$fps){if(this._$startTime=t-e%this._$fps,this._$action(),this._$sounds.size){for(const i of this._$sounds.values())i._$soundPlay();this._$sounds.clear()}this._$draw(),!Ke&&!this._$hitTestStart&&this._$state==="up"&&this._$stageX>-1&&this._$stageY>-1&&oi()&&this._$pointerCheck()}else this._$videos.length&&!X&&this._$draw();this._$timerId=Ze(i=>{this._$run(i)})}_$pointerCheck(){const t=this._$stageX,e=this._$stageY;this._$hitObject.x=t,this._$hitObject.y=e,this._$hitObject.pointer="",this._$hitObject.hit=null,ge.setTransform(1,0,0,1,0,0),ge.beginPath(),$e[4]=this._$tx/this._$scale/at,$e[5]=this._$ty/this._$scale/at,this._$stage._$mouseHit(ge,$e,this._$hitObject,!0);let i=null,r=null,n=!1,a=!1;if(this._$hitObject.hit){if(i=this._$hitObject.hit,this._$mouseOverTarget&&this._$mouseOverTarget!==i){const o=this._$mouseOverTarget;o.willTrigger(P.MOUSE_OUT)&&o.dispatchEvent(new P(P.MOUSE_OUT,!0,!1))}if(this._$rollOverObject!==i){let o=null;if(this._$rollOverObject)for(r=this._$rollOverObject,r.willTrigger(P.ROLL_OUT)&&r.dispatchEvent(new P(P.ROLL_OUT,!1,!1)),o=r._$parent;o&&o._$root!==o&&o!==i;){if(o._$mouseEnabled&&o._$outCheck(t,e)){let c=!1,u=i;for(;u&&u._$root!==u;){if(u!==o){u=u._$parent;continue}c=!0;break}if(!c&&o._$parent===i._$parent&&o._$index>i._$index&&(c=!0),c)break}o.willTrigger(P.ROLL_OUT)&&o.dispatchEvent(new P(P.ROLL_OUT,!1,!1)),o=o._$parent}for(r=i;r.willTrigger(P.ROLL_OVER)&&r.dispatchEvent(new P(P.ROLL_OVER,!1,!1)),r=r._$parent,!(!r||r===o||r.stage===r););}switch(this._$rollOverObject=i,!0){case this._$mouseOverTarget===null:case this._$mouseOverTarget!==i:i&&i.willTrigger(P.MOUSE_OVER)&&i.dispatchEvent(new P(P.MOUSE_OVER,!0,!1)),this._$mouseOverTarget=i;break}if(this._$state==="up"&&(this._$clickTarget=null),!Ke&&this._$state==="up")for(r=i;r&&r.root!==r;){if("_$text"in r&&r.type==="input"){n=!0;break}if("buttonMode"in r&&r.buttonMode){a=!0;break}r=r._$parent}}else{if(this._$mouseOverTarget&&(i=this._$mouseOverTarget,i.willTrigger(P.MOUSE_OUT)&&i.dispatchEvent(new P(P.MOUSE_OUT,!0,!1))),this._$rollOverObject)for(r=this._$rollOverObject;r&&r.root!==r;)r.willTrigger(P.ROLL_OUT)&&r.dispatchEvent(new P(P.ROLL_OUT,!1,!1)),r=r._$parent;this._$rollOverObject=null,this._$mouseOverTarget=null}switch(!0){case n:this._$canvas.style.cursor="text";break;case a:this._$canvas.style.cursor="pointer";break;case(!Ke&&this._$state==="up"):this._$canvas.style.cursor="auto";break}this._$actions.length>1&&this._$doAction()}_$action(){if(this._$stopFlag)return;let t=null;const e=this._$loaders.length;if(e){t=this._$loaders.slice(0),this._$loaders.length=0;for(let i=0;i<e;++i){const r=t[i];"content"in r&&r.content._$prepareActions()}}if(this._$stage._$nextFrame(),this._$broadcastEvents.has(S.ENTER_FRAME)&&this._$dispatchEvent(new S(S.ENTER_FRAME)),this._$broadcastEvents.has(S.FRAME_CONSTRUCTED)&&this._$dispatchEvent(new S(S.FRAME_CONSTRUCTED)),this._$doAction(),this._$broadcastEvents.has(S.EXIT_FRAME)&&this._$dispatchEvent(new S(S.EXIT_FRAME)),this._$stage._$invalidate&&(this._$stage._$invalidate=!1,this._$dispatchEvent(new S(S.RENDER))),t){for(let i=0;i<t.length;++i){const r=t[i];r.hasEventListener(S.INIT)&&r.dispatchEvent(new S(S.INIT)),r.hasEventListener(S.COMPLETE)&&r.dispatchEvent(new S(S.COMPLETE))}V(t)}this._$doAction()}_$draw(){if(!this._$width||!this._$height||!this._$stage._$isUpdated())return;X&&X.postMessage({command:"draw"});const t=this._$context;t&&(t.reset(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this._$width,this._$height),t.beginPath(),this._$stage._$draw(t,this._$matrix,vr),this._$stage._$updated=!1,t.drawInstacedArray(),t.frameBuffer.transferToMainTexture())}_$doAction(){for(;this._$actions.length;){this._$actionProcess=!0;const t=this._$actions.pop();if(!t)continue;t._$canAction=!1,t._$actionOffset=0,t._$actionLimit=0;const e=t._$currentFrame;if(!t._$actions.has(e))continue;const i=t._$actions.get(e);if(i){t._$actionProcess=!0;for(let r=0;r<i.length;++r)ri(t._$loaderInfo),i[r].apply(t);t._$actionProcess=!1,t._$frameCache.size&&(t._$currentFrame=t._$frameCache.get("nextFrame"),t._$clearChildren(),t._$stopFlag=t._$frameCache.get("stopFlag"),t._$isPlaying=t._$frameCache.get("isPlaying"),t._$frameCache.clear())}}this._$actionProcess=!1}_$hitTest(){if(this._$stopFlag)return;const t=oi();if(!t)return;this._$hitTestStart=!0,pt(!1);let e=null,i=null,r=Ut.scrollX,n=Ut.scrollY;const a=Dt.getElementById(this.contentElementId);if(a){const f=a.getBoundingClientRect();r+=f.left,n+=f.top}let o=0,c=0;if("changedTouches"in t){const f=t.changedTouches[0];o=f.pageX,c=f.pageY}else"pageX"in t&&(o=t.pageX,c=t.pageY);const u=(o-r)/this._$scale,l=(c-n)/this._$scale;this._$stageX=u,this._$stageY=l,this._$hitObject.x=u,this._$hitObject.y=l,this._$hitObject.pointer="",this._$hitObject.hit=null,ge.setTransform(1,0,0,1,0,0),ge.beginPath(),$e[4]=this._$tx/this._$scale/at,$e[5]=this._$ty/this._$scale/at,this._$stage._$mouseHit(ge,$e,this._$hitObject,!0),this._$hitObject.hit&&t.preventDefault();let h=!1,$=!1,_=!1;const g=Qu();switch(g){case Se:case je:if(ti){const f=ti._$dragMousePoint();let m=f.x,p=f.y;_e.lock||(m+=_e.position.x,p+=_e.position.y);const x=_e.bounds;x&&(m=O(m,x.left,x.right),p=O(p,x.top,x.bottom)),ti.x=m,ti.y=p}if(this._$clickTarget&&"_$text"in this._$clickTarget&&this._$clickTarget.scrollEnabled&&this._$clickTarget.selectIndex===-1){const f=this._$deltaX-o,m=this._$deltaY-c;this._$clickTarget.scrollX+=f/(this._$clickTarget.textWidth/this._$clickTarget.width),this._$clickTarget.scrollY+=m/(this._$clickTarget.textHeight/this._$clickTarget.height)}this._$deltaX=o,this._$deltaY=c;break;case Zi:case Ji:this._$deltaX=o,this._$deltaY=c,this._$state="down",_=this._$canvas.style.cursor==="pointer",$=!0;break;case vs:case ns:case Qi:this._$deltaX=0,this._$deltaY=0,this._$state="up";break}switch(!0){case this._$hitObject.hit===null:case g===Na:if(this._$mouseOverTarget&&(e=this._$mouseOverTarget,e.willTrigger(P.MOUSE_OUT)&&e.dispatchEvent(new P(P.MOUSE_OUT,!0,!1))),this._$rollOverObject)for(i=this._$rollOverObject;i&&i.root!==i;)i.willTrigger(P.ROLL_OUT)&&i.dispatchEvent(new P(P.ROLL_OUT,!1,!1)),i=i._$parent;switch(this._$rollOverObject=null,this._$mouseOverTarget=null,g){case jr:this._$stage.hasEventListener(P.MOUSE_WHEEL)&&this._$stage.dispatchEvent(new P(P.MOUSE_WHEEL,!0,!1));break;case Zi:case Ji:this._$textField&&"focus"in this._$textField&&(this._$textField.focus=!1,this._$textField=null),this._$stage.hasEventListener(P.MOUSE_DOWN)&&this._$stage.dispatchEvent(new P(P.MOUSE_DOWN,!0,!1));break;case vs:case ns:this._$stage.hasEventListener(P.CLICK)&&this._$stage.dispatchEvent(new P(P.CLICK,!0,!1)),this._$stage.hasEventListener(P.MOUSE_UP)&&this._$stage.dispatchEvent(new P(P.MOUSE_UP,!0,!1));break;case Se:case je:this._$stage.hasEventListener(P.MOUSE_MOVE)&&this._$stage.dispatchEvent(new P(P.MOUSE_MOVE,!0,!1));break;case Qi:this._$stage.hasEventListener(P.DOUBLE_CLICK)&&this._$stage.dispatchEvent(new P(P.DOUBLE_CLICK,!0,!1));break}break;default:switch(e=this._$hitObject.hit,g){case Se:case je:if(e.willTrigger(P.MOUSE_MOVE)&&e.dispatchEvent(new P(P.MOUSE_MOVE,!0,!1)),this._$mouseOverTarget&&this._$mouseOverTarget!==e){const f=this._$mouseOverTarget;f.willTrigger(P.MOUSE_OUT)&&f.dispatchEvent(new P(P.MOUSE_OUT,!0,!1))}if(this._$rollOverObject!==e){let f=null;if(this._$rollOverObject)for(i=this._$rollOverObject,i.willTrigger(P.ROLL_OUT)&&i.dispatchEvent(new P(P.ROLL_OUT,!1,!1)),f=i._$parent;f&&f._$root!==f&&f!==e;){if(f._$mouseEnabled&&f._$outCheck(u,l)){let m=!1,p=e;for(;p&&p._$root!==p;){if(p!==f){p=p._$parent;continue}m=!0;break}if(!m&&f._$parent===e._$parent&&f._$index>e._$index&&(m=!0),m)break}f.willTrigger(P.ROLL_OUT)&&f.dispatchEvent(new P(P.ROLL_OUT,!1,!1)),f=f._$parent}for(i=e;i.willTrigger(P.ROLL_OVER)&&i.dispatchEvent(new P(P.ROLL_OVER,!1,!1)),i=i._$parent,!(!i||i===f||i.stage===i););}switch(this._$rollOverObject=e,!0){case this._$mouseOverTarget===null:case this._$mouseOverTarget!==e:e.willTrigger(P.MOUSE_OVER)&&e.dispatchEvent(new P(P.MOUSE_OVER,!0,!1)),this._$mouseOverTarget=e;break}this._$state==="up"?this._$clickTarget=null:this._$textField&&this._$textField._$setIndex(u-$e[4],l-$e[5]);break;case Zi:case Ji:this._$textField&&e!==this._$textField&&(this._$textField.focus=!1,this._$textField=null),"_$text"in e&&(e.focus=!0,e._$setIndex(u-$e[4],l-$e[5]),this._$textField=e,Ct.style.left=`${o}px`,Ct.style.top=`${c}px`),e.willTrigger(P.MOUSE_DOWN)&&e.dispatchEvent(new P(P.MOUSE_DOWN,!0,!1)),this._$clickTarget=e;break;case vs:case ns:e.willTrigger(P.MOUSE_UP)&&e.dispatchEvent(new P(P.MOUSE_UP,!0,!1)),this._$clickTarget===e&&e.willTrigger(P.CLICK)&&e.dispatchEvent(new P(P.CLICK,!0,!1)),this._$clickTarget=null;break;case jr:e.willTrigger(P.MOUSE_WHEEL)&&e.dispatchEvent(new P(P.MOUSE_WHEEL)),e.scrollEnabled&&("deltaX"in t&&(e.scrollX+=t.deltaX/(e.textWidth/e.width)),"deltaY"in t&&(e.scrollY+=t.deltaY/(e.textHeight/e.height)));break;case Qi:e.willTrigger(P.DOUBLE_CLICK)&&e.dispatchEvent(new P(P.DOUBLE_CLICK));break}if(!$&&!Ke&&this._$state==="up")for(i=e;i&&i.root!==i;){if("_$text"in i){if(i.type==="input"){h=!0;break}}else if(i._$buttonMode){_=!0;break}i=i._$parent}break}switch(!0){case h:this._$canvas.style.cursor="text";break;case _:this._$canvas.style.cursor="pointer";break;case(!Ke&&this._$state==="up"):this._$canvas.style.cursor="auto";break}!this._$actionProcess&&this._$actions.length>1&&this._$doAction(),W_()&&(this._$stage._$prepareActions(),this._$actionProcess||this._$doAction()),this._$hitTestStart=!1}}const co={Event:S,EventDispatcher:Ei,EventPhase:ws,FocusEvent:xn,HTTPStatusEvent:yn,IOErrorEvent:fe,MouseEvent:P,ProgressEvent:Lt,VideoEvent:At};Object.entries(co).forEach(([s,t])=>{Object.defineProperty(co,s,{get(){return t}})});const uo={DisplayObject:sa,InteractiveObject:nr,DisplayObjectContainer:Yt,Sprite:fr,MovieClip:Ln,BitmapData:Ms,BlendMode:J_,FrameLabel:pl,Graphics:U,Loader:Tl,LoaderInfo:bl,Shape:gr,Stage:vl,TextField:oo};Object.entries(uo).forEach(([s,t])=>{Object.defineProperty(uo,s,{get(){return t}})});const lo={BevelFilter:jn,BlurFilter:Ne,ColorMatrixFilter:Kn,ConvolutionFilter:qn,DisplacementMapFilter:Zn,DropShadowFilter:Jn,GlowFilter:Qn,GradientBevelFilter:ta,GradientGlowFilter:ea};Object.entries(lo).forEach(([s,t])=>{Object.defineProperty(lo,s,{get(){return t}})});const ho={ColorTransform:fl,Matrix:gl,Point:Mt,Rectangle:ue,Transform:ml};Object.entries(ho).forEach(([s,t])=>{Object.defineProperty(ho,s,{get(){return t}})});const $o={Sound:xl,SoundMixer:ls,SoundTransform:El,Video:Qa};Object.entries($o).forEach(([s,t])=>{Object.defineProperty($o,s,{get(){return t}})});const _o={URLRequest:Lo,URLRequestHeader:Ao};Object.entries(_o).forEach(([s,t])=>{Object.defineProperty(_o,s,{get(){return t}})});const fo={TextFormat:ia};Object.entries(fo).forEach(([s,t])=>{Object.defineProperty(fo,s,{get(){return t}})});const go={Easing:hs,Job:Sl,Tween:to};Object.entries(go).forEach(([s,t])=>{Object.defineProperty(go,s,{get(){return t}})});var t0=function(s,t,e,i){function r(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function o(l){try{u(i.next(l))}catch(h){a(h)}}function c(l){try{u(i.throw(l))}catch(h){a(h)}}function u(l){l.done?n(l.value):r(l.value).then(o,c)}u((i=i.apply(s,t||[])).next())})};class e0{constructor(t){this._$promises=t,this._$player=new hi,this.display=uo,this.events=co,this.filters=lo,this.geom=ho,this.media=$o,this.net=_o,this.text=fo,this.ui=go}get player(){return this._$player}load(t,e){Promise.all(this._$promises).then(()=>{if(V(this._$promises),t==="develop"){const r=location.search.slice(1).split("&")[0];if(!r)return;t=`${location.origin}/${r}`}if(!t)return;t.charAt(1)==="/"&&(t=t.slice(1)),(!e||!("base"in e))&&t.indexOf("//")>-1&&(this._$player.base=t),this._$player.setOptions(e),this._$player._$initialize();const i=new Tl;i.contentLoaderInfo.addEventListener(fe.IO_ERROR,r=>{r.target&&r.target.removeEventListener(fe.IO_ERROR,r.listener),alert("Error: "+r.text)}),i.contentLoaderInfo.addEventListener(S.COMPLETE,r=>{const n=r.target,a=this._$player;if(n.removeEventListener(S.COMPLETE,r.listener),n._$data){const o=n._$data.stage;a.bgColor=o.bgColor,a._$setBackgroundColor(o.bgColor),a.stage.addChild(n.content),a.width=o.width,a.height=o.height,a.stage._$frameRate=O(+o.fps,1,60,60)}a._$resize()}),i.load(new Lo(t))})}createRootMovieClip(t=240,e=240,i=24,r=null){return t0(this,void 0,void 0,function*(){yield Promise.all(this._$promises),V(this._$promises);const n=this._$player;n.width=t|0,n.height=e|0,n.mode="create",n.stage._$frameRate=i|0,n.setOptions(r),n._$initialize();const a=n.stage.addChild(new fr);return n._$loadStatus=hi.LOAD_END,n.play(),a})}}const Gc="__next2d__",Zi="touchstart",Se="touchmove",vs="touchend",Ji="mousedown",je="mousemove",ns="mouseup",jr="wheel",Qi="dblclick",Na="mouseleave";let vt=null;const Ss=new Map;let ti=null;const zc=s=>{ti=s},_e={lock:!1,position:{x:0,y:0},bounds:null},Hc=new Float32Array(256);for(let s=0;s<256;++s)Hc[s]=d.pow(s/255,2.23333333),Hc[s]=s/255;const $e=new Float32Array([1,0,0,1,0,0]),cr=[],Ul=[],mo=[],s0=new Map;let Yl=!1,Kr=!1,qr=!1,Ke=!1;const Ct=Dt.createElement("textarea");let Ue="";Ue+="position: fixed;";Ue+="top: 0;";Ue+="left: 0;";Ue+="font-size: 16px;";Ue+="border: 0;";Ue+="resize: none;";Ue+="opacity: 0;";Ue+="z-index: -1;";Ue+="pointer-events: none;";Ct.setAttribute("style",Ue);Ct.tabIndex=-1;Ct.addEventListener("compositionstart",()=>{const t=Ut.next2d.player._$textField;t&&t.compositionStart()});Ct.addEventListener("compositionupdate",s=>{const e=Ut.next2d.player._$textField;e&&e.compositionUpdate(s.data)});Ct.addEventListener("compositionend",()=>{const t=Ut.next2d.player._$textField;t&&t.compositionEnd()});Ct.addEventListener("input",s=>{if(!s.data)return;const e=Ut.next2d.player._$textField;e&&e.insertText(s.data)});Ct.addEventListener("keydown",s=>{const e=Ut.next2d.player._$textField;if(e)switch(s.key){case"Backspace":case"Delete":e.deleteText();break;case"Enter":e.insertText(`
`);break;case"ArrowLeft":e.arrowLeft();break;case"ArrowRight":e.arrowRight();break;case"ArrowUp":e.arrowUp();break;case"ArrowDown":e.arrowDown();break;case"a":(s.metaKey||s.ctrlKey)&&(s.preventDefault(),e.selectAll());break;case"v":(s.metaKey||s.ctrlKey)&&(s.preventDefault(),e.paste());break;case"c":(s.metaKey||s.ctrlKey)&&(s.preventDefault(),e.copy());break}});const Bo=Dt.createElement("canvas");Bo.width=1;Bo.height=1;const ra=Bo.getContext("2d");if(!ra)throw new Error("the CanvasRenderingContext2D is null.");ra.globalAlpha=0;ra.imageSmoothingEnabled=!1;const ge=ra,jc=[],Bn=[],ur=()=>jc.length?jc.pop():new Float32Array(64),di=()=>Bn.length?Bn.pop():{command:""},$i=s=>{s.buffer=null,Bn.push(s),console.log("renderMessageArray: ",Bn)},nt=()=>Ut.next2d.player,Rn=()=>{const s=oi();if(!s)return new Mt;const t=nt();let e=Ut.scrollX,i=Ut.scrollY;const r=Dt.getElementById(t.contentElementId);if(r){const u=r.getBoundingClientRect();e+=u.left,i+=u.top}let n=0,a=0;if("changedTouches"in s){const u=s.changedTouches[0];n=u.pageX,a=u.pageY}else"pageX"in s&&(n=s.pageX,a=s.pageY);const o=(n-e)/t._$scale-t.x/t._$scale/at,c=(a-i)/t._$scale-t.y/t._$scale/at;return new Mt(o,c)},er=(s=1,t=0,e=0,i=1,r=0,n=0)=>{const a=Ul.pop();return a?(a.setTo(s,t,e,i,r,n),a):new gl(s,t,e,i,r,n)},Zt=s=>{Ul.push(s)},sr=(s=1,t=1,e=1,i=1,r=0,n=0,a=0,o=0)=>{const c=mo.length?mo.pop():null;return c?(c.redMultiplier=s,c.greenMultiplier=t,c.blueMultiplier=e,c.alphaMultiplier=i,c.redOffset=r,c.greenOffset=n,c.blueOffset=a,c.alphaOffset=o,c):new fl(s,t,e,i,r,n,a,o)},Xl=s=>{mo.push(s)},Wl=(s,t)=>{s._$character?s._$character.audioBuffer=t:s._$audioBuffer=t},i0=(s,t)=>{if(!vt)throw new Error("the Audio Context is null.");const e=new Uint8Array(t);let i=0;for(;i=e.indexOf(255,i),!(i===-1||(e[i+1]&224)===224);)++i;if(i>-1)return vt.decodeAudioData(e.subarray(i).buffer).then(r=>(Wl(s,r),Promise.resolve(s))).catch(()=>{throw new Error("This voice data is not available.")});throw new Error("This voice data is not available.")},po=s=>{if(!vt)throw new Error("the AudioContext is null.");let t=null;if(s._$character){const e=s._$character.buffer;e&&(t=new Uint8Array(e).buffer,V(e),s._$character.buffer=null)}else t=s._$arrayBuffer;return t?vt.decodeAudioData(t).then(e=>(Wl(s,e),Promise.resolve(s))).catch(()=>{if(!t)throw new Error;return i0(s,t)}):Promise.resolve(s)},Kc=()=>{if(vt||(vt=new AudioContext,vt.resume()),vt){const s=A();for(let t=0;t<cr.length;++t){const e=cr[t];e._$character&&e._$character.audioBuffer&&s.push(Promise.resolve(e)),e._$audioBuffer&&s.push(Promise.resolve(e)),s.push(po(e))}Promise.all(s).then(t=>{cr.length=0,nt()._$loaders.push(...t)})}};let qc=-1;const r0=()=>{const s=nt();if(s._$loadStatus===hi.LOAD_END){s._$resize();const t=s.stage;t.willTrigger(S.RESIZE)&&t.dispatchEvent(new S(S.RESIZE))}};Ut.addEventListener("resize",()=>{qt(qc),qc=_r(r0,300)});const Vl=s=>{let t=null;switch(s.method.toUpperCase()){case"GET":if(s.data){const i=s.url.split("?");i[1]=i.length===1?s.data.toString():`${i[1]}&${s.data.toString()}`,s.url=i.join("?")}break;case"PUT":case"POST":s.data&&(t=s.data.toString());break}const e=new XMLHttpRequest;if(e.open(s.method,s.url,!0),e.responseType=s.format,e.withCredentials=s.withCredentials,s.event){const i=Object.keys(s.event);for(let r=0;r<i.length;++r){const n=i[r];e.addEventListener(n,s.event[n])}V(i)}for(let i=0;i<s.headers.length;++i){const r=s.headers[i];e.setRequestHeader(r.name,r.value)}e.send(t)},n0=s=>{const t=A();if(s){const e=s.trim().split(`
`),i=e.length;for(let r=0;r<i;++r){const n=e[r].split(":");t.push(new Ao(`${n[0].trim()}`,`${n[1].trim()}`))}}return t},Zc=new Map([["normal",1],["layer",2],["multiply",3],["screen",4],["lighten",5],["darken",6],["difference",7],["add",8],["subtract",9],["invert",10],["alpha",11],["erase",12],["overlay",13],["hardlight",14]]),a0=s=>Zc.has(s)&&Zc.get(s)||1,o0=s=>{switch(s){case Ln.namespace:return new Ln;case gr.namespace:return new gr;case oo.namespace:return new oo;case fr.namespace:return new fr;case Qa.namespace:return new Qa}};let X=null,Fn=null;const c0=URL.createObjectURL(new Blob(['(()=>{"use strict";var r=Uint8Array,n=Uint16Array,e=Int32Array,a=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),t=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),i=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(r,a){for(var t=new n(31),i=0;i<31;++i)t[i]=a+=1<<r[i-1];var o=new e(t[30]);for(i=1;i<30;++i)for(var f=t[i];f<t[i+1];++f)o[f]=f-t[i]<<5|i;return{b:t,r:o}},f=o(a,2),u=f.b,v=f.r;u[28]=258,v[258]=28;for(var c=o(t,0),l=c.b,d=(c.r,new n(32768)),s=0;s<32768;++s){var w=(43690&s)>>1|(21845&s)<<1;w=(61680&(w=(52428&w)>>2|(13107&w)<<2))>>4|(3855&w)<<4,d[s]=((65280&w)>>8|(255&w)<<8)>>1}var h=function(r,e,a){for(var t=r.length,i=0,o=new n(e);i<t;++i)r[i]&&++o[r[i]-1];var f,u=new n(e);for(i=1;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;if(a){f=new n(1<<e);var v=15-e;for(i=0;i<t;++i)if(r[i])for(var c=i<<4|r[i],l=e-r[i],s=u[r[i]-1]++<<l,w=s|(1<<l)-1;s<=w;++s)f[d[s]>>v]=c}else for(f=new n(t),i=0;i<t;++i)r[i]&&(f[i]=d[u[r[i]-1]++]>>15-r[i]);return f},y=new r(288);for(s=0;s<144;++s)y[s]=8;for(s=144;s<256;++s)y[s]=9;for(s=256;s<280;++s)y[s]=7;for(s=280;s<288;++s)y[s]=8;var b=new r(32);for(s=0;s<32;++s)b[s]=5;var g=h(y,9,1),p=h(b,5,1),m=function(r){for(var n=r[0],e=1;e<r.length;++e)r[e]>n&&(n=r[e]);return n},k=function(r,n,e){var a=n/8|0;return(r[a]|r[a+1]<<8)>>(7&n)&e},x=function(r,n){var e=n/8|0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>(7&n)},T=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],z=function(r,n,e){var a=new Error(n||T[r]);if(a.code=r,Error.captureStackTrace&&Error.captureStackTrace(a,z),!e)throw a;return a},E=function(n,e,o,f){var v=n.length,c=f?f.length:0;if(!v||e.f&&!e.l)return o||new r(0);var d=!o,s=d||2!=e.i,w=e.i;d&&(o=new r(3*v));var y,b=function(n){var e=o.length;if(n>e){var a=new r(Math.max(2*e,n));a.set(o),o=a}},T=e.f||0,E=e.p||0,M=e.b||0,S=e.l,U=e.d,A=e.m,C=e.n,q=8*v;do{if(!S){T=k(n,E,1);var D=k(n,E+1,3);if(E+=3,!D){var F=n[(y=E,(H=4+((y+7)/8|0))-4)]|n[H-3]<<8,I=H+F;if(I>v){w&&z(0);break}s&&b(M+F),o.set(n.subarray(H,I),M),e.b=M+=F,e.p=E=8*I,e.f=T;continue}if(1==D)S=g,U=p,A=9,C=5;else if(2==D){var O=k(n,E,31)+257,J=k(n,E+10,15)+4,L=O+k(n,E+5,31)+1;E+=14;for(var N=new r(L),P=new r(19),R=0;R<J;++R)P[i[R]]=k(n,E+3*R,7);E+=3*J;var j=m(P),B=(1<<j)-1,G=h(P,j,1);for(R=0;R<L;){var H,K=G[k(n,E,B)];if(E+=15&K,(H=K>>4)<16)N[R++]=H;else{var Q=0,V=0;for(16==H?(V=3+k(n,E,3),E+=2,Q=N[R-1]):17==H?(V=3+k(n,E,7),E+=3):18==H&&(V=11+k(n,E,127),E+=7);V--;)N[R++]=Q}}var W=N.subarray(0,O),X=N.subarray(O);A=m(W),C=m(X),S=h(W,A,1),U=h(X,C,1)}else z(1);if(E>q){w&&z(0);break}}s&&b(M+131072);for(var Y=(1<<A)-1,Z=(1<<C)-1,$=E;;$=E){var _=(Q=S[x(n,E)&Y])>>4;if((E+=15&Q)>q){w&&z(0);break}if(Q||z(2),_<256)o[M++]=_;else{if(256==_){$=E,S=null;break}var rr=_-254;if(_>264){var nr=a[R=_-257];rr=k(n,E,(1<<nr)-1)+u[R],E+=nr}var er=U[x(n,E)&Z],ar=er>>4;if(er||z(3),E+=15&er,X=l[ar],ar>3&&(nr=t[ar],X+=x(n,E)&(1<<nr)-1,E+=nr),E>q){w&&z(0);break}s&&b(M+131072);var tr=M+rr;if(M<X){var ir=c-X,or=Math.min(X,tr);for(ir+M<0&&z(3);M<or;++M)o[M]=f[ir+M]}for(;M<tr;++M)o[M]=o[M-X]}}e.l=S,e.p=$,e.b=M,e.f=T,S&&(T=1,e.m=A,e.d=U,e.n=C)}while(!T);return M!=o.length&&d?function(n,e,a){return(null==e||e<0)&&(e=0),(null==a||a>n.length)&&(a=n.length),new r(n.subarray(e,a))}(o,0,M):o.subarray(0,M)},M=new r(0);function S(n,e){var a,t,i=function(r){31==r[0]&&139==r[1]&&8==r[2]||z(6,"invalid gzip data");var n=r[3],e=10;4&n&&(e+=2+(r[10]|r[11]<<8));for(var a=(n>>3&1)+(n>>4&1);a>0;a-=!r[e++]);return e+(2&n)}(n);return i+8>n.length&&z(6,"invalid gzip data"),E(n.subarray(i,-8),{i:2},e&&e.out||new r((t=(a=n).length,(a[t-4]|a[t-3]<<8|a[t-2]<<16|a[t-1]<<24)>>>0)),e&&e.dictionary)}function U(r,n){return E(r.subarray((e=r,a=n&&n.dictionary,(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&z(6,"invalid zlib data"),(e[1]>>5&1)==+!a&&z(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)),-4),{i:2},n&&n.out,n&&n.dictionary);var e,a}var A="undefined"!=typeof TextDecoder&&new TextDecoder;try{A.decode(M,{stream:!0})}catch(r){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;self.addEventListener("message",(r=>{return n=void 0,e=void 0,t=function*(){const n=31==(e=r.data)[0]&&139==e[1]&&8==e[2]?S(e,a):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?function(r,n){return E(r,{i:2},n&&n.out,n&&n.dictionary)}(e,a):U(e,a);var e,a;let t="";for(let r=0;r<n.length;r+=4096)t+=String.fromCharCode(...n.slice(r,r+4096));self.postMessage(JSON.parse(decodeURIComponent(t)))},new((a=void 0)||(a=Promise))((function(r,i){function o(r){try{u(t.next(r))}catch(r){i(r)}}function f(r){try{u(t.throw(r))}catch(r){i(r)}}function u(n){var e;n.done?r(n.value):(e=n.value,e instanceof a?e:new a((function(r){r(e)}))).then(o,f)}u((t=t.apply(n,e||[])).next())}));var n,e,a,t}))})();'],{type:"text/javascript"})),Da=[];let Ua=null;const Jc=()=>(Ua||(Ua=new Worker(c0)),Ua);let Gl=!1;const Qc=s=>{Gl=s},u0=()=>Gl,l0='(()=>{"use strict";let t=1,e=0,i=!1;const s=1/0,r=Math,n=Array,a=Map,h=Number,o=Float32Array,_=Int32Array,l=Int16Array,c=OffscreenCanvas,$=isNaN,u=requestAnimationFrame,d=setTimeout,g=clearTimeout,f=new o([1,0,0,1,0,0]),m=new o([1,1,1,1,0,0,0,0]),p=r.PI/180,x=(r.PI,[]),b=[],v=[],T=[],A=[],M=[],y=[],E=[],C=[],S=new c(1,1).getContext("2d"),F=(t=0,e=0,i=0,s=0)=>{const r=C.pop()||{xMin:0,xMax:0,yMin:0,yMax:0};return r.xMin=t,r.xMax=e,r.yMin=i,r.yMax=s,r},B=t=>{C.push(t)},w=(t=0,e=0,i=0,s=0)=>{const r=v.pop()||new o(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=s,r},R=t=>{v.push(t)},I=(t=0,e=0,i=0,s=0)=>{const r=b.pop()||new _(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=s,r},P=(t=0,e=0,i=0,s=0,r=0,n=0)=>{const a=T.pop()||new o(6);return a[0]=t,a[1]=e,a[2]=i,a[3]=s,a[4]=r,a[5]=n,a},N=t=>{T.push(t)},k=(t=1,e=1,i=1,s=1,r=0,n=0,a=0,h=0)=>{const _=A.pop()||new o(8);return _[0]=t,_[1]=e,_[2]=i,_[3]=s,_[4]=r,_[5]=n,_[6]=a,_[7]=h,_},L=t=>{A.push(t)},O=(t=0,e=0,i=0,s=0,r=0,n=0,a=0,h=0,_=0)=>{const l=M.pop()||new o(9);return l[0]=t,l[1]=e,l[2]=i,l[3]=s,l[4]=r,l[5]=n,l[6]=a,l[7]=h,l[8]=_,l},U=(...t)=>{const e=y.pop()||[];return t.length&&e.push(...t),e},D=(t=null)=>{t&&(t.length&&(t.length=0),y.push(t))},X=t=>{t.size&&t.clear(),E.push(t)},V=()=>E.pop()||new a,Y=t=>(t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t),z=t=>{const e=1/(t[0]*t[4]-t[3]*t[1]),i=t[3]*t[7]-t[4]*t[6],s=t[1]*t[6]-t[0]*t[7];return O(t[4]*e,0-t[1]*e,0,0-t[3]*e,t[0]*e,0,i*e,s*e,1)},G=(t,e,i,s=null)=>{const n=+t;return $(n)&&null!==s?s:r.min(r.max(e,$(n)?0:n),i)},H=(t,e)=>P(t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]),W=(t,e)=>k(t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3],t[0]*e[4]+t[4],t[1]*e[5]+t[5],t[2]*e[6]+t[6],t[3]*e[7]+t[7]),q=(t,e)=>{const i=t.xMax*e[0]+t.yMax*e[2]+e[4],s=t.xMax*e[0]+t.yMin*e[2]+e[4],n=t.xMin*e[0]+t.yMax*e[2]+e[4],a=t.xMin*e[0]+t.yMin*e[2]+e[4],o=t.xMax*e[1]+t.yMax*e[3]+e[5],_=t.xMax*e[1]+t.yMin*e[3]+e[5],l=t.xMin*e[1]+t.yMax*e[3]+e[5],c=t.xMin*e[1]+t.yMin*e[3]+e[5],$=r.min(h.MAX_VALUE,i,s,n,a),u=r.max(0-h.MAX_VALUE,i,s,n,a),d=r.min(h.MAX_VALUE,o,_,l,c),g=r.max(0-h.MAX_VALUE,o,_,l,c);return F($,u,d,g)},j=t=>$(+t)?(t=>{if(!S)return 0;S.fillStyle=t;const e=+`0x${S.fillStyle.slice(1)}`;return S.fillStyle="rgba(0, 0, 0, 1)",e})(`${t}`):+t,K=(t,e,i)=>(t>>16)*(i?e:1)/255,Q=(t,e,i)=>(t>>8&255)*(i?e:1)/255,J=(t,e,i)=>(255&t)*(i?e:1)/255,Z=(t,e=1)=>({R:(16711680&t)>>16,G:(65280&t)>>8,B:255&t,A:255*e}),tt=(t,e,i=!1,s=!1)=>{let r="";return i&&(r="italic "),s&&(r+="bold "),`${r}${e}px \'${t}\',\'sans-serif\'`},et=t=>{t.color&&L(t.color),t.isLayer=!1,t.isUpdated=null,t.canApply=null,t.matrix=null,t.color=null,t.filters=null,t.blendMode="normal",t.sw=0,t.sh=0,x.push(t)},it=new Map([[1,"normal"],[2,"layer"],[3,"multiply"],[4,"screen"],[5,"lighten"],[6,"darken"],[7,"difference"],[8,"add"],[9,"subtract"],[10,"invert"],[11,"alpha"],[12,"erase"],[13,"overlay"],[14,"hardlight"]]),st=t=>it.has(t)&&it.get(t)||"normal",rt=new class{constructor(){this._$pool=[],this._$store=new Map,this._$timerMap=new Map,this._$context=null}set context(t){this._$context=t}reset(){for(const t of this._$store.values()){for(const e of t.values())this.destroy(e);X(t)}this._$store.clear(),this._$context&&this._$context.frameBuffer.clearCache()}destroy(t=null){if(t&&"object"==typeof t)if(t instanceof WebGLTexture)u((()=>{this._$context&&this._$context.frameBuffer.releaseTexture(t)}));else{if("canvas"in t&&t instanceof CanvasRenderingContext2D){const e=t.canvas,i=e.width,s=e.height;t.clearRect(0,0,i+1,s+1),e.width=e.height=1,this._$pool.push(e)}this._$context&&"index"in t&&this._$context.frameBuffer.textureManager.releasePosition(t)}}getCanvas(){return this._$pool.pop()||document.createElement("canvas")}remove(t,e){if(!this._$store.has(t))return;const i=this._$store.get(t);i.has(e)&&(i.delete(e),i.size||(X(i),this._$store.delete(t)))}stopTimer(t){t=`${t}`,this._$timerMap.has(t)&&(g(this._$timerMap.get(t)),this._$timerMap.delete(t))}removeCache(t){if(t=`${t}`,this._$store.has(t)){const e=this._$store.get(t);for(const t of e.values())this.destroy(t);e.clear(),X(e),this._$store.delete(t)}this._$timerMap.delete(t)}setRemoveTimer(t){if(t=`${t}`,this.stopTimer(t),this._$store.has(t)){const e=d((()=>{this.removeCache(t)}),5e3);this._$timerMap.set(t,e)}}get(t){const e=`${t[0]}`,i=`${t[1]}`;if(this._$store.has(e)){this.stopTimer(e);const t=this._$store.get(e);if(t.has(i))return t.get(i)}return null}set(t,e=null){const i=`${t[0]}`,s=`${t[1]}`;this._$store.has(i)||this._$store.set(i,V());const r=this._$store.get(i);if(null===e){if(!r.has(s))return;return this.destroy(r.get(s)),r.delete(s),void(r.size||(X(r),this._$store.delete(i)))}r.set(s,e)}has(t){const e=`${t[0]}`;return!!this._$store.has(e)&&this._$store.get(e).has(`${t[1]}`)}generateKeys(t,e=null,i=null){let s="";e&&e.length&&(s+=`${e[0]}_${e[1]}`),i&&i.length&&(s+=0===i[7]?"":`_${i[7]}`);const r=U();if(s){let t=0;const e=s.length;for(let i=0;i<e;i++)t=(t<<5)-t+s.charCodeAt(i),t|=0;r[1]=`_${t}`}else r[1]="_0";return r[0]=`${t}`,r}};class nt{constructor(){this._$updated=!0}static toString(){return"[class BitmapFilter]"}static get namespace(){return"next2d.filters.BitmapFilter"}toString(){return"[object BitmapFilter]"}get namespace(){return"next2d.filters.BitmapFilter"}_$isUpdated(){return this._$updated}_$doChanged(){this._$updated=!0,((t=!0)=>{i=t})()}}class at extends nt{constructor(t=4,e=4,i=1){super(),this._$blurX=4,this._$blurY=4,this._$quality=1,this.blurX=t,this.blurY=e,this.quality=i}static toString(){return"[class BlurFilter]"}static get namespace(){return"next2d.filters.BlurFilter"}toString(){return"[object BlurFilter]"}get namespace(){return"next2d.filters.BlurFilter"}static get STEP(){return[.5,1.05,1.4,1.55,1.75,1.9,2,2.15,2.2,2.3,2.5,3,3,3.5,3.5]}get blurX(){return this._$blurX}set blurX(t){(t=G(+t,0,255,0))!==this._$blurX&&(this._$blurX=t,this._$doChanged())}get blurY(){return this._$blurY}set blurY(t){(t=G(+t,0,255,0))!==this._$blurY&&(this._$blurY=t,this._$doChanged())}get quality(){return this._$quality}set quality(t){(t=G(0|t,0,15,1))!==this._$quality&&(this._$quality=t,this._$doChanged())}clone(){return new at(this._$blurX,this._$blurY,this._$quality)}_$toArray(){return U(1,this._$blurX,this._$blurY,this._$quality)}_$generateFilterRect(t,e=0,i=0){const s=F(t.xMin,t.xMax,t.yMin,t.yMax);if(!this._$quality)return s;const n=at.STEP[this._$quality-1];let a=0>=this._$blurX?1:this._$blurX*n,h=0>=this._$blurY?1:this._$blurY*n;return e?a*=e:a=r.round(a),i?h*=i:h=r.round(h),s.xMin-=a,s.xMax+=2*a,s.yMin-=h,s.yMax+=2*h,s}_$canApply(){return 0!==this._$blurX&&0!==this._$blurY}_$applyFilter(e,i,s=!0){this._$updated=!1;const n=e.frameBuffer,a=n.currentAttachment,h=n.getTextureFromCurrentAttachment();if(!this._$canApply())return s?h:n.createTextureFromCurrentAttachment();let o=r.sqrt(i[0]*i[0]+i[1]*i[1]),_=r.sqrt(i[2]*i[2]+i[3]*i[3]);o/=t,_/=t,o*=2,_*=2;const l=F(0,h.width,0,h.height),c=this._$generateFilterRect(l,o,_);B(l);const $=0|r.ceil(c.xMax),u=0|r.ceil(c.yMax),d=r.ceil(r.abs(c.xMin)+.5*r.abs($-c.xMax)),g=r.ceil(r.abs(c.yMin)+.5*r.abs(u-c.yMax));e._$offsetX=d+e._$offsetX,e._$offsetY=g+e._$offsetY;const f=this._$blurX*o,m=this._$blurY*_;let p=1,x=1;f>128?p=.0625:f>64?p=.125:f>32?p=.25:f>16&&(p=.5),m>128?x=.0625:m>64?x=.125:m>32?x=.25:m>16&&(x=.5);const b=f*p,v=m*x,T=r.ceil($*p),A=r.ceil(u*x),M=n.createTextureAttachment(T,A),y=[M,n.createTextureAttachment(T,A)];let E=0;e._$bind(M),e.reset(),e.setTransform(p,0,0,x,0,0),e.drawImage(h,d,g,h.width,h.height),e.blend.toOneZero();let C=n.getTextureFromCurrentAttachment();for(let t=0;t<this._$quality;++t){if(this._$blurX>0){E=(E+1)%2;const t=y[E];e._$bind(t),e._$applyBlurFilter(C,!0,b),C=n.getTextureFromCurrentAttachment()}if(this._$blurY>0){E=(E+1)%2;const t=y[E];e._$bind(t),e._$applyBlurFilter(C,!1,v),C=n.getTextureFromCurrentAttachment()}}if(e.blend.reset(),1!==p||1!==x){const t=n.createTextureAttachment($,u);e._$bind(t),e.reset(),e.imageSmoothingEnabled=!0,e.setTransform(1/p,0,0,1/x,0,0),e.drawImage(C,0,0,T,A),C=n.getTextureFromCurrentAttachment(),e.reset(),e.setTransform(1,0,0,1,0,0),n.releaseAttachment(y[0],!0),n.releaseAttachment(y[1],!0),s?n.releaseAttachment(a,!0):n.releaseAttachment(t,!1)}else n.releaseAttachment(y[(E+1)%2],!0),s?n.releaseAttachment(a,!0):n.releaseAttachment(y[E],!1);return C}}class ht extends nt{constructor(t=4,e=45,i=16777215,s=1,r=0,n=1,a=4,h=4,o=1,_=1,l="inner",c=!1){super(),this._$blurFilter=new at(a,h,_),this._$distance=4,this._$angle=45,this._$highlightColor=16777215,this._$highlightAlpha=1,this._$shadowColor=0,this._$shadowAlpha=1,this._$strength=1,this._$type="inner",this._$knockout=!1,this.distance=t,this.angle=e,this.highlightColor=i,this.highlightAlpha=s,this.shadowColor=r,this.shadowAlpha=n,this.strength=o,this.type=l,this.knockout=c}static toString(){return"[class BevelFilter]"}static get namespace(){return"next2d.filters.BevelFilter"}toString(){return"[object BevelFilter]"}get namespace(){return"next2d.filters.BevelFilter"}get angle(){return this._$angle}set angle(t){(t%=360)!==this._$angle&&(this._$angle=G(t,-360,360,45),this._$doChanged())}get blurX(){return this._$blurFilter.blurX}set blurX(t){this._$blurFilter.blurX=t}get blurY(){return this._$blurFilter.blurY}set blurY(t){this._$blurFilter.blurY=t}get distance(){return this._$distance}set distance(t){(t=G(+t,-255,255,4))!==this._$distance&&(this._$distance=t,this._$doChanged())}get highlightAlpha(){return this._$highlightAlpha}set highlightAlpha(t){(t=G(+t,0,1,0))!==this._$highlightAlpha&&(this._$highlightAlpha=t,this._$doChanged())}get highlightColor(){return this._$highlightColor}set highlightColor(t){(t=G(j(t),0,16777215,16777215))!==this._$highlightColor&&(this._$highlightColor=t,this._$doChanged())}get knockout(){return this._$knockout}set knockout(t){t!==this._$knockout&&(this._$knockout=!!t,this._$doChanged())}get quality(){return this._$blurFilter.quality}set quality(t){this._$blurFilter.quality=t}get shadowAlpha(){return this._$shadowAlpha}set shadowAlpha(t){(t=G(+t,0,1,0))!==this._$shadowAlpha&&(this._$shadowAlpha=t,this._$doChanged())}get shadowColor(){return this._$shadowColor}set shadowColor(t){(t=G(j(t),0,16777215,0))!==this._$shadowColor&&(this._$shadowColor=t,this._$doChanged())}get strength(){return this._$strength}set strength(t){(t=G(0|t,0,255,0))!==this._$strength&&(this._$strength=t,this._$doChanged())}get type(){return this._$type}set type(t){(t=`${t}`)!==this._$type&&(this._$type=t,this._$doChanged())}clone(){return new ht(this._$distance,this._$angle,this._$highlightColor,this._$highlightAlpha,this._$shadowColor,this._$shadowAlpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$toArray(){return U(0,this._$distance,this._$angle,this._$highlightColor,this._$highlightAlpha,this._$shadowColor,this._$shadowAlpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$isUpdated(){return this._$updated||this._$blurFilter._$isUpdated()}_$generateFilterRect(t,e=0,i=0){let s=F(t.xMin,t.xMax,t.yMin,t.yMax);if(!this._$canApply())return s;s=this._$blurFilter._$generateFilterRect(s,e,i);const n=this._$angle*p;let a=r.abs(r.cos(n)*this._$distance),h=r.abs(r.sin(n)*this._$distance);return e&&(a*=e),i&&(h*=i),s.xMin=r.min(s.xMin,a),a>0&&(s.xMax+=a),s.yMin=r.min(s.yMin,h),h>0&&(s.yMax+=h),s}_$canApply(){return this._$strength>0&&0!==this._$distance&&this._$blurFilter._$canApply()}_$applyFilter(e,i){this._$updated=!1;const s=e.frameBuffer,n=s.currentAttachment;if(!n)throw new Error("the current attachment is null.");e.setTransform(1,0,0,1,0,0);const a=s.getTextureFromCurrentAttachment();if(!this._$canApply())return a;const h=n.width,o=n.height,_=e._$offsetX,l=e._$offsetY;let c=r.sqrt(i[0]*i[0]+i[1]*i[1]),$=r.sqrt(i[2]*i[2]+i[3]*i[3]);c/=t,$/=t,c*=2,$*=2;const u=this._$angle*p,d=r.cos(u)*this._$distance*c,g=r.sin(u)*this._$distance*$,f=s.createTextureAttachment(h,o);e._$bind(f),e.reset(),e.drawImage(a,0,0,h,o),e.globalCompositeOperation="erase",e.drawImage(a,2*d,2*g,h,o);const m=this._$blurFilter._$applyFilter(e,i,!1),x=m.width,b=m.height,v=r.ceil(x+2*r.abs(d)),T=r.ceil(b+2*r.abs(g)),A="inner"===this._$type,M=A?h:v,y=A?o:T,E=r.abs(d),C=r.abs(g),S=(x-h)/2,F=(b-o)/2,B=A?0:E+S,w=A?0:C+F,R=A?-S-d:E-d,I=A?-F-g:C-g;return e._$bind(n),s.releaseAttachment(f,!0),e._$applyBitmapFilter(m,M,y,h,o,B,w,x,b,R,I,!1,this._$type,this._$knockout,this._$strength,null,null,null,K(this._$highlightColor,this._$highlightAlpha,!0),Q(this._$highlightColor,this._$highlightAlpha,!0),J(this._$highlightColor,this._$highlightAlpha,!0),this._$highlightAlpha,K(this._$shadowColor,this._$shadowAlpha,!0),Q(this._$shadowColor,this._$shadowAlpha,!0),J(this._$shadowColor,this._$shadowAlpha,!0),this._$shadowAlpha),e._$offsetX=_+B,e._$offsetY=l+w,s.releaseTexture(m),s.getTextureFromCurrentAttachment()}}class ot extends nt{constructor(t=null){super(),this._$matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix=t}static toString(){return"[class ColorMatrixFilter]"}static get namespace(){return"next2d.filters.ColorMatrixFilter"}toString(){return"[object ColorMatrixFilter]"}get namespace(){return"next2d.filters.ColorMatrixFilter"}get matrix(){return this._$matrix}set matrix(t){if(t&&n.isArray(t)&&20===t.length){for(let e=0;e<20;++e)if(t[e]!==this._$matrix[e]){this._$doChanged();break}this._$matrix=t}}clone(){return new ot(this._$matrix)}_$toArray(){return U(2,this._$matrix)}_$generateFilterRect(t){return t}_$canApply(){return!0}_$applyFilter(t){this._$updated=!1;const e=t.frameBuffer,i=e.currentAttachment;t.setTransform(1,0,0,1,0,0);const s=e.getTextureFromCurrentAttachment(),r=s.width,n=s.height,a=e.createTextureAttachment(r,n);return t._$bind(a),t.reset(),t._$applyColorMatrixFilter(s,this._$matrix),e.releaseAttachment(i,!0),e.getTextureFromCurrentAttachment()}}class _t extends nt{constructor(t=0,e=0,i=null,s=1,r=0,n=!0,a=!0,h=0,o=0){super(),this._$matrixX=0,this._$matrixY=0,this._$matrix=null,this._$divisor=1,this._$bias=0,this._$preserveAlpha=!0,this._$clamp=!0,this._$color=0,this._$alpha=0,this.matrixX=t,this.matrixY=e,this.matrix=i,this.divisor=s,this.bias=r,this.preserveAlpha=n,this.clamp=a,this.color=h,this.alpha=o}static toString(){return"[class ConvolutionFilter]"}static get namespace(){return"next2d.filters.ConvolutionFilter"}toString(){return"[object ConvolutionFilter]"}get namespace(){return"next2d.filters.ConvolutionFilter"}get alpha(){return this._$alpha}set alpha(t){(t=G(+t,0,1,0))!==this._$alpha&&(this._$alpha=t,this._$doChanged())}get bias(){return this._$bias}set bias(t){t!==this._$bias&&(this._$bias=0|t,this._$doChanged())}get clamp(){return this._$clamp}set clamp(t){t!==this._$clamp&&(this._$clamp=!!t,this._$doChanged())}get color(){return this._$color}set color(t){(t=G(j(t),0,16777215,0))!==this._$color&&(this._$color=t,this._$doChanged())}get divisor(){return this._$divisor}set divisor(t){t!==this._$divisor&&(this._$divisor=0|t,this._$doChanged())}get matrix(){return this._$matrix}set matrix(t){n.isArray(this._$matrix)&&D(this._$matrix),this._$matrix=n.isArray(t)?t:null,this._$doChanged()}get matrixX(){return this._$matrixX}set matrixX(t){(t=0|G(0|t,0,15,0))!==this._$matrixX&&(this._$matrixX=t,this._$doChanged())}get matrixY(){return this._$matrixY}set matrixY(t){(t=0|G(0|t,0,15,0))!==this._$matrixY&&(this._$matrixY=t,this._$doChanged())}get preserveAlpha(){return this._$preserveAlpha}set preserveAlpha(t){t!==this._$preserveAlpha&&(this._$preserveAlpha=!!t,this._$doChanged())}clone(){return new _t(this._$matrixX,this._$matrixY,this._$matrix?this._$matrix.slice():null,this._$divisor,this._$bias,this._$preserveAlpha,this._$clamp,this._$color,this._$alpha)}_$toArray(){return U(3,this._$matrixX,this._$matrixY,this._$matrix,this._$divisor,this._$bias,this._$preserveAlpha,this._$clamp,this._$color,this._$alpha)}_$generateFilterRect(t){return t}_$canApply(){return null!==this._$matrix&&this._$matrixX*this._$matrixY===this._$matrix.length}_$applyFilter(t){this._$updated=!1;const e=t.frameBuffer,i=e.currentAttachment;t.setTransform(1,0,0,1,0,0);const s=e.getTextureFromCurrentAttachment();return this._$canApply()&&this._$matrix?(t._$applyConvolutionFilter(s,this._$matrixX,this._$matrixY,this._$matrix,this._$divisor,this._$bias,this._$preserveAlpha,this._$clamp,K(this._$color,this._$alpha,!1),Q(this._$color,this._$alpha,!1),J(this._$color,this._$alpha,!1),this._$alpha),e.releaseAttachment(i,!0),e.getTextureFromCurrentAttachment()):s}}class lt extends nt{constructor(t=null,e=null,i=0,s=0,r=0,n=0,a="wrap",h=0,o=0){super(),this._$mapBitmap=null,this._$mapPoint=null,this._$componentX=0,this._$componentY=0,this._$scaleX=0,this._$scaleY=0,this._$mode="wrap",this._$color=0,this._$alpha=0,this.mapBitmap=t,this.mapPoint=e,this.componentX=i,this.componentY=s,this.scaleX=r,this.scaleY=n,this.mode=a,this.color=h,this.alpha=o}static toString(){return"[class DisplacementMapFilter]"}static get namespace(){return"next2d.filters.DisplacementMapFilter"}toString(){return"[object DisplacementMapFilter]"}get namespace(){return"next2d.filters.DisplacementMapFilter"}get alpha(){return this._$alpha}set alpha(t){(t=G(+t,0,1,0))!==this._$alpha&&(this._$alpha=t,this._$doChanged())}get color(){return this._$color}set color(t){(t=G(j(t),0,16777215,0))!==this._$color&&(this._$color=t,this._$doChanged())}get componentX(){return this._$componentX}set componentX(t){t!==this._$componentX&&(this._$componentX=t,this._$doChanged())}get componentY(){return this._$componentY}set componentY(t){t!==this._$componentY&&(this._$componentY=t,this._$doChanged())}get mapBitmap(){return this._$mapBitmap}set mapBitmap(t){t!==this._$mapBitmap&&(this._$mapBitmap=t,this._$doChanged())}get mapPoint(){return this._$mapPoint}set mapPoint(t){t!==this._$mapPoint&&(this._$mapPoint=t,this._$doChanged())}get mode(){return this._$mode}set mode(t){t!==this._$mode&&(this._$mode=t,this._$doChanged())}get scaleX(){return this._$scaleX}set scaleX(t){(t=G(+t,-65535,65535,0))!==this._$scaleX&&(this._$scaleX=t,this._$doChanged())}get scaleY(){return this._$scaleY}set scaleY(t){(t=G(+t,-65535,65535,0))!==this._$scaleY&&(this._$scaleY=t,this._$doChanged())}clone(){return new lt(this._$mapBitmap,this._$mapPoint,this._$componentX,this._$componentY,this._$scaleX,this._$scaleY,this._$mode,this._$color,this._$alpha)}_$toArray(){return U(4,this._$mapBitmap,this._$mapPoint,this._$componentX,this._$componentY,this._$scaleX,this._$scaleY,this._$mode,this._$color,this._$alpha)}_$generateFilterRect(t){return t}_$canApply(){return null!==this._$mapBitmap&&this._$componentX>0&&this._$componentY>0&&0!==this._$scaleX&&0!==this._$scaleY}_$applyFilter(t,e){this._$updated=!1;const i=t.frameBuffer,s=i.currentAttachment;t.setTransform(1,0,0,1,0,0);const n=i.getTextureFromCurrentAttachment();if(!this._$canApply()||!s||!this._$mapBitmap)return n;const a=r.sqrt(e[0]*e[0]+e[1]*e[1]),h=r.sqrt(e[2]*e[2]+e[3]*e[3]);return t._$applyDisplacementMapFilter(n,this._$mapBitmap,n.width/a,n.height/h,this._$mapPoint,this._$componentX,this._$componentY,this._$scaleX,this._$scaleY,this._$mode,K(this._$color,this._$alpha,!0),Q(this._$color,this._$alpha,!0),J(this._$color,this._$alpha,!0),this._$alpha),i.releaseAttachment(s,!0),i.getTextureFromCurrentAttachment()}}class ct extends nt{constructor(t=4,e=45,i=0,s=1,r=4,n=4,a=1,h=1,o=!1,_=!1,l=!1){super(),this._$blurFilter=new at(r,n,h),this._$distance=4,this._$angle=45,this._$color=0,this._$alpha=1,this._$strength=1,this._$inner=!1,this._$knockout=!1,this._$hideObject=!1,this.distance=t,this.angle=e,this.color=i,this.alpha=s,this.strength=a,this.inner=o,this.knockout=_,this.hideObject=l}static toString(){return"[class DropShadowFilter]"}static get namespace(){return"next2d.filters.DropShadowFilter"}toString(){return"[object DropShadowFilter]"}get namespace(){return"next2d.filters.DropShadowFilter"}get alpha(){return this._$alpha}set alpha(t){(t=G(+t,0,1,0))!==this._$alpha&&(this._$alpha=t,this._$doChanged())}get angle(){return this._$angle}set angle(t){(t%=360)!==this._$angle&&(this._$angle=G(t,-360,360,45),this._$doChanged())}get blurX(){return this._$blurFilter.blurX}set blurX(t){this._$blurFilter.blurX=t}get blurY(){return this._$blurFilter.blurY}set blurY(t){this._$blurFilter.blurY=t}get color(){return this._$color}set color(t){(t=G(j(t),0,16777215,0))!==this._$color&&(this._$color=t,this._$doChanged())}get distance(){return this._$distance}set distance(t){(t=G(+t,-255,255,4))!==this._$distance&&(this._$distance=t,this._$doChanged())}get hideObject(){return this._$hideObject}set hideObject(t){t!==this._$hideObject&&(this._$hideObject=!!t,this._$doChanged())}get inner(){return this._$inner}set inner(t){t!==this._$inner&&(this._$inner=!!t,this._$doChanged())}get knockout(){return this._$knockout}set knockout(t){t!==this._$knockout&&(this._$knockout=!!t,this._$doChanged())}get quality(){return this._$blurFilter.quality}set quality(t){this._$blurFilter.quality=t}get strength(){return this._$strength}set strength(t){(t=G(0|t,0,255,0))!==this._$strength&&(this._$strength=t,this._$doChanged())}clone(){return new ct(this._$distance,this._$angle,this._$color,this._$alpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$inner,this._$knockout,this._$hideObject)}_$toArray(){return U(5,this._$distance,this._$angle,this._$color,this._$alpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$inner,this._$knockout,this._$hideObject)}_$isUpdated(){return this._$updated||this._$blurFilter._$isUpdated()}_$generateFilterRect(t,e=0,i=0){let s=F(t.xMin,t.xMax,t.yMin,t.yMax);if(!this._$canApply())return s;s=this._$blurFilter._$generateFilterRect(s,e,i);const n=this._$angle*p;let a=r.cos(n)*this._$distance,h=r.sin(n)*this._$distance;return e&&(a*=e),i&&(h*=i),s.xMin=r.min(s.xMin,a),a>0&&(s.xMax+=a),s.yMin=r.min(s.yMin,h),h>0&&(s.yMax+=h),s}_$canApply(){return this._$alpha>0&&this._$strength>0&&this._$blurFilter._$canApply()}_$applyFilter(e,i){const s=e.frameBuffer,n=s.currentAttachment;if(!n)throw new Error("the current attachment is null.");if(e.setTransform(1,0,0,1,0,0),!this._$canApply())return s.getTextureFromCurrentAttachment();const a=n.width,h=n.height,o=e._$offsetX,_=e._$offsetY,l=this._$blurFilter._$applyFilter(e,i,!1),c=l.width,$=l.height,u=e._$offsetX,d=e._$offsetY,g=u-o,f=d-_;let m=r.sqrt(i[0]*i[0]+i[1]*i[1]),x=r.sqrt(i[2]*i[2]+i[3]*i[3]);m/=t,x/=t,m*=2,x*=2;const b=this._$angle*p,v=r.cos(b)*this._$distance*m,T=r.sin(b)*this._$distance*x,A=this._$inner?a:c+r.max(0,r.abs(v)-g),M=this._$inner?h:$+r.max(0,r.abs(T)-f),y=r.ceil(A),E=r.ceil(M),C=(y-A)/2,S=(E-M)/2,F=this._$inner?0:r.max(0,g-v)+C,B=this._$inner?0:r.max(0,f-T)+S,w=this._$inner?v-u:(v>0?r.max(0,v-g):0)+C,R=this._$inner?T-d:(T>0?r.max(0,T-f):0)+S;let I,P;return this._$inner?(I="inner",P=this._$knockout||this._$hideObject):!this._$knockout&&this._$hideObject?(I="full",P=!0):(I="outer",P=this._$knockout),e._$bind(n),e._$applyBitmapFilter(l,y,E,a,h,F,B,c,$,w,R,!0,I,P,this._$strength,null,null,null,K(this._$color,this._$alpha,!0),Q(this._$color,this._$alpha,!0),J(this._$color,this._$alpha,!0),this._$alpha,0,0,0,0),e._$offsetX=o+F,e._$offsetY=_+B,s.releaseTexture(l),s.getTextureFromCurrentAttachment()}}class $t extends nt{constructor(t=0,e=1,i=4,s=4,r=1,n=1,a=!1,h=!1){super(),this._$blurFilter=new at(i,s,n),this._$color=0,this._$alpha=1,this._$strength=1,this._$inner=!1,this._$knockout=!1,this.color=t,this.alpha=e,this.strength=r,this.inner=a,this.knockout=h}static toString(){return"[class GlowFilter]"}static get namespace(){return"next2d.filters.GlowFilter"}toString(){return"[object GlowFilter]"}get namespace(){return"next2d.filters.GlowFilter"}get alpha(){return this._$alpha}set alpha(t){(t=G(+t,0,1,0))!==this._$alpha&&(this._$alpha=t,this._$doChanged())}get blurX(){return this._$blurFilter.blurX}set blurX(t){this._$blurFilter.blurX=t}get blurY(){return this._$blurFilter.blurY}set blurY(t){this._$blurFilter.blurY=t}get color(){return this._$color}set color(t){(t=G(j(t),0,16777215,4))!==this._$color&&(this._$color=t,this._$doChanged())}get inner(){return this._$inner}set inner(t){t!==this._$inner&&(this._$inner=!!t,this._$doChanged())}get knockout(){return this._$knockout}set knockout(t){t!==this._$knockout&&(this._$knockout=!!t,this._$doChanged())}get quality(){return this._$blurFilter.quality}set quality(t){this._$blurFilter.quality=t}get strength(){return this._$strength}set strength(t){(t=G(0|t,0,255,0))!==this._$strength&&(this._$strength=t,this._$doChanged())}clone(){return new $t(this._$color,this._$alpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$inner,this._$knockout)}_$toArray(){return U(6,this._$color,this._$alpha,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$inner,this._$knockout)}_$isUpdated(){return this._$updated||this._$blurFilter._$isUpdated()}_$generateFilterRect(t,e=0,i=0){const s=F(t.xMin,t.xMax,t.yMin,t.yMax);return this._$canApply()?this._$blurFilter._$generateFilterRect(s,e,i):s}_$canApply(){return this._$alpha>0&&this._$strength>0&&this._$blurFilter._$canApply()}_$applyFilter(t,e){const i=t.frameBuffer,s=i.currentAttachment;if(!s)throw new Error("the current attachment is null.");if(this._$updated=!1,t.setTransform(1,0,0,1,0,0),!this._$canApply())return i.getTextureFromCurrentAttachment();const r=s.width,n=s.height,a=t._$offsetX,h=t._$offsetY,o=this._$blurFilter._$applyFilter(t,e,!1),_=o.width,l=o.height,c=t._$offsetX,$=t._$offsetY,u=this._$inner?r:_,d=this._$inner?n:l,g=this._$inner?0:c-a,f=this._$inner?0:$-h,m=this._$inner?-c:0,p=this._$inner?-$:0,x=this._$inner?"inner":"outer";return t._$bind(s),t._$applyBitmapFilter(o,u,d,r,n,g,f,_,l,m,p,!0,x,this._$knockout,this._$strength,null,null,null,K(this._$color,this._$alpha,!0),Q(this._$color,this._$alpha,!0),J(this._$color,this._$alpha,!0),this._$alpha,0,0,0,0),t._$offsetX=a+g,t._$offsetY=h+f,i.releaseTexture(o),i.getTextureFromCurrentAttachment()}}class ut extends nt{constructor(t=4,e=45,i=null,s=null,r=null,n=4,a=4,h=1,o=1,_="inner",l=!1){super(),this._$blurFilter=new at(n,a,o),this._$distance=4,this._$angle=45,this._$colors=null,this._$alphas=null,this._$ratios=null,this._$strength=1,this._$type="inner",this._$knockout=!1,this.distance=t,this.angle=e,this.colors=i,this.alphas=s,this.ratios=r,this.strength=h,this.type=_,this.knockout=l}static toString(){return"[class GradientBevelFilter]"}static get namespace(){return"next2d.filters.GradientBevelFilter"}toString(){return"[object GradientBevelFilter]"}get namespace(){return"next2d.filters.GradientBevelFilter"}get alphas(){return this._$alphas}set alphas(t){if(t!==this._$alphas){if(this._$alphas=t,n.isArray(t)){for(let e=0;e<t.length;++e){const i=t[e];t[e]=G(+i,0,1,0)}this._$alphas=t}this._$doChanged()}}get angle(){return this._$angle}set angle(t){(t=G(t%360,-360,360,45))!==this._$angle&&(this._$angle=t,this._$doChanged())}get blurX(){return this._$blurFilter.blurX}set blurX(t){this._$blurFilter.blurX=t}get blurY(){return this._$blurFilter.blurY}set blurY(t){this._$blurFilter.blurY=t}get colors(){return this._$colors}set colors(t){if(this._$colors!==t){if(this._$colors=t,n.isArray(t)){for(let e=0;e<t.length;++e)t[e]=G(j(t[e]),0,16777215,0);this._$colors=t}this._$doChanged()}}get distance(){return this._$distance}set distance(t){(t=G(+t,-255,255,4))!==this._$distance&&(this._$distance=t,this._$doChanged())}get knockout(){return this._$knockout}set knockout(t){t!==this._$knockout&&(this._$knockout=!!t,this._$doChanged())}get quality(){return this._$blurFilter.quality}set quality(t){this._$blurFilter.quality=t}get ratios(){return this._$ratios}set ratios(t){if(this._$ratios!==t){if(this._$ratios=t,n.isArray(t)){for(let e=0;e<t.length;++e)t[e]=G(+t[e],0,255,0);this._$ratios=t}this._$doChanged()}}get strength(){return this._$strength}set strength(t){(t=G(0|t,0,255,0))!==this._$strength&&(this._$strength=t,this._$doChanged())}get type(){return this._$type}set type(t){t!==this._$type&&(this._$type=t,this._$doChanged())}clone(){return new ut(this._$distance,this._$angle,this._$colors?this._$colors.slice():null,this._$alphas?this._$alphas.slice():null,this._$ratios?this._$ratios.slice():null,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$toArray(){return U(7,this._$distance,this._$angle,this._$colors,this._$alphas,this._$ratios,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$isUpdated(){return this._$updated||this._$blurFilter._$isUpdated()}_$generateFilterRect(t,e=0,i=0){let s=F(t.xMin,t.xMax,t.yMin,t.yMax);if(!this._$canApply())return s;s=this._$blurFilter._$generateFilterRect(s,e,i);const n=this._$angle*p;let a=r.abs(r.cos(n)*this._$distance),h=r.abs(r.sin(n)*this._$distance);return e&&(a*=e),i&&(h*=i),s.xMin=r.min(s.xMin,a),a>0&&(s.xMax+=a),s.yMin=r.min(s.yMin,h),h>0&&(s.yMax+=h),s}_$canApply(){return this._$strength>0&&this._$distance>0&&null!==this._$alphas&&null!==this._$ratios&&null!==this._$colors&&this._$blurFilter._$canApply()}_$applyFilter(e,i){this._$updated=!1;const s=e.frameBuffer,n=s.currentAttachment;e.setTransform(1,0,0,1,0,0);const a=s.getTextureFromCurrentAttachment();if(!this._$canApply()||!n)return a;const h=n.width,o=n.height,_=e._$offsetX,l=e._$offsetY;let c=r.sqrt(i[0]*i[0]+i[1]*i[1]),$=r.sqrt(i[2]*i[2]+i[3]*i[3]);c/=t,$/=t,c*=2,$*=2;const u=+this._$angle*p,d=+r.cos(u)*this._$distance*c,g=+r.sin(u)*this._$distance*$,f=s.createTextureAttachment(h,o);e._$bind(f),e.reset(),e.drawImage(a,0,0,h,o),e.globalCompositeOperation="erase",e.drawImage(a,2*d,2*g,h,o);const m=this._$blurFilter._$applyFilter(e,i,!1),x=m.width,b=m.height,v=r.ceil(x+2*r.abs(d)),T=r.ceil(b+2*r.abs(g)),A="inner"===this._$type,M=A?h:v,y=A?o:T,E=r.abs(d),C=r.abs(g),S=(x-h)/2,F=(b-o)/2,B=A?0:E+S,w=A?0:C+F,R=A?-S-d:E-d,I=A?-F-g:C-g;return e._$bind(n),e._$applyBitmapFilter(m,M,y,h,o,B,w,x,b,R,I,!1,this._$type,this._$knockout,this._$strength,this._$ratios,this._$colors,this._$alphas,0,0,0,0,0,0,0,0),e._$offsetX=_+B,e._$offsetY=l+w,s.releaseAttachment(f,!0),s.getTextureFromCurrentAttachment()}}class dt extends nt{constructor(t=4,e=45,i=null,s=null,r=null,n=4,a=4,h=1,o=1,_="inner",l=!1){super(),this._$blurFilter=new at(n,a,o),this._$distance=4,this._$angle=45,this._$colors=null,this._$alphas=null,this._$ratios=null,this._$strength=1,this._$type="inner",this._$knockout=!1,this.distance=t,this.angle=e,this.colors=i,this.alphas=s,this.ratios=r,this.strength=h,this.type=_,this.knockout=l}static toString(){return"[class GradientGlowFilter]"}static get namespace(){return"next2d.filters.GradientGlowFilter"}toString(){return"[object GradientGlowFilter]"}get namespace(){return"next2d.filters.GradientGlowFilter"}get alphas(){return this._$alphas}set alphas(t){if(t!==this._$alphas){if(this._$alphas=t,n.isArray(t)){for(let e=0;e<t.length;++e)t[e]=G(+t[e],0,1,0);this._$alphas=t}this._$doChanged()}}get angle(){return this._$angle}set angle(t){(t=G(t%360,-360,360,45))!==this._$angle&&(this._$angle=t,this._$doChanged())}get blurX(){return this._$blurFilter.blurX}set blurX(t){this._$blurFilter.blurX=t}get blurY(){return this._$blurFilter.blurY}set blurY(t){this._$blurFilter.blurY=t}get colors(){return this._$colors}set colors(t){if(this._$colors!==t){if(this._$colors=t,n.isArray(t)){for(let e=0;e<t.length;++e)t[e]=G(j(t[e]),0,16777215,0);this._$colors=t}this._$doChanged()}}get distance(){return this._$distance}set distance(t){(t=G(+t,-255,255,4))!==this._$distance&&(this._$distance=t,this._$doChanged())}get knockout(){return this._$knockout}set knockout(t){t!==this._$knockout&&(this._$knockout=!!t,this._$doChanged())}get quality(){return this._$blurFilter.quality}set quality(t){this._$blurFilter.quality=t}get ratios(){return this._$ratios}set ratios(t){if(this._$ratios!==t){if(this._$ratios=t,n.isArray(t)){for(let e=0;e<t.length;++e)t[e]=G(+t[e],0,255,0);this._$ratios=t}this._$doChanged()}}get strength(){return this._$strength}set strength(t){(t=G(0|t,0,255,0))!==this._$strength&&(this._$strength=t,this._$doChanged())}get type(){return this._$type}set type(t){t!==this._$type&&(this._$type=t,this._$doChanged())}clone(){return new dt(this._$distance,this._$angle,this._$colors,this._$alphas,this._$ratios,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$toArray(){return U(8,this._$distance,this._$angle,this._$colors,this._$alphas,this._$ratios,this._$blurFilter.blurX,this._$blurFilter.blurY,this._$strength,this._$blurFilter.quality,this._$type,this._$knockout)}_$isUpdated(){return this._$updated||this._$blurFilter._$isUpdated()}_$generateFilterRect(t,e=0,i=0){let s=F(t.xMin,t.xMax,t.yMin,t.yMax);if(!this._$canApply())return s;s=this._$blurFilter._$generateFilterRect(s,e,i);const n=this._$angle*p;let a=r.abs(r.cos(n)*this._$distance),h=r.abs(r.sin(n)*this._$distance);return e&&(a*=e),i&&(h*=i),s.xMin=r.min(s.xMin,a),a>0&&(s.xMax+=a),s.yMin=r.min(s.yMin,h),h>0&&(s.yMax+=h),s}_$canApply(){return this._$strength>0&&this._$distance>0&&null!==this._$alphas&&null!==this._$ratios&&null!==this._$colors&&this._$blurFilter._$canApply()}_$applyFilter(e,i){this._$updated=!1;const s=e.frameBuffer,n=s.currentAttachment;if(e.setTransform(1,0,0,1,0,0),!this._$canApply()||!n)return s.getTextureFromCurrentAttachment();const a=n.width,h=n.height,o=e._$offsetX,_=e._$offsetY,l=this._$blurFilter._$applyFilter(e,i,!1),c=l.width,$=l.height,u=e._$offsetX,d=e._$offsetY,g=u-o,f=d-_;let m=r.sqrt(i[0]*i[0]+i[1]*i[1]),x=r.sqrt(i[2]*i[2]+i[3]*i[3]);m/=t,x/=t,m*=2,x*=2;const b=+this._$angle*p,v=+r.cos(b)*this._$distance*m,T=+r.sin(b)*this._$distance*x,A="inner"===this.type,M=A?a:c+r.max(0,r.abs(v)-g),y=A?h:$+r.max(0,r.abs(T)-f),E=r.ceil(M),C=r.ceil(y),S=(E-M)/2,F=(C-y)/2,B=A?0:r.max(0,g-v)+S,w=A?0:r.max(0,f-T)+F,R=A?v-u:(v>0?r.max(0,v-g):0)+S,I=A?T-d:(T>0?r.max(0,T-f):0)+F;return e._$bind(n),e._$applyBitmapFilter(l,E,C,a,h,B,w,c,$,R,I,!0,this._$type,this._$knockout,this._$strength,this._$ratios,this._$colors,this._$alphas,0,0,0,0,0,0,0,0),e._$offsetX=o+B,e._$offsetY=_+w,s.releaseTexture(l),s.getTextureFromCurrentAttachment()}}class gt{constructor(){this._$instanceId=-1,this._$parentId=-1,this._$loaderInfoId=-1,this._$characterId=-1,this._$clipDepth=0,this._$depth=0,this._$isMask=!1,this._$updated=!0,this._$matrix=P(1,0,0,1,0,0),this._$colorTransform=k(1,1,1,1,0,0,0,0),this._$blendMode="normal",this._$filters=null,this._$visible=!0,this._$maskId=-1,this._$maskMatrix=null,this._$isMask=!1,this._$xMin=0,this._$yMin=0,this._$xMax=0,this._$yMax=0,this._$scale9Grid=null,this._$matrixBase=null}_$shouldClip(t){const e=this._$getBounds(t),i=r.abs(e.xMax-e.xMin),s=r.abs(e.yMax-e.yMin);return B(e),!(!i||!s)}_$getLayerBounds(e){const i=this._$getBounds(),s=q(i,e);B(i);const n=this._$filters;if(!n||!n.length)return s;let a=F(0,r.abs(s.xMax-s.xMin),0,r.abs(s.yMax-s.yMin));B(s);let h=+r.sqrt(e[0]*e[0]+e[1]*e[1]),o=+r.sqrt(e[2]*e[2]+e[3]*e[3]);h/=t,o/=t,h*=2,o*=2;for(let t=0;t<n.length;++t)a=n[t]._$generateFilterRect(a,h,o);return a}_$getBounds(t=null){const e=F(this._$xMin,this._$xMax,this._$yMin,this._$yMax);if(!t)return e;let i=t;const s=this._$matrix;1===s[0]&&0===s[1]&&0===s[2]&&1===s[3]&&0===s[4]&&0===s[5]||(i=H(t,s));const r=q(e,i);return B(e),i!==t&&N(i),r}_$startClip(t,e){t.drawInstacedArray();const i=this._$getBounds(e),s=t._$startClip(i);if(B(i),!s)return!1;t._$enterClip(),t._$beginClipDef();let r=!1;return"_$children"in this&&(r=!0,t._$updateContainerClipFlag(!0)),this._$clip(t,e),this._$updated=!1,r&&(t._$updateContainerClipFlag(!1),t._$drawContainerClip()),t._$endClipDef(),!0}_$doChanged(){if(this._$updated=!0,this._$parentId>-1){const t=le.instances;if(!t.has(this._$parentId))return;const e=t.get(this._$parentId);e._$updated||e._$doChanged()}}_$update(t){if(this._$doChanged(),this._$visible=t.visible,"depth"in t&&(this._$depth=t.depth),"isMask"in t&&(this._$isMask=t.isMask),"clipDepth"in t&&(this._$clipDepth=t.clipDepth),"maskId"in t&&(this._$maskId=t.maskId,this._$maskId>-1&&t.maskMatrix&&(this._$maskMatrix=t.maskMatrix)),this._$matrix[0]="a"in t?t.a:1,this._$matrix[1]="b"in t?t.b:0,this._$matrix[2]="c"in t?t.c:0,this._$matrix[3]="d"in t?t.d:1,this._$matrix[4]="tx"in t?t.tx:0,this._$matrix[5]="ty"in t?t.ty:0,this._$colorTransform[0]="f0"in t?t.f0:1,this._$colorTransform[1]="f1"in t?t.f1:1,this._$colorTransform[2]="f2"in t?t.f2:1,this._$colorTransform[3]="f3"in t?t.f3:1,this._$colorTransform[4]="f4"in t?t.f4:0,this._$colorTransform[5]="f5"in t?t.f5:0,this._$colorTransform[6]="f6"in t?t.f6:0,this._$colorTransform[7]="f7"in t?t.f7:0,this._$blendMode=t.blendMode||"normal",this._$filters=null,t.filters&&t.filters.length){this._$filters=U();for(let e=0;e<t.filters.length;++e){const i=t.filters[e];switch(i.shift()){case 0:this._$filters.push(new ht(...i));break;case 1:this._$filters.push(new at(...i));break;case 2:this._$filters.push(new ot(...i));break;case 3:this._$filters.push(new _t(...i));break;case 4:this._$filters.push(new lt(...i));break;case 5:this._$filters.push(new ct(...i));break;case 6:this._$filters.push(new $t(...i));break;case 7:this._$filters.push(new ut(...i));break;case 8:this._$filters.push(new dt(...i))}}}t.grid&&(this._$scale9Grid=t.grid,t.matrixBase&&(this._$matrixBase=t.matrixBase))}_$canApply(t=null){if(t)for(let e=0;e<t.length;++e)if(t[e]._$canApply())return!0;return!1}_$remove(){this._$doChanged();const t=le;rt.setRemoveTimer(this._$instanceId),this._$loaderInfoId>-1&&this._$characterId&&rt.setRemoveTimer(`${this._$loaderInfoId}@${this._$characterId}`),t.instances.delete(this._$instanceId),this._$instanceId=-1,this._$parentId=-1,this._$loaderInfoId=-1,this._$characterId=-1,this._$blendMode="normal",this._$filters=null,this._$visible=!0,this._$maskId=-1,this._$isMask=!1,this._$depth=0,this._$clipDepth=0,this._$scale9Grid=null}_$isUpdated(){return this._$updated}_$isFilterUpdated(t,e=null,i=!1){if(this._$isUpdated())return!0;if(i&&e)for(let t=0;t<e.length;++t)if(e[t]._$isUpdated())return!0;const s=rt.get([this._$instanceId,"f"]);return!s||s.filterState!==i||s.matrix!==`${t[0]}_${t[1]}_${t[2]}_${t[3]}`}_$applyFilter(t,e,i,s,n,a){const h=+r.sqrt(s[0]*s[0]+s[1]*s[1]),o=+r.sqrt(s[2]*s[2]+s[3]*s[3]),_=r.atan2(s[1],s[0]),l=r.atan2(0-s[2],s[3]),c=P(r.cos(_),r.sin(_),0-r.sin(l),r.cos(l),n/2,a/2),$=P(1,0,0,1,0-i.width/2,0-i.height/2),u=H(c,$);N(c),N($);const d=t.frameBuffer,g=d.currentAttachment,f=d.createCacheAttachment(n,a);t._$bind(f),t.reset(),t.setTransform(u[0],u[1],u[2],u[3],u[4],u[5]),N(u),t.drawImage(i,0,0,i.width,i.height),t._$offsetX=0,t._$offsetY=0;const m=P(h,0,0,o,0,0);let p=null;for(let i=0;i<e.length;++i)p=e[i]._$applyFilter(t,m);if(N(m),!p)return i;const x=t._$offsetX,b=t._$offsetY;return t._$offsetX=0,t._$offsetY=0,p.offsetX=x,p.offsetY=b,p.matrix=s[0]+"_"+s[1]+"_"+s[2]+"_"+s[3],p.filterState=!0,t._$bind(g),d.releaseAttachment(f,!1),p}_$drawFilter(t,e,i,s,n,a=null){const h=U(this._$instanceId,"f");let o=rt.get(h);const _=this._$isFilterUpdated(e,i,!0);if(o&&!_)return t.cachePosition=o,o;o&&rt.set(h,null);const l=t.frameBuffer,c=a||t.getTextureFromRect(t.cachePosition),$=this._$applyFilter(t,i,c,e,s,n);l.textureManager.release(c);const u=this._$getLayerBounds(e);return o=l.createCachePosition(r.ceil(r.abs(u.xMax-u.xMin)),r.ceil(r.abs(u.yMax-u.yMin))),B(u),o.filterState=!0,o.matrix=`${e[0]}_${e[1]}_${e[2]}_${e[3]}_0_0`,o.offsetX=$.offsetX,o.offsetY=$.offsetY,t.drawTextureFromRect($,o),rt.set(h,o),D(h),o}}class ft extends gt{constructor(){super(),this._$children=new Int32Array}_$clip(t,e){let i=e;const s=this._$matrix;1===s[0]&&0===s[1]&&0===s[2]&&1===s[3]&&0===s[4]&&0===s[5]||(i=H(e,s));const r=le.instances,n=this._$children;for(let e=0;e<this._$children.length;++e){const s=n[e];if(!r.has(s))continue;const a=r.get(s);a&&!a._$isMask&&(a._$clip(t,i),a._$updated=!1)}i!==e&&N(i)}_$draw(t,e,i){if(!this._$visible)return;let s=i;const r=this._$colorTransform;if(1===r[0]&&1===r[1]&&1===r[2]&&1===r[3]&&0===r[4]&&0===r[5]&&0===r[6]&&0===r[7]||(s=W(i,r)),!G(s[3]+s[7]/255,0,1,0))return;const n=this._$children,a=n.length;if(!a)return;const h=this._$preDraw(t,e);if(!h)return;if(h.isLayer&&!h.isUpdated)return void this._$postDraw(t,e,s,h);const o=h.matrix,_=h.isLayer&&h.color?h.color:s;let l=!0,c=0;const $=le.instances,u=t.isLayer;for(let e=0;e<a;++e){const i=n[e];if(!$.has(i))continue;const s=$.get(i);if(s._$isMask)continue;const r=s._$blendMode;if(("alpha"===r||"erase"===r)&&!u)continue;if(c&&(s._$depth>c||s._$clipDepth>0)&&(t.restore(),l&&t._$leaveClip(),c=0,l=!0),!l)continue;if(s._$clipDepth>0){c=s._$clipDepth,l=s._$shouldClip(o),l&&(t.save(),l=s._$startClip(t,o));continue}const a=s._$maskId>-1&&$.has(s._$maskId)?$.get(s._$maskId):null;if(a){let e;if(a._$updated=!1,this._$instanceId===a._$parentId)e=o;else{e=f;let i=$.get(a._$parentId);for(;i||i._$instanceId!==i._$parentId;)e=H(i._$matrix,e),i=$.get(i._$parentId);const s=le.scaleX,r=P(s,0,0,s,0,0);if(e=H(r,e),N(r),t.isLayer){const i=t.getCurrentPosition();e[4]-=i.xMin,e[5]-=i.yMin}}if(!a._$shouldClip(e))continue;const i=a._$startClip(t,e);if(t.save(),!i){t.restore();continue}}s._$draw(t,o,_),s._$updated=!1,a&&(t.restore(),t._$leaveClip())}if(c&&(t.restore(),l&&t._$leaveClip()),h.isLayer)return this._$postDraw(t,e,s,h);h.matrix!==e&&N(h.matrix),s!==i&&L(s),et(h)}_$getLayerBounds(e){const i=this._$children;if(!i.length)return F(0,0,0,0);const s=h.MAX_VALUE;let n=s,a=-s,o=s,_=-s;const l=le.instances;for(let t=0;t<i.length;++t){const s=i[t];if(!l.has(s))continue;const h=l.get(s);let c=e;const $=h._$matrix;1===$[0]&&0===$[1]&&0===$[2]&&1===$[3]&&0===$[4]&&0===$[5]||(c=H(e,$));const u=h._$getLayerBounds(c);n=r.min(n,u.xMin),a=r.max(a,u.xMax),o=r.min(o,u.yMin),_=r.max(_,u.yMax),B(u),c!==e&&N(c)}if(!this._$filters||!this._$filters.length)return F(n,a,o,_);let c=F(0,a-n,0,_-o),$=+r.sqrt(e[0]*e[0]+e[1]*e[1]),u=+r.sqrt(e[2]*e[2]+e[3]*e[3]);$/=t,u/=t,$*=2,u*=2;for(let t=0;t<this._$filters.length;++t)c=this._$filters[t]._$generateFilterRect(c,$,u);return a+=c.xMax-(a-n),_+=c.yMax-(_-o),n+=c.xMin,o+=c.yMin,B(c),F(n,a,o,_)}_$getBounds(t=null){let e=f;if(t){e=t;const i=this._$matrix;1===i[0]&&0===i[1]&&0===i[2]&&1===i[3]&&0===i[4]&&0===i[5]||(e=H(t,i))}const i=this._$children;if(!i.length){const i=F(e[4],-e[4],e[5],-e[5]);return t&&e!==t&&N(e),i}const s=h.MAX_VALUE;let n=s,a=-s,o=s,_=-s;const l=le.instances;for(let t=0;t<i.length;++t){const s=i[t];if(!l.has(s))continue;const h=l.get(s)._$getBounds(e);n=r.min(n,h.xMin),a=r.max(a,h.xMax),o=r.min(o,h.yMin),_=r.max(_,h.yMax),B(h)}return t&&e!==t&&N(e),F(n,a,o,_)}_$preDraw(t,e){let i=e;const s=this._$matrix;if(1===s[0]&&0===s[1]&&0===s[2]&&1===s[3]&&0===s[4]&&0===s[5]||(i=H(e,s)),!i[0]&&!i[1]||!i[2]&&!i[3])return null;const n=x.pop()||{isLayer:!1,isUpdated:null,canApply:null,matrix:null,color:null,blendMode:"normal",filters:null,sw:0,sh:0};n.matrix=i;const a=this._$blendMode;if("normal"!==a||this._$filters&&this._$filters.length>0){const s=this._$getBounds(null),o=q(s,i);B(s);const _=+o.xMax,l=+o.xMin,c=+o.yMax,$=+o.yMin;B(o);const u=r.ceil(r.abs(_-l)),d=r.ceil(r.abs(c-$));if(0>=u||0>=d)return et(n),i!==e&&N(i),null;let g=+r.sqrt(i[0]*i[0]+i[1]*i[1]);if(!h.isInteger(g)){const t=g.toString(),e=t.indexOf("e");-1!==e&&(g=+t.slice(0,e)),g=+g.toFixed(4)}let f=+r.sqrt(i[2]*i[2]+i[3]*i[3]);if(!h.isInteger(f)){const t=f.toString(),e=t.indexOf("e");-1!==e&&(f=+t.slice(0,e)),f=+f.toFixed(4)}n.canApply=this._$canApply(this._$filters);let m=F(0,u,0,d);if(n.canApply&&this._$filters)for(let t=0;t<this._$filters.length;++t)m=this._$filters[t]._$generateFilterRect(m,g,f);const p=t.frameBuffer.currentAttachment;if(!p||!p.texture||l-m.xMin>p.width||$-m.yMin>p.height)return B(m),et(n),i!==e&&N(i),null;if(0>l+m.xMax||0>$+m.yMax)return B(m),et(n),i!==e&&N(i),null;let x=i[4]-l,b=i[5]-$;t._$startLayer(F(l,_,$,c));const v=this._$isFilterUpdated(i,this._$filters,n.canApply),T=this._$getLayerBounds(i),A=r.ceil(r.abs(T.xMax-T.xMin)),M=r.ceil(r.abs(T.yMax-T.yMin));B(T);const y=A-m.xMax+m.xMin,E=M-m.yMax+m.yMin;x+=y,b+=E,n.sw=y,n.sh=E,v&&t._$saveAttachment(r.ceil(u+y),r.ceil(d+E),!0),n.isLayer=!0,n.isUpdated=v,n.filters=this._$filters,n.blendMode=a,n.color=k(),n.matrix=P(i[0],i[1],i[2],i[3],x,b),i!==e&&N(i),B(m)}return n}_$postDraw(t,e,i,s){t.drawInstacedArray();const r=U(this._$instanceId,"f"),n=t.frameBuffer,a=s.matrix;let h=0,o=0,_=rt.get(r);if(!_||s.isUpdated){_&&rt.set(r,null),_=n.getTextureFromCurrentAttachment();const i=s.filters;let l=!1;if(i&&i.length){for(let s=0;s<i.length;++s)_=i[s]._$applyFilter(t,e);l=!0,h=t._$offsetX,o=t._$offsetY,t._$offsetX=0,t._$offsetY=0}_.filterState=l,_.matrix=`${a[0]}_${a[1]}_${a[2]}_${a[3]}`,_.offsetX=h,_.offsetY=o,rt.set(r,_),t._$restoreAttachment()}_.offsetX&&(h=_.offsetX),_.offsetY&&(o=_.offsetY),t.reset(),t.globalAlpha=G(i[3]+i[7]/255,0,1),t.globalCompositeOperation=s.blendMode;const l=t.getCurrentPosition();t.setTransform(1,0,0,1,l.xMin-h-s.sw,l.yMin-o-s.sh),t.drawImage(_,0,0,_.width,_.height,i),t._$endLayer(),t._$endLayer(),N(s.matrix),et(s),t.cachePosition=null}_$remove(){this._$children=new Int32Array,super._$remove(),ue.push(this)}}class mt{constructor(){this._$rgb="rgb",this._$mode="pad",this._$type="linear",this._$focalPointRatio=0,this._$points=P(),this._$stops=U()}dispose(){const t=this._$stops;for(let i=0;i<t.length;++i)e=t[i][1],b.push(e);var e;N(this._$points)}get mode(){return this._$mode}get type(){return this._$type}get rgb(){return this._$rgb}get points(){return this._$points}get focalPointRatio(){return this._$focalPointRatio}get stops(){return this._$stops.sort(((t,e)=>{switch(!0){case t[0]>e[0]:return 1;case e[0]>t[0]:return-1;default:return 0}})),this._$stops}linear(t,e,i,s,r="rgb",n="pad"){return this._$type="linear",this._$points[0]=t,this._$points[1]=e,this._$points[2]=i,this._$points[3]=s,this._$rgb=r,this._$mode=n,this._$stops.length&&(this._$stops.length=0),this}radial(t,e,i,s,r,n,a="rgb",h="pad",o=0){return this._$type="radial",this._$points[0]=t,this._$points[1]=e,this._$points[2]=i,this._$points[3]=s,this._$points[4]=r,this._$points[5]=n,this._$rgb=a,this._$mode=h,this._$focalPointRatio=G(o,-.975,.975,0),this._$stops.length&&(this._$stops.length=0),this}addColorStop(t,e){this._$stops.push(U(t,e))}}class pt{constructor(t,e,i){this._$texture=t,this._$repeat=e,this._$colorTransform=i}get texture(){return this._$texture}get repeat(){return this._$repeat}get colorTransform(){return this._$colorTransform}}class xt{constructor(){this._$fillStyle=w(1,1,1,1),this._$strokeStyle=w(1,1,1,1),this._$lineWidth=1,this._$lineCap="round",this._$lineJoin="round",this._$miterLimit=5}get miterLimit(){return this._$miterLimit}set miterLimit(t){this._$miterLimit=t}get lineWidth(){return this._$lineWidth}set lineWidth(t){this._$lineWidth=t}get lineCap(){return this._$lineCap}set lineCap(t){this._$lineCap=t}get lineJoin(){return this._$lineJoin}set lineJoin(t){this._$lineJoin=t}get fillStyle(){return this._$fillStyle}set fillStyle(t){this._$fillStyle instanceof o&&R(this._$fillStyle),this._$fillStyle=t}get strokeStyle(){return this._$strokeStyle}set strokeStyle(t){this._$strokeStyle instanceof o&&R(this._$strokeStyle),this._$strokeStyle=t}clear(){this._$lineWidth=1,this._$lineCap="round",this._$lineJoin="round",this._$miterLimit=5,this._$clearFill(),this._$clearStroke()}_$clearFill(){if(this._$fillStyle instanceof mt)return this._$fillStyle.dispose(),void(this._$fillStyle=w(1,1,1,1));this._$fillStyle instanceof pt?this._$fillStyle=w(1,1,1,1):this._$fillStyle.fill(1)}_$clearStroke(){if(this._$strokeStyle instanceof mt)return this._$strokeStyle.dispose(),void(this._$strokeStyle=w(1,1,1,1));this._$strokeStyle instanceof pt?this._$strokeStyle=w(1,1,1,1):this._$strokeStyle.fill(1)}}let bt=2048;class vt{constructor(t){t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),this._$gl=t,this._$objectPool=[],this._$objectPoolArea=0,this._$activeTexture=-1,this._$boundTextures=[null,null,null],this._$maxWidth=0,this._$maxHeight=0,this._$atlasTextures=[],this._$atlasCacheMap=new Map,this._$positionObjectArray=[],this._$nodeObjectArray=[],this._$atlasNodes=new Map}createTextureAtlas(){const t=this._$gl.createTexture();t.width=bt,t.height=bt,this._$gl.activeTexture(this._$gl.TEXTURE3),this._$gl.bindTexture(this._$gl.TEXTURE_2D,t),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_WRAP_S,this._$gl.CLAMP_TO_EDGE),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_WRAP_T,this._$gl.CLAMP_TO_EDGE),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_MIN_FILTER,this._$gl.NEAREST),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_MAG_FILTER,this._$gl.NEAREST),this._$gl.texStorage2D(this._$gl.TEXTURE_2D,1,this._$gl.RGBA8,bt,bt),this._$gl.bindTexture(this._$gl.TEXTURE_2D,null),this._$activeTexture>-1&&this._$gl.activeTexture(this._$activeTexture);const e=this._$atlasTextures.length;this._$atlasNodes.set(e,[]),this._$atlasCacheMap.set(e,[]),this._$atlasTextures.push(t)}getAtlasTexture(t){return this._$atlasTextures[t]}getNode(t,e,i,s){const r=this._$nodeObjectArray.length?this._$nodeObjectArray.pop():{x:0,y:0,w:0,h:0};return r.x=t,r.y=e,r.w=i,r.h=s,r}createCachePosition(t,e){const i=this._$positionObjectArray.length?this._$positionObjectArray.pop():{index:0,x:0,y:0,w:0,h:0};i.x=i.y=0,i.w=t,i.h=e;for(const[s,r]of this._$atlasNodes){if(!r.length)return t>e?(bt-t-1>0&&r.push(this.getNode(t+1,0,bt-t-1,e)),bt-e-1>0&&r.push(this.getNode(0,e+1,bt,bt-e-1))):(bt-e-1>0&&r.push(this.getNode(0,e+1,t,bt-e-1)),bt-t-1>0&&r.push(this.getNode(t+1,0,bt-t-1,bt))),i.index=s,this._$atlasCacheMap.get(i.index).push(i),i;const n=r.length;for(let a=0;a<n;++a){const n=r[a];if(!(t>n.w||e>n.h))return i.index=s,i.x=n.x,i.y=n.y,this._$atlasCacheMap.get(i.index).push(i),n.w!==t||n.h!==e?t>e?(n.h-e-1>0&&r.push(this.getNode(n.x,n.y+e+1,n.w,n.h-e-1)),n.w-t-1>0?(n.x=n.x+t+1,n.w=n.w-t-1,n.h=e):(r.splice(a,1),this._$nodeObjectArray.push(n))):(n.w-t-1>0&&r.push(this.getNode(n.x+t+1,n.y,n.w-t-1,n.h)),n.h-e-1>0?(n.y=n.y+e+1,n.w=t,n.h=n.h-e-1):(r.splice(a,1),this._$nodeObjectArray.push(n))):(r.splice(a,1),this._$nodeObjectArray.push(n)),i}}const s=this._$atlasTextures.length;this.createTextureAtlas();const r=this._$atlasNodes.get(s);return t>e?(bt-t-1>0&&r.push(this.getNode(t+1,0,bt-t-1,e)),bt-e-1>0&&r.push(this.getNode(0,e+1,bt,bt-e-1))):(bt-e-1>0&&r.push(this.getNode(0,e+1,t,bt-e-1)),bt-t-1>0&&r.push(this.getNode(t+1,0,bt-t-1,bt))),i.index=s,this._$atlasCacheMap.get(i.index).push(i),i}releasePosition(t){var e;this._$atlasNodes.has(t.index)&&(null===(e=this._$atlasNodes.get(t.index))||void 0===e||e.unshift(this.getNode(t.x,t.y,t.w,t.h)),this._$positionObjectArray.push(t))}clearCache(){for(const t of this._$atlasCacheMap.values())t.length=0;for(const t of this._$atlasNodes.values())t.length=0}_$createTexture(t,e){const i=this._$gl.createTexture();return i.width=0,i.height=0,i.area=0,i.dirty=!0,i.smoothing=!0,this.bind0(i,!1),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_WRAP_S,this._$gl.CLAMP_TO_EDGE),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_WRAP_T,this._$gl.CLAMP_TO_EDGE),i.width=t,i.height=e,i.area=t*e,i.dirty=!1,this._$gl.texStorage2D(this._$gl.TEXTURE_2D,1,this._$gl.RGBA8,t,e),i}_$getTexture(t,e){for(let i=0;i<this._$objectPool.length;i++){const s=this._$objectPool[i];if(s.width===t&&s.height===e)return this._$objectPool.splice(i,1),this._$objectPoolArea-=s.area,this.bind0(s,!1),s}return this._$createTexture(t,e)}create(t,e,i=null,s=!1,r=!0){const n=this._$getTexture(t,e);return s&&this._$gl.pixelStorei(this._$gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),r||this._$gl.pixelStorei(this._$gl.UNPACK_FLIP_Y_WEBGL,!1),n.width!==t||n.height!==e?(n.width=t,n.height=e,n.area=t*e,n.dirty=!1,this._$gl.texImage2D(this._$gl.TEXTURE_2D,0,this._$gl.RGBA,t,e,0,this._$gl.RGBA,this._$gl.UNSIGNED_BYTE,i)):i&&(n.dirty=!1,this._$gl.texSubImage2D(this._$gl.TEXTURE_2D,0,0,0,t,e,this._$gl.RGBA,this._$gl.UNSIGNED_BYTE,i)),s&&this._$gl.pixelStorei(this._$gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r||this._$gl.pixelStorei(this._$gl.UNPACK_FLIP_Y_WEBGL,!0),n}createFromImage(t,e=!1){return this._$createFromElement(t.width,t.height,t,e)}createFromCanvas(t){return this._$createFromElement(t.width,t.height,t,!1)}createFromVideo(t,e=!1){return this._$createFromElement(t.videoWidth,t.videoHeight,t,e)}_$createFromElement(t,e,i,s=!1){const r=this._$getTexture(t,e);return r.dirty=!1,this.bind0(r,s),this._$gl.pixelStorei(this._$gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),r.width!==t||r.height!==e?(r.width=t,r.height=e,r.area=t*e,this._$gl.texImage2D(this._$gl.TEXTURE_2D,0,this._$gl.RGBA,this._$gl.RGBA,this._$gl.UNSIGNED_BYTE,i)):this._$gl.texSubImage2D(this._$gl.TEXTURE_2D,0,0,0,this._$gl.RGBA,this._$gl.UNSIGNED_BYTE,i),this._$gl.pixelStorei(this._$gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r}release(t){if(t.area>this._$maxWidth*this._$maxHeight*2)this._$gl.deleteTexture(t);else if(t.dirty=!0,this._$objectPool.push(t),this._$objectPoolArea+=t.area,this._$objectPool.length&&this._$objectPoolArea>this._$maxWidth*this._$maxHeight*10){const t=this._$objectPool.shift();this._$objectPoolArea-=t.area,this._$gl.deleteTexture(t)}}bind0(t,e=null){this._$bindTexture(2,this._$gl.TEXTURE2,null,null),this._$bindTexture(1,this._$gl.TEXTURE1,null,null),this._$bindTexture(0,this._$gl.TEXTURE0,t,e)}bind01(t,e,i=null){this._$bindTexture(2,this._$gl.TEXTURE2,null,null),this._$bindTexture(1,this._$gl.TEXTURE1,e,i),this._$bindTexture(0,this._$gl.TEXTURE0,t,i)}bind012(t,e,i,s=null){this._$bindTexture(2,this._$gl.TEXTURE2,i,s),this._$bindTexture(1,this._$gl.TEXTURE1,e,null),this._$bindTexture(0,this._$gl.TEXTURE0,t,null)}bind02(t,e,i=null){this._$bindTexture(2,this._$gl.TEXTURE2,e,i),this._$bindTexture(1,this._$gl.TEXTURE1,null,null),this._$bindTexture(0,this._$gl.TEXTURE0,t,null)}_$bindTexture(t,e,i=null,s=null){const r=i!==this._$boundTextures[t],n=null!==s&&null!==i&&s!==i.smoothing;if((r||n||e===this._$gl.TEXTURE0)&&e!==this._$activeTexture&&(this._$activeTexture=e,this._$gl.activeTexture(e)),r&&(this._$boundTextures[t]=i,this._$gl.bindTexture(this._$gl.TEXTURE_2D,i)),n){i&&(i.smoothing=!!s);const t=s?this._$gl.LINEAR:this._$gl.NEAREST;this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_MIN_FILTER,t),this._$gl.texParameteri(this._$gl.TEXTURE_2D,this._$gl.TEXTURE_MAG_FILTER,t)}}}class Tt{constructor(t){this._$gl=t,this._$objectPool=U(),this._$objectPoolArea=0,this._$maxWidth=0,this._$maxHeight=0}set maxWidth(t){this._$maxWidth=t}set maxHeight(t){this._$maxHeight=t}_$createStencilBuffer(){const t=this._$gl.createRenderbuffer();if(!t)throw new Error("the stencil buffer is null.");return t.width=0,t.height=0,t.area=0,t.dirty=!0,t}_$getStencilBuffer(t,e){const i=this._$objectPool.length;for(let s=0;s<i;++s){const i=this._$objectPool[s];if(i.width===t&&i.height===e)return this._$objectPool.splice(s,1),this._$objectPoolArea-=i.area,i}if(i>100){const t=this._$objectPool.shift();if(t)return this._$objectPoolArea-=t.area,t}return this._$createStencilBuffer()}create(t,e){const i=this._$getStencilBuffer(t,e);return i.width===t&&i.height===e||(i.width=t,i.height=e,i.area=t*e,i.dirty=!1,this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,i),this._$gl.renderbufferStorage(this._$gl.RENDERBUFFER,this._$gl.STENCIL_INDEX8,t,e)),i}release(t){if(t.area>this._$maxWidth*this._$maxHeight*2)this._$gl.deleteRenderbuffer(t);else if(t.dirty=!0,this._$objectPool.push(t),this._$objectPoolArea+=t.area,this._$objectPoolArea>this._$maxWidth*this._$maxHeight*10){const t=this._$objectPool.shift();t&&(this._$objectPoolArea-=t.area,this._$gl.deleteRenderbuffer(t))}}}class At{constructor(t,e){this._$gl=t,this._$samples=e,this._$objectPool=U()}set samples(t){this._$samples=t}_$createColorBuffer(){const t=this._$gl.createRenderbuffer();if(!t)throw new Error("the color buffer is null.");const e=this._$gl.createRenderbuffer();if(!e)throw new Error("the stencil buffer is null.");return t.stencil=e,t.samples=0,t.width=0,t.height=0,t.area=0,t.dirty=!0,t}_$getColorBuffer(t){if(!this._$objectPool.length)return this._$createColorBuffer();const e=this._$bsearch(t);if(e<this._$objectPool.length){const t=this._$objectPool[e];return this._$objectPool.splice(e,1),t}const i=this._$objectPool.shift();if(!i)throw new Error("the color buffer is void.");return i}create(t,e,i=0){t=r.max(256,Y(t)),e=r.max(256,Y(e));const s=this._$getColorBuffer(t*e);return i||(i=this._$samples),(s.width<t||s.height<e||s.samples!==i)&&(t=r.max(t,s.width),e=r.max(e,s.height),s.samples=i,s.width=t,s.height=e,s.area=t*e,s.dirty=!1,this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,s),this._$gl.renderbufferStorageMultisample(this._$gl.RENDERBUFFER,i,this._$gl.RGBA8,t,e),this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,s.stencil),this._$gl.renderbufferStorageMultisample(this._$gl.RENDERBUFFER,i,this._$gl.STENCIL_INDEX8,t,e)),s}release(t){t.dirty=!0;const e=this._$bsearch(t.area);this._$objectPool.splice(e,0,t)}_$bsearch(t){let e=-1,i=this._$objectPool.length;for(;r.abs(i-e)>1;){const s=r.floor((i+e)/2);t<=this._$objectPool[s].area?i=s:e=s}return i}}class Mt{constructor(t,e){this._$gl=t,this._$objectPool=[],this._$frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.READ_FRAMEBUFFER,this._$frameBuffer),this._$frameBufferTexture=t.createFramebuffer(),this._$currentAttachment=null,this._$isBinding=!1,this._$textureManager=new vt(t),this._$stencilBufferPool=new Tt(t),this._$colorBufferPool=new At(t,e),this._$isRenderBinding=!1,this._$colorBuffer=this._$gl.createRenderbuffer(),this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,this._$colorBuffer),this._$gl.renderbufferStorageMultisample(this._$gl.RENDERBUFFER,e,this._$gl.RGBA8,bt,bt),this._$stencilBuffer=this._$gl.createRenderbuffer(),this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,this._$stencilBuffer),this._$gl.renderbufferStorageMultisample(this._$gl.RENDERBUFFER,e,this._$gl.STENCIL_INDEX8,bt,bt)}bindRenderBuffer(){this._$isBinding||(this._$isBinding=!0,this._$gl.bindFramebuffer(this._$gl.FRAMEBUFFER,this._$frameBuffer)),this._$isRenderBinding||(this._$isRenderBinding=!0,this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,this._$colorBuffer),this._$gl.framebufferRenderbuffer(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.RENDERBUFFER,this._$colorBuffer),this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,this._$stencilBuffer),this._$gl.framebufferRenderbuffer(this._$gl.FRAMEBUFFER,this._$gl.STENCIL_ATTACHMENT,this._$gl.RENDERBUFFER,this._$stencilBuffer))}get currentAttachment(){return this._$currentAttachment}get textureManager(){return this._$textureManager}createCacheAttachment(t,e,i=!1,s=0){const r=this._$objectPool.pop()||{width:0,height:0,color:null,texture:null,msaa:!1,stencil:null,mask:!1,clipLevel:0,isActive:!1},n=this._$textureManager.create(t,e);return r.width=t,r.height=e,i?(r.color=this._$colorBufferPool.create(t,e,s),r.texture=n,r.msaa=!0,r.stencil=r.color.stencil):(r.color=n,r.texture=n,r.msaa=!1,r.stencil=this._$stencilBufferPool.create(t,e)),r.mask=!1,r.clipLevel=0,r.isActive=!0,r}clearCache(){this._$textureManager.clearCache()}setMaxSize(t,e){this._$stencilBufferPool._$maxWidth=t,this._$stencilBufferPool._$maxHeight=e,this._$textureManager._$maxWidth=t,this._$textureManager._$maxHeight=e}createTextureAttachment(t,e){const i=this._$objectPool.pop()||{width:0,height:0,color:null,texture:null,msaa:!1,stencil:null,mask:!1,clipLevel:0,isActive:!1},s=this._$textureManager.create(t,e);return i.width=t,i.height=e,i.color=s,i.texture=s,i.msaa=!1,i.stencil=null,i.mask=!1,i.clipLevel=0,i.isActive=!0,i}createTextureAttachmentFrom(t){const e=this._$objectPool.pop()||{width:0,height:0,color:null,texture:null,msaa:!1,stencil:null,mask:!1,clipLevel:0,isActive:!0};return e.width=t.width,e.height=t.height,e.color=t,e.texture=t,e.msaa=!1,e.stencil=null,e.mask=!1,e.clipLevel=0,e.isActive=!0,e}releaseAttachment(t=null,e=!1){t&&t.isActive&&(t.msaa?t.color instanceof WebGLRenderbuffer&&this._$colorBufferPool.release(t.color):t.stencil&&this._$stencilBufferPool.release(t.stencil),e&&t.texture&&this._$textureManager.release(t.texture),t.color=null,t.texture=null,t.stencil=null,t.isActive=!1,this._$objectPool.push(t))}bind(t){this._$currentAttachment=t,this._$isBinding||(this._$isBinding=!0,this._$gl.bindFramebuffer(this._$gl.FRAMEBUFFER,this._$frameBuffer)),t.msaa?t.color instanceof WebGLRenderbuffer&&(this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,t.color),this._$gl.framebufferRenderbuffer(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.RENDERBUFFER,t.color)):t.color instanceof WebGLTexture&&(t.color&&this._$textureManager.bind0(t.color),this._$gl.framebufferTexture2D(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.TEXTURE_2D,t.color,0)),this._$gl.bindRenderbuffer(this._$gl.RENDERBUFFER,t.stencil),this._$gl.framebufferRenderbuffer(this._$gl.FRAMEBUFFER,this._$gl.STENCIL_ATTACHMENT,this._$gl.RENDERBUFFER,t.stencil),this._$isRenderBinding=!1}unbind(){this._$currentAttachment=null,this._$isBinding&&(this._$isBinding=!1,this._$gl.bindFramebuffer(this._$gl.FRAMEBUFFER,null))}transferToMainTexture(){if(!this._$currentAttachment)throw new Error("the current attachment is null.");const t=this._$currentAttachment.width,e=this._$currentAttachment.height,i=this._$currentAttachment.texture;if(!i)throw new Error("the texture is null.");this._$gl.bindFramebuffer(this._$gl.DRAW_FRAMEBUFFER,this._$frameBufferTexture),this._$textureManager.bind0(i),this._$gl.framebufferTexture2D(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.TEXTURE_2D,i,0),this._$gl.bindFramebuffer(this._$gl.DRAW_FRAMEBUFFER,null),this._$gl.blitFramebuffer(0,0,t,e,0,0,t,e,this._$gl.COLOR_BUFFER_BIT,this._$gl.NEAREST),this._$gl.bindFramebuffer(this._$gl.DRAW_FRAMEBUFFER,this._$frameBuffer)}createCachePosition(t,e){return this._$textureManager.createCachePosition(t,e)}transferTexture(t){this._$gl.disable(this._$gl.SCISSOR_TEST),this._$gl.bindFramebuffer(this._$gl.DRAW_FRAMEBUFFER,this._$frameBufferTexture);const e=this._$textureManager.getAtlasTexture(t.index);this._$textureManager.bind0(e),this._$gl.framebufferTexture2D(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.TEXTURE_2D,e,0);const i=r.max(0,t.x-1),s=r.max(0,t.y-1),n=r.min(bt,t.x+t.w+1),a=r.min(bt,t.y+t.h+1);this._$gl.blitFramebuffer(i,s,n,a,i,s,n,a,this._$gl.COLOR_BUFFER_BIT,this._$gl.NEAREST),this._$gl.bindFramebuffer(this._$gl.FRAMEBUFFER,this._$frameBuffer)}getTextureFromCurrentAttachment(){if(!this._$currentAttachment)throw new Error("the current attachment is null.");if(!this._$currentAttachment.msaa&&this._$currentAttachment.texture)return this._$currentAttachment.texture;const t=this._$currentAttachment.width,e=this._$currentAttachment.height,i=this._$currentAttachment.texture;if(!i)throw new Error("the texture is null.");return i.dirty=!1,this._$gl.bindFramebuffer(this._$gl.DRAW_FRAMEBUFFER,this._$frameBufferTexture),this._$textureManager.bind0(i),this._$gl.framebufferTexture2D(this._$gl.FRAMEBUFFER,this._$gl.COLOR_ATTACHMENT0,this._$gl.TEXTURE_2D,i,0),this._$gl.blitFramebuffer(0,0,t,e,0,0,t,e,this._$gl.COLOR_BUFFER_BIT,this._$gl.NEAREST),this._$gl.bindFramebuffer(this._$gl.FRAMEBUFFER,this._$frameBuffer),i}createTextureFromPixels(t,e,i=null,s=!1,r=!0){return this._$textureManager.create(t,e,i,s,r)}createTextureFromCanvas(t){return this._$textureManager.createFromCanvas(t)}createTextureFromImage(t,e=!1){return this._$textureManager.createFromImage(t,e)}createTextureFromVideo(t,e=!1){return this._$textureManager.createFromVideo(t,e)}createTextureFromCurrentAttachment(){if(!this._$currentAttachment)throw new Error("the current attachment is null.");const t=this._$currentAttachment.width,e=this._$currentAttachment.height,i=this._$textureManager.create(t,e);return this._$textureManager.bind0(i),this._$gl.copyTexSubImage2D(this._$gl.TEXTURE_2D,0,0,0,0,0,t,e),i}releaseTexture(t){this._$textureManager.release(t)}}class yt{constructor(){this._$bezierConverterBuffer=new o(32)}cubicToQuad(t,e,i,s,r,n,a,h){this._$split2Cubic(t,e,i,s,r,n,a,h,0,16),this._$split2Cubic(this._$bezierConverterBuffer[0],this._$bezierConverterBuffer[1],this._$bezierConverterBuffer[2],this._$bezierConverterBuffer[3],this._$bezierConverterBuffer[4],this._$bezierConverterBuffer[5],this._$bezierConverterBuffer[6],this._$bezierConverterBuffer[7],0,8),this._$split2Cubic(this._$bezierConverterBuffer[16],this._$bezierConverterBuffer[17],this._$bezierConverterBuffer[18],this._$bezierConverterBuffer[19],this._$bezierConverterBuffer[20],this._$bezierConverterBuffer[21],this._$bezierConverterBuffer[22],this._$bezierConverterBuffer[23],16,24),this._$split2Quad(this._$bezierConverterBuffer[0],this._$bezierConverterBuffer[1],this._$bezierConverterBuffer[2],this._$bezierConverterBuffer[3],this._$bezierConverterBuffer[4],this._$bezierConverterBuffer[5],this._$bezierConverterBuffer[6],this._$bezierConverterBuffer[7],0),this._$split2Quad(this._$bezierConverterBuffer[8],this._$bezierConverterBuffer[9],this._$bezierConverterBuffer[10],this._$bezierConverterBuffer[11],this._$bezierConverterBuffer[12],this._$bezierConverterBuffer[13],this._$bezierConverterBuffer[14],this._$bezierConverterBuffer[15],8),this._$split2Quad(this._$bezierConverterBuffer[16],this._$bezierConverterBuffer[17],this._$bezierConverterBuffer[18],this._$bezierConverterBuffer[19],this._$bezierConverterBuffer[20],this._$bezierConverterBuffer[21],this._$bezierConverterBuffer[22],this._$bezierConverterBuffer[23],16),this._$split2Quad(this._$bezierConverterBuffer[24],this._$bezierConverterBuffer[25],this._$bezierConverterBuffer[26],this._$bezierConverterBuffer[27],this._$bezierConverterBuffer[28],this._$bezierConverterBuffer[29],this._$bezierConverterBuffer[30],this._$bezierConverterBuffer[31],24)}_$split2Cubic(t,e,i,s,r,n,a,h,o,_){const l=.125*(t+3*(i+r)+a),c=.125*(e+3*(s+n)+h),$=.125*(a+r-i-t),u=.125*(h+n-s-e);this._$bezierConverterBuffer[o]=t,this._$bezierConverterBuffer[o+1]=e,this._$bezierConverterBuffer[o+2]=.5*(t+i),this._$bezierConverterBuffer[o+3]=.5*(e+s),this._$bezierConverterBuffer[o+4]=l-$,this._$bezierConverterBuffer[o+5]=c-u,this._$bezierConverterBuffer[o+6]=l,this._$bezierConverterBuffer[o+7]=c,this._$bezierConverterBuffer[_]=l,this._$bezierConverterBuffer[_+1]=c,this._$bezierConverterBuffer[_+2]=l+$,this._$bezierConverterBuffer[_+3]=c+u,this._$bezierConverterBuffer[_+4]=.5*(r+a),this._$bezierConverterBuffer[_+5]=.5*(n+h),this._$bezierConverterBuffer[_+6]=a,this._$bezierConverterBuffer[_+7]=h}_$split2Quad(t,e,i,s,r,n,a,h,o){const _=.125*(t+3*(i+r)+a),l=.125*(e+3*(s+n)+h);this._$bezierConverterBuffer[o]=.25*t+.75*i,this._$bezierConverterBuffer[o+1]=.25*e+.75*s,this._$bezierConverterBuffer[o+2]=_,this._$bezierConverterBuffer[o+3]=l,this._$bezierConverterBuffer[o+4]=.75*r+.25*a,this._$bezierConverterBuffer[o+5]=.75*n+.25*h,this._$bezierConverterBuffer[o+6]=a,this._$bezierConverterBuffer[o+7]=h}}class Et{constructor(){this._$currentPath=U(),this._$vertices=U(),this._$bezierConverter=new yt}get vertices(){return this._$pushCurrentPathToVertices(),this._$vertices}begin(){for(this._$currentPath.length=0;this._$vertices.length;)D(this._$vertices.pop())}moveTo(t,e){this._$currentPath.length?this._$equalsToLastPoint(t,e)||(this._$pushCurrentPathToVertices(),this._$pushPointToCurrentPath(t,e,!1)):this._$pushPointToCurrentPath(t,e,!1)}lineTo(t,e){this._$currentPath.length||this.moveTo(0,0),this._$equalsToLastPoint(t,e)||this._$pushPointToCurrentPath(t,e,!1)}quadTo(t,e,i,s){this._$currentPath.length||this.moveTo(0,0),this._$equalsToLastPoint(i,s)||(this._$pushPointToCurrentPath(t,e,!0),this._$pushPointToCurrentPath(i,s,!1))}cubicTo(t,e,i,s,r,n){if(this._$currentPath.length||this.moveTo(0,0),this._$equalsToLastPoint(r,n))return;const a=+this._$currentPath[this._$currentPath.length-3],h=+this._$currentPath[this._$currentPath.length-2];this._$bezierConverter.cubicToQuad(a,h,t,e,i,s,r,n);const o=this._$bezierConverter._$bezierConverterBuffer;for(let t=0;t<32;)this.quadTo(o[t++],o[t++],o[t++],o[t++])}drawCircle(t,e,i){const s=i,r=.5522847498307936*i;this.cubicTo(t+s,e+r,t+r,e+s,t,e+s),this.cubicTo(t-r,e+s,t-s,e+r,t-s,e),this.cubicTo(t-s,e-r,t-r,e-s,t,e-s),this.cubicTo(t+r,e-s,t+s,e-r,t+s,e)}close(){if(this._$currentPath.length<=6)return;const t=+this._$currentPath[0],e=+this._$currentPath[1];this._$equalsToLastPoint(t,e)||this._$pushPointToCurrentPath(t,e,!1)}_$equalsToLastPoint(t,e){const i=+this._$currentPath[this._$currentPath.length-3],s=+this._$currentPath[this._$currentPath.length-2];return t===i&&e===s}_$pushPointToCurrentPath(t,e,i){this._$currentPath.push(t,e,i)}_$pushCurrentPathToVertices(){this._$currentPath.length<4?this._$currentPath.length=0:(this._$vertices.push(this._$currentPath),this._$currentPath=U())}createRectVertices(t,e,i,s){return U(U(t,e,!1,t+i,e,!1,t+i,e+s,!1,t,e+s,!1))}}class Ct{constructor(){this.enabled=!1,this.parentMatrixA=1,this.parentMatrixB=0,this.parentMatrixC=0,this.parentMatrixD=0,this.parentMatrixE=1,this.parentMatrixF=0,this.parentMatrixG=0,this.parentMatrixH=0,this.parentMatrixI=1,this.ancestorMatrixA=1,this.ancestorMatrixB=0,this.ancestorMatrixC=0,this.ancestorMatrixD=0,this.ancestorMatrixE=1,this.ancestorMatrixF=0,this.ancestorMatrixG=0,this.ancestorMatrixH=0,this.ancestorMatrixI=1,this.parentViewportX=0,this.parentViewportY=0,this.parentViewportW=0,this.parentViewportH=0,this.minXST=1e-5,this.minYST=1e-5,this.minXPQ=1e-5,this.minYPQ=1e-5,this.maxXST=.99999,this.maxYST=.99999,this.maxXPQ=.99999,this.maxYPQ=.99999}enable(t,e,i,s,n,a,h,o,_,l,c,$,u,d,g,f,m,p,x){const b=n.xMax-n.xMin,v=n.yMax-n.yMin,T=a.w,A=a.h,M=r.abs(r.ceil(b*h)),y=r.abs(r.ceil(v*h)),E=T>0?(a.x-n.xMin)/b:1e-5,C=A>0?(a.y-n.yMin)/v:1e-5,S=T>0?(a.x+a.w-n.xMin)/b:.99999,F=A>0?(a.y+a.h-n.yMin)/v:.99999;let B=M*E/i,w=y*C/s,R=(i-M*(1-S))/i,I=(s-y*(1-F))/s;if(B>=R){const t=E/(E+(1-S));B=r.max(t-1e-5,0),R=r.min(t+1e-5,1)}if(w>=I){const t=C/(C+(1-F));w=r.max(t-1e-5,0),I=r.min(t+1e-5,1)}this.enabled=!0,this.parentMatrixA=o,this.parentMatrixB=_,this.parentMatrixD=l,this.parentMatrixE=c,this.parentMatrixG=$,this.parentMatrixH=u,this.ancestorMatrixA=d,this.ancestorMatrixB=g,this.ancestorMatrixD=f,this.ancestorMatrixE=m,this.ancestorMatrixG=p,this.ancestorMatrixH=x,this.parentViewportX=t,this.parentViewportY=e,this.parentViewportW=i,this.parentViewportH=s,this.minXST=E,this.minYST=C,this.minXPQ=B,this.minYPQ=w,this.maxXST=S,this.maxYST=F,this.maxXPQ=R,this.maxYPQ=I}disable(){this.enabled=!1}}class St{constructor(t,e){this._$gl=t,this._$array=[],this._$map=V();const i=this._$gl.getProgramParameter(e,this._$gl.ACTIVE_UNIFORMS);for(let t=0;t<i;t++){const i=this._$gl.getActiveUniform(e,t),s=i.name.endsWith("[0]")?i.name.slice(0,-3):i.name,r=this._$gl.getUniformLocation(e,s);if(i.type===this._$gl.SAMPLER_2D&&1===i.size)continue;const n={};switch(i.type){case this._$gl.FLOAT_VEC4:n.method=this._$gl.uniform4fv.bind(this._$gl,r),n.array=new o(4*i.size),n.assign=-1;break;case this._$gl.INT_VEC4:n.method=this._$gl.uniform4iv.bind(this._$gl,r),n.array=new _(4*i.size),n.assign=-1;break;case this._$gl.SAMPLER_2D:n.method=this._$gl.uniform1iv.bind(this._$gl,r),n.array=new _(i.size),n.assign=1;break;case this._$gl.FLOAT:case this._$gl.FLOAT_VEC2:case this._$gl.FLOAT_VEC3:case this._$gl.FLOAT_MAT2:case this._$gl.FLOAT_MAT3:case this._$gl.FLOAT_MAT4:case this._$gl.INT:case this._$gl.INT_VEC2:case this._$gl.INT_VEC3:default:throw new Error("Use gl.FLOAT_VEC4 or gl.INT_VEC4 instead")}this._$array.push(n),this._$map.set(s,n)}}getArray(t){const e=this._$map.get(t);if(!e||!e.array)throw new Error("the UniformData is null.");return e.array}get textures(){const t=this._$map.get("u_textures");if(!t||!t.array)throw new Error("the UniformData is null.");return t.array}get highp(){const t=this._$map.get("u_highp");if(!t||!t.array)throw new Error("the UniformData is null.");return t.array}get mediump(){const t=this._$map.get("u_mediump");if(!t||!t.array)throw new Error("the UniformData is null.");return t.array}get integer(){const t=this._$map.get("u_integer");if(!t||!t.array)throw new Error("the UniformData is null.");return t.array}bindUniforms(){const t=this._$array.length;for(let e=0;e<t;e++){const t=this._$array[e];void 0!==t.method&&void 0!==t.assign&&(t.assign<0?t.method(t.array):t.assign>0&&(t.assign--,t.method(t.array)))}}}class Ft{constructor(){this._$attributes=[],this._$count=0}get attributes(){return this._$attributes}get count(){return this._$count}set count(t){this._$count=t}clear(){this._$attributes.length=0,this._$count=0}}class Bt{constructor(t,e,i,s){this._$gl=t,this._$context=e,this._$program=this._$createProgram(i,s),this._$uniform=new St(t,this._$program),this._$instance=null}get instance(){return this._$instance||(this._$instance=new Ft),this._$instance}get uniform(){return this._$uniform}_$createProgram(t,i){const s=this._$gl.createProgram();s.id=e++;const r=this._$gl.createShader(this._$gl.VERTEX_SHADER);this._$gl.shaderSource(r,t),this._$gl.compileShader(r);const n=this._$gl.createShader(this._$gl.FRAGMENT_SHADER);return this._$gl.shaderSource(n,i),this._$gl.compileShader(n),this._$gl.attachShader(s,r),this._$gl.attachShader(s,n),this._$gl.linkProgram(s),this._$gl.detachShader(s,r),this._$gl.detachShader(s,n),this._$gl.deleteShader(r),this._$gl.deleteShader(n),s}_$attachProgram(){const t=this._$context.shaderList;t.currentProgramId!==this._$program.id&&(t.currentProgramId=this._$program.id,this._$gl.useProgram(this._$program))}drawArraysInstanced(t){this._$attachProgram(),this._$context.vao.bindInstnceArray(t),this._$gl.drawArraysInstanced(this._$gl.TRIANGLE_STRIP,0,4,t.count)}_$drawImage(){this._$attachProgram(),this._$uniform.bindUniforms(),this._$context.vao.bindCommonVertexArray(),this._$gl.drawArrays(this._$gl.TRIANGLE_STRIP,0,4)}_$drawGradient(t,e){this._$attachProgram(),this._$uniform.bindUniforms(),this._$context.vao.bindGradientVertexArray(t,e),this._$gl.drawArrays(this._$gl.TRIANGLE_STRIP,0,4)}_$stroke(t){this._$attachProgram(),this._$context.blend.reset(),this._$uniform.bindUniforms(),this._$context.vao.bind(t),this._$gl.drawElements(this._$gl.TRIANGLES,t.indexCount,this._$gl.UNSIGNED_SHORT,0)}_$fill(t){this._$attachProgram(),this._$context.blend.reset(),this._$uniform.bindUniforms(),this._$context.vao.bind(t);const e=t.indexRanges,i=e[e.length-1];this._$gl.drawArrays(this._$gl.TRIANGLES,0,i.first+i.count)}_$containerClip(t,e,i){this._$attachProgram(),this._$context.blend.reset(),this._$uniform.bindUniforms(),this._$context.vao.bind(t),this._$gl.drawArrays(this._$gl.TRIANGLES,e,i)}_$drawPoints(t,e,i){this._$attachProgram(),this._$uniform.bindUniforms(),this._$context.vao.bind(t),this._$gl.drawArrays(this._$gl.POINTS,e,i)}}class wt{static FUNCTION_GRID_OFF(){return"\\n\\nvec2 applyMatrix(in vec2 vertex) {\\n    mat3 matrix = mat3(\\n        u_highp[0].xyz,\\n        u_highp[1].xyz,\\n        u_highp[2].xyz\\n    );\\n\\n    vec2 position = (matrix * vec3(vertex, 1.0)).xy;\\n\\n    return position;\\n}\\n\\n"}static FUNCTION_GRID_ON(t){return`\\n\\nvec2 applyMatrix(in vec2 vertex) {\\n    mat3 parent_matrix = mat3(\\n        u_highp[${t}].xyz,\\n        u_highp[${t+1}].xyz,\\n        u_highp[${t+2}].xyz\\n    );\\n    mat3 ancestor_matrix = mat3(\\n        u_highp[${t+3}].xyz,\\n        u_highp[${t+4}].xyz,\\n        u_highp[${t+5}].xyz\\n    );\\n    vec2 parent_offset = vec2(u_highp[${t+2}].w, u_highp[${t+3}].w);\\n    vec2 parent_size   = vec2(u_highp[${t+4}].w, u_highp[${t+5}].w);\\n    vec4 grid_min = u_highp[${t+6}];\\n    vec4 grid_max = u_highp[${t+7}];\\n\\n    vec2 position = (parent_matrix * vec3(vertex, 1.0)).xy;\\n    position = (position - parent_offset) / parent_size;\\n\\n    vec4 ga = grid_min;\\n    vec4 gb = grid_max  - grid_min;\\n    vec4 gc = vec4(1.0) - grid_max;\\n\\n    vec2 pa = position;\\n    vec2 pb = position - grid_min.st;\\n    vec2 pc = position - grid_max.st;\\n\\n    position = (ga.pq / ga.st) * min(pa, ga.st)\\n             + (gb.pq / gb.st) * clamp(pb, vec2(0.0), gb.st)\\n             + (gc.pq / gc.st) * max(vec2(0.0), pc);\\n\\n    position = position * parent_size + parent_offset;\\n    position = (ancestor_matrix * vec3(position, 1.0)).xy;\\n\\n    return position;\\n}\\n\\n`}}class Rt{static TEMPLATE(t,e,i,s){const r=e-1,n=i?this.VARYING_UV_ON():"",a=i?this.STATEMENT_UV_ON():"";return`#version 300 es\\n\\nlayout (location = 0) in vec2 a_vertex;\\nlayout (location = 1) in vec2 a_option1;\\nlayout (location = 2) in vec2 a_option2;\\nlayout (location = 3) in float a_type;\\n\\nuniform vec4 u_highp[${t}];\\n\\n${n}\\n\\n${s?wt.FUNCTION_GRID_ON(i?5:0):wt.FUNCTION_GRID_OFF()}\\n\\nfloat crossVec2(in vec2 v1, in vec2 v2) {\\n    return v1.x * v2.y - v2.x * v1.y;\\n}\\n\\nvec2 perpendicularVec2(in vec2 v1) {\\n    float face = u_highp[${r}][1];\\n\\n    return face * vec2(v1.y, -v1.x);\\n}\\n\\nvec2 calculateNormal(in vec2 direction) {\\n    vec2 normalized = normalize(direction);\\n    return perpendicularVec2(normalized);\\n}\\n\\nvec2 calculateIntersection(in vec2 v1, in vec2 v2, in vec2 o1, in vec2 o2) {\\n    float t = crossVec2(o2 - o1, v2) / crossVec2(v1, v2);\\n    return (o1 + t * v1);\\n}\\n\\nvec2 calculateAnchor(in vec2 position, in float convex, out vec2 v1, out vec2 v2, out vec2 o1, out vec2 o2) {\\n    float miter_limit = u_highp[${r}][2];\\n\\n    vec2 a = applyMatrix(a_option1);\\n    vec2 b = applyMatrix(a_option2);\\n\\n    v1 = convex * (position - a);\\n    v2 = convex * (b - position);\\n    o1 = calculateNormal(v1) + a;\\n    o2 = calculateNormal(v2) + position;\\n\\n    vec2 anchor = calculateIntersection(v1, v2, o1, o2) - position;\\n    return normalize(anchor) * min(length(anchor), miter_limit);\\n}\\n\\nvoid main() {\\n    vec2 viewport = vec2(u_highp[0].w, u_highp[1].w);\\n    float half_width = u_highp[${r}][0];\\n\\n    vec2 position = applyMatrix(a_vertex);\\n    vec2 offset = vec2(0.0);\\n    vec2 v1, v2, o1, o2;\\n\\n    if (a_type == 1.0 || a_type == 2.0) { // \\n        offset = calculateNormal(a_option2 * (applyMatrix(a_option1) - position));\\n    } else if (a_type == 10.0) { // \\n        offset = normalize(position - applyMatrix(a_option1));\\n        offset += a_option2 * perpendicularVec2(offset);\\n    } else if (a_type == 21.0) { // B\\n        offset = calculateAnchor(position, 1.0, v1, v2, o1, o2);\\n        offset = calculateIntersection(v2, perpendicularVec2(offset), o2, position + offset) - position;\\n    } else if (a_type == 22.0) { // A\\n        offset = calculateAnchor(position, 1.0, v1, v2, o1, o2);\\n        offset = calculateIntersection(v1, perpendicularVec2(offset), o1, position + offset) - position;\\n    } else if (a_type == 23.0) { // A\\n        offset = calculateAnchor(position, -1.0, v1, v2, o1, o2);\\n        offset = calculateIntersection(v1, perpendicularVec2(offset), o1, position + offset) - position;\\n    } else if (a_type == 24.0) { // B\\n        offset = calculateAnchor(position, -1.0, v1, v2, o1, o2);\\n        offset = calculateIntersection(v2, perpendicularVec2(offset), o2, position + offset) - position;\\n    } else if (a_type >= 30.0) { // \\n        float face = u_highp[${r}][1];\\n        float rad = face * (a_type - 30.0) * 0.3488888889; /* 0.3488888889 = PI / 9.0 */\\n        offset = mat2(cos(rad), sin(rad), -sin(rad), cos(rad)) * vec2(1.0, 0.0);\\n    }\\n    \\n    offset *= half_width;\\n    position += offset;\\n    ${a}\\n\\n    position /= viewport;\\n    position = position * 2.0 - 1.0;\\n    gl_Position = vec4(position.x, -position.y, 0.0, 1.0);\\n}\\n\\n`}static VARYING_UV_ON(){return"\\nout vec2 v_uv;\\n"}static STATEMENT_UV_ON(){return"\\n    mat3 uv_matrix = mat3(\\n        u_highp[0].xyz,\\n        u_highp[1].xyz,\\n        u_highp[2].xyz\\n    );\\n    mat3 inverse_matrix = mat3(\\n        u_highp[3].xyz,\\n        u_highp[4].xyz,\\n        vec3(u_highp[2].w, u_highp[3].w, u_highp[4].w)\\n    );\\n\\n    v_uv = (uv_matrix * vec3(a_vertex, 1.0)).xy;\\n    v_uv += offset;\\n    v_uv = (inverse_matrix * vec3(v_uv, 1.0)).xy;\\n"}}class It{static TEMPLATE(t,e,i,s){const r=i?this.ATTRIBUTE_BEZIER_ON():"",n=i?this.VARYING_BEZIER_ON():e?this.VARYING_UV_ON():"",a=i?this.STATEMENT_BEZIER_ON():e?this.STATEMENT_UV_ON():"";return`#version 300 es\\n\\nlayout (location = 0) in vec2 a_vertex;\\n${r}\\n\\nuniform vec4 u_highp[${t}];\\n\\n${n}\\n\\n${s?wt.FUNCTION_GRID_ON(e?5:0):wt.FUNCTION_GRID_OFF()}\\n\\nvoid main() {\\n    vec2 viewport = vec2(u_highp[0].w, u_highp[1].w);\\n\\n    ${a}\\n\\n    vec2 pos = applyMatrix(a_vertex) / viewport;\\n    pos = pos * 2.0 - 1.0;\\n    gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\\n}\\n\\n`}static ATTRIBUTE_BEZIER_ON(){return"\\nlayout (location = 1) in vec2 a_bezier;\\n"}static VARYING_UV_ON(){return"\\nout vec2 v_uv;\\n"}static VARYING_BEZIER_ON(){return"\\nout vec2 v_bezier;\\n"}static STATEMENT_UV_ON(){return"\\n    mat3 uv_matrix = mat3(\\n        u_highp[0].xyz,\\n        u_highp[1].xyz,\\n        u_highp[2].xyz\\n    );\\n    mat3 inverse_matrix = mat3(\\n        u_highp[3].xyz,\\n        u_highp[4].xyz,\\n        vec3(u_highp[2].w, u_highp[3].w, u_highp[4].w)\\n    );\\n\\n    v_uv = (inverse_matrix * uv_matrix * vec3(a_vertex, 1.0)).xy;\\n"}static STATEMENT_BEZIER_ON(){return"\\n    v_bezier = a_bezier;\\n"}}class Pt{static FUNCTION_IS_INSIDE(){return"\\n\\nfloat isInside(in vec2 uv) {\\n    return step(4.0, dot(step(vec4(0.0, uv.x, 0.0, uv.y), vec4(uv.x, 1.0, uv.y, 1.0)), vec4(1.0)));\\n}\\n\\n"}static STATEMENT_INSTANCED_COLOR_TRANSFORM_ON(){return"\\n    src.rgb /= max(0.0001, src.a);\\n    src = clamp(src * mul + add, 0.0, 1.0);\\n    src.rgb *= src.a;\\n"}static STATEMENT_COLOR_TRANSFORM_ON(t){return`\\n    vec4 mul = u_mediump[${t}];\\n    vec4 add = u_mediump[${t+1}];\\n${Pt.STATEMENT_INSTANCED_COLOR_TRANSFORM_ON()}\\n`}}class Nt{static SOLID_COLOR(){return"#version 300 es\\nprecision mediump float;\\n\\nuniform vec4 u_mediump;\\n\\nout vec4 o_color;\\n\\nvoid main() {\\n    o_color = vec4(u_mediump.rgb * u_mediump.a, u_mediump.a);\\n}\\n\\n"}static BITMAP_CLIPPED(){return`#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_texture;\\nuniform vec4 u_mediump[3];\\n\\nin vec2 v_uv;\\nout vec4 o_color;\\n\\nvoid main() {\\n    vec2 uv = vec2(v_uv.x, u_mediump[0].y - v_uv.y) / u_mediump[0].xy;\\n\\n    vec4 src = texture(u_texture, uv);\\n    ${Pt.STATEMENT_COLOR_TRANSFORM_ON(1)}\\n    o_color = src;\\n}`}static BITMAP_PATTERN(){return`#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_texture;\\nuniform vec4 u_mediump[3];\\n\\nin vec2 v_uv;\\nout vec4 o_color;\\n\\nvoid main() {\\n    vec2 uv = fract(vec2(v_uv.x, -v_uv.y) / u_mediump[0].xy);\\n    \\n    vec4 src = texture(u_texture, uv);\\n    ${Pt.STATEMENT_COLOR_TRANSFORM_ON(1)}\\n    o_color = src;\\n}`}static MASK(){return"#version 300 es\\nprecision mediump float;\\n\\nin vec2 v_bezier;\\nout vec4 o_color;\\n\\nvoid main() {\\n    vec2 px = dFdx(v_bezier);\\n    vec2 py = dFdy(v_bezier);\\n\\n    vec2 f = (2.0 * v_bezier.x) * vec2(px.x, py.x) - vec2(px.y, py.y);\\n    float alpha = 0.5 - (v_bezier.x * v_bezier.x - v_bezier.y) / length(f);\\n\\n    if (alpha > 0.0) {\\n        o_color = vec4(min(alpha, 1.0));\\n    } else {\\n        discard;\\n    }    \\n}\\n\\n"}}class kt{constructor(t,e){this._$context=t,this._$gl=e,this._$collection=V()}getSolidColorShapeShader(t,e){const i=`s${t?"y":"n"}${e?"y":"n"}`;if(this._$collection.has(i)){const t=this._$collection.get(i);if(t)return t}const s=(e?8:3)+(t?1:0),r=s;let n;n=t?Rt.TEMPLATE(s,r,!1,e):It.TEMPLATE(s,!1,!1,e);const a=new Bt(this._$gl,this._$context,n,Nt.SOLID_COLOR());return this._$collection.set(i,a),a}getBitmapShapeShader(t,e,i){const s=`b${t?"y":"n"}${e?"y":"n"}${i?"y":"n"}`;if(this._$collection.has(s)){const t=this._$collection.get(s);if(t)return t}const r=(i?13:5)+(t?1:0),n=r;let a;a=t?Rt.TEMPLATE(r,n,!0,i):It.TEMPLATE(r,!0,!1,i);const h=e?Nt.BITMAP_PATTERN():Nt.BITMAP_CLIPPED(),o=new Bt(this._$gl,this._$context,a,h);return this._$collection.set(s,o),o}getMaskShapeShader(t,e){const i=`m${t?"y":"n"}${e?"y":"n"}`;if(this._$collection.has(i)){const t=this._$collection.get(i);if(t)return t}const s=(e?8:3)+(t?1:0),r=s;let n;n=t?Rt.TEMPLATE(s,r,!1,e):It.TEMPLATE(s,!1,!0,e);const a=new Bt(this._$gl,this._$context,n,Nt.MASK());return this._$collection.set(i,a),a}setSolidColorShapeUniform(t,e,i,s,r,n,a,h,o,_,l,c){const $=t.highp;let u;n?($[0]=_.parentMatrixA,$[1]=_.parentMatrixB,$[2]=_.parentMatrixC,$[4]=_.parentMatrixD,$[5]=_.parentMatrixE,$[6]=_.parentMatrixF,$[8]=_.parentMatrixG,$[9]=_.parentMatrixH,$[10]=_.parentMatrixI,$[12]=_.ancestorMatrixA,$[13]=_.ancestorMatrixB,$[14]=_.ancestorMatrixC,$[16]=_.ancestorMatrixD,$[17]=_.ancestorMatrixE,$[18]=_.ancestorMatrixF,$[20]=_.ancestorMatrixG,$[21]=_.ancestorMatrixH,$[22]=_.ancestorMatrixI,$[3]=h,$[7]=o,$[11]=_.parentViewportX,$[15]=_.parentViewportY,$[19]=_.parentViewportW,$[23]=_.parentViewportH,$[24]=_.minXST,$[25]=_.minYST,$[26]=_.minXPQ,$[27]=_.minYPQ,$[28]=_.maxXST,$[29]=_.maxYST,$[30]=_.maxXPQ,$[31]=_.maxYPQ,u=32):($[0]=a[0],$[1]=a[1],$[2]=a[2],$[4]=a[3],$[5]=a[4],$[6]=a[5],$[8]=a[6],$[9]=a[7],$[10]=a[8],$[3]=h,$[7]=o,u=12),e&&($[u]=i,$[u+1]=s,$[u+2]=r);const d=t.mediump;d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3]*c}setBitmapShapeUniform(t,e,i,s,r,n,a,h,o,_,l,c,$,u,d,g,f,m,p,x,b){const v=t.highp;let T;v[0]=a[0],v[1]=a[1],v[2]=a[2],v[4]=a[3],v[5]=a[4],v[6]=a[5],v[8]=a[6],v[9]=a[7],v[10]=a[8],v[12]=h[0],v[13]=h[1],v[14]=h[2],v[16]=h[3],v[17]=h[4],v[18]=h[5],v[11]=h[6],v[15]=h[7],v[19]=h[8],v[3]=o,v[7]=_,T=20,n&&(v[T]=l.parentMatrixA,v[T+1]=l.parentMatrixB,v[T+2]=l.parentMatrixC,v[T+4]=l.parentMatrixD,v[T+5]=l.parentMatrixE,v[T+6]=l.parentMatrixF,v[T+8]=l.parentMatrixG,v[T+9]=l.parentMatrixH,v[T+10]=l.parentMatrixI,v[T+12]=l.ancestorMatrixA,v[T+13]=l.ancestorMatrixB,v[T+14]=l.ancestorMatrixC,v[T+16]=l.ancestorMatrixD,v[T+17]=l.ancestorMatrixE,v[T+18]=l.ancestorMatrixF,v[T+20]=l.ancestorMatrixG,v[T+21]=l.ancestorMatrixH,v[T+22]=l.ancestorMatrixI,v[T+11]=l.parentViewportX,v[T+15]=l.parentViewportY,v[T+19]=l.parentViewportW,v[T+23]=l.parentViewportH,v[T+24]=l.minXST,v[T+25]=l.minYST,v[T+26]=l.minXPQ,v[T+27]=l.minYPQ,v[T+28]=l.maxXST,v[T+29]=l.maxYST,v[T+30]=l.maxXPQ,v[T+31]=l.maxYPQ,T=52),e&&(v[T]=i,v[T+1]=s,v[T+2]=r);const A=t.mediump;A[0]=c,A[1]=$,A[4]=u,A[5]=d,A[6]=g,A[7]=f,A[8]=m,A[9]=p,A[10]=x,A[11]=b}setMaskShapeUniform(t,e,i,s,r,n,a,h,o,_,l,c,$,u=null){const d=t.highp;e&&u?(d[0]=u.parentMatrixA,d[1]=u.parentMatrixB,d[2]=u.parentMatrixC,d[4]=u.parentMatrixD,d[5]=u.parentMatrixE,d[6]=u.parentMatrixF,d[8]=u.parentMatrixG,d[9]=u.parentMatrixH,d[10]=u.parentMatrixI,d[12]=u.ancestorMatrixA,d[13]=u.ancestorMatrixB,d[14]=u.ancestorMatrixC,d[16]=u.ancestorMatrixD,d[17]=u.ancestorMatrixE,d[18]=u.ancestorMatrixF,d[20]=u.ancestorMatrixG,d[21]=u.ancestorMatrixH,d[22]=u.ancestorMatrixI,d[3]=c,d[7]=$,d[11]=u.parentViewportX,d[15]=u.parentViewportY,d[19]=u.parentViewportW,d[23]=u.parentViewportH,d[24]=u.minXST,d[25]=u.minYST,d[26]=u.minXPQ,d[27]=u.minYPQ,d[28]=u.maxXST,d[29]=u.maxYST,d[30]=u.maxXPQ,d[31]=u.maxYPQ):(d[0]=i,d[1]=s,d[2]=r,d[4]=n,d[5]=a,d[6]=h,d[8]=o,d[9]=_,d[10]=l,d[3]=c,d[7]=$)}setMaskShapeUniformIdentity(t,e,i){const s=t.highp;s[0]=1,s[1]=0,s[2]=0,s[4]=0,s[5]=1,s[6]=0,s[8]=0,s[9]=0,s[10]=1,s[3]=e,s[7]=i}}class Lt{static TEMPLATE(t,e,i,s,r){const n=i?this.STATEMENT_GRADIENT_TYPE_RADIAL(e,s):this.STATEMENT_GRADIENT_TYPE_LINEAR(e);let a;switch(r){case"reflect":a="1.0 - abs(fract(t * 0.5) * 2.0 - 1.0)";break;case"repeat":a="fract(t)";break;default:a="clamp(t, 0.0, 1.0)"}return`#version 300 es\\nprecision highp float;\\n\\nuniform sampler2D u_texture;\\nuniform vec4 u_highp[${t}];\\n\\nin vec2 v_uv;\\nout vec4 o_color;\\n\\nvoid main() {\\n    vec2 p = v_uv;\\n    ${n}\\n    t = ${a};\\n    o_color = texture(u_texture, vec2(t, 0.5));\\n}\\n\\n`}static STATEMENT_GRADIENT_TYPE_LINEAR(t){return`\\n    vec2 a = u_highp[${t}].xy;\\n    vec2 b = u_highp[${t}].zw;\\n\\n    vec2 ab = b - a;\\n    vec2 ap = p - a;\\n\\n    float t = dot(ab, ap) / dot(ab, ab);\\n`}static STATEMENT_GRADIENT_TYPE_RADIAL(t,e){return`\\n    float radius = u_highp[${t}][0];\\n\\n    vec2 coord = p / radius;\\n    ${e?this.STATEMENT_FOCAL_POINT_ON(t):this.STATEMENT_FOCAL_POINT_OFF()}\\n`}static STATEMENT_FOCAL_POINT_OFF(){return"\\n    float t = length(coord);\\n"}static STATEMENT_FOCAL_POINT_ON(t){return`\\n    vec2 focal = vec2(u_highp[${t}][1], 0.0);\\n\\n    vec2 dir = normalize(coord - focal);\\n\\n    float a = dot(dir, dir);\\n    float b = 2.0 * dot(dir, focal);\\n    float c = dot(focal, focal) - 1.0;\\n    float x = (-b + sqrt(b * b - 4.0 * a * c)) / (2.0 * a);\\n\\n    float t = distance(focal, coord) / distance(focal, focal + dir * x);\\n`}}class Ot{constructor(t,e){this._$context=t,this._$gl=e,this._$collection=V()}getGradientShapeShader(t,e,i,s,r){const n=this.createCollectionKey(t,e,i,s,r);if(this._$collection.has(n)){const t=this._$collection.get(n);if(t)return t}const a=(e?13:5)+(t?1:0)+1,h=a-1;let o;o=t?Rt.TEMPLATE(a,h,!0,e):It.TEMPLATE(a,!0,!1,e);const _=new Bt(this._$gl,this._$context,o,Lt.TEMPLATE(a,h,i,s,r));return this._$collection.set(n,_),_}createCollectionKey(t,e,i,s,r){const n=t?"y":"n",a=e?"y":"n",h=i?"y":"n",o=i&&s?"y":"n";let _=0;switch(r){case"reflect":_=1;break;case"repeat":_=2}return`${n}${a}${h}${o}${_}`}setGradientShapeUniform(t,e,i,s,r,n,a,h,o,_,l,c,$,u){const d=t.highp;d[0]=a[0],d[1]=a[1],d[2]=a[2],d[4]=a[3],d[5]=a[4],d[6]=a[5],d[8]=a[6],d[9]=a[7],d[10]=a[8],d[12]=h[0],d[13]=h[1],d[14]=h[2],d[16]=h[3],d[17]=h[4],d[18]=h[5],d[11]=h[6],d[15]=h[7],d[19]=h[8],d[3]=o,d[7]=_;let g=20;n&&(d[g]=l.parentMatrixA,d[g+1]=l.parentMatrixB,d[g+2]=l.parentMatrixC,d[g+4]=l.parentMatrixD,d[g+5]=l.parentMatrixE,d[g+6]=l.parentMatrixF,d[g+8]=l.parentMatrixG,d[g+9]=l.parentMatrixH,d[g+10]=l.parentMatrixI,d[g+12]=l.ancestorMatrixA,d[g+13]=l.ancestorMatrixB,d[g+14]=l.ancestorMatrixC,d[g+16]=l.ancestorMatrixD,d[g+17]=l.ancestorMatrixE,d[g+18]=l.ancestorMatrixF,d[g+20]=l.ancestorMatrixG,d[g+21]=l.ancestorMatrixH,d[g+22]=l.ancestorMatrixI,d[g+11]=l.parentViewportX,d[g+15]=l.parentViewportY,d[g+19]=l.parentViewportW,d[g+23]=l.parentViewportH,d[g+24]=l.minXST,d[g+25]=l.minYST,d[g+26]=l.minXPQ,d[g+27]=l.minYPQ,d[g+28]=l.maxXST,d[g+29]=l.maxYST,d[g+30]=l.maxXPQ,d[g+31]=l.maxYPQ,g=52),e&&(d[g]=i,d[g+1]=s,d[g+2]=r,g+=4),c?(d[g]=$[5],d[g+1]=u):(d[g]=$[0],d[g+1]=$[1],d[g+2]=$[2],d[g+3]=$[3])}}class Ut{static TEXTURE(){return"#version 300 es\\n\\nlayout (location = 0) in vec2 a_vertex;\\n\\nout vec2 v_coord;\\n\\nvoid main() {\\n    v_coord = a_vertex;\\n\\n    vec2 position = a_vertex * 2.0 - 1.0;\\n    gl_Position = vec4(position, 0.0, 1.0);\\n}\\n\\n"}static BLEND(){return"#version 300 es\\n\\nlayout (location = 0) in vec2 a_vertex;\\n\\nuniform vec4 u_highp[4];\\n\\nout vec2 v_coord;\\n\\nvoid main() {\\n    v_coord = a_vertex;\\n\\n    vec2 offset   = u_highp[0].xy;\\n    vec2 size     = u_highp[0].zw;\\n    mat3 matrix   = mat3(u_highp[1].xyz, u_highp[2].xyz, u_highp[3].xyz);\\n    vec2 viewport = vec2(u_highp[1].w, u_highp[2].w);\\n\\n    vec2 position = vec2(a_vertex.x, 1.0 - a_vertex.y);\\n    position = position * size + offset;\\n    position = (matrix * vec3(position, 1.0)).xy;\\n    position /= viewport;\\n\\n    position = position * 2.0 - 1.0;\\n    gl_Position = vec4(position.x, -position.y, 0.0, 1.0);\\n}\\n\\n"}static INSTANCE_BLEND(){return"#version 300 es\\n\\nlayout (location = 0) in vec2 a_vertex;\\n\\nuniform vec4 u_highp[5];\\n\\nout vec2 v_src_coord;\\nout vec2 v_dst_coord;\\n\\nvoid main() {\\n    vec4 rect     = vec4(u_highp[0].x, u_highp[0].y, u_highp[0].z, u_highp[0].w);\\n    vec2 size     = vec2(u_highp[4].x, u_highp[4].y);\\n    mat3 matrix   = mat3(u_highp[1].xyz, u_highp[2].xyz, u_highp[3].xyz);\\n    vec2 viewport = vec2(u_highp[1].w, u_highp[2].w);\\n\\n    v_src_coord = a_vertex * rect.zw + rect.xy;\\n    v_dst_coord = a_vertex;\\n\\n    vec2 position = vec2(a_vertex.x, 1.0 - a_vertex.y);\\n    position = position * size;\\n    position = (matrix * vec3(position, 1.0)).xy;\\n    position /= viewport;\\n\\n    position = position * 2.0 - 1.0;\\n    gl_Position = vec4(position.x, -position.y, 0.0, 1.0);\\n}\\n\\n"}static INSTANCE(){return"#version 300 es\\n\\nlayout (location = 0) in vec2 a_vertex;\\nlayout (location = 1) in vec4 a_rect;\\nlayout (location = 2) in vec4 a_size;\\nlayout (location = 3) in vec2 a_offset;\\nlayout (location = 4) in vec4 a_matrix;\\nlayout (location = 5) in vec4 a_mul;\\nlayout (location = 6) in vec4 a_add;\\n\\nout vec2 v_coord;\\nout vec4 mul;\\nout vec4 add;\\n\\nvoid main() {\\n    v_coord = a_vertex * a_rect.zw + a_rect.xy;\\n    mul = a_mul;\\n    add = a_add;\\n\\n    vec2 position = vec2(a_vertex.x, 1.0 - a_vertex.y);\\n    position = position * a_size.xy;\\n    mat3 matrix = mat3(a_matrix.x, a_matrix.y, 0.0, a_matrix.z, a_matrix.w, 0.0, a_offset.x, a_offset.y, 1.0);\\n    position = (matrix * vec3(position, 1.0)).xy;\\n    position /= a_size.zw;\\n\\n    position = position * 2.0 - 1.0;\\n    gl_Position = vec4(position.x, -position.y, 0.0, 1.0);\\n}\\n\\n"}static BLEND_CLIP(){return"#version 300 es\\n\\nlayout (location = 0) in vec2 a_vertex;\\n\\nuniform vec4 u_highp[4];\\n\\nout vec2 v_coord;\\n\\nvoid main() {\\n    v_coord = a_vertex;\\n\\n    vec2 offset     = u_highp[0].xy;\\n    vec2 size       = u_highp[0].zw;\\n    mat3 inv_matrix = mat3(u_highp[1].xyz, u_highp[2].xyz, u_highp[3].xyz);\\n    vec2 viewport   = vec2(u_highp[1].w, u_highp[2].w);\\n\\n    vec2 position = vec2(a_vertex.x, 1.0 - a_vertex.y);\\n    position *= viewport;\\n    position = (inv_matrix * vec3(position, 1.0)).xy;\\n    position = (position - offset) / size;\\n\\n    position = position * 2.0 - 1.0;\\n    gl_Position = vec4(position.x, -position.y, 0.0, 1.0);\\n}\\n\\n"}}class Dt{static TEMPLATE(t,e,i){let s="";for(let t=1;t<e;t++){const i=t-1,n=t,a=`u_mediump[${e+r.floor(i/4)}][${i%4}]`,h=`u_mediump[${e+r.floor(n/4)}][${n%4}]`;s+=`\\n    if (t <= ${h}) {\\n        return mix(u_mediump[${i}], u_mediump[${n}], (t - ${a}) / (${h} - ${a}));\\n    }\\n`}return`#version 300 es\\nprecision mediump float;\\n\\nuniform vec4 u_mediump[${t}];\\n\\nin vec2 v_coord;\\nout vec4 o_color;\\n\\nvec4 getGradientColor(in float t) {\\n    if (t <= u_mediump[${e}][0]) {\\n        return u_mediump[0];\\n    }\\n    ${s}\\n    return u_mediump[${e-1}];\\n}\\n\\nvoid main() {\\n    vec4 color = getGradientColor(v_coord.x);\\n    ${i?"color = pow(color, vec4(0.45454545));":""}\\n    color.rgb *= color.a;\\n\\n    o_color = color;\\n}\\n\\n`}}class Xt{constructor(t,e){this._$context=t,this._$gl=e,this._$collection=V()}getGradientLUTShader(t,e){const i=`l${("00"+t).slice(-3)}${e?"y":"n"}`;if(this._$collection.has(i)){const t=this._$collection.get(i);if(t)return t}const s=r.ceil(5*t/4),n=new Bt(this._$gl,this._$context,Ut.TEXTURE(),Dt.TEMPLATE(s,t,e));return this._$collection.set(i,n),n}setGradientLUTUniformForShape(t,e,i,s,r){let n=0;const a=t.mediump;for(let t=i;t<s;t++){const i=e[t][1];a[n++]=r[i[0]],a[n++]=r[i[1]],a[n++]=r[i[2]],a[n++]=r[i[3]]}for(let t=i;t<s;t++)a[n++]=e[t][0]}setGradientLUTUniformForFilter(t,e,i,s,r,n){let a=0;const h=t.mediump;for(let t=r;t<n;t++){const e=i[t];h[a++]=(e>>16)/255,h[a++]=(e>>8&255)/255,h[a++]=(255&e)/255,h[a++]=s[t]}for(let t=r;t<n;t++)h[a++]=e[t]}}class Vt{static TEMPLATE(t,e,i,s,r,n,a,h,o){let _=0;const l=i?this.STATEMENT_BASE_TEXTURE_TRANSFORM(_++):"",c=s?this.STATEMENT_BLUR_TEXTURE_TRANSFORM(_++):this.STATEMENT_BLUR_TEXTURE(),$="inner"===n,u=_;let d,g,f=4*_;switch(o?d=r?this.STATEMENT_GLOW(!1,i,h,o,u,f):this.STATEMENT_BEVEL(i,s,h,o,u,f):r?(f+=4,d=this.STATEMENT_GLOW($,i,h,o,u,f)):(f+=8,d=this.STATEMENT_BEVEL(i,s,h,o,u,f)),n){case"outer":g=a?"blur - blur * base.a":"base + blur - blur * base.a";break;case"full":g=a?"blur":"base - base * blur.a + blur";break;default:g="blur"}return`#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_textures[${t}];\\nuniform vec4 u_mediump[${e}];\\n\\nin vec2 v_coord;\\nout vec4 o_color;\\n\\n${Pt.FUNCTION_IS_INSIDE()}\\n\\nvoid main() {\\n    ${l}\\n    ${c}\\n    ${d}\\n    o_color = ${g};\\n}\\n\\n`}static STATEMENT_BASE_TEXTURE_TRANSFORM(t){return`\\n    vec2 base_scale  = u_mediump[${t}].xy;\\n    vec2 base_offset = u_mediump[${t}].zw;\\n\\n    vec2 uv = v_coord * base_scale - base_offset;\\n    vec4 base = mix(vec4(0.0), texture(u_textures[1], uv), isInside(uv));\\n`}static STATEMENT_BLUR_TEXTURE(){return"\\n    vec4 blur = texture(u_textures[0], v_coord);\\n"}static STATEMENT_BLUR_TEXTURE_TRANSFORM(t){return`\\n    vec2 blur_scale  = u_mediump[${t}].xy;\\n    vec2 blur_offset = u_mediump[${t}].zw;\\n\\n    vec2 st = v_coord * blur_scale - blur_offset;\\n    vec4 blur = mix(vec4(0.0), texture(u_textures[0], st), isInside(st));\\n`}static STATEMENT_GLOW(t,e,i,s,r,n){return`\\n    ${t?"blur.a = 1.0 - blur.a;":""}\\n    ${i?this.STATEMENT_GLOW_STRENGTH(n):""}\\n    ${s?this.STATEMENT_GLOW_GRADIENT_COLOR(e):this.STATEMENT_GLOW_SOLID_COLOR(r)}\\n`}static STATEMENT_GLOW_STRENGTH(t){return`\\n    float strength = u_mediump[${r.floor(t/4)}][${t%4}];\\n    blur.a = clamp(blur.a * strength, 0.0, 1.0);\\n`}static STATEMENT_GLOW_SOLID_COLOR(t){return`\\n    vec4 color = u_mediump[${t}];\\n    blur = color * blur.a;\\n`}static STATEMENT_GLOW_GRADIENT_COLOR(t){return`\\n    blur = texture(u_textures[${t?2:1}], vec2(blur.a, 0.5));\\n`}static STATEMENT_BEVEL(t,e,i,s,r,n){return`\\n    ${e?this.STATEMENT_BLUR_TEXTURE_TRANSFORM_2():this.STATEMENT_BLUR_TEXTURE_2()}\\n    float highlight_alpha = blur.a - blur2.a;\\n    float shadow_alpha    = blur2.a - blur.a;\\n    ${i?this.STATEMENT_BEVEL_STRENGTH(n):""}\\n    highlight_alpha = clamp(highlight_alpha, 0.0, 1.0);\\n    shadow_alpha    = clamp(shadow_alpha, 0.0, 1.0);\\n    ${s?this.STATEMENT_BEVEL_GRADIENT_COLOR(t):this.STATEMENT_BEVEL_SOLID_COLOR(r)}\\n`}static STATEMENT_BLUR_TEXTURE_2(){return"\\n    vec4 blur2 = texture(u_textures[0], 1.0 - v_coord);\\n"}static STATEMENT_BLUR_TEXTURE_TRANSFORM_2(){return"\\n    vec2 pq = (1.0 - v_coord) * blur_scale - blur_offset;\\n    vec4 blur2 = mix(vec4(0.0), texture(u_textures[0], pq), isInside(pq));\\n"}static STATEMENT_BEVEL_STRENGTH(t){return`\\n    float strength = u_mediump[${r.floor(t/4)}][${t%4}];\\n    highlight_alpha *= strength;\\n    shadow_alpha    *= strength;\\n`}static STATEMENT_BEVEL_SOLID_COLOR(t){return`\\n    vec4 highlight_color = u_mediump[${t}];\\n    vec4 shadow_color    = u_mediump[${t+1}];\\n    blur = highlight_color * highlight_alpha + shadow_color * shadow_alpha;\\n`}static STATEMENT_BEVEL_GRADIENT_COLOR(t){return`\\n    blur = texture(u_textures[${t?2:1}], vec2(\\n        0.5019607843137255 - 0.5019607843137255 * shadow_alpha + 0.4980392156862745 * highlight_alpha,\\n        0.5\\n    ));\\n`}}class Yt{static TEMPLATE(t){const e=t.toFixed(1);return`#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_texture;\\nuniform vec4 u_mediump;\\n\\nin vec2 v_coord;\\nout vec4 o_color;\\n\\nvoid main() {\\n    vec2  offset   = u_mediump.xy;\\n    float fraction = u_mediump.z;\\n    float samples  = u_mediump.w;\\n    \\n    vec4 color = texture(u_texture, v_coord);\\n\\n    for (float i = 1.0; i < ${e}; i += 1.0) {\\n        color += texture(u_texture, v_coord + offset * i);\\n        color += texture(u_texture, v_coord - offset * i);\\n    }\\n    color += texture(u_texture, v_coord + offset * ${e}) * fraction;\\n    color += texture(u_texture, v_coord - offset * ${e}) * fraction;\\n    color /= samples;\\n\\n    o_color = color;\\n}\\n\\n`}}class zt{static TEMPLATE(){return"#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_texture;\\nuniform vec4 u_mediump[5];\\n\\nin vec2 v_coord;\\nout vec4 o_color;\\n\\nvoid main() {\\n    mat4 mul = mat4(u_mediump[0], u_mediump[1], u_mediump[2], u_mediump[3]);\\n    vec4 add = u_mediump[4];\\n    \\n    vec4 color = texture(u_texture, v_coord);\\n\\n    color.rgb /= max(0.0001, color.a);\\n    color = clamp(color * mul + add, 0.0, 1.0);\\n    color.rgb *= color.a;\\n\\n    o_color = color;\\n}\\n\\n"}}class Gt{static TEMPLATE(t,e,i,s,n){const a=r.floor(.5*e),h=r.floor(.5*i),o=e*i;let _="";const l=n?1:2;for(let t=0;t<o;++t)_+=`\\n    result += getWeightedColor(${t}, u_mediump[${l+r.floor(t/4)}][${t%4}]);\\n`;const c=s?"result.a = texture(u_texture, v_coord).a;":"",$=n?"":"\\n    vec4 substitute_color = u_mediump[1];\\n    color = mix(substitute_color, color, isInside(uv));\\n";return`#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_texture;\\nuniform vec4 u_mediump[${t}];\\n\\nin vec2 v_coord;\\nout vec4 o_color;\\n\\n${Pt.FUNCTION_IS_INSIDE()}\\n\\nvec4 getWeightedColor (in int i, in float weight) {\\n    vec2 rcp_size = u_mediump[0].xy;\\n\\n    int i_div_x = i / ${e};\\n    int i_mod_x = i - ${e} * i_div_x;\\n    vec2 offset = vec2(i_mod_x - ${a}, ${h} - i_div_x);\\n    vec2 uv = v_coord + offset * rcp_size;\\n\\n    vec4 color = texture(u_texture, uv);\\n    color.rgb /= max(0.0001, color.a);\\n    ${$}\\n\\n    return color * weight;\\n}\\n\\nvoid main() {\\n    float rcp_divisor = u_mediump[0].z;\\n    float bias        = u_mediump[0].w;\\n\\n    vec4 result = vec4(0.0);\\n    ${_}\\n    result = clamp(result * rcp_divisor + bias, 0.0, 1.0);\\n    ${c}\\n\\n    result.rgb *= result.a;\\n    o_color = result;\\n}\\n\\n`}}class Ht{static TEMPLATE(t,e,i,s){let r,n,a;switch(e){case 1:r="map_color.r";break;case 2:r="map_color.g";break;case 4:r="map_color.b";break;case 8:r="map_color.a";break;default:r="0.5"}switch(i){case 1:n="map_color.r";break;case 2:n="map_color.g";break;case 4:n="map_color.b";break;case 8:n="map_color.a";break;default:n="0.5"}switch(s){case"clamp":a="\\n    vec4 source_color = texture(u_textures[0], uv);\\n";break;case"ignore":a="\\n    vec4 source_color =texture(u_textures[0], mix(v_coord, uv, step(abs(uv - vec2(0.5)), vec2(0.5))));\\n";break;case"color":a="\\n    vec4 substitute_color = u_mediump[2];\\n    vec4 source_color = mix(substitute_color, texture(u_textures[0], uv), isInside(uv));\\n";break;default:a="\\n    vec4 source_color = texture(u_textures[0], fract(uv));\\n"}return`#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_textures[2];\\nuniform vec4 u_mediump[${t}];\\n\\nin vec2 v_coord;\\nout vec4 o_color;\\n\\n${Pt.FUNCTION_IS_INSIDE()}\\n\\nvoid main() {\\n    vec2 uv_to_st_scale  = u_mediump[0].xy;\\n    vec2 uv_to_st_offset = u_mediump[0].zw;\\n    vec2 scale           = u_mediump[1].xy;\\n\\n    vec2 st = v_coord * uv_to_st_scale - uv_to_st_offset;\\n    vec4 map_color = texture(u_textures[1], st);\\n\\n    vec2 offset = vec2(${r}, ${n}) - 0.5;\\n    vec2 uv = v_coord + offset * scale;\\n    ${a}\\n\\n    o_color = mix(texture(u_textures[0], v_coord), source_color, isInside(st));\\n}\\n\\n`}}class Wt{constructor(t,e){this._$context=t,this._$gl=e,this._$collection=V()}getBlurFilterShader(t){const e=`b${t}`;if(this._$collection.has(e)){const t=this._$collection.get(e);if(t)return t}const i=new Bt(this._$gl,this._$context,Ut.TEXTURE(),Yt.TEMPLATE(t));return this._$collection.set(e,i),i}getBitmapFilterShader(t,e,i,s,n,a,h){const o=`f${t?"y":"n"}${e?"y":"n"}${i?"y":"n"}${s}${n?"y":"n"}${a?"y":"n"}`;if(this._$collection.has(o)){const t=this._$collection.get(o);if(t)return t}let _=1;t&&_++,h&&_++;let l=(t?4:0)+(e?4:0)+(a?1:0);h||(l+=i?4:8),l=r.ceil(l/4);const c=new Bt(this._$gl,this._$context,Ut.TEXTURE(),Vt.TEMPLATE(_,l,t,e,i,s,n,a,h));return this._$collection.set(o,c),c}getColorMatrixFilterShader(){if(this._$collection.has("m")){const t=this._$collection.get("m");if(t)return t}const t=new Bt(this._$gl,this._$context,Ut.TEXTURE(),zt.TEMPLATE());return this._$collection.set("m",t),t}getConvolutionFilterShader(t,e,i,s){const n=`c${("0"+t).slice(-2)}${("0"+e).slice(-2)}${i?"y":"n"}${s?"y":"n"}`;if(this._$collection.has(n)){const t=this._$collection.get(n);if(t)return t}const a=(s?1:2)+r.ceil(t*e/4),h=new Bt(this._$gl,this._$context,Ut.TEXTURE(),Gt.TEMPLATE(a,t,e,i,s));return this._$collection.set(n,h),h}getDisplacementMapFilterShader(t,e,i){const s=`d${t}${e}${i}`;if(this._$collection.has(s)){const t=this._$collection.get(s);if(t)return t}const r="color"===i?3:2,n=new Bt(this._$gl,this._$context,Ut.TEXTURE(),Ht.TEMPLATE(r,t,e,i));return this._$collection.set(s,n),n}setBlurFilterUniform(t,e,i,s,r,n){const a=t.mediump;s?(a[0]=1/e,a[1]=0):(a[0]=0,a[1]=1/i),a[2]=r,a[3]=n}setBitmapFilterUniform(t,e,i,s,r,n,a,h,o,_,l,c,$,u,d,g,f,m,p,x,b,v,T,A,M){let y;v?(y=t.textures,y[0]=0,y[1]=1,M&&(y[2]=2)):M&&(y=t.textures,y[0]=0,y[1]=2);const E=t.mediump;let C=0;v&&(E[C]=e/s,E[C+1]=i/r,E[C+2]=n/s,E[C+3]=(i-r-a)/r,C+=4),T&&(E[C]=e/h,E[C+1]=i/o,E[C+2]=_/h,E[C+3]=(i-o-l)/o,C+=4),M||(c?(E[C]=u,E[C+1]=d,E[C+2]=g,E[C+3]=f,C+=4):(E[C]=u,E[C+1]=d,E[C+2]=g,E[C+3]=f,E[C+4]=m,E[C+5]=p,E[C+6]=x,E[C+7]=b,C+=8)),A&&(E[C]=$)}setColorMatrixFilterUniform(t,e){const i=t.mediump;i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[5],i[5]=e[6],i[6]=e[7],i[7]=e[8],i[8]=e[10],i[9]=e[11],i[10]=e[12],i[11]=e[13],i[12]=e[15],i[13]=e[16],i[14]=e[17],i[15]=e[18],i[16]=e[4]/255,i[17]=e[9]/255,i[18]=e[14]/255,i[19]=e[19]/255}setConvolutionFilterUniform(t,e,i,s,r,n,a,h,o,_,l){const c=t.mediump;c[0]=1/e,c[1]=1/i,c[2]=1/r,c[3]=n/255;let $=4;a||(c[$]=h,c[$+1]=o,c[$+2]=_,c[$+3]=l,$+=4);const u=s.length;for(let t=0;t<u;t++)c[$++]=s[t]}setDisplacementMapFilterUniform(t,e,i,s,r,n,a,h,o,_,l,c,$,u){const d=t.textures;d[0]=0,d[1]=1;const g=t.mediump;g[0]=s/e,g[1]=r/i,g[2]=n/e,g[3]=(r-i-a)/i,g[4]=h/s,g[5]=-o/r,"color"===_&&(g[8]=l,g[9]=c,g[10]=$,g[11]=u)}}class qt{static TEMPLATE(t){return`#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_texture;\\n${t?"uniform vec4 u_mediump[2];":""}\\n\\nin vec2 v_coord;\\nout vec4 o_color;\\n\\nvoid main() {\\n    vec4 src = texture(u_texture, v_coord);\\n    ${t?Pt.STATEMENT_COLOR_TRANSFORM_ON(0):""}\\n    o_color = src;\\n}\\n\\n`}static INSTANCE_TEMPLATE(){return"#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_texture;\\n\\nin vec4 mul;\\nin vec4 add;\\nin vec2 v_coord;\\nout vec4 o_color;\\n\\nvoid main() {\\n    vec4 src = texture(u_texture, v_coord);\\n\\n    if (mul.x != 1.0 || mul.y != 1.0 || mul.z != 1.0 || mul.w != 1.0\\n        || add.x != 0.0 || add.y != 0.0 || add.z != 0.0 || add.w != 0.0\\n    ) {\\n        src.rgb /= max(0.0001, src.a);\\n        src = clamp(src * mul + add, 0.0, 1.0);\\n        src.rgb *= src.a;\\n    }\\n    \\n    o_color = src;\\n}\\n\\n"}}class jt{static TEMPLATE(t,e){let i;switch(t){case"subtract":i=this.FUNCTION_SUBTRACT();break;case"multiply":i=this.FUNCTION_MULTIPLY();break;case"lighten":i=this.FUNCTION_LIGHTEN();break;case"darken":i=this.FUNCTION_DARKEN();break;case"overlay":i=this.FUNCTION_OVERLAY();break;case"hardlight":i=this.FUNCTION_HARDLIGHT();break;case"difference":i=this.FUNCTION_DIFFERENCE();break;case"invert":i=this.FUNCTION_INVERT();break;default:i=this.FUNCTION_NORMAL()}return`#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_textures[2];\\n${e?"uniform vec4 u_mediump[2];":""}\\n\\nin vec2 v_coord;\\nout vec4 o_color;\\n\\n${i}\\n\\nvoid main() {\\n    vec4 dst = texture(u_textures[0], v_coord);\\n    vec4 src = texture(u_textures[1], v_coord);\\n    ${e?Pt.STATEMENT_COLOR_TRANSFORM_ON(0):""}\\n    o_color = blend(src, dst);\\n}\\n\\n`}static INSTANCE_TEMPLATE(t,e){let i;switch(t){case"subtract":i=this.FUNCTION_SUBTRACT();break;case"multiply":i=this.FUNCTION_MULTIPLY();break;case"lighten":i=this.FUNCTION_LIGHTEN();break;case"darken":i=this.FUNCTION_DARKEN();break;case"overlay":i=this.FUNCTION_OVERLAY();break;case"hardlight":i=this.FUNCTION_HARDLIGHT();break;case"difference":i=this.FUNCTION_DIFFERENCE();break;case"invert":i=this.FUNCTION_INVERT();break;default:i=this.FUNCTION_NORMAL()}return`#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D u_textures[2];\\n${e?"uniform vec4 u_mediump[2];":""}\\n\\nin vec2 v_src_coord;\\nin vec2 v_dst_coord;\\nout vec4 o_color;\\n\\n${i}\\n\\nvoid main() {\\n    vec4 dst = texture(u_textures[0], v_dst_coord);\\n    vec4 src = texture(u_textures[1], v_src_coord);\\n    ${e?Pt.STATEMENT_COLOR_TRANSFORM_ON(0):""}\\n    o_color = blend(src, dst);\\n}\\n\\n`}static FUNCTION_NORMAL(){return"\\n\\nvec4 blend (in vec4 src, in vec4 dst) {\\n    return src + dst - dst * src.a;\\n}\\n\\n"}static FUNCTION_SUBTRACT(){return"\\n\\nvec4 blend (in vec4 src, in vec4 dst) {\\n    if (src.a == 0.0) { return dst; }\\n    if (dst.a == 0.0) { return src; }\\n\\n    vec4 a = src - src * dst.a;\\n    vec4 b = dst - dst * src.a;\\n\\n    src.rgb /= src.a;\\n    dst.rgb /= dst.a;\\n\\n    vec4 c = vec4(dst.rgb - src.rgb, src.a * dst.a);\\n    c.rgb *= c.a;\\n\\n    return a + b + c;\\n}\\n\\n"}static FUNCTION_MULTIPLY(){return"\\n\\nvec4 blend (in vec4 src, in vec4 dst) {\\n    vec4 a = src - src * dst.a;\\n    vec4 b = dst - dst * src.a;\\n    vec4 c = src * dst;\\n\\n    return a + b + c;\\n}\\n\\n"}static FUNCTION_LIGHTEN(){return"\\n\\nvec4 blend (in vec4 src, in vec4 dst) {\\n    if (src.a == 0.0) { return dst; }\\n    if (dst.a == 0.0) { return src; }\\n\\n    vec4 a = src - src * dst.a;\\n    vec4 b = dst - dst * src.a;\\n\\n    src.rgb /= src.a;\\n    dst.rgb /= dst.a;\\n\\n    vec4 c = vec4(mix(src.rgb, dst.rgb, step(src.rgb, dst.rgb)), src.a * dst.a);\\n    c.rgb *= c.a;\\n\\n    return a + b + c;\\n}\\n\\n"}static FUNCTION_DARKEN(){return"\\n\\nvec4 blend (in vec4 src, in vec4 dst) {\\n    if (src.a == 0.0) { return dst; }\\n    if (dst.a == 0.0) { return src; }\\n\\n    vec4 a = src - src * dst.a;\\n    vec4 b = dst - dst * src.a;\\n\\n    src.rgb /= src.a;\\n    dst.rgb /= dst.a;\\n\\n    vec4 c = vec4(mix(src.rgb, dst.rgb, step(dst.rgb, src.rgb)), src.a * dst.a);\\n    c.rgb *= c.a;\\n\\n    return a + b + c;\\n}\\n\\n"}static FUNCTION_OVERLAY(){return"\\n\\nvec4 blend (in vec4 src, in vec4 dst) {\\n    if (src.a == 0.0) { return dst; }\\n    if (dst.a == 0.0) { return src; }\\n\\n    vec4 a = src - src * dst.a;\\n    vec4 b = dst - dst * src.a;\\n\\n    src.rgb /= src.a;\\n    dst.rgb /= dst.a;\\n\\n    vec4 mul = src * dst;\\n    vec3 c1 = 2.0 * mul.rgb;\\n    vec3 c2 = 2.0 * (src.rgb + dst.rgb - mul.rgb) - 1.0;\\n    vec4 c = vec4(mix(c1, c2, step(vec3(0.5), dst.rgb)), mul.a);\\n    c.rgb *= c.a;\\n\\n    return a + b + c;\\n}\\n\\n"}static FUNCTION_HARDLIGHT(){return"\\n\\nvec4 blend (in vec4 src, in vec4 dst) {\\n    if (src.a == 0.0) { return dst; }\\n    if (dst.a == 0.0) { return src; }\\n\\n    vec4 a = src - src * dst.a;\\n    vec4 b = dst - dst * src.a;\\n\\n    src.rgb /= src.a;\\n    dst.rgb /= dst.a;\\n\\n    vec4 mul = src * dst;\\n    vec3 c1 = 2.0 * mul.rgb;\\n    vec3 c2 = 2.0 * (src.rgb + dst.rgb - mul.rgb) - 1.0;\\n    vec4 c = vec4(mix(c1, c2, step(vec3(0.5), src.rgb)), mul.a);\\n    c.rgb *= c.a;\\n\\n    return a + b + c;\\n}\\n\\n"}static FUNCTION_DIFFERENCE(){return"\\n\\nvec4 blend (in vec4 src, in vec4 dst) {\\n    if (src.a == 0.0) { return dst; }\\n    if (dst.a == 0.0) { return src; }\\n\\n    vec4 a = src - src * dst.a;\\n    vec4 b = dst - dst * src.a;\\n\\n    src.rgb /= src.a;\\n    dst.rgb /= dst.a;\\n\\n    vec4 c = vec4(abs(src.rgb - dst.rgb), src.a * dst.a);\\n    c.rgb *= c.a;\\n\\n    return a + b + c;\\n}\\n\\n"}static FUNCTION_INVERT(){return"\\n\\nvec4 blend (in vec4 src, in vec4 dst) {\\n    if (src.a == 0.0) { return dst; }\\n    if (dst.a == 0.0) { return src; }\\n\\n    vec4 b = dst - dst * src.a;\\n    vec4 c = vec4(src.a - dst.rgb * src.a, src.a);\\n\\n    return b + c;\\n}\\n\\n"}}class Kt{constructor(t,e){this._$context=t,this._$gl=e,this._$collection=V()}getInstanceShader(){if(this._$collection.has("i")){const t=this._$collection.get("i");if(t)return t}const t=new Bt(this._$gl,this._$context,Ut.INSTANCE(),qt.INSTANCE_TEMPLATE());return this._$collection.set("i",t),t}getNormalBlendShader(t){const e="n"+(t?"y":"n");if(this._$collection.has(e)){const t=this._$collection.get(e);if(t)return t}const i=new Bt(this._$gl,this._$context,Ut.BLEND(),qt.TEMPLATE(t));return this._$collection.set(e,i),i}getClipShader(){if(this._$collection.has("c")){const t=this._$collection.get("c");if(t)return t}const t=new Bt(this._$gl,this._$context,Ut.BLEND_CLIP(),qt.TEMPLATE(!1));return this._$collection.set("c",t),t}getBlendShader(t,e){const i=`${t}${e?"y":"n"}`;if(this._$collection.has(i)){const t=this._$collection.get(i);if(t)return t}const s=new Bt(this._$gl,this._$context,Ut.BLEND(),jt.TEMPLATE(t,e));return this._$collection.set(i,s),s}getInstanceBlendShader(t,e){const i=`i${t}${e?"y":"n"}`;if(this._$collection.has(i)){const t=this._$collection.get(i);if(t)return t}const s=new Bt(this._$gl,this._$context,Ut.INSTANCE_BLEND(),jt.INSTANCE_TEMPLATE(t,e));return this._$collection.set(i,s),s}setNormalBlendUniform(t,e,i,s,r,n,a,h,o,_,l,c,$,u,d,g,f){const m=t.highp;if(m[0]=e,m[1]=i,m[2]=s,m[3]=r,m[4]=n[0],m[5]=n[1],m[6]=n[2],m[8]=n[3],m[9]=n[4],m[10]=n[5],m[12]=n[6],m[13]=n[7],m[14]=n[8],m[7]=a,m[11]=h,o){const e=t.mediump;e[0]=_,e[1]=l,e[2]=c,e[3]=$,e[4]=u,e[5]=d,e[6]=g,e[7]=f}}pushNormalBlend(t,e,i,s,r,n,a,h,o=1,_=1,l=1,c=1,$=0,u=0,d=0,g=0){t.attributes.push(e/bt,i/bt,s/bt,r/bt,s,r,a,h,n[6],n[7],n[0],n[1],n[3],n[4],o,_,l,c,$,u,d,g),t.count++}setClipUniform(t,e,i,s,r,n,a,h){const o=t.highp;o[0]=e,o[1]=i,o[2]=s,o[3]=r,o[4]=n[0],o[5]=n[1],o[6]=n[2],o[8]=n[3],o[9]=n[4],o[10]=n[5],o[12]=n[6],o[13]=n[7],o[14]=n[8],o[7]=a,o[11]=h}setInstanceBlendUniform(t,e,i,s,r,n,a,h,o,_,l,c,$,u,d,g,f,m,p){const x=t.textures;x[0]=0,x[1]=1;const b=t.highp;if(b[0]=e,b[1]=i,b[2]=s,b[3]=r,b[4]=h[0],b[5]=h[1],b[6]=h[2],b[8]=h[3],b[9]=h[4],b[10]=h[5],b[12]=h[6],b[13]=h[7],b[14]=h[8],b[7]=o,b[11]=_,b[16]=n,b[17]=a,l){const e=t.mediump;e[0]=c,e[1]=$,e[2]=u,e[3]=d,e[4]=g,e[5]=f,e[6]=m,e[7]=p}}setBlendUniform(t,e,i,s,r,n,a,h,o,_,l,c,$,u,d,g,f){const m=t.textures;m[0]=0,m[1]=1;const p=t.highp;if(p[0]=e,p[1]=i,p[2]=s,p[3]=r,p[4]=n[0],p[5]=n[1],p[6]=n[2],p[8]=n[3],p[9]=n[4],p[10]=n[5],p[12]=n[6],p[13]=n[7],p[14]=n[8],p[7]=a,p[11]=h,o){const e=t.mediump;e[0]=_,e[1]=l,e[2]=c,e[3]=$,e[4]=u,e[5]=d,e[6]=g,e[7]=f}}}class Qt{constructor(t,e){this._$currentProgramId=-1,this._$shapeShaderVariants=new kt(t,e),this._$gradientShapeShaderVariants=new Ot(t,e),this._$gradientLUTShaderVariants=new Xt(t,e),this._$filterShaderVariants=new Wt(t,e),this._$blendShaderVariants=new Kt(t,e)}get currentProgramId(){return this._$currentProgramId}set currentProgramId(t){this._$currentProgramId=t}get shapeShaderVariants(){return this._$shapeShaderVariants}get gradientShapeShaderVariants(){return this._$gradientShapeShaderVariants}get gradientLUTShaderVariants(){return this._$gradientLUTShaderVariants}get filterShaderVariants(){return this._$filterShaderVariants}get blendShaderVariants(){return this._$blendShaderVariants}}class Jt{constructor(t,e){this._$context=t,this._$gl=e,this._$attachment=t.frameBuffer.createTextureAttachment(512,1),this._$maxLength=r.floor(.75*e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS)),this._$rgbToLinearTable=new Float32Array(256),this._$rgbIdentityTable=new Float32Array(256);for(let t=0;t<256;t++){const e=t/255;this._$rgbToLinearTable[t]=r.pow(e,2.23333333),this._$rgbIdentityTable[t]=e}}generateForShape(t,e){const i=this._$context.frameBuffer.currentAttachment,s=this._$context.cachePosition;s&&this._$gl.disable(this._$gl.SCISSOR_TEST),this._$context._$bind(this._$attachment);const n=t.length,a=this._$context.shaderList.gradientLUTShaderVariants,h=e?this._$rgbToLinearTable:this._$rgbIdentityTable;this._$context.blend.toOneZero();for(let i=0;i<n;i+=this._$maxLength-1){const s=r.min(i+this._$maxLength,n),o=a.getGradientLUTShader(s-i,e),_=o.uniform;a.setGradientLUTUniformForShape(_,t,i,s,h),o._$drawGradient(0===i?0:t[i][0],s===n?1:t[s-1][0])}if(this._$context._$bind(i),!this._$attachment.texture)throw new Error("the texture is null.");return s&&this._$context.bindRenderBuffer(s),this._$attachment.texture}generateForFilter(t,e,i){const s=this._$context.frameBuffer.currentAttachment;this._$context._$bind(this._$attachment);const n=t.length,a=this._$context.shaderList.gradientLUTShaderVariants;this._$context.blend.toOneZero();for(let s=0;s<n;s+=this._$maxLength-1){const h=r.min(s+this._$maxLength,n),o=a.getGradientLUTShader(h-s,!1),_=o.uniform;a.setGradientLUTUniformForFilter(_,t,e,i,s,h),o._$drawGradient(0===s?0:t[s],h===n?1:t[h-1])}if(this._$context._$bind(s),!this._$attachment.texture)throw new Error("the texture is null.");return this._$attachment.texture}}class Zt{static get indexRangePool(){return this._$indexRangePool}static generate(t){let e=0;for(let i=0;i<t.length;++i)e+=12*(t[i].length/3-2);this._$vertexBufferData=new o(e),this._$indexRanges=U(),this._$currentIndex=0;for(let e=0;e<t.length;++e){const i=this._$currentIndex;this._$generateMesh(t[e]);const s=this._$currentIndex-i,r=this._$indexRangePool.pop()||{first:0,count:0};r.first=i,r.count=s,this._$indexRanges.push(r)}return{vertexBufferData:this._$vertexBufferData,indexRanges:this._$indexRanges}}static _$generateMesh(t){const e=this._$vertexBufferData;let i=this._$currentIndex;const s=t.length-5;for(let r=3;r<s;r+=3){let s=4*i;t[r+2]?(e[s++]=t[r-3],e[s++]=t[r-2],e[s++]=0,e[s++]=0,e[s++]=t[r],e[s++]=t[r+1],e[s++]=.5,e[s++]=0,e[s++]=t[r+3],e[s++]=t[r+4],e[s++]=1,e[s++]=1):t[r+5]?(e[s++]=t[0],e[s++]=t[1],e[s++]=.5,e[s++]=.5,e[s++]=t[r],e[s++]=t[r+1],e[s++]=.5,e[s++]=.5,e[s++]=t[r+6],e[s++]=t[r+7],e[s++]=.5,e[s++]=.5):(e[s++]=t[0],e[s++]=t[1],e[s++]=.5,e[s++]=.5,e[s++]=t[r],e[s++]=t[r+1],e[s++]=.5,e[s++]=.5,e[s++]=t[r+3],e[s++]=t[r+4],e[s++]=.5,e[s++]=.5),i+=3}this._$currentIndex=i}}Zt._$indexRangePool=U();class te{static generate(t,e,i){this._$vertexBufferData=this._$vertexBufferData||new o(1024),this._$vertexBufferPos=0,this._$indexBufferData=this._$indexBufferData||new Int16Array(256),this._$indexBufferPos=0,this._$lineCap=e,this._$lineJoin=i;for(let e=0;e<t.length;e++){const i=this._$vertexBufferPos;this._$generateLineSegment(t[e]);const s=this._$vertexBufferPos;this._$generateLineJoin(i,s),this._$generateLineCap(i,s)}return{vertexBufferData:this._$vertexBufferData.slice(0,this._$vertexBufferPos),indexBufferData:this._$indexBufferData.slice(0,this._$indexBufferPos)}}static _$expandVertexBufferIfNeeded(t){if(this._$vertexBufferPos+t>this._$vertexBufferData.length){const t=new o(2*this._$vertexBufferData.length);t.set(this._$vertexBufferData),this._$vertexBufferData=t}}static _$expandIndexBufferIfNeeded(t){if(this._$indexBufferPos+t>this._$indexBufferData.length){const t=new l(2*this._$indexBufferData.length);t.set(this._$indexBufferData),this._$indexBufferData=t}}static _$generateLineSegment(t){const e=t.length-5;for(let i=0;i<e;i+=3)t[i+2]||(t[i+5]?this._$addQuadSegmentMesh(t[i],t[i+1],t[i+3],t[i+4],t[i+6],t[i+7]):this._$addLineSegmentMesh(t[i],t[i+1],t[i+3],t[i+4]))}static _$addQuadSegmentMesh(t,e,i,s,r,n){let a=t,h=e;for(let o=1;o<11;o++){const _=o/11,l=1-_,c=(t*l+i*_)*l+(i*l+r*_)*_,$=(e*l+s*_)*l+(s*l+n*_)*_;this._$addLineSegmentMesh(a,h,c,$,2),a=c,h=$}this._$addLineSegmentMesh(a,h,r,n)}static _$addLineSegmentMesh(t,e,i,s,r=1){const n=this._$vertexBufferPos/7,a=n+1,h=n+2,o=n+3;this._$expandIndexBufferIfNeeded(6);const _=this._$indexBufferData;let l=this._$indexBufferPos;_[l++]=n,_[l++]=a,_[l++]=o,_[l++]=o,_[l++]=h,_[l++]=n,this._$indexBufferPos=l,this._$expandVertexBufferIfNeeded(28);const c=this._$vertexBufferData;let $=this._$vertexBufferPos;c[$++]=t,c[$++]=e,c[$++]=i,c[$++]=s,c[$++]=1,c[$++]=1,c[$++]=1,c[$++]=t,c[$++]=e,c[$++]=i,c[$++]=s,c[$++]=-1,c[$++]=-1,c[$++]=1,c[$++]=i,c[$++]=s,c[$++]=t,c[$++]=e,c[$++]=-1,c[$++]=-1,c[$++]=r,c[$++]=i,c[$++]=s,c[$++]=t,c[$++]=e,c[$++]=1,c[$++]=1,c[$++]=r,this._$vertexBufferPos=$}static _$generateLineJoin(t,e){const i=this._$vertexBufferData,s=e-55;for(let e=t;e<s;e+=28){const t=e/7;this._$addLineJoinMesh(i[e],i[e+1],i[e+21],i[e+22],i[e+27],i[e+49],i[e+50],t+2,t+3,t+4,t+5)}}static _$addLineJoinMesh(t,e,i,s,n,a,h,o,_,l=0,c=0){const $=i-t,u=s-e,d=a-i,g=h-s,f=this._$cross($,u,d,g);if(!(r.abs(f)<1e-4))if(2!==n)switch(this._$lineJoin){case"round":this._$addRoundJoinMesh(i,s);break;case"miter":this._$addMiterJoinMesh(i,s,t,e,a,h,l,o,_,c);break;default:this._$addBevelJoinMesh(i,s,l,o,_,c)}else this._$addBevelJoinMesh(i,s,l,o,_,c)}static _$addRoundJoinMesh(t,e){const i=this._$vertexBufferPos/7;this._$expandIndexBufferIfNeeded(57);const s=this._$indexBufferData;let r=this._$indexBufferPos;for(let t=1;t<18;t++){const e=i+t;s[r++]=i,s[r++]=e,s[r++]=e+1}s[r++]=i,s[r++]=i+18,s[r++]=i+1,this._$indexBufferPos=r,this._$expandVertexBufferIfNeeded(133);const n=this._$vertexBufferData;let a=this._$vertexBufferPos;n[a++]=t,n[a++]=e,n[a++]=0,n[a++]=0,n[a++]=0,n[a++]=0,n[a++]=0;for(let i=0;i<18;i++)n[a++]=t,n[a++]=e,n[a++]=0,n[a++]=0,n[a++]=0,n[a++]=0,n[a++]=30+i;this._$vertexBufferPos=a}static _$addMiterJoinMesh(t,e,i,s,r,n,a,h,o,_){const l=this._$vertexBufferPos/7,c=l+1,$=l+2,u=l+3,d=l+4;this._$expandIndexBufferIfNeeded(18);const g=this._$indexBufferData;let f=this._$indexBufferPos;g[f++]=l,g[f++]=a,g[f++]=c,g[f++]=l,g[f++]=c,g[f++]=$,g[f++]=l,g[f++]=$,g[f++]=h,g[f++]=l,g[f++]=o,g[f++]=u,g[f++]=l,g[f++]=u,g[f++]=d,g[f++]=l,g[f++]=d,g[f++]=_,this._$indexBufferPos=f,this._$expandVertexBufferIfNeeded(35);const m=this._$vertexBufferData;let p=this._$vertexBufferPos;m[p++]=t,m[p++]=e,m[p++]=i,m[p++]=s,m[p++]=r,m[p++]=n,m[p++]=0,m[p++]=t,m[p++]=e,m[p++]=i,m[p++]=s,m[p++]=r,m[p++]=n,m[p++]=21,m[p++]=t,m[p++]=e,m[p++]=i,m[p++]=s,m[p++]=r,m[p++]=n,m[p++]=22,m[p++]=t,m[p++]=e,m[p++]=i,m[p++]=s,m[p++]=r,m[p++]=n,m[p++]=23,m[p++]=t,m[p++]=e,m[p++]=i,m[p++]=s,m[p++]=r,m[p++]=n,m[p++]=24,this._$vertexBufferPos=p}static _$addBevelJoinMesh(t,e,i,s,r,n){const a=this._$vertexBufferPos/7;this._$expandIndexBufferIfNeeded(6);const h=this._$indexBufferData;let o=this._$indexBufferPos;h[o++]=a,h[o++]=i,h[o++]=s,h[o++]=a,h[o++]=r,h[o++]=n,this._$indexBufferPos=o,this._$expandVertexBufferIfNeeded(7);const _=this._$vertexBufferData;let l=this._$vertexBufferPos;_[l++]=t,_[l++]=e,_[l++]=0,_[l++]=0,_[l++]=0,_[l++]=0,_[l++]=0,this._$vertexBufferPos=l}static _$generateLineCap(t,e){const i=this._$vertexBufferData,s=i[t],r=i[t+1],n=i[t+2],a=i[t+3],h=i[e-7],o=i[e-6],_=i[e-5],l=i[e-4],c=t/7,$=e/7;s!==h||r!==o?(this._$addLineCapMesh(s,r,n,a,c,c+1),this._$addLineCapMesh(h,o,_,l,$-1,$-2)):this._$addLineJoinMesh(_,l,s,r,n,a,$-2,$-1,c,c+1)}static _$addLineCapMesh(t,e,i,s,r,n){switch(this._$lineCap){case"round":this._$addRoundJoinMesh(t,e);break;case"square":this._$addSquareCapMesh(t,e,i,s,r,n)}}static _$addSquareCapMesh(t,e,i,s,r,n){const a=this._$vertexBufferPos/7,h=a+1;this._$expandIndexBufferIfNeeded(6);const o=this._$indexBufferData;let _=this._$indexBufferPos;o[_++]=r,o[_++]=a,o[_++]=h,o[_++]=h,o[_++]=n,o[_++]=r,this._$indexBufferPos=_,this._$expandVertexBufferIfNeeded(14);const l=this._$vertexBufferData;let c=this._$vertexBufferPos;l[c++]=t,l[c++]=e,l[c++]=i,l[c++]=s,l[c++]=-1,l[c++]=-1,l[c++]=10,l[c++]=t,l[c++]=e,l[c++]=i,l[c++]=s,l[c++]=1,l[c++]=1,l[c++]=10,this._$vertexBufferPos=c}}te._$cross=(t,e,i,s)=>t*s-i*e;class ee{constructor(t){this._$gl=t,this._$fillVertexArrayPool=[],this._$strokeVertexArrayPool=[],this._$boundVertexArray=null,this._$fillAttrib_vertex=0,this._$fillAttrib_bezier=1,this._$strokeAttrib_vertex=0,this._$strokeAttrib_option1=1,this._$strokeAttrib_option2=2,this._$strokeAttrib_type=3,this._$vertexBufferData=new Float32Array([0,0,0,1,1,0,1,1]),this._$attributeVertexBuffer=t.createBuffer(),this._$attributeBuffer=new Float32Array(22),this._$instanceVertexArray=this._$getCommonVertexArray(),this._$commonVertexArray=this._$getVertexArray(0,1)}_$getCommonVertexArray(){const t=this._$gl.createVertexArray();this.bind(t);const e=this._$gl.createBuffer();return this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,e),this._$gl.bufferData(this._$gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),this._$gl.STATIC_DRAW),this._$gl.enableVertexAttribArray(0),this._$gl.vertexAttribPointer(0,2,this._$gl.FLOAT,!1,0,0),this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,this._$attributeVertexBuffer),this._$gl.bufferData(this._$gl.ARRAY_BUFFER,this._$attributeBuffer.byteLength,this._$gl.DYNAMIC_DRAW),this._$gl.enableVertexAttribArray(1),this._$gl.vertexAttribPointer(1,4,this._$gl.FLOAT,!1,88,0),this._$gl.vertexAttribDivisor(1,1),this._$gl.enableVertexAttribArray(2),this._$gl.vertexAttribPointer(2,4,this._$gl.FLOAT,!1,88,16),this._$gl.vertexAttribDivisor(2,1),this._$gl.enableVertexAttribArray(3),this._$gl.vertexAttribPointer(3,2,this._$gl.FLOAT,!1,88,32),this._$gl.vertexAttribDivisor(3,1),this._$gl.enableVertexAttribArray(4),this._$gl.vertexAttribPointer(4,4,this._$gl.FLOAT,!1,88,40),this._$gl.vertexAttribDivisor(4,1),this._$gl.enableVertexAttribArray(5),this._$gl.vertexAttribPointer(5,4,this._$gl.FLOAT,!1,88,56),this._$gl.vertexAttribDivisor(5,1),this._$gl.enableVertexAttribArray(6),this._$gl.vertexAttribPointer(6,4,this._$gl.FLOAT,!1,88,72),this._$gl.vertexAttribDivisor(6,1),t}_$getVertexArray(t,e){const i=this._$gl.createVertexArray();this.bind(i);const s=this._$gl.createBuffer();return this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,s),this._$vertexBufferData[0]=t,this._$vertexBufferData[2]=t,this._$vertexBufferData[4]=e,this._$vertexBufferData[6]=e,this._$gl.bufferData(this._$gl.ARRAY_BUFFER,this._$vertexBufferData,this._$gl.STATIC_DRAW),this._$gl.enableVertexAttribArray(0),this._$gl.vertexAttribPointer(0,2,this._$gl.FLOAT,!1,0,0),i}_$getFillVertexArray(){if(this._$fillVertexArrayPool.length){const t=this._$fillVertexArrayPool.pop();if(t)return t}const t=this._$gl.createVertexArray();this.bind(t);const e=this._$gl.createBuffer();return t.vertexBuffer=e,t.vertexLength=0,this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,e),this._$gl.enableVertexAttribArray(0),this._$gl.enableVertexAttribArray(1),this._$gl.vertexAttribPointer(this._$fillAttrib_vertex,2,this._$gl.FLOAT,!1,16,0),this._$gl.vertexAttribPointer(this._$fillAttrib_bezier,2,this._$gl.FLOAT,!1,16,8),t}_$getStrokeVertexArray(){if(this._$strokeVertexArrayPool.length){const t=this._$strokeVertexArrayPool.pop();if(t)return t}const t=this._$gl.createVertexArray();this.bind(t);const e=this._$gl.createBuffer();t.vertexBuffer=e,t.vertexLength=0,this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,e);const i=this._$gl.createBuffer();return t.indexBuffer=i,t.indexLength=0,this._$gl.bindBuffer(this._$gl.ELEMENT_ARRAY_BUFFER,i),this._$gl.enableVertexAttribArray(0),this._$gl.enableVertexAttribArray(1),this._$gl.enableVertexAttribArray(2),this._$gl.enableVertexAttribArray(3),this._$gl.vertexAttribPointer(this._$strokeAttrib_vertex,2,this._$gl.FLOAT,!1,28,0),this._$gl.vertexAttribPointer(this._$strokeAttrib_option1,2,this._$gl.FLOAT,!1,28,8),this._$gl.vertexAttribPointer(this._$strokeAttrib_option2,2,this._$gl.FLOAT,!1,28,16),this._$gl.vertexAttribPointer(this._$strokeAttrib_type,1,this._$gl.FLOAT,!1,28,24),t}createFill(t){const e=Zt.generate(t),i=e.vertexBufferData,s=this._$getFillVertexArray();return s.indexRanges=e.indexRanges,this.bind(s),this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,s.vertexBuffer),s.vertexLength<i.length&&(s.vertexLength=Y(i.length),this._$gl.bufferData(this._$gl.ARRAY_BUFFER,4*s.vertexLength,this._$gl.DYNAMIC_DRAW)),this._$gl.bufferSubData(this._$gl.ARRAY_BUFFER,0,i),s}createStroke(t,e,i){const s=te.generate(t,e,i),r=s.vertexBufferData,n=s.indexBufferData,a=this._$getStrokeVertexArray();return a.indexCount=n.length,this.bind(a),this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,a.vertexBuffer),this._$gl.bindBuffer(this._$gl.ELEMENT_ARRAY_BUFFER,a.indexBuffer),a.vertexLength<r.length&&(a.vertexLength=Y(r.length),this._$gl.bufferData(this._$gl.ARRAY_BUFFER,4*a.vertexLength,this._$gl.DYNAMIC_DRAW)),a.indexLength<n.length&&(a.indexLength=Y(n.length),this._$gl.bufferData(this._$gl.ELEMENT_ARRAY_BUFFER,2*a.indexLength,this._$gl.DYNAMIC_DRAW)),this._$gl.bufferSubData(this._$gl.ARRAY_BUFFER,0,r),this._$gl.bufferSubData(this._$gl.ELEMENT_ARRAY_BUFFER,0,n),a}releaseFill(t){this._$fillVertexArrayPool.push(t)}releaseStroke(t){this._$strokeVertexArrayPool.push(t)}bind(t=null){t!==this._$boundVertexArray&&(this._$boundVertexArray=t,this._$gl.bindVertexArray(t))}bindInstnceArray(t){this.bind(this._$instanceVertexArray),this._$gl.bindBuffer(this._$gl.ARRAY_BUFFER,this._$attributeVertexBuffer),t.attributes.length>this._$attributeBuffer.length&&(this._$attributeBuffer=new Float32Array(t.attributes.length),this._$gl.bufferData(this._$gl.ARRAY_BUFFER,this._$attributeBuffer.byteLength,this._$gl.DYNAMIC_DRAW)),this._$attributeBuffer.set(t.attributes),this._$gl.bufferSubData(this._$gl.ARRAY_BUFFER,0,this._$attributeBuffer.subarray(0,t.attributes.length))}bindCommonVertexArray(){this.bind(this._$commonVertexArray)}bindGradientVertexArray(t,e){const i=this._$getVertexArray(t,e);this.bind(i)}}class ie{constructor(t,e){this._$context=t,this._$gl=e,this._$clips=[],this._$poolClip=[],this._$clipStatus=!1,this._$containerClip=!1,this._$currentClip=!1}get containerClip(){return this._$containerClip}set containerClip(t){this._$containerClip=t}_$onClear(t){t&&(this._$gl.enable(this._$gl.STENCIL_TEST),this._$currentClip=!0)}_$onBind(t){!t&&this._$currentClip?(this._$gl.disable(this._$gl.STENCIL_TEST),this._$currentClip=!1):t&&!this._$currentClip&&(this._$gl.enable(this._$gl.STENCIL_TEST),this._$currentClip=!0,this._$endClipDef())}_$onClearRect(){this._$gl.disable(this._$gl.STENCIL_TEST),this._$currentClip=!1}_$enterClip(){this._$currentClip||(this._$gl.enable(this._$gl.STENCIL_TEST),this._$currentClip=!0);const t=this._$context.frameBuffer.currentAttachment;if(!t)throw new Error("mask currentAttachment is null.");t.mask=!0,++t.clipLevel}_$beginClipDef(){const t=this._$context.frameBuffer.currentAttachment;if(!t)throw new Error("mask currentAttachment is null.");this._$gl.enable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.ALWAYS,0,255),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.INVERT,this._$gl.INVERT),this._$gl.stencilMask(1<<t.clipLevel-1),this._$gl.colorMask(!1,!1,!1,!1)}_$endClipDef(){const t=this._$context.frameBuffer.currentAttachment;if(!t)throw new Error("mask currentAttachment is null.");const e=t.clipLevel;let i=0;for(let t=0;t<e;++t)i|=(1<<e-t)-1;this._$gl.disable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.EQUAL,255&i,i),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.KEEP,this._$gl.KEEP),this._$gl.stencilMask(255),this._$gl.colorMask(!0,!0,!0,!0)}_$leaveClip(){const t=this._$context.frameBuffer.currentAttachment;if(!t)throw new Error("mask currentAttachment is null.");if(--t.clipLevel,t.mask=!!t.clipLevel,!t.clipLevel)return void this._$context._$clearRectStencil();const e=t.width,i=t.height,s=this._$context.path.createRectVertices(0,0,e,i),r=this._$context.vao.createFill(s);D(s.pop()),D(s);const n=this._$context.shaderList.shapeShaderVariants,a=n.getMaskShapeShader(!1,!1),h=a.uniform;n.setMaskShapeUniformIdentity(h,e,i);const o=r.indexRanges[0];this._$currentClip||(this._$currentClip=!0,this._$gl.enable(this._$gl.STENCIL_TEST)),this._$gl.enable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.ALWAYS,0,255),this._$gl.stencilOp(this._$gl.REPLACE,this._$gl.REPLACE,this._$gl.REPLACE),this._$gl.stencilMask(1<<t.clipLevel),this._$gl.colorMask(!1,!1,!1,!1),a._$containerClip(r,o.first,o.count);const _=r.indexRanges;for(let t=0;t<_.length;++t)Zt.indexRangePool.push(_[t]);D(r.indexRanges),this._$context.vao.releaseFill(r),this._$endClipDef()}_$drawContainerClip(){const t=this._$context.frameBuffer.currentAttachment;if(!t)throw new Error("mask currentAttachment is null.");const e=t.clipLevel,i=this._$context.shaderList.shapeShaderVariants,s=i.getMaskShapeShader(!1,!1),r=s.uniform;let n=e;const a=t.width,h=t.height;this._$gl.enable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.ALWAYS,0,255),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.INVERT,this._$gl.INVERT),this._$gl.colorMask(!1,!1,!1,!1);const o=this._$poolClip.length;for(let t=0;t<o;++t){const t=this._$poolClip.shift();if(!t)continue;i.setMaskShapeUniform(r,!1,t.matrixA,t.matrixB,t.matrixC,t.matrixD,t.matrixE,t.matrixF,t.matrixG,t.matrixH,t.matrixI,t.viewportWidth,t.viewportHeight,null);const o=t.vertexArrayObject.indexRanges;for(let e=0;e<o.length;++e){const i=o[e];this._$gl.stencilMask(1<<n-1),s._$containerClip(t.vertexArrayObject,i.first,i.count),Zt.indexRangePool.push(i)}D(o),this._$context.vao.releaseFill(t.vertexArrayObject),++n,n>7&&(this._$unionStencilMask(e,a,h),n=e)}n>e+1&&this._$unionStencilMask(e,a,h)}_$unionStencilMask(t,e,i){const s=this._$context.path.createRectVertices(0,0,e,i),r=this._$context.vao.createFill(s);D(s.pop()),D(s);const n=this._$context.shaderList.shapeShaderVariants,a=n.getMaskShapeShader(!1,!1),h=a.uniform;n.setMaskShapeUniformIdentity(h,e,i);const o=r.indexRanges[0];this._$gl.stencilFunc(this._$gl.LEQUAL,1<<t-1,255),this._$gl.stencilOp(this._$gl.ZERO,this._$gl.REPLACE,this._$gl.REPLACE),this._$gl.stencilMask(~((1<<t-1)-1)),a._$containerClip(r,o.first,o.count),this._$poolClip.length&&(this._$gl.stencilFunc(this._$gl.ALWAYS,0,255),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.INVERT,this._$gl.INVERT));const _=r.indexRanges;for(let t=0;t<_.length;++t)Zt.indexRangePool.push(_[t]);D(r.indexRanges),this._$context.vao.releaseFill(r)}_$onClip(t,e,i,s){return this._$clipStatus=!0,!!this._$containerClip&&(this._$poolClip.push({vertexArrayObject:t,matrixA:e[0],matrixB:e[1],matrixC:e[2],matrixD:e[3],matrixE:e[4],matrixF:e[5],matrixG:e[6],matrixH:e[7],matrixI:e[8],viewportWidth:i,viewportHeight:s}),!0)}_$onSave(){this._$clips.push(this._$clipStatus)}_$onRestore(){this._$clips.length&&(this._$clipStatus=!!this._$clips.pop())}}class se{constructor(t,e){this._$context=t,this._$gl=e,this._$enabled=!1,this._$funcCode=600,this._$currentOperation="normal",this._$currentIndex=-1,this._$currentSmoothing=null,this._$variants=t.shaderList.blendShaderVariants,this._$instanceShader=this._$variants.getInstanceShader(),this.enable()}enable(){this._$enabled||(this._$enabled=!0,this._$gl.enable(this._$gl.BLEND)),this.reset()}disable(){this._$enabled&&(this._$enabled=!1,this._$gl.disable(this._$gl.BLEND))}reset(){613!==this._$funcCode&&(this._$funcCode=613,this._$gl.blendFunc(this._$gl.ONE,this._$gl.ONE_MINUS_SRC_ALPHA))}toOneZero(){610!==this._$funcCode&&(this._$funcCode=610,this._$gl.blendFunc(this._$gl.ONE,this._$gl.ZERO))}toZeroOne(){601!==this._$funcCode&&(this._$funcCode=601,this._$gl.blendFuncSeparate(this._$gl.ZERO,this._$gl.ONE,this._$gl.ONE,this._$gl.ZERO))}toAdd(){611!==this._$funcCode&&(this._$funcCode=611,this._$gl.blendFunc(this._$gl.ONE,this._$gl.ONE))}toScreen(){641!==this._$funcCode&&(this._$funcCode=641,this._$gl.blendFunc(this._$gl.ONE_MINUS_DST_COLOR,this._$gl.ONE))}toAlpha(){606!==this._$funcCode&&(this._$funcCode=606,this._$gl.blendFunc(this._$gl.ZERO,this._$gl.SRC_ALPHA))}toErase(){603!==this._$funcCode&&(this._$funcCode=603,this._$gl.blendFunc(this._$gl.ZERO,this._$gl.ONE_MINUS_SRC_ALPHA))}toSourceAtop(){673!==this._$funcCode&&(this._$funcCode=673,this._$gl.blendFunc(this._$gl.DST_ALPHA,this._$gl.ONE_MINUS_SRC_ALPHA))}toSourceIn(){670!==this._$funcCode&&(this._$funcCode=670,this._$gl.blendFunc(this._$gl.DST_ALPHA,this._$gl.ZERO))}toOperation(t){switch(t){case"add":this.toAdd();break;case"screen":this.toScreen();break;case"alpha":this.toAlpha();break;case"erase":this.toErase();break;case"copy":this.toOneZero();break;default:this.reset()}}clearInstacedArray(){const t=this._$instanceShader.instance;t.count&&t.clear()}drawInstacedArray(){const t=this._$instanceShader.instance;if(!t.count)return;const e=this._$context.frameBuffer,i=e.textureManager.getAtlasTexture(this._$currentIndex);e.textureManager.bind0(i,this._$currentSmoothing),this.toOperation(this._$currentOperation),this._$instanceShader.drawArraysInstanced(t),t.clear()}drawInstance(t,e,i,s,r,n,a,h,o,_,l,c,$,u){this._$currentOperation||(this._$currentOperation=_),-1===this._$currentIndex&&(this._$currentIndex=t.index),null===this._$currentSmoothing&&(this._$currentSmoothing=u),this._$currentOperation===_&&this._$currentIndex===t.index&&this._$currentSmoothing===u||(this.drawInstacedArray(),this._$currentOperation=_,this._$currentIndex=t.index,this._$currentSmoothing=u),this._$variants.pushNormalBlend(this._$instanceShader.instance,t.x,t.y,t.w,t.h,$,l,c,e,i,s,r,n,a,h,o)}drawInstanceBlend(t,e,i,s,n,a,h,o,_,l,c,$,u,d,g,f,m,p,x){this.drawInstacedArray();const b=this._$context.frameBuffer,v=b.currentAttachment,T=1!==a||1!==h||1!==o||1!==_||0!==l||0!==c||0!==$||0!==u,A=b.getTextureFromCurrentAttachment(),M=this._$context.frameBuffer.createTextureAttachment(d.w,d.h);this._$context._$bind(M),b.textureManager.bind0(A);const y=this._$variants.getClipShader(),E=y.uniform;this._$variants.setClipUniform(E,0,0,d.w,d.h,z(p),f,m),this.reset(),y._$drawImage();const C=b.getTextureFromCurrentAttachment();this._$context._$bind(v),b.textureManager.bind01(C,t,x);const S=this._$variants.getInstanceBlendShader(g,T);this._$variants.setInstanceBlendUniform(S.uniform,d.x/t.width,d.y/t.height,d.w/t.width,d.h/t.height,d.w,d.h,p,f,m,T,a,h,o,_,l,c,$,u);const F=r.abs(s-e),B=r.abs(n-i);this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(e,m-(i+B),F,B),this.toOneZero(),S._$drawImage(),this._$gl.disable(this._$gl.SCISSOR_TEST),b.releaseAttachment(M,!0)}drawImage(t,e,i,s,n,a,o,_,l,c,$,u,d,g,f,m,p,x){const b=this._$context.frameBuffer,v=b.currentAttachment,T=1!==a||1!==o||1!==_||1!==l||0!==c||0!==$||0!==u||0!==d;switch(g){case"normal":case"layer":case"add":case"screen":case"alpha":case"erase":case"copy":{b.textureManager.bind0(t,x);const v=this._$variants.getNormalBlendShader(T);this._$variants.setNormalBlendUniform(v.uniform,e,i,s,n,p,f,m,T,a,o,_,l,c,$,u,d);const A=p[0],M=p[1],y=p[3],E=p[4],C=p[6],S=p[7];if(1!==A||0!==M||0!==y||1!==E){const t=e+s,a=i+n,o=+(t*A+a*y+C),_=+(t*A+i*y+C),l=+(e*A+a*y+C),c=+(e*A+i*y+C),$=+(t*M+a*E+S),u=+(t*M+i*E+S),d=+(e*M+a*E+S),g=+(e*M+i*E+S),p=h.MAX_VALUE,x=+r.min(r.min(r.min(r.min(p,o),_),l),c),b=+r.max(r.max(r.max(r.max(-p,o),_),l),c),v=+r.min(r.min(r.min(r.min(p,$),u),d),g),T=+r.max(r.max(r.max(r.max(-p,$),u),d),g),F=r.max(0,x),B=r.max(0,v),w=r.min(r.max(0,f-F),r.ceil(r.abs(b-x))),R=r.min(r.max(0,m-B),r.ceil(r.abs(T-v)));if(!w||!R)return;this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(F,r.max(0,m-(B+R)),w+1,R+1)}else{const t=r.max(0,e+C),a=r.max(0,i+S),h=r.min(r.max(0,f-t),s),o=r.min(r.max(0,m-a),n);if(!h||!o)return;this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(t,r.max(0,m-(a+o)),h+1,o+1)}this.toOperation(g),v._$drawImage(),this._$gl.disable(this._$gl.SCISSOR_TEST)}break;default:{const h=r.max(0,e+p[6]),A=r.max(0,i+p[7]),M=r.min(r.max(0,f-h),s),y=r.min(r.max(0,m-A),n);if(!M||!y)return;const E=b.getTextureFromCurrentAttachment(),C=this._$context.frameBuffer.createTextureAttachment(s,n);this._$context._$bind(C),b.textureManager.bind0(E);const S=this._$variants.getClipShader(),F=S.uniform;this._$variants.setClipUniform(F,e,i,s,n,z(p),f,m),this.reset(),S._$drawImage();const B=b.getTextureFromCurrentAttachment();this._$context._$bind(v),b.textureManager.bind01(B,t,x);const w=this._$variants.getBlendShader(g,T);this._$variants.setBlendUniform(w.uniform,e,i,s,n,p,f,m,T,a,o,_,l,c,$,u,d),this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(h,r.max(0,m-(A+y)),M,y),this.toOneZero(),w._$drawImage(),this._$gl.disable(this._$gl.SCISSOR_TEST),b.releaseAttachment(C,!0)}}}}class re{constructor(t,e){var i;i=t.getParameter(t.MAX_TEXTURE_SIZE),bt=Math.min(4096,i/2),this._$gl=t;const s=r.min(e,t.getParameter(t.MAX_SAMPLES));this._$maxTextureSize=r.min(8192,t.getParameter(t.MAX_TEXTURE_SIZE))-2,this._$contextStyle=new xt,this._$cacheBounds=F(),this._$matrix=O(1,0,0,0,1,0,0,0,1),this._$cacheAttachment=null,this._$stack=[],this._$globalAlpha=1,this._$imageSmoothingEnabled=!1,this._$globalCompositeOperation="normal",this._$clearColorR=1,this._$clearColorG=1,this._$clearColorB=1,this._$clearColorA=1,this._$viewportWidth=0,this._$viewportHeight=0,this._$frameBufferManager=new Mt(t,s),this._$path=new Et,this._$grid=new Ct,this._$offsetX=0,this._$offsetY=0,this._$blends=U(),this._$positions=U(),this._$isLayer=!1,this._$shaderList=new Qt(this,t),this._$gradientLUT=new Jt(this,t),this._$vao=new ee(t),this._$mask=new ie(this,t),this._$blend=new se(this,t),this._$attachmentArray=[],this._$maskBounds=F(0,0,0,0),this._$cachePosition=null}get cachePosition(){return this._$cachePosition}set cachePosition(t){this._$cachePosition=t}reset(){this._$globalAlpha=1,this._$globalCompositeOperation="normal",this._$imageSmoothingEnabled=!1,this._$contextStyle.clear()}get isLayer(){return this._$isLayer}get canvas(){return this._$gl.canvas}get cacheAttachment(){return this._$cacheAttachment}set cacheAttachment(t){this._$cacheAttachment=t}get cacheBounds(){return this._$cacheBounds}get fillStyle(){return this._$contextStyle.fillStyle}set fillStyle(t){this._$contextStyle.fillStyle=t}get strokeStyle(){return this._$contextStyle.strokeStyle}set strokeStyle(t){this._$contextStyle.strokeStyle=t}get lineWidth(){return this._$contextStyle.lineWidth}set lineWidth(t){this._$contextStyle.lineWidth=t}get lineCap(){return this._$contextStyle.lineCap}set lineCap(t){this._$contextStyle.lineCap=t}get lineJoin(){return this._$contextStyle.lineJoin}set lineJoin(t){this._$contextStyle.lineJoin=t}get miterLimit(){return this._$contextStyle.miterLimit}set miterLimit(t){this._$contextStyle.miterLimit=t}get globalAlpha(){return this._$globalAlpha}set globalAlpha(t){this._$globalAlpha=G(t,0,1,1)}get imageSmoothingEnabled(){return this._$imageSmoothingEnabled}set imageSmoothingEnabled(t){this._$imageSmoothingEnabled=t}get globalCompositeOperation(){return this._$globalCompositeOperation}set globalCompositeOperation(t){this._$globalCompositeOperation=t}get frameBuffer(){return this._$frameBufferManager}get shaderList(){return this._$shaderList}get path(){return this._$path}get grid(){return this._$grid}get vao(){return this._$vao}get blend(){return this._$blend}_$getCurrentPosition(){return this._$positions[this._$positions.length-1]}_$getTextureScale(t,e){const i=r.max(t,e);return i>this._$maxTextureSize?this._$maxTextureSize/i:1}drawInstacedArray(){this.blend.drawInstacedArray()}clearInstacedArray(){this.blend.clearInstacedArray()}bindRenderBuffer(t){this._$frameBufferManager.bindRenderBuffer(),this._$gl.clearColor(0,0,0,0),this._$gl.clear(this._$gl.COLOR_BUFFER_BIT|this._$gl.STENCIL_BUFFER_BIT),this._$viewportWidth=t.w,this._$viewportHeight=t.h,this._$gl.viewport(t.x,t.y,t.w,t.h),this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(t.x,t.y,t.w,t.h)}getTextureFromRect(t){const e=this._$frameBufferManager,i=e.textureManager.getAtlasTexture(t.index),s=e.currentAttachment,r=e.createTextureAttachment(t.w,t.h);this._$bind(r),this.save(),this.setTransform(1,0,0,1,0,0),this.reset(),this.drawImage(i,-t.x,-i.height+t.h+t.y,i.width,i.height),this.restore();const n=r.texture;return e.releaseAttachment(r),this._$bind(s),n}drawBitmap(t){const e=this._$shaderList.blendShaderVariants,i=e.getNormalBlendShader(!1);e.setNormalBlendUniform(i.uniform,0,0,t.width,t.height,this._$matrix,this._$viewportWidth,this._$viewportHeight,!1,1,1,1,1,0,0,0,0),this._$frameBufferManager.textureManager.bind0(t,this._$imageSmoothingEnabled),this.blend.toOperation("normal"),i._$drawImage()}drawTextureFromRect(t,e){const i=this._$frameBufferManager,s=i.currentAttachment;this.bindRenderBuffer(e),i.transferTexture(e);const r=i.textureManager.getAtlasTexture(e.index),n=i.createTextureAttachmentFrom(r);this._$bind(n),this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(e.x,e.y,e.w,e.h),this._$gl.clearColor(0,0,0,0),this._$gl.disable(this._$gl.SCISSOR_TEST),this.save(),this.setTransform(1,0,0,1,0,0),this.reset(),this.drawImage(t,e.x,r.height-e.h-e.y,t.width,t.height),this.restore(),i.releaseAttachment(n),this._$bind(s),i.textureManager.release(t)}stopStencil(){this._$mask._$onClearRect()}_$bind(t=null){if(!t)return;this._$frameBufferManager.bind(t);const e=t.color,i=t.stencil,s=t.width,r=t.height;this._$viewportWidth===s&&this._$viewportHeight===r||(this._$viewportWidth=s,this._$viewportHeight=r,this._$gl.viewport(0,0,s,r)),(e&&e.dirty||i&&i.dirty)&&(e&&(e.dirty=!1),i&&(i.dirty=!1),this._$gl.clearColor(0,0,0,0),this.clearRect(0,0,this._$viewportWidth,this._$viewportHeight),this._$gl.clearColor(this._$clearColorR,this._$clearColorG,this._$clearColorB,this._$clearColorA),this._$mask._$onClear(t.mask)),this._$mask._$onBind(t.mask)}setTransform(t,e,i,s,r,n){this._$matrix[0]=t,this._$matrix[1]=e,this._$matrix[3]=i,this._$matrix[4]=s,this._$matrix[6]=r,this._$matrix[7]=n}setMaxSize(t,e){this._$frameBufferManager.setMaxSize(t,e)}transform(t,e,i,s,r,n){const a=this._$matrix[0],h=this._$matrix[1],o=this._$matrix[3],_=this._$matrix[4],l=this._$matrix[6],c=this._$matrix[7];this._$matrix[0]=t*a+e*o,this._$matrix[1]=t*h+e*_,this._$matrix[3]=i*a+s*o,this._$matrix[4]=i*h+s*_,this._$matrix[6]=r*a+n*o+l,this._$matrix[7]=r*h+n*_+c}debug(t=0){const e=this._$frameBufferManager,i=e.textureManager.getAtlasTexture(t),s=e.currentAttachment,r=e.createTextureAttachmentFrom(i);this._$bind(r);const n=new Uint8Array(i.width*i.height*4);this._$gl.readPixels(0,0,i.width,i.height,this._$gl.RGBA,this._$gl.UNSIGNED_BYTE,n);const a=document.createElement("canvas");a.width=i.width,a.height=i.height;const h=a.getContext("2d"),o=new ImageData(i.width,i.height);for(let t=0;t<n.length;++t)o.data[t]=n[t];null==h||h.putImageData(o,0,0),console.log(a.toDataURL()),this._$bind(s),e.releaseAttachment(r)}drawInstance(t,e,i,s,r){let n=1,a=1,h=1,o=0,_=0,l=0;const c=this._$globalAlpha;r&&(n=r[0],a=r[1],h=r[2],o=r[4]/255,_=r[5]/255,l=r[6]/255);const $=this._$cachePosition;if($)switch(this._$globalCompositeOperation){case"normal":case"layer":case"add":case"screen":case"alpha":case"erase":case"copy":this.blend.drawInstance($,n,a,h,c,o,_,l,0,this._$globalCompositeOperation,this._$viewportWidth,this._$viewportHeight,this._$matrix,this._$imageSmoothingEnabled);break;default:{const r=this._$frameBufferManager.textureManager.getAtlasTexture($.index);this.blend.drawInstanceBlend(r,t,e,i,s,n,a,h,c,o,_,l,0,$,this._$globalCompositeOperation,this._$viewportWidth,this._$viewportHeight,this._$matrix,this._$imageSmoothingEnabled)}}}drawImage(t,e,i,s,r,n=null){let a=1,h=1,o=1,_=0,l=0,c=0;const $=this._$globalAlpha;n&&(a=n[0],h=n[1],o=n[2],_=n[4]/255,l=n[5]/255,c=n[6]/255),this.blend.drawImage(t,e,i,s,r,a,h,o,$,_,l,c,0,this._$globalCompositeOperation,this._$viewportWidth,this._$viewportHeight,this._$matrix,this._$imageSmoothingEnabled)}_$setColor(t=0,e=0,i=0,s=0){this._$clearColorR=t,this._$clearColorG=e,this._$clearColorB=i,this._$clearColorA=s,this._$gl.clearColor(t,e,i,s)}clearRect(t,e,i,s){this._$mask._$onClearRect(),this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(t,e,i,s),this._$gl.clear(this._$gl.COLOR_BUFFER_BIT|this._$gl.STENCIL_BUFFER_BIT),this._$gl.disable(this._$gl.SCISSOR_TEST)}_$clearRectStencil(){this._$mask._$onClearRect(),this._$gl.enable(this._$gl.SCISSOR_TEST),this._$gl.scissor(this._$maskBounds.xMin,this._$maskBounds.yMin,this._$maskBounds.xMax,this._$maskBounds.yMax),this._$gl.clear(this._$gl.STENCIL_BUFFER_BIT),this._$gl.disable(this._$gl.SCISSOR_TEST)}moveTo(t,e){this._$path.moveTo(t,e)}lineTo(t,e){this._$path.lineTo(t,e)}beginPath(){this._$path.begin()}quadraticCurveTo(t,e,i,s){this._$path.quadTo(t,e,i,s)}bezierCurveTo(t,e,i,s,r,n){this._$path.cubicTo(t,e,i,s,r,n)}fill(){const t=this._$path.vertices;if(!t.length)return;const e=U();for(let i=0;i<t.length;++i){const s=t[i];10>s.length||e.push(s)}if(!e.length)return void D(e);const i=this._$vao.createFill(e),s=this.fillStyle;let r,n,a,h=this._$matrix;const o=this._$grid.enabled;if(s instanceof mt){const t=s.stops,e="linearRGB"===s.rgb;if(r=this._$gradientLUT.generateForShape(t,e),this._$frameBufferManager.textureManager.bind0(r,!0),this._$frameBufferManager.bindRenderBuffer(),n=this._$shaderList.gradientShapeShaderVariants,"linear"===s.type)a=n.getGradientShapeShader(!1,o,!1,!1,s.mode),n.setGradientShapeUniform(a.uniform,!1,0,0,0,o,h,z(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,!1,s.points,0);else{h=this._$stack[this._$stack.length-1];const t=0!==s.focalPointRatio;a=n.getGradientShapeShader(!1,o,!0,t,s.mode),n.setGradientShapeUniform(a.uniform,!1,0,0,0,o,h,z(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,!0,s.points,s.focalPointRatio)}}else if(s instanceof pt){h=this._$stack[this._$stack.length-1];const t=s.colorTransform;r=s.texture,this._$frameBufferManager.textureManager.bind0(r,this._$imageSmoothingEnabled),n=this._$shaderList.shapeShaderVariants,a=n.getBitmapShapeShader(!1,s.repeat,o),t?n.setBitmapShapeUniform(a.uniform,!1,0,0,0,o,h,z(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,r.width,r.height,t[0],t[1],t[2],this._$globalAlpha,t[4]/255,t[5]/255,t[6]/255,0):n.setBitmapShapeUniform(a.uniform,!1,0,0,0,o,h,z(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,r.width,r.height,1,1,1,this._$globalAlpha,0,0,0,0)}else n=this._$shaderList.shapeShaderVariants,a=n.getSolidColorShapeShader(!1,this._$grid.enabled),n.setSolidColorShapeUniform(a.uniform,!1,0,0,0,o,h,this._$viewportWidth,this._$viewportHeight,this._$grid,s,this._$globalAlpha);const _=this._$shaderList.shapeShaderVariants,l=_.getMaskShapeShader(!1,o);_.setMaskShapeUniform(l.uniform,o,h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8],this._$viewportWidth,this._$viewportHeight,this._$grid),this._$gl.enable(this._$gl.STENCIL_TEST),this._$gl.stencilMask(255),this._$gl.enable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.ALWAYS,0,255),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.INVERT,this._$gl.INVERT),this._$gl.colorMask(!1,!1,!1,!1),l._$fill(i),this._$gl.disable(this._$gl.SAMPLE_ALPHA_TO_COVERAGE),this._$gl.stencilFunc(this._$gl.NOTEQUAL,0,255),this._$gl.stencilOp(this._$gl.KEEP,this._$gl.ZERO,this._$gl.ZERO),this._$gl.colorMask(!0,!0,!0,!0),a._$fill(i),this._$gl.disable(this._$gl.STENCIL_TEST),this.releaseFillVertexArray(i)}releaseFillVertexArray(t){this._$vao.releaseFill(t);const e=t.indexRanges;for(let t=0;t<e.length;++t)Zt.indexRangePool.push(e[t]);D(e)}_$enterClip(){this._$mask._$enterClip()}_$beginClipDef(){this._$mask._$beginClipDef()}_$updateContainerClipFlag(t){this._$mask.containerClip=t}_$startClip(t){const e=t.xMin,i=t.yMin,s=Math.abs(t.xMax-t.xMin),n=Math.abs(t.yMax-t.yMin),a=this._$frameBufferManager.currentAttachment;if(!a)throw new Error("the current Attachment is null.");return!(e>a.width||i>a.height||0>e&&0>=s+e||0>i&&0>=n+i||(this._$maskBounds.xMin=r.max(0,r.min(this._$maskBounds.xMin,e)),this._$maskBounds.yMin=r.max(0,r.min(this._$maskBounds.yMin,i)),this._$maskBounds.xMax=r.min(a.width,r.min(this._$maskBounds.xMax,s)),this._$maskBounds.yMax=r.min(a.height,r.min(this._$maskBounds.yMax,n)),0))}_$endClipDef(){this._$mask._$endClipDef()}_$leaveClip(){this.drawInstacedArray(),this._$mask._$leaveClip()}_$drawContainerClip(){this._$mask._$drawContainerClip()}closePath(){this._$path.close()}stroke(){const t=this._$path.vertices;if(!t.length)return;const e=U();for(let i=0;i<t.length;++i){const s=t[i];6>s.length||e.push(s)}if(!e.length)return void D(e);const i=this._$vao.createStroke(t,this.lineCap,this.lineJoin);let s=this._$matrix;const n=this.strokeStyle;let a=r.sign(s[0]*s[4]);a>0&&0!==s[1]&&0!==s[3]&&(a=-r.sign(s[1]*s[3]));let h,o,_=.5*this.lineWidth;this._$grid.enabled?(h=r.abs(this._$grid.ancestorMatrixA+this._$grid.ancestorMatrixD),o=r.abs(this._$grid.ancestorMatrixB+this._$grid.ancestorMatrixE)):(h=r.abs(s[0]+s[3]),o=r.abs(s[1]+s[4]));const l=r.min(h,o),c=r.max(h,o);_*=c*(1-.3*r.cos(.5*r.PI*(l/c))),_=r.max(1,_);const $=this._$grid.enabled;let u,d,g;if(n instanceof mt){"radial"===n.type&&(s=this._$stack[this._$stack.length-1]);const t=n.stops,e="linearRGB"===n.rgb;if(u=this._$gradientLUT.generateForShape(t,e),this._$frameBufferManager.textureManager.bind0(u,!0),d=this._$shaderList.gradientShapeShaderVariants,"linear"===n.type)g=d.getGradientShapeShader(!0,$,!1,!1,n.mode),d.setGradientShapeUniform(g.uniform,!0,_,a,this.miterLimit,$,s,z(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,!1,n.points,0);else{s=this._$stack[this._$stack.length-1];const t=0!==n.focalPointRatio;g=d.getGradientShapeShader(!0,$,!0,t,n.mode),d.setGradientShapeUniform(g.uniform,!0,_,a,this.miterLimit,$,s,z(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,!0,n.points,n.focalPointRatio)}}else if(n instanceof pt){s=this._$stack[this._$stack.length-1];const t=n.colorTransform;u=n.texture,this._$frameBufferManager.textureManager.bind0(u),d=this._$shaderList.shapeShaderVariants,g=d.getBitmapShapeShader(!0,n.repeat,this._$grid.enabled),t?d.setBitmapShapeUniform(g.uniform,!0,_,a,this.miterLimit,$,s,z(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,u.width,u.height,t[0],t[1],t[2],this._$globalAlpha,t[4]/255,t[5]/255,t[6]/255,0):d.setBitmapShapeUniform(g.uniform,!0,_,a,this.miterLimit,$,s,z(this._$matrix),this._$viewportWidth,this._$viewportHeight,this._$grid,u.width,u.height,1,1,1,this._$globalAlpha,0,0,0,0)}else d=this._$shaderList.shapeShaderVariants,g=d.getSolidColorShapeShader(!0,this._$grid.enabled),d.setSolidColorShapeUniform(g.uniform,!0,_,a,this.miterLimit,$,s,this._$viewportWidth,this._$viewportHeight,this._$grid,n,this._$globalAlpha);g._$stroke(i),this._$vao.releaseStroke(i)}arc(t,e,i){this._$path.drawCircle(t,e,i)}clip(){const t=this._$path.vertices;if(!t.length)return;const e=U();for(let i=0;i<t.length;++i){const s=t[i];10>s.length||e.push(s)}if(!e.length)return void D(e);const i=this._$vao.createFill(e),s=this._$shaderList.shapeShaderVariants,r=s.getMaskShapeShader(!1,!1),n=r.uniform;s.setMaskShapeUniform(n,!1,this._$matrix[0],this._$matrix[1],this._$matrix[2],this._$matrix[3],this._$matrix[4],this._$matrix[5],this._$matrix[6],this._$matrix[7],this._$matrix[8],this._$viewportWidth,this._$viewportHeight,null),this._$mask._$onClip(i,this._$matrix,this._$viewportWidth,this._$viewportHeight)||(r._$fill(i),this.beginPath())}save(){const t=this._$matrix;this._$stack.push(O(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])),this._$mask._$onSave()}restore(){var t;this._$stack.length&&(t=this._$matrix,M.push(t),this._$matrix=this._$stack.pop()||O()),this._$mask._$onRestore()}createPattern(t,e,i){return new pt(t,e,i)}createLinearGradient(t,e,i,s,r="rgb",n="pad"){return(new mt).linear(t,e,i,s,r,n)}createRadialGradient(t,e,i,s,r,n,a="rgb",h="pad",o=0){return(new mt).radial(t,e,i,s,r,n,a,h,o)}_$applyBlurFilter(t,e,i){const s=this._$frameBufferManager,n=s.currentAttachment;if(!n)throw new Error("the current attachment is null.");const a=n.width,h=n.height;s.textureManager.bind0(t,!0);const o=r.ceil(.5*i),_=1-(o-.5*i),l=1+i,c=this._$shaderList.filterShaderVariants,$=c.getBlurFilterShader(o);c.setBlurFilterUniform($.uniform,a,h,e,_,l),$._$drawImage()}_$applyBitmapFilter(t,e,i,s,r,n,a,h,o,_,l,c,$,u,d,g=null,f=null,m=null,p=0,x=0,b=0,v=0,T=0,A=0,M=0,y=0){const E=this._$frameBufferManager,C="inner"===$,S=E.currentAttachment,F=E.getTextureFromCurrentAttachment();let B=null;const w=null!==g&&null!==f&&null!==m;let R;null!==g&&null!==f&&null!==m&&(B=this._$gradientLUT.generateForFilter(g,f,m)),C?w&&B?E.textureManager.bind02(t,B,!0):E.textureManager.bind0(t):(R=this._$frameBufferManager.createTextureAttachment(e,i),this._$bind(R),w&&B?E.textureManager.bind012(t,F,B,!0):E.textureManager.bind01(t,F));const I=!(C||"full"===$&&u),P=!(e===h&&i===o&&0===_&&0===l),N=!(1===d),k=this._$shaderList.filterShaderVariants,L=k.getBitmapFilterShader(I,P,c,$,u,N,w);k.setBitmapFilterUniform(L.uniform,e,i,s,r,n,a,h,o,_,l,c,d,p,x,b,v,T,A,M,y,I,P,N,w),C?u?this.blend.toSourceIn():this.blend.toSourceAtop():this.blend.toOneZero(),L._$drawImage(),C||E.releaseAttachment(S,!0)}_$applyColorMatrixFilter(t,e){this._$frameBufferManager.textureManager.bind0(t,!0);const i=this._$shaderList.filterShaderVariants,s=i.getColorMatrixFilterShader();i.setColorMatrixFilterUniform(s.uniform,e),this.blend.reset(),s._$drawImage()}_$applyConvolutionFilter(t,e,i,s,r,n,a,h,o,_,l,c){const $=t.width,u=t.height,d=this._$frameBufferManager.createTextureAttachment($,u);this._$bind(d),this._$frameBufferManager.textureManager.bind0(t,!0);const g=this._$shaderList.filterShaderVariants,f=g.getConvolutionFilterShader(e,i,a,h);g.setConvolutionFilterUniform(f.uniform,$,u,s,r,n,h,o,_,l,c),this.blend.reset(),f._$drawImage()}_$applyDisplacementMapFilter(t,e,i,s,r,n,a,h,o,_,l,c,$,u){const d=t.width,g=t.height,f=this._$frameBufferManager.createTextureAttachment(d,g);this._$bind(f),r||(r={x:0,y:0});const m=this._$frameBufferManager.createTextureFromImage(e);this._$frameBufferManager.textureManager.bind01(t,m);const p=this._$shaderList.filterShaderVariants,x=p.getDisplacementMapFilterShader(n,a,_);p.setDisplacementMapFilterUniform(x.uniform,e.width,e.height,i,s,r.x,r.y,h,o,_,l,c,$,u),this.blend.reset(),x._$drawImage(),this._$frameBufferManager.releaseTexture(m)}_$startLayer(t){this._$positions.push(t),this._$blends.push(this._$isLayer),this._$isLayer=!0}_$endLayer(){const t=this._$positions.pop();t&&B(t),this._$isLayer=!!this._$blends.pop()}_$saveAttachment(t,e,i=!1){this.drawInstacedArray();const s=this._$frameBufferManager;this._$attachmentArray.push(s.currentAttachment),this._$bind(s.createCacheAttachment(t,e,i))}_$restoreAttachment(t=!1){const e=this._$frameBufferManager;e.releaseAttachment(e.currentAttachment,t),this._$bind(this._$attachmentArray.pop())}getCurrentPosition(){return this._$positions[this._$positions.length-1]}textureScale(t,e){const i=r.max(t,e);return i>this._$maxTextureSize?this._$maxTextureSize/i:1}}class ne extends gt{constructor(){super(),this._$recodes=null,this._$maxAlpha=0,this._$canDraw=!1,this._$uniqueKey="",this._$cacheKeys=U(),this._$cacheParams=U(0,0,0),this._$bitmapId=0,this._$mode="shape"}_$clip(t,e){if(!this._$recodes)return;const i=this._$getBounds(),n=q(i,e);B(i);const a=r.ceil(r.abs(n.xMax-n.xMin)),h=r.ceil(r.abs(n.yMax-n.yMin));switch(B(n),!0){case 0===a:case 0===h:case a===-1/0:case h===-1/0:case a===s:case h===s:return}t.reset(),t.setTransform(e[0],e[1],e[2],e[3],e[4],e[5]),this._$runCommand(t,this._$recodes,null,!0),t.clip()}_$createCacheKey(){if(!this._$recodes)return"";let t=0;for(let e=0;e<this._$recodes.length;e++)t=(t<<5)-t+this._$recodes[e],t|=0;return`${t}`}_$createBitmapTexture(t,e,i,s,r,n){if("bitmap"!==this._$mode)return null;t.drawInstacedArray();const a=t.frameBuffer,h=a.currentAttachment,o=a.createCacheAttachment(r,n);t._$bind(o),t.reset();const _=P(i,0,0,s,r/2,n/2),l=t.getTextureFromRect(e),c=P(1,0,0,1,-l.width/2,-l.height/2),$=H(_,c);N(_),N(c),t.setTransform($[0],$[1],$[2],$[3],$[4],$[5]),t.drawImage(l,0,0,l.width,l.height);const u=a.getTextureFromCurrentAttachment();return t._$bind(h),a.releaseAttachment(o),a.textureManager.release(l),u}_$draw(t,e,i,n="normal",a=null){if(!(this._$visible&&this._$recodes&&this._$maxAlpha&&this._$canDraw))return;const o=G(i[3]+i[7]/255,0,1,0);if(!o)return;const _=this._$matrix;let l=null!==this._$scale9Grid;l&&(l=l&&r.abs(_[1])<.001&&r.abs(_[2])<1e-4);const c=F(this._$xMin,this._$xMax,this._$yMin,this._$yMax),$=q(c,e),u=$.xMax,d=$.xMin,g=$.yMax,f=$.yMin;B($);const m=r.ceil(r.abs(u-d)),p=r.ceil(r.abs(g-f));switch(!0){case 0===m:case 0===p:case m===-1/0:case p===-1/0:case m===s:case p===s:return}let x=+r.sqrt(e[0]*e[0]+e[1]*e[1]);if(!h.isInteger(x)){const t=x.toString(),e=t.indexOf("e");-1!==e&&(x=+t.slice(0,e)),x=+x.toFixed(4)}let b=+r.sqrt(e[2]*e[2]+e[3]*e[3]);if(!h.isInteger(b)){const t=b.toString(),e=t.indexOf("e");-1!==e&&(b=+t.slice(0,e)),b=+b.toFixed(4)}const v=null!==a&&a.length>0&&this._$canApply(a);let T=F(0,m,0,p);if(v&&a)for(let t=0;t<a.length;++t)T=a[t]._$generateFilterRect(T,x,b);const A=t.frameBuffer,M=A.currentAttachment;if(!M||d-T.xMin>M.width||f-T.yMin>M.height)return void B(T);if(0>d+T.xMax||0>f+T.yMax)return void B(T);if(B(T),""===this._$uniqueKey&&(!l&&this._$loaderInfoId>-1&&this._$characterId>-1?this._$uniqueKey=`${this._$loaderInfoId}@${this._$characterId}`:this._$uniqueKey=this._$createCacheKey()),"bitmap"===this._$mode)this._$cacheKeys.length||(this._$cacheKeys=rt.generateKeys(this._$uniqueKey));else if(!this._$cacheKeys.length||this._$cacheParams[0]!==x||this._$cacheParams[1]!==b||this._$cacheParams[2]!==i[7]){const t=U();t[0]=x,t[1]=b,this._$cacheKeys=rt.generateKeys(this._$uniqueKey,t,i),D(t),this._$cacheParams[0]=x,this._$cacheParams[1]=b,this._$cacheParams[2]=i[7]}if(t.cachePosition=rt.get(this._$cacheKeys),!t.cachePosition){const s=A.currentAttachment;s&&s.mask&&t.stopStencil();let n=0,a=0;if("shape"===this._$mode){n=r.ceil(r.abs(c.xMax-c.xMin)*x),a=r.ceil(r.abs(c.yMax-c.yMin)*b);const e=t._$getTextureScale(n,a);e<1&&(n*=e,a*=e)}else n=r.ceil(r.abs(c.xMax-c.xMin)),a=r.ceil(r.abs(c.yMax-c.yMin));if(t.cachePosition=A.createCachePosition(n,a),t.bindRenderBuffer(t.cachePosition),t.reset(),"shape"===this._$mode?t.setTransform(x,0,0,b,-c.xMin*x,-c.yMin*b):t.setTransform(1,0,0,1,-c.xMin,-c.yMin),l){const i=le.scaleX,s=P(i,0,0,i,0,0),n=H(s,_);N(s);const a=this._$matrixBase,h=P(a[0],a[1],a[2],a[3],a[4]*i-d,a[5]*i-f),o=H(h,n),l=o[4]-(e[4]-d),$=o[5]-(e[5]-f);N(o);const u=q(c,n),g=+u.xMax,m=+u.xMin,p=+u.yMax,x=+u.yMin,b=r.ceil(r.abs(g-m)),v=r.ceil(r.abs(p-x));B(u),t.grid.enable(m,x,b,v,c,this._$scale9Grid,i,n[0],n[1],n[2],n[3],n[4],n[5],h[0],h[1],h[2],h[3],h[4]-l,h[5]-$),N(n),N(h)}this._$runCommand(t,this._$recodes,i,!1),l&&t.grid.disable(),A.transferTexture(t.cachePosition),rt.set(this._$cacheKeys,t.cachePosition),t._$bind(s)}let y=0,E=0;if(v&&a){const i=this._$createBitmapTexture(t,t.cachePosition,x,b,m,p),s=this._$drawFilter(t,e,a,m,p,i);s.offsetX&&(y=s.offsetX),s.offsetY&&(E=s.offsetY),t.cachePosition=s}if(v||"bitmap"!==this._$mode){const i=r.atan2(e[1],e[0]),s=r.atan2(-e[2],e[3]);if(v||!i&&!s)t.setTransform(1,0,0,1,d-y,f-E);else{const n=c.xMin*x,a=c.yMin*b,h=r.cos(i),o=r.sin(i),_=r.cos(s),l=r.sin(s);t.setTransform(h,o,-l,_,n*h-a*l+e[4],n*o+a*_+e[5])}}else t.setTransform(e[0],e[1],e[2],e[3],c.xMin*e[0]+c.yMin*e[2]+e[4],c.xMin*e[1]+c.yMin*e[3]+e[5]);t.cachePosition&&(t.globalAlpha=o,t.imageSmoothingEnabled="shape"===this._$mode,t.globalCompositeOperation=n,t.drawInstance(d-y,f-E,u,g,i),t.cachePosition=null),B(c)}setupStroke(t,e,i,s,r){switch(t.lineWidth=e,i){case 0:t.lineCap="none";break;case 1:t.lineCap="round";break;case 2:t.lineCap="square"}switch(s){case 0:t.lineJoin="bevel";break;case 1:t.lineJoin="miter";break;case 2:t.lineJoin="round"}t.miterLimit=r}createGradientStyle(t,e,i,s,n,a,h,o=null){let _,l="pad";switch(n){case 0:l="reflect";break;case 1:l="repeat"}if(0===e){const e=(t=>{const e=-819.2*t[0]-819.2*t[2]+t[4],i=819.2*t[0]-819.2*t[2]+t[4],s=-819.2*t[0]+819.2*t[2]+t[4],n=-819.2*t[1]-819.2*t[3]+t[5],a=819.2*t[1]-819.2*t[3]+t[5];let h=s-e,o=-819.2*t[1]+819.2*t[3]+t[5]-n;const _=r.sqrt(h*h+o*o);_?(h/=_,o/=_):(h=0,o=0);const l=(i-e)*h+(a-n)*o;return w(e+l*h,n+l*o,i,a)})(s);_=t.createLinearGradient(e[0],e[1],e[2],e[3],a?"rgb":"linearRGB",l)}else t.save(),t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),_=t.createRadialGradient(0,0,0,0,0,819.2,a?"rgb":"linearRGB",l,h);for(let t=0;t<i.length;++t){const e=i[t];let s=e.A;o&&(1===o[3]&&0===o[7]||(s=0|r.max(0,r.min(e.A*o[3]+o[7],255)))),_.addColorStop(e.ratio,I(e.R,e.G,e.B,s))}return _}_$runCommand(t,e,i=null,s=!1){t.reset(),t.beginPath();const n=e.length;for(let a=0;a<n;)switch(e[a++]){case 9:t.beginPath();break;case 0:t.moveTo(e[a++],e[a++]);break;case 2:t.lineTo(e[a++],e[a++]);break;case 1:t.quadraticCurveTo(e[a++],e[a++],e[a++],e[a++]);break;case 5:{if(s){a+=4;continue}const n=w();n[0]=e[a++]/255,n[1]=e[a++]/255,n[2]=e[a++]/255,n[3]=e[a++]/255,null!==i&&(1===i[3]&&0===i[7]||(n[3]=r.max(0,r.min(n[3]*i[3]+i[7],255))/255)),t.fillStyle=n}break;case 7:s||t.fill();break;case 6:{if(s){a+=8;continue}this.setupStroke(t,e[a++],e[a++],e[a++],e[a++]);const n=w();n[0]=e[a++]/255,n[1]=e[a++]/255,n[2]=e[a++]/255,n[3]=e[a++]/255,null!==i&&(1===i[3]&&0===i[7]||(n[3]=r.max(0,r.min(n[3]*i[3]+i[7],255))/255)),t.strokeStyle=n}break;case 8:s||t.stroke();break;case 12:t.closePath();break;case 3:t.bezierCurveTo(e[a++],e[a++],e[a++],e[a++],e[a++],e[a++]);break;case 4:t.arc(e[a++],e[a++],e[a++]);break;case 10:{if(s){a+=1;const t=e[a++];a+=5*t,a+=9;continue}const r=e[a++];let n=e[a++];const h=U();for(;n;)h.push({ratio:e[a++],R:e[a++],G:e[a++],B:e[a++],A:e[a++]}),n--;const o=P(e[a++],e[a++],e[a++],e[a++],e[a++],e[a++]);t.fillStyle=this.createGradientStyle(t,r,h,o,e[a++],e[a++],e[a++],i),t.fill(),1===r&&t.restore(),N(o),D(h)}break;case 11:{if(s){a+=5;const t=e[a++];a+=5*t,a+=9;continue}this.setupStroke(t,e[a++],e[a++],e[a++],e[a++]);const r=e[a++];let n=e[a++];const h=U();for(;n;)h.push({ratio:e[a++],R:e[a++],G:e[a++],B:e[a++],A:e[a++]}),n--;const o=P(e[a++],e[a++],e[a++],e[a++],e[a++],e[a++]);t.strokeStyle=this.createGradientStyle(t,r,h,o,e[a++],e[a++],e[a++],i),t.stroke(),1===r&&t.restore(),N(o),D(h)}break;case 13:{const r=e[a++],n=e[a++],h=e[a++],o=e[a++],_=e[a++];if(s){a+=_,a+=8;continue}const l=new Uint8Array(e.subarray(a,_+a));a+=_;const c=P(e[a++],e[a++],e[a++],e[a++],e[a++],e[a++]),$=!!e[a++],u=!!e[a++];t.save(),1===c[0]&&0===c[1]&&0===c[2]&&1===c[3]&&0===c[4]&&0===c[5]||t.transform(c[0],c[1],c[2],c[3],c[4],c[5]),N(c);const d=t.frameBuffer,g=d.createTextureFromPixels(r,n,l,!0);$||r!==h||n!==o?(t.fillStyle=t.createPattern(g,$,i||k()),t.imageSmoothingEnabled=u,t.fill()):(t.drawImage(g,0,0,r,n),d.releaseTexture(g)),t.restore(),t.imageSmoothingEnabled=!1}break;case 14:{if(s){a+=4;const t=e[a++];a+=t,a+=8;continue}t.save(),this.setupStroke(t,e[a++],e[a++],e[a++],e[a++]);const r=e[a++],n=e[a++],h=e[a++],o=new Uint8Array(e.subarray(a,h+a));a+=h;const _=P(e[a++],e[a++],e[a++],e[a++],e[a++],e[a++]);1===_[0]&&0===_[1]&&0===_[2]&&1===_[3]&&0===_[4]&&0===_[5]||t.transform(_[0],_[1],_[2],_[3],_[4],_[5]),N(_);const l=!!e[a++],c=!!e[a++],$=t.frameBuffer.createTextureFromPixels(r,n,o,!0);t.strokeStyle=t.createPattern($,l,i||k()),t.imageSmoothingEnabled=c,t.stroke(),t.restore(),t.imageSmoothingEnabled=!1}}}_$update(t){super._$update(t),t.recodes&&(this._$recodes=t.recodes,this._$xMin=t.xMin,this._$yMin=t.yMin,this._$xMax=t.xMax,this._$yMax=t.yMax,this._$maxAlpha=t.maxAlpha,this._$canDraw=t.canDraw,rt.removeCache(this._$instanceId),this._$loaderInfoId>-1&&this._$characterId>-1&&rt.removeCache(`${this._$loaderInfoId}@${this._$characterId}`))}}class ae extends ne{_$clip(t,e){let i=e;const n=this._$matrix;1===n[0]&&0===n[1]&&0===n[2]&&1===n[3]&&0===n[4]&&0===n[5]||(i=H(e,n));const a=this._$getBounds(),h=q(a,i);B(a);const o=r.ceil(r.abs(h.xMax-h.xMin)),_=r.ceil(r.abs(h.yMax-h.yMin));switch(B(h),!0){case 0===o:case 0===_:case o===-1/0:case _===-1/0:case o===s:case _===s:return}super._$clip(t,i),i!==e&&N(i)}_$draw(t,e,i){if(!this._$visible||!this._$maxAlpha||!this._$canDraw)return;let s=i;const r=this._$colorTransform;if(1===r[0]&&1===r[1]&&1===r[2]&&1===r[3]&&0===r[4]&&0===r[5]&&0===r[6]&&0===r[7]||(s=W(i,r)),!G(s[3]+s[7]/255,0,1,0))return void(s!==i&&L(s));let n=e;const a=this._$matrix;1===a[0]&&0===a[1]&&0===a[2]&&1===a[3]&&0===a[4]&&0===a[5]||(n=H(e,a)),super._$draw(t,n,s,this._$blendMode,this._$filters),n!==e&&N(n),s!==i&&L(s)}_$remove(){this._$xMin=0,this._$yMin=0,this._$xMax=0,this._$yMax=0,this._$recodes=null,super._$remove(),ce.push(this)}}class he extends gt{constructor(){super(),this._$background=!1,this._$backgroundColor=16777215,this._$border=!1,this._$borderColor=0,this._$wordWrap=!1,this._$textData=U(),this._$textAreaActive=!1,this._$thickness=0,this._$thicknessColor=0,this._$limitWidth=0,this._$limitHeight=0,this._$autoSize="none",this._$widthTable=U(),this._$heightTable=U(),this._$objectTable=U(),this._$textHeightTable=U(),this._$xMin=0,this._$yMin=0,this._$xMax=0,this._$yMax=0,this._$maxScrollV=null,this._$scrollV=1,this._$textHeight=0,this._$verticalAlign="top",this._$cacheKeys=U(),this._$cacheParams=U(0,0,0)}get width(){const t=q(this._$getBounds(null),this._$matrix),e=r.abs(t.xMax-t.xMin);switch(B(t),!0){case 0===e:case e===s:case e===-1/0:return 0;default:return e}}get height(){const t=q(this._$getBounds(null),this._$matrix),e=r.abs(t.yMax-t.yMin);switch(B(t),e){case 0:case s:case-1/0:return 0;default:return e}}get maxScrollV(){if(null===this._$maxScrollV){this._$maxScrollV=1;const t=this._$textHeightTable.length,e=this.height;if(e>this._$textHeight)return this._$maxScrollV;let i=0,s=0;for(;t>s&&(i+=this._$textHeightTable[s++],!(i>e));)this._$maxScrollV++}return this._$maxScrollV}_$clip(t,e){const i=this._$getBounds(),s=i.xMax,n=i.xMin,a=i.yMax,h=i.yMin;B(i);const o=r.ceil(r.abs(s-n)),_=r.ceil(r.abs(a-h));if(!o||!_)return;let l=e;const c=this._$matrix;1===c[0]&&0===c[1]&&0===c[2]&&1===c[3]&&0===c[4]&&0===c[5]||(l=H(e,c)),t.reset(),t.setTransform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),t.moveTo(0,0),t.lineTo(o,0),t.lineTo(o,_),t.lineTo(0,_),t.lineTo(0,0),t.clip(),l!==e&&N(l)}_$draw(t,e,i){if(!this._$visible||this._$textAreaActive)return;if(!this._$background&&!this._$border&&2>this._$textData.length)return;let n=i;const a=this._$colorTransform;1===a[0]&&1===a[1]&&1===a[2]&&1===a[3]&&0===a[4]&&0===a[5]&&0===a[6]&&0===a[7]||(n=W(i,a));const o=G(n[3]+n[7]/255,0,1);if(!o)return;let _=e;const l=this._$matrix;1===l[0]&&0===l[1]&&0===l[2]&&1===l[3]&&0===l[4]&&0===l[5]||(_=H(e,l));const c=this._$getBounds(null);c.xMin-=this._$thickness,c.xMax+=this._$thickness,c.yMin-=this._$thickness,c.yMax+=this._$thickness;const $=q(c,_),u=+$.xMax,d=+$.xMin,g=+$.yMax,f=+$.yMin;B($);const m=r.ceil(r.abs(u-d)),p=r.ceil(r.abs(g-f));switch(!0){case 0===m:case 0===p:case m===-1/0:case p===-1/0:case m===s:case p===s:return}let x=+r.sqrt(_[0]*_[0]+_[1]*_[1]);if(!h.isInteger(x)){const t=x.toString(),e=t.indexOf("e");-1!==e&&(x=+t.slice(0,e)),x=+x.toFixed(4)}let b=+r.sqrt(_[2]*_[2]+_[3]*_[3]);if(!h.isInteger(b)){const t=b.toString(),e=t.indexOf("e");-1!==e&&(b=+t.slice(0,e)),b=+b.toFixed(4)}const v=this._$filters,T=null!==v&&v.length>0&&this._$canApply(v);let A=F(0,m,0,p);if(T&&v)for(let t=0;t<v.length;++t)A=v[t]._$generateFilterRect(A,x,b);const M=t.frameBuffer,y=M.currentAttachment;if(!y||d-A.xMin>y.width||f-A.yMin>y.height)return void B(A);if(0>d+A.xMax||0>f+A.yMax)return void B(A);if(B(A),this._$isUpdated()&&(rt.removeCache(this._$instanceId),t.cachePosition=null,this._$cacheKeys.length=0),!this._$cacheKeys.length||this._$cacheParams[0]!==x||this._$cacheParams[1]!==b||this._$cacheParams[2]!==i[7]){const t=U(x,b);this._$cacheKeys=rt.generateKeys(this._$instanceId,t),D(t),this._$cacheParams[0]=x,this._$cacheParams[1]=b,this._$cacheParams[2]=i[7]}if(t.cachePosition=rt.get(this._$cacheKeys),!t.cachePosition){const s=r.min(1,r.max(x,b)),a=r.ceil(r.abs(c.xMax-c.xMin)*x),h=r.ceil(r.abs(c.yMax-c.yMin)*b);n[3]=1;const o=new OffscreenCanvas(a+2*s,h+2*s).getContext("2d");if(!o)return;if(this._$background||this._$border){if(o.beginPath(),o.moveTo(0,0),o.lineTo(a,0),o.lineTo(a,h),o.lineTo(0,h),o.lineTo(0,0),this._$background){const t=Z(this._$backgroundColor),e=r.max(0,r.min(255*t.A*i[3]+i[7],255))/255;o.fillStyle=`rgba(${t.R},${t.G},${t.B},${e})`,o.fill()}if(this._$border){const t=Z(this._$borderColor),e=r.max(0,r.min(255*t.A*i[3]+i[7],255))/255;o.lineWidth=s,o.strokeStyle=`rgba(${t.R},${t.G},${t.B},${e})`,o.stroke()}}o.save(),o.beginPath(),o.moveTo(2,2),o.lineTo(a-2,2),o.lineTo(a-2,h-2),o.lineTo(2,h-2),o.lineTo(2,2),o.clip(),o.beginPath(),o.setTransform(x,0,0,b,0,0),this._$doDraw(o,e,i,a/x),o.restore();const _=M.createCachePosition(m,p),l=M.createTextureFromCanvas(o.canvas);t.drawTextureFromRect(l,_),t.cachePosition=_,rt.set(this._$cacheKeys,_)}let E=!1,C=0,S=0;if(v&&v.length&&this._$canApply(v)){E=!0;const e=this._$drawFilter(t,_,v,m,p);e.offsetX&&(C=e.offsetX),e.offsetY&&(S=e.offsetY),t.cachePosition=e}const w=r.atan2(_[1],_[0]),R=r.atan2(-_[2],_[3]);if(E||!w&&!R)t.setTransform(1,0,0,1,d-C,f-S);else{const e=c.xMin*x,i=c.yMin*b,s=r.cos(w),n=r.sin(w),a=r.cos(R),h=r.sin(R);t.setTransform(s,n,-h,a,e*s-i*h+_[4],e*n+i*a+_[5])}t.cachePosition&&(t.globalAlpha=o,t.imageSmoothingEnabled=!0,t.globalCompositeOperation=this._$blendMode,t.drawInstance(d-C,f-S,u,g,i),t.cachePosition=null),B(c),_!==e&&N(_),n!==i&&L(n)}_$doDraw(t,e,i,s){const n=this.width,a=this.height;let h=0,o=0,_=0,l=0;if("top"!==this._$verticalAlign&&this.height>this._$textHeight)switch(this._$verticalAlign){case"middle":l=(this.height-this._$textHeight+2)/2;break;case"bottom":l=this.height-this._$textHeight+2}const c=this._$textData.length;for(let $=0;$<c;++$){const c=this._$textData[$];if(0===c.width)continue;const u=h+c.x;if("none"===this._$autoSize&&(o>a||u>n))continue;const d=c.textFormat,g=Z(c.textFormat._$color),f=r.max(0,r.min(255*g.A*i[3]+i[7],255))/255;if(t.fillStyle=`rgba(${g.R},${g.G},${g.B},${f})`,this._$thickness){const e=Z(this._$thicknessColor),s=r.max(0,r.min(255*e.A*i[3]+i[7],255))/255;t.lineWidth=this._$thickness,t.strokeStyle=`rgba(${e.R},${e.G},${e.B},${s})`}const m=c.yIndex;switch(c.mode){case"break":case"wrap":if(_++,this._$scrollV>_)continue;if(o+=this._$textHeightTable[m],h=this._$getAlignOffset(this._$objectTable[m],s),d._$underline){const s=c.textFormat._$size/12,n=Z(d._$color),a=r.max(0,r.min(255*n.A*i[3]+i[7],255))/255;t.lineWidth=r.max(1,1/r.min(e[0],e[3])),t.strokeStyle=`rgba(${n.R},${n.G},${n.B},${a})`,t.beginPath(),t.moveTo(h,l+o-s),t.lineTo(h+this._$widthTable[m],l+o-s),t.stroke()}break;case"text":{if(this._$scrollV>_)continue;let e=o-this._$heightTable[0];_e||(e+=c.textFormat._$size/12*2),t.beginPath(),t.textBaseline="top",t.font=tt(d._$font,d._$size,d._$italic,d._$bold),this._$thickness&&t.strokeText(c.text,u,l+e),t.fillText(c.text,u,l+e)}break;case"image":if(!c.loaded)continue;t.beginPath(),t.drawImage(c.image,c.hspace,l+c.y,c.width,c.height)}}}_$getAlignOffset(t,e){const i=this._$widthTable[t.yIndex],s=t.textFormat,n=s._$blockIndent+s._$leftMargin>0?s._$blockIndent+s._$leftMargin:0;switch(!0){case!this._$wordWrap&&i>e:return r.max(0,n);case"center"===s._$align:case"center"===this._$autoSize:return r.max(0,e/2-n-s._$rightMargin-i/2);case"right"===s._$align:case"right"===this._$autoSize:return r.max(0,e-n-i-s._$rightMargin-2);default:return r.max(0,n+2)}}_$remove(){this._$xMin=0,this._$yMin=0,this._$xMax=0,this._$yMax=0,this._$textData.length=0,this._$widthTable.length=0,this._$heightTable.length=0,this._$objectTable.length=0,this._$textHeightTable.length=0,this._$textAreaActive=!1,super._$remove(),$e.push(this)}_$updateProperty(t){this._$textAreaActive=!!t.textAreaActive,this._$textData.length=0,this._$widthTable.length=0,this._$heightTable.length=0,this._$objectTable.length=0,this._$textHeightTable.length=0,this._$textData.push(...t.textData),this._$widthTable.push(...t.widthTable),this._$heightTable.push(...t.heightTable),this._$objectTable.push(...t.objectTable),this._$textHeightTable.push(...t.textHeightTable),this._$wordWrap=t.wordWrap,this._$limitWidth=t.limitWidth,this._$limitHeight=t.limitHeight,this._$autoSize=t.autoSize,this._$scrollV=t.scrollV,this._$textHeight=t.textHeight,this._$verticalAlign=t.verticalAlign,this._$border=t.border,this._$border&&(this._$borderColor=t.borderColor),this._$background=t.background,this._$background&&(this._$backgroundColor=t.backgroundColor),"thickness"in t&&(this._$thickness=t.thickness,this._$thicknessColor=t.thicknessColor)}_$update(t){super._$update(t),this._$textAreaActive=!!t.textAreaActive,this._$xMin=t.xMin,this._$yMin=t.yMin,this._$xMax=t.xMax,this._$yMax=t.yMax,t.textData&&this._$updateProperty(t)}}class oe extends gt{constructor(){super(),this._$imageBitmap=null,this._$context=null,this._$smoothing=!0,this._$cacheKeys=U(),this._$cacheParams=U(0,0,0)}_$clip(t,e){const i=this._$xMax,s=this._$yMax;if(!i||!s)return;let r=e;const n=this._$matrix;1===n[0]&&0===n[1]&&0===n[2]&&1===n[3]&&0===n[4]&&0===n[5]||(r=H(e,n)),t.reset(),t.setTransform(r[0],r[1],r[2],r[3],r[4],r[5]),t.beginPath(),t.moveTo(0,0),t.lineTo(i,0),t.lineTo(i,s),t.lineTo(0,s),t.lineTo(0,0),t.clip(),r!==e&&N(r)}_$draw(t,e,i){if(!this._$visible||!this._$imageBitmap||!this._$context)return;let n=i;const a=this._$colorTransform;1===a[0]&&1===a[1]&&1===a[2]&&1===a[3]&&0===a[4]&&0===a[5]&&0===a[6]&&0===a[7]||(n=W(i,a));const o=G(n[3]+n[7]/255,0,1,0);if(!o)return void(n!==i&&L(n));let _=e;const l=this._$matrix;1===l[0]&&0===l[1]&&0===l[2]&&1===l[3]&&0===l[4]&&0===l[5]||(_=H(e,l));const c=this._$getBounds();B(c);const $=q(c,_),u=+$.xMax,d=+$.xMin,g=+$.yMax,f=+$.yMin;B($);const m=r.ceil(r.abs(u-d)),p=r.ceil(r.abs(g-f));switch(!0){case 0===m:case 0===p:case m===-1/0:case p===-1/0:case m===s:case p===s:return}let x=+r.sqrt(_[0]*_[0]+_[1]*_[1]);if(!h.isInteger(x)){const t=x.toString(),e=t.indexOf("e");-1!==e&&(x=+t.slice(0,e)),x=+x.toFixed(4)}let b=+r.sqrt(_[2]*_[2]+_[3]*_[3]);if(!h.isInteger(b)){const t=b.toString(),e=t.indexOf("e");-1!==e&&(b=+t.slice(0,e)),b=+b.toFixed(4)}const v=this._$filters,T=null!==v&&v.length>0&&this._$canApply(v);let A=F(0,m,0,p);if(T&&v)for(let t=0;t<v.length;++t)A=v[t]._$generateFilterRect(A,x,b);const M=t.frameBuffer,y=M.currentAttachment;if(!y||d-A.xMin>y.width||f-A.yMin>y.height)return void B(A);if(0>d+A.xMax||0>f+A.yMax)return void B(A);if(B(A),!this._$cacheKeys.length||this._$cacheParams[0]!==x||this._$cacheParams[1]!==b||this._$cacheParams[2]!==i[7]){const t=U();t[0]=x,t[1]=b,this._$cacheKeys=rt.generateKeys(this._$instanceId,t,i),D(t),this._$cacheParams[0]=x,this._$cacheParams[1]=b,this._$cacheParams[2]=i[7]}if(t.cachePosition=rt.get(this._$cacheKeys),!t.cachePosition){const e=r.ceil(r.abs(this._$xMax-this._$xMin)),i=r.ceil(r.abs(this._$yMax-this._$yMin)),s=M.createCachePosition(e,i);t.cachePosition=s,rt.set(this._$cacheKeys,s)}this._$context.drawImage(this._$imageBitmap,0,0);const E=M.textureManager._$createFromElement(this._$imageBitmap.width,this._$imageBitmap.height,this._$context.canvas,this._$smoothing);let C=0,S=0;if(T&&v){const e=M.currentAttachment,i=M.createCacheAttachment(m,p);t._$bind(i),t.reset();const s=P(x,0,0,b,m/2,p/2),r=P(1,0,0,1,-E.width/2,-E.height/2),n=H(s,r);N(s),N(r),t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]),t.drawImage(E,0,0,E.width,E.height);const a=M.getTextureFromCurrentAttachment();t._$bind(e),M.releaseAttachment(i),t.drawTextureFromRect(E,t.cachePosition);const h=this._$drawFilter(t,_,v,m,p,a);h.offsetX&&(C=h.offsetX),h.offsetY&&(S=h.offsetY),t.cachePosition=h,t.setTransform(1,0,0,1,d-C,f-S)}else t.drawTextureFromRect(E,t.cachePosition),t.setTransform(_[0],_[1],_[2],_[3],_[4],_[5]);t.cachePosition&&(t.globalAlpha=o,t.imageSmoothingEnabled=!0,t.globalCompositeOperation=this._$blendMode,t.drawInstance(d-C,f-S,u,g,i),t.cachePosition=null),_!==e&&N(_),n!==i&&L(n)}_$remove(){this._$xMin=0,this._$yMin=0,this._$xMax=0,this._$yMax=0,this._$context=null,this._$imageBitmap=null,this._$smoothing=!0,super._$remove(),de.push(this)}_$updateProperty(t){if(this._$xMin=t.xMin,this._$yMin=t.yMin,this._$xMax=t.xMax,this._$yMax=t.yMax,this._$imageBitmap=t.imageBitmap,this._$smoothing=t.smoothing,!this._$context&&this._$imageBitmap){const t=new c(this._$imageBitmap.width,this._$imageBitmap.height);this._$context=t.getContext("2d")}}_$update(t){super._$update(t),this._$updateProperty(t)}}let _e=!1;const le=new class{constructor(){this._$instances=new Map,this._$matrix=P(1,0,0,1,0,0),this._$width=0,this._$height=0,this._$stage=new ft,this._$canvas=null,this._$context=null,this._$attachment=null}get instances(){return this._$instances}get context(){return this._$context}get scaleX(){return this._$matrix[0]}stop(){rt.reset()}_$initialize(e,i){let s=0;var r,n;this._$setStage(e[s++]),n=1===e[s++],_e=n,r=e[s++],t=r,this._$canvas=i;const a=i.getContext("webgl2",{stencil:!0,premultipliedAlpha:!0,antialias:!1,depth:!1,preserveDrawingBuffer:!0});if(a){const t=new re(a,e[s++]);this._$context=t,rt.context=t}}_$setBackgroundColor(t){if(!this._$context)return;const e=t[0];if(-1===e)this._$context._$setColor(0,0,0,0);else{const t={A:(i=e)>>>24,R:(16711680&i)>>16,G:(65280&i)>>8,B:255&i};this._$context._$setColor(t.R/255,t.G/255,t.B/255,1)}var i}_$bitmapDraw(t,e,i,s){const r=this._$context;if(!r)return;r._$bind(this._$attachment),r.reset(),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,this._$width,this._$height),r.beginPath(),t._$draw(r,e,i),r.frameBuffer.transferToMainTexture();const n=s.getContext("2d");n&&this._$canvas&&n.drawImage(this._$canvas,0,0)}_$draw(){if(!this._$width||!this._$height)return;const t=this._$context;t&&(t.reset(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this._$width,this._$height),t.beginPath(),this._$stage._$draw(t,this._$matrix,m),this._$stage._$updated=!1,t.drawInstacedArray(),t.frameBuffer.transferToMainTexture())}_$resize(t){let e=0;const i=t[e++],s=t[e++];if(this._$width=i,this._$height=s,!this._$canvas)return;if(this._$canvas.width===i&&this._$canvas.height===s)return;const r=this._$context;if(!r)return;const n=t[e++];this._$matrix[0]=n,this._$matrix[3]=n,this._$matrix[4]=t[e++],this._$matrix[5]=t[e++],this._$stage._$updated=!0,rt.reset(),r.clearInstacedArray(),this._$canvas.width=i,this._$canvas.height=s,r._$gl.viewport(0,0,i,s);const a=r.frameBuffer;this._$attachment&&(a.unbind(),a.releaseAttachment(this._$attachment,!0)),this._$attachment=a.createCacheAttachment(i,s,!0),r.setMaxSize(i,s),r._$bind(this._$attachment)}_$setStage(t){this._$stage._$instanceId=t,this._$instances.set(t,this._$stage)}_$updateStage(){this._$stage._$updated=!0}_$createDisplayObjectContainer(t){const e=ge();let i=0;e._$instanceId=t[i++],e._$parentId=t[i++],this._$setProperty(e,t,2),this._$instances.set(e._$instanceId,e)}_$setProperty(t,e,i){t._$visible=1===e[i++],t._$depth=e[i++],t._$clipDepth=e[i++],t._$isMask=1===e[i++],1===e[i++]?(t._$maskId=e[i++],t._$maskMatrix||(t._$maskMatrix=P()),t._$maskMatrix[0]=e[i++],t._$maskMatrix[1]=e[i++],t._$maskMatrix[2]=e[i++],t._$maskMatrix[3]=e[i++],t._$maskMatrix[4]=e[i++],t._$maskMatrix[5]=e[i++]):(t._$maskId=-1,t._$maskMatrix&&(N(t._$maskMatrix),t._$maskMatrix=null),i+=7),t._$visible?(t._$matrix[0]=e[i++],t._$matrix[1]=e[i++],t._$matrix[2]=e[i++],t._$matrix[3]=e[i++],t._$matrix[4]=e[i++],t._$matrix[5]=e[i++],t._$colorTransform[0]=e[i++],t._$colorTransform[1]=e[i++],t._$colorTransform[2]=e[i++],t._$colorTransform[3]=e[i++],t._$colorTransform[4]=e[i++],t._$colorTransform[5]=e[i++],t._$colorTransform[6]=e[i++],t._$colorTransform[7]=e[i++]):(i+=6,i+=8),t._$blendMode=st(e[i++]),e[i++]?t._$scale9Grid={x:e[i++],y:e[i++],w:e[i++],h:e[i++]}:t._$scale9Grid=null,t._$blendMode=st(e[i++]),e[i++]?t._$scale9Grid={x:e[i++],y:e[i++],w:e[i++],h:e[i++]}:t._$scale9Grid=null}_$registerShapeRecodes(t,e){this._$instances.has(t)||this._$instances.set(t,pe()),this._$instances.get(t)._$recodes=e}_$createShape(t){let e=0;const i=t[e++];this._$instances.has(i)||this._$instances.set(i,pe());const s=this._$instances.get(i);s._$instanceId=i,s._$parentId=t[e++],s._$maxAlpha=t[e++],s._$canDraw=1===t[e++],s._$xMin=t[e++],s._$yMin=t[e++],s._$xMax=t[e++],s._$yMax=t[e++],s._$characterId=t[e++],s._$loaderInfoId=t[e++],this._$setProperty(s,t,10)}_$createVideo(t){const e=me();t.characterId&&(e._$characterId=t.characterId),"loaderInfoId"in t&&(e._$loaderInfoId=t.loaderInfoId||0),e._$updateProperty(t),this._$instances.set(e._$instanceId,e)}_$createTextField(t){const e=fe();e._$xMin=t.xMin||0,e._$yMin=t.yMin||0,e._$xMax=t.xMax||0,e._$yMax=t.yMax||0,t.characterId&&(e._$characterId=t.characterId),"loaderInfoId"in t&&(e._$loaderInfoId=t.loaderInfoId||0),e._$updateProperty(t),this._$instances.set(e._$instanceId,e)}},ce=[],$e=[],ue=[],de=[],ge=()=>ue.pop()||new ft,fe=()=>$e.pop()||new he,me=()=>de.pop()||new oe,pe=()=>ce.pop()||new ae;const xe=new class{constructor(){this.state="deactivate",this.queue=[],this._$options=[]}execute(){this.state="active";let t=!0;for(;this.queue.length;){const e=this.queue.shift();if(console.log(e),e){switch(t=!0,e.command){case"draw":le._$draw();break;case"setProperty":if(!le.instances.has(e.instanceId))continue;break;case"setChildren":{t=!1;const i=e.buffer,s=le.instances;if(!s.has(i[0]))continue;const r=s.get(i[0]);r._$doChanged(),r._$children=i.subarray(1)}break;case"remove":{const t=le.instances;if(!t.has(e.instanceId))continue;t.get(e.instanceId)._$remove(),t.delete(e.instanceId)}break;case"createShape":le._$createShape(e.buffer);break;case"createDisplayObjectContainer":le._$createDisplayObjectContainer(e.buffer);break;case"createTextField":le._$createTextField(e);break;case"createVideo":le._$createVideo(e);break;case"resize":le._$resize(e.buffer);break;case"initialize":le._$initialize(e.buffer,e.canvas);break;case"setBackgroundColor":le._$setBackgroundColor(e.buffer);break;case"stop":le.stop();break;case"removeCache":rt.removeCache(e.id);break;case"bitmapDraw":{const t=le.instances;if(!t.has(e.sourceId))continue;const i=t.get(e.sourceId),s=new c(e.width,e.height);le._$bitmapDraw(i,e.matrix||f,e.colorTransform||m,s);const r=s.transferToImageBitmap();globalThis.postMessage({command:"bitmapDraw",sourceId:e.sourceId,imageBitmap:r},[r])}break;default:if(e.command.indexOf("shapeRecodes")>-1){t=!1;const i=+e.command.split("@")[1];le._$registerShapeRecodes(i,e.buffer)}}e.buffer&&t&&(this._$options.length=0)}}this.state="deactivate"}};self.addEventListener("message",(t=>{return e=void 0,i=void 0,r=function*(){xe.queue.push(t.data),"deactivate"===xe.state&&xe.execute()},new((s=void 0)||(s=Promise))((function(t,n){function a(t){try{o(r.next(t))}catch(t){n(t)}}function h(t){try{o(r.throw(t))}catch(t){n(t)}}function o(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(a,h)}o((r=r.apply(e,i||[])).next())}));var e,i,s,r}))})();',tu=()=>("OffscreenCanvas"in window&&(X=new OffscreenCanvas(0,0).getContext("webgl2")!==null?new Worker(URL.createObjectURL(new Blob([l0],{type:"text/javascript"}))):null,X=null,X&&(Fn=e=>{e._$createWorkerInstance(),e._$postProperty();const i=e._$needsChildren?e._$getChildren():e._$children,r=A();for(let n=0;n<i.length;++n){const a=i[n];if(a){if(r.push(a._$instanceId),"_$children"in a){Fn(a);continue}a._$createWorkerInstance(),a._$postProperty()}}e._$postChildrenIds(r),V(r)})),new Promise(s=>{const t=navigator.userAgentData;if(t)t.getHighEntropyValues(["platform","mobile"]).then(e=>{const i=e.brands;for(let r=0;r<i.length&&i[r].brand.indexOf("Chrome")===-1;++r);Kr=e.platform==="Android",qr=e.platform==="iOS",Ke=Kr||qr,s()});else{const e=navigator.userAgent;Kr=e.indexOf("Android")>-1,qr=e.indexOf("iPhone")>-1||e.indexOf("iPod")>-1,e.indexOf("Chrome")>-1,e.indexOf("Firefox")>-1,Yl=e.indexOf("Chrome")===-1&&e.indexOf("Safari")>-1,Ke=Kr||qr,s()}}));"next2d"in window||(console.log("%c Next2D Player %c 1.18.11 %c https://next2d.app","color: #fff; background: #5f5f5f","color: #fff; background: #4bc729",""),window.next2d=new e0([new Promise(s=>{if(document.readyState==="loading"){const t=()=>{window.removeEventListener("DOMContentLoaded",t),tu().then(()=>{nt()._$initializeCanvas(),s()})};window.addEventListener("DOMContentLoaded",t)}else tu().then(()=>{nt()._$initializeCanvas(),s()})})]));const h0=async()=>{};class E{static get MOUSE_DOWN(){return"pointerdown"}static get MOUSE_UP(){return"pointerup"}static get MOUSE_MOVE(){return"pointermove"}static get START(){return"start"}static get END(){return"end"}static get CHANGE(){return"change"}static get MOUSE_OVER(){return"pointerover"}static get MOUSE_OUT(){return"pointerout"}static get KEY_DOWN(){return"keydown"}static get MOUSE_LEAVE(){return"pointerleave"}}let vn=null;const d0=()=>vn,zl=s=>{vn&&vn.dispatchEvent(E.END),vn=s,s.dispatchEvent(E.START)},$0=new Map,_0=s=>{$0.set(s.name,s)};let Hl="up";const f0=()=>Hl,jl=s=>{Hl=s},Kl="stage",g0="stage-area",Ro="screen",ql="screen-tab-area",m0="screen-tab-list",p0="screen-tab-menu-name-list",b0=(s,t)=>`
<div draggable="true" id="tab-id-${s}" data-tab-id="${s}" class="tab disable">
    <p id="tab-text-id-${s}" data-tab-id="${s}" data-detail="{{}}" data-shortcut-key="ArrowLeftCtrl" data-shortcut-text="Ctrl +  or " data-area="global">${t}</p>
    <i id="tab-delete-id-${s}" data-tab-id="${s}" data-detail="{{}}"></i>
</div>
`,x0=(s,t)=>`<div id="tab-menu-id-${s}" data-tab-id="${s}">${t}</div>`,_s=s=>document.getElementById(`tab-id-${s}`),fs="user-setting",_i="shortcut-setting-menu",me="progress-container",As="detail-modal",fi="screen-tab-menu",ai="screen-menu",y0="screen-order-menu",E0="screen-align-menu",Sn="timeline-menu",wn="timeline-header-menu",lr="timeline-layer-menu",Mn="library-menu",mr="editor-modal",Fo="billing-modal",pe="confirm-modal",Pn="scene-name-menu";let kn=new Map;const T0=()=>kn,v0=s=>{kn=new Map(s)},be=s=>kn.has(s)&&kn.get(s)||s,S0=(s,...t)=>{if(!t.length)return"";for(let e=0;e<t.length;++e)s=s.replace(`%s${e+1}`,t[e]);return s},na="__next2d-tools__",w0=1,Zl=`${na}@user-setting`,Jl=`${na}@language-setting`,Po=`${na}@shortcut`,Je="save-data",Ql="local",th="billing",gs=()=>{const s=localStorage.getItem(Zl);return s?JSON.parse(s):{layer:!1,type:"zlib",modal:!0}},Nn=new Map,M0=s=>{Nn.set(s.name,s)},Z=s=>Nn.has(s)?Nn.get(s):null,I0=()=>Nn,z=(s="")=>{const t=I0();for(const e of t.values())e.name!==s&&e.hide()},Dn=()=>{const s=Z(As);s&&s.hide()};let eh=null;const sh=()=>eh,ih=s=>{eh=s},rh=new Map,ko=()=>{rh.clear()},No=()=>rh,nh=new Map,ah=()=>{nh.clear()},es=()=>nh,oh=new Map,Do=()=>oh,Sr=()=>{oh.clear()};let ch=!1;const uh=s=>{ch=s},A0=()=>ch,L0=s=>{if(!gs().modal)return;const e=document.getElementById(As);if(!e||e.classList.contains("fadeIn"))return;const i=s.currentTarget;if(!i||!i.dataset.detail)return;let r=be(i.dataset.detail);const n=i.dataset.shortcutKey;if(n){let c=i.dataset.shortcutText;const u=es();if(u.size&&u.has(n)){const l=u.get(n);l&&(c=l.text)}r+=` (${c})`}e.textContent!==r&&(e.textContent=r);const a=Z(As);if(!a)return;switch(!0){case e.clientWidth+s.pageX-20>window.innerWidth:a.offsetLeft=s.pageX-(e.clientWidth+s.pageX+10-window.innerWidth);break;case 0>s.pageX-20:a.offsetLeft=10;break;default:a.offsetLeft=s.pageX-20;break}switch(!0){case e.clientHeight+s.pageY+20>window.innerHeight:a.offsetTop=s.pageY-e.clientHeight-20;break;default:a.offsetTop=s.pageY+20;break}const o=setTimeout(()=>{Dn()},1500);e.dataset.timerId=`${o}`,Dn(),a.show()},C0=()=>{if(!gs().modal)return;const t=document.getElementById(As);if(!t||t.classList.contains("fadeOut"))return;const e=parseFloat(t.dataset.timerId);clearTimeout(e),t.setAttribute("class","fadeOut")},lh=async s=>{const t=s.querySelectorAll("[data-detail]"),e=t.length;for(let i=0;i<e;++i){const r=t[i];r&&(r.addEventListener(E.MOUSE_OVER,L0),r.addEventListener(E.MOUSE_OUT,C0))}},O0=async s=>{const t=be("{{}}");window.confirm(t)&&s.remove()},wr=s=>document.getElementById(`tab-menu-id-${s}`),Ti=s=>document.getElementById(`tab-text-id-${s}`),hh=new Map,ee=(s,t)=>{hh.set(s,t)},B0=()=>hh,Xt=(s,t=null)=>{let e=s.length===1?s.toLowerCase():s;return t&&(t.shift&&(e+="Shift"),t.alt&&(e+="Alt"),t.ctrl&&(e+="Ctrl")),e};let dh=!1;const Ye=s=>{dh=s},ss=()=>dh,R0=(s,t)=>{s.contentEditable="true",t.style.borderBottom="1px solid #f5f5f5",s.focus(),Ye(!0)},F0=s=>{const t=Ti(s);if(!t)return;const e=_s(s);e&&(z(),R0(t,e))};let Ya=!1;const P0=s=>{s.stopPropagation();const t=s.target;if(!t)return;const e=k(parseInt(t.dataset.tabId));e&&(Ya?(s.preventDefault(),F0(e.id)):(Ya=!0,setTimeout(()=>{Ya=!1},300),e.active||xc(e)))},$h=()=>{const s=Z(fi);s&&s.hide()},k0=s=>{s.active?$h():xc(s)},N0=s=>{if(s.key!=="Enter")return;s.stopPropagation(),s.preventDefault();const t=s.currentTarget;t&&t.blur()},D0=100,Mr="history-list",vi=0,Si=1,wi=2,Mi=3,Ii=4,_h=5,fh=6,Ai=7,Li=8,gh=9,mh=10,ph=11,Ci=12,bh=13,Oi=14,Bi=15,Ri=16,Fi=17,Pi=18,ki=19,Ni=20,Di=21,Ui=22,Yi=23,Xi=24,Wi=25,Ps=26,aa=27;let hr=null;const st=()=>hr!==null||location.hash!=="",oa=()=>hr,Uo=s=>{hr&&hr.close(),hr=s};let xh=!1;const U0=s=>{xh=s},Un=()=>xh;let yh=!1;const Y0=()=>{yh=!0},X0=()=>yh,St=s=>{const t=document.getElementById(Mr);if(!t)return;const e=s.histories.length;if(s.historyIndex!==e)for(let i=s.historyIndex;i<e;++i){const r=t.lastElementChild;r&&r.remove()}},W0="https://language.next2d.app",V0="language",Eh="__@",G0=(s,t,e,...i)=>`
<div data-index="${t}" data-library-id="${s}">
    <span class="language" data-text="{{${e}}}" data-args="${i.join(Eh)}">${e}</span> 
</div>
`;let pr="";const z0=()=>{if(pr)return pr;const s=new Date,t=s.getFullYear(),e=("0"+String(s.getMonth()+1)).slice(-2),i=("0"+String(s.getDate())).slice(-2);return`${t}-${e}-${i}`},Th=s=>{pr=s},H0=()=>pr?new Date(pr).getTime()>new Date().getTime():!1,Vi=()=>H0(),Ir=()=>{const s=Z(Fo);s&&s.show()},dt=s=>{const t=oa();if(!t)return;const e={roomId:location.hash.replace("#",""),historyCommand:s.command,data:s.messages,command:"receive"};t.send(JSON.stringify(e))},j0=(s,t)=>{const e=k(s);if(e){if(e.active){const i=Ti(e.id);if(!i)return;const r=wr(e.id);if(!r)return;r.textContent=i.textContent=t}e.name=t}},K0=(s,t,e,i="",r="")=>{const n=k(s);if(!n)return null;const a=n.getLibrary(t);if(!a)return null;const o=a.createLayer();return i&&(o.name=i),r&&(o.color=r),a.setLayer(o,e),o},q0=270,vh=13,Yo=30,Sh=5,wh=260,qe=112,ms="timeline",Z0="label-name",Gi="timeline-controller-base",J0="context-menu-script-add-one",Q0="timeline-header",Xo="timeline-adjustment-x",tg="timeline-adjustment-y",Wo="timeline-content",Mh="timeline-marker",eg="timeline-marker-border",Vo="current-frame",Ih="timeline-scroll-bar-x",Go="timeline-scroll-bar-y",sg="timeline-scale",ig="timeline-layer-add",rg="timeline-layer-trash",ng="timeline-layer-light-all",ag="timeline-layer-disable-all",og="timeline-layer-lock-all",cg="timeline-script-add",Ah=860,eu=150,ug=600,lg=4,Lh=13,zo=271,hg=0,dg=1,Ch=2,$g=3,_g=4,fg="scene-name",Oh="scene-list",Ar="scene-name-menu-list",gg="timeline-key-add",Yn="target-group";let su="auto";const kt=(s="auto")=>{su!==s&&(su=s,document.documentElement.style.setProperty("--tool-cursor",s))},he=(s,t,e)=>{const i=+s;return Math.min(Math.max(t,isNaN(i)||!isFinite(i)?0:i),e)},mg=s=>{},pg=s=>{},bo=[],ca=()=>bo.length?bo.shift():document.createElement("canvas"),Ls=s=>{s.width=s.height=1,s.setAttribute("class",""),s.setAttribute("style",""),bo.push(s)},iu=s=>`
<div class="frame-header-parent" data-frame="${s}">
    <div class="frame-sec ${s%5===0?"frame-border-end":"frame-border"}"></div>
    <div class="frame-border-box"></div>
    <div class="frame-border-box"></div>
    <div class="frame-border-box"></div>
    <div class="frame-number">${s%5===0?s:""}</div>
</div>
`,Lr=()=>{const s=document.getElementById(Gi);s&&($t.clientWidth=s.clientWidth)},Bh=s=>{const t=document.getElementById(sg);if(!t)return;const i=M().timelineAreaState;Sh>s||s>wh||(i.frameWidth=s,document.documentElement.style.setProperty("--timeline-frame-width",`${s}px`),t.value=`${Math.floor(s/vh*100)}`)},ks=()=>{Lr(),ac()},Et=s=>{switch(s){case vi:return"%s1%s2";case Si:return"%s1%s2";case wi:return"%s1%s2";case Mi:return"%s1%s2";case Ii:return"%s1%s2";case Ai:return"%s1%s2";case Li:return"%s1%s2%s3";case Ci:return"%s1";case Oi:return"%s1%s2";case Bi:return"%s1%s2";case Fi:return"%s1";case Ri:return"%s1";case Pi:return"%s1";case ki:return"%s1";case Ni:return"%s1";case Di:return"%s1";case Ui:return"%s1";case Yi:return"MovieClip%s1";case Xi:return"%s1";case Wi:return"%s1%s2";case Ps:return"%s1%s2";case aa:return"%s1%s2%s3"}return""},bg=(s,t,e,i,r)=>({command:Li,messages:[s,t.id,e,i,r],args:[t.name,i,r]}),xg=(s,t,e,i,r=!1)=>{St(s);const n=t.layers.indexOf(e),a=bg(s.id,t,n,e.name,i);s.active&&Tt(t.id,s.historyIndex,Et(Li),"",...a.args),s.addHistory(a),!r&&st()&&dt(a)},ua=s=>{const t=K.elements[s.getDisplayIndex()];if(!t)return;const e=t.querySelector(".identification-view-text");e&&e.textContent!==s.name&&(e.textContent=s.name)},Ho=(s,t,e,i,r=!1)=>{xg(s,t,e,i,r),e.name=i,s.active&&t.active&&ua(e)},yg=(s,t,e,i)=>({command:gh,messages:[s,t,e,i],args:[]}),Cr=s=>{const t=K.elements[s.getDisplayIndex()];if(!t)return;const e=t.querySelector(".timeline-layer-lock-one");e&&(s.lock?(e.classList.remove("icon-disable"),e.classList.add("icon-active")):(e.classList.remove("icon-active"),e.classList.add("icon-disable")))},Eg=(s,t,e,i,r=!1)=>{const n=new lt(s,t,e),a=yg(s.id,t.id,n.index,i);e.lock=i,s.active&&t.active&&Cr(e),!r&&st()&&dt(a)},Tg=(s,t,e,i)=>({command:mh,messages:[s,t,e,i],args:[]}),Or=s=>{const t=K.elements[s.getDisplayIndex()];if(!t)return;const e=t.querySelector(".timeline-layer-disable-one");e&&(s.disable?(e.classList.remove("icon-disable"),e.classList.add("icon-active")):(e.classList.remove("icon-active"),e.classList.add("icon-disable")))},vg=(s,t,e,i,r=!1)=>{const n=new lt(s,t,e),a=Tg(s.id,t.id,n.index,i);e.disable=i,s.active&&t.active&&Or(e),!r&&st()&&dt(a)},Sg=(s,t,e,i)=>({command:ph,messages:[s,t,e,i],args:[]}),Ns=s=>{const t=K.elements[s.getDisplayIndex()];if(!t)return;t.style.borderBottom=s.light?`1px solid ${s.color}`:"";const e=t.querySelector(".timeline-layer-light-one");if(!e)return;const i=e.children[0];s.light?(i.style.display="none",e.style.backgroundImage=`url('${s.getHighlightURL()}')`):(i.style.display="",e.style.backgroundImage="")},wg=(s,t,e,i,r=!1)=>{const n=new lt(s,t,e),a=Sg(s.id,t.id,n.index,i);e.light=i,s.active&&t.active&&Ns(e),!r&&st()&&dt(a)},Mg=(s,t,e,i)=>({command:Ps,messages:[s,t.id,t.layers.indexOf(e),i,e.color],args:[t.name,e.name]}),Ig=(s,t,e,i,r=!1)=>{St(s);const n=Mg(s.id,t,e,i);s.active&&Tt(t.id,s.historyIndex,Et(Ps),"",...n.args),s.addHistory(n),!r&&st()&&dt(n)},la=s=>{const t=K.elements[s.getDisplayIndex()];if(!t)return;const e=t.querySelector(".timeline-layer-light-one");if(!e)return;const i=e.children[0];i.style.backgroundColor=s.color},Rh=(s,t,e,i,r=!1)=>{const n=e.color;e.color=i,Ig(s,t,e,n,r),s.active&&t.active&&(la(e),e.light&&Ns(e))},jo=0,Ht=1,ps=2,jt=3,bs=4,ha="normal",Ko="mask",Fh="mask_in",qo="guide",Ph="guide_in",Ag=s=>{switch(s){case Ht:return"timeline-mask-icon";case ps:return"timeline-mask-in-icon";case jt:return"timeline-guide-icon";case bs:return"timeline-guide-in-icon";default:return"timeline-layer-icon"}},Cs=s=>{const t=K.elements[s.getDisplayIndex()];if(!t)return;const e=Ag(s.mode),i=t.querySelector(".identification-class");if(!i)return;const r=i.classList;for(let a=0;a<r.length;++a){const o=r[a];o!=="identification-class"&&o!==e&&i.classList.remove(o)}i.classList.contains(e)||i.classList.add(e);const n=t.querySelector(".identification-view-text");if(n)switch(s.mode){case 2:case 4:n.classList.contains("view-text")&&n.classList.remove("view-text"),n.classList.contains("view-in-text")||n.classList.add("view-in-text");break;default:n.classList.contains("view-text")||n.classList.add("view-text"),n.classList.contains("view-in-text")&&n.classList.remove("view-in-text");break}},Lg=s=>{switch(s){case Ko:return Ht;case Fh:return ps;case qo:return jt;case Ph:return bs;default:return jo}},Cg=(s,t,e,i,r,n,a)=>({command:Ps,messages:[s,t.id,t.layers.indexOf(e),i,e.mode,r,e.parentId,n],args:[t.name,e.name,a]}),kh=s=>{switch(s){case Ht:return Ko;case ps:return Fh;case jt:return qo;case bs:return Ph;default:return ha}},Og=(s,t,e,i,r,n,a=!1)=>{St(s);const o=Cg(s.id,t,e,i,r,n,kh(e.mode));s.active&&Tt(t.id,s.historyIndex,Et(aa),"",...o.args),s.addHistory(o),!a&&st()&&dt(o)},Bg=(s,t,e,i,r=!1)=>{const n=e.mode,a=e.parentId,o=Lg(i);if(n===o)return;const c=[];switch(e.mode){case Ht:case jt:{const u=t.layers.indexOf(e);for(let l=u+1;l<t.layers.length;++l){const h=t.layers[l];if(h.parentId!==e.id)break;c.push(l),h.clearRelation()}}break}e.clearRelation(),e.mode=o,Og(s,t,e,n,a,c,r),s.active&&t.active&&Cs(e)};class lt{_$layer;_$workSpace;_$movieClip;constructor(t,e,i){this._$workSpace=t,this._$movieClip=e,this._$layer=i}get name(){return this._$layer.name}set name(t){t||(t="Layer"),this._$layer.name!==t&&Ho(this._$workSpace,this._$movieClip,this._$layer,t)}get index(){return this._$movieClip.layers.indexOf(this._$layer)}isSelected(){return this._$movieClip.selectedLayers.indexOf(this._$layer)>-1}getLock(){return this._$layer.lock}setLock(t,e=!1){Eg(this._$workSpace,this._$movieClip,this._$layer,t,e)}getDisable(){return this._$layer.disable}setDisable(t,e=!1){vg(this._$workSpace,this._$movieClip,this._$layer,t,e)}getLight(){return this._$layer.light}setLight(t,e=!1){wg(this._$workSpace,this._$movieClip,this._$layer,t,e)}updateLightColor(t){Rh(this._$workSpace,this._$movieClip,this._$layer,t)}get layerType(){return kh(this._$layer.mode)}set layerType(t){Bg(this._$workSpace,this._$movieClip,this._$layer,t)}}const Nh=(s,t,e,i)=>{const r=Le(e);if(!r)return;const n=new lt(s,t,r),a=t.selectedStartFrame,o=t.selectedEndFrame,c=e.children,u=c.length;for(let l=0;l<u;++l){const h=c[l];if(!h)continue;const $=i+l,_=[];_.push("frame"),$%5===0&&_.push("frame-pointer"),n.isSelected()&&a>0&&$>=a&&o>$&&_.push("frame-active"),h.setAttribute("data-frame",`${$}`),h.setAttribute("data-frame-state","empty"),h.setAttribute("class",_.join(" "))}},Rg=(s,t)=>`
<div class="${t%5!==0?"frame":"frame frame-pointer"}" data-frame-state="empty" data-layer-index="${s}" data-frame="${t}"></div>
`,Zo=(s,t,e,i,r)=>{for(let n=t;n<e;++n)s.insertAdjacentHTML("beforeend",Rg(i,r+n))},Dh=()=>{const s=M(),t=s.scene,e=t.layers;if(!e.length)return;const i=s.timelineAreaState.frameWidth+1,r=s.timelineAreaState.frameHeight,n=mt(),a=Math.ceil($t.clientWidth/i)+1;let o=0;for(let c=Ae();e.length>c;++c){const l=e[c].getDisplayIndex(),h=K.elements[l];if(!h)continue;const $=h.lastElementChild,_=$.children.length;if(a>_&&Zo($,_,a,l,n),Nh(s,t,$,n),o+=r,o>K.clientHeight)break}},Uh=()=>{const s=M(),t=s.scene,e=$t.clientWidth,i=s.timelineAreaState.frameWidth+1,r=e/(Us()*i);document.documentElement.style.setProperty("--timeline-scroll-bar-width",`${Math.floor(e*r)-2}px`);const n=tc();t.scrollX>n&&(t.scrollX=n)},Jo=()=>{const s=document.getElementById(Ih);if(!s)return;const t=M(),e=t.scene,i=$t.clientWidth,r=t.timelineAreaState.frameWidth+1,n=i/(Us()*r);s.style.left=`${Math.floor(e.scrollX*n)+1}px`},Ds=()=>{Lr(),Uh(),Jo(),Dh()};class Fg{_$clientWidth;constructor(){this._$clientWidth=0}async initialize(){this._$clientWidth=Lh}get clientWidth(){return this._$clientWidth}set clientWidth(t){this._$clientWidth=t}}const Qo=new Fg,Yh=s=>{s=he(s,lg,Lh),Qo.clientWidth=s,document.documentElement.style.setProperty("--marker-width",`${s}px`)};let Zr="";const is=()=>{const s=document.getElementById(Mh);if(!s)return;const t=document.getElementById(eg);if(!t)return;const i=M().scene.currentFrame-mt(),r=M(),n=i*(r.timelineAreaState.frameWidth+1);if(0>i||Math.abs(n)>$t.clientWidth){if(Zr!=="")return;Zr="none",s.style.display="none",t.style.display="none"}else Zr==="none"&&(Zr="",s.style.display="",t.style.display=""),s.style.left=`${n}px`,document.documentElement.style.setProperty("--timeline-marker-border-left",`${Math.floor((Qo.clientWidth-1)/2)+n}px`)},Xh=s=>{const t=s.deltaY;if(!t)return;const i=M().timelineAreaState;if(Sh>i.frameWidth+t||i.frameWidth+t>wh)return;const r=i.frameWidth+t;Bh(r),Yh(r),is(),ks(),Ds()},Pg=s=>{s.stopPropagation(),s.preventDefault(),s.altKey?requestAnimationFrame(()=>{Xh(s)}):requestAnimationFrame(()=>{zt(s.deltaX||s.deltaY)})},kg=()=>{Lr();const s=document.getElementById(Gi);s&&s.addEventListener("wheel",Pg,{passive:!1})};class Ng{_$clientWidth;_$elements;constructor(){this._$clientWidth=0,this._$elements=[]}get elements(){return this._$elements}initialize(){return new Promise(t=>{kg(),t()})}get clientWidth(){return this._$clientWidth}set clientWidth(t){this._$clientWidth=t}}const $t=new Ng;let Wh="up";const Vh=()=>Wh,da=s=>{Wh=s},mt=()=>{const s=M();return 1+Math.ceil(s.scene.scrollX/(s.timelineAreaState.frameWidth+1))},xs=()=>{const s=M();return mt()+Math.ceil($t.clientWidth/(s.timelineAreaState.frameWidth+1))},Us=()=>M().scene.totalFrame+ug,tc=()=>{const t=M().timelineAreaState.frameWidth+1;return Us()*t-$t.clientWidth},Ae=()=>{const s=M(),t=s.scene.scrollY;return t?Math.ceil(t/s.timelineAreaState.frameHeight):0},Gh=()=>{const s=M(),t=(s.timelineAreaState.frameHeight+1)*s.scene.layers.length;return t>K.clientHeight?t-K.clientHeight:0};let zh=!1;const xt=()=>zh,ut=s=>{zh=s};let Hh=!1;const Dg=()=>Hh,Ug=s=>{Hh=s};let jh=!1;const Yg=()=>jh,Xg=s=>{jh=s};let Kh=!1;const Wg=()=>Kh,Vg=s=>{Kh=s};let qh=!1;const Zh=()=>qh,Jh=s=>{qh=s};let Qh=!1;const td=()=>Qh,ed=s=>{Qh=s},Le=s=>M().scene.layers[Ae()+parseInt(s.dataset.layerIndex)],Gg=(s,t=0)=>({start:s,end:he(t,s+1,Number.MAX_VALUE)});let sd=!1;const id=s=>{sd=s},rd=()=>sd,Is=s=>{const t=document.getElementById(Vo);t&&(t.value=`${s}`,M().scene.currentFrame=s)},zg=s=>{Is(s),is()},Hg=(s,t)=>{const e=K.elements[t.getDisplayIndex()];if(!e)return;e.classList.remove("active");const i=mt(),r=s.selectedStartFrame,n=s.selectedEndFrame;if(!r)return;const o=e.lastElementChild.children,c=o.length;for(let u=r;n>u;++u){const l=u-i;if(l>c)continue;const h=o[l];h&&h.classList.remove("frame-active")}},jg=(s,t,e)=>{s.active&&t.active&&new lt(s,t,e).isSelected()&&Hg(t,e),t.deactivatedLayer(e)},ec=s=>{s.classList.contains("active")||s.classList.add("active")},Kg=s=>{const t=K.elements[s.getDisplayIndex()];t&&ec(t)},qg=(s,t,e)=>{for(let i=0;i<e.length;++i){const r=e[i],n=t.layers[r];n&&(t.selectedLayers.indexOf(n)===-1&&t.selectedLayers.push(n),s.active&&t.active&&Kg(n))}},Zg=s=>{s.classList.contains("frame-active")||s.classList.add("frame-active")},Jg=(s,t)=>{const e=mt();for(let i=0;i<s.selectedLayers.length;++i){const r=s.selectedLayers[i],n=K.elements[r.getDisplayIndex()];if(!n)continue;n.classList.contains("active")||n.classList.add("active");const o=n.lastElementChild.children,c=o.length;for(let u=0;t.length>u;++u){const h=t[u]-e;if(h>c)continue;const $=o[h];!$||$.classList.contains("frame-active")||Zg($)}}},sc=s=>{const t=mt(),e=s.selectedStartFrame,i=s.selectedEndFrame;for(let r=0;r<s.selectedLayers.length;++r){const n=s.selectedLayers[r],a=K.elements[n.getDisplayIndex()];if(!a||(a.classList.contains("active")&&a.classList.remove("active"),!e))continue;const c=a.lastElementChild.children,u=c.length;for(let l=e;i>l;++l){const h=l-t;if(h>u)continue;const $=c[h];!$||!$.classList.contains("frame-active")||$.classList.remove("frame-active")}}},Qg=s=>{Cs(s),ua(s),la(s),Ns(s),Or(s),Cr(s)},tm=(s,t)=>`
<div class="timeline-content-child" data-layer-index="${s}" style="display: none;">
    <div class="timeline-layer-controller" data-layer-index="${s}">
        <i style="display: none;" class="timeline-exit-icon" data-layer-index="${s}"></i>
        <i style="display: none;" class="timeline-insert-icon" data-layer-index="${s}"></i>
        <i class="timeline-layer-icon identification-class" data-layer-index="${s}" data-detail="{{()}}"></i>
        <div class="view-text identification-view-text" data-layer-index="${s}">${t.name}</div>
        <i class="timeline-layer-light-one" data-layer-index="${s}" data-detail="{{}}"><span style="background-color:#000000;"></span></i>
        <i class="timeline-layer-disable-one icon-disable" data-layer-index="${s}" data-detail="{{}}"></i>
        <i class="timeline-layer-lock-one icon-disable" data-layer-index="${s}" data-detail="{{}}"></i>
    </div>

    <div class="timeline-frame-controller" data-layer-index="${s}"></div>
</div>
`,em=s=>{s.button===0&&(s.stopPropagation(),z())},nd="timeline-layer-color",ad="timeline-layer-normal",od="timeline-layer-mask",cd="timeline-layer-guide",ud="timeline-layer-scale",sm=s=>{const t=Le(s);if(!t)return;const e=document.getElementById(nd);e&&(e.value=t.color)},im=s=>{const t=document.getElementById(ad);if(!t)return;const e=document.getElementById(od);if(!e)return;const i=document.getElementById(cd);if(i)switch(s.mode){case jo:t.setAttribute("style","opacity:0.5; pointer-events:none;"),e.setAttribute("style",""),i.setAttribute("style","");break;case Ht:t.setAttribute("style",""),e.setAttribute("style","opacity:0.5; pointer-events:none;"),i.setAttribute("style","");break;case jt:t.setAttribute("style",""),e.setAttribute("style",""),i.setAttribute("style","opacity:0.5; pointer-events:none;");break;default:t.setAttribute("style","opacity:0.5; pointer-events:none;"),e.setAttribute("style","opacity:0.5; pointer-events:none;"),i.setAttribute("style","opacity:0.5; pointer-events:none;");break}},ld=s=>{s.stopPropagation(),s.preventDefault(),z(lr);const t=Z(lr);if(!t)return;const e=document.getElementById(lr);if(!e)return;const i=s.currentTarget;if(!i)return;const r=Le(i);if(!r)return;const n=M(),a=n.scene,o=new Ot(n,a),c=new lt(n,a,r);o.selectedLayers([c.index]),im(r),sm(i);let u=s.pageY-e.clientHeight;0>u&&(u=15),t.offsetLeft=s.pageX+15,t.offsetTop=u,t.show()},rm=s=>{if(s.button!==0)return;s.stopPropagation(),z();const t=s.target;if(!t)return;const e=Le(t);if(!e)return;const i=M();new lt(i,i.scene,e).setLight(!e.light),Ns(e)},nm=s=>{Ye(!0),s.contentEditable="true",s.style.borderBottom="1px solid #f5f5f5",s.focus()};let Jr=!1,Qr=-1;const am=s=>{switch(!0){case s.button!==0:case ss():case s.altKey:case s.metaKey:case s.shiftKey:return}const t=s.target;if(!t)return;z();const e=parseInt(t.dataset.layerIndex);!Jr||e!==Qr?(Jr=!0,Qr=e,setTimeout(()=>{Jr=!1,Qr=-1},300)):(Jr=!1,Qr=-1,s.preventDefault(),s.stopPropagation(),nm(t))},om=s=>{if(s.key!=="Enter")return;s.stopPropagation(),s.preventDefault();const t=s.currentTarget;t&&t.blur()};let tr=!1;const cm=s=>{if(s.button!==0){tr=!1;return}z(lr),tr?(tr=!1,ld(s)):(tr=!0,setTimeout(()=>{tr=!1},300))},hd=s=>{s.classList.contains("active")&&s.classList.remove("active")},um=(s,t)=>{const e=K.elements[t.getDisplayIndex()];if(!e)return;const i=s.selectedLayers.indexOf(t);i===-1?(s.selectedLayers.push(t),ec(e)):(s.selectedLayers.splice(i,1),hd(e))},lm=(s,t)=>{const e=s.selectedLayers.length?s.selectedLayers[0]:t,i=s.layers.indexOf(t),r=s.layers.indexOf(e),n=Math.min(i,r),a=Math.max(i,r),o=[r];for(let u=n;u<=a;++u)u!==r&&o.push(u);new Ot(M(),s).selectedLayers(o)};let dd=!1;const hm=()=>dd,br=s=>{dd=s};let $d=0;const $a=()=>$d,Os=s=>{$d=s},gi=()=>{const s=document.getElementById(Go);if(!s)return;const t=M(),e=t.scene,i=K.clientHeight,r=t.timelineAreaState.frameHeight,n=i/(e.layers.length*r);s.style.top=`${Math.floor(e.scrollY*n)+1}px`},ke=s=>{if(!s)return!1;const e=M().scene;if(!e.scrollY&&0>s)return!1;const i=e.scrollY,r=he(i+s,0,Gh());if(i===r)return!1;const n=Ae();return e.scrollY=r,gi(),n===Ae()||Xe(),!0},Xn=(s,t=!1)=>{s.stopPropagation(),s.preventDefault(),kt("grabbing");const e=M().timelineAreaState,i=$a()+qe,r=i+e.height-qe-12;if(s.pageY<i){requestAnimationFrame(()=>{if(!(t&&!xt())){if(!ke(-2)){ut(!1);return}(t||!xt())&&(t||ut(!0),Xn(s,!0))}});return}if(s.pageY>r){requestAnimationFrame(()=>{if(!(t&&!xt())){if(!ke(2)){ut(!1);return}(t||!xt())&&(t||ut(!0),Xn(s,!0))}});return}ut(!1)},xo=s=>{const t=s.querySelector(".timeline-insert-icon");t&&t.setAttribute("style","display: none;");const e=s.querySelector(".timeline-exit-icon");e&&e.setAttribute("style","display: none;")},_d=s=>{const t=s.querySelector(".timeline-exit-icon");t&&t.setAttribute("style","display: none;")},fd=s=>{s.classList.contains("move-target")&&s.classList.remove("move-target")},ru=s=>{const t=K.elements[s.getDisplayIndex()];t&&(fd(t),xo(t),_d(t))},gd=s=>{s.stopPropagation(),s.preventDefault(),kt("auto"),id(!1),window.removeEventListener(E.MOUSE_MOVE,Xn),window.removeEventListener(E.MOUSE_UP,gd);const t=M(),e=t.scene;if(!e.layers.length)return;for(let n=0;n<e.selectedLayers.length;++n){const a=e.selectedLayers[n];a&&ru(a)}if(K.distIndex===-1)return;const i=e.layers[K.distIndex];if(!i)return;ru(i),new Ot(t,e).behindLayer(K.distIndex),K.distIndex=-1},dm=()=>{window.addEventListener(E.MOUSE_MOVE,Xn),window.addEventListener(E.MOUSE_UP,gd)},md=s=>{const t=s.querySelector(".timeline-exit-icon");t&&t.setAttribute("style","")},$m=s=>{if(s.button!==0)return;const t=s.currentTarget;if(!t)return;const e=Le(t);if(!e)return;const i=M(),r=i.scene;switch(!0){case(s.altKey||s.metaKey):um(r,e);break;case s.shiftKey:lm(r,e);break;default:if(r.selectedLayers.indexOf(e)===-1){const n=new lt(i,r,e);new Ot(i,r).selectedLayers([n.index])}switch(e.mode){case 2:case 4:md(t);break}break}K.distIndex=-1,id(!0),dm()},_m=s=>{Ye(!1);const t=s.target;t&&(t.contentEditable="false",t.style.borderBottom="")},fm=s=>{_m(s);const t=s.target;if(!t)return;const e=Le(t);if(!e)return;let i=t.textContent;if(i||(i="Layer"),e.name===i)return;const r=M();Ho(r,r.scene,e,i)},pd=()=>{ed(!1),window.removeEventListener(E.MOUSE_UP,pd)},gm=s=>{if(s.button!==0)return;s.stopPropagation(),z(),td()||(ed(!0),window.addEventListener(E.MOUSE_UP,pd));const t=s.target;if(!t)return;const e=Le(t);if(!e)return;const i=M();new lt(i,i.scene,e).setDisable(!e.disable),Or(e)},mm=s=>{if(!td())return;const t=s.currentTarget;if(!t)return;const e=Le(t);if(!e)return;const i=M();new lt(i,i.scene,e).setDisable(!e.disable),Or(e)},bd=()=>{Jh(!1),window.removeEventListener(E.MOUSE_UP,bd)},pm=s=>{if(s.button!==0)return;s.stopPropagation(),z(),Zh()||(Jh(!0),window.addEventListener(E.MOUSE_UP,bd));const t=s.target;if(!t)return;const e=Le(t);if(!e)return;const i=M();new lt(i,i.scene,e).setLock(!e.lock),Cr(e)},bm=s=>{if(!Zh())return;const t=s.currentTarget;if(!t)return;const e=Le(t);if(!e)return;const i=M();new lt(i,i.scene,e).setLock(!e.lock),Cr(e)},xm=s=>{const t=s.querySelector(".timeline-insert-icon");t&&t.setAttribute("style","")},xd=s=>{s.classList.contains("move-target")||s.classList.add("move-target")},ym=s=>{if(!rd())return;s.stopPropagation();const t=s.currentTarget;if(!t)return;const e=t.parentElement;if(!e)return;const i=parseInt(e.dataset.layerIndex)+Ae(),n=M().scene,a=n.layers[i];if(!(n.selectedLayers.indexOf(a)>-1))switch(K.distIndex=parseInt(e.dataset.layerIndex)+Ae(),xd(e),a.mode){case Ht:case ps:case jt:case bs:xm(e);break}},Em=s=>{if(!rd())return;s.stopPropagation();const t=s.currentTarget;if(!t)return;const e=t.parentElement;if(!e)return;const i=parseInt(e.dataset.layerIndex)+Ae(),n=M().scene,a=n.layers[i];if(!(n.selectedLayers.indexOf(a)>-1))switch(e.classList.contains("move-target")&&e.classList.remove("move-target"),K.distIndex=-1,a.mode){case Ht:case jt:xo(e);break;case ps:case bs:_d(e),xo(e);break}},Tm=s=>{s.stopPropagation();const t=s.target;if(!t)return;const e=parseInt(t.dataset.layerIndex),i=K.elements[e];i&&(t.style.opacity="1",K.distIndex=e+Ae(),xd(i))},vm=s=>{if(s.stopPropagation(),K.distIndex===-1)return;const t=s.target;if(!t)return;const e=parseInt(t.dataset.layerIndex),i=K.elements[e];i&&(K.distIndex=-1,md(i),fd(i))},Sm=s=>{s.addEventListener("contextmenu",ld),s.addEventListener(E.MOUSE_DOWN,$m),s.addEventListener(E.MOUSE_OVER,ym),s.addEventListener(E.MOUSE_OUT,Em);const t=s.querySelector(".timeline-layer-icon");t&&t.addEventListener(E.MOUSE_DOWN,cm);const e=s.querySelector(".timeline-exit-icon");e&&(e.addEventListener(E.MOUSE_OVER,Tm),e.addEventListener(E.MOUSE_OUT,vm));const i=s.querySelector(".identification-view-text");i&&(i.addEventListener(E.MOUSE_DOWN,am),i.addEventListener("focusout",fm),i.addEventListener("keypress",om));const r=s.querySelector(".timeline-layer-light-one");r&&r.addEventListener(E.MOUSE_DOWN,rm);const n=s.querySelector(".timeline-layer-disable-one");n&&(n.addEventListener(E.MOUSE_DOWN,gm),n.addEventListener(E.MOUSE_OVER,mm));const a=s.querySelector(".timeline-layer-lock-one");a&&(a.addEventListener(E.MOUSE_DOWN,pm),a.addEventListener(E.MOUSE_OVER,bm))},wm=s=>{s.stopPropagation(),s.preventDefault(),z(Sn);const t=Z(Sn);if(!t)return;const e=document.getElementById(Sn);if(!e)return;let i=s.pageY-e.clientHeight;0>i&&(i=15),t.offsetLeft=s.pageX+15,t.offsetTop=i,t.show()},ie="tools",Mm="arrow",Im="bucket",Am="circle",yd="setting",Lm="export",Cm="free-transform",Om="hand",Bm="load",Rm="save",Fm="pen",Pm="rectangle",km="round-rect",Nm="shape-transform",Dm="text",Um="zoom-minus",Ym="zoom-plus",ic=`${ie}-${yd}`,Xm="screen-scale",zi=45,Xa=(s,t,e,i)=>{const r=new Ot(s,t);r.selectedLayers(e),t.selectedFrameObject.end=i;const n=t.selectedStartFrame,a=t.selectedEndFrame,o=Array.from({length:a-n},(c,u)=>u+n);r.selectedFrames(o)},ei=(s,t=!1)=>{s.stopPropagation(),s.preventDefault();const e=M(),i=e.scene,r=e.timelineAreaState;let n=r.offsetLeft;r.state==="fixed"&&(n=e.toolAreaState.state==="fixed"?zi:0);const a=r.frameWidth+1,o=zo+n,c=o,u=$t.clientWidth+o,l=$a()+qe,h=l+r.height-qe-12;if(s.pageY<l){requestAnimationFrame(()=>{if(!(t&&!xt())){if(!ke(-2)){ut(!1);return}(t||!xt())&&(t||ut(!0),ei(s,!0))}});return}if(s.pageY>h){requestAnimationFrame(()=>{if(!(t&&!xt())){if(!ke(2)){ut(!1);return}(t||!xt())&&(t||ut(!0),ei(s,!0))}});return}if(s.pageX>u){requestAnimationFrame(()=>{if(!(t&&!xt())){if(!zt(a)){ut(!1);return}if(t||!xt()){t||ut(!0);const $=[];for(let _=0;i.selectedLayers.length>=_;++_){const g=new lt(e,i,i.selectedLayers[_]);$.push(g.index)}Xa(e,i,$,i.selectedFrameObject.end+1),ei(s,!0)}}});return}if(s.pageX<c){requestAnimationFrame(()=>{if(!(t&&!xt())){if(!zt(-a)){ut(!1);return}if(t||!xt()){t||ut(!0);const $=[];for(let _=0;i.selectedLayers.length>=_;++_){const g=new lt(e,i,i.selectedLayers[_]);$.push(g.index)}Xa(e,i,$,i.selectedFrameObject.end-1),ei(s,!0)}}});return}ut(!1),requestAnimationFrame(()=>{const $=s.target;if(!$)return;const _=$.dataset.frame,g=$.dataset.layerIndex;if(!_||!g)return;const f=i.selectedLayers[0],m=i.layers.indexOf(f),p=parseInt(g)+Ae(),x=Math.min(p,m),b=Math.max(p,m),T=[m];for(let y=x;b>=y;++y)m!==y&&T.push(y);Xa(e,i,T,parseInt(_))})},Ed=s=>{s.stopPropagation(),da("up"),ut(!1),window.removeEventListener(E.MOUSE_MOVE,ei),window.removeEventListener(E.MOUSE_UP,Ed)},Wm=(s,t,e,i)=>{const r=new lt(s,t,e),n=new Ot(s,t);n.selectedLayers([r.index]),n.selectedFrames([i]),t.selectedFrameObject.start=i,t.selectedFrameObject.end=i,window.addEventListener(E.MOUSE_MOVE,ei),window.addEventListener(E.MOUSE_UP,Ed)};class Vm{_$x;_$y;_$moveX;_$moveY;_$pageX;_$pageY;constructor(){this._$x=0,this._$y=0,this._$moveX=0,this._$moveY=0,this._$pageX=0,this._$pageY=0}get x(){return this._$x}set x(t){this._$x=t}get y(){return this._$y}set y(t){this._$y=t}get pageX(){return this._$pageX}set pageX(t){this._$pageX=t}get pageY(){return this._$pageY}set pageY(t){this._$pageY=t}get moveX(){return this._$moveX}set moveX(t){this._$moveX=t}get moveY(){return this._$moveY}set moveY(t){this._$moveY=t}clear(){this._$x=0,this._$y=0,this._$moveX=0,this._$moveY=0,this._$pageX=0,this._$pageY=0}}const it=new Vm,si=(s,t=!1)=>{s.stopPropagation(),s.preventDefault();const e=M(),i=e.timelineAreaState;let r=i.offsetLeft;i.state==="fixed"&&(r=e.toolAreaState.state==="fixed"?zi:0);const n=i.frameWidth+1,a=i.frameHeight+1,o=zo+r,c=o,u=$t.clientWidth+o,l=Math.min(K.viewCount*a+qe,i.height),h=$a()+qe,$=h+l-qe,_=h+i.height-qe-12;if(s.pageY<h){requestAnimationFrame(()=>{if(!(t&&!xt())){if(!ke(-2)){ut(!1);return}(t||!xt())&&(t||ut(!0),it.y-=1,Math.abs(it.y)>i.frameHeight&&(it.y=0,it.moveY-=a),si(s,!0))}});return}if(s.pageY>_){requestAnimationFrame(()=>{if(!(t&&!xt())){if(!ke(2)){ut(!1);return}(t||!xt())&&(t||ut(!0),it.y+=1,Math.abs(it.y)>i.frameHeight&&(it.y=0,it.moveY+=a),si(s,!0))}});return}if(s.pageX<c){requestAnimationFrame(()=>{if(!(t&&!xt())){if(!zt(-n)){ut(!1);return}(t||!xt())&&(t||ut(!0),it.x-=1,Math.abs(it.x)>i.frameWidth&&(it.x=0,it.moveX-=n),si(s,!0))}});return}if(s.pageX>u){requestAnimationFrame(()=>{if(!(t&&!xt())){if(!zt(n)){ut(!1);return}(t||!xt())&&(t||ut(!0),it.x+=1,Math.abs(it.x)>i.frameWidth&&(it.x=0,it.moveX+=n),si(s,!0))}});return}if(ut(!1),it.x+=s.pageX-it.pageX,it.y+=s.pageY-it.pageY,it.pageX=s.pageX,it.pageY=s.pageY,Math.abs(it.x)>i.frameWidth){const g=it.x>0?1:-1,f=Math.round(Math.abs(it.x)/n),m=n*f*g;it.moveX+=m,it.x=0;const p=document.getElementById(Yn);if(p){const x=p.offsetLeft+m;switch(!0){case u<x+p.clientWidth:zt(n);break;case c>x:zt(-n);break;default:p.style.left=`${x}px`;break}}}if(Math.abs(it.y)>i.frameHeight){const g=it.y>0?1:-1,f=Math.round(Math.abs(it.y)/a),m=a*f*g;it.moveY+=m,it.y=0;const p=document.getElementById(Yn);if(p){const x=p.offsetTop+m;switch(!0){case $<x+p.clientHeight:ke(a);break;case h>x:ke(-a);break;default:p.style.top=`${p.offsetTop+m}px`;break}}}},Gm=()=>{const s=document.getElementById(Yn);s&&(s.style.display="none")},Td=s=>{s.stopPropagation(),ut(!1),Gm(),window.removeEventListener(E.MOUSE_MOVE,si),window.removeEventListener(E.MOUSE_UP,Td)},zm=()=>{window.addEventListener(E.MOUSE_MOVE,si),window.addEventListener(E.MOUSE_UP,Td)},Hm=(s,t)=>{const e=document.getElementById(Yn);if(!e)return;const i=M(),r=i.scene,n=i.timelineAreaState,o=(r.selectedEndFrame-r.selectedStartFrame)*(n.frameWidth+1)-5,c=r.selectedLayers.length*(n.frameHeight+1)-5;let u=Number.MAX_VALUE;for(let x=0;x<r.selectedLayers.length;x++){const b=r.selectedLayers[x];u=Math.min(u,r.layers.indexOf(b))}const l=r.layers[u],h=K.elements[l.getDisplayIndex()];if(!h)return;const $=h.lastElementChild;if(!$)return;const _=r.selectedStartFrame-mt(),g=$.children[_];if(!g)return;it.clear(),it.pageX=s,it.pageY=t,zm();const f=g.offsetTop+$a()+qe;let m=g.offsetLeft;m+=n.state==="fixed"?zi+2:n.offsetLeft+1;let p=`width: ${o}px;`;p+=`height: ${c}px;`,p+=`left: ${m}px;`,p+=`top: ${f}px;`,e.setAttribute("style",p)};let tn=!1,nu;const jm=s=>{if(s.button!==0)return;const t=s.target;if(!t)return;const e=Le(t);if(!e)return;da("down"),z();const i=M(),r=i.scene;if(tn)tn=!1,clearTimeout(nu);else{tn=!0,setTimeout(()=>{tn=!1},300);const n=parseInt(t.dataset.frame);r.selectedLayers.indexOf(e)>-1&&n>=r.selectedStartFrame&&r.selectedEndFrame>n?nu=setTimeout(()=>{Vh()!=="up"&&Hm(s.pageX,s.pageY)},500):Wm(i,r,e,n)}},Km=s=>{s.addEventListener("contextmenu",wm),s.addEventListener(E.MOUSE_DOWN,jm)},qm=(s,t,e,i)=>{const r=K.elements.length;s.insertAdjacentHTML("beforeend",tm(r,t));const n=s.lastElementChild;K.elements.push(n),n.addEventListener(E.MOUSE_DOWN,em);const a=n.firstElementChild;Sm(a);const o=n.lastElementChild;Km(o),Zo(o,0,e,r,i)},Zm=()=>{for(let s=0;s<K.elements.length;++s){const t=K.elements[s];t&&(t.style.display="none")}},Xe=()=>{const s=document.getElementById(Wo);if(!s)return;const t=M(),e=t.scene,i=e.layers;if(!i.length)return;const r=Ae();Zm(),sc(e);const n=t.timelineAreaState.frameHeight,a=t.timelineAreaState.frameWidth+1,o=Math.ceil($t.clientWidth/a)+1,c=mt();K.viewCount=0;let u=0,l=0;for(let h=r;i.length>h;++h){const $=i[h];let _=null,g=null;if(K.elements.length>l){_=K.elements[l],g=_.lastElementChild;const f=g.children.length;o>f&&Zo(g,f,o,l,c)}else qm(s,$,o,c),_=s.lastElementChild,g=_.lastElementChild;if(_.style.display="",K.viewCount++,Nh(t,e,g,c),Qg($),e.selectedLayers.indexOf($)>-1?ec(_):hd(_),u+=n,u>K.clientHeight)break;l++}K.numberOfDisplays=l},Jm=(s,t,e,i,r,n,a)=>({command:Wi,messages:[s,t.id,i,r,n,e.mode,a,e.parentId],args:[t.name,e.name]}),rc=(s,t,e,i,r,n,a,o=!1)=>{St(s);const c=Jm(s.id,t,e,i,r,n,a);s.active&&Tt(t.id,s.historyIndex,Et(Wi),"",...c.args),s.addHistory(c),!o&&st()&&dt(c)},nc=(s,t,e)=>{const i=[],r=s.layers;for(let n=e;n<r.length;++n){const a=r[n];if(i.indexOf(a)>-1)continue;if(a.parentId!==t.id){if(n>e+1)break;continue}r.splice(n,1);const o=r.indexOf(t);r.splice(o+i.length+1,0,a),i.push(a),--n}return i.length},Qm=(s,t,e)=>{const i=t.layers,r=t.selectedLayers.slice();r.sort((o,c)=>i.indexOf(o)-i.indexOf(c));const n=new Map;let a=0;for(let o=0;o<r.length;o++){const c=r[o];if(c.parentId!==-1){if(!n.has(c.parentId)){let _=i.indexOf(c)-1;for(;_>-1;--_){const g=t.layers[_];if(g.id===c.parentId&&r.indexOf(g)!==-1){r.splice(o,1),o-=1,n.set(g.id,!0);break}}}if(n.has(c.parentId))continue}const u=i.indexOf(c);i.splice(u,1);const l=i.indexOf(e)+a+o+1;if(u===l){i.splice(u,0,c);continue}i.splice(l,0,c);const h=c.mode,$=c.parentId;switch(c.mode){case Ht:case jt:a+=nc(t,c,u);break;default:c.clearRelation();break}rc(s,t,c,u,i.indexOf(c),h,$)}s.active&&t.active&&Xe()},vd=(s,t,e)=>{const i=t.layers,r=i[e],n=t.selectedLayers.slice();for(let c=0;c<n.length;c++)switch(n[c].mode){case Ht:case jt:return}n.sort((c,u)=>i.indexOf(c)-i.indexOf(u));let a=0;switch(r.mode){case Ht:case ps:a=2;break;case jt:case bs:a=4;break}const o=r.parentId===-1?r.id:r.parentId;for(let c=0;c<n.length;c++){const u=n[c],l=i.indexOf(u);i.splice(l,1);const h=i.indexOf(r)+c+1;if(l===h){if(i.splice(l,0,u),u.mode===r.mode||u.parentId===o)continue}else i.splice(h,0,u);const $=u.mode,_=u.parentId;u.mode=a,u.parentId=o,rc(s,t,u,l,h,$,_),s.active&&t.active&&Cs(u)}s.active&&t.active&&Xe()},tp=(s,t,e)=>{const r=t.layers[e];let n=!1;for(let a=0;a<t.selectedLayers.length;++a){const o=t.selectedLayers[a];if(o.parentId!==r.parentId)continue;const c=new lt(s,t,o);c.layerType=ha,n=!0}n||vd(s,t,e)},ep=(s,t,e)=>{if(!t.selectedLayers.length)return;const r=t.layers[e];switch(r.mode){case Ht:case jt:vd(s,t,e);break;case ps:case bs:tp(s,t,e);break;default:Qm(s,t,r);break}},sp=(s,t,e,i)=>({command:vi,messages:[s,t.id,i,e.name,e.color],args:[t.name,e.name]}),ip=(s,t,e,i=!1)=>{St(s);const r=t.layers.indexOf(e),n=sp(s.id,t,e,r);s.active&&Tt(t.id,s.historyIndex,Et(vi),"",...n.args),s.addHistory(n),!i&&st()&&dt(n)},rp=(s,t,e=0,i="",r="",n=!1)=>{t.clearSelectedFrame();const a=wd(s,t,e,i,r);return a?(ip(s,t,a,n),new lt(s,t,a)):null},au=(s,t,e,i)=>({command:Si,messages:[s,t.id,e,i.toObject()],args:[t.name,i.name]}),np=(s,t,e,i,r=!1)=>{St(s);const n=au(s.id,t,i,e);if(s.active&&Tt(t.id,s.historyIndex,Et(Si),"",...n.args),s.addHistory(n),!r&&st()){const a=au(s.id,t,i,e);a.args.pop(),dt(a)}},ap=(s,t,e,i=!1)=>{const r=[];for(let n=0;n<e.length;++n){const a=e[n],o=t.layers[a];if(!o)return;r.push(o)}for(let n=0;n<r.length;++n){const a=r[n],o=t.layers.indexOf(a);switch(a.mode){case Ht:case jt:for(let c=o+1;c<t.layers.length;++c){const u=t.layers[c];if(u.parentId!==a.id)continue;const l=new lt(s,t,u);l.layerType=ha}break}t.deleteLayer(a),np(s,t,a,o,i)}t.clearSelectedFrame(),s.active&&t.active&&Br()};class Ot{_$workSpace;_$movieClip;constructor(t,e){this._$workSpace=t,this._$movieClip=e}convertToKeyframes(t,e=0){if(console.log("TODO convertToKeyframes"),!this._$movieClip.selectedLayers.length)return;const i=Gg(t,e);console.log(i)}changeFrame(t){t=he(t,1,Number.MAX_VALUE),this._$workSpace.active&&this._$movieClip.active&&zg(t),this._$movieClip.currentFrame=t,this.deactivatedAllLayers()}addNewLayer(t=0,e="",i="",r=!1){this.deactivatedAllLayers();const n=rp(this._$workSpace,this._$movieClip,t,e,i,r);return n?(this.selectedLayers([n.index]),n):null}deleteLayer(t,e=!1){this.deactivatedLayer(t),ap(this._$workSpace,this._$movieClip,t,e),this.selectedLayers([Math.min(...t,this._$movieClip.layers.length-1)])}editMovieClip(t){return this._$movieClip===t?Promise.resolve():(this._$movieClip=t,this._$workSpace.active?t.run():Promise.resolve())}selectedLayers(t){this.deactivatedAllLayers(),qg(this._$workSpace,this._$movieClip,t)}selectedFrames(t){this._$movieClip.selectedLayers.length&&this._$workSpace.active&&this._$movieClip.active&&Jg(this._$movieClip,t)}deactivatedAllLayers(){this._$workSpace.active&&this._$movieClip.active&&sc(this._$movieClip),this._$movieClip.clearSelectedLayer()}deactivatedLayer(t){for(let e=0;e<t.length;++e){const i=this._$movieClip.layers[t[e]];if(!i)return;jg(this._$workSpace,this._$movieClip,i)}}behindLayer(t){ep(this._$workSpace,this._$movieClip,t)}}const op=s=>{if(s.button!==0)return;s.stopPropagation(),s.preventDefault(),z();const t=s.currentTarget;if(!t)return;const e=M();new Ot(e,e.scene).changeFrame(parseInt(t.dataset.frame))},cp=s=>{const t=s.currentTarget;if(!t)return;const e=t.parentElement;if(!e)return;const i=parseInt(e.dataset.frame);M().scene.hasAction(i)&&(s.stopPropagation(),t.draggable=!0)},ou=s=>{s.addEventListener(E.MOUSE_DOWN,op);const t=s.children[Ch];t&&t.addEventListener(E.MOUSE_DOWN,cp)},up=550,lp=400,hp=60,dp="#ffffff",$p="stage-width",_p="stage-height",Sd="stage-fps",fp="stage-bgColor",gp="stage-lock",mp=(s,t,e)=>{const i=s.children[hg];if(i)if(t%5===0?i.classList.contains("frame-border-end")||i.setAttribute("class","frame-border-end"):i.classList.contains("frame-border")||i.setAttribute("class","frame-border"),t%e===0&&e>4){const r=`${t/e}s`;(!i.textContent||i.textContent!==r)&&(i.textContent=r)}else i.textContent&&(i.textContent="")},pp=(s,t)=>{const e=s.children[dg];if(!e)return;const i=M().scene;i.hasLabel(t)?e.classList.contains("frame-border-box-marker")||(e.setAttribute("class","frame-border-box-marker"),e.textContent=i.getLabel(t)):e.classList.contains("frame-border-box")||(e.setAttribute("class","frame-border-box"),e.textContent="")},ys=(s,t)=>{const e=s.children[Ch];e&&(M().scene.hasAction(t)?e.classList.contains("frame-border-box-action")||e.setAttribute("class","frame-border-box-action"):e.classList.contains("frame-border-box")||e.setAttribute("class","frame-border-box"))},bp=(s,t)=>{const e=s.children[$g];e&&(M().scene.hasSound(t)?e.classList.contains("frame-border-box-sound")||e.setAttribute("class","frame-border-box-sound"):e.classList.contains("frame-border-box")||e.setAttribute("class","frame-border-box"))},xp=(s,t)=>{const e=s.children[_g];if(e)if(t%5===0){const i=`${t}`;(!e.textContent||e.textContent!==i)&&(e.textContent=i)}else e.textContent&&(e.textContent="")},ac=()=>{const s=document.getElementById(Q0);if(!s)return;const e=M().timelineAreaState.frameWidth+1,i=Math.ceil($t.clientWidth/e);if(!s.children.length){const c=i+1;for(let u=1;c>=u;++u){s.insertAdjacentHTML("beforeend",iu(u));const l=s.lastElementChild;l&&(ou(l),$t.elements.push(l))}}if(s.children.length+1>i){const c=i+1;for(;s.children.length>c;){const u=$t.elements.splice(c,1);if(!u||!u.length)break;u[0].remove()}}if(i>s.children.length){const c=s.lastElementChild;if(c&&c.dataset.frame){let u=parseInt(c.dataset.frame);const l=i-s.children.length;for(let h=1;l>=h;++h){s.insertAdjacentHTML("beforeend",iu(u++));const $=s.lastElementChild;$&&(ou($),$t.elements.push($))}}}const r=document.getElementById(Sd);if(!r)return;const n=parseInt(r.value),a=mt(),o=$t.elements.length;for(let c=0;o>c;++c){const u=a+c,l=$t.elements[c];if(!l)continue;parseInt(l.dataset.frame)!==u&&l.setAttribute("data-frame",`${u}`),mp(l,u,n),pp(l,u),ys(l,u),bp(l,u),xp(l,u)}},zt=s=>{if(!s)return!1;const e=M().scene;if(!e.scrollX&&0>s)return!1;const i=e.scrollX,r=he(i+s,0,tc());if(i===r)return!1;const n=mt();return e.scrollX=r,Jo(),n===mt()||(ac(),is(),Dh()),!0},yp=s=>{s.stopPropagation(),s.preventDefault(),s.deltaY?s.altKey?requestAnimationFrame(()=>{Xh(s)}):requestAnimationFrame(()=>{ke(s.deltaY)}):s.deltaX&&requestAnimationFrame(()=>{zt(s.deltaX)})},Ep=()=>{const s=document.getElementById(Wo);s&&s.addEventListener("wheel",yp,{passive:!1})};class Tp{_$clientHeight;_$numberOfDisplays;_$viewCount;_$distIndex;_$elements;constructor(){this._$clientHeight=0,this._$numberOfDisplays=0,this._$elements=[],this._$viewCount=0,this._$distIndex=-1}async initialize(){Ep()}get elements(){return this._$elements}get numberOfDisplays(){return this._$numberOfDisplays}set numberOfDisplays(t){this._$numberOfDisplays=t}get clientHeight(){return this._$clientHeight}set clientHeight(t){this._$clientHeight=t}getLayerElementFromElement(t){return this._$elements[parseInt(t.dataset.layerIndex)]}get viewCount(){return this._$viewCount}set viewCount(t){this._$viewCount=t}get distIndex(){return this._$distIndex}set distIndex(t){this._$distIndex=t}}const K=new Tp;let en="none";const _a=()=>{const s=document.getElementById(Go);if(!s)return;const t=M(),e=t.timelineAreaState,i=K.clientHeight,r=e.frameHeight+1,n=t.scene,a=n.layers.length*r;if(a>i){const o=i/a;document.documentElement.style.setProperty("--timeline-scroll-bar-height",`${Math.floor(i*o)-2}px`);const c=Gh();n.scrollY>c&&(n.scrollY=c,gi()),en==="none"&&(en="",s.style.display="")}else n.scrollY!==0&&(n.scrollY=0,gi()),en||(en="none",s.style.display="none")},Br=()=>{_a(),gi(),Xe()},wd=(s,t,e,i="",r="")=>{const n=K0(s.id,t.id,e,i,r);return n?(s.active&&t.active&&Br(),n):null},vp=(s,t,e,i,r)=>{const n=k(s);if(!n)return;const a=n.getLibrary(t);a&&wd(n,a,e,i,r)},Sp=(s,t,e)=>{const i=k(s);if(!i)return;const r=i.getLibrary(t);if(!r)return;const n=r.layers[e];if(!n)return;new Ot(i,r).deactivatedLayer([e]),r.deleteLayer(n),i.active&&r.active&&Br()},wp=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=r.getLibrary(t);if(!n)return;const a=n.layers[e];a&&(a.name=i,r.active&&n.active&&ua(a))},Md="javascript-internal-list-box",Mp=()=>{const s=document.getElementById(Md);if(!s)return;const t=s.children;for(;t.length;)t[0].remove()},Ip=(s,t)=>`<div data-library-id="${s}" class="internal-parent"><i></i>${t}</div>`,Ap=(s,t)=>{let e=t.name;if(t.folderId){let i=t;for(;i.folderId&&(i=s.getLibrary(i.folderId),!!i);)e=`${i.name}/${e}`}return e};class Rr{_$id;_$name;_$type;_$symbol;_$folderId;constructor(t){this._$id=t.id,this._$type=t.type,this._$name=t.name||"",this._$symbol=t.symbol||"",this._$folderId=t.folderId||0}get id(){return this._$id}get type(){return this._$type}getPath(t){return Ap(t,this)}get name(){return this._$name}set name(t){this._$name=t}get symbol(){return this._$symbol}set symbol(t){this._$symbol=t}get folderId(){return this._$folderId}set folderId(t){this._$folderId=t}remove(){}}const Id=(s,t,e)=>{let i=t.folderId;for(;i;){const r=s.getLibrary(i);if(!r||r.id===e)return!0;i=r.folderId}return!1};class fa extends Rr{_$mode;constructor(t){super(t),this._$mode=t.mode||"close"}get mode(){return this._$mode}set mode(t){this._$mode=t}checkDuplicate(t,e){return Id(t,this,e)}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,mode:this._$mode}}}const re=s=>{const t=Array.from(s.pathMap.keys());t.sort();const e=[],i=[],r=new Map;for(let a=0;a<t.length;++a){const o=t[a];if(!s.pathMap.has(o))continue;const c=s.pathMap.get(o),u=s.getLibrary(c);u&&(i.push(c),u.folderId?(r.has(u.folderId)||r.set(u.folderId,[]),r.get(u.folderId).push(u)):e.push(u))}s.libraries.clear();const n=a=>{for(let o=0;o<a.length;++o){const c=a[o];s.libraries.set(c.id,c),r.has(c.id)&&n(r.get(c.id))}};n(e),s.pathMap.clear();for(let a=0;a<i.length;++a)s.pathMap.set(t[a],i[a])},oc="library-preview-area",ga="library-list-box",Lp="library-menu-container-add",Cp="library-menu-folder-add",Op="library-menu-file",Ad="library-menu-file-input",Bp="library-menu-change-scene",Rp="library-menu-delete",Fp="library-open-photopea",Pp=s=>`
<div draggable="true" class="library-list-box-child" id="library-child-id-${s.id}" data-library-id="${s.id}">
    <div class="library-list-box-spacer" data-library-id="${s.id}"></div>
    <div class="library-list-box-name" data-library-id="${s.id}">
        <i class="library-type-${s.type==="folder"?`arrow ${s.mode}`:"space"}" data-library-id="${s.id}"></i>
        <i class="library-type-${s.type}${s.type==="folder"?`-${s.mode}`:""}" data-library-id="${s.id}"></i>
        <p><span class="view-text" data-library-id="${s.id}">${s.name}</span></p>
    </div>
    <div class="library-list-box-symbol" data-library-id="${s.id}">
        <p><span class="view-symbol-text" data-library-id="${s.id}">${s.symbol}</span></p>
    </div>
</div>`,cc=()=>{const s=j.selectedIds;for(let t=0;t<s.length;++t){const e=document.getElementById(`library-child-id-${s[t]}`);e&&e.classList.remove("active")}},Bs=()=>{const s=document.getElementById(oc);if(s)for(;s.firstElementChild;){const t=s.firstElementChild;t instanceof HTMLCanvasElement&&Ls(t),s.classList.remove("preview-center"),t.remove()}},gt=()=>{cc(),Bs(),j.clear()},kp=s=>{s.button===0&&(s.stopPropagation(),z(),gt())},Fr=()=>{const s=Z(me);s&&(z(me),s.show())},Np="progress-state",Dp="progress-bar",Pr=async s=>{const t=document.getElementById(Np);t&&(t.textContent=s)},uc=()=>{const s=Z(me);s&&s.hide()},Ld=(s,t,e)=>{const i=t.name.split(".");i.pop();const r=i.join("."),n=e?`${e}/${r}`:r;if(!s.pathMap.has(n))return!1;const a=Z(pe);if(!a)return!1;const o=s.pathMap.get(n),c=s.getLibrary(o);return c?(a.fileObjects.push({file:t,instance:c,path:e}),!0):!1},Cd=(s,t="")=>new Promise(e=>{const i=M(),r=new Kt(i);if(s.isDirectory){const n=[];t&&n.push(t),n.push(s.name);const a=n.join("/");r.addNewFolder(a,!1),s.createReader().readEntries(async o=>{for(let c=0;c<o.length;++c)await Cd(o[c],a);e()})}else s.file(async n=>{if(Ld(i,n,t))return e();const a=n.name.split(".");a.pop();const o=a.join(".");await r.importFile(n,o,t,!1),e()})}),ma=()=>{const s=Z(pe);s&&(s.fileObject=null,s.fileObjects.length=0)},Od=()=>{const s=Z(pe);s&&s.fileObjects.length>0&&s.setupFileObject()},Up=async s=>{ma(),Fr(),Pr(be("{{}}"));const t=M();let e="";if(j.selectedIds.length===1){const r=t.getLibrary(j.selectedIds[0]);r&&r.type==="folder"&&(e=r.getPath(t))}const i=[];for(let r=0;r<s.length;++r){const n=s[r].webkitGetAsEntry();n&&i.push(Cd(n,e))}await Promise.all(i),re(t),gt(),Q(),uc(),Od()},Rs=s=>{s.pathMap.clear();for(const t of s.libraries.values())s.pathMap.set(t.getPath(s),t.id)},Bd=()=>{const s=Z(pe);s&&(s.instanceObject=null,s.instanceObjects.length=0)},Yp=()=>{const s=Z(pe);s&&s.instanceObjects.length>0&&s.setupInstanceObject()},Xp=(s,t)=>{const e=t.getPath(s);if(!M().pathMap.has(e))return!1;const r=Z(pe);return r?(r.instanceObjects.push({targetWorkSpaceId:s.id,instanceId:t.id,path:e}),!0):!1},Wp=s=>{const t=s.target;if(!t)return;Bd();const e=M(),i=new Kt(e);let r=!1;const n=j.selectedIds.length;if("libraryId"in t.dataset){const a=parseInt(t.dataset.libraryId),o=e.getLibrary(a);if(!o)return;const c=o.type==="folder"?o:e.getLibrary(o.folderId);for(let u=0;u<n;++u){const l=j.selectedIds[u];if(o.id===l)continue;const h=e.getLibrary(l);if(h){if(c){if(!i.moveToFolder(c.getPath(e),h.getPath(e),!1))continue}else if(!i.outOfFolder(h.getPath(e),!1))continue;r=!0}}}else for(let a=0;a<n;++a){const o=j.selectedIds[a],c=e.getLibrary(o);!c||!c.folderId||Xp(e,c)||!i.outOfFolder(c.getPath(e),!1)||(r=!0)}r&&(Rs(e),re(e),Q()),Yp()},Vp=s=>{if(s.preventDefault(),s.stopPropagation(),!s.dataTransfer)return;const t=s.dataTransfer.items;t.length?Up(t):Wp(s)},Gp=s=>{s.stopPropagation(),s.preventDefault()},Rd=async()=>{if(!j.selectedIds.length)return;z();const s=M(),t=new Kt(s);for(let e=0;e<j.selectedIds.length;++e){const i=j.selectedIds[e],r=s.getLibrary(i);r&&await t.removeItem(r.getPath(s),!1)}gt(),Q()},xr=s=>{const t=document.getElementById(oc);t&&(Bs(),s.getHTMLElement().then(e=>{e&&(e.classList.add("preview-center"),t.appendChild(e))}))},zp=()=>{const s=M();if(2>s.libraries.size)return;const t=new Kt(s);if(j.selectedIds.length){const e=j.selectedIds[j.selectedIds.length-1],i=document.getElementById(`library-child-id-${e}`);if(!i)return;const r=i.nextElementSibling;if(!r)return;const n=parseInt(r.dataset.libraryId),a=s.getLibrary(n);if(!a)return;gt(),a.type!=="folder"?xr(a):Bs(),t.selectedItem(a.getPath(s))}else for(const[e,i]of s.pathMap){if(!i)continue;const r=s.getLibrary(i);if(!r)return;r.type!=="folder"?xr(r):Bs(),t.selectedItem(e);break}},Hp=()=>{const s=M();if(2>s.libraries.size)return;const t=new Kt(s);if(j.selectedIds.length){const e=j.selectedIds[j.selectedIds.length-1],i=document.getElementById(`library-child-id-${e}`);if(!i)return;const r=i.previousElementSibling;if(!r)return;const n=parseInt(r.dataset.libraryId),a=s.getLibrary(n);if(!a)return;gt(),a.type!=="folder"?xr(a):Bs(),t.selectedItem(a.getPath(s))}else for(const[e,i]of s.pathMap){if(!i)continue;const r=s.getLibrary(i);if(!r)return;r.type!=="folder"?xr(r):Bs(),t.selectedItem(e);break}},Fd=async s=>{if(!ss())switch(s.stopPropagation(),s.preventDefault(),s.stopImmediatePropagation(),s.key){case"Backspace":case"Delete":await Rd();break;case"ArrowDown":zp();break;case"ArrowUp":Hp();break}},jp=s=>{s.stopPropagation(),window.addEventListener("keydown",Fd)},cu=s=>{s.stopPropagation(),window.removeEventListener("keydown",Fd)},Kp=()=>{const s=document.getElementById(ga);s&&(s.addEventListener(E.MOUSE_DOWN,kp),s.addEventListener("dragover",Gp),s.addEventListener("drop",Vp),s.addEventListener("dragstart",()=>{}),s.addEventListener("dragend",()=>{}),s.addEventListener(E.MOUSE_OVER,jp),s.addEventListener(E.MOUSE_OUT,cu),s.addEventListener(E.MOUSE_LEAVE,cu))};class qp{_$selectedIds;constructor(){this._$selectedIds=[]}get selectedIds(){return this._$selectedIds}clear(){this._$selectedIds.length=0}initialize(){Kp()}}const j=new qp,ii=s=>{const t=document.getElementById(`library-child-id-${s}`);t&&t.classList.add("active")},ir=s=>{const t=document.getElementById(`library-child-id-${s}`);!t||!t.classList.contains("active")||t.classList.remove("active")},Zp=s=>{const t=j.selectedIds.indexOf(s);t===-1?(j.selectedIds.push(s),ii(s)):(j.selectedIds.splice(t,1),ir(s))},Pd=s=>{j.selectedIds.length=0,j.selectedIds.push(s)},Jp=s=>{if(!j.selectedIds.length){j.selectedIds.push(s),ii(s);return}const e=j.selectedIds[0];if(s===e){cc(),Pd(s),ii(s);return}const i=document.getElementById(ga);if(!i)return;const r=document.getElementById(`library-child-id-${s}`);if(!r)return;const n=document.getElementById(`library-child-id-${e}`);if(!n)return;const a=Array.from(i.children),o=a.indexOf(r),c=a.indexOf(n);if(o>c){let u=n;for(;u&&(u=u.previousElementSibling,!!u);){const h=parseInt(u.dataset.libraryId),$=j.selectedIds.indexOf(h);if($===-1)break;j.selectedIds.splice($,1),ir(h)}let l=r;for(;l&&(l=l.nextElementSibling,!!l);){const h=parseInt(l.dataset.libraryId),$=j.selectedIds.indexOf(h);if($===-1)break;j.selectedIds.splice($,1),ir(h)}for(l=n;l&&(l=l.nextElementSibling,!!l);){const h=parseInt(l.dataset.libraryId);if(j.selectedIds.indexOf(h)>-1){if(h===s)break;continue}if(j.selectedIds.push(h),ii(h),h===s)break}}else{let u=n;for(;u&&(u=u.nextElementSibling,!!u);){const h=parseInt(u.dataset.libraryId),$=j.selectedIds.indexOf(h);if($===-1)break;j.selectedIds.splice($,1),ir(h)}let l=r;for(;l&&(l=l.previousElementSibling,!!l);){const h=parseInt(l.dataset.libraryId),$=j.selectedIds.indexOf(h);if($===-1)break;j.selectedIds.splice($,1),ir(h)}for(l=n;l&&(l=l.previousElementSibling,!!l);){const h=parseInt(l.dataset.libraryId);if(j.selectedIds.indexOf(h)>-1){if(h===s)break;continue}if(j.selectedIds.push(h),ii(h),h===s)break}}},Qp=s=>{if(s.button!==0||(s.stopPropagation(),z(),ss()))return;const t=s.currentTarget;if(!t)return;const e=M(),i=parseInt(t.dataset.libraryId),r=e.getLibrary(i);if(r)switch(r.type!=="folder"?xr(r):Bs(),!0){case(s.altKey||s.metaKey):Zp(i);break;case s.shiftKey:Jp(i);break;default:j.selectedIds.indexOf(i)===-1&&new Kt(e).selectedItem(r.getPath(e));break}},tb=(s,t,e,i,r)=>({command:Oi,messages:[s,t,e,i,r],args:[i,r]}),eb=(s,t,e,i,r=!1)=>{St(s);const n=tb(s.id,t.id,e.id,i,e.name);s.active&&Tt(t.id,s.historyIndex,Et(Oi),"",...n.args),s.addHistory(n),!r&&st()&&dt(n)},kd=async s=>{const t=document.getElementById(fg);t&&(t.textContent=s)},sb=async(s,t)=>{const e=document.getElementById(`scene-library-id-${s}`);e&&(e.textContent=t)},ib="object-name",rb="object-symbol",Nd=async s=>{const t=document.getElementById(ib);t&&(t.value=s)},Dd=(s,t,e,i,r=!1)=>{const n=e.name;if(e.name=i,s.pathMap.has(e.getPath(s)))throw new Error("The same name exists.");e.name=n,s.pathMap.delete(e.getPath(s)),e.name=i,s.pathMap.set(e.getPath(s),e.id),re(s),s.active&&(Q(),e.type==="container"&&(sb(e.id,i),e.active&&(kd(i),Nd(i)))),eb(s,t,e,n,r)},nb=(s,t,e,i)=>({command:Bi,messages:[s,t.id,e.id,i,e.symbol],args:[e.name,e.symbol]}),ab=(s,t,e,i,r=!1)=>{St(s);const n=nb(s.id,t,e,i);s.active&&Tt(t.id,s.historyIndex,Et(Bi),"",...n.args),s.addHistory(n),!r&&st()&&dt(n)},lc=s=>{const t=document.getElementById(`library-child-id-${s.id}`);if(!t)return;const e=t.getElementsByTagName("span");if(!e||!e.length)return;const i=e[1];i.textContent=s.symbol},Ud=async s=>{const t=document.getElementById(rb);t&&(t.value=s)},Yd=(s,t,e,i,r=!1)=>{const n=e.symbol;if(i&&s.symbolMap.has(i))throw new Error("The same symbol exists.");s.symbolMap.delete(n),i&&s.symbolMap.set(i,e.id),e.symbol=i,s.active&&(lc(e),e.type==="container"&&e.active&&Ud(i)),ab(s,t,e,n,r)},Ys=(s,t)=>{s.libraries.delete(t.id),s.pathMap.delete(t.getPath(s)),t.symbol&&s.symbolMap.delete(t.symbol)},uu=(s,t,e)=>({command:Xi,messages:[s,t,e],args:[e.name]}),ob=(s,t,e,i=!1)=>{St(s);const r=uu(s.id,t.id,e.toObject());if(s.active&&Tt(t.id,s.historyIndex,Et(Xi),"",...r.args),s.addHistory(r),!i&&st())switch(e.type){case"bitmap":case"video":case"sound":{const n=e.toObject();n.buffer="";const a=uu(s.id,t.id,n);dt(a)}break;default:dt(r);break}},Xd=async(s,t,e=!0,i=!1)=>{ob(s,s.scene,t,i),Ys(s,t),e&&s.active&&(gt(),Q())};class rs{_$instance;_$workSpace;constructor(t,e){this._$workSpace=t,this._$instance=e}get id(){return this._$instance.id}get type(){return this._$instance.type}get name(){return this._$instance.name}set name(t){Dd(this._$workSpace,this._$workSpace.scene,this._$instance,t)}get symbol(){return this._$instance.symbol}set symbol(t){Yd(this._$workSpace,this._$workSpace.scene,this._$instance,t)}get folderId(){return this._$instance.folderId}set folderId(t){this._$instance.folderId=t}async remove(t=!0){await Xd(this._$workSpace,this._$instance,t)}}const lu=s=>{const t=document.getElementById(`library-child-id-${s.id}`);if(!t)return;const e=t.getElementsByTagName("i");if(!e.length)return;const i=e[0],r=e[1];s.mode==="close"?(i.classList.remove("open"),i.classList.add("close"),r.classList.remove("library-type-folder-open"),r.classList.add("library-type-folder-close")):(i.classList.remove("close"),i.classList.add("open"),r.classList.remove("library-type-folder-close"),r.classList.add("library-type-folder-open"))},hu=(s,t,e)=>({command:bh,messages:[s,t,e],args:[]}),cb=async(s,t)=>{const e=new Kt(s);for(const i of s.libraries.values())i.folderId===t&&await e.removeItem(i.getPath(s),!1)};class pa extends rs{open(t=!1){if(this._$instance.mode="open",this._$workSpace.active&&(lu(this._$instance),Q()),!t&&st()){const e=hu(this._$workSpace.id,this._$instance.id,"open");dt(e)}}close(t=!1){if(this._$instance.mode="close",this._$workSpace.active&&(lu(this._$instance),Q()),!t&&st()){const e=hu(this._$workSpace.id,this._$instance.id,"close");dt(e)}}checkDuplicate(t){return Id(this._$workSpace,this._$instance,t)}async remove(t=!0){await cb(this._$workSpace,this._$instance.id),await super.remove(t)}}const ub=s=>{if(s.button!==0)return;const t=s.currentTarget;if(!t)return;const e=parseInt(t.dataset.libraryId),i=M(),r=i.getLibrary(e),n=new pa(i,r);r.mode==="close"?n.open():n.close()};let sn=!1,rn=-1;const lb=s=>{if(s.button!==0)return;const t=s.currentTarget;if(t)if(!sn)sn=!0,rn=parseInt(t.dataset.libraryId),setTimeout(()=>{rn=-1,sn=!1},300);else{sn=!1;const e=parseInt(t.dataset.libraryId);if(rn!==e)return;rn=-1,s.stopPropagation(),s.preventDefault();const i=M(),r=i.getLibrary(e),n=new pa(i,r);r.mode==="close"?n.open():n.close()}},hb=(s,t,e,i)=>({command:wi,messages:[s,t.id,e,i],args:[t.name,e]}),db=(s,t,e,i,r=!1)=>{St(s);const n=hb(s.id,t,e,i);s.active&&Tt(t.id,s.historyIndex,Et(wi),"",...n.args),s.addHistory(n),!r&&st()&&dt(n)},$b=(s,t,e,i,r)=>({command:Mi,messages:[s,t.id,e,i,r],args:[t.name,e]}),_b=(s,t,e,i,r=!1)=>{St(s);const n=t.getAction(e),a=$b(s.id,t,e,n,i);s.active&&Tt(t.id,s.historyIndex,Et(Mi),"",...a.args),s.addHistory(a),!r&&st()&&dt(a)},fb=(s,t,e,i)=>({command:Ii,messages:[s,t.id,e,i],args:[t.name,e]}),gb=(s,t,e,i=!1)=>{St(s);const r=t.getAction(e),n=fb(s.id,t,e,r);s.active&&Tt(t.id,s.historyIndex,Et(Ii),"",...n.args),s.addHistory(n),!i&&st()&&dt(n)},ba=(s,t,e,i,r=!1)=>{let n=!1;if(i?(t.hasAction(e)?t.getAction(e)!==i&&(_b(s,t,e,i,r),s.active&&(n=!0)):(db(s,t,e,i,r),s.active&&(n=!0)),t.setAction(e,i)):t.hasAction(e)&&(gb(s,t,e,r),t.deleteAction(e),s.active&&(n=!0)),n&&Es(),s.active&&t.active&&mt()<=e&&xs()>=e){const a=$t.elements[e-mt()];if(!a)return;ys(a,e)}};class Hi extends rs{_$externalTimeline;constructor(t,e){super(t,e),this._$externalTimeline=new Ot(t,e)}get active(){return this._$instance.active}get timeline(){return this._$externalTimeline}get currentFrame(){return this._$instance.currentFrame}set currentFrame(t){this._$instance.currentFrame=t}get layers(){const t=this._$instance.layers,e=[];for(let i=0;i<t.length;++i)e.push(new lt(this._$workSpace,this._$instance,t[i]));return e}getAction(t){return this._$instance.getAction(t)}setAction(t,e=""){ba(this._$workSpace,this._$instance,t,e)}}class mb{_$scenes;constructor(){this._$scenes=[]}get scenes(){return this._$scenes}addSceneId(t){this._$scenes.indexOf(t)>-1||this._$scenes.push(t)}}const Fs=new mb,hc=()=>{if(!Fs.scenes.length)return;const s=document.getElementById(Ar);if(s){for(;s.children.length;)s.children[0].remove();Fs.scenes.length=0}},pb=s=>`
<div id="scene-library-id-${s.id}" data-library-id="${s.id}">${s.name}</div>
`,bb=()=>{const s=Z(Pn);s&&s.hide()},xb=s=>{const t=document.getElementById(Ar);if(t)for(;Fs.scenes.length;){const e=Fs.scenes.pop(),i=t.lastElementChild;if(!i||(i.remove(),e===s))break}},yb=async s=>{if(s.button!==0)return;s.stopPropagation(),bb();const t=s.target;if(!t)return;const e=M(),i=parseInt(t.dataset.libraryId),r=e.getLibrary(i);if(!r||r.type!=="container")return;xb(i),await new ds(e).runMovieClip(new Hi(e,r))},dc=()=>{hc();const s=document.getElementById(Ar);if(!s)return;const t=M();s.insertAdjacentHTML("beforeend",pb(t.root)),Fs.scenes.push(0);const e=s.lastElementChild;e&&e.addEventListener(E.MOUSE_DOWN,yb)};let nn=!1,an=-1;const Eb=async s=>{if(s.button!==0)return;const t=s.currentTarget;if(t)if(!nn)nn=!0,an=parseInt(t.dataset.libraryId),setTimeout(()=>{an=-1,nn=!1},300);else{nn=!1;const e=parseInt(t.dataset.libraryId);if(an!==e)return;an=-1,s.stopPropagation(),s.preventDefault();const i=M(),r=i.getLibrary(e);dc(),await new ds(i).runMovieClip(new Hi(i,r))}},Wd=s=>{s.contentEditable="true",s.style.borderBottom="1px solid #f5f5f5",s.focus(),Ye(!0)};let on=!1,cn=-1;const Tb=s=>{switch(!0){case s.button!==0:case ss():case s.altKey:case s.metaKey:case s.shiftKey:return}const t=s.currentTarget;if(!t)return;const e=parseInt(t.dataset.libraryId);!on||cn!==e?(on=!0,cn=e,setTimeout(()=>{on=!1,cn=-1},300)):(on=!1,cn=-1,s.stopPropagation(),s.preventDefault(),Wd(t))},du=s=>{if(s.key!=="Enter")return;s.stopPropagation(),s.preventDefault();const t=s.currentTarget;t&&t.blur()},Vd=s=>{Ye(!1);const t=s.target;t&&(t.contentEditable="false",t.style.borderBottom="")},$c=(s,t,e)=>{const i=document.getElementById(As);if(!i||i.classList.contains("fadeIn"))return;const r=Z(As);if(!r)return;switch(r.offsetLeft=t,r.offsetLeft=e,i.textContent=be(`{{${s}}}`).replace("{{","").replace("}}",""),!0){case i.clientWidth+t-20>window.innerWidth:r.offsetLeft=t-(i.clientWidth+t+10-window.innerWidth);break;case 0>t-20:r.offsetLeft=10;break;default:r.offsetLeft=t-20;break}switch(!0){case i.clientHeight+e+20>window.innerHeight:r.offsetTop=e-i.clientHeight-20;break;default:r.offsetTop=e+20;break}const n=setTimeout(()=>{Dn()},1500);i.dataset.timerId=`${n}`,Dn(),r.show()},vb="",Sb="",wb="",Mb=s=>{Vd(s);const t=s.target;if(!t)return;const e=parseInt(t.dataset.libraryId),i=M(),r=i.getLibrary(e);if(!r)return;let n=t.textContent;if(n||(t.textContent=n=r.name),n===r.name)return;const a=r.name;if(r.name=n,i.pathMap.has(r.getPath(i))){t.textContent=r.name=a,$c(vb,t.offsetLeft,t.offsetTop-t.clientHeight-4);return}r.name=a;const o=new rs(i,r);o.name=n};let un=!1,ln=-1;const Ib=s=>{switch(!0){case s.button!==0:case ss():case s.altKey:case s.metaKey:case s.shiftKey:return}const t=s.currentTarget;if(!t)return;const e=parseInt(t.dataset.libraryId);!un||ln!==e?(un=!0,ln=e,setTimeout(()=>{un=!1,ln=-1},300)):(un=!1,ln=-1,s.stopPropagation(),s.preventDefault(),Wd(t))},Ab=s=>{Vd(s);const t=s.target;if(!t)return;const e=parseInt(t.dataset.libraryId),i=M(),r=i.getLibrary(e);if(!r)return;const n=t.textContent;if(n===r.symbol)return;if(i.symbolMap.has(n)){t.textContent=r.symbol,$c(Sb,t.offsetLeft,t.offsetTop-t.clientHeight-4);return}const a=new rs(i,r);a.symbol=n},Lb=s=>{const t=M();let e=s.folderId;for(;e;){const i=t.getLibrary(e);if(!i)break;if(i.mode==="close")return!1;e=i.folderId}return!0},Cb=s=>{const t=M();let e=0,i=s.folderId;for(;i;){const r=t.getLibrary(i);if(!r)break;i=r.folderId,e+=20}return e},Q=async()=>{const s=document.getElementById(ga);if(!s)return;const t=s.children;for(;t.length;)t[0].remove();const e=M();for(const i of e.libraries.values()){if(i.id===0||!Lb(i))continue;s.insertAdjacentHTML("beforeend",Pp(i));const r=s.lastElementChild,n=Cb(i);if(n){const c=r.getElementsByTagName("div"),u=c[0];u.style.width=`${n}px`;const h=c[1].getElementsByTagName("p")[0];h.style.width=`calc((var(--controller-width) - 10px - 2px) / 2 - 48px - ${n}px)`}if(j.selectedIds.indexOf(i.id)>-1&&r.classList.add("active"),r.addEventListener(E.MOUSE_DOWN,Qp),i.type==="folder"){const c=r.getElementsByTagName("i");c.length&&(c[0].addEventListener(E.MOUSE_DOWN,ub),c[1].addEventListener(E.MOUSE_DOWN,lb))}if(i.type==="container"){const c=r.getElementsByTagName("i");c.length&&c[1].addEventListener(E.MOUSE_DOWN,Eb)}const a=r.getElementsByTagName("span"),o=a[0];if(o.addEventListener(E.MOUSE_DOWN,Tb),o.addEventListener("focusout",Mb),o.addEventListener("keypress",du),i.type!=="folder"){const c=a[1];c.addEventListener(E.MOUSE_DOWN,Ib),c.addEventListener("focusout",Ab),c.addEventListener("keypress",du)}}},xe=(s,t)=>{s.libraries.set(t.id,t),s.pathMap.set(t.getPath(s),t.id),t.symbol&&s.symbolMap.set(t.symbol,t.id)},Xs=(s,t,e=!0)=>{xe(s,t),re(s),e&&s.active&&Q()},Ob=(s,t,e,i,r)=>({command:Ci,messages:[s,t,e,i,r],args:[i]}),Gd=(s,t,e,i=!1)=>{St(s);const r=Ob(s.id,t.id,e.id,e.name,e.folderId);s.active&&Tt(t.id,s.historyIndex,Et(Ci),"",...r.args),s.addHistory(r),!i&&st()&&dt(r)},Bb=(s,t,e,i=0,r=!0)=>{const n=new fa({id:s.nextLibraryId,name:e,folderId:i,type:"folder",mode:"close"});return Xs(s,n,r),Gd(s,t,n),n},$u=["#ff0000","#0000ff","#32cd32","#ffc0cb","#ffd700","#ff8c00","#00ffff","#ff00ff","#008080","#00bfff","#ff6347","#fa8072","#ff69b4","#7fff00","#ffffe0","#9370db"],Rb=()=>{const s=Math.random()*$u.length|0;return $u[s]};class Fb{_$id;_$name;_$color;_$light;_$disable;_$lock;_$mode;_$parentId;_$characters;_$emptys;constructor(t=null){this._$id=-1,this._$name="",this._$color="",this._$light=!1,this._$disable=!1,this._$lock=!1,this._$mode=0,this._$parentId=-1,this._$characters=[],this._$emptys=[],t?this.load(t):this._$color=Rb()}get id(){return this._$id}set id(t){this._$id=t}get name(){return this._$name}set name(t){this._$name=t}get light(){return this._$light}set light(t){this._$light=t}get disable(){return this._$disable}set disable(t){this._$disable=t}get lock(){return this._$lock}set lock(t){this._$lock=t}get color(){return this._$color}set color(t){this._$color=`${t}`}get mode(){return this._$mode}set mode(t){this._$mode=t}get parentId(){return this._$parentId}set parentId(t){this._$parentId=t}get characters(){return this._$characters}get emptyCharacters(){return this._$emptys}getDisplayIndex(){const e=M().scene.layers.indexOf(this);return e===-1?e:e-Ae()}clearRelation(){this._$mode=jo,this._$parentId=-1}load(t){this._$id=t.id,this._$name=t.name,this._$color=t.color,this._$lock=t.lock,this._$disable=t.disable,this._$light=t.light,this._$mode=t.mode,t.parentId&&(this._$parentId=t.parentId),"maskId"in t&&t.maskId!==null&&(this._$parentId=t.maskId),"guideId"in t&&t.guideId!==null&&(this._$parentId=t.guideId),this.loadCharacter(t.characters),this.loadEmptyCharacter(t.characters)}loadCharacter(t){!t||!t.length||console.log("TODO",t)}loadEmptyCharacter(t){!t||!t.length||console.log("TODO",t)}getHighlightURL(){const t=parseInt(`0x${this.color.slice(1)}`,16),e=t>>16&255,i=t>>8&255,r=t&255;return`data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"><path fill="rgb(${e},${i},${r})" d="M14 19h-4c-.276 0-.5.224-.5.5s.224.5.5.5h4c.276 0 .5-.224.5-.5s-.224-.5-.5-.5zm0 2h-4c-.276 0-.5.224-.5.5s.224.5.5.5h4c.276 0 .5-.224.5-.5s-.224-.5-.5-.5zm.25 2h-4.5l1.188.782c.154.138.38.218.615.218h.895c.234 0 .461-.08.615-.218l1.187-.782zm3.75-13.799c0 3.569-3.214 5.983-3.214 8.799h-1.989c-.003-1.858.87-3.389 1.721-4.867.761-1.325 1.482-2.577 1.482-3.932 0-2.592-2.075-3.772-4.003-3.772-1.925 0-3.997 1.18-3.997 3.772 0 1.355.721 2.607 1.482 3.932.851 1.478 1.725 3.009 1.72 4.867h-1.988c0-2.816-3.214-5.23-3.214-8.799 0-3.723 2.998-5.772 5.997-5.772 3.001 0 6.003 2.051 6.003 5.772zm4-.691v1.372h-2.538c.02-.223.038-.448.038-.681 0-.237-.017-.464-.035-.69h2.535zm-10.648-6.553v-1.957h1.371v1.964c-.242-.022-.484-.035-.726-.035-.215 0-.43.01-.645.028zm-3.743 1.294l-1.04-1.94 1.208-.648 1.037 1.933c-.418.181-.822.401-1.205.655zm10.586 1.735l1.942-1.394.799 1.115-2.054 1.473c-.191-.43-.423-.827-.687-1.194zm-3.01-2.389l1.038-1.934 1.208.648-1.041 1.941c-.382-.254-.786-.473-1.205-.655zm-10.068 3.583l-2.054-1.472.799-1.115 1.942 1.393c-.264.366-.495.763-.687 1.194zm13.707 6.223l2.354.954-.514 1.271-2.425-.982c.21-.397.408-.812.585-1.243zm-13.108 1.155l-2.356 1.06-.562-1.251 2.34-1.052c.173.433.371.845.578 1.243zm-1.178-3.676h-2.538v-1.372h2.535c-.018.226-.035.454-.035.691 0 .233.018.458.038.681z"/></svg>`}toObject(){const t=[];for(let i=0;i<this._$characters.length;++i){const r=this._$characters[i];t.push(r.toObject())}const e=[];for(let i=0;i<this._$emptys.length;++i){const r=this._$emptys[i];e.push(r.toObject())}return{id:this._$id,name:this._$name,color:this._$color,lock:this._$lock,disable:this._$disable,light:this._$light,mode:this._$mode,parentId:this._$parentId,characters:t,emptyCharacters:e}}}const Pb=s=>{for(let t=0;t<s.length;++t){const e=document.getElementById(s[t]);e&&e.setAttribute("style","")}},kb=s=>{for(let t=0;t<s.length;++t){const e=document.getElementById(s[t]);e&&e.setAttribute("style","display: none;")}},Nb=async()=>{switch(""){case"shape":break;default:kb(["object-area","ruler-setting","instance-setting","fill-color-setting"]),Pb(["stage-setting","sound-setting","object-setting","color-setting","blend-setting","filter-setting"]);break}},Db=s=>{Uh(),Jo(),_a(),gi(),Is(s.currentFrame),ac(),is(),kd(s.name),Xe(),Nd(s.name),Ud(s.symbol),Nb()},Ub=s=>{sc(s)};class kr extends Rr{_$currentFrame;_$leftFrame;_$scrollX;_$scrollY;_$active;_$layerId;_$labels;_$layers;_$actions;_$sounds;_$selectedLayers;_$selectedFrameObject;constructor(t){super(t),this._$active=!1,this._$labels=new Map,this._$layers=[],this._$layerId=1,this._$actions=new Map,this._$sounds=new Map,this._$currentFrame=1,this._$leftFrame=1,this._$scrollX=0,this._$scrollY=0,this._$selectedLayers=[],this._$selectedFrameObject={start:0,end:0},this.load(t)}get selectedFrameObject(){return this._$selectedFrameObject}get selectedStartFrame(){return Math.min(this._$selectedFrameObject.start,this._$selectedFrameObject.end)}get selectedEndFrame(){return Math.max(this._$selectedFrameObject.start,this._$selectedFrameObject.end)+1}async getHTMLElement(){return null}get selectedLayers(){return this._$selectedLayers}clearSelectedLayer(){this._$selectedLayers.length=0}clearSelectedFrame(){this._$selectedFrameObject.start=0,this._$selectedFrameObject.end=0}get scrollX(){return this._$scrollX}set scrollX(t){this._$scrollX=t}get scrollY(){return this._$scrollY}set scrollY(t){this._$scrollY=t}get layers(){return this._$layers}get currentFrame(){return this._$currentFrame}set currentFrame(t){this._$currentFrame=t}get totalFrame(){return 0}get active(){return this._$active}async run(){Db(this),this._$active=!0}stop(){Ub(this),this._$active=!1}load(t){if(t.layers&&t.layers.length){this._$layers.length=0;for(let e=0;e<t.layers.length;++e){const i=this.createLayer();i.load(t.layers[e]),this._$layerId=Math.max(this._$layerId,i.id),this._$layers.push(i)}}else{const e=this.createLayer();this.setLayer(e,0)}if(t.scrollX&&(this._$scrollX=t.scrollX),t.scrollY&&(this._$scrollY=t.scrollY),t.currentFrame&&(this._$currentFrame=t.currentFrame),t.actions)for(let e=0;e<t.actions.length;++e){const i=t.actions[e];this._$actions.set(i.frame,i.action)}}createLayer(){const t=new Fb;return t.id=this._$layerId++,t.name=`Layer_${this._$layers.length}`,t}setLayer(t,e){const i=he(e,0,this._$layers.length);i>=this._$layers.length?this._$layers.push(t):this._$layers.splice(i,0,t)}deleteLayer(t){this.deactivatedLayer(t);const e=this._$layers.indexOf(t);e>-1&&this._$layers.splice(e,1)}deactivatedLayer(t){const e=this._$selectedLayers.indexOf(t);e>-1&&this._$selectedLayers.splice(e,1)}getLayer(t){return t in this._$layers?this._$layers[t]:null}getLabel(t){return this.hasLabel(t)?this._$labels.get(t):""}setLabel(t,e){this._$labels.set(t,e)}hasLabel(t){return this._$labels.has(t)}deleteLabel(t){return this._$labels.delete(t)}getSound(t){return this.hasSound(t)?this._$sounds.get(t):[]}setSound(t,e){this._$sounds.set(t,e)}hasSound(t){return this._$sounds.has(t)}deleteSound(t){return this._$sounds.delete(t)}get actions(){return this._$actions}getAction(t){return this.hasAction(t)?this._$actions.get(t):""}setAction(t,e){this._$actions.set(t,e)}hasAction(t){return this._$actions.has(t)}deleteAction(t){return this._$actions.delete(t)}toObject(){const t=[];for(let n=0;n<this._$layers.length;++n)t.push(this._$layers[n].toObject());const e=[];for(const[n,a]of this._$labels)e.push({frame:n,name:a});const i=[];for(const[n,a]of this._$actions)i.push({frame:n,action:a});const r=[];for(const[n,a]of this._$sounds)r.push({frame:n,sounds:a});return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,currentFrame:this._$currentFrame,leftFrame:this._$leftFrame,layers:t,labels:e,sounds:r,actions:i,scrollX:this._$scrollX,scrollY:this._$scrollY}}}const Yb=(s,t,e,i,r)=>({command:Yi,messages:[s,t,e,i,r],args:[i]}),zd=(s,t,e,i=!1)=>{St(s);const r=Yb(s.id,t.id,e.id,e.name,e.folderId);s.active&&Tt(t.id,s.historyIndex,Et(Yi),"",...r.args),s.addHistory(r),!i&&st()&&dt(r)},Xb=(s,t,e,i=0,r=!0)=>{const n=new kr({id:s.nextLibraryId,name:e,type:"container",folderId:i});return Xs(s,n,r),zd(s,t,n),n},ye=s=>{let t="";for(let e=0;e<s.length;e+=4096)t+=String.fromCharCode(...s.slice(e,e+4096));return t},We=s=>{const t=s.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=s.charCodeAt(i)&255;return e},Wb=(s,t,e)=>{const i=ca();if(!s)return i;i.width=t,i.height=e;const r=i.getContext("2d",{willReadFrequently:!0});if(!r)return i;const n=new ImageData(new Uint8ClampedArray(s.buffer),t,e);return r.putImageData(n,0,0),i};class Ws extends Rr{_$imageType;_$binary;_$width;_$height;_$buffer;constructor(t){super(t),this._$buffer=null,this._$binary="",this._$imageType="",this._$width=0,this._$height=0,t.imageType&&(this._$imageType=t.imageType),t.width&&(this._$width=t.width),t.height&&(this._$height=t.height),t.buffer&&(typeof t.buffer=="string"?(this._$binary=t.buffer,this._$buffer=We(t.buffer)):this._$buffer=t.buffer)}get imageType(){return this._$imageType}set imageType(t){this._$imageType=t}get width(){return this._$width}set width(t){this._$width=t}get height(){return this._$height}set height(t){this._$height=t}get buffer(){return this._$buffer}set buffer(t){this._$buffer=t,this._$binary=""}get binary(){return this._$binary||(this._$buffer||(this._$buffer=new Uint8Array(this._$width*this._$height*4)),this._$binary=ye(this._$buffer)),this._$binary}async getHTMLElement(){return Wb(this._$buffer,this._$width,this._$height)}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,width:this._$width,height:this._$height,imageType:this._$imageType,buffer:this.binary}}}const _u=(s,t,e,i="")=>({command:Ri,messages:[s,t,e,i],args:[e.name]}),Vb="https://rdx2wvxykwvsb2atm424fnklg40lasuz.lambda-url.ap-northeast-1.on.aws/",ae=async(s,t)=>{const e=location.hash.replace("#","");return(await(await fetch(`${Vb}?roomId=${e}&fileId=${s}&mode=${t}`)).json()).url},Vs=async(s,t)=>{await fetch(s,{method:"PUT",body:t,headers:{"Content-Type":"binary/octet-stream"}})},Hd="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciBVPVVpbnQ4QXJyYXkseT1VaW50MTZBcnJheSxwPUludDMyQXJyYXksZD1uZXcgVShbMCwwLDAsMCwwLDAsMCwwLDEsMSwxLDEsMiwyLDIsMiwzLDMsMywzLDQsNCw0LDQsNSw1LDUsNSwwLDAsMCwwXSkscnI9bmV3IFUoWzAsMCwwLDAsMSwxLDIsMiwzLDMsNCw0LDUsNSw2LDYsNyw3LDgsOCw5LDksMTAsMTAsMTEsMTEsMTIsMTIsMTMsMTMsMCwwXSksaHI9bmV3IFUoWzE2LDE3LDE4LDAsOCw3LDksNiwxMCw1LDExLDQsMTIsMywxMywyLDE0LDEsMTVdKSxvcj1mdW5jdGlvbihyLGEpe2Zvcih2YXIgZj1uZXcgeSgzMSksZT0wO2U8MzE7KytlKWZbZV09YSs9MTw8cltlLTFdO2Zvcih2YXIgdj1uZXcgcChmWzMwXSksZT0xO2U8MzA7KytlKWZvcih2YXIgbj1mW2VdO248ZltlKzFdOysrbil2W25dPW4tZltlXTw8NXxlO3JldHVybntiOmYscjp2fX0sdHI9b3IoZCwyKSxrcj10ci5iLGFyPXRyLnI7a3JbMjhdPTI1OCxhclsyNThdPTI4O2Zvcih2YXIgVHI9b3IocnIsMCksY3I9VHIucixlcj1uZXcgeSgzMjc2OCksbz0wO288MzI3Njg7KytvKXt2YXIgSz0obyY0MzY5MCk+PjF8KG8mMjE4NDUpPDwxO0s9KEsmNTI0MjgpPj4yfChLJjEzMTA3KTw8MixLPShLJjYxNjgwKT4+NHwoSyYzODU1KTw8NCxlcltvXT0oKEsmNjUyODApPj44fChLJjI1NSk8PDgpPj4xfWZvcih2YXIgWj1mdW5jdGlvbihyLGEsZil7Zm9yKHZhciBlPXIubGVuZ3RoLHY9MCxuPW5ldyB5KGEpO3Y8ZTsrK3Ypclt2XSYmKytuW3Jbdl0tMV07dmFyIHc9bmV3IHkoYSk7Zm9yKHY9MTt2PGE7Kyt2KXdbdl09d1t2LTFdK25bdi0xXTw8MTt2YXIgdDtpZihmKXt0PW5ldyB5KDE8PGEpO3ZhciBjPTE1LWE7Zm9yKHY9MDt2PGU7Kyt2KWlmKHJbdl0pZm9yKHZhciBpPXY8PDR8clt2XSxsPWEtclt2XSxGPXdbclt2XS0xXSsrPDxsLFQ9RnwoMTw8bCktMTtGPD1UOysrRil0W2VyW0ZdPj5jXT1pfWVsc2UgZm9yKHQ9bmV3IHkoZSksdj0wO3Y8ZTsrK3Ypclt2XSYmKHRbdl09ZXJbd1tyW3ZdLTFdKytdPj4xNS1yW3ZdKTtyZXR1cm4gdH0sUD1uZXcgVSgyODgpLG89MDtvPDE0NDsrK28pUFtvXT04O2Zvcih2YXIgbz0xNDQ7bzwyNTY7KytvKVBbb109OTtmb3IodmFyIG89MjU2O288MjgwOysrbylQW29dPTc7Zm9yKHZhciBvPTI4MDtvPDI4ODsrK28pUFtvXT04O2Zvcih2YXIgbT1uZXcgVSgzMiksbz0wO288MzI7KytvKW1bb109NTt2YXIgU3I9WihQLDksMCksVXI9WihtLDUsMCksZ3I9ZnVuY3Rpb24ocil7cmV0dXJuKHIrNykvOHwwfSxicj1mdW5jdGlvbihyLGEsZil7cmV0dXJuKGE9PW51bGx8fGE8MCkmJihhPTApLChmPT1udWxsfHxmPnIubGVuZ3RoKSYmKGY9ci5sZW5ndGgpLG5ldyBVKHIuc3ViYXJyYXkoYSxmKSl9LEg9ZnVuY3Rpb24ocixhLGYpe2Y8PD1hJjc7dmFyIGU9YS84fDA7cltlXXw9ZixyW2UrMV18PWY+Pjh9LCQ9ZnVuY3Rpb24ocixhLGYpe2Y8PD1hJjc7dmFyIGU9YS84fDA7cltlXXw9ZixyW2UrMV18PWY+PjgscltlKzJdfD1mPj4xNn0sdnI9ZnVuY3Rpb24ocixhKXtmb3IodmFyIGY9W10sZT0wO2U8ci5sZW5ndGg7KytlKXJbZV0mJmYucHVzaCh7czplLGY6cltlXX0pO3ZhciB2PWYubGVuZ3RoLG49Zi5zbGljZSgpO2lmKCF2KXJldHVybnt0OkZyLGw6MH07aWYodj09MSl7dmFyIHc9bmV3IFUoZlswXS5zKzEpO3JldHVybiB3W2ZbMF0uc109MSx7dDp3LGw6MX19Zi5zb3J0KGZ1bmN0aW9uKFMseil7cmV0dXJuIFMuZi16LmZ9KSxmLnB1c2goe3M6LTEsZjoyNTAwMX0pO3ZhciB0PWZbMF0sYz1mWzFdLGk9MCxsPTEsRj0yO2ZvcihmWzBdPXtzOi0xLGY6dC5mK2MuZixsOnQscjpjfTtsIT12LTE7KXQ9ZltmW2ldLmY8ZltGXS5mP2krKzpGKytdLGM9ZltpIT1sJiZmW2ldLmY8ZltGXS5mP2krKzpGKytdLGZbbCsrXT17czotMSxmOnQuZitjLmYsbDp0LHI6Y307Zm9yKHZhciBUPW5bMF0ucyxlPTE7ZTx2OysrZSluW2VdLnM+VCYmKFQ9bltlXS5zKTt2YXIgeD1uZXcgeShUKzEpLGI9bnIoZltsLTFdLHgsMCk7aWYoYj5hKXt2YXIgZT0wLHM9MCxOPWItYSxRPTE8PE47Zm9yKG4uc29ydChmdW5jdGlvbih6LEEpe3JldHVybiB4W0Euc10teFt6LnNdfHx6LmYtQS5mfSk7ZTx2OysrZSl7dmFyIEo9bltlXS5zO2lmKHhbSl0+YSlzKz1RLSgxPDxiLXhbSl0pLHhbSl09YTtlbHNlIGJyZWFrfWZvcihzPj49TjtzPjA7KXt2YXIgUj1uW2VdLnM7eFtSXTxhP3MtPTE8PGEteFtSXSsrLTE6KytlfWZvcig7ZT49MCYmczstLWUpe3ZhciBxPW5bZV0uczt4W3FdPT1hJiYoLS14W3FdLCsrcyl9Yj1hfXJldHVybnt0Om5ldyBVKHgpLGw6Yn19LG5yPWZ1bmN0aW9uKHIsYSxmKXtyZXR1cm4gci5zPT0tMT9NYXRoLm1heChucihyLmwsYSxmKzEpLG5yKHIucixhLGYrMSkpOmFbci5zXT1mfSxpcj1mdW5jdGlvbihyKXtmb3IodmFyIGE9ci5sZW5ndGg7YSYmIXJbLS1hXTspO2Zvcih2YXIgZj1uZXcgeSgrK2EpLGU9MCx2PXJbMF0sbj0xLHc9ZnVuY3Rpb24oYyl7ZltlKytdPWN9LHQ9MTt0PD1hOysrdClpZihyW3RdPT12JiZ0IT1hKSsrbjtlbHNle2lmKCF2JiZuPjIpe2Zvcig7bj4xMzg7bi09MTM4KXcoMzI3NTQpO24+MiYmKHcobj4xMD9uLTExPDw1fDI4NjkwOm4tMzw8NXwxMjMwNSksbj0wKX1lbHNlIGlmKG4+Myl7Zm9yKHcodiksLS1uO24+NjtuLT02KXcoODMwNCk7bj4yJiYodyhuLTM8PDV8ODIwOCksbj0wKX1mb3IoO24tLTspdyh2KTtuPTEsdj1yW3RdfXJldHVybntjOmYuc3ViYXJyYXkoMCxlKSxuOmF9fSxfPWZ1bmN0aW9uKHIsYSl7Zm9yKHZhciBmPTAsZT0wO2U8YS5sZW5ndGg7KytlKWYrPXJbZV0qYVtlXTtyZXR1cm4gZn0sc3I9ZnVuY3Rpb24ocixhLGYpe3ZhciBlPWYubGVuZ3RoLHY9Z3IoYSsyKTtyW3ZdPWUmMjU1LHJbdisxXT1lPj44LHJbdisyXT1yW3ZdXjI1NSxyW3YrM109clt2KzFdXjI1NTtmb3IodmFyIG49MDtuPGU7KytuKXJbdituKzRdPWZbbl07cmV0dXJuKHYrNCtlKSo4fSxNcj1mdW5jdGlvbihyLGEsZixlLHYsbix3LHQsYyxpLGwpe0goYSxsKyssZiksKyt2WzI1Nl07Zm9yKHZhciBGPXZyKHYsMTUpLFQ9Ri50LHg9Ri5sLGI9dnIobiwxNSkscz1iLnQsTj1iLmwsUT1pcihUKSxKPVEuYyxSPVEubixxPWlyKHMpLFM9cS5jLHo9cS5uLEE9bmV3IHkoMTkpLGg9MDtoPEoubGVuZ3RoOysraCkrK0FbSltoXSYzMV07Zm9yKHZhciBoPTA7aDxTLmxlbmd0aDsrK2gpKytBW1NbaF0mMzFdO2Zvcih2YXIgdT12cihBLDcpLEM9dS50LFY9dS5sLGs9MTk7az40JiYhQ1tocltrLTFdXTstLWspO3ZhciBXPWkrNTw8MyxFPV8odixQKStfKG4sbSkrdyxJPV8odixUKStfKG4scykrdysxNCszKmsrXyhBLEMpKzIqQVsxNl0rMypBWzE3XSs3KkFbMThdO2lmKGM+PTAmJlc8PUUmJlc8PUkpcmV0dXJuIHNyKGEsbCxyLnN1YmFycmF5KGMsYytpKSk7dmFyIEIsZyxMLE87aWYoSChhLGwsMSsoSTxFKSksbCs9MixJPEUpe0I9WihULHgsMCksZz1ULEw9WihzLE4sMCksTz1zO3ZhciBmcj1aKEMsViwwKTtIKGEsbCxSLTI1NyksSChhLGwrNSx6LTEpLEgoYSxsKzEwLGstNCksbCs9MTQ7Zm9yKHZhciBoPTA7aDxrOysraClIKGEsbCszKmgsQ1tocltoXV0pO2wrPTMqaztmb3IodmFyIEQ9W0osU10saj0wO2o8MjsrK2opZm9yKHZhciBYPURbal0saD0wO2g8WC5sZW5ndGg7KytoKXt2YXIgRz1YW2hdJjMxO0goYSxsLGZyW0ddKSxsKz1DW0ddLEc+MTUmJihIKGEsbCxYW2hdPj41JjEyNyksbCs9WFtoXT4+MTIpfX1lbHNlIEI9U3IsZz1QLEw9VXIsTz1tO2Zvcih2YXIgaD0wO2g8dDsrK2gpe3ZhciBNPWVbaF07aWYoTT4yNTUpe3ZhciBHPU0+PjE4JjMxOyQoYSxsLEJbRysyNTddKSxsKz1nW0crMjU3XSxHPjcmJihIKGEsbCxNPj4yMyYzMSksbCs9ZFtHXSk7dmFyIFk9TSYzMTskKGEsbCxMW1ldKSxsKz1PW1ldLFk+MyYmKCQoYSxsLE0+PjUmODE5MSksbCs9cnJbWV0pfWVsc2UgJChhLGwsQltNXSksbCs9Z1tNXX1yZXR1cm4gJChhLGwsQlsyNTZdKSxsK2dbMjU2XX0scXI9bmV3IHAoWzY1NTQwLDEzMTA4MCwxMzEwODgsMTMxMTA0LDI2MjE3NiwxMDQ4NzA0LDEwNDg4MzIsMjExNDU2MCwyMTE3NjMyXSksRnI9bmV3IFUoMCksenI9ZnVuY3Rpb24ocixhLGYsZSx2LG4pe3ZhciB3PW4uenx8ci5sZW5ndGgsdD1uZXcgVShlK3crNSooMStNYXRoLmNlaWwody83ZTMpKSt2KSxjPXQuc3ViYXJyYXkoZSx0Lmxlbmd0aC12KSxpPW4ubCxsPShuLnJ8fDApJjc7aWYoYSl7bCYmKGNbMF09bi5yPj4zKTtmb3IodmFyIEY9cXJbYS0xXSxUPUY+PjEzLHg9RiY4MTkxLGI9KDE8PGYpLTEscz1uLnB8fG5ldyB5KDMyNzY4KSxOPW4uaHx8bmV3IHkoYisxKSxRPU1hdGguY2VpbChmLzMpLEo9MipRLFI9ZnVuY3Rpb24od3Ipe3JldHVybihyW3dyXV5yW3dyKzFdPDxRXnJbd3IrMl08PEopJmJ9LHE9bmV3IHAoMjVlMyksUz1uZXcgeSgyODgpLHo9bmV3IHkoMzIpLEE9MCxoPTAsdT1uLml8fDAsQz0wLFY9bi53fHwwLGs9MDt1KzI8dzsrK3Upe3ZhciBXPVIodSksRT11JjMyNzY3LEk9TltXXTtpZihzW0VdPUksTltXXT1FLFY8PXUpe3ZhciBCPXctdTtpZigoQT43ZTN8fEM+MjQ1NzYpJiYoQj40MjN8fCFpKSl7bD1NcihyLGMsMCxxLFMseixoLEMsayx1LWssbCksQz1BPWg9MCxrPXU7Zm9yKHZhciBnPTA7ZzwyODY7KytnKVNbZ109MDtmb3IodmFyIGc9MDtnPDMwOysrZyl6W2ddPTB9dmFyIEw9MixPPTAsZnI9eCxEPUUtSSYzMjc2NztpZihCPjImJlc9PVIodS1EKSlmb3IodmFyIGo9TWF0aC5taW4oVCxCKS0xLFg9TWF0aC5taW4oMzI3NjcsdSksRz1NYXRoLm1pbigyNTgsQik7RDw9WCYmLS1mciYmRSE9STspe2lmKHJbdStMXT09clt1K0wtRF0pe2Zvcih2YXIgTT0wO008RyYmclt1K01dPT1yW3UrTS1EXTsrK00pO2lmKE0+TCl7aWYoTD1NLE89RCxNPmopYnJlYWs7Zm9yKHZhciBZPU1hdGgubWluKEQsTS0yKSx4cj0wLGc9MDtnPFk7KytnKXt2YXIgbHI9dS1EK2cmMzI3NjcsRHI9c1tscl0sQXI9bHItRHImMzI3Njc7QXI+eHImJih4cj1BcixJPWxyKX19fUU9SSxJPXNbRV0sRCs9RS1JJjMyNzY3fWlmKE8pe3FbQysrXT0yNjg0MzU0NTZ8YXJbTF08PDE4fGNyW09dO3ZhciB5cj1hcltMXSYzMSxDcj1jcltPXSYzMTtoKz1kW3lyXStycltDcl0sKytTWzI1Nyt5cl0sKyt6W0NyXSxWPXUrTCwrK0F9ZWxzZSBxW0MrK109clt1XSwrK1Nbclt1XV19fWZvcih1PU1hdGgubWF4KHUsVik7dTx3OysrdSlxW0MrK109clt1XSwrK1Nbclt1XV07bD1NcihyLGMsaSxxLFMseixoLEMsayx1LWssbCksaXx8KG4ucj1sJjd8Y1tsLzh8MF08PDMsbC09NyxuLmg9TixuLnA9cyxuLmk9dSxuLnc9Vil9ZWxzZXtmb3IodmFyIHU9bi53fHwwO3U8dytpO3UrPTY1NTM1KXt2YXIgdXI9dSs2NTUzNTt1cj49dyYmKGNbbC84fDBdPWksdXI9dyksbD1zcihjLGwrMSxyLnN1YmFycmF5KHUsdXIpKX1uLmk9d31yZXR1cm4gYnIodCwwLGUrZ3IobCkrdil9LEVyPWZ1bmN0aW9uKHIsYSxmLGUsdil7aWYoIXYmJih2PXtsOjF9LGEuZGljdGlvbmFyeSkpe3ZhciBuPWEuZGljdGlvbmFyeS5zdWJhcnJheSgtMzI3NjgpLHc9bmV3IFUobi5sZW5ndGgrci5sZW5ndGgpO3cuc2V0KG4pLHcuc2V0KHIsbi5sZW5ndGgpLHI9dyx2Lnc9bi5sZW5ndGh9cmV0dXJuIHpyKHIsYS5sZXZlbD09bnVsbD82OmEubGV2ZWwsYS5tZW09PW51bGw/di5sP01hdGguY2VpbChNYXRoLm1heCg4LE1hdGgubWluKDEzLE1hdGgubG9nKHIubGVuZ3RoKSkpKjEuNSk6MjA6MTIrYS5tZW0sZixlLHYpfTtmdW5jdGlvbiBJcihyLGEpe3JldHVybiBFcihyLGF8fHt9LDAsMCl9dmFyIExyPXR5cGVvZiBUZXh0RGVjb2RlcjwidSImJm5ldyBUZXh0RGVjb2RlcixCcj0wO3RyeXtMci5kZWNvZGUoRnIse3N0cmVhbTohMH0pLEJyPTF9Y2F0Y2h7fXNlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIscj0+e2NvbnN0IGE9SXIoci5kYXRhKTtzZWxmLnBvc3RNZXNzYWdlKGEsW2EuYnVmZmVyXSl9KX0pKCk7Cg==",Gb=s=>Uint8Array.from(atob(s),t=>t.charCodeAt(0)),fu=typeof window<"u"&&window.Blob&&new Blob([Gb(Hd)],{type:"text/javascript;charset=utf-8"});function Gs(s){let t;try{if(t=fu&&(window.URL||window.webkitURL).createObjectURL(fu),!t)throw"";const e=new Worker(t,{name:s?.name});return e.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(t)}),e}catch{return new Worker("data:text/javascript;base64,"+Hd,{name:s?.name})}finally{t&&(window.URL||window.webkitURL).revokeObjectURL(t)}}const gu=new Gs,jd=async(s,t,e,i=!1)=>{St(s);const r=_u(s.id,t.id,e.toObject());s.active&&Tt(t.id,s.historyIndex,Et(Ri),"",...r.args),s.addHistory(r),!i&&st()&&await new Promise(n=>{if(!e.buffer)return;gu.onmessage=async o=>{const c=o.data,u=ye(c),l=window.crypto.randomUUID(),h=await ae(l,"put");await Vs(h,u);const $=e.toObject();$.buffer="";const _=_u(s.id,t.id,$,l);dt(_),n()};const a=e.buffer.slice();gu.postMessage(a,[a.buffer])})},zb=(s,t,e,i="")=>new Promise(r=>{const a=new Kt(s).getItem(i),o=a&&a.type==="folder"?a.id:0,c=new Ws({id:s.nextLibraryId,type:"bitmap",name:e,folderId:o,imageType:t.type});xe(s,c);const u=new Image;u.src=URL.createObjectURL(t),u.decode().then(async()=>{const l=u.width,h=u.height,$=ca();$.width=l,$.height=h;const _=$.getContext("2d",{willReadFrequently:!0});if(!_)throw new Error("CanvasRenderingContext2D cannot be loaded");_.drawImage(u,0,0,l,h);const g=new Uint8Array(_.getImageData(0,0,l,h).data);Ls($),c.width=l,c.height=h,c.buffer=g,xe(s,c),await jd(s,s.scene,c),r()})});class zs extends Rr{_$video;_$width;_$height;_$binary;_$loaded;_$buffer;constructor(t){super(t),this._$width=0,this._$height=0,this._$binary="",this._$loaded=!1,this._$buffer=null,t.width&&(this._$width=t.width),t.height&&(this._$height=t.height),this._$video=document.createElement("video"),this._$video.crossOrigin="anonymous",this._$video.muted=!0,this._$video.autoplay=!1,this._$video.controls=!0,this._$video.oncanplaythrough=()=>{this._$width=this._$video.videoWidth,this._$height=this._$video.videoHeight,this._$loaded=!0},t.buffer&&(typeof t.buffer=="string"?(this._$binary=t.buffer,this._$buffer=We(t.buffer)):this._$buffer=t.buffer,this._$buffer instanceof Uint8Array&&(this._$video.src=URL.createObjectURL(new Blob([this._$buffer],{type:"video/mp4"})),this._$video.load()))}wait(){return new Promise(t=>{if(this._$loaded)return t();const e=()=>{if(this._$loaded)return t();setTimeout(e,200)};e()})}get buffer(){return this._$buffer}set buffer(t){this._$buffer=t,this._$binary="",this._$loaded=!1,this._$video.src=URL.createObjectURL(new Blob([this._$buffer],{type:"video/mp4"})),this._$video.load()}get width(){return this._$width}set width(t){this._$width=t|0}get height(){return this._$height}set height(t){this._$height=t|0}get binary(){return this._$binary||(this._$buffer||(this._$buffer=new Uint8Array(this._$width*this._$height*4)),this._$binary=ye(this._$buffer)),this._$binary}async getHTMLElement(){return this._$video}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,width:this._$width,height:this._$height,buffer:this.binary}}}const mu=(s,t,e,i)=>({command:ki,messages:[s,t,e,i],args:[e.name]}),pu=new Gs,Kd=async(s,t,e,i=!1)=>{St(s);const r=mu(s.id,t.id,e.toObject(),"");s.active&&Tt(t.id,s.historyIndex,Et(ki),"",...r.args),s.addHistory(r),!i&&st()&&await new Promise(n=>{if(!e.buffer)return;pu.onmessage=async o=>{const c=o.data,u=ye(c),l=window.crypto.randomUUID(),h=await ae(l,"put");await Vs(h,u);const $=e.toObject();$.buffer="";const _=mu(s.id,t.id,$,l);dt(_),n()};const a=e.buffer.slice();pu.postMessage(a,[a.buffer])})},Hb=(s,t,e,i="")=>new Promise(r=>{const a=new Kt(s).getItem(i),o=a&&a.type==="folder"?a.id:0,c=new zs({id:s.nextLibraryId,type:"video",name:e,folderId:o});xe(s,c),t.arrayBuffer().then(async u=>{c.buffer=new Uint8Array(u),await c.wait(),await Kd(s,s.scene,c),r()})}),jb=(s,t,e)=>{const i=s.slice(t,e);let r=-100;for(let n=0;n<i.length;n++){const a=i[n];a>r&&(r=a)}return r},bu=(s,t)=>{let e=Math.floor(s.length/t*window.devicePixelRatio);e<1&&(e=1);const i=[];for(let r=0;r<s.length;r+=e)i.push(jb(s,r,r+e));return i},Kb=async(s,t)=>{const e=v$();if(!e)return Promise.resolve();const i=await e.decodeAudioData(s.buffer),r=i.getChannelData(0),n=bu(r,t*window.devicePixelRatio);if(i.numberOfChannels===1)return[n,n];const a=i.getChannelData(1),o=bu(a,t*window.devicePixelRatio);return[n,o]},yo=async(s,t=351,e=60)=>{const i=ca();if(!s)return i;const r=await Kb(s.slice(),t);if(!r)return i;i.width=t*window.devicePixelRatio,i.height=e*window.devicePixelRatio,i.style.width=`${t}px`,i.style.height=`${e}px`;const n=i.getContext("2d",{willReadFrequently:!0});if(!n)return i;const a=r[0],o=r[1],c=i.width/a.length,u=i.height/2;n.fillStyle="#1355a5";for(let l=0;l<a.length;++l){const h=a[l]*u;n.fillRect(l*c,u-h,c,h);const $=o[l]*u;n.fillRect(l*c,u,c,$)}return i},qd=(s,t)=>{const e=document.createElement("div");e.classList.add("sound-canvas-element"),e.appendChild(s);const i=document.createElement("div");i.classList.add("sound-audio-element"),i.appendChild(t);const r=document.createElement("div");return r.classList.add("sound-parent"),r.appendChild(e),r.appendChild(i),r};class Hs extends Rr{_$binary;_$loaded;_$buffer;_$canvas;_$audio;constructor(t){super(t),this._$binary="",this._$loaded=!1,this._$buffer=null,this._$canvas=null,this._$audio=document.createElement("audio"),this._$audio.preload="auto",this._$audio.autoplay=!1,this._$audio.loop=!1,this._$audio.controls=!0,this._$audio.oncanplaythrough=async()=>{v$()&&(this._$canvas=await yo(this._$buffer)),this._$loaded=!0},t.buffer&&(typeof t.buffer=="string"?(this._$binary=t.buffer,this._$buffer=We(t.buffer)):this._$buffer=t.buffer,this._$buffer instanceof Uint8Array&&(this._$audio.src=URL.createObjectURL(new Blob([this._$buffer],{type:"audio/mp3"})),this._$audio.load()))}wait(){return new Promise(t=>{if(this._$loaded)return t();const e=()=>{if(this._$loaded)return t();setTimeout(e,200)};e()})}async getHTMLElement(){return this._$canvas||(this._$canvas=await yo(this._$buffer)),qd(this._$canvas,this._$audio)}get buffer(){return this._$buffer}set buffer(t){this._$buffer=t,this._$binary="",this._$loaded=!1,this._$canvas&&(Ls(this._$canvas),this._$canvas=null),this._$audio.src=URL.createObjectURL(new Blob([this._$buffer],{type:"audio/mp3"})),this._$audio.load()}get binary(){return!this._$binary&&this._$buffer&&(this._$binary=ye(this._$buffer)),this._$binary}toObject(){return{id:this.id,name:this.name,type:this.type,symbol:this.symbol,folderId:this.folderId,buffer:this.binary}}}const xu=(s,t,e,i)=>({command:Di,messages:[s,t,e,i],args:[e.name]}),yu=new Gs,Zd=async(s,t,e,i=!1)=>{St(s);const r=xu(s.id,t.id,e.toObject(),"");s.active&&Tt(t.id,s.historyIndex,Et(Di),"",...r.args),s.addHistory(r),!i&&st()&&await new Promise(n=>{if(!e.buffer)return;yu.onmessage=async o=>{const c=o.data,u=ye(c),l=window.crypto.randomUUID(),h=await ae(l,"put");await Vs(h,u);const $=e.toObject();$.buffer="";const _=xu(s.id,t.id,$,l);dt(_),n()};const a=e.buffer.slice();yu.postMessage(a,[a.buffer])})},qb=(s,t,e,i="")=>new Promise(r=>{const a=new Kt(s).getItem(i),o=a&&a.type==="folder"?a.id:0,c=new Hs({id:s.nextLibraryId,type:"sound",name:e,folderId:o});xe(s,c),t.arrayBuffer().then(async u=>{c.buffer=new Uint8Array(u),await c.wait(),await Zd(s,s.scene,c),r()})});class Zb extends rs{}class Jb extends rs{}class Qb extends rs{}class t1 extends rs{}class e1 extends rs{}const s1=(s,t)=>{switch(t.type){case"container":return new Hi(s,t);case"shape":return new Jb(s,t);case"sound":return new Qb(s,t);case"text":return new e1(s,t);case"video":return new t1(s,t);case"folder":return new pa(s,t);case"bitmap":return new Zb(s,t);default:return null}},i1=(s,t,e,i,r,n)=>({command:Fi,messages:[s,t,e,i,r],args:[n]}),Eo=(s,t,e,i,r=!1)=>{St(s);const n=i1(s.id,t.id,e.id,e.folderId,i,e.name);s.active&&Tt(t.id,s.historyIndex,Et(Fi),"",...n.args),s.addHistory(n),!r&&st()&&dt(n)};class Kt{_$workSpace;constructor(t){this._$workSpace=t}async importFile(t,e,i="",r=!0){switch(t.type){case"image/png":case"image/jpeg":case"image/gif":await zb(this._$workSpace,t,e,i);break;case"video/mp4":await Hb(this._$workSpace,t,e,i);break;case"audio/mpeg":await qb(this._$workSpace,t,e,i);break;case"application/x-shockwave-flash":break;case"image/svg+xml":break;default:return}r&&(re(this._$workSpace),this._$workSpace.active&&Q())}getItem(t){if(!this._$workSpace.pathMap.has(t))return null;const e=this._$workSpace.pathMap.get(t),i=this._$workSpace.getLibrary(e);return i?s1(this._$workSpace,i):null}outOfFolder(t,e=!0){const i=this.getItem(t);return!i||i.folderId===0?!1:(Eo(this._$workSpace,this._$workSpace.scene,i,0),i.folderId=0,e&&(Rs(this._$workSpace),re(this._$workSpace),this._$workSpace.active&&Q()),!0)}moveToFolder(t,e,i=!0){const r=this.getItem(t);if(!r)return!1;const n=this.getItem(e);return!n||n.folderId===r.id||n.type==="folder"&&r.checkDuplicate(n.id)?!1:(Eo(this._$workSpace,this._$workSpace.scene,n,r.id),n.folderId=r.id,i&&(Rs(this._$workSpace),re(this._$workSpace),this._$workSpace.active&&Q()),!0)}selectedItem(t){const e=this.getItem(t);e&&(j.selectedIds.indexOf(e.id)>-1||(this._$workSpace.active&&cc(),Pd(e.id),this._$workSpace.active&&ii(e.id)))}addNewFolder(t,e=!0){if(!t)return;const i=t.split("/");i[0]===""&&i.shift();const r=[];let n=0;for(let a=0;a<i.length;++a){const o=i[a];r.push(o);const c=this.getItem(r.join("/"));if(c&&c.type==="folder"){n=c.id;continue}n=Bb(this._$workSpace,this._$workSpace.scene,o,n,e).id}}addNewMovieClip(t,e=!0){if(!t)return;const i=t.split("/");if(i[0]===""&&i.shift(),!i.length)return;const r=i.pop();let n=0;i.length&&(this.addNewFolder(i.join("/"),e),n=this.getItem(i.join("/")).id),Xb(this._$workSpace,this._$workSpace.scene,r,n,e)}async removeItem(t,e=!0){const i=this.getItem(t);i&&await i.remove(e)}}class ds{_$workSpace;constructor(t){this._$workSpace=t}get id(){return this._$workSpace.id}get active(){return this._$workSpace.active}get name(){return this._$workSpace.name}set name(t){mc(this._$workSpace,t)}getCurrentTimeline(){return new Ot(this._$workSpace,this._$workSpace.scene)}async runMovieClip(t){const e=this._$workSpace.getLibrary(t.id),i=this._$workSpace.scene;!i||i===e||(i.stop(),this._$workSpace.scene=e,this._$workSpace.active&&await e.run())}getLibrary(){return new Kt(this._$workSpace)}}let hn=!1,Eu;const r1=async s=>{if(s.stopPropagation(),s.preventDefault(),z(),!hn)hn=!0,Eu=setTimeout(()=>{hn=!1},300);else{hn=!1,clearTimeout(Eu);const t=s.currentTarget;if(!t)return;const e=parseInt(t.dataset.libraryId),i=M();if(i.scene.id===e)return;const r=i.getLibrary(e);if(!r||r.type!=="container")return;r.id>0?dc():hc(),await new ds(i).runMovieClip(r)}},n1=s=>{s.addEventListener(E.MOUSE_DOWN,r1)},a1=(s,t)=>`<div data-library-id="${s}" data-frame="${t}" class="internal-child"><i></i>frame ${t}</div>`,Jd=()=>{const s=Z(mr);s&&(z(mr),s.show())};let Wa=null;const yr=()=>(Wa||(Wa=ace.edit("editor")),Wa);let Qd=null;const t$=()=>Qd,e$=s=>{Qd=s};let s$=1;const i$=()=>s$,r$=s=>{s$=s},o1=s=>{s.stopPropagation(),s.preventDefault();const t=s.currentTarget;if(!t)return;z();const e=M(),i=parseInt(t.dataset.libraryId),r=e.getLibrary(i);if(!r||r.type!=="container")return;e$(r);const n=parseInt(t.dataset.frame);r$(n),Jd()},Es=async()=>{const s=document.getElementById(Md);if(s){Mp();for(const t of M().libraries.values()){if(t.type!=="container"||!t.actions.size)continue;s.insertAdjacentHTML("beforeend",Ip(t.id,t.name));const e=s.lastElementChild;if(!e)continue;n1(e);const i=Array.from(t.actions.keys());i.sort((r,n)=>r-n);for(let r=0;r<i.length;++r){s.insertAdjacentHTML("beforeend",a1(t.id,i[r]));const n=s.lastElementChild;n&&n.addEventListener(E.MOUSE_DOWN,o1)}}}},c1=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=r.getLibrary(t);if(n&&(n.setAction(e,i),r.active&&n.active&&(Es(),mt()<=e&&xs()>=e))){const a=$t.elements[e-mt()];if(!a)return;ys(a,e)}},u1=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=r.getLibrary(t);if(n&&(n.setAction(e,i),r.active&&n.active&&(Es(),mt()<=e&&xs()>=e))){const a=$t.elements[e-mt()];if(!a)return;ys(a,e)}},l1=(s,t,e)=>{const i=k(s);if(!i)return;const r=i.getLibrary(t);if(r&&(r.deleteAction(e),i.active&&r.active&&(Es(),mt()<=e&&xs()>=e))){const n=$t.elements[e-mt()];if(!n)return;ys(n,e)}},h1=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=new fa({id:t,type:"folder",name:e,mode:"close",folderId:i});xe(r,n),r.active&&Q()},d1=(s,t,e)=>{const i=k(s);if(!i)return;const r=i.getLibrary(t);r&&(r.folderId=e,Rs(i),re(i),i.active&&Q())},$1=async(s,t)=>{const e=k(s);if(!e)return;const i=new zs(t);await i.wait(),xe(e,i),e.active&&(gt(),Q())},_1=(s,t)=>{const e=k(s);if(!e)return;const i=new zs(t);e.libraries.set(i.id,i),e.active&&(gt(),Q())},f1=(s,t)=>{const e=k(s);if(!e)return;const i=new Ws(t);xe(e,i),e.active&&(gt(),Q())},g1=(s,t)=>{const e=k(s);if(!e)return;const i=new Ws(t);e.libraries.set(i.id,i),e.active&&(gt(),Q())},m1=async(s,t)=>{const e=k(s);if(!e)return;const i=new Hs(t);await i.wait(),xe(e,i),e.active&&(gt(),Q())},p1=(s,t)=>{const e=k(s);if(!e)return;const i=new Hs(t);e.libraries.set(i.id,i),e.active&&(gt(),Q())},b1=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=new kr({id:t,name:e,type:"container",folderId:i});xe(r,n),r.active&&Q()},x1=(s,t)=>{const e=k(s);if(!e)return;const i=e.getLibrary(t.id);Ys(e,i),e.active&&(gt(),Q())},y1=(s,t,e,i,r,n)=>{const a=k(s);if(!a)return;const o=a.getLibrary(t);if(!o)return;const c=o.layers.splice(e,1);if(!c.length)return;const u=c[0];switch(u.mode=r,u.parentId=n,u.mode){case Ht:case jt:if(i>e){let l=0;for(let h=e;h<o.layers.length;++h){if(o.layers[h].parentId!==u.id){if(e+1>h)break;continue}l++}o.layers.splice(i+l,0,u)}else o.layers.splice(i,0,u);nc(o,u,e);break;default:o.layers.splice(i,0,u);break}a.active&&o.active&&Xe()},E1=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=r.getLibrary(t);if(!n)return;const a=n.layers[e];a&&(a.color=i,r.active&&n.active&&(la(a),a.light&&Ns(a)))},T1=(s,t,e,i,r)=>{const n=k(s);if(!n)return;const a=n.getLibrary(t);if(!a)return;const o=a.layers[e];if(!o)return;o.mode=i,o.parentId=r;let c=a.layers.indexOf(o)+1;for(;c<a.layers.length;++c){const u=a.layers[c];if(u.parentId!==o.id)break;u.clearRelation(),n.active&&a.active&&Cs(u)}n.active&&a.active&&Cs(o)},v1=(s,t,e)=>{const i=k(s);if(!i)return;const r=i.getLibrary(t);r&&(i.pathMap.delete(r.getPath(i)),r.name=e,i.pathMap.set(r.getPath(i),r.id),re(i),i.active&&Q())},S1=(s,t,e)=>{const i=k(s);if(!i)return;const r=i.getLibrary(t);r&&(i.symbolMap.delete(r.symbol),r.symbol=e,e&&i.pathMap.set(e,r.id),i.active&&lc(r))},w1=async s=>{const t=s.messages;switch(s.command){case Li:wp(t[0],t[1],t[2],t[4]);break;case Ai:j0(t[0],t[3]);break;case vi:vp(t[0],t[1],t[2],t[3],t[4]);break;case Si:Sp(t[0],t[1],t[2]);break;case wi:c1(t[0],t[1],t[2],t[3]);break;case Mi:u1(t[0],t[1],t[2],t[4]);break;case Ii:l1(t[0],t[1],t[2]);break;case Ci:h1(t[0],t[2],t[3],t[4]);break;case Oi:v1(t[0],t[2],t[4]);break;case Bi:S1(t[0],t[2],t[4]);break;case Ri:f1(t[0],t[2]);break;case Fi:d1(t[0],t[2],t[4]);break;case Pi:g1(t[0],t[3]);break;case ki:$1(t[0],t[2]);break;case Ni:_1(t[0],t[3]);break;case Di:m1(t[0],t[2]);break;case Ui:p1(t[0],t[3]);break;case Yi:b1(t[0],t[2],t[3],t[4]);break;case Xi:x1(t[0],t[2]);break;case Wi:y1(t[0],t[1],t[2],t[3],t[5],t[7]);break;case Ps:E1(t[0],t[1],t[2],t[4]);break;case aa:T1(t[0],t[1],t[2],t[4],t[6]);break}},_c=async(s,t,e=!1)=>{const i=document.getElementById(Mr);if(!i)return;const r=k(s);if(!r||r.historyIndex>=r.histories.length)return;const n=r.getLibrary(t);if(!n)return;const a=i.children[r.historyIndex];if(!a)return;a.setAttribute("class","");const o=r.histories[r.historyIndex++];o&&(await w1(o),!e&&st()&&dt({command:fh,messages:[r.id,n.id],args:[]}))},M1=(s,t)=>{const e=k(s);if(e){if(e.active){const i=Ti(e.id);if(!i)return;const r=wr(e.id);if(!r)return;r.textContent=i.textContent=t}e.name=t}},I1=(s,t,e)=>{const i=k(s);if(!i)return;const r=i.getLibrary(t);if(!r)return;const n=r.layers[e];if(!n)return;const a=new lt(i,r,n);new Ot(i,r).deactivatedLayer([a.index]),r.deleteLayer(n),i.active&&r.active&&Br()},A1=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=r.getLibrary(t);if(!n)return;new Ot(r,n).deactivatedAllLayers();const o=n.createLayer();o.load(i),n.setLayer(o,e),r.active&&n.active&&Br()},L1=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=r.getLibrary(t);if(!n)return;const a=n.layers[e];a&&(a.name=i,r.active&&n.active&&ua(a))},C1=(s,t,e)=>{const i=k(s);if(!i)return;const r=i.getLibrary(t);if(r&&(r.deleteAction(e),i.active&&r.active&&(Es(),mt()<=e&&xs()>=e))){const n=$t.elements[e-mt()];if(!n)return;ys(n,e)}},O1=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=r.getLibrary(t);if(n&&(n.setAction(e,i),r.active&&n.active&&(Es(),mt()<=e&&xs()>=e))){const a=$t.elements[e-mt()];if(!a)return;ys(a,e)}},B1=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=r.getLibrary(t);if(n&&(n.setAction(e,i),r.active&&n.active&&(Es(),mt()<=e&&xs()>=e))){const a=$t.elements[e-mt()];if(!a)return;ys(a,e)}},R1=(s,t)=>{const e=k(s);if(!e)return;const i=e.getLibrary(t);i&&(Ys(e,i),e.active&&Q())},F1=(s,t,e)=>{const i=k(s);if(!i)return;const r=i.getLibrary(t);r&&(r.folderId=e,Rs(i),re(i),i.active&&Q())},P1=(s,t)=>{const e=k(s);if(!e)return;const i=e.getLibrary(t.id);i&&(Ys(e,i),e.active&&(gt(),Q()))},Nr=async s=>{switch(s.type){case"container":return new kr(s);case"folder":return new fa(s);case"bitmap":return new Ws(s);case"video":{const t=new zs(s);return await t.wait(),t}case"sound":{const t=new Hs(s);return await t.wait(),t}default:throw new Error("This is an undefined class.")}},k1=async(s,t)=>{const e=k(s);if(!e)return;const i=await Nr(t);e.libraries.set(i.id,i),e.active&&(gt(),Q())},N1=(s,t)=>{const e=k(s);if(!e)return;const i=e.getLibrary(t.id);i&&(Ys(e,i),e.active&&(gt(),Q()))},D1=async(s,t)=>{const e=k(s);if(!e)return;const i=await Nr(t);e.libraries.set(i.id,i),e.active&&(gt(),Q())},U1=(s,t)=>{const e=k(s);if(!e)return;const i=e.getLibrary(t.id);i&&(Ys(e,i),e.active&&(gt(),Q()))},Y1=async(s,t)=>{const e=k(s);if(!e)return;const i=await Nr(t);e.libraries.set(i.id,i),e.active&&(gt(),Q())},X1=(s,t)=>{const e=k(s);if(!e)return;const i=e.getLibrary(t);i&&(Ys(e,i),e.active&&Q())},W1=async(s,t)=>{const e=k(s);if(!e)return;const i=await Nr(t);xe(e,i),re(e),e.active&&(gt(),Q())},V1=(s,t,e,i,r,n)=>{const a=k(s);if(!a)return;const o=a.getLibrary(t);if(!o)return;const c=o.layers.splice(i,1);if(!c.length)return;const u=c[0];switch(u.mode=r,u.parentId=n,u.mode){case Ht:case jt:if(e>i){let l=0;for(let h=i;h<o.layers.length;++h){if(o.layers[h].parentId!==u.id){if(i+1>h)break;continue}l++}o.layers.splice(e+l,0,u)}else o.layers.splice(e,0,u);nc(o,u,i);break;default:o.layers.splice(e,0,u);break}a.active&&o.active&&Xe()},G1=(s,t,e,i)=>{const r=k(s);if(!r)return;const n=r.getLibrary(t);if(!n)return;const a=n.layers[e];a&&(a.color=i,r.active&&n.active&&(la(a),a.light&&Ns(a)))},z1=(s,t,e,i,r,n)=>{const a=k(s);if(!a)return;const o=a.getLibrary(t);if(!o)return;const c=o.layers[e];if(c){c.mode=i,c.parentId=r;for(let u=0;u<n.length;++u){const l=o.layers[n[u]];switch(l.parentId=c.id,i){case Ht:l.mode=ps;break;case jt:l.mode=bs;break}a.active&&o.active&&Cs(l)}a.active&&o.active&&Cs(c)}},H1=(s,t,e)=>{const i=k(s);if(!i)return;const r=i.getLibrary(t);r&&(i.pathMap.delete(r.getPath(i)),r.name=e,i.pathMap.set(r.getPath(i),r.id),re(i),i.active&&Q())},j1=(s,t,e)=>{const i=k(s);if(!i)return;const r=i.getLibrary(t);r&&(i.symbolMap.delete(r.symbol),r.symbol=e,e&&i.symbolMap.set(e,r.id),i.active&&lc(r))},K1=async s=>{const t=s.messages;switch(s.command){case Li:L1(t[0],t[1],t[2],t[3]);break;case Ai:M1(t[0],t[2]);break;case vi:I1(t[0],t[1],t[2]);break;case Si:A1(t[0],t[1],t[2],t[3]);break;case wi:C1(t[0],t[1],t[2]);break;case Mi:O1(t[0],t[1],t[2],t[3]);break;case Ii:B1(t[0],t[1],t[2],t[3]);break;case Ci:R1(t[0],t[2]);break;case Oi:H1(t[0],t[2],t[3]);break;case Bi:j1(t[0],t[2],t[3]);break;case Ri:N1(t[0],t[2]);break;case Fi:F1(t[0],t[2],t[3]);break;case Pi:await D1(t[0],t[2]);break;case ki:P1(t[0],t[2]);break;case Ni:await k1(t[0],t[2]);break;case Di:U1(t[0],t[2]);break;case Ui:await Y1(t[0],t[2]);break;case Yi:X1(t[0],t[2]);break;case Xi:await W1(t[0],t[2]);break;case Wi:V1(t[0],t[1],t[2],t[3],t[4],t[6]);break;case Ps:G1(t[0],t[1],t[2],t[3]);break;case aa:z1(t[0],t[1],t[2],t[3],t[5],t[7]);break}},fc=async(s,t,e=!1)=>{const i=document.getElementById(Mr);if(!i)return;const r=k(s);if(!r||!r.historyIndex)return;const n=r.getLibrary(t);if(!n)return;const a=r.histories[--r.historyIndex];if(!a)return;const o=i.children[r.historyIndex];o&&(o.setAttribute("class","disable"),await K1(a),!e&&st()&&dt({command:_h,messages:[r.id,n.id],args:[]}))},q1=async s=>{if(s.button!==0)return;if(s.stopPropagation(),z(),!Vi()&&!st()){Ir();return}const t=s.currentTarget;if(!t)return;const e=M(),i=parseInt(t.dataset.libraryId),r=e.getLibrary(i);if(!r)return;const n=parseInt(t.dataset.index);if(e.historyIndex>n)for(;e.historyIndex!==n;)await fc(e.id,r.id);else for(;n>=e.historyIndex;)await _c(e.id,r.id)},gc=async s=>{const t=s.getElementsByClassName(V0),e=es(),i=T0(),r=t.length;for(let n=0;n<r;++n){const a=t[n],o=a.dataset.text;if(!o||!i.has(o))continue;let c=i.get(o);if(!c)continue;const u=a.dataset.shortcutKey;if(u){let h=a.dataset.shortcutText;if(e.size&&e.has(u)){const $=e.get(u);$&&(h=$.text)}c+=` (${h})`}const l=a.dataset.args;l&&(c=S0(c,...l.split(Eh))),a.innerText=c}},Tt=(s,t,e,i="",...r)=>{const n=document.getElementById(Mr);if(!n)return;n.insertAdjacentHTML("beforeend",G0(s,t,e,...r));const a=n.lastElementChild;a&&(i&&a.setAttribute("class",i),gc(a),a.addEventListener(E.MOUSE_DOWN,q1))},Z1=(s,t,e,i)=>({command:Ai,messages:[s,t,e,i],args:[e,i]}),J1=(s,t,e=!1)=>{const i=s.scene;St(s);const r=Z1(s.id,i.id,s.name,t);Tt(i.id,s.historyIndex,Et(Ai),"",...r.args),s.addHistory(r),!e&&st()&&dt(r)},Q1=(s,t,e=!1)=>{const i=k(s);i&&(J1(i,t,e),i.name=t||"Untitled")},tx=(s,t)=>{s.contentEditable="false",t.style.borderBottom="",Ye(!1)},mc=(s,t,e=!1)=>{t||(t="Untitled");const i=_s(s.id);if(!i)return;const r=Ti(s.id);if(!r)return;const n=wr(s.id);n&&(tx(r,i),s.name!==t&&(r.textContent=n.textContent=t,Q1(s.id,t,e)))},ex=s=>{if(s.stopPropagation(),!s.target)return;const t=parseInt(s.target.dataset.tabId),e=k(t);if(!e)return;const i=Ti(t);if(!i)return;const r=i.textContent;if(!r)return i.textContent="Untitled",i.focus();mc(e,r)},sx=s=>{if(!s.target)return;const t=s.currentTarget,e=parseInt(t.dataset.tabId),i=_s(e);i&&(i.draggable=!1)};let n$=null;const a$=s=>{n$=s},pc=()=>n$,ix=s=>{z(),a$(s.target)},rx=s=>{if(s.preventDefault(),!s.currentTarget)return;const t=s.currentTarget;pc()!==t&&(t.classList.contains("drop-targe")||t.classList.add("drop-target"))},nx=s=>{if(s.preventDefault(),!s.currentTarget)return;const t=s.currentTarget;pc()!==t&&t.classList.remove("drop-target")},ax=s=>{if(s.stopPropagation(),s.preventDefault(),!s.currentTarget)return;const t=s.currentTarget;t.classList.remove("drop-target");const e=pc();if(!e||t===e)return;const i=document.getElementById(ql);if(!i)return;const r=t.nextElementSibling;i.insertBefore(e,e===r?t:r),a$(null)},ox=s=>{const t=wr(s.id);t&&t.addEventListener(E.MOUSE_DOWN,n=>{n.stopPropagation(),k0(s)});const e=document.getElementById(`tab-delete-id-${s.id}`);e&&(e.addEventListener(E.MOUSE_DOWN,n=>{n.stopPropagation(),n.stopImmediatePropagation(),n.preventDefault()}),e.addEventListener(E.MOUSE_UP,async n=>{n.stopPropagation(),await O0(s)}));const i=_s(s.id);i&&(i.addEventListener(E.MOUSE_DOWN,P0),i.addEventListener("dragstart",ix),i.addEventListener("dragover",rx),i.addEventListener("dragleave",nx),i.addEventListener("drop",ax));const r=Ti(s.id);r&&(r.addEventListener("focusin",sx),r.addEventListener("focusout",ex),r.addEventListener("keypress",N0))},cx=s=>{const t=document.getElementById(ql);if(!t)return;t.insertAdjacentHTML("beforeend",b0(s.id,s.name));const e=document.getElementById(p0);if(!e)return;e.insertAdjacentHTML("beforeend",x0(s.id,s.name));const i=_s(s.id);i&&(lh(i),ox(s))},ux=s=>{s.classList.remove("disable"),s.classList.add("active")},lx=s=>{s.classList.remove("active"),s.classList.add("disable")},hx=s=>{const t=_s(s);t&&t.remove();const e=wr(s);e&&e.remove()};class dx{_$workSpace;constructor(t){this._$workSpace=t}initialize(){cx(this._$workSpace)}remove(){hx(this._$workSpace.id)}active(){const t=_s(this._$workSpace.id);t&&ux(t)}disable(){const t=_s(this._$workSpace.id);t&&lx(t)}}const $x=s=>{const t=document.getElementById(Kl);t&&(t.style.width=`${s.width}px`,t.style.height=`${s.height}px`,t.style.backgroundColor=s.bgColor)},_x=()=>{const s=document.getElementById(Xm);s&&(s.value="100")},fx=s=>{const t=document.getElementById(oc);t&&(t.style.backgroundColor=s)},gx=s=>{const t=document.getElementById($p);t&&(t.value=`${s.width}`);const e=document.getElementById(_p);e&&(e.value=`${s.height}`);const i=document.getElementById(Sd);i&&(i.value=`${s.fps}`);const r=document.getElementById(fp);r&&(r.value=s.bgColor);const n=document.getElementById(gp);n&&n.children.length&&n.children[0].setAttribute("class",s.lock?"active":"disable")},mx=(s="")=>{const t=document.getElementById(Z0);t&&(t.value=s)},px=s=>{const t=document.getElementById(g0);t&&(t.style.width=`${s.width+window.screen.width}px`,t.style.height=`${s.height+window.screen.height}px`)},bx=s=>{const t=document.getElementById(Ro);t&&(t.scrollLeft=window.screen.width/2-(t.clientWidth-s.width)/2,t.scrollTop=window.screen.height/2-(t.clientHeight-s.height)/2)},xx=()=>{const s=document.getElementById(Kl);s&&(mg(s.offsetLeft),pg(s.offsetTop))},yx=s=>{$x(s),_x(),fx(s.bgColor),gx(s),mx(""),px(s),bx(s),xx()};class Ex{_$width;_$height;_$fps;_$bgColor;_$lock;constructor(){this._$width=up,this._$height=lp,this._$fps=hp,this._$bgColor=dp,this._$lock=!1}get width(){return this._$width}set width(t){this._$width=he(+t,1,1024*4)}get height(){return this._$height}set height(t){this._$height=he(+t,1,1024*4)}get fps(){return this._$fps}set fps(t){this._$fps=he(t|0,1,60)}get bgColor(){return this._$bgColor}set bgColor(t){this._$bgColor=`${t}`.toLowerCase()}get lock(){return this._$lock}set lock(t){this._$lock=!!t}run(){yx(this)}toObject(){return{width:this.width,height:this.height,fps:this.fps,bgColor:this.bgColor,lock:this.lock}}load(t){this._$width=t.width,this._$height=t.height,this._$fps=t.fps,this._$bgColor=t.bgColor,this._$lock=t.lock}}const o$=s=>{const e=M().toolAreaState;e.state!=="fixed"&&(s.style.height="96vh",s.style.left=`${e.offsetLeft}px`,s.style.top=`${e.offsetTop}px`,s.style.zIndex="65535",s.style.boxShadow="0 0 5px rgba(245, 245, 245, 0.25)",s.style.position="fixed",document.documentElement.style.setProperty("--tool-width","0px"))},c$=s=>{s.style.height="",s.style.left="",s.style.top="",s.style.zIndex="",s.style.boxShadow="",s.style.position="",document.documentElement.style.setProperty("--tool-width",`${zi}px`)},Tx=s=>{const t=document.getElementById(ie);t&&(s.state==="move"?o$(t):c$(t))},u$=s=>{const e=M().timelineAreaState,i=document.documentElement.style;i.setProperty("--timeline-height","0px"),s.style.left=`${e.offsetLeft}px`,s.style.top=`${e.offsetTop}px`,s.style.borderLeft="1px solid #1c1c1c",s.style.borderBottom="1px solid #1c1c1c",s.style.borderRight="1px solid #1c1c1c",s.style.minWidth=`${Ah}px`,s.style.zIndex="65535",s.style.boxShadow="0 0 5px rgba(245, 245, 245, 0.25)",s.style.position="fixed",i.setProperty("--timeline-logic-width",`${s.clientWidth}px`),i.setProperty("--timeline-logic-height",`${s.clientHeight}px`),s.style.width="var(--timeline-logic-width)";const r=document.getElementById(Xo);if(!r)return;r.style.display="",i.setProperty("--timeline-adjustment-width","8px");const n=document.getElementById(Gi);n&&(n.style.width="calc(var(--timeline-logic-width) - var(--timeline-layer-controller-width) - var(--timeline-adjustment-width))")},l$=s=>{s.style.borderLeft="",s.style.borderBottom="",s.style.borderRight="",s.style.minWidth="",s.style.left="",s.style.top="",s.style.zIndex="",s.style.boxShadow="",s.style.width="",s.style.position="";const t=document.documentElement.style,e=t.getPropertyValue("--timeline-logic-height");t.setProperty("--timeline-height",e),t.setProperty("--timeline-logic-width","0px");const i=document.getElementById(Gi);if(!i)return;i.style.width="",$t.clientWidth=i.clientWidth;const r=document.getElementById(Xo);r&&(r.style.display="none",t.setProperty("--timeline-adjustment-width","0px"))},h$=s=>{const t=M().timelineAreaState;t.frameHeight=s,document.documentElement.style.setProperty("--timeline-frame-height",`${s}px`)},d$=()=>{const s=document.getElementById(Wo);s&&(K.clientHeight=s.clientHeight)},vx=()=>{const s=document.getElementById(ud);if(!s)return;const t=M().timelineAreaState.frameHeight/Yo,e=s.options,i=e.length;for(let r=0;i>r;++r){const n=e[r];n.selected=parseFloat(n.value)===t}},Sx=s=>{const t=document.getElementById(ms);if(!t)return;const e=document.documentElement.style;s.state==="move"?(u$(t),e.setProperty("--timeline-logic-width",`${s.width}px`),Os(s.offsetTop)):(l$(t),e.setProperty("--timeline-height",`${s.height}px`),Os(t.offsetTop)),e.setProperty("--timeline-logic-height",`${s.height}px`),Bh(s.frameWidth),h$(s.frameHeight),Yh(s.frameWidth),is(),Lr(),d$(),vx()},ji="controller-area-property",wx="controller",xa="controller-tab-area",Mx="controller-adjustment",$$="library-menu-copy",_$="library-menu-export",f$="library-menu-change-scene",g$="library-open-photopea",bc=360,m$=s=>{const e=M().propertyAreaState;s.style.display="",s.style.width=`${bc}px`,s.style.height="96vh",s.style.left=`${e.offsetLeft}px`,s.style.top=`${e.offsetTop}px`,s.style.zIndex="65535",s.style.backgroundColor="#2c2c2c",s.style.boxShadow="0 0 5px rgba(245, 245, 245, 0.25)",s.style.position="fixed"},p$=()=>{const s=document.getElementById(xa);if(!s)return;const t=s.children[0];if(!t)return;t.style.display="",t.classList.remove("disable"),t.classList.add("active");const e=document.getElementById(t.dataset.tabType);if(!e)return;e.style.display="";const i=s.children.length;for(let r=1;r<i;++r){const n=s.children[r];if(!n)continue;n.classList.add("disable"),n.classList.remove("active");const a=document.getElementById(n.dataset.tabType);a&&(a.style.display="none")}},b$=()=>{const s=document.getElementById(xa);if(!s)return;const t=s.children[0];if(!t)return;t.classList.remove("active"),t.classList.add("disable"),t.style.display="none";const e=s.children[1];if(!e)return;e.classList.add("active"),e.classList.remove("disable");const i=document.getElementById(e.dataset.tabType);i&&(i.style.display="")},x$=s=>{s.style.width="",s.style.height="",s.style.left="",s.style.top="",s.style.zIndex="",s.style.boxShadow="",s.style.position="",s.style.backgroundColor="",s.style.display=""},Ix=s=>{const t=document.getElementById(ji);t&&(s.state==="move"?(m$(t),b$()):(x$(t),p$()))},Ax=s=>{document.documentElement.style.setProperty("--controller-width",`${s.width}px`)},Lx=()=>{const s=document.getElementById(Mr);if(!s)return;for(;s.children.length;)s.children[0].remove();const t=M(),e=t.histories;for(let i=0;i<e.length;++i){const r=e[i],n=r.messages[1];Tt(n,i,Et(r.command),t.historyIndex>i?"":"disable",...r.args)}},Cx=s=>new Promise(t=>{const e=Z(me);e&&(e.show(),e.message=be("{{N2D}}"),j.clear(),s.stage.run(),s.screenTab.active(),Tx(s.toolAreaState),Sx(s.timelineAreaState),Ix(s.propertyAreaState),Ax(s.controllerAreaState),Es(),gt(),Q(),hc(),Lx(),s.scene.run().then(()=>{e.hide(),t()}))}),Ox=s=>new Promise(t=>{Fr(),Pr(be("{{}}")),s.screenTab.disable(),s.scene.stop(),t()}),Bx=s=>new Promise(t=>{s.screenTab.initialize(),t()}),Rx=s=>new Promise(t=>{s.active&&(Fr(),Pr(be("{{}}"))),s.screenTab.remove(),y$(s).then(()=>{uc(),t()})}),Fx=async(s,t)=>{for(let e=0;e<t.length;++e){const i=t[e];if(i.id===0){s.root.load(i);continue}const r=await Nr(i);s.libraries.set(r.id,r)}},Px=s=>{s.symbolMap.clear();for(const t of s.libraries.values())t.symbol&&s.symbolMap.set(t.symbol,t.id)};let Va=1;class Dr{_$id;_$name;_$scene;_$active;_$historyIndex;_$root;_$stage;_$libraries;_$pathMap;_$symbolMap;_$screenTab;_$toolAreaState;_$timelineAreaState;_$propertyAreaState;_$controllerAreaState;_$plugins;_$histories;constructor(){this._$id=Va++,this._$name=`Untitled-${this._$id}`,this._$libraries=new Map,this._$pathMap=new Map,this._$symbolMap=new Map,this._$stage=new Ex,this._$root=new kr({id:0,type:"container",name:"main",symbol:""}),xe(this,this._$root),this._$scene=this._$root,this._$screenTab=new dx(this),this._$active=!1,this._$toolAreaState={state:"fixed",offsetLeft:0,offsetTop:0},this._$timelineAreaState={state:"fixed",offsetLeft:0,offsetTop:0,width:0,height:q0,frameWidth:vh,frameHeight:Yo},this._$propertyAreaState={state:"fixed",offsetLeft:0,offsetTop:0},this._$controllerAreaState={width:bc},this._$histories=[],this._$historyIndex=0,this._$plugins=new Map}static get workSpaceId(){return Va}static set workSpaceId(t){Va=he(t,1,Number.MAX_VALUE)}get id(){return this._$id}get active(){return this._$active}get root(){return this._$root}get stage(){return this._$stage}get histories(){return this._$histories}get historyIndex(){return this._$historyIndex}set historyIndex(t){this._$historyIndex=t}get scene(){return this._$scene}set scene(t){this._$scene=t}get libraries(){return this._$libraries}get pathMap(){return this._$pathMap}get symbolMap(){return this._$symbolMap}get screenTab(){return this._$screenTab}get toolAreaState(){return this._$toolAreaState}get timelineAreaState(){return this._$timelineAreaState}get controllerAreaState(){return this._$controllerAreaState}get propertyAreaState(){return this._$propertyAreaState}get name(){return this._$name}set name(t){this._$name=`${t}`}get nextLibraryId(){const t=Array.from(this._$libraries.keys());return t.sort((i,r)=>i>r?1:i<r?-1:0),this._$libraries.get(t.pop()||0).id+1}initialize(){return Bx(this)}async load(t,e=!1){this.name=t.name,e&&t.id&&(this._$id=t.id),this._$stage.load(t.stage),t.libraries&&await this.loadLibrary(t.libraries),t.tool&&this.updateToolArea(t.tool),t.timeline&&this.updateTimelineArea(t.timeline),t.property&&this.updatePropertyArea(t.property),t.controller&&this.updateControllerArea(t.controller),t.historyIndex&&(this._$historyIndex=t.historyIndex),t.histories&&this._$histories.push(...t.histories)}getLibrary(t){return this._$libraries.has(t)?this._$libraries.get(t):null}async loadLibrary(t){await Fx(this,t),Rs(this),Px(this)}addHistory(t){for(this._$histories.length=this._$historyIndex,this._$histories[this._$historyIndex++]=t;this._$histories.length>D0;)this._$histories.shift()}updateToolArea(t){Object.assign(this._$toolAreaState,t)}updatePropertyArea(t){Object.assign(this._$propertyAreaState,t)}updateTimelineArea(t){Object.assign(this._$timelineAreaState,t)}updateControllerArea(t){Object.assign(this._$controllerAreaState,t)}stop(){return this._$active=!1,Ox(this)}run(){return this._$active=!0,Cx(this)}remove(){return Rx(this)}toObject(){const t=[];for(const e of this._$libraries.values())t.push(e.toObject());return{version:w0,id:this.id,name:this.name,stage:this.stage.toObject(),libraries:t,plugins:Array.from(this._$plugins.values()),tool:structuredClone(this._$toolAreaState),timeline:structuredClone(this._$timelineAreaState),property:structuredClone(this._$propertyAreaState),controller:structuredClone(this._$controllerAreaState),historyIndex:this._$historyIndex,histories:this._$histories}}}const se=[],ya=()=>se;let we=null;const M=()=>we,xc=s=>new Promise(t=>{if(we){if(we.id===s.id)return t();we.stop().then(()=>{we=s,we.run().then(t)})}else we=s,we.run().then(t)}),k=s=>{for(let t=0;t<se.length;++t){const e=se[t];if(e.id===s)return e}return null},kx=s=>{se.length||(we=s),se.push(s)},Ea=()=>{const s=new Dr;return se.push(s),se.length===1&&(we=s),s},y$=s=>new Promise(t=>{const e=se.indexOf(s);if(e===-1)return t();if(se.splice(e,1),se.length){if(s.active){we=null,xc(se[0]).then(t);return}return t()}Dr.workSpaceId=1;const i=Ea();s.stop().then(()=>i.initialize()).then(()=>{i.run().then(t)})}),Nx=async()=>{for(let s=0;s<se.length;++s){const t=se[s];await t.stop(),t.screenTab.remove()}se.length=0};let E$=null;const T$=()=>{window.removeEventListener("click",T$),E$=new AudioContext},v$=()=>E$,Dx=s=>{M().toolAreaState.state==="fixed"&&s.stopPropagation();const e=d0();e&&e.dispatchEvent(E.MOUSE_MOVE,s)},S$=s=>{s.stopPropagation(),s.preventDefault(),requestAnimationFrame(()=>{const t=document.getElementById(ie);t&&(t.style.left=`${t.offsetLeft+s.movementX}px`,t.style.top=`${t.offsetTop+s.movementY}px`)})},w$=s=>{s.stopPropagation(),window.removeEventListener(E.MOUSE_MOVE,S$),window.removeEventListener(E.MOUSE_UP,w$),kt("auto");const t=document.getElementById(ie);if(!t)return;t.style.left=`${t.offsetLeft+s.movementX}px`,t.style.top=`${t.offsetTop+s.movementY}px`,M().updateToolArea({state:"move",offsetLeft:t.offsetLeft,offsetTop:t.offsetTop})},Ux=()=>{window.addEventListener(E.MOUSE_MOVE,S$),window.addEventListener(E.MOUSE_UP,w$)};let M$=!1;const Yx=()=>M$,Er=s=>{M$=s},Xx=()=>{if(!Yx()){kt("auto");return}if(Er(!1),f0()==="down"){const s=document.getElementById(ie);if(!s)return;const t=M();t.toolAreaState.state==="fixed"&&(t.updateToolArea({state:"move",offsetLeft:s.offsetLeft,offsetTop:s.offsetTop}),o$(s),ks(),Ds()),kt("move"),Ux()}else kt("auto")};let dn=!1,Tu;const Wx=s=>{if(s.button===0)if(s.stopPropagation(),s.preventDefault(),z(),jl("down"),!dn)dn=!0,setTimeout(()=>{dn=!1},300),Er(!0),Tu=setTimeout(()=>{if(!Vi()&&!st()){Ir();return}Xx()},600);else{dn=!1,clearTimeout(Tu),Er(!1);const t=M();if(t.toolAreaState.state==="fixed")return;t.updateToolArea({state:"fixed",offsetLeft:0,offsetTop:0});const e=document.getElementById(ie);if(!e)return;c$(e),ks(),Ds()}},Vx=()=>{jl("up")},Gx=s=>{s.stopPropagation(),Er(!1)},zx=s=>{s.addEventListener(E.MOUSE_DOWN,Wx),s.addEventListener(E.MOUSE_MOVE,Dx),s.addEventListener(E.MOUSE_UP,Vx),s.addEventListener(E.MOUSE_OUT,Gx)};class Hx{_$events;constructor(){this._$events=new Map}addEventListener(t,e){this._$events.has(t)||this._$events.set(t,[]);const i=this._$events.get(t);i&&i.push(e)}dispatchEvent(t,e=null){if(!this._$events.has(t))return;const i=this._$events.get(t);if(!(!i||!i.length))for(let r=0;r<i.length;++r){const n=i[r];n(e)}}}class jx extends Hx{_$name;_$active;_$target;constructor(t=""){super(),this._$name=`${t}`,this._$active=!1,this._$target=null,this._$initialize()}_$initialize(){this.addEventListener(E.MOUSE_DOWN,t=>{t.stopPropagation(),this.activation(t)}),this.addEventListener(E.MOUSE_UP,t=>{t.stopPropagation(),this.termination()}),this.addEventListener(E.START,()=>{this.toolStart()}),this.addEventListener(E.END,()=>{this.toolEnd()})}get name(){return this._$name}get active(){return this._$active}set active(t){this._$active=!!t}get target(){return this._$target}set target(t){this._$target=t}activation(t){this._$active=!0,this._$target=t.currentTarget}termination(){this._$active=!1,this._$target=null}toolStart(){kt("auto");const t=document.getElementById(`${ie}-${this._$name}`);!t||t.dataset.mode!=="tool"||t.classList.add("active")}toolEnd(){kt("auto");const t=document.getElementById(`${ie}-${this._$name}`);t&&t.classList.remove("active")}}class oe extends jx{_$cursor;_$pageX;_$pageY;_$offsetX;_$offsetY;constructor(t=""){super(t),this._$cursor="auto",this._$pageX=0,this._$pageY=0,this._$offsetX=0,this._$offsetY=0,t&&this._$register(t)}_$register(t){const e=document.getElementById(`${ie}-${t}`);!e||e.dataset.mode!=="tool"||(_0(this),e.addEventListener(E.MOUSE_DOWN,i=>{this.changeActiveTool(i)}))}get pageX(){return this._$pageX}set pageX(t){this._$pageX=t}get pageY(){return this._$pageY}set pageY(t){this._$pageY=t}get offsetX(){return this._$offsetX}set offsetX(t){this._$offsetX=t}get offsetY(){return this._$offsetY}set offsetY(t){this._$offsetY=t}get cursor(){return this._$cursor}changeActiveTool(t){t.stopPropagation(),z(),Er(!1),zl(this)}setIcon(t){const e=document.getElementById(`${ie}-${this.name}`);if(e){for(;e.children.length;)e.children[0].remove();e.appendChild(t)}}setToolTip(t){const e=document.getElementById(`${ie}-${this.name}`);e&&(e.dataset.detail=`${t}`)}setCursor(t="auto"){this._$cursor=`${t}`}}const Kx=s=>{zl(s)};class qx extends oe{constructor(){super(Mm)}initialize(){Kx(this)}}class Zx extends oe{_$validity;constructor(){super(Cm),this._$validity=!1}get validity(){return this._$validity}}class Jx extends oe{constructor(){super(Im)}}class yc extends oe{constructor(t){super(t)}}class Qx extends yc{constructor(){super(Am)}}class t2 extends oe{constructor(){super(Om)}}class e2 extends oe{constructor(){super(Fm)}}class s2 extends yc{constructor(){super(Pm)}}class i2 extends yc{constructor(){super(km)}}class r2 extends oe{constructor(){super(Dm)}}class n2 extends oe{constructor(){super(Nm)}}class a2 extends oe{constructor(){super(Ym)}}class o2 extends oe{constructor(){super(Um)}}class c2 extends oe{constructor(){super(Rm)}}class u2 extends oe{constructor(){super(Bm)}}class l2 extends oe{constructor(){super(Lm)}}const Ec=()=>{const s=Z(fs);s&&(z(fs),s.show())},I$=()=>{const s=Z(fs);if(!s)return;const t=document.getElementById(fs);if(!t)return;const e=document.getElementById(ic);if(!e)return;const i=document.getElementById(ie);if(!i)return;let r=i.offsetLeft+e.offsetLeft+zi;r+t.clientWidth>window.screen.width&&(r=i.offsetLeft-e.offsetLeft-t.clientWidth),s.offsetLeft=r,s.offsetTop=i.offsetTop+e.offsetTop+e.clientHeight-t.clientHeight},h2=s=>{s.stopPropagation(),z(fs),I$(),Ec()},d2=()=>{const s=document.getElementById(ic);s&&s.addEventListener(E.MOUSE_DOWN,t=>{h2(t)})};class $2 extends oe{constructor(){super(yd)}initialize(){d2()}}const _2=()=>{const s=[qx,Zx,Jx,Qx,t2,e2,s2,i2,r2,n2,a2,o2,c2,u2,l2,$2],t=[];for(let e=0;e<s.length;++e){const i=s[e],r=new i;r.initialize&&r.initialize()}return Promise.all(t)},f2=()=>{const s=document.getElementById(ie);return s&&zx(s),_2()},g2=()=>new Promise(s=>{f2().then(()=>{s()})});class Wt{_$state;_$element;_$name;_$offsetLeft;_$offsetTop;constructor(t){this._$name=`${t}`,this._$state="hide",this._$offsetLeft=0,this._$offsetTop=0,this._$element=document.getElementById(t),M0(this)}get state(){return this._$state}get name(){return this._$name}get offsetLeft(){return this._$offsetLeft}set offsetLeft(t){this._$offsetLeft=t}get offsetTop(){return this._$offsetTop}set offsetTop(t){this._$offsetTop=t}show(){this._$element&&(this.move(this._$element),this._$state!=="show"&&(this._$state="show",this._$element.setAttribute("class","fadeIn")))}hide(){this._$state!=="hide"&&(this._$state="hide",this._$element&&this._$element.setAttribute("class","fadeOut"))}move(t){return t}}const m2=s=>{const t=document.getElementById(Dp);t&&(t.value=s)};class p2 extends Wt{_$active;_$currentState;constructor(){super(me),this._$state="show",this._$active=!1,this._$currentState=0}get active(){return this._$active}set message(t){Pr(t)}get currentState(){return this._$currentState}set currentState(t){this._$currentState=t,m2(t)}update(){this.currentState>=100||(this.currentState++,95>this.currentState&&requestAnimationFrame(()=>{this.update()}))}show(){this._$state!=="show"&&(super.show(),this._$active=!0,this.update())}hide(){this._$state!=="hide"&&(this.message=be("{{}}"),this.currentState=100,setTimeout(()=>{super.hide(),setTimeout(()=>{this._$active=!1,this.currentState=0},300)},300))}}const b2="publish-layer-setting",x2="publish-type-setting",y2="modal-setting",E2="current-version",T2="language-setting",v2="shortcut-setting",S2="share-setting",Tc=s=>{localStorage.setItem(Zl,JSON.stringify(s))},w2=s=>{if(s.stopPropagation(),s.target){const t=gs(),e=s.target;t.layer=e.value==="1",Tc(t)}},M2=s=>{const t=gs(),e=s.children[t.layer?1:0];e.selected=!0},I2=()=>{const s=document.getElementById(b2);s&&(M2(s),s.addEventListener(E.CHANGE,w2))},A2=s=>{const t=gs(),e=s.children,i=e.length;for(let r=0;r<i;++r){const n=e[r];if(t.type===n.value){n.selected=!0;break}}},L2=s=>{s.stopPropagation();const t=s.target;if(!t)return;const e=gs();e.type=t.value,Tc(e)},C2=()=>{const s=document.getElementById(x2);s&&(A2(s),s.addEventListener(E.CHANGE,L2))},O2=s=>{s.stopPropagation();const t=s.target;if(!t)return;const e=gs();e.modal=t.value==="1",Tc(e)},B2=s=>{const t=gs(),e=s.children[t.modal?0:1];e.selected=!0},R2=()=>{const s=document.getElementById(y2);s&&(B2(s),s.addEventListener(E.CHANGE,O2))},A$=s=>{localStorage.setItem(Jl,s)},F2=s=>fetch(`${W0}/${s.toLocaleLowerCase()}.json`).then(t=>t.json()),L$=async s=>{const t=await F2(s).catch(()=>{const e=Z(me);if(e)throw e.message="[Error] check network settings",new Error("Communication error, check network settings")});v0(t)},P2=s=>{s.stopPropagation();const t=s.target;if(!t)return;const e=t.value;e&&(A$(e),L$(e).then(()=>{gc(document)}))},C$=()=>localStorage.getItem(Jl),k2=s=>{const t=C$();if(!t)return;const e=s.children,i=e.length;for(let r=0;r<i;++r){const n=e[r];if(t===n.value){n.selected=!0;break}}},N2=()=>{const s=document.getElementById(T2);s&&(k2(s),s.addEventListener(E.CHANGE,P2))},D2="0.252.0",U2=()=>{const s=document.getElementById(E2);s&&(s.textContent=` version: ${D2}`)},Y2=()=>{const s=Z(fs);s&&s.hide()},X2=()=>{const s=Z(_i);if(!s)return;const t=document.getElementById(fs);if(!t)return;const e=document.getElementById(_i);if(!e)return;let i=t.offsetLeft;if(i+e.clientWidth>window.screen.width){const r=document.getElementById(ie);if(!r)return;const n=document.getElementById(ic);if(!n)return;i=r.offsetLeft-n.offsetLeft-e.clientWidth}s.offsetLeft=i,s.offsetTop=t.offsetTop},W2=()=>{const s=Z(_i);s&&(z(_i),s.show())},V2=s=>{s.stopPropagation(),Y2(),X2(),W2()},G2=()=>{const s=document.getElementById(v2);s&&s.addEventListener(E.MOUSE_DOWN,V2)},z2=()=>{if(Un())return;const s=oa();s&&s.send(JSON.stringify({roomId:location.hash.replace("#",""),command:"initialize"}))},vu=new Gs,O$=()=>new Promise(s=>{const t=ya();if(!t.length)return s(null);const e=[];for(let n=0;n<t.length;++n){const a=t[n];e.push(a.toObject())}const i=encodeURIComponent(JSON.stringify(e)),r=new Uint8Array(i.length);for(let n=0;n<i.length;++n)r[n]=i[n].charCodeAt(0);vu.onmessage=n=>{s(n.data)},vu.postMessage(r,[r.buffer])}),H2=async s=>{const t=oa();if(!t)return;const e=await O$();if(!e)return;const i=window.crypto.randomUUID(),r=await ae(i,"put"),n=ye(e);await Vs(r,n);const a={workSpaceId:Dr.workSpaceId,connectionId:s,fileId:i,command:"load"};t.send(JSON.stringify(a))},j2=s=>s,B$="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciBvPVVpbnQ4QXJyYXkseD1VaW50MTZBcnJheSx1cj1JbnQzMkFycmF5LFg9bmV3IG8oWzAsMCwwLDAsMCwwLDAsMCwxLDEsMSwxLDIsMiwyLDIsMywzLDMsMyw0LDQsNCw0LDUsNSw1LDUsMCwwLDAsMF0pLFk9bmV3IG8oWzAsMCwwLDAsMSwxLDIsMiwzLDMsNCw0LDUsNSw2LDYsNyw3LDgsOCw5LDksMTAsMTAsMTEsMTEsMTIsMTIsMTMsMTMsMCwwXSksY3I9bmV3IG8oWzE2LDE3LDE4LDAsOCw3LDksNiwxMCw1LDExLDQsMTIsMywxMywyLDE0LDEsMTVdKSxaPWZ1bmN0aW9uKHIsZSl7Zm9yKHZhciBuPW5ldyB4KDMxKSxmPTA7ZjwzMTsrK2YpbltmXT1lKz0xPDxyW2YtMV07Zm9yKHZhciBpPW5ldyB1cihuWzMwXSksZj0xO2Y8MzA7KytmKWZvcih2YXIgZz1uW2ZdO2c8bltmKzFdOysrZylpW2ddPWctbltmXTw8NXxmO3JldHVybntiOm4scjppfX0sJD1aKFgsMikscD0kLmIsdHI9JC5yO3BbMjhdPTI1OCx0clsyNThdPTI4O2Zvcih2YXIgd3I9WihZLDApLGdyPXdyLmIsTz1uZXcgeCgzMjc2OCksdj0wO3Y8MzI3Njg7Kyt2KXt2YXIgaD0odiY0MzY5MCk+PjF8KHYmMjE4NDUpPDwxO2g9KGgmNTI0MjgpPj4yfChoJjEzMTA3KTw8MixoPShoJjYxNjgwKT4+NHwoaCYzODU1KTw8NCxPW3ZdPSgoaCY2NTI4MCk+Pjh8KGgmMjU1KTw8OCk+PjF9Zm9yKHZhciBFPWZ1bmN0aW9uKHIsZSxuKXtmb3IodmFyIGY9ci5sZW5ndGgsaT0wLGc9bmV3IHgoZSk7aTxmOysraSlyW2ldJiYrK2dbcltpXS0xXTt2YXIgeT1uZXcgeChlKTtmb3IoaT0xO2k8ZTsrK2kpeVtpXT15W2ktMV0rZ1tpLTFdPDwxO3ZhciBiO2lmKG4pe2I9bmV3IHgoMTw8ZSk7dmFyIEE9MTUtZTtmb3IoaT0wO2k8ZjsrK2kpaWYocltpXSlmb3IodmFyIEM9aTw8NHxyW2ldLHo9ZS1yW2ldLGE9eVtyW2ldLTFdKys8PHosbD1hfCgxPDx6KS0xO2E8PWw7KythKWJbT1thXT4+QV09Q31lbHNlIGZvcihiPW5ldyB4KGYpLGk9MDtpPGY7KytpKXJbaV0mJihiW2ldPU9beVtyW2ldLTFdKytdPj4xNS1yW2ldKTtyZXR1cm4gYn0sVD1uZXcgbygyODgpLHY9MDt2PDE0NDsrK3YpVFt2XT04O2Zvcih2YXIgdj0xNDQ7djwyNTY7Kyt2KVRbdl09OTtmb3IodmFyIHY9MjU2O3Y8MjgwOysrdilUW3ZdPTc7Zm9yKHZhciB2PTI4MDt2PDI4ODsrK3YpVFt2XT04O2Zvcih2YXIgTD1uZXcgbygzMiksdj0wO3Y8MzI7Kyt2KUxbdl09NTt2YXIgYnI9RShULDksMSksaHI9RShMLDUsMSksXz1mdW5jdGlvbihyKXtmb3IodmFyIGU9clswXSxuPTE7bjxyLmxlbmd0aDsrK24pcltuXT5lJiYoZT1yW25dKTtyZXR1cm4gZX0sdD1mdW5jdGlvbihyLGUsbil7dmFyIGY9ZS84fDA7cmV0dXJuKHJbZl18cltmKzFdPDw4KT4+KGUmNykmbn0scT1mdW5jdGlvbihyLGUpe3ZhciBuPWUvOHwwO3JldHVybihyW25dfHJbbisxXTw8OHxyW24rMl08PDE2KT4+KGUmNyl9LHlyPWZ1bmN0aW9uKHIpe3JldHVybihyKzcpLzh8MH0senI9ZnVuY3Rpb24ocixlLG4pe3JldHVybihlPT1udWxsfHxlPDApJiYoZT0wKSwobj09bnVsbHx8bj5yLmxlbmd0aCkmJihuPXIubGVuZ3RoKSxuZXcgbyhyLnN1YmFycmF5KGUsbikpfSxGcj1bInVuZXhwZWN0ZWQgRU9GIiwiaW52YWxpZCBibG9jayB0eXBlIiwiaW52YWxpZCBsZW5ndGgvbGl0ZXJhbCIsImludmFsaWQgZGlzdGFuY2UiLCJzdHJlYW0gZmluaXNoZWQiLCJubyBzdHJlYW0gaGFuZGxlciIsLCJubyBjYWxsYmFjayIsImludmFsaWQgVVRGLTggZGF0YSIsImV4dHJhIGZpZWxkIHRvbyBsb25nIiwiZGF0ZSBub3QgaW4gcmFuZ2UgMTk4MC0yMDk5IiwiZmlsZW5hbWUgdG9vIGxvbmciLCJzdHJlYW0gZmluaXNoaW5nIiwiaW52YWxpZCB6aXAgZGF0YSJdLHU9ZnVuY3Rpb24ocixlLG4pe3ZhciBmPW5ldyBFcnJvcihlfHxGcltyXSk7aWYoZi5jb2RlPXIsRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UmJkVycm9yLmNhcHR1cmVTdGFja1RyYWNlKGYsdSksIW4pdGhyb3cgZjtyZXR1cm4gZn0sRz1mdW5jdGlvbihyLGUsbixmKXt2YXIgaT1yLmxlbmd0aCxnPWY/Zi5sZW5ndGg6MDtpZighaXx8ZS5mJiYhZS5sKXJldHVybiBufHxuZXcgbygwKTt2YXIgeT0hbixiPXl8fGUuaSE9MixBPWUuaTt5JiYobj1uZXcgbyhpKjMpKTt2YXIgQz1mdW5jdGlvbih2cil7dmFyIGxyPW4ubGVuZ3RoO2lmKHZyPmxyKXt2YXIgb3I9bmV3IG8oTWF0aC5tYXgobHIqMix2cikpO29yLnNldChuKSxuPW9yfX0sej1lLmZ8fDAsYT1lLnB8fDAsbD1lLmJ8fDAsaz1lLmwsQj1lLmQsTT1lLm0scz1lLm4sSD1pKjg7ZG97aWYoIWspe3o9dChyLGEsMSk7dmFyIEo9dChyLGErMSwzKTtpZihhKz0zLEopaWYoSj09MSlrPWJyLEI9aHIsTT05LHM9NTtlbHNlIGlmKEo9PTIpe3ZhciBQPXQocixhLDMxKSsyNTcsaj10KHIsYSsxMCwxNSkrNCxkPVArdChyLGErNSwzMSkrMTthKz0xNDtmb3IodmFyIFU9bmV3IG8oZCksUT1uZXcgbygxOSksYz0wO2M8ajsrK2MpUVtjcltjXV09dChyLGErYyozLDcpO2ErPWoqMztmb3IodmFyIHJyPV8oUSksVXI9KDE8PHJyKS0xLERyPUUoUSxyciwxKSxjPTA7YzxkOyl7dmFyIGVyPURyW3QocixhLFVyKV07YSs9ZXImMTU7dmFyIHc9ZXI+PjQ7aWYodzwxNilVW2MrK109dztlbHNle3ZhciBTPTAsST0wO2Zvcih3PT0xNj8oST0zK3QocixhLDMpLGErPTIsUz1VW2MtMV0pOnc9PTE3PyhJPTMrdChyLGEsNyksYSs9Myk6dz09MTgmJihJPTExK3QocixhLDEyNyksYSs9Nyk7SS0tOylVW2MrK109U319dmFyIG5yPVUuc3ViYXJyYXkoMCxQKSxGPVUuc3ViYXJyYXkoUCk7TT1fKG5yKSxzPV8oRiksaz1FKG5yLE0sMSksQj1FKEYscywxKX1lbHNlIHUoMSk7ZWxzZXt2YXIgdz15cihhKSs0LEs9clt3LTRdfHJbdy0zXTw8OCxOPXcrSztpZihOPmkpe0EmJnUoMCk7YnJlYWt9YiYmQyhsK0spLG4uc2V0KHIuc3ViYXJyYXkodyxOKSxsKSxlLmI9bCs9SyxlLnA9YT1OKjgsZS5mPXo7Y29udGludWV9aWYoYT5IKXtBJiZ1KDApO2JyZWFrfX1iJiZDKGwrMTMxMDcyKTtmb3IodmFyIEJyPSgxPDxNKS0xLElyPSgxPDxzKS0xLFI9YTs7Uj1hKXt2YXIgUz1rW3EocixhKSZCcl0sbT1TPj40O2lmKGErPVMmMTUsYT5IKXtBJiZ1KDApO2JyZWFrfWlmKFN8fHUoMiksbTwyNTYpbltsKytdPW07ZWxzZSBpZihtPT0yNTYpe1I9YSxrPW51bGw7YnJlYWt9ZWxzZXt2YXIgYXI9bS0yNTQ7aWYobT4yNjQpe3ZhciBjPW0tMjU3LEQ9WFtjXTthcj10KHIsYSwoMTw8RCktMSkrcFtjXSxhKz1EfXZhciBWPUJbcShyLGEpJklyXSxXPVY+PjQ7Vnx8dSgzKSxhKz1WJjE1O3ZhciBGPWdyW1ddO2lmKFc+Myl7dmFyIEQ9WVtXXTtGKz1xKHIsYSkmKDE8PEQpLTEsYSs9RH1pZihhPkgpe0EmJnUoMCk7YnJlYWt9YiYmQyhsKzEzMTA3Mik7dmFyIGlyPWwrYXI7aWYobDxGKXt2YXIgZnI9Zy1GLE9yPU1hdGgubWluKEYsaXIpO2ZvcihmcitsPDAmJnUoMyk7bDxPcjsrK2wpbltsXT1mW2ZyK2xdfWZvcig7bDxpcjsrK2wpbltsXT1uW2wtRl19fWUubD1rLGUucD1SLGUuYj1sLGUuZj16LGsmJih6PTEsZS5tPU0sZS5kPUIsZS5uPXMpfXdoaWxlKCF6KTtyZXR1cm4gbCE9bi5sZW5ndGgmJnk/enIobiwwLGwpOm4uc3ViYXJyYXkoMCxsKX0sa3I9bmV3IG8oMCkseHI9ZnVuY3Rpb24ocil7KHJbMF0hPTMxfHxyWzFdIT0xMzl8fHJbMl0hPTgpJiZ1KDYsImludmFsaWQgZ3ppcCBkYXRhIik7dmFyIGU9clszXSxuPTEwO2UmNCYmKG4rPShyWzEwXXxyWzExXTw8OCkrMik7Zm9yKHZhciBmPShlPj4zJjEpKyhlPj40JjEpO2Y+MDtmLT0hcltuKytdKTtyZXR1cm4gbisoZSYyKX0sQXI9ZnVuY3Rpb24ocil7dmFyIGU9ci5sZW5ndGg7cmV0dXJuKHJbZS00XXxyW2UtM108PDh8cltlLTJdPDwxNnxyW2UtMV08PDI0KT4+PjB9LFNyPWZ1bmN0aW9uKHIsZSl7cmV0dXJuKChyWzBdJjE1KSE9OHx8clswXT4+ND43fHwoclswXTw8OHxyWzFdKSUzMSkmJnUoNiwiaW52YWxpZCB6bGliIGRhdGEiKSwoclsxXT4+NSYxKT09KyFlJiZ1KDYsImludmFsaWQgemxpYiBkYXRhOiAiKyhyWzFdJjMyPyJuZWVkIjoidW5leHBlY3RlZCIpKyIgZGljdGlvbmFyeSIpLChyWzFdPj4zJjQpKzJ9O2Z1bmN0aW9uIG1yKHIsZSl7cmV0dXJuIEcocix7aToyfSxlJiZlLm91dCxlJiZlLmRpY3Rpb25hcnkpfWZ1bmN0aW9uIEVyKHIsZSl7dmFyIG49eHIocik7cmV0dXJuIG4rOD5yLmxlbmd0aCYmdSg2LCJpbnZhbGlkIGd6aXAgZGF0YSIpLEcoci5zdWJhcnJheShuLC04KSx7aToyfSxlJiZlLm91dHx8bmV3IG8oQXIocikpLGUmJmUuZGljdGlvbmFyeSl9ZnVuY3Rpb24gVHIocixlKXtyZXR1cm4gRyhyLnN1YmFycmF5KFNyKHIsZSYmZS5kaWN0aW9uYXJ5KSwtNCkse2k6Mn0sZSYmZS5vdXQsZSYmZS5kaWN0aW9uYXJ5KX1mdW5jdGlvbiBDcihyLGUpe3JldHVybiByWzBdPT0zMSYmclsxXT09MTM5JiZyWzJdPT04P0VyKHIsZSk6KHJbMF0mMTUpIT04fHxyWzBdPj40Pjd8fChyWzBdPDw4fHJbMV0pJTMxP21yKHIsZSk6VHIocixlKX12YXIgTXI9dHlwZW9mIFRleHREZWNvZGVyPCJ1IiYmbmV3IFRleHREZWNvZGVyLHNyPTA7dHJ5e01yLmRlY29kZShrcix7c3RyZWFtOiEwfSksc3I9MX1jYXRjaHt9c2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIixyPT57Y29uc3QgZT1DcihyLmRhdGEpO3NlbGYucG9zdE1lc3NhZ2UoZSxbZS5idWZmZXJdKX0pfSkoKTsK",K2=s=>Uint8Array.from(atob(s),t=>t.charCodeAt(0)),Su=typeof window<"u"&&window.Blob&&new Blob([K2(B$)],{type:"text/javascript;charset=utf-8"});function js(s){let t;try{if(t=Su&&(window.URL||window.webkitURL).createObjectURL(Su),!t)throw"";const e=new Worker(t,{name:s?.name});return e.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(t)}),e}catch{return new Worker("data:text/javascript;base64,"+B$,{name:s?.name})}finally{t&&(window.URL||window.webkitURL).revokeObjectURL(t)}}const wu=new js,R$=(s,t=!1)=>new Promise(e=>{const i=We(s);wu.onmessage=async r=>{const n=ye(r.data),a=j2(JSON.parse(decodeURIComponent(n)));for(let o=0;o<a.length;++o){const c=new Dr;await c.load(a[o],t),kx(c)}e()},wu.postMessage(i,[i.buffer])}),vc=()=>{const s=indexedDB.open(`${na}@${Je}`);return s.addEventListener("upgradeneeded",t=>{if(!t.target)return;const e=t.target.result;e.objectStoreNames.contains(`${Je}`)||e.createObjectStore(`${Je}`)}),s},q2=async()=>{const s=await O$();if(!s)return;const t=vc();t.onsuccess=e=>{if(!e.target)return;const i=e.target.result,r=i.transaction(`${Je}`,"readwrite"),n=r.objectStore(`${Je}`),a=ye(s);n.put(a,Ql),r.oncomplete=()=>{i.close();const o=Z(me);o&&o.hide()},r.commit()}},Sc=async()=>{const s=Z(me);s&&(s.show(),s.message=be("{{}}"),await q2())},Ks=async s=>(await fetch(s)).text(),Z2=async s=>{Y0(),z(),Fr(),Dr.workSpaceId=s.workSpaceId,await Sc(),await Nx();const t=await ae(s.fileId,"get"),e=await Ks(t);await R$(e,!0);const i=ya();for(let r=0;r<i.length;++r)i[r].initialize();await M().run()},J2=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[2],r=s.data[3];e.name=i,mc(e,r,!0)},Q2=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;new Ot(e,r).addNewLayer(s.data[2],s.data[3],s.data[4],!0)},ty=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;new Ot(e,r).deleteLayer([s.data[2]],!0)},ey=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=r.getLayer(n);if(!a)return;const o=s.data[4];Ho(e,r,a,o,!0)},sy=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=r.getLayer(n);if(!a)return;new lt(e,r,a).setLock(s.data[3],!0)},iy=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=r.getLayer(n);if(!a)return;new lt(e,r,a).setDisable(s.data[3],!0)},ry=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=r.getLayer(n);if(!a)return;new lt(e,r,a).setLight(s.data[3],!0)},ny=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);r&&ba(e,r,s.data[2],s.data[3],!0)},ay=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);r&&ba(e,r,s.data[2],s.data[4],!0)},oy=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);r&&ba(e,r,s.data[2],"",!0)},Mu=new js,cy=async s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=await ae(s.data[3],"get"),o=await Ks(a),c=We(o);return new Promise(u=>{Mu.onmessage=async l=>{n.buffer=l.data;const h=new zs(n);await h.wait(),Xs(e,h),Kd(e,r,h,!0),u()},Mu.postMessage(c,[c.buffer])})},Iu=(s,t,e,i,r="")=>({command:Ni,messages:[s,t,e,i,r],args:[e.name]}),Au=new Gs,F$=async(s,t,e,i,r=!1)=>{St(s);const n=Iu(s.id,t.id,e,i.toObject());n.messages.pop(),s.active&&Tt(t.id,s.historyIndex,Et(Ni),"",...n.args),s.addHistory(n),!r&&st()&&await new Promise(a=>{if(!i.buffer)return;Au.onmessage=async c=>{const u=c.data,l=ye(u),h=window.crypto.randomUUID(),$=await ae(h,"put");await Vs($,l);const _=i.toObject();_.buffer="";const g=Iu(s.id,t.id,_,_,h);dt(g),a()};const o=i.buffer.slice();Au.postMessage(o,[o.buffer])})},Lu=new js,uy=async s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[3],o=e.getLibrary(n.id).toObject(),c=await ae(s.data[4],"get"),u=await Ks(c),l=We(u);return new Promise(h=>{Lu.onmessage=async $=>{n.buffer=$.data;const _=new zs(n);await _.wait(),e.libraries.set(_.id,_),F$(e,r,o,_,!0),e.active&&(gt(),Q()),h()},Lu.postMessage(l,[l.buffer])})},Cu=new js,ly=async s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=await ae(s.data[3],"get"),o=await Ks(a),c=We(o);return new Promise(u=>{Cu.onmessage=l=>{n.buffer=l.data;const h=new Hs(n);Xs(e,h),Zd(e,r,h,!0),u()},Cu.postMessage(c,[c.buffer])})},Ou=(s,t,e,i,r="")=>({command:Ui,messages:[s,t,e,i,r],args:[e.name]}),Bu=new Gs,P$=async(s,t,e,i,r=!1)=>{St(s);const n=Ou(s.id,t.id,e,i.toObject());n.messages.pop(),s.active&&Tt(t.id,s.historyIndex,Et(Ui),"",...n.args),s.addHistory(n),!r&&st()&&await new Promise(a=>{if(!i.buffer)return;Bu.onmessage=async c=>{const u=c.data,l=ye(u),h=window.crypto.randomUUID(),$=await ae(h,"put");await Vs($,l);const _=i.toObject();_.buffer="";const g=Ou(s.id,t.id,_,_,h);dt(g),a()};const o=i.buffer.slice();Bu.postMessage(o,[o.buffer])})},Ru=new js,hy=async s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[3],o=e.getLibrary(n.id).toObject(),c=await ae(s.data[4],"get"),u=await Ks(c),l=We(u);return new Promise(h=>{Ru.onmessage=$=>{n.buffer=$.data;const _=new Hs(n);e.libraries.set(_.id,_),P$(e,r,o,_,!0),e.active&&(gt(),Q()),h()},Ru.postMessage(l,[l.buffer])})},dy=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=new fa({id:s.data[2],name:s.data[3],folderId:s.data[4],type:"folder",mode:"close"});Xs(e,n),Gd(e,r,n,!0)},$y=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=e.getLibrary(s.data[2]);if(!n)return;const a=s.data[4];Eo(e,r,n,a,!0),n.folderId=a,Rs(e),re(e),e.active&&Q()},Fu=new js,_y=async s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=await ae(s.data[3],"get"),o=await Ks(a),c=We(o);return new Promise(u=>{Fu.onmessage=l=>{n.buffer=l.data;const h=new Ws(n);Xs(e,h),jd(e,r,h,!0),u()},Fu.postMessage(c,[c.buffer])})},Pu=(s,t,e,i,r="")=>({command:Pi,messages:[s,t,e,i,r],args:[e.name]}),ku=new Gs,k$=async(s,t,e,i,r=!1)=>{St(s);const n=Pu(s.id,t.id,e,i.toObject());n.messages.pop(),s.active&&Tt(t.id,s.historyIndex,Et(Pi),"",...n.args),s.addHistory(n),!r&&st()&&await new Promise(a=>{if(!i.buffer)return;ku.onmessage=async c=>{const u=c.data,l=ye(u),h=window.crypto.randomUUID(),$=await ae(h,"put");await Vs($,l);const _=i.toObject();_.buffer="";const g=Pu(s.id,t.id,_,_,h);dt(g),a()};const o=i.buffer.slice();ku.postMessage(o,[o.buffer])})},Nu=new js,fy=async s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[3],o=e.getLibrary(n.id).toObject(),c=await ae(s.data[4],"get"),u=await Ks(c),l=We(u);return new Promise(h=>{Nu.onmessage=$=>{n.buffer=$.data;const _=new Ws(n);e.libraries.set(_.id,_),k$(e,r,o,_,!0),e.active&&(gt(),Q()),h()},Nu.postMessage(l,[l.buffer])})},gy=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=new pa(e,r);s.data[2]==="open"?n.open(!0):n.close(!0)},my=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=e.getLibrary(n);a&&Dd(e,r,a,s.data[4],!0)},py=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=e.getLibrary(n);a&&Yd(e,r,a,s.data[4],!0)},by=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=new kr({id:s.data[2],name:s.data[3],folderId:s.data[4],type:"container"});Xs(e,n),zd(e,r,n,!0)},xy=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1];if(!e.getLibrary(i))return;const n=s.data[2],a=e.getLibrary(n.id);Xd(e,a,!0,!0)},yy=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=r.layers[n];a&&Rh(e,r,a,s.data[4],!0)},Ey=s=>{const t=s.data[0],e=k(t);if(!e)return;const i=s.data[1],r=e.getLibrary(i);if(!r)return;const n=s.data[2],a=s.data[3],o=r.layers.splice(n,1)[0],c=o.mode,u=o.parentId;o.mode=s.data[4],o.parentId=s.data[6],r.layers.splice(a,0,o),rc(e,r,o,n,a,c,u,!0),e.active&&r.active&&Xe()},Ty=async s=>{switch(s.historyCommand){case _h:await fc(s.data[0],s.data[1],!0);break;case fh:await _c(s.data[0],s.data[1],!0);break;case Ai:J2(s);break;case vi:Q2(s);break;case Si:ty(s);break;case Li:ey(s);break;case gh:sy(s);break;case mh:iy(s);break;case ph:ry(s);break;case wi:ny(s);break;case Mi:ay(s);break;case Ii:oy(s);break;case Ci:dy(s);break;case bh:gy(s);break;case Oi:my(s);break;case Bi:py(s);break;case Ri:await _y(s);break;case Fi:$y(s);break;case Pi:await fy(s);break;case ki:await cy(s);break;case Ni:await uy(s);break;case Di:await ly(s);break;case Ui:await hy(s);break;case Yi:by(s);break;case Xi:xy(s);break;case Wi:Ey(s);break;case Ps:yy(s);break}},vy=s=>{const t=JSON.parse(s.data);switch(t.command){case"receive":Ty(t);break;case"initialize":if(!Un())return;H2(t.connectionId);break;case"load":if(Un()||X0())return;Z2(t);break}},Sy="https://2eybuazxfqquupjefqoel4qcui0durxq.lambda-url.ap-northeast-1.on.aws/",wy="wss://cy2ekpq925.execute-api.ap-northeast-1.amazonaws.com/prod",My=async s=>await(await fetch(`${Sy}?url=${wy}&roomId=${s}`)).json(),N$=async s=>{const t=await My(s),e=new WebSocket(t.url);Uo(e),e.addEventListener("open",z2),e.addEventListener("message",vy)},Iy=()=>{if(st())return;if(!Vi()){Ir();return}const s=crypto.randomUUID();history.pushState("","",`${location.origin}/#${s}`),U0(!0),N$(s)},Ay=s=>{s.stopPropagation(),s.preventDefault(),z(),Iy()},Ly=()=>{const s=document.getElementById(S2);s&&s.addEventListener(E.MOUSE_DOWN,Ay)},Cy=()=>{I$(),I2(),C2(),R2(),N2(),G2(),Ly(),U2()};class Oy extends Wt{constructor(){super(fs)}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}initialize(){Cy()}}const D$=s=>{const t=sh();t&&t.classList.remove("shortcut-active"),s&&s.classList.add("shortcut-active"),ih(s)},Ur=()=>{D$(null),ih(null)},By="shortcut-setting-save",Ry="shortcut-setting-reset",Fy="shortcut-setting-close",Ta="shortcut-list-screen",va="shortcut-list-timeline",Sa="shortcut-list-library",wa="shortcut-setting-screen",Ma="shortcut-setting-timeline",Ia="shortcut-setting-library",Py="shortcut-item",ky=()=>{const s=document.getElementById(Ta);s&&s.setAttribute("class","");const t=document.getElementById(wa);t&&t.setAttribute("class","shortcut-active");const e=document.getElementById(va);e&&e.setAttribute("class","shortcut-inactive");const i=document.getElementById(Ma);i&&i.setAttribute("class","");const r=document.getElementById(Sa);r&&r.setAttribute("class","shortcut-inactive");const n=document.getElementById(Ia);n&&n.setAttribute("class","")},Ny=()=>{Ur(),ky()},Dy=()=>{const s=document.getElementById(Ta);s&&s.setAttribute("class","shortcut-inactive");const t=document.getElementById(wa);t&&t.setAttribute("class","");const e=document.getElementById(va);e&&e.setAttribute("class","");const i=document.getElementById(Ma);i&&i.setAttribute("class","shortcut-active");const r=document.getElementById(Sa);r&&r.setAttribute("class","shortcut-inactive");const n=document.getElementById(Ia);n&&n.setAttribute("class","")},Uy=()=>{Ur(),Dy()},Yy=()=>{const s=document.getElementById(Ta);s&&s.setAttribute("class","shortcut-inactive");const t=document.getElementById(wa);t&&t.setAttribute("class","");const e=document.getElementById(va);e&&e.setAttribute("class","shortcut-inactive");const i=document.getElementById(Ma);i&&i.setAttribute("class","");const r=document.getElementById(Sa);r&&r.setAttribute("class","");const n=document.getElementById(Ia);n&&n.setAttribute("class","shortcut-active")},Xy=()=>{Ur(),Yy()},Wy=()=>{const s=Z(_i);s&&s.hide()},U$=s=>{switch(s.key){case"Shift":case"Control":case"Alt":case"Meta":return!0}const t=sh();if(!t)return!0;const e=t.querySelector(".command");if(!e)return!0;s.stopPropagation(),s.stopImmediatePropagation(),s.preventDefault();const i=[],r={shift:!1,alt:!1,ctrl:!1};switch(s.shiftKey&&(r.shift=!0,i.push("Shift")),s.altKey&&(r.alt=!0,i.push("Alt")),(s.ctrlKey||s.metaKey)&&(r.ctrl=!0,i.push("Ctrl")),!0){case s.key===" ":i.push(s.code);break;case s.key.length===1:i.push(s.key.toUpperCase());break;default:i.push(s.key);break}const n=Xt(s.key,r),a=i.join(" + "),o=Do(),c=e.dataset.defaultKey;return o.delete(c),c!==n&&o.set(c,{defaultKey:c,customKey:n,text:a}),e.textContent=`${a}`,!1},Y$=()=>{window.removeEventListener(E.KEY_DOWN,U$)},Vy=()=>{Wy(),Ec(),Ur(),Y$()},Gy=s=>{localStorage.setItem(Po,JSON.stringify(s))},zy=()=>{ko();const s=No(),t=es();for(const e of t.values())s.set(e.customKey,e.defaultKey)},Hy=()=>{const s=Do(),t=es();for(const[e,i]of s)t.set(e,i);Sr()},jy=()=>{Hy(),zy();const s=es(),t=[];for(const e of s.values())t.push(e);Gy(t)},Ky=()=>{localStorage.removeItem(Po)},qy=()=>{const s=Do();if(s.size)for(const e of s.values()){const i=document.getElementById(`shortcut-${e.defaultKey}`);i&&(i.textContent=i.dataset.defaultText)}const t=es();if(t.size)for(const e of t.values()){const i=document.getElementById(`shortcut-${e.defaultKey}`);i&&(i.textContent=i.dataset.defaultText)}},Zy=()=>{Ky(),qy(),Sr(),ah(),ko()},Jy=s=>{s.stopPropagation();const t=s.target;D$(t)},Qy=()=>{const s=document.getElementById(By);s&&s.addEventListener(E.MOUSE_DOWN,o=>{o.stopPropagation(),jy()});const t=document.getElementById(Ry);t&&t.addEventListener(E.MOUSE_DOWN,o=>{o.stopPropagation(),Zy()});const e=document.getElementById(Fy);e&&e.addEventListener(E.MOUSE_DOWN,o=>{o.stopPropagation(),Vy()});const i=document.getElementById(wa);i&&i.addEventListener(E.MOUSE_DOWN,o=>{o.stopPropagation(),Ny()});const r=document.getElementById(Ma);r&&r.addEventListener(E.MOUSE_DOWN,o=>{o.stopPropagation(),Uy()});const n=document.getElementById(Ia);n&&n.addEventListener(E.MOUSE_DOWN,o=>{o.stopPropagation(),Xy()});const a=[Ta,va,Sa];for(let o=0;o<a.length;++o){const c=document.getElementById(a[o]);if(!c)continue;const u=c.getElementsByClassName(Py),l=u.length;for(let h=0;h<l;++h)u[h].addEventListener(E.MOUSE_DOWN,Jy)}},tE=()=>{const s=localStorage.getItem(Po);return s?JSON.parse(s):null},eE=()=>{const s=tE();if(!s)return;ko(),ah(),Sr();const t=No(),e=es();for(let i=0;i<s.length;++i){const r=s[i];e.set(r.defaultKey,r),t.set(r.customKey,r.defaultKey)}},sE=()=>{const s=es();if(s.size)for(const t of s.values()){const e=document.getElementById(`shortcut-${t.defaultKey}`);e&&(e.textContent=t.text)}},iE=()=>{Qy(),eE(),sE()},rE=()=>{window.addEventListener(E.KEY_DOWN,U$)},nE=()=>{uh(!0),rE(),Sr()},aE=()=>{uh(!1),Ur(),Y$(),Sr()};class oE extends Wt{constructor(){super(_i)}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}show(){this.state==="hide"&&nE(),super.show()}hide(){this.state==="show"&&aE(),super.hide()}initialize(){iE()}}class cE extends Wt{constructor(){super(As)}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}}const uE=()=>{const s=Z(fi);s&&(z(fi),s.show())},lE=s=>{const t=Z(fi);t&&(s.stopPropagation(),t.state==="hide"?uE():$h())},hE=()=>{const s=document.getElementById(m0);if(!s)return;const t=Z(fi);t&&(t.offsetLeft=s.offsetLeft+s.offsetWidth,t.offsetTop=s.offsetTop+25,s.addEventListener(E.MOUSE_DOWN,lE))};class dE extends Wt{constructor(){super(fi)}initialize(){hE()}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}}const $E=s=>{s.stopPropagation(),s.preventDefault(),z(ai);const t=Z(ai);if(!t)return;const e=document.getElementById(ai);if(!e)return;const i=e.clientHeight,r=i/2;let n=s.pageY-r;0>n&&(n=15),s.pageY+r>window.innerHeight&&(n=window.innerHeight-i-15),t.offsetLeft=s.pageX+15,t.offsetTop=n,t.show()},_E=s=>{s.stopPropagation(),z(ai)},fE=s=>{s.stopPropagation();const t=document.getElementById(ai);if(!t)return;const e=s.target,i=["screen-order","screen-align"];for(let r=0;r<i.length;++r){const n=i[r],a=Z(`${n}-menu`);a&&(n===e.id?(a.offsetLeft=t.offsetLeft+t.clientWidth-5,a.offsetTop=t.offsetTop+20,a.show()):a.hide())}},gE=()=>{const s=["screen-distribute-to-layers","screen-distribute-to-keyframes","screen-align-coordinates-prev-keyframe","screen-align-matrix-prev-keyframe","screen-integrating-paths","screen-add-tween-curve-pointer","screen-delete-tween-curve-pointer","screen-change-movie-clip","screen-preview","screen-ruler","screen-change-scene","screen-move-scene"];for(let e=0;e<s.length;++e){const i=document.getElementById(s[e]);i&&i.addEventListener(E.MOUSE_OVER,_E)}const t=["screen-order","screen-align"];for(let e=0;e<t.length;++e){const i=document.getElementById(t[e]);i&&i.addEventListener(E.MOUSE_OVER,fE)}},mE=()=>{const s=document.getElementById(Ro);s&&(s.addEventListener("contextmenu",$E),gE())};class pE extends Wt{constructor(){super(ai)}initialize(){mE()}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}}class bE extends Wt{constructor(){super(y0)}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}}class xE extends Wt{constructor(){super(E0)}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}}class yE extends Wt{constructor(){super(Sn)}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}}const EE=s=>{s.stopPropagation(),s.preventDefault(),z(wn);const t=Z(wn);if(!t)return;const e=document.getElementById(wn);if(!e)return;let i=s.pageY-e.clientHeight;0>i&&(i=15),t.offsetLeft=s.pageX+15,t.offsetTop=i,t.show()},wc=()=>{const s=M().scene;e$(s),r$(s.currentFrame),Jd()},TE=s=>{s.button===0&&(s.stopPropagation(),s.preventDefault(),wc())},vE=()=>{const s=document.getElementById(Gi);if(!s)return;s.addEventListener("contextmenu",EE);const t=document.getElementById(J0);t&&t.addEventListener(E.MOUSE_DOWN,TE)};class SE extends Wt{constructor(){super(wn)}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}initialize(){vE()}}const wE=s=>{s.stopPropagation();const t=s.target;if(!t)return;const e=M(),i=e.scene;if(!i.selectedLayers.length)return;const r=i.selectedLayers[0];new lt(e,i,r).updateLightColor(t.value)},ME=s=>{s.stopPropagation();const t=s.target;if(!t)return;const e=M().timelineAreaState,i=Math.floor(K.clientHeight/e.frameHeight);h$(Yo*parseFloat(t.value)),_a();const r=Math.floor(K.clientHeight/e.frameHeight);i!==r&&Xe()},IE=s=>{if(s.button!==0)return;s.stopPropagation(),z();const t=M(),e=t.scene;if(!e.selectedLayers.length)return;const i=e.selectedLayers[0];if(!i)return;const r=new lt(t,e,i);r.layerType=Ko},AE=s=>{if(s.button!==0)return;s.stopPropagation(),z();const t=M(),e=t.scene;if(!e.selectedLayers.length)return;const i=e.selectedLayers[0];if(!i)return;const r=new lt(t,e,i);r.layerType=ha},LE=s=>{if(s.button!==0)return;s.stopPropagation(),z();const t=M(),e=t.scene;if(!e.selectedLayers.length)return;const i=e.selectedLayers[0];if(!i)return;const r=new lt(t,e,i);r.layerType=qo},CE=()=>{const s=document.getElementById(nd);s&&s.addEventListener("change",wE);const t=document.getElementById(ud);t&&t.addEventListener("change",ME);const e=document.getElementById(ad);e&&e.addEventListener(E.MOUSE_DOWN,AE);const i=document.getElementById(od);i&&i.addEventListener(E.MOUSE_DOWN,IE);const r=document.getElementById(cd);r&&r.addEventListener(E.MOUSE_DOWN,LE)};class OE extends Wt{constructor(){super(lr)}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}initialize(){CE()}}const BE=()=>{const s=document.getElementById($$);s&&(s.classList.contains("disabled")||s.classList.add("disabled"))},RE=()=>{const s=document.getElementById($$);s&&s.classList.contains("disabled")&&s.classList.remove("disabled")},FE=()=>{const s=document.getElementById(_$);s&&s.classList.contains("disabled")&&s.classList.remove("disabled")},Du=()=>{const s=document.getElementById(_$);s&&(s.classList.contains("disabled")||s.classList.add("disabled"))},PE=()=>{const s=document.getElementById(f$);s&&s.classList.contains("disabled")&&s.classList.remove("disabled")},Ga=()=>{const s=document.getElementById(f$);s&&(s.classList.contains("disabled")||s.classList.add("disabled"))},kE=()=>{const s=document.getElementById(g$);s&&s.classList.contains("disabled")&&s.classList.remove("disabled")},za=()=>{const s=document.getElementById(g$);s&&(s.classList.contains("disabled")||s.classList.add("disabled"))},NE=s=>{s.stopPropagation(),s.preventDefault(),z(Mn);const t=Z(Mn);if(!t)return;const e=document.getElementById(Mn);if(!e)return;const i=e.clientWidth,r=e.clientHeight,n=r/2;let a=s.pageY-n;0>a&&(a=15),s.pageY+n>window.innerHeight&&(a=window.innerHeight-r-15);let o=s.pageX+15;if(o+i>window.innerWidth&&(o=s.pageX-i-15),t.offsetLeft=o,t.offsetTop=a,j.selectedIds.length){if(j.selectedIds.length===1){FE();const c=M().getLibrary(j.selectedIds[0]);if(c)switch(c.type){case"container":PE(),za();break;case"bitmap":kE(),Ga();break;default:Ga(),za();break}}else Du();RE()}else BE(),Du(),Ga(),za();t.show()},X$=()=>{const s=M();new Kt(s).addNewFolder(`Folder_${s.nextLibraryId}`)},DE=s=>{s.button===0&&(z(),s.stopPropagation(),s.preventDefault(),X$())},W$=()=>{const s=M();new Kt(s).addNewMovieClip(`MovieClip_${s.nextLibraryId}`)},UE=s=>{s.button===0&&(z(),s.stopPropagation(),s.preventDefault(),W$())},V$=()=>{const s=document.getElementById(Ad);s&&(z(),s.click())},YE=s=>{s.stopPropagation(),s.preventDefault(),V$()},XE=async s=>{const t=s.target;if(!t)return;const e=t.files;if(!e)return;s.preventDefault(),s.stopPropagation(),ma(),Fr(),Pr(be("{{}}"));const i=M(),r=new Kt(i);let n="";if(j.selectedIds.length===1){const a=i.getLibrary(j.selectedIds[0]);a&&a.type==="folder"&&(n=a.getPath(i))}for(let a=0;a<e.length;++a){const o=e[a];if(Ld(i,o,n))continue;const c=o.name.split(".");c.pop();const u=c.join(".");await r.importFile(o,u,n,!1)}re(i),Q(),uc(),Od()},G$=async()=>{if(j.selectedIds.length!==1)return;const s=j.selectedIds[0],t=M(),e=t.getLibrary(s);if(!e||e.type!=="container")return;dc(),await new ds(t).runMovieClip(new Hi(t,e))},WE=async s=>{s.button===0&&(z(),s.stopPropagation(),s.preventDefault(),await G$())},VE=s=>{if(s.button!==0||!j.selectedIds.length)return;s.stopPropagation(),z();const t=j.selectedIds[0],i=M().getLibrary(t);i&&i.getHTMLElement().then(r=>{const n=r.toDataURL(i.imageType);Ls(r);const a=document.createElement("a");a.href=`https://www.photopea.com#${encodeURI(JSON.stringify({files:[n]}))}`,a.target="_blank",a.click()})},GE=()=>{const s=document.getElementById(ga);s&&s.addEventListener("contextmenu",NE);const t=document.getElementById(Cp);t&&t.addEventListener(E.MOUSE_DOWN,DE);const e=document.getElementById(Lp);e&&e.addEventListener(E.MOUSE_DOWN,UE);const i=document.getElementById(Op);i&&i.addEventListener(E.MOUSE_DOWN,YE);const r=document.getElementById(Ad);r&&r.addEventListener("change",XE);const n=document.getElementById(Bp);n&&n.addEventListener(E.MOUSE_DOWN,WE);const a=document.getElementById(Rp);a&&a.addEventListener(E.MOUSE_DOWN,Rd);const o=document.getElementById(Fp);o&&o.addEventListener(E.MOUSE_DOWN,VE)};class zE extends Wt{constructor(){super(Mn)}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}initialize(){GE()}}const HE=()=>{const s=Z(mr);s&&(z(mr),s.hide())},jE=s=>{s.button===0&&(s.stopPropagation(),s.preventDefault(),HE())},KE="editor-hide-icon",qE="editor-bar",ZE="editor-title",z$="editor-modal",$n=document.getElementById(z$),H$=s=>{s.stopPropagation(),s.preventDefault(),requestAnimationFrame(()=>{$n.style.left=`${$n.offsetLeft+s.movementX}px`,$n.style.top=`${$n.offsetTop+s.movementY}px`})},j$=s=>{s.stopPropagation(),s.preventDefault(),window.removeEventListener(E.MOUSE_MOVE,H$),window.removeEventListener(E.MOUSE_UP,j$)},JE=s=>{s.stopPropagation(),s.preventDefault(),window.addEventListener(E.MOUSE_MOVE,H$),window.addEventListener(E.MOUSE_UP,j$)},QE=()=>{const s=document.getElementById(z$);if(s){s.style.top=`${(window.innerHeight-s.clientHeight)/2}px`,s.style.left=`${(window.innerWidth-s.clientWidth)/2}px`;const i=document.documentElement.style;new ResizeObserver(n=>{requestAnimationFrame(()=>{n.forEach(a=>{const o=a.target;i.setProperty("--script-modal-width",`${o.clientWidth}px`),i.setProperty("--script-modal-height",`${o.clientHeight}px`)}),yr().resize(!0)})}).observe(s)}const t=document.getElementById(KE);t&&t.addEventListener(E.MOUSE_DOWN,jE);const e=document.getElementById(qE);e&&e.addEventListener(E.MOUSE_DOWN,JE)},tT=()=>{const s=yr();s.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),s.session.setMode("ace/mode/javascript"),s.setTheme("ace/theme/monokai"),s.setShowPrintMargin(!1),s.setKeyboardHandler("ace/keybinding/vscode");const t=[{word:"next2d",meta:"keyword"}],e=Object.keys(window.next2d);for(let i=1;i<e.length;++i){const r=e[i];if(r.indexOf("$")>-1||!(r in window.next2d))continue;t.push({word:`next2d.${r}`,meta:"keyword"});const n=window.next2d[r],a=Object.keys(n);for(let o=0;o<a.length;++o){const c=a[o];t.push({word:c,meta:`next2d.${r}.${c}`});const u=n[c],l=Object.getOwnPropertyDescriptors(u),h=Object.getOwnPropertyNames(u);for(let g=0;g<h.length;++g){const f=h[g];if(f.indexOf("$")>-1)continue;switch(f){case"length":case"prototype":case"toString":case"namespace":case"name":continue}const m=l[f];if("value"in m){const p=m.value.toString().replace(/ |\n/g,"").split("{")[0].split("(")[1].replace(")","");t.push({word:`${c}.${f}`,value:`${c}.${f}();`,meta:`${c}.${f}(${p})`})}else t.push({word:`${c}.${f}`,meta:`${c}.${f}`})}const $=Object.getOwnPropertyDescriptors(u.prototype),_=Object.getOwnPropertyNames(u.prototype);for(let g=0;g<_.length;++g){const f=_[g];if(f.indexOf("$")>-1)continue;switch(f){case"constructor":case"toString":case"namespace":case"name":continue}const m=$[f];if("value"in m){const p=m.value.toString().replace(/ |\n/g,"").split("{")[0].split("(")[1].replace(")","");t.push({word:`${c}.${f}`,value:`${f}();`,meta:`${c}.${f}(${p})`})}else t.push({word:f,meta:`${c}.${f}`})}}}ace.require("ace/ext/language_tools").addCompleter({getCompletions:(i,r,n,a,o)=>{o(null,t.map(c=>({caption:c.word,value:c.value||c.word,meta:c.meta,score:0})))}})},eT=()=>{const s=t$();if(!s)return;const t=yr(),e=t.getValue().trim(),i=i$();new Hi(M(),s).setAction(i,e),t.setValue(""),Ye(!1)},sT=(s,t)=>{const e=document.getElementById(ZE);e&&(e.textContent=`${s} / frame [${t}]`)},iT=()=>{const s=t$();if(!s)return;const t=i$();sT(s.name,t),s.hasAction(t)&&yr().setValue(s.getAction(t),-1),Ye(!0),yr().focus()};class rT extends Wt{constructor(){super(mr)}initialize(){QE(),tT()}show(){this.state!=="show"&&(super.show(),iT())}hide(){this._$state!=="hide"&&(super.hide(),eT())}}const nT=7,aT="billing-hide-icon",oT="billing-qrcode",cT="wss://free.blr2.piesocket.com/v3",uT="8cOA5hGuUUQu5jRByX35HodVTPxMchtaANchsGyw",K$=()=>{const s=Z(Fo);s&&s.hide()},q$=()=>{const s=document.getElementById("advertisement");s&&(s.style.display="none"),document.documentElement.style.setProperty("--ad","0px")},lT=()=>new Promise(s=>{const t=vc();t.onsuccess=e=>{if(!e.target)return s();const i=e.target.result,r=i.transaction(`${Je}`,"readwrite"),n=r.objectStore(`${Je}`),a=new Date(z0());a.setDate(a.getDate()+nT);const o=a.getFullYear(),c=("0"+String(a.getMonth()+1)).slice(-2),u=("0"+String(a.getDate())).slice(-2),l={expire:`${o}-${c}-${u}`};Th(l.expire),n.put(JSON.stringify(l),th),r.oncomplete=()=>{i.close(),s()},r.commit()}}),hT=async()=>{await lT(),q$(),K$()},dT=s=>{const t=new WebSocket(`${cT}/${s}?api_key=${uT}`);Uo(t),t.addEventListener("message",hT)};var Yr={},$T=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},Z$={},de={};let Mc;const _T=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];de.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};de.getSymbolTotalCodewords=function(t){return _T[t]};de.getBCHDigit=function(s){let t=0;for(;s!==0;)t++,s>>>=1;return t};de.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');Mc=t};de.isKanjiModeEnabled=function(){return typeof Mc<"u"};de.toSJIS=function(t){return Mc(t)};var Aa={};(function(s){s.L={bit:1},s.M={bit:0},s.Q={bit:3},s.H={bit:2};function t(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return s.L;case"m":case"medium":return s.M;case"q":case"quartile":return s.Q;case"h":case"high":return s.H;default:throw new Error("Unknown EC Level: "+e)}}s.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},s.from=function(i,r){if(s.isValid(i))return i;try{return t(i)}catch{return r}}})(Aa);function J$(){this.buffer=[],this.length=0}J$.prototype={get:function(s){const t=Math.floor(s/8);return(this.buffer[t]>>>7-s%8&1)===1},put:function(s,t){for(let e=0;e<t;e++)this.putBit((s>>>t-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(s){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),s&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var fT=J$;function Xr(s){if(!s||s<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=s,this.data=new Uint8Array(s*s),this.reservedBit=new Uint8Array(s*s)}Xr.prototype.set=function(s,t,e,i){const r=s*this.size+t;this.data[r]=e,i&&(this.reservedBit[r]=!0)};Xr.prototype.get=function(s,t){return this.data[s*this.size+t]};Xr.prototype.xor=function(s,t,e){this.data[s*this.size+t]^=e};Xr.prototype.isReserved=function(s,t){return this.reservedBit[s*this.size+t]};var gT=Xr,Q$={};(function(s){const t=de.getSymbolSize;s.getRowColCoords=function(i){if(i===1)return[];const r=Math.floor(i/7)+2,n=t(i),a=n===145?26:Math.ceil((n-13)/(2*r-2))*2,o=[n-7];for(let c=1;c<r-1;c++)o[c]=o[c-1]-a;return o.push(6),o.reverse()},s.getPositions=function(i){const r=[],n=s.getRowColCoords(i),a=n.length;for(let o=0;o<a;o++)for(let c=0;c<a;c++)o===0&&c===0||o===0&&c===a-1||o===a-1&&c===0||r.push([n[o],n[c]]);return r}})(Q$);var t_={};const mT=de.getSymbolSize,Uu=7;t_.getPositions=function(t){const e=mT(t);return[[0,0],[e-Uu,0],[0,e-Uu]]};var e_={};(function(s){s.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};s.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},s.from=function(r){return s.isValid(r)?parseInt(r,10):void 0},s.getPenaltyN1=function(r){const n=r.size;let a=0,o=0,c=0,u=null,l=null;for(let h=0;h<n;h++){o=c=0,u=l=null;for(let $=0;$<n;$++){let _=r.get(h,$);_===u?o++:(o>=5&&(a+=t.N1+(o-5)),u=_,o=1),_=r.get($,h),_===l?c++:(c>=5&&(a+=t.N1+(c-5)),l=_,c=1)}o>=5&&(a+=t.N1+(o-5)),c>=5&&(a+=t.N1+(c-5))}return a},s.getPenaltyN2=function(r){const n=r.size;let a=0;for(let o=0;o<n-1;o++)for(let c=0;c<n-1;c++){const u=r.get(o,c)+r.get(o,c+1)+r.get(o+1,c)+r.get(o+1,c+1);(u===4||u===0)&&a++}return a*t.N2},s.getPenaltyN3=function(r){const n=r.size;let a=0,o=0,c=0;for(let u=0;u<n;u++){o=c=0;for(let l=0;l<n;l++)o=o<<1&2047|r.get(u,l),l>=10&&(o===1488||o===93)&&a++,c=c<<1&2047|r.get(l,u),l>=10&&(c===1488||c===93)&&a++}return a*t.N3},s.getPenaltyN4=function(r){let n=0;const a=r.data.length;for(let c=0;c<a;c++)n+=r.data[c];return Math.abs(Math.ceil(n*100/a/5)-10)*t.N4};function e(i,r,n){switch(i){case s.Patterns.PATTERN000:return(r+n)%2===0;case s.Patterns.PATTERN001:return r%2===0;case s.Patterns.PATTERN010:return n%3===0;case s.Patterns.PATTERN011:return(r+n)%3===0;case s.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(n/3))%2===0;case s.Patterns.PATTERN101:return r*n%2+r*n%3===0;case s.Patterns.PATTERN110:return(r*n%2+r*n%3)%2===0;case s.Patterns.PATTERN111:return(r*n%3+(r+n)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}s.applyMask=function(r,n){const a=n.size;for(let o=0;o<a;o++)for(let c=0;c<a;c++)n.isReserved(c,o)||n.xor(c,o,e(r,c,o))},s.getBestMask=function(r,n){const a=Object.keys(s.Patterns).length;let o=0,c=1/0;for(let u=0;u<a;u++){n(u),s.applyMask(u,r);const l=s.getPenaltyN1(r)+s.getPenaltyN2(r)+s.getPenaltyN3(r)+s.getPenaltyN4(r);s.applyMask(u,r),l<c&&(c=l,o=u)}return o}})(e_);var La={};const cs=Aa,_n=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],fn=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];La.getBlocksCount=function(t,e){switch(e){case cs.L:return _n[(t-1)*4+0];case cs.M:return _n[(t-1)*4+1];case cs.Q:return _n[(t-1)*4+2];case cs.H:return _n[(t-1)*4+3];default:return}};La.getTotalCodewordsCount=function(t,e){switch(e){case cs.L:return fn[(t-1)*4+0];case cs.M:return fn[(t-1)*4+1];case cs.Q:return fn[(t-1)*4+2];case cs.H:return fn[(t-1)*4+3];default:return}};var s_={},Ca={};const dr=new Uint8Array(512),Wn=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)dr[e]=t,Wn[t]=e,t<<=1,t&256&&(t^=285);for(let e=255;e<512;e++)dr[e]=dr[e-255]})();Ca.log=function(t){if(t<1)throw new Error("log("+t+")");return Wn[t]};Ca.exp=function(t){return dr[t]};Ca.mul=function(t,e){return t===0||e===0?0:dr[Wn[t]+Wn[e]]};(function(s){const t=Ca;s.mul=function(i,r){const n=new Uint8Array(i.length+r.length-1);for(let a=0;a<i.length;a++)for(let o=0;o<r.length;o++)n[a+o]^=t.mul(i[a],r[o]);return n},s.mod=function(i,r){let n=new Uint8Array(i);for(;n.length-r.length>=0;){const a=n[0];for(let c=0;c<r.length;c++)n[c]^=t.mul(r[c],a);let o=0;for(;o<n.length&&n[o]===0;)o++;n=n.slice(o)}return n},s.generateECPolynomial=function(i){let r=new Uint8Array([1]);for(let n=0;n<i;n++)r=s.mul(r,new Uint8Array([1,t.exp(n)]));return r}})(s_);const i_=s_;function Ic(s){this.genPoly=void 0,this.degree=s,this.degree&&this.initialize(this.degree)}Ic.prototype.initialize=function(t){this.degree=t,this.genPoly=i_.generateECPolynomial(this.degree)};Ic.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(t.length+this.degree);e.set(t);const i=i_.mod(e,this.genPoly),r=this.degree-i.length;if(r>0){const n=new Uint8Array(this.degree);return n.set(i,r),n}return i};var pT=Ic,r_={},Ts={},Ac={};Ac.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var Ve={};const n_="[0-9]+",bT="[A-Z $%*+\\-./:]+";let Tr="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";Tr=Tr.replace(/u/g,"\\u");const xT="(?:(?![A-Z0-9 $%*+\\-./:]|"+Tr+`)(?:.|[\r
]))+`;Ve.KANJI=new RegExp(Tr,"g");Ve.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Ve.BYTE=new RegExp(xT,"g");Ve.NUMERIC=new RegExp(n_,"g");Ve.ALPHANUMERIC=new RegExp(bT,"g");const yT=new RegExp("^"+Tr+"$"),ET=new RegExp("^"+n_+"$"),TT=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Ve.testKanji=function(t){return yT.test(t)};Ve.testNumeric=function(t){return ET.test(t)};Ve.testAlphanumeric=function(t){return TT.test(t)};(function(s){const t=Ac,e=Ve;s.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},s.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},s.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},s.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},s.MIXED={bit:-1},s.getCharCountIndicator=function(n,a){if(!n.ccBits)throw new Error("Invalid mode: "+n);if(!t.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?n.ccBits[0]:a<27?n.ccBits[1]:n.ccBits[2]},s.getBestModeForData=function(n){return e.testNumeric(n)?s.NUMERIC:e.testAlphanumeric(n)?s.ALPHANUMERIC:e.testKanji(n)?s.KANJI:s.BYTE},s.toString=function(n){if(n&&n.id)return n.id;throw new Error("Invalid mode")},s.isValid=function(n){return n&&n.bit&&n.ccBits};function i(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return s.NUMERIC;case"alphanumeric":return s.ALPHANUMERIC;case"kanji":return s.KANJI;case"byte":return s.BYTE;default:throw new Error("Unknown mode: "+r)}}s.from=function(n,a){if(s.isValid(n))return n;try{return i(n)}catch{return a}}})(Ts);(function(s){const t=de,e=La,i=Aa,r=Ts,n=Ac,a=7973,o=t.getBCHDigit(a);function c($,_,g){for(let f=1;f<=40;f++)if(_<=s.getCapacity(f,g,$))return f}function u($,_){return r.getCharCountIndicator($,_)+4}function l($,_){let g=0;return $.forEach(function(f){const m=u(f.mode,_);g+=m+f.getBitsLength()}),g}function h($,_){for(let g=1;g<=40;g++)if(l($,g)<=s.getCapacity(g,_,r.MIXED))return g}s.from=function(_,g){return n.isValid(_)?parseInt(_,10):g},s.getCapacity=function(_,g,f){if(!n.isValid(_))throw new Error("Invalid QR Code version");typeof f>"u"&&(f=r.BYTE);const m=t.getSymbolTotalCodewords(_),p=e.getTotalCodewordsCount(_,g),x=(m-p)*8;if(f===r.MIXED)return x;const b=x-u(f,_);switch(f){case r.NUMERIC:return Math.floor(b/10*3);case r.ALPHANUMERIC:return Math.floor(b/11*2);case r.KANJI:return Math.floor(b/13);case r.BYTE:default:return Math.floor(b/8)}},s.getBestVersionForData=function(_,g){let f;const m=i.from(g,i.M);if(Array.isArray(_)){if(_.length>1)return h(_,m);if(_.length===0)return 1;f=_[0]}else f=_;return c(f.mode,f.getLength(),m)},s.getEncodedBits=function(_){if(!n.isValid(_)||_<7)throw new Error("Invalid QR Code version");let g=_<<12;for(;t.getBCHDigit(g)-o>=0;)g^=a<<t.getBCHDigit(g)-o;return _<<12|g}})(r_);var a_={};const To=de,o_=1335,vT=21522,Yu=To.getBCHDigit(o_);a_.getEncodedBits=function(t,e){const i=t.bit<<3|e;let r=i<<10;for(;To.getBCHDigit(r)-Yu>=0;)r^=o_<<To.getBCHDigit(r)-Yu;return(i<<10|r)^vT};var c_={};const ST=Ts;function mi(s){this.mode=ST.NUMERIC,this.data=s.toString()}mi.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};mi.prototype.getLength=function(){return this.data.length};mi.prototype.getBitsLength=function(){return mi.getBitsLength(this.data.length)};mi.prototype.write=function(t){let e,i,r;for(e=0;e+3<=this.data.length;e+=3)i=this.data.substr(e,3),r=parseInt(i,10),t.put(r,10);const n=this.data.length-e;n>0&&(i=this.data.substr(e),r=parseInt(i,10),t.put(r,n*3+1))};var wT=mi;const MT=Ts,Ha=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function pi(s){this.mode=MT.ALPHANUMERIC,this.data=s}pi.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};pi.prototype.getLength=function(){return this.data.length};pi.prototype.getBitsLength=function(){return pi.getBitsLength(this.data.length)};pi.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let i=Ha.indexOf(this.data[e])*45;i+=Ha.indexOf(this.data[e+1]),t.put(i,11)}this.data.length%2&&t.put(Ha.indexOf(this.data[e]),6)};var IT=pi,AT=function(t){for(var e=[],i=t.length,r=0;r<i;r++){var n=t.charCodeAt(r);if(n>=55296&&n<=56319&&i>r+1){var a=t.charCodeAt(r+1);a>=56320&&a<=57343&&(n=(n-55296)*1024+a-56320+65536,r+=1)}if(n<128){e.push(n);continue}if(n<2048){e.push(n>>6|192),e.push(n&63|128);continue}if(n<55296||n>=57344&&n<65536){e.push(n>>12|224),e.push(n>>6&63|128),e.push(n&63|128);continue}if(n>=65536&&n<=1114111){e.push(n>>18|240),e.push(n>>12&63|128),e.push(n>>6&63|128),e.push(n&63|128);continue}e.push(239,191,189)}return new Uint8Array(e).buffer};const LT=AT,CT=Ts;function bi(s){this.mode=CT.BYTE,typeof s=="string"&&(s=LT(s)),this.data=new Uint8Array(s)}bi.getBitsLength=function(t){return t*8};bi.prototype.getLength=function(){return this.data.length};bi.prototype.getBitsLength=function(){return bi.getBitsLength(this.data.length)};bi.prototype.write=function(s){for(let t=0,e=this.data.length;t<e;t++)s.put(this.data[t],8)};var OT=bi;const BT=Ts,RT=de;function xi(s){this.mode=BT.KANJI,this.data=s}xi.getBitsLength=function(t){return t*13};xi.prototype.getLength=function(){return this.data.length};xi.prototype.getBitsLength=function(){return xi.getBitsLength(this.data.length)};xi.prototype.write=function(s){let t;for(t=0;t<this.data.length;t++){let e=RT.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),s.put(e,13)}};var FT=xi,u_={exports:{}};(function(s){var t={single_source_shortest_paths:function(e,i,r){var n={},a={};a[i]=0;var o=t.PriorityQueue.make();o.push(i,0);for(var c,u,l,h,$,_,g,f,m;!o.empty();){c=o.pop(),u=c.value,h=c.cost,$=e[u]||{};for(l in $)$.hasOwnProperty(l)&&(_=$[l],g=h+_,f=a[l],m=typeof a[l]>"u",(m||f>g)&&(a[l]=g,o.push(l,g),n[l]=u))}if(typeof r<"u"&&typeof a[r]>"u"){var p=["Could not find a path from ",i," to ",r,"."].join("");throw new Error(p)}return n},extract_shortest_path_from_predecessor_list:function(e,i){for(var r=[],n=i;n;)r.push(n),e[n],n=e[n];return r.reverse(),r},find_path:function(e,i,r){var n=t.single_source_shortest_paths(e,i,r);return t.extract_shortest_path_from_predecessor_list(n,r)},PriorityQueue:{make:function(e){var i=t.PriorityQueue,r={},n;e=e||{};for(n in i)i.hasOwnProperty(n)&&(r[n]=i[n]);return r.queue=[],r.sorter=e.sorter||i.default_sorter,r},default_sorter:function(e,i){return e.cost-i.cost},push:function(e,i){var r={value:e,cost:i};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};s.exports=t})(u_);var PT=u_.exports;(function(s){const t=Ts,e=wT,i=IT,r=OT,n=FT,a=Ve,o=de,c=PT;function u(p){return unescape(encodeURIComponent(p)).length}function l(p,x,b){const T=[];let y;for(;(y=p.exec(b))!==null;)T.push({data:y[0],index:y.index,mode:x,length:y[0].length});return T}function h(p){const x=l(a.NUMERIC,t.NUMERIC,p),b=l(a.ALPHANUMERIC,t.ALPHANUMERIC,p);let T,y;return o.isKanjiModeEnabled()?(T=l(a.BYTE,t.BYTE,p),y=l(a.KANJI,t.KANJI,p)):(T=l(a.BYTE_KANJI,t.BYTE,p),y=[]),x.concat(b,T,y).sort(function(L,B){return L.index-B.index}).map(function(L){return{data:L.data,mode:L.mode,length:L.length}})}function $(p,x){switch(x){case t.NUMERIC:return e.getBitsLength(p);case t.ALPHANUMERIC:return i.getBitsLength(p);case t.KANJI:return n.getBitsLength(p);case t.BYTE:return r.getBitsLength(p)}}function _(p){return p.reduce(function(x,b){const T=x.length-1>=0?x[x.length-1]:null;return T&&T.mode===b.mode?(x[x.length-1].data+=b.data,x):(x.push(b),x)},[])}function g(p){const x=[];for(let b=0;b<p.length;b++){const T=p[b];switch(T.mode){case t.NUMERIC:x.push([T,{data:T.data,mode:t.ALPHANUMERIC,length:T.length},{data:T.data,mode:t.BYTE,length:T.length}]);break;case t.ALPHANUMERIC:x.push([T,{data:T.data,mode:t.BYTE,length:T.length}]);break;case t.KANJI:x.push([T,{data:T.data,mode:t.BYTE,length:u(T.data)}]);break;case t.BYTE:x.push([{data:T.data,mode:t.BYTE,length:u(T.data)}])}}return x}function f(p,x){const b={},T={start:{}};let y=["start"];for(let v=0;v<p.length;v++){const L=p[v],B=[];for(let F=0;F<L.length;F++){const R=L[F],w=""+v+F;B.push(w),b[w]={node:R,lastCount:0},T[w]={};for(let I=0;I<y.length;I++){const D=y[I];b[D]&&b[D].node.mode===R.mode?(T[D][w]=$(b[D].lastCount+R.length,R.mode)-$(b[D].lastCount,R.mode),b[D].lastCount+=R.length):(b[D]&&(b[D].lastCount=R.length),T[D][w]=$(R.length,R.mode)+4+t.getCharCountIndicator(R.mode,x))}}y=B}for(let v=0;v<y.length;v++)T[y[v]].end=0;return{map:T,table:b}}function m(p,x){let b;const T=t.getBestModeForData(p);if(b=t.from(x,T),b!==t.BYTE&&b.bit<T.bit)throw new Error('"'+p+'" cannot be encoded with mode '+t.toString(b)+`.
 Suggested mode is: `+t.toString(T));switch(b===t.KANJI&&!o.isKanjiModeEnabled()&&(b=t.BYTE),b){case t.NUMERIC:return new e(p);case t.ALPHANUMERIC:return new i(p);case t.KANJI:return new n(p);case t.BYTE:return new r(p)}}s.fromArray=function(x){return x.reduce(function(b,T){return typeof T=="string"?b.push(m(T,null)):T.data&&b.push(m(T.data,T.mode)),b},[])},s.fromString=function(x,b){const T=h(x,o.isKanjiModeEnabled()),y=g(T),v=f(y,b),L=c.find_path(v.map,"start","end"),B=[];for(let F=1;F<L.length-1;F++)B.push(v.table[L[F]].node);return s.fromArray(_(B))},s.rawSplit=function(x){return s.fromArray(h(x,o.isKanjiModeEnabled()))}})(c_);const Oa=de,ja=Aa,kT=fT,NT=gT,DT=Q$,UT=t_,vo=e_,So=La,YT=pT,Vn=r_,XT=a_,WT=Ts,Ka=c_;function VT(s,t){const e=s.size,i=UT.getPositions(t);for(let r=0;r<i.length;r++){const n=i[r][0],a=i[r][1];for(let o=-1;o<=7;o++)if(!(n+o<=-1||e<=n+o))for(let c=-1;c<=7;c++)a+c<=-1||e<=a+c||(o>=0&&o<=6&&(c===0||c===6)||c>=0&&c<=6&&(o===0||o===6)||o>=2&&o<=4&&c>=2&&c<=4?s.set(n+o,a+c,!0,!0):s.set(n+o,a+c,!1,!0))}}function GT(s){const t=s.size;for(let e=8;e<t-8;e++){const i=e%2===0;s.set(e,6,i,!0),s.set(6,e,i,!0)}}function zT(s,t){const e=DT.getPositions(t);for(let i=0;i<e.length;i++){const r=e[i][0],n=e[i][1];for(let a=-2;a<=2;a++)for(let o=-2;o<=2;o++)a===-2||a===2||o===-2||o===2||a===0&&o===0?s.set(r+a,n+o,!0,!0):s.set(r+a,n+o,!1,!0)}}function HT(s,t){const e=s.size,i=Vn.getEncodedBits(t);let r,n,a;for(let o=0;o<18;o++)r=Math.floor(o/3),n=o%3+e-8-3,a=(i>>o&1)===1,s.set(r,n,a,!0),s.set(n,r,a,!0)}function qa(s,t,e){const i=s.size,r=XT.getEncodedBits(t,e);let n,a;for(n=0;n<15;n++)a=(r>>n&1)===1,n<6?s.set(n,8,a,!0):n<8?s.set(n+1,8,a,!0):s.set(i-15+n,8,a,!0),n<8?s.set(8,i-n-1,a,!0):n<9?s.set(8,15-n-1+1,a,!0):s.set(8,15-n-1,a,!0);s.set(i-8,8,1,!0)}function jT(s,t){const e=s.size;let i=-1,r=e-1,n=7,a=0;for(let o=e-1;o>0;o-=2)for(o===6&&o--;;){for(let c=0;c<2;c++)if(!s.isReserved(r,o-c)){let u=!1;a<t.length&&(u=(t[a]>>>n&1)===1),s.set(r,o-c,u),n--,n===-1&&(a++,n=7)}if(r+=i,r<0||e<=r){r-=i,i=-i;break}}}function KT(s,t,e){const i=new kT;e.forEach(function(c){i.put(c.mode.bit,4),i.put(c.getLength(),WT.getCharCountIndicator(c.mode,s)),c.write(i)});const r=Oa.getSymbolTotalCodewords(s),n=So.getTotalCodewordsCount(s,t),a=(r-n)*8;for(i.getLengthInBits()+4<=a&&i.put(0,4);i.getLengthInBits()%8!==0;)i.putBit(0);const o=(a-i.getLengthInBits())/8;for(let c=0;c<o;c++)i.put(c%2?17:236,8);return qT(i,s,t)}function qT(s,t,e){const i=Oa.getSymbolTotalCodewords(t),r=So.getTotalCodewordsCount(t,e),n=i-r,a=So.getBlocksCount(t,e),o=i%a,c=a-o,u=Math.floor(i/a),l=Math.floor(n/a),h=l+1,$=u-l,_=new YT($);let g=0;const f=new Array(a),m=new Array(a);let p=0;const x=new Uint8Array(s.buffer);for(let L=0;L<a;L++){const B=L<c?l:h;f[L]=x.slice(g,g+B),m[L]=_.encode(f[L]),g+=B,p=Math.max(p,B)}const b=new Uint8Array(i);let T=0,y,v;for(y=0;y<p;y++)for(v=0;v<a;v++)y<f[v].length&&(b[T++]=f[v][y]);for(y=0;y<$;y++)for(v=0;v<a;v++)b[T++]=m[v][y];return b}function ZT(s,t,e,i){let r;if(Array.isArray(s))r=Ka.fromArray(s);else if(typeof s=="string"){let u=t;if(!u){const l=Ka.rawSplit(s);u=Vn.getBestVersionForData(l,e)}r=Ka.fromString(s,u||40)}else throw new Error("Invalid data");const n=Vn.getBestVersionForData(r,e);if(!n)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=n;else if(t<n)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+n+`.
`);const a=KT(t,e,r),o=Oa.getSymbolSize(t),c=new NT(o);return VT(c,t),GT(c),zT(c,t),qa(c,e,0),t>=7&&HT(c,t),jT(c,a),isNaN(i)&&(i=vo.getBestMask(c,qa.bind(null,c,e))),vo.applyMask(i,c),qa(c,e,i),{modules:c,version:t,errorCorrectionLevel:e,maskPattern:i,segments:r}}Z$.create=function(t,e){if(typeof t>"u"||t==="")throw new Error("No input text");let i=ja.M,r,n;return typeof e<"u"&&(i=ja.from(e.errorCorrectionLevel,ja.M),r=Vn.from(e.version),n=vo.from(e.maskPattern),e.toSJISFunc&&Oa.setToSJISFunction(e.toSJISFunc)),ZT(t,r,i,n)};var l_={},Lc={};(function(s){function t(e){if(typeof e=="number"&&(e=e.toString()),typeof e!="string")throw new Error("Color should be defined as hex string");let i=e.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+e);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(n){return[n,n]}))),i.length===6&&i.push("F","F");const r=parseInt(i.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+i.slice(0,6).join("")}}s.getOptions=function(i){i||(i={}),i.color||(i.color={});const r=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,n=i.width&&i.width>=21?i.width:void 0,a=i.scale||4;return{width:n,scale:n?4:a,margin:r,color:{dark:t(i.color.dark||"#000000ff"),light:t(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},s.getScale=function(i,r){return r.width&&r.width>=i+r.margin*2?r.width/(i+r.margin*2):r.scale},s.getImageWidth=function(i,r){const n=s.getScale(i,r);return Math.floor((i+r.margin*2)*n)},s.qrToImageData=function(i,r,n){const a=r.modules.size,o=r.modules.data,c=s.getScale(a,n),u=Math.floor((a+n.margin*2)*c),l=n.margin*c,h=[n.color.light,n.color.dark];for(let $=0;$<u;$++)for(let _=0;_<u;_++){let g=($*u+_)*4,f=n.color.light;if($>=l&&_>=l&&$<u-l&&_<u-l){const m=Math.floor(($-l)/c),p=Math.floor((_-l)/c);f=h[o[m*a+p]?1:0]}i[g++]=f.r,i[g++]=f.g,i[g++]=f.b,i[g]=f.a}}})(Lc);(function(s){const t=Lc;function e(r,n,a){r.clearRect(0,0,n.width,n.height),n.style||(n.style={}),n.height=a,n.width=a,n.style.height=a+"px",n.style.width=a+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}s.render=function(n,a,o){let c=o,u=a;typeof c>"u"&&(!a||!a.getContext)&&(c=a,a=void 0),a||(u=i()),c=t.getOptions(c);const l=t.getImageWidth(n.modules.size,c),h=u.getContext("2d"),$=h.createImageData(l,l);return t.qrToImageData($.data,n,c),e(h,u,l),h.putImageData($,0,0),u},s.renderToDataURL=function(n,a,o){let c=o;typeof c>"u"&&(!a||!a.getContext)&&(c=a,a=void 0),c||(c={});const u=s.render(n,a,c),l=c.type||"image/png",h=c.rendererOpts||{};return u.toDataURL(l,h.quality)}})(l_);var h_={};const JT=Lc;function Xu(s,t){const e=s.a/255,i=t+'="'+s.hex+'"';return e<1?i+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':i}function Za(s,t,e){let i=s+t;return typeof e<"u"&&(i+=" "+e),i}function QT(s,t,e){let i="",r=0,n=!1,a=0;for(let o=0;o<s.length;o++){const c=Math.floor(o%t),u=Math.floor(o/t);!c&&!n&&(n=!0),s[o]?(a++,o>0&&c>0&&s[o-1]||(i+=n?Za("M",c+e,.5+u+e):Za("m",r,0),r=0,n=!1),c+1<t&&s[o+1]||(i+=Za("h",a),a=0)):r++}return i}h_.render=function(t,e,i){const r=JT.getOptions(e),n=t.modules.size,a=t.modules.data,o=n+r.margin*2,c=r.color.light.a?"<path "+Xu(r.color.light,"fill")+' d="M0 0h'+o+"v"+o+'H0z"/>':"",u="<path "+Xu(r.color.dark,"stroke")+' d="'+QT(a,n,r.margin)+'"/>',l='viewBox="0 0 '+o+" "+o+'"',$='<svg xmlns="http://www.w3.org/2000/svg" '+(r.width?'width="'+r.width+'" height="'+r.width+'" ':"")+l+' shape-rendering="crispEdges">'+c+u+`</svg>
`;return typeof i=="function"&&i(null,$),$};const tv=$T,wo=Z$,d_=l_,ev=h_;function Cc(s,t,e,i,r){const n=[].slice.call(arguments,1),a=n.length,o=typeof n[a-1]=="function";if(!o&&!tv())throw new Error("Callback required as last argument");if(o){if(a<2)throw new Error("Too few arguments provided");a===2?(r=e,e=t,t=i=void 0):a===3&&(t.getContext&&typeof r>"u"?(r=i,i=void 0):(r=i,i=e,e=t,t=void 0))}else{if(a<1)throw new Error("Too few arguments provided");return a===1?(e=t,t=i=void 0):a===2&&!t.getContext&&(i=e,e=t,t=void 0),new Promise(function(c,u){try{const l=wo.create(e,i);c(s(l,t,i))}catch(l){u(l)}})}try{const c=wo.create(e,i);r(null,s(c,t,i))}catch(c){r(c)}}Yr.create=wo.create;Yr.toCanvas=Cc.bind(null,d_.render);Yr.toDataURL=Cc.bind(null,d_.renderToDataURL);Yr.toString=Cc.bind(null,function(s,t,e){return ev.render(s,e)});const sv=s=>new Promise(t=>{Yr.toDataURL(`${s}`,{width:320}).then(e=>{const i=document.getElementById(oT);if(!i)return t();i.src=e,t()})}),iv=()=>{const s=crypto.randomUUID();return dT(s),sv(s)},rv=()=>{const s=oa();s&&(s.close(),Uo(null))},nv=s=>{s.button===0&&(s.stopPropagation(),s.preventDefault(),K$())},av=()=>{const s=document.getElementById(aT);s&&s.addEventListener(E.MOUSE_DOWN,nv)};class ov extends Wt{constructor(){super(Fo)}initialize(){av()}show(){this._$state!=="show"&&iv().then(()=>{super.show()})}hide(){this._$state!=="hide"&&(super.hide(),rv())}}const cv=(s,t)=>new Promise(e=>{const i=s.name.split(".");i.pop();const r=i.join("."),n=t?`${t}/${r}`:r,a=M();if(!a.pathMap.has(n))return e();const o=a.pathMap.get(n),c=a.getLibrary(o);if(!c)return e();const u=new Image;u.src=URL.createObjectURL(s),u.decode().then(()=>{const l=u.width,h=u.height,$=ca();$.width=l,$.height=h;const _=$.getContext("2d",{willReadFrequently:!0});if(!_)throw new Error("CanvasRenderingContext2D cannot be loaded");_.drawImage(u,0,0,l,h);const g=new Uint8Array(_.getImageData(0,0,l,h).data);Ls($);const f=c.toObject(),m=new Ws({id:c.id,type:"bitmap",name:c.name,folderId:c.folderId,width:l,height:h,imageType:s.type,buffer:g});k$(a,a.scene,f,m),a.libraries.set(m.id,m),a.active&&(gt(),Q()),e()})}),uv=(s,t)=>new Promise(e=>{const i=s.name.split(".");i.pop();const r=i.join("."),n=t?`${t}/${r}`:r,a=M();if(!a.pathMap.has(n))return e();const o=a.pathMap.get(n),c=a.getLibrary(o);if(!c)return e();s.arrayBuffer().then(async u=>{const l=c.toObject(),h=new zs({id:c.id,type:"video",name:c.name,folderId:c.folderId,buffer:new Uint8Array(u)});await h.wait(),F$(a,a.scene,l,h),a.libraries.set(h.id,h),a.active&&(gt(),Q()),e()})}),lv=(s,t)=>new Promise(e=>{const i=s.name.split(".");i.pop();const r=i.join("."),n=t?`${t}/${r}`:r,a=M();if(!a.pathMap.has(n))return e();const o=a.pathMap.get(n),c=a.getLibrary(o);if(!c)return e();s.arrayBuffer().then(async u=>{const l=c.toObject(),h=new Hs({id:c.id,type:"sound",name:c.name,folderId:c.folderId,buffer:new Uint8Array(u)});await h.wait(),P$(a,a.scene,l,h),a.libraries.set(h.id,h),a.active&&(gt(),Q()),e()})}),$_=(s,t)=>{switch(s.type){case"image/png":case"image/jpeg":case"image/gif":return cv(s,t);case"video/mp4":return uv(s,t);case"audio/mpeg":return lv(s,t);case"application/x-shockwave-flash":return Promise.resolve();case"image/svg+xml":return Promise.resolve();default:return Promise.resolve()}},hv=async()=>{const s=Z(pe);if(s)switch(!0){case s.fileObject!==null:for(;s.fileObject!==null;)await $_(s.fileObject.file,s.fileObject.path),s.setupFileObject();break}},dv="confirm-all-overwriting",$v="confirm-all-cancel",_v="confirm-overwriting",fv="confirm-cancel",gv="confirm-before-preview",mv="confirm-after-preview",__="confirm-file-name",pv=async()=>{const s=Z(pe);if(!s)return;const t=document.getElementById(__);if(t){if(!t.value){const e=document.getElementById(pe);if(!e)return;const i=e.firstElementChild,r=i.offsetLeft-i.clientWidth/2,n=i.offsetTop-i.clientHeight/2;$c(wb,r+t.offsetLeft+25,n+t.offsetTop-t.clientHeight+5);return}switch(!0){case s.fileObject!==null:{const e=s.fileObject.file,i=s.fileObject.path,r=e.name.split(".");r.pop();const n=r.join(".");t.value===n?await $_(e,i):await new Kt(M()).importFile(e,t.value,i),s.setupFileObject()}break}}},bv=()=>{const s=Z(pe);s&&(ma(),s.hide())},xv=()=>{const s=Z(pe);if(s)switch(!0){case s.fileObject!==null:s.setupFileObject();break}},yv=()=>{const s=document.getElementById(dv);s&&s.addEventListener(E.MOUSE_DOWN,hv);const t=document.getElementById($v);t&&t.addEventListener(E.MOUSE_DOWN,bv);const e=document.getElementById(_v);e&&e.addEventListener(E.MOUSE_DOWN,pv);const i=document.getElementById(fv);i&&i.addEventListener(E.MOUSE_DOWN,xv)},Ev=s=>{switch(s.type){case"image/svg+xml":case"image/png":case"image/jpeg":case"image/gif":return new Promise(t=>{const e=new Image;e.addEventListener("load",()=>{t(e)}),e.src=URL.createObjectURL(s)});case"video/mp4":return new Promise(t=>{const e=document.createElement("video");e.crossOrigin="anonymous",e.muted=!0,e.autoplay=!1,e.controls=!0,e.addEventListener("canplaythrough",()=>{t(e)}),e.src=URL.createObjectURL(s),e.load()});case"audio/mpeg":return new Promise(t=>{const e=document.createElement("audio");e.preload="auto",e.autoplay=!1,e.loop=!1,e.controls=!0,e.addEventListener("canplaythrough",()=>{s.arrayBuffer().then(async i=>{const r=await yo(new Uint8Array(i));t(qd(r,e))})}),e.src=URL.createObjectURL(s),e.load()})}return Promise.resolve()},Tv=(s,t)=>{const e=document.getElementById(__);if(!e)return;const i=document.getElementById(gv);if(!i)return;const r=document.getElementById(mv);if(r){for(e.value=t.name,e.focus();i.firstElementChild;){const n=i.firstElementChild;n instanceof HTMLCanvasElement&&Ls(n),n.remove()}for(;r.firstElementChild;){const n=r.firstElementChild;n instanceof HTMLCanvasElement&&Ls(n),n.remove()}Ev(s).then(n=>{n&&(n.classList.add("preview-center"),r.appendChild(n))}),t.getHTMLElement().then(n=>{n&&(n.classList.add("preview-center"),i.appendChild(n))})}};class vv extends Wt{_$instanceObject;_$fileObject;_$fileObjects;_$instanceObjects;constructor(){super(pe),this._$fileObjects=[],this._$fileObject=null,this._$instanceObjects=[],this._$instanceObject=null}initialize(){yv()}get fileObjects(){return this._$fileObjects}get fileObject(){return this._$fileObject}set fileObject(t){this._$fileObject=t}setupFileObject(){if(!this._$fileObjects.length)return ma(),this.hide();this._$fileObject=this._$fileObjects.pop(),Tv(this._$fileObject.file,this._$fileObject.instance),this.show()}get instanceObjects(){return this._$instanceObjects}get instanceObject(){return this._$instanceObject}set instanceObject(t){this._$instanceObject=t}setupInstanceObject(){if(!this._$instanceObjects.length)return Bd(),this.hide();this._$instanceObject=this._$instanceObjects.pop(),this.show()}}class Sv extends Wt{constructor(){super(Pn)}initialize(){}move(t){return t.style.left=`${this.offsetLeft}px`,t.style.top=`${this.offsetTop}px`,t}}const Wu=[cE,p2,Oy,oE,dE,pE,bE,xE,yE,SE,OE,zE,rT,ov,vv,Sv],wv=async()=>{const s=[];for(let t=0;t<Wu.length;++t){const e=Wu[t],i=new e;i.initialize&&s.push(i.initialize())}await Promise.all(s)},Mv=()=>{z(),Ea().initialize()},Iv=()=>{const s=document.getElementById("screen-tab-add");s&&(s.addEventListener(E.MOUSE_DOWN,t=>{t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()}),s.addEventListener(E.MOUSE_UP,t=>{t.stopPropagation(),Mv()}))},Av=async()=>{if(!Fs.scenes.length)return;const s=document.getElementById(Ar);if(!s)return;const t=s.lastElementChild;if(!t)return;t.remove();const e=Fs.scenes.pop(),i=M(),r=i.getLibrary(e);if(!r)return;await new ds(i).runMovieClip(new Hi(i,r))};let gn=!1;const Lv=s=>{s.button===0&&(gn?(gn=!1,s.stopPropagation(),s.preventDefault(),Av()):(gn=!0,setTimeout(()=>{gn=!1},300)))},Cv=()=>{const s=document.getElementById(Ro);s&&s.addEventListener(E.MOUSE_DOWN,Lv)},Ov=()=>new Promise(s=>(Iv(),Cv(),s())),f_=s=>{s.stopPropagation(),s.preventDefault(),requestAnimationFrame(()=>{const t=document.getElementById(ms);t&&(t.style.left=`${t.offsetLeft+s.movementX}px`,t.style.top=`${t.offsetTop+s.movementY}px`)})},g_=s=>{s.stopPropagation(),window.removeEventListener(E.MOUSE_MOVE,f_),window.removeEventListener(E.MOUSE_UP,g_),kt("auto");const t=document.getElementById(ms);if(!t)return;t.style.left=`${t.offsetLeft+s.movementX}px`,t.style.top=`${t.offsetTop+s.movementY}px`;const e=M(),i=e.timelineAreaState;i.state="move",i.offsetLeft=t.offsetLeft,i.offsetTop=t.offsetTop,i.width=t.clientWidth,i.height=t.clientHeight,e.updateTimelineArea(i),Os(t.offsetTop)},Bv=()=>{window.addEventListener(E.MOUSE_MOVE,f_),window.addEventListener(E.MOUSE_UP,g_)},Rv=()=>{if(!hm()){kt("auto");return}if(br(!1),Vh()==="down"){const s=document.getElementById(ms);if(!s)return;const t=M();t.timelineAreaState.state==="fixed"&&(t.timelineAreaState.state="move",t.timelineAreaState.offsetLeft=s.offsetLeft,t.timelineAreaState.offsetTop=s.offsetTop,Os(s.offsetTop),u$(s),Lr()),kt("move"),Bv(),ks(),Ds()}else kt("auto")};let mn=!1,Vu;const Fv=s=>{if(!(s.button!==0||ss()))if(s.stopPropagation(),s.preventDefault(),z(),da("down"),!mn)mn=!0,setTimeout(()=>{mn=!1},300),br(!0),Vu=setTimeout(()=>{if(!Vi()&&!st()){Ir();return}Rv()},600);else{mn=!1,clearTimeout(Vu),br(!1);const t=M();if(t.timelineAreaState.state==="fixed")return;t.timelineAreaState.state="fixed",t.timelineAreaState.offsetLeft=0,t.timelineAreaState.offsetTop=0,t.timelineAreaState.width=0;const e=document.getElementById(ms);if(!e)return;l$(e),ks(),Ds(),Os(e.offsetTop)}},Pv=()=>{da("up"),br(!1)},kv=s=>{s.stopPropagation(),br(!1)},Gu=s=>{s.stopPropagation(),console.log([s])},Nv=()=>{const s=document.getElementById(ms);if(!s)return;s.addEventListener(E.MOUSE_DOWN,Fv),s.addEventListener(E.MOUSE_UP,Pv),s.addEventListener(E.MOUSE_OUT,kv);const t=document.getElementById(Gi);t&&(t.addEventListener(E.MOUSE_OVER,()=>{window.addEventListener("keypress",Gu)}),t.addEventListener(E.MOUSE_LEAVE,()=>{window.removeEventListener("keypress",Gu)}))},m_=s=>{s.stopPropagation(),s.preventDefault(),requestAnimationFrame(()=>{const t=document.documentElement.style;let e=parseFloat(t.getPropertyValue("--timeline-logic-width"));e+=s.movementX,e=Math.max(Ah,e),t.setProperty("--timeline-logic-width",`${e}px`);const i=M();i.timelineAreaState.width=e,ks(),Ds(),is()})},p_=s=>{s.stopPropagation(),window.removeEventListener(E.MOUSE_MOVE,m_),window.removeEventListener(E.MOUSE_UP,p_)},Dv=s=>{s.stopPropagation(),s.preventDefault(),z(),window.addEventListener(E.MOUSE_MOVE,m_),window.addEventListener(E.MOUSE_UP,p_)},b_=s=>{s.stopPropagation(),s.preventDefault(),requestAnimationFrame(()=>{const t=document.documentElement.style,e=M().timelineAreaState,i=e.state==="move"?"--timeline-logic-height":"--timeline-height";let r=parseFloat(t.getPropertyValue(i));r+=-s.movementY,r=Math.max(eu,r);const n=document.getElementById(ms);if(e.state==="move"){if(n&&eu<r){const o=n.offsetTop+s.movementY;e.offsetTop=o,n.style.top=`${o}px`,Os(o)}}else t.setProperty("--timeline-height",`${r}px`),n&&Os(n.offsetTop);e.height=r,t.setProperty("--timeline-logic-height",`${r}px`),d$(),_a(),gi(),Math.floor(K.clientHeight/e.frameHeight)>K.numberOfDisplays&&Xe()})},x_=s=>{s.stopPropagation(),window.removeEventListener(E.MOUSE_MOVE,b_),window.removeEventListener(E.MOUSE_UP,x_)},Uv=s=>{s.stopPropagation(),s.preventDefault(),z(),window.addEventListener(E.MOUSE_MOVE,b_),window.addEventListener(E.MOUSE_UP,x_)},Yv=()=>{const s=document.getElementById(Xo);s&&s.addEventListener(E.MOUSE_DOWN,Dv);const t=document.getElementById(tg);t&&t.addEventListener(E.MOUSE_DOWN,Uv)},y_=s=>{s.stopPropagation(),s.preventDefault(),requestAnimationFrame(()=>{const t=M(),e=$t.clientWidth,i=t.timelineAreaState.frameWidth+1,r=e/(Us()*i);zt(Math.floor(s.movementX/r))})},E_=s=>{s.stopPropagation(),window.removeEventListener(E.MOUSE_MOVE,y_),window.removeEventListener(E.MOUSE_UP,E_)},Xv=s=>{s.stopPropagation(),window.addEventListener(E.MOUSE_MOVE,y_),window.addEventListener(E.MOUSE_UP,E_)},Wv=()=>{const s=document.getElementById(Ih);s&&s.addEventListener(E.MOUSE_DOWN,Xv)},T_=s=>{s.stopPropagation(),s.preventDefault(),requestAnimationFrame(()=>{const t=M(),e=K.clientHeight,i=t.timelineAreaState.frameHeight,r=e/(t.scene.layers.length*i);ke(Math.floor(s.movementY/r))})},v_=s=>{s.stopPropagation(),window.removeEventListener(E.MOUSE_MOVE,T_),window.removeEventListener(E.MOUSE_UP,v_)},Vv=s=>{s.stopPropagation(),window.addEventListener(E.MOUSE_MOVE,T_),window.addEventListener(E.MOUSE_UP,v_)},Gv=()=>{const s=document.getElementById(Go);s&&s.addEventListener(E.MOUSE_DOWN,Vv)},Mo=()=>{const s=M(),t=s.scene;let e=0;if(t.selectedLayers.length){const r=t.selectedLayers[0];e=t.layers.indexOf(r)}new Ot(s,t).addNewLayer(e)},zv=s=>{s.button===0&&(s.stopPropagation(),s.preventDefault(),Mo())},Hv=()=>{const s=document.getElementById(ig);s&&s.addEventListener(E.MOUSE_DOWN,zv)},S_=s=>{s.stopPropagation(),s.preventDefault(),kt("ew-resize"),requestAnimationFrame(()=>{const t=M().scene,e=he(t.currentFrame+s.movementX,1,Us());switch(Is(e),!0){case mt()>e:zt(-$t.clientWidth);break;case e>=xs():zt($t.clientWidth);break;default:is();break}})},w_=()=>{window.removeEventListener(E.MOUSE_MOVE,S_),window.removeEventListener(E.MOUSE_UP,w_),kt("auto");const s=document.getElementById(Vo);s&&s.focus()},jv=()=>{window.addEventListener(E.MOUSE_MOVE,S_),window.addEventListener(E.MOUSE_UP,w_)},Kv=s=>{if(s.button!==0||ss())return;s.stopPropagation(),s.preventDefault(),z();const t=M();new Ot(t,t.scene).deactivatedAllLayers(),jv()},qv=s=>{if(ss())return;s.stopPropagation(),s.preventDefault();const t=s.currentTarget;t&&(t.style.cursor="ew-resize")},Zv=s=>{s.stopPropagation(),s.preventDefault();const t=s.currentTarget;t&&(t.style.cursor="")},Jv=s=>{s.stopPropagation(),s.preventDefault(),Ye(!0);const t=s.target;t&&(t.style.cursor="")},Qv=s=>{s.stopPropagation(),s.preventDefault(),Ye(!1)},tS=s=>{if(s.key!=="Enter")return;s.stopPropagation(),s.preventDefault();const t=s.currentTarget;if(!t)return;const e=he(parseInt(t.value),1,Us()),i=M(),r=he((e-1)*(i.timelineAreaState.frameWidth+1),0,tc());r?(i.scene.scrollX=0,zt(r)):zt(-i.scene.scrollX),Is(e),is(),t.value=`${e}`,t.blur()},eS=()=>{const s=document.getElementById(Vo);s&&(s.addEventListener(E.MOUSE_DOWN,Kv),s.addEventListener(E.MOUSE_OVER,qv),s.addEventListener(E.MOUSE_OUT,Zv),s.addEventListener("focusin",Jv),s.addEventListener("focusout",Qv),s.addEventListener("keypress",tS))},M_=(s=0,t=-1)=>{const e=s!==0?k(s):M();if(!e)return;const i=t===-1?e.scene:e.getLibrary(t);if(!i||2>i.layers.length)return;const r=i.selectedLayers;if(!r.length)return;const n=[];for(let o=0;o<r.length;++o){const c=r[o],u=new lt(e,i,c);n.push(u.index)}new Ot(e,i).deleteLayer(n)},sS=s=>{s.button===0&&(s.stopPropagation(),s.preventDefault(),M_())},iS=()=>{const s=document.getElementById(rg);s&&s.addEventListener(E.MOUSE_DOWN,sS)},rS=()=>{const s=M().scene.layers;switch(!0){case s.every(t=>t.light===!0):return!1;case s.every(t=>t.light===!1):return!0;default:return!Dg()}},nS=s=>{if(s.button!==0)return;s.stopPropagation(),s.preventDefault();const t=rS(),e=M(),i=e.scene,r=M().scene.layers;for(let n=0;n<r.length;++n){const a=r[n];if(!a)continue;new lt(e,i,a).setLight(t),Ns(a)}Ug(t)},aS=()=>{const s=document.getElementById(ng);s&&s.addEventListener(E.MOUSE_DOWN,nS)},oS=()=>{const s=M().scene.layers;switch(!0){case s.every(t=>t.disable===!0):return!1;case s.every(t=>t.disable===!1):return!0;default:return!Yg()}},cS=s=>{if(s.button!==0)return;s.stopPropagation(),s.preventDefault();const t=oS(),e=M(),i=e.scene,r=i.layers;for(let n=0;n<r.length;++n){const a=r[n];if(!a)continue;new lt(e,i,a).setDisable(t),Or(a)}Xg(t)},uS=()=>{const s=document.getElementById(ag);s&&s.addEventListener(E.MOUSE_DOWN,cS)},lS=()=>{const s=M().scene.layers;switch(!0){case s.every(t=>t.lock===!0):return!1;case s.every(t=>t.lock===!1):return!0;default:return!Wg()}},hS=s=>{if(s.button!==0)return;s.stopPropagation(),s.preventDefault();const t=lS(),e=M(),i=e.scene,r=i.layers;for(let n=0;n<r.length;++n){const a=r[n];if(!a)continue;new lt(e,i,a).setLock(t),Cr(a)}Vg(t)},dS=()=>{const s=document.getElementById(og);s&&s.addEventListener(E.MOUSE_DOWN,hS)},$S=s=>{s.button===0&&(s.stopPropagation(),s.preventDefault(),wc())},_S=()=>{const s=document.getElementById(cg);s&&s.addEventListener(E.MOUSE_DOWN,$S)},fS=(s,t)=>{new Ot(s,t).convertToKeyframes(t.currentFrame)},gS=s=>{if(s.button!==0)return;s.stopPropagation(),s.preventDefault();const t=M();fS(t,t.scene)},mS=()=>{const s=document.getElementById(gg);s&&s.addEventListener(E.MOUSE_DOWN,gS)},pS=()=>{Hv(),eS(),iS(),aS(),uS(),dS(),_S(),mS()},Gn=(s,t=!1)=>{s.stopPropagation(),s.preventDefault();const e=M(),i=e.scene,r=e.timelineAreaState;let n=r.offsetLeft;r.state==="fixed"&&(n=e.toolAreaState.state==="fixed"?zi:0);const a=r.frameWidth+1,o=zo+n,c=o,u=$t.clientWidth+o;if(s.pageX>u){requestAnimationFrame(()=>{if(!(t&&!xt())){if(Is(Math.min(i.currentFrame+1,Us())),!zt(a)){ut(!1);return}(t||!xt())&&(t||ut(!0),Gn(s,!0))}});return}if(s.pageX<c){requestAnimationFrame(()=>{if(!(t&&!xt())){if(Is(Math.max(i.currentFrame-1,1)),!zt(-a)){ut(!1);return}(t||!xt())&&(t||ut(!0),Gn(s,!0))}});return}ut(!1),requestAnimationFrame(()=>{const l=s.target;if(!l)return;const h=l.parentElement;if(!h)return;const $=h.dataset.frame;$&&(Is(parseInt($)),is())})},I_=s=>{s.stopPropagation(),window.removeEventListener(E.MOUSE_MOVE,Gn),window.removeEventListener(E.MOUSE_UP,I_),ut(!1)},bS=s=>{s.stopPropagation();const t=M();new Ot(t,t.scene).deactivatedAllLayers(),window.addEventListener(E.MOUSE_MOVE,Gn),window.addEventListener(E.MOUSE_UP,I_)},xS=()=>{const s=document.getElementById(Mh);s&&s.addEventListener(E.MOUSE_DOWN,bS)},yS=()=>{const s=Z(Pn);if(!s)return;const t=document.getElementById(Ar);if(!t||!t.children.length)return;const e=document.getElementById(Oh);if(!e)return;z(Pn);const r=M().timelineAreaState,n=e.offsetLeft+e.clientWidth+5,a=e.offsetTop+e.clientHeight;if(r.state==="fixed")s.offsetLeft=n,s.offsetTop=a;else{const o=document.getElementById(ms);if(!o)return;s.offsetLeft=o.offsetLeft+n,s.offsetTop=o.offsetTop+a}s.show()},ES=s=>{s.button===0&&(s.stopPropagation(),yS())},TS=()=>{const s=document.getElementById(Oh);s&&s.addEventListener(E.MOUSE_DOWN,ES)},zu=[$t,K,Qo],vS=async()=>{const s=[];for(let t=0;t<zu.length;++t)s.push(zu[t].initialize());await Promise.all(s),Nv(),pS(),TS(),Yv(),Wv(),Gv(),xS()},SS=async()=>{let s=C$();if(!s){switch(navigator.language){case"ja":s="Japanese";break;case"ko":s="Korean";break;case"zh":s="Chinese";break;case"fr":s="French";break;case"ru":s="Russia";break;case"it":s="Italiano";break;case"es":s="Spanish";break;case"bg":s="Bulgaria";break;case"fi":s="Finland";break;case"de":s="Germany";break;case"hu":s="Hungary";break;case"id":s="indonesia";break;case"lv":s="Latvia";break;case"lt":s="Lithuania";break;case"nl":s="Netherlands";break;case"pl":s="Poland";break;case"ro":s="Romania";break;case"sk":s="Slovakia";break;case"tr":s="Turkey";break;default:s="English";break}A$(s)}await L$(s)},wS=()=>new Promise(s=>(window.addEventListener("click",T$),s())),MS=async s=>{location.hash&&!Un()||(s.preventDefault(),s.stopPropagation(),await Sc())},IS=()=>new Promise(s=>{window.addEventListener("beforeunload",MS,{passive:!1}),s()}),AS=()=>{ee(Xt("s",{ctrl:!0}),Sc),ee(Xt("z",{ctrl:!0}),async()=>{const s=M(),t=s.scene;await fc(s.id,t.id)}),ee(Xt("z",{ctrl:!0,shift:!0}),async()=>{const s=M(),t=s.scene;await _c(s.id,t.id)}),ee(Xt("u"),Ec)},LS=()=>{console.log("down")},CS=()=>{console.log("up")},OS=()=>{ee(Xt("+",{ctrl:!0}),Mo),ee(Xt(";",{ctrl:!0}),Mo),ee(Xt("ArrowUp",{ctrl:!0}),CS),ee(Xt("ArrowDown",{ctrl:!0}),LS),ee(Xt("Backspace",{ctrl:!0}),M_),ee(Xt("s"),wc)},BS=()=>{ee(Xt("m",{ctrl:!0,shift:!0}),W$),ee(Xt("f",{ctrl:!0,shift:!0}),X$),ee(Xt("r",{ctrl:!0}),V$),ee(Xt("e"),G$)},RS=async s=>{if(ss()||A0())return;const t=s.shiftKey,e=s.ctrlKey||s.metaKey,i=s.altKey;if(e)switch(s.key){case"-":case"+":case";":s.stopImmediatePropagation(),s.stopPropagation(),s.preventDefault();break}const r=Xt(s.key,{alt:i,shift:t,ctrl:e}),n=B0(),a=No();if(a.has(r)){const u=a.get(r),l=n.get(u);if(!l)return;s.stopImmediatePropagation(),s.stopPropagation(),s.preventDefault(),l(s);return}if(es().has(r)||!n.has(r))return;const c=n.get(r);c&&(s.stopImmediatePropagation(),s.stopPropagation(),s.preventDefault(),await c(s))},FS=()=>{window.addEventListener("keydown",RS)},PS=()=>new Promise(s=>(AS(),OS(),BS(),FS(),s())),kS=s=>{s.button===0&&(s.stopPropagation(),z())},NS=()=>{const s=document.getElementById(wx);s&&s.addEventListener(E.MOUSE_DOWN,kS)},DS=s=>{s.stopPropagation();const t=s.currentTarget;if(!t)return;const e=document.getElementById(`${t.dataset.settingName}-setting-view-area`);if(!e)return;const i=t.getElementsByTagName("i");if(!i.length)return;const r=i[0];r.classList.contains("active")?(r.classList.remove("active"),r.classList.add("disable"),e.style.display="none"):(r.classList.remove("disable"),r.classList.add("active"),e.style.display="")};let A_=!1;const US=()=>A_,zn=s=>{A_=s};let L_="up";const YS=()=>L_,C_=s=>{L_=s},XS=s=>{s.stopPropagation(),zn(!1)},WS=()=>{C_("up")},O_=s=>{s.stopPropagation(),s.preventDefault(),requestAnimationFrame(()=>{const t=document.getElementById(ji);t&&(t.style.left=`${t.offsetLeft+s.movementX}px`,t.style.top=`${t.offsetTop+s.movementY}px`)})},B_=s=>{s.stopPropagation(),window.removeEventListener(E.MOUSE_MOVE,O_),window.removeEventListener(E.MOUSE_UP,B_),kt("auto");const t=document.getElementById(ji);if(!t)return;t.style.left=`${t.offsetLeft+s.movementX}px`,t.style.top=`${t.offsetTop+s.movementY}px`,M().updatePropertyArea({state:"move",offsetLeft:t.offsetLeft,offsetTop:t.offsetTop})},VS=()=>{window.addEventListener(E.MOUSE_MOVE,O_),window.addEventListener(E.MOUSE_UP,B_)},GS=()=>{if(!US()){kt("auto");return}if(zn(!1),YS()==="down"){const s=document.getElementById(ji);if(!s)return;const t=M();t.propertyAreaState.state==="fixed"&&(t.propertyAreaState.state="move",t.propertyAreaState.offsetLeft=s.offsetLeft,t.propertyAreaState.offsetTop=s.offsetTop,m$(s),b$()),kt("move"),VS()}else kt("auto")};let pn=!1,Hu;const zS=s=>{if(s.button===0)if(s.stopPropagation(),s.preventDefault(),z(),C_("down"),!pn)pn=!0,setTimeout(()=>{pn=!1},300),zn(!0),Hu=setTimeout(()=>{if(!Vi()&&!st()){Ir();return}GS()},600);else{pn=!1,clearTimeout(Hu),zn(!1);const t=M();if(t.propertyAreaState.state==="fixed")return;t.updatePropertyArea({state:"fixed",offsetLeft:0,offsetTop:0});const e=document.getElementById(ji);if(!e)return;x$(e),p$()}},HS=()=>{const s=document.getElementsByClassName("container-title"),t=s.length;for(let i=0;i<t;++i){const r=s[i];r&&r.addEventListener(E.MOUSE_DOWN,DS)}const e=document.getElementById(ji);e&&(e.addEventListener(E.MOUSE_DOWN,zS),e.addEventListener(E.MOUSE_UP,WS),e.addEventListener(E.MOUSE_OUT,XS))},R_=s=>{s.stopPropagation(),s.preventDefault(),requestAnimationFrame(()=>{const t=document.documentElement.style;let e=parseFloat(t.getPropertyValue("--controller-width"));e-=s.movementX,e=Math.max(bc,e),t.setProperty("--controller-width",`${e}px`);const i=M();i.controllerAreaState.width=e})},F_=s=>{s.stopPropagation(),window.removeEventListener(E.MOUSE_MOVE,R_),window.removeEventListener(E.MOUSE_UP,F_)},jS=s=>{s.stopPropagation(),s.preventDefault(),z(),window.addEventListener(E.MOUSE_MOVE,R_),window.addEventListener(E.MOUSE_UP,F_)},KS=()=>{const s=document.getElementById(Mx);s&&s.addEventListener(E.MOUSE_DOWN,jS)},qS=s=>{s.stopPropagation(),z();const t=document.getElementById(xa);if(!t)return;const e=t.children,i=e.length;for(let a=0;a<i;++a){const o=e[a];if(!o||!o.classList.contains("active"))continue;o.classList.remove("active"),o.classList.add("disable");const c=document.getElementById(o.dataset.tabType);if(c){c.style.display="none";break}}const r=s.currentTarget;r.classList.remove("disable"),r.classList.add("active");const n=document.getElementById(r.dataset.tabType);n&&(n.style.display="")},ZS=()=>{const s=document.getElementById(xa);if(!s)return;const t=s.children,e=t.length;for(let i=0;i<e;++i){const r=t[i];r&&r.addEventListener(E.MOUSE_DOWN,qS)}};class JS{initialize(){ZS()}}const QS=new JS;class tw{_$lock;constructor(){this._$lock=!1}initialize(){}get lock(){return this._$lock}set lock(t){this._$lock=t}}const ew=new tw,ju=[ew,QS,j],sw=async()=>{NS(),KS(),HS();const s=[];for(let t=0;t<ju.length;++t){const e=ju[t];e.initialize&&s.push(e.initialize())}await Promise.all(s)},iw="view",rw=s=>{s.button===0&&(s.stopPropagation(),z())},nw=()=>{const s=document.getElementById(iw);s&&s.addEventListener(E.MOUSE_DOWN,rw)},aw=()=>{nw()},ow=()=>{const s=location.hash;s&&N$(s.replace("#",""))},cw=()=>{ow()},uw=()=>new Promise(s=>{const t=Z(me);if(!t)return;t.message=be("{{}}");const e=vc();e.onsuccess=i=>{if(!i.target)return;const r=i.target.result,a=r.transaction(`${Je}`,"readonly").objectStore(`${Je}`),o=a.get(`${th}`);o.onsuccess=c=>{if(!c.target)return;const u=c.target.result;if(u){const h=JSON.parse(u);Th(h.expire),Vi()&&q$()}const l=a.get(`${Ql}`);l.onsuccess=async h=>{if(!h.target)return;t.message=be("{{N2D}}");const $=h.target.result;$?await R$($):Ea(),r.close(),s()}}}}),lw=()=>uw(),hw=()=>{window.addEventListener("resize",()=>{M().timelineAreaState.state!=="move"&&(requestAnimationFrame(Ds),requestAnimationFrame(ks))})};class dw{getCurrentWorkSpace(){return new ds(M())}getAllWorkSpace(){const t=ya(),e=[];for(let i=0;i<t.length;++i)e.push(new ds(t[i]));return e}createWorkSpace(){return new ds(Ea())}async removeWorkSpace(t){await y$(t)}}const Ku=[h0,PS,wv,IS,wS,Ov,g2,vS,sw,aw,SS,cw],qu=[lw],$w=()=>{"nl"in window||(window.nl=new dw)},_w=async()=>{const s=[];for(let e=0;e<Ku.length;++e){const i=Ku[e];s.push(i())}await Promise.all(s);const t=Z(me);t&&t.update()},fw=async()=>{if(st()){const e=Z(me);e&&(e.message="Socket connection...");return}const s=Z(me);s&&(s.message="Booting the system.");const t=[];for(let e=0;e<qu.length;++e){const i=qu[e];t.push(i())}await Promise.all(t)},gw=async()=>{if(st())return;const s=[],t=ya();for(let e=0;e<t.length;++e){const i=t[e];s.push(i.initialize())}await Promise.all(s),hw(),await M().run(),await lh(document),await gc(document),$w()},Io=()=>{window.removeEventListener("DOMContentLoaded",Io),_w().then(fw).then(gw)};document.readyState==="loading"?window.addEventListener("DOMContentLoaded",Io):Io();
